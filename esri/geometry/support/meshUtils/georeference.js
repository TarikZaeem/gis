// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat3f64 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/mat3 ../../projection ../../spatialReferenceEllipsoidUtils ../MeshTransform ../buffer/BufferView ../../../chunks/vec32 ./geographicUtils ./projection".split(" "),function(p,l,t,H,z,A,B,I,J,K,k,q,u,m){function v(b,a,d){if(u.isGeographicMesh(a.spatialReference,d)){var e=a.spatialReference,f=C(a,d,w);d=new Float64Array(b.position.length);var c=b.position,h=
f;a=e;var g=d;q.transformMat4(k.BufferViewVec3f64.fromTypedArray(g),k.BufferViewVec3f64.fromTypedArray(c),h);c=new Float64Array(c.length);a=m.projectFromPCPF(g,c,a);f=B.normalFromMat4(D,f);g=d;c=b.normal;h=f;var r=e;if(l.isNone(c))g=null;else{var n=new Float32Array(c.length);q.transformMat3(k.BufferViewVec3f.fromTypedArray(n),k.BufferViewVec3f.fromTypedArray(c),h);m.projectNormalFromPCPF(n,a,g,r,n);g=n}b=b.tangent;if(l.isNone(b))b=null;else{c=new Float32Array(b.length);q.transformMat3(k.BufferViewVec3f.fromTypedArray(c,
4*Float32Array.BYTES_PER_ELEMENT),k.BufferViewVec3f.fromTypedArray(b,4*Float32Array.BYTES_PER_ELEMENT),f);for(f=3;f<c.length;f+=4)c[f]=b[f];m.projectTangentFromPCPF(c,a,d,e,c);b=c}b={position:a,normal:g,tangent:b}}else{e=new Float64Array(b.position.length);f=b.position;g=a.x;c=a.y;h=a.z||0;const {horizontal:E,vertical:L}=x(d?d.unit:null,a.spatialReference);for(a=0;a<f.length;a+=3)e[a+0]=f[a+0]*E+g,e[a+1]=f[a+1]*E+c,e[a+2]=f[a+2]*L+h;b={position:e,normal:b.normal,tangent:b.tangent}}return b}function F(b,
a,d){const {position:e,normal:f,tangent:c}=b;if(l.isNone(a))return{position:e,normal:f,tangent:c};var h=a.localMatrix;b=m.transformPosition(e,new Float64Array(e.length),h);const g=l.isSome(f)?m.transformNormal(f,new Float32Array(f.length),h):null;h=l.isSome(c)?m.transformTangent(c,new Float32Array(c.length),h):null;return v({position:b,normal:g,tangent:h},a.getOriginPoint(d),{geographic:a.geographic})}function y(b,a,d){if(u.isGeographicMesh(a.spatialReference,d)){var e=a.spatialReference;C(a,d,w);
var f=z.invert(M,w);d=new Float64Array(b.position.length);a=f;var c=m.projectToPCPF(b.position,e,d),h=k.BufferViewVec3f64.fromTypedArray(c);c=new Float64Array(c.length);var g=k.BufferViewVec3f64.fromTypedArray(c);q.transformMat4(g,h,a);a=c;f=B.normalFromMat4(D,f);c=b.normal;g=b.position;var r=d,n=e;h=f;l.isNone(c)?h=null:(c=m.projectNormalToPCPF(c,g,r,n,new Float32Array(c.length)),g=k.BufferViewVec3f.fromTypedArray(c),q.transformMat3(g,g,h),h=c);c=b.tangent;b=b.position;g=e;e=f;l.isNone(c)?e=null:
(b=m.projectTangentToPCPF(c,b,d,g,new Float32Array(c.length)),d=k.BufferViewVec3f.fromTypedArray(b,4*Float32Array.BYTES_PER_ELEMENT),q.transformMat3(d,d,e),e=b);e={position:a,normal:h,tangent:e}}else e=G(b,a,d);return e}function G(b,a,d){const e=new Float64Array(b.position.length),f=b.position,c=a.x,h=a.y,g=a.z||0,{horizontal:r,vertical:n}=x(d?d.unit:null,a.spatialReference);for(a=0;a<f.length;a+=3)e[a+0]=(f[a+0]-c)/r,e[a+1]=(f[a+1]-h)/r,e[a+2]=(f[a+2]-g)/n;return{position:e,normal:b.normal,tangent:b.tangent}}
function C(b,a,d){I.computeTranslationToOriginAndRotation(b.spatialReference,[b.x,b.y,b.z||0],d,J.getSphericalPCPF(b.spatialReference));const {horizontal:e,vertical:f}=x(a?a.unit:null,b.spatialReference);z.scale(d,d,[e,e,f]);return d}function x(b,a){if(l.isNone(b))return N;const d=a.isGeographic?1:t.getMetersPerUnitForSR(a);a=a.isGeographic?1:t.getMetersPerVerticalUnitForSR(a);b=t.convertUnit(1,b,"meters");return{horizontal:b*d,vertical:b*a}}const w=A.create(),M=A.create(),D=H.create(),N={horizontal:1,
vertical:1};p.georeference=v;p.georeferenceApplyTransform=F;p.georeferenceByTransform=function(b,a,d){if(d?.useTransform){const {position:e,normal:f,tangent:c}=b;return{vertexAttributes:{position:e,normal:f,tangent:c},transform:new K({origin:[a.x,a.y,a.z??0],geographic:u.isGeographicMesh(a.spatialReference,d)})}}return{vertexAttributes:v(b,a,d),transform:null}};p.ungeoreference=y;p.ungeoreferenceByTransform=function(b,a,d,e){if(l.isNone(a))return y(b,d,e);b=F(b,a,d.spatialReference);return d.equals(a.getOriginPoint(d.spatialReference))?
G(b,d,e):y(b,d,e)};Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});