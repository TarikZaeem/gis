// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("require exports ../chunks/_rollupPluginBabelHelpers ../geometry ../core/Error ../core/Logger ../core/maybe ../geometry/SpatialReference".split(" "),function(B,k,x,u,C,D,E,F){function y(){v||(v=x._asyncToGenerator(function*(){const b=yield new Promise((c,a)=>B(["./arcadeUtils"],c,a));return{arcade:b.arcade,arcadeUtils:b,Dictionary:b.Dictionary,Feature:b.arcadeFeature}})());return v}const G=D.getLogger("esri.support.arcadeOnDemand");let v;u=(b,c,a)=>p.create(b,c,a,null,["$feature","$view"]);
let p=function(){function b(a,g,n,q,l,d,h){this.script=a;this.evaluate=q;this.fields=Array.isArray(d)?d:d.fields;this._syntaxTree=n;this._arcade=g;this._arcadeFeature=l;this._spatialReference=h;this._referencesGeometry=g.scriptTouchesGeometry(this._syntaxTree);this._referencesScale=this._arcade.referencesMember(this._syntaxTree,"scale")}b.create=function(){var a=x._asyncToGenerator(function*(g,n,q,l,d,h){const {arcade:f,Feature:H,Dictionary:z}=yield y(),w=F.fromJSON(n);let m;try{m=f.parseScript(g,
h)}catch(e){return G.error(new C("arcade-bad-expression","Failed to parse arcade script",{script:g,error:e})),null}d=d.reduce((e,I)=>({...e,[I]:null}),{});let r=null;E.isSome(l)&&(r=new z(l),r.immutable=!0,d.$config=null);h=(l=f.scriptUsesGeometryEngine(m))&&f.enableGeometrySupport();const J=f.scriptUsesFeatureSet(m)&&f.enableFeatureSetSupport(),A=(n=f.scriptIsAsync(m))&&f.enableAsyncSupport();d={vars:d,spatialReference:w,useAsync:!!A};yield Promise.all([h,J,A]);h=new Set;yield f.loadDependentModules(h,
m,null,n,l);const t=new z;t.immutable=!1;t.setField("scale",0);const K=f.compileScript(m,d);return new b(g,f,m,e=>{"$view"in e&&e.$view&&(t.setField("scale","object"===typeof e.$view?e.$view.scale:void 0),e.$view=t);r&&(e.$config=r);return K({vars:e,spatialReference:w})},new H,q,w)});return function(g,n,q,l,d,h){return a.apply(this,arguments)}}();var c=b.prototype;c.repurposeFeature=function(a){a.geometry&&!a.geometry.spatialReference&&(a.geometry.spatialReference=this._spatialReference);this._arcadeFeature.repurposeFromGraphicLikeObject(a.geometry,
a.attributes,{fields:this.fields});return this._arcadeFeature};c.referencesGeometry=function(){return this._referencesGeometry};c.referencesScale=function(){return this._referencesScale};return b}();k.ArcadeExpression=p;k.createDictionaryExpression=(b,c,a,g)=>p.create(b,c,a,g,["$feature","$view"]);k.createLabelExpression=(b,c,a)=>p.create(b,c,a,null,["$feature"]);k.createRendererExpression=u;k.createVVExpression=u;k.loadArcade=y;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});