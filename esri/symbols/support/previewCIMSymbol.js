// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/screenUtils ../cim/CIMSymbolHelper ../cim/CIMSymbolRasterizer ../cim/utils ./previewUtils ./renderUtils".split(" "),function(t,z,h,l,m,A,n,B){function p(){p=z._asyncToGenerator(function*(b,g={}){const {node:u,opacity:v,symbolConfig:q}=g;var f="object"===typeof q&&"isSquareFill"in q?q.isSquareFill:!1,c=g.cimOptions||g,d=c.geometryType||A.mapCIMSymbolToGeometryType(b?.data?.symbol);var a=g?.size;a="number"===typeof a?{width:a,height:a}:
{width:null!=a&&"object"===typeof a&&"width"in a?a.width:null,height:null!=a&&"object"===typeof a&&"height"in a?a.height:null};const {feature:w,fieldMap:x}=c;if(null==a.width||null==a.height){c=yield l.OverrideHelper.resolveSymbolOverrides(b.data,w,null,x,d);if(!c)return null;b=b.clone();b.data={type:"CIMSymbolReference",symbol:c};b.data.primitiveOverrides=void 0;var e=[];l.CIMSymbolHelper.fetchResources(c,r.resourceManager,e);0<e.length&&(yield Promise.all(e));e=l.CIMSymbolHelper.getEnvelope(c,null,
r.resourceManager);c=e?.width;e=e?.height;a.width="esriGeometryPolygon"===d?k:"esriGeometryPolyline"===d?C:null!=c&&isFinite(c)?Math.min(c,y):k;a.height="esriGeometryPolygon"===d?k:null!=e&&isFinite(e)?Math.max(Math.min(e,y),1):k}f=yield r.rasterizeCIMSymbolAsync(b,w,a,f||"esriGeometryPolygon"!==d?m.GeometryStyle.Preview:m.GeometryStyle.Legend,x,d);if(!f)return null;const {width:D,height:E}=f;b=document.createElement("canvas");b.width=D;b.height=E;b.getContext("2d").putImageData(f,0,0);f=h.pt2px(a.width);
a=h.pt2px(a.height);d=new Image(f,a);d.src=b.toDataURL();null!=v&&(d.style.opacity=`${v}`);b=d;null!=g.effectView&&(b=B.renderSymbol([[{shape:{type:"image",x:0,y:0,width:f,height:a,src:d.src},fill:null,stroke:null,offset:[0,0]}]],[f,a],{effectView:g.effectView}));u&&b&&u.appendChild(b);return b});return p.apply(this,arguments)}const r=new m.CIMSymbolRasterizer(null,!0),k=h.px2pt(n.SymbolSizeDefaults.size),y=h.px2pt(n.SymbolSizeDefaults.maxSize),C=h.px2pt(n.SymbolSizeDefaults.lineWidth);t.previewCIMSymbol=
function(b){return p.apply(this,arguments)};Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});