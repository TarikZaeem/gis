// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/has ../../core/maybe ../../core/promiseUtils ../../layers/support/source/DataLayerSource ./executeQueryJSON ./executeQueryPBF ../support/FeatureSet ../support/Query".split(" "),function(w,k,n,x,y,f,z,A,B,C,D,E){function p(){p=n._asyncToGenerator(function*(d,a,c,e){return t(d,a,c,e).then(b=>F(a,b,c,e))});return p.apply(this,arguments)}function t(d,a,c,e){return q.apply(this,arguments)}function q(){q=n._asyncToGenerator(function*(d,
a,c,e){e={...e};var b=E.from(a);b.sourceSpatialReference=b.sourceSpatialReference??c?.sourceSpatialReference??null;if(c?.gdbVersion||c?.dynamicDataSource)b=b===a?b.clone():b,b.gdbVersion=a.gdbVersion||c.gdbVersion,b.dynamicDataSource=a.dynamicDataSource?A.DataLayerSource.from(a.dynamicDataSource):c.dynamicDataSource;const h=c?.infoFor3D;if(f.isSome(h)&&u(a,h)){b=b===a?b.clone():b;b.formatOf3DObjects=null;for(g of h.queryFormats){if("3D_glb"===g){b.formatOf3DObjects=g;break}"3D_gltf"!==g||b.formatOf3DObjects||
(b.formatOf3DObjects=g)}if(!b.formatOf3DObjects)throw new x("query:unsupported-3d-query-formats","Could not find any supported 3D object query format. Only supported formats are 3D_glb and 3D_gltf");if(f.isNone(b.outFields)||!b.outFields.includes("*")){b=b===a?b.clone():b;f.isNone(b.outFields)&&(b.outFields=[]);const {originX:l,originY:G,originZ:H,translationX:I,translationY:J,translationZ:K,scaleX:L,scaleY:M,scaleZ:N,rotationX:O,rotationY:P,rotationZ:Q,rotationDeg:R}=h.transformFieldRoles;b.outFields.push(l,
G,H,I,J,K,L,M,N,O,P,Q,R)}}var g=b;a=null!=a.outStatistics?.[0];b=y("featurelayer-pbf-statistics");a=!a||b;let m;if("pbf"===c?.format&&a)try{m=yield C.executeRawQueryPBF(d,g,e)}catch(l){if("query:parsing-pbf"===l.name)c.format="json";else throw l;}"json"!==c?.format&&a||(m=yield B.executeRawQueryJSON(d,g,e));v(c?.fieldsIndex,m.fields);return m});return q.apply(this,arguments)}function v(d,a){if(f.isSome(d)&&f.isSome(a))for(const c of a)(a=d.get(c.name))&&Object.assign(c,a.toJSON())}function F(d,a,
c,e){return r.apply(this,arguments)}function r(){r=n._asyncToGenerator(function*(d,a,c,e){c=c?.infoFor3D;if(!u(d,c)||f.isNone(c)||!a.assetMaps||!a.features||!a.features.length)return D.fromJSON(a);({meshFeatureSetFromJSON:e}=yield z.whenOrAbort(new Promise((b,h)=>w(["../support/meshFeatureSet"],b,h)),e));return e(d,c,a)});return r.apply(this,arguments)}function u(d,a){return f.isSome(a)&&!0===d.returnGeometry&&"xyFootprint"!==d.multipatchOption&&!d.outStatistics}k.executeQuery=function(d,a,c,e){return p.apply(this,
arguments)};k.executeRawQuery=t;k.normalizeFields=v;Object.defineProperty(k,Symbol.toStringTag,{value:"Module"})});