// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./core/Collection ./core/collectionUtils ./core/deprecate ./core/JSONSupport ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./geometry/SpatialReference ./portal/Portal ./portal/PortalItem ./support/basemapDefinitions ./webdoc/support/writeUtils".split(" "),
function(F,p,h,u,y,G,g,H,I,J,v,z,w,x,l,P,K,L,M,A,N,B,C){var r;let O=0;g=r=function(m){function k(b){var a=m.call(this,b)||this;a.id=null;a.portalItem=null;a.spatialReference=null;a.thumbnailUrl=null;a.title="Basemap";a.id=Date.now().toString(16)+"-basemap-"+O++;a.baseLayers=new u;a.referenceLayers=new u;const c=d=>{d.parent&&d.parent!==p._assertThisInitialized(a)&&"remove"in d.parent&&d.parent.remove(d);d.parent=p._assertThisInitialized(a);"elevation"===d.type&&v.getLogger(a.declaredClass).error(`Layer '${d.title}, id:${d.id}' of type '${d.type}' is not supported as a basemap layer and will therefore be ignored.`)};
a.baseLayers.on("after-add",d=>c(d.item));a.referenceLayers.on("after-add",d=>c(d.item));a.baseLayers.on("after-remove",d=>{d.item.parent=null});a.referenceLayers.on("after-remove",d=>{d.item.parent=null});return a}p._inheritsLoose(k,m);var f=k.prototype;f.initialize=function(){this.when().catch(b=>{v.getLogger(this.declaredClass).error("#load()",`Failed to load basemap (title: '${this.title}', id: '${this.id}')`,b)});this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)};
f.destroy=function(){var b=this.baseLayers.removeAll();for(const a of b)a.destroy();b=this.referenceLayers.removeAll();for(const a of b)a.destroy();this.baseLayers.destroy();this.referenceLayers.destroy();this.portalItem?.destroy();this.portalItem=null};f.normalizeCtorArgs=function(b){b&&"resourceInfo"in b&&(this._set("resourceInfo",b.resourceInfo),b={...b},delete b.resourceInfo);return b};f._writeBaseLayers=function(b,a,c){const d=[];b&&(c={...c,layerContainerType:"basemap"},this.baseLayers.forEach(e=>
{e=C.getLayerJSON(e,c.webmap?c.webmap.getLayerJSONFromResourceInfo(e):null,c);z.isSome(e)&&d.push(e)}),this.referenceLayers.forEach(e=>{const n=C.getLayerJSON(e,c.webmap?c.webmap.getLayerJSONFromResourceInfo(e):null,c);z.isSome(n)&&("scene"!==e.type&&(n.isReference=!0),d.push(n))}));a.baseMapLayers=d};f.writeTitle=function(b,a){a.title=b||"Basemap"};f.load=function(b){this.addResolvingPromise(this._loadFromSource(b));return Promise.resolve(this)};f.loadAll=function(){return J.loadAll(this,b=>{b(this.baseLayers,
this.referenceLayers)})};f.clone=function(){const b={id:this.id,title:this.title,portalItem:this.portalItem,baseLayers:this.baseLayers.slice(),referenceLayers:this.referenceLayers.slice()};this.loaded&&(b.loadStatus="loaded");return(new r({resourceInfo:this.resourceInfo})).set(b)};f.read=function(b,a){this.resourceInfo||this._set("resourceInfo",{data:b,context:a});m.prototype.read.call(this,b,a)};f.write=function(b,a){b=b||{};a&&a.origin||(a={origin:"web-map",...a});m.prototype.write.call(this,b,
a);!this.loaded&&this.resourceInfo&&this.resourceInfo.data.baseMapLayers&&(b.baseMapLayers=this.resourceInfo.data.baseMapLayers.map(c=>{c=H.clone(c);c.url&&x.isProtocolRelative(c.url)&&(c.url=`https:${c.url}`);c.templateUrl&&x.isProtocolRelative(c.templateUrl)&&(c.templateUrl=`https:${c.templateUrl}`);return c}));return b};f._loadFromSource=function(){var b=p._asyncToGenerator(function*(a){const {resourceInfo:c,portalItem:d}=this;w.throwIfAborted(a);const e=[];c?(e.push(this._loadLayersFromJSON(c.data,
c.context?c.context.url:null,a)),c.data.id&&!c.data.title&&e.push(B.getBasemapTitle(c.data.id).then(n=>{n&&this.read({title:n},c.context)}))):d&&e.push(this._loadFromItem(d,a));yield Promise.all(e)});return function(a){return b.apply(this,arguments)}}();f._loadLayersFromJSON=function(){var b=p._asyncToGenerator(function*(a,c,d){var e=this.resourceInfo&&this.resourceInfo.context;const n=this.portalItem&&this.portalItem.portal||e&&e.portal||null,D=e&&"web-scene"===e.origin?"web-scene":"web-map",{populateOperationalLayers:E}=
yield new Promise((t,q)=>F(["./layers/support/layersCreator"],t,q));e=[];w.throwIfAborted(d);if(a.baseMapLayers&&Array.isArray(a.baseMapLayers)){c={context:{origin:D,url:c,portal:n,layerContainerType:"basemap"},defaultLayerType:"DefaultTileLayer"};const t=q=>"web-scene"===D&&"ArcGISSceneServiceLayer"===q.layerType||q.isReference;d=E(this.baseLayers,a.baseMapLayers.filter(q=>!t(q)),c);e.push(d);a=E(this.referenceLayers,a.baseMapLayers.filter(t),c);e.push(a)}yield w.eachAlways(e)});return function(a,
c,d){return b.apply(this,arguments)}}();f._loadFromItem=function(){var b=p._asyncToGenerator(function*(a,c){const d=yield(yield a.load(c)).fetchData("json",c),e=x.urlToObject(a.itemUrl??"");this._set("resourceInfo",{data:d.baseMap??{},context:{origin:"Web Scene"===a.type?"web-scene":"web-map",portal:a.portal||A.getDefault(),url:e}});this.read(this.resourceInfo.data,this.resourceInfo.context);this.read({spatialReference:d.spatialReference},this.resourceInfo.context);this.read({title:a.title,thumbnailUrl:a.thumbnailUrl},
{origin:"portal-item",portal:a.portal||A.getDefault(),url:e});return this._loadLayersFromJSON(this.resourceInfo.data,e,c)});return function(a,c){return b.apply(this,arguments)}}();k.fromId=function(b){const a=B.esriBasemapDefinitions[b];if(a){if(a.deprecated){let c=null;"dark-gray"===b?c="dark-gray-vector":"gray"===b?c="gray-vector":"streets"===b?c="streets-vector":"topo"===b&&(c="topo-vector");G.deprecated(v.getLogger("esri.Basemap"),`The ${b} basemap has entered mature support and is no longer being updated.`,
{replacement:c,see:"https://arcg.is/1iq8aD",warnOnce:!0})}return r.fromJSON(a)}return null};p._createClass(k,[{key:"baseLayers",set:function(b){this._set("baseLayers",y.referenceSetter(b,this._get("baseLayers")))}},{key:"referenceLayers",set:function(b){this._set("referenceLayers",y.referenceSetter(b,this._get("referenceLayers")))}}]);return k}(g.JSONSupportMixin(I));h.__decorate([l.property({json:{write:{ignoreOrigin:!0,target:"baseMapLayers",writer(m,k,f,b){this._writeBaseLayers(m,k,b)}},origins:{"web-scene":{write:{ignoreOrigin:!0,
target:{baseMapLayers:{type:u}},writer(m,k,f,b){this._writeBaseLayers(m,k,b)}}}}}})],g.prototype,"baseLayers",null);h.__decorate([l.property({type:String,json:{origins:{"web-scene":{write:!0}}}})],g.prototype,"id",void 0);h.__decorate([l.property({type:N})],g.prototype,"portalItem",void 0);h.__decorate([l.property()],g.prototype,"referenceLayers",null);h.__decorate([l.property({readOnly:!0})],g.prototype,"resourceInfo",void 0);h.__decorate([l.property({type:M})],g.prototype,"spatialReference",void 0);
h.__decorate([l.property()],g.prototype,"thumbnailUrl",void 0);h.__decorate([l.property({type:String,json:{origins:{"web-scene":{write:{isRequired:!0}}}}})],g.prototype,"title",void 0);h.__decorate([L.writer("title")],g.prototype,"writeTitle",null);return g=r=h.__decorate([K.subclass("esri.Basemap")],g)});