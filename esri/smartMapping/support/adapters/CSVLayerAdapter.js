// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/subclass ../../../rest/support/generateRendererUtils ../../statistics/support/utils ../../statistics/support/WorkerClient ../utils ./FeatureLayerAdapter ./support/utils".split(" "),function(l,w,r,t,m,D,E,F,x,u,n,y,z,A,B){m=function(v){function p(d){return v.call(this,
d)||this}l._inheritsLoose(p,v);var q=p.prototype;q._createGenerateRendererResult=function(){var d=l._asyncToGenerator(function*(a,b,e,c,f){a=a?.features;if(!a?.length)throw new r("csv-layer-adapter:insufficient-data","No features are available to calculate statistics");const h=B.ensureFeaturesJSON(a);a=null;if("percent-of-total"===c&&(a=(yield this.workerClient.summaryStatistics({field:b},h)).sum,null==a))throw new r("csv-layer-adapter:invalid","invalid normalizationTotal");if("class-breaks-definition"===
f.type)return b=(yield n.getDataValues({field:b,normalizationType:c,normalizationField:e,normalizationTotal:a},h)).filter(g=>Number.isFinite(g)),u.createGenerateRendererClassBreaks({definition:f,values:b,normalizationTotal:a});f=(yield n.getDataValues({field:b},h)).filter(g=>null!=g&&"string"===typeof g&&""!==g.trim());return u.createGenerateRendererUniqueValues(f)});return function(a,b,e,c,f){return d.apply(this,arguments)}}();q.generateRenderer=function(d,a){const b=d.classificationDefinition;let e=
null,c=null,f=null;"class-breaks-definition"===b.type?(e=b.classificationField,c=b.normalizationField,f=b.normalizationType):e=b.attributeField;const h=this.layer;return z.getFieldsList({field:e,normalizationField:c}).then(g=>{const k=h.createQuery();k.returnGeometry=!1;k.outFields=g;k.where=n.mergeWhereClauses(k.where,d.where);return h.queryFeatures(k,{signal:a}).then(C=>this._createGenerateRendererResult(C,e,c,f,b))})};q.load=function(d){var a=this;const b=this.layer.load(d).then(function(){var e=
l._asyncToGenerator(function*(c){a.geometryType=c.geometryType;a.objectIdField=c.objectIdField;a.supportsSQLExpression=!0;a._hasLocalSource=!1;a.hasQueryEngine=!0;a.workerClient=y.WorkerClient.getInstance();yield a.workerClient.open(t.unwrap(t.unwrap(d).signal))});return function(c){return e.apply(this,arguments)}}());this.addResolvingPromise(b);return Promise.resolve(this)};return p}(A);return m=w.__decorate([x.subclass("esri.smartMapping.support.adapters.CSVLayerAdapter")],m)});