// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define(["exports","./dom","./key","./observers"],function(g,n,t,p){function l(a){return!(!a||isNaN(Number(a)))}function m(a,b){if(!a)return a;const c=a.toLowerCase().indexOf("e")+1;return c?a.replace(/[eE]*$/g,"").substring(0,c).concat(a.slice(c).replace(/[eE]/g,"")).split(/[eE]/).map((d,f)=>1===f?b(d.replace(/\./g,"")):b(d)).join("e").replace(/^e/,"1e"):b(a)}function y(a){return t.numberKeys.some(b=>a.includes(b))}function u(a,b="cldr"){const c="cldr"===b?z:A;if(!a)return"en";if(c.includes(a))return a;
a=a.toLowerCase();if("nb"===a)return"no";if("t9n"===b&&"pt"===a)return"pt-BR";a.includes("-")&&(a=a.replace(/(\w+)-(\w+)/,(d,f,h)=>`${f}-${h.toUpperCase()}`),c.includes(a)||(a=a.split("-")[0]));return"zh"===a?"zh-CN":c.includes(a)?a:(console.warn(`Translations for the "${a}" locale are not available and will fall back to the default, English (en).`),"en")}const B=RegExp("-","g"),C=RegExp("\\.?0+$");class e{constructor(a){this.add=d=>e.fromBigInt(this.value+(new e(d)).value);this.subtract=d=>e.fromBigInt(this.value-
(new e(d)).value);this.multiply=d=>e._divRound(this.value*(new e(d)).value,e.SHIFT);this.divide=d=>e._divRound(this.value*e.SHIFT,(new e(d)).value);if(a instanceof e)return a;const [b,c]=String(a).split(".").concat("");this.value=BigInt(b+c.padEnd(e.DECIMALS,"0").slice(0,e.DECIMALS))+BigInt(e.ROUNDED&&"5"<=c[e.DECIMALS]);this.isNegative="-"===a.charAt(0)}getIntegersAndDecimals(){var a=this.value.toString().replace(B,"").padStart(e.DECIMALS+1,"0");const b=a.slice(0,-e.DECIMALS);a=a.slice(-e.DECIMALS).replace(C,
"");return{integers:b,decimals:a}}toString(){const {integers:a,decimals:b}=this.getIntegersAndDecimals();return`${this.isNegative?"-":""}${a}${b.length?"."+b:""}`}formatToParts(a){const {integers:b,decimals:c}=this.getIntegersAndDecimals(),d=a.numberFormatter.formatToParts(BigInt(b));this.isNegative&&d.unshift({type:"minusSign",value:a.minusSign});c.length&&(d.push({type:"decimal",value:a.decimal}),c.split("").forEach(f=>d.push({type:"fraction",value:f})));return d}format(a){const {integers:b,decimals:c}=
this.getIntegersAndDecimals(),d=`${this.isNegative?a.minusSign:""}${a.numberFormatter.format(BigInt(b))}`,f=c.length?`${a.decimal}${c.split("").map(h=>a.numberFormatter.format(Number(h))).join("")}`:"";return`${d}${f}`}}e.DECIMALS=100;e.ROUNDED=!0;e.SHIFT=BigInt("1"+"0".repeat(e.DECIMALS));e._divRound=(a,b)=>e.fromBigInt(a/b+(e.ROUNDED?a*BigInt(2)/b%BigInt(2):BigInt(0)));e.fromBigInt=a=>Object.assign(Object.create(e.prototype),{value:a});const D=/^([-0])0+(?=\d)/,E=/(?!^\.)\.$/,F=/(?!^-)-/g,G=/^-\b0\b\.?0*$/,
A="ar bg bs ca cs da de el en es et fi fr he hr hu id it ja ko lt lv no nl pl pt-BR pt-PT ro ru sk sl sr sv th tr uk vi zh-CN zh-HK zh-TW".split(" "),z="ar bg bs ca cs da de de-CH el en en-AU en-CA en-GB es es-MX et fi fr fr-CH he hi hr hu id it it-CH ja ko lt lv mk no nl pl pt pt-PT ro ru sk sl sr sv th tr uk vi zh-CN zh-HK zh-TW".split(" "),v="arab arabext bali beng deva fullwide gujr guru hanidec khmr knda laoo latn limb mlym mong mymr orya tamldec telu thai tibt".split(" "),q=(new Intl.NumberFormat).resolvedOptions().numberingSystem,
r="arab"!==q&&v.includes(q)?q:"latn",w=a=>v.includes(a)?a:r,k=new Set,x=p.createObserver("mutation",a=>{a.forEach(b=>{const c=b.target;k.forEach(d=>{if(n.containsCrossShadowBoundary(c,d.el)){var f=n.closestElementCrossShadowBoundary(d.el,"[lang]");if(f){var h=f.lang;d.effectiveLocale=f.hasAttribute("lang")&&""===h?"en":h}else d.effectiveLocale="en"}})})});class H{constructor(){this.delocalize=a=>this._numberFormatOptions?m(a,b=>b.trim().replace(new RegExp(`[${this._minusSign}]`,"g"),"-").replace(new RegExp(`[${this._group}]`,
"g"),"").replace(new RegExp(`[${this._decimal}]`,"g"),".").replace(new RegExp(`[${this._digits.join("")}]`,"g"),this._getDigitIndex)):a;this.localize=a=>this._numberFormatOptions?m(a,b=>l(b.trim())?(new e(b.trim())).format(this).replace(new RegExp(`[${this._actualGroup}]`,"g"),this._group):b):a}get group(){return this._group}get decimal(){return this._decimal}get minusSign(){return this._minusSign}get digits(){return this._digits}get numberFormatter(){return this._numberFormatter}get numberFormatOptions(){return this._numberFormatOptions}set numberFormatOptions(a){a.locale=
u(a?.locale);a.numberingSystem=w(a?.numberingSystem);if((this._numberFormatOptions||"en"!==a.locale||a.numberingSystem!==r||2!==Object.keys(a).length)&&JSON.stringify(this._numberFormatOptions)!==JSON.stringify(a)){this._numberFormatOptions=a;this._numberFormatter=new Intl.NumberFormat(this._numberFormatOptions.locale,this._numberFormatOptions);this._digits=[...(new Intl.NumberFormat(this._numberFormatOptions.locale,{useGrouping:!1,numberingSystem:this._numberFormatOptions.numberingSystem})).format(9876543210)].reverse();
var b=new Map(this._digits.map((c,d)=>[c,d]));a=(new Intl.NumberFormat(this._numberFormatOptions.locale)).formatToParts(-1.23456789E7);this._actualGroup=a.find(c=>"group"===c.type).value;this._group=0===this._actualGroup.trim().length?" ":this._actualGroup;this._decimal=a.find(c=>"decimal"===c.type).value;this._minusSign=a.find(c=>"minusSign"===c.type).value;this._getDigitIndex=c=>b.get(c)}}}p=new H;g.connectLocalized=function(a){a.effectiveLocale=a.el.lang||n.closestElementCrossShadowBoundary(a.el,
"[lang]")?.lang||document.documentElement.lang||"en";0===k.size&&x?.observe(document.documentElement,{attributes:!0,attributeFilter:["lang"],subtree:!0});k.add(a)};g.defaultNumberingSystem=r;g.disconnectLocalized=function(a){k.delete(a);0===k.size&&x.disconnect()};g.getSupportedLocale=u;g.getSupportedNumberingSystem=w;g.isValidNumber=l;g.numberStringFormatter=p;g.parseNumberString=function(a){return a&&y(a)?m(a,b=>{let c=!1;b=b.split("").filter((d,f)=>d.match(/\./g)&&!c?c=!0:d.match(/\-/g)&&0===f?
!0:t.numberKeys.includes(d)).reduce((d,f)=>d+f);return l(b)?(new e(b)).toString():""}):""};g.sanitizeNumberString=a=>m(a,b=>{const c=b.replace(F,"").replace(E,"").replace(D,"$1");return l(c)?G.test(c)?c:(new e(c)).toString():b})});