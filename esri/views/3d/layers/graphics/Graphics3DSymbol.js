// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable ./symbolComplexity".split(" "),function(n,x,g,u,y,z,A,v,q,B){const r={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(w){function t(a,d,c){var b=w.call(this,d.schedule)||this;b._symbol=a;b._context=d;b._backgroundLayers=c;b._destroyed=
!1;b.symbolLayers=[];b.referenced=0;b._extentPadding=0;return b}n._inheritsLoose(t,w);var l=t.prototype;l.doLoad=function(){var a=n._asyncToGenerator(function*(d){var c=this;let b=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(b=this._backgroundLayers.concat(b));const e=b.length;for(;this.symbolLayers.length<b.length;)this.symbolLayers.push(null);this.symbolLayers.length=b.length;const h=[];for(let k=0;k<e;k++){var f=b.getItemAt(k);if(!1===f.enabled)continue;r.renderPriority=
1-(1+k)/e;r.renderPriorityStep=1/e;r.ignoreDrivers=f._ignoreDrivers;const m=A.make(this.symbol,f,this._context,r);(f=u.onAbortOrThrow(d,()=>{this.symbolLayers[k]=null;m.destroy()}))&&h.push(f);this.symbolLayers[k]=m}yield x.forEach(this.symbolLayers,function(){var k=n._asyncToGenerator(function*(m,p){if(g.isSome(m))try{yield m.load(),c._extentPadding+=Math.max(c._extentPadding,m.extentPadding)}catch{c.symbolLayers[p]=null}});return function(m,p){return k.apply(this,arguments)}}());h.forEach(k=>k.remove());
u.throwIfAborted(d);if(this.symbolLayers.length&&!this.symbolLayers.some(k=>!!k))throw Error();});return function(d){return a.apply(this,arguments)}}();l.getSymbolLayerSize=function(a){a=this.symbolLayers[a];return g.isSome(a)?a.getCachedSize():null};l.createGraphics3DGraphic=function(a,d){const c=a.graphic,b=Array(this.symbolLayers.length);for(let e=0;e<this.symbolLayers.length;e++){const h=this.symbolLayers[e];b[e]=g.isSome(h)?h.createGraphics3DGraphic(a):null}return new y(c,d||this,b,a.layer,this._context.arcade||
this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};l.globalPropertyChanged=function(a,d){const c=this.symbolLayers.length;for(let b=0;b<c;b++){const e=this.symbolLayers[b],h=f=>{f=f.layers[b];return f instanceof z.Graphics3DObject3DGraphicLayer?f:null};if(g.isSome(e)&&!e.globalPropertyChanged(a,d,h))return!1}return!0};l.applyRendererDiff=function(a,d){return this.loadStatus!==q.LoadStatus.LOADED?
v.ApplyRendererDiffResult.Recreate_Symbol:this.symbolLayers.reduce((c,b)=>c!==v.ApplyRendererDiffResult.Recreate_Symbol&&g.isSome(b)?Math.min(c,b.applyRendererDiff(a,d)):c,v.ApplyRendererDiffResult.Fast_Update)};l.prepareSymbolPatch=function(a){if(this.loadStatus!==q.LoadStatus.FAILED&&"partial"===a.diff.type){var d=a.diff.diff;if(d.symbolLayers&&"partial"===d.symbolLayers.type){var c=d.symbolLayers.diff;this.symbolLayers.forEach((b,e)=>{if(!g.isNone(b)){var h=c[e];if(h){const f={diff:h,graphics3DGraphicPatches:[],
symbolLayerStatePatches:[]};b.prepareSymbolLayerPatch(f);a.symbolStatePatches.push(...f.symbolLayerStatePatches);f.graphics3DGraphicPatches.length&&a.graphics3DGraphicPatches.push((k,m)=>{const p=k.layers[e];g.isSome(p)&&f.graphics3DGraphicPatches.forEach(C=>C(p,m))})}}})}}};l.updateGeometry=function(a,d){for(let c=0;c<this.symbolLayers.length;c++){const b=this.symbolLayers[c];if(g.isNone(b))continue;const e=a.layers[c];if(g.isNone(e)||!b.updateGeometry(e,d))return!1}return!0};l.onRemoveGraphic=function(a){for(let d=
0;d<this.symbolLayers.length;d++){const c=this.symbolLayers[d];if(g.isNone(c))continue;const b=a.layers[d];if(g.isSome(b))c.onRemoveGraphic(b)}};l.getFastUpdateStatus=function(){let a=0,d=0,c=0;this.symbolLayers.forEach(b=>{g.isNone(b)||(b.loadStatus===q.LoadStatus.LOADING?a++:b.isFastUpdatesEnabled()?c++:d++)});return{loading:a,slow:d,fast:c}};l.queryForSnapping=function(){var a=n._asyncToGenerator(function*(d,c,b,e){var h=this.symbolLayers.filter(g.isSome).filter(f=>g.isSome(f.queryForSnapping)).map(f=>
f.queryForSnapping(d,c,b,e));h=yield Promise.all(h);u.throwIfAborted(e);return h.flat()});return function(d,c,b,e){return a.apply(this,arguments)}}();l.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{w.prototype.destroy.call(this);for(const a of this.symbolLayers)g.isSome(a)&&a.destroy();this.symbolLayers.length=0;this._destroyed=!0}};n._createClass(t,[{key:"symbol",get:function(){return this._symbol},set:function(a){this._symbol=
a;a.symbolLayers.forEach((d,c)=>{c=this.symbolLayers[c];g.isSome(c)&&(c.symbol=a,c.symbolLayer=d)})}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"symbologySnappingSupported",get:function(){return this.symbolLayers.some(a=>g.isSome(a)&&a.queryForSnapping)}},{key:"complexity",get:function(){return B.totalSymbolComplexities(this.symbolLayers.map(a=>g.get(a,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return t}(q.Loadable)});