// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),function(w,z,l,v,x,r,C,D,E,F,A,y){function B(p){return p.isVisible()?p.parameters.transparent?y.Transparency.TRANSPARENT:y.Transparency.OPAQUE:
y.Transparency.INVISIBLE}let H=function(){function p(a,b,c,f,g,d,k,m=null){this.graphics3DSymbolLayer=a;this.stageObject=b;this._uniqueGeometries=c;this._uniqueMaterials=f;this._sharedResource=g;this.elevationAligner=d;this.elevationContext=k;this._edgeState=m;this.type="object3d";this._stage=this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1}var e=p.prototype;e.initialize=function(a,b){this._stageLayer=
b;this._stage=a;a.addMany(this._uniqueMaterials);a.addMany(this._uniqueGeometries);a.add(this.stageObject)};e.destroy=function(){var a=this._stage;this._stageLayer&&(a.removeMany(this._uniqueMaterials),a.removeMany(this._uniqueGeometries));a.remove(this.stageObject);this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);a=this._stage.renderer.ensureEdgeView();a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this.stageObject.dispose();l.isSome(this._sharedResource)&&
this._sharedResource.release();this._visible=!1;this._stage=this._stageLayer=null};e.layerOpacityChanged=function(a,b){if(!l.isNone(this._edgeState)){var c=B(this._edgeState.baseMaterial),f=!1;for(const g of this._edgeState.edgeMaterials)g.objectTransparency!==c&&(g.objectTransparency=c,f=!0);f&&this._resetEdgeObject(b);this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[a])}};e.slicePlaneEnabledChanged=function(a,b){l.isNone(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,
this._edgeState.edgeMaterials,{hasSlicePlane:a},!b),this._edgeState.properties.hasSlicePlane=a)};e.setVisibility=function(a){if(null!=this._stage&&this._visible!==a&&(this._visible=a,this.stageObject.visible=a,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),l.isSome(this._edgeState))){const b=this._stage.renderer.ensureEdgeView();b.hasObject(this.stageObject)?b.updateObjectVisibility(this.stageObject,a):a&&this._addOrUpdateEdgeObject(b,!1)}};e.alignWithElevation=
function(a,b,c,f){null!=this.elevationAligner&&(l.isSome(c)&&E.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,l.unwrap(a.spatialReference),(g,d)=>D.evaluateElevationInfoAtPoint(g,a,this.elevationContext,b,d),b),this._resetEdgeObject(f))};e.alignWithAbsoluteElevation=function(a,b,c){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(f,g)=>{g.sampledElevation=a;g.verticalDistanceToGround=
0;g.z=a},b);this._resetEdgeObject(c)};e.getCenterObjectSpace=function(a=x.create()){return v.copy(a,C.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};e.getBoundingBoxObjectSpace=function(a=r.create()){const b=this.stageObject.boundingVolumeObjectSpace;r.setMin(a,b.min);r.setMax(a,b.max);return a};e.computeAttachmentOrigin=function(a){if(this.useObjectOriginAsAttachmentOrigin){var b=this.stageObject.transformation;a.render.origin[0]+=b[12];a.render.origin[1]+=b[13];a.render.origin[2]+=
b[14];a.render.num++}else for(b of this.stageObject.geometries)b.computeAttachmentOrigin(n)&&(v.transformMat4(n,n,this.stageObject.transformation),v.add(a.render.origin,a.render.origin,n),a.render.num++)};e.getProjectedBoundingBox=function(){var a=z._asyncToGenerator(function*(b,c,f,g,d){d=this.getBoundingBoxObjectSpace(d);var k=G,m=r.isPoint(d)?1:k.length;for(var h=0;h<m;h++){const u=k[h];q[0]=d[u[0]];q[1]=d[u[1]];q[2]=d[u[2]];v.transformMat4(q,q,this.stageObject.transformation);t[3*h]=q[0];t[3*
h+1]=q[1];t[3*h+2]=q[2]}if(!b(t,0,m))return null;r.empty(d);b=null;this.calculateRelativeScreenBounds&&(b=this.calculateRelativeScreenBounds());for(k=0;k<3*m;k+=3){for(h=0;3>h;h++)d[h]=Math.min(d[h],t[k+h]),d[h+3]=Math.max(d[h+3],t[k+h]);b&&f.push({location:t.slice(k,k+3),screenSpaceBoundingRect:b})}if(c&&c.service&&"absolute-height"!==this.elevationContext.mode){r.center(d,n);f="relative-to-scene"===this.elevationContext.mode?"scene":"ground";m=0;if(c.useViewElevation)m=l.unwrapOr(c.service.getElevation(n[0],
n[1],f),0);else try{const u=F.demResolutionForBoundingBox(d,c.service.spatialReference,c);m=l.unwrapOr(yield c.service.queryElevation(n[0],n[1],g,u,f),0)}catch(u){}r.offset(d,0,0,-this.alignedSampledElevation+m)}return d});return function(b,c,f,g,d){return a.apply(this,arguments)}}();e.addObjectState=function(a,b){a===A.Object3DState.Highlight&&b.addObject(this.stageObject,this.stageObject.highlight());a===A.Object3DState.MaskOccludee&&b.addObject(this.stageObject,this.stageObject.maskOccludee())};
e.removeObjectState=function(a){a.removeObject(this.stageObject)};e._resetEdgeObject=function(a){if(!l.isNone(this._edgeState)){var b=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(b,a):b.removeObject(this.stageObject)}};e._addOrUpdateEdgeObject=function(a,b){const c=this._edgeState;if(!l.isNone(c)){var f=B(c.baseMaterial);for(const g of c.edgeMaterials)g.objectTransparency=f;a.addOrUpdateObject3D(this.stageObject,c.edgeMaterials,c.properties,!b).then(()=>this._stageLayer?.sync())}};
z._createClass(p,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",get:function(){return this._visible}}]);return p}();const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=x.create(),n=x.create(),G=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];w.Graphics3DObject3DGraphicLayer=H;w.Object3DEdgeState=function(p,e,a){this.baseMaterial=p;this.edgeMaterials=e;this.properties=a};Object.defineProperty(w,
Symbol.toStringTag,{value:"Module"})});