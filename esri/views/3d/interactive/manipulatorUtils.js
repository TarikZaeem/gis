// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../../core/maybe ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/vectorStacks ../../../layers/graphics/hydratedFeatures ./Manipulator3D ./RenderObject ../layers/graphics/graphicUtils ../webgl-engine/lib/Attribute ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Geometry ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/Material ../webgl-engine/lib/VertexAttribute ../webgl-engine/materials/ColorMaterial ../webgl-engine/materials/ImageMaterial ../webgl-engine/materials/NativeLineMaterial ../webgl-engine/materials/RibbonLineMaterial ../webgl-engine/materials/ShadedColorMaterial ../../interactive/interfaces".split(" "),
function(e,r,L,l,y,t,h,M,B,n,N,C,z,O,A,u,v,D,P,Q,R,S,m){function E(a,b=u.RenderOccludedFlag.OccludeAndTransparent,c=!0){const d=t.fromValues(a[0],a[1],a[2],3<a.length?a[3]:1);a=1>a[3];return c?new S.ShadedColorMaterial({color:d,transparent:a,writeDepth:!0,cullFace:z.CullFaceOptions.Back,renderOccluded:b}):new D.ColorMaterial({color:d,transparent:a,writeDepth:!0,cullFace:z.CullFaceOptions.Back,renderOccluded:b})}function F(a,b){const c=b.material??new P.ImageMaterial({transparent:!0,writeDepth:!1,
textureId:b.texture?.id,renderOccluded:u.RenderOccludedFlag.Opaque}),d=b.focusMultiplier??p.focusMultiplier,f=b.calloutLength??p.calloutLength,w=p.discRadius*(b.discScale??1),G=w*d,I=(g,T)=>{const H=[0,1,2,2,3,0];return new O.Geometry(T,[[v.VertexAttribute.POSITION,new C.Attribute([f-g,-g,0,f+g,-g,0,f+g,g,0,f-g,g,0],3,!0)],[v.VertexAttribute.UV0,new C.Attribute([0,0,1,0,1,1,0,1],2,!0)]],[[v.VertexAttribute.POSITION,H],[v.VertexAttribute.UV0,H]])};var q=p.calloutColor,k=b.calloutWidth??p.calloutWidth;
k=new (1<k?R.RibbonLineMaterial:Q.NativeLineMaterial)({width:k,color:t.fromValues(q[0],q[1],q[2],b.calloutOpacity??1),renderOccluded:u.RenderOccludedFlag.OccludeAndTransparent});q=A.createPolylineGeometry(k,[[0,0,0],[f-w,0,0]]);k=A.createPolylineGeometry(k,[[0,0,0],[f-G,0,0]]);const x=b.customStateMask??m.ManipulatorStateCustomFlags.None;a.collisionType={type:"disc",direction:[0,0,1],offset:[f,0,0]};a.focusMultiplier=d;a.metadata=b.metadata;a.radius=w;a.renderObjects=[new n.RenderObject(I(w,c),m.ManipulatorStateFlags.Unfocused|
x),new n.RenderObject(q,m.ManipulatorStateFlags.Unfocused|x),new n.RenderObject(I(G,c),m.ManipulatorStateFlags.Focused|x),new n.RenderObject(k,m.ManipulatorStateFlags.Focused|x)]}function J(a,b,c,d){a=l.normalize(h.sv3d.get(),a);b=l.normalize(h.sv3d.get(),b);const f=l.cross(h.sv3d.get(),a,b);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=0;d[4]=b[0];d[5]=b[1];d[6]=b[2];d[7]=0;d[8]=f[0];d[9]=f[1];d[10]=f[2];d[11]=0;d[12]=c[0];d[13]=c[1];d[14]=c[2];d[15]=1;return d}function K(a,b){const c=a.getViewForGraphic(b);
return r.isSome(c)&&"computeAttachmentOrigin"in c?c.computeAttachmentOrigin(b,a.spatialReference):null}const p=Object.freeze({calloutLength:40,calloutWidth:1,discRadius:27,focusMultiplier:1.1,calloutColor:y.fromValues(1,.5,0)});y=Object.freeze({autoScaleRenderObjects:!1,worldSized:!0});e.calculateInputRotationTransform=function(a,b,c,d){a=l.subtract(h.sv3d.get(),a,c);d=l.cross(h.sv3d.get(),d,a);c=J(a,d,c,h.sm4d.get());L.invert(c,c);b=l.transformMat4(h.sv3d.get(),b,c);return Math.atan2(b[1],b[0])};
e.calculateTranslateRotateFromBases=J;e.createManipulatorMaterial=E;e.createManipulatorOutlineMaterial=function(a,b=u.RenderOccludedFlag.OccludeAndTransparent){a=t.fromValues(a[0],a[1],a[2],4===a.length?a[3]:1);return new D.ColorMaterial({color:a,transparent:!0,writeDepth:!0,cullFace:z.CullFaceOptions.Front,renderOccluded:b})};e.createRotateManipulator=function(a,b){a=new B.Manipulator3D({view:a,autoScaleRenderObjects:!1,collisionPriority:1,metadata:b.metadata});F(a,b);return a};e.createSphereManipulator=
function(a,b,c=1,d=m.ManipulatorStateCustomFlags.None){b=E(t.fromValues(b[0],b[1],b[2],null!=c?c:1));d=[new n.RenderObject(A.createSphereGeometry(b,1,32,32),d)];return new B.Manipulator3D({view:a,renderObjects:d})};e.getGraphicAttachmentOrigin=K;e.placeAtGraphic=function(a,b,c){a=K(a,c);r.isSome(a)?b.elevationAlignedLocation=a:(c=c.geometry,r.isNone(c)||(c="mesh"===c.type?c.anchor:N.computeCentroid(c),r.isNone(c)||(b.location=M.hydrateGeometry(c))))};e.updateRotateManipulator=F;e.worldScaledManipulatorSettings=
y;Object.defineProperty(e,Symbol.toStringTag,{value:"Module"})});