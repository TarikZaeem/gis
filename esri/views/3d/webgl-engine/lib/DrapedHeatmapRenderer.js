// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(b,r,c,h,w,d,F,G,x,y,z,A,n,e,B,C,D){b.DrapedHeatmapRenderer=function(t){function l(a){a=t.call(this,a)||this;a.pixelRatio=1;a._colorRampData=new Uint8ClampedArray(4);a.type="draped-heatmap";a._heatmapParameters=new n.HeatmapPassParameters;return a}r._inheritsLoose(l,t);var p=l.prototype;p.initialize=function(){this._densityMap=new B.FramebufferObject(this.rctx,{colorTarget:e.TargetType.TEXTURE,depthStencilTarget:e.DepthStencilTargetType.NONE,width:0,height:0},{target:e.TextureType.TEXTURE_2D,
pixelFormat:this.pixelFormat,internalFormat:this.internalFormat,dataType:this.dataType,samplingMode:this.samplingMode,wrapMode:e.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});this._quad=z.createQuadVAO(this.rctx);var a=this._colorRampData;this._colorRamp=new C.Texture(this.rctx,{target:e.TextureType.TEXTURE_2D,pixelFormat:e.PixelFormat.RGBA,dataType:e.PixelType.UNSIGNED_BYTE,samplingMode:e.TextureSamplingMode.LINEAR,wrapMode:e.TextureWrapMode.CLAMP_TO_EDGE,width:a.length/4,height:1},a);a=new n.HeatmapTechniqueConfiguration;
a.usesHalfFloat=this.dataType!==e.PixelType.FLOAT;this._technique=new n.HeatmapTechnique({rctx:this.rctx,viewingMode:y.ViewingMode.Local},a);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(w.watch(()=>[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))};p.destroy=function(){this._technique=h.releaseMaybe(this._technique);this._densityMap=h.disposeMaybe(this._densityMap);
this._quad=h.disposeMaybe(this._quad);this._colorRamp=h.disposeMaybe(this._colorRamp)};p.render=function(a){const f=this._sortedMaterialRenderers;if(!(1>f.length)){var m=this.rctx.getBoundFramebufferObject(),g=this.rctx.getViewport(),E=a.bindParameters,{pixelRatio:k}=this,u=Math.ceil(g.width*k);k=Math.ceil(g.height*k);this._densityMap.resize(u,k);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,u,k);this.rctx.clear(e.ClearBufferBit.COLOR_BUFFER_BIT);var q=!1;f.forAll(v=>{v.material.shouldRender(a)&&
(q=v.render(a.output,E)||q)});this.rctx.bindFramebuffer(m);this.rctx.setViewport(g.x,g.y,g.width,g.height);q&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,this._heatmapParameters,a.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,D.vertexCount(this._quad,"geometry")))}};r._createClass(l,[{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(a){a!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=
a,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(a){a!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=a,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(a){a!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=a,this.notifyChange("maxDensity"))}},{key:"fieldTotal",get:function(){return this._heatmapParameters.fieldTotal},
set:function(a){this._heatmapParameters.fieldTotal=a;this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(a){const {colorRamp:f}=this._heatmapParameters;if(h.isSome(f)&&a!==this._colorRampData){const m=a.length/4;m!==f.descriptor.width&&f.resize(m,1);f.setData(a)}this._colorRampData=a}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(a){this._heatmapParameters.colorRamp=a}},{key:"hasHighlights",get:function(){return!1}},
{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}}]);return l}(A.SortedRenderGeometryRenderer);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"searchRadius",null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"minDensity",null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"maxDensity",null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"fieldTotal",null);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,
"pixelRatio",void 0);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"colorRampData",null);c.__decorate([d.property({constructOnly:!0})],b.DrapedHeatmapRenderer.prototype,"dataType",void 0);c.__decorate([d.property({constructOnly:!0})],b.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);c.__decorate([d.property({constructOnly:!0})],b.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);c.__decorate([d.property({constructOnly:!0})],b.DrapedHeatmapRenderer.prototype,"internalFormat",
void 0);c.__decorate([d.property()],b.DrapedHeatmapRenderer.prototype,"_colorRampData",void 0);b.DrapedHeatmapRenderer=c.__decorate([x.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],b.DrapedHeatmapRenderer);Object.defineProperty(b,Symbol.toStringTag,{value:"Module"})});