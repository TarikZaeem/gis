// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(t,y,L,l,f,n,D,M,e,u,z,N,v,A,O,w,p,P,Q,E,F,R,S){A=function(k){function g(a){a=k.call(this,a,T)||this;a.supportsEdges=!0;a._configuration=new R.DefaultMaterialTechniqueConfiguration;var b=a.parameters;const c=M.newLayout().vec3f(p.VertexAttribute.POSITION).vec3f(p.VertexAttribute.NORMAL),m=b.textureId||b.normalTextureId||b.metallicRoughnessTextureId||b.emissiveTextureId||b.occlusionTextureId;b.hasVertexTangents&&c.vec4f(p.VertexAttribute.TANGENT);m&&c.vec2f(p.VertexAttribute.UV0);b.hasVertexColors&&
c.vec4u8(p.VertexAttribute.COLOR);b.hasSymbolColors&&c.vec4u8(p.VertexAttribute.SYMBOLCOLOR);L("enable-feature:objectAndLayerId-rendering")&&c.vec4u8(p.VertexAttribute.OBJECTANDLAYERIDCOLOR);a._vertexBufferLayout=c;return a}y._inheritsLoose(g,k);var d=g.prototype;d.isVisibleForOutput=function(a){return a===e.ShaderOutput.Shadow||a===e.ShaderOutput.ShadowExcludeHighlight||a===e.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0};d.isVisible=function(){var a=this.parameters;if(!k.prototype.isVisible.call(this)||
0===a.layerOpacity)return!1;const {instanced:b,hasVertexColors:c,hasSymbolColors:m,vvColorEnabled:r}=a,x=l.isSome(b)&&b.includes("color"),h="replace"===a.colorMixMode,q=0<a.opacity;a=a.externalColor&&0<a.externalColor[3];return c&&(x||r||m)?h?!0:q:c?h?a:q:x||r||m?h?!0:q:h?a:q};d.getConfiguration=function(a,b){this._configuration.output=a;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=!!this.parameters.textureId;this._configuration.hasVertexTangents=
this.parameters.hasVertexTangents;this._configuration.instanced=!!this.parameters.instanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.hasVerticalOffset=l.isSome(this.parameters.verticalOffset);this._configuration.hasScreenSizePerspective=l.isSome(this.parameters.screenSizePerspective);this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasSliceHighlight=
this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode;this._configuration.normalType=this.parameters.normalType;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;l.isSome(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=this.parameters.hasSlicePlane?
N.CullFaceOptions.None:this.parameters.cullFace;this._configuration.hasMultipassTerrain=b.multipassTerrain.enabled;this._configuration.cullAboveGround=b.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=l.isSome(this.parameters.modelTransformation);if(a===e.ShaderOutput.Color||a===e.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=
this.parameters.treeRendering?u.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?u.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?u.NormalsDoubleSidedMode.WindingOrder:u.NormalsDoubleSidedMode.None,this._configuration.instancedColor=l.isSome(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,
this._configuration.receiveAmbientOcclusion=b.ssaoHelper.active?this.parameters.receiveSSAO:!1,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?z.PBRMode.Schematic:z.PBRMode.Normal:z.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=
!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=b.transparencyPassType,this._configuration.enableOffset=b.camera.relativeElevation<O.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(b),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,
this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration};d.hasSnowCover=function(a){return l.isSome(a.weather)&&a.weatherVisible&&
"snowy"===a.weather.type&&"enabled"===a.weather.snowCover};d.intersect=function(a,b,c,m,r,x){if(l.isSome(this.parameters.verticalOffset)){const q=c.camera;f.set(B,b[12],b[13],b[14]);b=null;switch(c.viewingMode){case D.ViewingMode.Global:b=f.normalize(G,B);break;case D.ViewingMode.Local:b=f.copy(G,U)}let H=0;var h=f.subtract(V,B,q.eye);const I=f.length(h);h=f.scale(h,h,1/I);let J=null;this.parameters.screenSizePerspective&&(J=f.dot(b,h));H+=E.verticalOffsetAtDistance(q,I,this.parameters.verticalOffset,
J??0,this.parameters.screenSizePerspective);f.scale(b,b,H);f.transformMat3(C,b,c.transform.inverseRotation);m=f.subtract(W,m,C);r=f.subtract(X,r,C)}E.intersectTriangleGeometry(a,c,m,r,P.getVerticalOffsetObject3D(c.verticalOffset),x)};d.requiresSlot=function(a,b){return b===e.ShaderOutput.Color||b===e.ShaderOutput.Alpha||b===e.ShaderOutput.Depth||b===e.ShaderOutput.Normal||b===e.ShaderOutput.Shadow||b===e.ShaderOutput.ShadowHighlight||b===e.ShaderOutput.ShadowExcludeHighlight||b===e.ShaderOutput.Highlight||
b===e.ShaderOutput.ObjectAndLayerIdColor?a===(this.parameters.transparent?this.parameters.writeDepth?w.RenderSlot.TRANSPARENT_MATERIAL:w.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:w.RenderSlot.OPAQUE_MATERIAL)||a===w.RenderSlot.DRAPED_MATERIAL:!1};d.createGLMaterial=function(a){return new K(a)};d.createBufferWriter=function(){return new Q.DefaultBufferWriter(this._vertexBufferLayout)};return g}(A.Material);let K=function(k){function g(a){return k.call(this,{...a,...a.material.parameters})||
this}y._inheritsLoose(g,k);var d=g.prototype;d._updateShadowState=function(a){a.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:a.shadowMap.enabled})};d._updateOccludeeState=function(a){a.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:a.hasOccludees})};d.beginSlot=function(a){if(this._output===e.ShaderOutput.Color||this._output===e.ShaderOutput.Alpha)this._updateShadowState(a),
this._updateOccludeeState(a);const b=this._material.parameters;this.updateTexture(b.textureId);const c=a.camera.viewInverseTransposeMatrix;f.set(b.origin,c[3],c[7],c[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(b.treeRendering?S.RealisticTreeTechnique:F.DefaultMaterialTechnique,a)};return g}(v.GLTextureMaterial);v=function(k){function g(){var d=k.apply(this,arguments)||this;d.initTextureTransparent=!1;d.treeRendering=!1;d.hasVertexTangents=!1;return d}
y._inheritsLoose(g,k);return g}(F.DefaultMaterialPassParameters);const T=new v,W=n.create(),X=n.create(),U=n.fromValues(0,0,1),G=n.create(),C=n.create(),B=n.create(),V=n.create();t.DefaultGLMaterial=K;t.DefaultMaterial=A;t.DefaultMaterialParameters=v;Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})});