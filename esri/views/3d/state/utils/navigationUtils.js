// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(f,x,p,aa,wa,r,E,xa,ya,d,n,F,A,B,R,za,G,H,ba,Aa,S){function T(a,c,b){b=r.fromRotation(G.sm4d.get(),b[3],F.axis(b));aa.isNone(b)||r.exactEquals(b,E.IDENTITY)||(d.subtract(l,a.eye,c),d.transformMat4(l,l,b),a.eye=d.add(l,l,c),d.subtract(l,a.center,c),d.transformMat4(l,l,b),a.center=d.add(l,l,c),a.up=d.transformMat4(l,a.up,b))}function ca(a,c,b,e){return Math.sin(a/d.length(c))*(b+e.radius)}function da(a,c,b,e){b=H.fromScreenAtEye(c,b,U);if(aa.isNone(b))return!1;R.closestPointOnSilhouette(a,b,
I);return R.intersectRay(a,b,e)?d.squaredDistance(I,b.origin)<d.squaredDistance(e,b.origin)?(d.copy(e,I),!1):!0:(d.subtract(y,c.eye,c.center),d.normalize(y,y),B.fromNormalAndOffset(y,-d.dot(d.normalize(y,y),I),ea),B.intersectRay(ea,b,e),!1)}function fa(a,c,b,e,h,k){var g=0;d.cross(J,a,c);d.subtract(K,a,c);d.length(a)<=h||!e.aboveGround?(d.cross(b,K,e.eye),g=d.dot(a,c)/(d.length(a)*d.length(c)),.9999>g?g=p.acosClamped(g):(a=d.length(d.cross(n.create(),a,c))/(d.length(a)*d.length(c)),g=p.asinClamped(a)),
k=Math.cos(p.clamp(x.cyclicalPI.normalize(p.deg2rad(k)),0,V)),g=-g-Math.max(0,d.length(c)-h)/(k*h)):(d.subtract(ha,e.eye,e.center),d.cross(b,K,ha),g=-d.length(K)/h);d.normalize(b,b);d.scale(b,b,d.length(J));return g}function W(a,c,b,e){e=Math.cos(p.clamp(x.cyclicalPI.normalize(p.deg2rad(e)),0,V));c=c>b?-(c-b)/(e*b):c<-b?Math.PI-(c+b)/(e*b):p.acosClamped(c/b);return((a>b?-(a-b)/(e*b):a<-b?Math.PI-(a+b)/(e*b):p.acosClamped(a/b))-c)*b}function ia(a,c,b,e,h,k,g,m,q,t){m=W(a[2],c[2],k[3],m);c=q?W(a[0],
c[0],k[3],180):c[0]-a[0];a=Math.sin(g)*c-Math.cos(g)*m;g=Math.cos(g)*c+Math.sin(g)*m;d.normalize(l,h);h=q?a/Math.sqrt(Math.abs(k[3]**2-d.dot(b,l)**2)):a/k[3];b=g/Math.sqrt(Math.abs(k[3]**2-d.dot(b,e)**2));xa.set(t,h,b)}function ja(a,c,b,e,h,k,g,m,q,t){d.cross(J,a,c);A.coordinateSystemFromOneAxisAndNormalVector(k.up,k.eye,L,M,N);A.coordinateSystemFromOneAxisAndNormalVector([0,0,1],k.eye,u,v,ka);d.copy(b,v);d.copy(e,u);d.normalize(b,b);d.scale(b,b,d.length(J));A.vectorCoordinates(a,d.normalize(M,M),
d.normalize(N,N),d.normalize(L,L),la);A.vectorCoordinates(c,M,N,L,ma);ia(la,ma,a,u,v,g,m,q,t,h)}function na(a,c,b,e,h,k,g){r.fromRotation(O,h,e);r.fromRotation(P,g,k);r.multiply(z,O,P);d.subtract(c,a,b);d.transformMat4(c,c,z);d.add(c,c,b)}function oa(a,c,b,e,h,k){r.fromRotation(O,e,b);r.fromRotation(P,k,h);r.multiply(z,O,P);d.subtract(l,a.eye,c);d.transformMat4(l,l,z);a.eye=d.add(l,l,c);d.subtract(l,a.center,c);d.transformMat4(l,l,z);a.center=d.add(l,l,c);d.subtract(l,a.up,c);d.transformMat4(l,l,
z);a.up=d.add(l,l,c)}function X(a,c,b,e,h,k){return(Math.abs(e)>Math.PI-C.Angle||Math.abs(e)<C.Angle)&&(Math.abs(a[2])<b*C.Pole||Math.abs(c)>b)&&k.aboveGround&&h<C.Tilt}function pa(a,c,b,e,h,k){k?(F.fromPoints(b,e,qa),T(c,a,qa)):(b=fa(b,e,ra,c,a[3],h),T(c,a,F.wrapAxisAngle(ra,b)))}function sa(a,c,b,e,h,k,g){const m=g?20:1;d.copy(w,e);Q.copyFrom(c);let q;for(let t=0;t<m&&1E-12<d.squaredDistance(b,w);t++)if(e=d.squaredDistance(b,w),ja(b,w,v,u,D,Q,a,h,k,g),oa(Q,a,u,D[1],v,D[0]),na(w,w,a,u,D[1],v,D[0]),
q=d.squaredDistance(b,w),q<e||0===t)c.copyFrom(Q);else break}f.SpherePickPointFallback=void 0;(function(a){a[a.Ellipsoid=0]="Ellipsoid";a[a.Silhouette=1]="Silhouette"})(f.SpherePickPointFallback||(f.SpherePickPointFallback={}));S={exclude:new Set([S.TERRAIN_ID])};const ta=wa.createScreenPointArray();f.NavigationMode=void 0;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(f.NavigationMode||(f.NavigationMode={}));const Y={Elevation:3E4,Angle:p.deg2rad(16)},C={Pole:.95,Angle:p.deg2rad(18),
Tilt:45},V=p.deg2rad(80),Z=n.create(),I=n.create(),y=n.create(),ea=B.create(),ha=n.create(),u=n.create(),v=n.create(),ka=n.create(),L=n.create(),M=n.create(),N=n.create(),la=n.create(),ma=n.create(),D=ya.create(),qa=F.create(),O=E.create(),P=E.create(),z=E.create(),w=n.create(),l=n.create(),K=n.create(),Q=new Aa.Camera,J=n.create(),ra=n.create(),U={origin:n.create(),direction:n.create()},ua={origin:n.create(),direction:n.create()};f.DISTANCE_CLAMP_VALUES=[1,3E8];f.MIN_HEIGHT_LIMIT=50;f.PAN_DISTANCE_MODIFIER=
5;f.PIVOT_DISTANCE_MODIFIER=30;f.PreservingHeadingThreshold=C;f.ROTATE_PIVOT_DISTANCE_MODIFIER=5;f.ROTATE_PIVOT_MIN_DISTANCE_MODIFIER=10;f.ROTATE_SCREEN_PIXEL_AREA=90;f.SCREEN_PIXEL_AREA=80;f.TiltThresholdPanningSpeed=V;f.VerticalPanTresholds=Y;f.ZOOM_DISTANCE_MODIFIER=8;f.ZOOM_MAX_DISTANCE_MODIFIER=1508E5;f.ZOOM_MIN_DISTANCE_MODIFIER=200;f.applyPanPlanar=function(a,c,b){d.subtract(Z,b,c);a.eye=d.subtract(l,a.eye,Z);a.center=d.subtract(l,a.center,Z)};f.applyPanSphericalDirectRotation=pa;f.applyPanSphericalPreserveHeading=
sa;f.applyRotation=T;f.applyRotationWithTwoAxes=oa;f.applyZoomOnSphere=function(a,c,b){c.getScreenCenter(ta);ba.intersectScreen(a,c,ta,l)&&(c.center=l);a=c.distance;b*=a;1E-6>Math.abs(a-b)||(b=d.scale(G.sv3d.get(),c.viewForward,b),c.eye=d.subtract(l,c.center,b))};f.applyZoomToPoint=function(a,c,b,e){const h=G.sv3d.get();b=1-b;d.subtract(h,c,a.eye);const k=d.length(h);let g=k*(1-b);0<=b&&g<e&&(g=e,b=-(g-k)/k);1E-6>Math.abs(k-g)||(d.scale(h,h,b),a.eye=d.add(l,a.eye,h),a.center=d.lerp(l,a.center,c,b))};
f.centroid=function(a,c){d.set(c,0,0,0);for(const b of a)d.add(c,c,b);d.scale(c,c,1/a.length)};f.contentIntersectorOptions=S;f.decideNavigationMode=function(a,c,b){if(d.length(a.eye)-b.radius>Y.Elevation)return f.NavigationMode.Horizontal;H.fromScreenAtEye(a,c,ua);return-Math.sign(a.relativeElevation)*(.5*Math.PI+za.angle(a.eye,ua.direction))<Y.Angle?f.NavigationMode.Vertical:f.NavigationMode.Horizontal};f.intersectPlaneFromScreenPoint=function(a,c,b,e){return B.intersectRay(a,H.fromScreen(c,b,U),
e)};f.intersectPlaneFromScreenPointAtEye=function(a,c,b,e){return B.intersectRay(a,H.fromScreenAtEye(c,b,U),e)};f.lengthFromPoints=W;f.normalizeCoordinate=function(a,c,b){b[0]=c[0]/(a.fullWidth/a.pixelRatio);b[1]=c[1]/(a.fullHeight/a.pixelRatio);return b};f.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};f.offSurfaceTiltToEyeTiltGlobal=function(a,c,b,e){return ca(Math.PI/2,c,b,e)+(a-Math.PI/2)};f.onSurfaceTiltToEyeTiltGlobal=ca;f.panMotionToRotationMatrix=
function(a,c,b,e,h,k,g,m,q){if(X(a.center,d.dot(a.up,a.center),d.length(a.center),-x.cyclicalPI.normalize(p.deg2rad(k)),g,c))switch(a=-x.cyclicalPI.normalize(p.deg2rad(h)),{eye:h}=c,A.coordinateSystemFromOneAxisAndNormalVector([0,0,1],h,u,v,ka),h=b.translation[0]*e.pan,k="zoom"===q.mode?0:b.translation[1]*e.pan,c=Math.max(Math.sqrt(Math.abs(1-d.dot(c.center,u)**2/d.length(c.center)**2)),.5),g=-Math.cos(a)*k+Math.sin(a)*h,r.rotate(m.pan.matrix,m.pan.matrix,(Math.sin(a)*k+Math.cos(a)*h)/c,u),m.pan.enabled=
!0,q.mode){case "pan":r.rotate(m.pan.matrix,m.pan.matrix,g,v);m.pan.enabled=!0;break;case "zoom":m.zoom=-b.translation[1]*e.zoom}else{const {eye:t,viewRight:va}=c;c=d.cross(G.sv3d.get(),va,t);a=b.translation[0]*e.pan;0!==a&&(r.rotate(m.pan.matrix,m.pan.matrix,-a,c),m.pan.enabled=!0);switch(q.mode){case "pan":b=b.translation[1]*e.pan;0!==b&&(r.rotate(m.pan.matrix,m.pan.matrix,b,va),m.pan.enabled=!0);break;case "zoom":m.zoom=-b.translation[1]*e.zoom}}};f.panToPosition=function(a,c,b,e,h,k,g){X(b,d.dot(c.up,
b),a[3],-x.cyclicalPI.normalize(p.deg2rad(h)),k,c)?sa(a,c,b,e,-x.cyclicalPI.normalize(p.deg2rad(h)),k,g):pa(a,c,b,e,k,g)};f.pickPointAndInitSphere=function(a,c,b,e,h,k){const g=n.create(),m=R.create();let q=!0,t=!0;a.intersectScreen(b,g,k)?m[3]=d.length(g):(t=!1,m[3]=c.aboveGround&&h!==f.SpherePickPointFallback.Ellipsoid?Math.max(d.length(c.center),.9*e.radius):d.length(c.eye)-c.relativeElevation,h===f.SpherePickPointFallback.Silhouette?da(m,c,b,g):q=ba.intersectScreen(m,c,b,g));return{sphere:m,scenePickPoint:q?
g:null,hasGeometryIntersection:t}};f.preserveHeadingThreshold=X;f.rotatePointAroundTwoAxes=na;f.rotationAngleAndAxisDirectRotation=fa;f.rotationAnglesAndAxesHeadingPreserving=ja;f.rotationAnglesHeadingPreserving=ia;f.sphereOrPlanePointFromScreenPoint=da;Object.defineProperty(f,Symbol.toStringTag,{value:"Module"})});