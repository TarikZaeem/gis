// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
require({cache:{"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){function k(Z=U){return{plane:h.create(Z.plane),origin:f.clone(Z.origin),basis1:f.clone(Z.basis1),basis2:f.clone(Z.basis2)}}
function p(Z,ha,fa){const ka=ea.get();ka.origin=Z;ka.basis1=ha;ka.basis2=fa;ka.plane=h.wrap(0,0,0,0);A(ka);return ka}function z(Z,ha=k()){return B(Z.origin,Z.basis1,Z.basis2,ha)}function C(Z,ha){d.copy(ha.origin,Z.origin);d.copy(ha.basis1,Z.basis1);d.copy(ha.basis2,Z.basis2);h.copy(ha.plane,Z.plane)}function B(Z,ha,fa,ka=k()){d.copy(ka.origin,Z);d.copy(ka.basis1,ha);d.copy(ka.basis2,fa);A(ka);1E-6<Math.abs(d.dot(ka.basis1,ka.basis2)/(d.length(ka.basis1)*d.length(ka.basis2)))&&T.warn("fromValues()",
"Provided basis vectors are not perpendicular");1E-6<Math.abs(d.dot(ka.basis1,Q(ka)))&&T.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-d.dot(Q(ka),ka.origin)-ka.plane[3])&&T.warn("fromValues()","Plane offset is not consistent with plane origin");return ka}function A(Z){h.fromVectorsAndPoint(Z.basis2,Z.basis1,Z.origin,Z.plane)}function x(Z,ha,fa){Z!==fa&&z(Z,fa);Z=d.scale(q.sv3d.get(),Q(Z),ha);d.add(fa.origin,fa.origin,Z);fa.plane[3]-=ha;return fa}function u(Z,
ha,fa){y(ha,fa);x(fa,H(Z,Z.origin),fa);return fa}function y(Z,ha=k()){const fa=(Z[2]-Z[0])/2,ka=(Z[3]-Z[1])/2;d.set(ha.origin,Z[0]+fa,Z[1]+ka,0);d.set(ha.basis1,fa,0,0);d.set(ha.basis2,0,ka,0);h.fromValues(0,0,1,0,ha.plane);return ha}function w(Z,ha,fa){return h.intersectRay(Z.plane,ha,fa)?V(Z,fa):!1}function D(Z,ha,fa){if(w(Z,ha,fa))return fa;Z=F(Z,ha,q.sv3d.get());d.add(fa,ha.origin,d.scale(q.sv3d.get(),ha.direction,d.distance(ha.origin,Z)/d.length(ha.direction)));return fa}function F(Z,ha,fa){const ka=
Y.get();var la=Y.get();W(Z,ha,ka,la);la=Number.POSITIVE_INFINITY;for(const pa of ca){var na=X(Z,pa,ba.get());const va=q.sv3d.get();h.intersectLineSegment(ka,na,va)&&(na=d.direction(q.sv3d.get(),ha.origin,va),na=Math.abs(t.acosClamped(d.dot(ha.direction,na))),na<la&&(la=na,d.copy(fa,va)))}return la===Number.POSITIVE_INFINITY?E(Z,ha,fa):fa}function E(Z,ha,fa){if(w(Z,ha,fa))return fa;const ka=Y.get(),la=Y.get();W(Z,ha,ka,la);let na=Number.POSITIVE_INFINITY;for(const va of ca){var pa=X(Z,va,ba.get());
const wa=q.sv3d.get();h.intersectLineSegmentClamp(ka,pa,wa)&&(pa=l.distance2(ha,wa),h.isPointInside(la,wa)&&pa<na&&(na=pa,d.copy(fa,wa)))}M(Z,ha.origin)<na&&K(Z,ha.origin,fa);return fa}function K(Z,ha,fa){var ka=h.projectPoint(Z.plane,ha,q.sv3d.get());ha=g.projectPointClamp(aa(Z,Z.basis1),ka,-1,1,q.sv3d.get());ka=g.projectPointClamp(aa(Z,Z.basis2),ka,-1,1,q.sv3d.get());d.subtract(fa,d.add(q.sv3d.get(),ha,ka),Z.origin);return fa}function J(Z,ha,fa){const {origin:ka,basis1:la,basis2:na}=Z,pa=d.subtract(q.sv3d.get(),
ha,ka);ha=v.projectPointSignedLength(la,pa);const va=v.projectPointSignedLength(na,pa);Z=v.projectPointSignedLength(Q(Z),pa);return d.set(fa,ha,va,Z)}function M(Z,ha){ha=J(Z,ha,q.sv3d.get());const {basis1:fa,basis2:ka}=Z;Z=d.length(fa);var la=d.length(ka);Z=Math.max(Math.abs(ha[0])-Z,0);la=Math.max(Math.abs(ha[1])-la,0);ha=ha[2];return Z*Z+la*la+ha*ha}function N(Z,ha){return Math.sqrt(M(Z,ha))}function P(Z,ha){let fa=Number.NEGATIVE_INFINITY;for(const la of ca){var ka=X(Z,la,ba.get());ka=g.distance2(ka,
ha);ka>fa&&(fa=ka)}return Math.sqrt(fa)}function I(Z,ha){return h.isPointInside(Z.plane,ha)&&V(Z,ha)}function G(Z,ha,fa,ka){switch(fa){case e.Axis.X:d.copy(ka,Z.basis1);d.normalize(ka,ka);break;case e.Axis.Y:d.copy(ka,Z.basis2);d.normalize(ka,ka);break;case e.Axis.Z:d.copy(ka,Q(Z))}return ka}function H(Z,ha){const fa=-Z.plane[3];return v.projectPointSignedLength(Q(Z),ha)-fa}function L(Z,ha,fa,ka){const la=H(Z,ha);Z=d.scale(da,Q(Z),fa-la);d.add(ka,ha,Z);return ka}function O(Z,ha){return d.exactEquals(Z.basis1,
ha.basis1)&&d.exactEquals(Z.basis2,ha.basis2)&&d.exactEquals(Z.origin,ha.origin)}function S(Z,ha,fa){Z!==fa&&z(Z,fa);r.invert(ja,ha);r.transpose(ja,ja);d.transformMat4(fa.basis1,Z.basis1,ja);d.transformMat4(fa.basis2,Z.basis2,ja);d.transformMat4(h.normal(fa.plane),h.normal(Z.plane),ja);d.transformMat4(fa.origin,Z.origin,ha);h.setOffsetFromPoint(fa.plane,fa.plane,fa.origin);return fa}function R(Z,ha,fa,ka){Z!==ka&&z(Z,ka);r.fromRotation(ia,ha,fa);d.transformMat4(ka.basis1,Z.basis1,ia);d.transformMat4(ka.basis2,
Z.basis2,ia);A(ka);return ka}function Q(Z){return h.normal(Z.plane)}function V(Z,ha){const fa=d.subtract(q.sv3d.get(),ha,Z.origin);ha=d.squaredLength(Z.basis1);const ka=d.squaredLength(Z.basis2),la=d.dot(Z.basis1,fa);Z=d.dot(Z.basis2,fa);return 0>-la-ha&&0>la-ha&&0>-Z-ka&&0>Z-ka}function aa(Z,ha){const fa=ba.get();d.copy(fa.origin,Z.origin);d.copy(fa.vector,ha);return fa}function X(Z,ha,fa){const {basis1:ka,basis2:la,origin:na}=Z;Z=d.scale(q.sv3d.get(),ka,ha.origin[0]);const pa=d.scale(q.sv3d.get(),
la,ha.origin[1]);d.add(fa.origin,Z,pa);d.add(fa.origin,fa.origin,na);Z=d.scale(q.sv3d.get(),ka,ha.direction[0]);ha=d.scale(q.sv3d.get(),la,ha.direction[1]);d.scale(fa.vector,d.add(Z,Z,ha),2);return fa}function W(Z,ha,fa,ka){Z=Q(Z);h.fromVectorsAndPoint(Z,ha.direction,ha.origin,fa);h.fromVectorsAndPoint(h.normal(fa),Z,ha.origin,ka)}const T=b.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");c=function(){this.plane=h.create();this.origin=f.create();this.basis1=f.create();this.basis2=f.create()};
const U={plane:h.create(),origin:f.fromValues(0,0,0),basis1:f.fromValues(1,0,0),basis2:f.fromValues(0,1,0)},Y=new n.ObjectStack(h.create),ba=new n.ObjectStack(g.create),da=f.create(),ea=new n.ObjectStack(()=>k()),ca=[{origin:[-1,-1],direction:[1,0]},{origin:[1,-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],ja=m.create(),ia=m.create();n=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:c,UP:U,altitudeAt:H,axisAt:G,closestPoint:E,closestPointOnSilhouette:F,
copy:z,copyWithoutVerify:C,create:k,distance:N,distance2:M,distanceToSilhouette:P,elevate:x,equals:O,extrusionContainsPoint:I,fromAABoundingRect:y,fromValues:B,intersectRay:w,intersectRayClosestSilhouette:D,normal:Q,projectPoint:K,projectPointLocal:J,rotate:R,setAltitudeAt:L,setExtent:u,transform:S,updateUnboundedPlane:A,wrap:p},Symbol.toStringTag,{value:"Module"}));a.BoundedPlaneClass=c;a.UP=U;a.altitudeAt=H;a.axisAt=G;a.boundedPlane=n;a.closestPoint=E;a.closestPointOnSilhouette=F;a.copy=z;a.copyWithoutVerify=
C;a.create=k;a.distance=N;a.distance2=M;a.distanceToSilhouette=P;a.elevate=x;a.equals=O;a.extrusionContainsPoint=I;a.fromAABoundingRect=y;a.fromValues=B;a.intersectRay=w;a.intersectRayClosestSilhouette=D;a.normal=Q;a.projectPoint=K;a.projectPointLocal=J;a.rotate=R;a.setAltitudeAt=L;a.setExtent=u;a.transform=S;a.updateUnboundedPlane=A;a.wrap=p})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(a,c){let b=function(){function t(r){this._allocator=r;this._items=[];this._itemsPtr=
0;this._grow()}var n=t.prototype;n.get=function(){0===this._itemsPtr&&c.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]};n._reset=function(){this._items.length=Math.min(Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);this._itemsPtr=0};n._grow=function(){for(let r=0;r<Math.max(8,Math.min(this._items.length,1024));r++)this._items.push(this._allocator())};return t}();a.ObjectStack=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat4f64":function(){define(["exports"],function(a){function c(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function b(d){return[d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8],d[9],d[10],d[11],d[12],d[13],d[14],d[15]]}function t(d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){return[d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u]}function n(d,f){return new Float64Array(d,f,16)}const r=c(),m=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:r,clone:b,create:c,createView:n,
fromValues:t},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=r;a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.mat4f64=m})},"esri/geometry/support/Axis":function(){define(["exports"],function(a){a.Axis=void 0;var c=a.Axis||(a.Axis={});c[c.X=0]="X";c[c.Y=1]="Y";c[c.Z=2]="Z";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),
function(a,c,b,t,n,r){function m(q){return q?{origin:n.clone(q.origin),vector:n.clone(q.vector)}:{origin:n.create(),vector:n.create()}}function d(q,k){const p=v.get();p.origin=q;p.vector=k;return p}function f(q,k,p=m()){t.copy(p.origin,q);t.copy(p.vector,k);return p}function e(q,k){k=t.subtract(r.sv3d.get(),k,q.origin);var p=t.dot(q.vector,k);const z=t.dot(q.vector,q.vector);p=c.clamp(p/z,0,1);q=t.subtract(r.sv3d.get(),t.scale(r.sv3d.get(),q.vector,p),k);return t.dot(q,q)}function g(q,k,p,z,C){const {vector:B,
origin:A}=q;k=t.subtract(r.sv3d.get(),k,A);k=t.dot(B,k)/t.squaredLength(B);t.scale(C,B,c.clamp(k,p,z));return t.add(C,C,q.origin)}function h(q,k,p,z){const C=q.origin;var B=t.add(r.sv3d.get(),C,q.vector);q=k.origin;var A=t.add(r.sv3d.get(),q,k.vector),x=r.sv3d.get();k=r.sv3d.get();x[0]=C[0]-q[0];x[1]=C[1]-q[1];x[2]=C[2]-q[2];k[0]=A[0]-q[0];k[1]=A[1]-q[1];k[2]=A[2]-q[2];if(1E-6>Math.abs(k[0])&&1E-6>Math.abs(k[1])&&1E-6>Math.abs(k[2]))return!1;A=r.sv3d.get();A[0]=B[0]-C[0];A[1]=B[1]-C[1];A[2]=B[2]-
C[2];if(1E-6>Math.abs(A[0])&&1E-6>Math.abs(A[1])&&1E-6>Math.abs(A[2]))return!1;B=x[0]*k[0]+x[1]*k[1]+x[2]*k[2];var u=k[0]*A[0]+k[1]*A[1]+k[2]*A[2];const y=k[0]*k[0]+k[1]*k[1]+k[2]*k[2],w=(A[0]*A[0]+A[1]*A[1]+A[2]*A[2])*y-u*u;if(1E-6>Math.abs(w))return!1;x=(B*u-(x[0]*A[0]+x[1]*A[1]+x[2]*A[2])*y)/w;B=(B+u*x)/y;p&&(x=c.clamp(x,0,1),B=c.clamp(B,0,1));p=r.sv3d.get();u=r.sv3d.get();p[0]=C[0]+x*A[0];p[1]=C[1]+x*A[1];p[2]=C[2]+x*A[2];u[0]=q[0]+B*k[0];u[1]=q[1]+B*k[1];u[2]=q[2]+B*k[2];z.tA=x;z.tB=B;z.pA=p;
z.pB=u;z.distance2=t.squaredDistance(p,u);return!0}const l={tA:0,tB:0,pA:n.create(),pB:n.create(),distance2:0},v=new b.ObjectStack(()=>m());a.closestLineSegmentDistance2=function(q,k){return h(q,k,!0,l)?l.distance2:null};a.closestLineSegmentPoint=function(q,k,p){return h(q,k,!0,l)?(t.copy(p,l.pA),!0):!1};a.closestRayDistance2=function(q,k){if(h(q,d(k.origin,k.direction),!1,l)){const {tA:p,pB:z,distance2:C}=l;if(0<=p&&1>=p)return C;if(0>p)return t.squaredDistance(q.origin,z);if(1<p)return t.squaredDistance(t.add(r.sv3d.get(),
q.origin,q.vector),z)}return null};a.copy=function(q,k=m()){return f(q.origin,q.vector,k)};a.create=m;a.distance=function(q,k){return Math.sqrt(e(q,k))};a.distance2=e;a.fromPoints=function(q,k,p=m()){t.copy(p.origin,q);t.subtract(p.vector,k,q);return p};a.fromValues=f;a.pointAt=function(q,k,p){return t.add(p,q.origin,t.scale(p,q.vector,k))};a.projectPoint=function(q,k,p){return g(q,k,0,1,p)};a.projectPointClamp=g;a.wrap=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vectorStacks":function(){define(["exports",
"../../core/VectorStack"],function(a,c){const b=c.VectorStack.createVec2f64(),t=c.VectorStack.createVec3f64(),n=c.VectorStack.createVec4f64(),r=c.VectorStack.createMat3f64(),m=c.VectorStack.createMat4f64();c=c.VectorStack.createQuatf64();a.sm3d=r;a.sm4d=m;a.sq4d=c;a.sv2d=b;a.sv3d=t;a.sv4d=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./byteSizeEstimations ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),
function(a,c,b,t,n,r,m,d,f,e){let g=function(){function l(q,k,p){this._itemByteSize=q;this._itemCreate=k;this._buffers=[];this._items=[];this._itemsPtr=0;this._itemsPerBuffer=Math.ceil(p/this._itemByteSize)}var v=l.prototype;v.get=function(){0===this._itemsPtr&&t.nextTick(()=>this._reset());const q=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=q;){const k=new ArrayBuffer(this._itemsPerBuffer*this._itemByteSize);for(let p=0;p<this._itemsPerBuffer;++p)this._items.push(this._itemCreate(k,
p*this._itemByteSize));this._buffers.push(k)}return this._items[this._itemsPtr++]};v._reset=function(){const q=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>q;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0};l.createVec2f64=function(q=h){return new l(16,d.createView,q)};l.createVec3f64=function(q=h){return new l(24,f.createView,q)};l.createVec4f64=function(q=h){return new l(32,e.createView,q)};l.createMat3f64=function(q=
h){return new l(72,n.createView,q)};l.createMat4f64=function(q=h){return new l(128,r.createView,q)};l.createQuatf64=function(q=h){return new l(32,m.createView,q)};c._createClass(l,[{key:"test",get:function(){return{size:this._buffers.length*this._itemsPerBuffer*this._itemByteSize}}}]);return l}();const h=4*b.ByteSizeUnit.KILOBYTES;a.VectorStack=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/byteSizeEstimations":function(){define(["exports"],function(a){function c(n){return 32+
n.length}function b(n){if(!n)return 0;if(Array.isArray(n)){var r=n.length;if(0===r||"number"===typeof n[0])n=32+8*r;else{var m=32;for(let d=0;d<r;d++)m+=t(n[d]);n=m}return n}m=32;for(r in n)n.hasOwnProperty(r)&&(m+=t(n[r]));return m}function t(n){switch(typeof n){case "object":return b(n);case "string":return c(n);case "number":return 16;case "boolean":return 4;default:return 8}}a.ByteSizeUnit=void 0;(function(n){n[n.KILOBYTES=1024]="KILOBYTES";n[n.MEGABYTES=1048576]="MEGABYTES";n[n.GIGABYTES=1073741824]=
"GIGABYTES"})(a.ByteSizeUnit||(a.ByteSizeUnit={}));a.estimateAttributesObjectSize=function(n){if(!n)return 0;let r=32;for(const m in n)if(n.hasOwnProperty(m)){const d=n[m];switch(typeof d){case "string":r+=c(d);break;case "number":r+=16;break;case "boolean":r+=4}}return r};a.estimateFixedArraySize=function(n,r){return 32+n.length*r};a.estimateNestedObjectSize=b;a.estimateNumberByteSize=function(n){return 16};a.estimateStringByteSize=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/mat3f64":function(){define(["exports"],function(a){function c(){return[1,0,0,0,1,0,0,0,1]}function b(m){return[m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8]]}function t(m,d,f,e,g,h,l,v,q){return[m,d,f,e,g,h,l,v,q]}function n(m,d){return new Float64Array(m,d,9)}const r=Object.freeze(Object.defineProperty({__proto__:null,clone:b,create:c,createView:n,fromValues:t},Symbol.toStringTag,{value:"Module"}));a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.mat3f64=r})},"esri/chunks/quatf64":function(){define(["exports"],
function(a){function c(){return[0,0,0,1]}function b(d){return[d[0],d[1],d[2],d[3]]}function t(d,f,e,g){return[d,f,e,g]}function n(d,f){return new Float64Array(d,f,4)}const r=c(),m=Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:r,clone:b,create:c,createView:n,fromValues:t},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=r;a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.quatf64=m})},"esri/chunks/vec2f64":function(){define(["exports"],function(a){function c(){return[0,0]}function b(k){return[k[0],
k[1]]}function t(k,p){return[k,p]}function n(k){const p=[0,0],z=Math.min(2,k.length);for(let C=0;C<z;++C)p[C]=k[C];return p}function r(k,p){return new Float64Array(k,p,2)}function m(){return[0,0]}function d(){return[1,1]}function f(){return[1,0]}function e(){return[0,1]}const g=[0,0],h=[1,1],l=[1,0],v=[0,1],q=Object.freeze(Object.defineProperty({__proto__:null,ONES:h,UNIT_X:l,UNIT_Y:v,ZEROS:g,clone:b,create:c,createView:r,fromArray:n,fromValues:t,ones:d,unitX:f,unitY:e,zeros:m},Symbol.toStringTag,
{value:"Module"}));a.ONES=h;a.UNIT_X=l;a.UNIT_Y=v;a.ZEROS=g;a.clone=b;a.create=c;a.createView=r;a.fromArray=n;a.fromValues=t;a.ones=d;a.unitX=f;a.unitY=e;a.vec2f64=q;a.zeros=m})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../core/maybe ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/sphere ./vector ./vectorStacks ../../views/3d/support/mathUtils".split(" "),function(a,c,b,t,n,r,m,d,f){function e(E=y){return[E[0],E[1],E[2],E[3]]}function g(E,K){return h(K[0],
K[1],K[2],K[3],E)}function h(E,K,J,M,N=e()){N[0]=E;N[1]=K;N[2]=J;N[3]=M;return N}function l(E,K,J){var M=K[0]*K[0]+K[1]*K[1]+K[2]*K[2];M=1E-5<Math.abs(M-1)&&1E-12<M?1/Math.sqrt(M):1;J[0]=K[0]*M;J[1]=K[1]*M;J[2]=K[2]*M;J[3]=-(J[0]*E[0]+J[1]*E[1]+J[2]*E[2]);return J}function v(E,K,J,M=e()){var N=J[0]-K[0],P=J[1]-K[1],I=J[2]-K[2];J=E[0]-K[0];const G=E[1]-K[1],H=E[2]-K[2];K=P*H-I*G;I=I*J-N*H;N=N*G-P*J;P=K*K+I*I+N*N;P=1E-5<Math.abs(P-1)&&1E-12<P?1/Math.sqrt(P):1;M[0]=K*P;M[1]=I*P;M[2]=N*P;M[3]=-(M[0]*
E[0]+M[1]*E[1]+M[2]*E[2]);return M}function q(E,K,J,M,N){const P=E.length/3;if(3>P)return!1;t.set(C,E[3*J],E[3*J+1],E[3*J+2]);let I=M;for(var G=!1;I<P-1&&!G;)G=3*I,t.set(B,E[G],E[G+1],E[G+2]),I++,G=!t.exactEquals(C,B);if(!G)return!1;I=Math.max(I,N);for(G=!1;I<P&&!G;)G=3*I,t.set(A,E[G],E[G+1],E[G+2]),I++,t.subtract(x,C,B),t.normalize(x,x),t.subtract(u,B,A),t.normalize(u,u),G=!t.exactEquals(C,A)&&!t.exactEquals(B,A)&&.99619469809>Math.abs(t.dot(x,u));if(!G)return 0===J&&1===M&&2===N?!1:q(E,K,0,1,2);
v(C,B,A,K);return!0}function k(E,K,J){E=t.scale(d.sv3d.get(),E,t.dot(E,K));t.subtract(J,K,E);return J}function p(E,K){return t.dot(E,K)+E[3]}function z(E,K,J,M,N){const P=t.dot(E,J);if(0===P)return!1;E=-(t.dot(E,K)+E[3])/P;M&w.CLAMP&&(E=c.clamp(E,0,1));if(!(M&w.INFINITE_MIN)&&0>E||!(M&w.INFINITE_MAX)&&1<E)return!1;t.add(N,K,t.scale(N,J,E));return!0}const C=n.create(),B=n.create(),A=n.create(),x=n.create(),u=n.create(),y=[0,0,1,0];var w;(function(E){E[E.NONE=0]="NONE";E[E.CLAMP=1]="CLAMP";E[E.INFINITE_MIN=
4]="INFINITE_MIN";E[E.INFINITE_MAX=8]="INFINITE_MAX"})(w||(w={}));const D=w.INFINITE_MIN|w.INFINITE_MAX,F=w.INFINITE_MAX;a.UP=y;a.clip=function(E,K){const J=t.dot(E,K.ray.direction);E=-p(E,K.ray.origin);if(0>E&&0<=J)return!1;if(-1E-6<J&&1E-6>J)return 0<E;if((0>E||0>J)&&!(0>E&&0>J))return!0;E/=J;0<J?E<K.c1&&(K.c1=E):E>K.c0&&(K.c0=E);return K.c0<=K.c1};a.clipInfinite=function(E,K){const J=t.dot(E,K.ray.direction);E=-p(E,K.ray.origin);if(-1E-6<J&&1E-6>J)return 0<E;E/=J;0<J?E<K.c1&&(K.c1=E):E>K.c0&&(K.c0=
E);return K.c0<=K.c1};a.copy=g;a.create=e;a.distance=function(E,K){return Math.abs(p(E,K))};a.fromManyPoints=function(E,K){return q(E,K,0,1,2)};a.fromManyPointsSampleAt=q;a.fromNormalAndOffset=function(E,K,J){t.copy(J,E);J[3]=K;return J};a.fromPoints=v;a.fromPositionAndNormal=l;a.fromValues=h;a.fromVectorsAndPoint=function(E,K,J,M){t.cross(A,K,E);return l(J,A,M)};a.intersectLine=function(E,K,J,M){J=t.subtract(d.sv3d.get(),J,K);return z(E,K,J,D,M)};a.intersectLineSegment=function(E,K,J){return z(E,
K.origin,K.vector,w.NONE,J)};a.intersectLineSegmentClamp=function(E,K,J){return z(E,K.origin,K.vector,w.CLAMP,J)};a.intersectRay=function(E,K,J){return b.isSome(K)?z(E,K.origin,K.direction,F,J):!1};a.isPointInside=function(E,K){return 0<=p(E,K)};a.isPointOutside=function(E,K){return 0>p(E,K)};a.isSphereFullyInside=function(E,K){return 0<=p(E,r.getCenter(K))-K[3]};a.isSphereFullyOutside=function(E,K){return 0>p(E,r.getCenter(K))+K[3]};a.negate=function(E,K){K[0]=-E[0];K[1]=-E[1];K[2]=-E[2];K[3]=-E[3];
return K};a.normal=function(E){return E};a.projectPoint=function(E,K,J){const M=t.scale(d.sv3d.get(),E,-E[3]);K=t.subtract(d.sv3d.get(),K,M);E=k(E,K,d.sv3d.get());t.add(J,E,M);return J};a.projectPointLocal=function(E,K,J,M){var N=d.sv3d.get(),P=d.sv3d.get();f.tangentFrame(E,N,P);K=t.subtract(d.sv3d.get(),J,K);N=m.projectPointSignedLength(N,K);P=m.projectPointSignedLength(P,K);E=m.projectPointSignedLength(E,K);return t.set(M,N,P,E)};a.projectVector=k;a.setOffsetFromPoint=function(E,K,J){K!==E&&g(E,
K);E[3]=-t.dot(E,J);return E};a.signedDistance=p;a.wrap=function(E=y[0],K=y[1],J=y[2],M=y[3]){return h(E,K,J,M,d.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/maybe ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(){return e.create()}
function k(Q,V=q()){return f.copy(V,Q)}function p(Q,V){return e.fromValues(Q[0],Q[1],Q[2],V)}function z(Q){return Q}function C(Q){Q[0]=Q[1]=Q[2]=Q[3]=0}function B(Q,V){Q[0]=Q[1]=Q[2]=0;Q[3]=V;return Q}function A(Q){return Q[3]}function x(Q){return Q}function u(Q,V,aa,X){return e.fromValues(Q,V,aa,X)}function y(Q,V,aa){Q!==aa&&m.copy(aa,Q);aa[3]=Q[3]+V;return aa}function w(Q,V,aa){b.getLogger("esri.geometry.support.sphere").error("sphere.setExtent is not yet supported");return Q===aa?aa:k(Q,aa)}function D(Q,
V,aa){if(n.isNone(V))return!1;const {origin:X,direction:W}=V;var T=O;T[0]=X[0]-Q[0];T[1]=X[1]-Q[1];T[2]=X[2]-Q[2];V=W[0]*W[0]+W[1]*W[1]+W[2]*W[2];if(0===V)return!1;const U=2*(W[0]*T[0]+W[1]*T[1]+W[2]*T[2]);Q=U*U-4*V*(T[0]*T[0]+T[1]*T[1]+T[2]*T[2]-Q[3]*Q[3]);if(0>Q)return!1;T=Math.sqrt(Q);Q=(-U-T)/(2*V);V=(-U+T)/(2*V);if(0>Q||V<Q&&0<V)Q=V;if(0>Q)return!1;aa&&(aa[0]=X[0]+W[0]*Q,aa[1]=X[1]+W[1]*Q,aa[2]=X[2]+W[2]*Q);return!0}function F(Q,V){return D(Q,V,null)}function E(Q,V,aa){if(D(Q,V,aa))return aa;
Q=K(Q,V,v.sv3d.get());m.add(aa,V.origin,m.scale(v.sv3d.get(),V.direction,m.distance(V.origin,Q)/m.length(V.direction)));return aa}function K(Q,V,aa){const X=v.sv3d.get(),W=v.sm4d.get();m.cross(X,V.origin,V.direction);const T=Q[3];m.cross(aa,X,V.origin);m.scale(aa,aa,1/m.length(aa)*T);Q=P(Q,V.origin);V=l.angle(V.origin,aa);r.fromRotation(W,V+Q,X);m.transformMat4(aa,aa,W);return aa}function J(Q,V,aa){if(D(Q,V,aa))return aa;h.closestPoint(V,Q,aa);return M(Q,aa,aa)}function M(Q,V,aa){V=m.subtract(v.sv3d.get(),
V,Q);V=m.scale(v.sv3d.get(),V,Q[3]/m.length(V));return m.add(aa,V,Q)}function N(Q,V){V=m.subtract(v.sv3d.get(),V,Q);V=m.squaredLength(V);return Math.sqrt(Math.abs(V-Q[3]*Q[3]))}function P(Q,V){V=m.subtract(v.sv3d.get(),V,Q);V=m.length(V);Q=Q[3];return t.acosClamped(Q/(Q+Math.abs(Q-V)))}function I(Q,V,aa,X){Q=m.subtract(S,V,Q);switch(aa){case g.Axis.X:return aa=t.cartesianToSpherical(Q,S)[2],m.set(X,-Math.sin(aa),Math.cos(aa),0);case g.Axis.Y:return Q=t.cartesianToSpherical(Q,S),aa=Q[1],Q=Q[2],V=Math.sin(aa),
m.set(X,-V*Math.cos(Q),-V*Math.sin(Q),Math.cos(aa));case g.Axis.Z:return m.normalize(X,Q)}}function G(Q,V){V=m.subtract(R,V,Q);return m.length(V)-Q[3]}function H(Q,V,aa,X){const W=G(Q,V);Q=I(Q,V,g.Axis.Z,R);aa=m.scale(R,Q,aa-W);return m.add(X,V,aa)}function L(Q,V){V=m.squaredDistance(Q,V);Q=Q[3];return V<=Q*Q}const O=d.create(),S=d.create(),R=d.create();c=q();d=Object.freeze(Object.defineProperty({__proto__:null,altitudeAt:G,angleToSilhouette:P,axisAt:I,clear:C,closestPoint:J,closestPointOnSilhouette:K,
containsPoint:L,copy:k,create:q,distanceToSilhouette:N,elevate:y,fromCenterAndRadius:p,fromRadius:B,fromValues:u,getCenter:x,getRadius:A,intersectRay:D,intersectRayClosestSilhouette:E,intersectsRay:F,projectPoint:M,setAltitudeAt:H,setExtent:w,tmpSphere:c,wrap:z},Symbol.toStringTag,{value:"Module"}));a.altitudeAt=G;a.angleToSilhouette=P;a.axisAt=I;a.clear=C;a.closestPoint=J;a.closestPointOnSilhouette=K;a.containsPoint=L;a.copy=k;a.create=q;a.distanceToSilhouette=N;a.elevate=y;a.fromCenterAndRadius=
p;a.fromRadius=B;a.fromValues=u;a.getCenter=x;a.getRadius=A;a.intersectRay=D;a.intersectRayClosestSilhouette=E;a.intersectsRay=F;a.projectPoint=M;a.setAltitudeAt=H;a.setExtent=w;a.sphere=d;a.tmpSphere=c;a.wrap=z})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(a,c,b,t,n,r){function m(h){return h?d(n.clone(h.origin),n.clone(h.direction)):d(n.create(),n.create())}function d(h,
l){return{origin:h,direction:l}}function f(h,l,v=m()){t.copy(v.origin,h);t.copy(v.direction,l);return v}function e(h,l){h=t.cross(r.sv3d.get(),t.normalize(r.sv3d.get(),h.direction),t.subtract(r.sv3d.get(),l,h.origin));return t.dot(h,h)}const g=new b.ObjectStack(()=>m());a.closestPoint=function(h,l,v){l=t.dot(h.direction,t.subtract(v,l,h.origin));t.add(v,h.origin,t.scale(v,h.direction,l));return v};a.copy=function(h,l=m()){return f(h.origin,h.direction,l)};a.create=m;a.distance=function(h,l){return Math.sqrt(e(h,
l))};a.distance2=e;a.equals=function(h,l){return c.equals(h.origin,l.origin)&&c.equals(h.direction,l.direction)};a.fromPoints=function(h,l,v=m()){t.copy(v.origin,h);t.subtract(v.direction,l,h);return v};a.fromValues=f;a.wrap=function(h,l){const v=g.get();v.origin=h;v.direction=l;return v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/vector":function(){define(["exports","../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],function(a,c,b,t){const n=
t.create(),r=t.create();a.angle=function(m,d){m=b.dot(m,d)/(b.length(m)*b.length(d));return-c.acosClamped(m)};a.angleAroundAxis=function(m,d,f){b.normalize(n,m);b.normalize(r,d);m=b.dot(n,r);m=c.acosClamped(m);d=b.cross(n,n,r);return 0>b.dot(d,f)?2*Math.PI-m:m};a.projectPoint=function(m,d,f){d=b.dot(m,d)/b.dot(m,m);return b.scale(f,m,d)};a.projectPointSignedLength=function(m,d){return b.dot(m,d)/b.length(m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/mathUtils":function(){define(["exports",
"../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,c,b,t){const n=t.create(),r=t.create(),m=t.create(),d=t.create(),f=t.create();a.angle=function(e,g,h){e=b.normalize(d,e);g=b.normalize(f,g);const l=c.acosClamped(b.dot(e,g));return h&&(e=b.cross(m,e,g),0>b.dot(e,h))?-l:l};a.bilerp=function(e,g,h,l,v,q){e+=(g-e)*v;return e+(h+(l-h)*v-e)*q};a.cosCapped=function(e,g){return e>g?Math.cos(g):Math.cos(e)};a.fovx2fovy=function(e,g,h){return 2*Math.atan(h*Math.tan(.5*e)/
g)};a.fovy2fovx=function(e,g,h){return 2*Math.atan(g*Math.tan(.5*e)/h)};a.makeOrthonormal=function(e,g,h){h=h||e;const l=b.dot(e,g);b.set(h,e[0]-l*g[0],e[1]-l*g[1],e[2]-l*g[2]);b.normalize(h,h)};a.makePiecewiseLinearFunction=function(e){const g=e.length;return h=>{if(h<=e[0][0])return e[0][1];if(h>=e[g-1][0])return e[g-1][1];let l=1;for(;h>e[l][0];)l++;const v=e[l][0];h=(v-h)/(v-e[l-1][0]);return h*e[l-1][1]+(1-h)*e[l][1]}};a.maxScale=function(e){return Math.sqrt(Math.max(e[0]*e[0]+e[4]*e[4]+e[8]*
e[8],e[1]*e[1]+e[5]*e[5]+e[9]*e[9],e[2]*e[2]+e[6]*e[6]+e[10]*e[10]))};a.moduloPositive=function(e,g){return(e%g+g)%g};a.planeFromPoints=function(e,g,h,l){b.subtract(n,g,e);b.subtract(r,h,e);b.cross(l,n,r);b.normalize(l,l);l[3]=-b.dot(e,l)};a.scaleFromMatrix=function(e,g){b.set(e,Math.sqrt(g[0]*g[0]+g[4]*g[4]+g[8]*g[8]),Math.sqrt(g[1]*g[1]+g[5]*g[5]+g[9]*g[9]),Math.sqrt(g[2]*g[2]+g[6]*g[6]+g[10]*g[10]));return e};a.slerp=function(e,g,h,l=t.create()){const v=b.length(e);var q=b.length(g),k=b.dot(e,
g)/(v*q);if(.9999999999999999>k){k=Math.acos(k);const p=((1-h)*v+h*q)/Math.sin(k);q=p/q*Math.sin(h*k);b.scale(d,e,p/v*Math.sin((1-h)*k));b.scale(f,g,q);return b.add(l,d,f)}return b.lerp(l,e,g,h)};a.slerpTangent=function(e,g,h,l=t.create(),v=t.create()){const q=b.length(e),k=b.length(g);var p=b.dot(e,g)/(q*k);if(.9999999999999999>p){p=Math.acos(p);const z=Math.sin(p),C=Math.sin(h*p),B=Math.sin((1-h)*p),A=(1-h)*q+h*k,x=A/z,u=x/k*C;b.scale(d,e,x/q*B);b.scale(f,g,u);b.add(l,d,f);b.scale(d,e,1/q*(-Math.cos((1-
h)*p)*p*A+B*(-q+k)));b.scale(f,g,1/k*(Math.cos(h*p)*p*A+C*(-q+k)));b.add(v,d,f);b.scale(v,v,1/z);return v}b.lerp(l,e,g,h);b.subtract(v,g,e);b.normalize(v,v);return v};a.tangentFrame=function(e,g,h){Math.abs(e[0])>Math.abs(e[1])?b.set(g,0,1,0):b.set(g,1,0,0);b.cross(h,e,g);b.normalize(g,g);b.cross(g,h,e);b.normalize(h,h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../ellipsoidUtils ../SpatialReference ../spatialReferenceEllipsoidUtils ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(z){return{operations:z,value:z.create()}}function h(z,C,B=g(z)){B.operations=z;z.copy(C,B.value);return B}function l(z,C,B,A){return z.operations.setAltitudeAt(z.value,C,B,A)}const v=2**50,q=t.create(),k={operations:null,value:null},p=t.create();a.altitudeAt=function(z,C){return z.operations.altitudeAt(z.value,C)};a.axisAt=function(z,C,B,A){return z.operations.axisAt(z.value,C,B,A)};a.closestPoint=function(z,C,B){return z.operations.closestPoint(z.value,C,
B)};a.closestPointOnSilhouette=function(z,C,B){return z.operations.closestPointOnSilhouette(z.value,C,B)};a.coordinateSystemFromOneAxisAndNormalVector=function(z,C,B,A,x){b.copy(B,z);b.copy(p,C);b.normalize(p,p);b.cross(A,p,B);b.cross(x,A,B)};a.create=function(z){const {value:C,operations:B}=z;return{operations:B,value:B.create(C)}};a.createFromOperations=g;a.createGlobal=function(z){return h(e.sphere,e.fromValues(0,0,0,n.getReferenceEllipsoid(z).radius))};a.createLocal=function(){return h(f.boundedPlane,
f.fromValues([0,0,0],[v,0,0],[0,v,0]))};a.distanceToSilhouette=function(z,C){return z.operations.distanceToSilhouette(z.value,C)};a.elevate=function(z,C,B){return z.operations.elevate(z.value,C,B.value)};a.fromValues=h;a.intersectRay=function(z,C,B){return z.operations.intersectRay(z.value,C,B)};a.intersectRayClosestSilhouette=function(z,C,B){return z.operations.intersectRayClosestSilhouette(z.value,C,B)};a.intersectsRay=function(z,C){return z.operations.intersectRay(z.value,C,null)};a.normalAt=function(z,
C,B){return z.operations.axisAt(z.value,C,d.Axis.Z,B)};a.renderSRFromViewSR=function(z,C){return z?m.getSphericalPCPF(C):C.isGeographic?r.PlateCarree:C};a.setAltitudeAt=l;a.setAltitudeOfTransformation=function(z,C,B,A){C!==A&&c.copy(A,C);b.set(q,A[12],A[13],A[14]);l(z,q,B,q);A[12]=q[0];A[13]=q[1];A[14]=q[2];return A};a.setExtent=function(z,C,B){z.operations.setExtent(z.value,C,B.value);return B};a.vectorCoordinates=function(z,C,B,A,x){x[0]=b.dot(z,C);x[1]=b.dot(z,B);x[2]=b.dot(z,A);return x};a.wrap=
function(z,C){k.operations=z;k.value=C;return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/spatialReferenceEllipsoidUtils":function(){define(["exports","./ellipsoidUtils","./SpatialReference","./support/spatialReferenceUtils"],function(a,c,b,t){const n=new b(c.SphericalECEFSpatialReferenceLike),r=new b(c.SphericalPCPFMarsLike),m=new b(c.SphericalPCPFMoonLike);c=new b(c.WGS84ECEFSpatialReferenceLike);a.SphericalECEFSpatialReference=n;a.SphericalPCPFMars=r;a.SphericalPCPFMoon=
m;a.WGS84ECEFSpatialReference=c;a.getSphericalPCPF=function(d){return d&&(t.isMars(d)||t.equals(d,r))?r:d&&(t.isMoon(d)||t.equals(d,m))?m:n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(a,c){function b(t,n){n=c.getMetersPerUnitForSR(n);return t/(n*c.inchesPerMeter*96)}a.getExtentForScale=function(t,n){const r=t.extent;t=t.width-(t.padding?t.padding.left+t.padding.right:0);n=b(n,r.spatialReference);
return r.clone().expand(n*t/r.width)};a.getResolutionForScale=b;a.getResolutionInMetersForScale=function(t){return t/(96*c.inchesPerMeter)};a.getScale=function(t,n){n=n||t.extent;t=t.width;const r=c.getMetersPerUnitForSR(n&&n.spatialReference);return n&&t?n.width/t*r*c.inchesPerMeter*96:0};a.getScaleForResolution=function(t,n){n=c.getMetersPerUnitForSR(n);return t*n*c.inchesPerMeter*96};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/LayerConstants":function(){define(["exports"],
function(a){a.fallbackObjectIDAttribute="OBJECTID";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/ArrayPool ../core/Handles ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){function h(q,k){return k?
l[q].valueToClassName[k].split(" "):[]}const l={widthBreakpoint:{getValue(q){const k=q.viewSize[0];q=q.breakpoints;const p=this.values;return k<=q.xsmall?p.xsmall:k<=q.small?p.small:k<=q.medium?p.medium:k<=q.large?p.large:p.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue(q){const k=q.viewSize[1];q=q.breakpoints;const p=this.values;return k<=q.xsmall?p.xsmall:k<=q.small?p.small:k<=q.medium?p.medium:k<=q.large?p.large:p.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue(q){q=q.viewSize;const k=this.values;return q[1]>=q[0]?k.portrait:k.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},v={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=q=>{q=function(k){function p(...C){C=k.call(this,...C)||this;C._breakpointsHandles=new n;C.orientation=null;C.widthBreakpoint=null;C.heightBreakpoint=null;C.breakpoints=v;return C}
c._inheritsLoose(p,k);var z=p.prototype;z.initialize=function(){this._breakpointsHandles.add(m.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),m.initial))};z.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=r.destroyMaybe(this._breakpointsHandles))};z._updateClassNames=function(){if(this.container){var C=t.acquire(),B=t.acquire(),A=!1,x;for(x in l){const u=this[x],y=l[x].getValue({viewSize:this.size,breakpoints:this.breakpoints});u!==
y&&(A=!0,this[x]=y,h(x,u).forEach(w=>B.push(w)),h(x,y).forEach(w=>C.push(w)))}A&&(this._applyClassNameChanges(C,B),t.release(C),t.release(B))}};z._applyClassNameChanges=function(C,B){const A=this.container;A&&(B.forEach(x=>A.classList.remove(x)),C.forEach(x=>A.classList.add(x)))};z._removeActiveClassNames=function(){const C=this.container;if(C)for(var B in l)h(B,this[B]).forEach(A=>C.classList.remove(A))};c._createClass(p,[{key:"breakpoints",set:function(C){var B=this._get("breakpoints");if(C!==B){B=
(B=C)&&B.xsmall<B.small&&B.small<B.medium&&B.medium<B.large;if(!B){const A=JSON.stringify(v,null,2);console.warn("provided breakpoints are not valid, using defaults:"+A)}C=B?C:v;this._set("breakpoints",{...C})}}}]);return p}(q);b.__decorate([d.property()],q.prototype,"breakpoints",null);b.__decorate([d.property()],q.prototype,"orientation",void 0);b.__decorate([d.property()],q.prototype,"widthBreakpoint",void 0);b.__decorate([d.property()],q.prototype,"heightBreakpoint",void 0);return q=b.__decorate([g.subclass("esri.views.BreakpointsOwner")],
q)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/DOMContainer":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/domUtils ../core/Logger ../core/maybe ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../widgets/Popup".split(" "),function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(p){p&&
(t.empty(p),p.parentNode&&p.parentNode.removeChild(p))}const k=[0,0];a.DOMContainer=p=>{p=function(z){function C(...A){var x=z.call(this,...A)||this;x._freqInfo={freq:16,time:750};x._overlayRenderTaskHandle=null;x.height=0;x.overlay=null;x.position=null;x.resizing=!1;x.root=null;x.surface=null;x.suspended=!0;x.ui=null;x.userContent=null;x.width=0;x.widthBreakpoint=null;if(0===A.length||void 0===A[0]?.popup)x.popup=new v({view:c._assertThisInitialized(x)});x.handles.add([m.watch(()=>x.cursor,u=>{const {surface:y}=
c._assertThisInitialized(x);y&&y.setAttribute("data-cursor",u)}),m.watch(()=>x.interacting,u=>{const {surface:y}=c._assertThisInitialized(x);y&&y.setAttribute("data-interacting",u.toString())})]);return x}c._inheritsLoose(C,z);var B=C.prototype;B.initialize=function(){this.handles.add(m.watch(()=>this.ui,(A,x)=>this._handleUIChange(A,x)));this._wireUI(this.ui);this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])};B.destroy=function(){this.destroyed||
(this.ui=r.destroyMaybe(this.ui),this.popup&&!this.popup.destroyed&&this.popup.destroy(),this.container=null)};B.blur=function(){this.surface&&this.surface.blur()};B.focus=function(){this.surface&&this.surface.focus()};B.pageToContainer=function(A,x,u){const y=this.position;A-=y?y[0]:0;x-=y?y[1]:0;u?(u[0]=A,u[1]=x):u=[A,x];return u};B.containerToPage=function(A,x,u){const y=this.position;A+=y?y[0]:0;x+=y?y[1]:0;u?(u[0]=A,u[1]=x):u=[A,x];return u};B._handleUIChange=function(A,x){x&&(this.handles.remove("ui"),
x.destroy());A&&this._wireUI(A);this._set("ui",A)};B._wireUI=function(A){this.handles.remove("ui");A&&(A.view=this,this.handles.add([m.watch(()=>this.root,x=>{if(x){const u=document.createElement("div");x.appendChild(u);x=u}else x=null;A.container=x},m.initial),m.watch(()=>this.popup,(x,u)=>{u&&A.remove(u,"popup");x&&(x.view=A.view,A.add(x,{key:"popup",position:"manual"}))},m.initial)],"ui"))};B._stopMeasuring=function(){this.handles.remove("measuring");this._get("resizing")&&this._set("resizing",
!1)};B._startMeasuring=function(){const A=this._freqInfo;A.freq=16;A.time=750;this.handles.add([(()=>{const x=()=>{A.freq=16;A.time=750};window.addEventListener("resize",x);return{remove(){window.removeEventListener("resize",x)}}})(),d.addFrameTask({prepare:x=>{const u=this._measure(),y=this._freqInfo;y.time+=x.deltaTime;u&&(y.freq=16,this._get("resizing")||this._set("resizing",!0));y.time<y.freq||(y.time=0,this._position()||u?y.freq=16:y.freq=Math.min(750,2*y.freq),!u&&512<=y.freq&&this._get("resizing")&&
this._set("resizing",!1))}})],"measuring");this._measure();this._position()};B._measure=function(){var A=this.container;const x=A?A.clientWidth:0;A=A?A.clientHeight:0;if(0===x||0===A)return this.suspended||this._set("suspended",!0),!1;const u=this.width,y=this.height;if(x===u&&A===y)return this.suspended&&this._set("suspended",!1),!1;this._set("width",x);this._set("height",A);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:u,oldHeight:y,width:x,height:A});return!0};B._position=
function(){var A=this.container;const x=this.position;var u;if(u=A)u=(A.ownerDocument||window.document).defaultView,A=A.getBoundingClientRect(),k[0]=A.left+(u?.pageXOffset??0),k[1]=A.top+(u?.pageYOffset??0),u=k;A=u;return A?x&&A[0]===x[0]&&A[1]===x[1]?!1:(this._set("position",[A[0],A[1]]),!0):!1};B.forceDOMReadyCycle=function(){};c._createClass(C,[{key:"container",get:function(){return this._get("container")??null},set:function(A){const x=this._get("container"),u=t.byId(A);u||"string"!==typeof A||
n.getLogger(this.declaredClass).error("#container",`element with id '${A}' not found`);if(x!==u)if(this.handles.remove("dom-size"),this._stopMeasuring(),x&&(x.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay&&(this.overlay.destroy(),this._set("overlay",null)),this.root&&(q(this.root),this._set("root",null)),this.userContent&&(t.reparent(this.userContent,x),q(this.userContent),this._set("userContent",
null))),u){u.classList.add("esri-view");A=document.createElement("div");A.className="esri-view-user-storage";t.reparent(u,A);u.appendChild(A);this._set("userContent",A);A=document.createElement("div");A.className="esri-view-root";u.insertBefore(A,u.firstChild);this._set("root",A);var y=document.createElement("div");y.className="esri-view-surface";y.setAttribute("role","application");y.tabIndex=0;A.appendChild(y);this._set("surface",y);var w=new l;A.appendChild(w.surface);this._set("overlay",w);m.watch(()=>
w.needsRender,D=>{this._overlayRenderTaskHandle=D&&!this._overlayRenderTaskHandle?d.addFrameTask({render:()=>this.overlay?.render()}):r.removeMaybe(this._overlayRenderTaskHandle)});this.forceDOMReadyCycle();this.handles.add(m.watch(()=>this.size,D=>{const [F,E]=D;F>=document.body.clientWidth||E>=document.body.clientHeight?y.classList.add("esri-view-surface--inset-outline"):y.classList.remove("esri-view-surface--inset-outline")},m.initial),"dom-size");this._set("container",u);this._startMeasuring()}else this._set("width",
0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},{key:"focused",get:function(){const A=document.activeElement===this.surface;return document.hasFocus()&&A}},{key:"popup",set:function(A){const x=this._get("popup");x&&x!==A&&x.destroy();this._set("popup",A)}},{key:"size",get:function(){return[this.width,this.height]}}]);return C}(p);b.__decorate([f.property()],p.prototype,"container",null);b.__decorate([f.property({readOnly:!0})],
p.prototype,"focused",null);b.__decorate([f.property({readOnly:!0})],p.prototype,"height",void 0);b.__decorate([f.property({type:v})],p.prototype,"popup",null);b.__decorate([f.property({type:l})],p.prototype,"overlay",void 0);b.__decorate([f.property({readOnly:!0})],p.prototype,"position",void 0);b.__decorate([f.property({readOnly:!0})],p.prototype,"resizing",void 0);b.__decorate([f.property({readOnly:!0})],p.prototype,"root",void 0);b.__decorate([f.property({value:null,readOnly:!0})],p.prototype,
"size",null);b.__decorate([f.property({readOnly:!0})],p.prototype,"surface",void 0);b.__decorate([f.property({readOnly:!0})],p.prototype,"suspended",void 0);b.__decorate([f.property()],p.prototype,"ui",void 0);b.__decorate([f.property({readOnly:!0})],p.prototype,"userContent",void 0);b.__decorate([f.property({readOnly:!0})],p.prototype,"width",void 0);b.__decorate([f.property()],p.prototype,"widthBreakpoint",void 0);return p=b.__decorate([h.subclass("esri.views.DOMContainer")],p)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../core/support/WatchUpdatingTracking ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){b=function(h){function l(){var q=
h.apply(this,arguments)||this;q.items=new t;q._watchUpdatingTracking=new f.WatchUpdatingTracking;q._callbacks=new Map;q._projector=g.createProjector();q._hiddenProjector=g.createProjector();return q}a._inheritsLoose(l,h);var v=l.prototype;v.initialize=function(){const q=document.createElement("div");q.className="esri-overlay-surface";this._set("surface",q);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");q.appendChild(this._hiddenSurface);
this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,k=>{for(const p of k.added){const z=()=>p.render();this._callbacks.set(p,z);this._projector.append(this.surface,z)}for(const p of k.removed)k=this._projector.detach(this._callbacks.get(p)),this.surface.removeChild(k.domNode),this._callbacks.delete(p)})};v.addItem=function(q){this.items.add(q)};v.removeItem=function(q){this.items.remove(q)};v.destroy=function(){this.items.removeAll();this._callbacks.forEach(q=>this._projector.detach(q));
this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};v.render=function(){this._projector.renderNow()};v.computeBoundingRect=function(q){const k=this._hiddenSurface,p=this._hiddenProjector;let z;const C=()=>z=q.render();p.append(k,C);p.renderNow();const B={left:0,top:0,right:0,bottom:0};if(z&&z.domNode){const A=z.domNode.getBoundingClientRect();B.left=A.left;B.top=A.top;B.right=A.right;B.bottom=A.bottom}for(p.detach(C);k.firstChild;)k.removeChild(k.firstChild);return B};v.overlaps=
function(q,k){q=this.computeBoundingRect(q);k=this.computeBoundingRect(k);return Math.max(q.left,k.left)<=Math.min(q.right,k.right)&&Math.max(q.top,k.top)<=Math.min(q.bottom,k.bottom)};v.prepare=function(){var q=a._asyncToGenerator(function*(){yield document.fonts.load(this._fontString()).catch(()=>{})});return function(){return q.apply(this,arguments)}}();v.renderCanvas=function(q){if(this.items.some(p=>p.visible)){var k=q.getContext("2d");k.save();k.font=this._fontString();this.items.forEach(p=>
{k.save();p.renderCanvas(k);k.restore()});k.restore()}};v._fontString=function(){return`10px ${getComputedStyle(this.surface).fontFamily}`};a._createClass(l,[{key:"needsRender",get:function(){return 0<this.items.length}},{key:"updating",get:function(){return this._watchUpdatingTracking?.updating??!1}},{key:"hasVisibleItems",get:function(){return this.items.some(q=>q.visible)}}]);return l}(b);c.__decorate([n.property({readOnly:!0})],b.prototype,"surface",void 0);c.__decorate([n.property({readOnly:!0})],
b.prototype,"items",void 0);c.__decorate([n.property({readOnly:!0})],b.prototype,"needsRender",null);c.__decorate([n.property({readOnly:!0})],b.prototype,"_watchUpdatingTracking",void 0);c.__decorate([n.property({readOnly:!0})],b.prototype,"updating",null);return b=c.__decorate([d.subclass("esri.views.overlay.ViewOverlay")],b)})},"esri/widgets/Popup":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/Collection ../core/events ../core/Handles ../core/Logger ../core/maybe ../core/reactiveUtils ../core/throttle ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./Feature ./Spinner ./Widget ./Feature/resources ./Feature/support/FeatureContentMixin ./Popup/actionUtils ./Popup/css ./Popup/PopupViewModel ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ./support/widgetUtils ../support/themeUtils ../intl/substitute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M){function N(G,H){return void 0===H?`${"esri-popup"}__${G}`:`${"esri-popup"}__${G}-${H}`}const P={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},I={closeButton:!0,featureNavigation:!0};t=function(G){function H(O,S){var R=G.call(this,O,S)||this;R._blurClose=!1;R._blurContainer=!1;R._containerNode=null;R._mainContainerNode=null;R._featureMenuNode=null;R._actionsMenuNode=null;R._focusClose=!1;R._focusContainer=!1;R._focusDockButton=
!1;R._focusFeatureMenuButton=!1;R._focusActionsMenuButton=!1;R._focusFirstFeature=!1;R._focusFirstAction=!1;R._handles=new m;R._pointerOffsetInPx=16;R._spinner=null;R._feature=null;R._featureMenuIntersectionObserverNode=null;R._featureMenuViewportNode=null;R._rootFlowItemNode=null;R._featureMenuIntersectionObserverCallback=([Q])=>{Q?.isIntersecting&&null!=R.viewModel.featurePage&&R.viewModel.featurePage++};R._featureMenuIntersectionObserver=new IntersectionObserver(R._featureMenuIntersectionObserverCallback,
{root:window.document});R._displaySpinnerThrottled=g.throttle(()=>R._displaySpinner(),0);R._exitRelatedRecordsActions=new WeakMap;R._featureSelectionActions=new WeakMap;R._flowItems=new n;R.alignment="auto";R.collapsed=!1;R.collapseEnabled=!0;R.dockEnabled=!1;R.featureMenuOpen=!1;R.headingLevel=2;R.maxInlineActions=3;R.messages=null;R.messagesCommon=null;R.spinnerEnabled=!0;R.viewModel=new u;R.visibleElements={...I};R._handleOpenRelatedFeature=Q=>{R._openRelatedFeature(Q)};R._addSelectedFeatureIndexHandle();
R.addHandles([e.watch(()=>R.viewModel?.screenLocation,()=>R._positionContainer()),e.watch(()=>[R.viewModel?.active,R.dockEnabled],()=>R._toggleScreenLocationEnabled()),e.watch(()=>R.viewModel?.screenLocation,(Q,V)=>{!!Q!==!!V&&R.reposition()}),e.watch(()=>[R.viewModel?.view?.padding,R.viewModel?.view?.size,R.viewModel?.active,R.viewModel?.location,R.alignment],()=>R.reposition()),e.watch(()=>R.spinnerEnabled,Q=>R._spinnerEnabledChange(Q)),e.watch(()=>R.viewModel?.view?.size,(Q,V)=>R._updateDockEnabledForViewSize(Q,
V)),e.watch(()=>R.viewModel?.view,(Q,V)=>R._viewChange(Q,V)),e.watch(()=>R.viewModel?.view?.ready,(Q,V)=>R._viewReadyChange(Q??!1,V??!1)),e.watch(()=>[R.viewModel?.waitingForResult,R.viewModel?.location],()=>{R._hideSpinner();R._displaySpinnerThrottled()}),e.watch(()=>R.selectedFeatureWidget,()=>R._destroyFlowItemWidgets()),e.watch(()=>[R.selectedFeatureWidget?.viewModel?.title,R.selectedFeatureWidget?.viewModel?.state],()=>R._setTitleFromFeatureWidget()),e.watch(()=>[R.selectedFeatureWidget?.viewModel?.content,
R.selectedFeatureWidget?.viewModel?.state],()=>R._setContentFromFeatureWidget()),e.when(()=>!R.collapsed,()=>{"xsmall"===R.viewModel?.view?.widthBreakpoint&&R.viewModel.active&&R.collapseEnabled&&R.viewModel.centerAtLocation()}),e.on(()=>R.viewModel?.allActions,"change",()=>R._watchActions()),e.watch(()=>R.viewModel?.allActions,()=>R._watchActions(),e.initial),e.watch(()=>R.viewModel?.featureViewModels,()=>R._featureMenuViewportScrollTop()),e.on(()=>R._flowItems,"change",()=>{R.notifyChange("_activeFlowItemWidget");
R.scheduleRender()}),e.watch(()=>[R._activeFlowItemWidget?.viewModel?.state,R._activeFlowItemWidget?.viewModel?.title],()=>R.scheduleRender())]);return R}c._inheritsLoose(H,G);var L=H.prototype;L.loadDependencies=function(){return Promise.all([new Promise((O,S)=>a(["../chunks/calcite-flow"],O,S)),new Promise((O,S)=>a(["../chunks/calcite-flow-item"],O,S)),new Promise((O,S)=>a(["../chunks/calcite-action"],O,S)),new Promise((O,S)=>a(["../chunks/calcite-tooltip"],O,S)),new Promise((O,S)=>a(["../chunks/calcite-icon"],
O,S))])};L.destroy=function(){this._destroyFlowItemWidgets();this._destroySelectedFeatureWidget();this._destroySpinner();this._handles?.destroy();this._unobserveFeatureMenuObserver();this._featureMenuIntersectionObserver?.disconnect()};L.castVisibleElements=function(O){return{...I,...O}};L.blur=function(){const {active:O}=this.viewModel;O||d.getLogger(this.declaredClass).warn("Popup can only be blurred when currently active.");this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=
!0;this.scheduleRender()};L.clear=function(){return this.viewModel.clear()};L.close=function(){this.visible=!1};L.fetchFeatures=function(O,S){return this.viewModel.fetchFeatures(O,S)};L.focus=function(){const {active:O}=this.viewModel;O||d.getLogger(this.declaredClass).warn("Popup can only be focused when currently active.");this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0;this.scheduleRender()};L.next=function(){return this.viewModel.next()};L.open=function(O){this._handles.remove("selected-index");
const S={collapsed:O?!!O.collapsed:!1,actionsMenuOpen:O?!!O.actionsMenuOpen:!1,featureMenuOpen:O?!!O.featureMenuOpen:!1};"xsmall"===this.viewModel?.view?.widthBreakpoint&&(S.collapsed=!0);this.set(S);this.viewModel.open(O);this._shouldFocus(O);this._addSelectedFeatureIndexHandle()};L.previous=function(){return this.viewModel.previous()};L.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};L.triggerAction=function(O){return this.viewModel.triggerAction(O)};
L.render=function(){const {actionsMenuOpen:O,dockEnabled:S,featureMenuVisible:R,dividedActions:Q,currentAlignment:V,currentDockPosition:aa}=this,{active:X}=this.viewModel,{menuActions:W}=Q,T=this.selectedFeature?.layer?.title,U=this.selectedFeature?.layer?.id;return E.tsx("div",{class:this.classes(x.CSS.base,{[x.CSS.alignTopCenter]:"top-center"===V,[x.CSS.alignBottomCenter]:"bottom-center"===V,[x.CSS.alignTopLeft]:"top-left"===V,[x.CSS.alignBottomLeft]:"bottom-left"===V,[x.CSS.alignTopRight]:"top-right"===
V,[x.CSS.alignBottomRight]:"bottom-right"===V,[x.CSS.isDocked]:X&&S,[x.CSS.shadow]:X&&!S,[x.CSS.isDockedTopLeft]:"top-left"===aa,[x.CSS.isDockedTopCenter]:"top-center"===aa,[x.CSS.isDockedTopRight]:"top-right"===aa,[x.CSS.isDockedBottomLeft]:"bottom-left"===aa,[x.CSS.isDockedBottomCenter]:"bottom-center"===aa,[x.CSS.isDockedBottomRight]:"bottom-right"===aa,[x.CSS.isFeatureMenuOpen]:R,[x.CSS.isActionsMenuOpen]:X&&1<W.length&&O}),role:"presentation","data-layer-title":T,"data-layer-id":U,bind:this,
afterCreate:this._positionContainer,afterUpdate:this._positionContainer},X?[this.renderMainContainer(),this.renderPointer()]:null)};L.renderLoadingIcon=function(){return E.tsx("span",{"aria-hidden":"true",class:this.classes(x.CSS.icon,x.CSS.iconLoading,x.CSS.rotating)})};L.renderNavigationLoading=function(){const {messagesCommon:O}=this;return this.viewModel.pendingPromisesCount?E.tsx("div",{key:N("loading-container"),role:"presentation",class:x.CSS.loadingContainer,"aria-label":O.loading,title:O.loading},
this.renderLoadingIcon()):null};L.renderPreviousIcon=function(){const O=K.isRTL(this.container);return E.tsx("span",{"aria-hidden":"true",class:this.classes(x.CSS.icon,{[x.CSS.iconRightTriangleArrow]:O,[x.CSS.paginationPreviousIconRTL]:O,[x.CSS.iconLeftTriangleArrow]:!O,[x.CSS.paginationPreviousIconLTR]:!O})})};L.renderPreviousButton=function(){const {messages:O}=this;return E.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes(x.CSS.button,
x.CSS.paginationPrevious),"aria-label":O.previous,title:O.previous},this.renderPreviousIcon())};L.renderNextIcon=function(){const O=K.isRTL(this.container);return E.tsx("span",{"aria-hidden":"true",class:this.classes(x.CSS.icon,{[x.CSS.iconLeftTriangleArrow]:O,[x.CSS.paginationNextIconRTL]:O,[x.CSS.iconRightTriangleArrow]:!O,[x.CSS.paginationNextIconLTR]:!O})})};L.renderNextButton=function(){const {messages:O}=this;return E.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,
class:this.classes(x.CSS.button,x.CSS.paginationNext),"aria-label":O.next,title:O.next},this.renderNextIcon())};L.renderFeatureMenuButton=function(){const {featureMenuOpen:O,featureMenuId:S,messagesCommon:R}=this,{featureCount:Q,selectedFeatureIndex:V}=this.viewModel;return E.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes(x.CSS.button,
x.CSS.featureMenuButton),"aria-haspopup":"true","aria-controls":S,"aria-expanded":O.toString(),"aria-label":R.menu,title:R.menu},this._getPageText(Q,V))};L.renderNavigationButtons=function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:[]};L.renderDockIcon=function(){const {dockEnabled:O}=this,S=this._wouldDockTo();return E.tsx("span",{"aria-hidden":"true",class:this.classes({[x.CSS.iconUndock]:O,
[x.CSS.iconDock]:!O,[x.CSS.iconDockToRight]:!O&&("top-right"===S||"bottom-right"===S),[x.CSS.iconDockToLeft]:!O&&("top-left"===S||"bottom-left"===S),[x.CSS.iconDockToTop]:!O&&"top-center"===S,[x.CSS.iconDockToBottom]:!O&&"bottom-center"===S},x.CSS.icon)})};L.renderDockButton=function(){const {dockEnabled:O,messages:S}=this,R=O?S.undock:S.dock;return"xsmall"!==this.viewModel?.view?.widthBreakpoint&&this.dockOptions?.buttonEnabled?E.tsx("div",{role:"button","aria-label":R,title:R,tabIndex:0,bind:this,
onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes(x.CSS.button,x.CSS.buttonDock)},this.renderDockIcon()):null};L.renderTitle=function(){const {title:O}=this.viewModel,{titleId:S,collapsible:R,contentCollapsed:Q,messagesCommon:V}=this;var aa={[x.CSS.headerContainerButton]:R};const X=E.tsx(y.Heading,{level:this.headingLevel,class:x.CSS.headerTitle,innerHTML:O??""});aa=R?E.tsx("button",{key:`${O}--collapsible`,
id:S,title:Q?V.expand:V.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(x.CSS.headerContainer,aa),"aria-expanded":Q?"false":"true",onclick:this._toggleCollapsed,type:"button"},X,E.tsx("calcite-icon",{class:x.CSS.collapseIcon,key:"collapse-icon",icon:Q?"chevron-down":"chevron-up",scale:"m"})):E.tsx("div",{key:O??"title",id:S,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes(x.CSS.headerContainer,aa)},X);return O?aa:null};L.renderCloseIcon=
function(){return E.tsx("span",{"aria-hidden":"true",class:this.classes(x.CSS.icon,x.CSS.iconClose)})};L.renderCloseButton=function(){const {visibleElements:O,messagesCommon:S}=this;return O.closeButton?E.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:x.CSS.button,"aria-label":S.close,title:S.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null};L.renderHeader=function(){return E.tsx("header",
{class:x.CSS.header},this.renderTitle(),E.tsx("div",{class:x.CSS.headerButtons},this.renderDockButton(),this.renderCloseButton()))};L.renderContentContainer=function(){const {contentId:O,hasContent:S,contentCollapsed:R,_flowItems:Q}=this,{content:V}=this.viewModel,aa=Q.toArray(),X={[x.CSS.contentHasFlows]:!!aa.length};return S&&!R?E.tsx("div",{key:V??"content",enterAnimation:this._createFeatureUpdatedAnimation(),id:O,class:this.classes(x.CSS.content,X)},E.tsx("calcite-flow",{bind:this},E.tsx("calcite-flow-item",
{bind:this,"data-node-ref":"_rootFlowItemNode",afterCreate:K.storeNode,key:"root-flow-item",onCalciteFlowItemBack:this._handleBackClick},this.renderContent()),aa.map(W=>this.renderFlowItem(W))),aa.map(W=>this.renderFlowItemTooltips(W))):null};L.renderFlowItem=function(O){const {messages:S}=this,R=J.isDarkTheme(),Q="graphic"in O&&!O.isTable;return E.tsx("calcite-flow-item",{bind:this,class:this.classes({[x.CSS.calciteThemeDark]:!R,[x.CSS.calciteThemeLight]:R}),heading:O.title??"",description:this._getFlowItemDescription(O),
onCalciteFlowItemBack:this._handleBackClick,key:`flow-item-${O.viewModel.uid}`},E.tsx("calcite-action",{class:x.CSS.actionExit,icon:"move-up",label:S?.exitRelatedRecords,text:S?.exitRelatedRecords,slot:"header-actions-start",bind:this,afterCreate:V=>this._storeExitRelatedRecordsAction(O,V),onclick:this._destroyFlowItemWidgets}),Q?E.tsx("calcite-action",{class:x.CSS.actionSelectFeature,icon:"zoom-to-object",label:S?.selectFeature,text:S?.selectFeature,slot:"header-actions-end",bind:this,afterCreate:V=>
this._storeFeatureSelectionAction(O,V),onclick:()=>this._handleOpenRelatedFeature(O)}):null,E.tsx("div",{class:this.classes(x.CSS.contentFlowItem,{[x.CSS.calciteThemeDark]:R,[x.CSS.calciteThemeLight]:!R})},O.render()))};L.renderFlowItemTooltips=function(O){const {messages:S,_exitRelatedRecordsActions:R,_featureSelectionActions:Q}=this,V=J.isDarkTheme(),aa=Q.get(O);return[E.tsx("calcite-tooltip",{class:this.classes({[x.CSS.calciteThemeDark]:!V,[x.CSS.calciteThemeLight]:V}),key:`exit-related-records-tooltip-${O.viewModel.uid}`,
label:S?.exitRelatedRecords,overlayPositioning:"fixed",referenceElement:R.get(O),placement:"top"},S?.exitRelatedRecords),aa?E.tsx("calcite-tooltip",{class:this.classes({[x.CSS.calciteThemeDark]:!V,[x.CSS.calciteThemeLight]:V}),key:`select-related-record-tooltip-${O.viewModel.uid}`,label:S?.selectFeature,overlayPositioning:"fixed",referenceElement:aa,placement:"top"},S?.selectFeature):null]};L.renderActionsMenuButton=function(){const {actionsMenuId:O,actionsMenuButtonId:S,actionsMenuOpen:R,dividedActions:Q,
messagesCommon:V}=this,aa=R?V.close:V.open,{menuActions:X}=Q;return X.length?E.tsx("div",{key:N("actions-menu-button"),class:this.classes(x.CSS.button,x.CSS.actionsMenuButton),role:"button",id:S,"aria-haspopup":"true","aria-controls":R?O:null,tabIndex:0,bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":aa,title:aa},E.tsx("span",{"aria-hidden":"true",class:x.CSS.iconActionsMenu})):
null};L.renderMenuActions=function(){const {actionsMenuId:O,actionsMenuButtonId:S,actionsMenuOpen:R,dividedActions:Q}=this,{menuActions:V}=Q;return V.length&&R?E.tsx("ul",{id:O,role:"menu","aria-labelledby":S,key:N("actions"),class:x.CSS.actions,bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},V.toArray().map(aa=>this.renderAction({action:aa,type:"menu-item"}))):null};L.renderInlineActions=function(){const {inlineActions:O}=
this.dividedActions;return O.length?O.toArray().map(S=>this.renderAction({action:S,type:"inline"})):[]};L.renderInlineActionsContainer=function(){const {inlineActions:O,menuActions:S}=this.dividedActions,R=!!O.length,Q=!!S.length;return R||Q?E.tsx("div",{key:"inline-actions-container","data-inline-actions":R.toString(),"data-menu-actions":Q.toString(),class:x.CSS.inlineActionsContainer},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null};L.renderNavigation=function(){return this.featureNavigationVisible?
E.tsx("section",{key:N("navigation"),class:this.classes(x.CSS.navigation)},this.renderNavigationButtons()):null};L.renderFooter=function(){const {featureNavigationVisible:O,dividedActions:S}=this,{inlineActions:R,menuActions:Q}=S,V=!!R.length,aa={[x.CSS.footerHasPagination]:O,[x.CSS.footerHasActions]:V,[x.CSS.footerHasActionsMenu]:!!Q.length};return O||V?E.tsx("div",{key:N("feature-buttons"),class:this.classes(x.CSS.footer,aa)},this.renderInlineActionsContainer(),this.renderNavigation()):null};L.renderFeatureMenuContainer=
function(){var {messages:O}=this;const {featureViewModels:S,isLoadingFeature:R}=this.viewModel;O=M.substitute(O.selectedFeatures,{total:S.length});return E.tsx("section",{key:N("menu"),class:x.CSS.featureMenu},E.tsx("strong",{class:x.CSS.featureMenuHeader},O),E.tsx("nav",{bind:this,class:x.CSS.featureMenuViewport,"data-node-ref":"_featureMenuViewportNode",afterCreate:K.storeNode},this.renderFeatureMenu(),E.tsx("div",{class:x.CSS.featureMenuObserver,bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),
R?E.tsx("div",{class:x.CSS.featureMenuLoader},this.renderLoadingIcon()):null))};L.renderPointer=function(){return this.dockEnabled?null:E.tsx("div",{key:N("pointer"),class:x.CSS.pointer,role:"presentation"},E.tsx("div",{class:this.classes(x.CSS.pointerDirection,x.CSS.shadow)}))};L.renderMainContainer=function(){const {dockEnabled:O,currentAlignment:S,currentDockPosition:R,titleId:Q,contentId:V,collapsible:aa,hasContent:X,contentCollapsed:W,visibleElements:T}=this,{title:U}=this.viewModel,Y="bottom-left"===
S||"bottom-center"===S||"bottom-right"===S||"top-left"===R||"top-center"===R||"top-right"===R,ba="top-left"===S||"top-center"===S||"top-right"===S||"bottom-left"===R||"bottom-center"===R||"bottom-right"===R;return E.tsx("div",{class:this.classes(x.CSS.main,x.CSS.widget,{[x.CSS.shadow]:O,[x.CSS.isCollapsible]:aa,[x.CSS.isCollapsed]:W}),tabIndex:T.closeButton?void 0:-1,role:"dialog","aria-labelledby":U?Q:"","aria-describedby":X&&!W?V:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,
afterUpdate:this._mainContainerNodeUpdated},Y?this.renderFooter():null,Y?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),ba?this.renderFooter():null,ba?this.renderFeatureMenuContainer():null)};L.renderContent=function(){const O=this.viewModel?.content;return O?"string"===typeof O?E.tsx("div",{class:C.CSS.contentNode,key:O,innerHTML:O}):this.renderNodeContent(O):null};L.renderActionText=function(O){return E.tsx("span",{key:"text",class:x.CSS.actionText},O)};
L.renderActionIcon=function(O){const S=this._getActionClass(O),R=this._getActionImage(O),Q={[x.CSS.iconLoading]:O.active,[x.CSS.rotating]:O.active,[x.CSS.icon]:!!S,[x.CSS.actionImage]:!O.active&&!!R};S&&(Q[S]=!O.active);return E.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes(x.CSS.icon,Q),styles:this._getIconStyles(R)})};L.renderAction=function(O){const {action:S,type:R}=O;O=this._getActionTitle(S);const Q={[x.CSS.action]:"toggle"!==S.type,[x.CSS.actionToggle]:"toggle"===S.type,[x.CSS.actionToggleOn]:"toggle"===
S.type&&S.value,[x.CSS.buttonDisabled]:S.disabled},V=[this.renderActionIcon(S),this.renderActionText(O)];O="menu-item"===R?E.tsx("li",{key:S.uid,role:"menuitem",tabIndex:0,title:O,"aria-label":O,class:this.classes(x.CSS.button,Q),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":S.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},V):E.tsx("div",{key:S.uid,role:"button",tabIndex:0,title:O,"aria-label":O,class:this.classes(x.CSS.button,Q),onkeyup:this._handleActionMenuItemKeyup,
bind:this,"data-action-uid":S.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},V);return S.visible?O:null};L.renderFeatureMenuItem=function(O,S){const {messages:R,messagesCommon:Q}=this,{selectedFeatureIndex:V,selectedFeatureViewModel:aa}=this.viewModel;var X=O===aa;const W={[x.CSS.featureMenuSelected]:X};X=X?E.tsx("span",{key:N(`feature-menu-selected-feature-${V}`),title:R.selectedFeature,"aria-label":R.selectedFeature,class:x.CSS.iconCheckMark}):null;O=E.tsx("span",{innerHTML:O.title||
Q.untitled});return E.tsx("li",{role:"menuitem",tabIndex:-1,key:N(`feature-menu-feature-${V}`),class:this.classes(W,x.CSS.featureMenuItem),bind:this,"data-feature-index":S,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,onmouseleave:this._removeActiveFeature},E.tsx("span",{class:x.CSS.featureMenuTitle},O,X))};L.renderFeatureMenu=function(){const {featureMenuId:O}=
this,{featureViewModels:S}=this.viewModel;return 1<S.length?E.tsx("ol",{class:x.CSS.featureMenuList,id:O,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},S.filter(R=>!!R.graphic).map((R,Q)=>this.renderFeatureMenuItem(R,Q))):null};L._storeFeatureSelectionAction=function(O,S){this._featureSelectionActions.set(O,S);this.scheduleRender()};L._storeExitRelatedRecordsAction=function(O,S){this._exitRelatedRecordsActions.set(O,
S);this.scheduleRender()};L._getFlowItemDescription=function(O){return"featureCountDescription"in O?O.featureCountDescription:O.viewModel.description??""};L._openRelatedFeature=function(){var O=c._asyncToGenerator(function*(S){yield S.viewModel.updateGeometry();S=S.graphic;var R=S?.geometry;f.isNone(R)||f.isNone(S)||(this._destroyFlowItemWidgets(),yield this.viewModel.zoomTo({target:R}),R=A.getPointFromGeometry(R),this.open({features:[S],location:f.isSome(R)?R:void 0}))});return function(S){return O.apply(this,
arguments)}}();L._destroyFlowItemWidgets=function(){this._flowItems.removeAll().forEach(O=>{"showAllEnabled"in O.viewModel&&(O.viewModel.showAllEnabled=!1);O.viewModel=null;O.destroy()})};L._handleBackClick=function(){const O=this._flowItems.pop();O&&(this._exitRelatedRecordsActions.delete(O),this._featureSelectionActions.delete(O),"showAllEnabled"in O.viewModel&&(O.viewModel.showAllEnabled=!1),O&&(O.viewModel=null,O.destroy()))};L._getActionTitle=function(O){const {messages:S,selectedFeature:R,messagesCommon:Q}=
this,{id:V}=O,aa=R?.attributes,X=O.title??"";return(O="zoom-to-feature"===V?M.substitute(X,{messages:S}):"remove-selected-feature"===V?M.substitute(X,{messages:Q}):"zoom-to-clustered-features"===V?M.substitute(X,{messages:S}):"browse-clustered-features"===V?M.substitute(X,{messages:S}):O.title)&&aa?M.substitute(O,aa):O??""};L._getActionClass=function(O){var {selectedFeature:S}=this;S=S?.attributes;const {className:R,image:Q}=O;return(O=Q||R?R:x.CSS.iconDefaultAction)&&S?M.substitute(O,S):O??""};L._getActionImage=
function(O){var {selectedFeature:S}=this;S=S?.attributes;({image:O}=O);return O&&S?M.substitute(O,S):O??""};L._createFeatureUpdatedAnimation=function(){return K.cssTransition("enter",x.CSS.hasFeatureUpdated)};L._getInlineActionCount=function(){const {maxInlineActions:O,featureNavigationVisible:S}=this;if("number"!==typeof O)return null;const R=Math.round(O);return Math.max(S?R-1:R,0)};L._watchActions=function(){const {allActions:O}=this.viewModel;this.notifyChange("dividedActions");this._handles.remove("actions");
O&&O.forEach(S=>{this._handles.add(e.watch(()=>[S.uid,S.active,S.className,S.disabled,S.id,S.title,S.image,S.visible],()=>this.scheduleRender()),"actions")})};L._divideActions=function(){var {allActions:O}=this.viewModel;O=O.filter(V=>V.visible);const S=this._getInlineActionCount(),R=null===S,Q=0===S;return{inlineActions:R?O.slice(0):Q?new n:O.slice(0,S),menuActions:R?new n:Q?O.slice(0):O.slice(S)}};L._featureMenuOpenChanged=function(O){O?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};
L._actionsMenuOpenChanged=function(O){O?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};L._setTitleFromFeatureWidget=function(){const {selectedFeatureWidget:O,messagesCommon:S}=this;O&&(this.viewModel.title="error"===O.viewModel?.state?S.errorMessage:O.viewModel?.title||"")};L._setContentFromFeatureWidget=function(){const {selectedFeatureWidget:O}=this;O&&(this.viewModel.content=O)};L._unobserveFeatureMenuObserver=function(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)};
L._featureMenuIntersectionObserverCreated=function(O){this._unobserveFeatureMenuObserver();this._featureMenuIntersectionObserver.observe(O);this._featureMenuIntersectionObserverNode=O};L._handleFeatureMenuKeyup=function(O){"Escape"===r.eventKey(O)&&(O.stopPropagation(),this._focusFeatureMenuButton=!0,this.featureMenuOpen=!1,this.scheduleRender())};L._handleActionMenuKeyup=function(O){"Escape"===r.eventKey(O)&&(O.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};
L._setActiveFeature=function(O){const {viewModel:S}=this;S.activeFeature=S.features[O.currentTarget["data-feature-index"]]||null};L._removeActiveFeature=function(){this.viewModel.activeFeature=null};L._handleFeatureMenuItemKeyup=function(O){const S=r.eventKey(O);var {_featureMenuNode:R}=this;const Q=O.currentTarget["data-feature-index"];if(R){R=R.querySelectorAll("li");var V=R.length;"ArrowUp"===S?(O.stopPropagation(),R[(Q-1+V)%V].focus()):"ArrowDown"===S?(O.stopPropagation(),R[(Q+1+V)%V].focus()):
"Home"===S?(O.stopPropagation(),R[0].focus()):"End"===S&&(O.stopPropagation(),R[R.length-1].focus())}};L._handleActionMenuItemKeyup=function(O){const S=r.eventKey(O);var {_actionsMenuNode:R}=this;const Q=O.currentTarget.dataset.actionUid;var {menuActions:V}=this.dividedActions;V=V.findIndex(X=>X.uid===Q);if(R){R=R.querySelectorAll("li");var aa=R.length;"ArrowUp"===S?(O.stopPropagation(),R[(V-1+aa)%aa].focus()):"ArrowDown"===S?(O.stopPropagation(),R[(V+1+aa)%aa].focus()):"Home"===S?(O.stopPropagation(),
R[0].focus()):"End"===S&&(O.stopPropagation(),R[R.length-1].focus())}};L._handleMainKeyup=function(O){const S=r.eventKey(O);"ArrowLeft"===S&&(O.stopPropagation(),this.previous());"ArrowRight"===S&&(O.stopPropagation(),this.next())};L._spinnerEnabledChange=function(O){this._destroySpinner();O&&(O=this.get("viewModel.view"),this._createSpinner(O))};L._hideSpinner=function(){const {_spinner:O}=this;O&&(O.location=null,O.hide())};L._displaySpinner=function(){const {_spinner:O}=this;if(O){var {location:S,
waitingForResult:R}=this.viewModel;R&&S?O.show({location:S}):O.hide()}};L._getIconStyles=function(O){return{"background-image":O?`url(${O})`:""}};L._shouldFocus=function(){var O=c._asyncToGenerator(function*(S){S?.shouldFocus&&(yield e.whenOnce(()=>!0===this.viewModel?.active),this.focus())});return function(S){return O.apply(this,arguments)}}();L._addSelectedFeatureIndexHandle=function(){const O=e.watch(()=>this.viewModel?.selectedFeatureIndex,(S,R)=>this._selectedFeatureIndexUpdated(S,R));this._handles.add(O,
"selected-index")};L._selectedFeatureIndexUpdated=function(O,S){const {featureCount:R}=this;R&&O!==S&&-1!==O&&(this._destroyFlowItemWidgets(),this.featureMenuOpen=this.actionsMenuOpen=!1,this._mainContainerNode&&(this._mainContainerNode.scrollTop=0),this._rootFlowItemNode&&this._rootFlowItemNode.scrollContentTo({top:0}))};L._destroySelectedFeatureWidget=function(){const {_feature:O}=this;O&&(O.viewModel=null,O&&!O.destroyed&&O.destroy());this._feature=null};L._isScreenLocationWithinView=function(O,
S){return-1<O.x&&-1<O.y&&O.x<=S.width&&O.y<=S.height};L._isOutsideView=function(O){const {popupHeight:S,popupWidth:R,screenLocation:Q,side:V,view:aa}=O;if(isNaN(R)||isNaN(S)||!aa||!Q)return!1;O=aa.padding;return"right"===V&&Q.x+R/2>aa.width-O.right||"left"===V&&Q.x-R/2<O.left||"top"===V&&Q.y-S<O.top||"bottom"===V&&Q.y+S>aa.height-O.bottom?!0:!1};L._calculateAutoAlignment=function(O){if("auto"!==O)return O;const {_pointerOffsetInPx:S,_containerNode:R,_mainContainerNode:Q,viewModel:V}=this,{screenLocation:aa,
view:X}=V;if(f.isNone(aa)||!X||!R)return"top-center";if(!this._isScreenLocationWithinView(aa,X))return this._get("currentAlignment")||"top-center";var W=(O=Q?window.getComputedStyle(Q,null):null)?parseInt(O.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,T=O?parseInt(O.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0;const {height:U,width:Y}=R.getBoundingClientRect();O=Y+S;const ba=Math.max(U,W,T)+S;W=this._isOutsideView({popupHeight:ba,popupWidth:O,screenLocation:aa,side:"right",
view:X});T=this._isOutsideView({popupHeight:ba,popupWidth:O,screenLocation:aa,side:"left",view:X});const da=this._isOutsideView({popupHeight:ba,popupWidth:O,screenLocation:aa,side:"top",view:X});O=this._isOutsideView({popupHeight:ba,popupWidth:O,screenLocation:aa,side:"bottom",view:X});return T?da?"bottom-right":"top-right":W?da?"bottom-left":"top-left":da?O?"top-center":"bottom-center":"top-center"};L._callCurrentAlignment=function(O){return"function"===typeof O?O.call(this):O};L._getCurrentAlignment=
function(){const {alignment:O,dockEnabled:S}=this;return S||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(O)))};L._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};L._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};L._calculatePositionResult=function(O){const S=["left","right"];K.isRTL(this.container)&&S.reverse();return O.replace(/leading/gi,
S[0]).replace(/trailing/gi,S[1])};L._callDockPosition=function(O){return"function"===typeof O?O.call(this):O};L._getDockPosition=function(){return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(this.dockOptions?.position)))};L._getCurrentDockPosition=function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null};L._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};L._calculateAutoDockPosition=function(O){if("auto"!==
O)return O;var S=this.viewModel?.view;O=K.isRTL(this.container)?"top-left":"top-right";if(!S)return O;var R=S.padding||{left:0,right:0,top:0,bottom:0};R=S.width-R.left-R.right;({breakpoints:S}=S);return S&&R<=S.xsmall?"bottom-center":O};L._positionContainer=function(O=this._containerNode){O&&(this._containerNode=O);if(this._containerNode){({screenLocation:O}=this.viewModel);var {width:S}=this._containerNode.getBoundingClientRect();(O=this._calculatePositionStyle(O,S))&&Object.assign(this._containerNode.style,
O)}};L._calculateFullWidth=function(O){const {currentAlignment:S,_pointerOffsetInPx:R}=this;return"top-left"===S||"bottom-left"===S||"top-right"===S||"bottom-right"===S?O+R:O};L._calculateAlignmentPosition=function(O,S,R,Q){const {currentAlignment:V,_pointerOffsetInPx:aa}=this;if(R){var {padding:X}=R;Q/=2;var W=R.height-S;R=R.width-O;if("bottom-center"===V)return{top:S+aa-X.top,left:O-Q-X.left};if("top-left"===V)return{bottom:W+aa-X.bottom,right:R+aa-X.right};if("bottom-left"===V)return{top:S+aa-
X.top,right:R+aa-X.right};if("top-right"===V)return{bottom:W+aa-X.bottom,left:O+aa-X.left};if("bottom-right"===V)return{top:S+aa-X.top,left:O+aa-X.left};if("top-center"===V)return{bottom:W+aa-X.bottom,left:O-Q-X.left}}};L._calculatePositionStyle=function(O,S){const {dockEnabled:R,view:Q}=this;if(Q){if(R)return{left:"",top:"",right:"",bottom:""};if(!f.isNone(O)&&S&&(S=this._calculateFullWidth(S),O=this._calculateAlignmentPosition(O.x,O.y,Q,S)))return{top:void 0!==O.top?`${O.top}px`:"auto",left:void 0!==
O.left?`${O.left}px`:"auto",bottom:void 0!==O.bottom?`${O.bottom}px`:"auto",right:void 0!==O.right?`${O.right}px`:"auto"}}};L._viewChange=function(O,S){O&&S&&(this.close(),this.clear())};L._viewReadyChange=function(O,S){O?(O=this.get("viewModel.view"),this._wireUpView(O)):S&&(this.close(),this.clear())};L._wireUpView=function(O){this._destroySpinner();if(O){var {spinnerEnabled:S}=this;S&&this._createSpinner(O);this._setDockEnabledForViewSize(this.dockOptions)}};L._dockingThresholdCrossed=function(O,
S,R){const [Q,V]=O,[aa,X]=S,{width:W=0,height:T=0}=R??{};return Q<=W&&aa>W||Q>W&&aa<=W||V<=T&&X>T||V>T&&X<=T};L._updateDockEnabledForViewSize=function(O,S){if(O&&S){var R=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},Q=R.left+R.right,V=R.top+R.bottom;R=[];var aa=[];R[0]=O[0]-Q;R[1]=O[1]-V;aa[0]=S[0]-Q;aa[1]=S[1]-V;({dockOptions:O}=this);this._dockingThresholdCrossed(R,aa,O.breakpoint)&&this._setDockEnabledForViewSize(O);this._setCurrentDockPosition()}};L._focusDockButtonNode=
function(O){this._focusDockButton&&(this._focusDockButton=!1,O.focus())};L._closeButtonNodeUpdated=function(O){this._focusClose?(this._focusClose=!1,O.focus()):this._blurClose&&(this._blurClose=!1,O.blur())};L._mainContainerNodeUpdated=function(O){this._mainContainerNode=O;this._focusContainer?(this._focusContainer=!1,O.focus()):this._blurContainer&&(this._blurContainer=!1,O.blur())};L._featureMenuNodeUpdated=function(O){(this._featureMenuNode=O)&&this._focusFirstFeature&&(this._focusFirstFeature=
!1,O=O.querySelectorAll("li"),O.length&&O[0].focus())};L._actionsMenuNodeUpdated=function(O){(this._actionsMenuNode=O)&&this._focusFirstAction&&(this._focusFirstAction=!1,O=O.querySelectorAll("li"),O.length&&O[0].focus())};L._focusFeatureMenuButtonNode=function(O){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,O.focus())};L._focusActionsMenuButtonNode=function(O){this._focusActionsMenuButton&&(this._focusActionsMenuButton=!1,O.focus())};L._featureMenuViewportScrollTop=function(){this._featureMenuViewportNode&&
(this._featureMenuViewportNode.scrollTop=0)};L._toggleScreenLocationEnabled=function(){const {dockEnabled:O,viewModel:S}=this;S&&(S.screenLocationEnabled=S.active&&!O)};L._shouldDockAtCurrentViewSize=function(O){O=O.breakpoint;var S=this.viewModel?.view?.ui;if(!S)return!1;const {width:R,height:Q}=S;if(isNaN(R)||isNaN(Q)||!O)return!1;S=O.hasOwnProperty("width")&&R<=(O.width??0);O=O.hasOwnProperty("height")&&Q<=(O.height??0);return S||O};L._setDockEnabledForViewSize=function(O){O.breakpoint&&(this.dockEnabled=
this._shouldDockAtCurrentViewSize(O))};L._getPageText=function(O,S){return this.featureNavigationVisible?M.substitute(this.messages.pageText,{index:S+1,total:O}):null};L._destroySpinner=function(){const {_spinner:O,view:S}=this;O&&(S&&S.ui&&S.ui.remove(O,"popup-spinner"),O.destroy(),this._spinner=null)};L._createSpinner=function(O){O&&(this._spinner=new p({view:O}),O.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};L._toggleCollapsed=function(){this.collapsed=!this.collapsed};L._close=
function(){this.close();this.view&&this.view.focus()};L._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};L._toggleFeatureMenu=function(){const O=!this.featureMenuOpen;this._featureMenuOpenChanged(O);this.actionsMenuOpen=!1;this.featureMenuOpen=O};L._toggleActionsMenu=function(){const O=!this.actionsMenuOpen;this._actionsMenuOpenChanged(O);this.featureMenuOpen=!1;this.actionsMenuOpen=O};L._triggerAction=function(O){const S=O.currentTarget.dataset.actionUid;
var {allActions:R}=this.viewModel;O=R.findIndex(Q=>Q.uid===S);(R=R.getItemAt(O))&&"toggle"===R.type&&(R.value=!R.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(O)};L._selectFeature=function(O){O=O.currentTarget["data-feature-index"];isNaN(O)||(this.viewModel.selectedFeatureIndex=O);this.featureMenuOpen=!1;this._focusFeatureMenuButton=!0;this.scheduleRender()};L._next=function(){this.next()};L._previous=function(){this.previous()};c._createClass(H,[{key:"actionsMenuId",get:function(){return`${this.id}-actions-menu`}},
{key:"actionsMenuButtonId",get:function(){return`${this.id}-actions-menu-button`}},{key:"featureMenuId",get:function(){return`${this.id}-feature-menu`}},{key:"titleId",get:function(){return`${this.id}-popup-title`}},{key:"contentId",get:function(){return`${this.id}-popup-content`}},{key:"hasContent",get:function(){const {selectedFeatureWidget:O,viewModel:S}=this;if(!O)return!!S?.content;var R=O.viewModel;if(R?.waitingForContent||"error"===R?.state)return!0;R=R?.content;return Array.isArray(R)?!!R.length:
!!R}},{key:"featureNavigationVisible",get:function(){return this.viewModel.active&&1<this.viewModel.featureCount&&null!=this.visibleElements.featureNavigation}},{key:"collapsible",get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},
{key:"_activeFlowItemWidget",get:function(){const {_flowItems:O}=this;return O.getItemAt(O.length-1)||null}},{key:"actions",get:function(){return this.viewModel.actions},set:function(O){this.viewModel.actions=O}},{key:"actionsMenuOpen",get:function(){return this.viewModel.active?this._get("actionsMenuOpen"):!1},set:function(O){this._set("actionsMenuOpen",!!O)}},{key:"autoCloseEnabled",get:function(){return this.viewModel.autoCloseEnabled},set:function(O){this.viewModel.autoCloseEnabled=O}},{key:"autoOpenEnabled",
get:function(){return this.viewModel.autoOpenEnabled},set:function(O){this.viewModel.autoOpenEnabled=O}},{key:"defaultPopupTemplateEnabled",get:function(){return this.viewModel.defaultPopupTemplateEnabled},set:function(O){this.viewModel.defaultPopupTemplateEnabled=O}},{key:"content",get:function(){return this.viewModel.content},set:function(O){this.viewModel.content=O}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},
{key:"dockOptions",get:function(){return this._get("dockOptions")||P},set:function(O){var S={...P};const R=this.viewModel?.view?.breakpoints;var Q={};R&&(Q.width=R.xsmall,Q.height=R.xsmall);O={...S,...O};S={...S.breakpoint,...Q};({breakpoint:Q}=O);"object"===typeof Q?O.breakpoint={...S,...Q}:Q&&(O.breakpoint=S);this._set("dockOptions",O);this._setCurrentDockPosition();this.reposition()}},{key:"featureCount",get:function(){return this.viewModel.featureCount}},{key:"features",get:function(){return this.viewModel.features},
set:function(O){this.viewModel.features=O}},{key:"goToOverride",get:function(){return this.viewModel.goToOverride},set:function(O){this.viewModel.goToOverride=O}},{key:"highlightEnabled",get:function(){return this.viewModel.highlightEnabled},set:function(O){this.viewModel.highlightEnabled=O}},{key:"location",get:function(){return this.viewModel.location},set:function(O){this.viewModel.location=O}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(O){this._overrideIfSome("label",
O)}},{key:"promises",get:function(){return this.viewModel.promises},set:function(O){this.viewModel.promises=O}},{key:"selectedFeature",get:function(){return this.viewModel.selectedFeature}},{key:"selectedFeatureIndex",get:function(){return this.viewModel.selectedFeatureIndex},set:function(O){this.viewModel.selectedFeatureIndex=O}},{key:"selectedFeatureWidget",get:function(){const {_feature:O,visibleElements:S,headingLevel:R,_flowItems:Q}=this,{selectedFeatureViewModel:V}=this.viewModel,aa={...S,title:!1};
if(!V)return null;O?(O.viewModel=V,O.visibleElements=aa):this._feature=new k({flowItems:Q,headingLevel:R+1,viewModel:V,visibleElements:aa});return this._feature}},{key:"title",get:function(){return this.viewModel.title},set:function(O){this.viewModel.title=O}},{key:"updateLocationEnabled",get:function(){return this.viewModel.updateLocationEnabled},set:function(O){this.viewModel.updateLocationEnabled=O}},{key:"view",get:function(){return this.viewModel.view},set:function(O){this.viewModel.view=O}},
{key:"visible",get:function(){return this.viewModel.visible},set:function(O){this.viewModel.visible=O}}]);return H}(B.FeatureContentMixin(z));b.__decorate([h.property({readOnly:!0})],t.prototype,"actionsMenuId",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"actionsMenuButtonId",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"featureMenuId",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"titleId",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"contentId",
null);b.__decorate([h.property({readOnly:!0})],t.prototype,"hasContent",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"featureNavigationVisible",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"collapsible",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"featureMenuVisible",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"contentCollapsed",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"dividedActions",null);b.__decorate([h.property({readOnly:!0,
dependsOn:["_flowItems.length"]})],t.prototype,"_activeFlowItemWidget",null);b.__decorate([h.property()],t.prototype,"actions",null);b.__decorate([h.property()],t.prototype,"actionsMenuOpen",null);b.__decorate([h.property()],t.prototype,"alignment",void 0);b.__decorate([h.property()],t.prototype,"autoCloseEnabled",null);b.__decorate([h.property()],t.prototype,"autoOpenEnabled",null);b.__decorate([h.property()],t.prototype,"defaultPopupTemplateEnabled",null);b.__decorate([h.property()],t.prototype,
"content",null);b.__decorate([h.property()],t.prototype,"collapsed",void 0);b.__decorate([h.property()],t.prototype,"collapseEnabled",void 0);b.__decorate([h.property({readOnly:!0})],t.prototype,"currentAlignment",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"currentDockPosition",null);b.__decorate([h.property()],t.prototype,"dockOptions",null);b.__decorate([h.property()],t.prototype,"dockEnabled",void 0);b.__decorate([h.property({readOnly:!0})],t.prototype,"featureCount",null);b.__decorate([h.property()],
t.prototype,"featureMenuOpen",void 0);b.__decorate([h.property()],t.prototype,"features",null);b.__decorate([h.property()],t.prototype,"goToOverride",null);b.__decorate([h.property()],t.prototype,"headingLevel",void 0);b.__decorate([h.property()],t.prototype,"highlightEnabled",null);b.__decorate([h.property()],t.prototype,"location",null);b.__decorate([h.property()],t.prototype,"label",null);b.__decorate([h.property()],t.prototype,"maxInlineActions",void 0);b.__decorate([h.property(),D.messageBundle("esri/widgets/Popup/t9n/Popup")],
t.prototype,"messages",void 0);b.__decorate([h.property(),D.messageBundle("esri/t9n/common")],t.prototype,"messagesCommon",void 0);b.__decorate([h.property()],t.prototype,"promises",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"selectedFeature",null);b.__decorate([h.property()],t.prototype,"selectedFeatureIndex",null);b.__decorate([h.property({readOnly:!0})],t.prototype,"selectedFeatureWidget",null);b.__decorate([h.property()],t.prototype,"spinnerEnabled",void 0);b.__decorate([h.property()],
t.prototype,"title",null);b.__decorate([h.property()],t.prototype,"updateLocationEnabled",null);b.__decorate([h.property()],t.prototype,"view",null);b.__decorate([h.property({type:u}),F.vmEvent(["triggerAction","trigger-action"])],t.prototype,"viewModel",void 0);b.__decorate([h.property()],t.prototype,"visible",null);b.__decorate([h.property()],t.prototype,"visibleElements",void 0);b.__decorate([l.cast("visibleElements")],t.prototype,"castVisibleElements",null);b.__decorate([w.accessibleHandler()],
t.prototype,"_close",null);b.__decorate([w.accessibleHandler()],t.prototype,"_toggleDockEnabled",null);b.__decorate([w.accessibleHandler()],t.prototype,"_toggleFeatureMenu",null);b.__decorate([w.accessibleHandler()],t.prototype,"_toggleActionsMenu",null);b.__decorate([w.accessibleHandler()],t.prototype,"_triggerAction",null);b.__decorate([w.accessibleHandler()],t.prototype,"_selectFeature",null);b.__decorate([w.accessibleHandler()],t.prototype,"_next",null);b.__decorate([w.accessibleHandler()],t.prototype,
"_previous",null);return t=b.__decorate([q.subclass("esri.widgets.Popup")],t)})},"esri/core/throttle":function(){define(["exports"],function(a){a.throttle=function(c,b,t,n){let r=null,m=1E3;"number"===typeof b?(m=b,n=t):(r=b??null,m=t);let d=0,f;const e=()=>{d=0;c.apply(n,f)};b=(...g)=>{r&&r.apply(n,g);f=g;m?d||(d=setTimeout(e,m)):e()};b.remove=()=>{d&&(clearTimeout(d),d=0)};b.forceUpdate=()=>{d&&(clearTimeout(d),e())};b.hasPendingUpdates=()=>!!d;return b};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/widgets/Feature":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./Widget ./Feature/FeatureAttachments ./Feature/FeatureContent ./Feature/FeatureExpression ./Feature/FeatureFields ./Feature/FeatureMedia ./Feature/FeatureRelationship ./Feature/FeatureViewModel ./Feature/resources ./Feature/support/FeatureContentMixin ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y){var w;const D={title:!0,content:!0,lastEditedInfo:!0};t=w=function(F){function E(J,M){J=F.call(this,J,M)||this;J._contentWidgets=[];J.flowItems=null;J.headingLevel=2;J.messages=null;J.messagesCommon=null;J.messagesURIUtils=null;J.visibleElements={...D};J.viewModel=new p;return J}c._inheritsLoose(E,F);var K=E.prototype;K.initialize=function(){this.addHandles(n.watch(()=>this.viewModel?.contentViewModels,()=>this._setupContentWidgets(),n.initial))};
K.loadDependencies=function(){return new Promise((J,M)=>a(["../chunks/calcite-notice"],J,M))};K.destroy=function(){this._destroyContentWidgets()};K.castVisibleElements=function(J){return{...D,...J}};K.render=function(){var {state:J}=this.viewModel;J=u.tsx("div",{class:z.CSS.container,key:"container"},this.renderTitle(),"error"===J?this.renderError():"loading"===J?this.renderLoading():this.renderContentContainer());return u.tsx("div",{class:this.classes(z.CSS.base,z.CSS.esriWidget)},J)};K.setActiveMedia=
function(J,M){return this.viewModel.setActiveMedia(J,M)};K.nextMedia=function(J){return this.viewModel.nextMedia(J)};K.previousMedia=function(J){return this.viewModel.previousMedia(J)};K.renderError=function(){const {messagesCommon:J,messages:M,visibleElements:N}=this;return u.tsx("calcite-notice",{open:!0,kind:"danger",icon:"exclamation-mark-circle",scale:"s"},N.title?u.tsx("div",{key:"error-title",slot:"title"},J.errorMessage):null,u.tsx("div",{key:"error-message",slot:"message"},M.loadingError))};
K.renderLoading=function(){return u.tsx("div",{key:"loading-container",class:z.CSS.loadingSpinnerContainer},u.tsx("span",{class:this.classes(z.CSS.iconLoading,z.CSS.spinner)}))};K.renderContentContainer=function(){const {visibleElements:J}=this;return J.content?u.tsx("div",{class:z.CSS.main},[this.renderContent(),this.renderLastEditInfo()]):null};K.renderTitle=function(){const {visibleElements:J,title:M}=this;return J.title?u.tsx(B.Heading,{level:this.headingLevel,class:z.CSS.title,innerHTML:M}):
null};K.renderContent=function(){var J=this.viewModel.content;return J?Array.isArray(J)?J.length?u.tsx("div",{class:z.CSS.contentNode,key:"content-content-elements"},J.map(this.renderContentElement,this)):null:"string"===typeof J?(J=this._contentWidgets[0],!J||J.destroyed?null:u.tsx("div",{class:z.CSS.contentNode,key:"content-content"},J.render())):this.renderNodeContent(J):null};K.renderContentElement=function(J,M){const {visibleElements:N}=this;if("boolean"!==typeof N.content&&!N.content?.[J.type])return null;
switch(J.type){case "attachments":return this.renderAttachments(M);case "custom":return this.renderCustom(J,M);case "fields":return this.renderFields(M);case "media":return this.renderMedia(M);case "text":return this.renderText(J,M);case "expression":return this.renderExpression(M);case "relationship":return this.renderRelationship(M);default:return null}};K.renderAttachments=function(J){const M=this._contentWidgets[J];if(!M||M.destroyed)return null;const {state:N,attachmentInfos:P}=M.viewModel;return"loading"===
N||0<P.length?u.tsx("div",{key:this._buildKey("attachments-element",J),class:this.classes(z.CSS.contentElement)},M.render()):null};K.renderRelationship=function(J){const M=this._contentWidgets[J];return M&&!M.destroyed&&this.flowItems?u.tsx("div",{key:this._buildKey("relationship-element",J),class:z.CSS.contentElement},M.render()):null};K.renderExpression=function(J){const M=this._contentWidgets[J];return!M||M.destroyed?null:u.tsx("div",{key:this._buildKey("expression-element",J),class:z.CSS.contentElement},
M.render())};K.renderCustom=function(J,M){({creator:J}=J);const N=this._contentWidgets[M];return!N||N.destroyed?null:J?u.tsx("div",{key:this._buildKey("custom-element",M),class:z.CSS.contentElement},N.render()):null};K.renderFields=function(J){const M=this._contentWidgets[J];return!M||M.destroyed?null:u.tsx("div",{key:this._buildKey("fields-element",J),class:z.CSS.contentElement},M.render())};K.renderMedia=function(J){const M=this._contentWidgets[J];return!M||M.destroyed?null:u.tsx("div",{key:this._buildKey("media-element",
J),class:z.CSS.contentElement},M.render())};K.renderLastEditInfo=function(){const {visibleElements:J,messages:M}=this;var {lastEditInfo:N}=this.viewModel;if(!N||!J.lastEditedInfo)return null;const {date:P,user:I}=N;N=y.substitute("edit"===N.type?I?M.lastEditedByUser:M.lastEdited:I?M.lastCreatedByUser:M.lastCreated,{date:P,user:I});return u.tsx("div",{key:"edit-info-element",class:this.classes(z.CSS.lastEditedInfo,z.CSS.contentElement)},N)};K.renderText=function(J,M){const N=this._contentWidgets[M];
return!N||N.destroyed?null:J.text?u.tsx("div",{key:this._buildKey("text-element",M),class:this.classes(z.CSS.contentElement,z.CSS.text)},N.render()):null};K._buildKey=function(J,...M){const N=this.get("viewModel.graphic.uid")||"0";M=M.join("-");return`${J}__${N}-${M}`};K._destroyContentWidget=function(J){J&&(J.viewModel=null,!J.destroyed&&J.destroy())};K._destroyContentWidgets=function(){this.removeHandles("relationship-handles");this._contentWidgets.forEach(J=>this._destroyContentWidget(J));this._contentWidgets=
[]};K._addFeatureRelationshipHandles=function(J){const {flowItems:M,visibleElements:N}=this;this.addHandles([n.on(()=>J,"select-record",({featureViewModel:P})=>{M&&(P.abilities={relationshipContent:!0},M.push(new w({flowItems:M,viewModel:P,visibleElements:N})))}),n.on(()=>J,"show-all-records",()=>{if(M){var {viewModel:P}=J;P.showAllEnabled=!0;P=new k({visibleElements:{title:!1,description:!1},viewModel:P});this._addFeatureRelationshipHandles(P);M.push(P)}})],"relationship-handles")};K._setupContentWidgets=
function(){this._destroyContentWidgets();const {headingLevel:J,visibleElements:M}=this;var N=this.get("viewModel.content");const {contentViewModels:P}=this.viewModel;Array.isArray(N)?N.forEach((I,G)=>{"attachments"===I.type&&(this._contentWidgets[G]=new g({displayType:I.displayType,headingLevel:M.title?J+1:J,viewModel:P[G]}));"fields"===I.type&&(this._contentWidgets[G]=new v({viewModel:P[G]}));"media"===I.type&&(this._contentWidgets[G]=new q({viewModel:P[G]}));"text"===I.type&&(this._contentWidgets[G]=
new h({viewModel:P[G]}));"custom"===I.type&&(this._contentWidgets[G]=new h({viewModel:P[G]}));"expression"===I.type&&(this._contentWidgets[G]=new l({viewModel:P[G]}));"relationship"===I.type&&(I=new k({viewModel:P[G]}),this._addFeatureRelationshipHandles(I),this._contentWidgets[G]=I)},this):(N=P[0])&&!N.destroyed&&(this._contentWidgets[0]=new h({viewModel:N}));this.scheduleRender()};c._createClass(E,[{key:"graphic",get:function(){return this.viewModel.graphic},set:function(J){this.viewModel.graphic=
J}},{key:"defaultPopupTemplateEnabled",get:function(){return this.viewModel.defaultPopupTemplateEnabled},set:function(J){this.viewModel.defaultPopupTemplateEnabled=J}},{key:"isTable",get:function(){return this.viewModel.isTable}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(J){this._overrideIfSome("label",J)}},{key:"spatialReference",get:function(){return this.viewModel.spatialReference},set:function(J){this.viewModel.spatialReference=J}},{key:"title",get:function(){return this.viewModel.title}},
{key:"map",get:function(){return this.viewModel.map},set:function(J){this.viewModel.map=J}},{key:"view",get:function(){return this.viewModel.view},set:function(J){this.viewModel.view=J}}]);return E}(C.FeatureContentMixin(e));b.__decorate([r.property()],t.prototype,"graphic",null);b.__decorate([r.property()],t.prototype,"defaultPopupTemplateEnabled",null);b.__decorate([r.property()],t.prototype,"flowItems",void 0);b.__decorate([r.property()],t.prototype,"headingLevel",void 0);b.__decorate([r.property({readOnly:!0})],
t.prototype,"isTable",null);b.__decorate([r.property()],t.prototype,"label",null);b.__decorate([r.property(),x.messageBundle("esri/widgets/Feature/t9n/Feature")],t.prototype,"messages",void 0);b.__decorate([r.property(),x.messageBundle("esri/t9n/common")],t.prototype,"messagesCommon",void 0);b.__decorate([r.property(),x.messageBundle("esri/widgets/support/t9n/uriUtils")],t.prototype,"messagesURIUtils",void 0);b.__decorate([r.property()],t.prototype,"spatialReference",null);b.__decorate([r.property({readOnly:!0})],
t.prototype,"title",null);b.__decorate([r.property()],t.prototype,"visibleElements",void 0);b.__decorate([m.cast("visibleElements")],t.prototype,"castVisibleElements",null);b.__decorate([r.property()],t.prototype,"map",null);b.__decorate([r.property()],t.prototype,"view",null);b.__decorate([r.property({type:p})],t.prototype,"viewModel",void 0);return t=w=b.__decorate([f.subclass("esri.widgets.Feature")],t)})},"esri/widgets/Feature/FeatureAttachments":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../Attachments ../Widget ./FeatureAttachments/FeatureAttachmentsViewModel ./support/FeatureElementInfo ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){n=function(v){function q(p,z){p=v.call(this,p,z)||this;p._featureElementInfo=null;p.attachmentsWidget=new d;p.headingLevel=2;p.viewModel=new e;return p}a._inheritsLoose(q,v);var k=q.prototype;k.initialize=function(){this._featureElementInfo=new g;this.addHandles([b.watch(()=>[this.viewModel?.description,this.viewModel?.title,this.headingLevel],()=>this._setupFeatureElementInfo(),b.initial),b.watch(()=>this.viewModel,p=>this.attachmentsWidget.viewModel=p,b.initial)])};
k.destroy=function(){this.attachmentsWidget.destroy();this._featureElementInfo?.destroy()};k.render=function(){const {attachmentsWidget:p}=this;return l.tsx("div",{class:"esri-feature-attachments"},this._featureElementInfo?.render(),p?.render())};k._setupFeatureElementInfo=function(){const {description:p,title:z,headingLevel:C}=this;this._featureElementInfo?.set({description:p,title:z,headingLevel:C})};a._createClass(q,[{key:"description",get:function(){return this.viewModel.description},set:function(p){this.viewModel.description=
p}},{key:"displayType",get:function(){return this.attachmentsWidget.displayType},set:function(p){this.attachmentsWidget.displayType=p}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(p){this.viewModel.graphic=p}},{key:"title",get:function(){return this.viewModel.title},set:function(p){this.viewModel.title=p}}]);return q}(f);c.__decorate([t.property({readOnly:!0})],n.prototype,"attachmentsWidget",void 0);c.__decorate([t.property()],n.prototype,"description",null);c.__decorate([t.property()],
n.prototype,"displayType",null);c.__decorate([t.property()],n.prototype,"graphic",null);c.__decorate([t.property()],n.prototype,"headingLevel",void 0);c.__decorate([t.property()],n.prototype,"title",null);c.__decorate([t.property({type:e})],n.prototype,"viewModel",void 0);return n=c.__decorate([m.subclass("esri.widgets.Feature.FeatureAttachments")],n)})},"esri/widgets/Attachments":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/maybe ../core/reactiveUtils ../core/unitFormatUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){const z={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},C=window.CSS;e=function(B){function A(u,y){u=B.call(this,u,y)||this;u.displayType="auto";u.messages=null;u.messagesUnits=null;u.selectedFile=null;u.submitting=!1;u.viewModel=null;u.visibleElements={...z};u._supportsImageOrientation=C&&C.supports&&C.supports("image-orientation","from-image");u._addAttachmentForm=
null;u._updateAttachmentForm=null;return u}c._inheritsLoose(A,B);var x=A.prototype;x.initialize=function(){this.viewModel||(this.viewModel=new l);this.addHandles([r.on(()=>this.viewModel?.attachmentInfos,"change",()=>this.scheduleRender()),r.on(()=>this.viewModel?.fileInfos,"change",()=>this.scheduleRender()),r.watch(()=>this.viewModel?.mode,()=>this._modeChanged(),r.initial)])};x.loadDependencies=function(){return Promise.all([new Promise((u,y)=>a(["../chunks/calcite-icon"],u,y))])};x.castVisibleElements=
function(u){return{...z,...u}};x.addAttachment=function(){const {_addAttachmentForm:u,viewModel:y}=this;this._set("submitting",!0);this._set("error",null);return y.addAttachment(u).then(w=>{this._set("submitting",!1);this._set("error",null);y.mode="view";return w}).catch(w=>{this._set("submitting",!1);this._set("error",new t("attachments:add-attachment",this.messages.addErrorMessage,w));throw w;})};x.deleteAttachment=function(u){const {viewModel:y}=this;this._set("submitting",!0);this._set("error",
null);return y.deleteAttachment(u).then(w=>{this._set("submitting",!1);this._set("error",null);y.mode="view";return w}).catch(w=>{this._set("submitting",!1);this._set("error",new t("attachments:delete-attachment",this.messages.deleteErrorMessage,w));throw w;})};x.updateAttachment=function(){const {viewModel:u}=this,{_updateAttachmentForm:y}=this;this._set("submitting",!0);this._set("error",null);return u.updateAttachment(y).then(w=>{this._set("submitting",!1);this._set("error",null);u.mode="view";
return w}).catch(w=>{this._set("submitting",!1);this._set("error",new t("attachments:update-attachment",this.messages.updateErrorMessage,w));throw w;})};x.addFile=function(){const u=this.viewModel.addFile(this.selectedFile,this._addAttachmentForm);this.viewModel.mode="view";return u};x.updateFile=function(){const {viewModel:u}=this,y=u.updateFile(this.selectedFile,this._updateAttachmentForm,u.activeFileInfo);u.mode="view";return y};x.deleteFile=function(u){u=this.viewModel.deleteFile(u||this.viewModel.activeFileInfo?.file);
this.viewModel.mode="view";return u};x.render=function(){const {submitting:u,viewModel:y}=this,{state:w}=y;return p.tsx("div",{class:this.classes("esri-attachments","esri-widget")},u?this.renderProgressBar():null,"loading"===w?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())};x.renderErrorMessage=function(){const {error:u,visibleElements:y}=this;return u&&y.errorMessage?p.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},u.message):null};x.renderAttachments=
function(){const {activeFileInfo:u,mode:y,activeAttachmentInfo:w}=this.viewModel;return"add"===y?this.renderAddForm():"edit"===y?this.renderDetailsForm(w||u):this.renderAttachmentContainer()};x.renderLoading=function(){return p.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},p.tsx("div",{class:"esri-attachments__loader"}))};x.renderProgressBar=function(){return this.visibleElements.progressBar?p.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};x.renderAddForm=
function(){const {submitting:u,selectedFile:y}=this;var w=u||!y,D=this.visibleElements.cancelAddButton?p.tsx("button",{type:"button",bind:this,disabled:u,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",u&&"esri-button--disabled")},this.messages.cancel):null;w=this.visibleElements.addSubmitButton?p.tsx("button",{type:"submit",disabled:w,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",
{["esri-button--disabled"]:w})},this.messages.add):null;const F=y?p.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},y.name):null;D=p.tsx("form",{bind:this,afterCreate:q.storeNode,afterRemoved:q.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},p.tsx("fieldset",{class:"esri-attachments__file-fieldset"},F,p.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},y?this.messages.changeFile:this.messages.selectFile,
p.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),w,D);return p.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},D)};x.renderDetailsForm=function(u){const {visibleElements:y,viewModel:w,selectedFile:D,submitting:F}=this;var {abilities:E}=w,K=F||!D;let J;if(D){var M=D.type;J=D.name;var N=D.size}else if(u&&"file"in u)M=u.file.type,J=u.file.name,N=u.file.size;else if(u&&"contentType"in u){M=u.contentType;
J=u.name;N=u.size;var P=u.url}var I=E.editing&&E.operations?.delete&&y.deleteButton?p.tsx("button",{key:"delete-button",type:"button",disabled:F,bind:this,onclick:H=>this._submitDeleteAttachment(H,u),class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-attachments__delete-button",{["esri-button--disabled"]:F})},this.messages.delete):void 0;K=E.editing&&E.operations?.update&&y.updateButton?p.tsx("button",{disabled:K,key:"update-button",type:"submit",class:this.classes("esri-button",
"esri-button--small","esri-button--third",{["esri-button--disabled"]:K})},this.messages.update):void 0;const G=this.visibleElements.cancelUpdateButton?p.tsx("button",{disabled:F,key:"cancel-button",type:"button",bind:this,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",{["esri-button--disabled"]:F})},this.messages.cancel):void 0;E=E.editing&&E.operations?.update?p.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},
p.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},J),p.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,p.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):void 0;N=p.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},p.tsx("label",null,m.formatFileSize(this.messagesUnits,N??0)));M=p.tsx("fieldset",{key:"content-type",
class:"esri-attachments__metadata-fieldset"},p.tsx("label",null,M));P=n.isSome(P)?p.tsx("a",{class:"esri-attachments__item-link",href:P,rel:"noreferrer",target:"_blank"},this.renderImageMask(u,400),p.tsx("div",{class:"esri-attachments__item-link-overlay"},p.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},p.tsx("calcite-icon",{icon:"launch"})))):this.renderImageMask(u,400);I=p.tsx("form",{bind:this,afterCreate:q.storeNode,afterRemoved:q.discardNode,"data-node-ref":"_updateAttachmentForm",
onsubmit:H=>this._submitUpdateAttachment(H,u)},p.tsx("div",{class:"esri-attachments__metadata"},N,M),E,p.tsx("div",{class:"esri-attachments__actions"},I,G,K));return p.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},P,I)};x.renderImageMask=function(u,y){return u?"file"in u?this.renderGenericImageMask(u.file.name,u.file.type):this.renderImageMaskForAttachment(u,y):null};x.renderGenericImageMask=function(u,y){var {supportsResizeAttachments:w}=this.viewModel;y=v.getIconPath(y);
w={["esri-attachments__image--resizable"]:w};return p.tsx("div",{class:this.classes("esri-attachments__item-mask--icon","esri-attachments__item-mask")},p.tsx("img",{title:u,alt:u,src:y,class:this.classes(w,"esri-attachments__image")}))};x.renderImageMaskForAttachment=function(u,y){var {supportsResizeAttachments:w}=this.viewModel;if(!u)return null;const {contentType:D,name:F,url:E}=u;if(!w||!v.isSupportedImage(D))return this.renderGenericImageMask(F,D);u=(u=this._getCSSTransform(u))?{transform:u,"image-orientation":"none"}:
{};y=`${E}${E?.includes("?")?"\x26":"?"}w=${y}`;w={["esri-attachments__image--resizable"]:w};return p.tsx("div",{class:this.classes("esri-attachments__item-mask")},p.tsx("img",{styles:u,alt:F,title:F,src:y,class:this.classes(w,"esri-attachments__image")}))};x.renderFile=function(u){const {file:y}=u;return p.tsx("li",{class:"esri-attachments__item",key:y},p.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,
onclick:()=>this._startEditFile(u),type:"button"},this.renderImageMask(u),p.tsx("label",{class:"esri-attachments__label"},p.tsx("span",{class:"esri-attachments__filename"},y.name||this.messages.noTitle),p.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",q.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}))))};x.renderAttachmentInfo=function({attachmentInfo:u,displayType:y}){const {viewModel:w,effectiveDisplayType:D}=this,{abilities:F,supportsResizeAttachments:E}=
w,{contentType:K,name:J,url:M}=u;y=this.renderImageMask(u,"list"===y?48:400);var N=F.editing?p.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",q.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}):null;N="preview"===D&&E&&v.isSupportedImage(K)?null:p.tsx("label",{class:"esri-attachments__label"},p.tsx("span",{class:"esri-attachments__filename"},J||this.messages.noTitle),N);y=[y,N];y=F.editing?p.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",
title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":u.id,onclick:()=>this._startEditAttachment(u),type:"button"},y):p.tsx("a",{key:"details-link",class:"esri-attachments__item-button",href:M??void 0,target:"_blank"},y);return p.tsx("li",{class:"esri-attachments__item",key:u},y)};x.renderAttachmentContainer=function(){const {effectiveDisplayType:u,viewModel:y,visibleElements:w}=this,{attachmentInfos:D,abilities:F,fileInfos:E}=y;var K=!!D?.length;
const J=!!E?.length,M={["esri-attachments__container--list"]:"preview"!==u,["esri-attachments__container--preview"]:"preview"===u},N=F.editing&&F.operations?.add&&w.addButton?p.tsx("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},p.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):void 0,P=K?p.tsx("ul",
{key:"attachments-list",class:"esri-attachments__items"},D.toArray().map(G=>this.renderAttachmentInfo({attachmentInfo:G,displayType:u}))):void 0,I=J?p.tsx("ul",{key:"file-list",class:"esri-attachments__items"},E.toArray().map(G=>this.renderFile(G))):void 0;K=J||K?void 0:p.tsx("div",{class:"esri-widget__content--empty"},this.messages.noAttachments);return p.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",M)},P,I,K,N)};x._modeChanged=function(){this._set("error",
null);this._set("selectedFile",null)};x._handleFileInputChange=function(u){u=(u=u.target)&&u.files&&u.files.item(0);this._set("selectedFile",u)};x._submitDeleteAttachment=function(u,y){u.preventDefault();y&&("file"in y?this.deleteFile(y.file):y&&this.deleteAttachment(y))};x._submitAddAttachment=function(u){u.preventDefault();this.viewModel.filesEnabled?this.addFile():this.addAttachment()};x._submitUpdateAttachment=function(u,y){u.preventDefault();y&&"file"in y?this.updateFile():this.updateAttachment()};
x._startEditAttachment=function(u){const {viewModel:y}=this;y.activeFileInfo=null;y.activeAttachmentInfo=u;y.mode="edit"};x._startEditFile=function(u){const {viewModel:y}=this;y.activeAttachmentInfo=null;y.activeFileInfo=u;y.mode="edit"};x._startAddAttachment=function(){this.viewModel.mode="add"};x._cancelForm=function(u){u.preventDefault();this.viewModel.mode="view"};x._getCSSTransform=function(u){({orientationInfo:u}=u);return!this._supportsImageOrientation&&u?[u.rotation?`rotate(${u.rotation}deg)`:
"",u.mirrored?"scaleX(-1)":""].join(" "):""};c._createClass(A,[{key:"abilities",get:function(){return this.viewModel.abilities},set:function(u){this.viewModel.abilities=u}},{key:"effectiveDisplayType",get:function(){const {displayType:u}=this;return u&&"auto"!==u?u:this.viewModel.supportsResizeAttachments?"preview":"list"}},{key:"graphic",get:function(){return this.viewModel.graphic},set:function(u){this.viewModel.graphic=u}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(u){this._overrideIfSome("label",
u)}}]);return A}(h);b.__decorate([d.property()],e.prototype,"abilities",null);b.__decorate([d.property()],e.prototype,"displayType",void 0);b.__decorate([d.property({readOnly:!0})],e.prototype,"effectiveDisplayType",null);b.__decorate([d.property()],e.prototype,"graphic",null);b.__decorate([d.property()],e.prototype,"label",null);b.__decorate([d.property(),k.messageBundle("esri/widgets/Attachments/t9n/Attachments")],e.prototype,"messages",void 0);b.__decorate([d.property(),k.messageBundle("esri/core/t9n/Units")],
e.prototype,"messagesUnits",void 0);b.__decorate([d.property({readOnly:!0})],e.prototype,"selectedFile",void 0);b.__decorate([d.property({readOnly:!0})],e.prototype,"submitting",void 0);b.__decorate([d.property({readOnly:!0})],e.prototype,"error",void 0);b.__decorate([d.property({type:l})],e.prototype,"viewModel",void 0);b.__decorate([d.property()],e.prototype,"visibleElements",void 0);b.__decorate([f.cast("visibleElements")],e.prototype,"castVisibleElements",null);return e=b.__decorate([g.subclass("esri.widgets.Attachments")],
e)})},"esri/core/unitFormatUtils":function(){define("exports ./byteSizeEstimations ./Cyclical ./mathUtils ./maybe ./string ./unitUtils ../intl/number".split(" "),function(a,c,b,t,n,r,m,d){function f(q,k,p){return q.units[k][p]}function e(q,k,p,z=2,C="abbr"){return`${d.formatNumber(k,{minimumFractionDigits:z,maximumFractionDigits:z,signDisplay:0<k?"never":"exceptZero"})} ${f(q,p,C)}`}function g(q,k,p,z=2,C="abbr"){return`${d.formatNumber(k,{minimumFractionDigits:z,maximumFractionDigits:z,signDisplay:"exceptZero"})} ${f(q,
p,C)}`}function h(q,k){const p=JSON.stringify(k);let z=l.get(p);z||(z=new Intl.NumberFormat("en-US",k),l.set(p,z));return/\-?\+?360/.test(z.format(q))?0:q}const l=new Map,v=["B","kB","MB","GB","TB"];a.formatAngleDegrees=function(q,k,p,z,C){C=n.unwrapOr(C,2);var B=b.cyclicalDegrees,A=B.normalize;a:if(q=m.convertUnit(q,k,"degrees"),p===z)p=q;else{switch(z){case "arithmetic":p=-q+90;break a;case "geographic":p=-q-90;break a}p=void 0}B=A.call(B,p,0,!0);C={style:"unit",unitDisplay:"narrow",unit:"degree",
maximumFractionDigits:C,minimumFractionDigits:C,signDisplay:0<B?"never":"exceptZero"};B=h(B,C);return d.formatNumber(B,C)};a.formatDMS=function(q,k,p=2){q=m.convertUnit(q,k,"degrees");k=q-Math.floor(q);q-=k;k*=60;let z=k-Math.floor(k);k-=z;z*=60;return`${q.toFixed()}\u00b0 ${k.toFixed()}' ${z.toFixed(p)}"`};a.formatDecimal=e;a.formatFileSize=function(q,k){let p=0===k?0:Math.floor(Math.log(k)/Math.log(c.ByteSizeUnit.KILOBYTES));p=t.clamp(p,0,v.length-1);k=d.formatNumber(k/c.ByteSizeUnit.KILOBYTES**
p,{maximumFractionDigits:2});return r.replace(q.units.bytes[v[p]],{fileSize:k})};a.formatImperialArea=function(q,k,p,z=2,C="abbr"){const B=m.preferredImperialAreaUnit(k,p);return e(q,m.convertUnit(k,p,B),B,z,C)};a.formatImperialLength=function(q,k,p,z=2,C="abbr"){const B=m.preferredImperialLengthUnit(k,p);return e(q,m.convertUnit(k,p,B),B,z,C)};a.formatImperialRelativeLength=function(q,k,p,z=2,C="abbr"){const B=m.preferredImperialLengthUnit(k,p);return g(q,m.convertUnit(k,p,B),B,z,C)};a.formatImperialRelativeVerticalLength=
function(q,k,p,z=2,C="abbr"){const B=m.preferredImperialVerticalLengthUnit(k,p);return g(q,m.convertUnit(k,p,B),B,z,C)};a.formatImperialVerticalLength=function(q,k,p,z=2,C="abbr"){const B=m.preferredImperialVerticalLengthUnit(k,p);return e(q,m.convertUnit(k,p,B),B,z,C)};a.formatMetricArea=function(q,k,p,z=2,C="abbr"){const B=m.preferredMetricAreaUnit(k,p);return e(q,m.convertUnit(k,p,B),B,z,C)};a.formatMetricLength=function(q,k,p,z=2,C="abbr"){const B=m.preferredMetricLengthUnit(k,p);return e(q,m.convertUnit(k,
p,B),B,z,C)};a.formatMetricRelativeLength=function(q,k,p,z=2,C="abbr"){const B=m.preferredMetricLengthUnit(k,p);return g(q,m.convertUnit(k,p,B),B,z,C)};a.formatMetricRelativeVerticalLength=function(q,k,p,z=2,C="abbr"){const B=m.preferredMetricVerticalLengthUnit(k,p);return g(q,m.convertUnit(k,p,B),B,z,C)};a.formatMetricVerticalLength=function(q,k,p,z=2,C="abbr"){const B=m.preferredMetricVerticalLengthUnit(k,p);return e(q,m.convertUnit(k,p,B),B,z,C)};a.formatRelativeAngleDegrees=function(q,k,p,z,C){p!==
z&&(q=-q);C=n.unwrapOr(C,2);p={style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:C,minimumFractionDigits:C,signDisplay:"exceptZero"};q=m.convertUnit(q,k,"degrees")%360;q=h(q,p);return d.formatNumber(q,p)};a.formatRelativeDecimal=g;a.unitName=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Accessor ../../core/Collection ../../core/Error ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../rest/query/support/AttachmentInfo ../../rest/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){const k={editing:!1,operations:{add:!0,update:!0,delete:!0}},p=n.ofType(l);t=function(z){function C(A){var x=z.call(this,A)||this;x._getAttachmentsPromise=null;x._attachmentLayer=null;x.abilities={...k};x.activeAttachmentInfo=null;x.activeFileInfo=null;x.attachmentInfos=new p;x.fileInfos=new n;x.graphic=null;x.mode="view";x.filesEnabled=!1;x.addHandles(d.watch(()=>x.graphic,()=>x._graphicChanged(),d.initial));return x}a._inheritsLoose(C,z);var B=C.prototype;
B.destroy=function(){this.graphic=this._attachmentLayer=null};B.castAbilities=function(A){return{...k,...A}};B.getAttachments=function(){var A=a._asyncToGenerator(function*(){const {_attachmentLayer:x,attachmentInfos:u}=this;if(!x||"function"!==typeof x.queryAttachments)throw new r("invalid-layer","getAttachments(): A valid layer is required.");const y=this._getObjectId();var w=new v({objectIds:[y],returnMetadata:!0});const D=[];this._getAttachmentsPromise=w=x.queryAttachments(w).then(F=>F[y]||D).catch(()=>
D);this.notifyChange("state");w=yield w;u.removeAll();w.length&&u.addMany(w);this._getAttachmentsPromise=null;this.notifyChange("state");return w});return function(){return A.apply(this,arguments)}}();B.addAttachment=function(){var A=a._asyncToGenerator(function*(x,u=this.graphic){const {_attachmentLayer:y,attachmentInfos:w,abilities:D}=this;if(!u)throw new r("invalid-graphic","addAttachment(): A valid graphic is required.",{graphic:u});if(!x)throw new r("invalid-attachment","addAttachment(): An attachment is required.",
{attachment:x});if(!D.operations?.add)throw new r("invalid-abilities","addAttachment(): add abilities are required.");if(!y||"function"!==typeof y.addAttachment)throw new r("invalid-layer","addAttachment(): A valid layer is required.");x=yield y.addAttachment(u,x).then(F=>this._queryAttachment(F.objectId,u));w.add(x);return x});return function(x){return A.apply(this,arguments)}}();B.deleteAttachment=function(){var A=a._asyncToGenerator(function*(x){const {_attachmentLayer:u,attachmentInfos:y,graphic:w,
abilities:D}=this;if(!x)throw new r("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:x});if(!D.operations?.delete)throw new r("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!u||"function"!==typeof u.deleteAttachments)throw new r("invalid-layer","deleteAttachment(): A valid layer is required.");if(!w)throw new r("invalid-graphic","deleteAttachment(): A graphic is required.");const F=yield u.deleteAttachments(w,[x.id]).then(()=>
x);y.remove(F);return F});return function(x){return A.apply(this,arguments)}}();B.updateAttachment=function(){var A=a._asyncToGenerator(function*(x,u=this.activeAttachmentInfo){const {_attachmentLayer:y,attachmentInfos:w,graphic:D,abilities:F}=this;if(!x)throw new r("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:x});if(!u)throw new r("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:u});if(!F.operations?.update)throw new r("invalid-abilities",
"updateAttachment(): Update abilities are required.");const E=w.findIndex(K=>K===u);if(!y||"function"!==typeof y.updateAttachment)throw new r("invalid-layer","updateAttachment(): A valid layer is required.");if(!D)throw new r("invalid-graphic","updateAttachment(): A graphic is required.");x=yield y.updateAttachment(D,u.id,x).then(K=>this._queryAttachment(K.objectId));w.splice(E,1,x);return x});return function(x){return A.apply(this,arguments)}}();B.commitFiles=function(){var A=a._asyncToGenerator(function*(){yield Promise.all(this.fileInfos.items.map(x=>
this.addAttachment(x.form)));this.fileInfos.removeAll();return this.getAttachments()});return function(){return A.apply(this,arguments)}}();B.addFile=function(A,x){if(!A||!x)return null;A={file:A,form:x};this.fileInfos.add(A);return A};B.updateFile=function(A,x,u=this.activeFileInfo){if(!A||!x||!u)return null;const y=this.fileInfos.findIndex(w=>u===w);-1<y&&this.fileInfos.splice(y,1,{file:A,form:x});return this.fileInfos.items[y]};B.deleteFile=function(A){const x=this.fileInfos.find(u=>u.file===A);
return x?(this.fileInfos.remove(x),x):null};B._queryAttachment=function(){var A=a._asyncToGenerator(function*(x,u){const {_attachmentLayer:y}=this;if(!x||!y?.queryAttachments)throw new r("invalid-attachment-id","Could not query attachment.");const w=this._getObjectId(u);x=new v({objectIds:[w],attachmentsWhere:`AttachmentId=${x}`,returnMetadata:!0});return y.queryAttachments(x).then(D=>D[w][0])});return function(x,u){return A.apply(this,arguments)}}();B._getObjectId=function(A=this.graphic){return A?.getObjectId()??
null};B._graphicChanged=function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))};B._setAttachmentLayer=function(){var {graphic:A}=this;this._attachmentLayer=(A=q.getSourceLayer(A))?"scene"===A.type&&m.isSome(A.associatedLayer)?A.associatedLayer:A:null};a._createClass(C,[{key:"state",get:function(){return this._getAttachmentsPromise?"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){var {graphic:A}=this;if(!A)return!1;A=A.layer||
A.sourceLayer;return A?.loaded&&"capabilities"in A&&A.capabilities&&"operations"in A.capabilities&&"supportsResizeAttachments"in A.capabilities.operations&&A.capabilities.operations.supportsResizeAttachments||!1}}]);return C}(t);c.__decorate([f.property()],t.prototype,"abilities",void 0);c.__decorate([e.cast("abilities")],t.prototype,"castAbilities",null);c.__decorate([f.property()],t.prototype,"activeAttachmentInfo",void 0);c.__decorate([f.property()],t.prototype,"activeFileInfo",void 0);c.__decorate([f.property({readOnly:!0,
type:p})],t.prototype,"attachmentInfos",void 0);c.__decorate([f.property()],t.prototype,"fileInfos",void 0);c.__decorate([f.property({type:b})],t.prototype,"graphic",void 0);c.__decorate([f.property()],t.prototype,"mode",void 0);c.__decorate([f.property({readOnly:!0})],t.prototype,"state",null);c.__decorate([f.property()],t.prototype,"filesEnabled",void 0);c.__decorate([f.property({readOnly:!0})],t.prototype,"supportsResizeAttachments",null);return t=c.__decorate([h.subclass("esri.widgets.Attachments.AttachmentsViewModel")],
t)})},"esri/rest/query/support/AttachmentInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../layers/support/exifUtils".split(" "),function(a,c,b,t,n,r,m,d){var f;const e={1:{id:1,rotation:0,mirrored:!1},2:{id:2,rotation:0,mirrored:!0},3:{id:3,rotation:180,mirrored:!1},
4:{id:4,rotation:180,mirrored:!0},5:{id:5,rotation:-90,mirrored:!0},6:{id:6,rotation:90,mirrored:!1},7:{id:7,rotation:90,mirrored:!0},8:{id:8,rotation:-90,mirrored:!1}};b=f=function(g){function h(l){l=g.call(this,l)||this;l.contentType=null;l.exifInfo=null;l.id=null;l.globalId=null;l.keywords=null;l.name=null;l.parentGlobalId=null;l.parentObjectId=null;l.size=null;l.url=null;return l}a._inheritsLoose(h,g);h.prototype.clone=function(){return new f({contentType:this.contentType,exifInfo:this.exifInfo,
id:this.id,globalId:this.globalId,keywords:this.keywords,name:this.name,parentGlobalId:this.parentGlobalId,parentObjectId:this.parentObjectId,size:this.size,url:this.url})};a._createClass(h,[{key:"orientationInfo",get:function(){var {exifInfo:l}=this;l=d.getExifValue({exifName:"Exif IFD0",tagName:"Orientation",exifInfo:l});return e[l]||null}}]);return h}(b.JSONSupport);c.__decorate([t.property({type:String})],b.prototype,"contentType",void 0);c.__decorate([t.property()],b.prototype,"exifInfo",void 0);
c.__decorate([t.property({readOnly:!0})],b.prototype,"orientationInfo",null);c.__decorate([t.property({type:n.Integer})],b.prototype,"id",void 0);c.__decorate([t.property({type:String})],b.prototype,"globalId",void 0);c.__decorate([t.property({type:String})],b.prototype,"keywords",void 0);c.__decorate([t.property({type:String})],b.prototype,"name",void 0);c.__decorate([t.property({json:{read:!1}})],b.prototype,"parentGlobalId",void 0);c.__decorate([t.property({json:{read:!1}})],b.prototype,"parentObjectId",
void 0);c.__decorate([t.property({type:n.Integer})],b.prototype,"size",void 0);c.__decorate([t.property({json:{read:!1}})],b.prototype,"url",void 0);return b=f=c.__decorate([m.subclass("esri.layers.support.AttachmentInfo")],b)})},"esri/layers/support/exifUtils":function(){define(["exports"],function(a){function c(b){const {tagName:t,tags:n}=b;return n&&t?(b=n.find(r=>r.name===t))&&b.value||null:null}a.getExifValue=function(b){const {exifInfo:t,exifName:n,tagName:r}=b;return t&&n&&r?(b=t.find(m=>m.name===
n))?c({tagName:r,tags:b.tags}):null:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/support/featureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../intl ../../../core/Logger ../../../core/maybe ../../../core/string ../../../intl/date ../../../intl/number ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../popup/support/FieldInfoFormat ../../../support/arcadeOnDemand".split(" "),function(a,c,
b,t,n,r,m,d,f,e,g,h){function l(){l=c._asyncToGenerator(function*(da,ea){return"function"===typeof da?da.call(null,ea):da});return l.apply(this,arguments)}function v(da){return da?V.test(da):!1}function q(da,ea){if(!v(ea)||!da)return null;const ca=ea.replace(V,"").toLowerCase();let ja=null;da.some(ia=>ia.name.toLowerCase()===ca?(ja=ia,!0):!1);return ja}function k(da,ea){return(ea=p(ea,da))?ea.name:da}function p(da,ea){return da&&"function"===typeof da.getField&&ea?da.getField(ea)??null:null}function z({formattedAttributes:da,
template:ea,fieldInfoMap:ca}){return`${r.replace(r.replace(ea,ja=>{const ia=ca.get(ja.toLowerCase());return`{${ia&&ia.fieldName||ja}}`}),da).replace(S,"")}`.trim()}function C(da,ea,ca=!1){const ja=ea[da];"string"===typeof ja&&(ca=(ca?encodeURIComponent(ja):ja).replace(Q,"%27"),ea[da]=ca)}function B(da,ea=!1){const ca={...da};Object.keys(ca).forEach(ja=>C(ja,ca,ea));return ca}function A(da,ea){return da.replace(R,(ca,ja,ia)=>(ca=p(ea,ia))?`{${ca.name}}`:ja)}function x(da,ea,ca){return(da=A(da,ca))?
da.replace(W,(ja,ia,Z)=>{ia=`${ia||Z}`.trim();return r.replace(ja,B(ea,ia&&"{"!==ia[0]||!1))}):da}function u(da,ea){var ca=ea.fieldName,ja=y(ea.fieldInfos,ca)?.clone();const ia=ea.preventPlacesFormatting;ea=ea.layer;var Z=p(ea,ca);ja&&"date"===Z?.type&&(Z=ja.format||new g,Z.dateFormat=Z.dateFormat||"short-date-short-time",Z.dateTimeFormatOptions=!ea?.layer&&"feature"===ea?.type&&ea.datesInUnknownTimezone||ea?.layer&&"map-image"===ea.layer?.type&&ea.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,
ja.format=Z);ja=ja&&ja.format;if("string"===typeof da&&f.isRasterPixelValueField(ca)&&ja)return ja.formatRasterPixelValue(da);"string"!==typeof da||!ja||null!=ja.dateFormat||null==ja.places&&null==ja.digitSeparator||(ca=Number(da),isNaN(ca)||(da=ca));return"string"===typeof da||null==da||null==ja?F(da):ia?d.formatNumber(da,{...d.convertNumberFormatToIntlOptions(ja),minimumFractionDigits:0,maximumFractionDigits:20}):ja.format(da)}function y(da,ea){if(da&&da.length&&ea){var ca=ea.toLowerCase(),ja=void 0;
da.some(ia=>ia.fieldName&&ia.fieldName.toLowerCase()===ca?(ja=ia,!0):!1);return ja}}function w({fieldName:da,graphic:ea,layer:ca}){if(I(da)||!ca||"function"!==typeof ca.getFeatureType)return null;const {typeIdField:ja}=ca;return ja&&da===ja?(da=ca.getFeatureType(ea))?da.name:null:null}function D({fieldName:da,value:ea,graphic:ca,layer:ja}){return I(da)||!ja||"function"!==typeof ja.getFieldDomain?null:(da=ca&&ja.getFieldDomain(da,{feature:ca}))&&"coded-value"===da.type?da.getName(ea):null}function F(da){return"string"===
typeof da?da.replace(aa,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):da}function E(da){const {value:ea,fieldName:ca,fieldInfos:ja,fieldInfoMap:ia,layer:Z,graphic:ha}=da;return null==ea?"":(da=D({fieldName:ca,value:ea,graphic:ha,layer:Z}))||(da=w({fieldName:ca,graphic:ha,layer:Z}))?da:ia.get(ca.toLowerCase())?u(ea,{fieldInfos:ja||Array.from(ia.values()),fieldName:ca,layer:Z}):(da=Z&&Z.fieldsIndex)&&da.isDateField(ca)?m.formatDate(ea,U):F(ea)}function K(da,ea){return J.apply(this,arguments)}function J(){J=
c._asyncToGenerator(function*(da,ea){const {layer:ca,graphic:ja,outFields:ia,objectIds:Z,returnGeometry:ha,spatialReference:fa}=da;da=Z[0];if("number"!==typeof da&&"string"!==typeof da)return O.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:ca,graphic:ja,objectId:da,requiredFields:ia}),null;if(!e.getEffectiveLayerCapabilities(ca)?.operations?.supportsQuery)return O.warn("The specified layer cannot be queried. The following fields will not be available.",
{layer:ca,graphic:ja,requiredFields:ia,returnGeometry:ha}),null;da=ca.createQuery();da.objectIds=Z;da.outFields=ia?.length?ia:[ca.objectIdField];da.returnGeometry=!!ha;da.returnZ=!!ha;da.returnM=!!ha;da.outSpatialReference=fa;return(yield ca.queryFeatures(da,ea)).features[0]});return J.apply(this,arguments)}function M(da){return N.apply(this,arguments)}function N(){N=c._asyncToGenerator(function*(da){if(!da.expressionInfos?.length)return!1;var ea=yield h.loadArcade();({arcadeUtils:{hasGeometryFunctions:ea}}=
ea);return ea(da)});return N.apply(this,arguments)}function P(){P=c._asyncToGenerator(function*({graphic:da,popupTemplate:ea,layer:ca,spatialReference:ja},ia){if(ca&&ea&&("function"===typeof ca.load&&(yield ca.load(ia)),da.attributes)){var Z=da.attributes[ca.objectIdField];if(null!=Z){Z=[Z];var ha=yield ea.getRequiredFields(ca.fieldsIndex),fa=f.featureHasFields(ha,da);ha=fa?[]:ha;ea=ea.returnGeometry||(yield M(ea));if(!fa||ea)if(ca=yield K({layer:ca,graphic:da,outFields:ha,objectIds:Z,returnGeometry:ea,
spatialReference:ja},ia))ca.geometry&&(da.geometry=ca.geometry),ca.attributes&&(da.attributes={...da.attributes,...ca.attributes})}}});return P.apply(this,arguments)}function I(da=""){return da?da.includes("relationships/"):!1}function G({attributes:da,graphic:ea,relatedInfo:ca,fieldInfos:ja,fieldInfoMap:ia,layer:Z}){da&&ea&&ca&&Object.keys(ea.attributes).forEach(ha=>{var fa=(fa={layerId:ca.relation.id.toString(),fieldName:ha},`${"relationships/"}${fa.layerId}/${fa.fieldName}`);da[fa]=E({fieldName:fa,
fieldInfos:ja,fieldInfoMap:ia,layer:Z,value:ea.attributes[ha],graphic:ea})})}function H({attributes:da,relatedInfo:ea,fieldInfoMap:ca,fieldInfos:ja,layer:ia}){da&&ea&&(ea.relatedFeatures&&ea.relatedFeatures&&ea.relatedFeatures.forEach(Z=>G({attributes:da,graphic:Z,relatedInfo:ea,fieldInfoMap:ca,fieldInfos:ja,layer:ia})),ea.relatedStatsFeatures&&ea.relatedStatsFeatures&&ea.relatedStatsFeatures.forEach(Z=>G({attributes:da,graphic:Z,relatedInfo:ea,fieldInfoMap:ca,fieldInfos:ja,layer:ia})))}function L(da,
ea,ca){return da.find(ja=>ja!==ea&&"feature"===ja.type&&ja.url===ea.url&&ja.layerId===ca.relatedTableId)}const O=t.getLogger("esri.widgets.Feature.support.featureUtils"),S=/href=(""|'')/gi,R=/(\{([^\{\r\n]+)\})/g,Q=/'/g,V=/^\s*expression\//i,aa=/(\n)/gi,X=/[\u00A0-\u9999<>&]/gim,W=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,T=/^(?:mailto:|tel:)/,U=m.convertDateFormatToIntlOptions("short-date-short-time"),Y=da=>{if(!da)return!1;da=da.toUpperCase();return da.includes("CURRENT_TIMESTAMP")||da.includes("CURRENT_DATE")||
da.includes("CURRENT_TIME")},ba=({layer:da,method:ea,query:ca,definitionExpression:ja})=>{da.capabilities?.query?.supportsCacheHint&&"attachments"!==ea&&(da=n.isSome(ca.where)?ca.where:null,ea=n.isSome(ca.geometry)?ca.geometry:null,Y(ja)||Y(da)||"extent"===ea?.type||"tile"===ca.resultType||(ca.cacheHint=!0))};a.applyTextFormattingHTML=F;a.createfieldInfoMap=function(da,ea){const ca=new Map;if(!da)return ca;da.forEach(ja=>{const ia=k(ja.fieldName,ea);ja.fieldName=ia;ca.set(ia.toLowerCase(),ja)});return ca};
a.findRelatedLayer=function(da,ea,ca){return da&&ea&&ca?L(da.allLayers,ea,ca)||L(da.allTables,ea,ca):null};a.fixTokens=A;a.formatAttributes=function({fieldInfos:da,attributes:ea,layer:ca,graphic:ja,fieldInfoMap:ia,relatedInfos:Z}){const ha={};Z?.forEach(fa=>H({attributes:ha,relatedInfo:fa,fieldInfoMap:ia,fieldInfos:da,layer:ca}));ea&&Object.keys(ea).forEach(fa=>{ha[fa]=E({fieldName:fa,fieldInfos:da,fieldInfoMap:ia,layer:ca,value:ea[fa],graphic:ja})});return ha};a.formatEditInfo=function(da,ea){const {creatorField:ca,
creationDateField:ja,editorField:ia,editDateField:Z}=da;if(ea){da=ea[Z];if("number"===typeof da)return ea=ea[ia],{type:"edit",date:m.formatDate(da,U),user:ea};da=ea[ja];return"number"===typeof da?(ea=ea[ca],{type:"create",date:m.formatDate(da,U),user:ea}):null}};a.formatValueToFieldInfo=u;a.getAllFieldInfos=function(da){const ea=[];if(!da)return ea;const {fieldInfos:ca,content:ja}=da;ca&&ea.push(...ca);if(!ja||!Array.isArray(ja))return ea;ja.forEach(ia=>{"fields"===ia.type&&(ia=ia&&ia.fieldInfos)&&
ea.push(...ia)});return ea};a.getFieldInfo=y;a.getFieldInfoLabel=function(da,ea){return(ea=q(ea,da?.fieldName))?ea.title||null:da?da.label||da.fieldName:null};a.getFixedFieldName=k;a.getFixedFieldNames=function(da,ea){return da&&da.map(ca=>k(ca,ea))};a.getSourceLayer=function(da){if(!n.isNone(da))return da.get("sourceLayer")||da.get("layer")};a.graphicCallback=function(da,ea){return l.apply(this,arguments)};a.htmlEntities=function(da){return da.replace(X,ea=>`&#${ea.charCodeAt(0)};`)};a.isExpressionField=
v;a.isRelatedField=I;a.preLayerQueryCallback=({query:da,layer:ea,method:ca})=>{ba({layer:ea,method:ca,query:da,definitionExpression:`${ea.definitionExpression} ${ea.serviceDefinitionExpression}`})};a.preRequestCallback=({queryPayload:da,layer:ea,method:ca})=>{ba({layer:ea,method:ca,query:da,definitionExpression:`${ea.definitionExpression} ${ea.serviceDefinitionExpression}`})};a.querySourceLayer=K;a.queryUpdatedFeature=function(da,ea){return P.apply(this,arguments)};a.shouldOpenInNewTab=function(da=
""){if(da)return!T.test(da.trim().toLowerCase())};a.substituteAttributes=z;a.substituteFieldsInLinksAndAttributes=function({attributes:da,globalAttributes:ea,layer:ca,text:ja,expressionAttributes:ia,fieldInfoMap:Z}){return ja?z({formattedAttributes:ea,template:x(ja,{...ea,...ia,...da},ca),fieldInfoMap:Z}):""};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["exports","../../../assets"],function(a,c){a.getIconPath=
function(b){const t=c.getAssetUrl("esri/themes/base/images/files/");return b?"text/plain"===b?`${t}text-32.svg`:"application/pdf"===b?`${t}pdf-32.svg`:"text/csv"===b?`${t}csv-32.svg`:"application/gpx+xml"===b?`${t}gpx-32.svg`:"application/x-dwf"===b?`${t}cad-32.svg`:"application/postscript"===b||"application/json"===b||"text/xml"===b||"model/vrml"===b?`${t}code-32.svg`:"application/x-zip-compressed"===b||"application/x-7z-compressed"===b||"application/x-gzip"===b||"application/x-tar"===b||"application/x-gtar"===
b||"application/x-bzip2"===b||"application/gzip"===b||"application/x-compress"===b||"application/x-apple-diskimage"===b||"application/x-rar-compressed"===b||"application/zip"===b?`${t}zip-32.svg`:b.includes("image/")?`${t}image-32.svg`:b.includes("audio/")?`${t}sound-32.svg`:b.includes("video/")?`${t}video-32.svg`:b.includes("msexcel")||b.includes("ms-excel")||b.includes("spreadsheetml")?`${t}excel-32.svg`:b.includes("msword")||b.includes("ms-word")||b.includes("wordprocessingml")?`${t}word-32.svg`:
b.includes("powerpoint")||b.includes("presentationml")?`${t}report-32.svg`:`${t}generic-32.svg`:`${t}generic-32.svg`};a.isSupportedImage=function(b){b=b.toLowerCase();return"image/bmp"===b||"image/emf"===b||"image/exif"===b||"image/gif"===b||"image/x-icon"===b||"image/jpeg"===b||"image/png"===b||"image/tiff"===b||"image/x-wmf"===b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../Attachments/AttachmentsViewModel".split(" "),
function(a,c,b,t,n,r,m){t=function(d){function f(e){e=d.call(this,e)||this;e.description=null;e.title=null;return e}a._inheritsLoose(f,d);return f}(m);c.__decorate([b.property()],t.prototype,"description",void 0);c.__decorate([b.property()],t.prototype,"title",void 0);return t=c.__decorate([r.subclass("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],t)})},"esri/widgets/Feature/support/FeatureElementInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../Widget ../../support/Heading ../../support/widgetUtils ../../support/jsxFactory".split(" "),
function(a,c,b,t,n,r,m,d,f,e){t=function(g){function h(v,q){v=g.call(this,v,q)||this;v.description=null;v.headingLevel=2;v.title=null;return v}a._inheritsLoose(h,g);var l=h.prototype;l.render=function(){return e.tsx("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())};l.renderTitle=function(){const {title:v}=this;return v?e.tsx(d.Heading,{level:this.headingLevel,class:"esri-feature-element-info__title"},v):null};l.renderDescription=function(){const {description:v}=
this;return v?e.tsx("div",{key:"description",class:"esri-feature-element-info__description"},v):null};return h}(m);c.__decorate([b.property()],t.prototype,"description",void 0);c.__decorate([b.property()],t.prototype,"headingLevel",void 0);c.__decorate([b.property()],t.prototype,"title",void 0);return t=c.__decorate([r.subclass("esri.widgets.Feature.support.FeatureElementInfo")],t)})},"esri/widgets/support/Heading":function(){define(["exports","../../core/mathUtils","./widgetUtils","./jsxFactory"],
function(a,c,b,t){const n={heading:"esri-widget__heading"};a.CSS=n;a.Heading=function({level:r,class:m,...d},f){r=c.clamp(Math.ceil(r),1,6);return t.tsx(`h${r}`,{...d,class:b.classes(n.heading,m),role:"heading","aria-level":String(r)},f)};a.incrementHeadingLevel=function(r,m=1){return c.clamp(Math.ceil(r+m),1,6)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureContent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent/FeatureContentViewModel ./support/featureUtils ../support/widget ../support/jsxFactory".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){t=function(h){function l(q,k){q=h.call(this,q,k)||this;q.viewModel=null;q._addTargetToAnchors=p=>{Array.from(p.querySelectorAll("a")).forEach(z=>{f.shouldOpenInNewTab(z.href)&&!z.hasAttribute("target")&&z.setAttribute("target","_blank")})};return q}a._inheritsLoose(l,h);var v=l.prototype;v.renderLoading=function(){return g.tsx("div",{class:"esri-feature-content__loader-container",key:"loader"},g.tsx("div",{class:"esri-feature-content__loader"}))};v.renderCreated=function(){const q=
this.viewModel?.created;return q?q instanceof HTMLElement?g.tsx("div",{key:q,bind:q,afterCreate:this._attachToNode}):e.isWidget(q)?g.tsx("div",{key:q},!q.destroyed&&q.render()):g.tsx("div",{key:q,innerHTML:q,afterCreate:this._addTargetToAnchors}):null};v.render=function(){return g.tsx("div",{class:"esri-feature-content"},"loading"===this.viewModel?.state?this.renderLoading():this.renderCreated())};v._attachToNode=function(q){q.appendChild(this)};a._createClass(l,[{key:"creator",get:function(){return this.viewModel?.creator},
set:function(q){this.viewModel&&(this.viewModel.creator=q)}},{key:"graphic",get:function(){return this.viewModel?.graphic},set:function(q){this.viewModel&&(this.viewModel.graphic=q)}}]);return l}(m);c.__decorate([b.property()],t.prototype,"creator",null);c.__decorate([b.property()],t.prototype,"graphic",null);c.__decorate([b.property({type:d})],t.prototype,"viewModel",void 0);return t=c.__decorate([r.subclass("esri.widgets.Feature.FeatureContent")],t)})},"esri/widgets/Feature/FeatureContent/FeatureContentViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../support/featureUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){t=function(h){function l(q){var k=h.call(this,q)||this;k._loadingPromise=null;k.created=null;k.creator=null;k.destroyer=null;k.graphic=null;k.handles.add(r.watch(()=>k.creator,p=>{k._destroyContent();k._createContent(p)},r.initial));return k}a._inheritsLoose(l,h);var v=l.prototype;v.destroy=function(){this._destroyContent()};v._destroyContent=function(){const {created:q,graphic:k,destroyer:p}=this;q&&k&&(g.graphicCallback(p,{graphic:k}).catch(()=>null),this._set("created",
null))};v._createContent=function(){var q=a._asyncToGenerator(function*(k){var p=this.graphic;p&&k&&(this._loadingPromise=k=g.graphicCallback(k,{graphic:p}).catch(()=>null),this.notifyChange("state"),p=yield k,k===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",p)))});return function(k){return q.apply(this,arguments)}}();a._createClass(l,[{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}}]);return l}(n.HandleOwnerMixin(t));c.__decorate([m.property({readOnly:!0})],
t.prototype,"created",void 0);c.__decorate([m.property()],t.prototype,"creator",void 0);c.__decorate([m.property()],t.prototype,"destroyer",void 0);c.__decorate([m.property({type:b})],t.prototype,"graphic",void 0);c.__decorate([m.property({readOnly:!0})],t.prototype,"state",null);return t=c.__decorate([e.subclass("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],t)})},"esri/widgets/Feature/FeatureExpression":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent ./FeatureFields ./FeatureMedia ./FeatureExpression/FeatureExpressionViewModel ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){n=function(q){function k(z,C){z=q.call(this,z,C)||this;z._contentWidget=null;z.viewModel=new h;return z}a._inheritsLoose(k,q);var p=k.prototype;p.initialize=function(){this.addHandles(b.watch(()=>this.viewModel?.contentElementViewModel,()=>this._setupExpressionWidget(),b.initial))};p.destroy=function(){this._destroyContentWidget()};p.renderLoading=function(){return v.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},v.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating",
"esri-feature__loading-spinner")}))};p.render=function(){const {state:z}=this.viewModel;return v.tsx("div",{class:"esri-feature-expression"},"loading"===z?this.renderLoading():"disabled"===z?null:this._contentWidget?.render())};p._destroyContentWidget=function(){const {_contentWidget:z}=this;z&&(z.viewModel=null,z.destroy());this._contentWidget=null};p._setupExpressionWidget=function(){const {contentElementViewModel:z,contentElement:C}=this.viewModel,B=C?.type;this._destroyContentWidget();this._contentWidget=
z?"fields"===B?new e({viewModel:z}):"media"===B?new g({viewModel:z}):"text"===B?new f({viewModel:z}):null:null;this.scheduleRender()};return k}(d);c.__decorate([t.property({type:h})],n.prototype,"viewModel",void 0);return n=c.__decorate([m.subclass("esri.widgets.Feature.FeatureExpression")],n)})},"esri/widgets/Feature/FeatureFields":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureFields/FeatureFieldsViewModel ./support/FeatureElementInfo ../support/uriUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){n=function(q){function k(z,C){z=q.call(this,z,C)||this;z._featureElementInfo=null;z.viewModel=new f;z.messages=null;z.messagesURIUtils=null;return z}a._inheritsLoose(k,q);var p=k.prototype;p.initialize=function(){this._featureElementInfo=new e;this.addHandles(b.watch(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),b.initial))};p.destroy=function(){this._featureElementInfo?.destroy()};p.renderFieldInfo=function(z,C){var {attributes:B}=
this.viewModel;const A=z.fieldName,x=z.label||A;B=B?null==B[A]?"":B[A]:"";z=!(!z.format||!z.format.dateFormat);B="number"!==typeof B||z?g.autoLink(this.messagesURIUtils,B):this._forceLTR(B);z={["esri-feature-fields__field-data--date"]:z};return v.tsx("tr",{key:`fields-element-info-row-${A}-${C}`},v.tsx("th",{key:`fields-element-info-row-header-${A}-${C}`,class:"esri-feature-fields__field-header",innerHTML:x}),v.tsx("td",{key:`fields-element-info-row-data-${A}-${C}`,class:this.classes("esri-feature-fields__field-data",
z),innerHTML:B}))};p.renderFields=function(){const {formattedFieldInfos:z}=this.viewModel;return z?.length?v.tsx("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},v.tsx("tbody",null,z.map((C,B)=>this.renderFieldInfo(C,B)))):null};p.render=function(){return v.tsx("div",{class:"esri-feature-fields"},this._featureElementInfo?.render(),this.renderFields())};p._setupFeatureElementInfo=function(){const {description:z,title:C}=this;this._featureElementInfo?.set({description:z,title:C})};
p._forceLTR=function(z){return`&lrm;${z}`};a._createClass(k,[{key:"attributes",get:function(){return this.viewModel.attributes},set:function(z){this.viewModel.attributes=z}},{key:"description",get:function(){return this.viewModel.description},set:function(z){this.viewModel.description=z}},{key:"expressionInfos",get:function(){return this.viewModel.expressionInfos},set:function(z){this.viewModel.expressionInfos=z}},{key:"fieldInfos",get:function(){return this.viewModel.fieldInfos},set:function(z){this.viewModel.fieldInfos=
z}},{key:"title",get:function(){return this.viewModel.title},set:function(z){this.viewModel.title=z}}]);return k}(d);c.__decorate([t.property()],n.prototype,"attributes",null);c.__decorate([t.property()],n.prototype,"description",null);c.__decorate([t.property()],n.prototype,"expressionInfos",null);c.__decorate([t.property()],n.prototype,"fieldInfos",null);c.__decorate([t.property()],n.prototype,"title",null);c.__decorate([t.property({type:f,nonNullable:!0})],n.prototype,"viewModel",void 0);c.__decorate([t.property(),
l.messageBundle("esri/widgets/Feature/t9n/Feature")],n.prototype,"messages",void 0);c.__decorate([t.property(),l.messageBundle("esri/widgets/support/t9n/uriUtils")],n.prototype,"messagesURIUtils",void 0);return n=c.__decorate([m.subclass("esri.widgets.Feature.FeatureFields")],n)})},"esri/widgets/Feature/FeatureFields/FeatureFieldsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../support/featureUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e){b=function(g){function h(l){l=g.call(this,l)||this;l.attributes=null;l.expressionInfos=null;l.description=null;l.fieldInfos=null;l.title=null;return l}a._inheritsLoose(h,g);a._createClass(h,[{key:"formattedFieldInfos",get:function(){const {expressionInfos:l,fieldInfos:v}=this,q=[];v?.forEach(k=>{if(!k.hasOwnProperty("visible")||k.visible)k=k.clone(),k.label=e.getFieldInfoLabel(k,l),q.push(k)});return q}}]);return h}(b);c.__decorate([t.property()],b.prototype,"attributes",
void 0);c.__decorate([t.property({type:[d]})],b.prototype,"expressionInfos",void 0);c.__decorate([t.property()],b.prototype,"description",void 0);c.__decorate([t.property({type:[f]})],b.prototype,"fieldInfos",void 0);c.__decorate([t.property({readOnly:!0})],b.prototype,"formattedFieldInfos",null);c.__decorate([t.property()],b.prototype,"title",void 0);return b=c.__decorate([m.subclass("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],b)})},"esri/widgets/support/uriUtils":function(){define(["exports",
"../../core/string"],function(a,c){function b(n){let r=null;t.some(m=>{m.pattern.test(n)&&(r=m);return!!r});return r}const t=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Collector"},{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",
appName:"Workforce"},{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];a.autoLink=function(n,r){if("string"!==typeof r||!r)return r;const m=b(r);if(!m)return r;const d=r.match(m.pattern);
n=c.replace(c.replace(m.label,{messages:n,hierPart:d&&d[2]}),{appName:m.appName});return r.replace(m.pattern,`<a${m.target?` target="${m.target}"`:""} href="$1"${"_blank"===m.target?' rel\x3d"noreferrer"':""}>${n}</a>`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureMedia":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/events ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../renderers/support/utils ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../support/themeUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){r=function(C){function B(x,u){var y=C.call(this,x,u)||this;y._refreshTimer=null;y._refreshIntervalInfo=null;y._featureElementInfo=null;y.viewModel=new g;y.messages=null;y._getChartDependencies=function(){var w=a._asyncToGenerator(function*(D){const F=yield v.loadChartsModule(),{destroyed:E,viewModel:K}=a._assertThisInitialized(y);if(!E&&K&&D){var {activeMediaInfo:J}=K,M=yield y._getRendererColors(F);y._renderChart({chartDiv:D,mediaInfo:J,chartsModule:F,
colorMap:M})}});return function(D){return w.apply(this,arguments)}}();return y}a._inheritsLoose(B,C);var A=B.prototype;A.initialize=function(){this._featureElementInfo=new h;this.addHandles([t.watch(()=>[this.viewModel?.activeMediaInfo,this.viewModel?.activeMediaInfoIndex],()=>this._setupMediaRefreshTimer(),t.initial),t.watch(()=>[this.viewModel?.description,this.viewModel?.title],()=>this._setupFeatureElementInfo(),t.initial)])};A.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo?.destroy()};
A.render=function(){return p.tsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},this._featureElementInfo?.render(),this.renderMedia())};A.renderMedia=function(){const {formattedMediaInfoCount:x}=this.viewModel;return x?p.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null};A.renderImageMediaInfo=function(x){var {_refreshIntervalInfo:u}=this;
const {activeMediaInfoIndex:y,formattedMediaInfoCount:w}=this.viewModel,{value:D,refreshInterval:F,altText:E,title:K,type:J}=x,{sourceURL:M,linkURL:N}=D;x=l.shouldOpenInNewTab(N??void 0)?"_blank":"_self";const P="_blank"===x?"noreferrer":"";u=F?u:null;u=p.tsx("img",{alt:E||K,key:`media-${J}-${y}-${w}-${u?u.timestamp:0}`,src:(u?u.sourceURL:M)??void 0});return(x=N?p.tsx("a",{title:K,href:N,rel:P,target:x},u):null)?x:u};A.renderChartMediaInfo=function(x){const {activeMediaInfoIndex:u,formattedMediaInfoCount:y}=
this.viewModel;return p.tsx("div",{key:`media-${x.type}-${u}-${y}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};A.renderMediaInfoType=function(){const {activeMediaInfo:x}=this.viewModel;return x?"image"===x.type?this.renderImageMediaInfo(x):x.type.includes("chart")?this.renderChartMediaInfo(x):null:null};A.renderMediaInfo=function(){var {activeMediaInfo:x}=this.viewModel;if(!x)return null;const u=x.title?p.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",
innerHTML:x.title}):null;x=x.caption?p.tsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:x.caption}):null;return p.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},p.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),u,x)};A.renderMediaPageButton=function(x){if(2>this.viewModel.formattedMediaInfoCount)return null;const u=(x="previous"===x)?this.messages.previous:this.messages.next,y=x?this.classes("esri-feature-media__button",
"esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),w=x?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),D=x?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl",
"esri-icon-left-triangle-arrow");return p.tsx("button",{type:"button",key:x?"media-previous":"media-next",title:u,"aria-label":u,tabIndex:0,class:y,bind:this,onclick:x?this._previous:this._next},p.tsx("span",{"aria-hidden":"true",class:w}),p.tsx("span",{"aria-hidden":"true",class:D}))};A._setupFeatureElementInfo=function(){const {description:x,title:u}=this;this._featureElementInfo?.set({description:x,title:u})};A._next=function(){this.viewModel.next()};A._previous=function(){this.viewModel.previous()};
A._getRenderer=function(){const {isAggregate:x,layer:u}=this.viewModel;return x&&u?.featureReduction&&"renderer"in u.featureReduction?u.featureReduction.renderer:u?.renderer};A._getRendererColors=function(){var x=a._asyncToGenerator(function*(u){const {am4core:y}=u,w=new Map;u=this._getRenderer();if(!u)return w;const D=yield f.getColorsFromRenderer(u);D.delete("default");if(!Array.from(D.values()).every(F=>1===F?.length))return w;w.set("default-line-value",y.color({r:50,g:50,b:50,a:1}));Array.from(D.keys()).forEach(F=>
{F&&w.set(F,y.color(D.get(F)?.[0].toCss(!0)))});return w});return function(u){return x.apply(this,arguments)}}();A._handleMediaKeyup=function(x){const u=b.eventKey(x);"ArrowLeft"===u&&(x.stopPropagation(),this.viewModel.previous());"ArrowRight"===u&&(x.stopPropagation(),this.viewModel.next())};A._renderChart=function(x){const {abilities:u}=this.viewModel,{chartsModule:y,chartDiv:w,mediaInfo:D,colorMap:F}=x,{value:E,type:K}=D,{am4core:J}=y,M=v.getColorSet(J);z.isDarkTheme()&&J.useTheme(y.am4themes_dark);
const N=window.matchMedia("(prefers-reduced-motion: reduce)");u.chartAnimation&&!N.matches?J.useTheme(y.am4themes_animated):J.unuseTheme(y.am4themes_animated);J.useTheme(function(P){P instanceof J.ColorSet&&M&&(P.list=M)});x="pie-chart"===K?this._createPieChart(x):this._createXYChart(x);w.setAttribute("aria-label",D.altText||D.title);x.data=E.series.map(P=>({tooltip:P.tooltip,value:P.value,color:F.get(P.fieldName)})).filter(P=>"pie-chart"===K?null!=P.value&&0<P.value:!0)};A._customizeChartTooltip=
function(x,u){x&&(x.label.wrap=!0,x.label.maxWidth=200,x.autoTextColor=!1,x.getFillFromObject=!1,x.label.fill=u.color("#ffffff"),x.background.fill=u.color({r:0,g:0,b:0,a:.7}))};A._createPieChart=function(x){const {chartDiv:u,chartsModule:y}=x,{am4core:w,am4charts:D}=y;x=w.create(u,D.PieChart);x.rtl=q.isRTL(this.container);const F=x.series.push(new D.PieSeries);F.labels.template.disabled=!0;F.ticks.template.disabled=!0;F.dataFields.value="value";F.dataFields.category="tooltip";this._customizeChartTooltip(F.tooltip,
w);F.slices.template.propertyFields.fill="color";F.slices.template.propertyFields.stroke="color";return x};A._getMinSeriesValue=function(x){let u=0;x.forEach(y=>u=Math.min(y.value,u));return u};A._createColumnChart=function(x,u){const {chartsModule:y,mediaInfo:w}=u;({value:u}=w);const {am4core:D,am4charts:F}=y;var E=x.xAxes.push(new F.CategoryAxis);E.dataFields.category="tooltip";E.renderer.labels.template.disabled=!0;const K=E.tooltip;this._customizeChartTooltip(K,D);K.events.on("sizechanged",()=>
{K.dy=-K.contentHeight});E=x.yAxes.push(new F.ValueAxis);const J=E.renderer.labels.template;E.renderer.minLabelPosition=.05;E.renderer.maxLabelPosition=.95;E.min=this._getMinSeriesValue(u.series);this._customizeChartTooltip(E.tooltip,D);J.wrap=!0;E=x.series.push(new F.ColumnSeries);E.dataFields.valueY="value";E.dataFields.categoryX="tooltip";E.columns.template.propertyFields.fill="color";E.columns.template.propertyFields.stroke="color";x.cursor=new F.XYCursor;15<u.series.length&&(x.scrollbarX=new D.Scrollbar)};
A._createBarChart=function(x,u){const {chartsModule:y,mediaInfo:w}=u;({value:u}=w);const {am4core:D,am4charts:F}=y;var E=x.yAxes.push(new F.CategoryAxis);E.dataFields.category="tooltip";E.renderer.inversed=!0;E.renderer.labels.template.disabled=!0;const K=E.tooltip;this._customizeChartTooltip(K,D);K.events.on("sizechanged",()=>{K.dx=K.contentWidth});E=x.xAxes.push(new F.ValueAxis);const J=E.renderer.labels.template;E.renderer.minLabelPosition=.05;E.renderer.maxLabelPosition=.95;E.min=this._getMinSeriesValue(u.series);
this._customizeChartTooltip(E.tooltip,D);J.wrap=!0;E=x.series.push(new F.ColumnSeries);E.dataFields.valueX="value";E.dataFields.categoryY="tooltip";E.columns.template.propertyFields.fill="color";E.columns.template.propertyFields.stroke="color";x.cursor=new F.XYCursor;15<u.series.length&&(x.scrollbarY=new D.Scrollbar)};A._createLineChart=function(x,u){const {chartsModule:y,mediaInfo:w,colorMap:D}=u;({value:u}=w);const {am4core:F,am4charts:E}=y;var K=x.xAxes.push(new E.CategoryAxis);K.dataFields.category=
"tooltip";K.renderer.labels.template.disabled=!0;const J=K.tooltip;this._customizeChartTooltip(J,F);J.events.on("sizechanged",()=>{J.dy=-J.contentHeight});K=x.yAxes.push(new E.ValueAxis);var M=K.renderer.labels.template;K.renderer.minLabelPosition=.05;K.renderer.maxLabelPosition=.95;K.min=this._getMinSeriesValue(u.series);this._customizeChartTooltip(K.tooltip,F);M.wrap=!0;K=x.series.push(new E.LineSeries);K.dataFields.categoryX="tooltip";K.dataFields.valueY="value";K.strokeWidth=1;if(M=D.get("default-line-value"))K.stroke=
M;K=K.bullets.push(new E.CircleBullet);K.propertyFields.fill="color";K.propertyFields.stroke="color";x.cursor=new E.XYCursor;15<u.series.length&&(x.scrollbarX=new F.Scrollbar)};A._createXYChart=function(x){const {chartDiv:u,chartsModule:y,mediaInfo:w}=x,{type:D}=w,{am4core:F,am4charts:E}=y,K=F.create(u,E.XYChart);K.rtl=q.isRTL(this.container);"column-chart"===D&&this._createColumnChart(K,x);"bar-chart"===D&&this._createBarChart(K,x);"line-chart"===D&&this._createLineChart(K,x);return K};A._clearMediaRefreshTimer=
function(){const {_refreshTimer:x}=this;x&&(clearTimeout(x),this._refreshTimer=null)};A._updateMediaInfoTimestamp=function(x){const u=Date.now();this._refreshIntervalInfo={timestamp:u,sourceURL:x&&this._getImageSource(x,u)};this.scheduleRender()};A._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:x}=this.viewModel;x&&"image"===x.type&&x.refreshInterval&&this._setRefreshTimeout(x)};A._setRefreshTimeout=function(x){const {refreshInterval:u,value:y}=x;u&&(x=6E4*
u,this._updateMediaInfoTimestamp(y.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(y.sourceURL)},x))};A._getImageSource=function(x,u){const y=x.includes("?")?"\x26":"?",[w,D=""]=x.split("#");return`${w}${y}timestamp=${u}${D?"#":""}${D}`};a._createClass(B,[{key:"attributes",get:function(){return this.viewModel.attributes},set:function(x){this.viewModel.attributes=x}},{key:"activeMediaInfoIndex",get:function(){return this.viewModel.activeMediaInfoIndex},set:function(x){this.viewModel.activeMediaInfoIndex=
x}},{key:"description",get:function(){return this.viewModel.description},set:function(x){this.viewModel.description=x}},{key:"fieldInfoMap",get:function(){return this.viewModel.fieldInfoMap},set:function(x){this.viewModel.fieldInfoMap=x}},{key:"layer",get:function(){return this.viewModel.layer},set:function(x){this.viewModel.layer=x}},{key:"mediaInfos",get:function(){return this.viewModel.mediaInfos},set:function(x){this.viewModel.mediaInfos=x}},{key:"popupTemplate",get:function(){return this.viewModel.popupTemplate},
set:function(x){this.viewModel.popupTemplate=x}},{key:"relatedInfos",get:function(){return this.viewModel.relatedInfos},set:function(x){this.viewModel.relatedInfos=x}},{key:"title",get:function(){return this.viewModel.title},set:function(x){this.viewModel.title=x}}]);return B}(e);c.__decorate([n.property()],r.prototype,"attributes",null);c.__decorate([n.property()],r.prototype,"activeMediaInfoIndex",null);c.__decorate([n.property()],r.prototype,"description",null);c.__decorate([n.property()],r.prototype,
"fieldInfoMap",null);c.__decorate([n.property()],r.prototype,"layer",null);c.__decorate([n.property()],r.prototype,"mediaInfos",null);c.__decorate([n.property()],r.prototype,"popupTemplate",null);c.__decorate([n.property()],r.prototype,"relatedInfos",null);c.__decorate([n.property()],r.prototype,"title",null);c.__decorate([n.property({type:g})],r.prototype,"viewModel",void 0);c.__decorate([n.property(),k.messageBundle("esri/widgets/Feature/t9n/Feature")],r.prototype,"messages",void 0);return r=c.__decorate([d.subclass("esri.widgets.Feature.FeatureMedia")],
r)})},"esri/renderers/support/utils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/MapUtils ../../core/maybe ../../intl/date ./numberUtils ../visualVariables/support/ColorStop ../../symbols/support/utils ../../widgets/Legend/support/colorRampUtils ../../widgets/Legend/support/heatmapRampUtils".split(" "),function(a,c,b,t,n,r,m,d,f,e,g,h){function l(x,u,y){return v.apply(this,arguments)}function v(){v=c._asyncToGenerator(function*(x,
u,y){n.getOrCreateMapValue(x,u,()=>[]).push(...y)});return v.apply(this,arguments)}function q(){q=c._asyncToGenerator(function*(x){const u=new Map;if(!x)return u;if("visualVariables"in x&&x.visualVariables){var y=x.visualVariables.filter(D=>"color"===D.type);for(var w of y)y=((yield g.getRampStops(w))??[]).map(D=>D.color),yield l(u,w.field||w.valueExpression,y)}if("heatmap"===x.type)w=h.getHeatmapRampStops(x).map(D=>D.color),yield l(u,x.field||x.valueExpression,w);else if("pie-chart"===x.type){for(const D of x.attributes)yield l(u,
D.field||D.valueExpression,[D.color]);yield l(u,"default",[x?.othersCategory?.color,e.getColorFromSymbol(x.backgroundFillSymbol,null)])}else if("dot-density"===x.type){for(const D of x.attributes)yield l(u,D.field||D.valueExpression,[D.color]);yield l(u,"default",[x.backgroundColor])}else if("unique-value"===x.type)if("predominance"===x.authoringInfo?.type)for(const D of x.uniqueValueInfos??[])yield l(u,D.value.toString(),[e.getColorFromSymbol(D.symbol,null)]);else{w=(x.uniqueValueInfos??[]).map(J=>
e.getColorFromSymbol(J.symbol,null));const {field:D,field2:F,field3:E,valueExpression:K}=x;if(D||K)yield l(u,D||K,w);F&&(yield l(u,F,w));E&&(yield l(u,E,w))}else if("class-breaks"===x.type){w=x.classBreakInfos.map(E=>e.getColorFromSymbol(E.symbol,null));const {field:D,valueExpression:F}=x;yield l(u,D??F,w)}else"simple"===x.type&&(yield l(u,"default",[e.getColorFromSymbol(x.symbol,null)]));"defaultSymbol"in x&&x.defaultSymbol&&(yield l(u,"default",[e.getColorFromSymbol(x.defaultSymbol,null)]));u.forEach((D,
F)=>{D=b.unique(D.filter(Boolean),(E,K)=>JSON.stringify(E)===JSON.stringify(K));u.set(F,D)});return u});return q.apply(this,arguments)}function k(x){let u=x.minValue,y=x.maxValue;const w=x.isFirstBreak?"":C.gt+" ";x="percent-of-total"===x.normalizationType?C.pct:"";u=null==u?"":d.format(u);y=null==y?"":d.format(y);return w+u+x+" "+C.ld+" "+y+x}function p(x,u){return"normalizationField"in x&&x.normalizationField?{type:"normalized-field",field:x.field,normalizationField:x.normalizationField}:"field"in
x&&x.field?{type:"field",field:x.field}:"valueExpression"in x&&x.valueExpression?{type:"expression",expression:x.valueExpression,title:x.valueExpressionTitle,returnType:u}:null}const z=t.getLogger("esri.renderers.support.utils"),C={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},B={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},A={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",
day:"long-month-day-year",month:"long-month-day-year",year:"year"};t=m.convertDateFormatToIntlOptions("short-date");a.calculateDateFormatInterval=function(x){x=x.map(F=>new Date(F));const u=x.length;let y=Infinity,w=null;for(let F=0;F<u-1;F++){const E=x[F];let K=Infinity,J=null;for(let M=F+1;M<u;M++){var D=x[M];D=E.getFullYear()!==D.getFullYear()&&"year"||E.getMonth()!==D.getMonth()&&"month"||E.getDate()!==D.getDate()&&"day"||E.getHours()!==D.getHours()&&"hour"||E.getMinutes()!==D.getMinutes()&&"minute"||
E.getSeconds()!==D.getSeconds()&&"second"||"millisecond";const N=B[D];N<K&&(K=N,J=D)}K<y&&(y=K,w=J)}return w};a.createClassBreakLabel=k;a.createColorStops=function(x){const {values:u,colors:y,labelIndexes:w,isDate:D,dateFormatOptions:F}=x;return u.map((E,K)=>{var J=null;if(!w||w.includes(K)){let M;if(M=D?m.formatDate(E,F):d.format(E))J="",0===K?J=C.lt+" ":K===u.length-1&&(J=C.gt+" "),J+=M}return new f({value:E,color:y[K],label:J})})};a.createUniqueValueLabel=function(x){const {value:u,domain:y,fieldInfo:w,
dateFormatInterval:D}=x;x=String(u);const F=y&&"codedValues"in y&&y.codedValues?y.getName(u):null;F?x=F:"number"===typeof u&&(x=w&&"date"===w.type?m.formatDate(u,D&&m.convertDateFormatToIntlOptions(A[D])):d.format(u));return x};a.getAttribute=p;a.getAttributes=function(x,u){const y=[];if("class-breaks"===x.type||"heatmap"===x.type)y.push(p(x,"number"));else if("unique-value"===x.type){var w=x.authoringInfo;if(w&&"relationship"===w.type){if(w.field1&&w.field2){var D=w.field2.field;const F=w.field2.normalizationField;
y.push(p({field:w.field1.field,normalizationField:w.field1.normalizationField}));y.push(p({field:D,normalizationField:F}))}}else D=x.uniqueValueInfos?.[0],w=null,D&&D.value&&(D=typeof x.uniqueValueInfos[0].value,"string"===D||"number"===D)&&(w=D),y.push(p(x,w)),[x.field2,x.field3].forEach(F=>F&&y.push({type:"field",field:F}))}else"attributes"in x&&x.attributes?.forEach(F=>y.push(p(F,"number")));(x=u?u(x):"visualVariables"in x?x.visualVariables:null)&&x.forEach(F=>y.push(p(F,"number")));return b.unique(y.filter(r.isSome),
(F,E)=>"field"===F.type&&"field"===E.type?F.field===E.field:"normalized-field"===F.type&&"normalized-field"===E.type?F.field===E.field&&F.normalizationField===E.normalizationField:"expression"===F.type&&"expression"===E.type?F.expression===E.expression:!1)};a.getColorsFromRenderer=function(x){return q.apply(this,arguments)};a.setLabelsForClassBreaks=function(x){const u=x.classBreakInfos,y=x.normalizationType;let w=[];if(u&&u.length)if("standard-deviation"===x.classificationMethod)z.warn("setLabelsForClassBreaks",
"cannot set labels for class breaks generated using 'standard-deviation' method.");else if(x.round){w.push(u[0].minValue);for(const D of u)w.push(D.maxValue);w=d.round(w);u.forEach((D,F)=>{D.label=k({minValue:0===F?w[0]:w[F],maxValue:w[F+1],isFirstBreak:0===F,normalizationType:y})})}else u.forEach((D,F)=>{D.label=k({minValue:D.minValue,maxValue:D.maxValue,isFirstBreak:0===F,normalizationType:y})})};a.timelineDateFormatOptions=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/numberUtils":function(){define(["exports",
"../../intl","../../intl/number"],function(a,c,b){function t(g,h){return g-h}function n(g,h){let l;l=Number(g.toFixed(h));l<g?g=l+1/10**h:(g=l,l-=1/10**h);l=Number(l.toFixed(h));g=Number(g.toFixed(h));return[l,g]}function r(g,h,l,v,q){g=d(g,h,l,v);h=null==g.next||g.next<=q;return(null==g.previous||g.previous<=q)&&h||g.previous+g.next<=2*q}function m(g){g=String(g);var h=g.match(f);if(h&&h[1])return{integer:h[1].split("").length,fractional:h[3]?h[3].split("").length:0};if(g.toLowerCase().includes("e")&&
(h=g.split("e"),g=h[0],h=h[1],g&&h)){g=Number(g);h=Number(h);const l=0<h;l||(h=Math.abs(h));g=m(g);l?(g.integer+=h,g.fractional=h>g.fractional?0:g.fractional-h):(g.fractional+=h,g.integer=h>g.integer?1:g.integer-h);return g}return{integer:0,fractional:0}}function d(g,h,l,v){const q={previous:null,next:null};if(null!=l){const k=g-l;q.previous=Math.floor(Math.abs(100*(h-l-k)/k))}null!=v&&(g=v-g,q.next=Math.floor(Math.abs(100*(v-h-g)/g)));return q}const f=/^-?(\d+)(\.(\d+))?$/i,e={maximumFractionDigits:20};
a.format=function(g){return b.formatNumber(g,e)};a.numDigits=m;a.percentChange=d;a.round=function(g,h={}){g=g.slice(0);const {tolerance:l=2,strictBounds:v=!1,indexes:q=g.map((p,z)=>z)}=h;q.sort(t);for(h=0;h<q.length;h++){const p=q[h],z=g[p],C=0===p?null:g[p-1],B=p===g.length-1?null:g[p+1],A=m(z).fractional;if(A){let x=0,u=!1;for(var k=void 0;x<=A&&!u;)k=n(z,x),k=v&&0===h?k[1]:k[0],u=r(z,k,C,B,l),x++;u&&(g[p]=k)}}return g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/utils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){function v(M){M=M.symbolLayers;if(!M)return null;let N=null;M.forEach(P=>{if("object"!==P.type||null==P.resource?.href)N="water"===P.type?d.unwrap(P.color):d.isSome(P.material)?d.unwrap(P.material.color):null});return N?new t(N):null}function q(M,N){if(null==N||null==M)return M;M=M.toRgba();M[3]*=N;return new t(M)}function k(M,N,P){if(M=M.symbolLayers){var I=G=>{G=d.isSome(G)?G:null;N=N??G??(null!=P?J:null);return q(N,P)};M.forEach(G=>{if("object"!==G.type||null==
G.resource?.href||N)if("water"===G.type)G.color=I(G.color);else{var H=d.isSome(G.material)?G.material.color:null;H=I(H);d.isNone(G.material)?G.material=new l.Symbol3DMaterial({color:H}):G.material.color=H;null!=P&&"outline"in G&&d.isSome(G.outline)&&d.isSome(G.outline.color)&&(G.outline.color=q(G.outline.color,P))}})}}function p(M,N){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(M,N){(M=M.symbolLayers)&&(yield r.forEach(M,function(){var P=b._asyncToGenerator(function*(I){return C(I,
N)});return function(I){return P.apply(this,arguments)}}()))});return z.apply(this,arguments)}function C(M,N){return B.apply(this,arguments)}function B(){B=b._asyncToGenerator(function*(M,N){switch(M.type){case "extrude":M.size="number"===typeof N[2]?N[2]:0;break;case "icon":case "line":case "text":N=A(N);d.isSome(N)&&(M.size=N);break;case "path":const P=y(N,e.ONES,[M.width,void 0,M.height]);M.width=F(N[0],M.width,1,P);M.height=F(N[2],M.height,1,P);break;case "object":yield x(M,N)}});return B.apply(this,
arguments)}function A(M){for(const N of M)if("number"===typeof N)return N;return null}function x(M,N){return u.apply(this,arguments)}function u(){u=b._asyncToGenerator(function*(M,N){const {resourceSize:P,symbolSize:I}=yield w(M),G=y(N,P,I);M.width=F(N[0],I[0],P[0],G);M.depth=F(N[1],I[1],P[1],G);M.height=F(N[2],I[2],P[2],G)});return u.apply(this,arguments)}function y(M,N,P){for(let I=0;3>I;I++){const G=M[I];switch(G){case "symbol-value":return M=P[I],null!=M?M/N[I]:1;case "proportional":break;default:if(G&&
N[I])return G/N[I]}}return 1}function w(M){return D.apply(this,arguments)}function D(){D=b._asyncToGenerator(function*(M){const N=yield(yield new Promise((O,S)=>a(["./symbolLayerUtils"],O,S))).computeObjectLayerResourceSize(M,10),{width:P,height:I,depth:G}=M;M=[P,G,I];let H=1;for(var L=0;3>L;L++){const O=M[L];if(null!=O){H=O/N[L];break}}for(L=0;3>L;L++)null==M[L]&&(M[L]=N[L]*H);return{resourceSize:N,symbolSize:M}});return D.apply(this,arguments)}function F(M,N,P,I){switch(M){case "proportional":return P*
I;case "symbol-value":return null!=N?N:P;default:return M}}function E(){E=b._asyncToGenerator(function*(M,N){if(M&&N){if(n.isSymbol3D(M))return p(M,N);if(n.isSymbol2D(M)&&(N=A(N),!d.isNone(N)))switch(M.type){case "simple-marker":M.size=N;break;case "picture-marker":const P=M.width/M.height;1<P?(M.width=N,M.height=N*P):(M.width=N*P,M.height=N);break;case "simple-line":M.width=N;break;case "text":M.font.size=N}}});return E.apply(this,arguments)}function K(){K=b._asyncToGenerator(function*(M,N){const P=
yield M.fetchSymbol(N);return P?P:M.fetchCIMSymbol(N)});return K.apply(this,arguments)}const J=new t("white");c.applyColorToSymbol=function(M,N,P){if(M&&(N||null!=P))if(N&&(N=new t(N)),n.isSymbol3D(M))k(M,N,P);else if(n.isSymbol2D(M)){if(N=N??M.color)M.color=q(N,P);null!=P&&"outline"in M&&M.outline&&M.outline.color&&(M.outline.color=q(M.outline.color,P))}};c.applyOpacityToColor=q;c.applyRotationToSymbol=function(M,N,P){M&&null!=N&&(n.isSymbol3D(M)?(M=M.symbolLayers)&&M.forEach(I=>{if(I&&"object"===
I.type)switch(P){case "tilt":I.tilt=N;break;case "roll":I.roll=N;break;default:I.heading=N}}):!n.isSymbol2D(M)||"simple-marker"!==M.type&&"picture-marker"!==M.type&&"text"!==M.type||(M.angle=N))};c.applySizesToSymbol=function(M,N){return E.apply(this,arguments)};c.fetchWebStyleSymbol=function(M,N){return K.apply(this,arguments)};c.getCSSFilterFromEffectList=function(M){if(!M)return null;M=M.effects.filter(N=>"bloom"!==N.type).map(N=>N.toJSON());return g.effectFunctionsFromJSON(M)};c.getColorFromSymbol=
function(M,N){if(!M)return null;let P=null;n.isSymbol3D(M)?P=v(M):n.isSymbol2D(M)&&(P=M.color?new t(M.color):null);return P?q(P,N):null};c.getIconHref=function(M){return d.unwrapOrThrow(M.resource).href};c.getSymbolOutlineSize=function(M){if(!M)return 0;if(n.isSymbol3D(M)){{const N=M.symbolLayers&&M.symbolLayers.length;N?(M=M.symbolLayers.getItemAt(N-1),M="outline"in M?d.get(M,"outline","size"):void 0):M=void 0}return d.isSome(M)?M:0}return f.px2pt(h.getStroke(M)?.width)};c.isVolumetricSymbol=function(M){if(d.isNone(M)||
!("symbolLayers"in M)||d.isNone(M.symbolLayers))return!1;switch(M.type){case "point-3d":return M.symbolLayers.some(N=>"object"===N.type);case "line-3d":return M.symbolLayers.some(N=>"path"===N.type);case "polygon-3d":return M.symbolLayers.some(N=>"object"===N.type||"extrude"===N.type);default:return!1}};c.symbolHasExtrudeSymbolLayer=function(M){return d.isSome(M)&&"polygon-3d"===M.type&&M.symbolLayers.some(N=>"extrude"===N.type)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/ItemCache ../../core/screenUtils ./cimSymbolUtils".split(" "),
function(a,c,b,t,n,r,m){function d(g){if(!g)return null;let h=null;switch(g.type){case "simple-fill":case "picture-fill":case "simple-marker":h=d(g.outline);break;case "simple-line":const l=r.pt2px(g.width);null!=g.style&&"none"!==g.style&&0!==l&&(h={color:g.color,style:e(g.style),width:l,cap:g.cap,join:"miter"===g.join?r.pt2px(g.miterLimit):g.join});break;default:h=null}return h}const f=new n(1E3),e=(()=>{const g={};return h=>{if(g[h])return g[h];const l=h.replace(/-/g,"");return g[h]=l}})();b=new b([128,
128,128]);a.defaultThematicColor=b;a.dekebabifyLineStyle=e;a.getFill=function(g){const h=g.style;let l=null;if(g)switch(g.type){case "simple-marker":"cross"!==h&&"x"!==h&&(l=g.color);break;case "simple-fill":"solid"===h?l=g.color:"none"!==h&&(l={type:"pattern",x:0,y:0,src:c.getAssetUrl(`esri/symbols/patterns/${h}.png`),width:5,height:5});break;case "picture-fill":l={type:"pattern",src:g.url,width:r.pt2px(g.width)*g.xscale,height:r.pt2px(g.height)*g.yscale,x:r.pt2px(g.xoffset),y:r.pt2px(g.yoffset)};
break;case "text":l=g.color;break;case "cim":l=m.getCIMSymbolColor(g)}return l};a.getPatternUrlWithColor=function(g,h){const l=g+"-"+h;return void 0!==f.get(l)?Promise.resolve(f.get(l)):t(g,{responseType:"image"}).then(v=>{v=v.data;const q=v.naturalWidth,k=v.naturalHeight,p=document.createElement("canvas");p.width=q;p.height=k;const z=p.getContext("2d");z.fillStyle=h;z.fillRect(0,0,q,k);z.globalCompositeOperation="destination-in";z.drawImage(v,0,0);v=p.toDataURL();f.put(l,v);return v})};a.getStroke=
d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/ItemCache":function(){define(["./MemCache"],function(a){return function(){function c(t,n){this._storage=new a.MemCacheStorage;this._storage.maxSize=t;n&&this._storage.registerRemoveFunc("",n)}var b=c.prototype;b.put=function(t,n){this._storage.put(t,n,1,1)};b.pop=function(t){return this._storage.pop(t)};b.get=function(t){return this._storage.get(t)};b.clear=function(){this._storage.clearAll()};b.destroy=function(){this._storage.destroy()};
return c}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,c,b){function t(h){h=b.toCIMSymbolJSON(h);if("CIMTextSymbol"===h?.type)return h.height??0;let l=0;if(h?.symbolLayers)for(const v of h.symbolLayers)b.isCIMMarker(v)&&null!=v.size&&v.size>l?l=v.size:b.isCIMStroke(v)&&null!=v.width&&v.width>l?l=v.width:b.isCIMFill(v);return l}function n(h,l,v,q){if(h)if("CIMTextSymbol"===h.type)null!=h.height&&(h.height*=l);else{if(v&&h.effects)for(const k of h.effects)d(k,
l);if(h.symbolLayers)for(const k of h.symbolLayers)switch(k.type){case "CIMPictureMarker":case "CIMVectorMarker":r(k,l,q);break;case "CIMPictureStroke":case "CIMSolidStroke":!q?.preserveOutlineWidth&&k.width&&(k.width*=l);break;case "CIMPictureFill":k.height&&(k.height*=l);k.offsetX&&(k.offsetX*=l);k.offsetY&&(k.offsetY*=l);break;case "CIMHatchFill":n(k.lineSymbol,l,!0,{...q,preserveOutlineWidth:!1}),k.offsetX&&(k.offsetX*=l),k.offsetY&&(k.offsetY*=l),k.separation&&(k.separation*=l)}}}function r(h,
l,v){if(h&&(h.markerPlacement&&m(h.markerPlacement,l),h.offsetX&&(h.offsetX*=l),h.offsetY&&(h.offsetY*=l),h.anchorPoint&&"Absolute"===h.anchorPointUnits&&(h.anchorPoint={x:h.anchorPoint.x*l,y:h.anchorPoint.y*l}),h.size=null!=h.size?h.size*l:0,"CIMVectorMarker"===h.type&&h.markerGraphics))for(const q of h.markerGraphics)h.scaleSymbolsProportionally||n(q.symbol,l,!0,v)}function m(h,l){b.isCIMMarkerStrokePlacement(h)&&h.offset&&(h.offset*=l);switch(h.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":h.customEndingOffset&&
(h.customEndingOffset*=l);h.offsetAlongLine&&(h.offsetAlongLine*=l);if(h.placementTemplate&&h.placementTemplate.length){var v=h.placementTemplate.map(q=>q*l);h.placementTemplate=v}break;case "CIMMarkerPlacementAlongLineVariableSize":h.maxRandomOffset&&(h.maxRandomOffset*=l);h.placementTemplate&&h.placementTemplate.length&&(v=h.placementTemplate.map(q=>q*l),h.placementTemplate=v);break;case "CIMMarkerPlacementOnLine":h.startPointOffset&&(h.startPointOffset*=l);break;case "CIMMarkerPlacementAtExtremities":h.offsetAlongLine&&
(h.offsetAlongLine*=l);break;case "CIMMarkerPlacementAtRatioPositions":h.beginPosition&&(h.beginPosition*=l);h.endPosition&&(h.endPosition*=l);break;case "CIMMarkerPlacementPolygonCenter":h.offsetX&&(h.offsetX*=l);h.offsetY&&(h.offsetY*=l);break;case "CIMMarkerPlacementInsidePolygon":h.offsetX&&(h.offsetX*=l),h.offsetY&&(h.offsetY*=l),h.stepX&&(h.stepX*=l),h.stepY&&(h.stepY*=l)}}function d(h,l){switch(h.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":h.width&&(h.width*=l);break;
case "CIMGeometricEffectBuffer":h.size&&(h.size*=l);break;case "CIMGeometricEffectCut":h.beginCut&&(h.beginCut*=l);h.endCut&&(h.endCut*=l);h.middleCut&&(h.middleCut*=l);break;case "CIMGeometricEffectDashes":h.customEndingOffset&&(h.customEndingOffset*=l);h.offsetAlongLine&&(h.offsetAlongLine*=l);if(h.dashTemplate&&h.dashTemplate.length){const v=h.dashTemplate.map(q=>q*l);h.dashTemplate=v}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":h.length&&
(h.length*=l);break;case "CIMGeometricEffectMove":h.offsetX&&(h.offsetX*=l);h.offsetY&&(h.offsetY*=l);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":h.offset&&(h.offset*=l);break;case "CIMGeometricEffectRegularPolygon":h.radius&&(h.radius*=l);break;case "CIMGeometricEffectTaperedPolygon":h.fromWidth&&(h.fromWidth*=l);h.length&&(h.length*=l);h.toWidth&&(h.toWidth*=l);break;case "CIMGeometricEffectWave":h.amplitude&&(h.amplitude*=l),h.period&&(h.period*=l)}}function f(h,
l){if(h){var v="CIMTextSymbol"===h.type?h.symbol:h;h="CIMPolygonSymbol"===h.type;if(v?.symbolLayers)for(const q of v.symbolLayers)if(!(q.colorLocked||h&&(b.isCIMStroke(q)||b.isCIMMarker(q)&&q.markerPlacement&&b.isCIMMarkerStrokePlacement(q.markerPlacement))))switch(q.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":q.tintColor&&e(l,q.tintColor);break;case "CIMVectorMarker":q.markerGraphics?.forEach(k=>{f(k.symbol,l)});break;case "CIMSolidStroke":case "CIMSolidFill":e(l,
q.color);break;case "CIMHatchFill":f(q.lineSymbol,l)}}}function e(h,l){for(const v of h)if(v.join(".")===l.join("."))return;h.push(l)}function g(h,l,v){if(h){var q="CIMTextSymbol"===h.type?h.symbol:h;h="CIMPolygonSymbol"===q?.type;if(q?.symbolLayers)for(const k of q.symbolLayers)if(!k.colorLocked){if(h)if(v){if({layersToColor:q}=v,(b.isCIMStroke(k)||b.isCIMMarker(k)&&k.markerPlacement&&b.isCIMMarkerStrokePlacement(k.markerPlacement))&&"fill"===q||b.isCIMFill(k)&&"outline"===q)continue}else if(b.isCIMStroke(k)||
b.isCIMMarker(k)&&k.markerPlacement&&b.isCIMMarkerStrokePlacement(k.markerPlacement))continue;q=l.toArray();switch(k.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":k.tintColor=q;break;case "CIMVectorMarker":k.markerGraphics?.forEach(p=>{g(p.symbol,l,v)});break;case "CIMSolidStroke":case "CIMSolidFill":k.color=q;break;case "CIMHatchFill":g(k.lineSymbol,l,v)}}}}a.applyCIMSymbolColor=function(h,l,v){l instanceof c||(l=new c(l));(h=b.toCIMSymbolJSON(h))&&g(h,l,v)};a.applyCIMSymbolRotation=
function(h,l,v=!1){h=b.toCIMSymbolJSON(h);v&&0!==l&&(l=360-l);if("CIMTextSymbol"===h?.type)h.angle=l;else if("CIMPointSymbol"===h?.type&&h.symbolLayers){v=l-(h.angle||0);for(const q of h.symbolLayers)if(b.isCIMMarker(q)){let k=q.rotation||0;k=q.rotateClockwise?k-v:k+v;q.rotation=k}h.angle=l}};a.getCIMSymbolColor=function(h){h=b.toCIMSymbolJSON(h);const l=[];f(h,l);return l.length?new c(b.fromCIMColor(l[0])):null};a.getCIMSymbolRotation=function(h,l=!1){h=b.toCIMSymbolJSON(h);return"CIMTextSymbol"===
h?.type||"CIMPointSymbol"===h?.type?(h=h.angle,null!=h&&0!==h&&l?360-h:h??0):0};a.getCIMSymbolSize=t;a.getCIMSymbolType=function(h){h=b.toCIMSymbolJSON(h);if(!h)return null;switch(h.type){case "CIMPointSymbol":return"CIMPointSymbol";case "CIMLineSymbol":return"CIMLineSymbol";case "CIMPolygonSymbol":return"CIMPolygonSymbol";case "CIMTextSymbol":return"CIMTextSymbol";case "CIMMeshSymbol":return"CIMMeshSymbol";default:return null}};a.scaleCIMMarker=r;a.scaleCIMSymbol=n;a.scaleCIMSymbolTo=function(h,
l,v){if(h){var q=b.toCIMSymbolJSON(h);h=t(h);if(0===h){if(q)if("CIMTextSymbol"===q.type)q.height=l;else if(q.symbolLayers)for(const k of q.symbolLayers)switch(k.type){case "CIMPictureMarker":case "CIMVectorMarker":k.size=l;break;case "CIMPictureStroke":case "CIMSolidStroke":k.width=l}}else n(q,l/h,!1,v)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(a,c){function b(g){let h=g.length;for(;h--;)if(!" /-,\n".includes(g.charAt(h)))return!1;
return!0}function t(g,h){const l=[];var v=0;let q=-1;do q=g.indexOf("[",v),q>=v&&(q>v&&(v=g.substr(v,q-v),l.push([v,null,b(v)])),v=q+1,q=g.indexOf("]",v),q>=v&&(q>v&&(v=g.substr(v,q-v),(v=h[v])&&l.push([null,v,!1])),v=q+1));while(-1!==q);v<g.length-1&&(g=g.substr(v),l.push([g,null,b(g)]));return l}function n(g,h,l){let v="",q=null;for(const k of h){const [p,z,C]=k;if(p)C?q=p:(q&&(v+=q,q=null),v+=p);else if(h=g.attributes[z])q&&(v+=q,q=null),v+=h}return r(v,l)}function r(g,h){"string"!==typeof g&&
(g=String(g));switch(h){case "LowerCase":return g.toLowerCase();case "Allcaps":return g.toUpperCase();default:return g}}function m(g){return g?{r:g[0],g:g[1],b:g[2],a:g[3]/255}:{r:0,g:0,b:0,a:0}}function d(g){if(!g)return null;switch(g.type){case "CIMPolygonSymbol":if(g.symbolLayers)for(const h of g.symbolLayers)if(g=d(h),null!=g)return g;break;case "CIMTextSymbol":return d(g.symbol);case "CIMSolidFill":return g.color}}function f(g){if(g)switch(g.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(g=
g.symbolLayers)for(const h of g)if(g=f(h),null!=g)return g;break;case "CIMTextSymbol":return f(g.symbol);case "CIMSolidStroke":case "CIMSolidFill":return g.color}}function e(g){if(g)switch(g.type){case "CIMPolygonSymbol":case "CIMLineSymbol":if(g.symbolLayers)for(const h of g.symbolLayers)if(g=e(h),void 0!==g)return g;break;case "CIMTextSymbol":return e(g.symbol);case "CIMSolidStroke":case "CIMGradientStroke":case "CIMPictureStroke":return g.width}}c.adjustTextCase=r;c.analyzeTextParts=t;c.assignTextValuesFromFeature=
n;c.attributesToFields=function(g){return(g?Object.keys(g):[]).map(h=>({name:h,alias:h,type:"string"===typeof g[h]?"esriFieldTypeString":"esriFieldTypeDouble"}))};c.colorToArray=function(g){return[g.r,g.g,g.b,g.a]};c.createLabelOverrideFunction=function(g,h,l){const v=t(h,g);return q=>n(q,v,l)};c.evaluateValueOrFunction=function(g,h,l,v){return"function"===typeof g?g(h,l,v):g};c.fromCIMColor=m;c.fromCIMFontDecoration=function(g){return g.underline?"underline":g.strikethrough?"line-through":"none"};
c.fromCIMFontStyle=function(g){let h="",l="";g&&(g=g.toLowerCase(),g.includes("italic")?h="italic":g.includes("oblique")&&(h="oblique"),g.includes("bold")?l="bold":g.includes("light")&&(l="lighter"));return{style:h,weight:l}};c.fromCIMHorizontalAlignment=function(g){switch(g){default:return"left";case "Right":return"right";case "Center":return"center";case "Justify":return"center"}};c.fromCIMVerticalAlignment=function(g){switch(g){default:return"top";case "Center":return"middle";case "Baseline":return"baseline";
case "Bottom":return"bottom"}};c.getFillColor=d;c.getFontStyle=function(g){if(!g)return"normal";switch(g.toLowerCase()){case "italic":return"italic";case "oblique":return"oblique";default:return"normal"}};c.getFontWeight=function(g){if(!g)return"normal";switch(g.toLowerCase()){case "bold":return"bold";case "bolder":return"bolder";case "lighter":return"lighter";default:return"normal"}};c.getStrokeColor=f;c.getStrokeWidth=e;c.getTintColor=g=>g.tintColor?m(g.tintColor):{r:255,g:255,b:255,a:1};c.getValue=
(g,h=0)=>null==g||isNaN(g)?h:g;c.importGeometryEngine=function(){return new Promise((g,h)=>a(["../../geometry/geometryEngineJSON"],g,h))};c.isCIMFill=function(g){return null!=g&&("CIMGradientFill"===g.type||"CIMHatchFill"===g.type||"CIMPictureFill"===g.type||"CIMSolidFill"===g.type||"CIMWaterFill"===g.type)};c.isCIMMarker=function(g){return"CIMVectorMarker"===g.type||"CIMPictureMarker"===g.type||"CIMBarChartMarker"===g.type||"CIMCharacterMarker"===g.type||"CIMPieChartMarker"===g.type||"CIMStackedBarChartMarker"===
g.type};c.isCIMMarkerStrokePlacement=function(g){return null!=g&&("CIMMarkerPlacementAlongLineRandomSize"===g.type||"CIMMarkerPlacementAlongLineSameSize"===g.type||"CIMMarkerPlacementAlongLineVariableSize"===g.type||"CIMMarkerPlacementAtExtremities"===g.type||"CIMMarkerPlacementAtMeasuredUnits"===g.type||"CIMMarkerPlacementAtRatioPositions"===g.type||"CIMMarkerPlacementOnLine"===g.type||"CIMMarkerPlacementOnVertices"===g.type)};c.isCIMStroke=function(g){return"CIMGradientStroke"===g.type||"CIMPictureStroke"===
g.type||"CIMSolidStroke"===g.type};c.isGeometryEngineRequired=g=>{if(!g)return!1;for(const h of g)switch(h.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":case "CIMGeometricEffectDonut":return!0}return!1};c.isSVGImage=g=>g.includes("data:image/svg+xml");c.mapCIMSymbolToGeometryType=function(g){if(!g)return null;switch(g.type){case "CIMPointSymbol":case "CIMTextSymbol":return"esriGeometryPoint";case "CIMLineSymbol":return"esriGeometryPolyline";case "CIMPolygonSymbol":return"esriGeometryPolygon";
default:return null}};c.resampleHermite=function(g,h,l,v,q,k,p=!0){const z=h/q;l/=k;const C=Math.ceil(z/2),B=Math.ceil(l/2);for(let u=0;u<k;u++)for(let y=0;y<q;y++){const w=4*(y+(p?k-u-1:u)*q);var A=0;let D=0,F=0,E=0,K=0,J=0,M=0;const N=(u+.5)*l;for(let P=Math.floor(u*l);P<(u+1)*l;P++){var x=Math.abs(N-(P+.5))/B;const I=(y+.5)*z;x*=x;for(let G=Math.floor(y*z);G<(y+1)*z;G++){let H=Math.abs(I-(G+.5))/C;A=Math.sqrt(x+H*H);-1<=A&&1>=A&&(A=2*A*A*A-3*A*A+1,0<A&&(H=4*(G+P*h),M+=A*g[H+3],F+=A,255>g[H+3]&&
(A=A*g[H+3]/250),E+=A*g[H],K+=A*g[H+1],J+=A*g[H+2],D+=A))}}v[w]=E/D;v[w+1]=K/D;v[w+2]=J/D;v[w+3]=M/F}};c.toCIMSymbolJSON=function(g){return g.data?.symbol??null};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/colorRampUtils":function(){define(["require","exports","../../../chunks/_rollupPluginBabelHelpers","../../../Color","./utils"],function(a,c,b,t,n){function r(l,v){const q=[],k=l.length-1;5===l.length?q.push(0,2,4):q.push(0,k);return l.map((p,z)=>
q.includes(z)?n.createStopLabel(p,z,k,v):null)}function m(){m=b._asyncToGenerator(function*(l,v,q){let k=!1,p=[],z=[];if(l.stops){var C=l.stops;p=C.map(A=>A.value);(k=C.some(A=>!!A.label))&&(z=C.map(A=>A.label))}C=p[p.length-1];if(null==p[0]&&null==C)return null;const B=k?null:r(p,q??!1);return(yield Promise.all(p.map(function(){var A=b._asyncToGenerator(function*(x,u){const y="opacity"===l.type?yield d(x,l,v):(yield new Promise((w,D)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],
w,D))).getColor(l,x);return{value:x,color:y,label:k?z[u]:B?.[u]??""}});return function(x,u){return A.apply(this,arguments)}}()))).reverse()});return m.apply(this,arguments)}function d(l,v){return f.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(l,v,q=h){q=new t(q);l=(yield new Promise((k,p)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],k,p))).getOpacity(v,l);null!=l&&(q.a=l);return q});return f.apply(this,arguments)}function e(l,v){const {startIndex:q,endIndex:k,
weight:p}=g(l,v);if(q===k)return v[q].color;l=t.blendColors(v[q].color,v[k].color,p);return new t(l)}function g(l,v){let q=0,k=v.length-1;v.some((p,z)=>{if(l<p.value)return k=z,!0;q=z;return!1});return{startIndex:q,endIndex:k,weight:(l-v[q].value)/(v[k].value-v[q].value)}}const h=new t([64,64,64]);c.getColorFromPointCloudStops=e;c.getRampStops=function(l,v,q){return m.apply(this,arguments)};c.getRampStopsForPointCloud=function(l){let v=!1,q=[],k=[];q=l.map(C=>C.value);(v=l.some(C=>!!C.label))&&(k=
l.map(C=>C.label??""));const p=q[q.length-1];if(null==q[0]&&null==p)return null;const z=v?null:r(q,!1);return q.map((C,B)=>{const A=e(C,l);return{value:C,color:A,label:v?k[B]:z?.[B]??""}}).reverse()};c.getStrectchRampStops=function(l,v){let q=[];if(l&&"multipart"===l.type)l.colorRamps.reverse().forEach((k,p)=>{0===p?q.push({value:v.max,color:new t(k.toColor),label:"high"}):q.push({value:null,color:new t(k.toColor),label:""});p===l.colorRamps.length-1?q.push({value:v.min,color:new t(k.fromColor),label:"low"}):
q.push({value:null,color:new t(k.fromColor),label:""})});else{let k,p;l&&"algorithmic"===l.type?(k=l.fromColor,p=l.toColor):(k=[0,0,0,1],p=[255,255,255,1]);q=[{value:v.max,color:new t(p),label:"high"},{value:v.min,color:new t(k),label:"low"}]}return q};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/utils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../symbols ../../../intl/date ../../../renderers/support/numberUtils ../../../symbols/SimpleLineSymbol".split(" "),
function(a,c,b,t,n,r,m){function d(h){return f.apply(this,arguments)}function f(){f=b._asyncToGenerator(function*(h){if(!("visualVariables"in h&&h.visualVariables))return null;h=h.visualVariables.find(q=>"color"===q.type);if(!h)return null;var l=null,v=null;if(h.stops){if(1===h.stops.length)return h.stops[0].color;l=h.stops[0].value;v=h.stops[h.stops.length-1].value}l=null!=l&&null!=v?l+(v-l)/2:0;({getColor:v}=yield new Promise((q,k)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],
q,k)));return v(h,l)??null});return f.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(h,l){const v=h.trailCap,q=h.trailWidth||1;h=l||(yield d(h))||h.color;return new m({cap:v,color:h,width:q})});return e.apply(this,arguments)}const g=n.convertDateFormatToIntlOptions("short-date");c.RGB_IMG_SOURCE=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII\x3d",
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII\x3d","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII\x3d"];c.SPECIAL_CHARS_GREATER_THAN="\x3e";c.SPECIAL_CHARS_LESS_THAN="\x3c";c.createStopLabel=function(h,
l,v,q){let k="";0===l?k="\x3c ":l===v&&(k="\x3e ");l=null;l=q?n.formatDate(h,g):r.format(h);return k+l};c.getMedianColor=d;c.getSymbolForFlowRenderer=function(h,l){return e.apply(this,arguments)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["exports","../../../renderers/support/HeatmapColorStop"],function(a,c){a.getHeatmapRampStops=function(b){if(!b.colorStops)return[];const t=[...b.colorStops].filter(r=>0<r.color?.a);
let n=t.length-1;if(t&&t[0]){const r=t[n];r&&1!==r.ratio&&(t.push(new c({ratio:1,color:r.color})),n++)}return t.map((r,m)=>{let d="";0===m?d=b.legendOptions?.minLabel||"low":m===n&&(d=b.legendOptions?.maxLabel||"high");return{color:r.color,label:d,ratio:r.ratio}}).reverse()};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureMedia/FeatureMediaViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){const l={chartAnimation:!0};b=function(v){function q(p){p=v.call(this,p)||this;p.abilities={...l};p.activeMediaInfoIndex=0;p.attributes=null;p.description=null;p.fieldInfoMap=null;p.formattedAttributes=null;p.expressionAttributes=null;p.isAggregate=!1;p.layer=null;p.mediaInfos=null;p.popupTemplate=null;p.relatedInfos=null;p.title=null;return p}a._inheritsLoose(q,v);var k=q.prototype;k.castAbilities=function(p){return{...l,...p}};k.setActiveMedia=function(p){this._setContentElementMedia(p)};
k.next=function(){this._pageContentElementMedia(1)};k.previous=function(){this._pageContentElementMedia(-1)};k._setContentElementMedia=function(p){const {formattedMediaInfoCount:z}=this;this.activeMediaInfoIndex=(p+z)%z};k._pageContentElementMedia=function(p){const {activeMediaInfoIndex:z}=this;this._setContentElementMedia(z+p)};k._formatMediaInfos=function(){const {mediaInfos:p,layer:z}=this,C=this.attributes??{},B=this.formattedAttributes??{},A=this.expressionAttributes??{},x=this.fieldInfoMap??
new Map;return p?.map(u=>{u=u?.clone();if(!u)return null;u.title=g.substituteFieldsInLinksAndAttributes({attributes:C,fieldInfoMap:x,globalAttributes:B,expressionAttributes:A,layer:z,text:u.title});u.caption=g.substituteFieldsInLinksAndAttributes({attributes:C,fieldInfoMap:x,globalAttributes:B,expressionAttributes:A,layer:z,text:u.caption});u.altText=g.substituteFieldsInLinksAndAttributes({attributes:C,fieldInfoMap:x,globalAttributes:B,expressionAttributes:A,layer:z,text:u.altText});if("image"===
u.type){var {value:y}=u;this._setImageValue({value:y,formattedAttributes:B,layer:z});return u.value.sourceURL?u:void 0}return"pie-chart"===u.type||"line-chart"===u.type||"column-chart"===u.type||"bar-chart"===u.type?({value:y}=u,this._setChartValue({value:y,chartType:u.type,attributes:C,formattedAttributes:B,layer:z,expressionAttributes:A}),u):null}).filter(t.isSome)??[]};k._setImageValue=function(p){const z=this.fieldInfoMap??new Map,{value:C,formattedAttributes:B,layer:A}=p,{linkURL:x,sourceURL:u}=
C;u&&(p=g.fixTokens(u,A),C.sourceURL=g.substituteAttributes({formattedAttributes:B,template:p,fieldInfoMap:z}));x&&(p=g.fixTokens(x,A),C.linkURL=g.substituteAttributes({formattedAttributes:B,template:p,fieldInfoMap:z}))};k._setChartValue=function(p){const {value:z,attributes:C,formattedAttributes:B,chartType:A,layer:x,expressionAttributes:u}=p,{popupTemplate:y,relatedInfos:w}=this,{fields:D,normalizeField:F}=z;z.fields=g.getFixedFieldNames(D,x);F&&(z.normalizeField=g.getFixedFieldName(F,x));if(D.some(K=>
!!(null!=B[K]||g.isRelatedField(K)&&w?.size))){var E=y?.fieldInfos??[];D.forEach(K=>{g.isRelatedField(K)?z.series=[...z.series,...this._getRelatedChartInfos({fieldInfos:E,fieldName:K,formattedAttributes:B,chartType:A,value:z})]:(K=this._getChartOption({value:z,attributes:C,chartType:A,formattedAttributes:B,expressionAttributes:u,fieldName:K,fieldInfos:E}),z.series.push(K))})}};k._getRelatedChartInfos=function(p){const {fieldInfos:z,fieldName:C,formattedAttributes:B,chartType:A,value:x}=p,u=[],y=h.getRelatedFieldInfo(C);
p=y&&this.relatedInfos?.get(y.layerId.toString());if(!p)return u;const {relatedFeatures:w,relation:D}=p;if(!D||!w)return u;({cardinality:p}=D);w.forEach(F=>{const {attributes:E}=F;E&&Object.keys(E).forEach(K=>{K===y.fieldName&&u.push(this._getChartOption({value:x,attributes:E,formattedAttributes:B,fieldName:C,chartType:A,relatedFieldName:K,hasMultipleRelatedFeatures:1<w?.length,fieldInfos:z}))})});return"one-to-many"===p||"many-to-many"===p?u:[u[0]]};k._getTooltip=function({label:p,value:z,chartType:C}){return"pie-chart"===
C?`${p}`:`${p}: ${z}`};k._getChartOption=function(p){const {value:z,attributes:C,formattedAttributes:B,expressionAttributes:A,fieldName:x,relatedFieldName:u,fieldInfos:y,chartType:w,hasMultipleRelatedFeatures:D}=p;var F=this.layer,E=this.fieldInfoMap??new Map;const {normalizeField:K,tooltipField:J}=z;p=K?g.isRelatedField(K)?C[h.getRelatedFieldInfo(K).fieldName]:C[K]:null;var M=g.isExpressionField(x)&&A&&void 0!==A[x]?A[x]:u&&void 0!==C[u]?C[u]:void 0!==C[x]?C[x]:B[x];p=new e({fieldName:x,value:void 0===
M?null:M&&p?M/p:M});if(g.isRelatedField(x))return F=E.get(x.toLowerCase()),M=J&&E.get(J.toLowerCase()),E=F?.fieldName??x,M=D&&J?h.getRelatedFieldInfo(J).fieldName:M?.fieldName??J,p.tooltip=this._getTooltip({label:D&&M?C[M]:B[M]??F?.label??F?.fieldName??u,value:D&&u?C[u]:B[E],chartType:w}),p;E=g.getFieldInfo(y,x);F=g.getFixedFieldName(x,F);E=J&&void 0!==B[J]?B[J]:g.getFieldInfoLabel(E||new f({fieldName:F}),this.popupTemplate?.expressionInfos);p.tooltip=this._getTooltip({label:E,value:B[F],chartType:w});
return p};a._createClass(q,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return q}(b);c.__decorate([n.property()],b.prototype,"abilities",void 0);c.__decorate([r.cast("abilities")],b.prototype,"castAbilities",null);c.__decorate([n.property()],b.prototype,"activeMediaInfoIndex",
void 0);c.__decorate([n.property({readOnly:!0})],b.prototype,"activeMediaInfo",null);c.__decorate([n.property()],b.prototype,"attributes",void 0);c.__decorate([n.property()],b.prototype,"description",void 0);c.__decorate([n.property()],b.prototype,"fieldInfoMap",void 0);c.__decorate([n.property()],b.prototype,"formattedAttributes",void 0);c.__decorate([n.property()],b.prototype,"expressionAttributes",void 0);c.__decorate([n.property({readOnly:!0})],b.prototype,"formattedMediaInfos",null);c.__decorate([n.property()],
b.prototype,"isAggregate",void 0);c.__decorate([n.property()],b.prototype,"layer",void 0);c.__decorate([n.property({readOnly:!0})],b.prototype,"formattedMediaInfoCount",null);c.__decorate([n.property()],b.prototype,"mediaInfos",void 0);c.__decorate([n.property()],b.prototype,"popupTemplate",void 0);c.__decorate([n.property()],b.prototype,"relatedInfos",void 0);c.__decorate([n.property()],b.prototype,"title",void 0);return b=c.__decorate([d.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],
b)})},"esri/widgets/Feature/support/relatedFeatureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../layers/support/fieldUtils ../../../core/has ../../../layers/support/source/DataLayerSource ../../../rest/query/executeQueryJSON ../../../config ../../../kernel ../../../core/arrayUtils ../../../core/urlUtils ../../../core/unitUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/graphics/featureConversionUtils ../../../geometry/Extent ../../../geometry/Geometry ../../../geometry/Multipoint ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/Polyline ../../../geometry/support/normalizeUtils ../../../core/pbf ../../../rest/support/FeatureSet ../../../rest/support/Query ../../../rest/query/support/AttachmentInfo ../../../rest/support/AttachmentQuery ../../../geometry ../../../rest/support/RelationshipQuery ../../../rest/support/TopFeaturesQuery ../../../rest/support/StatisticDefinition ./featureUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I){function G(W,T){if(!T.relationships)return null;let U=null;({relationships:T}=T);T.some(Y=>Y.id===parseInt(W,10)?(U=Y,!0):!1);return U}function H({originRelationship:W,relationships:T,layerId:U}){let Y=null;T&&T.some(ba=>{`${ba.relatedTableId}`===U&&ba.id===W?.id&&(Y=ba);return!!Y});return Y}function L(W,T){T=T.toLowerCase();for(const U in W)if(U.toLowerCase()===T)return W[U];return null}function O(W,T,U,Y){const ba=new M;
ba.outFields=["*"];ba.relationshipId="number"===typeof T.id?T.id:parseInt(T.id,10);ba.objectIds=[W.attributes[U.objectIdField]];return U.queryRelatedFeatures?.(ba,Y)??Promise.resolve({})}function S(W,T,U){let Y=0;const ba=[];for(;Y<T.length;)ba.push(`${W} IN (${T.slice(Y,U+Y)})`),Y+=U;return ba.join(" OR ")}function R(W,T,U,Y){return Q.apply(this,arguments)}function Q(){Q=c._asyncToGenerator(function*(W,T,U,Y){var ba=U.layerId.toString();const {layerInfo:da,relation:ea,relatedFields:ca,outStatistics:ja,
url:ia,sourceSpatialReference:Z}=T;if(!da||!ea)return null;ba=H({originRelationship:ea,relationships:da.relationships,layerId:ba});if(ba?.relationshipTableId&&ba.keyFieldInRelationshipTable){U=(yield O(W,ba,U,Y))[W.attributes[U.objectIdField]];if(!U)return null;const ha=U.features.map(fa=>fa.attributes[da.objectIdField]);if(ja?.length&&da.supportsStatistics)return T=new F,T.where=S(da.objectIdField,ha,1E3),T.outFields=ca,T.outStatistics=ja,T.sourceSpatialReference=Z,T={features:Promise.resolve(U),
statsFeatures:e.executeQueryJSON(ia,T)},r.eachAlways(T)}return(ba=ba?.keyField)?(U=m.isNumericField(V(da.fields,ba)),W=L(W.attributes,ea.keyField),ba=U?`${ba}=${W}`:`${ba}='${W}'`,W=e.executeQueryJSON(ia,new F({where:ba,outFields:T.relatedFields,sourceSpatialReference:Z}),Y),T=T.outStatistics&&0<T.outStatistics.length&&da.supportsStatistics?e.executeQueryJSON(ia,new F({where:ba,outFields:T.relatedFields,outStatistics:T.outStatistics,sourceSpatialReference:Z}),Y):null,Y={features:W},T&&(Y.statsFeatures=
T),r.eachAlways(Y)):null});return Q.apply(this,arguments)}function V(W,T){if(null!=W){T=T.toLowerCase();for(const U of W)if(U&&U.name.toLowerCase()===T)return U}return null}const aa=n.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),X=new Map;a.createRelatedInfo=function(W,T){if(W=G(W,T))return{url:`${T.url}/${W.relatedTableId}`,sourceSpatialReference:T.spatialReference,relation:W,relatedFields:[],outStatistics:[]}};a.getDestinationRelation=H;a.getRelatedFieldInfo=function(W){if(!I.isRelatedField(W))return null;
const [T,U]=W.split("/").slice(1);return{layerId:T,fieldName:U}};a.queryLayerInfos=function({relatedInfos:W,layer:T},U){const Y={};W.forEach((ba,da)=>{({relation:ba}=ba);if(!ba)throw da=new t("relation-required","A relation is required on a layer to retrieve related records."),aa.error(da),da;({relatedTableId:ba}=ba);if("number"!==typeof ba)throw da=new t("A related table ID is required on a layer to retrieve related records."),aa.error(da),da;ba=`${T.url}/${ba}`;const ea=X.get(ba),ca=ea?ea:b(ba,
{query:{f:"json"},signal:void 0});ea||X.set(ba,ca);Y[da]=ca});return r.whenOrAbort(r.eachAlways(Y),U)};a.queryRelatedFeatures=function({graphic:W,relatedInfos:T,layer:U},Y){const ba={};T.forEach((da,ea)=>{da.layerInfo&&(ba[ea]=R(W,da,U,Y))});return r.eachAlways(ba)};a.setRelatedFeatures=function(W,T){if(T&&W){var {features:U,statsFeatures:Y}=W;W=U&&U.value;T.relatedFeatures=W?W.features:[];W=Y&&Y.value;T.relatedStatsFeatures=W?W.features:[]}};a.updateRelatedInfo=function({relatedInfo:W,fieldName:T,
fieldInfo:U}){W.relatedFields?.push(T);U.statisticType&&(T=new P({statisticType:U.statisticType,onStatisticField:T,outStatisticFieldName:T}),W.outStatistics?.push(T))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/chartUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../intl ../../core/has ../../intl/locale".split(" "),function(a,c,b,t,n,r){function m(l){if(!l)return"en-us";if(e.has(l.toLowerCase()))return l.toLowerCase();
l=l.split("-")[0].toLowerCase();let v=null;for(const q of e.keys())if(q.startsWith(l)){v=q;break}return v||"en-us"}function d(){d=b._asyncToGenerator(function*(l=r.getLocale()){l=m(l);if(g&&l===h)return g;g=(new Promise((v,q)=>a(["../../chunks/index2"],v,q))).then(v=>v.index);h=l;try{const [v,q]=yield Promise.all([g,e.get(h)()]);h===l&&(v.am4core.options.defaultLocale=q.default);v.am4core.options.suppressWarnings=!0;v.am4core.options.autoDispose=!0}catch{return h=g=null}return g});return d.apply(this,
arguments)}t="#ffffff #858585 #ffbebe #ffebbe #ffebaf #ffffbe #e9ffbe #d3ffbe #beffe8 #bee8ff #bed2ff #e8beff #ffbee8 #ebebeb #707070 #ff7f7f #ffa77f #ffd37f #ffff73 #d1ff73 #a3ff73 #73ffdf #73dfff #73b2ff #df73ff #ff73df #d6d6d6 #5c5c5c #ff0000 #ff5500 #ffaa00 #ffff00 #aaff00 #55ff00 #00ffc5 #00c5ff #0070ff #c500ff #ff00c5 #c2c2c2 #474747 #e60000 #e64c00 #e69800 #e6e600 #98e600 #4ce600 #00e6a9 #00a9e6 #005ce6 #a900e6 #e600a9 #adadad #242424 #a80000 #a83800 #a87000 #a8a800 #70a800 #38a800 #00a884 #0084a8 #004da8 #8400a8 #a80084 #999999 #1a1a1a #730000 #732600 #734c00 #737300 #4c7300 #267300 #00734c #004c73 #002673 #4c0073 #73004".split(" ");
var f=[{name:"default",colors:[].concat(t.slice(30,39),t.slice(28,30).reverse())},{name:"cat-dark",colors:"#ed5151 #149ece #a7c636 #9e559c #fc921f #ffde3e #f789d8 #b7814a #3caf99 #6b6bd6 #b54779 #7f7f7f".split(" ")},{name:"tropical-bliss",colors:"#fce138 #ff9399 #fcd27e #f1983c #a553b7 #b1a9d0 #6ecffc #4c81cd #fc6f84 #fc3e5a #6af689 #48885c".split(" ")},{name:"desert-blooms",colors:"#102432 #144d59 #ffc730 #ed9310 #a64f1b #661510 #d9351a #b31515 #4a0932 #8c213f #18382e #2c6954".split(" ")},{name:"under-the-sea",
colors:"#bf9727 #607100 #00734c #704489 #01acca #024e76 #f09100 #ea311f #c6004b #7570b3 #666666 #333333".split(" ")},{name:"vibrant-rainbow",colors:"#fffb00 #f5cb11 #9fd40c #46e39c #32b8a6 #7ff2fa #ac08cc #dd33ff #eb7200 #e8a784 #bf2e2e #6c7000".split(" ")},{name:"ocean-bay",colors:"#191921 #11495c #78b1c2 #454f4b #8f8f82 #9be0c0 #87b051 #f7ec88 #ebdcc1 #dbb658 #c43541 #75351e".split(" ")},{name:"prairie-summer",colors:"#332424 #751555 #d47013 #d68989 #211173 #82aad6 #7bfaeb #6ec9a8 #6b6408 #eada40 #ccc54a #1fc235".split(" ")},
{name:"pastel-chalk",colors:"#fffd99 #f5e6a4 #c1d48c #b8e3d0 #a0b8b5 #cbf7fa #d791f2 #dfc1eb #f2b983 #e8c4b2 #bf8e8e #94995c".split(" ")},{name:"seq-yellow-orange-red-bright",colors:"#910000 #b1260b #c0370f #e05919 #ef6a1d #ff7b22 #ffa143 #ffb454 #ffda74 #ffed85".split(" ")},{name:"seq-reds-bright",colors:"#57453b #7b4238 #9f4036 #c23d33 #d7483c #ec5244 #f3696c #f9816c #ffc4ae #fff0dc".split(" ")},{name:"seq-purples-bright",colors:"#4e465c #5a4a78 #695291 #775baa #8663c3 #946bdc #aa89e8 #c1a6f3 #d7c4ff #e6e1ff".split(" ")},
{name:"seq-blues-bright",colors:"#404d54 #435c6c #48799d #4b88b6 #4d96ce #50a5e7 #74bbed #98d0f3 #bce6f9 #e6faff".split(" ")},{name:"seq-greens-bright",colors:"#39544c #386757 #368165 #359b73 #33b581 #4bc392 #64d2a2 #7ce0b3 #cbf6d9 #f4ffea".split(" ")},{name:"seq-browns-bright",colors:"#524834 #715b38 #8f6e3c #ae8140 #cc9444 #eba748 #eeb664 #f0c47f #f9e0b7 #fff8eb".split(" ")}];const e=new Map([["ar",()=>(new Promise((l,v)=>a(["../../chunks/ar"],l,v))).then(l=>l.ar)],["bg-bg",()=>(new Promise((l,
v)=>a(["../../chunks/bg_BG"],l,v))).then(l=>l.bg_BG)],["bs-ba",()=>(new Promise((l,v)=>a(["../../chunks/bs_BA"],l,v))).then(l=>l.bs_BA)],["ca-es",()=>(new Promise((l,v)=>a(["../../chunks/ca_ES"],l,v))).then(l=>l.ca_ES)],["cs-cz",()=>(new Promise((l,v)=>a(["../../chunks/cs_CZ"],l,v))).then(l=>l.cs_CZ)],["da-dk",()=>(new Promise((l,v)=>a(["../../chunks/da_DK"],l,v))).then(l=>l.da_DK)],["de-de",()=>(new Promise((l,v)=>a(["../../chunks/de_DE"],l,v))).then(l=>l.de_DE)],["de-ch",()=>(new Promise((l,v)=>
a(["../../chunks/de_CH"],l,v))).then(l=>l.de_CH)],["el-gr",()=>(new Promise((l,v)=>a(["../../chunks/el_GR"],l,v))).then(l=>l.el_GR)],["en-us",()=>(new Promise((l,v)=>a(["../../chunks/en_US"],l,v))).then(l=>l.en_US)],["en-ca",()=>(new Promise((l,v)=>a(["../../chunks/en_CA"],l,v))).then(l=>l.en_CA)],["es-es",()=>(new Promise((l,v)=>a(["../../chunks/es_ES"],l,v))).then(l=>l.es_ES)],["et-ee",()=>(new Promise((l,v)=>a(["../../chunks/et_EE"],l,v))).then(l=>l.et_EE)],["fi-fi",()=>(new Promise((l,v)=>a(["../../chunks/fi_FI"],
l,v))).then(l=>l.fi_FI)],["fr-fr",()=>(new Promise((l,v)=>a(["../../chunks/fr_FR"],l,v))).then(l=>l.fr_FR)],["he-il",()=>(new Promise((l,v)=>a(["../../chunks/he_IL"],l,v))).then(l=>l.he_IL)],["hr-hr",()=>(new Promise((l,v)=>a(["../../chunks/hr_HR"],l,v))).then(l=>l.hr_HR)],["hu-hu",()=>(new Promise((l,v)=>a(["../../chunks/hu_HU"],l,v))).then(l=>l.hu_HU)],["id-id",()=>(new Promise((l,v)=>a(["../../chunks/id_ID"],l,v))).then(l=>l.id_ID)],["it-it",()=>(new Promise((l,v)=>a(["../../chunks/it_IT"],l,v))).then(l=>
l.it_IT)],["ja-jp",()=>(new Promise((l,v)=>a(["../../chunks/ja_JP"],l,v))).then(l=>l.ja_JP)],["ko-kr",()=>(new Promise((l,v)=>a(["../../chunks/ko_KR"],l,v))).then(l=>l.ko_KR)],["lt-lt",()=>(new Promise((l,v)=>a(["../../chunks/lt_LT"],l,v))).then(l=>l.lt_LT)],["lv-lv",()=>(new Promise((l,v)=>a(["../../chunks/lv_LV"],l,v))).then(l=>l.lv_LV)],["nb-no",()=>(new Promise((l,v)=>a(["../../chunks/nb_NO"],l,v))).then(l=>l.nb_NO)],["nl-nl",()=>(new Promise((l,v)=>a(["../../chunks/nl_NL"],l,v))).then(l=>l.nl_NL)],
["pl-pl",()=>(new Promise((l,v)=>a(["../../chunks/pl_PL"],l,v))).then(l=>l.pl_PL)],["pt-br",()=>(new Promise((l,v)=>a(["../../chunks/pt_BR"],l,v))).then(l=>l.pt_BR)],["pt-pt",()=>(new Promise((l,v)=>a(["../../chunks/pt_PT"],l,v))).then(l=>l.pt_PT)],["ro-ro",()=>(new Promise((l,v)=>a(["../../chunks/ro_RO"],l,v))).then(l=>l.ro_RO)],["ru-ru",()=>(new Promise((l,v)=>a(["../../chunks/ru_RU"],l,v))).then(l=>l.ru_RU)],["sk-sk",()=>(new Promise((l,v)=>a(["../../chunks/sk_SK"],l,v))).then(l=>l.sk_SK)],["sl-sl",
()=>(new Promise((l,v)=>a(["../../chunks/sl_SL"],l,v))).then(l=>l.sl_SL)],["sr-rs",()=>(new Promise((l,v)=>a(["../../chunks/sr_RS"],l,v))).then(l=>l.sr_RS)],["sv-se",()=>(new Promise((l,v)=>a(["../../chunks/sv_SE"],l,v))).then(l=>l.sv_SE)],["th-th",()=>(new Promise((l,v)=>a(["../../chunks/th_TH"],l,v))).then(l=>l.th_TH)],["tr-tr",()=>(new Promise((l,v)=>a(["../../chunks/tr_TR"],l,v))).then(l=>l.tr_TR)],["uk-ua",()=>(new Promise((l,v)=>a(["../../chunks/uk_UA"],l,v))).then(l=>l.uk_UA)],["vi-vn",()=>
(new Promise((l,v)=>a(["../../chunks/vi_VN"],l,v))).then(l=>l.vi_VN)],["zh-cn",()=>(new Promise((l,v)=>a(["../../chunks/zh_Hans"],l,v))).then(l=>l.zh_Hans)],["zh-hk",()=>(new Promise((l,v)=>a(["../../chunks/zh_Hant"],l,v))).then(l=>l.zh_Hant)],["zh-tw",()=>(new Promise((l,v)=>a(["../../chunks/zh_Hant"],l,v))).then(l=>l.zh_Hant)]]);let g=null,h=null;c.getChartLocale=m;c.getColorSet=function(l,v="default"){const q=f.find(k=>k.name===v);return q?q.colors.map(k=>l.color(k)):null};c.loadChartsModule=function(){return d.apply(this,
arguments)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureExpression/FeatureExpressionViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/reactiveUtils ../../../core/throttle ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../popup/content/AttachmentsContent ../../../popup/content/Content ../../../popup/content/CustomContent ../../../popup/content/ExpressionContent ../../../popup/content/FieldsContent ../../../popup/content/MediaContent ../../../popup/content/RelationshipContent ../../../popup/content/TextContent ../../../popup/ElementExpressionInfo ../FeatureContent/FeatureContentViewModel ../FeatureFields/FeatureFieldsViewModel ../FeatureMedia/FeatureMediaViewModel ../support/arcadeFeatureUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y){t=function(w){function D(F){var E=w.call(this,F)||this;E._abortController=null;E.expressionInfo=null;E.graphic=null;E.contentElement=null;E.contentElementViewModel=null;E.interceptor=null;E.view=null;E._cancelQuery=()=>{const {_abortController:K}=a._assertThisInitialized(E);K&&K.abort();E._abortController=null};E._createVM=()=>{var K=E.contentElement?.type;E.contentElementViewModel?.destroy();K="fields"===K?new x:"media"===K?new u:"text"===
K?new A:null;E._set("contentElementViewModel",K)};E._compile=a._asyncToGenerator(function*(){E._cancelQuery();const K=new AbortController;E._abortController=K;yield E._compileExpression();E._abortController===K&&(E._abortController=null)});E._compileThrottled=m.throttle(E._compile,1,a._assertThisInitialized(E));E._compileExpression=a._asyncToGenerator(function*(){const {expressionInfo:K,graphic:J,interceptor:M,spatialReference:N,map:P,view:I,_abortController:G}=a._assertThisInitialized(E);if(K&&J&&
N&&P){var H=yield y.loadArcadeUtils();if(G===E._abortController)if((H=yield y.createCompiledExpression({arcadeUtils:H,expressionInfo:K,graphic:J,interceptor:M,map:P,spatialReference:N,view:I}))&&"esri.arcade.Dictionary"===H.declaredClass){H=yield H.castAsJsonAsync(G?.signal);var L=H?.type;H="media"===L?p.fromJSON(H):"text"===L?C.fromJSON(H):"fields"===L?k.fromJSON(H):null;E._set("contentElement",H)}else E._set("contentElement",null)}else E._set("contentElement",null)});E.handles.add([r.watch(()=>
[E.expressionInfo,E.graphic,E.map,E.spatialReference,E.view],()=>E._compileThrottled(),r.initial),r.watch(()=>[E.contentElement],()=>E._createVM(),r.initial)]);return E}a._inheritsLoose(D,w);D.prototype.destroy=function(){this._cancelQuery();this.contentElementViewModel?.destroy();this._set("contentElementViewModel",null);this._set("contentElement",null)};a._createClass(D,[{key:"spatialReference",get:function(){return this.view?.spatialReference??null},set:function(F){this._override("spatialReference",
F)}},{key:"state",get:function(){const {_abortController:F,contentElement:E,contentElementViewModel:K}=this;return F?"loading":E||K?"ready":"disabled"}},{key:"map",get:function(){return this.view?.map??null},set:function(F){this._override("map",F)}}]);return D}(n.HandleOwnerMixin(t));c.__decorate([d.property()],t.prototype,"_abortController",void 0);c.__decorate([d.property({type:B})],t.prototype,"expressionInfo",void 0);c.__decorate([d.property({type:b})],t.prototype,"graphic",void 0);c.__decorate([d.property({readOnly:!0})],
t.prototype,"contentElement",void 0);c.__decorate([d.property({readOnly:!0})],t.prototype,"contentElementViewModel",void 0);c.__decorate([d.property()],t.prototype,"interceptor",void 0);c.__decorate([d.property()],t.prototype,"spatialReference",null);c.__decorate([d.property({readOnly:!0})],t.prototype,"state",null);c.__decorate([d.property()],t.prototype,"map",null);c.__decorate([d.property()],t.prototype,"view",void 0);return t=c.__decorate([g.subclass("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],
t)})},"esri/widgets/Feature/support/arcadeFeatureUtils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../layers/FeatureLayer ./featureUtils".split(" "),function(a,c,b,t,n,r,m){function d(C){return`<ul class="esri-widget__list">${C.map(B=>`<li>${"string"===typeof B?m.applyTextFormattingHTML(m.htmlEntities(B)):B}</li>`).join("")}</ul>`}function f(C){return`<table class="esri-widget__table">${C.keys().map(B=>{var A=
C.field(B);A="string"===typeof A?m.applyTextFormattingHTML(m.htmlEntities(A)):A;return`<tr><th>${B}</th><td>${A}</td></tr>`}).join("")}</table>`}function e({aggregatedFeatures:C,arcadeUtils:B,featureSetVars:A,context:x,viewInfo:u,map:y,graphic:w,interceptor:D}){A.forEach(F=>{F=F.toLowerCase();var E=u.sr;const K={map:y,spatialReference:E,interceptor:D};"$map"===F&&(x.vars[F]=B.convertMapToFeatureSetCollection(K));"$layer"===F&&(x.vars[F]=B.convertFeatureLayerToFeatureSet({layer:w.sourceLayer,spatialReference:E,
interceptor:D}));"$datastore"===F&&(x.vars[F]=B.convertServiceUrlToWorkspace({url:w.sourceLayer.url,spatialReference:E,interceptor:D}));if("$aggregatedfeatures"===F){E=w.layer;const {fields:J,objectIdField:M,geometryType:N,spatialReference:P,displayField:I}=E;E=new r({fields:J,objectIdField:M,geometryType:N,spatialReference:P,displayField:I,...("feature"===E.type?{templates:E.templates,typeIdField:E.typeIdField,types:E.types}:null),source:C});x.vars[F]=B.convertFeatureLayerToFeatureSet({layer:E,spatialReference:P,
interceptor:D})}})}function g(){return new Promise((C,B)=>a(["../../../support/arcadeUtils"],C,B))}function h(C){return l.apply(this,arguments)}function l(){l=b._asyncToGenerator(function*({graphic:C,view:B}){const {isAggregate:A,layer:x}=C;if(!A||!x||"2d"!==B?.type)return[];B=yield B.whenLayerView(x);if(!("createQuery"in B&&"queryFeatures"in B))return[];const u=B.createQuery();C=C.getObjectId();u.aggregateIds=null!=C?[C]:[];({features:C}=yield B.queryFeatures(u));return C});return l.apply(this,arguments)}
function v(C){return q.apply(this,arguments)}function q(){q=b._asyncToGenerator(function*({expressionInfo:C,arcadeUtils:B,interceptor:A,spatialReference:x,map:u,graphic:y,view:w}){if(!C||!C.expression)return null;const D=B.createSyntaxTree(C.expression),F=p.filter(K=>B.hasVariable(D,K));[w]=yield Promise.all([h({graphic:y,view:w}),B.loadScriptDependencies(D,!0,F)]);const E=B.getViewInfo({spatialReference:x});x=B.createExecContext(y,E);x.interceptor=A;x.useAsync=!0;e({aggregatedFeatures:w,arcadeUtils:B,
featureSetVars:F,context:x,viewInfo:E,map:u,graphic:y,interceptor:A});A=B.createFunction(D,x);return B.executeAsyncFunction(A,x).catch(K=>z.error("arcade-execution-error",{error:K,graphic:y,expressionInfo:C}))});return q.apply(this,arguments)}function k(){k=b._asyncToGenerator(function*({expressionInfos:C,spatialReference:B,graphic:A,interceptor:x,map:u,view:y}){if(!C||!C.length)return{};const w=yield g(),D={};for(const F of C)D[`expression/${F.name}`]=v({expressionInfo:F,arcadeUtils:w,interceptor:x,
spatialReference:B,map:u,graphic:A,view:y});C=yield n.eachAlways(D);B={};for(const F in C)A=C[F].value,A="string"===typeof A?m.applyTextFormattingHTML(m.htmlEntities(A)):Array.isArray(A)?d(A):"esri.arcade.Dictionary"===A?.declaredClass?f(A):A,B[F]=A;return B});return k.apply(this,arguments)}const p=["$datastore","$map","$layer","$aggregatedfeatures"],z=t.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");c.createCompiledExpression=v;c.createCompiledExpressions=function(C){return k.apply(this,
arguments)};c.loadArcadeUtils=g;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/FeatureRelationship":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureRelationship/FeatureRelationshipViewModel ./support/FeatureElementInfo ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../intl/substitute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){const C={title:!0,description:!0};t=function(B){function A(u,y){var w=B.call(this,u,y)||this;w._featureElementInfo=null;w._relatedFeatureIntersectionObserverNode=null;w._relatedFeatureIntersectionObserver=new IntersectionObserver(([D])=>{D?.isIntersecting&&w._increaseFeaturePage()},{root:window.document});w.headingLevel=2;w.viewModel=new l;w.messages=null;w.messagesCommon=null;w.visibleElements={...C};w._increaseFeaturePage=()=>{const {state:D,showAllEnabled:F,
relatedFeatures:E,featuresPerPage:K,featurePage:J}=w.viewModel;"ready"===D&&F&&E.length>=K*J&&w.viewModel.featurePage++};return w}c._inheritsLoose(A,B);var x=A.prototype;x.initialize=function(){this._featureElementInfo=new v;this.addHandles([m.watch(()=>[this.viewModel.description,this.viewModel.title,this.headingLevel],()=>this._setupFeatureElementInfo(),m.initial),m.watch(()=>[this.viewModel.state,this.viewModel.showAllEnabled,this._relatedFeatureIntersectionObserverNode],()=>this._handleRelatedFeatureObserverChange()),
m.on(()=>this.viewModel.relatedFeatureViewModels,"change",()=>this._setupRelatedFeatureViewModels())])};x.loadDependencies=function(){return Promise.all([new Promise((u,y)=>a(["../../chunks/calcite-list"],u,y)),new Promise((u,y)=>a(["../../chunks/calcite-list-item"],u,y)),new Promise((u,y)=>a(["../../chunks/calcite-icon"],u,y)),new Promise((u,y)=>a(["../../chunks/calcite-notice"],u,y))])};x.destroy=function(){this._unobserveRelatedFeatureObserver();this._featureElementInfo=n.destroyMaybe(this._featureElementInfo)};
x.castVisibleElements=function(u){return{...C,...u}};x.renderStickyLoading=function(){return"querying"===this.viewModel.state?p.tsx("div",{key:"sticky-loader",class:"esri-feature__sticky-loading-container"},this.renderLoadingIcon()):null};x.renderLoadingIcon=function(){return p.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})};x.renderLoading=function(){return p.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},
this.renderLoadingIcon())};x.renderShowAllIconNode=function(){return p.tsx("calcite-icon",{scale:"s",icon:"list",slot:"content-end"})};x.renderChevronIconNode=function(){const u=q.isRTL(this.container)?"chevron-left":"chevron-right";return p.tsx("calcite-icon",{scale:"s",icon:u,slot:"content-end"})};x.renderRelatedFeature=function(u){var {itemDescriptionFieldName:y}=this.viewModel;const w=u.title;u.description=y&&u.formattedAttributes?.global[y];y="loading"===u.state;return p.tsx("calcite-list-item",
{key:u.uid,label:y?`${this.messagesCommon?.loading}\u2026`:w,description:y?"\u2026":u.description??"",onCalciteListItemSelect:()=>this.emit("select-record",{featureViewModel:u})},this.renderChevronIconNode())};x.renderShowAllListItem=function(){return this.displayShowAllButton?p.tsx("calcite-list-item",{key:"show-all-item",label:this.messages?.showAll,description:this.featureCountDescription,onCalciteListItemSelect:()=>this.emit("show-all-records")},this.renderShowAllIconNode()):null};x.renderNoRelatedFeaturesMessage=
function(){return p.tsx("calcite-notice",{key:"no-related-features-message",icon:"information",open:!0,kind:"brand",scale:"s",width:"full"},p.tsx("div",{slot:"message"},this.messages?.noRelatedFeatures))};x.renderFeatureObserver=function(){return p.tsx("div",{key:"feature-observer",class:"esri-feature__feature-observer",bind:this,afterCreate:this._relatedFeatureIntersectionObserverCreated})};x.renderList=function(){const {relatedFeatureViewModels:u}=this.viewModel;return p.tsx("calcite-list",null,
u.toArray().map(y=>this.renderRelatedFeature(y)),this.renderShowAllListItem())};x.renderRelatedFeatures=function(){const {displayListItems:u}=this,{state:y}=this.viewModel;return p.tsx("div",{key:"list-container",class:this.classes("esri-feature-relationship__list",{["esri-feature-relationship__list--querying"]:"querying"===y})},u?this.renderList():"ready"===y?this.renderNoRelatedFeaturesMessage():null,this.renderStickyLoading(),this.renderFeatureObserver())};x.renderRelationshipNotFound=function(){return p.tsx("calcite-notice",
{key:"relationship-not-found",icon:"exclamation-mark-triangle",open:!0,kind:"danger",scale:"s",width:"full"},p.tsx("div",{slot:"message"},this.messages?.relationshipNotFound))};x.render=function(){const {state:u}=this.viewModel;return p.tsx("div",{class:this.classes("esri-feature-relationship","esri-widget")},this._featureElementInfo?.render(),"loading"===u?this.renderLoading():"disabled"===u?this.renderRelationshipNotFound():this.renderRelatedFeatures())};x._setupRelatedFeatureViewModels=function(){const {relatedFeatureViewModels:u}=
this.viewModel;this.removeHandles("related-feature-viewmodels");u?.forEach(y=>{this.addHandles(m.watch(()=>[y.title,y.state],()=>this.scheduleRender(),m.initial),"related-feature-viewmodels")});this.scheduleRender()};x._setupFeatureElementInfo=function(){const {headingLevel:u,visibleElements:y}=this,w=y.description&&this.description,D=y.title&&this.title;this._featureElementInfo?.set({description:w,title:D,headingLevel:u})};x._handleRelatedFeatureObserverChange=function(){var u=c._asyncToGenerator(function*(){this._unobserveRelatedFeatureObserver();
const {state:y,showAllEnabled:w}=this.viewModel;yield r.after(0);this._relatedFeatureIntersectionObserverNode&&"ready"===y&&w&&this._relatedFeatureIntersectionObserver.observe(this._relatedFeatureIntersectionObserverNode)});return function(){return u.apply(this,arguments)}}();x._relatedFeatureIntersectionObserverCreated=function(u){this._relatedFeatureIntersectionObserverNode=u};x._unobserveRelatedFeatureObserver=function(){this._relatedFeatureIntersectionObserverNode&&this._relatedFeatureIntersectionObserver.unobserve(this._relatedFeatureIntersectionObserverNode)};
c._createClass(A,[{key:"displayShowAllButton",get:function(){const {showAllEnabled:u,featureCount:y,displayCount:w}=this.viewModel;return!u&&!!y&&(y>w||0===w)}},{key:"displayListItems",get:function(){return this.displayShowAllButton||0<this.viewModel.relatedFeatureViewModels.length}},{key:"description",get:function(){return this.viewModel.description},set:function(u){this.viewModel.description=u}},{key:"featureCountDescription",get:function(){const {messages:u}=this,{featureCount:y}=this.viewModel;
return z.substitute(1===y?u?.numberRecord:u?.numberRecords,{number:y})}},{key:"title",get:function(){return this.viewModel.title},set:function(u){this.viewModel.title=u}}]);return A}(h);b.__decorate([d.property()],t.prototype,"_relatedFeatureIntersectionObserverNode",void 0);b.__decorate([d.property({readOnly:!0})],t.prototype,"displayShowAllButton",null);b.__decorate([d.property({readOnly:!0})],t.prototype,"displayListItems",null);b.__decorate([d.property()],t.prototype,"description",null);b.__decorate([d.property({readOnly:!0})],
t.prototype,"featureCountDescription",null);b.__decorate([d.property()],t.prototype,"headingLevel",void 0);b.__decorate([d.property()],t.prototype,"title",null);b.__decorate([d.property({type:l})],t.prototype,"viewModel",void 0);b.__decorate([d.property(),k.messageBundle("esri/widgets/Feature/t9n/Feature")],t.prototype,"messages",void 0);b.__decorate([d.property(),k.messageBundle("esri/t9n/common")],t.prototype,"messagesCommon",void 0);b.__decorate([d.property()],t.prototype,"visibleElements",void 0);
b.__decorate([f.cast("visibleElements")],t.prototype,"castVisibleElements",null);return t=b.__decorate([g.subclass("esri.widgets.Feature.FeatureRelationship")],t)})},"esri/widgets/Feature/FeatureRelationship/FeatureRelationshipViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/Clonable ../../../core/Collection ../../../core/HandleOwner ../../../core/Identifiable ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/throttle ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../rest/support/RelationshipQuery ../support/featureUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){t=function(C){function B(x){var u=C.call(this,x)||this;u._queryAbortController=null;u._queryPageAbortController=null;u._queryFeatureCountAbortController=null;u.featuresPerPage=10;u.description=null;u.graphic=null;u.layer=null;u.map=null;u.orderByFields=null;u.featureCount=0;u.relationshipId=null;u.showAllEnabled=!1;u.title=null;u._cancelQuery=()=>{const {_queryAbortController:y}=a._assertThisInitialized(u);y&&y.abort();u._queryAbortController=null};u._cancelQueryFeatureCount=
()=>{const {_queryFeatureCountAbortController:y}=a._assertThisInitialized(u);y&&y.abort();u._queryFeatureCountAbortController=null};u._cancelQueryPage=()=>{const {_queryPageAbortController:y}=a._assertThisInitialized(u);y&&y.abort();u._queryPageAbortController=null};u._queryController=a._asyncToGenerator(function*(){u._cancelQuery();const y=new AbortController;u._queryAbortController=y;yield e.ignoreAbortErrors(u._query());u._queryAbortController===y&&(u._queryAbortController=null)});u._queryFeatureCountController=
a._asyncToGenerator(function*(){u._cancelQueryFeatureCount();const y=new AbortController;u._queryFeatureCountAbortController=y;yield e.ignoreAbortErrors(u._queryFeatureCount());u._queryFeatureCountAbortController===y&&(u._queryFeatureCountAbortController=null)});u._queryPageController=a._asyncToGenerator(function*(){const y=new AbortController;u._queryPageAbortController=y;yield e.ignoreAbortErrors(u._queryPage());u._queryPageAbortController===y&&(u._queryPageAbortController=null)});u._queryThrottled=
h.throttle(u._queryController,100,a._assertThisInitialized(u));u._queryFeatureCountThrottled=h.throttle(u._queryFeatureCountController,100,a._assertThisInitialized(u));u._queryPageThrottled=h.throttle(u._queryPageController,100,a._assertThisInitialized(u));u._query=a._asyncToGenerator(function*(){const {_queryAbortController:y,relatedFeatures:w}=a._assertThisInitialized(u);u._destroyRelatedFeatureViewModels();u.featurePage=1;w.removeAll();w.addMany(u._sliceFeatures(yield u._queryRelatedFeatures({signal:y?.signal})))});
u.handles.add([g.watch(()=>[u.displayCount,u.graphic,u.layer,u.map,u.orderByFieldsFixedCasing,u.relationshipId,u.featuresPerPage,u.showAllEnabled,u.canQuery,u.featureCount],()=>u._queryThrottled(),g.initial),g.watch(()=>[u.featurePage,u.showAllEnabled],()=>u._queryPageThrottled()),g.watch(()=>[u.layer,u.relationshipId,u.objectId,u.canQuery],()=>u._queryFeatureCountThrottled())]);return u}a._inheritsLoose(B,C);var A=B.prototype;A.destroy=function(){this._destroyRelatedFeatureViewModels();this.relatedFeatures.removeAll();
this._cancelQuery();this._cancelQueryFeatureCount();this._cancelQueryPage()};A._destroyRelatedFeatureViewModels=function(){this.relatedFeatureViewModels?.forEach(x=>!x.destroyed&&x.destroy());this.relatedFeatureViewModels.removeAll()};A._queryFeatureCount=function(){var x=a._asyncToGenerator(function*(){const {layer:u,relatedLayer:y,relationshipId:w,objectId:D,_queryFeatureCountAbortController:F,canQuery:E,supportsCacheHint:K}=this;yield u?.load();yield y?.load();if(E&&u&&y){var J=y.createQuery();
J=new p({cacheHint:K,relationshipId:w,returnGeometry:!1,objectIds:[D],where:f.unwrapOrValue(J.where,void 0)});J=yield u.queryRelatedFeaturesCount(J,{signal:F?.signal});this._set("featureCount",J[D]||0)}else this._set("featureCount",0)});return function(){return x.apply(this,arguments)}}();A._sliceFeatures=function(x){const {showAllEnabled:u,displayCount:y}=this;return u?x:y?x.slice(0,y):[]};A._queryPage=function(){var x=a._asyncToGenerator(function*(){const {relatedFeatures:u,featurePage:y,showAllEnabled:w,
_queryPageAbortController:D}=this;!w||2>y||u.addMany(yield this._queryRelatedFeatures({signal:D?.signal}))});return function(){return x.apply(this,arguments)}}();A._queryRelatedFeatures=function(){var x=a._asyncToGenerator(function*(u){const {orderByFieldsFixedCasing:y,showAllEnabled:w,featuresPerPage:D,displayCount:F,layer:E,relationshipId:K,featurePage:J,featureCount:M,relatedLayer:N,supportsCacheHint:P}=this,{canQuery:I,objectId:G}=this;if(!I||!E||!N)return[];var H=w?((J-1)*D+M)%M:0;const L=w?
D:F;var O=N.objectIdField;O=[...y?.map(Q=>Q.field),O].filter(f.isSome);const S=y?.map(Q=>`${Q.field} ${Q.order}`),R=N.createQuery();H=new p({orderByFields:S,start:H,num:L,outFields:O,cacheHint:P,relationshipId:K,returnGeometry:!1,objectIds:[G],where:f.unwrapOrValue(R.where,void 0)});u=(yield E.queryRelatedFeatures(H,{signal:u?.signal}))[G]?.features||[];u.forEach(Q=>{Q.sourceLayer=N;Q.layer=N});return u});return function(u){return x.apply(this,arguments)}}();a._createClass(B,[{key:"featurePage",get:function(){return this._get("featurePage")},
set:function(x){const {featuresPerPage:u,featureCount:y}=this;this._set("featurePage",Math.min(Math.max(x,1),Math.ceil(y/u)||1))}},{key:"orderByFieldsFixedCasing",get:function(){const {orderByFields:x,relatedLayer:u}=this;return x&&u?.loaded?x.map(y=>{const w=y.clone();y=z.getFixedFieldName(y.field,u);w.field=y;return w}):x??[]}},{key:"supportsCacheHint",get:function(){return!!this.layer?.capabilities?.queryRelated?.supportsCacheHint}},{key:"canQuery",get:function(){const x=this.layer?.capabilities?.queryRelated;
return!!this.relatedLayer&&!!this.relationship&&"number"===typeof this.relationshipId&&"number"===typeof this.objectId&&!!x?.supportsCount&&!!x?.supportsPagination}},{key:"itemDescriptionFieldName",get:function(){return this.orderByFieldsFixedCasing?.[0]?.field||null}},{key:"displayCount",get:function(){return this._get("displayCount")},set:function(x){this._set("displayCount",Math.min(Math.max(x,0),10))}},{key:"objectId",get:function(){return(this.objectIdField&&this.graphic?.attributes?.[this.objectIdField])??
null}},{key:"objectIdField",get:function(){return this.layer?.objectIdField||null}},{key:"relatedFeatures",get:function(){return this._get("relatedFeatures")||new r}},{key:"relatedLayer",get:function(){const {layer:x,map:u,relationship:y}=this;return x?.loaded&&u&&y?z.findRelatedLayer(u,x,y)??null:null}},{key:"relationship",get:function(){const {relationshipId:x,layer:u}=this;return"number"===typeof x?u?.relationships?.find(({id:y})=>y===x)??null:null}},{key:"relatedFeatureViewModels",get:function(){return this._get("relatedFeatureViewModels")||
new r}},{key:"state",get:function(){const {_queryAbortController:x,_queryFeatureCountAbortController:u,_queryPageAbortController:y,canQuery:w}=this;return u?"loading":x||y?"querying":w?"ready":"disabled"}}]);return B}(n.ClonableMixin(d.IdentifiableMixin(m.HandleOwnerMixin(t))));c.__decorate([l.property()],t.prototype,"_queryAbortController",void 0);c.__decorate([l.property()],t.prototype,"_queryPageAbortController",void 0);c.__decorate([l.property()],t.prototype,"_queryFeatureCountAbortController",
void 0);c.__decorate([l.property({value:1})],t.prototype,"featurePage",null);c.__decorate([l.property()],t.prototype,"featuresPerPage",void 0);c.__decorate([l.property({readOnly:!0})],t.prototype,"orderByFieldsFixedCasing",null);c.__decorate([l.property({readOnly:!0})],t.prototype,"supportsCacheHint",null);c.__decorate([l.property({readOnly:!0})],t.prototype,"canQuery",null);c.__decorate([l.property()],t.prototype,"description",void 0);c.__decorate([l.property({readOnly:!0})],t.prototype,"itemDescriptionFieldName",
null);c.__decorate([l.property({value:3})],t.prototype,"displayCount",null);c.__decorate([l.property({type:b})],t.prototype,"graphic",void 0);c.__decorate([l.property()],t.prototype,"layer",void 0);c.__decorate([l.property()],t.prototype,"map",void 0);c.__decorate([l.property({readOnly:!0})],t.prototype,"objectId",null);c.__decorate([l.property({readOnly:!0})],t.prototype,"objectIdField",null);c.__decorate([l.property()],t.prototype,"orderByFields",void 0);c.__decorate([l.property({readOnly:!0})],
t.prototype,"relatedFeatures",null);c.__decorate([l.property({readOnly:!0})],t.prototype,"relatedLayer",null);c.__decorate([l.property({readOnly:!0})],t.prototype,"relationship",null);c.__decorate([l.property()],t.prototype,"featureCount",void 0);c.__decorate([l.property({readOnly:!0})],t.prototype,"relatedFeatureViewModels",null);c.__decorate([l.property()],t.prototype,"relationshipId",void 0);c.__decorate([l.property()],t.prototype,"showAllEnabled",void 0);c.__decorate([l.property()],t.prototype,
"state",null);c.__decorate([l.property()],t.prototype,"title",void 0);return t=c.__decorate([k.subclass("esri.widgets.Feature.FeatureRelationship.FeatureRelationshipViewModel")],t)})},"esri/widgets/Feature/FeatureViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../arcade/featureset/support/FeatureSetQueryInterceptor ../../core/Accessor ../../core/Handles ../../core/Identifiable ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../popup/content/TextContent ./FeatureAttachments/FeatureAttachmentsViewModel ./FeatureContent/FeatureContentViewModel ./FeatureExpression/FeatureExpressionViewModel ./FeatureFields/FeatureFieldsViewModel ./FeatureMedia/FeatureMediaViewModel ./FeatureRelationship/FeatureRelationshipViewModel ./support/arcadeFeatureUtils ./support/featureUtils ./support/relatedFeatureUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D){var F;const E={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0,relationshipContent:!0};n=F=function(K){function J(N){var P=K.call(this,N)||this;P._handles=new r;P._error=null;P._featureAbortController=null;P._graphicChangedThrottled=h.throttle(P._graphicChanged,1,a._assertThisInitialized(P));P._expressionAttributes=null;P._graphicExpressionAttributes=null;P.abilities=
{...E};P.content=null;P.contentViewModels=[];P.description=null;P.defaultPopupTemplateEnabled=!1;P.formattedAttributes=null;P.lastEditInfo=null;P.relatedInfos=new Map;P.title="";P.view=null;P._isAllowedContentType=I=>{const {abilities:G}=a._assertThisInitialized(P);return"attachments"===I.type&&!!G.attachmentsContent||"custom"===I.type&&!!G.customContent||"fields"===I.type&&!!G.fieldsContent||"media"===I.type&&!!G.mediaContent||"text"===I.type&&!!G.textContent||"expression"===I.type&&!!G.expressionContent||
"relationship"===I.type&&!!G.relationshipContent};P._handles.add(g.watch(()=>[P.graphic,P._effectivePopupTemplate,P.abilities],()=>P._graphicChangedThrottled(),g.initial));return P}a._inheritsLoose(J,K);var M=J.prototype;M.destroy=function(){this._clear();this._cancelFeatureQuery();this._error=null;this._handles.destroy();this.graphic=null;this._destroyContentViewModels();this.relatedInfos.clear()};M.castAbilities=function(N){return{...E,...N}};M.setActiveMedia=function(N,P){N=this.contentViewModels[N];
N instanceof x&&N.setActiveMedia(P)};M.nextMedia=function(N){N=this.contentViewModels[N];N instanceof x&&N.next()};M.previousMedia=function(N){N=this.contentViewModels[N];N instanceof x&&N.previous()};M.updateGeometry=function(){var N=a._asyncToGenerator(function*(){const {graphic:P,spatialReference:I,_sourceLayer:G}=this;yield G?.load();var H=G?.objectIdField;H&&P&&G&&(H=P?.attributes?.[H],null!=H&&(H=[H],!P.geometry&&(H=(yield w.querySourceLayer({layer:G,graphic:P,outFields:[],objectIds:H,returnGeometry:!0,
spatialReference:I}))?.geometry)))&&(P.geometry=H)});return function(){return N.apply(this,arguments)}}();M._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};M._graphicChanged=function(){var N=a._asyncToGenerator(function*(){this._cancelFeatureQuery();this._error=null;this._clear();const {graphic:P}=this;if(P){var I=new AbortController;this._featureAbortController=I;try{yield this._queryFeature({signal:I.signal})}catch(G){e.isAbortError(G)||(this._error=
G,d.getLogger(this.declaredClass).error("error","The popupTemplate could not be displayed for this feature.",{error:G,graphic:P,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===I&&(this._featureAbortController=null)}});return function(){return N.apply(this,arguments)}}();M._cancelFeatureQuery=function(){const {_featureAbortController:N}=this;N&&N.abort();this._featureAbortController=null};M._compileContentElement=function(N,P){if("attachments"===N.type)return this._compileAttachments(N,
P);if("custom"===N.type)return this._compileCustom(N,P);if("fields"===N.type)return this._compileFields(N,P);if("media"===N.type)return this._compileMedia(N,P);if("text"===N.type)return this._compileText(N,P);if("expression"===N.type)return this._compileExpression(N,P);if("relationship"===N.type)return this._compileRelationship(N,P)};M._compileContent=function(N){this._destroyContentViewModels();if(this.graphic)return Array.isArray(N)?N.filter(this._isAllowedContentType).map((P,I)=>this._compileContentElement(P,
I)).filter(f.isSome):"string"===typeof N?this._compileText(new p({text:N}),0).text:N};M._destroyContentViewModels=function(){this._handles?.remove("relationship-view-models");this._handles?.remove("content-view-models");this.contentViewModels.forEach(N=>N&&!N.destroyed&&N.destroy());this._set("contentViewModels",[])};M._matchesFeature=function(N,P){N=N?.graphic?.getObjectId();P=P?.getObjectId();return f.isSome(N)&&f.isSome(P)&&N===P};M._setRelatedFeaturesViewModels=function({relatedFeatureViewModels:N,
relatedFeatures:P,map:I}){const {view:G,spatialReference:H}=this;P?.filter(Boolean).forEach(L=>{N.find(O=>this._matchesFeature(O,L))||N.add(new F({abilities:{relationshipContent:!1},map:I,view:G,spatialReference:H,graphic:L}))});N.forEach(L=>{P?.find(O=>this._matchesFeature(L,O))||N.remove(L)})};M._setExpressionContentVM=function(N,P){const I=this.formattedAttributes,{contentElement:G,contentElementViewModel:H}=N;N=G?.type;H&&N&&("fields"===N&&(this._createFieldsFormattedAttributes({contentElement:G,
contentElementIndex:P,formattedAttributes:I}),H.set(this._createFieldsVMParams(G,P))),"media"===N&&(this._createMediaFormattedAttributes({contentElement:G,contentElementIndex:P,formattedAttributes:I}),H.set(this._createMediaVMParams(G,P))),"text"===N&&H.set(this._createTextVMParams(G)))};M._compileRelationship=function(N,P){const {displayCount:I,orderByFields:G,relationshipId:H,title:L,description:O}=N,{_sourceLayer:S,graphic:R,map:Q}=this,V=new u({displayCount:I,graphic:R,orderByFields:G,relationshipId:H,
layer:S,map:Q,...this._compileTitleAndDesc({title:L,description:O})});this.contentViewModels[P]=V;this._handles.add(g.on(()=>V.relatedFeatures,"change",()=>this._setRelatedFeaturesViewModels(V)),"relationship-view-models");return N};M._compileExpression=function(N,P){const {expressionInfo:I}=N,{graphic:G,map:H,spatialReference:L,view:O}=this,S=new B({expressionInfo:I,graphic:G,interceptor:F.interceptor,map:H,spatialReference:L,view:O});this.contentViewModels[P]=S;this._handles.add(g.watch(()=>S.contentElementViewModel,
()=>this._setExpressionContentVM(S,P),g.initial),"content-view-models");return N};M._compileAttachments=function(N,P){const {graphic:I}=this,{description:G,title:H}=N;this.contentViewModels[P]=new z({graphic:I,...this._compileTitleAndDesc({title:H,description:G})});return N};M._compileCustom=function(N,P){const {graphic:I}=this,{creator:G,destroyer:H}=N;this.contentViewModels[P]=new C({graphic:I,creator:G,destroyer:H});return N};M._compileTitleAndDesc=function({title:N,description:P}){const {_fieldInfoMap:I,
_sourceLayer:G,graphic:H,formattedAttributes:L}=this,O=H?.attributes,S=this._expressionAttributes,R=L.global;return{title:w.substituteFieldsInLinksAndAttributes({attributes:O,fieldInfoMap:I,globalAttributes:R,expressionAttributes:S,layer:G,text:N}),description:w.substituteFieldsInLinksAndAttributes({attributes:O,fieldInfoMap:I,globalAttributes:R,expressionAttributes:S,layer:G,text:P})}};M._createFieldsVMParams=function(N,P){const I=this._effectivePopupTemplate,G=this.formattedAttributes,H={...G?.global,
...G?.content[P]};P=(N?.fieldInfos||I?.fieldInfos)?.filter(({fieldName:S})=>w.isExpressionField(S)||w.isRelatedField(S)||H.hasOwnProperty(S));const {description:L,title:O}=N;return{attributes:H,expressionInfos:I?.expressionInfos,fieldInfos:P,...this._compileTitleAndDesc({title:O,description:L})}};M._compileFields=function(N,P){const I=N.clone();N=new A(this._createFieldsVMParams(N,P));this.contentViewModels[P]=N;I.fieldInfos=N.formattedFieldInfos.slice(0);return I};M._createMediaVMParams=function(N,
P){const {abilities:I,graphic:G,_fieldInfoMap:H,_effectivePopupTemplate:L,relatedInfos:O,_sourceLayer:S,_expressionAttributes:R}=this,Q=this.formattedAttributes,V=G?.attributes??{},{description:aa,mediaInfos:X,title:W}=N;return{abilities:{chartAnimation:I.chartAnimation},activeMediaInfoIndex:N.activeMediaInfoIndex||0,attributes:V,isAggregate:G?.isAggregate,layer:S,fieldInfoMap:H,formattedAttributes:{...Q?.global,...Q?.content[P]},expressionAttributes:R,mediaInfos:X,popupTemplate:L,relatedInfos:O,
...this._compileTitleAndDesc({title:W,description:aa})}};M._compileMedia=function(N,P){const I=N.clone();N=new x(this._createMediaVMParams(N,P));I.mediaInfos=N.formattedMediaInfos.slice(0);this.contentViewModels[P]=N;return I};M._createTextVMParams=function(N){const {graphic:P,_fieldInfoMap:I,_sourceLayer:G,_expressionAttributes:H}=this;N&&N.text&&(N.text=w.substituteFieldsInLinksAndAttributes({attributes:P?.attributes??{},fieldInfoMap:I,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:H,
layer:G,text:N.text}));return{graphic:P,creator:N.text}};M._compileText=function(N,P){N=N.clone();this.contentViewModels[P]=new C(this._createTextVMParams(N));return N};M._compileLastEditInfo=function(){const {_effectivePopupTemplate:N,_sourceLayer:P,graphic:I}=this;if(N){var {lastEditInfoEnabled:G}=N,H=P?.editFieldsInfo;if(G&&H)return w.formatEditInfo(H,I?.attributes)}};M._compileTitle=function(N){const {_fieldInfoMap:P,_sourceLayer:I,graphic:G,_expressionAttributes:H}=this;return w.substituteFieldsInLinksAndAttributes({attributes:G?.attributes??
{},fieldInfoMap:P,globalAttributes:this.formattedAttributes?.global??{},expressionAttributes:H,layer:I,text:N})};M._getTitle=function(){var N=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:P,graphic:I}=this;return I?w.graphicCallback(P?.title,{graphic:I}):null});return function(){return N.apply(this,arguments)}}();M._getContent=function(){var N=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:P,graphic:I}=this;return I?w.graphicCallback(P?.content,{graphic:I}):null});
return function(){return N.apply(this,arguments)}}();M._queryFeature=function(){var N=a._asyncToGenerator(function*(P){const {_featureAbortController:I,_sourceLayer:G,graphic:H,_effectivePopupTemplate:L}=this,O=this.map,S=this.view,R=this.spatialReference;if(I===this._featureAbortController&&H){yield w.queryUpdatedFeature({graphic:H,popupTemplate:L,layer:G,spatialReference:R},P);var {content:{value:Q},title:{value:V}}=yield e.eachAlways({content:this._getContent(),title:this._getTitle()});({expressionAttributes:{value:P}}=
yield e.eachAlways({checkForRelatedFeatures:this._checkForRelatedFeatures(P),expressionAttributes:y.createCompiledExpressions({expressionInfos:L?.expressionInfos,spatialReference:R,graphic:H,map:O,interceptor:F.interceptor,view:S})}));I===this._featureAbortController&&H&&(this._expressionAttributes=P,this._graphicExpressionAttributes={...H.attributes,...P},this._set("formattedAttributes",this._createFormattedAttributes(Q)),this._set("title",this._compileTitle(V)),this._set("lastEditInfo",this._compileLastEditInfo()||
null),this._set("content",this._compileContent(Q)||null))}});return function(P){return N.apply(this,arguments)}}();M._createMediaFormattedAttributes=function({contentElement:N,contentElementIndex:P,formattedAttributes:I}){const {_effectivePopupTemplate:G,graphic:H,relatedInfos:L,_sourceLayer:O,_fieldInfoMap:S,_graphicExpressionAttributes:R}=this;I.content[P]=w.formatAttributes({fieldInfos:G?.fieldInfos,graphic:H,attributes:{...R,...N.attributes},layer:O,fieldInfoMap:S,relatedInfos:L})};M._createFieldsFormattedAttributes=
function({contentElement:N,contentElementIndex:P,formattedAttributes:I}){if(N.fieldInfos){const {graphic:G,relatedInfos:H,_sourceLayer:L,_fieldInfoMap:O,_graphicExpressionAttributes:S}=this;I.content[P]=w.formatAttributes({fieldInfos:N.fieldInfos,graphic:G,attributes:{...S,...N.attributes},layer:L,fieldInfoMap:O,relatedInfos:H})}};M._createFormattedAttributes=function(N){const {_effectivePopupTemplate:P,graphic:I,relatedInfos:G,_sourceLayer:H,_fieldInfoMap:L,_graphicExpressionAttributes:O}=this,S=
{global:w.formatAttributes({fieldInfos:P?.fieldInfos,graphic:I,attributes:O,layer:H,fieldInfoMap:L,relatedInfos:G}),content:[]};Array.isArray(N)&&N.forEach((R,Q)=>{"fields"===R.type&&this._createFieldsFormattedAttributes({contentElement:R,contentElementIndex:Q,formattedAttributes:S});"media"===R.type&&this._createMediaFormattedAttributes({contentElement:R,contentElementIndex:Q,formattedAttributes:S})});return S};M._checkForRelatedFeatures=function(N){const {graphic:P,_effectivePopupTemplate:I}=this;
return this._queryRelatedInfos(P,w.getAllFieldInfos(I),N)};M._queryRelatedInfos=function(){var N=a._asyncToGenerator(function*(P,I,G){const {relatedInfos:H,_sourceLayer:L}=this;H.clear();const O=f.isSome(L?.associatedLayer)?yield L?.associatedLayer.load(G):L;if(O&&P){var S=I.filter(V=>V&&w.isRelatedField(V.fieldName));if(S&&S.length){I.forEach(V=>this._configureRelatedInfo(V,O));var R=yield D.queryLayerInfos({relatedInfos:H,layer:O},G);Object.keys(R).forEach(V=>{const aa=H.get(V.toString());V=R[V]?.value;
aa&&V&&(aa.layerInfo=V.data)});var Q=yield D.queryRelatedFeatures({graphic:P,relatedInfos:H,layer:O},G);Object.keys(Q).forEach(V=>{D.setRelatedFeatures(Q[V]?.value,H.get(V.toString()))})}}});return function(P,I,G){return N.apply(this,arguments)}}();M._configureRelatedInfo=function(N,P){const {relatedInfos:I}=this,G=D.getRelatedFieldInfo(N.fieldName);if(G){var {layerId:H,fieldName:L}=G;H&&(P=I.get(H.toString())||D.createRelatedInfo(H,P))&&(D.updateRelatedInfo({relatedInfo:P,fieldName:L,fieldInfo:N}),
this.relatedInfos.set(H,P))}};a._createClass(J,[{key:"_effectivePopupTemplate",get:function(){return f.isSome(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return w.createfieldInfoMap(w.getAllFieldInfos(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return w.getSourceLayer(this.graphic)}},{key:"isTable",get:function(){return this._sourceLayer?.isTable||!1}},{key:"state",get:function(){return this.graphic?
this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(N){this._set("graphic",N?N.clone():null)}},{key:"spatialReference",get:function(){return this.view?.spatialReference??null},set:function(N){this._override("spatialReference",N)}},{key:"map",get:function(){return this.view?.map||null},set:function(N){this._override("map",N)}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}}]);return J}(m.IdentifiableMixin(n));n.interceptor=
new t.FeatureSetQueryInterceptor(w.preLayerQueryCallback,w.preRequestCallback);c.__decorate([l.property()],n.prototype,"_error",void 0);c.__decorate([l.property()],n.prototype,"_featureAbortController",void 0);c.__decorate([l.property({readOnly:!0})],n.prototype,"_effectivePopupTemplate",null);c.__decorate([l.property({readOnly:!0})],n.prototype,"_fieldInfoMap",null);c.__decorate([l.property({readOnly:!0})],n.prototype,"_sourceLayer",null);c.__decorate([l.property()],n.prototype,"abilities",void 0);
c.__decorate([v.cast("abilities")],n.prototype,"castAbilities",null);c.__decorate([l.property({readOnly:!0})],n.prototype,"content",void 0);c.__decorate([l.property({readOnly:!0})],n.prototype,"contentViewModels",void 0);c.__decorate([l.property()],n.prototype,"description",void 0);c.__decorate([l.property({type:Boolean})],n.prototype,"defaultPopupTemplateEnabled",void 0);c.__decorate([l.property({readOnly:!0})],n.prototype,"isTable",null);c.__decorate([l.property({readOnly:!0})],n.prototype,"state",
null);c.__decorate([l.property({readOnly:!0})],n.prototype,"formattedAttributes",void 0);c.__decorate([l.property({type:b,value:null})],n.prototype,"graphic",null);c.__decorate([l.property({readOnly:!0})],n.prototype,"lastEditInfo",void 0);c.__decorate([l.property({readOnly:!0})],n.prototype,"relatedInfos",void 0);c.__decorate([l.property()],n.prototype,"spatialReference",null);c.__decorate([l.property({readOnly:!0})],n.prototype,"title",void 0);c.__decorate([l.property()],n.prototype,"map",null);
c.__decorate([l.property({readOnly:!0})],n.prototype,"waitingForContent",null);c.__decorate([l.property()],n.prototype,"view",void 0);return n=F=c.__decorate([k.subclass("esri.widgets.FeatureViewModel")],n)})},"esri/arcade/featureset/support/FeatureSetQueryInterceptor":function(){define(["exports"],function(a){a.FeatureSetQueryInterceptor=function(c,b){this.preLayerQueryCallback=c;this.preRequestCallback=b;this.preLayerQueryCallback||(this.preLayerQueryCallback=t=>{});this.preRequestCallback||(this.preLayerQueryCallback=
t=>{})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/resources":function(){define(["exports"],function(a){a.CSS={iconText:"esri-icon-font-fallback-text",iconLoading:"esri-icon-loading-indicator esri-rotating",esriTable:"esri-widget__table",esriWidget:"esri-widget",base:"esri-feature",container:"esri-feature__size-container",title:"esri-feature__title",main:"esri-feature__main-container",btn:"esri-feature__button",icon:"esri-feature__icon",content:"esri-feature__content",
contentNode:"esri-feature__content-node",contentElement:"esri-feature__content-element",text:"esri-feature__text",lastEditedInfo:"esri-feature__last-edited-info",fields:"esri-feature__fields",fieldHeader:"esri-feature__field-header",fieldData:"esri-feature__field-data",fieldDataDate:"esri-feature__field-data--date",loadingSpinnerContainer:"esri-feature__loading-container",spinner:"esri-feature__loading-spinner"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Feature/support/FeatureContentMixin":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/Error ../../../core/has ../../../core/accessorSupport/decorators/subclass ../resources ../../support/widget ../../support/jsxFactory".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){a.FeatureContentMixin=l=>{l=function(v){function q(){var k=v.apply(this,arguments)||this;k.renderNodeContent=p=>g.isWidget(p)&&!p.destroyed?h.tsx("div",{class:e.CSS.contentNode,key:p},p.render()):p instanceof HTMLElement?h.tsx("div",{class:e.CSS.contentNode,key:p,bind:p,afterCreate:k._attachToNode}):g.hasDomNode(p)?h.tsx("div",{class:e.CSS.contentNode,key:p,bind:p.domNode,afterCreate:k._attachToNode}):null;return k}c._inheritsLoose(q,v);q.prototype._attachToNode=
function(k){k.appendChild(this)};return q}(l);return l=b.__decorate([f.subclass("esri.widgets.Feature.ContentMixin")],l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Spinner":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./Widget ./Spinner/SpinnerViewModel ./support/widgetUtils ./support/jsxFactory".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){m=function(v){function q(p,z){p=v.call(this,p,z)||this;p._animationDelay=500;p._animationPromise=null;p.viewModel=new g;return p}a._inheritsLoose(q,v);var k=q.prototype;k.initialize=function(){this.addHandles(n.watch(()=>this.visible,p=>this._visibleChange(p)))};k.destroy=function(){this._animationPromise=null};k.show=function(p){const {location:z,promise:C}=p??{};z&&(this.viewModel.location=z);this.visible=!0;p=()=>this.hide();C&&C.catch(()=>{}).then(p)};k.hide=
function(){this.visible=!1};k.render=function(){var {visible:p}=this,{screenLocation:z}=this.viewModel;z=!!z;p={["esri-spinner--start"]:p&&z,["esri-spinner--finish"]:!p&&z};z=this._getPositionStyles();return l.tsx("div",{class:this.classes("esri-spinner",p),styles:z})};k._visibleChange=function(p){if(p)this.viewModel.screenLocationEnabled=!0;else{var z=t.after(this._animationDelay);this._animationPromise=z;z.catch(()=>{}).then(()=>{this._animationPromise===z&&(this.viewModel.screenLocationEnabled=
!1,this._animationPromise=null)})}};k._getPositionStyles=function(){const {screenLocation:p,view:z}=this.viewModel;if(b.isNone(z)||b.isNone(p))return{};const {padding:C}=z;return{left:`${p.x-C.left}px`,top:`${p.y-C.top}px`}};a._createClass(q,[{key:"location",get:function(){return this.viewModel.location},set:function(p){this.viewModel.location=p}},{key:"view",get:function(){return this.viewModel.view},set:function(p){this.viewModel.view=p}},{key:"visible",get:function(){return this.viewModel.visible},
set:function(p){this.viewModel.visible=p}}]);return q}(e);c.__decorate([r.property()],m.prototype,"location",null);c.__decorate([r.property()],m.prototype,"view",null);c.__decorate([r.property({type:g})],m.prototype,"viewModel",void 0);c.__decorate([r.property()],m.prototype,"visible",null);return m=c.__decorate([f.subclass("esri.widgets.Spinner")],m)})},"esri/widgets/Spinner/SpinnerViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../support/AnchorElementViewModel".split(" "),
function(a,c,b,t,n,r,m){t=function(d){function f(e){e=d.call(this,e)||this;e.visible=!1;return e}a._inheritsLoose(f,d);return f}(m);c.__decorate([b.property()],t.prototype,"visible",void 0);return t=c.__decorate([r.subclass("esri.widgets.CompassViewModel")],t)})},"esri/widgets/support/AnchorElementViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d,f,e){const g=Symbol("anchorHandles");b=function(l){function v(q){var k=l.call(this,q)||this;k[h]=new t;k.location=null;k.screenLocationEnabled=!1;k.view=null;k[g].add([r.when(()=>n.applySome(k.screenLocationEnabled?k.view:null,p=>[p.size,"3d"===p.type?p.camera:p.viewpoint]),()=>k.notifyChange("screenLocation")),r.watch(()=>k.screenLocation,(p,z)=>{n.isSome(p)&&n.isSome(z)&&k.emit("view-change")})]);return k}a._inheritsLoose(v,l);v.prototype.destroy=function(){this.view=null;
this[g]=n.destroyMaybe(this[g])};a._createClass(v,[{key:"screenLocation",get:function(){const {location:q,view:k,screenLocationEnabled:p}=this;return p&&n.isSome(q)&&n.isSome(k)&&k.ready?k.toScreen?.(q):null}}]);return v}(b.EventedAccessor);var h=g;c.__decorate([m.property()],b.prototype,"location",void 0);c.__decorate([m.property()],b.prototype,"screenLocation",null);c.__decorate([m.property()],b.prototype,"screenLocationEnabled",void 0);c.__decorate([m.property()],b.prototype,"view",void 0);return b=
c.__decorate([e.subclass("esri.widgets.support.AnchorElementViewModel")],b)})},"esri/widgets/Popup/actionUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ./actions".split(" "),function(a,c,b,t,n,r,m){function d(A){const {selectedFeature:x,location:u,view:y}=A;return y?"3d"===y.type?x??u??null:A.get("selectedFeature.geometry")||u:null}function f(A){return!!A&&A.isAggregate&&"cluster"===A.sourceLayer?.featureReduction?.type}
function e(A,x){return g.apply(this,arguments)}function g(){g=c._asyncToGenerator(function*(A,x){if("3d"!==x?.type||!A||"esri.Graphic"!==A.declaredClass)return!0;if((x=x.getViewForGraphic(A))&&"whenGraphicBounds"in x){let u;try{u=yield x.whenGraphicBounds(A,{useViewElevation:!0})}catch(y){}return!u||!u.boundingBox||u.boundingBox[0]===u.boundingBox[3]&&u.boundingBox[1]===u.boundingBox[4]&&u.boundingBox[2]===u.boundingBox[5]}return!0});return g.apply(this,arguments)}function h(A){return l.apply(this,
arguments)}function l(){l=c._asyncToGenerator(function*(A){const {location:x,selectedFeature:u,view:y,zoomFactor:w}=A,D=d(A);if(!y||!D)throw A=new b("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",{target:D,view:y}),B.error(A),A;const F=y.scale/w,E=A.selectedFeature?.geometry??x,K=n.isSome(E)&&"point"===E.type&&(yield e(u,y));m.zoomToFeature.active=!0;m.zoomToFeature.disabled=!0;try{yield A.zoomTo({target:{target:D,scale:K?F:void 0}})}catch(J){const M=new b("zoom-to:invalid-graphic",
"Could not zoom to the location of the graphic.",{graphic:u});B.error(M)}finally{m.zoomToFeature.active=!1,m.zoomToFeature.disabled=!1,A.zoomToLocation=null,K&&(A.location=E)}});return l.apply(this,arguments)}function v(A){return q.apply(this,arguments)}function q(){q=c._asyncToGenerator(function*(A){const {selectedFeature:x,view:u}=A;if("2d"!==u?.type)throw A=new b("zoomToCluster:invalid-view","View must be 2d MapView.",{view:u}),B.error(A),A;if(!x||!f(x))throw A=new b("zoomToCluster:invalid-selectedFeature",
"Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:x}),B.error(A),A;const [y,w]=yield z(u,x);m.zoomToClusteredFeatures.active=!0;m.zoomToClusteredFeatures.disabled=!0;const {extent:D}=yield y.queryExtent(w);yield A.zoomTo({target:D});m.zoomToClusteredFeatures.active=!1;m.zoomToClusteredFeatures.disabled=!1});return q.apply(this,arguments)}function k(){k=c._asyncToGenerator(function*(A){const {view:x,selectedFeature:u}=A;if(x&&u){var [y,w]=yield z(x,u),{extent:D}=yield y.queryExtent(w);
A.selectedClusterBoundaryFeature.geometry=D;x.graphics.add(A.selectedClusterBoundaryFeature)}});return k.apply(this,arguments)}function p(){p=c._asyncToGenerator(function*(A){const {selectedFeature:x,view:u}=A;if(u&&x){var [y,w]=yield z(u,x);m.browseClusteredFeatures.active=!0;m.browseClusteredFeatures.disabled=!0;({features:A}=yield y.queryFeatures(w));m.browseClusteredFeatures.active=!1;m.browseClusteredFeatures.disabled=!1;u.popup?.open({features:[x].concat(A),featureMenuOpen:!0})}});return p.apply(this,
arguments)}function z(A,x){return C.apply(this,arguments)}function C(){C=c._asyncToGenerator(function*(A,x){A=yield A.whenLayerView(x.sourceLayer);const u=A.createQuery();x=x.getObjectId();u.aggregateIds=null!=x?[x]:[];return[A,u]});return C.apply(this,arguments)}const B=t.getLogger("esri.widgets.Popup.PopupViewModel");a.browseAggregateFeatures=function(A){return p.apply(this,arguments)};a.displayClusterExtent=function(A){return k.apply(this,arguments)};a.getPointFromGeometry=function(A){if(n.isNone(A))return null;
switch(A.type){case "point":return A;case "extent":return A.center;case "polygon":return A.centroid;case "multipoint":case "polyline":return A.extent?.center;default:return null}};a.getSelectedTarget=d;a.isClusterFeature=f;a.removeClusteredFeaturesForBrowsing=function(A){const x=A.features.filter(u=>f(u));x.length&&(A.features=x)};a.triggerAction=A=>{const {event:x,view:u}=A;({action:A}=x);var y=u&&u.popup;if(!A)return Promise.reject(new b("trigger-action:missing-arguments","Event has no action"));
if(!y)return Promise.reject(new b("trigger-action:missing-arguments","view.popup is missing"));const {disabled:w,id:D}=A;if(!D)return Promise.reject(new b("trigger-action:invalid-action","action.id is missing"));if(w)return Promise.reject(new b("trigger-action:invalid-action","Action is disabled"));if(D===m.zoomToFeature.id)return h(y.viewModel).catch(r.throwIfNotAbortError);if(D===m.zoomToClusteredFeatures.id)return v(y.viewModel);if(D===m.browseClusteredFeatures.id)return y.featureMenuOpen=!y.featureMenuOpen,
y.viewModel.browseClusterEnabled=!y.viewModel.browseClusterEnabled,Promise.resolve();y.viewModel.browseClusterEnabled=!1;if(D===m.removeSelectedFeature.id){y.close();({selectedFeature:A}=y);if(!A)return Promise.reject(new b(`trigger-action:${m.removeSelectedFeature.id}`,"selectedFeature is required",{selectedFeature:A}));({sourceLayer:y}=A);y?y.remove(A):u.graphics.remove(A)}return Promise.resolve()};a.zoomToClusterExtent=v;a.zoomToLocation=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/widgets/Popup/actions":function(){define(["exports","../../support/actions/ActionButton"],function(a,c){const b=new c({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),t=new c({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),n=new c({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"});c=new c({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",
className:"esri-icon-table"});a.all=[b,t,c,n];a.browseClusteredFeatures=c;a.removeSelectedFeature=t;a.zoomToClusteredFeatures=n;a.zoomToFeature=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Popup/css":function(){define(["exports"],function(a){a.CSS={calciteThemeLight:"calcite-mode-light",calciteThemeDark:"calcite-mode-dark",iconLeftTriangleArrow:"esri-icon-left-triangle-arrow",iconRightTriangleArrow:"esri-icon-right-triangle-arrow",iconDockToTop:"esri-icon-maximize",
iconDockToBottom:"esri-icon-dock-bottom",iconDockToLeft:"esri-icon-dock-left",iconDockToRight:"esri-icon-dock-right",iconClose:"esri-icon-close",iconUndock:"esri-icon-minimize",iconCheckMark:"esri-icon-check-mark",iconLoading:"esri-icon-loading-indicator",iconDefaultAction:"esri-icon-default-action",iconActionsMenu:"esri-icon-handle-horizontal",rotating:"esri-rotating",base:"esri-popup",widget:"esri-widget",main:"esri-popup__main-container",loadingContainer:"esri-popup__loading-container",isCollapsible:"esri-popup--is-collapsible",
isCollapsed:"esri-popup--is-collapsed",shadow:"esri-popup--shadow",isDocked:"esri-popup--is-docked",isDockedTopLeft:"esri-popup--is-docked-top-left",isDockedTopCenter:"esri-popup--is-docked-top-center",isDockedTopRight:"esri-popup--is-docked-top-right",isDockedBottomLeft:"esri-popup--is-docked-bottom-left",isDockedBottomCenter:"esri-popup--is-docked-bottom-center",isDockedBottomRight:"esri-popup--is-docked-bottom-right",alignTopCenter:"esri-popup--aligned-top-center",alignBottomCenter:"esri-popup--aligned-bottom-center",
alignTopLeft:"esri-popup--aligned-top-left",alignBottomLeft:"esri-popup--aligned-bottom-left",alignTopRight:"esri-popup--aligned-top-right",alignBottomRight:"esri-popup--aligned-bottom-right",isFeatureMenuOpen:"esri-popup--feature-menu-open",isActionsMenuOpen:"esri-popup--actions-menu-open",hasFeatureUpdated:"esri-popup--feature-updated",header:"esri-popup__header",headerButtons:"esri-popup__header-buttons",headerContainer:"esri-popup__header-container",headerContainerButton:"esri-popup__header-container--button",
headerTitle:"esri-popup__header-title",content:"esri-popup__content",contentHasFlows:"esri-content--has-flows",contentFlowItem:"esri-content__flow-item",footer:"esri-popup__footer",footerHasPagination:"esri-popup__footer--has-pagination",footerHasActions:"esri-popup__footer--has-actions",footerHasActionsMenu:"esri-popup__footer--has-actions-menu",button:"esri-popup__button",buttonDisabled:"esri-popup__button--disabled",buttonDock:"esri-popup__button--dock",icon:"esri-popup__icon",iconDock:"esri-popup__icon--dock-icon",
inlineActionsContainer:"esri-popup__inline-actions-container",actionsMenuButton:"esri-popup__actions-menu-button",actions:"esri-popup__actions",action:"esri-popup__action",actionImage:"esri-popup__action-image",actionText:"esri-popup__action-text",actionToggle:"esri-popup__action-toggle",actionToggleOn:"esri-popup__action-toggle--on",actionExit:"esri-popup__action--exit",actionSelectFeature:"esri-popup__action--select-feature",pointer:"esri-popup__pointer",pointerDirection:"esri-popup__pointer-direction",
navigation:"esri-popup__navigation",paginationPrevious:"esri-popup__pagination-previous",paginationNext:"esri-popup__pagination-next",paginationPreviousIconLTR:"esri-popup__pagination-previous-icon",paginationPreviousIconRTL:"esri-popup__pagination-previous-icon--rtl",paginationNextIconLTR:"esri-popup__pagination-next-icon",paginationNextIconRTL:"esri-popup__pagination-next-icon--rtl",featureMenu:"esri-popup__feature-menu",featureMenuList:"esri-popup__feature-menu-list",featureMenuItem:"esri-popup__feature-menu-item",
featureMenuViewport:"esri-popup__feature-menu-viewport",featureMenuHeader:"esri-popup__feature-menu-header",featureMenuNote:"esri-popup__feature-menu-note",featureMenuSelected:"esri-popup__feature-menu-item--selected",featureMenuButton:"esri-popup__feature-menu-button",featureMenuTitle:"esri-popup__feature-menu-title",featureMenuObserver:"esri-popup__feature-menu-observer",featureMenuLoader:"esri-popup__feature-menu-loader",collapseButton:"esri-popup__collapse-button",collapseIcon:"esri-popup__collapse-icon"};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Popup/PopupViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../symbols ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/support/webMercatorUtils ../../layers/Layer ../../layers/LayerConstants ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../symbols/support/symbolUtils ../../views/input/InputManager ../../views/support/layerViewUtils ../Feature/FeatureViewModel ./actions ./actionUtils ../support/AnchorElementViewModel ../support/GoTo ../../symbols/SimpleFillSymbol ../../geometry/Point".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M){const N=r.ofType({key:"type",defaultKeyValue:"button",base:C,typeMap:{button:B,toggle:A}});b=function(P){function I(H){H=P.call(this,H)||this;H._handles=new d;H._pendingPromises=new Set;H._fetchFeaturesController=null;H._highlightSelectedFeaturePromise=null;H._highlightActiveFeaturePromise=null;H._selectedClusterFeature=null;H.featurePage=null;H.actions=new N;H.activeFeature=null;H.defaultPopupTemplateEnabled=!1;H.autoCloseEnabled=
!1;H.autoOpenEnabled=!0;H.browseClusterEnabled=!1;H.content=null;H.featuresPerPage=20;H.featureViewModelAbilities=null;H.featureViewModels=[];H.highlightEnabled=!0;H.includeDefaultActions=!0;H.selectedClusterBoundaryFeature=new t({symbol:new J({outline:{width:1.5,color:"cyan"},style:"none"})});H.title=null;H.updateLocationEnabled=!1;H.view=null;H.visible=!1;H.zoomFactor=4;H.zoomToLocation=null;return H}a._inheritsLoose(I,P);var G=I.prototype;G.initialize=function(){this._handles.add([g.watch(()=>
[this.autoOpenEnabled,this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),g.watch(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),g.watch(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),g.watch(()=>this.view?.animation?.state,H=>this._animationStateChange(H)),g.watch(()=>this.location,H=>this._locationChange(H)),g.watch(()=>this.selectedFeature,
H=>this._selectedFeatureChange(H)),g.watch(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),g.watch(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),g.watch(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",H=>F.triggerAction({event:H,view:this.view})),g.when(()=>!this.waitingForResult,()=>this._waitingForResultChange(),
g.sync),g.watch(()=>[this.features,this.view?.map,this.view?.spatialReference],()=>this._updateFeatureVMs()),g.watch(()=>this.view?.scale,()=>this._viewScaleChange()),g.when(()=>!this.visible,()=>this.browseClusterEnabled=!1),g.watch(()=>this.browseClusterEnabled,H=>H?this.enableClusterBrowsing():this.disableClusterBrowsing())])};G.destroy=function(){this._cancelFetchingFeatures();this._handles.destroy();this._pendingPromises.clear();this.browseClusterEnabled=!1;this.view=null};G.centerAtLocation=
function(){const {view:H}=this,L=F.getSelectedTarget(this);return L&&H?this.callGoTo({target:{target:L,scale:H.scale}}):Promise.reject(new m("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:L,view:H}))};G.zoomTo=function(H){return this.callGoTo(H)};G.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null,activeFeature:null})};G.fetchFeatures=function(H,L){const {view:O}=this;if(!O||!H)throw new m("fetch-features:invalid-screenpoint-or-view",
"Cannot fetch features without a screenPoint and view.",{screenPoint:H,view:O});return O.fetchPopupFeatures(H,{event:L&&L.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:L&&L.signal})};G.open=function(H){H={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...H,visible:!0};var {fetchFeatures:L}=H;delete H.fetchFeatures;L&&this._setFetchFeaturesPromises(H.location);L=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const O of L)delete H[O];this.set(H)};G.triggerAction=
function(H){(H=this.allActions.getItemAt(H))&&!H.disabled&&this.emit("trigger-action",{action:H})};G.next=function(){this.selectedFeatureIndex+=1;return this};G.previous=function(){--this.selectedFeatureIndex;return this};G.disableClusterBrowsing=function(){F.removeClusteredFeaturesForBrowsing(this);this._clearBrowsedClusterGraphics()};G.enableClusterBrowsing=function(){var H=a._asyncToGenerator(function*(){const {view:L,selectedFeature:O}=this;"2d"!==L?.type?f.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",
O):F.isClusterFeature(O)?(yield F.displayClusterExtent(this),yield F.browseAggregateFeatures(this)):f.getLogger(this.declaredClass).warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",O)});return function(){return H.apply(this,arguments)}}();G._animationStateChange=function(H){this.zoomToLocation||(D.zoomToFeature.disabled="waiting-for-target"===H)};G._clearBrowsedClusterGraphics=function(){const H=this.view?.graphics;H&&(H.remove(this.selectedClusterBoundaryFeature),
this._selectedClusterFeature&&H.remove(this._selectedClusterFeature));this._selectedClusterFeature=null;this.selectedClusterBoundaryFeature.geometry=null};G._viewScaleChange=function(){F.isClusterFeature(this.selectedFeature)?(this.visible=this.browseClusterEnabled=!1,this.clear()):this.browseClusterEnabled&&(this.features=this.selectedFeature?[this.selectedFeature]:[])};G._locationChange=function(H){const {selectedFeature:L,updateLocationEnabled:O}=this;O&&H&&(!L||L.geometry)&&this.centerAtLocation()};
G._selectedFeatureIndexChange=function(){this.featurePage=1<this.featureCount?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null};G._featureViewModelsChange=function(){this.featurePage=1<this.featureCount?1:null};G._setGraphicOnFeatureViewModels=function(){const {features:H,featureCount:L,featurePage:O,featuresPerPage:S,featureViewModels:R}=this;if(null!==O){var Q=((O-1)*S+L)%L;R.slice(Q,Q+S).forEach((V,aa)=>{V&&!V.graphic&&(V.graphic=H[Q+aa])})}};G._selectedFeatureChange=function(){var H=
a._asyncToGenerator(function*(L){const {location:O,updateLocationEnabled:S,view:R}=this;L&&R&&(this.browseClusterEnabled?(this._selectedClusterFeature&&(R.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),F.isClusterFeature(L)||(L.symbol=yield x.getDisplayedSymbol(L),this._selectedClusterFeature=L,R.graphics.add(this._selectedClusterFeature))):!S&&O||!L.geometry?S&&!L.geometry&&this.centerAtLocation().then(()=>{const Q=R.center?.clone();Q&&(this.location=Q)}):this.location=
e.unwrap(F.getPointFromGeometry(L.geometry)))});return function(L){return H.apply(this,arguments)}}();G._waitingForResultChange=function(){!this.featureCount&&this.promises&&(this.visible=!1)};G._setFetchFeaturesPromises=function(H){return this._fetchFeaturesWithController(this._getScreenPoint(H||this.location)).then(L=>{const {clientOnlyGraphics:O,promisesPerLayerView:S}=L;L=Promise.resolve(O);const R=S.map(Q=>Q.promise);this.promises=[L,...R]})};G._destroyFeatureVMs=function(){this.featureViewModels.forEach(H=>
H&&!H.destroyed&&H.destroy());this._set("featureViewModels",[])};G._updateFeatureVMs=function(){const {selectedFeature:H,features:L,featureViewModels:O}=this;F.isClusterFeature(H)||(this.browseClusterEnabled=!1);this._destroyFeatureVMs();if(L&&L.length){var S=O.slice(0),R=[];L.forEach((Q,V)=>{if(Q){var aa=null;S.some((X,W)=>{X&&X.graphic===Q&&(aa=X,S.splice(W,1));return!!aa});if(aa)R[V]=aa;else{const X=new w({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,
spatialReference:this.view?.spatialReference,graphic:Q===H?Q:null,map:this.view?.map,view:this.view});R[V]=X}}});S.forEach(Q=>Q&&!Q.destroyed&&Q.destroy());this._set("featureViewModels",R)}};G._getScreenPoint=function(H){const {view:L}=this;return L&&H&&"function"===typeof L.toScreen?L.toScreen(H):null};G._autoOpenEnabledChange=function(){const {_handles:H,autoOpenEnabled:L}=this;H.remove("auto-fetch-features");if(L&&this.view){const O=this.view.on("click",S=>{"mouse"===S.pointerType&&0!==S.button||
this._fetchFeaturesAndOpen(S)},u.ViewEventPriorities.WIDGET);H.add(O,"auto-fetch-features")}};G._cancelFetchingFeatures=function(){const H=this._fetchFeaturesController;H&&H.abort();this._fetchFeaturesController=null;this.notifyChange("waitingForResult")};G._fetchFeaturesWithController=function(H,L){this._cancelFetchingFeatures();const O=new AbortController,{signal:S}=O;this._fetchFeaturesController=O;this.notifyChange("waitingForResult");H=this.fetchFeatures(H,{signal:S,event:L});H.catch(()=>{}).then(()=>
{this._fetchFeaturesController=null;this.notifyChange("waitingForResult")});return H};G._fetchFeaturesAndOpen=function(H){const {screenPoint:L,mapPoint:O}=H,{view:S}=this;this._fetchFeaturesWithController(L,H).then(R=>{const {clientOnlyGraphics:Q,promisesPerLayerView:V,location:aa}=R,X=[Promise.resolve(Q),...V.map(W=>W.promise)];S?.popup?.open({location:aa||O,promises:X});return R})};G._updatePendingPromises=function(H){H&&this._pendingPromises.has(H)&&(this._pendingPromises.delete(H),this.notifyChange("pendingPromisesCount"))};
G._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};G._getLayerView=function(){var H=a._asyncToGenerator(function*(L,O){yield L.when();return L.whenLayerView(O)});return function(L,O){return H.apply(this,arguments)}}();G._getHighlightLayer=function(H){const {layer:L,sourceLayer:O}=H;return O&&"layer"in O&&O.layer?O.layer:"map-notes"===O?.type||"subtype-group"===O?.type?O:L};G._getHighlightTarget=function(H,L){L="imagery"===L.type?void 0:"objectIdField"in L?L.objectIdField||z.fallbackObjectIDAttribute:
null;const O=H.attributes;return O&&L&&O[L]||H};G._highlightActiveFeature=function(){var H=a._asyncToGenerator(function*(){this._handles.remove("highlight-active-feature");const {highlightEnabled:L,view:O,activeFeature:S,visible:R}=this;if(S&&O&&L&&R){var Q=this._getHighlightLayer(S);if(Q&&Q instanceof p){var V=this._getLayerView(O,Q);this._highlightActiveFeaturePromise=V;var aa=yield V;aa&&y.highlightsSupported(aa)&&this._highlightActiveFeaturePromise===V&&this.activeFeature&&this.highlightEnabled&&
(Q=aa.highlight(this._getHighlightTarget(S,Q)),this._handles.add(Q,"highlight-active-feature"))}}});return function(){return H.apply(this,arguments)}}();G._highlightSelectedFeature=function(){var H=a._asyncToGenerator(function*(){this._handles.remove("highlight-selected-feature");const {selectedFeature:L,highlightEnabled:O,view:S,visible:R}=this;if(L&&S&&O&&R){var Q=this._getHighlightLayer(L);if(Q&&Q instanceof p){var V=this._getLayerView(S,Q);this._highlightSelectedFeaturePromise=V;var aa=yield V;
aa&&y.highlightsSupported(aa)&&this._highlightSelectedFeaturePromise===V&&this.selectedFeature&&this.highlightEnabled&&this.visible&&(Q=aa.highlight(this._getHighlightTarget(L,Q)),this._handles.add(Q,"highlight-selected-feature"))}}});return function(){return H.apply(this,arguments)}}();G._updateFeatures=function(H){const {features:L}=this;H&&H.length&&(L.length?(H=H.filter(O=>!L.includes(O)),this.features=L.concat(H)):this.features=H)};a._createClass(I,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some(H=>
H.waitingForContent)}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){const H=this._get("allActions")||new N;H.removeAll();const {actions:L,defaultActions:O,defaultPopupTemplateEnabled:S,includeDefaultActions:R,selectedFeature:Q}=this;var V=R?O.concat(L):L;const aa=Q&&("function"===typeof Q.getEffectivePopupTemplate&&Q.getEffectivePopupTemplate(S)||Q.popupTemplate),X=aa&&aa.actions;(V=aa&&aa.overwriteActions?X:X?X.concat(V):V)&&V.filter(Boolean).forEach(W=>
H.add(W));return H}},{key:"defaultActions",get:function(){const H=this._get("defaultActions")||new N;H.removeAll();H.addMany(F.isClusterFeature(this.selectedFeature)?[D.zoomToClusteredFeatures.clone(),D.browseClusteredFeatures.clone()]:[D.zoomToFeature.clone()]);return H}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||[]},set:function(H){H=H||[];this._set("features",H);const {pendingPromisesCount:L,promiseCount:O,selectedFeatureIndex:S}=
this,R=O&&H.length;R&&L&&-1===S?this.selectedFeatureIndex=0:R&&-1!==S||(this.selectedFeatureIndex=H.length?0:-1)}},{key:"location",get:function(){return this._get("location")||null},set:function(H){let L=H;const O=this.view?.spatialReference?.isWebMercator;H&&H?.spatialReference?.isWGS84&&O&&(L=k.geographicToWebMercator(H));this._set("location",L)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||
0<this.pendingPromisesCount)||0!==this.featureCount)}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||[]},set:function(H){this._pendingPromises.clear();this.features=[];Array.isArray(H)&&H.length?(this._set("promises",H),H=H.slice(0),H.forEach(L=>{this._pendingPromises.add(L);L.then(O=>{this._pendingPromises.has(L)&&this._updateFeatures(O);this._updatePendingPromises(L)},()=>this._updatePendingPromises(L))})):this._set("promises",
[]);this.notifyChange("pendingPromisesCount")}},{key:"selectedFeature",get:function(){const {features:H,selectedFeatureIndex:L}=this;return-1===L?null:H[L]||null}},{key:"selectedFeatureIndex",get:function(){const H=this._get("selectedFeatureIndex");return"number"===typeof H?H:-1},set:function(H){const {featureCount:L}=this;H=isNaN(H)||-1>H||!L?-1:(H+L)%L;this.activeFeature=null;this._set("selectedFeatureIndex",H)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||
null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}}]);return I}(K.GoToMixin(E));c.__decorate([h.property()],b.prototype,"featurePage",void 0);c.__decorate([h.property()],b.prototype,"isLoadingFeature",null);c.__decorate([h.property({type:N})],b.prototype,"actions",void 0);c.__decorate([h.property({readOnly:!0})],b.prototype,"active",null);c.__decorate([h.property()],b.prototype,"activeFeature",void 0);c.__decorate([h.property({readOnly:!0})],b.prototype,"allActions",
null);c.__decorate([h.property({type:Boolean})],b.prototype,"defaultPopupTemplateEnabled",void 0);c.__decorate([h.property()],b.prototype,"autoCloseEnabled",void 0);c.__decorate([h.property()],b.prototype,"autoOpenEnabled",void 0);c.__decorate([h.property()],b.prototype,"browseClusterEnabled",void 0);c.__decorate([h.property()],b.prototype,"content",void 0);c.__decorate([h.property({type:N,readOnly:!0})],b.prototype,"defaultActions",null);c.__decorate([h.property({readOnly:!0})],b.prototype,"featureCount",
null);c.__decorate([h.property()],b.prototype,"features",null);c.__decorate([h.property()],b.prototype,"featuresPerPage",void 0);c.__decorate([h.property()],b.prototype,"featureViewModelAbilities",void 0);c.__decorate([h.property({readOnly:!0})],b.prototype,"featureViewModels",void 0);c.__decorate([h.property()],b.prototype,"highlightEnabled",void 0);c.__decorate([h.property()],b.prototype,"includeDefaultActions",void 0);c.__decorate([h.property({type:M})],b.prototype,"location",null);c.__decorate([h.property({readOnly:!0})],
b.prototype,"pendingPromisesCount",null);c.__decorate([h.property({readOnly:!0})],b.prototype,"selectedClusterBoundaryFeature",void 0);c.__decorate([h.property({readOnly:!0})],b.prototype,"waitingForResult",null);c.__decorate([h.property({readOnly:!0})],b.prototype,"promiseCount",null);c.__decorate([h.property()],b.prototype,"promises",null);c.__decorate([h.property({value:null,readOnly:!0})],b.prototype,"selectedFeature",null);c.__decorate([h.property({value:-1})],b.prototype,"selectedFeatureIndex",
null);c.__decorate([h.property({readOnly:!0})],b.prototype,"selectedFeatureViewModel",null);c.__decorate([h.property({readOnly:!0})],b.prototype,"state",null);c.__decorate([h.property()],b.prototype,"title",void 0);c.__decorate([h.property()],b.prototype,"updateLocationEnabled",void 0);c.__decorate([h.property()],b.prototype,"view",void 0);c.__decorate([h.property()],b.prototype,"visible",void 0);c.__decorate([h.property()],b.prototype,"zoomFactor",void 0);c.__decorate([h.property()],b.prototype,
"zoomToLocation",void 0);c.__decorate([h.property()],b.prototype,"centerAtLocation",null);return b=c.__decorate([q.subclass("esri.widgets.Popup.PopupViewModel")],b)})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./gfxUtils ./previewUtils ./renderUtils ./utils ../../widgets/Legend/styles/support/relationshipUtils ../../widgets/Legend/support/relationshipRampUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(A,x){if(x&&(A.style.filter=e.getCSSFilterFromEffectList(x),x=x.effects))for(const u of x)if("drop-shadow"===u?.type){0>u.offsetX?A.style.marginLeft=`${Math.abs(u.offsetX)}px`:A.style.marginRight=`${u.offsetX}px`;break}}function v(A,x){return q.apply(this,arguments)}function q(){q=b._asyncToGenerator(function*(A,x){switch(A.type){case "web-style":var {previewWebStyleSymbol:u}=yield new Promise((y,w)=>a(["./previewWebStyleSymbol"],y,w));return u(A,v,x);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:u}=
yield new Promise((y,w)=>a(["./previewSymbol3D"],y,w)),u(A,x);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:u}=yield new Promise((y,w)=>a(["./previewSymbol2D"],y,w)),u(A,x);case "cim":return{previewCIMSymbol:u}=yield new Promise((y,w)=>a(["./previewCIMSymbol"],y,w)),u(A,x)}});return q.apply(this,arguments)}function k(A){return A&&"opacity"in A?A.opacity*k(A.parent):1}function p(){p=b._asyncToGenerator(function*(A,
x){if(A){var u=A.sourceLayer,y=(n.isSome(x)&&(x.useSourceLayer??!1)?u:A.layer)??u;u=k(y);if(n.isSome(A.symbol)&&(!n.isSome(x)||!0!==x.ignoreGraphicSymbol))return A="web-style"===A.symbol.type?yield e.fetchWebStyleSymbol(A.symbol,{...x,cache:n.isSome(x)?x.webStyleCache:null}):A.symbol.clone(),e.applyColorToSymbol(A,null,u),A;var w=(n.isSome(x)?x.renderer:null)??(y&&"renderer"in y?y.renderer:null);if(y=w&&"getSymbolAsync"in w?yield w.getSymbolAsync(A,x):null){y="web-style"===y.type?yield y.fetchSymbol({...x,
cache:n.isSome(x)?x.webStyleCache:null}):y.clone();if(!(w&&"visualVariables"in w&&w.visualVariables&&w.visualVariables.length))return e.applyColorToSymbol(y,null,u),y;"arcadeRequiredForVisualVariables"in w&&w.arcadeRequiredForVisualVariables&&(n.isNone(x)||n.isNone(x.arcade))&&(x={...n.unwrap(x)},x.arcade=yield r.loadArcade());var D=yield new Promise((N,P)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],N,P)),F=[],E=[],K=[],J=[];for(var M of w.visualVariables)switch(M.type){case "color":F.push(M);
break;case "opacity":E.push(M);break;case "rotation":J.push(M);break;case "size":M.target||K.push(M)}M=(M=!!F.length&&F[F.length-1])?D.getColor(M,A,x):null;E=(E=!!E.length&&E[E.length-1])?D.getOpacity(E,A,x):null;null!=u&&(E=null!=E?E*u:u);e.applyColorToSymbol(y,M,E);K.length&&(u=D.getAllSizes(K,A,x),yield e.applySizesToSymbol(y,u));for(const N of J)e.applyRotationToSymbol(y,D.getRotationAngle(N,A,x),N.axis);return y}}});return p.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(A,
x){if(A){var u=k(A.layer||A.sourceLayer);if(n.isSome(A.symbol)&&(!n.isSome(x)||!0!==x.ignoreGraphicSymbol))return A="web-style"===A.symbol.type?yield e.fetchWebStyleSymbol(A.symbol,x):A.symbol.clone(),e.getColorFromSymbol(A,u);var y=n.isSome(x)&&x.renderer||A.get("layer.renderer")||A.get("sourceLayer.renderer"),w=yield y.getSymbolAsync(A,x);if(w){w="web-style"===w.type?yield e.fetchWebStyleSymbol(w,x):w.clone();var D=e.getColorFromSymbol(w,u);if(!("visualVariables"in y)||"visualVariables"in y&&!y.visualVariables||
"visualVariables"in y&&!y.visualVariables?.length)return D;y.arcadeRequiredForVisualVariables&&(n.isNone(x)||n.isNone(x.arcade))&&(x={...n.unwrap(x)},x.arcade=yield r.loadArcade());w=yield new Promise((K,J)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],K,J));var F=[],E=[];for(const K of y.visualVariables)switch(K.type){case "color":F.push(K);break;case "opacity":E.push(K)}y=(y=0<F.length?F[F.length-1]:null)?w.getColor(y,A,x):D;A=(D=0<E.length?E[E.length-1]:null)?w.getOpacity(D,
A,x):null;null!=u&&(A=null!=A?A*u:u);return y?e.applyOpacityToColor(y,A):null}}});return z.apply(this,arguments)}let C=null;const B=[255,255,255];c.getDisplayedColor=function(A,x){return z.apply(this,arguments)};c.getDisplayedSymbol=function(A,x){return p.apply(this,arguments)};c.renderColorRampPreviewHTML=function(A,x={}){var u="horizontal"===x.align;const {width:y=u?75:24,height:w=u?24:75,gradient:D=!0}=x;var F=window.devicePixelRatio,E=y*F,K=w*F;F=document.createElement("canvas");F.width=E;F.height=
K;F.style.width=`${y}px`;F.style.height=`${w}px`;const J=F.getContext("2d");var M=u?E:0,N=u?0:K;if(D){const P=J.createLinearGradient(0,0,M,N);u=A.length;const I=1===u?0:1/(u-1);A.forEach((G,H)=>P.addColorStop(H*I,G.toString()));J.fillStyle=P;J.fillRect(0,0,E,K)}else{E=u?E/A.length:E;K=u?K:K/A.length;N=M=0;for(const P of A)J.fillStyle=P.toString(),J.fillRect(M,N,E,K),M=u?M+E:0,N=u?0:N+K}A=document.createElement("div");A.style.width=`${y}px`;A.style.height=`${w}px`;l(A,x?.effectList);A.appendChild(F);
return A};c.renderDotDensityPreviewHTML=function(A,x,u){const {backgroundColor:y,outline:w,dotSize:D}=A;u=u&&u.swatchSize||d.SymbolSizeDefaults.size;const F=Math.round(u*u/D**2*.8),E=window.devicePixelRatio;A=document.createElement("canvas");const K=u*E;A.width=K;A.height=K;A.style.width=`${A.width/E}px`;A.style.height=`${A.height/E}px`;const J=A.getContext("2d");y&&(J.fillStyle=y.toCss(!0),J.fillRect(0,0,K,K),J.fill());J.fillStyle=x.toCss(!0);if(C&&C.length/2===F)for(x=0;x<2*F;x+=2)J.fillRect(C[x],
C[x+1],D*E,D*E),J.fill();else for(C=[],x=0;x<2*F;x+=2){const M=Math.floor(Math.random()*(K-0+1)),N=Math.floor(Math.random()*(K-0+1));C.push(M,N);J.fillRect(M,N,D*E,D*E);J.fill()}w&&(w.color&&(J.strokeStyle=w.color.toCss(!0)),J.lineWidth=w.width,J.strokeRect(0,0,K,K));u=new Image(u,u);u.src=A.toDataURL();return u};c.renderPieChartPreviewHTML=function(A,x={}){const u=x.radius||40;var y=2*Math.PI*u,w=A.length;const D=y/w,F=[],E=m.getStroke(x.outline);null!=E?.width&&(E.width*=2);(E||x.backgroundColor)&&
F.push({shape:{type:"circle",cx:u,cy:u,r:u},fill:x.backgroundColor,stroke:E,offset:[0,0]});const K=x.values,J=K&&K.length===w&&100===K.reduce((N,P)=>N+P,0),M=[0];for(let N=0;N<w;N++){let P=null;J&&(P=K[N]*y/100,M.push(P+M[N]));F.push({shape:{type:"circle",cx:u,cy:u,r:u/2},fill:[0,0,0,0],stroke:{width:u,dashArray:`${(P??D)/2} ${y}`,dashoffset:`-${J?M[N]/2:D/2*N}`,color:A[N]},offset:[0,0]})}w=null;A=2*u+(E?.width||0);if(y=x.holePercentage)E&&F.push({shape:{type:"circle",cx:u,cy:u,r:u*y},fill:null,stroke:E,
offset:[0,0]}),w=A/2,w=[[{shape:{type:"circle",cx:w,cy:w,r:w},fill:B,stroke:E?{...E,color:B}:null,offset:[0,0]},{shape:{type:"circle",cx:w,cy:w,r:u*y},fill:[0,0,0],stroke:null,offset:[0,0]}]];return f.renderSymbol([F],[A,A],{effectView:x.effectList,ignoreStrokeWidth:!0,masking:w,rotation:-90})};c.renderPreviewHTML=v;c.renderRelationshipRampPreviewHTML=function(A,x={}){const u=A?.authoringInfo;if("relationship"!==u?.type||!u?.numClasses||!A.uniqueValueInfos)return null;const {focus:y,numClasses:w}=
u,D=h.getRelationshipRampElement({focus:y,numClasses:w,infos:A.uniqueValueInfos});A=x&&x.node||document.createElement("div");f.renderOnce(A,()=>g.renderRelationshipRamp(D,x.id||"relationship",x.opacity||1,x.effectList));return A};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/previewUtils":function(){define(["exports","../../Color"],function(a,c){function b(t,n){return Math.round(Math.min(Math.max(t+191.25*n,0),255))}a.SymbolSizeDefaults=void 0;(function(t){t[t.size=
22]="size";t[t.lineWidth=50]="lineWidth";t[t.maxSize=120]="maxSize";t[t.maxOutlineSize=80]="maxOutlineSize";t[t.tallSymbolWidth=20]="tallSymbolWidth"})(a.SymbolSizeDefaults||(a.SymbolSizeDefaults={}));a.adjustColorBrightness=function(t,n){if(null==t)return new c;if("type"in t&&("linear"===t.type||"pattern"===t.type))return t;t=new c(t);return new c([b(t.r,n),b(t.g,n),b(t.b,n),t.a])};a.adjustColorComponentBrightness=b;a.getConeShapes=function(t,n){let r=n?a.SymbolSizeDefaults.tallSymbolWidth:t;n=n?
4:6;r=r<=a.SymbolSizeDefaults.size?r-.5*n:r-n;n=.15*r;const m=r;t-=n;return[{type:"ellipse",cx:.5*r,cy:t,rx:.5*r,ry:n},{type:"path",path:[{command:"M",values:[.5*m,0]},{command:"L",values:[m,t]},{command:"L",values:[0,t]},{command:"Z",values:[]}]}]};a.getCubeShapes=function(t,n){let r=n?a.SymbolSizeDefaults.tallSymbolWidth:t;var m=n?4:6;m=r=r<=a.SymbolSizeDefaults.size?r-.5*m:r-m;n=n?.35*r:.5*r;return[{type:"path",path:[{command:"M",values:[.5*m,0]},{command:"L",values:[m,.5*n]},{command:"L",values:[.5*
m,n]},{command:"L",values:[0,.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*m,n]},{command:"L",values:[.5*m,t]},{command:"L",values:[0,t-.5*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*m,n]},{command:"L",values:[.5*m,t]},{command:"L",values:[m,t-.5*n]},{command:"L",values:[m,.5*n]},{command:"Z",values:[]}]}]};a.getCylinderShapes=function(t,n){var r=n?a.SymbolSizeDefaults.tallSymbolWidth:t;n=n?4:6;r=r<=a.SymbolSizeDefaults.size?
r-.5*n:r-n;n=.5*r;const m=.15*r;t-=m;return[{type:"ellipse",cx:.5*r,cy:t,rx:n,ry:m},{type:"path",path:[{command:"M",values:[0,m]},{command:"L",values:[0,t]},{command:"L",values:[r,t]},{command:"L",values:[r,m]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*r,cy:m,rx:n,ry:m}]};a.getDiamondShapes=function(t){var n=t;n=n<a.SymbolSizeDefaults.size?n-2:n-4;const r=Math.floor(t/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*n,0]},{command:"L",values:[n,.5*t-r]},{command:"L",values:[.45*n-
r,.5*t+r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*n,0]},{command:"L",values:[.45*n-r,.5*t+r]},{command:"L",values:[0,.5*t-r]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*t-r]},{command:"L",values:[.45*n-r,.5*t+r]},{command:"L",values:[.45*n,t]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*n,t]},{command:"L",values:[n,.5*t-r]},{command:"L",values:[.45*n-r,.5*t+r]},{command:"Z",values:[]}]}]};a.getExtrudeSymbolShapes=
function(t){const n=a.SymbolSizeDefaults.size;t*=.5;return[{type:"path",path:[{command:"M",values:[0,.35*n]},{command:"L",values:[.3*n,.7*n]},{command:"L",values:[.3*n,.7*n+t]},{command:"L",values:[0,.7*n+t-.35*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*n,.7*n]},{command:"L",values:[.3*n,.7*n+t]},{command:"L",values:[n,t]},{command:"L",values:[n,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*n,0]},{command:"L",values:[n,0]},{command:"L",values:[.3*
n,.7*n]},{command:"L",values:[0,.35*n]},{command:"Z",values:[]}]}]};a.getInvertedConeShapes=function(t){let n=t;n=n<a.SymbolSizeDefaults.size?n-3:n-6;const r=.15*n,m=n;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[m,0]},{command:"L",values:[.5*m,t-r]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*n,cy:0,rx:.5*n,ry:r}]};a.getPathSymbolShapes=function(t,n,r){var m=a.SymbolSizeDefaults.size;let d=m,f=m;1>t?d*=.75:1<t&&(f*=1.25);t=m;n&&r&&(d=f=t=m=0);return[{type:"path",
path:[{command:"M",values:[t,0]},{command:"L",values:[r?t:.875*t,0]},{command:"L",values:[r?d-.5*t:0,f-.5*m]},{command:"L",values:[d-.5*t,f-.5*m]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[t,0]},{command:"L",values:[t,n?0:.125*m]},{command:"L",values:[d-.5*t,n?f-.5*m:m]},{command:"L",values:[d-.5*t,f-.5*m]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[d-.5*t,f-.5*m]},{command:"L",values:[r?d-.5*t:0,f-.5*m]},{command:"L",values:[r?d-.5*t:0,n?f-.5*m:m]},
{command:"L",values:[d-.5*t,n?f-.5*m:m]},{command:"Z",values:[]}]}]};a.getTetrahedronShapes=function(t){var n=t;n=n<a.SymbolSizeDefaults.size?n-1:n-2;return[{type:"path",path:[{command:"M",values:[.45*t,0]},{command:"L",values:[t,n]},{command:"L",values:[.45*t,.6*n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*t,0]},{command:"L",values:[.45*t,.6*n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,n]},{command:"L",values:[.45*
t,.6*n]},{command:"L",values:[t,n]},{command:"Z",values:[]}]}]};a.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},
{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]};
a.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],
cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],
tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",
path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/renderUtils":function(){define("exports ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../libs/maquette/projection ../../libs/maquette/projector ./svgUtils ./utils".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(v,q){l.append(v,q);l.detach(q)}function h(v,q,k){return v?b(v,{responseType:"image"}).then(p=>{p=p.data;const z=p.width,C=p.height,B=z/C;let A=q;k&&(A=Math.min(A,Math.max(z,C)));return{image:p,width:1>=B?Math.ceil(A*B):A,height:1>=B?A:Math.ceil(A/B)}}):Promise.reject(new n("renderUtils: imageDataSize","href not provided."))}const l=d.createProjector();a.renderOnce=g;a.renderSymbol=function(v,q,k){const p=Math.ceil(q[0]),z=Math.ceil(q[1]);if(!v.some(C=>!!C.length))return null;
q=k&&k.node||document.createElement("div");null!=k.opacity&&(q.style.opacity=k.opacity.toString());null!=k.effectView&&(q.style.filter=e.getCSSFilterFromEffectList(k.effectView));g(q,()=>f.renderSVG(v,p,z,k));return q};a.tintImageWithColor=function(v,q,k,p,z){return h(v,q,z).then(C=>{const B=C.width?C.width:q,A=C.height?C.height:q;var x;if(x=C.image)x=k&&"ignore"!==p?"multiply"===p&&255===k.r&&255===k.g&&255===k.b&&1===k.a?!1:!0:!1;if(x){var u=C.image.width,y=C.image.height;r("edge")&&/\.svg$/i.test(v)&&
(--u,--y);x=Math.ceil(B);var w=Math.ceil(A);var D=document.createElement("canvas");D.width=x;D.height=w;D.style.width=x+"px";D.style.height=w+"px";D=D.getContext("2d");D.clearRect(0,0,x,w);x=D;x.drawImage(C.image,0,0,u,y,0,0,B,A);w=x.getImageData(0,0,B,A);D=[k.r/255,k.g/255,k.b/255,k.a];const E=t.toHSV(k);for(let K=0;K<w.data.length;K+=4){C=w.data;u=K;y=D;var F=E;switch(p){case "multiply":C[u+0]*=y[0];C[u+1]*=y[1];C[u+2]*=y[2];C[u+3]*=y[3];break;default:const J=t.toHSV({r:C[u+0],g:C[u+1],b:C[u+2]});
J.h=F.h;J.s=F.s;J.v=J.v/100*F.v;F=t.toRGB(J);C[u+0]=F.r;C[u+1]=F.g;C[u+2]=F.b;C[u+3]*=y[3]}}x.putImageData(w,0,0);v=x.canvas.toDataURL("image/png")}else(x=c.id&&c.id.findCredential(v))&&x.token&&(C=v.includes("?")?"\x26":"?",v=`${v}${C}token=${x.token}`);return{url:v,width:B,height:A}}).catch(()=>({url:v,width:q,height:q}))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/colorUtils":function(){define(["exports"],function(a){function c(e,g){const h=[];let l,v;if(e[0].length!==
g.length)throw Error("dimensions do not match");const q=e.length,k=e[0].length;let p=0;for(l=0;l<q;l++){for(v=p=0;v<k;v++)p+=e[l][v]*g[v];h.push(p)}return h}function b(e){e=[e.r/255,e.g/255,e.b/255].map(g=>.04045>=g?g/12.92:((g+.055)/1.055)**2.4);e=c(d,e);return{x:100*e[0],y:100*e[1],z:100*e[2]}}function t(e){e=c(f,[e.x/100,e.y/100,e.z/100]).map(g=>Math.min(1,Math.max(.0031308>=g?12.92*g:1.055*g**(1/2.4)-.055,0)));return{r:Math.round(255*e[0]),g:Math.round(255*e[1]),b:Math.round(255*e[2])}}function n(e){e=
[e.x/95.047,e.y/100,e.z/108.883].map(g=>g>(6/29)**3?g**(1/3):1/3*(29/6)**2*g+4/29);return{l:116*e[1]-16,a:500*(e[0]-e[1]),b:200*(e[1]-e[2])}}function r(e){const g=e.l;e=[(g+16)/116+e.a/500,(g+16)/116,(g+16)/116-e.b/200].map(h=>h>6/29?h**3:3*(6/29)**2*(h-4/29));return{x:95.047*e[0],y:100*e[1],z:108.883*e[2]}}function m(e){if("r"in e&&"g"in e&&"b"in e)return e;if("l"in e&&"c"in e&&"h"in e){var g=e.c,h=e.h;return t(r({l:e.l,a:g*Math.cos(h),b:g*Math.sin(h)}))}if("l"in e&&"a"in e&&"b"in e)return t(r(e));
if("x"in e&&"y"in e&&"z"in e)return t(e);if("h"in e&&"s"in e&&"v"in e){h=(e.h+360)%360/60;g=e.v/100*255;e=e.s/100*g;const l=e*(1-Math.abs(h%2-1));switch(Math.floor(h)){case 0:h={r:e,g:l,b:0};break;case 1:h={r:l,g:e,b:0};break;case 2:h={r:0,g:e,b:l};break;case 3:h={r:0,g:l,b:e};break;case 4:h={r:l,g:0,b:e};break;case 5:case 6:h={r:e,g:0,b:l};break;default:h={r:0,g:0,b:0}}h.r=Math.round(h.r+g-e);h.g=Math.round(h.g+g-e);h.b=Math.round(h.b+g-e);return h}return e}const d=[[.4124,.3576,.1805],[.2126,.7152,
.0722],[.0193,.1192,.9505]],f=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];a.darken=function(e,g){e=n(b(e));e.l*=1-g;return t(r(e))};a.toHSV=function(e){if("h"in e&&"s"in e&&"v"in e)return e;var g=m(e);e=g.r;const h=g.g,l=g.b;g=Math.max(e,h,l);const v=g-Math.min(e,h,l);e=0===v?0:g===e?(h-l)/v%6:g===h?(l-e)/v+2:(e-h)/v+4;0>e&&(e+=6);return{h:60*e,s:100*(0===v?0:v/g),v:100/255*g}};a.toLAB=function(e){return"l"in e&&"a"in e&&"b"in e?e:n(b(m(e)))};a.toLCH=function(e){if(!("l"in
e&&"c"in e&&"h"in e)){var g=n(b(m(e)));e=g.l;var h=g.a;const l=g.b;g=Math.sqrt(h*h+l*l);h=Math.atan2(l,h);h=0<h?h:h+2*Math.PI;e={l:e,c:g,h}}return e};a.toRGB=m;a.toXYZ=function(e){return"x"in e&&"y"in e&&"z"in e?e:b(m(e))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/svgUtils":function(){define("exports ../../Color ../../core/has ../../core/maybe ../../chunks/mat2df32 ../../chunks/mat2d ../../widgets/support/widgetUtils ../../widgets/support/jsxFactory".split(" "),
function(a,c,b,t,n,r,m,d){function f(G,H){G*=P/180;return Math.abs(H*Math.sin(G))+Math.abs(H*Math.cos(G))}function e(G){return G.map(H=>`${H.command} ${H.values.join(" ")}`).join(" ").trim()}function g(G,H,L,O){if(G){if("circle"===G.type)return d.tsx("circle",{fill:H,"fill-rule":"evenodd",stroke:L.color,"stroke-width":L.width,"stroke-linecap":L.cap,"stroke-linejoin":L.join,"stroke-dasharray":L.dashArray,"stroke-dashoffset":L.dashOffset,"stroke-miterlimit":"4",cx:G.cx,cy:G.cy,r:G.r});if("ellipse"===
G.type)return d.tsx("ellipse",{fill:H,"fill-rule":"evenodd",stroke:L.color,"stroke-width":L.width,"stroke-linecap":L.cap,"stroke-linejoin":L.join,"stroke-dasharray":L.dashArray,"stroke-miterlimit":"4",cx:G.cx,cy:G.cy,rx:G.rx,ry:G.ry});if("rect"===G.type)return d.tsx("rect",{fill:H,"fill-rule":"evenodd",stroke:L.color,"stroke-width":L.width,"stroke-linecap":L.cap,"stroke-linejoin":L.join,"stroke-dasharray":L.dashArray,"stroke-miterlimit":"4",x:G.x,y:G.y,width:G.width,height:G.height});if("image"===
G.type)return d.tsx("image",{href:G.src,x:G.x,y:G.y,width:G.width,height:G.height,preserveAspectRatio:"none"});if("path"===G.type)return G="string"!==typeof G.path?e(G.path):G.path,d.tsx("path",{fill:H,"fill-rule":"evenodd",stroke:L.color,"stroke-width":L.width,"stroke-linecap":L.cap,"stroke-linejoin":L.join,"stroke-dasharray":L.dashArray,"stroke-miterlimit":"4",d:G});if("text"===G.type)return t.assertIsSome(O),d.tsx("text",{"dominant-baseline":O.dominantBaseline,fill:H,"fill-rule":"evenodd",stroke:L.color,
"stroke-width":L.width,"stroke-linecap":L.cap,"stroke-linejoin":L.join,"stroke-dasharray":L.dashArray,"stroke-miterlimit":"4","text-anchor":O.align,"text-decoration":O.decoration,kerning:O.kerning,rotate:O.rotate,"text-rendering":F,"font-style":O.font.style,"font-variant":O.font.variant,"font-weight":O.font.weight,"font-size":O.font.size,"font-family":O.font.family,x:G.x,y:G.y},G.text)}return null}function h(G){const H={fill:"none",pattern:null,linearGradient:null};if(G)if("type"in G&&"pattern"===
G.type){var L=`patternId-${++w}`;H.fill=`url(#${L})`;H.pattern={id:L,x:G.x,y:G.y,width:G.width,height:G.height,image:{x:0,y:0,width:G.width,height:G.height,href:G.src}}}else"type"in G&&"linear"===G.type?(L=`linearGradientId-${++D}`,H.fill=`url(#${L})`,H.linearGradient={id:L,x1:G.x1,y1:G.y1,x2:G.x2,y2:G.y2,stops:G.colors.map(O=>({offset:O.offset,color:O.color&&(new c(O.color)).toString()}))}):G&&(G=new c(G),H.fill=G.toString());return H}function l(G){const H={color:"none",width:1,cap:"butt",join:"4",
dashArray:"none",dashOffset:"0"};if(G&&(null!=G.width&&(H.width=G.width),G.cap&&(H.cap=G.cap),G.join&&(H.join=G.join.toString()),G.color&&(H.color=(new c(G.color)).toString()),G.dashArray&&(H.dashArray=G.dashArray),G.dashArray&&(H.dashOffset=G.dashoffset),G.style)){let L=null;G.style in N&&(L=N[G.style]);if(Array.isArray(L)){L=L.slice(0);const O=G.width??0;for(let S=0;S<L.length;++S)L[S]*=O;if("butt"!==G.cap){for(G=0;G<L.length;G+=2)L[G]-=O,1>L[G]&&(L[G]=1);for(G=1;G<L.length;G+=2)L[G]+=O}L=L.join(",")}H.dashArray=
L}return H}function v(G,H){const L={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};if(G){const O=G.alignBaseline;L.align=G.align;L.dominantBaseline="baseline"===O?"auto":"top"===O?"text-top":"bottom"===O?"hanging":O;L.decoration=G.decoration;L.kerning=G.kerning?"auto":"0";L.rotate=G.rotated?"90":"0";t.assertIsSome(H);L.font.style=H.style||"normal";L.font.variant=H.variant||"normal";L.font.weight=H.weight||"normal";L.font.size=
H.size&&H.size.toString()||"10pt";L.font.family=H.family||"serif"}return L}function q(G){const {pattern:H,linearGradient:L}=G;return H?d.tsx("pattern",{id:H.id,patternUnits:"userSpaceOnUse",x:H.x,y:H.y,width:H.width,height:H.height},d.tsx("image",{x:H.image.x,y:H.image.y,width:H.image.width,height:H.image.height,href:H.image.href})):L?(G=L.stops.map((O,S)=>d.tsx("stop",{key:`${S}-stop`,offset:O.offset,"stop-color":O.color})),d.tsx("linearGradient",{id:L.id,gradientUnits:"userSpaceOnUse",x1:L.x1,y1:L.y1,
x2:L.x2,y2:L.y2},G)):null}function k(G,H){if(!G)return null;const L=[];for(const O of G){const {shape:S,fill:R,stroke:Q,font:V}=O;G=h(R);const aa=l(Q),X="text"===S.type?v(S,V):null;(G=g(S,G.fill,aa,X))&&L.push(G)}return d.tsx("mask",{id:H,maskUnits:"userSpaceOnUse"},d.tsx("g",null,L))}function p(G,H,L,O,S){r.scale(G,r.identity(G),[H,L]);G[4]=G[4]*H-O*H+O;G[5]=G[5]*L-S*L+S;return G}function z(G,H){if(J&&"left"in J){null!=J.left&&J.left>G&&(J.left=G);if(null==J.right||J.right<G)J.right=G;if(null==J.top||
J.top>H)J.top=H;if(null==J.bottom||J.bottom<H)J.bottom=H}else J={left:G,bottom:H,right:G,top:H}}function C(G){const H=G.args,L=H.length;switch(G.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(G=0;G<L;G+=2)z(H[G],H[G+1]);M.x=H[L-2];M.y=H[L-1];break;case "H":for(G=0;G<L;++G)z(H[G],M.y);M.x=H[L-1];break;case "V":for(G=0;G<L;++G)z(M.x,H[G]);M.y=H[L-1];break;case "m":G=0;"x"in M||(z(M.x=H[0],M.y=H[1]),G=2);for(;G<L;G+=2)z(M.x+=H[G],M.y+=H[G+1]);break;case "l":case "t":for(G=0;G<L;G+=
2)z(M.x+=H[G],M.y+=H[G+1]);break;case "h":for(G=0;G<L;++G)z(M.x+=H[G],M.y);break;case "v":for(G=0;G<L;++G)z(M.x,M.y+=H[G]);break;case "c":for(G=0;G<L;G+=6)z(M.x+H[G],M.y+H[G+1]),z(M.x+H[G+2],M.y+H[G+3]),z(M.x+=H[G+4],M.y+=H[G+5]);break;case "s":case "q":for(G=0;G<L;G+=4)z(M.x+H[G],M.y+H[G+1]),z(M.x+=H[G+2],M.y+=H[G+3]);break;case "A":for(G=0;G<L;G+=7)z(H[G+5],H[G+6]);M.x=H[L-2];M.y=H[L-1];break;case "a":for(G=0;G<L;G+=7)z(M.x+=H[G+5],M.y+=H[G+6])}}function B(G,H,L){const O=E[G.toLowerCase()];"number"===
typeof O&&(O?H.length>=O&&(G={action:G,args:H.slice(0,H.length-H.length%O)},L.push(G),C(G)):(G={action:G,args:[]},L.push(G),C(G)))}function A(G){const H={x:0,y:0,width:0,height:0};if("circle"===G.type)H.x=G.cx-G.r,H.y=G.cy-G.r,H.width=2*G.r,H.height=2*G.r;else if("ellipse"===G.type)H.x=G.cx-G.rx,H.y=G.cy-G.ry,H.width=2*G.rx,H.height=2*G.ry;else if("image"===G.type||"rect"===G.type)H.x=G.x,H.y=G.y,H.width=G.width,H.height=G.height;else if("path"===G.type){var L=t.unwrapOrThrow;{const R=("string"!==
typeof G.path?e(G.path):G.path).match(K),Q=[];J={};M={};if(R){G="";var O=[],S=R.length;for(let V=0;V<S;++V){const aa=R[V],X=parseFloat(aa);isNaN(X)?(G&&B(G,O,Q),O=[],G=aa):O.push(X)}B(G,O,Q);G={x:0,y:0,width:0,height:0};J&&"left"in J&&(G.x=J.left,G.y=J.top,G.width=J.right-J.left,G.height=J.bottom-J.top)}else G=null}L=L.call(t,G);H.x=L.x;H.y=L.y;H.width=L.width;H.height=L.height}return H}function x(G){const H={x:0,y:0,width:0,height:0};let L=null,O=Number.NEGATIVE_INFINITY,S=Number.NEGATIVE_INFINITY;
for(const R of G)L?(L.x=Math.min(L.x,R.x),L.y=Math.min(L.y,R.y),O=Math.max(O,R.x+R.width),S=Math.max(S,R.y+R.height)):(L=H,L.x=R.x,L.y=R.y,O=R.x+R.width,S=R.y+R.height);L&&(L.width=O-L.x,L.height=S-L.y);return L}function u(G,H,L,O,S,R,Q,V,aa){var X=(Q&&R?f(R,H):H)/2,W=(Q&&R?f(R,L):L)/2;if(aa){var T=aa[0];aa=aa[1];X=(Q&&R?f(R,T):T)/2;W=(Q&&R?f(R,aa):aa)/2}T=G.width+O;var U=G.height+O;aa=n.create();Q=n.create();var Y=!1;if(S&&0!==T&&0!==U){S=H!==L?H/L:T/U;Y=H>L?H:L;let ba=1,da=1;isNaN(Y)||(1<S?(ba=
Y/T,da=Y/S/U):(da=Y/U,ba=Y*S/T));r.multiply(Q,Q,p(aa,ba,da,X,W));Y=!0}S=G.x+(T-O)/2;G=G.y+(U-O)/2;O=r.multiply;X-=S;W-=G;X=r.translate(aa,r.identity(aa),[X,W]);O.call(r,Q,Q,X);!Y&&(T>H||U>L)&&(X=T/H>U/L,H=(X?H:L)/(X?T:U),r.multiply(Q,Q,p(aa,H,H,S,G)));R&&(H=r.multiply,L=R%360*Math.PI/180,r.rotate(aa,r.identity(aa),L),R=Math.cos(L),L=Math.sin(L),T=aa[4],U=aa[5],aa[4]=T*R-U*L+G*L-S*R+S,aa[5]=U*R+T*L-S*L-G*R+G,H.call(r,Q,Q,aa));V&&(R=r.multiply,H=V[0],V=V[1],V=r.translate(aa,r.identity(aa),[H,V]),R.call(r,
Q,Q,V));return`matrix(${Q[0]},${Q[1]},${Q[2]},${Q[3]},${Q[4]},${Q[5]})`}function y(G,H,L){G=G?.effects.find(V=>"bloom"===V.type);if(!G)return null;const {strength:O,radius:S}=G;G=0<O?S:0;const R=(O+G)*H,Q=4*O+1;return d.tsx("filter",{id:`bloom${L}`,x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},d.tsx("feMorphology",{operator:"dilate",radius:(O+.5*G)*5**(H/100)*(.4+H/100),in:"SourceGraphic",result:"dilate"}),d.tsx("feGaussianBlur",{in:"dilate",stdDeviation:R/25,result:"blur"}),
d.tsx("feGaussianBlur",{in:"blur",stdDeviation:R/50,result:"intensityBlur"}),d.tsx("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},d.tsx("feFuncR",{type:"linear",slope:Q}),d.tsx("feFuncG",{type:"linear",slope:Q}),d.tsx("feFuncB",{type:"linear",slope:Q})),d.tsx("feMerge",null,d.tsx("feMergeNode",{in:"intensityBlur"}),d.tsx("feMergeNode",{in:"intensityBrightness"}),d.tsx("feGaussianBlur",{stdDeviation:O/10})))}let w=0,D=0;m=b("android");const F=b("chrome")||m&&4<=m?"auto":"optimizeLegibility",
E={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},K=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let J={},M={};const N={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},P=Math.PI;let I=1;a.computeBBox=x;a.generateFillAttributes=h;a.generateStrokeAttributes=l;a.generateTextAttributes=v;a.getBoundingBox=A;a.getTransformMatrix=u;a.renderDef=q;a.renderSVG=
function(G,H,L,O={}){const S=[],R=[],Q=++I,V=y(O.effectView,H,Q);var aa=null;V&&(aa=O.effectView?.effects.find(Y=>"bloom"===Y.type),aa=(aa.strength?aa.strength+aa.radius/2:0)/3,aa=[Math.max(H+H*aa,10),Math.max(L+L*aa,10)]);for(let Y=0;Y<G.length;Y++){var X=G[Y];const ba=[];var W=[],T=0,U=0;let da=0;for(const ea of X){const {shape:ca,fill:ja,stroke:ia,font:Z,offset:ha}=ea;O.ignoreStrokeWidth||(T+=ia&&ia.width||0);X=h(ja);const fa=l(ia),ka="text"===ca.type?v(ca,Z):null;S.push(q(X));ba.push(g(ca,X.fill,
fa,ka));W.push(A(ca));ha&&(U+=ha[0],da+=ha[1])}W=t.unwrapOrThrow(x(W));T=u(W,H,L,T,O.scale??!1,O.rotation,O.useRotationSize??!1,[U,da],aa);U=null;O.masking&&(U=`mask-${Y}`,S.push(k(O.masking[Y],U)),U=`url(#${U})`);R.push(U?d.tsx("g",{mask:U},d.tsx("g",{transform:T},ba)):d.tsx("g",{transform:T},ba))}O.useRotationSize&&O.rotation&&(H=f(O.rotation,H),L=f(O.rotation,L));V&&(t.assertIsSome(aa),H=aa[0],L=aa[1]);return d.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:H,height:L,style:"display: block;"},
V,d.tsx("defs",null,S),V?d.tsx("g",{filter:`url(#bloom${Q})`},R):R)};a.renderShape=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat2df32":function(){define(["exports"],function(a){function c(){const f=new Float32Array(6);f[0]=1;f[3]=1;return f}function b(f){const e=new Float32Array(6);e[0]=f[0];e[1]=f[1];e[2]=f[2];e[3]=f[3];e[4]=f[4];e[5]=f[5];return e}function t(f,e,g,h,l,v){const q=new Float32Array(6);q[0]=f;q[1]=e;q[2]=g;q[3]=h;q[4]=l;q[5]=v;return q}function n(f,
e){return new Float32Array(f,e,6)}function r(f,e,g,h){const l=e[h];e=e[h+1];f[h]=g[0]*l+g[2]*e+g[4];f[h+1]=g[1]*l+g[3]*e+g[5]}function m(f,e,g,h=0,l=0,v=2){for(l=l||e.length/v;h<l;h++)r(f,e,g,h*v)}const d=Object.freeze(Object.defineProperty({__proto__:null,clone:b,create:c,createView:n,fromValues:t,transform:r,transformMany:m},Symbol.toStringTag,{value:"Module"}));a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.mat2df32=d;a.transform=r;a.transformMany=m})},"esri/chunks/mat2d":function(){define(["exports",
"./common"],function(a,c){function b(y,w){y[0]=w[0];y[1]=w[1];y[2]=w[2];y[3]=w[3];y[4]=w[4];y[5]=w[5];return y}function t(y){y[0]=1;y[1]=0;y[2]=0;y[3]=1;y[4]=0;y[5]=0;return y}function n(y,w,D,F,E,K,J){y[0]=w;y[1]=D;y[2]=F;y[3]=E;y[4]=K;y[5]=J;return y}function r(y,w){const D=w[0],F=w[1],E=w[2],K=w[3],J=w[4];w=w[5];let M=D*K-F*E;if(!M)return null;M=1/M;y[0]=K*M;y[1]=-F*M;y[2]=-E*M;y[3]=D*M;y[4]=(E*w-K*J)*M;y[5]=(F*J-D*w)*M;return y}function m(y){return y[0]*y[3]-y[1]*y[2]}function d(y,w,D){const F=
w[0],E=w[1],K=w[2],J=w[3],M=w[4];w=w[5];const N=D[0],P=D[1],I=D[2],G=D[3],H=D[4];D=D[5];y[0]=F*N+K*P;y[1]=E*N+J*P;y[2]=F*I+K*G;y[3]=E*I+J*G;y[4]=F*H+K*D+M;y[5]=E*H+J*D+w;return y}function f(y,w,D){const F=w[0],E=w[1],K=w[2],J=w[3],M=w[4];w=w[5];const N=Math.sin(D);D=Math.cos(D);y[0]=F*D+K*N;y[1]=E*D+J*N;y[2]=F*-N+K*D;y[3]=E*-N+J*D;y[4]=M;y[5]=w;return y}function e(y,w,D){const F=w[1],E=w[2],K=w[3],J=w[4],M=w[5],N=D[0];D=D[1];y[0]=w[0]*N;y[1]=F*N;y[2]=E*D;y[3]=K*D;y[4]=J;y[5]=M;return y}function g(y,
w,D){const F=w[0],E=w[1],K=w[2],J=w[3],M=w[4];w=w[5];const N=D[0];D=D[1];y[0]=F;y[1]=E;y[2]=K;y[3]=J;y[4]=F*N+K*D+M;y[5]=E*N+J*D+w;return y}function h(y,w){const D=Math.sin(w);w=Math.cos(w);y[0]=w;y[1]=D;y[2]=-D;y[3]=w;y[4]=0;y[5]=0;return y}function l(y,w){y[0]=w[0];y[1]=0;y[2]=0;y[3]=w[1];y[4]=0;y[5]=0;return y}function v(y,w){y[0]=1;y[1]=0;y[2]=0;y[3]=1;y[4]=w[0];y[5]=w[1];return y}function q(y){return"mat2d("+y[0]+", "+y[1]+", "+y[2]+", "+y[3]+", "+y[4]+", "+y[5]+")"}function k(y){return Math.sqrt(y[0]**
2+y[1]**2+y[2]**2+y[3]**2+y[4]**2+y[5]**2+1)}function p(y,w,D){y[0]=w[0]+D[0];y[1]=w[1]+D[1];y[2]=w[2]+D[2];y[3]=w[3]+D[3];y[4]=w[4]+D[4];y[5]=w[5]+D[5];return y}function z(y,w,D){y[0]=w[0]-D[0];y[1]=w[1]-D[1];y[2]=w[2]-D[2];y[3]=w[3]-D[3];y[4]=w[4]-D[4];y[5]=w[5]-D[5];return y}function C(y,w,D){y[0]=w[0]*D;y[1]=w[1]*D;y[2]=w[2]*D;y[3]=w[3]*D;y[4]=w[4]*D;y[5]=w[5]*D;return y}function B(y,w,D,F){y[0]=w[0]+D[0]*F;y[1]=w[1]+D[1]*F;y[2]=w[2]+D[2]*F;y[3]=w[3]+D[3]*F;y[4]=w[4]+D[4]*F;y[5]=w[5]+D[5]*F;return y}
function A(y,w){return y[0]===w[0]&&y[1]===w[1]&&y[2]===w[2]&&y[3]===w[3]&&y[4]===w[4]&&y[5]===w[5]}function x(y,w){const D=y[0],F=y[1],E=y[2],K=y[3],J=y[4];y=y[5];const M=w[0],N=w[1],P=w[2],I=w[3],G=w[4];w=w[5];const H=c.getEpsilon();return Math.abs(D-M)<=H*Math.max(1,Math.abs(D),Math.abs(M))&&Math.abs(F-N)<=H*Math.max(1,Math.abs(F),Math.abs(N))&&Math.abs(E-P)<=H*Math.max(1,Math.abs(E),Math.abs(P))&&Math.abs(K-I)<=H*Math.max(1,Math.abs(K),Math.abs(I))&&Math.abs(J-G)<=H*Math.max(1,Math.abs(J),Math.abs(G))&&
Math.abs(y-w)<=H*Math.max(1,Math.abs(y),Math.abs(w))}const u=Object.freeze(Object.defineProperty({__proto__:null,add:p,copy:b,determinant:m,equals:x,exactEquals:A,frob:k,fromRotation:h,fromScaling:l,fromTranslation:v,identity:t,invert:r,mul:d,multiply:d,multiplyScalar:C,multiplyScalarAndAdd:B,rotate:f,scale:e,set:n,str:q,sub:z,subtract:z,translate:g},Symbol.toStringTag,{value:"Module"}));a.add=p;a.copy=b;a.determinant=m;a.equals=x;a.exactEquals=A;a.frob=k;a.fromRotation=h;a.fromScaling=l;a.fromTranslation=
v;a.identity=t;a.invert=r;a.mat2d=u;a.mul=d;a.multiply=d;a.multiplyScalar=C;a.multiplyScalarAndAdd=B;a.rotate=f;a.scale=e;a.set=n;a.str=q;a.sub=z;a.subtract=z;a.translate=g})},"esri/widgets/Legend/styles/support/relationshipUtils":function(){define(["exports","../../../../symbols/support/svgUtils","../../../../symbols/support/utils","../../../support/widgetUtils","../../../support/jsxFactory"],function(a,c,b,t,n){function r(f,e,g){const h=`${g}_arrowStart`;g=`${g}_arrowEnd`;f="left"===f;const l={markerStart:null,
markerEnd:null};switch(e){case "HL":f?l.markerStart=`url(#${g})`:l.markerEnd=`url(#${h})`;break;case "LL":l.markerStart=`url(#${g})`;break;case "LH":f?l.markerEnd=`url(#${h})`:l.markerStart=`url(#${g})`;break;default:l.markerEnd=`url(#${h})`}return l}function m(f,e,g,h,l=60){const {focus:v,numClasses:q,colors:k,rotation:p}=f;f=!!v;const z=Math.sqrt(l**2+l**2)+(f?0:5),C=[],B=[];var A=[],x=(l||75)/q;for(var u=0;u<q;u++){var y=u*x;for(var w=0;w<q;w++){var D=w*x,F=c.generateFillAttributes(k[u][w]);const E=
c.generateStrokeAttributes(null);D={type:"rect",x:D,y,width:x,height:x};const K=c.renderDef(F);K&&C.push(K);(F=c.renderShape(D,F.fill,E,null))&&B.push(F);A.push(c.getBoundingBox(D))}}x=null;f||(x="margin: -15px -15px -18px -15px");u=r("left",v,e);y=r("right",v,e);w=c.computeBBox(A);A=c.getTransformMatrix(w,z,z,0,!1,p,!1);w=c.getTransformMatrix(w,z,z,0,!1,f?-45:null,!1);g={filter:b.getCSSFilterFromEffectList(h),opacity:null==g?"":`${g}`};return n.tsx("div",{styles:g,class:f?d.diamondMidColRamp:d.squareTableCell},
n.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:z,height:z,style:x},n.tsx("defs",null,n.tsx("marker",{id:`${e}_arrowStart`,markerWidth:"10",markerHeight:"10",refX:"5",refY:"5",markerUnits:"strokeWidth",orient:"auto"},n.tsx("polyline",{points:"0,0 5,5 0,10",fill:"none",stroke:"#555555","stroke-width":"1"})),n.tsx("marker",{id:`${e}_arrowEnd`,markerWidth:"10",markerHeight:"10",refX:"0",refY:"5",markerUnits:"strokeWidth",orient:"auto"},n.tsx("polyline",{points:"5,0 0,5 5,10",fill:"none",stroke:"#555555",
"stroke-width":"1"})),C),n.tsx("g",{transform:A},B),n.tsx("g",{transform:w},n.tsx("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":u.markerStart,"marker-end":u.markerEnd,x1:-10,y1:l-15,x2:-10,y2:15}),n.tsx("line",{fill:"none",stroke:"#555555","stroke-width":"1","marker-start":y.markerStart,"marker-end":y.markerEnd,x1:15,y1:l+10,x2:l-15,y2:l+10}))))}const d={diamondContainer:"esri-relationship-ramp--diamond__container",diamondLeftCol:"esri-relationship-ramp--diamond__left-column",
diamondRightCol:"esri-relationship-ramp--diamond__right-column",diamondMidCol:"esri-relationship-ramp--diamond__middle-column",diamondMidColLabel:"esri-relationship-ramp--diamond__middle-column--label",diamondMidColRamp:"esri-relationship-ramp--diamond__middle-column--ramp",squareTable:"esri-relationship-ramp--square__table",squareTableRow:"esri-relationship-ramp--square__table-row",squareTableCell:"esri-relationship-ramp--square__table-cell",squareTableLabel:"esri-relationship-ramp--square__table-label",
squareTableLabelLeftBottom:"esri-relationship-ramp--square__table-label--left-bottom",squareTableLabelRightBottom:"esri-relationship-ramp--square__table-label--right-bottom",squareTableLabelLeftTop:"esri-relationship-ramp--square__table-label--left-top",squareTableLabelRightTop:"esri-relationship-ramp--square__table-label--right-top"};a.renderRelationshipRamp=function(f,e,g,h){const {focus:l,labels:v}=f,q=!!l;f=m(f,e,g,h);e={justifyContent:"center"};g=t.isRTL();return q?n.tsx("div",{class:d.diamondContainer,
styles:e},n.tsx("div",{class:d.diamondLeftCol},g?v.right:v.left),n.tsx("div",{class:d.diamondMidCol},n.tsx("div",{class:d.diamondMidColLabel},v.top),f,n.tsx("div",{class:d.diamondMidColLabel},v.bottom)),n.tsx("div",{class:d.diamondRightCol},g?v.left:v.right)):n.tsx("div",{class:d.squareTable},n.tsx("div",{class:d.squareTableRow},n.tsx("div",{class:t.classes(d.squareTableCell,d.squareTableLabel,d.squareTableLabelRightBottom)},g?v.top:v.left),n.tsx("div",{class:d.squareTableCell}),n.tsx("div",{class:t.classes(d.squareTableCell,
d.squareTableLabel,d.squareTableLabelLeftBottom)},g?v.left:v.top)),n.tsx("div",{class:d.squareTableRow},n.tsx("div",{class:d.squareTableCell}),f,n.tsx("div",{class:d.squareTableCell})),n.tsx("div",{class:d.squareTableRow},n.tsx("div",{class:t.classes(d.squareTableCell,d.squareTableLabel,d.squareTableLabelRightTop)},g?v.right:v.bottom),n.tsx("div",{class:d.squareTableCell}),n.tsx("div",{class:t.classes(d.squareTableCell,d.squareTableLabel,d.squareTableLabelLeftTop)},g?v.bottom:v.right)))};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define(["exports","../../../core/lang","../../../symbols/support/gfxUtils","../../../symbols/support/previewSymbol3D"],function(a,c,b,t){function n(e){if(e){var {type:g}=e;return g.includes("3d")?t.getSymbolLayerFill(e.symbolLayers.getItemAt(0)):"simple-line"===g||"simple-marker"===e.type&&("x"===e.style||"cross"===e.style)?(e=b.getStroke(e))&&e.color:b.getFill(e)}}function r(e,g){const h=g.HH.label,
l=g.LL.label,v=g.HL.label;g=g.LH.label;switch(e){case "HH":return{top:h,bottom:l,left:v,right:g};case "HL":return{top:v,bottom:g,left:l,right:h};case "LL":return{top:l,bottom:h,left:g,right:v};case "LH":return{top:g,bottom:v,left:h,right:l};default:return{top:h,bottom:l,left:v,right:g}}}function m(e){let g=d[e];e&&null==g&&(g=d.HH);return g||0}const d={HH:315,HL:45,LL:135,LH:225},f={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L",
"M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};a.getRelationshipRampColors2D=function(e,g){const h=[],l=e.length**.5;e=c.clone(e);var v=(g||"HH").split("");g=v[0];for(v="H"===v[1];e.length;){const q=[];for(;q.length<l;)q.push(e.shift());v&&q.reverse();h.push(q)}"L"===g&&h.reverse();return h};a.getRelationshipRampElement=function(e){const {focus:g,infos:h,numClasses:l}=e;var v=f[l];const q={};h.forEach(k=>{q[k.value]={label:k.label,fill:n(k.symbol)}});e=[];for(let k=0;k<
l;k++){const p=[];for(let z=0;z<l;z++)p.push(q[v[k][z]].fill);e.push(p)}v=r(g,q);return{type:"relationship-ramp",numClasses:l,focus:g,colors:e,labels:v,rotation:m(g)}};a.getRotationAngleForFocus=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/previewSymbol3D":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../assets ../../core/colorUtils ../../core/has ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./IconSymbol3DLayerResource ./ObjectSymbol3DLayerResource ./previewUtils ./renderUtils ./utils ./webStyleSymbolUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){function z(Q){const V=Q.outline;var aa=d.isSome(Q.material)?Q.material.color:null;aa=d.isSome(aa)?aa.toHex():null;if(d.isNone(V)||"pattern"in V&&d.isSome(V.pattern)&&"style"===V.pattern.type&&"none"===V.pattern.style)return"fill"===Q.type&&"#ffffff"===aa?{color:"#bdc3c7",width:.75}:null;Q=e.pt2px(V.size)||0;return{color:"rgba("+(d.isSome(V.color)?V.color.toRgba():"255,255,255,1")+")",width:Math.min(Q,O),style:"pattern"in V&&d.isSome(V.pattern)&&"style"===
V.pattern.type?g.dekebabifyLineStyle(V.pattern.style):null,join:"butt",cap:"patternCap"in V?V.patternCap:"butt"}}function C(Q,V){var aa=V&&V.resource;aa=aa&&aa.href;if(Q.thumbnail&&Q.thumbnail.url)return Promise.resolve(Q.thumbnail.url);if(aa&&"object"!==V.type)return Promise.resolve(k.getIconHref(V));const X=b.getAssetUrl("esri/images/Legend/legend3dsymboldefault.png");return Q.styleOrigin&&(Q.styleOrigin.styleName||Q.styleOrigin.styleUrl)?p.resolveWebStyleSymbol(Q.styleOrigin,{portal:Q.styleOrigin.portal},
"webRef").catch(W=>W).then(W=>W?.thumbnail?.url||X):Promise.resolve(X)}function B(Q,V=1){const aa=Q.a;Q=t.toHSV(Q);const {r:X,g:W,b:T}=t.toRGB({h:Q.h,s:Q.s/V,v:100-(100-Q.v)/V});return[X,W,T,aa]}function A(Q){return"water"===Q.type?d.isNone(Q.color)?null:Q.color:d.isNone(Q.material)||d.isNone(Q.material.color)?null:Q.material.color}function x(Q,V=0){var aa=A(Q);if(!aa){if("fill"===Q.type)return null;V=v.adjustColorComponentBrightness(g.defaultThematicColor.r,V);return[V,V,V,100]}Q=aa.toRgba();for(aa=
0;3>aa;aa++)Q[aa]=v.adjustColorComponentBrightness(Q[aa],V);return Q}function u(Q,V){return y.apply(this,arguments)}function y(){y=c._asyncToGenerator(function*(Q,V){Q=Q.style;return"none"===Q?null:{type:"pattern",x:0,y:0,src:yield g.getPatternUrlWithColor(b.getAssetUrl(`esri/symbols/patterns/${Q}.png`),V.toCss(!0)),width:5,height:5}});return y.apply(this,arguments)}function w(Q){return Q.outline?z(Q):{color:"rgba(0, 0, 0, 1)",width:1.5}}function D(Q,V){Q=A(Q);if(!Q)return null;let aa;aa="rgba("+
(v.adjustColorComponentBrightness(Q.r,V)+",");aa+=v.adjustColorComponentBrightness(Q.g,V)+",";aa+=v.adjustColorComponentBrightness(Q.b,V)+",";return aa+Q.a+");"}function F(Q,V){V=D(Q,V);if(!V)return{};if("pattern"in Q&&d.isSome(Q.pattern)&&"style"===Q.pattern.type&&"none"===Q.pattern.style)return null;const aa=Math.min(Q.size?e.pt2px(Q.size):.75,O);return{color:V,width:aa,style:"pattern"in Q&&d.isSome(Q.pattern)&&"style"===Q.pattern.type?g.dekebabifyLineStyle(Q.pattern.style):null,cap:"cap"in Q?Q.cap:
null,join:"join"in Q?"miter"===Q.join?e.pt2px(2):Q.join:null}}function E(Q,V,aa){aa=null!=aa?.75*aa:0;return{type:"linear",x1:aa?.25*aa:0,y1:aa?.5*aa:0,x2:aa||4,y2:aa?.5*aa:4,colors:[{color:Q,offset:0},{color:V,offset:1}]}}function K(Q){const V=Q.depth,aa=Q.height;Q=Q.width;return 0!==Q&&0!==V&&0!==aa&&Q===V&&null!=Q&&null!=aa&&Q<aa}function J(Q,V,aa){const X=[];if(!Q)return X;switch(Q.type){case "icon":switch(Q.resource&&Q.resource.primitive||h.defaultPrimitive){case "circle":X.push({shape:{type:"circle",
cx:0,cy:0,r:.5*V},fill:x(Q,0),stroke:z(Q)});break;case "square":X.push({shape:{type:"path",path:[{command:"M",values:[0,V]},{command:"L",values:[0,0]},{command:"L",values:[V,0]},{command:"L",values:[V,V]},{command:"Z",values:[]}]},fill:x(Q,0),stroke:z(Q)});break;case "triangle":X.push({shape:{type:"path",path:[{command:"M",values:[0,V]},{command:"L",values:[.5*V,0]},{command:"L",values:[V,V]},{command:"Z",values:[]}]},fill:x(Q,0),stroke:z(Q)});break;case "cross":X.push({shape:{type:"path",path:[{command:"M",
values:[.5*V,0]},{command:"L",values:[.5*V,V]},{command:"M",values:[0,.5*V]},{command:"L",values:[V,.5*V]}]},stroke:w(Q)});break;case "x":X.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[V,V]},{command:"M",values:[V,0]},{command:"L",values:[0,V]}]},stroke:w(Q)});break;case "kite":X.push({shape:{type:"path",path:[{command:"M",values:[0,.5*V]},{command:"L",values:[.5*V,0]},{command:"L",values:[V,.5*V]},{command:"L",values:[.5*V,V]},{command:"Z",values:[]}]},fill:x(Q,
0),stroke:z(Q)})}break;case "object":switch(Q.resource&&Q.resource.primitive||l.defaultPrimitive){case "cone":var W=x(Q,0);Q=x(Q,-.6);Q=E(W,Q,aa?R:V);V=v.getConeShapes(V,aa);X.push({shape:V[0],fill:Q});X.push({shape:V[1],fill:Q});break;case "inverted-cone":aa=x(Q,0);Q=x(Q,-.6);Q=E(aa,Q,V);V=v.getInvertedConeShapes(V);X.push({shape:V[0],fill:Q});X.push({shape:V[1],fill:aa});break;case "cube":V=v.getCubeShapes(V,aa);X.push({shape:V[0],fill:x(Q,0)});X.push({shape:V[1],fill:x(Q,-.3)});X.push({shape:V[2],
fill:x(Q,-.5)});break;case "cylinder":W=x(Q,0);const T=x(Q,-.6);W=E(W,T,aa?R:V);V=v.getCylinderShapes(V,aa);X.push({shape:V[0],fill:W});X.push({shape:V[1],fill:W});X.push({shape:V[2],fill:x(Q,0)});break;case "diamond":V=v.getDiamondShapes(V);X.push({shape:V[0],fill:x(Q,-.3)});X.push({shape:V[1],fill:x(Q,0)});X.push({shape:V[2],fill:x(Q,-.3)});X.push({shape:V[3],fill:x(Q,-.7)});break;case "sphere":aa=x(Q,0);Q=x(Q,-.6);Q=E(aa,Q);Q.x1=0;Q.y1=0;Q.x2=.25*V;Q.y2=.25*V;X.push({shape:{type:"circle",cx:0,
cy:0,r:.5*V},fill:Q});break;case "tetrahedron":V=v.getTetrahedronShapes(V),X.push({shape:V[0],fill:x(Q,-.3)}),X.push({shape:V[1],fill:x(Q,0)}),X.push({shape:V[2],fill:x(Q,-.6)})}}return X}function M(Q){return(Q="number"===typeof Q?.size?Q?.size:null)?e.pt2px(Q):null}function N(Q,V){const aa=M(V),X=V?.maxSize?e.pt2px(V.maxSize):null,W=V?.disableUpsampling??!1,T=Q.symbolLayers,U=[];let Y=0,ba=0;const da=T.getItemAt(T.length-1);let ea;da&&"icon"===da.type&&(ea=da.size&&e.pt2px(da.size));T.forEach(ca=>
{if("icon"===ca.type||"object"===ca.type){var ja="icon"===ca.type?ca.size&&e.pt2px(ca.size):0,ia=aa||ja?Math.ceil(Math.min(aa||ja,X||L)):H;if(ca&&ca.resource&&ca.resource.href){var Z=C(Q,ca).then(ha=>{const fa=ca.get("material.color");var ka="icon"===ca.type?"multiply":"tint";return q.tintImageWithColor(ha,ia,fa,ka,W)}).then(ha=>{const fa=ha.width,ka=ha.height;Y=Math.max(Y,fa);ba=Math.max(ba,ka);return[{shape:{type:"image",x:0,y:0,width:fa,height:ka,src:ha.url},fill:null,stroke:null}]});U.push(Z)}else Z=
ia,"icon"===ca.type&&ea&&aa&&(Z=ja/ea*ia),ja="tall"===V?.symbolConfig||V?.symbolConfig?.isTall||("object"===ca.type?K(ca):!1),Y=Math.max(Y,ja?R:Z),ba=Math.max(ba,Z),U.push(Promise.resolve(J(ca,Z,ja)))}});return f.eachAlways(U).then(ca=>{const ja=[];ca.forEach(ia=>{ia.value?ja.push(ia.value):ia.error&&m.getLogger("esri.symbols.support.previewSymbol3D").warn("error while building swatchInfo!",ia.error)});return q.renderSymbol(ja,[Y,ba],{node:V&&V.node,scale:!1,opacity:V&&V.opacity})})}function P(Q,
V){const aa=Q.symbolLayers,X=[];Q=k.isVolumetricSymbol(Q);const W=M(V),T=(V&&V.maxSize?e.pt2px(V.maxSize):null)||O;let U=0,Y=0,ba;aa.forEach((da,ea)=>{if(da&&("line"===da.type||"path"===da.type)){var ca=[];switch(da.type){case "line":var ja=F(da,0);if(d.isNone(ja))break;var ia=ja&&ja.width||0;0===ea&&(ba=ia);da=Math.min(W||ia,T);ea=0===ea?da:W?ia/ba*da:da;ia=ea>S/2?2*ea:S;Y=Math.max(Y,ea);U=Math.max(U,ia);ja.width=ea;ca.push({shape:{type:"path",path:[{command:"M",values:[0,.5*Y]},{command:"L",values:[U,
.5*Y]}]},stroke:ja});break;case "path":ja=Math.min(W||H,T);ea=x(da,0);ia=x(da,-.2);var Z=D(da,-.4);Z=Z?{color:Z,width:1}:{};if("quad"===da.profile){const ha=da.width;da=da.height;da=v.getPathSymbolShapes(ha&&da?ha/da:1,0===da,0===ha);Z={...Z,join:"bevel"};ca.push({shape:da[0],fill:ia,stroke:Z});ca.push({shape:da[1],fill:ia,stroke:Z});ca.push({shape:da[2],fill:ea,stroke:Z})}else ca.push({shape:v.shapes.pathSymbol3DLayer[0],fill:ia,stroke:Z}),ca.push({shape:v.shapes.pathSymbol3DLayer[1],fill:ea,stroke:Z});
U=Y=Math.max(Y,ja)}X.push(ca)}});return Promise.resolve(q.renderSymbol(X,[U,Y],{node:V&&V.node,scale:Q,opacity:V&&V.opacity}))}function I(Q,V){return G.apply(this,arguments)}function G(){G=c._asyncToGenerator(function*(Q,V){const aa="mesh-3d"===Q.type;Q=Q.symbolLayers;var X=M(V);const W=V&&V.maxSize?e.pt2px(V.maxSize):null;X=X||H;const T=[];let U=0,Y=0;var ba=!1;for(let Z=0;Z<Q.length;Z++){var da=Q.getItemAt(Z);const ha=[];if(!aa||"fill"===da.type){var ea=v.shapes.fill[0];switch(da.type){case "fill":var ca=
z(da);ba=Math.min(X,W||L);U=Math.max(U,ba);Y=Math.max(Y,ba);ba=!0;var ja=x(da,0),ia="pattern"in da?da.pattern:null;da=A(da);!aa&&d.isSome(ia)&&"style"===ia.type&&"solid"!==ia.style&&da&&(ja=yield u(ia,da));ha.push({shape:ea,fill:ja,stroke:ca});break;case "line":da=F(da,0);if(d.isNone(da))break;da={stroke:da,shape:ea};U=Math.max(U,H);Y=Math.max(Y,H);ha.push(da);break;case "extrude":ea={join:"round",width:1,...F(da,-.4)};ca=x(da,0);da=x(da,-.2);ja=Math.min(X,W||L);ia=v.getExtrudeSymbolShapes(ja);ea.width=
1;ha.push({shape:ia[0],fill:da,stroke:ea});ha.push({shape:ia[1],fill:da,stroke:ea});ha.push({shape:ia[2],fill:ca,stroke:ea});da=.7*H+.5*ja;U=Math.max(U,H);Y=Math.max(Y,da);break;case "water":ba=d.unwrapOrThrow(A(da)),da=B(ba),ea=B(ba,2),ca=B(ba,3),ja=v.getWaterSymbolShapes(),ba=!0,ha.push({shape:ja[0],fill:da}),ha.push({shape:ja[1],fill:ea}),ha.push({shape:ja[2],fill:ca}),da=Math.min(X,W||L),U=Math.max(U,da),Y=Math.max(Y,da)}T.push(ha)}}return q.renderSymbol(T,[U,Y],{node:V&&V.node,scale:ba,opacity:V&&
V.opacity})});return G.apply(this,arguments)}const H=v.SymbolSizeDefaults.size,L=v.SymbolSizeDefaults.maxSize,O=v.SymbolSizeDefaults.maxOutlineSize,S=v.SymbolSizeDefaults.lineWidth,R=v.SymbolSizeDefaults.tallSymbolWidth;a.getPatternDescriptor=u;a.getSizeFromOptions=M;a.getSymbolLayerFill=x;a.previewSymbol3D=function(Q,V){if(0===Q.symbolLayers.length)return Promise.reject(new r("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));switch(Q.type){case "point-3d":return N(Q,V);case "line-3d":return P(Q,
V);case "polygon-3d":case "mesh-3d":return I(Q,V)}return Promise.reject(new r("symbolPreview: swatchInfo3D","symbol not supported."))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/webStyleSymbolUtils":function(){define("exports ../../symbols ../../core/devEnvironmentUtils ../../core/Error ../../core/maybe ../../core/urlUtils ../../portal/Portal ../../chunks/persistableUrlUtils ./jsonUtils ./StyleOrigin ./styleUtils ./Thumbnail".split(" "),function(a,c,b,t,
n,r,m,d,f,e,g,h){function l(q,k,p,z,C){var B=q.data;const A=p&&n.isSome(p.portal)?p.portal:m.getDefault(),x={portal:A,url:r.urlToObject(q.baseUrl),origin:"portal-item"};B=B.items.find(F=>F.name===k);if(!B)return Promise.reject(new t("symbolstyleutils:symbol-name-not-found",`The symbol name '${k}' could not be found`,{symbolName:k}));let u=d.fromJSON(g.symbolUrlFromStyleItem(B,z),x),y=B.thumbnail?.href??null;const w=B.thumbnail&&B.thumbnail.imageData;b.isDevEnvironment()&&(u=b.adjustStaticAGOUrl(u)??
"",y=b.adjustStaticAGOUrl(y));const D={portal:A,url:r.urlToObject(r.removeFile(u)),origin:"portal-item"};return g.requestJSON(u,C).then(F=>{F="cimRef"===z?g.makeCIMSymbolRef(F.data):F.data;if((F=f.fromJSON(F,D))&&c.isSymbol3D(F)){if(y){const E=d.fromJSON(y,x);F.thumbnail=new h.Thumbnail({url:E})}else w&&(F.thumbnail=new h.Thumbnail({url:`data:image/png;base64,${w}`}));q.styleUrl?F.styleOrigin=new e({portal:p.portal,styleUrl:q.styleUrl,name:k}):q.styleName&&(F.styleOrigin=new e({portal:p.portal,styleName:q.styleName,
name:k}))}return F})}function v(q,k,p){const z=g.Style2DUrlTemplate.replace(/\{SymbolName\}/gi,q.name),C=n.isSome(k.portal)?k.portal:m.getDefault();return g.requestJSON(z,p).then(B=>{B=g.makeCIMSymbolRef(B.data);return f.fromJSON(B,{portal:C,url:r.urlToObject(r.removeFile(z)),origin:"portal-item"})})}a.fetchSymbolFromStyle=l;a.resolveWebStyleSymbol=function(q,k,p,z){return q.name?q.styleName&&"Esri2DPointSymbolsStyle"===q.styleName?v(q,k,z):g.fetchStyle(q,k,z).then(C=>l(n.unwrapOrThrow(C),q.name,
k,p,z)):Promise.reject(new t("symbolstyleutils:style-symbol-reference-name-missing","Missing name in style symbol reference"))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],function(a){const c=/^devext.arcgis.com$/,b=/^qaext.arcgis.com$/,t=/^[\w-]*\.mapsdevext.arcgis.com$/,n=/^[\w-]*\.mapsqa.arcgis.com$/,r=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,c,b,/^jsapps.esri.com$/,t,n];a.adjustStaticAGOUrl=function(m,d){return m?
(d=d||globalThis.location.hostname)?null!=d.match(c)||null!=d.match(t)?m.replace("static.arcgis.com","staticdev.arcgis.com"):null!=d.match(b)||null!=d.match(n)?m.replace("static.arcgis.com","staticqa.arcgis.com"):m:m:m};a.isDevEnvironment=function(m){m=m||globalThis.location.hostname;return r.some(d=>null!=m?.match(d))};a.isTelemetryDevEnvironment=function(m){m=m||globalThis.location.hostname;return[/^zrh-.+?\.esri\.com$/].concat(r).some(d=>null!=m?.match(d))};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/support/layerViewUtils":function(){define(["exports","../../core/maybe"],function(a,c){a.extractSafeScaleBounds=function(b){b=b.effectiveScaleRange;return{minScale:b?.minScale??0,maxScale:b?.maxScale??0}};a.highlightsSupported=function(b){return b&&"function"===typeof b.highlight};a.isScaleRangeActive=function(b,t){return c.isSome(b)&&0<b||c.isSome(t)&&0<t};a.occludeesSupported=function(b){return b&&"function"===typeof b.maskOccludee};a.scaleBoundsPredicate=function(b,
t,n){return c.isNone(b)||b>n&&(0===t||b<t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m,d){a.GoToMixin=f=>{f=function(e){function g(...h){h=e.call(this,...h)||
this;h.goToOverride=null;h.view=null;return h}c._inheritsLoose(g,e);g.prototype.callGoTo=function(h){const {view:l}=this;t.assertIsSome(l);return this.goToOverride?this.goToOverride(l,h):l.goTo(h.target,h.options)};return g}(f);b.__decorate([n.property()],f.prototype,"goToOverride",void 0);b.__decorate([n.property()],f.prototype,"view",void 0);return f=b.__decorate([d.subclass("esri.widgets.support.GoTo")],f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/Handles ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./support/GroundViewElevationSampler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){b=function(h){function l(q){q=h.call(this,q)||this;q._handles=new n;q.view=null;q.layerViews=new t;return q}a._inheritsLoose(l,h);var v=l.prototype;v.initialize=function(){this._handles.add(r.when(()=>this.view?.map?.ground,q=>q.load()));this._handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))};v.destroy=function(){this._set("view",null);this._handles&&(this._handles.destroy(),this._handles=null)};v._layerViewsAfterChangesHandler=
function(){this._handles.remove("updating");this._handles.add(this.layerViews.map(q=>r.watch(()=>q.updating,()=>this._updateUpdating(),r.sync)).toArray(),"updating");this._updateUpdating()};v._updateUpdating=function(){this.notifyChange("updating")};a._createClass(l,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new g({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?
!1:this.layerViews.some(q=>q.updating)}},{key:"suspended",get:function(){return!this.view||this.view.suspended}}]);return l}(b);c.__decorate([m.property({readOnly:!0})],b.prototype,"elevationSampler",null);c.__decorate([m.property({type:Boolean,readOnly:!0})],b.prototype,"updating",null);c.__decorate([m.property({constructOnly:!0})],b.prototype,"view",void 0);c.__decorate([m.property({type:t,readOnly:!0})],b.prototype,"layerViews",void 0);c.__decorate([m.property({readOnly:!0})],b.prototype,"suspended",
null);return b=c.__decorate([e.subclass("esri.views.GroundView")],b)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){b=function(q){function k(z){z=q.call(this,z)||this;z.demResolution={min:-1,max:-1};z.noDataValue=v.ELEVATION_NODATA_VALUE;return z}a._inheritsLoose(k,q);var p=k.prototype;p.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};p.elevationAt=function(z,C){if(n.isNone(this.extent)||!h.extentContainsXYZ(this.extent,z,C)){const B=n.isSome(this.extent)?`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:
null;t.getLogger(this.declaredClass).warn("#elevationAt()",`Point used to sample elevation (${z}, ${C}) is outside of the sampler extent (${B})`);return this.noDataValue}return n.unwrapOr(this.view.elevationProvider?.getElevation(z,C,0,this.spatialReference,"ground"),this.noDataValue)};p.queryElevation=function(z){return l.updateGeometryElevation(z.clone(),this)};a._createClass(k,[{key:"extent",get:function(){const z=this.view.basemapTerrain;if(null==z||n.isNone(z.extent)||n.isNone(z.spatialReference))return null;
const C=g.toExtent(z.extent,z.spatialReference);C.zmin=z.visibleElevationBounds.min;C.zmax=z.visibleElevationBounds.max;return C}},{key:"spatialReference",get:function(){return n.unwrapOr(this.view.basemapTerrain?.spatialReference,e.WGS84)}}]);return k}(b.EventedAccessor);c.__decorate([r.property({readOnly:!0})],b.prototype,"demResolution",void 0);c.__decorate([r.property({readOnly:!0})],b.prototype,"extent",null);c.__decorate([r.property({readOnly:!0})],b.prototype,"noDataValue",void 0);c.__decorate([r.property()],
b.prototype,"spatialReference",null);c.__decorate([r.property({constructOnly:!0})],b.prototype,"view",void 0);return b=c.__decorate([f.subclass("esri.views.support.GroundViewElevationSampler")],b)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(p,z){const C=h(p,z.spatialReference);if(!C)return null;switch(p.type){case "point":p.z=z.elevationAt(C.x,C.y);break;case "polyline":q.spatialReference=C.spatialReference;var B=p.hasM&&!p.hasZ;for(var A=0;A<p.paths.length;A++){var x=p.paths[A],u=C.paths[A];for(let y=0;y<x.length;y++){const w=x[y],D=u[y];q.x=D[0];q.y=D[1];B&&(w[3]=w[2]);w[2]=z.elevationAt(q.x,q.y)}}p.hasZ=!0;break;case "multipoint":q.spatialReference=C.spatialReference;B=p.hasM&&!p.hasZ;for(A=
0;A<p.points.length;A++)x=p.points[A],u=C.points[A],q.x=u[0],q.y=u[1],B&&(x[3]=x[2]),x[2]=z.elevationAt(q.x,q.y);p.hasZ=!0}return p}function h(p,z){if(r.isNone(p))return null;const C=p.spatialReference;if(C.equals(z))return p;(p=f.project(p,z))||l.error(`Cannot project geometry spatial reference (wkid:${C.wkid}) to elevation sampler spatial reference (wkid:${z.wkid})`);return p}const l=n.getLogger("esri.layers.support.ElevationSampler");b=function(){function p(){}var z=p.prototype;z.queryElevation=
function(C){return g(C.clone(),this)};z.on=function(){return k};z.projectIfRequired=function(C,B){return h(C,B)};return p}();let v=function(p){function z(B,A,x){var u=p.call(this)||this;u.tile=B;u.noDataValue=x;x=B.tile.extent;u.extent=d.toExtent(x,A.spatialReference);u.extent.zmin=B.zmin;u.extent.zmax=B.zmax;u._aaExtent=x;x=m.getMetersPerUnitForSR(A.spatialReference);B=A.lodAt(B.tile.level).resolution*x;u.demResolution={min:B,max:B};return u}c._inheritsLoose(z,p);var C=z.prototype;C.contains=function(B){B=
this.projectIfRequired(B,this.spatialReference);return r.isNone(B)?!1:this.containsAt(B.x,B.y)};C.containsAt=function(B,A){return d.containsXY(this._aaExtent,B,A)};C.elevationAt=function(B,A){if(!this.containsAt(B,A)){const x=this.extent;l.warn("#elevationAt()",`Point used to sample elevation (${B}, ${A}) is outside of the sampler extent (${`${x.xmin}, ${x.ymin}, ${x.xmax}, ${x.ymax}`})`);return this.noDataValue}return r.unwrapOr(this.tile.sample(B,A),this.noDataValue)};c._createClass(z,[{key:"spatialReference",
get:function(){return this.extent.spatialReference}}]);return z}(b);t=function(p){function z(C,B,A){var x=p.call(this)||this;let u;"number"===typeof B?(x.noDataValue=B,u=null):(u=B,x.noDataValue=A);x.samplers=u?C.map(y=>new v(y,u,x.noDataValue)):C;if(C=x.samplers[0]){x.extent=C.extent.clone();const {min:y,max:w}=C.demResolution;x.demResolution={min:y,max:w};for(C=1;C<x.samplers.length;C++)B=x.samplers[C],x.extent.union(B.extent),x.demResolution.min=Math.min(x.demResolution.min,B.demResolution.min),
x.demResolution.max=Math.max(x.demResolution.max,B.demResolution.max)}else x.extent=d.toExtent(d.create(),u.spatialReference),x.demResolution={min:0,max:0};return x}c._inheritsLoose(z,p);z.prototype.elevationAt=function(C,B){for(const A of this.samplers)if(A.containsAt(C,B))return A.elevationAt(C,B);l.warn("#elevationAt()",`Point used to sample elevation (${C}, ${B}) is outside of the sampler`);return this.noDataValue};c._createClass(z,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);
return z}(b);const q=new e,k={remove(){}};a.ElevationSamplerBase=b;a.MultiTileElevationSampler=t;a.TileElevationSampler=v;a.updateGeometryElevation=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,c,b,t){c=c.clampFloat32(c.NUMBER_MAX_FLOAT32/10);const n=b.create();t.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,0,
0,n);b=b.create([-180,-90,180,90]);let r=3;a.ELEVATION_NODATA_VALUE=c;a.GEOGRAPHIC_WORLD_EXTENT=b;a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.PROGRESSIVE_LOADING_MODULO=2;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";a.WEBMERCATOR_WORLD_EXTENT=n;a.getElevationDesiredResolutionLevel=
function(m){return 4>m?3:r};a.test={setElevationDesiredMaxUpscalingDistance(m){r=null==m?3:m}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/LOD ../../../layers/support/TileInfo ../../../geometry/Point".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){function p(){return new t("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}b=function(){function C(A){var x=C.checkUnsupported(A);if(r.isSome(x))throw x;A=r.unwrap(A);this.spatialReference=A.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=f.canProjectToWGS84ComparableLonLat(this.spatialReference)||h.isMars(this.spatialReference)||h.isMoon(this.spatialReference);this.origin=[A.origin.x,A.origin.y];
this.pixelSize=A.size[0];this.dpi=A.dpi;var u=A.lods.reduce((D,F,E)=>{F.level<D.min&&(D.min=F.level,D.minIndex=E);D.max=Math.max(D.max,F.level);return D},{min:Infinity,minIndex:0,max:-Infinity}),y=A.lods[u.minIndex];const w=2**y.level;x=y.resolution*w;y=y.scale*w;this.levels=Array(u.max+1);for(u=0;u<this.levels.length;u++)this.levels[u]={resolution:x,scale:y,tileSize:[x*A.size[0],x*A.size[1]]},x/=2,y/=2}var B=C.prototype;B.clone=function(){return new C(this.toTileInfo())};B.toTileInfo=function(){return new q({dpi:this.dpi,
origin:new k({x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference}),size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((A,x)=>new v({level:x,scale:A.scale,resolution:A.resolution}))})};B.getExtent=function(A,x,u,y){var w=this.levels[A];A=w.tileSize[0];w=w.tileSize[1];y[0]=this.origin[0]+u*A;y[2]=this.origin[0]+(u+1)*A;y[3]=this.origin[1]-x*w;y[1]=this.origin[1]-(x+1)*w};B.convertExtentToRadians=function(A,x){this._isWebMercator?(x[0]=
l.x2lon(A[0]),x[1]=l.y2lat(A[1]),x[2]=l.x2lon(A[2]),x[3]=l.y2lat(A[3])):this._isGCS&&(x[0]=n.deg2rad(A[0]),x[1]=n.deg2rad(A[1]),x[2]=n.deg2rad(A[2]),x[3]=n.deg2rad(A[3]))};B.getExtentGeometry=function(A,x,u,y=new d){this.getExtent(A,x,u,z);y.spatialReference=this.spatialReference;y.xmin=z[0];y.ymin=z[1];y.xmax=z[2];y.ymax=z[3];y.zmin=void 0;y.zmax=void 0;return y};B.ensureMaxLod=function(A){if(null==A)return!1;for(var x=!1;this.levels.length<=A;){x=this.levels[this.levels.length-1];const u=x.resolution/
2;this.levels.push({resolution:u,scale:x.scale/2,tileSize:[u*this.pixelSize,u*this.pixelSize]});x=!0}return x};B.capMaxLod=function(A){this.levels.length>A+1&&(this.levels.length=A+1)};B.getMaxLod=function(){return this.levels.length-1};B.scaleAtLevel=function(A){return this.levels[0].scale/2**A};B.levelAtScale=function(A){const x=this.levels[0].scale;return A>=x?0:Math.log(x/A)*Math.LOG2E};B.resolutionAtLevel=function(A){return this.levels[0].resolution/2**A};B.compatibleWith=function(A){if(!(A instanceof
C)){if(C.checkUnsupported(A))return!1;A=new C(A)}if(!A.spatialReference.equals(this.spatialReference)||A.pixelSize!==this.pixelSize)return!1;const x=Math.min(this.levels.length,A.levels.length)-1,u=this.levels[x].resolution;let y=.5*u;if(!n.floatEqualAbsolute(A.origin[0],this.origin[0],y)||!n.floatEqualAbsolute(A.origin[1],this.origin[1],y))return!1;y=.5*u/2**x/this.pixelSize*12;return n.floatEqualAbsolute(u,A.levels[x].resolution,y)};B.rootTilesInExtent=function(A,x=null,u=Infinity){const y=[],w=
this.levels[0].tileSize;if(r.isNone(A)||0===w[0]||0===w[1])return y;C.computeRowColExtent(A,w,this.origin,z);A=z[1];let D=z[3],F=z[0],E=z[2];var K=E-F;const J=D-A;K*J>u&&(u=Math.floor(Math.sqrt(u)),J>u&&(A=A+Math.floor(.5*J)-Math.floor(.5*u),D=A+u),K>u&&(F=F+Math.floor(.5*K)-Math.floor(.5*u),E=F+u));for(u=A;u<D;u++)for(K=F;K<E;K++)y.push([0,u,K]);r.isSome(x)&&(x[0]=this.origin[0]+F*w[0],x[1]=this.origin[1]-D*w[1],x[2]=this.origin[0]+E*w[0],x[3]=this.origin[1]-A*w[1]);return y};C.computeRowColExtent=
function(A,x,u,y){const w=.001*(A[2]-A[0]+(A[3]-A[1]));y[0]=Math.max(0,Math.floor((A[0]+w-u[0])/x[0]));y[2]=Math.max(0,Math.ceil((A[2]-w-u[0])/x[0]));y[1]=Math.max(0,Math.floor((u[1]-A[3]+w)/x[1]));y[3]=Math.max(0,Math.ceil((u[1]-A[1]-w)/x[1]))};C.isPowerOfTwo=function(A){A=A.lods;const x=A[0].resolution*2**A[0].level;return!A.some(u=>!n.floatEqualRelative(u.resolution,x/2**u.level))};C.hasGapInLevels=function(A){A=A.lods.map(x=>x.level);A.sort((x,u)=>x-u);for(let x=1;x<A.length;x++)if(A[x]!==A[0]+
x)return!0;return!1};C.tileSizeSupported=function(A){const x=A.size[1];return x===A.size[0]&&0===(x&x-1)&&128<=x&&512>=x};C.hasOriginPerLODs=function(A){const x=A.origin;return A.lods.some(u=>null!=u.origin&&(u.origin[0]!==x.x||u.origin[1]!==x.y))};C.getMissingTileInfoError=function(){return new t("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};C.checkUnsupported=function(A){return r.isNone(A)?p():1>A.lods.length?new t("tilingscheme:generic","Tiling scheme must have at least one level"):
C.isPowerOfTwo(A)?C.hasGapInLevels(A)?new t("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):C.tileSizeSupported(A)?C.hasOriginPerLODs(A)?new t("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new t("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new t("tilingscheme:power-of-two","Tiling scheme must be power of two")};C.fromExtent=function(A,x){const u=A[2]-A[0],y=A[3]-A[1],w=
m.getMetersPerUnitForSR(x),D=1.2*Math.max(u,y);A=new C(new q({size:[256,256],origin:new k({x:A[0]-.5*(D-u),y:A[3]+.5*(D-y)}),lods:[new v({level:0,resolution:D/256,scale:1/(256/96*.0254/(D*w))})],spatialReference:x}));A.ensureMaxLod(20);return A};C.makeWebMercatorAuxiliarySphere=function(A){const x=new C(C.WebMercatorAuxiliarySphereTileInfo);x.ensureMaxLod(A);return x};C.makeGCSWithTileSize=function(A,x=256,u=16){const y=256/x;A=new C(new q({size:[x,x],origin:new k({x:-180,y:90,spatialReference:A}),
spatialReference:A,lods:[new v({level:0,resolution:.703125*y,scale:2.95497598570834E8*y})]}));A.ensureMaxLod(u);return A};c._createClass(C,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return C}();b.WebMercatorAuxiliarySphereTileInfo=new q({size:[256,256],origin:new k({x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:e.WebMercator}),spatialReference:e.WebMercator,lods:[new v({level:0,resolution:156543.03392800014,scale:5.91657527591555E8})]});
b.WebMercatorAuxiliarySphere=b.makeWebMercatorAuxiliarySphere(19);const z=g.create();a.TilingScheme=b;a.getMissingTileInfoError=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LOD":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),function(a,
c,b,t,n,r,m){var d;b=d=function(f){function e(g){g=f.call(this,g)||this;g.cols=null;g.level=0;g.levelValue=null;g.origin=null;g.resolution=0;g.rows=null;g.scale=0;return g}a._inheritsLoose(e,f);e.prototype.clone=function(){return new d({cols:this.cols,level:this.level,levelValue:this.levelValue,resolution:this.resolution,rows:this.rows,scale:this.scale})};return e}(b.JSONSupport);c.__decorate([t.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],
b.prototype,"cols",void 0);c.__decorate([t.property({type:n.Integer,json:{write:!0}})],b.prototype,"level",void 0);c.__decorate([t.property({type:String,json:{write:!0}})],b.prototype,"levelValue",void 0);c.__decorate([t.property({json:{write:!0,origins:{"web-document":{read:!1,write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"origin",void 0);c.__decorate([t.property({type:Number,json:{write:!0}})],b.prototype,"resolution",void 0);c.__decorate([t.property({json:{write:!0,origins:{"web-document":{read:!1,
write:!1},"portal-item":{read:!1,write:!1}}}})],b.prototype,"rows",void 0);c.__decorate([t.property({type:Number,json:{write:!0}})],b.prototype,"scale",void 0);return b=d=c.__decorate([m.subclass("esri.layers.support.LOD")],b)})},"esri/layers/support/TileInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/maybe ../../core/unitUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/Point ../../geometry/SpatialReference ../../geometry/support/aaBoundingRect ../../geometry/support/spatialReferenceUtils ../../geometry/support/webMercatorUtils ./LOD ./TileKey".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){var B;b=new b.JSONMap({PNG:"png",PNG8:"png8",PNG24:"png24",PNG32:"png32",JPEG:"jpg",JPG:"jpg",DIB:"dib",TIFF:"tiff",EMF:"emf",PS:"ps",PDF:"pdf",GIF:"gif",SVG:"svg",SVGZ:"svgz",Mixed:"mixed",MIXED:"mixed",LERC:"lerc",LERC2D:"lerc2d",RAW:"raw",pbf:"pbf"});t=B=function(A){function x(y){y=A.call(this,y)||this;y.dpi=96;y.format=null;y.origin=null;y.minScale=0;y.maxScale=0;y.size=null;y.spatialReference=null;return y}a._inheritsLoose(x,A);x.create=function(y=
{}){const {resolutionFactor:w=1,scales:D,size:F=256,spatialReference:E=v.WebMercator,numLODs:K=24}=y;if(!k.isValid(E)){y=[];if(D)for(var J=0;J<D.length;J++){var M=D[J];y.push(new z({level:J,scale:M,resolution:M}))}else for(J=5E-4,M=K-1;0<=M;M--)y.unshift(new z({level:M,scale:J,resolution:J})),J*=2;return new B({dpi:96,lods:y,origin:new l(0,0,E),size:[F,F],spatialReference:E})}J=k.getInfo(E);y=y.origin?new l({x:y.origin.x,y:y.origin.y,spatialReference:E}):J?new l({x:J.origin[0],y:J.origin[1],spatialReference:E}):
new l({x:0,y:0,spatialReference:E});J=1/(39.37*r.getMetersPerUnitForSR(E)*96);M=[];if(D)for(var N=0;N<D.length;N++){var P=D[N];M.push(new z({level:N,scale:P,resolution:P*J}))}else{var I=k.isGeographic(E)?512/F*5.916575275917094E8:256/F*5.91657527591555E8;N=Math.ceil(K/w);M.push(new z({level:0,scale:I,resolution:I*J}));for(P=1;P<N;P++)I/=2**w,M.push(new z({level:P,scale:I,resolution:I*J}))}return new B({dpi:96,lods:M,origin:y,size:[F,F],spatialReference:E})};var u=x.prototype;u.readOrigin=function(y,
w){return l.fromJSON({spatialReference:w.spatialReference,...y})};u.readSize=function(y,w){return[w.cols,w.rows]};u.writeSize=function(y,w){w.cols=y[0];w.rows=y[1]};u.zoomToScale=function(y){const w=this.scales;if(0>=y)return w[0];if(y>=w.length-1)return w[w.length-1];const D=Math.floor(y);return w[D]/(w[D]/w[D+1])**(y-D)};u.scaleToZoom=function(y){const w=this.scales,D=w.length-1;let F=0;for(;F<D;F++){const E=w[F],K=w[F+1];if(E<=y)break;if(K===y)return F+1;if(E>y&&K<y)return F+Math.log(E/y)/Math.log(E/
K)}return F};u.snapScale=function(y,w=.95){y=this.scaleToZoom(y);return y%Math.floor(y)>=w?this.zoomToScale(Math.ceil(y)):this.zoomToScale(Math.floor(y))};u.tileAt=function(y,w,D,F){var E=this.lodAt(y);if(!E)return null;let K;if("number"===typeof w)K=w,w=D;else{if(k.equals(w.spatialReference,this.spatialReference))K=w.x,w=w.y;else{F=p.project(w,this.spatialReference);if(n.isNone(F))return null;K=F.x;w=F.y}F=D}D=E.resolution*this.size[0];E=E.resolution*this.size[1];F||(F=new C.TileKey(null,0,0,0,q.create()));
F.level=y;F.row=Math.floor((this.origin.y-w)/E+.001);F.col=Math.floor((K-this.origin.x)/D+.001);this.updateTileInfo(F);return F};u.updateTileInfo=function(y,w=B.ExtrapolateOptions.NONE){var D=this.lodAt(y.level);D||w!==B.ExtrapolateOptions.POWER_OF_TWO||(w=this.lods[this.lods.length-1],w.level<y.level&&(D=w));if(D){var F=y.level-D.level;w=D.resolution*this.size[0]/2**F;D=D.resolution*this.size[1]/2**F;y.id=`${y.level}/${y.row}/${y.col}`;y.extent||(y.extent=q.create());y.extent[0]=this.origin.x+y.col*
w;y.extent[1]=this.origin.y-(y.row+1)*D;y.extent[2]=y.extent[0]+w;y.extent[3]=y.extent[1]+D}};u.upsampleTile=function(y){const w=this._upsampleLevels[y.level];if(!w||-1===w.parentLevel)return!1;y.level=w.parentLevel;y.row=Math.floor(y.row/w.factor+.001);y.col=Math.floor(y.col/w.factor+.001);this.updateTileInfo(y);return!0};u.getTileBounds=function(y,w){var D=this.lodAt(w.level);if(null==D)return null;var {resolution:F}=D;D=F*this.size[0];F*=this.size[1];y[0]=this.origin.x+w.col*D;y[1]=this.origin.y-
(w.row+1)*F;y[2]=y[0]+D;y[3]=y[1]+F;return y};u.lodAt=function(y){return this._levelToLOD?.[y]??null};u.clone=function(){return B.fromJSON(this.write({}))};u.getOrCreateCompatible=function(y,w){if(256===this.size[0]&&256===this.size[1])return 256===y?this:null;const D=[],F=this.lods.length;for(let E=0;E<F;E++){const K=this.lods[E];D.push(new z({level:K.level,scale:K.scale,resolution:K.resolution*w}))}return new B({size:[y,y],dpi:this.dpi,format:this.format,compressionQuality:this.compressionQuality,
origin:this.origin,spatialReference:this.spatialReference,lods:D})};u._initializeUpsampleLevels=function(){const y=this.lods;this._upsampleLevels=[];let w=null;for(let D=0;D<y.length;D++){const F=y[D];this._upsampleLevels[F.level]={parentLevel:w?w.level:-1,factor:w?w.resolution/F.resolution:0};w=F}};a._createClass(x,[{key:"isWrappable",get:function(){const {spatialReference:y,origin:w}=this;if(y&&w){const D=k.getInfo(y);return y.isWrappable&&!!D&&Math.abs(D.origin[0]-w.x)<=D.dx}return!1}},{key:"lods",
set:function(y){let w=0,D=0;const F=[],E=this._levelToLOD={};y&&(w=-Infinity,D=Infinity,y.forEach(K=>{F.push(K.scale);w=K.scale>w?K.scale:w;D=K.scale<D?K.scale:D;E[K.level]=K}));this._set("scales",F);this._set("minScale",w);this._set("maxScale",D);this._set("lods",y);this._initializeUpsampleLevels()}}]);return x}(t.JSONSupport);c.__decorate([m.property({type:Number,json:{write:!0}})],t.prototype,"compressionQuality",void 0);c.__decorate([m.property({type:Number,json:{write:!0}})],t.prototype,"dpi",
void 0);c.__decorate([m.property({type:String,json:{read:b.read,write:b.write,origins:{"web-scene":{read:!1,write:!1}}}})],t.prototype,"format",void 0);c.__decorate([m.property({readOnly:!0})],t.prototype,"isWrappable",null);c.__decorate([m.property({type:l,json:{write:!0}})],t.prototype,"origin",void 0);c.__decorate([e.reader("origin")],t.prototype,"readOrigin",null);c.__decorate([m.property({type:[z],value:null,json:{write:!0}})],t.prototype,"lods",null);c.__decorate([m.property({readOnly:!0})],
t.prototype,"minScale",void 0);c.__decorate([m.property({readOnly:!0})],t.prototype,"maxScale",void 0);c.__decorate([m.property({readOnly:!0})],t.prototype,"scales",void 0);c.__decorate([m.property({cast:A=>Array.isArray(A)?A:"number"===typeof A?[A,A]:[256,256]})],t.prototype,"size",void 0);c.__decorate([e.reader("size",["rows","cols"])],t.prototype,"readSize",null);c.__decorate([h.writer("size",{cols:{type:d.Integer},rows:{type:d.Integer}})],t.prototype,"writeSize",null);c.__decorate([m.property({type:v,
json:{write:!0}})],t.prototype,"spatialReference",void 0);t=B=c.__decorate([g.subclass("esri.layers.support.TileInfo")],t);(function(A){A=A.ExtrapolateOptions||(A.ExtrapolateOptions={});A[A.NONE=0]="NONE";A[A.POWER_OF_TWO=1]="POWER_OF_TWO"})(t||(t={}));return t})},"esri/layers/support/TileKey":function(){define(["exports"],function(a){a.TileKey=function(c,b,t,n,r){this.id=c;this.level=b;this.row=t;this.col=n;this.extent=r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/Logger ../core/accessorSupport/ensureType ../core/arrayUtils ../core/Error ../core/has ../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){a.PopupView=h=>{h=function(l){function v(){return l.apply(this,arguments)||this}c._inheritsLoose(v,l);var q=v.prototype;q.fetchPopupFeatures=function(){var k=c._asyncToGenerator(function*(p,z){yield this.when();const {location:C,queryArea:B,layerViewsAndGraphics:A,clientOnlyGraphics:x}=yield this._prepareFetchPopupFeatures(p,z);p=Promise.resolve(x);z=this._queryLayerPopupFeatures(B,A,z);const u=z.map(y=>y.promise);p=n.eachAlwaysValues([p,...u]).then(y=>Array.from(new Set(y.flat())));
return{location:C,clientOnlyGraphics:x,allGraphicsPromise:p,promisesPerLayerView:z}});return function(p,z){return k.apply(this,arguments)}}();q._queryLayerPopupFeatures=function(k,p,z){return p.map(({layerView:C,graphics:B})=>{B={clientGraphics:B,event:t.isSome(z)?z.event:void 0,signal:t.isSome(z)?z.signal:void 0,defaultPopupTemplateEnabled:t.isSome(z)?!!z.defaultPopupTemplateEnabled:!1};B=C.fetchPopupFeatures(k,B);return{layerView:C,promise:B}})};q._isValidPopupGraphic=function(k,p){return k&&!!k.getEffectivePopupTemplate(t.isSome(p)&&
p.defaultPopupTemplateEnabled)};q._prepareFetchPopupFeatures=function(){var k=c._asyncToGenerator(function*(p,z){const {clientGraphics:C,queryArea:B,location:A}=yield this._popupHitTestGraphics(p,z);p=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:x,clientOnlyGraphics:u}=this._graphicsPerFetchPopupLayerView(C,p);return{clientOnlyGraphics:u,layerViewsAndGraphics:x,queryArea:B,location:A}});return function(p,z){return k.apply(this,arguments)}}();q._popupHitTestGraphics=function(){var k=
c._asyncToGenerator(function*(p,z){var C=yield this.popupHitTest(p);p=C.mapPoint;C=C.results.filter(A=>"graphic"===A.type&&this._isValidPopupGraphic(A.graphic,z));const B=C.length?C[0].mapPoint:null;return{clientGraphics:C.map(A=>A.graphic),queryArea:p,location:p||B}});return function(p,z){return k.apply(this,arguments)}}();q._getFetchPopupLayerViews=function(){const k=[];this.allLayerViews.forEach(p=>{this._isValidPopupLayerView(p)&&k.push(p)});t.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&
k.push(this.graphicsView);return k.reverse()};q._isValidPopupLayerView=function(k){return t.isSome(k)&&(!("layer"in k)||!k.suspended)&&"fetchPopupFeatures"in k};q._graphicsPerFetchPopupLayerView=function(k,p){const z=[],C=new Map;p=p.map(B=>{const A=[];"layer"in B?C.set(B.layer,A):C.set(B.graphics,A);return{layerView:B,graphics:A}});for(const B of k)(k=C.get(B.layer)||C.get(B.sourceLayer)||null)?k.push(B):z.push(B);return{layerViewsAndGraphics:p,clientOnlyGraphics:z}};return v}(h);return h=b.__decorate([g.subclass("esri.views.PopupView")],
h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe"],function(a,c,b,t){const n=f=>Object.freeze(Object.defineProperty({__proto__:null,default:f},Symbol.toStringTag,{value:"Module"})),r=()=>new Promise((f,e)=>a(["./layers/TileLayerView3D"],g=>f(n(g)),e)),m=()=>new Promise((f,e)=>a(["./layers/ElevationLayerView3D"],g=>f(n(g)),e)),d={"base-dynamic":()=>new Promise((f,
e)=>a(["./layers/BaseDynamicLayerView3D"],g=>f(n(g)),e)),"base-elevation":m,"base-tile":r,"bing-maps":r,"building-scene":()=>new Promise((f,e)=>a(["./layers/BuildingSceneLayerView3D"],g=>f(n(g)),e)),csv:()=>new Promise((f,e)=>a(["./layers/CSVLayerView3D"],g=>f(n(g)),e)),dimension:()=>new Promise((f,e)=>a(["./layers/DimensionLayerView3D"],g=>f(n(g)),e)),elevation:m,feature:()=>new Promise((f,e)=>a(["./layers/FeatureLayerView3D"],g=>f(n(g)),e)),geojson:()=>new Promise((f,e)=>a(["./layers/GeoJSONLayerView3D"],
g=>f(n(g)),e)),graphics:()=>new Promise((f,e)=>a(["./layers/GraphicsLayerView3D"],g=>f(n(g)),e)),group:()=>new Promise((f,e)=>a(["../layers/GroupLayerView"],g=>f(n(g)),e)),imagery:()=>new Promise((f,e)=>a(["./layers/ImageryLayerView3D"],g=>f(n(g)),e)),"integrated-mesh":()=>new Promise((f,e)=>a(["./layers/IntegratedMeshLayerView3D"],g=>f(n(g)),e)),"line-of-sight":()=>new Promise((f,e)=>a(["./layers/LineOfSightLayerView3D"],g=>f(n(g)),e)),"map-image":()=>new Promise((f,e)=>a(["./layers/MapImageLayerView3D"],
g=>f(n(g)),e)),media:()=>new Promise((f,e)=>a(["./layers/MediaLayerView3D"],g=>f(n(g)),e)),"ogc-feature":()=>new Promise((f,e)=>a(["./layers/OGCFeatureLayerView3D"],g=>f(n(g)),e)),"open-street-map":r,"oriented-imagery":()=>new Promise((f,e)=>a(["./layers/FeatureLayerView3D"],g=>f(n(g)),e)),"point-cloud":()=>new Promise((f,e)=>a(["./layers/PointCloudLayerView3D"],g=>f(n(g)),e)),voxel:()=>new Promise((f,e)=>a(["./layers/VoxelLayerView3D"],g=>f(n(g)),e)),route:()=>new Promise((f,e)=>a(["./layers/RouteLayerView3D"],
g=>f(n(g)),e)),scene:f=>null==f.profile||"mesh-pyramids"===f.profile?new Promise((e,g)=>a(["./layers/SceneLayerView3D"],h=>e(n(h)),g)):new Promise((e,g)=>a(["./layers/SceneLayerGraphicsView3D"],h=>e(n(h)),g)),stream:()=>new Promise((f,e)=>a(["./layers/StreamLayerView3D"],g=>f(n(g)),e)),tile:r,"imagery-tile":()=>new Promise((f,e)=>a(["./layers/ImageryTileLayerView3D"],g=>f(n(g)),e)),"vector-tile":()=>new Promise((f,e)=>a(["./layers/VectorTileLayerView3D"],g=>f(n(g)),e)),wcs:()=>new Promise((f,e)=>
a(["./layers/ImageryTileLayerView3D"],g=>f(n(g)),e)),"web-tile":r,wfs:()=>new Promise((f,e)=>a(["./layers/WFSLayerView3D"],g=>f(n(g)),e)),wms:()=>new Promise((f,e)=>a(["./layers/WMSLayerView3D"],g=>f(n(g)),e)),wmts:()=>new Promise((f,e)=>a(["./layers/WMTSLayerView3D"],g=>f(n(g)),e)),"geo-rss":null,kml:null,"knowledge-graph":null,"link-chart":null,"knowledge-graph-sublayer":null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};c.layerView3DImporter={hasLayerViewModule:f=>t.isSome(d[f.type]),
importLayerView:f=>{var e=d[f.type];if(t.isNone(e))throw f=f.declaredClass?f.declaredClass.slice(f.declaredClass.lastIndexOf(".")+1):"Unknown",e=f.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),new b(`${e}:view-not-supported`,`${f} is not supported in 3D`);return e(f)}};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Error ../../../core/HandleOwner ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){function v(){const z=e.createResolver();z.promise.catch(()=>{});return z}const q=z=>Object.freeze(Object.defineProperty({__proto__:null,default:z},Symbol.toStringTag,{value:"Module"}));var k;(function(z){z[z.PENDING=0]="PENDING";z[z.CREATED=1]="CREATED"})(k||(k={}));var p;(function(z){z[z.ADDED=0]="ADDED";z[z.REMOVED=1]="REMOVED"})(p||(p={}));m=function(z){function C(A){A=z.call(this,A)||this;A._allAnalysisViews=new n;A._creatingViewCount=0;A._items=new Map;A._scheduledUpdateHandle=
null;A._attachedToViewResolver=v();A._analysisModules={"area-measurement":{module:null},dimension:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}};return A}c._inheritsLoose(C,z);var B=C.prototype;B.destroy=function(){this._disconnectOwners();this._attachedToViewResolver.reject(e.createAbortError("AnalysisViewManager was destroyed"))};B.attach=function(){this._connectOwners();this._attachedToViewResolver.resolve()};B.detach=function(){this._disconnectOwners();
this._attachedToViewResolver.reject(e.createAbortError());this._attachedToViewResolver=v()};B.whenAnalysisView=function(){var A=c._asyncToGenerator(function*(x){yield this._attachedToViewResolver.promise;const u=this._items.get(x);if(f.isNone(u)||u.state.list===p.REMOVED)throw new r("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:x});return u.createAnalysisViewTask.promise});return function(x){return A.apply(this,arguments)}}();B._connectOwners=
function(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),"analyses-owner-handles")};B._disconnectOwners=function(){this.handles.remove("analyses-owner-handles");this._update();this._creatingViewCount=0};B._connectAnalysesCollection=function(A){for(const y of A)this._addAnalysis(y);const x=A.on("after-add",y=>this._addAnalysis(y.item)),u=A.on("after-remove",y=>this._removeAnalysis(y.item));return{remove:()=>{x.remove();u.remove();for(const y of A)this._removeAnalysis(y)}}};B._addAnalysis=
function(A){const x=this._items.get(A);if(null==x){const u={state:{view:k.PENDING,list:p.ADDED},analysis:A,view:null,createAnalysisViewTask:null};this._items.set(A,u);u.createAnalysisViewTask=t.createTask(y=>this._createAnalysisViewPromise(u,y))}else x.state.list=p.ADDED};B._removeAnalysis=function(A){A=this._items.get(A);null==A?d.getLogger(this.declaredClass).error("Trying to remove analysis which was not added"):(A.state.list=p.REMOVED,this._scheduleUpdate())};B._scheduleUpdate=function(){f.isSome(this._scheduledUpdateHandle)||
(this._scheduledUpdateHandle=g.schedule(()=>this._update()))};B._update=function(){this._scheduledUpdateHandle=f.removeMaybe(this._scheduledUpdateHandle);this._items.forEach(A=>{if(A.state.list===p.REMOVED)switch(this._items.delete(A.analysis),A.state.view){case k.PENDING:A.createAnalysisViewTask=f.abortMaybe(A.createAnalysisViewTask);break;case k.CREATED:f.isSome(A.view)&&(this._allAnalysisViews.remove(A.view),A.view=f.destroyMaybe(A.view),A.createAnalysisViewTask=null)}})};B._createAnalysisViewPromise=
function(){var A=c._asyncToGenerator(function*(x,u){var y=x.analysis;const w=y.type,D=this._analysisModules[w];this._creatingViewCount+=1;if(f.isNone(D.module))try{D.module=yield this._loadAnalysisModule(w)}catch(F){throw--this._creatingViewCount,F;}if(e.isAborted(u))throw--this._creatingViewCount,e.createAbortError("AnalysisView creation aborted");y=new D.module.default({analysis:y,view:this.view});try{yield y.when()}catch(F){throw--this._creatingViewCount,F;}if(e.isAborted(u))throw--this._creatingViewCount,
y.destroy(),e.createAbortError("AnalysisView creation aborted");x.view=y;x.state.view=k.CREATED;this._allAnalysisViews.add(y);--this._creatingViewCount;return y});return function(x,u){return A.apply(this,arguments)}}();B._loadAnalysisModule=function(A){switch(A){case "area-measurement":return new Promise((x,u)=>a(["./AreaMeasurementAnalysisView3D"],y=>x(q(y)),u));case "dimension":return new Promise((x,u)=>a(["./DimensionAnalysisView3D"],y=>x(q(y)),u));case "direct-line-measurement":return new Promise((x,
u)=>a(["./DirectLineMeasurementAnalysisView3D"],y=>x(q(y)),u));case "line-of-sight":return new Promise((x,u)=>a(["./LineOfSightAnalysisView3D"],y=>x(q(y)),u));case "slice":return new Promise((x,u)=>a(["./SliceAnalysisView3D"],y=>x(q(y)),u))}};c._createClass(C,[{key:"updating",get:function(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(A=>A.updating)}},{key:"testInfo",get:function(){return{allAnalysisViews:this._allAnalysisViews}}}]);return C}(m.HandleOwner);b.__decorate([h.property()],
m.prototype,"updating",null);b.__decorate([h.property({constructOnly:!0})],m.prototype,"view",void 0);b.__decorate([h.property()],m.prototype,"_allAnalysisViews",void 0);b.__decorate([h.property()],m.prototype,"_creatingViewCount",void 0);return m=b.__decorate([l.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],m)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){a.Constraints=function(h){function l(){var v=h.apply(this,arguments)||this;v.tilt=new g.TiltConstraint;v.altitude=new f.AltitudeConstraint;v.clipDistance=new e.ClipDistanceConstraint;return v}c._inheritsLoose(l,h);return l}(t);b.__decorate([n.property({type:g.TiltConstraint})],a.Constraints.prototype,"tilt",void 0);b.__decorate([n.property({type:f.AltitudeConstraint})],a.Constraints.prototype,"altitude",void 0);b.__decorate([n.property({type:e.ClipDistanceConstraint})],
a.Constraints.prototype,"clipDistance",void 0);a.Constraints=b.__decorate([d.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,c,b,t,n,r,m,d,f){a.AltitudeConstraint=function(e){function g(){var h=e.apply(this,arguments)||this;h.min=f.earthAltitudeConstraint.min;h.max=f.earthAltitudeConstraint.max;return h}c._inheritsLoose(g,e);return g}(t);b.__decorate([n.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);b.__decorate([n.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=b.__decorate([d.subclass("esri.views.3d.constraints.AltitudeConstraint")],a.AltitudeConstraint);
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){a.Constraints=function(p){function z(B){B=p.call(this,B)||this;B.collision=new k;B.distance=Infinity;B.minimumPoiDistance=4;B.tilt=null;return B}c._inheritsLoose(z,p);var C=z.prototype;C.clampAltitude=function(B){return this.altitude?r.clamp(B,this.altitude.min,this.altitude.max):B};C.clampTilt=function(B,A){if(!this.tilt)return A;B=this.tilt(B);return r.clamp(A,B.min,B.max)};C.clampDistance=function(B){return Math.min(B,this.distance)};C.createDefaultTilt=function(){return this.mode===
h.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()};C.createConstantMaxTilt=function(B){return(A,x=q)=>{x.min=v.min;x.max=B;return x}};C._createDefaultTiltLocal=function(){const B=this.collision.enabled?l.makePiecewiseLinearFunction([[4E3,v.max],[1E4,r.deg2rad(88)],[6E6,r.deg2rad(88)]]):()=>v.max;return(A,x=q)=>{x.min=v.min;x.max=B(A);return x}};C._createDefaultTiltGlobal=function(){const B=this.collision.enabled?l.makePiecewiseLinearFunction([[4E3,v.max],[5E4,r.deg2rad(88)],
[6E6,r.deg2rad(88)],[2E7,v.min]]):l.makePiecewiseLinearFunction([[3E5,v.max],[3E6,r.deg2rad(88)],[6E6,r.deg2rad(88)],[2E7,v.min]]);return(A,x=q)=>{x.min=v.min;x.max=B(A);return x}};c._createClass(z,[{key:"altitude",get:function(){return this.mode===h.ViewingMode.Local?null:this._get("altitude")||null},set:function(B){this.mode===h.ViewingMode.Local?n.getLogger(this.declaredClass).warn("Altitude constraint is ignored in local scenes"):this._set("altitude",B)}}]);return z}(t);b.__decorate([m.property()],
a.Constraints.prototype,"altitude",null);b.__decorate([m.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);b.__decorate([m.property()],a.Constraints.prototype,"distance",void 0);b.__decorate([m.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);b.__decorate([m.property()],a.Constraints.prototype,"tilt",void 0);b.__decorate([m.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=b.__decorate([e.subclass("esri.views.3d.state.Constraints")],
a.Constraints);d={min:-2E5,max:4*g.earth.radius};const v={min:r.deg2rad(.5),max:r.deg2rad(179.5)},q={min:0,max:0};let k=function(p){function z(){var C=p.apply(this,arguments)||this;C.enabled=!0;C.elevationMargin=5;return C}c._inheritsLoose(z,p);return z}(t);b.__decorate([m.property({type:Boolean})],k.prototype,"enabled",void 0);b.__decorate([m.property({type:Number})],k.prototype,"elevationMargin",void 0);k=b.__decorate([e.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],k);a.TiltDefault=
v;a.earthAltitudeConstraint=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m,d){a.ClipDistanceConstraint=function(f){function e(){var h=
f.apply(this,arguments)||this;h.mode="auto";return h}c._inheritsLoose(e,f);var g=e.prototype;g.castNear=function(h){return Math.max(1E-8,h)};g.castFar=function(h){return Math.max(1E-8,h)};g.autoUpdate=function(h,l){"auto"===this.mode&&(this._get("near")!==h&&this._set("near",h),this._get("far")!==l&&this._set("far",l))};c._createClass(e,[{key:"near",get:function(){return this._get("near")},set:function(h){this._set("near",h);h>=this._get("far")&&(this.far=h+1E-9);this.mode="manual"}},{key:"far",get:function(){return this._get("far")},
set:function(h){this._set("far",h);h<=this._get("near")&&(this.near=h-1E-9);this.mode="manual"}}]);return e}(t);b.__decorate([n.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);b.__decorate([r.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);b.__decorate([n.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);b.__decorate([r.cast("far")],a.ClipDistanceConstraint.prototype,"castFar",null);b.__decorate([n.property({type:["auto",
"manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=b.__decorate([d.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,c,b,t,n,r,m,d,f,e){var g=n.rad2deg(e.TiltDefault.min),h=n.rad2deg(e.TiltDefault.max);a.TiltConstraint=function(l){function v(){var k=l.apply(this,arguments)||this;k.mode="auto";return k}c._inheritsLoose(v,l);var q=v.prototype;q.castMax=function(k){return n.clamp(k,g,h)};q.autoUpdate=function(k){"auto"===this.mode&&this._get("max")!==k&&this._set("max",k)};c._createClass(v,[{key:"max",get:function(){return this._get("max")},set:function(k){this._set("max",k);this.mode="manual"}}]);return v}(t);
b.__decorate([r.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);b.__decorate([r.property({type:Number,value:h})],a.TiltConstraint.prototype,"max",null);b.__decorate([m.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=b.__decorate([f.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/compilerUtils ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){var k;l=k=function(p){function z(B){B=p.call(this,B)||this;B.atmosphere=new e.SceneViewAtmosphere;B.lighting=new g;B.cachedCameraTrackingEnabled=null;return B}a._inheritsLoose(z,p);z.fromWebsceneEnvironment=function(B){B=B.cloneConstructProperties();return new k({...B,lighting:B.lighting?"virtual"===B.lighting.type?h.fromWebsceneLighting(B.lighting):g.fromWebsceneLighting(B.lighting):void 0})};var C=z.prototype;C.castLighting=function(B){return this._convertLighting(B)};
C.applyLighting=function(B){this.lighting=this._convertLighting(B)};C._convertLighting=function(B){return B?B instanceof g||B instanceof h?B:B instanceof v?this.lighting&&"virtual"!==this.lighting.type?this.lighting.cloneWithWebsceneLighting(B):new g({...B.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):B instanceof q?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(B):new h({...B.cloneConstructProperties(),...this.lighting?.cloneNonPersistentConstructProperties()}):
d.ensureOneOfType(f.lightingTypes,B):new g};C.clone=function(){return new k({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:t.clone(this.background)})};C.cloneWithWebsceneEnvironment=function(B){return new k({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:t.clone(this.background),
...B.cloneConstructProperties(),lighting:this._getLighting(B)})};C._getLighting=function(B){switch(B.lighting.type){case "sun":return this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(B.lighting):g.fromWebsceneLighting(B.lighting);case "virtual":return this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(B.lighting):h.fromWebsceneLighting(B.lighting);default:return b.neverReached(B.lighting),g.fromWebsceneLighting(B.lighting)}};return z}(l);
c.__decorate([n.property({type:e.SceneViewAtmosphere,json:{read:!1},nonNullable:!0})],l.prototype,"atmosphere",void 0);c.__decorate([n.property({nonNullable:!0})],l.prototype,"lighting",void 0);c.__decorate([r.cast("lighting")],l.prototype,"castLighting",null);return l=k=c.__decorate([m.subclass("esri.views.3d.environment.SceneViewEnvironment")],l)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,c,b){a.lightingTypes={key:"type",
defaultKeyValue:"sun",base:null,typeMap:{sun:c,virtual:b}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),function(a,
c,b,t,n,r,m,d,f){var e;b=e=function(h){function l(q){q=h.call(this,q)||this;q.cameraTrackingEnabled=!0;q.ambientOcclusionEnabled=!1;q.waterReflectionEnabled=!1;q.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};var k=(new Date).getFullYear();k=new Date("March 15, "+k+" 12:00:00 UTC");q._set("defaultDate",k);q._set("date",k);return q}a._inheritsLoose(l,h);l.fromWebsceneLighting=function(q){return new e(q.cloneConstructProperties())};var v=l.prototype;v.autoUpdate=function(q,k){const p=
e.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=k.hours;this.positionTimezoneInfo.minutes=k.minutes;this.positionTimezoneInfo.seconds=k.seconds;k=null;t.isSome(q)&&(this.positionTimezoneInfo.autoUpdated=!0,isNaN(q.getTime())?(k=this.defaultDate.getTime(),this._set("date",this.defaultDate)):(k=this.date&&this.date.getTime(),this._set("date",new Date(q.getTime()))));const z=e.calculateTimezoneOffset(this.positionTimezoneInfo);p!==z&&(g.target=this,g.timezoneOffset=
z,this.emit("timezone-will-change",g));if(t.isSome(q))return isNaN(q.getTime())?!0:k!==q.getTime()};v.clone=function(){const q=this._get("date")===this._get("defaultDate"),k=new e({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});q&&k._set("date",k._get("defaultDate"));k.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;
k.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;k.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;k.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return k};v.cloneWithWebsceneLighting=function(q){const k=this.clone();null!=q.date&&(k.date=q.date);k.directShadowsEnabled=q.directShadowsEnabled;k.displayUTCOffset=q.displayUTCOffset;return k};v.cloneNonPersistentConstructProperties=function(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,
cameraTrackingEnabled:this.cameraTrackingEnabled}};a._createClass(l,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(q){const k=this._get("date")===this._get("defaultDate");q=new Date(q.getTime());this._set("defaultDate",q);k&&this._set("date",q)}},{key:"date",set:function(q){null!=q&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(q.getTime())))}}]);return l}(b.EventedMixin(f));c.__decorate([n.property({type:Boolean})],b.prototype,
"cameraTrackingEnabled",void 0);c.__decorate([n.property({type:Boolean})],b.prototype,"ambientOcclusionEnabled",void 0);c.__decorate([n.property({type:Boolean})],b.prototype,"waterReflectionEnabled",void 0);c.__decorate([n.property({type:Date})],b.prototype,"defaultDate",null);c.__decorate([n.property({type:Date})],b.prototype,"date",null);b=e=c.__decorate([d.subclass("esri.views.3d.environment.SunLighting")],b);(function(h){h.calculateTimezoneOffset=function({hours:l,minutes:v,seconds:q}){return Math.round(l+
v/60+q/3600)}})(b||(b={}));const g={target:null,timezoneOffset:0};return b})},"esri/webscene/SunLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),function(a,c,b,t,n,r,m,d,f){var e;b=e=function(g){function h(v){v=
g.call(this,v)||this;v.type="sun";v.date=null;v.directShadowsEnabled=!1;v.displayUTCOffset=null;return v}a._inheritsLoose(h,g);var l=h.prototype;l.readDate=function(v,q){return null!=q.datetime&&new Date(q.datetime)||null};l.writeDate=function(v,q,k){q[k]=v.getTime()};l.readDirectShadowsEnabled=function(v,q){return!!q.directShadows};l.writedirectShadowsEnabled=function(v,q,k){v&&(q[k]=v)};l.writeDisplayUTCOffset=function(v,q){null!=v&&(q.displayUTCOffset=v)};l.clone=function(){return new e(this.cloneConstructProperties())};
l.cloneConstructProperties=function(){const v={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(v.date=new Date(this.date.getTime()));return v};return h}(b.JSONSupport);c.__decorate([t.property({readOnly:!0,type:["sun"],json:{write:!0}})],b.prototype,"type",void 0);c.__decorate([t.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],b.prototype,"date",void 0);c.__decorate([m.reader("date",["datetime"])],
b.prototype,"readDate",null);c.__decorate([f.writer("date")],b.prototype,"writeDate",null);c.__decorate([t.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],b.prototype,"directShadowsEnabled",void 0);c.__decorate([m.reader("directShadowsEnabled",["directShadows"])],b.prototype,"readDirectShadowsEnabled",null);c.__decorate([f.writer("directShadowsEnabled")],b.prototype,"writedirectShadowsEnabled",null);c.__decorate([t.property({type:Number,json:{write:!0}})],b.prototype,"displayUTCOffset",
void 0);c.__decorate([f.writer("displayUTCOffset")],b.prototype,"writeDisplayUTCOffset",null);return b=e=c.__decorate([d.subclass("esri.webscene.SunLighting")],b)})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),
function(a,c,b,t,n,r,m,d){var f;b=f=function(e){function g(l){l=e.call(this,l)||this;l.ambientOcclusionEnabled=!1;l.waterReflectionEnabled=!1;l.cameraTrackingEnabled=!0;return l}a._inheritsLoose(g,e);var h=g.prototype;h.clone=function(){return new f({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled})};g.fromWebsceneLighting=function(l){return new f(l.cloneConstructProperties())};
h.cloneWithWebsceneLighting=function(l){const v=this.clone();v.directShadowsEnabled=l.directShadowsEnabled;return v};h.cloneNonPersistentConstructProperties=function(){return{ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled,cameraTrackingEnabled:this.cameraTrackingEnabled}};return g}(b.EventedMixin(d));c.__decorate([t.property({type:Boolean})],b.prototype,"ambientOcclusionEnabled",void 0);c.__decorate([t.property({type:Boolean})],b.prototype,
"waterReflectionEnabled",void 0);c.__decorate([t.property({type:Boolean})],b.prototype,"cameraTrackingEnabled",void 0);return b=f=c.__decorate([m.subclass("esri.views.3d.environment.VirtualLighting")],b)})},"esri/webscene/VirtualLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass".split(" "),function(a,c,
b,t,n,r,m){var d;b=d=function(f){function e(h){h=f.call(this,h)||this;h.type="virtual";h.directShadowsEnabled=!1;return h}a._inheritsLoose(e,f);var g=e.prototype;g.clone=function(){return new d(this.cloneConstructProperties())};g.cloneConstructProperties=function(){return{directShadowsEnabled:this.directShadowsEnabled}};return e}(b.JSONSupport);c.__decorate([t.property({readOnly:!0,type:["virtual"],json:{write:!0}})],b.prototype,"type",void 0);c.__decorate([t.property({type:Boolean,json:{default:!1,
name:"directShadows",write:!0}})],b.prototype,"directShadowsEnabled",void 0);return b=d=c.__decorate([m.subclass("esri.webscene.VirtualLighting")],b)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,
c,b,t,n,r,m,d){var f;a.SceneViewAtmosphere=f=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);g.prototype.clone=function(){return new f({quality:this.quality})};c._createClass(g,[{key:"quality",set:function(h){["low","high"].includes(h)&&this._set("quality",h)}}]);return g}(t);b.__decorate([n.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=f=b.__decorate([d.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){var q;const k=n.getLogger("esri.webscene.Environment");n=(p,z,C)=>({enabled:!C||!C.isPresentation});b=q=function(p){function z(B){B=p.call(this,B)||this;B.lighting=new h;B.background=null;B.atmosphereEnabled=!0;B.starsEnabled=!0;return B}a._inheritsLoose(z,p);var C=z.prototype;C.clone=function(){return new q(this.cloneConstructProperties())};C.cloneConstructProperties=function(){return{lighting:this.lighting&&"virtual"===this.lighting.type?l.prototype.clone.call(this.lighting):
h.prototype.clone.call(this.lighting),background:t.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}};a._createClass(z,[{key:"weather",set:function(B){e.validateWeatherType(B?.type,k)&&this._set("weather",B)}}]);return z}(b.JSONSupport);c.__decorate([r.property({types:g.lightingTypes,nonNullable:!0,json:{write:!0}})],b.prototype,"lighting",void 0);c.__decorate([r.property(v.backgroundProperty)],b.prototype,"background",void 0);
c.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:n}}})],b.prototype,"atmosphereEnabled",void 0);c.__decorate([r.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:n}}})],b.prototype,"starsEnabled",void 0);c.__decorate([r.property({types:e.weatherTypes,nonNullable:!0,json:{write:!0},value:new f})],b.prototype,"weather",null);return b=q=c.__decorate([d.subclass("esri.webscene.Environment")],b)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d){var f;b=f=function(e){function g(h){h=e.call(this,h)||this;h.type="sunny";h.cloudCover=.5;return h}a._inheritsLoose(g,e);g.prototype.clone=function(){return new f({cloudCover:this.cloudCover})};return g}(b.JSONSupport);c.__decorate([m.enumeration({sunny:"sunny"})],b.prototype,"type",void 0);c.__decorate([t.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);return b=f=c.__decorate([d.subclass("esri.views.3d.environment.SunnyWeather")],
b)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),function(a,c,b,t,n,r){c={key:"type",base:r,typeMap:{sunny:r,cloudy:c,rainy:t,snowy:n,foggy:b}};const m=Object.keys(c.typeMap);a.validateWeatherType=function(d,f){return m.includes(d)?!0:(f.error(`"${d}" is not a valid weather type`),!1)};a.weatherHeightLimit=1E4;a.weatherTypes=c;a.weatherTypesArray=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m,d){var f;b=f=function(e){function g(h){h=e.call(this,h)||this;h.type="cloudy";
h.cloudCover=.5;return h}a._inheritsLoose(g,e);g.prototype.clone=function(){return new f({cloudCover:this.cloudCover})};return g}(b.JSONSupport);c.__decorate([m.enumeration({cloudy:"cloudy"})],b.prototype,"type",void 0);c.__decorate([t.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);return b=f=c.__decorate([d.subclass("esri.views.3d.environment.CloudyWeather")],b)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d){var f;b=f=function(e){function g(h){h=e.call(this,h)||this;h.type="foggy";h.fogStrength=.5;return h}a._inheritsLoose(g,e);g.prototype.clone=function(){return new f({fogStrength:this.fogStrength})};return g}(b.JSONSupport);c.__decorate([m.enumeration({foggy:"foggy"})],b.prototype,"type",void 0);c.__decorate([t.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"fogStrength",void 0);return b=f=c.__decorate([d.subclass("esri.views.3d.environment.FoggyWeather")],
b)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m,d){var f;b=f=function(e){function g(h){h=e.call(this,h)||this;h.type="rainy";h.cloudCover=
.5;h.precipitation=.5;return h}a._inheritsLoose(g,e);g.prototype.clone=function(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation})};return g}(b.JSONSupport);c.__decorate([m.enumeration({rainy:"rainy"})],b.prototype,"type",void 0);c.__decorate([t.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",void 0);c.__decorate([t.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"precipitation",
void 0);return b=f=c.__decorate([d.subclass("esri.views.3d.environment.RainyWeather")],b)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m,
d){var f;b=f=function(e){function g(h){h=e.call(this,h)||this;h.type="snowy";h.cloudCover=.5;h.precipitation=.5;h.snowCover="disabled";return h}a._inheritsLoose(g,e);g.prototype.clone=function(){return new f({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})};return g}(b.JSONSupport);c.__decorate([m.enumeration({snowy:"snowy"})],b.prototype,"type",void 0);c.__decorate([t.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"cloudCover",
void 0);c.__decorate([t.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],b.prototype,"precipitation",void 0);c.__decorate([t.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],b.prototype,"snowCover",void 0);return b=f=c.__decorate([d.subclass("esri.views.3d.environment.SnowyWeather")],b)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,c,b){a.lightingTypes={key:"type",defaultKeyValue:"sun",
base:null,typeMap:{sun:c,virtual:b}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,c,b){c={base:c,key:"type",typeMap:{color:b}};c={types:c,json:{read:function(t){return(n,r,m)=>{if(!n)return n;for(const d in t.typeMap)if(n.type===d)return r=new t.typeMap[d],r.read(n,m),r}}(c),write:{overridePolicy:(t,n,r)=>({enabled:!r||!r.isPresentation})}}};a.backgroundProperty=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m){b=function(d){function f(e){return d.call(this,e)||this}a._inheritsLoose(f,d);f.prototype.clone=function(){};return f}(b.JSONSupport);
c.__decorate([t.property({readOnly:!0,json:{read:!1}})],b.prototype,"type",void 0);return b=c.__decorate([m.subclass("esri.webscene.background.Background")],b)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,c,b,t,n,r,m,d,f,e){var g;n={...f.colorAndTransparencyProperty,nonNullable:!0};e=g=function(h){function l(q){q=h.call(this,q)||this;q.type="color";q.color=new b([0,0,0,1]);return q}a._inheritsLoose(l,h);var v=l.prototype;v.clone=function(){return new g(this.cloneProperties())};v.cloneProperties=function(){return{color:this.color.clone()}};return l}(e);c.__decorate([m.enumeration({color:"color"},{readOnly:!0})],e.prototype,"type",void 0);c.__decorate([t.property(n)],e.prototype,"color",void 0);
return e=g=c.__decorate([d.subclass("esri.webscene.background.ColorBackground")],e)})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lib/Update ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w){a.SceneViewEnvironmentManager=function(N){function P(){var G=N.call(this)||this;G._referencePointUpdateDelay=200;G._referencePointUpdateInterval=3E3;G._referencePointUpdateDistThreshold=1E6;G._referencePosUpdateQuery=null;G._referencePosMapCoordsRequested=null;G._viewHandles=new r;G._preserveAbsoluteDateTime=!1;G._trackingEnabled=!1;G._referencePosResetPreserveAbsoluteTime=!1;G._referencePosUpdateTimer=null;G._referencePosMapCoords=null;
G._mainLight=new y.MainLight;G._ambientLight=new y.AmbientLight;G._moonLight=new y.FillLight;G.disableQueries=!1;G._disableWeather=!1;G._renderer=null;G._referencePosWGS84Comparable=null;G._resetReferencePosition();return G}c._inheritsLoose(P,N);var I=P.prototype;I.destroy=function(){this.disconnectView();this._viewHandles.destroy()};I.connectView=function(G){if(!this._renderer){this._renderer=new B.EnvironmentRenderer({view:G});var H=()=>this._updateRenderParameters(),L=()=>this._cameraHandler();
this._viewHandles.add([f.watch(()=>G.environment.lighting,O=>this._updateLightingHandler(O),f.sync),f.watch(()=>"virtual"!==G.environment.lighting.type?G.environment.lighting.date:null,O=>this._lightingDateHandler(O),f.sync),f.watch(()=>G.stationary,()=>this._interactingStationaryHandler()),f.watch(()=>G.environment.lighting.directShadowsEnabled,H,f.sync),f.watch(()=>G.environment.lighting.ambientOcclusionEnabled,H,f.sync),f.watch(()=>G.environment.lighting.waterReflectionEnabled,H,f.sync),f.watch(()=>
G.environment.background?.color,H,f.sync),f.watch(()=>G.spatialReference,()=>this._resetReferencePosition(!0),f.sync),f.watch(()=>G.environment.weather.type,()=>this._updateLighting(null,u.Update.Faded),f.sync),f.watch(()=>this.weatherEnabled,()=>this._updateLighting(null,u.Update.Faded),f.sync),f.watch(()=>G.viewingMode,()=>this._resetReferencePosition(!0),f.syncAndInitial),f.watch(()=>"virtual"!==G.environment.lighting.type?G.environment.lighting.cameraTrackingEnabled:!1,O=>this._updateCameraTracking(O),
f.syncAndInitial),f.watch(()=>G.state.camera,L,f.syncAndInitial),f.watch(()=>this.disableQueries,L)]);this._updateRenderParameters();this._updateLighting();this._cameraHandler();this.notifyChange("updating")}};I.disconnectView=function(){this._viewHandles.removeAll();this._resetReferencePosition();this._renderer=m.destroyMaybe(this._renderer)};I._updateLightingHandler=function(G){this._updateCameraTracking("virtual"!==G.type?G.cameraTrackingEnabled:!1);this._lightingDateHandler("virtual"!==G.type?
G.date:null);this._updateRenderParameters()};I._updateCameraTracking=function(G){(this._trackingEnabled=G)?this._cameraHandler():(G=this._view.environment.lighting,"virtual"!==G?.type&&(G.positionTimezoneInfo.autoUpdated=!1))};I._lightingDateHandler=function(G){const H=this._view.environment.lighting;if("virtual"===H?.type)this._updateLighting();else if(G){if(!H.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!p.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var L=
this._view.camera.position;if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(L)){this._requestReferencePositionUpdate(L);return}}this._preupdateTracking(G);m.isSome(this._referencePosWGS84Comparable)&&(L=A.positionToTimezoneInfo(this._referencePosWGS84Comparable,K),m.isSome(L)&&(H.autoUpdate(null,L),this._trackingEnabled&&(H.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(G)}};I._preupdateTracking=function(G){!this._trackingEnabled&&"virtual"!==this._view.environment.lighting.type&&
this._view.environment.lighting.cameraTrackingEnabled&&this._cameraHandler(G)};I._cameraHandler=function(G=null){var H=this._view;H.ready&&(H=H.stateManager.camera)&&(this._cameraHandlerClientSide(H,G)||this._cameraHandlerServerSide(H))};I._cameraHandlerClientSide=function(G,H){const L=z.isEarth(this._view.spatialReference);if(L&&!p.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return"virtual"===this._view.environment.lighting.type&&this._updateLighting(),!1;G=G.position;m.isNone(this._referencePosWGS84Comparable)&&
(this._referencePosWGS84Comparable=q.create());L?p.projectPointToWGS84ComparableLonLat(G,this._referencePosWGS84Comparable):v.set(this._referencePosWGS84Comparable,G.longitude??0,G.latitude??0,G.z??0);this.notifyChange("referencePositionWGS84Comparable");this._autoUpdateTimezone(this._referencePosWGS84Comparable,H)||this._updateLighting(H);return!0};I._cameraHandlerServerSide=function(G){G=G.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(G))&&
this._requestReferencePositionUpdate(G,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=(G.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};I._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};I._updateLighting=function(G,H=u.Update.Immediate){var L=this._view;G=G||("virtual"===L.environment.lighting.type?null:L.environment.lighting.date);var O=this._referencePosWGS84Comparable;
const S=m.isSome(O)?D:F;var R=this.weatherVisible?L.environment.weather.type:"disabled";m.isSome(O)?x.computeColorAndIntensity(G,O,L.state.viewingMode,R,L.state.camera,S):"virtual"===L.environment.lighting.type&&x.computeVirtualLightDirection(L.state.camera,L.state.viewingMode,S.direct.directionToLightSource);G=this._mainLight;L=S.direct;v.scale(G.intensity,L.color,L.intensity*Math.PI);v.copy(G.direction,L.directionToLightSource);G.specularStrength=S.specularStrength;G.environmentStrength=S.environmentStrength;
O=this._ambientLight;v.scale(O.intensity,S.ambient.color,S.ambient.intensity);R=this._moonLight;v.lerp(R.intensity,J,M,S.globalFactor);v.scale(R.intensity,R.intensity,(1-.5*S.globalFactor)*(1-.4*S.noonFactor*(1-S.globalFactor)));v.copy(R.direction,L.directionToLightSource);this._renderer.updateLightSources([G,O,R],S.noonFactor,S.globalFactor,H);this._updateRenderParameters()};I._autoUpdateTimezone=function(G,H=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||
m.isNone(G))return!1;const L=E;L.setTime((H||this._view.environment.lighting.date).getTime());G=A.positionToTimezoneInfo(G,K);if(m.isNone(G))return!1;var O=this._view.environment.lighting.positionTimezoneInfo;if(!O.autoUpdated)O=G;else if(O.hours===G.hours&&O.minutes===G.minutes&&O.seconds===G.seconds)return!1;const S=L.getUTCHours()-(G.hours-O.hours),R=L.getUTCMinutes()-(G.minutes-O.minutes);O=L.getUTCSeconds()-(G.seconds-O.seconds);L.setUTCHours(S);L.setUTCMinutes(R);L.setUTCSeconds(O);return H?
!1:this._view.environment.lighting.autoUpdate(L,G)};I._updateRenderParameters=function(){const G=this._view._stage;if(G){var H=m.mapOr(this._referencePosWGS84Comparable,!0,O=>x.computeShadowsEnabled(O[2],this._view.state.viewingMode)),L=this._view.environment.background;L=L instanceof w?{type:"color",color:k.fromArray(t.toUnitRGBA(L.color))}:{type:"color",color:k.fromValues(0,0,0,1)};G.renderer.setParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&H,background:L,environment:this._view.environment,
weatherVisible:this._view.environmentManager.weatherVisible})}};I._resetReferencePosition=function(G=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;this.notifyChange("updating");G&&this._cameraHandler()};I._requestReferencePositionUpdate=function(G,H=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(G):
this._referencePosMapCoordsRequested=G.clone(),this._referencePosResetPreserveAbsoluteTime=!!H,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const L=this._referencePosUpdateQuery=d.after(this._referencePointUpdateDelay).then(()=>{if(this._referencePosUpdateQuery===L)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==L)}).catch(S=>{"mapcoordshelper:missing-geometry-service"===S.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===
L&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),O=this._referencePosUpdateTimer=d.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===O&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};I._doReferencePositionUpdateQuery=function(){var G=c._asyncToGenerator(function*(H){this._referencePosResetPreserveAbsoluteTime&&
(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;const L=yield this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);H()||isNaN(L[0])||isNaN(L[1])||(H=(this._referencePosMapCoords.z??0)*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?
(this._referencePosWGS84Comparable[0]=L[0],this._referencePosWGS84Comparable[1]=L[1],this._referencePosWGS84Comparable[2]=H):this._referencePosWGS84Comparable=[L[0],L[1],H],this._referencePosChanged())});return function(H){return G.apply(this,arguments)}}();I._executePendingReferencePositionUpdate=function(){const G=this._referencePosMapCoordsRequested;G&&this._requestReferencePositionUpdate(G,this._referencePosResetPreserveAbsoluteTime)};I._referencePosChanged=function(){this._preserveAbsoluteDateTime?
this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")};I._exceedsReferencePosDistThreshold=function(G){return this._referencePosMapCoords?(G=this._referencePosMapCoords.distance(G),this._view.mapCoordsHelper&&(G*=this._view.mapCoordsHelper.unitInMeters),G>this._referencePointUpdateDistThreshold):!0};I._cancelReferencePosUpdates=function(){const G=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=
this._referencePosUpdateQuery=null;return G};c._createClass(P,[{key:"_view",get:function(){return this._renderer?.view}},{key:"updating",get:function(){return!((this.disableQueries||!this._referencePosUpdateQuery&&!this._referencePosMapCoordsRequested)&&!this._renderer?.updating)}},{key:"weatherEnabled",get:function(){return this._view?.environment.atmosphereEnabled&&!this._disableWeather&&this._view?.state?.viewingMode===C.ViewingMode.Global&&z.isEarth(this._view.spatialReference)}},{key:"weatherVisible",
get:function(){return this.weatherEnabled&&this._renderer?.weatherVisible}},{key:"referencePositionWGS84Comparable",get:function(){return this._referencePosWGS84Comparable}},{key:"test",get:function(){const G=this;return{get renderer(){return G._renderer},set referencePointUpdateInterval(H){G._referencePointUpdateInterval=H},set referencePointUpdateDistThreshold(H){G._referencePointUpdateDistThreshold=H},set referencePosUpdateTimer(H){G._referencePosUpdateTimer=H},set referencePointUpdateDelay(H){G._referencePointUpdateDelay=
H},set disableWeather(H){G._disableWeather=H}}}}]);return P}(n.EventedAccessor);b.__decorate([e.property({type:Boolean,readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);b.__decorate([e.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);b.__decorate([e.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);b.__decorate([e.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);b.__decorate([e.property()],a.SceneViewEnvironmentManager.prototype,
"weatherVisible",null);b.__decorate([e.property()],a.SceneViewEnvironmentManager.prototype,"referencePositionWGS84Comparable",null);b.__decorate([e.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);b.__decorate([e.property()],a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=b.__decorate([l.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const D=new x.ColorAndIntensity,
F=new x.ColorAndIntensity,E=new Date,K={hours:0,minutes:0,seconds:0},J=q.fromValues(.22,.22,.33),M=q.fromValues(.22,.22,.22);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./AtmosphereType ./ChapmanAtmosphere ./CloudsComposition ./CloudsCompositionParameters ./CloudsData ./CloudsGenerator ./CloudsPresets ./Fog ./PanoramicAtmosphere ./Precipitation ./SimpleAtmosphere ./SimpleHaze ./Stars ./weather ./weatherUtils ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/lib/RenderFeature ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Update".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H){var L;const O=[G.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE,G.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];a.EnvironmentRenderer=L=function(aa){function X(T){T=aa.call(this,T)||this;T._context=null;T._atmosphere=null;T._hqAtmosphere=null;T._oldWeatherParameters=new S;T._newWeatherParameters=new S;T._fadedWeatherParameters=new S;T._weatherParameters=T._newWeatherParameters;return T}c._inheritsLoose(X,aa);var W=
X.prototype;W.initialize=function(){this.view._stage.addRenderPlugin(O,this)};W.destroy=function(){this.removeHandles();null!=this.view?._stage&&this.view._stage.removeRenderPlugin(this);this._set("view",null)};W.updateAnimation=function(T){return m.isSome(this._precipitation)?this._precipitation.update(T):!1};W.initializeRenderContext=function(T=null){this._context=T;T=()=>this._setNeedsRender();this.addHandles([d.when(()=>this.view?.basemapTerrain,()=>this._updateBasemapTerrain(),d.syncAndInitial),
d.watch(()=>({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),U=>this._updateAtmosphere(U),d.syncAndInitial),d.watch(()=>this._stars,T),d.watch(()=>this._precipitation,T),d.watch(()=>this._clouds,()=>this._updateWeather(),d.initial),d.watch(()=>this._fog,()=>this._updateFogHaze(),d.initial),d.watch(()=>this._simpleHaze,()=>this._updateFogHaze(),d.initial),d.watch(()=>this.view.state.mode,()=>{this._setNeedsRender()},
d.sync),d.watch(()=>this._atmosphereType,()=>this._updateBasemapTerrain(),d.syncAndInitial),d.watch(()=>this._weatherUpdateParameters,()=>{this._updateWeather();this._updateFogHaze()},d.syncAndInitial)])};W.uninitializeRenderContext=function(){this._context=null;this._atmosphere=m.destroyMaybe(this._atmosphere);this._hqAtmosphere=m.destroyMaybe(this._hqAtmosphere);this._set("_stars",m.destroyMaybe(this._stars));this._set("_precipitation",m.destroyMaybe(this._precipitation));this._set("_clouds",m.destroyMaybe(this._clouds));
this._set("_cloudsComposition",m.destroyMaybe(this._cloudsComposition));this._set("_fog",m.destroyMaybe(this._fog));this._set("_simpleHaze",m.destroyMaybe(this._simpleHaze))};W.prepareRender=function(T){T.bindParameters.cloudsFade.data=x.isReadyCloudsData(this._clouds)?this._clouds:null;"local"!==this.view.viewingMode&&(N.updateWeatherFading(T.bindParameters.cloudsFade,T.bindParameters.camera,this.view.state.mode,T.time,this.view.qualitySettings.fadeDuration),this._updateWeatherFading(T.bindParameters),
T.bindParameters.cloudsFade.renderingStage===x.CloudsRenderingStages.FINISHED&&m.isSome(this._clouds)&&0===this._clouds.coverage&&!1===this._clouds.running&&(this._clouds.destroyFrameBufferCube(),T.bindParameters.cloudsFade.data=null))};W.render=function(T){if(T.output===P.ShaderOutput.Color)switch(T.bindParameters.slot){case G.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE:m.isSome(this._stars)&&this._stars.render(T);m.isSome(this.atmosphere)&&(this.atmosphere.render(T),m.isSome(this._cloudsComposition)&&
m.isSome(T.bindParameters.cloudsFade.data)&&(this.weatherVisible&&m.isSome(this._clouds)&&this._clouds.updateWeatherTile(),this._cloudsComposition.render(T)),N.weatherFadingNeedsRender(T.bindParameters.cloudsFade)&&m.isSome(this._context)&&this._context.requestRender());break;case G.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(m.isSome(this.atmosphere)&&(this.atmosphere.renderHaze(T,this._weatherParameters.haze.amount),0<this._weatherParameters.haze.amount&&this._atmosphereType!==z.AtmosphereType.Realistic&&
m.isSome(this._simpleHaze)&&this._simpleHaze.render(T,this._weatherParameters.haze),0<this._weatherParameters.fog.amount&&m.isSome(this._fog)&&this._fog.render(T,this._weatherParameters.fog),m.isSome(this._precipitation))){const U=this.view.environment.weather;"rainy"!==U.type&&"snowy"!==U.type||this._precipitation.render(T,U.precipitation,U.type)}}};W.updateLightSources=function(T,U,Y,ba){if(m.isSome(this._context)){const da=this._context.renderContext;da.bindParameters.oldLighting.copyFrom(da.bindParameters.lighting);
da.bindParameters.newLighting.noonFactor=U;da.bindParameters.newLighting.globalFactor=Y;da.bindParameters.newLighting.set(T);ba===H.Update.Faded||da.bindParameters.weatherFading?da.bindParameters.fadeLighting(0):da.bindParameters.fadeLighting(1);this._context.requestRender()}};W._updateWeatherFading=function(T){if(T.weatherFading){var U=T.cloudsFade;U.fadeIn.stage===A.FadeInStages.FADE_IN?(T.fadeLighting(U.fadeIn.factor),this._fadeWeather(U.fadeIn.factor)):U.fadeInOut.stage===A.FadeInOutStages.FADE_IN?
(T.fadeLighting(U.fadeInOut.factor),this._fadeWeather(U.fadeInOut.factor)):U.crossFade.enabled?(T.fadeLighting(U.crossFade.factor),this._fadeWeather(U.crossFade.factor)):(T.fadeLighting(0),this._fadeWeather(0))}};W._fadeWeather=function(T){const {_newWeatherParameters:U,_oldWeatherParameters:Y}=this;1<=T?this._weatherParameters=U:(this._fadedWeatherParameters.lerp(Y,U,T),this._weatherParameters=this._fadedWeatherParameters)};W._updateWeather=function(){const T=this._weatherUpdateParameters;m.isNone(T)||
m.isNone(this._clouds)||(this._clouds.applyPreset(y.cloudPresets[T.type],T.weatherAdjustment),this._setNeedsRender())};W._setNeedsRender=function(){m.isSome(this._context)&&this._context.requestRender()};W._updateFogHaze=function(){const T=this._weatherUpdateParameters;if(!(m.isNone(this._fog)||m.isNone(this._simpleHaze)||m.isNone(T)||m.isNone(this._context))){var U=this._context.renderContext.bindParameters;this._oldWeatherParameters.copyFrom(this._weatherParameters);switch(T.type){case "foggy":this._newWeatherParameters.fog.strength=
r.lerp(3E-5,.005,T.weatherAdjustment**3);l.copy(this._newWeatherParameters.fog.color,Q);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.haze.strength=0;this._newWeatherParameters.haze.amount=this._atmosphereType===z.AtmosphereType.Realistic?1:0;this._setNeedsRender();break;case "rainy":this._newWeatherParameters.fog.strength=r.lerp(4E-6,2E-4,(T.effect??0)**3);l.copy(this._newWeatherParameters.fog.color,R);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.haze.strength=
0;this._newWeatherParameters.haze.amount=0;this._setNeedsRender();break;case "snowy":this._newWeatherParameters.fog.strength=r.lerp(4E-6,2E-4,(T.effect??0)**3);l.copy(this._newWeatherParameters.fog.color,Q);this._newWeatherParameters.fog.amount=1;this._newWeatherParameters.haze.strength=0;this._newWeatherParameters.haze.amount=this._atmosphereType===z.AtmosphereType.Realistic?1:0;this._setNeedsRender();break;default:this._newWeatherParameters.fog.strength=0,this._newWeatherParameters.fog.amount=0,
this._newWeatherParameters.haze.strength=4E-6,this._newWeatherParameters.haze.amount=1,this._setNeedsRender()}U.weatherFading?this._fadeWeather(0):this._fadeWeather(1)}};W._updateAtmosphere=function(T){T=this._selectAtmosphereType(T);if(m.isSome(this._atmosphere)?this._atmosphere.type!==T:T!==z.AtmosphereType.None){this._atmosphere=m.destroyMaybe(this._atmosphere);this._hqAtmosphere=m.destroyMaybe(this._hqAtmosphere);var U=this._getAtmosphereClass(T);U&&m.isSome(this._context)&&(this._atmosphere=
new U(this.view,this._context),T===z.AtmosphereType.Simple&&(this._hqAtmosphere=new C.ChapmanAtmosphere(this.view,this._context)));this._setNeedsRender();this._updateBasemapTerrain()}};W._getAtmosphereClass=function(T){switch(T){case z.AtmosphereType.Realistic:return C.ChapmanAtmosphere;case z.AtmosphereType.Panoramic:return D.PanoramicAtmosphere;case z.AtmosphereType.Simple:return E;default:case z.AtmosphereType.None:return null}};W._selectAtmosphereType=function(T){const {enabled:U,quality:Y,viewingMode:ba}=
T;return!U||k.isMoon(this.view.spatialReference)?z.AtmosphereType.None:ba===p.ViewingMode.Local?z.AtmosphereType.Panoramic:m.isSome(this._context)&&"high"===Y&&C.ChapmanAtmosphere.isSupported(this._context)&&k.isEarth(this.view.spatialReference)?z.AtmosphereType.Realistic:z.AtmosphereType.Simple};W._updateBasemapTerrain=function(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=this._atmosphereType===z.AtmosphereType.Simple)};c._createClass(X,[{key:"atmosphere",get:function(){return m.isSome(this._hqAtmosphere)&&
this.view._stage.renderer.isFeatureEnabled(I.RenderFeature.RealisticAtmosphere)?this._hqAtmosphere:this._atmosphere}},{key:"_atmosphereType",get:function(){return m.isSome(this.atmosphere)?this.atmosphere.type:z.AtmosphereType.None}},{key:"canRender",get:function(){return!!this.view.basemapTerrain?.renderer.canRender||"global"!==this.view.viewingMode}},{key:"needsLinearDepth",get:function(){return this._atmosphereType===z.AtmosphereType.Realistic}},{key:"updating",get:function(){return m.isSome(this._stars)&&
this._stars.updating||m.isSome(this._clouds)&&this._clouds.running}},{key:"weatherVisible",get:function(){return l.length(this.view.state.camera.eye)-q.getReferenceEllipsoid(this.view.spatialReference).radius<=M.weatherHeightLimit}},{key:"_stars",get:function(){const T=this.view,U=T.environment?.starsEnabled??!1,Y=this._get("_stars");return!U||m.isNone(this._context)?(m.destroyMaybe(Y),null):m.isSome(Y)?Y:new J.Stars({view:T,requestRender:()=>this._setNeedsRender()})}},{key:"_precipitation",get:function(){const T=
this._get("_precipitation");if(!this._precipitationEnabled||m.isNone(this._context))return m.destroyMaybe(T),null;const U=this.view,Y=this._context;if(m.isSome(T)&&T.context===Y)return T;m.destroyMaybe(T);return new F.Precipitation({context:Y,view:U})}},{key:"_clouds",get:function(){const T=this._get("_clouds");if(!this.weatherEnabled||m.isNone(this._context))return m.destroyMaybe(T),null;if(m.isSome(T))return T;const U=this.view,Y=this._context;m.destroyMaybe(T);return new u.CloudsGenerator({context:Y,
view:U,requestRender:()=>this._setNeedsRender()})}},{key:"_cloudsComposition",get:function(){const T=this._get("_cloudsComposition");if(!this.weatherEnabled||m.isNone(this._context))return m.destroyMaybe(T),null;const U=this.view.state.viewingMode,Y=this._context.renderContext.rctx,ba=q.getReferenceEllipsoid(this.view.spatialReference).radius;if(m.isSome(T)&&T.viewingMode===U&&T.planetRadius===ba)return T;m.destroyMaybe(T);return new B.CloudsComposition({rctx:Y,viewingMode:U,planetRadius:ba,requestRender:()=>
this._setNeedsRender()})}},{key:"_fog",get:function(){const T=this._get("_fog");return!this.weatherEnabled||m.isNone(this._context)?(m.destroyMaybe(T),null):m.isSome(T)?T:new w.Fog({context:this._context,view:this.view})}},{key:"_simpleHaze",get:function(){const T=this._get("_simpleHaze");return!this.weatherEnabled||m.isNone(this._context)?(m.destroyMaybe(T),null):m.isSome(T)?T:new K.SimpleHaze({context:this._context,view:this.view})}},{key:"weatherEnabled",get:function(){return!!this.view?.environmentManager?.weatherEnabled}},
{key:"_precipitationEnabled",get:function(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}},{key:"_weatherUpdateParameters",get:function(){const T=this.weatherEnabled?this.view.environment.weather:null;return m.isNone(T)?null:"rainy"===T.type||"snowy"===T.type?{type:T.type,weatherAdjustment:T.cloudCover,effect:T.precipitation}:{type:T.type,weatherAdjustment:"foggy"===T.type?T.fogStrength:T.cloudCover}}},{key:"test",get:function(){return{atmosphere:this._atmosphere,
clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType({viewingMode:this.view.state.viewingMode,enabled:this.view.environment.atmosphereEnabled,quality:this.view.environment.atmosphere.quality}),stubGetAtmosphereClass:T=>{V=L.prototype._getAtmosphereClass;L.prototype._getAtmosphereClass=T},restoreGetAtmosphereClass:()=>{L.prototype._getAtmosphereClass=V}}}}]);return X}(t);b.__decorate([f.property({constructOnly:!0})],a.EnvironmentRenderer.prototype,"view",void 0);b.__decorate([f.property({readOnly:!0})],
a.EnvironmentRenderer.prototype,"atmosphere",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_atmosphereType",null);b.__decorate([f.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherVisible",null);b.__decorate([f.property()],a.EnvironmentRenderer.prototype,"_context",void 0);b.__decorate([f.property()],a.EnvironmentRenderer.prototype,"_atmosphere",void 0);
b.__decorate([f.property()],a.EnvironmentRenderer.prototype,"_hqAtmosphere",void 0);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_stars",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudsComposition",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,
"_fog",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_simpleHaze",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherEnabled",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitationEnabled",null);b.__decorate([f.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=L=b.__decorate([h.subclass("esri.views.3d.environment.EnvironmentRenderer")],
a.EnvironmentRenderer);let S=function(){function aa(){this.fog=new w.FogParameters;this.haze=new K.HazeParameters}var X=aa.prototype;X.copyFrom=function(W){this.fog.amount=W.fog.amount;this.haze.amount=W.haze.amount;this.fog.strength=W.fog.strength;this.haze.strength=W.haze.strength;l.copy(this.fog.color,W.fog.color)};X.lerp=function(W,T,U){this.fog.amount=r.lerp(W.fog.amount,T.fog.amount,U);this.haze.amount=r.lerp(W.haze.amount,T.haze.amount,U);this.fog.strength=r.lerp(W.fog.strength,T.fog.strength,
U);this.haze.strength=r.lerp(W.haze.strength,T.haze.strength,U);l.lerp(this.fog.color,W.fog.color,T.fog.color,U)};return aa}();const R=v.fromValues(.5,.5,.5),Q=v.fromValues(1.5,1.5,1.5);let V;a.WeatherParameters=S;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/AtmosphereType":function(){define(["exports"],function(a){a.AtmosphereType=void 0;var c=a.AtmosphereType||(a.AtmosphereType={});c[c.Simple=0]="Simple";c[c.Realistic=1]="Realistic";c[c.Panoramic=2]=
"Panoramic";c[c.None=3]="None";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec4 ../../../geometry/support/Ellipsoid ./AtmosphereType ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){let p=function(){function z(B,A){this._view=B;this.type=e.AtmosphereType.Realistic;this._handles=new c;this._passParameters=new h.ChapmanAtmospherePassParameters;this._rootTileElevationMin=NaN;this._lowerBoundEarthRadius=f.earth.radius;this._fadeHaze=0;this._updateRadius(f.earth.radius);B=A.renderContext.rctx;this._updateRootTileElevationBounds();this._handles.add([n.watch(()=>this._view.basemapTerrain.rootTileElevationBounds,()=>this._updateRootTileElevationBounds()),
n.watch(()=>this._view.basemapTerrain.visibleElevationBounds,()=>this._updateVisibleElevationBounds())]);const x=new l.ChapmanAtmosphereTechniqueConfiguration;x.haze=!1;this._atmosphereTechnique=A.techniqueRepository.acquire(h.ChapmanAtmosphereTechnique,x);x.haze=!0;this._atmosphereHazeTechnique=A.techniqueRepository.acquire(h.ChapmanAtmosphereTechnique,x);this._vao=q.createQuadVAO(B,v.Pos2Tex)}var C=z.prototype;C.destroy=function(){this._atmosphereTechnique.release();this._atmosphereHazeTechnique.release();
this._vao.dispose();this._handles.destroy()};C.render=function(B){this._render(B,this._atmosphereTechnique,B.offscreenRenderingHelper.depthTexture)};C.renderHaze=function(B,A){this._fadeHaze=A;this._render(B,this._atmosphereHazeTechnique,B.offscreenRenderingHelper.linearDepthTexture)};C._render=function(B,A,x){if(!t.isNone(x)){this._update(B.bindParameters.camera);this._passParameters.depthTex=x;var u=B.rctx.bindTechnique(A,this._passParameters,B.bindParameters);B.offscreenRenderingHelper.renderDepthDetached(()=>
this._renderCommon(u,B))}};C._renderCommon=function(B,A){t.isNone(this._vao)||(A.rctx.bindVAO(this._vao),B.assertCompatibleVertexAttributeLocations(this._vao),A.rctx.drawArrays(k.PrimitiveType.TRIANGLE_STRIP,0,4))};C._adjustRadiusForTesselation=function(B){return B*Math.cos(Math.PI/16/16)};C._updateRootTileElevationBounds=function(){const B=this._view.basemapTerrain.rootTileElevationBounds.min;B!==this._rootTileElevationMin&&(this._rootTileElevationMin=B,this._lowerBoundEarthRadius=f.earth.radius,
this._updateVisibleElevationBounds())};C._updateVisibleElevationBounds=function(){const B=this._adjustRadiusForTesselation(f.earth.radius+this._view.basemapTerrain.visibleElevationBounds.min);B<this._lowerBoundEarthRadius&&this._updateRadius(B)};C._updateRadius=function(B){this._lowerBoundEarthRadius=B;r.set(this._passParameters.radii,B,B+g.atmosphereHeight);this._passParameters.innerFadeDistance=2*Math.sqrt((2*B-g.innerAtmosphereDepth)*g.innerAtmosphereDepth)};C._update=function(B){if(!t.isNone(B)){B=
m.squaredLength(B.eye);var A=Math.sqrt(B),x=B-this._passParameters.radii[1]*this._passParameters.radii[1],u=b.clamp((A-this._passParameters.radii[0])/g.atmosphereHeight,0,1);d.set(this._passParameters.heightParameters,A,B,x,u);this._passParameters.altitudeFade=g.computeInnerAltitudeFade(A-this._lowerBoundEarthRadius);this._passParameters.hazeStrength=b.lerp(b.lerp(.6,1,b.smoothstep(9500,10500,A-f.earth.radius)),1,this._fadeHaze)}};z.isSupported=function(B){return B.renderContext.rctx.capabilities.depthTexture};
return z}();a.ChapmanAtmosphere=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec2":function(){define(["exports","./common"],function(a,c){function b(O,S){O[0]=S[0];O[1]=S[1];return O}function t(O,S,R){O[0]=S;O[1]=R;return O}function n(O,S,R){O[0]=S[0]+R[0];O[1]=S[1]+R[1];return O}function r(O,S,R){O[0]=S[0]-R[0];O[1]=S[1]-R[1];return O}function m(O,S,R){O[0]=S[0]*R[0];O[1]=S[1]*R[1];return O}function d(O,S,R){O[0]=S[0]/R[0];O[1]=S[1]/R[1];return O}function f(O,S){O[0]=
Math.ceil(S[0]);O[1]=Math.ceil(S[1]);return O}function e(O,S){O[0]=Math.floor(S[0]);O[1]=Math.floor(S[1]);return O}function g(O,S,R){O[0]=Math.min(S[0],R[0]);O[1]=Math.min(S[1],R[1]);return O}function h(O,S,R){O[0]=Math.max(S[0],R[0]);O[1]=Math.max(S[1],R[1]);return O}function l(O,S){O[0]=Math.round(S[0]);O[1]=Math.round(S[1]);return O}function v(O,S,R){O[0]=S[0]*R;O[1]=S[1]*R;return O}function q(O,S,R,Q){O[0]=S[0]+R[0]*Q;O[1]=S[1]+R[1]*Q;return O}function k(O,S){const R=S[0]-O[0];O=S[1]-O[1];return Math.sqrt(R*
R+O*O)}function p(O,S){const R=S[0]-O[0];O=S[1]-O[1];return R*R+O*O}function z(O){const S=O[0];O=O[1];return Math.sqrt(S*S+O*O)}function C(O){const S=O[0];O=O[1];return S*S+O*O}function B(O,S){O[0]=-S[0];O[1]=-S[1];return O}function A(O,S){O[0]=1/S[0];O[1]=1/S[1];return O}function x(O,S){var R=S[0];const Q=S[1];R=R*R+Q*Q;0<R&&(R=1/Math.sqrt(R),O[0]=S[0]*R,O[1]=S[1]*R);return O}function u(O,S){return O[0]*S[0]+O[1]*S[1]}function y(O,S,R){S=S[0]*R[1]-S[1]*R[0];O[0]=O[1]=0;O[2]=S;return O}function w(O,
S,R,Q){const V=S[0];S=S[1];O[0]=V+Q*(R[0]-V);O[1]=S+Q*(R[1]-S);return O}function D(O,S){S=S||1;const R=2*c.RANDOM()*Math.PI;O[0]=Math.cos(R)*S;O[1]=Math.sin(R)*S;return O}function F(O,S,R){const Q=S[0];S=S[1];O[0]=R[0]*Q+R[2]*S;O[1]=R[1]*Q+R[3]*S;return O}function E(O,S,R){const Q=S[0];S=S[1];O[0]=R[0]*Q+R[2]*S+R[4];O[1]=R[1]*Q+R[3]*S+R[5];return O}function K(O,S,R){const Q=S[0];S=S[1];O[0]=R[0]*Q+R[3]*S+R[6];O[1]=R[1]*Q+R[4]*S+R[7];return O}function J(O,S,R){const Q=S[0];S=S[1];O[0]=R[0]*Q+R[4]*
S+R[12];O[1]=R[1]*Q+R[5]*S+R[13];return O}function M(O,S,R,Q){const V=S[0]-R[0];S=S[1]-R[1];const aa=Math.sin(Q);Q=Math.cos(Q);O[0]=V*Q-S*aa+R[0];O[1]=V*aa+S*Q+R[1];return O}function N(O,S){var R=O[0];O=O[1];const Q=S[0];S=S[1];let V=R*R+O*O;0<V&&(V=1/Math.sqrt(V));let aa=Q*Q+S*S;0<aa&&(aa=1/Math.sqrt(aa));R=(R*Q+O*S)*V*aa;return 1<R?0:-1>R?Math.PI:Math.acos(R)}function P(O){return"vec2("+O[0]+", "+O[1]+")"}function I(O,S){return O[0]===S[0]&&O[1]===S[1]}function G(O,S){const R=O[0];O=O[1];const Q=
S[0];S=S[1];const V=c.getEpsilon();return Math.abs(R-Q)<=V*Math.max(1,Math.abs(R),Math.abs(Q))&&Math.abs(O-S)<=V*Math.max(1,Math.abs(O),Math.abs(S))}function H(O,S,R,Q,V){let aa=S[0]-R[0];R=S[1]-R[1];V=(Q[0]*aa+Q[1]*R)*(V-1);aa=Q[0]*V;R=Q[1]*V;O[0]=S[0]+aa;O[1]=S[1]+R;return O}const L=Object.freeze(Object.defineProperty({__proto__:null,add:n,angle:N,ceil:f,copy:b,cross:y,dist:k,distance:k,div:d,divide:d,dot:u,equals:G,exactEquals:I,floor:e,inverse:A,len:z,length:z,lerp:w,max:h,min:g,mul:m,multiply:m,
negate:B,normalize:x,projectAndScale:H,random:D,rotate:M,round:l,scale:v,scaleAndAdd:q,set:t,sqrDist:p,sqrLen:C,squaredDistance:p,squaredLength:C,str:P,sub:r,subtract:r,transformMat2:F,transformMat2d:E,transformMat3:K,transformMat4:J},Symbol.toStringTag,{value:"Module"}));a.add=n;a.angle=N;a.ceil=f;a.copy=b;a.cross=y;a.dist=k;a.distance=k;a.div=d;a.divide=d;a.dot=u;a.equals=G;a.exactEquals=I;a.floor=e;a.inverse=A;a.len=z;a.length=z;a.lerp=w;a.max=h;a.min=g;a.mul=m;a.multiply=m;a.negate=B;a.normalize=
x;a.projectAndScale=H;a.random=D;a.rotate=M;a.round=l;a.scale=v;a.scaleAndAdd=q;a.set=t;a.sqrDist=p;a.sqrLen=C;a.squaredDistance=p;a.squaredLength=C;a.str=P;a.sub=r;a.subtract=r;a.transformMat2=F;a.transformMat2d=E;a.transformMat3=K;a.transformMat4=J;a.vec2=L})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../core/mathUtils"],function(a,c){a.atmosphereHeight=1E5;a.computeInnerAltitudeFade=function(b){return c.clamp((b-1E5)/9E5,0,1)};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=
.085;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/vec2f64 ../../../chunks/vec4f64 ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){m=function(v){function q(){var k=v.apply(this,arguments)||this;k.heightParameters=n.create();k.radii=t.create();k.innerFadeDistance=0;k.altitudeFade=0;k.hazeStrength=1;return k}b._inheritsLoose(q,v);return q}(m.NoParameters);f=function(v){function q(){return v.apply(this,arguments)||this}b._inheritsLoose(q,v);var k=q.prototype;k.initializeProgram=function(p){return new g.Program(p.rctx,q.shader.get().build(this.configuration),e.Default3D)};k.initializePipeline=
function(){return this.configuration.haze?l.makePipelineState({blending:l.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ZERO,h.BlendFactor.ONE_MINUS_SRC_COLOR,h.BlendFactor.ONE),colorWrite:l.defaultColorWriteParams}):l.makePipelineState({blending:l.separateBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:h.CompareFunction.LEQUAL},colorWrite:l.defaultColorWriteParams})};return q}(f.ShaderTechnique);
f.shader=new d.ReloadableShaderModule(r.ChapmanAtmosphere,()=>new Promise((v,q)=>a(["./ChapmanAtmosphere.glsl"],v,q)));c.ChapmanAtmospherePassParameters=m;c.ChapmanAtmosphereTechnique=f;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ./mat4 ./mat4f64 ./vec3f64 ../views/3d/environment/atmosphereUtils ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){function C(y){const w=new k.ShaderBuilder;w.attributes.add(z.VertexAttribute.POSITION,"vec2");w.include(r.TextureCoordinateAttribute,{textureCoordinateType:r.TextureCoordinateAttributeType.Default});w.varyings.add("worldRay","vec3");w.varyings.add("eyeDir","vec3");const {vertex:D,fragment:F}=w;D.uniforms.add([new q.Matrix4PassUniform("inverseProjectionMatrix",(E,K)=>K.camera.inverseProjectionMatrix),new q.Matrix4PassUniform("inverseViewMatrix",(E,K)=>
c.invertOrIdentity(u,K.camera.viewMatrix))]);D.code.add(v.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);F.uniforms.add([new e.Float2PassUniform("radii",E=>E.radii),new g.Float3PassUniform("cameraPosition",(E,K)=>K.camera.eye),new h.Float4PassUniform("heightParameters",E=>E.heightParameters),new l.FloatPassUniform("innerFadeDistance",E=>E.innerFadeDistance),new l.FloatPassUniform("altitudeFade",E=>E.altitudeFade),new p.Texture2DPassUniform("depthTex",E=>E.depthTex),new l.FloatPassUniform("hazeStrength",E=>E.hazeStrength)]);F.constants.add("betaRayleigh","vec3",B);F.constants.add("betaCombined","vec3",
x);F.constants.add("betaMie","float",3.996E-6);F.constants.add("scaleHeight","float",n.rayLeighScaleHeight*n.atmosphereHeight);f.addMainLightDirection(F);w.include(d.Gamma);y.haze&&(F.include(m.ReadLinearDepth),F.uniforms.add(new e.Float2PassUniform("nearFar",(E,K)=>K.camera.nearFar)));F.code.add(v.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);F.code.add(v.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);F.code.add(v.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);F.code.add(v.glsl`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${y.haze?v.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${y.haze?v.glsl``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${y.haze?"":v.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.0596831 * mumu;

      ${y.haze?v.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:v.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.1193662 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${y.haze?v.glsl`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:v.glsl`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${y.haze?v.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:v.glsl`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, mainLightDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${y.haze?"":v.glsl`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, mainLightDirection, gl_FragColor);
          }`}
    }
  `);return w}const B=t.fromValues(parseFloat(Number(5.802E-6).toFixed(6)),parseFloat(Number(1.3558E-5).toFixed(6)),parseFloat(Number(3.31E-5).toFixed(6))),A=t.fromValues(3*parseFloat(Number(6.5E-7).toFixed(6)),3*parseFloat(Number(1.881E-6).toFixed(6)),3*parseFloat(Number(8.5E-8).toFixed(6))),x=t.fromValues(parseFloat(Number(B[0]+A[0]).toFixed(6)),parseFloat(Number(B[1]+A[1]).toFixed(6)),parseFloat(Number(B[2]+A[2]).toFixed(6))),u=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,betaRayleigh:B,
build:C},Symbol.toStringTag,{value:"Module"}));a.ChapmanAtmosphere=b;a.betaRayleigh=B;a.build=C})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,c,b,t){a.TextureCoordinateAttributeType=void 0;(function(n){n[n.None=0]="None";n[n.Default=1]="Default";n[n.Atlas=2]="Atlas";n[n.Compressed=3]="Compressed";n[n.COUNT=4]=
"COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType={}));a.TextureCoordinateAttribute=function(n,r){switch(r.textureCoordinateType){case a.TextureCoordinateAttributeType.Default:n.attributes.add(t.VertexAttribute.UV0,"vec2");n.varyings.add("vuv0","vec2");n.vertex.code.add(b.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case a.TextureCoordinateAttributeType.Compressed:n.attributes.add(t.VertexAttribute.UV0,"vec2");n.varyings.add("vuv0","vec2");n.vertex.code.add(b.glsl`vec2 getUV0() {
return uv0 / 16384.0;
}
void forwardTextureCoordinates() {
vuv0 = getUV0();
}`);break;case a.TextureCoordinateAttributeType.Atlas:n.attributes.add(t.VertexAttribute.UV0,"vec2");n.varyings.add("vuv0","vec2");n.attributes.add(t.VertexAttribute.UVREGION,"vec4");n.varyings.add("vuvRegion","vec4");n.vertex.code.add(b.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;default:c.neverReached(r.textureCoordinateType);case a.TextureCoordinateAttributeType.None:n.vertex.code.add(b.glsl`void forwardTextureCoordinates() {}`);case a.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function c(b,...t){let n="";for(let r=0;r<t.length;r++)n+=b[r]+t[r];return n+=b[b.length-1]}(function(b){b.int=function(t){return Math.round(t).toString()};
b.float=function(t){return t.toPrecision(8)}})(c||(c={}));a.NoParameters=function(){};a.glsl=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;var c=a.VertexAttribute||(a.VertexAttribute={});c.POSITION="position";c.NORMAL="normal";c.UV0="uv0";c.AUXPOS1="auxpos1";c.AUXPOS2="auxpos2";c.COLOR="color";c.SYMBOLCOLOR="symbolColor";c.SIZE="size";c.TANGENT="tangent";c.OFFSET=
"offset";c.SUBDIVISIONFACTOR="subdivisionFactor";c.COLORFEATUREATTRIBUTE="colorFeatureAttribute";c.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";c.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";c.DISTANCETOSTART="distanceToStart";c.UVMAPSPACE="uvMapSpace";c.BOUNDINGRECT="boundingRect";c.UVREGION="uvRegion";c.NORMALCOMPRESSED="normalCompressed";c.PROFILERIGHT="profileRight";c.PROFILEUP="profileUp";c.PROFILEVERTEXANDNORMAL="profileVertexAndNormal";c.FEATUREVALUE="featureValue";c.MODELORIGINHI="modelOriginHi";
c.MODELORIGINLO="modelOriginLo";c.MODEL="model";c.MODELNORMAL="modelNormal";c.INSTANCECOLOR="instanceColor";c.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";c.LOCALTRANSFORM="localTransform";c.GLOBALTRANSFORM="globalTransform";c.BOUNDINGSPHERE="boundingSphere";c.MODELORIGIN="modelOrigin";c.MODELSCALEFACTORS="modelScaleFactors";c.FEATUREATTRIBUTE="featureAttribute";c.STATE="state";c.LODLEVEL="lodLevel";c.POSITION0="position0";c.POSITION1="position1";c.NORMALA="normalA";c.NORMALB="normalB";c.COMPONENTINDEX=
"componentIndex";c.VARIANTOFFSET="variantOffset";c.VARIANTSTROKE="variantStroke";c.VARIANTEXTENSION="variantExtension";c.U8PADDING="u8padding";c.U16PADDING="u16padding";c.SIDENESS="sideness";c.START="start";c.END="end";c.UP="up";c.EXTRUDE="extrude";c.OBJECTANDLAYERIDCOLOR="objectAndLayerIdColor";c.OBJECTANDLAYERIDCOLOR_INSTANCED="objectAndLayerIdColor_instanced";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports",
"../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,c,b){a.ReadLinearDepth=function(t){t.include(c.RgbaFloatEncoding);t.code.add(b.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.RgbaFloatEncoding=function(b){b.code.add(c.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.Gamma=function(b){b.fragment.code.add(c.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces"],function(a,c,b,t){function n(d){d.uniforms.add(new c.Float3PassUniform("mainLightDirection",(f,e)=>e.lighting.mainLight.direction))}function r(d){d.uniforms.add(new c.Float3PassUniform("mainLightIntensity",(f,e)=>e.lighting.mainLight.intensity))}
function m(d,f){f.useLegacyTerrainShading?d.uniforms.add(new b.FloatPassUniform("lightingFixedFactor",(e,g)=>g.lighting.noonFactor*(1-g.lighting.globalFactor))):d.constants.add("lightingFixedFactor","float",0)}a.MainLighting=function(d,f){d=d.fragment;n(d);r(d);m(d,f);d.code.add(t.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, mainLightDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return mainLightIntensity * ((1.0 - shadowing) * dotVal);
}`)};a.addMainLightDirection=n;a.addMainLightIntensity=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"vec3",t.BindType.Pass,(f,e,g)=>f.setUniform3fv(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Float3PassUniform=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports","../../../../../core/maybe","../shaderTechnique/BindType"],function(a,c,b){let t=function(){function n(r,m,d,f,e=null){this.name=r;this.type=m;this.arraySize=e;this.bind={[b.BindType.Pass]:null,[b.BindType.Draw]:null};c.isSome(d)&&c.isSome(f)&&(this.bind[d]=f)}n.prototype.equals=function(r){return this.type===r.type&&this.name===r.name&&this.arraySize===
r.arraySize};return n}();a.Uniform=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],function(a){a.BindType=void 0;var c=a.BindType||(a.BindType={});c[c.Pass=0]="Pass";c[c.Draw=1]="Draw";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform",
"../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"float",t.BindType.Pass,(f,e,g)=>f.setUniform1f(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.FloatPassUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=
function(n){function r(m,d){return n.call(this,m,"vec2",t.BindType.Pass,(f,e,g)=>f.setUniform2fv(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Float2PassUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"vec4",
t.BindType.Pass,(f,e,g)=>f.setUniform4fv(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Float4PassUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"mat4",t.BindType.Pass,(f,e,g)=>f.setUniformMatrix4fv(m,
d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Matrix4PassUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Error","../../../../../core/Logger","../../../../../core/maybe"],function(a,c,b,t,n){const r=t.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");t=function(){function q(){this._includedModules=
new Map}q.prototype.include=function(k,p){if(this._includedModules.has(k)){const z=this._includedModules.get(k);if(z!==p){r.error("Trying to include shader module multiple times with different sets of options.");p=new Set;for(const C of Object.keys(z))z[C]!==k[C]&&p.add(C);for(const C of Object.keys(k))z[C]!==k[C]&&p.add(C);p.forEach(C=>console.error(`  ${C}: current ${z[C]} new ${k[C]}`))}}else this._includedModules.set(k,p),k(this.builder,p)};return q}();let m=function(q){function k(){var z=q.apply(this,
arguments)||this;z.vertex=new e;z.fragment=new e;z.attributes=new g;z.varyings=new h;z.extensions=new l;z.constants=new v;return z}c._inheritsLoose(k,q);var p=k.prototype;p.generate=function(z){const C=this.extensions.generateSource(z),B=this.attributes.generateSource(z),A=this.varyings.generateSource();var x="vertex"===z?this.vertex:this.fragment;const u=x.uniforms.generateSource(),y=x.code.generateSource();z="vertex"===z?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";
x=this.constants.generateSource().concat(x.constants.generateSource());return`\n${C.join("\n")}\n\n${z}\n\n${x.join("\n")}\n\n${u.join("\n")}\n\n${B.join("\n")}\n\n${A.join("\n")}\n\n${y.join("\n")}`};p.generateBind=function(z,C){const B=new Map;this.vertex.uniforms.entries.forEach(u=>{const y=u.bind[z];n.isSome(y)&&B.set(u.name,y)});this.fragment.uniforms.entries.forEach(u=>{const y=u.bind[z];n.isSome(y)&&B.set(u.name,y)});const A=Array.from(B.values()),x=A.length;return(u,y,w)=>{for(let D=0;D<x;++D)A[D](C,
u,y,w)}};c._createClass(k,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms.entries}},{key:"builder",get:function(){return this}}]);return k}(t),d=function(){function q(){this._entries=new Map}var k=q.prototype;k.add=function(p){if(!Array.isArray(p))return this._add(p);for(const z of p)this._add(z)};k.get=function(p){return this._entries.get(p)};k._add=function(p){if(n.isNone(p))r.error(`Trying to add null Uniform from ${Error().stack}.`);else{if(this._entries.has(p.name)&&!this._entries.get(p.name).equals(p))throw new b(`Duplicate uniform name ${p.name} for different uniform type`);
this._entries.set(p.name,p)}};k.generateSource=function(){return Array.from(this._entries.values()).map(p=>n.isSome(p.arraySize)?`uniform ${p.type} ${p.name}[${p.arraySize}];`:`uniform ${p.type} ${p.name};`)};c._createClass(q,[{key:"entries",get:function(){return Array.from(this._entries.values())}}]);return q}(),f=function(){function q(){this._entries=[]}var k=q.prototype;k.add=function(p){this._entries.push(p)};k.generateSource=function(){return this._entries};return q}(),e=function(q){function k(){var p=
q.apply(this,arguments)||this;p.uniforms=new d;p.code=new f;p.constants=new v;return p}c._inheritsLoose(k,q);c._createClass(k,[{key:"builder",get:function(){return this}}]);return k}(t),g=function(){function q(){this._entries=[]}var k=q.prototype;k.add=function(p,z){this._entries.push([p,z])};k.generateSource=function(p){return"fragment"===p?[]:this._entries.map(z=>`attribute ${z[1]} ${z[0]};`)};return q}(),h=function(){function q(){this._entries=[]}var k=q.prototype;k.add=function(p,z){this._entries.push([p,
z])};k.generateSource=function(){return this._entries.map(p=>`varying ${p[1]} ${p[0]};`)};return q}(),l=function(){function q(){this._entries=new Set}var k=q.prototype;k.add=function(p){this._entries.add(p)};k.generateSource=function(p){const z="vertex"===p?q.ALLOWLIST_VERTEX:q.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(C=>z.includes(C)).map(C=>`#extension ${C} : enable`)};return q}();l.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];l.ALLOWLIST_VERTEX=
[];let v=function(){function q(){this._entries=new Set}var k=q.prototype;k.add=function(p,z,C){let B="ERROR_CONSTRUCTOR_STRING";switch(z){case "float":B=q._numberToFloatStr(C);break;case "int":B=q._numberToIntStr(C);break;case "bool":B=C.toString();break;case "vec2":B=`vec2(${q._numberToFloatStr(C[0])},                            ${q._numberToFloatStr(C[1])})`;break;case "vec3":B=`vec3(${q._numberToFloatStr(C[0])},                            ${q._numberToFloatStr(C[1])},                            ${q._numberToFloatStr(C[2])})`;
break;case "vec4":B=`vec4(${q._numberToFloatStr(C[0])},                            ${q._numberToFloatStr(C[1])},                            ${q._numberToFloatStr(C[2])},                            ${q._numberToFloatStr(C[3])})`;break;case "ivec2":B=`ivec2(${q._numberToIntStr(C[0])},                             ${q._numberToIntStr(C[1])})`;break;case "ivec3":B=`ivec3(${q._numberToIntStr(C[0])},                             ${q._numberToIntStr(C[1])},                             ${q._numberToIntStr(C[2])})`;
break;case "ivec4":B=`ivec4(${q._numberToIntStr(C[0])},                             ${q._numberToIntStr(C[1])},                             ${q._numberToIntStr(C[2])},                             ${q._numberToIntStr(C[3])})`;break;case "mat2":case "mat3":case "mat4":B=`${z}(${Array.prototype.map.call(C,A=>q._numberToFloatStr(A)).join(", ")})`}this._entries.add(`const ${z} ${p} = ${B};`);return this};q._numberToIntStr=function(p){return p.toFixed(0)};q._numberToFloatStr=function(p){return Number.isInteger(p)?
p.toFixed(1):p.toString()};k.generateSource=function(){return Array.from(this._entries)};return q}();a.Code=f;a.Includes=t;a.ShaderBuilder=m;a.Stage=e;a.Uniforms=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../shaderLibrary/util/WebGL2Utils ./Float2PassUniform ./TextureSizeUniformType ./Uniform ../shaderTechnique/BindType".split(" "),
function(a,c,b,t,n,r,m,d,f,e){let g=function(l){function v(q,k){return l.call(this,q,"sampler2D",e.BindType.Pass,(p,z,C)=>p.bindTexture(q,k(z,C)))||this}c._inheritsLoose(v,l);return v}(f.Uniform);const h=n.create();a.Texture2DPassUniform=g;a.createTexture2DPassSizeUniforms=function(l,v,q=d.TextureSizeUniformType.None){const k=[new g(l,v)];q&d.TextureSizeUniformType.Size&&k.push(new m.Float2PassUniform(l+r.TEXTURE_SIZE_UNIFORM_SUFFIX,(p,z)=>{p=v(p,z);return b.isSome(p)?t.set(h,p.descriptor.width,p.descriptor.height):
n.ZEROS}));q&d.TextureSizeUniformType.InvSize&&k.push(new m.Float2PassUniform(l+r.TEXTURE_INVERSE_SIZE_UNIFORM_SUFFIX,(p,z)=>{p=v(p,z);return b.isSome(p)?t.set(h,1/p.descriptor.width,1/p.descriptor.height):n.ZEROS}));return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/WebGL2Utils":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.TEXTURE_INVERSE_SIZE_UNIFORM_SUFFIX="InvSize";a.TEXTURE_SIZE_UNIFORM_SUFFIX=
"Size";a.texelFetch=function(b,t,n,r=null,m=0){if(b.hasWebGL2Context)return c.glsl`texelFetch(${t}, ivec2(${n}), ${c.glsl.int(m)})`;b=c.glsl`texture2D(${t}, ${n} * `;return b=r?b+c.glsl`(${r}))`:b+c.glsl`${t+"InvSize"})`};a.textureSize=function(b,t,n=!1,r=0){return b.hasWebGL2Context?(b=c.glsl`vec2(textureSize(${t}, ${c.glsl.int(r)}))`,n?"(1.0 / "+b+")":b):n?t+"InvSize":t+"Size"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureSizeUniformType":function(){define(["exports"],
function(a){a.TextureSizeUniformType=void 0;var c=a.TextureSizeUniformType||(a.TextureSizeUniformType={});c[c.None=0]="None";c[c.Size=1]="Size";c[c.InvSize=2]="InvSize";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(r,m){this._module=r;this._loadModule=m}var n=t.prototype;n.get=function(){return this._module};
n.reload=function(){var r=c._asyncToGenerator(function*(){return this._module=yield this._loadModule()});return function(){return r.apply(this,arguments)}}();return t}();a.ReloadableShaderModule=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../webgl/enums"],function(a,c,b,t){let n=function(){function r(d,
f,e){this.release=e;this.initializeConfiguration(d,f);this._configuration=f.snapshot();this._program=this.initializeProgram(d);this._pipeline=this.initializePipeline(d.rctx.capabilities)}var m=r.prototype;m.destroy=function(){this._program=b.disposeMaybe(this._program);this._pipeline=this._configuration=null};m.reload=function(d){b.disposeMaybe(this._program);this._program=this.initializeProgram(d);this._pipeline=this.initializePipeline(d.rctx.capabilities)};m.bindPipelineState=function(d,f=null,
e){d.setPipelineState(this.getPipelineState(f,e))};m.ensureAttributeLocations=function(d){this.program.assertCompatibleVertexAttributeLocations(d)};m.getPipelineState=function(d,f){return this._pipeline};m.initializeConfiguration=function(d,f){};c._createClass(r,[{key:"program",get:function(){return this._program}},{key:"compiled",get:function(){return this.program.compiled}},{key:"key",get:function(){return this._configuration.key}},{key:"configuration",get:function(){return this._configuration}},
{key:"primitiveType",get:function(){return t.PrimitiveType.TRIANGLES}}]);return r}();a.ShaderTechnique=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/enums":function(){define(["exports"],function(a){a.ClearBufferBit=void 0;(function(c){c[c.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";c[c.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";c[c.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=void 0;(function(c){c[c.POINTS=
0]="POINTS";c[c.LINES=1]="LINES";c[c.LINE_LOOP=2]="LINE_LOOP";c[c.LINE_STRIP=3]="LINE_STRIP";c[c.TRIANGLES=4]="TRIANGLES";c[c.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";c[c.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType={}));a.BlendFactor=void 0;(function(c){c[c.ZERO=0]="ZERO";c[c.ONE=1]="ONE";c[c.SRC_COLOR=768]="SRC_COLOR";c[c.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";c[c.SRC_ALPHA=770]="SRC_ALPHA";c[c.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";c[c.DST_ALPHA=772]="DST_ALPHA";
c[c.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";c[c.DST_COLOR=774]="DST_COLOR";c[c.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";c[c.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";c[c.CONSTANT_COLOR=32769]="CONSTANT_COLOR";c[c.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR";c[c.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";c[c.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(c){c[c.ADD=32774]="ADD";c[c.SUBTRACT=
32778]="SUBTRACT";c[c.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=void 0;(function(c){c[c.ARRAY_BUFFER=34962]="ARRAY_BUFFER";c[c.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";c[c.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER";c[c.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";c[c.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";c[c.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";c[c.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"})(a.BufferType||(a.BufferType=
{}));a.Face=void 0;(function(c){c[c.FRONT=1028]="FRONT";c[c.BACK=1029]="BACK";c[c.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(c){c[c.CW=2304]="CW";c[c.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=void 0;(function(c){c[c.BYTE=5120]="BYTE";c[c.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";c[c.SHORT=5122]="SHORT";c[c.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";c[c.INT=5124]="INT";c[c.UNSIGNED_INT=5125]="UNSIGNED_INT";c[c.FLOAT=5126]="FLOAT"})(a.DataType||(a.DataType=
{}));a.CompareFunction=void 0;(function(c){c[c.NEVER=512]="NEVER";c[c.LESS=513]="LESS";c[c.EQUAL=514]="EQUAL";c[c.LEQUAL=515]="LEQUAL";c[c.GREATER=516]="GREATER";c[c.NOTEQUAL=517]="NOTEQUAL";c[c.GEQUAL=518]="GEQUAL";c[c.ALWAYS=519]="ALWAYS"})(a.CompareFunction||(a.CompareFunction={}));a.StencilOperation=void 0;(function(c){c[c.ZERO=0]="ZERO";c[c.KEEP=7680]="KEEP";c[c.REPLACE=7681]="REPLACE";c[c.INCR=7682]="INCR";c[c.DECR=7683]="DECR";c[c.INVERT=5386]="INVERT";c[c.INCR_WRAP=34055]="INCR_WRAP";c[c.DECR_WRAP=
34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(c){c[c.NEAREST=9728]="NEAREST";c[c.LINEAR=9729]="LINEAR";c[c.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";c[c.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST";c[c.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";c[c.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode={}));a.TextureWrapMode=void 0;(function(c){c[c.CLAMP_TO_EDGE=33071]=
"CLAMP_TO_EDGE";c[c.REPEAT=10497]="REPEAT";c[c.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode={}));a.TextureType=void 0;(function(c){c[c.TEXTURE_2D=3553]="TEXTURE_2D";c[c.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";c[c.TEXTURE_3D=32879]="TEXTURE_3D";c[c.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";c[c.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";c[c.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";c[c.TEXTURE_CUBE_MAP_NEGATIVE_Y=
34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";c[c.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";c[c.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";c[c.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType={}));a.PixelFormat=void 0;(function(c){c[c.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";c[c.DEPTH_STENCIL=34041]="DEPTH_STENCIL";c[c.ALPHA=6406]="ALPHA";c[c.RGB=6407]="RGB";c[c.RGBA=6408]="RGBA";c[c.LUMINANCE=6409]="LUMINANCE";c[c.LUMINANCE_ALPHA=6410]=
"LUMINANCE_ALPHA";c[c.RED=6403]="RED";c[c.RG=33319]="RG";c[c.RED_INTEGER=36244]="RED_INTEGER";c[c.RG_INTEGER=33320]="RG_INTEGER";c[c.RGB_INTEGER=36248]="RGB_INTEGER";c[c.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=void 0;(function(c){c[c.RGBA4=32854]="RGBA4";c[c.R16F=33325]="R16F";c[c.RG16F=33327]="RG16F";c[c.RGB32F=34837]="RGB32F";c[c.RGBA16F=34842]="RGBA16F";c[c.R32F=33326]="R32F";c[c.RG32F=33328]="RG32F";c[c.RGBA32F=34836]="RGBA32F";c[c.R11F_G11F_B10F=
35898]="R11F_G11F_B10F";c[c.RGB8=32849]="RGB8";c[c.RGBA8=32856]="RGBA8";c[c.RGB5_A1=32855]="RGB5_A1";c[c.R8=33321]="R8";c[c.RG8=33323]="RG8";c[c.R8I=33329]="R8I";c[c.R8UI=33330]="R8UI";c[c.R16I=33331]="R16I";c[c.R16UI=33332]="R16UI";c[c.R32I=33333]="R32I";c[c.R32UI=33334]="R32UI";c[c.RG8I=33335]="RG8I";c[c.RG8UI=33336]="RG8UI";c[c.RG16I=33337]="RG16I";c[c.RG16UI=33338]="RG16UI";c[c.RG32I=33339]="RG32I";c[c.RG32UI=33340]="RG32UI";c[c.RGB16F=34843]="RGB16F";c[c.RGB9_E5=35901]="RGB9_E5";c[c.SRGB8=35905]=
"SRGB8";c[c.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";c[c.RGB565=36194]="RGB565";c[c.RGBA32UI=36208]="RGBA32UI";c[c.RGB32UI=36209]="RGB32UI";c[c.RGBA16UI=36214]="RGBA16UI";c[c.RGB16UI=36215]="RGB16UI";c[c.RGBA8UI=36220]="RGBA8UI";c[c.RGB8UI=36221]="RGB8UI";c[c.RGBA32I=36226]="RGBA32I";c[c.RGB32I=36227]="RGB32I";c[c.RGBA16I=36232]="RGBA16I";c[c.RGB16I=36233]="RGB16I";c[c.RGBA8I=36238]="RGBA8I";c[c.RGB8I=36239]="RGB8I";c[c.R8_SNORM=36756]="R8_SNORM";c[c.RG8_SNORM=36757]="RG8_SNORM";c[c.RGB8_SNORM=36758]="RGB8_SNORM";
c[c.RGBA8_SNORM=36759]="RGBA8_SNORM";c[c.RGB10_A2=32857]="RGB10_A2";c[c.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||(a.SizedPixelFormat={}));a.PixelType=void 0;(function(c){c[c.FLOAT=5126]="FLOAT";c[c.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";c[c.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8";c[c.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";c[c.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";c[c.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";c[c.BYTE=5120]="BYTE";c[c.UNSIGNED_SHORT=
5123]="UNSIGNED_SHORT";c[c.SHORT=5122]="SHORT";c[c.UNSIGNED_INT=5125]="UNSIGNED_INT";c[c.INT=5124]="INT";c[c.HALF_FLOAT=5131]="HALF_FLOAT";c[c.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";c[c.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";c[c.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";c[c.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(c){c[c.DEPTH_COMPONENT16=
33189]="DEPTH_COMPONENT16";c[c.STENCIL_INDEX8=36168]="STENCIL_INDEX8";c[c.DEPTH_STENCIL=34041]="DEPTH_STENCIL";c[c.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";c[c.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";c[c.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";c[c.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=void 0;(function(c){c[c.STATIC_DRAW=35044]="STATIC_DRAW";c[c.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";c[c.STREAM_DRAW=35040]="STREAM_DRAW";c[c.STATIC_READ=
35045]="STATIC_READ";c[c.DYNAMIC_READ=35049]="DYNAMIC_READ";c[c.STREAM_READ=35041]="STREAM_READ";c[c.STATIC_COPY=35046]="STATIC_COPY";c[c.DYNAMIC_COPY=35050]="DYNAMIC_COPY";c[c.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(c){c[c.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER";c[c.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||(a.ShaderType={}));a.FramebufferTarget=void 0;(function(c){c[c.FRAMEBUFFER=36160]="FRAMEBUFFER";c[c.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";
c[c.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget={}));a.TargetType=void 0;(function(c){c[c.TEXTURE=0]="TEXTURE";c[c.RENDER_BUFFER=1]="RENDER_BUFFER";c[c.CUBEMAP=2]="CUBEMAP"})(a.TargetType||(a.TargetType={}));a.DepthStencilTargetType=void 0;(function(c){c[c.NONE=0]="NONE";c[c.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER";c[c.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER";c[c.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER";c[c.DEPTH_STENCIL_TEXTURE=
4]="DEPTH_STENCIL_TEXTURE"})(a.DepthStencilTargetType||(a.DepthStencilTargetType={}));a.ResourceType=void 0;(function(c){c[c.Texture=0]="Texture";c[c.BufferObject=1]="BufferObject";c[c.VertexArrayObject=2]="VertexArrayObject";c[c.Shader=3]="Shader";c[c.Program=4]="Program";c[c.FramebufferObject=5]="FramebufferObject";c[c.Renderbuffer=6]="Renderbuffer";c[c.Sync=7]="Sync";c[c.COUNT=8]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(c){c[c.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";
c[c.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";c[c.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";c[c.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";c[c.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";c[c.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";c[c.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6";c[c.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";c[c.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";c[c.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";c[c.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";c[c.COLOR_ATTACHMENT11=
36075]="COLOR_ATTACHMENT11";c[c.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";c[c.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";c[c.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";c[c.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||(a.ColorAttachment={}));a.CompressedTextureFormat=void 0;(function(c){c[c.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";c[c.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";c[c.COMPRESSED_RGBA_S3TC_DXT3_EXT=
33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";c[c.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";c[c.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";c[c.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";c[c.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC";c[c.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC";c[c.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";c[c.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";c[c.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=
37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";c[c.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";c[c.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";c[c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(c){c[c.FLOAT=5126]="FLOAT";c[c.FLOAT_VEC2=35664]="FLOAT_VEC2";c[c.FLOAT_VEC3=35665]="FLOAT_VEC3";c[c.FLOAT_VEC4=35666]=
"FLOAT_VEC4";c[c.INT=5124]="INT";c[c.INT_VEC2=35667]="INT_VEC2";c[c.INT_VEC3=35668]="INT_VEC3";c[c.INT_VEC4=35669]="INT_VEC4";c[c.BOOL=35670]="BOOL";c[c.BOOL_VEC2=35671]="BOOL_VEC2";c[c.BOOL_VEC3=35672]="BOOL_VEC3";c[c.BOOL_VEC4=35673]="BOOL_VEC4";c[c.FLOAT_MAT2=35674]="FLOAT_MAT2";c[c.FLOAT_MAT3=35675]="FLOAT_MAT3";c[c.FLOAT_MAT4=35676]="FLOAT_MAT4";c[c.SAMPLER_2D=35678]="SAMPLER_2D";c[c.SAMPLER_CUBE=35680]="SAMPLER_CUBE";c[c.UNSIGNED_INT=5125]="UNSIGNED_INT";c[c.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";
c[c.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";c[c.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";c[c.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";c[c.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";c[c.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";c[c.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";c[c.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";c[c.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";c[c.SAMPLER_3D=35679]="SAMPLER_3D";c[c.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";c[c.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";c[c.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";
c[c.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";c[c.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D";c[c.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";c[c.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";c[c.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";c[c.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";c[c.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D";c[c.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";c[c.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||
(a.UniformType={}));a.SyncParameter=void 0;(function(c){c[c.OBJECT_TYPE=37138]="OBJECT_TYPE";c[c.SYNC_CONDITION=37139]="SYNC_CONDITION";c[c.SYNC_STATUS=37140]="SYNC_STATUS";c[c.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||(a.SyncParameter={}));a.SyncStatus=void 0;(function(c){c[c.UNSIGNALED=37144]="UNSIGNALED";c[c.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(c){c[c.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";c[c.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";
c[c.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";c[c.WAIT_FAILED=37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(c){c[c.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=void 0;(function(c){c[c.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.BASE_TEXTURE_UNIT=33984;a.DepthStencilAttachment=33306;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports","./VertexAttribute"],function(a,c){c=new Map([[c.VertexAttribute.POSITION,0],[c.VertexAttribute.NORMAL,1],[c.VertexAttribute.UV0,2],[c.VertexAttribute.COLOR,3],[c.VertexAttribute.SIZE,4],[c.VertexAttribute.TANGENT,4],[c.VertexAttribute.AUXPOS1,5],[c.VertexAttribute.SYMBOLCOLOR,5],[c.VertexAttribute.AUXPOS2,6],[c.VertexAttribute.FEATUREATTRIBUTE,6],[c.VertexAttribute.INSTANCEFEATUREATTRIBUTE,
6],[c.VertexAttribute.INSTANCECOLOR,7],[c.VertexAttribute.OBJECTANDLAYERIDCOLOR,7],[c.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED,7],[c.VertexAttribute.MODEL,8],[c.VertexAttribute.MODELNORMAL,12],[c.VertexAttribute.MODELORIGINHI,11],[c.VertexAttribute.MODELORIGINLO,15]]);a.Default3D=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Program":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../core/shaderTechnique/BindType ../../../webgl/checkWebGLError".split(" "),
function(a,c,b,t,n,r){let m=function(){function d(e,g,h){this._context=e;this._locations=h;this._textures=new Map;this._freeTextureUnits=new t({deallocator:null});this._glProgram=e.programCache.acquire(g.generate("vertex"),g.generate("fragment"),h);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=g.generateBind(n.BindType.Pass,this);this.bindDraw=g.generateBind(n.BindType.Draw,this);this._fragmentUniforms=r.webglDebugEnabled()?g.fragmentUniforms:null}var f=
d.prototype;f.dispose=function(){this._glProgram.dispose()};f.setUniform1b=function(e,g){this._glProgram.setUniform1i(e,g?1:0)};f.setUniform1i=function(e,g){this._glProgram.setUniform1i(e,g)};f.setUniform1f=function(e,g){this._glProgram.setUniform1f(e,g)};f.setUniform2fv=function(e,g){this._glProgram.setUniform2fv(e,g)};f.setUniform3fv=function(e,g){this._glProgram.setUniform3fv(e,g)};f.setUniform4fv=function(e,g){this._glProgram.setUniform4fv(e,g)};f.setUniformMatrix3fv=function(e,g){this._glProgram.setUniformMatrix3fv(e,
g)};f.setUniformMatrix4fv=function(e,g){this._glProgram.setUniformMatrix4fv(e,g)};f.setUniform1fv=function(e,g){this._glProgram.setUniform1fv(e,g)};f.setUniform1iv=function(e,g){this._glProgram.setUniform1iv(e,g)};f.setUniform2iv=function(e,g){this._glProgram.setUniform3iv(e,g)};f.setUniform3iv=function(e,g){this._glProgram.setUniform3iv(e,g)};f.setUniform4iv=function(e,g){this._glProgram.setUniform4iv(e,g)};f.assertCompatibleVertexAttributeLocations=function(e){e.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")};
f.stop=function(){this._textures.clear();this._freeTextureUnits.clear()};f.bindTexture=function(e,g){if(b.isNone(g)||null==g.glName){if(g=this._textures.get(e))this._context.bindTexture(null,g.unit),this._freeTextureUnit(g),this._textures.delete(e);return null}let h=this._textures.get(e);null==h?(h=this._allocTextureUnit(g),this._textures.set(e,h)):h.texture=g;this._context.useProgram(this);this.setUniform1i(e,h.unit);this._context.bindTexture(g,h.unit);return h.unit};f.rebindTextures=function(){this._context.useProgram(this);
this._textures.forEach((e,g)=>{this._context.bindTexture(e.texture,e.unit);this.setUniform1i(g,e.unit)});b.isSome(this._fragmentUniforms)&&this._fragmentUniforms.forEach(e=>{"sampler2D"!==e.type&&"samplerCube"!==e.type||this._textures.has(e.name)||console.error(`Texture sampler ${e.name} has no bound texture`)})};f._allocTextureUnit=function(e){return{texture:e,unit:0===this._freeTextureUnits.length?this._textures.size:this._freeTextureUnits.pop()}};f._freeTextureUnit=function(e){this._freeTextureUnits.push(e.unit)};
c._createClass(d,[{key:"glName",get:function(){return this._glProgram.glName}},{key:"compiled",get:function(){return this._glProgram.compiled}}]);return d}();a.Program=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],function(a,c,b,t){function n(d,f){switch(f){case d.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";
case d.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case d.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case d.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";case d.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case d.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";
default:return"Unknown error"}}const r=t.getLogger("esri.views.webgl.checkWebGLError"),m=!!b("enable-feature:webgl-debug");a.checkWebGLError=function(d){if(m){const f=d.getError();f&&(d=n(d,f),r.error(new c("webgl-error","WebGL error occured",{message:d,stack:Error().stack})))}};a.hasFeatureFlagWebGLDebug=m;a.webglDebugEnabled=function(){return m};a.webglValidateShadersEnabled=function(){return m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/renderState":function(){define(["exports",
"../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,c,b){function t(P){return y.intern(P)}function n(P){return w.intern(P)}function r(P){return D.intern(P)}function m(P){return F.intern(P)}function d(P){return E.intern(P)}function f(P){return K.intern(P)}function e(P){return J.intern(P)}function g(P){return M.intern(P)}function h(P){return"["+P.join(",")+"]"}function l(P){return P?h([P.srcRgb,P.srcAlpha,P.dstRgb,P.dstAlpha,P.opRgb,P.opAlpha,P.color.r,P.color.g,P.color.b,P.color.a]):null}
function v(P){return P?h([P.face,P.mode]):null}function q(P){return P?h([P.factor,P.units]):null}function k(P){return P?h([P.func]):null}function p(P){return P?h([P.function.func,P.function.ref,P.function.mask,P.operation.fail,P.operation.zFail,P.operation.zPass]):null}function z(P){return P?h([P.zNear,P.zFar]):null}function C(P){return P?h([P.r,P.g,P.b,P.a]):null}function B(P){return P?h([P.mask]):null}const A={face:b.Face.BACK,mode:b.CullMode.CCW},x={face:b.Face.FRONT,mode:b.CullMode.CCW};var u=
function(){function P(I,G){this._makeKey=I;this._makeRef=G;this._interns=new Map}P.prototype.intern=function(I){if(!I)return null;const G=this._makeKey(I),H=this._interns;H.has(G)||H.set(G,this._makeRef(I));return H.get(G)??null};return P}();const y=new u(l,P=>({__tag:"Blending",...P})),w=new u(v,P=>({__tag:"Culling",...P})),D=new u(q,P=>({__tag:"PolygonOffset",...P})),F=new u(k,P=>({__tag:"DepthTest",...P})),E=new u(p,P=>({__tag:"StencilTest",...P})),K=new u(z,P=>({__tag:"DepthWrite",...P})),J=new u(C,
P=>({__tag:"ColorWrite",...P})),M=new u(B,P=>({__tag:"StencilWrite",...P})),N=new u(function(P){return P?h([l(P.blending),v(P.culling),q(P.polygonOffset),k(P.depthTest),p(P.stencilTest),z(P.depthWrite),C(P.colorWrite),B(P.stencilWrite)]):null},P=>({blending:t(P.blending),culling:n(P.culling),polygonOffset:r(P.polygonOffset),depthTest:m(P.depthTest),stencilTest:d(P.stencilTest),depthWrite:f(P.depthWrite),colorWrite:e(P.colorWrite),stencilWrite:g(P.stencilWrite)}));u=function(){function P(G){this._stencilWriteInvalid=
this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=G}var I=P.prototype;I.setPipeline=function(G){if(this._pipelineInvalid||G!==this._pipeline)this._setBlending(G.blending),this._setCulling(G.culling),this._setPolygonOffset(G.polygonOffset),this._setDepthTest(G.depthTest),this._setStencilTest(G.stencilTest),this._setDepthWrite(G.depthWrite),
this._setColorWrite(G.colorWrite),this._setStencilWrite(G.stencilWrite),this._pipeline=G;this._pipelineInvalid=!1};I.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};I.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};I.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};I.invalidateDepthTest=function(){this._pipelineInvalid=this._depthTestInvalid=!0};I.invalidateStencilTest=function(){this._pipelineInvalid=
this._stencilTestInvalid=!0};I.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};I.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};I.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};I._setBlending=function(G){this._blending=this._setSubState(G,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=!1};I._setCulling=function(G){this._culling=this._setSubState(G,
this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};I._setPolygonOffset=function(G){this._polygonOffset=this._setSubState(G,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};I._setDepthTest=function(G){this._depthTest=this._setSubState(G,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=!1};I._setStencilTest=function(G){this._stencilTest=this._setSubState(G,
this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};I._setDepthWrite=function(G){this._depthWrite=this._setSubState(G,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};I._setColorWrite=function(G){this._colorWrite=this._setSubState(G,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=!1};I._setStencilWrite=function(G){this._stencilWrite=this._setSubState(G,
this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};I._setSubState=function(G,H,L,O){if(L||G!==H)O(G),this._pipelineInvalid=!0;return G};return P}();a.StateTracker=u;a.backFaceCullingParams=A;a.cullingParams=P=>P===c.CullFaceOptions.Back?A:P===c.CullFaceOptions.Front?x:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=x;a.makeBlending=t;a.makeColorWrite=e;a.makeCulling=
n;a.makeDepthTest=m;a.makeDepthWrite=f;a.makePipelineState=function(P){return N.intern(P)};a.makePolygonOffset=r;a.makeStencilTest=d;a.makeStencilWrite=g;a.separateBlendingParams=function(P,I,G,H,L=b.BlendOperation.ADD,O=b.BlendOperation.ADD,S=[0,0,0,0]){return{srcRgb:P,srcAlpha:I,dstRgb:G,dstAlpha:H,opRgb:L,opAlpha:O,color:{r:S[0],g:S[1],b:S[2],a:S[3]}}};a.simpleBlendingParams=function(P,I,G=b.BlendOperation.ADD,H=[0,0,0,0]){return{srcRgb:P,srcAlpha:P,dstRgb:I,dstAlpha:I,opRgb:G,opAlpha:G,color:{r:H[0],
g:H[1],b:H[2],a:H[3]}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(a){a.CullFaceOptions=void 0;(function(c){c[c.None=0]="None";c[c.Front=1]="Front";c[c.Back=2]="Back";c[c.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(c){c[c.Less=0]="Less";c[c.Lequal=1]="Lequal";c[c.COUNT=2]="COUNT"})(a.DepthTestFunction||(a.DepthTestFunction={}));a.RenderRequestType=
void 0;(function(c){c[c.BACKGROUND=0]="BACKGROUND";c[c.UPDATE=1]="UPDATE"})(a.RenderRequestType||(a.RenderRequestType={}));a.ResourceState=void 0;(function(c){c[c.NOT_LOADED=0]="NOT_LOADED";c[c.LOADING=1]="LOADING";c[c.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(c){c[c.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";c[c.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits={}));a.Object3DState=void 0;(function(c){c[c.Highlight=
0]="Highlight";c[c.MaskOccludee=1]="MaskOccludee";c[c.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.PowerOfTwoResizeMode=void 0;(function(c){c[c.STRETCH=1]="STRETCH";c[c.PAD=2]="PAD"})(a.PowerOfTwoResizeMode||(a.PowerOfTwoResizeMode={}));a.ValidationState=void 0;(function(c){c[c.CHANGED=0]="CHANGED";c[c.UNCHANGED=1]="UNCHANGED"})(a.ValidationState||(a.ValidationState={}));a.AlphaDiscardMode=void 0;(function(c){c[c.Blend=0]="Blend";c[c.Opaque=1]="Opaque";c[c.Mask=2]="Mask";c[c.MaskBlend=
3]="MaskBlend";c[c.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.Decorations=void 0;(function(c){c[c.OFF=0]="OFF";c[c.ON=1]="ON"})(a.Decorations||(a.Decorations={}));a.TextureEncodingMimeType=void 0;(function(c){c.DDS_ENCODING="image/vnd-ms.dds";c.KTX2_ENCODING="image/ktx2";c.BASIS_ENCODING="image/x.basis"})(a.TextureEncodingMimeType||(a.TextureEncodingMimeType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,c,b,t){let n=function(r){function m(){var d=r.apply(this,arguments)||this;d.haze=!1;return d}c._inheritsLoose(m,r);return m}(t.ShaderTechniqueConfiguration);b.__decorate([t.parameter()],n.prototype,"haze",void 0);a.ChapmanAtmosphereTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../shaderModules/interfaces"],function(a,c,b){b=function(t){function n(){var r=t.call(this)||this;r._key="";r._keyDirty=!1;r._parameterBits=r._parameterBits?r._parameterBits.map(()=>0):[];r._parameterNames||(r._parameterNames=[]);return r}c._inheritsLoose(n,t);n.prototype.snapshot=function(){const r=this._parameterNames,m={key:this.key};for(const d of r)m[d]=this[d];return m};c._createClass(n,[{key:"key",get:function(){this._keyDirty&&(this._keyDirty=
!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return n}(b.NoParameters);a.ShaderTechniqueConfiguration=b;a.parameter=function(t={}){return(n,r)=>{n._parameterNames=n._parameterNames??[];n._parameterNames.push(r);if(null!=t.constValue)Object.defineProperty(n,r,{get(){return t.constValue}});else{const m=n._parameterNames.length-1,d=Math.ceil(Math.log2(t.count||2)),f=n._parameterBits??[0];let e=0;for(;16<f[e]+d;)e++,e>=f.length&&f.push(0);n._parameterBits=f;
const g=f[e],h=(1<<d)-1<<g;f[e]+=d;Object.defineProperty(n,r,{get(){return this[m]},set(l){if(this[m]!==l&&(this[m]=l,this._keyDirty=!0,this._parameterBits[e]=this._parameterBits[e]&~h|+l<<g&h,"number"!==typeof l&&"boolean"!==typeof l))throw Error("Configuration value for "+r+" must be boolean or number, got "+typeof l);}})}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports","./VertexAttribute",
"../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,c,b,t){const n=[new t.VertexElementDescriptor(c.VertexAttribute.POSITION,3,b.DataType.FLOAT,0,12)],r=[new t.VertexElementDescriptor(c.VertexAttribute.POSITION,3,b.DataType.FLOAT,0,20),new t.VertexElementDescriptor(c.VertexAttribute.UV0,2,b.DataType.FLOAT,12,20)],m=[new t.VertexElementDescriptor(c.VertexAttribute.POSITION,3,b.DataType.FLOAT,0,32),new t.VertexElementDescriptor(c.VertexAttribute.NORMAL,3,b.DataType.FLOAT,12,
32),new t.VertexElementDescriptor(c.VertexAttribute.UV0,2,b.DataType.FLOAT,24,32)],d=[new t.VertexElementDescriptor(c.VertexAttribute.POSITION,3,b.DataType.FLOAT,0,16),new t.VertexElementDescriptor(c.VertexAttribute.COLOR,4,b.DataType.UNSIGNED_BYTE,12,16)],f=[new t.VertexElementDescriptor(c.VertexAttribute.POSITION,2,b.DataType.FLOAT,0,8)];c=[new t.VertexElementDescriptor(c.VertexAttribute.POSITION,2,b.DataType.FLOAT,0,16),new t.VertexElementDescriptor(c.VertexAttribute.UV0,2,b.DataType.FLOAT,8,16)];
a.Pos2=f;a.Pos2Tex=c;a.Pos3=n;a.Pos3Col=d;a.Pos3NormalTex=m;a.Pos3Tex=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(a){a.VertexElementDescriptor=function(c,b,t,n,r,m=!1,d=0){this.name=c;this.count=b;this.type=t;this.offset=n;this.stride=r;this.normalized=m;this.divisor=d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./VertexArrayObject ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,c,b,t,n,r,m){a.createColorTexture=function(d,f,e=4){const g=new Uint8Array(e*e*4);for(let h=0;h<g.length;h+=4)g[h+0]=255*f[0],g[h+1]=255*f[1],g[h+2]=255*f[2],g[h+3]=255*f[3];return new m.Texture(d,{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.NEAREST,width:e,height:e},g)};a.createEmptyDepthTexture=function(d){return new m.Texture(d,{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,
samplingMode:r.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))};a.createEmptyTexture=function(d,f=4){return new m.Texture(d,{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.NEAREST,width:f,height:f})};a.createQuadVAO=function(d,f=b.Pos2,e=c.Default3D,g=-1,h=1){let l=null;switch(f){case b.Pos2Tex:l=new Float32Array([g,g,0,0,h,g,1,0,g,h,0,1,h,h,1,1]);break;default:l=new Float32Array([g,
g,h,g,g,h,h,h])}return new t.VertexArrayObject(d,e,{geometry:f},{geometry:n.BufferObject.createVertex(d,r.Usage.STATIC_DRAW,l)})};a.createScreenSizeTriangleVAO=function(d,f=b.Pos2,e=c.Default3D){const g=new Float32Array([-1,-1,3,-1,-1,3]);return new t.VertexArrayObject(d,e,{geometry:f},{geometry:n.BufferObject.createVertex(d,r.Usage.STATIC_DRAW,g)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/VertexArrayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../webgl/VertexArrayObject"],function(a,c,b){b=function(t){function n(){return t.apply(this,arguments)||this}c._inheritsLoose(n,t);return n}(b.VertexArrayObject);a.VertexArrayObject=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./enums ./Util".split(" "),function(a,c,b,t,n,r){const m=b.getLogger("esri.views.webgl.VertexArrayObject");b=
function(){function d(e,g,h,l,v=null){this._context=e;this._locations=g;this._layout=h;this._buffers=l;this._indexBuffer=v;this._glName=null;this._initialized=!1;e.instanceCounter.increment(n.ResourceType.VertexArrayObject,this)}var f=d.prototype;f.dispose=function(e=!0){if(this._context){if(this._glName){const g=this._context?.capabilities?.vao;g?(g.deleteVertexArray(this._glName),this._glName=null):m.warn("Leaked WebGL VAO")}this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(e){for(const g in this._buffers)this._buffers[g]?.dispose(),
delete this._buffers[g];this._indexBuffer=t.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(n.ResourceType.VertexArrayObject,this);this._context=t.nullifyNonNullableForDispose(this._context)}else(this._glName||e&&0<Object.getOwnPropertyNames(this._buffers).length)&&m.warn("Leaked WebGL VAO")};f.initialize=function(){if(!this._initialized){var e=this._context.capabilities.vao;if(e){const g=e.createVertexArray();e.bindVertexArray(g);this._bindLayout();e.bindVertexArray(null);
this._glName=g}this._initialized=!0}};f.bind=function(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};f._bindLayout=function(){const {_buffers:e,_layout:g,_indexBuffer:h}=this;e||m.error("Vertex buffer dictionary is empty!");const l=this._context.gl;for(const v in e){const q=e[v];q||m.error("Vertex buffer is uninitialized!");const k=g[v];k||m.error("Vertex element descriptor is empty!");r.bindVertexBufferLayout(this._context,
this._locations,q,k)}t.isSome(h)&&(this._context.capabilities.vao?l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,h.glName):this._context.bindBuffer(h))};f.unbind=function(){this.initialize();const e=this._context.capabilities.vao;e?e.bindVertexArray(null):this._unbindLayout()};f._unbindLayout=function(){const {_buffers:e,_layout:g}=this;e||m.error("Vertex buffer dictionary is empty!");for(const h in e){const l=e[h];l||m.error("Vertex buffer is uninitialized!");r.unbindVertexBufferLayout(this._context,this._locations,
l,g[h])}t.isSome(this._indexBuffer)&&this._context.unbindBuffer(this._indexBuffer.bufferType)};c._createClass(d,[{key:"glName",get:function(){return this._glName}},{key:"context",get:function(){return this._context}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((e,g)=>e+this._buffers[g].size,t.isSome(this._indexBuffer)?this._indexBuffer.size:0)}},{key:"layout",
get:function(){return this._layout}},{key:"locations",get:function(){return this._locations}}]);return d}();a.VertexArrayObject=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","../../core/maybe","./enums"],function(a,c,b,t){function n(d){return d[0].stride}function r(d){switch(d){case t.PixelFormat.ALPHA:case t.PixelFormat.LUMINANCE:case t.PixelFormat.RED:case t.PixelFormat.RED_INTEGER:case t.SizedPixelFormat.R8:case t.SizedPixelFormat.R8I:case t.SizedPixelFormat.R8UI:case t.SizedPixelFormat.R8_SNORM:case t.RenderbufferFormat.STENCIL_INDEX8:return 1;
case t.PixelFormat.LUMINANCE_ALPHA:case t.PixelFormat.RG:case t.PixelFormat.RG_INTEGER:case t.SizedPixelFormat.RGBA4:case t.SizedPixelFormat.R16F:case t.SizedPixelFormat.R16I:case t.SizedPixelFormat.R16UI:case t.SizedPixelFormat.RG8:case t.SizedPixelFormat.RG8I:case t.SizedPixelFormat.RG8UI:case t.SizedPixelFormat.RG8_SNORM:case t.SizedPixelFormat.RGB565:case t.SizedPixelFormat.RGB5_A1:case t.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case t.PixelFormat.DEPTH_COMPONENT:case t.PixelFormat.RGB:case t.PixelFormat.RGB_INTEGER:case t.SizedPixelFormat.RGB8:case t.SizedPixelFormat.RGB8I:case t.SizedPixelFormat.RGB8UI:case t.SizedPixelFormat.RGB8_SNORM:case t.SizedPixelFormat.SRGB8:case t.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case t.PixelFormat.DEPTH_STENCIL:case t.PixelFormat.RGBA:case t.PixelFormat.RGBA_INTEGER:case t.SizedPixelFormat.RGBA8:case t.SizedPixelFormat.R32F:case t.SizedPixelFormat.R11F_G11F_B10F:case t.SizedPixelFormat.RG16F:case t.SizedPixelFormat.R32I:case t.SizedPixelFormat.R32UI:case t.SizedPixelFormat.RG16I:case t.SizedPixelFormat.RG16UI:case t.SizedPixelFormat.RGBA8I:case t.SizedPixelFormat.RGBA8UI:case t.SizedPixelFormat.RGBA8_SNORM:case t.SizedPixelFormat.SRGB8_ALPHA8:case t.SizedPixelFormat.RGB9_E5:case t.SizedPixelFormat.RGB10_A2UI:case t.SizedPixelFormat.RGB10_A2:case t.RenderbufferFormat.DEPTH_STENCIL:case t.RenderbufferFormat.DEPTH_COMPONENT32F:case t.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case t.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case t.SizedPixelFormat.RGB16F:case t.SizedPixelFormat.RGB16I:case t.SizedPixelFormat.RGB16UI:return 6;case t.SizedPixelFormat.RG32F:case t.SizedPixelFormat.RG32I:case t.SizedPixelFormat.RG32UI:case t.SizedPixelFormat.RGBA16F:case t.SizedPixelFormat.RGBA16I:case t.SizedPixelFormat.RGBA16UI:return 8;case t.SizedPixelFormat.RGB32F:case t.SizedPixelFormat.RGB32I:case t.SizedPixelFormat.RGB32UI:return 12;case t.SizedPixelFormat.RGBA32F:case t.SizedPixelFormat.RGBA32I:case t.SizedPixelFormat.RGBA32UI:return 16;
case t.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case t.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case t.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case t.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case t.CompressedTextureFormat.COMPRESSED_R11_EAC:case t.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case t.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case t.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case t.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case t.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case t.CompressedTextureFormat.COMPRESSED_RG11_EAC:case t.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case t.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case t.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function m(d){if(b.isNone(d))return 0;if("descriptor"in d)return d.glName?m(d.descriptor):0;const f=d.internalFormat||"pixelFormat"in d&&d.pixelFormat;if(!f)return 0;const e="hasMipmap"in d&&d.hasMipmap?1.3:1;d=d.width*d.height;return r(f)*d*e}a.bindVertexBufferLayout=
function(d,f,e,g,h=0){const l=d.gl,v=d.capabilities.instancing;d.bindBuffer(e);for(const q of g)if(d=f.get(q.name),void 0===d&&console.error(`There is no location for vertex attribute '${q.name}' defined.`),e=h*q.stride,4>=q.count)l.vertexAttribPointer(d,q.count,q.type,q.normalized,q.stride,q.offset+e),l.enableVertexAttribArray(d),0<q.divisor&&v&&v.vertexAttribDivisor(d,q.divisor);else if(9===q.count)for(g=0;3>g;g++)l.vertexAttribPointer(d+g,3,q.type,q.normalized,q.stride,q.offset+12*g+e),l.enableVertexAttribArray(d+
g),0<q.divisor&&v&&v.vertexAttribDivisor(d+g,q.divisor);else if(16===q.count)for(g=0;4>g;g++)l.vertexAttribPointer(d+g,4,q.type,q.normalized,q.stride,q.offset+16*g+e),l.enableVertexAttribArray(d+g),0<q.divisor&&v&&v.vertexAttribDivisor(d+g,q.divisor);else console.error("Unsupported vertex attribute element count: "+q.count)};a.getBytesPerElementFormat=r;a.getErrorString=function(d){d=d.gl;switch(d.getError()){case d.NO_ERROR:return null;case d.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";
case d.INVALID_VALUE:return"An unacceptable value has been specified for an argument";case d.INVALID_OPERATION:return"The specified command is not allowed for the current state";case d.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case d.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case d.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"};a.getGpuMemoryUsage=m;a.getStride=n;a.unbindVertexBufferLayout=
function(d,f,e,g){const h=d.gl,l=d.capabilities.instancing;d.bindBuffer(e);for(const v of g)if(e=f.get(v.name),4>=v.count)h.disableVertexAttribArray(e),v.divisor&&0<v.divisor&&l&&l.vertexAttribDivisor(e,0);else if(9===v.count)for(g=0;3>g;g++)h.disableVertexAttribArray(e+g),v.divisor&&0<v.divisor&&l&&l.vertexAttribDivisor(e+g,0);else if(16===v.count)for(g=0;4>g;g++)h.disableVertexAttribArray(e+g),v.divisor&&0<v.divisor&&l&&l.vertexAttribDivisor(e+g,0);else console.error("Unsupported vertex attribute element count: "+
v.count);d.unbindBuffer(t.BufferType.ARRAY_BUFFER)};a.vertexCount=function(d,f){return d.vertexBuffers[f].size/n(d.layout[f])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/BufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./checkWebGLError ./context-util ./enums".split(" "),function(a,c,b,t,n,r,m,d,f){const e=t.getLogger("esri.views.webgl.BufferObject");
t=function(){function g(l,v,q,k){this._context=l;this.bufferType=v;this.usage=q;this._glName=null;this._size=-1;this._indexType=void 0;l.instanceCounter.increment(f.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();m.checkWebGLError(this._context.gl);k&&this.setData(k)}g.createIndex=function(l,v,q){return new g(l,f.BufferType.ELEMENT_ARRAY_BUFFER,v,q)};g.createVertex=function(l,v,q){return new g(l,f.BufferType.ARRAY_BUFFER,v,q)};g.createUniform=function(l,v,q){if(l.type!==
d.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");return new g(l,f.BufferType.UNIFORM_BUFFER,v,q)};g.createPixelPack=function(l,v=f.Usage.STREAM_READ,q){if(l.type!==d.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");l=new g(l,f.BufferType.PIXEL_PACK_BUFFER,v);q&&l.setSize(q);return l};g.createPixelUnpack=function(l,v=f.Usage.STREAM_DRAW,q){if(l.type!==d.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");
return new g(l,f.BufferType.PIXEL_UNPACK_BUFFER,v,q)};var h=g.prototype;h.dispose=function(){this._context?.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(f.ResourceType.BufferObject,this),this._context=n.nullifyNonNullableForDispose(this._context)):this._glName&&e.warn("Leaked WebGL buffer object")};h.setSize=function(l,v=null){0>=l&&e.error("Buffer size needs to be positive!");if(this.bufferType===f.BufferType.ELEMENT_ARRAY_BUFFER&&
n.isSome(v))switch(this._indexType=v,v){case f.DataType.UNSIGNED_SHORT:l*=2;break;case f.DataType.UNSIGNED_INT:l*=4}this._setBufferData(l)};h.setData=function(l){if(l){var v=l.byteLength;this.bufferType===f.BufferType.ELEMENT_ARRAY_BUFFER&&(r.isUint16Array(l)&&(v/=2,this._indexType=f.DataType.UNSIGNED_SHORT),r.isUint32Array(l)&&(v/=4,this._indexType=f.DataType.UNSIGNED_INT));this._setBufferData(v,l)}};h._setBufferData=function(l,v=null){this._size=l;const q=this._context.getBoundVAO();this._isVAOAware&&
this._context.bindVAO(null);this._context.bindBuffer(this);const k=this._context.gl;n.isSome(v)?k.bufferData(this.bufferType,v,this.usage):k.bufferData(this.bufferType,l,this.usage);m.checkWebGLError(k);this._isVAOAware&&this._context.bindVAO(q)};h.setSubData=function(l,v,q,k){if(l){(0>v||v*l.BYTES_PER_ELEMENT>=this.byteSize)&&e.error("offset is out of range!");q>=k&&e.error("end must be bigger than start!");(v+(k-q))*l.BYTES_PER_ELEMENT>this.byteSize&&e.error("An attempt to write beyond the end of the buffer!");
var p=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var z=this._context.gl;this._context.type===d.ContextType.WEBGL2?z.bufferSubData(this.bufferType,v*l.BYTES_PER_ELEMENT,l,q,k-q):(q=0===q&&k===l.length?l:l.subarray(q,k),z.bufferSubData(this.bufferType,v*l.BYTES_PER_ELEMENT,q));m.checkWebGLError(z);this._isVAOAware&&this._context.bindVAO(p)}};h.getSubData=function(l,v=0,q,k){if(this._context.type!==d.ContextType.WEBGL2)e.error("Get buffer subdata is supported in WebGL2 only!");
else if(0>q||0>k)e.error("Problem getting subdata: offset and length were less than zero!");else{var p=b.isArrayLike(l)?l.BYTES_PER_ELEMENT:1;p*((q??0)+(k??0))>l.byteLength?e.error("Problem getting subdata: offset and length exceeded destination size!"):(v+p*(k??0)>this.byteSize&&e.warn("Potential problem getting subdata: requested data exceeds buffer size!"),p=this._context.gl,this._context.bindBuffer(this,f.BufferType.COPY_READ_BUFFER),p.getBufferSubData(f.BufferType.COPY_READ_BUFFER,v,l,q,k),this._context.unbindBuffer(f.BufferType.COPY_READ_BUFFER))}};
h.getSubDataAsync=function(){var l=c._asyncToGenerator(function*(v,q=0,k,p){this._context.type!==d.ContextType.WEBGL2?e.error("Get buffer subdata is supported in WebGL2 only!"):(yield this._context.clientWaitAsync(),this.getSubData(v,q,k,p))});return function(v){return l.apply(this,arguments)}}();c._createClass(g,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",get:function(){return this._indexType}},{key:"byteSize",get:function(){return this.bufferType===
f.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===f.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}},{key:"_isVAOAware",get:function(){return this.bufferType===f.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===f.BufferType.ARRAY_BUFFER}}]);return g}();a.BufferObject=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/context-util":function(){define(["exports","../../core/has","../../core/maybe"],function(a,c,b){function t(d){const f=c("esri-force-webgl");
if(f===a.ContextType.WEBGL1||f===a.ContextType.WEBGL2)return[f];switch(d){case "2d":return c("mac")&&c("chrome")?[a.ContextType.WEBGL1,a.ContextType.WEBGL2]:[a.ContextType.WEBGL2,a.ContextType.WEBGL1];case "3d":return[a.ContextType.WEBGL2,a.ContextType.WEBGL1]}}function n(d,f,e={}){if(!window.WebGLRenderingContext)return m(d,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),null;f=r(d,f,e);b.isNone(f)&&
m(d,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e');return f}function r(d,f,e={}){f=f===a.ContextType.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let g=null;for(const h of f){try{g=d.getContext(h,e)}catch(l){}if(g)break}return g}function m(d,f){(d=d.parentNode)&&(d.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
f+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}a.ContextType=void 0;(function(d){d[d.WEBGL1=1]="WEBGL1";d[d.WEBGL2=2]="WEBGL2"})(a.ContextType||(a.ContextType={}));a.createContext=r;a.createContextOrErrorHTML=function(d,f,e={}){for(d=t(d);1<d.length;){const g=r(f,d.shift(),e);if(b.isSome(g))return g}return n(f,d.shift(),e)};a.getContextTypes=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Texture":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/mathUtils ../../core/maybe ./checkWebGLError ./context-util ./enums".split(" "),
function(a,c,b,t,n,r,m,d){function f(v){return n.isSome(v)&&"type"in v&&"compressed"===v.type}function e(v){var q;if(q=n.isSome(v)&&!f(v))q=!(n.isSome(v)&&"byteLength"in v);return q}function g(v){return v===d.TextureType.TEXTURE_3D||v===d.TextureType.TEXTURE_2D_ARRAY}function h(v,q,k,p=1){q=Math.max(q,k);v===d.TextureType.TEXTURE_3D&&(q=Math.max(q,p));return Math.round(Math.log(q)/Math.LN2)+1}const l={target:d.TextureType.TEXTURE_2D,samplingMode:d.TextureSamplingMode.LINEAR,wrapMode:d.TextureWrapMode.REPEAT,
flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1};b=function(){function v(k,p,z=null){this._context=k;this.type="texture";this._glName=null;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;k.instanceCounter.increment(d.ResourceType.Texture,this);this._descriptor={...l,...p};for(const C in l)void 0===this._descriptor[C]&&(this._descriptor[C]=l[C]);if(k.type!==m.ContextType.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=
!1),g(this._descriptor.target)))throw Error("3D and array textures are not supported in WebGL1");this._descriptor.target===d.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(z):this.setData(z)}var q=v.prototype;q.dispose=function(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(d.ResourceType.Texture,this))};q.release=function(){this.dispose()};q.resize=function(k,p){const z=
this._descriptor;if(z.width!==k||z.height!==p){if(this._wasImmutablyAllocated)throw Error("Immutable textures can't be resized!");z.width=k;z.height=p;this._descriptor.target===d.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}};q._setDataCubeMap=function(k=null){for(let p=d.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;p<=d.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;p++)this._setData(k,p)};q.setData=function(k){this._setData(k)};q._setData=function(k,p){if(this._context&&this._context.gl){var z=
this._context.gl;this._glName||(this._glName=z.createTexture());void 0===k&&(k=null);var C=this._descriptor,B=p??C.target,A=g(B);null===k&&(C.width=C.width||4,C.height=C.height||4,A&&(C.depth=C.depth??1));p=this._context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);v._validateTexture(this._context,C);this._configurePixelStorage();r.checkWebGLError(z);var x=C.pixelFormat,u=C.internalFormat??this._deriveInternalFormat(x,C.dataType);if(e(k)){x=
k.width;let y=k.height;k instanceof HTMLVideoElement&&(x=k.videoWidth,y=k.videoHeight);C.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(B,u,C.hasMipmap,x,y,1);this._texImage(B,0,u,x,y,1,k);r.checkWebGLError(z);C.hasMipmap&&this.generateMipmap();void 0===C.width&&(C.width=x);void 0===C.height&&(C.height=y);A&&void 0===C.depth&&(C.depth=1)}else{const {width:y,height:w,depth:D}=C;if(null==y||null==w)throw Error("Width and height must be specified!");if(A&&null==D)throw Error("Depth must be specified!");
C.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(B,u,C.hasMipmap,y,w,D);z.DEPTH24_STENCIL8&&u===z.DEPTH_STENCIL&&(u=z.DEPTH24_STENCIL8);if(f(k)){const F=k.levels;k=h(B,y,w,D);A=Math.min(k-1,F.length-1);n.isSome(this._context.gl2)?z.texParameteri(C.target,this._context.gl2.TEXTURE_MAX_LEVEL,A):C.hasMipmap=C.hasMipmap&&k===F.length;const E=u;if(!(E in d.CompressedTextureFormat))throw Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((K,J,M,
N)=>{this._compressedTexImage(B,K,E,J,M,N,F[Math.min(K,F.length-1)])},A)}else n.isSome(k)?(this._texImage(B,0,u,y,w,D,k),r.checkWebGLError(z),C.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((F,E,K,J)=>{this._texImage(B,F,u,E,K,J,null);r.checkWebGLError(z)})}v._applySamplingMode(z,this._descriptor);v._applyWrapMode(z,this._descriptor);v._applyAnisotropicFilteringParameters(this._context,this._descriptor);r.checkWebGLError(z);this._context.bindTexture(p,v.TEXTURE_UNIT_FOR_UPDATES)}};q.updateData=
function(k,p,z,C,B,A,x=0){A||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const u=this._context.gl,y=this._descriptor,{pixelFormat:w,dataType:D,target:F,isImmutable:E}=y,K=y.internalFormat??this._deriveInternalFormat(w,D);if(E&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");const J=this._context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES,!0);(0>p||0>z||C>y.width||B>
y.height||p+C>y.width||z+B>y.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();if(x){if(n.isNone(this._context.gl2)){console.error("Webgl2 must be enabled to use dataRowOffset!");return}u.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,x)}e(A)?n.isSome(this._context.gl2)?this._context.gl2.texSubImage2D(F,k,p,z,C,B,w,D,A):u.texSubImage2D(F,k,p,z,w,D,A):f(A)?u.compressedTexSubImage2D(F,k,p,z,C,B,K,A.levels[k]):u.texSubImage2D(F,k,p,z,C,B,w,D,A);
if(x){if(n.isNone(this._context.gl2)){console.error("Webgl2 must be enabled to use dataRowOffset!");return}u.pixelStorei(this._context.gl2.UNPACK_SKIP_ROWS,0)}this._context.bindTexture(J,v.TEXTURE_UNIT_FOR_UPDATES)};q.updateData3D=function(k,p,z,C,B,A,x,u){u||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const y=this._context.gl2;if(n.isNone(y))throw Error("3D textures are not supported in WebGL1");const w=this._descriptor,
{pixelFormat:D,dataType:F,isImmutable:E,target:K}=w,J=w.internalFormat??this._deriveInternalFormat(D,F);if(E&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");g(K)||console.warn("Attempting to set 3D texture data on a non-3D texture");const M=this._context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);(0>p||0>z||0>C||B>w.width||A>w.height||x>w.depth||p+B>w.width||z+A>w.height||C+x>w.depth)&&console.error("An attempt to update out of bounds of the texture!");
this._configurePixelStorage();f(u)?(u=u.levels[k],y.compressedTexSubImage3D(K,k,p,z,C,B,A,x,J,u)):y.texSubImage3D(K,k,p,z,C,B,A,x,D,F,u);this._context.bindTexture(M,v.TEXTURE_UNIT_FOR_UPDATES)};q.generateMipmap=function(){const k=this._descriptor;if(!k.hasMipmap){if(this._wasImmutablyAllocated)throw Error("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=k.hasMipmap=!0;v._validateTexture(this._context,k)}k.samplingMode===d.TextureSamplingMode.LINEAR?(this._samplingModeDirty=
!0,k.samplingMode=d.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):k.samplingMode===d.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,k.samplingMode=d.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const p=this._context.bindTexture(this,v.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(v.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(k.target);this._context.bindTexture(p,v.TEXTURE_UNIT_FOR_UPDATES)};q.setSamplingMode=function(k){k!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=
k,this._samplingModeDirty=!0)};q.setWrapMode=function(k){k!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=k,v._validateTexture(this._context,this._descriptor),this._wrapModeDirty=!0)};q.applyChanges=function(){const k=this._context.gl,p=this._descriptor;this._samplingModeDirty&&(v._applySamplingMode(k,p),this._samplingModeDirty=!1);this._wrapModeDirty&&(v._applyWrapMode(k,p),this._wrapModeDirty=!1)};q._deriveInternalFormat=function(k,p){if(this._context.type===m.ContextType.WEBGL1)return k;
switch(p){case d.PixelType.FLOAT:switch(k){case d.PixelFormat.RGBA:return d.SizedPixelFormat.RGBA32F;case d.PixelFormat.RGB:return d.SizedPixelFormat.RGB32F;default:throw Error("Unable to derive format");}case d.PixelType.UNSIGNED_BYTE:switch(k){case d.PixelFormat.RGBA:return d.SizedPixelFormat.RGBA8;case d.PixelFormat.RGB:return d.SizedPixelFormat.RGB8}default:return k}};q._configurePixelStorage=function(){const k=this._context.gl,{unpackAlignment:p,flipped:z,preMultiplyAlpha:C}=this._descriptor;
k.pixelStorei(k.UNPACK_ALIGNMENT,p);k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,z?1:0);k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,C?1:0)};q._texStorage=function(k,p,z,C,B,A){const x=this._context.gl2;if(n.isNone(x))throw Error("Immutable textures are not supported in WebGL1");if(!(p in d.SizedPixelFormat))throw Error("Immutable textures must have a sized internal format");if(this._descriptor.isImmutable){z=z?h(k,C,B,A):1;if(g(k)){if(null==A)throw Error("Missing depth dimension for 3D texture upload");
x.texStorage3D(k,z,p,C,B,A)}else x.texStorage2D(k,z,p,C,B);this._wasImmutablyAllocated=!0}};q._texImage=function(k,p,z,C,B,A,x){const u=this._context.gl;let y=null;const w=this._context.type===m.ContextType.WEBGL2,D=g(k),{isImmutable:F,pixelFormat:E,dataType:K}=this._descriptor;w&&(y=u);if(!w&&e(x))u.texImage2D(k,0,z,E,K,x);else if(F){if(n.isSome(x))if(D){if(null==A)throw Error("Missing depth dimension for 3D texture upload");y.texSubImage3D(k,p,0,0,0,C,B,A,E,K,x)}else u.texSubImage2D(k,p,0,0,C,B,
E,K,x)}else if(x=n.unwrap(x),D){if(null==A)throw Error("Missing depth dimension for 3D texture upload");y.texImage3D(k,p,z,C,B,A,0,E,K,x)}else u.texImage2D(k,p,z,C,B,0,E,K,x)};q._compressedTexImage=function(k,p,z,C,B,A,x){const u=this._context.gl;let y=null;const w=g(k),D=this._descriptor.isImmutable;if(w){if(this._context.type!==m.ContextType.WEBGL2)throw Error("3D textures are not supported in WebGL1");y=u}if(D){if(n.isSome(x))if(w){if(null==A)throw Error("Missing depth dimension for 3D texture upload");
y.compressedTexSubImage3D(k,p,0,0,0,C,B,A,z,x)}else u.compressedTexSubImage2D(k,p,0,0,C,B,z,x)}else if(w){if(null==A)throw Error("Missing depth dimension for 3D texture upload");y.compressedTexImage3D(k,p,z,C,B,A,0,x)}else u.compressedTexImage2D(k,p,z,C,B,0,x)};q._forEachMipmapLevel=function(k,p=Infinity){let {width:z,height:C,depth:B,hasMipmap:A,target:x}=this._descriptor;const u=x===d.TextureType.TEXTURE_3D;if(null==z||null==C||u&&null==B)throw Error("Missing texture dimensions for mipmap calculation");
for(let y=0;;++y){k(y,z,C,B);if(!A||1===z&&1===C&&(!u||1===B)||y>=p)break;z=Math.max(1,z>>1);C=Math.max(1,C>>1);u&&(B=Math.max(1,B>>1))}};v._validateTexture=function(k,p){(null!=p.width&&0>p.width||null!=p.height&&0>p.height||null!=p.depth&&0>p.depth)&&console.error("Negative dimension parameters are not allowed!");k=k.type===m.ContextType.WEBGL2;const z=null!=p.width&&t.isPowerOfTwo(p.width)&&null!=p.height&&t.isPowerOfTwo(p.height);k||!p.isImmutable&&!g(p.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!");
k||z||("number"===typeof p.wrapMode?p.wrapMode!==d.TextureWrapMode.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(p.wrapMode.s!==d.TextureWrapMode.CLAMP_TO_EDGE||p.wrapMode.t!==d.TextureWrapMode.CLAMP_TO_EDGE)&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),p.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};v._applySamplingMode=function(k,p){let z=p.samplingMode,C=p.samplingMode;if(z===
d.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||z===d.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)z=d.TextureSamplingMode.LINEAR,p.hasMipmap||(C=d.TextureSamplingMode.LINEAR);else if(z===d.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||z===d.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)z=d.TextureSamplingMode.NEAREST,p.hasMipmap||(C=d.TextureSamplingMode.NEAREST);k.texParameteri(p.target,k.TEXTURE_MAG_FILTER,z);k.texParameteri(p.target,k.TEXTURE_MIN_FILTER,C)};v._applyWrapMode=function(k,p){"number"===typeof p.wrapMode?
(k.texParameteri(p.target,k.TEXTURE_WRAP_S,p.wrapMode),k.texParameteri(p.target,k.TEXTURE_WRAP_T,p.wrapMode)):(k.texParameteri(p.target,k.TEXTURE_WRAP_S,p.wrapMode.s),k.texParameteri(p.target,k.TEXTURE_WRAP_T,p.wrapMode.t))};v._applyAnisotropicFilteringParameters=function(k,p){const z=k.capabilities.textureFilterAnisotropic;z&&k.gl.texParameterf(p.target,z.TEXTURE_MAX_ANISOTROPY,p.maxAnisotropy??1)};c._createClass(v,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}},
{key:"isDirty",get:function(){return this._samplingModeDirty||this._wrapModeDirty}}]);return v}();b.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./CloudsCompositionTechnique ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){a.CloudsComposition=function(q){function k(z){var C=q.call(this,z)||this;C._technique=new e.CloudsCompositionTechnique(z);C._vao=h.createQuadVAO(z.rctx);return C}c._inheritsLoose(k,q);var p=k.prototype;p.destroy=function(){this._technique=n.releaseMaybe(this._technique);this._vao=n.disposeMaybe(this._vao)};p.render=function(z){var C=z.bindParameters.cloudsFade;n.isNone(this._vao)||n.isNone(C.data)||(this._technique.compiled?(C=z.rctx.bindTechnique(this._technique,
v,z.bindParameters),z.rctx.bindVAO(this._vao),C.assertCompatibleVertexAttributeLocations(this._vao),z.rctx.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,4)):this.requestRender())};return k}(t);b.__decorate([r.property({constructOnly:!0})],a.CloudsComposition.prototype,"rctx",void 0);b.__decorate([r.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);b.__decorate([r.property({constructOnly:!0})],a.CloudsComposition.prototype,"planetRadius",void 0);b.__decorate([r.property({constructOnly:!0})],
a.CloudsComposition.prototype,"requestRender",void 0);a.CloudsComposition=b.__decorate([f.subclass("esri.views.3d.environment.CloudsComposition")],a.CloudsComposition);const v=new g.NoParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){r=function(h){function l(q){var k;return k=h.call(this,q,new m.ShaderTechniqueConfiguration,()=>k.destroy())||this}b._inheritsLoose(l,h);var v=l.prototype;v.initializeProgram=function(q){return new f.Program(q.rctx,l.shader.get().build(),d.Default3D)};v.initializePipeline=function(){return g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams})};
return l}(r.ShaderTechnique);r.shader=new n.ReloadableShaderModule(t.CloudsCompositionShader,()=>new Promise((h,l)=>a(["./CloudsComposition.glsl"],h,l)));c.CloudsCompositionTechnique=r;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){function p(){const C=new q.ShaderBuilder;C.attributes.add(k.VertexAttribute.POSITION,"vec2");C.varyings.add("worldRay","vec3");const {vertex:B,fragment:A}=C;B.uniforms.add([new v.Matrix4PassUniform("inverseProjectionMatrix",(x,u)=>u.camera.inverseProjectionMatrix),new v.Matrix4PassUniform("inverseViewMatrix",(x,u)=>c.invertOrIdentity(z,u.camera.viewMatrix))]);B.code.add(l.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);A.include(e.ColorConversion);A.include(g.RgbaFloatEncoding);C.include(t.EvaluateAmbientLighting,{pbrMode:m.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});C.include(d.PiUtils);C.include(n.Gamma);C.include(r.MainLighting,{useLegacyTerrainShading:!1});C.include(f.CloudsParallaxShading,{instancedDoublePrecision:!1,useLegacyTerrainShading:!1});A.uniforms.add([new h.Float3PassUniform("cameraPosition",(x,u)=>u.camera.eye)]);A.code.add(l.glsl`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return C}const z=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.CloudsCompositionShader=b;a.build=p})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,c,b,t,n,r,m,d,f){const e=b.create(),g=n.create();a.EvaluateAmbientLighting=function(h,l){h=h.fragment;const v=void 0!==l.lightingSphericalHarmonicsOrder?l.lightingSphericalHarmonicsOrder:2;0===v?(h.uniforms.add(new m.Float3PassUniform("lightingAmbientSH0",(q,k)=>c.set(e,k.lighting.sh.r[0],k.lighting.sh.g[0],k.lighting.sh.b[0]))),h.code.add(f.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===v?(h.uniforms.add([new d.Float4PassUniform("lightingAmbientSH_R",(q,k)=>t.set(g,k.lighting.sh.r[0],k.lighting.sh.r[1],k.lighting.sh.r[2],k.lighting.sh.r[3])),new d.Float4PassUniform("lightingAmbientSH_G",(q,k)=>t.set(g,k.lighting.sh.g[0],k.lighting.sh.g[1],k.lighting.sh.g[2],k.lighting.sh.g[3])),new d.Float4PassUniform("lightingAmbientSH_B",(q,k)=>t.set(g,k.lighting.sh.b[0],k.lighting.sh.b[1],k.lighting.sh.b[2],k.lighting.sh.b[3]))]),h.code.add(f.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===v&&(h.uniforms.add([new m.Float3PassUniform("lightingAmbientSH0",(q,k)=>c.set(e,k.lighting.sh.r[0],k.lighting.sh.g[0],k.lighting.sh.b[0])),new d.Float4PassUniform("lightingAmbientSH_R1",(q,k)=>t.set(g,k.lighting.sh.r[1],k.lighting.sh.r[2],k.lighting.sh.r[3],k.lighting.sh.r[4])),new d.Float4PassUniform("lightingAmbientSH_G1",(q,k)=>t.set(g,k.lighting.sh.g[1],k.lighting.sh.g[2],k.lighting.sh.g[3],k.lighting.sh.g[4])),new d.Float4PassUniform("lightingAmbientSH_B1",(q,k)=>t.set(g,k.lighting.sh.b[1],
k.lighting.sh.b[2],k.lighting.sh.b[3],k.lighting.sh.b[4])),new d.Float4PassUniform("lightingAmbientSH_R2",(q,k)=>t.set(g,k.lighting.sh.r[5],k.lighting.sh.r[6],k.lighting.sh.r[7],k.lighting.sh.r[8])),new d.Float4PassUniform("lightingAmbientSH_G2",(q,k)=>t.set(g,k.lighting.sh.g[5],k.lighting.sh.g[6],k.lighting.sh.g[7],k.lighting.sh.g[8])),new d.Float4PassUniform("lightingAmbientSH_B2",(q,k)=>t.set(g,k.lighting.sh.b[5],k.lighting.sh.b[6],k.lighting.sh.b[7],k.lighting.sh.b[8]))]),h.code.add(f.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),l.pbrMode!==r.PBRMode.Normal&&l.pbrMode!==r.PBRMode.Schematic||h.code.add(f.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f32 ../attributes/VertexTextureCoordinates.glsl ../util/WebGL2Utils ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){b=b.fromValues(0,.6,.2);a.PBRMode=void 0;(function(v){v[v.Disabled=0]="Disabled";v[v.Normal=1]="Normal";v[v.Schematic=2]="Schematic";v[v.Water=3]="Water";v[v.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";v[v.Terrain=5]="Terrain";v[v.TerrainWithWater=6]="TerrainWithWater";v[v.COUNT=7]="COUNT"})(a.PBRMode||(a.PBRMode={}));l=function(v){function q(){return v.apply(this,arguments)||this}c._inheritsLoose(q,v);return q}(l.GLTextureMaterialBindParameters);a.PBRBindParameters=
l;a.PBRSchematicMRRValues=b;a.PhysicallyBasedRenderingParameters=function(v,q){const k=v.fragment,p=q.hasMetallicRoughnessTexture||q.hasEmissionTexture||q.hasOcclusionTexture;q.pbrMode===a.PBRMode.Normal&&p&&v.include(t.VertexTextureCoordinates,q);if(q.pbrMode===a.PBRMode.Schematic)k.code.add(d.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);else if(q.pbrMode===a.PBRMode.Disabled)k.code.add(d.glsl`float getBakedOcclusion() { return 1.0; }`);else if(q.pbrMode===a.PBRMode.Normal){k.code.add(d.glsl`vec3 mrr;
vec3 emission;
float occlusion;`);v=q.supportsTextureAtlas?q.hasWebGL2Context?g.TextureSizeUniformType.None:g.TextureSizeUniformType.Size:g.TextureSizeUniformType.None;const z=q.pbrTextureBindType;q.hasMetallicRoughnessTexture&&(k.uniforms.add(z===h.BindType.Pass?e.createTexture2DPassSizeUniforms("texMetallicRoughness",C=>C.textureMetallicRoughness,v):f.createTexture2DDrawSizeUniforms("texMetallicRoughness",C=>C.textureMetallicRoughness,v)),k.code.add(d.glsl`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`));q.hasEmissionTexture&&(k.uniforms.add(z===h.BindType.Pass?e.createTexture2DPassSizeUniforms("texEmission",C=>C.textureEmissive,v):f.createTexture2DDrawSizeUniforms("texEmission",C=>C.textureEmissive,v)),k.code.add(d.glsl`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`));q.hasOcclusionTexture?(k.uniforms.add(z===h.BindType.Pass?e.createTexture2DPassSizeUniforms("texOcclusion",C=>C.textureOcclusion,v):f.createTexture2DDrawSizeUniforms("texOcclusion",C=>C.textureOcclusion,v)),k.code.add(d.glsl`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):k.code.add(d.glsl`float getBakedOcclusion() { return 1.0; }`);k.uniforms.add(z===h.BindType.Pass?[new m.Float3PassUniform("emissionFactor",C=>C.emissiveFactor),new m.Float3PassUniform("mrrFactors",C=>C.mrrFactors)]:[new r.Float3DrawUniform("emissionFactor",C=>C.emissiveFactor),new r.Float3DrawUniform("mrrFactors",C=>C.mrrFactors)]);k.code.add(d.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${p?d.glsl`vtc.uv = vuv0;`:""}
      ${q.hasMetallicRoughnessTextureTransform?d.glsl`vtc.uv = metallicRoughnessUV;`:""}
      ${q.hasMetallicRoughnessTexture?q.supportsTextureAtlas?d.glsl`
                vtc.size = ${n.textureSize(q,"texMetallicRoughness")};
                applyMetallnessAndRoughness(vtc);`:d.glsl`applyMetallnessAndRoughness(vtc);`:""}
      ${q.hasEmissiveTextureTransform?d.glsl`vtc.uv = emissiveUV;`:""}
      ${q.hasEmissionTexture?q.supportsTextureAtlas?d.glsl`
                vtc.size = ${n.textureSize(q,"texEmission")};
                applyEmission(vtc);`:d.glsl`applyEmission(vtc);`:""}
      ${q.hasOcclusionTextureTransform?d.glsl`vtc.uv = occlusionUV;`:""}
      ${q.hasOcclusionTexture?q.supportsTextureAtlas?d.glsl`
                vtc.size = ${n.textureSize(q,"texOcclusion")};
                applyOcclusion(vtc);`:d.glsl`applyOcclusion(vtc);`:""}
    }
  `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec3f32":function(){define(["exports"],function(a){function c(){return new Float32Array(3)}function b(p){const z=new Float32Array(3);z[0]=p[0];z[1]=p[1];z[2]=p[2];return z}function t(p,z,C){const B=new Float32Array(3);B[0]=p;B[1]=z;B[2]=C;return B}function n(p,z){return new Float32Array(p,z,3)}function r(){return c()}function m(){return t(1,1,1)}function d(){return t(1,0,0)}function f(){return t(0,1,0)}function e(){return t(0,
0,1)}const g=c(),h=m(),l=d(),v=f(),q=e(),k=Object.freeze(Object.defineProperty({__proto__:null,ONES:h,UNIT_X:l,UNIT_Y:v,UNIT_Z:q,ZEROS:g,clone:b,create:c,createView:n,fromValues:t,ones:m,unitX:d,unitY:f,unitZ:e,zeros:r},Symbol.toStringTag,{value:"Module"}));a.ONES=h;a.UNIT_X=l;a.UNIT_Y=v;a.UNIT_Z=q;a.ZEROS=g;a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.ones=m;a.unitX=d;a.unitY=f;a.unitZ=e;a.vec3f32=k;a.zeros=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports",
"../../../../../../core/compilerUtils","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,c,b,t,n){a.VertexTextureCoordinates=function(r,m){r.include(b.TextureCoordinateAttribute,m);r.fragment.code.add(n.glsl`
  struct TextureLookupParameter {
    vec2 uv;
    ${m.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `);switch(m.textureCoordinateType){case b.TextureCoordinateAttributeType.Default:case b.TextureCoordinateAttributeType.Compressed:r.fragment.code.add(n.glsl`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);break;case b.TextureCoordinateAttributeType.Atlas:r.include(t.TextureAtlasLookup);r.fragment.code.add(n.glsl`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);break;default:c.neverReached(m.textureCoordinateType);case b.TextureCoordinateAttributeType.None:case b.TextureCoordinateAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.TextureAtlasLookup=function(b){b.extensions.add("GL_EXT_shader_texture_lod");b.extensions.add("GL_OES_standard_derivatives");b.fragment.code.add(c.glsl`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"vec3",t.BindType.Draw,(f,e,g,h)=>f.setUniform3fv(m,d(e,g,h)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Float3DrawUniform=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../shaderLibrary/util/WebGL2Utils ./Float2DrawUniform ./TextureSizeUniformType ./Uniform ../shaderTechnique/BindType".split(" "),function(a,c,b,t,n,r,m,d,f,e){let g=function(l){function v(q,k){return l.call(this,q,"sampler2D",e.BindType.Draw,(p,z,C)=>p.bindTexture(q,
k(z,C)))||this}c._inheritsLoose(v,l);return v}(f.Uniform);const h=n.create();a.Texture2DDrawUniform=g;a.createTexture2DDrawSizeUniforms=function(l,v,q=d.TextureSizeUniformType.None){const k=[new g(l,v)];q&d.TextureSizeUniformType.Size&&k.push(new m.Float2DrawUniform(l+r.TEXTURE_SIZE_UNIFORM_SUFFIX,(p,z)=>{p=v(p,z);return b.isSome(p)?t.set(h,p.descriptor.width,p.descriptor.height):n.ZEROS}));q&d.TextureSizeUniformType.InvSize&&k.push(new m.Float2DrawUniform(l+r.TEXTURE_INVERSE_SIZE_UNIFORM_SUFFIX,
(p,z)=>{p=v(p,z);return b.isSome(p)?t.set(h,1/p.descriptor.width,1/p.descriptor.height):n.ZEROS}));return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"vec2",t.BindType.Draw,(f,e,g,h)=>f.setUniform2fv(m,d(e,g,h)))||this}c._inheritsLoose(r,
n);return r}(b.Uniform);a.Float2DrawUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),function(a,c,b,t,n,r,m){m=function(f){function e(h){var l=f.call(this,h)||this;l._numLoading=0;l._disposed=!1;l._textureRepository=h.textureRep;
l._textureId=h.textureId;l._acquire(h.textureId,v=>l._texture=v);l._acquire(h.normalTextureId,v=>l._textureNormal=v);l._acquire(h.emissiveTextureId,v=>l._textureEmissive=v);l._acquire(h.occlusionTextureId,v=>l._textureOcclusion=v);l._acquire(h.metallicRoughnessTextureId,v=>l._textureMetallicRoughness=v);return l}c._inheritsLoose(e,f);var g=e.prototype;g.dispose=function(){this._texture=b.releaseMaybe(this._texture);this._textureNormal=b.releaseMaybe(this._textureNormal);this._textureEmissive=b.releaseMaybe(this._textureEmissive);
this._textureOcclusion=b.releaseMaybe(this._textureOcclusion);this._textureMetallicRoughness=b.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0};g.ensureResources=function(h){return 0===this._numLoading?r.ResourceState.LOADED:r.ResourceState.LOADING};g.updateTexture=function(h){if(b.isNone(this._texture)||h!==this._texture.id)this._texture=b.releaseMaybe(this._texture),this._textureId=h,this._acquire(this._textureId,l=>this._texture=l)};g._acquire=function(h,l){b.isNone(h)?l(null):(h=
this._textureRepository.acquire(h),t.isPromiseLike(h)?(++this._numLoading,h.then(v=>{this._disposed?(b.releaseMaybe(v),l(null)):l(v)}).finally(()=>--this._numLoading)):l(h))};c._createClass(e,[{key:"textureBindParameters",get:function(){return new d(b.isSome(this._texture)?this._texture.glTexture:null,b.isSome(this._textureNormal)?this._textureNormal.glTexture:null,b.isSome(this._textureEmissive)?this._textureEmissive.glTexture:null,b.isSome(this._textureOcclusion)?this._textureOcclusion.glTexture:
null,b.isSome(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:null)}}]);return e}(m);let d=function(f){function e(g=null,h=null,l=null,v=null,q=null){var k=f.call(this)||this;k.texture=g;k.textureNormal=h;k.textureEmissive=l;k.textureOcclusion=v;k.textureMetallicRoughness=q;return k}c._inheritsLoose(e,f);return e}(n.NoParameters);a.GLTextureMaterial=m;a.GLTextureMaterialBindParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./basicInterfaces"],function(a,c){return function(){function b(n){this._material=n.material;this._techniqueRepository=n.techniqueRep;this._output=n.output}var t=b.prototype;t.dispose=function(){this._techniqueRepository.release(this._technique)};t.ensureTechnique=function(n,r){return this._technique=this._techniqueRepository.releaseAndAcquire(n,this._material.getConfiguration(this._output,r),this._technique)};t.ensureResources=function(n){return c.ResourceState.LOADED};a._createClass(b,[{key:"technique",
get:function(){return this._technique}},{key:"_stippleTextureRepository",get:function(){return this._techniqueRepository.constructionContext.stippleTextureRepository}}]);return b}()})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.PiUtils=function(b){b.vertex.code.add(c.glsl`const float PI = 3.141592653589793;`);b.fragment.code.add(c.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/mathUtils ../../../../../../core/maybe ../../../../../../geometry/support/Ellipsoid ../../../../environment/CloudsCompositionParameters ../../../../environment/CloudsData ../shading/MainLighting.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){a.CloudsParallaxShading=function(v){v=v.fragment;v.uniforms.add([new h.Matrix4PassUniform("rotationMatrixClouds",(q,k)=>k.cloudsFade.parallax.transform),new h.Matrix4PassUniform("rotationMatrixCloudsCrossFade",(q,k)=>k.cloudsFade.parallaxNew.transform),new f.Float3PassUniform("anchorPosition",(q,k)=>k.cloudsFade.parallax.anchorPointClouds),new f.Float3PassUniform("anchorPositionCrossFade",(q,k)=>k.cloudsFade.parallaxNew.anchorPointClouds),new e.FloatPassUniform("cloudsHeight",
(q,k)=>k.cloudsFade.parallax.cloudsHeight),new e.FloatPassUniform("radiusCurvatureCorrectionFactor",(q,k)=>k.cloudsFade.parallax.radiusCurvatureCorrectionFactor),new e.FloatPassUniform("totalFadeInOut",(q,k)=>k.cloudsFade.fadeInOut.stage===n.FadeInOutStages.FINISHED?k.cloudsFade.fadeInOutHeight.factor+1-k.cloudsFade.fadeIn.factor:k.cloudsFade.fadeInOutHeight.factor+1-k.cloudsFade.fadeInOut.factor),new e.FloatPassUniform("crossFadeAnchorFactor",(q,k)=>c.clamp(k.cloudsFade.crossFade.factor,0,1)),new l.TextureCubePassUniform("cubeMap",
(q,k)=>b.isSome(k.cloudsFade.data)&&b.isSome(k.cloudsFade.data.cubeMap)?k.cloudsFade.data.cubeMap.colorTexture:null),new d.BooleanPassUniform("crossFade",(q,k)=>k.cloudsFade.crossFade.enabled),new d.BooleanPassUniform("readChannelsRG",(q,k)=>k.cloudsFade.readChannels===r.CloudsTextureChannels.RG),new d.BooleanPassUniform("fadeTextureChannels",(q,k)=>k.cloudsFade.renderingStage===r.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)]);v.constants.add("planetRadius","float",t.earth.radius);v.code.add(g.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);v.code.add(g.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);v.code.add(g.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);m.addMainLightDirection(v);m.addMainLightIntensity(v);v.code.add(g.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(mainLightDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(mainLightDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((mainLightIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * (pow(dirDotLight, RIM_SCATTERING_FACTOR)) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);v.code.add(g.glsl`vec4 getCloudData(vec3 rayDir, bool readOtherChannel)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
bool readChannels = readChannelsRG ^^ readOtherChannel;
if (readChannels) {
cloudData = vec4(vec3(cloudData.r), cloudData.g);
} else {
cloudData = vec4(vec3(cloudData.b), cloudData.a);
}
if (length(cloudData) == 0.0) {
return vec4(cloudData.rgb, 1.0);
}
return cloudData;
}`);v.code.add(g.glsl`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`);v.code.add(g.glsl`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected, false);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected, fadeTextureChannels);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`);v.code.add(g.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsCompositionParameters":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/mat4f64","../../../chunks/vec3f64","./CloudsData"],function(a,c,b,t,n){let r=function(){function d(){this.readChannels=n.CloudsTextureChannels.RG;this.renderingStage=n.CloudsRenderingStages.FINISHED;this.startTimeHeightFade=this.startTime=0;this.cameraPositionLastFrame=t.create();this.isCameraPositionFinal=
!0;this.parallax=new m;this.parallaxNew=new m;this.crossFade={enabled:!1,factor:1,distanceThresholdFactor:.3};this.fadeInOut={stage:a.FadeInOutStages.FINISHED,factor:1,distanceThresholdFactor:.6};this.fadeIn={stage:a.FadeInStages.FINISHED,factor:1,distanceThresholdFactor:2};this.fadeInOutHeight={stage:a.FadeHeightStages.FINISHED,factor:-1}}c._createClass(d,[{key:"isFading",get:function(){return this.fadeInOut.stage===a.FadeInOutStages.FADE_OUT||this.fadeInOut.stage===a.FadeInOutStages.FADE_IN||this.fadeIn.stage===
a.FadeInStages.FADE_IN||this.fadeInOutHeight.stage!==a.FadeHeightStages.FINISHED||this.renderingStage===n.CloudsRenderingStages.FADING_TEXTURE_CHANNELS}}]);return d}();a.FadeInStages=void 0;(function(d){d[d.FINISHED=0]="FINISHED";d[d.CHANGE_ANCHOR=1]="CHANGE_ANCHOR";d[d.FADE_IN=2]="FADE_IN"})(a.FadeInStages||(a.FadeInStages={}));a.FadeInOutStages=void 0;(function(d){d[d.FINISHED=0]="FINISHED";d[d.FADE_OUT=1]="FADE_OUT";d[d.SWITCH=2]="SWITCH";d[d.FADE_IN=3]="FADE_IN"})(a.FadeInOutStages||(a.FadeInOutStages=
{}));a.FadeHeightStages=void 0;(function(d){d[d.FINISHED=0]="FINISHED";d[d.HEIGHT_FADE=1]="HEIGHT_FADE"})(a.FadeHeightStages||(a.FadeHeightStages={}));let m=function(){this.anchorPointClouds=t.create();this.cloudsHeight=1E5;this.radiusCurvatureCorrectionFactor=0;this.transform=b.create()};a.CloudsFadeParameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsData":function(){define(["exports","../../../core/maybe"],function(a,c){a.CloudsRenderingStages=
void 0;(function(b){b[b.RENDERING=0]="RENDERING";b[b.FINISHED_RENDERING=1]="FINISHED_RENDERING";b[b.FADING_TEXTURE_CHANNELS=2]="FADING_TEXTURE_CHANNELS";b[b.SWITCH_CHANNELS=3]="SWITCH_CHANNELS";b[b.FINISHED=4]="FINISHED"})(a.CloudsRenderingStages||(a.CloudsRenderingStages={}));a.CloudsTextureChannels=void 0;(function(b){b[b.RG=0]="RG";b[b.BA=1]="BA"})(a.CloudsTextureChannels||(a.CloudsTextureChannels={}));a.ensureClouds=function(b){return c.isSome(b)&&!b.running};a.isReadyCloudsData=function(b){return c.isSome(b)&&
c.isSome(b.cubeMap)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"bool",t.BindType.Pass,(f,e,g)=>f.setUniform1b(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.BooleanPassUniform=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"samplerCube",t.BindType.Pass,(f,e,g)=>f.bindTexture(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.TextureCubePassUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports",
"../../shaderModules/interfaces"],function(a,c){a.ColorConversion=function(b){b.code.add(c.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3f32 ../../../geometry/ellipsoidUtils ../../../chunks/Clouds.glsl ./CloudsData ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J){a.CloudsGenerator=function(I){function G(L){L=I.call(this,L)||this;L._handles=new n;L._techniques=[];L._techniqueConfiguration=new y.CloudsTechniqueConfiguration;L._bindParameters=new D.BindParameters(null,null,null);L._passParameters=new B.CloudsPassParameters;L._drawParameters=new B.CloudsDrawParameters;L._weatherTile=p.create();L._weatherTileCount=128;L._faceIndex=0;L._tileIndex=0;L.coverage=r.lerp(x.cloudPresets.default.coverage[0],
x.cloudPresets.default.coverage[1],.5);L.density=r.lerp(x.cloudPresets.default.density[0],x.cloudPresets.default.density[1],.5);L.absorption=r.lerp(x.cloudPresets.default.absorption[0],x.cloudPresets.default.absorption[1],.5);L.cloudSize=r.lerp(x.cloudPresets.default.cloudSize[0],x.cloudPresets.default.cloudSize[1],.5);L.detailSize=r.lerp(x.cloudPresets.default.detailSize[0],x.cloudPresets.default.detailSize[1],.5);L.smoothness=r.lerp(x.cloudPresets.default.smoothness[0],x.cloudPresets.default.smoothness[1],
.5);L.cloudHeight=r.lerp(x.cloudPresets.default.cloudHeight[0],x.cloudPresets.default.cloudHeight[1],.5);L.raymarchingSteps=x.cloudPresets.default.raymarchingSteps;L._viewMatrix=q.create();L._dirty=!1;L.running=!1;return L}c._inheritsLoose(G,I);var H=G.prototype;H._getTechnique=function(L){const O=1-this.context.renderContext.bindParameters.cloudsFade.readChannels,S=O===A.CloudsTextureChannels.RG?2*L:2*L+1,R=this._techniques[S];if(R)return R;this._techniqueConfiguration.writeTextureChannels=O;this._techniqueConfiguration.steps=
L;this._techniques[S]=new u.CloudsTechnique({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration);return this._techniques[S]};H.updateWeatherTile=function(){var L=this.view.camera.position.latitude,O=this.view.camera.position.longitude;null!=L&&null!=O&&(k.set(this._weatherTile,(L+90)/180,(O+180)/360),L=Math.floor(this._weatherTileCount*Math.abs(2*this._weatherTile[0]-1)),this._weatherTile[0]=Math.floor(2*this._weatherTileCount*this._weatherTile[0]),
this._weatherTile[1]=Math.floor(4*(this._weatherTileCount-L)*this._weatherTile[1]),O=L=0,m.isSome(this.view.environment)&&"virtual"!==this.view.environment.lighting.type&&m.isSome(this.view.environment.lighting.date)&&(O=new Date(this.view.environment.lighting.date),O.setUTCHours(this.view.environment.lighting.date.getUTCHours()+(this.view.environment.lighting.displayUTCOffset??0)),L=31*O.getUTCMonth()+O.getUTCDate(),O=O.getUTCFullYear()),this._weatherTile[0]=(this._weatherTile[0]+L)%(2*this._weatherTileCount),
this._weatherTile[1]=(this._weatherTile[1]+O%100)%(4*this._weatherTileCount),k.equals(this._passParameters.weatherTile,this._weatherTile)||this.setDirty())};H.initialize=function(){this._vao=F.createQuadVAO(this.context.renderContext.rctx);const L=C.getReferenceEllipsoid(this.view.spatialReference);this._passParameters.cloudRadius=.5*L.radius;this.setDirty();this.updateWeatherTile();this._handles.add([this.view.resourceController.scheduler.registerTask(E.TaskPriority.CLOUDS_GENERATOR,this),d.watch(()=>
[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,this.smoothness,this.cloudHeight,this.raymarchingSteps],()=>this.setDirty(),d.initial)])};H.destroy=function(){this._handles.destroy();this._techniques.forEach(L=>m.releaseMaybe(L));this._frameBufferCube=m.disposeMaybe(this._frameBufferCube);this._techniques.length=0;this._vao=m.disposeMaybe(this._vao);this._passParameters.noiseTexture=m.destroyMaybe(this._passParameters.noiseTexture)};H._ensureNoiseTexture=function(){m.isSome(this._passParameters.noiseTexture)||
(this._passParameters.noiseTexture=new w.NoiseTextureAtlas({context:this.context}));this._passParameters.noiseTexture.updateWeatherMap(this._passParameters.weatherTile);return m.isSome(this._passParameters.noiseTexture.textureAtlas)};H._ensureFrameBufferCube=function(L){m.isNone(this._frameBufferCube)&&(this._frameBufferCube=new J.FramebufferObject(this.context.renderContext.rctx,{colorTarget:K.TargetType.CUBEMAP,width:L,height:L},{target:K.TextureType.TEXTURE_CUBE_MAP,pixelFormat:K.PixelFormat.RGBA,
dataType:K.PixelType.UNSIGNED_BYTE,wrapMode:K.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:K.TextureSamplingMode.LINEAR,hasMipmap:!1,width:L,height:L}));return this._frameBufferCube};H.destroyFrameBufferCube=function(){this._frameBufferCube=m.disposeMaybe(this._frameBufferCube)};H.applyPreset=function(L,O){const S=L.median,R=Q=>{const V=r.lerp(Q[0],Q[1],S);return.5>O?r.lerp(Q[0],V,2*O):r.lerp(V,Q[1],2*(O-.5))};this.coverage=R(L.coverage);this.density=R(L.density);this.absorption=R(L.absorption);this.cloudSize=
R(L.cloudSize);this.detailSize=R(L.detailSize);this.smoothness=R(L.smoothness);this.cloudHeight=R(L.cloudHeight);this.raymarchingSteps=L.raymarchingSteps};H.setDirty=function(){this._dirty=this.running=!0};H.runTask=function(L){if(m.isNone(this._vao))this._dirty=this.running=!1,this.context.renderContext.bindParameters.cloudsFade.renderingStage=A.CloudsRenderingStages.FINISHED_RENDERING,L.madeProgress();else{0===this._faceIndex&&0===this._tileIndex&&(this._passParameters.raymarchingSteps=this.raymarchingSteps,
this.updateWeatherTile(),k.copy(this._passParameters.weatherTile,this._weatherTile));var O=this._getTechnique(this._passParameters.raymarchingSteps);if(!O.compiled||!this.context.renderContext.bindParameters.cloudsFade.isCameraPositionFinal||this.context.renderContext.bindParameters.cloudsFade.isFading||!this._ensureNoiseTexture())return E.Task.YIELD;0===this._faceIndex&&0===this._tileIndex&&(this.context.renderContext.bindParameters.cloudsFade.renderingStage=A.CloudsRenderingStages.RENDERING,this._passParameters.absorption=
this.absorption,this._passParameters.density=this.density,this._passParameters.cloudSize=this.cloudSize,this._passParameters.detailSize=this.detailSize,this._passParameters.smoothness=this.smoothness,this._passParameters.cloudHeight=this.cloudHeight,this._passParameters.coverage=this.coverage,this._dirty=!1);var S=this.context.renderContext.rctx,R=S.bindTechnique(O,this._passParameters,this._bindParameters);S.bindVAO(this._vao);R.assertCompatibleVertexAttributeLocations(this._vao);var Q=S.getViewport();
O=O.configuration.cubeMapSize;var V=O/this._tilesPerFace;S.setViewport(0,this._tileIndex*V,O,V);O=this._ensureFrameBufferCube(O);S.bindFramebuffer(O);v.targetTo(this._viewMatrix,P,M[this._faceIndex],N[this._faceIndex]);l.fromMat4(this._drawParameters.viewMatrix,this._viewMatrix);O.setColorTextureTarget(K.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+this._faceIndex);R.bindDraw(this._drawParameters,this._bindParameters,this._passParameters);S.gl.drawArrays(S.gl.TRIANGLE_STRIP,0,4);S.gl.flush();S.setViewport(Q.x,
Q.y,Q.width,Q.height);this.requestRender();++this._tileIndex;4===this._faceIndex&&this._tileIndex===this._tilesPerFace?(this.running=this._dirty,this._tileIndex=this._faceIndex=0,this.context.renderContext.bindParameters.cloudsFade.renderingStage=A.CloudsRenderingStages.FINISHED_RENDERING):this._tileIndex===this._tilesPerFace&&(++this._faceIndex,this._tileIndex=0);L.madeProgress();return E.Task.YIELD}};c._createClass(G,[{key:"_tilesPerFace",get:function(){switch(this._techniqueConfiguration.steps){case y.RayMarchingSteps.SIXTEEN:return 1;
case y.RayMarchingSteps.HUNDRED:return 4;case y.RayMarchingSteps.COUNT:case y.RayMarchingSteps.TWOHUNDRED:return 8}}},{key:"cubeMap",get:function(){return this._frameBufferCube}}]);return G}(t);b.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"context",void 0);b.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"view",void 0);b.__decorate([f.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",void 0);b.__decorate([f.property()],
a.CloudsGenerator.prototype,"coverage",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"density",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"absorption",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"cloudSize",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"detailSize",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"smoothness",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"cloudHeight",void 0);
b.__decorate([f.property()],a.CloudsGenerator.prototype,"raymarchingSteps",void 0);b.__decorate([f.property()],a.CloudsGenerator.prototype,"running",void 0);a.CloudsGenerator=b.__decorate([h.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);const M=[z.fromValues(1,0,0),z.fromValues(-1,0,0),z.fromValues(0,1,0),z.fromValues(0,-1,0),z.fromValues(0,0,1)],N=[z.fromValues(0,1,0),z.fromValues(0,1,0),z.fromValues(0,0,-1),z.fromValues(0,0,1),z.fromValues(0,1,0)],P=z.zeros();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(a,c){function b(I,G){I[0]=G[0];I[1]=G[1];I[2]=G[2];I[3]=G[4];I[4]=G[5];I[5]=G[6];I[6]=G[8];I[7]=G[9];I[8]=G[10];return I}function t(I,G){I[0]=G[0];I[1]=G[1];I[2]=G[2];I[3]=G[3];I[4]=G[4];I[5]=G[5];I[6]=G[6];I[7]=G[7];I[8]=G[8];return I}function n(I,G,H,L,O,S,R,Q,V,aa){I[0]=G;I[1]=H;I[2]=L;I[3]=O;I[4]=S;I[5]=R;I[6]=Q;I[7]=V;I[8]=aa;return I}function r(I){I[0]=1;I[1]=0;I[2]=0;I[3]=0;I[4]=1;I[5]=
0;I[6]=0;I[7]=0;I[8]=1;return I}function m(I,G){if(I===G){const H=G[1],L=G[2],O=G[5];I[1]=G[3];I[2]=G[6];I[3]=H;I[5]=G[7];I[6]=L;I[7]=O}else I[0]=G[0],I[1]=G[3],I[2]=G[6],I[3]=G[1],I[4]=G[4],I[5]=G[7],I[6]=G[2],I[7]=G[5],I[8]=G[8];return I}function d(I,G){const H=G[0],L=G[1],O=G[2],S=G[3],R=G[4],Q=G[5],V=G[6],aa=G[7];G=G[8];const X=G*R-Q*aa,W=-G*S+Q*V,T=aa*S-R*V;let U=H*X+L*W+O*T;if(!U)return null;U=1/U;I[0]=X*U;I[1]=(-G*L+O*aa)*U;I[2]=(Q*L-O*R)*U;I[3]=W*U;I[4]=(G*H-O*V)*U;I[5]=(-Q*H+O*S)*U;I[6]=
T*U;I[7]=(-aa*H+L*V)*U;I[8]=(R*H-L*S)*U;return I}function f(I,G){const H=G[0],L=G[1],O=G[2],S=G[3],R=G[4],Q=G[5],V=G[6],aa=G[7];G=G[8];I[0]=R*G-Q*aa;I[1]=O*aa-L*G;I[2]=L*Q-O*R;I[3]=Q*V-S*G;I[4]=H*G-O*V;I[5]=O*S-H*Q;I[6]=S*aa-R*V;I[7]=L*V-H*aa;I[8]=H*R-L*S;return I}function e(I){const G=I[3],H=I[4],L=I[5],O=I[6],S=I[7],R=I[8];return I[0]*(R*H-L*S)+I[1]*(-R*G+L*O)+I[2]*(S*G-H*O)}function g(I,G,H){const L=G[0],O=G[1],S=G[2],R=G[3],Q=G[4],V=G[5],aa=G[6],X=G[7];G=G[8];const W=H[0],T=H[1],U=H[2],Y=H[3],
ba=H[4],da=H[5],ea=H[6],ca=H[7];H=H[8];I[0]=W*L+T*R+U*aa;I[1]=W*O+T*Q+U*X;I[2]=W*S+T*V+U*G;I[3]=Y*L+ba*R+da*aa;I[4]=Y*O+ba*Q+da*X;I[5]=Y*S+ba*V+da*G;I[6]=ea*L+ca*R+H*aa;I[7]=ea*O+ca*Q+H*X;I[8]=ea*S+ca*V+H*G;return I}function h(I,G,H){const L=G[0],O=G[1],S=G[2],R=G[3],Q=G[4],V=G[5],aa=G[6],X=G[7];G=G[8];const W=H[0];H=H[1];I[0]=L;I[1]=O;I[2]=S;I[3]=R;I[4]=Q;I[5]=V;I[6]=W*L+H*R+aa;I[7]=W*O+H*Q+X;I[8]=W*S+H*V+G;return I}function l(I,G,H){const L=G[0],O=G[1],S=G[2],R=G[3],Q=G[4],V=G[5],aa=G[6],X=G[7];
G=G[8];const W=Math.sin(H);H=Math.cos(H);I[0]=H*L+W*R;I[1]=H*O+W*Q;I[2]=H*S+W*V;I[3]=H*R-W*L;I[4]=H*Q-W*O;I[5]=H*V-W*S;I[6]=aa;I[7]=X;I[8]=G;return I}function v(I,G,H){const L=H[0],O=H[1];H=H[2];I[0]=L*G[0];I[1]=L*G[1];I[2]=L*G[2];I[3]=O*G[3];I[4]=O*G[4];I[5]=O*G[5];I[6]=H*G[6];I[7]=H*G[7];I[8]=H*G[8];return I}function q(I,G,H){const L=H[0];H=H[1];I[0]=L*G[0];I[1]=L*G[1];I[2]=L*G[2];I[3]=H*G[3];I[4]=H*G[4];I[5]=H*G[5];return I}function k(I,G){I[0]=1;I[1]=0;I[2]=0;I[3]=0;I[4]=1;I[5]=0;I[6]=G[0];I[7]=
G[1];I[8]=1;return I}function p(I,G){const H=Math.sin(G);G=Math.cos(G);I[0]=G;I[1]=H;I[2]=0;I[3]=-H;I[4]=G;I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function z(I,G){I[0]=G[0];I[1]=0;I[2]=0;I[3]=0;I[4]=G[1];I[5]=0;I[6]=0;I[7]=0;I[8]=1;return I}function C(I,G){I[0]=G[0];I[1]=G[1];I[2]=0;I[3]=G[2];I[4]=G[3];I[5]=0;I[6]=G[4];I[7]=G[5];I[8]=1;return I}function B(I,G){var H=G[0],L=G[1],O=G[2];G=G[3];var S=H+H,R=L+L;const Q=O+O;H*=S;const V=L*S;L*=R;const aa=O*S,X=O*R;O*=Q;S*=G;R*=G;G*=Q;I[0]=1-L-O;I[3]=V-G;
I[6]=aa+R;I[1]=V+G;I[4]=1-H-O;I[7]=X-S;I[2]=aa-R;I[5]=X+S;I[8]=1-H-L;return I}function A(I,G){const H=G[0],L=G[1],O=G[2],S=G[4],R=G[5],Q=G[6],V=G[8],aa=G[9];G=G[10];const X=G*R-Q*aa,W=-G*S+Q*V,T=aa*S-R*V;var U=H*X+L*W+O*T;if(!U)return null;U=1/U;I[0]=X*U;I[1]=(-G*L+O*aa)*U;I[2]=(Q*L-O*R)*U;I[3]=W*U;I[4]=(G*H-O*V)*U;I[5]=(-Q*H+O*S)*U;I[6]=T*U;I[7]=(-aa*H+L*V)*U;I[8]=(R*H-L*S)*U;return I}function x(I,G){const H=G[0],L=G[1],O=G[2],S=G[3],R=G[4],Q=G[5],V=G[6],aa=G[7];var X=G[8],W=G[9],T=G[10],U=G[11];
const Y=G[12],ba=G[13],da=G[14];G=G[15];const ea=H*Q-L*R,ca=H*V-O*R,ja=H*aa-S*R,ia=L*V-O*Q,Z=L*aa-S*Q,ha=O*aa-S*V,fa=X*ba-W*Y,ka=X*da-T*Y;X=X*G-U*Y;const la=W*da-T*ba;W=W*G-U*ba;T=T*G-U*da;U=ea*T-ca*W+ja*la+ia*X-Z*ka+ha*fa;if(!U)return null;U=1/U;I[0]=(Q*T-V*W+aa*la)*U;I[1]=(V*X-R*T-aa*ka)*U;I[2]=(R*W-Q*X+aa*fa)*U;I[3]=(O*W-L*T-S*la)*U;I[4]=(H*T-O*X+S*ka)*U;I[5]=(L*X-H*W-S*fa)*U;I[6]=(ba*ha-da*Z+G*ia)*U;I[7]=(da*ja-Y*ha-G*ca)*U;I[8]=(Y*Z-ba*ja+G*ea)*U;return I}function u(I,G,H){I[0]=2/G;I[1]=0;I[2]=
0;I[3]=0;I[4]=-2/H;I[5]=0;I[6]=-1;I[7]=1;I[8]=1;return I}function y(I){return"mat3("+I[0]+", "+I[1]+", "+I[2]+", "+I[3]+", "+I[4]+", "+I[5]+", "+I[6]+", "+I[7]+", "+I[8]+")"}function w(I){return Math.sqrt(I[0]**2+I[1]**2+I[2]**2+I[3]**2+I[4]**2+I[5]**2+I[6]**2+I[7]**2+I[8]**2)}function D(I,G,H){I[0]=G[0]+H[0];I[1]=G[1]+H[1];I[2]=G[2]+H[2];I[3]=G[3]+H[3];I[4]=G[4]+H[4];I[5]=G[5]+H[5];I[6]=G[6]+H[6];I[7]=G[7]+H[7];I[8]=G[8]+H[8];return I}function F(I,G,H){I[0]=G[0]-H[0];I[1]=G[1]-H[1];I[2]=G[2]-H[2];
I[3]=G[3]-H[3];I[4]=G[4]-H[4];I[5]=G[5]-H[5];I[6]=G[6]-H[6];I[7]=G[7]-H[7];I[8]=G[8]-H[8];return I}function E(I,G,H){I[0]=G[0]*H;I[1]=G[1]*H;I[2]=G[2]*H;I[3]=G[3]*H;I[4]=G[4]*H;I[5]=G[5]*H;I[6]=G[6]*H;I[7]=G[7]*H;I[8]=G[8]*H;return I}function K(I,G,H,L){I[0]=G[0]+H[0]*L;I[1]=G[1]+H[1]*L;I[2]=G[2]+H[2]*L;I[3]=G[3]+H[3]*L;I[4]=G[4]+H[4]*L;I[5]=G[5]+H[5]*L;I[6]=G[6]+H[6]*L;I[7]=G[7]+H[7]*L;I[8]=G[8]+H[8]*L;return I}function J(I,G){return I[0]===G[0]&&I[1]===G[1]&&I[2]===G[2]&&I[3]===G[3]&&I[4]===G[4]&&
I[5]===G[5]&&I[6]===G[6]&&I[7]===G[7]&&I[8]===G[8]}function M(I,G){const H=I[0],L=I[1],O=I[2],S=I[3],R=I[4],Q=I[5],V=I[6],aa=I[7];I=I[8];const X=G[0],W=G[1],T=G[2],U=G[3],Y=G[4],ba=G[5],da=G[6],ea=G[7];G=G[8];const ca=c.getEpsilon();return Math.abs(H-X)<=ca*Math.max(1,Math.abs(H),Math.abs(X))&&Math.abs(L-W)<=ca*Math.max(1,Math.abs(L),Math.abs(W))&&Math.abs(O-T)<=ca*Math.max(1,Math.abs(O),Math.abs(T))&&Math.abs(S-U)<=ca*Math.max(1,Math.abs(S),Math.abs(U))&&Math.abs(R-Y)<=ca*Math.max(1,Math.abs(R),
Math.abs(Y))&&Math.abs(Q-ba)<=ca*Math.max(1,Math.abs(Q),Math.abs(ba))&&Math.abs(V-da)<=ca*Math.max(1,Math.abs(V),Math.abs(da))&&Math.abs(aa-ea)<=ca*Math.max(1,Math.abs(aa),Math.abs(ea))&&Math.abs(I-G)<=ca*Math.max(1,Math.abs(I),Math.abs(G))}function N(I){const G=c.getEpsilon(),H=I[0],L=I[1],O=I[2],S=I[3],R=I[4],Q=I[5],V=I[6],aa=I[7];I=I[8];return Math.abs(1-(H*H+S*S+V*V))<=G&&Math.abs(1-(L*L+R*R+aa*aa))<=G&&Math.abs(1-(O*O+Q*Q+I*I))<=G}const P=Object.freeze(Object.defineProperty({__proto__:null,add:D,
adjoint:f,copy:t,determinant:e,equals:M,exactEquals:J,frob:w,fromMat2d:C,fromMat4:b,fromQuat:B,fromRotation:p,fromScaling:z,fromTranslation:k,identity:r,invert:d,isOrthoNormal:N,mul:g,multiply:g,multiplyScalar:E,multiplyScalarAndAdd:K,normalFromMat4:x,normalFromMat4Legacy:A,projection:u,rotate:l,scale:v,scaleByVec2:q,set:n,str:y,sub:F,subtract:F,translate:h,transpose:m},Symbol.toStringTag,{value:"Module"}));a.add=D;a.adjoint=f;a.copy=t;a.determinant=e;a.equals=M;a.exactEquals=J;a.frob=w;a.fromMat2d=
C;a.fromMat4=b;a.fromQuat=B;a.fromRotation=p;a.fromScaling=z;a.fromTranslation=k;a.identity=r;a.invert=d;a.isOrthoNormal=N;a.mat3=P;a.mul=g;a.multiply=g;a.multiplyScalar=E;a.multiplyScalarAndAdd=K;a.normalFromMat4=x;a.normalFromMat4Legacy=A;a.projection=u;a.rotate=l;a.scale=v;a.scaleByVec2=q;a.set=n;a.str=y;a.sub=F;a.subtract=F;a.translate=h;a.transpose=m})},"esri/chunks/Clouds.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/mathUtils ../core/maybe ./mat3f64 ./vec2 ./vec2f64 ../views/3d/environment/CloudsPresets ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){function z(u){const y=new k.ShaderBuilder;y.include(g.ScreenSpacePass,!1);const w=y.fragment;w.uniforms.add([new l.FloatPassUniform("cloudRadius",D=>D.cloudRadius),new l.FloatPassUniform("power",D=>b.lerp(35,120,D.absorption)),new l.FloatPassUniform("sigmaE",D=>1+D.absorption),new l.FloatPassUniform("density",D=>b.lerp(0,.3,D.density)),new l.FloatPassUniform("cloudSize",D=>b.lerp(0,.02,Math.max(.01,1-D.cloudSize))),new l.FloatPassUniform("detailSize",D=>
b.lerp(0,.2,Math.max(.01,1-D.detailSize))),new l.FloatPassUniform("smoothness",D=>b.lerp(0,.5,1-D.smoothness)),new l.FloatPassUniform("cloudHeight",D=>b.lerp(0,1500,D.cloudHeight)),new l.FloatPassUniform("coverage",D=>D.coverage),new q.Matrix3DrawUniform("view",D=>D.viewMatrix),new p.Texture2DPassUniform("cloudShapeTexture",D=>t.isSome(D.noiseTexture)?D.noiseTexture.textureAtlas:null),new h.Float2PassUniform("cloudVariables",D=>r.set(A,D.coverage,D.absorption))]);w.constants.add("halfCubeMapSize",
"float",.5*u.cubeMapSize);w.code.add(v.glsl`
    const int STEPS = ${u.steps===f.RayMarchingSteps.SIXTEEN?v.glsl`16`:u.steps===f.RayMarchingSteps.HUNDRED?v.glsl`100`:v.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);w.code.add(v.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${v.glsl.float(e.ATLAS_SIZE)};
      const float dataWidth = ${v.glsl.float(e.ATLAS_SIZE)};
      const float tileRows = ${v.glsl.float(e.TILE_ROWS)};
      const vec3 atlasDimensions = vec3(${v.glsl.float(e.TILE_SIZE)}, ${v.glsl.float(e.TILE_SIZE)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${v.glsl.float(e.TEXTURE_SCALE)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${v.glsl.float(e.WEATHER_MAP_SCALE)} * p) / ${v.glsl.float(e.ATLAS_SIZE)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `);w.code.add(v.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);w.code.add(v.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);w.code.add("\n    float multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      float luminance \x3d 0.0;\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
w.code.add(v.glsl`float lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
float beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);w.code.add(v.glsl`float mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return 0.0;
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
float shading = 0.0;
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
float luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
shading += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return shading;
}`);w.code.add(v.glsl`void main() {
if (coverage ==  0.0) {
gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);
return;
}
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
float hazeFactor = smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(dot(rayDir, vec3(0, 0, 1))));
float totalTransmittance = 1.0;
float shading = 0.0;
if (hitsPlanet) {
shading = clamp(1.0 - cloudVariables.y, 0.6, 1.0) * (1.0 - hazeFactor);
totalTransmittance = hazeFactor;
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
vec3 sunDirection = normalize(vec3(0, 0, 1));
shading = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance);
shading = mix(clamp(1.0 - cloudVariables.y, 0.6, 1.0), shading, hazeFactor);
totalTransmittance = mix(0.0, totalTransmittance, hazeFactor);
gl_FragColor = vec4(shading, totalTransmittance, shading, totalTransmittance);
}`);return y}let C=function(u){function y(){var w=u.apply(this,arguments)||this;w.cloudRadius=0;w.cloudSize=0;w.detailSize=0;w.absorption=0;w.density=0;w.smoothness=0;w.cloudHeight=0;w.coverage=0;w.raymarchingSteps=d.cloudPresets.default.raymarchingSteps;w.weatherTile=m.create();return w}c._inheritsLoose(y,u);return y}(v.NoParameters),B=function(u){function y(){var w=u.apply(this,arguments)||this;w.viewMatrix=n.create();return w}c._inheritsLoose(y,u);return y}(v.NoParameters);const A=m.create(),x=
Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:B,CloudsPassParameters:C,build:z},Symbol.toStringTag,{value:"Module"}));a.Clouds=x;a.CloudsDrawParameters=B;a.CloudsPassParameters=C;a.build=z})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","./CloudsTechniqueConfiguration"],function(a,c){let b=function(n,r,m,d,f,e,g,h,l=.5){this.coverage=n;this.density=r;this.absorption=m;this.cloudSize=d;this.detailSize=f;this.smoothness=e;this.cloudHeight=g;this.raymarchingSteps=
h;this.median=l};const t=new b([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],c.RayMarchingSteps.SIXTEEN);c={sunny:t,cloudy:new b([.3,.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],c.RayMarchingSteps.TWOHUNDRED,.6),rainy:new b([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],c.RayMarchingSteps.TWOHUNDRED,.4),snowy:new b([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],c.RayMarchingSteps.HUNDRED,.65),foggy:new b([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,
.3],c.RayMarchingSteps.SIXTEEN),default:t};a.CloudPresets=b;a.cloudPresets=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/has ./CloudsData ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration".split(" "),function(a,c,b,t,n,r){a.RayMarchingSteps=void 0;(function(d){d[d.SIXTEEN=0]="SIXTEEN";d[d.HUNDRED=1]=
"HUNDRED";d[d.TWOHUNDRED=2]="TWOHUNDRED";d[d.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));let m=function(d){function f(){var e=d.apply(this,arguments)||this;e.steps=a.RayMarchingSteps.SIXTEEN;e.writeTextureChannels=n.CloudsTextureChannels.RG;return e}c._inheritsLoose(f,d);return f}(r.ShaderTechniqueConfiguration);b.__decorate([r.parameter({count:a.RayMarchingSteps.COUNT})],m.prototype,"steps",void 0);b.__decorate([r.parameter({constValue:t("esri-mobile")?1024:2048})],m.prototype,
"cubeMapSize",void 0);b.__decorate([r.parameter()],m.prototype,"writeTextureChannels",void 0);a.CloudsTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports","../../../core/has"],function(a,c){c=c("esri-mobile")?64:128;const b=Math.ceil(Math.sqrt(c)),t=(c+2)*b;a.ATLAS_SIZE=t;a.TEXTURE_SCALE=c/128;a.TILE_ROWS=b;a.TILE_SIZE=c;a.WEATHER_MAP_SCALE=t/1560;a.WEATHER_MAP_SIZE=1E5;a.WEATHER_TILE_SIZE=
128;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,c,b){a.ScreenSpacePass=function(t,n=!0){t.attributes.add(b.VertexAttribute.POSITION,"vec2");n&&t.varyings.add("uv","vec2");t.vertex.code.add(c.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${n?c.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"mat3",t.BindType.Draw,(f,e,g)=>f.setUniformMatrix3fv(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Matrix3DrawUniform=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Clouds.glsl ./CloudsData ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){m=function(h){function l(q,k){var p;return p=
h.call(this,q,k,()=>p.destroy())||this}b._inheritsLoose(l,h);var v=l.prototype;v.initializeProgram=function(q){return new f.Program(q.rctx,l.shader.get().build(this.configuration),d.Default3D)};v.initializePipeline=function(){return g.makePipelineState({blending:g.simpleBlendingParams(e.BlendFactor.CONSTANT_COLOR,e.BlendFactor.ONE_MINUS_CONSTANT_COLOR,e.BlendOperation.ADD,this.configuration.writeTextureChannels===n.CloudsTextureChannels.RG?[1,1,0,0]:[0,0,1,1]),depthTest:{func:e.CompareFunction.LEQUAL},
colorWrite:g.defaultColorWriteParams})};return l}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(t.Clouds,()=>new Promise((h,l)=>a(["./Clouds.glsl"],h,l)));c.CloudsTechnique=m;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){a.NoiseTextureAtlas=function(z){function C(A){var x=z.call(this,A)||this;x._needsRender=!0;x._passParameters=new g.NoiseTextureAtlasPassParameters;x._frameBuffer=new p.FramebufferObject(A.context.renderContext.rctx,{colorTarget:k.TargetType.TEXTURE,width:l.ATLAS_SIZE,height:l.ATLAS_SIZE},{target:k.TextureType.TEXTURE_2D,pixelFormat:k.PixelFormat.RGBA,dataType:k.PixelType.UNSIGNED_BYTE,wrapMode:k.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:k.TextureSamplingMode.LINEAR,
hasMipmap:!1,width:l.ATLAS_SIZE,height:l.ATLAS_SIZE});x._vao=q.createQuadVAO(A.context.renderContext.rctx);return x}c._inheritsLoose(C,z);var B=C.prototype;B._setDirty=function(){this._needsRender=!0};B.updateWeatherMap=function(A){if(this._passParameters.weatherTile[0]!==A[0]||this._passParameters.weatherTile[1]!==A[1])e.copy(this._passParameters.weatherTile,A),this._setDirty()};B.destroy=function(){this._fullTechniqueCached=n.releaseMaybe(this._fullTechniqueCached);this._weatherMapTechniqueCached=
n.releaseMaybe(this._weatherMapTechniqueCached);this._frameBuffer=n.disposeMaybe(this._frameBuffer);this._vao=n.disposeMaybe(this._vao)};B._render=function(A){if(n.isNone(this._vao)||n.isNone(this._frameBuffer))return null;var x=A===h.NoiseTextureRenderMode.Full?this._fullTechnique:this._weatherMapTechnique;A=this.context.renderContext.rctx;const u=A.getViewport();A.setViewport(0,0,l.ATLAS_SIZE,l.ATLAS_SIZE);A.bindFramebuffer(this._frameBuffer);x=A.bindTechnique(x,this._passParameters,null);A.bindVAO(this._vao);
x.assertCompatibleVertexAttributeLocations(this._vao);A.gl.drawArrays(A.gl.TRIANGLE_STRIP,0,4);A.setViewport(u.x,u.y,u.width,u.height);this._needsRender=!1;return this._frameBuffer.colorTexture};c._createClass(C,[{key:"_techniqueRepository",get:function(){return this.context.techniqueRepository}},{key:"textureAtlas",get:function(){n.isSome(this._texture)?n.isSome(this._weatherMapTechnique)&&this._weatherMapTechnique.compiled&&this._needsRender&&(this._texture=this._render(h.NoiseTextureRenderMode.WeatherMap)):
n.isSome(this._fullTechnique)&&this._fullTechnique.compiled&&(this._texture=this._render(h.NoiseTextureRenderMode.Full));return this._texture}},{key:"_fullTechnique",get:function(){if(n.isNone(this._fullTechniqueCached)){const A=new h.NoiseTextureAtlasTechniqueConfiguration;A.mode=h.NoiseTextureRenderMode.Full;this._fullTechniqueCached=this._techniqueRepository.acquire(v.NoiseTextureAtlasTechnique,A)}return this._fullTechniqueCached}},{key:"_weatherMapTechnique",get:function(){if(n.isNone(this._weatherMapTechniqueCached)){const A=
new h.NoiseTextureAtlasTechniqueConfiguration;A.mode=h.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechniqueCached=this._techniqueRepository.acquire(v.NoiseTextureAtlasTechnique,A)}return this._weatherMapTechniqueCached}}]);return C}(t);b.__decorate([r.property({constructOnly:!0})],a.NoiseTextureAtlas.prototype,"context",void 0);b.__decorate([r.property({readOnly:!0})],a.NoiseTextureAtlas.prototype,"_techniqueRepository",null);a.NoiseTextureAtlas=b.__decorate([f.subclass("esri.views.3d.environment.NoiseTextureAtlas")],
a.NoiseTextureAtlas);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,c,b,t,n,r,m,d,f){function e(l){const v=new f.ShaderBuilder;v.include(r.ScreenSpacePass,!1);v.fragment.code.add(d.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);l.mode===t.NoiseTextureRenderMode.Full&&v.fragment.code.add(d.glsl`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${d.glsl.float(n.TILE_ROWS)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${d.glsl.float(8)});

      float worley0 = worley(p, ${d.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${d.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${d.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${d.glsl.float(2)});
      float worley1 = worley(p, ${d.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${d.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${d.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);v.fragment.uniforms.add(new m.Float2PassUniform("weatherTile",q=>q.weatherTile));v.fragment.code.add(d.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${d.glsl.float(n.WEATHER_TILE_SIZE)});

      // Get global coordinates of p
      p += weatherTile * ${d.glsl.float(n.WEATHER_TILE_SIZE)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${d.glsl.float(n.WEATHER_MAP_SIZE)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);v.fragment.code.add(d.glsl`void main() {`);l.mode===t.NoiseTextureRenderMode.Full&&v.fragment.code.add(d.glsl`
        float padWidth = 1.0;
        float paddedSize = ${d.glsl.float(n.TILE_SIZE)} + 2.0 * padWidth;
        float tileCount = ${d.glsl.float(n.TILE_ROWS)} * ${d.glsl.float(n.TILE_ROWS)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${d.glsl.float(n.TILE_SIZE)};
          }

          if (startPadY) {
            pixel.y += ${d.glsl.float(n.TILE_SIZE)};
          }

          if (endPadX) {
            pixel.x -= ${d.glsl.float(n.TILE_SIZE)};
          }

          if (endPadY) {
            pixel.y -= ${d.glsl.float(n.TILE_SIZE)};
          }

          uv = vec2(pixel.xy / ${d.glsl.float(n.TILE_SIZE)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${d.glsl.float(n.TILE_SIZE)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${d.glsl.float(n.TILE_ROWS)} * ${d.glsl.float(n.TILE_ROWS)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${d.glsl.float(n.TILE_ROWS)} * ${d.glsl.float(n.TILE_ROWS)});
        p = p_;
        p.z /= (${d.glsl.float(n.TILE_ROWS)} * ${d.glsl.float(n.TILE_ROWS)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `);v.fragment.code.add(d.glsl`
      vec2 mapUV = ${d.glsl.float(n.WEATHER_TILE_SIZE)} * (gl_FragCoord.xy / ${d.glsl.float(n.ATLAS_SIZE)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${l.mode===t.NoiseTextureRenderMode.Full?d.glsl`gl_FragColor.ba = vec2(0.0, map);`:d.glsl`gl_FragColor = vec4(map);`};
    }
  `);return v}let g=function(l){function v(){var q=l.apply(this,arguments)||this;q.weatherTile=b.fromValues(0,0);return q}c._inheritsLoose(v,l);return v}(d.NoParameters);const h=Object.freeze(Object.defineProperty({__proto__:null,NoiseTextureAtlasPassParameters:g,build:e},Symbol.toStringTag,{value:"Module"}));a.NoiseTextureAtlas=h;a.NoiseTextureAtlasPassParameters=g;a.build=e})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,c,b,t){a.NoiseTextureRenderMode=void 0;(function(r){r[r.Full=0]="Full";r[r.WeatherMap=1]="WeatherMap";r[r.COUNT=2]="COUNT"})(a.NoiseTextureRenderMode||(a.NoiseTextureRenderMode={}));let n=function(r){function m(){var d=r.apply(this,arguments)||this;d.mode=a.NoiseTextureRenderMode.Full;return d}c._inheritsLoose(m,r);return m}(t.ShaderTechniqueConfiguration);b.__decorate([t.parameter({count:a.NoiseTextureRenderMode.COUNT})],
n.prototype,"mode",void 0);a.NoiseTextureAtlasTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){m=function(h){function l(){return h.apply(this,arguments)||this}b._inheritsLoose(l,h);var v=l.prototype;v.initializeProgram=function(q){return new f.Program(q.rctx,l.shader.get().build(this.configuration),d.Default3D)};v.initializePipeline=function(){return g.makePipelineState({blending:this.configuration.mode===n.NoiseTextureRenderMode.Full?g.simpleBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO):g.separateBlendingParams(e.BlendFactor.ZERO,e.BlendFactor.ONE,e.BlendFactor.ONE,
e.BlendFactor.ZERO),depthTest:{func:e.CompareFunction.ALWAYS},colorWrite:g.defaultColorWriteParams})};return l}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(t.NoiseTextureAtlas,()=>new Promise((h,l)=>a(["./NoiseTextureAtlas.glsl"],h,l)));c.NoiseTextureAtlasTechnique=m;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./context-util ./enums ./Renderbuffer ./Texture ./Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){function h(C){return null!=C&&"type"in C&&"texture"===C.type}function l(C){return null!=C&&"type"in C&&"renderbuffer"===C.type}function v(C){return h(C)||null!=C&&"pixelFormat"in C}function q(C,B){C.target!==d.TextureType.TEXTURE_2D&&C.target!==d.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");void 0!==B.width&&0<=B.width&&void 0!==B.height&&0<=B.height?B.width===C.width&&B.height===C.height||console.error("Color attachment texture must match the framebuffer's!"):
(B.width=C.width,B.height=C.height)}function k(C,B){void 0!==B.width&&0<=B.width&&void 0!==B.height&&0<=B.height?B.width===C.width&&B.height===C.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(B.width=C.width,B.height=C.height)}function p(C){return C.descriptor.target===d.TextureType.TEXTURE_CUBE_MAP?d.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:d.TextureType.TEXTURE_2D}let z=function(){function C(A,x,u=null,y=null){this._context=A;this._stencilAttachment=this._depthAttachment=
this._glName=null;this._colorAttachments=new Map;this._depthStencilTexture=null;this._initialized=!1;this._desc={...x};A.instanceCounter.increment(d.ResourceType.FramebufferObject,this);if(t.isSome(u))for(Array.isArray(u)||(u=[u]),A=0;A<u.length;++A){x=u[A];const w=d.ColorAttachment.COLOR_ATTACHMENT0+A;let D;v(x)?(h(x)?(D=x.descriptor,this._colorAttachments.set(w,x)):(D=x,this._colorAttachments.set(w,new e.Texture(this._context,D))),q(D,this._desc)):(l(x)?(D=x.descriptor,this._colorAttachments.set(w,
x)):(D=x,this._colorAttachments.set(w,new f.Renderbuffer(this._context,D))),k(D,this._desc));this._validateColorAttachmentPoint(w)}t.isSome(y)&&(v(y)?(this._context.capabilities.depthTexture||console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),h(y)?(u=y.descriptor,this._depthStencilTexture=y):(u=y,this._depthStencilTexture=new e.Texture(this._context,u)),q(u,this._desc)):(l(y)?u=y.descriptor:(u=y,y=new f.Renderbuffer(this._context,u)),A=this._desc.depthStencilTarget??
d.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER,A===d.DepthStencilTargetType.STENCIL_RENDER_BUFFER?this._stencilAttachment=y:A===d.DepthStencilTargetType.DEPTH_RENDER_BUFFER||A===d.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=y:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),this._desc.depthStencilTarget=A,k(u,this._desc)))}var B=C.prototype;B.dispose=function(){if(this._desc){var A=
this._context.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null);this._context.bindFramebuffer(A);this._context.instanceCounter.decrement(d.ResourceType.FramebufferObject,this);this._desc=null}};B.getColorTexture=function(A){return(A=this._colorAttachments.get(A))&&h(A)?A:null};B.attachColorTexture=function(A,x=d.ColorAttachment.COLOR_ATTACHMENT0){A&&(this._validateColorAttachmentPoint(x),
q(A.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(A.glName,x)),this._colorAttachments.set(x,A))};B.detachColorTexture=function(A=d.ColorAttachment.COLOR_ATTACHMENT0){const x=this._colorAttachments.get(A);if(h(x))return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,A)),this._colorAttachments.delete(A),x};B.setColorTextureTarget=function(A,x=d.ColorAttachment.COLOR_ATTACHMENT0){const u=
this._colorAttachments.get(x);h(u)&&this._framebufferTexture2D(u.glName,x,A)};B.attachDepthStencilTexture=function(A){if(!t.isNone(A)){var x=A.descriptor;x.pixelFormat!==d.PixelFormat.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");x.dataType!==d.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
q(x,this._desc);this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==d.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=d.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(A.glName,d.DepthStencilAttachment));this._depthStencilTexture=A}};B.detachDepthStencilTexture=function(){const A=this._depthStencilTexture;A&&this._initialized&&(this._context.bindFramebuffer(this),
this._framebufferTexture2D(null,d.DepthStencilAttachment));this._depthStencilTexture=null;return A};B.attachDepthStencilBuffer=function(A){if(!t.isNone(A)){var x=A.descriptor;x.internalFormat!==d.RenderbufferFormat.DEPTH_STENCIL&&x.internalFormat!==d.RenderbufferFormat.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat");k(x,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=x.internalFormat===d.RenderbufferFormat.DEPTH_STENCIL?d.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:
d.DepthStencilTargetType.DEPTH_RENDER_BUFFER;this._initialized&&(this._context.bindFramebuffer(this),x=this._context.gl,x.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===d.DepthStencilTargetType.DEPTH_RENDER_BUFFER?x.DEPTH_ATTACHMENT:x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,A.glName));this._depthAttachment=A}};B.detachDepthStencilBuffer=function(){const A=this._context.gl,x=this._depthAttachment;x&&this._initialized&&(this._context.bindFramebuffer(this),A.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,
this._desc.depthStencilTarget===d.DepthStencilTargetType.DEPTH_RENDER_BUFFER?A.DEPTH_ATTACHMENT:A.DEPTH_STENCIL_ATTACHMENT,A.RENDERBUFFER,null));this._depthAttachment=null;return x};B.detachAll=function(){this._colorAttachments.forEach((A,x)=>this._detachColorAttachment(x));this.detachDepthStencilBuffer();this.detachDepthStencilTexture()};B.copyToTexture=function(A,x,u,y,w,D,F){(0>A||0>x||0>w||0>D)&&console.error("Offsets cannot be negative!");(0>=u||0>=y)&&console.error("Copy width and height must be greater than zero!");
var E=this._desc;const K=F.descriptor;F.descriptor.target!==d.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(null==E?.width||null==E?.height||null==K?.width||null==K?.height||A+u>E.width||x+y>E.height||w+u>K.width||D+y>K.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");E=this._context;F=E.bindTexture(F,e.Texture.TEXTURE_UNIT_FOR_UPDATES);E.setActiveTexture(e.Texture.TEXTURE_UNIT_FOR_UPDATES);E.bindFramebuffer(this);
E.gl.copyTexSubImage2D(d.TextureType.TEXTURE_2D,0,w,D,A,x,u,y);E.bindTexture(F,e.Texture.TEXTURE_UNIT_FOR_UPDATES)};B.readPixels=function(A,x,u,y,w,D,F){(0>=u||0>=y)&&console.error("Copy width and height must be greater than zero!");F||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(A,x,u,y,w,D,F)};B.readPixelsAsync=function(){var A=c._asyncToGenerator(function*(x,u,y,w,D,F,E){if(this._context.type!==m.ContextType.WEBGL2)r.webglDebugEnabled()&&
console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),this.readPixels(x,u,y,w,D,F,E);else{var K=this._context.gl,J=n.BufferObject.createPixelPack(this._context,d.Usage.STREAM_READ,E.byteLength);this._context.bindBuffer(J);this._context.bindFramebuffer(this);K.readPixels(x,u,y,w,D,F,0);this._context.unbindBuffer(d.BufferType.PIXEL_PACK_BUFFER);yield J.getSubDataAsync(E);J.dispose()}});return function(x,u,y,w,D,F,E){return A.apply(this,arguments)}}();B.resize=function(A,
x){const u=this._desc;if(u.width!==A||u.height!==x)if(u.width=A,u.height=x,this._initialized){this._colorAttachments.forEach(y=>{y&&y.resize(A,x)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(A,x);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(A,x),this._stencilAttachment&&this._stencilAttachment.resize(A,x);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=!1}else this._colorAttachments.forEach(y=>
{y&&y.resize(A,x)}),this._depthStencilTexture&&this._depthStencilTexture.resize(A,x)};B.initializeAndBind=function(A=d.FramebufferTarget.FRAMEBUFFER){const x=this._context.gl;if(this._initialized)x.bindFramebuffer(A,this.glName);else{this._glName&&x.deleteFramebuffer(this._glName);var u=this._context,y=x.createFramebuffer(),w=this._desc,D=w.colorTarget??d.TargetType.RENDER_BUFFER,F=w.width??1,E=w.height??1;x.bindFramebuffer(A,y);0===this._colorAttachments.size&&(D===d.TargetType.TEXTURE||D===d.TargetType.CUBEMAP?
this._colorAttachments.set(d.ColorAttachment.COLOR_ATTACHMENT0,new e.Texture(u,{target:this.descriptor.colorTarget===d.TargetType.CUBEMAP?d.TextureType.TEXTURE_CUBE_MAP:d.TextureType.TEXTURE_2D,pixelFormat:d.PixelFormat.RGBA,dataType:d.PixelType.UNSIGNED_BYTE,samplingMode:d.TextureSamplingMode.NEAREST,wrapMode:d.TextureWrapMode.CLAMP_TO_EDGE,width:w.width,height:w.height})):(D=new f.Renderbuffer(u,{internalFormat:d.SizedPixelFormat.RGBA4,width:F,height:E}),this._colorAttachments.set(d.ColorAttachment.COLOR_ATTACHMENT0,
D)));this._colorAttachments.forEach((K,J)=>{K&&(h(K)?this._framebufferTexture2D(K.glName,J,p(K),A):x.framebufferRenderbuffer(A,J,x.RENDERBUFFER,K.glName))});D=w.depthStencilTarget??d.DepthStencilTargetType.NONE;switch(D){case d.DepthStencilTargetType.DEPTH_RENDER_BUFFER:case d.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:this._depthAttachment||(this._depthAttachment=new f.Renderbuffer(u,{internalFormat:w.depthStencilTarget===d.DepthStencilTargetType.DEPTH_RENDER_BUFFER?d.RenderbufferFormat.DEPTH_COMPONENT16:
d.RenderbufferFormat.DEPTH_STENCIL,width:F,height:E}));x.framebufferRenderbuffer(A,D===d.DepthStencilTargetType.DEPTH_RENDER_BUFFER?x.DEPTH_ATTACHMENT:x.DEPTH_STENCIL_ATTACHMENT,x.RENDERBUFFER,this._depthAttachment.glName);break;case d.DepthStencilTargetType.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new f.Renderbuffer(u,{internalFormat:d.RenderbufferFormat.STENCIL_INDEX8,width:F,height:E}));x.framebufferRenderbuffer(A,x.STENCIL_ATTACHMENT,x.RENDERBUFFER,this._stencilAttachment.glName);
break;case d.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE:this._depthStencilTexture||(u.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new e.Texture(u,{target:d.TextureType.TEXTURE_2D,pixelFormat:d.PixelFormat.DEPTH_STENCIL,dataType:d.PixelType.UNSIGNED_INT_24_8,samplingMode:d.TextureSamplingMode.NEAREST,wrapMode:d.TextureWrapMode.CLAMP_TO_EDGE,width:F,
height:E})),this._framebufferTexture2D(this._depthStencilTexture.glName,x.DEPTH_STENCIL_ATTACHMENT,p(this._depthStencilTexture),A)}r.webglDebugEnabled()&&x.checkFramebufferStatus(A)!==x.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=y;this._initialized=!0}};B._framebufferTexture2D=function(A,x=d.ColorAttachment.COLOR_ATTACHMENT0,u=d.TextureType.TEXTURE_2D,y=d.FramebufferTarget.FRAMEBUFFER,w=0){this._context.gl.framebufferTexture2D(y,x,u,A,w)};B._detachColorAttachment=
function(A){r.webglDebugEnabled()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const x=this._context.gl,u=this._colorAttachments.get(A);h(u)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,A)):this._initialized&&(this._context.bindFramebuffer(this),x.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,A,x.RENDERBUFFER,null));this._colorAttachments.delete(A);return u};B._disposeColorAttachments=
function(){this._colorAttachments.forEach((A,x)=>{this._detachColorAttachment(x);A.dispose()});this._colorAttachments.clear()};B._disposeDepthStencilAttachments=function(){const A=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),A.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===d.DepthStencilTargetType.DEPTH_RENDER_BUFFER?A.DEPTH_ATTACHMENT:A.DEPTH_STENCIL_ATTACHMENT,A.RENDERBUFFER,null)),this._depthAttachment.dispose(),
this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),A.framebufferRenderbuffer(d.FramebufferTarget.FRAMEBUFFER,A.STENCIL_ATTACHMENT,A.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,A.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};B._validateColorAttachmentPoint=
function(A){if(-1===C._MAX_COLOR_ATTACHMENTS){const x=this._context.capabilities.drawBuffers;C._MAX_COLOR_ATTACHMENTS=x?this._context.gl.getParameter(x.MAX_COLOR_ATTACHMENTS):1}A-=d.ColorAttachment.COLOR_ATTACHMENT0;A+1>C._MAX_COLOR_ATTACHMENTS&&b.getLogger("esri.views.webgl.FrameBufferObject").error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${A+1}. Implementation supports up to ${C._MAX_COLOR_ATTACHMENTS} color attachments`)};c._createClass(C,[{key:"glName",get:function(){return this._glName}},
{key:"descriptor",get:function(){return this._desc}},{key:"colorTexture",get:function(){const A=this._colorAttachments.get(d.ColorAttachment.COLOR_ATTACHMENT0);return A&&h(A)?A:null}},{key:"colorAttachment",get:function(){return this._colorAttachments.get(d.ColorAttachment.COLOR_ATTACHMENT0)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",
get:function(){return this._desc.width??0}},{key:"height",get:function(){return this._desc.height??0}},{key:"gpuMemoryUsage",get:function(){return[...this._colorAttachments].reduce((A,[,x])=>A+g.getGpuMemoryUsage(x),0)+g.getGpuMemoryUsage(this.depthStencilAttachment)}}]);return C}();z._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe",
"./context-util","./enums"],function(a,c,b,t,n){let r=function(){function m(f,e){this._context=f;this._desc=e;this.type="renderbuffer";this._context.instanceCounter.increment(n.ResourceType.Renderbuffer,this);f=this._context.gl;this.glName=f.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:g,height:h,internalFormat:l,multisampled:v}=e;if(v){if(this._context.type!==t.ContextType.WEBGL2)throw Error("Multisampled renderbuffers are not supported in WebGL1!");f.renderbufferStorageMultisample(f.RENDERBUFFER,
this.samples,l,g,h)}else f.renderbufferStorage(f.RENDERBUFFER,l,g,h)}var d=m.prototype;d.resize=function(f,e){const g=this._desc;if(g.width!==f||g.height!==e)g.width=f,g.height=e,f=this._context.gl,this._context.bindRenderbuffer(this),g.multisampled?f.renderbufferStorageMultisample(f.RENDERBUFFER,this.samples,g.internalFormat,g.width,g.height):f.renderbufferStorage(f.RENDERBUFFER,g.internalFormat,g.width,g.height)};d.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),
this._context.instanceCounter.decrement(n.ResourceType.Renderbuffer,this),this._context=b.nullifyNonNullableForDispose(this._context))};c._createClass(m,[{key:"descriptor",get:function(){return this._desc}},{key:"samples",get:function(){const f=this._desc.samples,e=this._context.parameters.maxSamples;return f?Math.min(f,e):e}}]);return m}();a.Renderbuffer=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f64 ../../environment/CloudsCompositionParameters ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ./Camera ./RenderSlot ./TransparencyPassType ../lighting/SceneLighting".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){let h=function(){function l(v,q,k){this.shadowMap=v;this.ssaoHelper=q;this.slicePlane=k;this.slot=f.RenderSlot.OPAQUE_MATERIAL;this.hasOccludees=!1;this.enableFillLights=!0;this.transparencyPassType=e.TransparencyPassType.NONE;this._camera=new d.Camera;this._inverseViewport=b.create();this.oldLighting=new g.SceneLighting;this.newLighting=new g.SceneLighting;this._fadedLighting=new g.SceneLighting;this._lighting=this.newLighting;this.ssr=new m.SSRUniforms;this.multipassTerrain=
new r.MultipassTerrainUniforms;this.multipassGeometry=new n.MultipassGeometryUniforms;this.overlays=[];this.cloudsFade=new t.CloudsFadeParameters}l.prototype.fadeLighting=function(v){const {oldLighting:q,newLighting:k}=this;1<=v?this._lighting=k:(this._fadedLighting.lerpLighting(q,k,v),this._lighting=this._fadedLighting)};c._createClass(l,[{key:"camera",get:function(){return this._camera},set:function(v){this._camera=this.ssr.camera=v;this._inverseViewport[0]=1/v.fullViewport[2];this._inverseViewport[1]=
1/v.fullViewport[3]}},{key:"inverseViewport",get:function(){return this._inverseViewport}},{key:"lighting",get:function(){return this._lighting}},{key:"weatherFading",get:function(){return this._lighting===this._fadedLighting}}]);return l}();a.BindParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform",
"../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,c,b,t,n){a.MultipassGeometryUniforms=function(){this.enabled=!1};a.multipassGeometryTest=function(r){r.include(c.ReadLinearDepth);r.uniforms.add([new n.Texture2DPassUniform("geometryDepthTexture",(m,d)=>d.multipassGeometry.linearDepthTexture),new b.Float2PassUniform("nearFar",(m,d)=>d.camera.nearFar)]);r.code.add(t.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,c,b,t,n){a.MultipassTerrainUniforms=function(){this.cullAboveGround=this.enabled=!1};a.multipassTerrainTest=function(r,m){m.hasMultipassTerrain&&(r.fragment.include(c.ReadLinearDepth),
r.fragment.uniforms.add(new n.Texture2DPassUniform("terrainDepthTexture",(d,f)=>f.multipassTerrain.linearDepthTexture)),r.fragment.uniforms.add(new b.Float2PassUniform("nearFar",(d,f)=>f.camera.nearFar)),r.fragment.uniforms.add(new b.Float2PassUniform("inverseViewport",(d,f)=>f.inverseViewport)),r.fragment.code.add(t.glsl`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${m.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../../../../../../chunks/mat4f64 ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,c,b,t,n,r,m,d){a.SSRUniforms=function(){this.enabled=
!1;this.fadeFactor=1;this.reprojectionMatrix=c.create()};a.ScreenSpaceReflections=function(f,e){f=f.fragment;f.include(b.ReadLinearDepth);f.uniforms.add(new t.Float2PassUniform("nearFar",(g,h)=>h.camera.nearFar));f.uniforms.add(new d.Texture2DPassUniform("depthMap",(g,h)=>h.linearDepthTexture));f.uniforms.add(new m.Matrix4PassUniform("proj",(g,h)=>h.ssr.camera.projectionMatrix));f.uniforms.add(new n.FloatPassUniform("invResolutionHeight",(g,h)=>1/h.ssr.camera.height));f.uniforms.add(new m.Matrix4PassUniform("reprojectionMatrix",
(g,h)=>h.ssr.reprojectionMatrix));f.code.add(r.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${e.highStepCount?"150":"75"};

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./fov".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y){var w;a.Camera=w=function(M){function N(I={}){I=M.call(this,I)||this;I._center=p.create();I._up=p.create();I._viewUp=p.create();I._viewForward=p.create();I._viewRight=p.create();I._ray=A.create();I._viewport=C.fromValues(0,0,1,1);I._padding=C.fromValues(0,0,0,0);I._fov=55/180*Math.PI;I._nearFar=q.fromValues(1,1E3);I._viewDirty=!0;I._viewMatrix=l.create();I._viewProjectionDirty=!0;I._viewProjectionMatrix=l.create();I._viewInverseTransposeMatrixDirty=
!0;I._viewInverseTransposeMatrix=l.create();I._frustumDirty=!0;I._frustum=B.create();I._fullViewport=C.create();I._pixelRatio=1;I.relativeElevation=0;return I}c._inheritsLoose(N,M);var P=N.prototype;P.depthNDCToWorld=function(I){return 2*this.near*this.far/(this.far+this.near-(2*I-1)*(this.far-this.near))};P.copyFrom=function(I){k.copy(this._ray.origin,I.eye);this.center=I.center;this.up=I.up;z.copy(this._viewport,I.viewport);this.notifyChange("_viewport");z.copy(this._padding,I.padding);this.notifyChange("_padding");
v.copy(this._nearFar,I.nearFar);this.notifyChange("_nearFar");this._fov=I.fov;this.relativeElevation=I.relativeElevation;this._viewDirty=I._viewDirty;this._viewDirty||(h.copy(this._viewMatrix,I.viewMatrix),k.copy(this._viewRight,I.viewRight),k.copy(this._viewUp,I.viewUp),k.copy(this._viewForward,I.viewForward));this._viewProjectionDirty=!0;this._frustumDirty=I._frustumDirty;this._frustumDirty||(B.copy(this._frustum,I.frustum),this._frustumDirty=!1);I._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=
!0:(h.copy(this._viewInverseTransposeMatrix,I.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);z.copy(this._fullViewport,I.fullViewport);this.pixelRatio=I.pixelRatio;return this};P.copyViewFrom=function(I){this.eye=I.eye;this.center=I.center;this.up=I.up};P.clone=function(){return(new w).copyFrom(this)};P.equals=function(I){return k.exactEquals(this.eye,I.eye)&&k.exactEquals(this.center,I.center)&&k.exactEquals(this.up,I.up)&&z.exactEquals(this._viewport,I.viewport)&&z.exactEquals(this._padding,
I.padding)&&v.exactEquals(this.nearFar,I.nearFar)&&this._fov===I.fov&&this.pixelRatio===I.pixelRatio&&this.relativeElevation===I.relativeElevation};P.almostEquals=function(I){if(.001<=Math.abs(I.fov-this._fov)||.5<=z.squaredDistance(I.padding,this._padding)||.5<=z.squaredDistance(this.screenViewport,I.screenViewport))return!1;k.sub(E,I.eye,I.center);k.sub(K,this.eye,this.center);const G=k.dot(E,K),H=k.sqrLen(E),L=k.sqrLen(K);return G*G>=(1-1E-10)*H*L&&k.sqrDist(I.eye,this.eye)<2.5E-7*Math.max(H,L)};
P.computeRenderPixelSizeAt=function(I){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(I))};P.computeRenderPixelSizeAtDist=function(I){return I*this.perRenderPixelRatio};P.computeScreenPixelSizeAt=function(I){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(I))};P._viewDirectionDistance=function(I){return Math.abs(x.projectPointSignedLength(this.viewForward,k.subtract(E,I,this.eye)))};P.computeScreenPixelSizeAtDist=function(I){return I*this.perScreenPixelRatio};
P.computeDistanceFromRadius=function(I,G){return I/Math.tan(Math.min(this.fovX,this.fovY)/(2*(G||1)))};P.getScreenCenter=function(I=m.createScreenPointArray()){I[0]=(this.padding[a.PaddingSide.LEFT]+this.width/2)/this.pixelRatio;I[1]=(this.padding[a.PaddingSide.TOP]+this.height/2)/this.pixelRatio;return I};P.getRenderCenter=function(I,G=.5,H=.5){I[0]=this.padding[a.PaddingSide.LEFT]+this.width*G;I[1]=this.padding[a.PaddingSide.BOTTOM]+this.height*H;I[2]=.5;return I};P.setGLViewport=function(I){const G=
this.viewport,H=this.padding;I.setViewport(G[0]-H[3],G[1]-H[2],G[2]+H[1]+H[3],G[3]+H[0]+H[2])};P.applyProjection=function(I,G){I!==D&&k.copy(D,I);D[3]=1;z.transformMat4(D,D,this.projectionMatrix);I=Math.abs(D[3]);k.scale(D,D,1/I);const H=this.fullViewport;G[0]=r.lerp(0,H[0]+H[2],.5+.5*D[0]);G[1]=r.lerp(0,H[1]+H[3],.5+.5*D[1]);G[2]=.5*(D[2]+1);G[3]=I};P.unapplyProjection=function(I,G){const H=this.fullViewport;D[0]=(I[0]/(H[0]+H[2])*2-1)*I[3];D[1]=(I[1]/(H[1]+H[3])*2-1)*I[3];D[2]=(2*I[2]-1)*I[3];D[3]=
I[3];null!=this.inverseProjectionMatrix&&(z.transformMat4(D,D,this.inverseProjectionMatrix),G[0]=D[0],G[1]=D[1],G[2]=D[2])};P.projectToScreen=function(I,G){this.projectToRenderScreen(I,J);this.renderToScreen(J,G);return G};P.projectToRenderScreen=function(I,G){D[0]=I[0];D[1]=I[1];D[2]=I[2];D[3]=1;z.transformMat4(D,D,this.viewProjectionMatrix);if(0===D[3])return null;k.scale(D,D,1/Math.abs(D[3]));I=this.fullViewport;"x"in G?(G.x=r.lerp(0,I[0]+I[2],.5+.5*D[0]),G.y=r.lerp(0,I[1]+I[3],.5+.5*D[1])):(G[0]=
r.lerp(0,I[0]+I[2],.5+.5*D[0]),G[1]=r.lerp(0,I[1]+I[3],.5+.5*D[1]),2<G.length&&(G[2]=.5*(D[2]+1)));return G};P.unprojectFromScreen=function(I,G){return this.unprojectFromRenderScreen(this.screenToRender(I,J),G)};P.unprojectFromRenderScreen=function(I,G){h.multiply(F,this.projectionMatrix,this.viewMatrix);if(!h.invert(F,F))return null;const H=this.fullViewport;D[0]=2*(I[0]-H[0])/H[2]-1;D[1]=2*(I[1]-H[1])/H[3]-1;D[2]=2*I[2]-1;D[3]=1;z.transformMat4(D,D,F);if(0===D[3])return null;G[0]=D[0]/D[3];G[1]=
D[1]/D[3];G[2]=D[2]/D[3];return G};P.constrainWindowSize=function(I,G,H,L){I*=this.pixelRatio;G*=this.pixelRatio;return[Math.max(I-H/2,0),Math.max(this.fullHeight-G-L/2,0),H- -Math.min(I-H/2,0)- -Math.min(this.fullWidth-I-H/2,0),L- -Math.min(this.fullHeight-G-L/2,0)- -Math.min(G-L/2,0)]};P.computeUp=function(I){I===u.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()};P.screenToRender=function(I,G){const H=this.fullHeight-I[1]*this.pixelRatio;G[0]=I[0]*this.pixelRatio;G[1]=H;return G};
P.renderToScreen=function(I,G){const H=(this.fullHeight-I[1])/this.pixelRatio;G[0]=I[0]/this.pixelRatio;G[1]=H};P._computeUpGlobal=function(){k.subtract(E,this.center,this.eye);const I=k.length(this.center);1>I?(k.set(this._up,0,0,1),this._markViewDirty(),this.notifyChange("_up")):Math.abs(k.dot(E,this.center))>.9999*k.length(E)*I||(k.cross(this._up,E,this.center),k.cross(this._up,this._up,E),k.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())};P._computeUpLocal=function(){k.direction(E,
this.eye,this.center);.9999>=Math.abs(E[2])&&(k.scale(E,E,E[2]),k.set(this._up,-E[0],-E[1],1-E[2]),k.normalize(this._up,this._up),this.notifyChange("_up"),this._markViewDirty())};P._compareAndSetView=function(I,G,H=""){"number"===typeof I[0]&&isFinite(I[0])&&"number"===typeof I[1]&&isFinite(I[1])&&"number"===typeof I[2]&&isFinite(I[2])?k.exactEquals(I,G)||(k.copy(G,I),this._markViewDirty(),H.length&&this.notifyChange(H)):n.getLogger("esri.views.3d.webgl-engine.lib.Camera").warn("Camera vector contains invalid number, ignoring value")};
P._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};P._recomputeFrustum=function(){this._frustumDirty&&(B.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};P._ensureViewClean=function(){this._viewDirty&&(h.lookAt(this._viewMatrix,this.eye,this.center,this.up),k.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),k.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),
k.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};c._createClass(N,[{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(I){this._pixelRatio=0<I?I:1}},{key:"eye",get:function(){return this._ray.origin},set:function(I){this._compareAndSetView(I,this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(I){this._compareAndSetView(I,this._center,"_center")}},{key:"ray",
get:function(){k.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(I){this._compareAndSetView(I,this._up,"_up")}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},set:function(I){h.copy(this._viewMatrix,I);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},
{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(I){this._nearFar[0]!==I&&(this._nearFar[0]=I,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}},{key:"far",get:function(){return this._nearFar[1]},set:function(I){this._nearFar[1]!==I&&(this._nearFar[1]=
I,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_nearFar"))}},{key:"viewport",get:function(){return this._viewport},set:function(I){this.x=I[0];this.y=I[1];this.width=I[2];this.height=I[3]}},{key:"screenViewport",get:function(){if(1===this.pixelRatio)return this._viewport;const I=z.scale(C.create(),this._viewport,1/this.pixelRatio),G=this._get("screenViewport");return G&&z.equals(I,G)?G:I}},{key:"x",get:function(){return this._viewport[0]},set:function(I){I+=this._padding[a.PaddingSide.LEFT];
this._viewport[0]!==I&&(this._viewport[0]=I,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"y",get:function(){return this._viewport[1]},set:function(I){I+=this._padding[a.PaddingSide.BOTTOM];this._viewport[1]!==I&&(this._viewport[1]=I,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"width",get:function(){return this._viewport[2]},set:function(I){this._viewport[2]!==I&&(this._viewport[2]=I,this._frustumDirty=this._viewProjectionDirty=
!0,this.notifyChange("_viewport"))}},{key:"height",get:function(){return this._viewport[3]},set:function(I){this._viewport[3]!==I&&(this._viewport[3]=I,this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_viewport"))}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]},set:function(I){this.width=I-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT])}},{key:"fullHeight",get:function(){return this._viewport[3]+
this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]},set:function(I){this.height=I-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM])}},{key:"fullViewport",get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[a.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[a.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},{key:"_aspect",get:function(){return this.width/
this.height}},{key:"padding",get:function(){return this._padding},set:function(I){z.exactEquals(this._padding,I)||(this._viewport[0]+=I[a.PaddingSide.LEFT]-this._padding[a.PaddingSide.LEFT],this._viewport[1]+=I[a.PaddingSide.BOTTOM]-this._padding[a.PaddingSide.BOTTOM],this._viewport[2]-=I[a.PaddingSide.RIGHT]+I[a.PaddingSide.LEFT]-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]),this._viewport[3]-=I[a.PaddingSide.TOP]+I[a.PaddingSide.BOTTOM]-(this._padding[a.PaddingSide.TOP]+
this._padding[a.PaddingSide.BOTTOM]),z.copy(this._padding,I),this._frustumDirty=this._viewProjectionDirty=!0,this.notifyChange("_padding"),this.notifyChange("_viewport"))}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(h.multiply(this._viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){var I=this.width,G=this.height;const H=this.near*Math.tan(this.fovY/2),L=H*
this._aspect;I=h.frustum(l.create(),-L*(1+2*this._padding[a.PaddingSide.LEFT]/I),L*(1+2*this._padding[a.PaddingSide.RIGHT]/I),-H*(1+2*this._padding[a.PaddingSide.BOTTOM]/G),H*(1+2*this._padding[a.PaddingSide.TOP]/G),this.near,this.far);return(G=this._get("projectionMatrix"))&&h.equals(G,I)?G:I}},{key:"inverseProjectionMatrix",get:function(){return h.invert(l.create(),this.projectionMatrix)||this._get("inverseProjectionMatrix")||l.create()}},{key:"fov",get:function(){return this._fov},set:function(I){this._fov=
I;this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fovX",get:function(){return y.fovd2fovx(this._fov,this.width,this.height)},set:function(I){this._fov=y.fovx2fovd(I,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}},{key:"fovY",get:function(){return y.fovd2fovy(this._fov,this.width,this.height)},set:function(I){this._fov=y.fovy2fovd(I,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=!0}},{key:"distance",get:function(){return k.distance(this.center,
this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)h.invert(this._viewInverseTransposeMatrix,this.viewMatrix),h.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/
2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this.pixelRatio}},{key:"aboveGround",get:function(){return null!=this.relativeElevation&&0<=this.relativeElevation}}]);return N}(t);b.__decorate([d.property()],a.Camera.prototype,"_center",void 0);b.__decorate([d.property()],a.Camera.prototype,"_up",void 0);b.__decorate([d.property()],a.Camera.prototype,"_viewport",void 0);b.__decorate([d.property()],a.Camera.prototype,"_padding",void 0);b.__decorate([d.property()],a.Camera.prototype,
"_fov",void 0);b.__decorate([d.property()],a.Camera.prototype,"_nearFar",void 0);b.__decorate([d.property()],a.Camera.prototype,"_pixelRatio",void 0);b.__decorate([d.property()],a.Camera.prototype,"pixelRatio",null);b.__decorate([d.property()],a.Camera.prototype,"eye",null);b.__decorate([d.property()],a.Camera.prototype,"center",null);b.__decorate([d.property()],a.Camera.prototype,"up",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"nearFar",null);b.__decorate([d.property()],a.Camera.prototype,
"near",null);b.__decorate([d.property()],a.Camera.prototype,"far",null);b.__decorate([d.property()],a.Camera.prototype,"viewport",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"screenViewport",null);b.__decorate([d.property()],a.Camera.prototype,"x",null);b.__decorate([d.property()],a.Camera.prototype,"y",null);b.__decorate([d.property()],a.Camera.prototype,"width",null);b.__decorate([d.property()],a.Camera.prototype,"height",null);b.__decorate([d.property()],a.Camera.prototype,
"fullWidth",null);b.__decorate([d.property()],a.Camera.prototype,"fullHeight",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"_aspect",null);b.__decorate([d.property()],a.Camera.prototype,"padding",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"projectionMatrix",null);b.__decorate([d.property({readOnly:!0})],a.Camera.prototype,"inverseProjectionMatrix",null);b.__decorate([d.property()],a.Camera.prototype,"fov",null);b.__decorate([d.property()],a.Camera.prototype,
"fovX",null);b.__decorate([d.property()],a.Camera.prototype,"fovY",null);a.Camera=w=b.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.Camera")],a.Camera);const D=C.create(),F=l.create(),E=p.create(),K=p.create(),J=m.createRenderScreenPointArray3();a.PaddingSide=void 0;(function(M){M[M.TOP=0]="TOP";M[M.RIGHT=1]="RIGHT";M[M.BOTTOM=2]="BOTTOM";M[M.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(){return[n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]}function h(z,C){f.fromPoints(C[a.PointIndex.FAR_BOTTOM_LEFT],C[a.PointIndex.NEAR_BOTTOM_LEFT],C[a.PointIndex.NEAR_TOP_LEFT],z[a.PlaneIndex.LEFT]);f.fromPoints(C[a.PointIndex.NEAR_BOTTOM_RIGHT],C[a.PointIndex.FAR_BOTTOM_RIGHT],C[a.PointIndex.FAR_TOP_RIGHT],z[a.PlaneIndex.RIGHT]);f.fromPoints(C[a.PointIndex.FAR_BOTTOM_LEFT],C[a.PointIndex.FAR_BOTTOM_RIGHT],C[a.PointIndex.NEAR_BOTTOM_RIGHT],
z[a.PlaneIndex.BOTTOM]);f.fromPoints(C[a.PointIndex.NEAR_TOP_LEFT],C[a.PointIndex.NEAR_TOP_RIGHT],C[a.PointIndex.FAR_TOP_RIGHT],z[a.PlaneIndex.TOP]);f.fromPoints(C[a.PointIndex.NEAR_BOTTOM_LEFT],C[a.PointIndex.NEAR_BOTTOM_RIGHT],C[a.PointIndex.NEAR_TOP_RIGHT],z[a.PlaneIndex.NEAR]);f.fromPoints(C[a.PointIndex.FAR_BOTTOM_RIGHT],C[a.PointIndex.FAR_BOTTOM_LEFT],C[a.PointIndex.FAR_TOP_LEFT],z[a.PlaneIndex.FAR])}function l(z,C){for(let B=0;B<a.NumPlanes.NUM;B++)if(!f.clip(z[B],C))return!1;return!0}a.PlaneIndex=
void 0;(function(z){z[z.LEFT=0]="LEFT";z[z.RIGHT=1]="RIGHT";z[z.BOTTOM=2]="BOTTOM";z[z.TOP=3]="TOP";z[z.NEAR=4]="NEAR";z[z.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(z){z[z.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";z[z.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";z[z.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";z[z.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";z[z.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";z[z.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";z[z.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";z[z.FAR_TOP_LEFT=
7]="FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const v={bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,
a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]};a.NumPlanes=void 0;(function(z){z[z.NUM=6]="NUM"})(a.NumPlanes||(a.NumPlanes={}));a.NumPoints=void 0;(function(z){z[z.NUM=8]="NUM"})(a.NumPoints||(a.NumPoints={}));const q=[m.fromValues(-1,-1,-1,1),m.fromValues(1,-1,-1,1),m.fromValues(1,1,
-1,1),m.fromValues(-1,1,-1,1),m.fromValues(-1,-1,1,1),m.fromValues(1,-1,1,1),m.fromValues(1,1,1,1),m.fromValues(-1,1,1,1)],k=new c.ObjectStack(d.create),p=g();a.computePlanes=h;a.copy=function(z,C){for(let B=0;B<a.NumPlanes.NUM;B++)f.copy(z[B],C[B])};a.create=function(z){return z?[f.create(z[0]),f.create(z[1]),f.create(z[2]),f.create(z[3]),f.create(z[4]),f.create(z[5])]:[f.create(),f.create(),f.create(),f.create(),f.create(),f.create()]};a.createPoints=g;a.fromMatrix=function(z,C,B,A=p){z=b.multiply(e.sm4d.get(),
C,z);b.invert(z,z);for(C=0;C<a.NumPoints.NUM;++C){const x=r.transformMat4(e.sv4d.get(),q[C],z);t.set(A[C],x[0]/x[3],x[1]/x[3],x[2]/x[3])}h(B,A)};a.intersectClipRay=function(z,C){for(let B=0;B<a.NumPlanes.NUM;B++)if(!f.clipInfinite(z[B],C))return!1;return!0};a.intersectsLineSegment=function(z,C,B){return l(z,d.fromLineSegmentAndDirection(C,B,k.get()))};a.intersectsPoint=function(z,C){for(let B=0;B<a.NumPlanes.NUM;B++)if(0<f.signedDistance(z[B],C))return!1;return!0};a.intersectsRay=function(z,C){return l(z,
d.fromRay(C,k.get()))};a.intersectsSphere=function(z,C){for(let B=0;B<a.NumPlanes.NUM;B++){const A=z[B];if(A[0]*C[0]+A[1]*C[1]+A[2]*C[2]+A[3]>=C[3])return!1}return!0};a.planePointIndices=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","./ray"],function(a,c,b,t){function n(f){return f?{ray:t.create(f.ray),c0:f.c0,c1:f.c1}:{ray:t.create(),c0:0,c1:Number.MAX_VALUE}}function r(f,
e,g,h=n()){t.copy(f,h.ray);h.c0=e;h.c1=g;return h}function m(f,e,g){return b.add(g,f.ray.origin,b.scale(g,f.ray.direction,e))}const d=new c.ObjectStack(()=>n());a.copy=function(f,e=n()){return r(f.ray,f.c0,f.c1,e)};a.create=n;a.fromLineSegmentAndDirection=function(f,e,g=n()){const h=b.length(f.vector);t.fromValues(f.origin,e,g.ray);g.c0=0;g.c1=h;return g};a.fromRay=function(f,e=n()){t.copy(f,e.ray);e.c0=0;e.c1=Number.MAX_VALUE;return e};a.fromValues=r;a.getAt=m;a.getEnd=function(f,e){return m(f,f.c1,
e)};a.getStart=function(f,e){return m(f,f.c0,e)};a.wrap=function(f,e,g){const h=d.get();h.ray=f;h.c0=e;h.c1=g;return h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/fov":function(){define(["exports"],function(a){a.fovd2fovx=function(c,b,t){return 2*Math.atan(b*Math.tan(.5*c)/Math.sqrt(b*b+t*t))};a.fovd2fovy=function(c,b,t){return 2*Math.atan(t*Math.tan(.5*c)/Math.sqrt(b*b+t*t))};a.fovx2fovd=function(c,b,t){return 2*Math.atan(Math.sqrt(b*b+t*t)*Math.tan(.5*
c)/b)};a.fovy2fovd=function(c,b,t){return 2*Math.atan(Math.sqrt(b*b+t*t)*Math.tan(.5*c)/t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=void 0;var c=a.RenderSlot||(a.RenderSlot={});c[c.INTEGRATED_MESH=0]="INTEGRATED_MESH";c[c.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";c[c.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";c[c.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL";c[c.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN";
c[c.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";c[c.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN";c[c.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL";c[c.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL";c[c.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";c[c.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE";c[c.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT";c[c.LASERLINES=12]="LASERLINES";c[c.LASERLINES_CONTRAST_CONTROL=
13]="LASERLINES_CONTRAST_CONTROL";c[c.HUD_MATERIAL=14]="HUD_MATERIAL";c[c.LABEL_MATERIAL=15]="LABEL_MATERIAL";c[c.LINE_CALLOUTS=16]="LINE_CALLOUTS";c[c.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";c[c.DRAPED_MATERIAL=18]="DRAPED_MATERIAL";c[c.DRAPED_WATER=19]="DRAPED_WATER";c[c.VOXEL=20]="VOXEL";c[c.MAX_SLOTS=21]="MAX_SLOTS";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TransparencyPassType":function(){define(["exports"],function(a){a.TransparencyPassType=
void 0;var c=a.TransparencyPassType||(a.TransparencyPassType={});c[c.Color=0]="Color";c[c.Alpha=1]="Alpha";c[c.FrontFace=2]="FrontFace";c[c.NONE=3]="NONE";c[c.COUNT=4]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),function(a,
c,b,t,n,r,m){let d=function(){this.color=n.create();this.intensity=1},f=function(){this.direction=n.create();this.ambient=new d;this.diffuse=new d},e=function(){function h(){this._shOrder=2;this._legacy=new f;this.noonFactor=this.globalFactor=.5;this._sphericalHarmonics=new r.SphericalHarmonicsAmbientLight;this._mainLight=new r.MainLight(n.create(),n.fromValues(1,0,0),!1)}var l=h.prototype;l.set=function(v){m.combineLights(v,this._shOrder,this._mainLight,this._sphericalHarmonics);t.copy(this._legacy.direction,
this._mainLight.direction);v=1/Math.PI;this._legacy.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*v;this._legacy.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*v;this._legacy.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*v;t.scale(this._legacy.diffuse.color,this._mainLight.intensity,v);t.copy(g,this._legacy.diffuse.color);t.scale(g,g,.4*this.globalFactor);t.add(this._legacy.ambient.color,this._legacy.ambient.color,g)};l.copyFrom=function(v){this._sphericalHarmonics.r=Array.from(v.sh.r);
this._sphericalHarmonics.g=Array.from(v.sh.g);this._sphericalHarmonics.b=Array.from(v.sh.b);this._mainLight.direction=n.clone(v.mainLight.direction);this._mainLight.intensity=n.clone(v.mainLight.intensity);this._mainLight.castShadows=v.mainLight.castShadows;this._mainLight.specularStrength=v.mainLight.specularStrength;this._mainLight.environmentStrength=v.mainLight.environmentStrength;this.globalFactor=v.globalFactor;this.noonFactor=v.noonFactor};l.lerpLighting=function(v,q,k){t.lerp(this._mainLight.intensity,
v.mainLight.intensity,q.mainLight.intensity,k);this._mainLight.environmentStrength=b.lerp(v.mainLight.environmentStrength,q.mainLight.environmentStrength,k);this._mainLight.specularStrength=b.lerp(v.mainLight.specularStrength,q.mainLight.specularStrength,k);t.copy(this._mainLight.direction,q.mainLight.direction);this._mainLight.castShadows=q.mainLight.castShadows;this.globalFactor=b.lerp(v.globalFactor,q.globalFactor,k);this.noonFactor=b.lerp(v.noonFactor,q.noonFactor,k);if(v.sh.r.length===q.sh.r.length)for(let p=
0;p<q.sh.r.length;p++)this._sphericalHarmonics.r[p]=b.lerp(v.sh.r[p],q.sh.r[p],k),this._sphericalHarmonics.g[p]=b.lerp(v.sh.g[p],q.sh.g[p],k),this._sphericalHarmonics.b[p]=b.lerp(v.sh.b[p],q.sh.b[p],k);else for(v=0;v<q.sh.r.length;v++)this._sphericalHarmonics.r[v]=q.sh.r[v],this._sphericalHarmonics.g[v]=q.sh.g[v],this._sphericalHarmonics.b[v]=q.sh.b[v]};c._createClass(h,[{key:"legacy",get:function(){return this._legacy}},{key:"sh",get:function(){return this._sphericalHarmonics}},{key:"mainLight",
get:function(){return this._mainLight}}]);return h}();const g=n.create();a.SceneLighting=e;a.ambientBoost=.4;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports","../../../../chunks/vec3f64"],function(a,c){a.AmbientLight=function(b=c.create()){this.intensity=b};a.FillLight=function(b=c.create(),t=c.fromValues(.57735,.57735,.57735)){this.intensity=b;this.direction=t};a.MainLight=function(b=c.create(),t=c.fromValues(.57735,
.57735,.57735),n=!0,r=1,m=1){this.intensity=b;this.direction=t;this.castShadows=n;this.specularStrength=r;this.environmentStrength=m};a.SphericalHarmonicsAmbientLight=function(){this.r=[0];this.g=[0];this.b=[0]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(a,c,b,
t,n,r){function m(B){return(B+1)*(B+1)}function d(B){return c.clamp(Math.floor(Math.sqrt(B)-1),0,2)}function f(B,A,x){const u=B[0],y=B[1];B=B[2];x=x||[];x.length=m(A);0<=A&&(x[0]=.28209479177);1<=A&&(x[1]=.4886025119*u,x[2]=.4886025119*B,x[3]=.4886025119*y);2<=A&&(x[4]=1.09254843059*u*y,x[5]=1.09254843059*y*B,x[6]=.31539156525*(3*B*B-1),x[7]=1.09254843059*u*B,x[8]=.54627421529*(u*u-y*y));return x}function e(B,A){B=m(B);A=A||{r:[],g:[],b:[]};A.r.length=A.g.length=A.b.length=B;for(let x=0;x<B;x++)A.r[x]=
A.g[x]=A.b[x]=0;return A}function g(B,A){const x=d(A.r.length);for(const u of B)b.negate(z,u.direction),f(z,x,k),n.elementwiseProduct(k,C),n.scalarProduct(k,u.intensity[0],p),n.add(A.r,p),n.scalarProduct(k,u.intensity[1],p),n.add(A.g,p),n.scalarProduct(k,u.intensity[2],p),n.add(A.b,p);return A}function h(B,A){f(z,0,k);for(const x of B)A.r[0]+=k[0]*C[0]*x.intensity[0]*4*Math.PI,A.g[0]+=k[0]*C[0]*x.intensity[1]*4*Math.PI,A.b[0]+=k[0]*C[0]*x.intensity[2]*4*Math.PI;return A}const l=[],v=[],q=[],k=[0],
p=[0],z=t.create(),C=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(B,A,x,u){e(A,u);b.set(x.intensity,0,0,0);A=!1;l.length=0;v.length=0;q.length=0;for(const y of B)y instanceof r.MainLight&&!A?(b.copy(x.direction,y.direction),b.copy(x.intensity,y.intensity),x.specularStrength=y.specularStrength,x.environmentStrength=y.environmentStrength,x.castShadows=y.castShadows,A=!0):y instanceof r.MainLight||y instanceof r.FillLight?l.push(y):y instanceof
r.AmbientLight?v.push(y):y instanceof r.SphericalHarmonicsAmbientLight&&q.push(y);g(l,u);h(v,u);for(const y of q)n.add(u.r,y.r),n.add(u.g,y.g),n.add(u.b,y.b)};a.computeCoefficients=f;a.initSHCoefficients=e;a.numberOfCoefficients=m;a.orderFromNumberOfCoefficients=d;a.projectAmbientLights=h;a.projectFillLights=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(c,b,t){t=t||c;t.length=
c.length;for(let n=0;n<c.length;n++)t[n]=c[n]+b[n];return t};a.dotProduct=function(c,b){let t=0;for(let n=0;n<c.length;n++)t+=c[n]*b[n];return t};a.elementwiseProduct=function(c,b,t){t=t||c;t.length=c.length;for(let n=0;n<c.length;n++)t[n]=c[n]*b[n];return t};a.scalarProduct=function(c,b,t){t=t||c;t.length=c.length;for(let n=0;n<c.length;n++)t[n]=c[n]*b;return t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ./atmosphereUtils ../../../chunks/FogHaze.glsl ./FogTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){a.Fog=function(x){function u(w){var D=x.call(this,w)||this;D._passParameters=new v.FogHazePassParameters;D._vao=z.createQuadVAO(w.context.renderContext.rctx,p.Pos2Tex);D._technique=w.context.techniqueRepository.acquire(q.FogTechnique,new q.FogHazeTechniqueConfiguration);w=h.getReferenceEllipsoid(w.view.spatialReference);D._planetRadius=w.radius;D._atmosphereRadius=w.radius+l.atmosphereHeight;return D}c._inheritsLoose(u,x);var y=u.prototype;y.destroy=
function(){this._technique.release();this._vao.dispose()};y.render=function(w,D){this._update(w,D);if(!(0>=this._passParameters.fogAmount)){var F=this._technique;if(F.compiled){var E=w.offscreenRenderingHelper;E.renderDepthDetached(()=>{this._passParameters.depthTexture=E.depthTexture;const K=w.rctx.bindTechnique(F,this._passParameters,w.bindParameters);this._renderFog(K,w)})}else this.context.requestRender()}};y._renderFog=function(w,D){D=D.rctx;D.bindVAO(this._vao);w.assertCompatibleVertexAttributeLocations(this._vao);
D.drawArrays(C.PrimitiveType.TRIANGLE_STRIP,0,4)};y._update=function(w,D){var F=w.bindParameters.camera;e.normalize(B,F.eye);w=Math.max(0,e.dot(B,w.bindParameters.lighting.mainLight.direction));const E=D.color;e.scale(A,E,.1);e.lerp(this._passParameters.fogColor,A,E,w);F=e.length(F.eye);this._passParameters.atmosphereC=F*F-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.fogAmount=(1-n.smoothstep(.95*k.weatherHeightLimit,1*k.weatherHeightLimit,Math.abs(F-this._planetRadius)))*D.amount;
this._passParameters.fogStrength=D.strength};u.isSupported=function(w){return w.capabilities.depthTexture};c._createClass(u,[{key:"strength",get:function(){return this._passParameters.fogStrength},set:function(w){this._passParameters.fogStrength=w}}]);return u}(t);b.__decorate([r.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);b.__decorate([r.property({constructOnly:!0})],a.Fog.prototype,"view",void 0);a.Fog=b.__decorate([f.subclass("esri.views.3d.environment.Fog")],a.Fog);const B=
g.create(),A=g.create();a.FogParameters=function(){this.color=g.create();this.amount=this.strength=0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/FogHaze.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){function p(B){const A=new v.ShaderBuilder;A.attributes.add(k.VertexAttribute.POSITION,"vec2");A.include(r.TextureCoordinateAttribute,{textureCoordinateType:r.TextureCoordinateAttributeType.Default});A.varyings.add("worldRay","vec3");A.varyings.add("eyeDir","vec3");const {vertex:x,fragment:u}=A;x.uniforms.add([new l.Matrix4PassUniform("inverseProjectionMatrix",(y,w)=>w.camera.inverseProjectionMatrix),new l.Matrix4PassUniform("inverseViewMatrix",(y,w)=>b.invertOrIdentity(C,
w.camera.viewMatrix))]);x.code.add(h.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);u.uniforms.add(new g.FloatPassUniform("atmosphereC",y=>y.atmosphereC));u.uniforms.add(new e.Float3PassUniform("cameraPosition",(y,w)=>w.camera.eye));u.uniforms.add(new f.Float2PassUniform("nearFar",(y,w)=>w.camera.nearFar));u.uniforms.add(new q.Texture2DPassUniform("depthTex",y=>y.depthTexture));u.uniforms.add(new g.FloatPassUniform("fogStrength",y=>B.haze?y.hazeStrength:y.fogStrength));u.uniforms.add(new g.FloatPassUniform("fogAmount",y=>B.haze?y.hazeAmount:y.fogAmount));u.uniforms.add(new e.Float3PassUniform("fogColor",
y=>B.haze?y.hazeColor:y.fogColor));A.include(d.Gamma);u.include(m.ReadLinearDepth);u.code.add(h.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);u.code.add(h.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);u.code.add(h.glsl`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${B.haze?h.glsl`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `);return A}let z=function(B){function A(){var x=B.apply(this,arguments)||this;x.fogColor=n.create();x.hazeColor=n.create();x.fogStrength=4E-6;x.hazeStrength=4E-6;x.atmosphereC=1;x.fogAmount=0;x.hazeAmount=0;return x}c._inheritsLoose(A,B);return A}(h.NoParameters);const C=t.create();t=Object.freeze(Object.defineProperty({__proto__:null,FogHazePassParameters:z,build:p},Symbol.toStringTag,{value:"Module"}));a.FogHazePassParameters=z;a.Haze=t;a.build=p})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/FogHaze.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){m=function(l){function v(){return l.apply(this,arguments)||this}b._inheritsLoose(v,l);var q=v.prototype;q.initializeProgram=function(k){return new e.Program(k.rctx,v.shader.get().build(this.configuration),f.Default3D)};q.initializePipeline=function(){return this.configuration.haze?h.makePipelineState({blending:h.separateBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ZERO,g.BlendFactor.ONE_MINUS_SRC_COLOR,g.BlendFactor.ONE),colorWrite:h.defaultColorWriteParams}):h.makePipelineState({blending:h.separateBlendingParams(g.BlendFactor.SRC_ALPHA,
g.BlendFactor.ZERO,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE),colorWrite:h.defaultColorWriteParams})};return v}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(n.Haze,()=>new Promise((l,v)=>a(["./FogHaze.glsl"],l,v)));n=function(l){function v(){var q=l.apply(this,arguments)||this;q.haze=!1;return q}b._inheritsLoose(v,l);return v}(d.ShaderTechniqueConfiguration);t.__decorate([d.parameter()],n.prototype,"haze",void 0);c.FogHazeTechniqueConfiguration=n;c.FogTechnique=m;Object.defineProperty(c,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("exports ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ./AtmosphereType ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){let B=function(){function u(w,D){this.type=n.AtmosphereType.Panoramic;this._configuration=new d.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new r.SimpleAtmospherePassParameters;this._configuration.geometry=d.SimpleAtmosphereGeometry.Cylinder;this._technique=D.techniqueRepository.acquire(m.SimpleAtmosphereTechnique,this._configuration);w=D.renderContext.rctx;this._vao=this._createVertexArrayObject(w);this._vaoCount=C.vertexCount(this._vao,
"geometry");this._passParameters.texture=new z.Texture(w,{pixelFormat:p.PixelFormat.RGBA,dataType:p.PixelType.UNSIGNED_BYTE,wrapMode:p.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:p.TextureSamplingMode.LINEAR,flipped:!0,width:1,height:512},f.earthAtmosphereTextureSimple)}var y=u.prototype;y.destroy=function(){this._passParameters.texture=c.disposeMaybe(this._passParameters.texture);this._vao.dispose();this._technique.release()};y.render=function(w){const D=w.rctx,F=D.bindTechnique(this._technique,this._passParameters,
w.bindParameters);var E=A;b.copy(E,w.bindParameters.camera.viewMatrix);E[12]=0;E[13]=0;E[14]=0;E[15]=1;F.setUniformMatrix4fv("view",A);D.bindVAO(this._vao);F.assertCompatibleVertexAttributeLocations(this._vao);D.drawArrays(p.PrimitiveType.TRIANGLES,0,this._vaoCount)};y.renderHaze=function(){return!1};y._createVertexArrayObject=function(w){var D=l.createPolySphereData(1,2,!1);const F=D.indices[0][1];D=D.vertexAttributes[0][1];for(var E=0;E<F.length;E+=3){var K=F[E];F[E]=F[E+2];F[E+2]=K}D=D.data;E=
x.createBuffer(F.length);K=E.position;for(let J=0;J<F.length;++J){const M=3*F[J];K.set(J,0,D[M]);K.set(J,1,D[M+1]);K.set(J,2,D[M+2])}return new v.VertexArrayObject(w,h.Default3D,{geometry:e.glLayout(x)},{geometry:k.BufferObject.createVertex(w,p.Usage.STATIC_DRAW,E.buffer)})};return u}();const A=t.create(),x=g.newLayout().vec3f(q.VertexAttribute.POSITION);a.PanoramicAtmosphere=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ./vec3f64 ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){function k(B){const A=new l.ShaderBuilder,{vertex:x,fragment:u}=A;m.addMainLightDirection(x);B.geometry===n.SimpleAtmosphereGeometry.Underground?(A.attributes.add(q.VertexAttribute.POSITION,"vec2"),A.varyings.add("color","vec4"),x.uniforms.add([new f.Float3PassUniform("cameraPosition",(y,w)=>w.camera.eye),new e.FloatPassUniform("undergroundFadeAlpha",y=>y.undergroundFadeAlpha)]),x.code.add(g.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), mainLightDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),u.code.add(g.glsl`void main() {
gl_FragColor = color;
}`)):(A.include(r.Transform,B),A.attributes.add(q.VertexAttribute.POSITION,"vec3"),A.varyings.add("vtc","vec2"),A.varyings.add("falloff","float"),B=B.geometry===n.SimpleAtmosphereGeometry.Cylinder,x.uniforms.add([new h.Matrix4PassUniform("proj",(y,w)=>w.camera.projectionMatrix),new h.Matrix4PassUniform("view",(y,w)=>w.camera.viewMatrix)]),B||(A.varyings.add("innerFactor","float"),x.uniforms.add(new f.Float3PassUniform("silCircleCenter",y=>y.silhouette.center)),x.uniforms.add(new f.Float3PassUniform("silCircleV1",
y=>y.silhouette.v1)),x.uniforms.add(new f.Float3PassUniform("silCircleV2",y=>y.silhouette.v2)),x.uniforms.add(new d.Float2PassUniform("texV",y=>y.texV)),x.uniforms.add(new e.FloatPassUniform("innerScale",y=>y.innerScale))),x.code.add(g.glsl`
		void main(void) {
      ${B?g.glsl`
      vec3 pos = position;
      float ndotl = mainLightDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:g.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${g.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), mainLightDirection);
      vtc.x = position.x  * ${g.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),u.uniforms.add(new v.Texture2DPassUniform("tex",y=>y.texture)),B||u.uniforms.add(new e.FloatPassUniform("altitudeFade",y=>y.altitudeFade)),u.code.add(g.glsl`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${B?g.glsl`gl_FragColor = atmosphereColor;`:g.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return A}let p=function(B){function A(){var x=B.apply(this,arguments)||this;x.texV=b.create();x.altitudeFade=0;x.innerScale=0;x.undergroundFadeAlpha=0;x.silhouette=new z;return x}c._inheritsLoose(A,B);return A}(g.NoParameters),z=function(){this.center=t.create();this.v1=t.create();this.v2=t.create()};const C=Object.freeze(Object.defineProperty({__proto__:null,SilhouetteCircle:z,SimpleAtmospherePassParameters:p,build:k},Symbol.toStringTag,{value:"Module"}));a.SilhouetteCircle=z;a.SimpleAtmosphere=
C;a.SimpleAtmospherePassParameters=p;a.build=k})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration","../webgl-engine/materials/DefaultTechniqueConfiguration"],function(a,c,b,t,n){a.SimpleAtmosphereGeometry=void 0;(function(r){r[r.Cone=0]="Cone";r[r.Cylinder=1]="Cylinder";r[r.Underground=2]="Underground";r[r.COUNT=
3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));n=function(r){function m(){var d=r.apply(this,arguments)||this;d.geometry=a.SimpleAtmosphereGeometry.Cone;return d}c._inheritsLoose(m,r);return m}(n.DefaultTechniqueConfiguration);b.__decorate([t.parameter({count:a.SimpleAtmosphereGeometry.COUNT})],n.prototype,"geometry",void 0);a.SimpleAtmosphereTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/BindType","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,c,b,t,n){let r=function(m){function d(){var f=m.apply(this,arguments)||this;f.hasWebGL2Context=!1;return f}c._inheritsLoose(d,m);return d}(n.ShaderTechniqueConfiguration);b.__decorate([n.parameter({constValue:!0})],r.prototype,"hasSliceHighlight",void 0);b.__decorate([n.parameter({constValue:!1})],r.prototype,"hasSliceInVertexProgram",
void 0);b.__decorate([n.parameter({constValue:!1})],r.prototype,"instancedDoublePrecision",void 0);b.__decorate([n.parameter({constValue:!1})],r.prototype,"useLegacyTerrainShading",void 0);b.__decorate([n.parameter({constValue:!1})],r.prototype,"hasModelTransformation",void 0);b.__decorate([n.parameter({constValue:t.BindType.Pass})],r.prototype,"pbrTextureBindType",void 0);b.__decorate([n.parameter()],r.prototype,"hasWebGL2Context",void 0);a.DefaultTechniqueConfiguration=r;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","./ForwardLinearDepth.glsl","../shaderModules/interfaces"],function(a,c,b){a.Transform=function(t,n){c.addCalculateLinearDepth(t);n.hasModelTransformation?(t.vertex.code.add(b.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = calculateLinearDepth(nearFar, eye.z);
return proj * eye;
}`),t.vertex.code.add(b.glsl`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`)):(t.vertex.code.add(b.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = calculateLinearDepth(nearFar,eye.z);
return proj * eye;
}`),t.vertex.code.add(b.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutput","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(a,c,b,t,n){function r(f){f.varyings.add("linearDepth","float")}function m(f){f.vertex.uniforms.add(new t.Float2PassUniform("nearFar",(e,g)=>g.camera.nearFar))}function d(f){f.vertex.code.add(n.glsl`float calculateLinearDepth(vec2 nearFar,float z) {
return (-z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)}a.ForwardLinearDepth=function(f,e){const {vertex:g}=f;switch(e.output){case c.ShaderOutput.Color:if(e.receiveShadows){r(f);g.code.add(n.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`);return}break;case c.ShaderOutput.Depth:case c.ShaderOutput.Shadow:case c.ShaderOutput.ShadowHighlight:case c.ShaderOutput.ShadowExcludeHighlight:f.include(b.VertexPosition,e);r(f);m(f);d(f);g.code.add(n.glsl`void forwardLinearDepth() {
linearDepth = calculateLinearDepth(nearFar, vPosition_view.z);
}`);return}g.code.add(n.glsl`void forwardLinearDepth() {}`)};a.addCalculateLinearDepth=d;a.addLinearDepth=r;a.addNearFar=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutput":function(){define(["exports"],function(a){a.ShaderOutput=void 0;var c=a.ShaderOutput||(a.ShaderOutput={});c[c.Color=0]="Color";c[c.Depth=1]="Depth";c[c.Normal=2]="Normal";c[c.Shadow=3]="Shadow";c[c.ShadowHighlight=4]="ShadowHighlight";c[c.ShadowExcludeHighlight=
5]="ShadowExcludeHighlight";c[c.Highlight=6]="Highlight";c[c.Alpha=7]="Alpha";c[c.ObjectAndLayerIdColor=8]="ObjectAndLayerIdColor";c[c.COUNT=9]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){let q=function(p){function z(){var C=p.apply(this,arguments)||this;C.transformWorldFromViewTH=r.create();C.transformWorldFromViewTL=r.create();C.transformViewFromCameraRelativeRS=b.create();C.transformProjFromView=t.create();return C}c._inheritsLoose(z,p);return z}(g.NoParameters),k=function(p){function z(){var C=p.apply(this,arguments)||this;C.transformWorldFromModelRS=b.create();C.transformWorldFromModelTH=n.create();C.transformWorldFromModelTL=n.create();return C}
c._inheritsLoose(z,p);return z}(g.NoParameters);a.VertexPosition=function(p,z){p.include(m.PositionAttribute);const C=p.vertex;C.include(d.DoublePrecision,z);p.varyings.add("vPositionWorldCameraRelative","vec3");p.varyings.add("vPosition_view","vec3");C.uniforms.add([new e.Float3PassUniform("transformWorldFromViewTH",B=>B.transformWorldFromViewTH),new e.Float3PassUniform("transformWorldFromViewTL",B=>B.transformWorldFromViewTL),new l.Matrix3PassUniform("transformViewFromCameraRelativeRS",B=>B.transformViewFromCameraRelativeRS),
new v.Matrix4PassUniform("transformProjFromView",B=>B.transformProjFromView),new h.Matrix3DrawUniform("transformWorldFromModelRS",B=>B.transformWorldFromModelRS),new f.Float3DrawUniform("transformWorldFromModelTH",B=>B.transformWorldFromModelTH),new f.Float3DrawUniform("transformWorldFromModelTL",B=>B.transformWorldFromModelTL)]);C.code.add(g.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);C.code.add(g.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${z.spherical?g.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:g.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);p.fragment.uniforms.add(new e.Float3PassUniform("transformWorldFromViewTL",B=>B.transformWorldFromViewTL));C.code.add(g.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);p.fragment.code.add(g.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionDrawParameters=k;a.VertexPositionPassParameters=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,c,b){a.PositionAttribute=function(t){t.attributes.add(b.VertexAttribute.POSITION,"vec3");t.vertex.code.add(c.glsl`vec3 positionModel() { return position; }`)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.DoublePrecision=function({code:b},t){t.doublePrecisionRequiresObfuscation?b.add(c.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):b.add(c.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"mat3",t.BindType.Pass,(f,e,g)=>f.setUniformMatrix3fv(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Matrix3PassUniform=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,c,b,t,n,r,m,
d,f,e,g){m=function(h){function l(){return h.apply(this,arguments)||this}b._inheritsLoose(l,h);var v=l.prototype;v.initializeProgram=function(q){return new f.Program(q.rctx,l.shader.get().build(this.configuration),d.Default3D)};v.initializePipeline=function(){return this.configuration.geometry===n.SimpleAtmosphereGeometry.Cylinder?g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),culling:g.backFaceCullingParams,
depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams}):g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams})};return l}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(t.SimpleAtmosphere,()=>new Promise((h,l)=>a(["./SimpleAtmosphere.glsl"],h,l)));c.SimpleAtmosphereTechnique=
m;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["exports"],function(a){const c=new Uint8ClampedArray([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,6,0,0,0,7,0,0,
0,7,0,0,0,7,0,0,0,7,0,0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,0,0,0,15,16,0,0,16,16,0,0,16,16,0,0,16,16,0,0,16,15,0,0,17,15,0,0,17,15,0,0,17,15,0,0,17,14,0,0,18,14,0,0,18,14,0,0,18,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,19,13,0,0,20,
13,0,0,20,13,0,0,20,13,0,0,20,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,21,12,0,0,22,12,0,0,22,12,0,0,22,12,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,27,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,28,18,0,0,29,18,0,0,29,18,0,0,29,17,0,0,30,17,0,0,30,17,0,0,30,17,0,0,30,16,0,0,31,16,0,0,31,16,0,0,31,16,0,0,32,16,0,0,32,16,0,0,32,15,0,0,33,15,0,0,33,15,0,0,33,15,0,0,34,15,8,0,34,15,8,
0,34,15,8,0,34,15,7,0,35,15,7,0,35,15,7,0,35,21,7,0,36,21,7,0,36,21,7,0,36,21,7,0,37,21,7,0,37,21,7,0,37,20,7,0,38,20,7,0,38,20,7,0,38,20,7,0,39,20,7,0,39,20,7,0,39,20,7,0,39,19,6,0,40,19,6,0,40,19,6,0,40,19,6,0,41,19,6,0,41,19,6,0,41,18,6,0,42,18,6,0,42,18,6,0,42,24,6,0,43,24,6,0,43,24,6,0,43,23,6,0,44,23,6,0,44,23,6,0,44,23,6,0,45,23,6,0,45,23,6,0,45,22,6,0,46,22,6,0,46,22,6,0,46,22,5,0,47,22,5,0,47,22,5,0,47,21,5,0,48,21,5,0,48,21,5,0,48,21,5,0,49,21,5,0,49,26,5,0,49,25,5,0,50,25,5,0,50,25,5,0,
50,25,5,0,51,25,5,0,51,25,5,0,51,25,5,0,52,25,5,0,52,25,5,0,52,24,5,0,53,24,5,0,53,24,5,0,53,24,9,0,54,28,9,0,54,28,9,0,54,28,9,0,55,28,9,0,55,27,9,0,56,27,9,0,56,27,9,0,56,27,9,4,57,27,9,4,57,27,9,4,57,26,9,4,58,26,9,4,58,26,9,4,58,26,9,4,59,26,9,4,59,26,9,4,59,26,8,4,60,30,8,4,60,30,8,4,60,29,8,4,61,29,8,4,61,29,8,4,62,29,8,4,62,29,8,4,62,28,8,4,63,28,8,4,63,28,8,4,63,28,12,4,64,28,12,4,64,28,12,4,64,27,12,4,65,27,12,8,65,27,12,8,65,31,12,8,66,31,12,8,66,30,11,8,67,30,11,8,67,30,11,8,67,30,11,8,
68,30,11,8,68,30,11,8,68,30,15,7,69,30,15,7,69,30,15,7,69,33,15,11,70,33,15,11,70,32,14,11,71,32,14,11,71,32,14,11,71,32,18,14,72,32,18,14,72,32,18,14,72,31,17,14,73,35,17,14,73,34,17,17,74,34,21,17,74,34,21,17,74,34,20,17,75,34,20,20,75,34,20,20,75,34,23,20,76,34,23,20,76,36,23,23,77,36,23,23,77,36,23,23,77,36,23,23,78,36,26,26,78,36,26,26,78,36,26,26,79,36,26,29,79,38,26,29,80,38,29,29,80,38,29,29,80,38,28,31,81,38,28,31,81,38,31,31,81,37,31,34,82,37,31,34,82,37,31,37,83,40,34,37,83,40,34,37,83,
39,33,39,84,39,33,39,84,39,36,42,84,39,36,42,85,39,36,42,85,39,36,42,85,39,39,44,86,39,39,44,86,41,38,47,87,41,41,47,87,41,41,50,87,41,41,49,88,41,41,52,88,40,43,52,89,43,43,52,89,43,43,54,89,42,45,54,90,42,45,57,90,42,45,57,90,42,45,59,91,42,48,59,91,44,47,61,92,44,47,61,92,44,50,61,92,44,49,63,93,44,49,63,93,44,52,66,93,43,52,65,94,46,54,68,94,46,54,70,95,46,54,70,95,46,54,70,95,45,56,72,96,45,56,72,96,45,58,74,97,47,58,76,97,47,58,76,97,47,60,78,98,47,60,78,98,47,60,81,98,49,62,80,99,49,62,82,
99,48,61,84,100,48,64,84,100,48,64,84,100,50,63,86,101,50,66,86,101,50,66,88,101,50,65,90,102,52,67,89,103,51,69,91,104,51,68,92,105,52,69,93,107,52,71,94,108,54,70,96,109,53,71,96,111,52,73,98,112,54,72,98,114,53,73,100,115,54,72,100,117,54,73,102,118,55,74,104,120,55,76,105,121,56,77,106,123,56,76,107,124,57,79,107,126,58,78,110,128,57,79,111,129,56,80,113,131,58,79,112,132,57,82,114,134,58,81,116,136,60,82,117,137,59,83,117,139,60,83,119,141,59,84,120,142,60,85,122,144,59,86,122,146,60,86,126,
148,62,87,127,149,61,88,127,151,62,88,128,153,63,89,130,155,62,90,131,156,63,90,132,158,64,91,134,160,65,91,135,162,64,92,136,163,63,93,138,165,66,95,139,167,65,95,140,169,66,95,142,171,67,96,142,172,66,97,144,174,67,99,145,176,67,97,148,178,67,99,147,180,68,100,149,181,68,100,150,183,69,101,152,185,70,102,153,187,71,103,155,188,70,103,156,190,70,104,157,192,71,105,158,194,71,106,160,195,72,106,161,197,72,108,161,199,73,108,163,200,73,109,164,202,74,109,165,204,74,110,167,206,75,111,168,207,74,112,
170,209,75,112,170,210,76,113,171,212,76,114,173,214,77,115,174,215,78,115,175,217,78,116,175,218,78,117,177,220,78,118,178,221,79,118,180,223,80,120,180,224,81,120,181,226,81,120,182,227,82,121,184,229,82,122,185,230,84,123,186,232,83,123,187,233,84,124,189,234,84,125,188,235,85,126,189,237,86,126,190,238,86,127,191,239,87,127,192,240,87,129,193,242,88,129,194,243,89,130,195,244,90,131,196,245,90,132,197,246,91,132,197,247,92,133,198,248,92,134,199,249,93,135,200,250,94,136,201,251,95,137,202,252,
96,138,203,253,97,140,204,254,98,141,205,254,99,142,206,255,101,143,207,255,102,144,208,255,103,146,209,255,104,147,209,255,106,148,210,255,107,149,211,255,108,151,212,255,110,152,213,255,111,153,213,255,112,154,214,255,114,156,215,255,115,157,215,255,117,158,216,255,118,160,217,255,120,161,217,255,121,162,218,255,123,164,218,255,124,165,219,255,125,166,219,255,127,167,220,255,129,169,220,255,130,170,221,255,132,171,221,255,133,173,222,255,134,174,222,255,136,175,223,255,139,178,224,255,142,180,224,
255,144,182,225,255,147,185,226,255,150,187,226,255,153,189,227,255,155,191,228,255,158,194,228,255,160,196,229,255,163,198,229,255,165,200,230,255,168,202,231,255,170,203,231,255,172,205,232,255,174,207,232,255,176,209,233,255,178,210,234,255,180,212,234,255,182,214,235,255,184,215,236,255,186,217,237,255,188,219,238,255,190,220,238,255,192,221,239,255,193,222,240,255,194,224,240,255,196,225,241,255,197,226,241,255,198,226,242,255,199,227,242,255,200,228,242,255,201,228,243,255,202,229,243,255,203,
230,243,255,204,230,244,255,205,231,244,255,207,232,244,255,208,233,245,255,209,233,245,255,211,234,246,255,213,235,246,255,217,238,247,255,222,240,248,255,226,242,249,255,231,245,250,255,236,247,251,255,241,249,252,255,245,251,253,255,249,252,254,255,255,255,255,255]);a.earthAtmosphereTextureSimple=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,
c,b){const t={u8:c.DataType.UNSIGNED_BYTE,u16:c.DataType.UNSIGNED_SHORT,u32:c.DataType.UNSIGNED_INT,i8:c.DataType.BYTE,i16:c.DataType.SHORT,i32:c.DataType.INT,f32:c.DataType.FLOAT};a.glLayout=function(n,r=0){const m=n.stride;return n.fieldNames.filter(d=>{d=n.fields.get(d).optional;return!(d&&d.glPadding)}).map(d=>{const f=n.fields.get(d),e=f.constructor.ElementCount;var g=t[f.constructor.ElementType];if(!g)throw Error("BufferType not supported in WebGL");return new b.VertexElementDescriptor(d,e,
g,f.offset,m,!(!f.optional||!f.optional.glNormalized),r)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types"],function(a,c,b,t){let n=function(){function m(f,e){this.layout=f;this.buffer="number"===typeof e?new ArrayBuffer(e*f.stride):e;for(const g of f.fieldNames)e=f.fields.get(g),
this[g]=new e.constructor(this.buffer,e.offset,this.stride)}var d=m.prototype;d.getField=function(f,e){return(f=this[f])&&f.elementCount===e.ElementCount&&f.elementType===e.ElementType?f:null};d.slice=function(f,e){return new m(this.layout,this.buffer.slice(f*this.stride,e*this.stride))};d.copyFrom=function(f,e,g,h){const l=this.stride;0===l%4?(f=new Uint32Array(f.buffer,e*l,h*l/4),(new Uint32Array(this.buffer,g*l,h*l/4)).set(f)):(f=new Uint8Array(f.buffer,e*l,h*l),(new Uint8Array(this.buffer,g*l,
h*l)).set(f))};c._createClass(m,[{key:"stride",get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return m}(),r=function(){function m(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var d=m.prototype;d.vec2f=function(f,e){this._appendField(f,b.BufferViewVec2f,e);return this};d.vec2f64=function(f,e){this._appendField(f,b.BufferViewVec2f64,e);return this};d.vec3f=
function(f,e){this._appendField(f,b.BufferViewVec3f,e);return this};d.vec3f64=function(f,e){this._appendField(f,b.BufferViewVec3f64,e);return this};d.vec4f=function(f,e){this._appendField(f,b.BufferViewVec4f,e);return this};d.vec4f64=function(f,e){this._appendField(f,b.BufferViewVec4f64,e);return this};d.mat3f=function(f,e){this._appendField(f,b.BufferViewMat3f,e);return this};d.mat3f64=function(f,e){this._appendField(f,b.BufferViewMat3f64,e);return this};d.mat4f=function(f,e){this._appendField(f,
b.BufferViewMat4f,e);return this};d.mat4f64=function(f,e){this._appendField(f,b.BufferViewMat4f64,e);return this};d.vec4u8=function(f,e){this._appendField(f,b.BufferViewVec4u8,e);return this};d.f32=function(f,e){this._appendField(f,b.BufferViewFloat,e);return this};d.f64=function(f,e){this._appendField(f,b.BufferViewFloat64,e);return this};d.u8=function(f,e){this._appendField(f,b.BufferViewUint8,e);return this};d.u16=function(f,e){this._appendField(f,b.BufferViewUint16,e);return this};d.i8=function(f,
e){this._appendField(f,b.BufferViewInt8,e);return this};d.vec2i8=function(f,e){this._appendField(f,b.BufferViewVec2i8,e);return this};d.vec2i16=function(f,e){this._appendField(f,b.BufferViewVec2i16,e);return this};d.vec2u8=function(f,e){this._appendField(f,b.BufferViewVec2u8,e);return this};d.vec4u16=function(f,e){this._appendField(f,b.BufferViewVec4u16,e);return this};d.u32=function(f,e){this._appendField(f,b.BufferViewUint32,e);return this};d._appendField=function(f,e,g){const h=e.ElementCount*
t.elementTypeSize(e.ElementType);this.fields.set(f,{size:h,constructor:e,offset:this.stride,optional:g});this.stride+=h;this.fieldNames.push(f)};d.alignTo=function(f){this.stride=Math.floor((this.stride+f-1)/f)*f;return this};d.hasField=function(f){return this.fieldNames.includes(f)};d.createBuffer=function(f){return new n(this,f)};d.createView=function(f){return new n(this,f)};d.clone=function(){const f=new m;f.stride=this.stride;f.fields=new Map;this.fields.forEach((e,g)=>f.fields.set(g,e));f.fieldNames=
this.fieldNames.slice();f.BufferType=this.BufferType;return f};return m}();a.InterleavedBuffer=n;a.InterleavedLayout=r;a.newLayout=function(){return new r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),function(a,c,b,t,n,r,m,d){let f=function(S){function R(Q,
V=0,aa,X){Q=S.call(this,Float32Array,Q,V,aa,X)||this;Q.elementType="f32";return Q}c._inheritsLoose(R,S);R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(n.BufferViewScalarImpl);f.ElementType="f32";let e=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Float32Array,Q,V,aa,X)||this;Q.elementType="f32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,
Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(r.BufferViewVec2Impl);e.ElementType="f32";let g=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Float32Array,Q,V,aa,X)||this;Q.elementType="f32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(m.BufferViewVec3Impl);g.ElementType="f32";let h=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Float32Array,
Q,V,aa,X)||this;Q.elementType="f32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(d.BufferViewVec4Impl);h.ElementType="f32";let l=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Float32Array,Q,V,aa,X)||this;Q.elementType="f32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,
V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(b.BufferViewMat3Impl);l.ElementType="f32";b=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Float64Array,Q,V,aa,X)||this;Q.elementType="f64";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(b.BufferViewMat3Impl);b.ElementType="f64";let v=function(S){function R(Q,V=0,aa,
X){Q=S.call(this,Float32Array,Q,V,aa,X)||this;Q.elementType="f32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(t.BufferViewMat4Impl);v.ElementType="f32";t=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Float64Array,Q,V,aa,X)||this;Q.elementType="f64";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};
R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(t.BufferViewMat4Impl);t.ElementType="f64";let q=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Float64Array,Q,V,aa,X)||this;Q.elementType="f64";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(n.BufferViewScalarImpl);q.ElementType="f64";let k=
function(S){function R(Q,V=0,aa,X){Q=S.call(this,Float64Array,Q,V,aa,X)||this;Q.elementType="f64";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(r.BufferViewVec2Impl);k.ElementType="f64";let p=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Float64Array,Q,V,aa,X)||this;Q.elementType="f64";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,
V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(m.BufferViewVec3Impl);p.ElementType="f64";let z=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Float64Array,Q,V,aa,X)||this;Q.elementType="f64";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(d.BufferViewVec4Impl);
z.ElementType="f64";let C=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint8Array,Q,V,aa,X)||this;Q.elementType="u8";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(n.BufferViewScalarImpl);C.ElementType="u8";let B=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint8Array,Q,V,aa,X)||this;Q.elementType="u8";return Q}c._inheritsLoose(R,S);R.prototype.slice=
function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(r.BufferViewVec2Impl);B.ElementType="u8";let A=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint8Array,Q,V,aa,X)||this;Q.elementType="u8";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(m.BufferViewVec3Impl);
A.ElementType="u8";let x=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint8Array,Q,V,aa,X)||this;Q.elementType="u8";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(d.BufferViewVec4Impl);x.ElementType="u8";let u=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint16Array,Q,V,aa,X)||this;Q.elementType="u16";return Q}c._inheritsLoose(R,S);R.prototype.slice=
function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(n.BufferViewScalarImpl);u.ElementType="u16";let y=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint16Array,Q,V,aa,X)||this;Q.elementType="u16";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(r.BufferViewVec2Impl);
y.ElementType="u16";let w=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint16Array,Q,V,aa,X)||this;Q.elementType="u16";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(m.BufferViewVec3Impl);w.ElementType="u16";let D=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint16Array,Q,V,aa,X)||this;Q.elementType="u16";return Q}c._inheritsLoose(R,S);R.prototype.slice=
function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(d.BufferViewVec4Impl);D.ElementType="u16";let F=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint32Array,Q,V,aa,X)||this;Q.elementType="u32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(n.BufferViewScalarImpl);
F.ElementType="u32";let E=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint32Array,Q,V,aa,X)||this;Q.elementType="u32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(r.BufferViewVec2Impl);E.ElementType="u32";let K=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint32Array,Q,V,aa,X)||this;Q.elementType="u32";return Q}c._inheritsLoose(R,S);R.prototype.slice=
function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(m.BufferViewVec3Impl);K.ElementType="u32";let J=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Uint32Array,Q,V,aa,X)||this;Q.elementType="u32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(d.BufferViewVec4Impl);
J.ElementType="u32";let M=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int8Array,Q,V,aa,X)||this;Q.elementType="i8";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(n.BufferViewScalarImpl);M.ElementType="i8";let N=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int8Array,Q,V,aa,X)||this;Q.elementType="i8";return Q}c._inheritsLoose(R,S);R.prototype.slice=
function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(r.BufferViewVec2Impl);N.ElementType="i8";let P=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int8Array,Q,V,aa,X)||this;Q.elementType="i8";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(m.BufferViewVec3Impl);
P.ElementType="i8";let I=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int8Array,Q,V,aa,X)||this;Q.elementType="i8";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(d.BufferViewVec4Impl);I.ElementType="i8";let G=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int16Array,Q,V,aa,X)||this;Q.elementType="i16";return Q}c._inheritsLoose(R,S);R.prototype.slice=
function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(n.BufferViewScalarImpl);G.ElementType="i16";let H=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int16Array,Q,V,aa,X)||this;Q.elementType="i16";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(r.BufferViewVec2Impl);
H.ElementType="i16";let L=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int16Array,Q,V,aa,X)||this;Q.elementType="i16";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(m.BufferViewVec3Impl);L.ElementType="i16";let O=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int16Array,Q,V,aa,X)||this;Q.elementType="i16";return Q}c._inheritsLoose(R,S);R.prototype.slice=
function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(d.BufferViewVec4Impl);O.ElementType="i16";n=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int32Array,Q,V,aa,X)||this;Q.elementType="i32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(n.BufferViewScalarImpl);
n.ElementType="i32";r=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int32Array,Q,V,aa,X)||this;Q.elementType="i32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(r.BufferViewVec2Impl);r.ElementType="i32";m=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int32Array,Q,V,aa,X)||this;Q.elementType="i32";return Q}c._inheritsLoose(R,S);R.prototype.slice=
function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(m.BufferViewVec3Impl);m.ElementType="i32";d=function(S){function R(Q,V=0,aa,X){Q=S.call(this,Int32Array,Q,V,aa,X)||this;Q.elementType="i32";return Q}c._inheritsLoose(R,S);R.prototype.slice=function(Q,V){return this.sliceBuffer(R,Q,V)};R.fromTypedArray=function(Q,V){return new R(Q.buffer,Q.byteOffset,V,Q.byteOffset+Q.byteLength)};return R}(d.BufferViewVec4Impl);
d.ElementType="i32";a.BufferViewFloat=f;a.BufferViewFloat64=q;a.BufferViewInt16=G;a.BufferViewInt32=n;a.BufferViewInt8=M;a.BufferViewMat3f=l;a.BufferViewMat3f64=b;a.BufferViewMat4f=v;a.BufferViewMat4f64=t;a.BufferViewUint16=u;a.BufferViewUint32=F;a.BufferViewUint8=C;a.BufferViewVec2f=e;a.BufferViewVec2f64=k;a.BufferViewVec2i16=H;a.BufferViewVec2i32=r;a.BufferViewVec2i8=N;a.BufferViewVec2u16=y;a.BufferViewVec2u32=E;a.BufferViewVec2u8=B;a.BufferViewVec3f=g;a.BufferViewVec3f64=p;a.BufferViewVec3i16=
L;a.BufferViewVec3i32=m;a.BufferViewVec3i8=P;a.BufferViewVec3u16=w;a.BufferViewVec3u32=K;a.BufferViewVec3u8=A;a.BufferViewVec4f=h;a.BufferViewVec4f64=z;a.BufferViewVec4i16=O;a.BufferViewVec4i32=d;a.BufferViewVec4i8=I;a.BufferViewVec4u16=D;a.BufferViewVec4u32=J;a.BufferViewVec4u8=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(r,
m,d=0,f,e){this.TypedArrayConstructor=r;this.elementCount=9;r=this.TypedArrayConstructor;void 0===f&&(f=9*r.BYTES_PER_ELEMENT);const g=0===m.byteLength?0:d;this.typedBuffer=null==e?new r(m,g):new r(m,g,(e-d)/r.BYTES_PER_ELEMENT);this.typedBufferStride=f/r.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var n=t.prototype;n.sliceBuffer=function(r,m,d=this.count-m){m=this.typedBuffer.byteOffset+
m*this.stride;return new r(this.buffer,m,this.stride,m+d*this.stride)};n.getMat=function(r,m){r*=this.typedBufferStride;for(let d=0;9>d;d++)m[d]=this.typedBuffer[r++];return m};n.setMat=function(r,m){r*=this.typedBufferStride;for(let d=0;9>d;d++)this.typedBuffer[r++]=m[d]};n.get=function(r,m){return this.typedBuffer[r*this.typedBufferStride+m]};n.set=function(r,m,d){this.typedBuffer[r*this.typedBufferStride+m]=d};n.copyFrom=function(r,m,d){const f=this.typedBuffer,e=m.typedBuffer;r*=this.typedBufferStride;
m=d*m.typedBufferStride;for(d=0;9>d;++d)f[r++]=e[m++]};c._createClass(t,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return t}();b.ElementCount=9;a.BufferViewMat3Impl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(r,m,d=0,f,e){this.TypedArrayConstructor=r;this.elementCount=16;r=this.TypedArrayConstructor;
void 0===f&&(f=16*r.BYTES_PER_ELEMENT);const g=0===m.byteLength?0:d;this.typedBuffer=null==e?new r(m,g):new r(m,g,(e-d)/r.BYTES_PER_ELEMENT);this.typedBufferStride=f/r.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var n=t.prototype;n.sliceBuffer=function(r,m,d=this.count-m){m=this.typedBuffer.byteOffset+m*this.stride;return new r(this.buffer,m,this.stride,m+d*this.stride)};n.getMat=
function(r,m){r*=this.typedBufferStride;for(let d=0;16>d;d++)m[d]=this.typedBuffer[r++];return m};n.setMat=function(r,m){r*=this.typedBufferStride;for(let d=0;16>d;d++)this.typedBuffer[r++]=m[d]};n.get=function(r,m){return this.typedBuffer[r*this.typedBufferStride+m]};n.set=function(r,m,d){this.typedBuffer[r*this.typedBufferStride+m]=d};n.copyFrom=function(r,m,d){const f=this.typedBuffer,e=m.typedBuffer;r*=this.typedBufferStride;m=d*m.typedBufferStride;for(d=0;16>d;++d)f[r++]=e[m++]};c._createClass(t,
[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return t}();b.ElementCount=16;a.BufferViewMat4Impl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(r,m,d=0,f,e){this.TypedArrayConstructor=r;this.elementCount=1;r=this.TypedArrayConstructor;void 0===f&&(f=r.BYTES_PER_ELEMENT);const g=0===m.byteLength?
0:d;this.typedBuffer=null==e?new r(m,g):new r(m,g,(e-d)/r.BYTES_PER_ELEMENT);this.stride=f;this.typedBufferStride=f/r.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride)}var n=t.prototype;n.sliceBuffer=function(r,m,d=this.count-m){m=this.typedBuffer.byteOffset+m*this.stride;return new r(this.buffer,m,this.stride,m+d*this.stride)};n.get=function(r){return this.typedBuffer[r*this.typedBufferStride]};n.set=function(r,m){this.typedBuffer[r*this.typedBufferStride]=m};
c._createClass(t,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return t}();b.ElementCount=1;a.BufferViewScalarImpl=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2"],function(a,c,b){let t=function(){function n(m,d,f=0,e,g){this.TypedArrayConstructor=m;this.elementCount=2;m=this.TypedArrayConstructor;void 0===e&&(e=2*
m.BYTES_PER_ELEMENT);const h=0===d.byteLength?0:f;this.typedBuffer=null==g?new m(d,h):new m(d,h,(g-f)/m.BYTES_PER_ELEMENT);this.typedBufferStride=e/m.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var r=n.prototype;r.sliceBuffer=function(m,d,f=this.count-d){d=this.typedBuffer.byteOffset+d*this.stride;return new m(this.buffer,d,this.stride,d+f*this.stride)};r.getVec=function(m,d){m*=
this.typedBufferStride;return b.set(d,this.typedBuffer[m],this.typedBuffer[m+1])};r.setVec=function(m,d){m*=this.typedBufferStride;this.typedBuffer[m++]=d[0];this.typedBuffer[m]=d[1]};r.get=function(m,d){return this.typedBuffer[m*this.typedBufferStride+d]};r.set=function(m,d,f){this.typedBuffer[m*this.typedBufferStride+d]=f};r.setValues=function(m,d,f){m*=this.typedBufferStride;this.typedBuffer[m++]=d;this.typedBuffer[m]=f};r.copyFrom=function(m,d,f){const e=this.typedBuffer,g=d.typedBuffer;m*=this.typedBufferStride;
d=f*d.typedBufferStride;e[m++]=g[d++];e[m]=g[d]};c._createClass(n,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return n}();t.ElementCount=2;a.BufferViewVec2Impl=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3"],function(a,c,b){let t=function(){function n(m,d,f=0,e,g){this.TypedArrayConstructor=m;this.elementCount=3;
m=this.TypedArrayConstructor;void 0===e&&(e=3*m.BYTES_PER_ELEMENT);const h=0===d.byteLength?0:f;this.typedBuffer=null==g?new m(d,h):new m(d,h,(g-f)/m.BYTES_PER_ELEMENT);this.typedBufferStride=e/m.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var r=n.prototype;r.sliceBuffer=function(m,d,f=this.count-d){d=this.typedBuffer.byteOffset+d*this.stride;return new m(this.buffer,d,this.stride,
d+f*this.stride)};r.getVec=function(m,d){m*=this.typedBufferStride;return b.set(d,this.typedBuffer[m],this.typedBuffer[m+1],this.typedBuffer[m+2])};r.setVec=function(m,d){m*=this.typedBufferStride;this.typedBuffer[m++]=d[0];this.typedBuffer[m++]=d[1];this.typedBuffer[m]=d[2]};r.get=function(m,d){return this.typedBuffer[m*this.typedBufferStride+d]};r.set=function(m,d,f){this.typedBuffer[m*this.typedBufferStride+d]=f};r.setValues=function(m,d,f,e){m*=this.typedBufferStride;this.typedBuffer[m++]=d;this.typedBuffer[m++]=
f;this.typedBuffer[m]=e};r.copyFrom=function(m,d,f){const e=this.typedBuffer,g=d.typedBuffer;m*=this.typedBufferStride;d=f*d.typedBufferStride;e[m++]=g[d++];e[m++]=g[d++];e[m]=g[d]};c._createClass(n,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return n}();t.ElementCount=3;a.BufferViewVec3Impl=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../chunks/vec4"],function(a,c,b){let t=function(){function n(m,d,f=0,e,g){this.TypedArrayConstructor=m;this.start=f;this.elementCount=4;m=this.TypedArrayConstructor;void 0===e&&(e=4*m.BYTES_PER_ELEMENT);const h=0===d.byteLength?0:f;this.typedBuffer=null==g?new m(d,h):new m(d,h,(g-f)/m.BYTES_PER_ELEMENT);this.typedBufferStride=e/m.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}
var r=n.prototype;r.sliceBuffer=function(m,d,f=this.count-d){d=this.typedBuffer.byteOffset+d*this.stride;return new m(this.buffer,d,this.stride,d+f*this.stride)};r.getVec=function(m,d){m*=this.typedBufferStride;return b.set(d,this.typedBuffer[m++],this.typedBuffer[m++],this.typedBuffer[m++],this.typedBuffer[m])};r.setVec=function(m,d){m*=this.typedBufferStride;this.typedBuffer[m++]=d[0];this.typedBuffer[m++]=d[1];this.typedBuffer[m++]=d[2];this.typedBuffer[m]=d[3]};r.get=function(m,d){return this.typedBuffer[m*
this.typedBufferStride+d]};r.set=function(m,d,f){this.typedBuffer[m*this.typedBufferStride+d]=f};r.setValues=function(m,d,f,e,g){m*=this.typedBufferStride;this.typedBuffer[m++]=d;this.typedBuffer[m++]=f;this.typedBuffer[m++]=e;this.typedBuffer[m]=g};r.copyFrom=function(m,d,f){const e=this.typedBuffer,g=d.typedBuffer;m*=this.typedBufferStride;d=f*d.typedBufferStride;e[m++]=g[d++];e[m++]=g[d++];e[m++]=g[d++];e[m]=g[d]};c._createClass(n,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);
return n}();t.ElementCount=4;a.BufferViewVec4Impl=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/types":function(){define(["exports"],function(a){a.elementTypeSize=function(c){switch(c){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(c){switch(c){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;
case "f32":case "f64":return!1}};a.isSigned=function(c){switch(c){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(c){switch(c){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./Attribute ./BufferVectorMath ./ContentObjectType ./DoubleArray ./FloatArray ./Geometry ./Indices ./Util ./VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){function p(T,U,Y){function ba(ja,ia){ja>ia&&([ja,ia]=[ia,ja]);const Z=ja.toString()+"."+ia.toString();if(ca[Z])return ca[Z];let ha=da.length;da.length+=3;A.add(da,3*ja,da,3*ia,da,ha);A.scale(da,ha,T/A.length(da,ha));ha/=3;return ca[Z]=ha}let da;Y?(da=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],Y=[0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1]):(Y=T*(1+Math.sqrt(5))/2,da=[-T,Y,0,T,Y,0,-T,-Y,0,T,-Y,0,0,-T,Y,0,T,Y,0,-T,-Y,0,T,-Y,Y,0,-T,Y,0,T,-Y,0,-T,-Y,0,T],Y=
[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]);for(var ea=0;ea<da.length;ea+=3)A.scale(da,ea,T/A.length(da,ea));let ca={};for(ea=0;ea<U;ea++){const ja=Y.length,ia=Array(4*ja);for(let Z=0;Z<ja;Z+=3){const ha=Y[Z],fa=Y[Z+1],ka=Y[Z+2],la=ba(ha,fa),na=ba(fa,ka),pa=ba(ka,ha),va=4*Z;ia[va]=ha;ia[va+1]=la;ia[va+2]=pa;ia[va+3]=fa;ia[va+4]=na;ia[va+5]=la;ia[va+6]=ka;ia[va+7]=pa;ia[va+8]=na;ia[va+9]=la;ia[va+10]=na;ia[va+
11]=pa}Y=ia;ca={}}U=h.floatArrayFrom(da);for(ea=0;ea<U.length;ea+=3)A.normalize(U,ea);Y=[[k.VertexAttribute.POSITION,Y],[k.VertexAttribute.NORMAL,Y]];return{vertexAttributes:[[k.VertexAttribute.POSITION,new d.Attribute(h.floatArrayFrom(da),3,!0)],[k.VertexAttribute.NORMAL,new d.Attribute(U,3,!0)]],indices:Y}}function z(T,U,Y,ba,da,ea,ca=t.fromValues(0,0,0)){var ja=U.length,ia=h.newFloatArray(Y.length*ja*3+(6*ba.length||0));const Z=h.newFloatArray(Y.length*ja*3+(ba?6:0)),ha=[],fa=[];let ka=0;var la=
0;const na=t.create(),pa=t.create(),va=t.create(),wa=t.create(),za=t.create(),sa=t.create(),ua=t.create(),oa=n.create(),xa=t.create(),Ea=t.create(),Ia=t.create(),Na=t.create(),Oa=t.create(),Ja=r.create();b.set(xa,0,1,0);b.subtract(pa,Y[1],Y[0]);b.normalize(pa,pa);ea?(b.add(oa,Y[0],ca),b.normalize(va,oa)):b.set(va,0,0,1);B(pa,va,xa,xa,za,va,.99619469809);b.copy(wa,va);b.copy(Na,za);for(var Sa=0;Sa<ba.length;Sa++)b.scale(sa,za,ba[Sa][0]),b.scale(oa,va,ba[Sa][2]),b.add(sa,sa,oa),b.add(sa,sa,Y[0]),ia[ka++]=
sa[0],ia[ka++]=sa[1],ia[ka++]=sa[2];Z[la++]=-pa[0];Z[la++]=-pa[1];Z[la++]=-pa[2];for(Sa=0;Sa<da.length;Sa++)ha.push(0<da[Sa][0]?da[Sa][0]:-da[Sa][0]-1+ba.length),ha.push(0<da[Sa][1]?da[Sa][1]:-da[Sa][1]-1+ba.length),ha.push(0<da[Sa][2]?da[Sa][2]:-da[Sa][2]-1+ba.length),fa.push(0),fa.push(0),fa.push(0);Sa=ba.length;const Ua=ba.length-1;for(let ma=0;ma<Y.length;ma++){let Ya=!1;0<ma&&(b.copy(na,pa),ma<Y.length-1?(b.subtract(pa,Y[ma+1],Y[ma]),b.normalize(pa,pa)):Ya=!0,b.add(Ea,na,pa),b.normalize(Ea,Ea),
b.add(Ia,Y[ma-1],wa),r.fromPositionAndNormal(Y[ma],Ea,Ja),r.intersectRay(Ja,m.wrap(Ia,na),oa)?(b.subtract(oa,oa,Y[ma]),b.normalize(va,oa),b.cross(za,Ea,va),b.normalize(za,za)):B(Ea,wa,Na,xa,za,va,.99619469809),b.copy(wa,va),b.copy(Na,za));ea&&(b.add(oa,Y[ma],ca),b.normalize(Oa,oa));for(let bb=0;bb<ja;bb++)if(b.scale(sa,za,U[bb][0]),b.scale(oa,va,U[bb][1]),b.add(sa,sa,oa),b.normalize(ua,sa),Z[la++]=ua[0],Z[la++]=ua[1],Z[la++]=ua[2],b.add(sa,sa,Y[ma]),ia[ka++]=sa[0],ia[ka++]=sa[1],ia[ka++]=sa[2],!Ya){var Za=
(bb+1)%ja;ha.push(Sa+bb);ha.push(Sa+ja+bb);ha.push(Sa+Za);ha.push(Sa+Za);ha.push(Sa+ja+bb);ha.push(Sa+ja+Za);for(Za=0;6>Za;Za++)fa.push(ha[ha.length-6+Za]-Ua)}Sa+=ja}U=Y[Y.length-1];for(Y=0;Y<ba.length;Y++)b.scale(sa,za,ba[Y][0]),b.scale(oa,va,ba[Y][1]),b.add(sa,sa,oa),b.add(sa,sa,U),ia[ka++]=sa[0],ia[ka++]=sa[1],ia[ka++]=sa[2];ba=la/3;Z[la++]=pa[0];Z[la++]=pa[1];Z[la++]=pa[2];ja=Sa-ja;for(la=0;la<da.length;la++)ha.push(0<=da[la][0]?Sa+da[la][0]:-da[la][0]-1+ja),ha.push(0<=da[la][2]?Sa+da[la][2]:
-da[la][2]-1+ja),ha.push(0<=da[la][1]?Sa+da[la][1]:-da[la][1]-1+ja),fa.push(ba),fa.push(ba),fa.push(ba);da=[[k.VertexAttribute.POSITION,ha],[k.VertexAttribute.NORMAL,fa]];ia=[[k.VertexAttribute.POSITION,new d.Attribute(ia,3,!0)],[k.VertexAttribute.NORMAL,new d.Attribute(Z,3,!0)]];return new l.Geometry(T,ia,da)}function C(T,U,Y,ba,da){if(Math.abs(b.dot(U,T))>da)return!1;b.cross(Y,T,U);b.normalize(Y,Y);b.cross(ba,Y,T);b.normalize(ba,ba);return!0}function B(T,U,Y,ba,da,ea,ca){return C(T,U,da,ea,ca)||
C(T,Y,da,ea,ca)||C(T,ba,da,ea,ca)}const A=f.Vec3Compact,x=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],u=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],y=[0,0,1,0,1,1,0,1],w=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],D=Array(36);for(f=0;6>f;f++)for(var F=0;6>F;F++)D[6*f+F]=f;const E=Array(36);for(f=0;6>f;f++)E[6*f]=0,E[6*f+1]=1,E[6*f+2]=2,E[6*f+3]=2,E[6*f+4]=3,E[6*f+5]=0;const K=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,
0,.5],[0,-.5,0],[0,.5,0]],J=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],M=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],N=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];f=t.fromValues(-.5,0,-.5);F=t.fromValues(.5,0,-.5);const P=t.fromValues(0,0,.5),I=t.fromValues(0,.5,0),G=t.create(),H=t.create(),L=t.create(),O=t.create(),S=t.create();b.subtract(G,f,I);b.subtract(H,f,F);b.cross(L,G,H);b.normalize(L,L);b.subtract(G,F,I);b.subtract(H,F,P);b.cross(O,G,H);b.normalize(O,O);b.subtract(G,
P,I);b.subtract(H,P,f);b.cross(S,G,H);b.normalize(S,S);const R=[f,F,P,I],Q=[0,-1,0,L[0],L[1],L[2],O[0],O[1],O[2],S[0],S[1],S[2]],V=[0,1,2,3,1,0,3,2,1,3,0,2],aa=[0,0,0,1,1,1,2,2,2,3,3,3],X=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]],W=t.create();a.cgToGIS=function(T,U=T){var Y=T.vertexAttributes;T=Y.get(k.VertexAttribute.POSITION).data;if(Y=Y.get(k.VertexAttribute.NORMAL).data){var ba=U.getMutableAttribute(k.VertexAttribute.NORMAL).data;for(let da=0;da<Y.length;da+=3){const ea=Y[da+1];ba[da+1]=-Y[da+2];
ba[da+2]=ea}}if(T)for(U=U.getMutableAttribute(k.VertexAttribute.POSITION).data,Y=0;Y<T.length;Y+=3)ba=T[Y+1],U[Y+1]=-T[Y+2],U[Y+2]=ba};a.createBoxGeometry=function(T,U){Array.isArray(U)||(U=[U,U,U]);const Y=Array(24);for(let ba=0;8>ba;ba++)Y[3*ba]=x[ba][0]*U[0],Y[3*ba+1]=x[ba][1]*U[1],Y[3*ba+2]=x[ba][2]*U[2];return new l.Geometry(T,[[k.VertexAttribute.POSITION,new d.Attribute(Y,3,!0)],[k.VertexAttribute.NORMAL,new d.Attribute(u,3)],[k.VertexAttribute.UV0,new d.Attribute(y,2)]],[[k.VertexAttribute.POSITION,
w],[k.VertexAttribute.NORMAL,D],[k.VertexAttribute.UV0,E]])};a.createConeGeometry=function(T,U,Y,ba,da,ea=!0,ca=!0){let ja=0;var ia=t.fromValues(0,ja,0),Z=t.fromValues(0,ja+U,0),ha=t.fromValues(0,-1,0),fa=t.fromValues(0,1,0);da&&(ja=U,Z=t.fromValues(0,0,0),ia=t.fromValues(0,ja,0),ha=t.fromValues(0,1,0),fa=t.fromValues(0,-1,0));ia=[Z,ia];ha=[ha,fa];fa=ba+2;Z=Math.sqrt(U*U+Y*Y);if(da)for(da=ba-1;0<=da;da--){var ka=2*Math.PI/ba*da,la=t.fromValues(Math.cos(ka)*Y,ja,Math.sin(ka)*Y);ia.push(la);ka=t.fromValues(U*
Math.cos(ka)/Z,-Y/Z,U*Math.sin(ka)/Z);ha.push(ka)}else for(da=0;da<ba;da++)ka=2*Math.PI/ba*da,la=t.fromValues(Math.cos(ka)*Y,ja,Math.sin(ka)*Y),ia.push(la),ka=t.fromValues(U*Math.cos(ka)/Z,Y/Z,U*Math.sin(ka)/Z),ha.push(ka);U=[];Y=[];if(ea){for(ea=3;ea<ia.length;ea++)U.push(1),U.push(ea-1),U.push(ea),Y.push(0),Y.push(0),Y.push(0);U.push(ia.length-1);U.push(2);U.push(1);Y.push(0);Y.push(0);Y.push(0)}if(ca){for(ca=3;ca<ia.length;ca++)U.push(ca),U.push(ca-1),U.push(0),Y.push(ca),Y.push(ca-1),Y.push(1);
U.push(0);U.push(2);U.push(ia.length-1);Y.push(1);Y.push(2);Y.push(ha.length-1)}ca=h.newFloatArray(3*fa);for(ea=0;ea<fa;ea++)ca[3*ea]=ia[ea][0],ca[3*ea+1]=ia[ea][1],ca[3*ea+2]=ia[ea][2];ia=h.newFloatArray(3*fa);for(ea=0;ea<fa;ea++)ia[3*ea]=ha[ea][0],ia[3*ea+1]=ha[ea][1],ia[3*ea+2]=ha[ea][2];ha=[[k.VertexAttribute.POSITION,U],[k.VertexAttribute.NORMAL,Y]];ia=[[k.VertexAttribute.POSITION,new d.Attribute(ca,3,!0)],[k.VertexAttribute.NORMAL,new d.Attribute(ia,3,!0)]];return new l.Geometry(T,ia,ha)};a.createCylinderGeometry=
function(T,U,Y,ba,da,ea,ca){da=da?t.clone(da):t.fromValues(1,0,0);ea=ea?t.clone(ea):t.fromValues(0,0,0);ca=null==ca?!0:ca;var ja=t.create();b.normalize(ja,da);var ia=t.create();b.scale(ia,ja,Math.abs(U));var Z=t.create();b.scale(Z,ia,-.5);b.add(Z,Z,ea);const ha=t.fromValues(0,1,0);.2>Math.abs(1-b.dot(ja,ha))&&b.set(ha,0,0,1);const fa=t.create();b.cross(fa,ja,ha);b.normalize(fa,fa);b.cross(ha,fa,ja);const ka=2*ba+(ca?2:0),la=ba+(ca?2:0);U=h.newFloatArray(3*ka);ea=h.newFloatArray(3*la);da=h.newFloatArray(2*
ka);const na=Array(3*ba*(ca?4:2)),pa=Array(3*ba*(ca?4:2));ca&&(U[3*(ka-2)]=Z[0],U[3*(ka-2)+1]=Z[1],U[3*(ka-2)+2]=Z[2],da[2*(ka-2)]=0,da[2*(ka-2)+1]=0,U[3*(ka-1)]=U[3*(ka-2)]+ia[0],U[3*(ka-1)+1]=U[3*(ka-2)+1]+ia[1],U[3*(ka-1)+2]=U[3*(ka-2)+2]+ia[2],da[2*(ka-1)]=1,da[2*(ka-1)+1]=1,ea[3*(la-2)]=-ja[0],ea[3*(la-2)+1]=-ja[1],ea[3*(la-2)+2]=-ja[2],ea[3*(la-1)]=ja[0],ea[3*(la-1)+1]=ja[1],ea[3*(la-1)+2]=ja[2]);ja=0;const va=t.create(),wa=t.create();for(let oa=0;oa<ba;oa++){var za=2*Math.PI/ba*oa;b.scale(va,
ha,Math.sin(za));b.scale(wa,fa,Math.cos(za));b.add(va,va,wa);ea[3*oa]=va[0];ea[3*oa+1]=va[1];ea[3*oa+2]=va[2];b.scale(va,va,Y);b.add(va,va,Z);U[3*oa]=va[0];U[3*oa+1]=va[1];U[3*oa+2]=va[2];da[2*oa]=oa/ba;da[2*oa+1]=0;U[3*(oa+ba)]=U[3*oa]+ia[0];U[3*(oa+ba)+1]=U[3*oa+1]+ia[1];U[3*(oa+ba)+2]=U[3*oa+2]+ia[2];da[2*(oa+ba)]=oa/ba;da[2*oa+1]=1;za=(oa+1)%ba;var sa=ja++,ua=oa;na[sa]=oa;pa[sa]=ua;sa=ja++;ua=oa;na[sa]=oa+ba;pa[sa]=ua;sa=ja++;ua=za;na[sa]=za;pa[sa]=ua;sa=ja++;ua=za;na[sa]=za;pa[sa]=ua;sa=ja++;
ua=oa;na[sa]=oa+ba;pa[sa]=ua;sa=ja++;ua=za;na[sa]=za+ba;pa[sa]=ua}if(ca){for(Y=0;Y<ba;Y++)ca=(Y+1)%ba,ia=ja++,Z=la-2,na[ia]=ka-2,pa[ia]=Z,ia=ja++,Z=la-2,na[ia]=Y,pa[ia]=Z,ia=ja++,Z=la-2,na[ia]=ca,pa[ia]=Z;for(Y=0;Y<ba;Y++)ca=(Y+1)%ba,ia=ja++,Z=la-1,na[ia]=Y+ba,pa[ia]=Z,ia=ja++,Z=la-1,na[ia]=ka-1,pa[ia]=Z,ia=ja++,Z=la-1,na[ia]=ca+ba,pa[ia]=Z}ba=[[k.VertexAttribute.POSITION,na],[k.VertexAttribute.NORMAL,pa],[k.VertexAttribute.UV0,na]];U=[[k.VertexAttribute.POSITION,new d.Attribute(U,3,!0)],[k.VertexAttribute.NORMAL,
new d.Attribute(ea,3,!0)],[k.VertexAttribute.UV0,new d.Attribute(da,2,!0)]];return new l.Geometry(T,U,ba)};a.createDiamondGeometry=function(T,U){Array.isArray(U)||(U=[U,U,U]);const Y=Array(18);for(let ba=0;6>ba;ba++)Y[3*ba]=K[ba][0]*U[0],Y[3*ba+1]=K[ba][1]*U[1],Y[3*ba+2]=K[ba][2]*U[2];return new l.Geometry(T,[[k.VertexAttribute.POSITION,new d.Attribute(Y,3,!0)],[k.VertexAttribute.NORMAL,new d.Attribute(J,3)]],[[k.VertexAttribute.POSITION,M],[k.VertexAttribute.NORMAL,N]])};a.createExtrudedTriangle=
function(T,U,Y,ba,da,ea=0){const ca=Array(18);U=[[-Y,ea,da/2],[ba,ea,da/2],[0,U+ea,da/2],[-Y,ea,-da/2],[ba,ea,-da/2],[0,U+ea,-da/2]];for(Y=0;6>Y;Y++)ca[3*Y]=U[Y][0],ca[3*Y+1]=U[Y][1],ca[3*Y+2]=U[Y][2];return new l.Geometry(T,[[k.VertexAttribute.POSITION,new d.Attribute(ca,3,!0)]],[[k.VertexAttribute.POSITION,[0,1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]]])};a.createPathExtrusionGeometry=z;a.createPointGeometry=function(T,U,Y,ba,da,ea,ca,ja,ia=null){Y=Y?[Y[0],Y[1],Y[2]]:[0,0,0];U=U?[U[0],U[1],
U[2]]:[0,0,1];ca=ca||[0,0];ba=ba?[255*ba[0],255*ba[1],255*ba[2],3<ba.length?255*ba[3]:255]:[255,255,255,255];da=c.isSome(da)&&2===da.length?da:[1,1];ca=[[k.VertexAttribute.POSITION,new d.Attribute(Y,3,!0)],[k.VertexAttribute.NORMAL,new d.Attribute(U,3,!0)],[k.VertexAttribute.UV0,new d.Attribute(ca,ca.length)],[k.VertexAttribute.COLOR,new d.Attribute(ba,4,!0)],[k.VertexAttribute.SIZE,new d.Attribute(da,2)]];null!=ea&&ca.push([k.VertexAttribute.AUXPOS1,new d.Attribute([ea[0],ea[1],ea[2],ea[3]],4)]);
null!=ja&&ca.push([k.VertexAttribute.AUXPOS2,new d.Attribute([ja[0],ja[1],ja[2],ja[3]],4)]);return new l.Geometry(T,ca,null,null,e.ContentObjectType.Point,ia)};a.createPolySphereData=p;a.createPolySphereGeometry=function(T,U,Y,ba){const {vertexAttributes:da,indices:ea}=p(U,Y,ba);return new l.Geometry(T,da,ea)};a.createPolylineGeometry=function(T,U,Y,ba){q.assert(1<U.length,"createPolylineGeometry(): polyline needs at least 2 points");q.assert(3===U[0].length,"createPolylineGeometry(): malformed vertex");
q.assert(null==Y||Y.length===U.length,"createPolylineGeometry: need same number of points and normals");q.assert(null==Y||3===Y[0].length,"createPolylineGeometry(): malformed normal");var da=g.newDoubleArray(3*U.length);const ea=Array(2*(U.length-1));var ca=0,ja=0;for(var ia=0;ia<U.length;ia++){for(var Z=0;3>Z;Z++)da[ca++]=U[ia][Z];0<ia&&(ea[ja++]=ia-1,ea[ja++]=ia)}ca=[];ja=[];ca.push([k.VertexAttribute.POSITION,ea]);ja.push([k.VertexAttribute.POSITION,new d.Attribute(da,3,!0)]);if(Y){da=h.newFloatArray(3*
Y.length);ia=0;for(Z=0;Z<U.length;Z++)for(let ha=0;3>ha;ha++)da[ia++]=Y[Z][ha];ca.push([k.VertexAttribute.NORMAL,ea]);ja.push([k.VertexAttribute.NORMAL,new d.Attribute(da,3,!0)])}ba&&(ja.push([k.VertexAttribute.COLOR,new d.Attribute(ba,4)]),ca.push([k.VertexAttribute.COLOR,v.generateDefaultIndexArray(ba.length/4)]));return new l.Geometry(T,ja,ca,null,e.ContentObjectType.Line)};a.createSphereGeometry=function(T,U,Y,ba,da={uv:!0}){var ea=-Math.PI,ca=2*Math.PI,ja=-Math.PI/2,ia=Math.PI;Y=Math.max(3,Math.floor(Y));
const Z=Math.max(2,Math.floor(ba));var ha=(Y+1)*(Z+1);ba=h.newFloatArray(3*ha);const fa=h.newFloatArray(3*ha);ha=h.newFloatArray(2*ha);const ka=[];var la=0;for(var na=0;na<=Z;na++){const va=[],wa=na/Z,za=ja+wa*ia,sa=Math.cos(za);for(let ua=0;ua<=Y;ua++){const oa=ua/Y;var pa=ea+oa*ca;const xa=Math.cos(pa)*sa,Ea=Math.sin(za);pa=-Math.sin(pa)*sa;ba[3*la]=xa*U;ba[3*la+1]=Ea*U;ba[3*la+2]=pa*U;fa[3*la]=xa;fa[3*la+1]=Ea;fa[3*la+2]=pa;ha[2*la]=oa;ha[2*la+1]=wa;va.push(la);++la}ka.push(va)}U=[];for(ea=0;ea<
Z;ea++)for(ca=0;ca<Y;ca++)ja=ka[ea][ca],ia=ka[ea][ca+1],la=ka[ea+1][ca+1],na=ka[ea+1][ca],0===ea?(U.push(ja),U.push(la),U.push(na)):ea===Z-1?(U.push(ja),U.push(ia),U.push(la)):(U.push(ja),U.push(ia),U.push(la),U.push(la),U.push(na),U.push(ja));Y=[[k.VertexAttribute.POSITION,U],[k.VertexAttribute.NORMAL,U]];ba=[[k.VertexAttribute.POSITION,new d.Attribute(ba,3,!0)],[k.VertexAttribute.NORMAL,new d.Attribute(fa,3,!0)]];da.uv&&(ba.push([k.VertexAttribute.UV0,new d.Attribute(ha,2,!0)]),Y.push([k.VertexAttribute.UV0,
U]));da.offset&&(Y[0][0]=k.VertexAttribute.OFFSET,ba[0][0]=k.VertexAttribute.OFFSET,Y.push([k.VertexAttribute.POSITION,Array(U.length).fill(0)]),ba.push([k.VertexAttribute.POSITION,new d.Attribute(Float64Array.from(da.offset),3,!0)]));return new l.Geometry(T,ba,Y)};a.createSquareGeometry=function(T,U=X){var Y=Array(12);for(var ba=0;4>ba;ba++)for(let da=0;3>da;da++)Y[3*ba+da]=U[ba][da];U=[0,1,2,2,3,0];ba=[0,0,0,0,0,0];U=[[k.VertexAttribute.POSITION,U],[k.VertexAttribute.NORMAL,ba],[k.VertexAttribute.UV0,
U],[k.VertexAttribute.COLOR,ba]];Y=[[k.VertexAttribute.POSITION,new d.Attribute(Y,3,!0)],[k.VertexAttribute.NORMAL,new d.Attribute([0,0,1],3,!0)],[k.VertexAttribute.UV0,new d.Attribute([0,0,1,0,1,1,0,1],2,!0)],[k.VertexAttribute.COLOR,new d.Attribute([255,255,255,255],4,!0)]];return new l.Geometry(T,Y,U)};a.createTetrahedronGeometry=function(T,U){Array.isArray(U)||(U=[U,U,U]);const Y=Array(12);for(let ba=0;4>ba;ba++)Y[3*ba]=R[ba][0]*U[0],Y[3*ba+1]=R[ba][1]*U[1],Y[3*ba+2]=R[ba][2]*U[2];return new l.Geometry(T,
[[k.VertexAttribute.POSITION,new d.Attribute(Y,3,!0)],[k.VertexAttribute.NORMAL,new d.Attribute(Q,3)]],[[k.VertexAttribute.POSITION,V],[k.VertexAttribute.NORMAL,aa]])};a.createTubeGeometry=function(T,U,Y,ba,da,ea){ba=ba||10;da=null!=da?da:!0;q.assert(1<U.length);const ca=[],ja=[];for(let ia=0;ia<ba;ia++){ca.push([0,-ia-1,-((ia+1)%ba)-1]);const Z=ia/ba*2*Math.PI;ja.push([Math.cos(Z)*Y,Math.sin(Z)*Y])}return z(T,ja,U,[[0,0,0]],ca,da,ea)};a.makeOrthoBasisDirUpFallback=B;a.transformInPlace=function(T,
U){T=T.getMutableAttribute(k.VertexAttribute.POSITION).data;for(let Y=0;Y<T.length;Y+=3)b.set(W,T[Y],T[Y+1],T[Y+2]),b.transformMat4(W,W,U),T[Y]=W[0],T[Y+1]=W[1],T[Y+2]=W[2]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Attribute":function(){define(["exports"],function(a){a.Attribute=function(c,b,t=!1,n=b){this.data=c;this.size=b;this.exclusive=t;this.stride=n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],
function(a){a.Vec3Compact=void 0;(function(c){c.length=function(b,t){const n=b[t],r=b[t+1];b=b[t+2];return Math.sqrt(n*n+r*r+b*b)};c.normalize=function(b,t){var n=b[t];const r=b[t+1],m=b[t+2];n=1/Math.sqrt(n*n+r*r+m*m);b[t]*=n;b[t+1]*=n;b[t+2]*=n};c.scale=function(b,t,n){b[t]*=n;b[t+1]*=n;b[t+2]*=n};c.add=function(b,t,n,r,m,d=t){m=m||b;m[d]=b[t]+n[r];m[d+1]=b[t+1]+n[r+1];m[d+2]=b[t+2]+n[r+2]};c.subtract=function(b,t,n,r,m,d=t){m=m||b;m[d]=b[t]-n[r];m[d+1]=b[t+1]-n[r+1];m[d+2]=b[t+2]-n[r+2]}})(a.Vec3Compact||
(a.Vec3Compact={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],function(a){a.ContentObjectType=void 0;var c=a.ContentObjectType||(a.ContentObjectType={});c[c.Layer=0]="Layer";c[c.Object=1]="Object";c[c.Mesh=2]="Mesh";c[c.Line=3]="Line";c[c.Point=4]="Point";c[c.Material=5]="Material";c[c.Texture=6]="Texture";c[c.COUNT=7]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DoubleArray":function(){define(["exports",
"../../../../core/typedArrayUtil"],function(a,c){a.doubleArrayFrom=function(b){return length<=c.NATIVE_ARRAY_MAX_SIZE?Array.from(b):new Float64Array(b)};a.doubleSubArray=function(b,t,n){return Array.isArray(b)?b.slice(t,t+n):b.subarray(t,t+n)};a.newDoubleArray=function(b,t=!1){return b<=c.NATIVE_ARRAY_MAX_SIZE?t?Array(b).fill(0):Array(b):new Float64Array(b)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/FloatArray":function(){define(["exports","../../../../core/typedArrayUtil"],
function(a,c){a.floatArrayFrom=function(b){return length<=c.NATIVE_ARRAY_MAX_SIZE?Array.from(b):new Float32Array(b)};a.floatSubArray=function(b,t,n){return Array.isArray(b)?b.slice(t,t+n):b.subarray(t,t+n)};a.newFloatArray=function(b,t=!1){return b<=c.NATIVE_ARRAY_MAX_SIZE?t?Array(b).fill(0):Array(b):new Float32Array(b)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ./AttributeArray ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Indices ./Object3DStateID ./Util ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){f=function(p){function z(B,A,x=[],u=null,y=e.ContentObjectType.Mesh,w=null,D=-1){var F=p.call(this)||this;F.material=B;F.mapPositions=u;F.type=y;F.objectAndLayerIdColor=w;F.edgeIndicesLength=D;F.visible=!0;F._vertexAttributes=new Map;F._indices=new Map;F._boundingInfo=null;for(const [E,K]of A)K&&F._vertexAttributes.set(E,{...K});if(null==x||0===x.length){B=F._vertexAttributes.values().next().value;B=null==B?0:B.data.length/B.size;A=h.generateDefaultIndexArray(B);
F.edgeIndicesLength=0>F.edgeIndicesLength?B:F.edgeIndicesLength;for(const E of F._vertexAttributes.keys())F._indices.set(E,A)}else for(const [E,K]of x)K&&(F._indices.set(E,h.compactIndices(K)),E===q.VertexAttribute.POSITION&&(F.edgeIndicesLength=0>F.edgeIndicesLength?F._indices.get(E).length:F.edgeIndicesLength));return F}c._inheritsLoose(z,p);var C=z.prototype;C.instantiate=function(B={}){const A=new z(B.material||this.material,[],void 0,this.mapPositions,this.type,this.objectAndLayerIdColor,this.edgeIndicesLength);
this._vertexAttributes.forEach((x,u)=>{x.exclusive=!1;A._vertexAttributes.set(u,x)});this._indices.forEach((x,u)=>A._indices.set(u,x));A._boundingInfo=this._boundingInfo;A.transformation=B.transformation||this.transformation;return A};C.getMutableAttribute=function(B){let A=this._vertexAttributes.get(B);A&&!A.exclusive&&(A={...A,exclusive:!0,data:r.cloneAttributeData(A.data)},this._vertexAttributes.set(B,A));return A};C.computeAttachmentOrigin=function(B){return(this.type===e.ContentObjectType.Mesh?
this._computeAttachmentOriginTriangles(B):this.type===e.ContentObjectType.Line?this._computeAttachmentOriginLines(B):this._computeAttachmentOriginPoints(B))?(b.isSome(this._transformation)&&n.transformMat4(B,B,this._transformation),!0):!1};C._computeAttachmentOriginTriangles=function(B){const A=this.indices.get(q.VertexAttribute.POSITION),x=this.vertexAttributes.get(q.VertexAttribute.POSITION);return g.computeAttachmentOriginTriangles(x,A,B)};C._computeAttachmentOriginLines=function(B){const A=this.vertexAttributes.get(q.VertexAttribute.POSITION),
x=this.indices.get(q.VertexAttribute.POSITION);var u=g.computeAttachmentOriginLines,y;if(y=x)y=this.material.parameters,y="isClosed"in y&&y.isClosed?x?2<x.length:6<A.data.length:!1;return u.call(g,A,x,y,B)};C._computeAttachmentOriginPoints=function(B){const A=this.indices.get(q.VertexAttribute.POSITION),x=this.vertexAttributes.get(q.VertexAttribute.POSITION);return g.computeAttachmentOriginPoints(x,A,B)};C.invalidateBoundingInfo=function(){this._boundingInfo=null};C._calculateBoundingInfo=function(){const B=
this.indices.get(q.VertexAttribute.POSITION),A=this.vertexAttributes.get(q.VertexAttribute.POSITION);if(!B||0===B.length||!A)return null;const x=this.type===e.ContentObjectType.Mesh?3:1;v.assert(0===B.length%x,"Indexing error: "+B.length+" not divisible by "+x);const u=h.generateDefaultIndexArray(B.length/x);return new d.BoundingInfo(u,x,B,A)};C.addHighlight=function(){const B=new l.Object3DStateID(m.Object3DState.Highlight);this.highlights=k.addObject3DStateID(this.highlights,B);return B};C.removeHighlight=
function(B){this.highlights=k.removeObject3DStateID(this.highlights,B)};c._createClass(z,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const B=this._indices.values().next().value;return B?B.length:0}},{key:"faceCount",get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){b.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}},
{key:"transformation",get:function(){return b.unwrapOr(this._transformation,t.IDENTITY)},set:function(B){this._transformation=B&&B!==t.IDENTITY?t.clone(B):null}},{key:"shaderTransformation",get:function(){return b.isSome(this._shaderTransformer)?this._shaderTransformer(this.transformation):this.transformation}},{key:"shaderTransformer",get:function(){return this._shaderTransformer},set:function(B){this._shaderTransformer=B}},{key:"hasVolatileTransformation",get:function(){return b.isSome(this._shaderTransformer)}}]);
return z}(f.ContentObject);a.Geometry=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AttributeArray":function(){define(["exports","../../../../core/typedArrayUtil"],function(a,c){a.cloneAttributeData=function(b){if(b.length<c.NATIVE_ARRAY_MAX_SIZE)return Array.from(b);if(Array.isArray(b))return Float64Array.from(b);switch(b.BYTES_PER_ELEMENT){case 1:return Uint8Array.from(b);case 2:return Uint16Array.from(b);case 4:return Float32Array.from(b);default:case 8:return Float64Array.from(b)}};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],function(a,c,b,t,n){let r=function(){function d(f,e,g,h){this.primitiveIndices=f;this._numIndexPerPrimitive=e;this.indices=g;this.position=h;this._children=void 0;n.assert(1<=f.length);n.assert(0===g.length%this._numIndexPerPrimitive);n.assert(g.length>=f.length*this._numIndexPerPrimitive);
n.assert(3===h.size||4===h.size);const {data:l,size:v}=h;var q=f.length;e=v*g[this._numIndexPerPrimitive*f[0]];m.clear();m.push(e);h=t.fromValues(l[e],l[e+1],l[e+2]);var k=t.clone(h);for(var p=0;p<q;++p){var z=this._numIndexPerPrimitive*f[p];for(let C=0;C<this._numIndexPerPrimitive;++C){e=v*g[z+C];m.push(e);let B=l[e];h[0]=Math.min(B,h[0]);k[0]=Math.max(B,k[0]);B=l[e+1];h[1]=Math.min(B,h[1]);k[1]=Math.max(B,k[1]);B=l[e+2];h[2]=Math.min(B,h[2]);k[2]=Math.max(B,k[2])}}this.bbMin=h;this.bbMax=k;f=b.lerp(t.create(),
this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(k[0]-h[0],k[1]-h[1]),k[2]-h[2]);g=this.radius*this.radius;for(h=0;h<m.length;++h)e=m.getItemAt(h),k=l[e]-f[0],q=l[e+1]-f[1],e=l[e+2]-f[2],p=k*k+q*q+e*e,p<=g||(p=Math.sqrt(p),z=.5*(p-this.radius),this.radius+=z,g=this.radius*this.radius,p=z/p,f[0]+=k*p,f[1]+=q*p,f[2]+=e*p);this.center=f;m.clear()}d.prototype.getChildren=function(){if(this._children||1>=b.squaredDistance(this.bbMin,this.bbMax))return this._children;var f=b.lerp(t.create(),this.bbMin,
this.bbMax,.5),e=this.primitiveIndices.length;const g=new Uint8Array(e),h=Array(8);for(var l=0;8>l;++l)h[l]=0;const {data:v,size:q}=this.position;for(l=0;l<e;++l){var k=0;const z=this._numIndexPerPrimitive*this.primitiveIndices[l];var p=q*this.indices[z];let C=v[p],B=v[p+1],A=v[p+2];for(let x=1;x<this._numIndexPerPrimitive;++x){p=q*this.indices[z+x];const u=v[p],y=v[p+1];p=v[p+2];u<C&&(C=u);y<B&&(B=y);p<A&&(A=p)}C<f[0]&&(k|=1);B<f[1]&&(k|=2);A<f[2]&&(k|=4);g[l]=k;++h[k]}f=0;for(l=0;8>l;++l)0<h[l]&&
++f;if(!(2>f)){f=Array(8);for(l=0;8>l;++l)f[l]=0<h[l]?new Uint32Array(h[l]):void 0;for(l=0;8>l;++l)h[l]=0;for(l=0;l<e;++l)k=g[l],f[k][h[k]++]=this.primitiveIndices[l];this._children=[];for(e=0;8>e;++e)void 0!==f[e]&&this._children.push(new d(f[e],this._numIndexPerPrimitive,this.indices,this.position));return this._children}};d.prune=function(){m.prune()};return d}();const m=new c({deallocator:null});a.BoundingInfo=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports",
"../../../../chunks/vec2f64","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,c,b,t){function n(d,f){if(!d)throw f=f||"Assertion",new m(`${f} at ${Error(f).stack}`);}const r=t.create();let m=function(){function d(f){this.message=f}d.prototype.toString=function(){return`AssertException: ${this.message}`};return d}();a.assert=n;a.isTranslationMatrix=function(d){return 1===d[0]&&0===d[1]&&0===d[2]&&0===d[3]&&0===d[4]&&1===d[5]&&0===d[6]&&0===d[7]&&0===d[8]&&0===d[9]&&1===d[10]&&0===
d[11]&&1===d[15]};a.logWithBase=function(d,f){return Math.log(d)/Math.log(f)};a.project=function(d,f,e,g,h){r[0]=d[0];r[1]=d[1];r[2]=d[2];r[3]=1;b.transformMat4(r,r,f);2<h.length&&(h[2]=-r[2]);b.transformMat4(r,r,e);n(0!==r[3]);h[0]=r[0]/r[3];h[1]=r[1]/r[3];h[2]=r[2]/r[3];h[0]=(.5*h[0]+.5)*g[2]+g[0];h[1]=(.5*h[1]+.5)*g[3]+g[1]};a.rayBoxTest=function(d,f,e,g){let h,l=(e[0]-d[0])/f[0],v=(g[0]-d[0])/f[0];l>v&&(h=l,l=v,v=h);let q=(e[1]-d[1])/f[1],k=(g[1]-d[1])/f[1];q>k&&(h=q,q=k,k=h);if(l>k||q>v)return!1;
q>l&&(l=q);k<v&&(v=k);e=(e[2]-d[2])/f[2];d=(g[2]-d[2])/f[2];e>d&&(h=e,e=d,d=h);if(l>d||e>v)return!1;d<v&&(v=d);return 0>v?!1:!0};a.rayRay2D=function(d,f,e,g,h,l=c.create()){const v=(g[h]-e[h])*(f[0]-d[0])-(g[0]-e[0])*(f[h]-d[h]);if(0===v)return!1;e=((g[0]-e[0])*(d[h]-e[h])-(g[h]-e[h])*(d[0]-e[0]))/v;l[0]=d[0]+e*(f[0]-d[0]);l[1]=d[h]+e*(f[h]-d[h]);return!0};a.setMatrixTranslation3=function(d,f,e,g){d[12]=f;d[13]=e;d[14]=g};a.verify=function(d,f){d||console.warn("Verify failed: "+(f||"")+"\n"+Error("verify").stack)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../core/uid"],function(a,c){let b=function(){function t(){this.id=c.generateUID()}t.prototype.unload=function(){};return t}();a.ContentObject=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],
function(a,c,b,t){const n=b.create(),r=b.create(),m=b.create(),d=b.create();a.computeAttachmentOriginLines=function(f,e,g,h){if(!f)return!1;c.set(h,0,0,0);c.set(d,0,0,0);let l=0,v=0;const {size:q,data:k}=f;f=e?e.length-1:k.length/q-1;g=f+(g?2:0);for(let C=0;C<g;C+=2){var p=C<f?C:f,z=C<f?C+1:0;p=(e?e[p]:p)*q;z=(e?e[z]:z)*q;n[0]=k[p];n[1]=k[p+1];n[2]=k[p+2];r[0]=k[z];r[1]=k[z+1];r[2]=k[z+2];c.scale(n,c.add(n,n,r),.5);z=c.dist(n,r);0<z?(c.add(h,h,c.scale(n,n,z)),l+=z):0===l&&(c.add(d,d,n),v++)}return 0!==
l?(c.scale(h,h,1/l),!0):0!==v?(c.scale(h,d,1/v),!0):!1};a.computeAttachmentOriginPoints=function(f,e,g){if(!f||!e)return!1;const {size:h,data:l}=f;c.set(g,0,0,0);f=-1;let v=0;for(let q=0;q<e.length;q++){const k=e[q]*h;f!==k&&(g[0]+=l[k+0],g[1]+=l[k+1],g[2]+=l[k+2],v++);f=k}1<v&&c.scale(g,g,1/v);return 0<v};a.computeAttachmentOriginTriangles=function(f,e,g){if(!f||!e)return!1;const {size:h,data:l}=f;c.set(g,0,0,0);c.set(d,0,0,0);let v=f=0;for(let k=0;k<e.length-2;k+=3){var q=e[k+0]*h;const p=e[k+1]*
h,z=e[k+2]*h;c.set(n,l[q+0],l[q+1],l[q+2]);c.set(r,l[p+0],l[p+1],l[p+2]);c.set(m,l[z+0],l[z+1],l[z+2]);(q=t.areaPoints3d(n,r,m))?(c.add(n,n,r),c.add(n,n,m),c.scale(n,n,1/3*q),c.add(g,g,n),f+=q):(c.add(d,d,n),c.add(d,d,r),c.add(d,d,m),v+=3)}return 0===v&&0===f?!1:0!==f?(c.scale(g,g,1/f),!0):0!==v?(c.scale(g,d,1/v),!0):!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),
function(a,c,b,t,n,r){function m(v){return v?{p0:t.clone(v.p0),p1:t.clone(v.p1),p2:t.clone(v.p2)}:{p0:t.create(),p1:t.create(),p2:t.create()}}function d(v,q,k,p=m()){b.copy(p.p0,v);b.copy(p.p1,q);b.copy(p.p2,k);return p}function f(v,q,k){return.5*Math.abs((q[0]-v[0])*(k[1]-v[1])-(q[1]-v[1])*(k[0]-v[0]))}const e=new c.ObjectStack(n.create),g=new c.ObjectStack(()=>m()),h=t.create(),l=t.create();a.area2d=function(v){return f(v.p0,v.p1,v.p2)};a.areaPoints2d=f;a.areaPoints3d=function(v,q,k){b.subtract(h,
q,v);b.subtract(l,k,v);return b.length(b.cross(h,h,l))/2};a.copy=function(v,q=m()){return d(v.p0,v.p1,v.p2,q)};a.create=m;a.distance2=function(v,q){var k=v.p0,p=v.p1;v=v.p2;const z=b.subtract(r.sv3d.get(),p,k),C=b.subtract(r.sv3d.get(),v,p),B=b.subtract(r.sv3d.get(),k,v),A=b.subtract(r.sv3d.get(),q,k);var x=b.subtract(r.sv3d.get(),q,p),u=b.subtract(r.sv3d.get(),q,v);const y=b.cross(z,z,B),w=b.dot(b.cross(r.sv3d.get(),z,y),A);x=b.dot(b.cross(r.sv3d.get(),C,y),x);u=b.dot(b.cross(r.sv3d.get(),B,y),u);
if(0<w&&0<x&&0<u)return q=b.dot(y,A),q*q/b.dot(y,y);k=n.distance2(n.fromValues(k,z,e.get()),q);p=n.distance2(n.fromValues(p,C,e.get()),q);q=n.distance2(n.fromValues(v,B,e.get()),q);return Math.min(k,p,q)};a.fromValues=d;a.intersectRay=function(v,q,k){const {direction:p,origin:z}=q,{p0:C,p1:B,p2:A}=v;var x=B[0]-C[0],u=B[1]-C[1],y=B[2]-C[2];v=A[0]-C[0];q=A[1]-C[1];const w=A[2]-C[2];var D=p[1]*w-q*p[2],F=p[2]*v-w*p[0];const E=p[0]*q-v*p[1];var K=x*D+u*F+y*E;if(-1E-5<K&&1E-5>K)return!1;K=1/K;const J=
z[0]-C[0],M=z[1]-C[1],N=z[2]-C[2];D=K*(J*D+M*F+N*E);if(0>D||1<D)return!1;F=M*y-u*N;y=N*x-y*J;x=J*u-x*M;u=K*(p[0]*F+p[1]*y+p[2]*x);if(0>u||1<D+u)return!1;k&&(b.scale(k,p,K*(v*F+q*y+w*x)),b.add(k,z,k));return!0};a.wrap=function(v,q,k){const p=g.get();p.p0=v;p.p1=q;p.p2=k;return p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Indices":function(){define(["exports","../../../../core/typedArrayUtil"],function(a,c){let b=(()=>{const r=new Uint32Array(131072);
for(let m=0;m<r.length;++m)r[m]=m;return r})();const t=[0],n=(()=>{const r=new Uint16Array(65536);for(let m=0;m<r.length;++m)r[m]=m;return r})();a.compactIndices=function(r){if(Array.isArray(r)){if(r.length<c.NATIVE_ARRAY_MAX_SIZE)return r;for(const m of r)if(65536<=m)return new Uint32Array(r);return new Uint16Array(r)}if(r.length<c.NATIVE_ARRAY_MAX_SIZE)return Array.from(r);if(r.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return r;for(const m of r)if(65536<=m)return r;return new Uint16Array(r)};
a.generateDefaultIndexArray=function(r){if(1===r)return t;if(r<c.NATIVE_ARRAY_MAX_SIZE)return Array.from(new Uint16Array(n.buffer,0,r));if(r<n.length)return new Uint16Array(n.buffer,0,r);if(r>b.length){b=new Uint32Array(Math.max(2*b.length,r));for(let m=0;m<b.length;m++)b[m]=m}return new Uint32Array(b.buffer,0,r)};a.generateIndexArray=function(r){if(1===r)return t;if(r<c.NATIVE_ARRAY_MAX_SIZE)return Array.from(new Uint16Array(n.buffer,0,r));if(r<n.length)return new Uint16Array(n.slice(0,r));if(r>
b.length){r=new Uint32Array(r);for(let m=0;m<r.length;m++)r[m]=m;return r}return new Uint32Array(b.slice(0,r))};a.newIndexArray=function(r){r*=3;return r<=c.NATIVE_ARRAY_MAX_SIZE?Array(r):65536>=r?new Uint16Array(r):new Uint32Array(r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,c){a.Object3DStateID=function(b){this.channel=b;this.id=c.generateUID()};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define(["exports","../../../../../core/maybe","../../../../../chunks/vec3f64","../../../../webgl/doublePrecisionUtils"],function(a,c,b,t){const n=b.create(),r=new Float32Array(6);a.addObject3DStateID=function(m,d){c.isNone(m)&&(m=[]);m.push(d);return m};a.encodeDoubleVec3=function(m,d,f,e,g){n[0]=m.get(d,0);n[1]=m.get(d,1);n[2]=m.get(d,2);t.encodeDoubleArray(n,r,3);f.set(g,0,r[0]);e.set(g,0,r[1]);
f.set(g,1,r[2]);e.set(g,1,r[3]);f.set(g,2,r[4]);e.set(g,2,r[5])};a.removeObject3DStateID=function(m,d){if(c.isNone(m))return null;m=m.filter(f=>f!==d);return 0===m.length?null:m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){const c=new Float32Array(2);a.decodeDoubleArray=function(b,t,n){for(let r=0;r<n;++r)t[r]=b[2*r]+b[2*r+1]};a.encodeDoubleArray=function(b,t,n){for(let r=0;r<n;++r)t[2*r]=b[r],t[2*
r+1]=b[r]-t[2*r]};a.encodeDoubleHi=function(b,t){const n=b.length;for(let r=0;r<n;++r)c[0]=b[r],t[r]=c[0];return t};a.encodeDoubleLo=function(b,t){const n=b.length;for(let r=0;r<n;++r)c[0]=b[r],c[1]=b[r]-c[0],t[r]=c[1];return t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../core/support/WatchUpdatingTracking ../../../geometry/ellipsoidUtils ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){a.Precipitation=function(D){function F(K){var J=D.call(this,K)||this;J._numParticles=25E4;J._rainSpeed=.1;J._snowSpeed=.01;J._passParameters=new v.PrecipitationPassParameters;J._animation=new z.AnimationTimer;J._updatingTracking=new h.WatchUpdatingTracking;J._passParameters.time=0;J._passParameters.radius=l.getReferenceEllipsoid(K.view.spatialReference).radius;J._techniqueRepository=K.context.techniqueRepository;return J}c._inheritsLoose(F,D);
var E=F.prototype;E.destroy=function(){this._updatingTracking.destroy();this._numParticles=0;this._snowTechniqueCached=r.releaseMaybe(this._snowTechniqueCached);this._rainTechniqueCached=r.releaseMaybe(this._rainTechniqueCached);this._vao=r.disposeMaybe(this._vao);this._instanceIdBuffer=r.disposeMaybe(this._instanceIdBuffer)};E.update=function(K){return this._animation.advance(K)};E.render=function(K,J,M){const N="rainy"===M?this._rainTechnique:this._snowTechnique;if(N.compiled){var P=K.rctx;this._ensureResources(P);
r.isNone(N)||r.isNone(this._vao)||r.isNone(this._instanceIdBuffer)||(r.isSome(K.bindParameters.cloudsFade.data)&&(this._passParameters.opacity=1-K.bindParameters.cloudsFade.fadeInOutHeight.factor),0>=this._passParameters.opacity||(J=.5>J?n.lerp(0,.35,2*J):n.lerp(.35,1,2*(J-.5)),this._passParameters.time=("rainy"===M?this._rainSpeed:this._snowSpeed)*m.secondsFromMilliseconds(this._animation.time)%1E5,K=P.bindTechnique(N,this._passParameters,K.bindParameters),P.bindVAO(this._vao),K.assertCompatibleVertexAttributeLocations(this._vao),
u.bindVertexBufferLayout(P,v.attributeLocations,this._instanceIdBuffer,w,0),P.capabilities.instancing?.drawArraysInstanced(x.PrimitiveType.TRIANGLES,0,3,this._numParticles*J),u.unbindVertexBufferLayout(P,v.attributeLocations,this._instanceIdBuffer,w)))}else this.context.requestRender()};E._ensureResources=function(K){r.isNone(this._vao)&&(this._vao=this._createVertexArrayObject(K));r.isNone(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(K))};E._createInstanceIndices=
function(K){const J=[];for(let M=0;M<this._numParticles;M++)J.push(M);return A.BufferObject.createVertex(K,x.Usage.STATIC_DRAW,new Float32Array(J))};E._createVertexArrayObject=function(K){const J=new Float32Array([-1,0,1,1,0,-1,1,0,1]);return new C.VertexArrayObject(K,v.attributeLocations,{geometry:k.glLayout(y)},{geometry:A.BufferObject.createVertex(K,x.Usage.STATIC_DRAW,J)})};c._createClass(F,[{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"_rainTechnique",get:function(){if(r.isNone(this._rainTechniqueCached)){const K=
new q.PrecipitationTechniqueConfiguration;K.type=q.PrecipitationType.Rain;this._rainTechniqueCached=this._techniqueRepository.acquire(v.PrecipitationTechnique,K)}return this._rainTechniqueCached}},{key:"_snowTechnique",get:function(){if(r.isNone(this._snowTechniqueCached)){const K=new q.PrecipitationTechniqueConfiguration;K.type=q.PrecipitationType.Snow;this._snowTechniqueCached=this._techniqueRepository.acquire(v.PrecipitationTechnique,K)}return this._snowTechniqueCached}}]);return F}(t);b.__decorate([d.property({constructOnly:!0})],
a.Precipitation.prototype,"context",void 0);b.__decorate([d.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0})],a.Precipitation.prototype,"updating",null);b.__decorate([d.property()],a.Precipitation.prototype,"_updatingTracking",void 0);a.Precipitation=b.__decorate([g.subclass("esri.views.3d.environment.Precipitation")],a.Precipitation);const y=p.newLayout().vec3f(B.VertexAttribute.POSITION),w=k.glLayout(p.newLayout().f32(B.VertexAttribute.INSTANCEFEATUREATTRIBUTE),
1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){n=function(l){function v(){var q=l.apply(this,arguments)||this;q.time=0;q.radius=1;q.width=500;q.opacity=1;return q}b._inheritsLoose(v,l);return v}(n.NoParameters);m=function(l){function v(){return l.apply(this,arguments)||this}b._inheritsLoose(v,l);var q=v.prototype;q.initializeProgram=function(k){return new d.Program(k.rctx,v.shader.get().build(this.configuration),h)};q.initializePipeline=function(){return g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.ONE,
e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams})};return v}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(t.Precipitation,()=>new Promise((l,v)=>a(["./Precipitation.glsl"],l,v)));const h=new Map([[f.VertexAttribute.POSITION,0],[f.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);c.PrecipitationPassParameters=n;c.PrecipitationTechnique=m;c.attributeLocations=h;Object.defineProperty(c,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Precipitation.glsl":function(){define("exports ./vec3 ./vec3f64 ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(k){const p=new f.ShaderBuilder;p.attributes.add(e.VertexAttribute.POSITION,"vec3");p.attributes.add(e.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");p.vertex.uniforms.add(new n.Float3PassUniform("cameraPosition",(z,C)=>C.camera.eye));p.vertex.uniforms.add(new n.Float3PassUniform("offset",(z,C)=>{C=C.camera.eye;var B=.5*z.width;const A=1/z.width;B=c.floor(h,c.set(h,(C[0]+B)*A,(C[1]+B)*A,(C[2]+B)*A));return c.sub(B,C,c.scale(B,B,z.width))}));p.vertex.uniforms.add(new r.FloatPassUniform("width",
z=>z.width));p.vertex.uniforms.add(new d.Matrix4PassUniform("proj",(z,C)=>C.camera.projectionMatrix));p.vertex.uniforms.add(new d.Matrix4PassUniform("view",(z,C)=>C.camera.viewMatrix));p.vertex.uniforms.add(new r.FloatPassUniform("time",z=>z.time));p.varyings.add("vUv","vec2");p.vertex.code.add(m.glsl`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${k.type===t.PrecipitationType.Rain?m.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:m.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);p.fragment.uniforms.add([new r.FloatPassUniform("opacity",z=>z.opacity),new n.Float3PassUniform("particleColor",(z,C)=>{z=k.type===t.PrecipitationType.Rain?q:v;const B=c.scale(h,z,.7);c.normalize(l,C.camera.eye);C=Math.max(0,c.dot(l,C.lighting.mainLight.direction));return c.lerp(B,B,z,C)})]);p.fragment.code.add(m.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${k.type===t.PrecipitationType.Rain?m.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:m.glsl`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `);return p}const h=b.create(),l=b.create(),v=b.fromValues(1,1,1),q=b.fromValues(.85,.85,.85);b=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.Precipitation=b;a.build=g})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,c,b,t){a.PrecipitationType=void 0;
(function(r){r[r.Rain=0]="Rain";r[r.Snow=1]="Snow";r[r.COUNT=2]="COUNT"})(a.PrecipitationType||(a.PrecipitationType={}));let n=function(r){function m(){var d=r.apply(this,arguments)||this;d.type=a.PrecipitationType.Rain;return d}c._inheritsLoose(m,r);return m}(t.ShaderTechniqueConfiguration);b.__decorate([t.parameter({count:a.PrecipitationType.COUNT})],n.prototype,"type",void 0);a.PrecipitationTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/time"],function(a,c,b,t){let n=function(){function r(){this.enabled=!0;this._time=t.Milliseconds(0)}r.prototype.advance=function({deltaTime:m,fixedTime:d}){if(b.isSome(d)){if(this._time===d)return!1;this._time=d;return!0}this._time=t.Milliseconds(this._time+m);return 0!==m};c._createClass(r,[{key:"time",get:function(){return this._time}}]);return r}();a.AnimationTimer=n;a.Parameters=function(r,m){this.deltaTime=
r;this.fixedTime=m};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/spatialReferenceUtils ./AtmosphereType ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ./resources/SimpleAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/FloatArray ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J){function M(O,S,R,Q,V){const aa=m.length(O),X=Q*Math.sqrt(aa*aa-Q*Q)/aa,W=V.v1,T=V.v2;m.scale(V.center,O,Math.sqrt(Q*Q-X*X)/aa);m.cross(W,O,S);1>m.squaredLength(W)&&m.cross(W,O,R);m.scale(W,W,X/m.length(W));m.cross(T,W,O);m.scale(T,T,X/m.length(T));return X}const N=-h.innerAtmosphereDepth,P=z.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);z=function(){function O(R,Q){this.view=R;this.type=
g.AtmosphereType.Simple;this._passParameters=new l.SimpleAtmospherePassParameters;this._vaoCount=0;this._texV1=1;this._isMars=e.isMars(R.spatialReference);R=f.getReferenceEllipsoid(R.spatialReference);this._planetRadius=R.radius;this._outerRimWidth=R.outerAtmosphereRimWidth;this._innerRimFactor=(this._planetRadius+N)/this._planetRadius;this._middleRimFactor=(this._planetRadius+0)/this._planetRadius;this._outerRimFactor=(this._planetRadius+this._outerRimWidth)/this._planetRadius;this._texV0=0/this._outerRimWidth;
this._texVScale=this._texV1-this._texV0;this._techniqueRepository=Q.techniqueRepository;R=Q.renderContext.rctx;this._cameraChangeHandle=b.watch(()=>this.view.state?.camera,()=>Q.requestRender(),b.syncAndInitial);this._vao=this._createRibbon(R);this._vaoCount=J.vertexCount(this._vao,"geometry");this._fadeVao=u.createQuadVAO(R);this._fadeVaoCount=J.vertexCount(this._fadeVao,"geometry");this._passParameters.texture=new K.Texture(R,{pixelFormat:E.PixelFormat.RGBA,dataType:E.PixelType.UNSIGNED_BYTE,wrapMode:E.TextureWrapMode.CLAMP_TO_EDGE,
samplingMode:E.TextureSamplingMode.LINEAR,flipped:!0,width:1,height:512},this._isMars?k.marsAtmosphereTextureSimple:p.earthAtmosphereTextureSimple);R=new q.SimpleAtmosphereTechniqueConfiguration;R.geometry=q.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._techniqueRepository.acquire(v.SimpleAtmosphereTechnique,R);R.geometry=q.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._techniqueRepository.acquire(v.SimpleAtmosphereTechnique,R)}var S=O.prototype;S.destroy=function(){this._coneTechnique.release();
this._undergroundTechnique.release();this._cameraChangeHandle.remove();this._passParameters.texture=c.disposeMaybe(this._passParameters.texture);this._fadeVao.dispose();this._vao.dispose()};S.render=function(R){this._update(R.bindParameters.camera);const Q=R.rctx;1>this._passParameters.undergroundFadeAlpha&&(Q.bindTechnique(this._coneTechnique,this._passParameters,R.bindParameters),Q.bindVAO(this._vao),Q.drawArrays(E.PrimitiveType.TRIANGLES,0,this._vaoCount));0<this._passParameters.undergroundFadeAlpha&&
(Q.bindTechnique(this._undergroundTechnique,this._passParameters,R.bindParameters),Q.bindVAO(this._fadeVao),Q.drawArrays(E.PrimitiveType.TRIANGLE_STRIP,0,this._fadeVaoCount))};S.renderHaze=function(){};S._update=function(R){var Q=d.create();const V=this._planetRadius;var aa=m.length(R.eye);const X=aa-V;this._passParameters.undergroundFadeAlpha=0>X?Math.min(-X/5E3,1):0;var W=V+N,T=V+Math.max(50,X);this._passParameters.innerScale=T*T/(Math.sqrt(T*T-V*V)*Math.sqrt(T*T-W*W)+V*W)-1;this._passParameters.altitudeFade=
h.computeInnerAltitudeFade(X);m.scale(Q,R.eye,(V+50)/aa);M(Q,R.center,R.up,V,this._passParameters.silhouette);Q=this._computeScreenRimWidth(R,Q,R.up,this._passParameters.silhouette);aa=P(X);W=this._texV0+.001953125*this._texVScale;T=this._texV0+Q*aa*this._texVScale;50<X&&(M(R.eye,R.center,R.up,V,this._passParameters.silhouette),R=this._computeScreenRimWidth(R,R.eye,R.up,this._passParameters.silhouette),R=a.clamp((R-1.5)/(Q-1.5),0,1),W=this._texV0+.001953125*R*this._texVScale,T=this._texV0+a.lerp(this._texV1,
Q*aa,R)*this._texVScale);r.set(this._passParameters.texV,W,T)};S._createRibbon=function(R){const Q=x.newFloatArray(1155),V=new Uint32Array(1920);Q[0]=0;Q[1]=0;Q[2]=-1;for(var aa=0;128>aa;aa++){var X=9*aa+3;Q[X+0]=aa;Q[X+1]=this._innerRimFactor;Q[X+2]=-1;Q[X+3]=aa;Q[X+4]=this._middleRimFactor;Q[X+5]=0;Q[X+6]=aa;Q[X+7]=this._outerRimFactor;Q[X+8]=1;X=3*aa+1;var W=127===aa?1:X+3,T=15*aa;V[T+0]=X;V[T+1]=X+1;V[T+2]=W+1;V[T+3]=W+1;V[T+4]=W;V[T+5]=X;V[T+6]=X+1;V[T+7]=X+2;V[T+8]=W+2;V[T+9]=W+2;V[T+10]=W+
1;V[T+11]=X+1;V[T+12]=X;V[T+13]=W;V[T+14]=0}aa=L.createBuffer(V.length);X=aa.position;for(W=0;W<V.length;++W)T=3*V[W],X.set(W,0,Q[T]),X.set(W,1,Q[T+1]),X.set(W,2,Q[T+2]);return new w.VertexArrayObject(R,A.Default3D,{geometry:C.glLayout(L)},{geometry:F.BufferObject.createVertex(R,E.Usage.STATIC_DRAW,aa.buffer)})};S._computeScreenRimWidth=function(R,Q,V,aa){m.add(G,aa.center,aa.v2);m.scale(H,G,this._outerRimFactor);t.lookAt(I,Q,G,V);y.project(G,I,R.projectionMatrix,R.viewport,G);y.project(H,I,R.projectionMatrix,
R.viewport,H);return m.distance(G,H)/R.height};return O}();const I=n.create(),G=d.create(),H=d.create(),L=B.newLayout().vec3f(D.VertexAttribute.POSITION);return z})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(["exports"],function(a){const c=new Uint8ClampedArray([0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,2,0,0,0,3,0,0,0,3,0,0,0,3,0,0,0,4,0,0,0,4,0,0,0,4,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,5,0,0,0,6,0,0,0,6,0,0,0,7,0,0,0,7,0,
0,0,7,0,0,0,8,0,0,0,8,0,0,0,8,0,0,0,9,0,0,0,9,0,0,0,9,0,0,0,10,0,0,0,10,0,0,0,11,0,0,0,11,0,0,0,11,0,0,0,12,0,0,0,12,0,0,0,12,0,0,0,13,0,0,0,13,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,14,0,0,0,15,0,0,0,15,0,0,0,16,0,0,0,16,0,0,0,16,0,0,0,17,0,0,0,17,0,0,0,18,0,0,0,18,0,0,0,19,0,0,0,19,0,0,0,19,0,0,0,20,0,0,0,20,0,0,0,21,0,0,0,21,0,0,0,22,0,0,0,22,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,23,11,0,0,24,11,0,0,24,11,0,0,24,10,0,0,25,10,0,0,25,10,0,0,26,10,0,0,26,9,0,0,27,9,0,0,27,9,0,0,28,9,0,0,28,9,0,
0,29,9,0,0,29,8,0,0,30,8,0,0,30,8,0,0,31,8,0,0,31,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,32,8,0,0,33,8,0,0,33,8,0,0,34,7,0,0,35,7,0,0,35,7,0,0,36,7,0,0,36,7,7,0,37,7,7,0,37,7,7,0,38,7,7,0,38,13,7,0,39,13,7,0,39,13,6,0,40,13,6,0,40,12,6,0,41,12,6,0,41,12,6,0,41,12,6,0,42,12,6,0,42,12,6,0,43,12,6,0,43,12,6,0,44,12,6,0,44,11,6,0,45,11,6,6,45,11,6,6,46,11,5,5,47,11,5,5,47,11,5,5,48,11,5,5,48,10,5,5,49,10,5,5,49,10,5,5,50,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,51,15,5,5,52,15,5,5,52,14,5,5,53,14,5,5,54,14,5,5,
54,14,5,5,55,14,5,5,55,14,5,5,56,13,4,4,57,13,4,4,57,13,4,4,58,13,4,4,58,13,4,4,59,13,4,4,59,17,4,4,60,17,4,4,60,17,4,4,60,17,4,4,61,17,4,4,61,16,4,4,62,16,4,4,63,16,4,4,63,16,8,4,64,16,8,4,64,16,8,4,65,15,8,4,66,15,8,4,66,15,8,4,67,19,8,4,68,19,8,4,68,18,7,4,69,18,7,4,69,18,7,4,69,18,7,4,70,18,7,4,70,18,7,4,71,18,7,4,71,18,7,4,72,17,7,3,73,17,7,3,73,21,7,3,74,21,7,3,74,20,7,3,75,20,7,3,76,20,7,3,76,20,7,3,77,20,7,3,77,20,7,3,78,20,7,3,78,20,7,7,78,19,6,6,79,19,10,6,80,19,10,6,80,22,9,6,81,22,9,6,
81,22,9,6,82,22,9,6,83,22,9,6,83,21,9,6,84,21,9,6,84,21,9,6,85,21,9,6,86,21,9,6,86,23,9,6,87,23,9,6,87,23,9,6,87,23,9,6,88,23,9,6,88,23,9,6,89,23,8,6,90,23,8,6,90,22,8,6,91,22,8,6,91,25,8,6,92,25,8,5,93,25,8,5,93,24,8,5,94,24,8,5,94,24,11,5,95,24,11,5,96,24,11,5,96,26,11,5,97,26,11,5,97,26,11,5,97,26,10,5,98,26,10,5,98,26,10,5,99,25,10,5,100,25,10,5,100,25,10,5,101,25,10,5,101,25,10,5,102,27,10,5,103,27,10,5,103,27,10,5,104,27,10,5,104,27,12,5,105,26,12,5,106,26,12,5,106,29,12,5,106,29,12,5,106,29,
12,7,107,28,12,7,108,28,12,7,108,28,12,7,109,28,12,7,109,30,12,7,110,30,11,7,111,30,11,7,111,30,11,7,112,30,11,7,112,29,11,7,113,29,11,7,114,29,11,7,114,31,11,7,115,31,11,7,115,31,11,7,115,31,11,7,116,31,11,7,116,33,13,7,117,33,13,9,117,32,13,9,118,32,13,9,118,32,13,9,119,34,15,8,120,34,15,8,120,34,15,8,121,36,15,8,121,36,15,8,122,36,15,8,122,35,15,8,123,37,14,8,124,37,14,8,124,37,14,8,124,37,14,8,124,39,14,8,125,39,16,8,125,38,16,8,126,38,16,8,127,38,16,8,127,40,16,10,128,40,16,10,128,40,16,10,129,
42,18,10,129,41,18,10,130,41,18,10,130,43,18,10,131,43,18,10,131,42,17,10,132,42,17,12,132,42,17,12,133,44,17,12,133,44,17,12,133,46,17,11,134,46,17,11,134,45,19,11,135,45,19,11,135,47,19,11,136,47,19,11,136,47,19,11,137,47,19,11,137,48,20,11,138,48,20,11,138,50,20,13,139,50,20,13,139,49,20,13,140,49,22,13,140,51,22,13,141,51,22,13,141,50,22,13,142,52,22,13,142,52,21,12,143,53,21,12,143,53,21,12,143,53,21,12,143,53,21,14,144,53,23,14,144,55,23,14,145,55,23,14,145,56,23,14,146,56,23,14,146,57,24,14,
147,57,24,14,147,59,24,16,148,59,24,16,148,58,24,15,149,58,26,15,149,58,26,15,149,60,26,15,150,60,26,15,150,61,25,15,151,61,25,15,151,62,25,17,152,62,25,17,152,64,25,17,152,64,27,17,152,63,27,17,153,63,27,17,153,65,27,17,153,66,28,17,154,66,28,17,154,67,28,16,155,67,28,16,155,67,30,16,155,69,29,18,156,69,29,18,156,68,29,18,157,70,29,18,157,70,29,18,157,71,31,18,158,71,31,18,158,72,30,19,159,72,30,19,159,74,30,19,159,73,30,19,160,73,32,19,160,74,32,19,161,74,32,21,161,76,32,21,161,78,33,21,161,78,
33,21,161,79,35,20,162,78,34,20,163,79,34,22,164,81,36,22,164,82,36,22,165,81,35,22,166,82,37,21,167,84,37,21,167,85,36,21,168,86,38,23,169,88,38,23,169,88,38,23,170,88,39,23,170,89,39,24,171,91,40,24,171,92,40,24,172,93,40,24,173,94,41,25,173,95,41,25,174,96,42,25,175,98,42,25,175,99,43,26,176,99,43,26,177,101,45,26,177,102,44,26,178,103,46,27,179,104,46,27,179,105,46,27,179,106,45,28,180,108,47,28,180,108,46,28,181,109,48,28,182,111,48,29,182,111,49,29,183,114,49,29,184,114,50,30,184,114,50,30,
185,116,51,30,185,117,51,30,186,119,52,31,187,119,53,31,187,121,53,31,188,122,54,33,188,123,54,32,189,124,55,32,189,125,55,32,189,126,56,34,190,128,56,34,190,128,57,33,191,130,57,33,191,131,58,35,192,131,58,35,192,133,59,34,193,134,60,35,194,135,60,35,194,136,61,37,195,139,61,37,195,139,62,36,196,141,62,36,196,141,63,38,197,142,63,38,197,143,64,39,198,144,64,39,198,146,66,39,198,146,67,39,198,147,67,38,199,147,68,40,199,149,68,40,200,150,69,40,200,152,70,41,201,154,71,41,201,154,71,42,202,155,72,
42,202,156,73,41,203,157,73,43,203,158,74,42,204,160,75,44,204,161,76,44,204,162,77,44,205,164,77,45,205,165,78,45,206,166,79,45,206,168,80,46,207,169,81,46,207,170,83,47,207,171,83,47,207,172,83,47,207,174,85,48,208,175,85,48,208,177,85,48,209,178,87,49,209,180,87,49,210,181,87,49,210,182,89,50,210,182,89,50,211,185,91,50,211,186,91,51,212,186,93,51,212,189,94,52,212,190,95,51,213,192,96,51,213,193,96,53,213,194,97,52,214,195,98,54,214,197,98,55,215,198,100,55,215,199,101,55,215,200,102,55,216,202,
103,55,216,203,104,55,216,204,105,57,216,205,106,57,216,207,107,58,216,208,108,58,217,209,109,59,217,210,110,60,217,211,111,60,218,212,112,61,218,213,113,61,218,214,114,62,219,217,115,63,219,217,116,64,219,218,118,64,220,219,119,65,220,220,121,66,220,222,121,67,221,222,122,67,221,222,123,68,221,223,124,69,222,224,125,70,222,225,127,71,222,226,128,72,223,228,129,73,223,228,130,74,223,229,132,75,223,230,135,79,224,231,138,81,224,233,141,84,224,233,144,87,225,235,147,91,225,236,150,94,225,237,154,97,
225,238,158,102,225,239,161,107,225,239,165,110,225,240,168,114,226,241,172,118,226,241,176,122,226,241,181,126,226,242,183,130,227,243,186,135,227,243,190,139,227,244,194,143,227,244,197,147,228,244,200,150,228,245,204,154,228,245,207,157,228,245,210,161,229,246,212,164,229,246,215,167,229,246,217,169,229,246,220,172,230,247,221,174,230]);a.marsAtmosphereTextureSimple=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleHaze":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ./atmosphereUtils ../../../chunks/FogHaze.glsl ./FogTechnique ./SimpleHazeTechnique ./weather ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B){a.SimpleHaze=function(y){function w(F){var E=y.call(this,F)||this;E._passParameters=new v.FogHazePassParameters;E._vao=C.createQuadVAO(F.context.renderContext.rctx,z.Pos2Tex);var K=h.getReferenceEllipsoid(F.view.spatialReference);E._planetRadius=K.radius;E._atmosphereRadius=K.radius+l.atmosphereHeight;K=new q.FogHazeTechniqueConfiguration;K.haze=!0;E._hazeTechnique=F.context.techniqueRepository.acquire(k.SimpleHazeTechnique,K);return E}c._inheritsLoose(w,
y);var D=w.prototype;D.destroy=function(){this._hazeTechnique.release();this._vao.dispose()};D.render=function(F,E){if(0!==this.view.basemapTerrain.baseOpacity&&(this._update(F,E),!(0>=this._passParameters.hazeAmount))){var K=this._hazeTechnique;if(K.compiled){var J=F.offscreenRenderingHelper;J.renderDepthDetached(()=>{this._passParameters.depthTexture=J.depthTexture;const M=F.rctx.bindTechnique(K,this._passParameters,F.bindParameters);this._renderSimpleHaze(M,F)})}else this.context.requestRender()}};
D._renderSimpleHaze=function(F,E){E=E.rctx;E.bindVAO(this._vao);F.assertCompatibleVertexAttributeLocations(this._vao);E.drawArrays(B.PrimitiveType.TRIANGLE_STRIP,0,4)};D._update=function(F,E){var K=F.bindParameters.camera;e.normalize(x,K.eye);F=Math.max(0,e.dot(x,F.bindParameters.lighting.mainLight.direction));const J=A;e.scale(u,J,0);e.lerp(this._passParameters.hazeColor,u,J,F);K=e.length(K.eye);this._passParameters.atmosphereC=K*K-this._atmosphereRadius*this._atmosphereRadius;this._passParameters.hazeAmount=
(1-n.smoothstep(.7*p.weatherHeightLimit,1*p.weatherHeightLimit,Math.abs(K-this._planetRadius)))*E.amount;this._passParameters.fogStrength=E.strength};w.isSupported=function(F){return F.capabilities.depthTexture};c._createClass(w,[{key:"strength",get:function(){return this._passParameters.hazeStrength},set:function(F){this._passParameters.hazeStrength=F}}]);return w}(t);b.__decorate([r.property({constructOnly:!0})],a.SimpleHaze.prototype,"context",void 0);b.__decorate([r.property({constructOnly:!0})],
a.SimpleHaze.prototype,"view",void 0);a.SimpleHaze=b.__decorate([f.subclass("esri.views.3d.environment.SimpleHaze")],a.SimpleHaze);const A=g.fromValues(.24,.44,.8),x=g.create(),u=g.create();a.HazeParameters=function(){this.amount=this.strength=0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/SimpleHazeTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/FogHaze.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e){r=function(g){function h(){return g.apply(this,arguments)||this}b._inheritsLoose(h,g);var l=h.prototype;l.initializeProgram=function(v){return new d.Program(v.rctx,h.shader.get().build(this.configuration),m.Default3D)};l.initializePipeline=function(){return e.makePipelineState({blending:e.separateBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ZERO,f.BlendFactor.ONE_MINUS_SRC_COLOR,f.BlendFactor.ONE),colorWrite:e.defaultColorWriteParams})};return h}(r.ShaderTechnique);
r.shader=new n.ReloadableShaderModule(t.Haze,()=>new Promise((g,h)=>a(["./FogHaze.glsl"],g,h)));c.SimpleHazeTechnique=r;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/asyncUtils ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../core/support/WatchUpdatingTracking ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexArrayObject ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D){a.Stars=function(N){function P(G){G=N.call(this,G)||this;G._loadDataTask=null;G._numPoints=0;G._renderParameter=new C.StarPassParameters;G._updatingTracking=new z.WatchUpdatingTracking;return G}c._inheritsLoose(P,N);var I=P.prototype;I.initialize=function(){this._loadDataTask=this._createLoadDataTask()};I.destroy=function(){this._loadDataTask=f.abortMaybe(this._loadDataTask);this._updatingTracking.destroy();this._numPoints=0;this._technique=
f.releaseMaybe(this._technique);this._vao=f.disposeMaybe(this._vao)};I.render=function(G){const {rctx:H}=G;this._ensureResources(H);f.isNone(this._technique)||f.isNone(this._vao)||(this._technique.compiled?(G=H.bindTechnique(this._technique,this._renderParameter,G.bindParameters),H.bindVAO(this._vao),G.assertCompatibleVertexAttributeLocations(this._vao),H.drawArrays(D.PrimitiveType.POINTS,0,this._numPoints)):this.requestRender())};I._ensureResources=function(G){if(!f.isSome(this._technique)&&!f.isNone(M)){this._technique=
new C.StarsTechnique({rctx:G,viewingMode:this.view.state.viewingMode});this._numPoints=M.byteLength/9;var H=new Float32Array(M,0,2*this._numPoints),L=new Uint8Array(M,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(G,H,L,this._numPoints);this._updatingTracking.add(()=>"virtual"!==this.view.environment.lighting.type?this.view.environment.lighting.date:null,O=>this._update(O),g.initial)}};I._computeDayDuration=function(G){const H=new Date(G.getFullYear(),0,1,11,58,56),L=new Date(G.getFullYear()+
1,0,1,11,58,55);return(+G-+H)/(+L-+H)};I._update=function(G){if(G){var H=G.getHours()/12,L=G.getMinutes()/60*(2/24),O=G.getSeconds()/60*(2/1440);H=(H+L+O-.9972222)%2;G=2*this._computeDayDuration(G);L=k.copy(this._renderParameter.modelMatrix,K);k.rotateZ(L,L,-G*Math.PI);k.multiply(L,E,L);k.rotateZ(L,L,-H*Math.PI);this.requestRender()}};I._hexToRGB=function(G){return[parseInt(G.substring(0,2),16),parseInt(G.substring(2,4),16),parseInt(G.substring(4,6),16)]};I._unpackUint8Attributes=function(G){return 192<=
G?[2.9,G-192]:160<=G?[2.5,G-160]:128<=G?[2,G-128]:96<=G?[1.5,G-96]:64<=G?[1,G-64]:32<=G?[.7,G-32]:[.4,G]};I._createVertexArrayObject=function(G,H,L,O){const S=J.createBuffer(O),R=S.position,Q=S.color,V=S.size;for(let W=0;W<O;W++){var aa=H[2*W],X=H[2*W+1];R.set(W,0,-Math.cos(aa)*Math.sin(X));R.set(W,1,-Math.sin(aa)*Math.sin(X));R.set(W,2,-Math.cos(X));aa=this._unpackUint8Attributes(L[W]);X=this._hexToRGB(F[aa[1]]);Q.set(W,0,255*X[0]);Q.set(W,1,255*X[1]);Q.set(W,2,255*X[2]);Q.set(W,3,255);V.set(W,aa[0])}return new u.VertexArrayObject(G,
x.Default3D,{geometry:B.glLayout(J)},{geometry:w.BufferObject.createVertex(G,D.Usage.STATIC_DRAW,S.buffer)})};I._createLoadDataTask=function(){var G=this;if(f.isSome(M))return null;const H=r.createTask(function(){var L=c._asyncToGenerator(function*(O){({data:O}=yield t.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:O}));G._verifyStarData(O);M=O});return function(O){return L.apply(this,arguments)}}());H.promise.catch(L=>{e.isAbortError(L)||d.getLogger(this.declaredClass).error(L)}).then(()=>
{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return H};I._verifyStarData=function(G){if(!G)throw new m("stars:no-data-received","Failed to create stars because star catalogue is missing");G=G.byteLength/9;if(0!==G%1||5E4<G||5E3>G)throw new m("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};c._createClass(P,[{key:"updating",get:function(){return this._updatingTracking.updating||this.loading}},{key:"loading",get:function(){return f.isSome(this._loadDataTask)&&
!this._loadDataTask.finished}}]);return P}(n);b.__decorate([h.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);b.__decorate([h.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);b.__decorate([h.property({readOnly:!0})],a.Stars.prototype,"updating",null);b.__decorate([h.property()],a.Stars.prototype,"_loadDataTask",void 0);b.__decorate([h.property()],a.Stars.prototype,"_updatingTracking",void 0);a.Stars=b.__decorate([q.subclass("esri.views.3d.environment.Stars")],
a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),E=p.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),K=p.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,0,0,0,0,1),J=A.newLayout().vec3f(y.VertexAttribute.POSITION).vec4u8(y.VertexAttribute.COLOR).f32(y.VertexAttribute.SIZE);
let M=null;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){r=function(v){function q(){var k=v.apply(this,arguments)||this;k.modelMatrix=t.create();return k}b._inheritsLoose(q,v);return q}(r.NoParameters);d=function(v){function q(p){var z;return z=v.call(this,p,new f.ShaderTechniqueConfiguration,()=>z.destroy())||this}b._inheritsLoose(q,v);var k=q.prototype;k.initializeProgram=function(p){return new g.Program(p.rctx,q.shader.get().build(),e.Default3D)};k.initializePipeline=function(){return l.makePipelineState({blending:l.separateBlendingParams(h.BlendFactor.SRC_ALPHA,
h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:h.CompareFunction.LEQUAL},colorWrite:l.defaultColorWriteParams})};return q}(d.ShaderTechnique);d.shader=new m.ReloadableShaderModule(n.Stars,()=>new Promise((v,q)=>a(["./Stars.glsl"],v,q)));c.StarPassParameters=r;c.StarsTechnique=d;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Stars.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(){const l=new f.ShaderBuilder;l.attributes.add(e.VertexAttribute.POSITION,"vec3");l.attributes.add(e.VertexAttribute.COLOR,"vec4");l.attributes.add(e.VertexAttribute.SIZE,"float");l.varyings.add("vcolor","vec4");l.varyings.add("vsize","float");l.vertex.uniforms.add([new d.Matrix4PassUniform("transform",(v,q)=>{c.copy(h,q.camera.projectionMatrix);h[10]=2.4E-7-1;h[11]=-1;h[14]=(2.4E-7-2)*q.camera.near;c.multiply(h,h,q.camera.viewMatrix);return c.multiply(h,h,
v.modelMatrix)}),new n.Float4PassUniform("viewport",(v,q)=>q.camera.fullViewport),new r.FloatPassUniform("pixelRatio",(v,q)=>q.camera.pixelRatio)]);l.include(t.AlignPixel);l.vertex.code.add(m.glsl`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);l.fragment.code.add(m.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`);return l}const h=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.Stars=b;a.build=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.AlignPixel=function(b){const t=c.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,n=c.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;b.vertex.code.add(t);b.vertex.code.add(n);b.fragment.code.add(t);b.fragment.code.add(n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/environment/weatherUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/mat4f64 ../../../geometry/support/axisAngleDegrees ../../../geometry/support/Ellipsoid ./CloudsCompositionParameters ./CloudsData ./weather ../../support/RenderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(z,C,B,A){const x=z.fadeInOutHeight,u=x.stage===f.FadeHeightStages.FINISHED?B:z.startTimeHeightFade;0!==A?(A=(B-u)/(1*A),x.factor+=C?-A:A):x.factor=C?0:1;z.startTimeHeightFade=B;x.factor=c.clamp(x.factor,0,1);x.stage=f.FadeHeightStages.HEIGHT_FADE}const v=n.fromValues(0,0,1),q=m.create(),k=n.create(),p=n.create();a.updateWeatherFading=function(z,C,B,A,x){z.renderingStage===e.CloudsRenderingStages.FINISHED_RENDERING&&(z.renderingStage=e.CloudsRenderingStages.FADING_TEXTURE_CHANNELS);
const u=t.length(C.eye);0>z.fadeInOutHeight.factor&&(z.fadeInOutHeight.factor=u-d.earth.radius>g.weatherHeightLimit?1:0);z.isCameraPositionFinal=t.equals(z.cameraPositionLastFrame,C.eye);t.normalize(k,C.eye);t.scale(k,k,d.earth.radius);const y=z.parallax;0===y.anchorPointClouds[0]&&0===y.anchorPointClouds[1]&&0===y.anchorPointClouds[2]&&t.copy(y.anchorPointClouds,k);var w=t.length(t.subtract(p,y.anchorPointClouds,k));let D=!0;if(w>z.fadeIn.distanceThresholdFactor*y.cloudsHeight||z.fadeIn.stage!==
f.FadeInStages.FINISHED)B=z.parallax.anchorPointClouds,z.fadeIn.stage===f.FadeInStages.FINISHED&&(z.fadeIn.factor=0,t.copy(B,k),z.fadeIn.stage=f.FadeInStages.CHANGE_ANCHOR,z.crossFade.enabled=!1,z.fadeInOut.stage=f.FadeInOutStages.FINISHED),z.fadeIn.stage===f.FadeInStages.CHANGE_ANCHOR&&z.isCameraPositionFinal&&(e.ensureClouds(z.data)&&z.renderingStage!==e.CloudsRenderingStages.RENDERING||z.renderingStage===e.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)&&(t.copy(B,k),z.fadeIn.stage=f.FadeInStages.FADE_IN,
z.startTime=A,z.renderingStage===e.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(z.renderingStage=e.CloudsRenderingStages.SWITCH_CHANNELS)),1>z.fadeIn.factor&&z.fadeIn.stage===f.FadeInStages.FADE_IN?z.fadeIn.factor=x?c.clamp((A-z.startTime)/(1*x),0,1):1:1<=z.fadeIn.factor&&z.fadeIn.stage===f.FadeInStages.FADE_IN&&(z.fadeIn.stage=f.FadeInStages.FINISHED,z.fadeIn.factor=1);else if(w>z.fadeInOut.distanceThresholdFactor*y.cloudsHeight||z.fadeInOut.stage!==f.FadeInOutStages.FINISHED){{const {fadeInOut:F,
crossFade:E}=z;F.stage===f.FadeInOutStages.FINISHED&&(z.startTime=A,F.factor=1,F.stage=f.FadeInOutStages.FADE_OUT);0<F.factor&&F.stage===f.FadeInOutStages.FADE_OUT?F.factor=x?1-c.clamp((A-z.startTime)/(.5*x),0,1):0:(0>=F.factor&&F.stage===f.FadeInOutStages.FADE_OUT&&(F.factor=0,t.copy(z.parallax.anchorPointClouds,k)),0>=F.factor&&F.stage===f.FadeInOutStages.FADE_OUT&&z.isCameraPositionFinal&&(F.factor=0,F.stage=f.FadeInOutStages.SWITCH,z.crossFade.enabled=!1,E.factor=1),F.stage===f.FadeInOutStages.SWITCH&&
(e.ensureClouds(z.data)&&z.renderingStage!==e.CloudsRenderingStages.RENDERING||z.renderingStage===e.CloudsRenderingStages.FADING_TEXTURE_CHANNELS)&&(z.startTime=A,F.factor=0,F.stage=f.FadeInOutStages.FADE_IN,t.copy(z.parallax.anchorPointClouds,k),z.crossFade.enabled=!1,E.factor=1,z.renderingStage===e.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(z.renderingStage=e.CloudsRenderingStages.SWITCH_CHANNELS)),1>F.factor&&F.stage===f.FadeInOutStages.FADE_IN?F.factor=x?c.clamp((A-z.startTime)/(1*x),0,1):
1:1<=F.factor&&F.stage===f.FadeInOutStages.FADE_IN&&(F.stage=f.FadeInOutStages.FINISHED,F.factor=1))}}else if(w>z.crossFade.distanceThresholdFactor*y.cloudsHeight||z.crossFade.enabled||z.renderingStage===e.CloudsRenderingStages.FADING_TEXTURE_CHANNELS){B=(B!==h.RenderState.IDLE||!e.ensureClouds(z.data))&&z.renderingStage!==e.CloudsRenderingStages.FADING_TEXTURE_CHANNELS;{({crossFade:w}=z);const F=z.parallax.anchorPointClouds;if(!z.crossFade.enabled||B)t.copy(z.parallaxNew.anchorPointClouds,k),z.startTime=
A,w.factor=0,z.crossFade.enabled=!0;1>w.factor&&z.crossFade.enabled?w.factor=x?c.clamp((A-z.startTime)/(1.3*x),0,1):1:1<=w.factor&&z.crossFade.enabled&&(z.crossFade.enabled=!1,w.factor=1,t.copy(F,z.parallaxNew.anchorPointClouds),z.renderingStage===e.CloudsRenderingStages.FADING_TEXTURE_CHANNELS&&(z.renderingStage=e.CloudsRenderingStages.SWITCH_CHANNELS))}}else D=!1;B=u-d.earth.radius;(B>1.7*g.weatherHeightLimit||B<-g.weatherHeightLimit)&&1>z.fadeInOutHeight.factor?z.fadeInOutHeight.factor=1:(B>g.weatherHeightLimit||
B<-.35*g.weatherHeightLimit)&&1>z.fadeInOutHeight.factor?l(z,!1,A,x):B<g.weatherHeightLimit&&B>-.35*g.weatherHeightLimit&&0<z.fadeInOutHeight.factor?l(z,!0,A,x):z.fadeInOutHeight.stage=f.FadeHeightStages.FINISHED;z.renderingStage===e.CloudsRenderingStages.SWITCH_CHANNELS&&(z.readChannels=1-z.readChannels,z.renderingStage=e.CloudsRenderingStages.FINISHED);y.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(u*u-d.earth.radius*d.earth.radius,0))/u;m.fromPoints(v,y.anchorPointClouds,q);b.rotate(y.transform,
r.IDENTITY,q[3],m.axis(q));D&&({parallaxNew:A}=z,m.fromPoints(v,A.anchorPointClouds,q),b.rotate(A.transform,r.IDENTITY,q[3],m.axis(q)));t.copy(z.cameraPositionLastFrame,C.eye)};a.weatherFadingNeedsRender=function(z){return z.crossFade.enabled||z.fadeInOut.stage!==f.FadeInOutStages.FINISHED||z.fadeIn.stage!==f.FadeInStages.FINISHED||z.fadeInOutHeight.stage!==f.FadeHeightStages.FINISHED||z.renderingStage!==e.CloudsRenderingStages.FINISHED};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/geometry/support/axisAngleDegrees":function(){define(["exports","../../core/mathUtils","../../chunks/quat","../../chunks/quatf64","../../chunks/vec3"],function(a,c,b,t,n){function r(v=e){return[v[0],v[1],v[2],v[3]]}function m(v,q,k,p,z=r()){z[0]=v;z[1]=q;z[2]=k;z[3]=p;return z}function d(v){return c.deg2rad(v[3])}function f(v,q){v[3]=q;return v}const e=[0,0,1,0],g=t.create(),h=t.create(),l=r();a.UP=e;a.angle=function(v){return v[3]};a.angleRad=d;a.axis=function(v){return v};a.compose=function(v,
q,k=r()){b.setAxisAngle(g,v,d(v));b.setAxisAngle(h,q,d(q));b.multiply(g,h,g);return f(k,c.rad2deg(b.getAxisAngle(k,g)))};a.copy=function(v,q=r()){return m(v[0],v[1],v[2],v[3],q)};a.create=r;a.fromAxisAndAngle=function(v,q,k=r()){n.copy(k,v);k[3]=q;return k};a.fromPoints=function(v,q,k=r()){n.cross(k,v,q);n.normalize(k,k);k[3]=-n.angle(v,q);return k};a.fromValues=m;a.setAngle=f;a.wrap=function(v,q,k,p){return m(v,q,k,p,l)};a.wrapAxisAngle=function(v,q){return m(v[0],v[1],v[2],q,l)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),function(a,c,b,t,n,r,m){function d(V){V[0]=0;V[1]=0;V[2]=0;V[3]=1;return V}function f(V,aa,X){X*=.5;const W=Math.sin(X);V[0]=W*aa[0];V[1]=W*aa[1];V[2]=W*aa[2];V[3]=Math.cos(X);return V}function e(V,aa){const X=2*Math.acos(aa[3]),W=Math.sin(X/2);W>n.getEpsilon()?(V[0]=aa[0]/W,V[1]=aa[1]/W,V[2]=aa[2]/W):(V[0]=1,V[1]=0,V[2]=0);return X}function g(V,aa,
X){const W=aa[0],T=aa[1],U=aa[2];aa=aa[3];const Y=X[0],ba=X[1],da=X[2];X=X[3];V[0]=W*X+aa*Y+T*da-U*ba;V[1]=T*X+aa*ba+U*Y-W*da;V[2]=U*X+aa*da+W*ba-T*Y;V[3]=aa*X-W*Y-T*ba-U*da;return V}function h(V,aa,X){X*=.5;const W=aa[0],T=aa[1],U=aa[2];aa=aa[3];const Y=Math.sin(X);X=Math.cos(X);V[0]=W*X+aa*Y;V[1]=T*X+U*Y;V[2]=U*X-T*Y;V[3]=aa*X-W*Y;return V}function l(V,aa,X){X*=.5;const W=aa[0],T=aa[1],U=aa[2];aa=aa[3];const Y=Math.sin(X);X=Math.cos(X);V[0]=W*X-U*Y;V[1]=T*X+aa*Y;V[2]=U*X+W*Y;V[3]=aa*X-T*Y;return V}
function v(V,aa,X){X*=.5;const W=aa[0],T=aa[1],U=aa[2];aa=aa[3];const Y=Math.sin(X);X=Math.cos(X);V[0]=W*X+T*Y;V[1]=T*X-W*Y;V[2]=U*X+aa*Y;V[3]=aa*X-U*Y;return V}function q(V,aa){const X=aa[0],W=aa[1];aa=aa[2];V[0]=X;V[1]=W;V[2]=aa;V[3]=Math.sqrt(Math.abs(1-X*X-W*W-aa*aa));return V}function k(V,aa,X,W){const T=aa[0],U=aa[1],Y=aa[2];aa=aa[3];let ba=X[0],da=X[1],ea=X[2];X=X[3];let ca;let ja;var ia=T*ba+U*da+Y*ea+aa*X;0>ia&&(ia=-ia,ba=-ba,da=-da,ea=-ea,X=-X);1-ia>n.getEpsilon()?(ca=Math.acos(ia),ja=Math.sin(ca),
ia=Math.sin((1-W)*ca)/ja,W=Math.sin(W*ca)/ja):ia=1-W;V[0]=ia*T+W*ba;V[1]=ia*U+W*da;V[2]=ia*Y+W*ea;V[3]=ia*aa+W*X;return V}function p(V){var aa=n.RANDOM,X=aa();const W=aa();aa=aa();const T=Math.sqrt(1-X);X=Math.sqrt(X);V[0]=T*Math.sin(2*Math.PI*W);V[1]=T*Math.cos(2*Math.PI*W);V[2]=X*Math.sin(2*Math.PI*aa);V[3]=X*Math.cos(2*Math.PI*aa);return V}function z(V,aa){const X=aa[0],W=aa[1],T=aa[2];aa=aa[3];var U=X*X+W*W+T*T+aa*aa;U=U?1/U:0;V[0]=-X*U;V[1]=-W*U;V[2]=-T*U;V[3]=aa*U;return V}function C(V,aa){V[0]=
-aa[0];V[1]=-aa[1];V[2]=-aa[2];V[3]=aa[3];return V}function B(V,aa){var X=aa[0]+aa[4]+aa[8];if(0<X)X=Math.sqrt(X+1),V[3]=.5*X,X=.5/X,V[0]=(aa[5]-aa[7])*X,V[1]=(aa[6]-aa[2])*X,V[2]=(aa[1]-aa[3])*X;else{let W=0;aa[4]>aa[0]&&(W=1);aa[8]>aa[3*W+W]&&(W=2);const T=(W+1)%3,U=(W+2)%3;X=Math.sqrt(aa[3*W+W]-aa[3*T+T]-aa[3*U+U]+1);V[W]=.5*X;X=.5/X;V[3]=(aa[3*T+U]-aa[3*U+T])*X;V[T]=(aa[3*T+W]+aa[3*W+T])*X;V[U]=(aa[3*U+W]+aa[3*W+U])*X}return V}function A(V,aa,X,W){var T=.5*Math.PI/180;aa*=T;X*=T;W*=T;T=Math.sin(aa);
aa=Math.cos(aa);const U=Math.sin(X);X=Math.cos(X);const Y=Math.sin(W);W=Math.cos(W);V[0]=T*X*W-aa*U*Y;V[1]=aa*U*W+T*X*Y;V[2]=aa*X*Y-T*U*W;V[3]=aa*X*W+T*U*Y;return V}function x(V){return"quat("+V[0]+", "+V[1]+", "+V[2]+", "+V[3]+")"}function u(V,aa,X){const W=r.dot(aa,X);if(-.999999>W)return r.cross(H,L,aa),1E-6>r.len(H)&&r.cross(H,O,aa),r.normalize(H,H),f(V,H,Math.PI),V;if(.999999<W)return V[0]=0,V[1]=0,V[2]=0,V[3]=1,V;r.cross(H,aa,X);V[0]=H[0];V[1]=H[1];V[2]=H[2];V[3]=1+W;return I(V,V)}function y(V,
aa,X,W,T,U){k(S,aa,T,U);k(R,X,W,U);k(V,S,R,2*U*(1-U));return V}function w(V,aa,X,W){const T=Q;T[0]=X[0];T[3]=X[1];T[6]=X[2];T[1]=W[0];T[4]=W[1];T[7]=W[2];T[2]=-aa[0];T[5]=-aa[1];T[8]=-aa[2];return I(V,B(V,T))}const D=m.copy,F=m.set,E=m.add,K=m.scale,J=m.dot,M=m.lerp,N=m.length,P=m.squaredLength,I=m.normalize,G=m.exactEquals;m=m.equals;const H=t.create(),L=t.fromValues(1,0,0),O=t.fromValues(0,1,0),S=b.create(),R=b.create(),Q=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,add:E,calculateW:q,
conjugate:C,copy:D,dot:J,equals:m,exactEquals:G,fromEuler:A,fromMat3:B,getAxisAngle:e,identity:d,invert:z,len:N,length:N,lerp:M,mul:g,multiply:g,normalize:I,random:p,rotateX:h,rotateY:l,rotateZ:v,rotationTo:u,scale:K,set:F,setAxes:w,setAxisAngle:f,slerp:k,sqlerp:y,sqrLen:P,squaredLength:P,str:x},Symbol.toStringTag,{value:"Module"}));a.add=E;a.calculateW=q;a.conjugate=C;a.copy=D;a.dot=J;a.equals=m;a.exactEquals=G;a.fromEuler=A;a.fromMat3=B;a.getAxisAngle=e;a.identity=d;a.invert=z;a.len=N;a.length=
N;a.lerp=M;a.mul=g;a.multiply=g;a.normalize=I;a.quat=c;a.random=p;a.rotateX=h;a.rotateY=l;a.rotateZ=v;a.rotationTo=u;a.scale=K;a.set=F;a.setAxes=w;a.setAxisAngle=f;a.slerp=k;a.sqlerp=y;a.sqrLen=P;a.squaredLength=P;a.str=x})},"esri/views/3d/webgl-engine/lib/RenderFeature":function(){define(["exports","../../../../core/has","../../../../core/NestedMap","../../../support/RenderState"],function(a,c,b,t){a.RenderFeature=void 0;(function(n){n[n.Antialiasing=0]="Antialiasing";n[n.HighQualityTransparency=
1]="HighQualityTransparency";n[n.HighQualityVoxel=2]="HighQualityVoxel";n[n.RealisticAtmosphere=3]="RealisticAtmosphere";n[n.SSAO=4]="SSAO";n[n.WaterReflection=5]="WaterReflection";n[n.ShadowMapUpdate=6]="ShadowMapUpdate";n[n.PhysicalPixelRendering=7]="PhysicalPixelRendering"})(a.RenderFeature||(a.RenderFeature={}));a.setupFeatureDefaults=function(n=c("enable-feature:high-quality-idle")){const r=new b.NestedMap;n&&(r.set(t.RenderState.INTERACTING,a.RenderFeature.Antialiasing,!0),r.set(t.RenderState.IDLE,
a.RenderFeature.Antialiasing,!0),r.set(t.RenderState.INTERACTING,a.RenderFeature.HighQualityTransparency,!0),r.set(t.RenderState.IDLE,a.RenderFeature.HighQualityTransparency,!0),r.set(t.RenderState.INTERACTING,a.RenderFeature.RealisticAtmosphere,!0),r.set(t.RenderState.IDLE,a.RenderFeature.RealisticAtmosphere,!0),r.set(t.RenderState.IDLE,a.RenderFeature.SSAO,!0),r.set(t.RenderState.IDLE,a.RenderFeature.WaterReflection,!0),r.set(t.RenderState.IDLE,a.RenderFeature.PhysicalPixelRendering,!0));r.set(t.RenderState.ANIMATING,
a.RenderFeature.ShadowMapUpdate,!0);r.set(t.RenderState.INTERACTING,a.RenderFeature.ShadowMapUpdate,!0);r.set(t.RenderState.IDLE,a.RenderFeature.ShadowMapUpdate,!0);r.set(t.RenderState.IDLE,a.RenderFeature.HighQualityVoxel,!0);return r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/NestedMap":function(){define(["exports","../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(){this._outer=new Map}var n=t.prototype;n.clear=function(){this._outer.clear()};
n.get=function(r,m){return this._outer.get(r)?.get(m)};n.set=function(r,m,d){const f=this._outer.get(r);f?f.set(m,d):this._outer.set(r,new Map([[m,d]]))};n.delete=function(r,m){const d=this._outer.get(r);d&&(d.delete(m),0===d.size&&this._outer.delete(r))};n.forEach=function(r){this._outer.forEach((m,d)=>r(m,d))};c._createClass(t,[{key:"empty",get:function(){return 0===this._outer.size}}]);return t}();a.NestedMap=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Update":function(){define(["exports"],
function(a){a.Update=void 0;var c=a.Update||(a.Update={});c[c.Immediate=0]="Immediate";c[c.Faded=1]="Faded";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../core/maybe","../../../geometry/ellipsoidUtils","../../../geometry/Point"],function(a,c,b,t,n){function r(f,e,g){if(b.isNone(e.longitude)||b.isNone(e.latitude)||b.isNone(g.longitude)||b.isNone(g.latitude))throw Error("Invalid points: no lon/lat");
return m(f,e.longitude,e.latitude,g.longitude,g.latitude)}function m(f,e,g,h,l){g=c.deg2rad(g);l=c.deg2rad(l);e=c.deg2rad(e);const v=c.deg2rad(h);h=Math.sin((g-l)/2);e=Math.sin((e-v)/2);g=2*c.asinClamped(Math.sqrt(h*h+Math.cos(g)*Math.cos(l)*e*e));return Math.round(g*f*1E4)/1E4}function d(f,e){f/=15;e||(f=Math.round(f));return f}a.getGreatCircleDistance=m;a.getGreatCircleDistanceFromPoints=r;a.getGreatCircleSpanAt=function(f,e,g){const h=e.spatialReference,l=t.getReferenceEllipsoid(h),v=new n(e.x,
f.y,h),q=new n(g.x,f.y,h);e=new n(f.x,e.y,h);f=new n(f.x,g.y,h);return{lon:r(l.radius,v,q),lat:r(l.radius,e,f)}};a.getLonDeltaForDistance=function(f,e,g){e/=g;f=c.deg2rad(f);e=Math.sin(e/2);f=Math.cos(f);f=2*c.asinClamped(Math.sqrt(e*e/(f*f)));return c.rad2deg(f)};a.longitudeToTimezone=d;a.positionToTimezoneInfo=function(f,e){f=f?.[0];if(null==f)return null;e||(e={hours:0,minutes:0,seconds:0});e.hours=d(f,!0);f=e.hours%1;e.hours-=f;e.minutes=60*f;f=e.minutes%1;e.minutes-=f;e.seconds=Math.round(60*
f);return e};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),function(a,c,b,t,n,r,m,d,f,e){function g(w,D,F){D===d.ViewingMode.Global?r.normalize(x,w.eye):r.set(x,0,0,1);r.scale(u,w.viewForward,-1);D=e.angle(u,x);const E=Math.max(D-
.5,0);t.fromRotation(A,-Math.max(.25,D-.25-.85*E/(E+1)),w.viewRight);r.transformMat4(F,u,A);r.add(F,F,r.scale(y,w.viewRight,.2));r.normalize(F,F)}function h(w,D,F,E){const K=C,J=t.identity(z);if(F===d.ViewingMode.Global)f.SunCalc.getPosition(w,0,0,K),r.set(E,0,0,-1),t.rotateX(J,J,-K.azimuth),t.rotateY(J,J,-K.altitude);else{var M=k.planarDirection;F=M.globalAngles;M=(Math.abs(D[2])-M.localAltitude)/(M.globalAltitude-M.localAltitude);M=c.clamp(M,0,1);1>M?(f.SunCalc.getPosition(w,D[1],D[0],K),K.azimuth=
(1-M)*K.azimuth+M*F.azimuth,K.altitude=(1-M)*K.altitude+M*F.altitude):(K.azimuth=F.azimuth,K.altitude=F.altitude);r.set(E,0,-1,0);t.rotateZ(J,J,-K.azimuth);t.rotateX(J,J,-K.altitude)}r.transformMat4(E,E,J)}function l(w){switch(w){case "disabled":case "sunny":return{direct:1,ambient:1};case "cloudy":return{direct:1,ambient:1};case "rainy":return{direct:.4,ambient:1.2};case "snowy":return{direct:.5,ambient:1.3};case "foggy":return{direct:.2,ambient:1.6}}}function v(w,D){const F=(w[0]+w[1]+w[2])/3;for(let E=
0;3>E;E++)w[E]+=(F-w[E])*D;return w}function q(w,D,F,E){const K=[];for(let J=0;J<F.length;J++)K[J]=(E[J]-F[J])*w/D+F[J];return K}const k={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},p=m.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258),z=n.create(),C={azimuth:0,
altitude:0},B=new Date(0),A=n.create(),x=m.create(),u=m.create(),y=m.create();a.ColorAndIntensity=function(){this.ambient={color:m.fromValues(1,1,1),intensity:.55};this.direct={color:m.fromValues(1,1,1),intensity:.55,directionToLightSource:m.clone(p)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1};a.computeColorAndIntensity=function(w,D,F,E,K,J){r.set(J.ambient.color,1,1,1);J.ambient.intensity=k.global.ambient;r.set(J.direct.color,1,1,1);J.direct.intensity=
k.global.direct;var M=c.clamp((Math.abs(D[2])-k.local.altitude)/(k.global.altitude-k.local.altitude),0,1);J.globalFactor=M;var N;b.isSome(w)&&(N=f.SunCalc.getTimes(w,D[1],D[0]));if(1>M){if(b.isSome(w)){var P=N;var I=w.valueOf();if(P.polarException===f.SunCalc.PolarException.MIDNIGHT_SUN){var G=I-36E5*(w.getHours()+48)-6E4*w.getMinutes();var H=G+432E6}else P.polarException===f.SunCalc.PolarException.POLAR_NIGHT?(G=I-2,H=I-1):(G=P.sunrise.valueOf(),H=P.sunset.valueOf());var L=H-G;P=G+L/2;var O=L/4;
var S=P-O;O=P+O;var R=.06*L;L=G-R/2;G+=R/2;const V=H-R/2,aa=H+R/2;H=k.local;R=[.01,H.ambientAtNight];const X=[.8,.8,1],W=[.01,.01,.01],T=[H.directAtTwilight,H.ambientAtTwilight],U=[1,.6,.5],Y=[.8,.8,1],ba=[.9*H.directAtNoon,H.ambientAtNoon],da=[1,.98,.98],ea=[.98,.98,1],ca=[H.directAtNoon,H.ambientAtNoon],ja=[1,1,1],ia=[1,1,1];H=[0,0];let Z=[0,0,0];var Q=[0,0,0];I<L||I>aa?(H=R,Z=W,Q=X):I<G?(Q=G-L,H=q(I-L,Q,R,T),Z=q(I-L,Q,W,U),Q=q(I-L,Q,X,Y)):I<S?(Q=S-G,H=q(I-G,Q,T,ba),Z=q(I-G,Q,U,da),Q=q(I-G,Q,Y,
ea)):I<P?(Q=P-S,H=q(I-S,Q,ba,ca),Z=q(I-S,Q,da,ja),Q=q(I-S,Q,ea,ia)):I<O?(Q=O-P,H=q(I-P,Q,ca,ba),Z=q(I-P,Q,ja,da),Q=q(I-P,Q,ia,ea)):I<V?(Q=V-O,H=q(I-O,Q,ba,T),Z=q(I-O,Q,da,U),Q=q(I-O,Q,ea,Y)):I<aa&&(Q=aa-V,H=q(I-V,Q,T,R),Z=q(I-V,Q,U,W),Q=q(I-V,Q,Y,X));I=0;switch(E){case "rainy":case "foggy":I=.5;break;case "snowy":I=.5}0<I&&(Z=v(Z,I),Q=v(Q,I));P=m.fromValues(Z[0],Z[1],Z[2]);S=m.fromValues(Q[0],Q[1],Q[2]);O=l(E);I=H[0]*O.direct;H=H[1]*O.ambient}else S=l(E),I=k.local.directAtNoon*S.direct,P=m.fromValues(1,
1,1),H=k.local.ambientAtNoon*S.ambient,S=m.fromValues(1,1,1);r.lerp(J.ambient.color,S,J.ambient.color,M);J.ambient.intensity=c.lerp(H,J.ambient.intensity,M);r.lerp(J.direct.color,P,J.direct.color,M);J.direct.intensity=c.lerp(I,J.direct.intensity,M);J.specularStrength="rainy"===E||"snowy"===E||"foggy"===E?0:1;J.environmentStrength="rainy"===E?.7:"snowy"===E||"foggy"===E?.75:1}b.isSome(w)?(E=w.valueOf(),N.polarException===f.SunCalc.PolarException.MIDNIGHT_SUN?(M=E-36E5*(w.getHours()+48)-6E4*w.getMinutes(),
N=M+432E6):N.polarException===f.SunCalc.PolarException.POLAR_NIGHT?(M=E-2,N=E-1):(M=N.sunrise.valueOf(),N=N.sunset.valueOf()),E=1-c.clamp(Math.abs(E-(M+(N-M)/2))/432E5,0,1)):E=1;J.noonFactor=E;b.isSome(w)?h(w,D,F,J.direct.directionToLightSource):g(K,F,J.direct.directionToLightSource)};a.computeDirectionsOverTime=function(w,D,F,E,K){w=w.getTime();D=D.getTime()-w;D=Math.floor(D/F)+1;const J=Array(D);for(let M=0;M<D;++M)B.setTime(w+F*M),J[M]=m.create(),h(B,E,K,J[M]);return J};a.computeShadowsEnabled=
function(w,D){return D===d.ViewingMode.Global?!0:Math.abs(w)<k.planarDirection.localAltitude};a.computeVirtualLightDirection=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SunCalc":function(){define(["exports"],function(a){var c={};(function(b){(function(t){t=t();void 0!==t&&(b.exports=t)})(function(){function t(w){return new Date(864E5*(w+.5-2440588))}function n(w,D){return z(v(w)*q(x)-k(D)*v(x),q(w))}function r(w,D){return p(v(D)*q(x)+q(D)*v(x)*v(w))}function m(w,
D,F){return z(v(w),q(w)*v(D)-k(F)*q(D))}function d(w,D,F){return p(v(D)*v(F)+q(D)*q(F)*q(w))}function f(w){return B*(1.9148*v(w)+.02*v(2*w)+3E-4*v(3*w))}function e(w,D){w=B*(357.5291+.98560028*w);var F=f(w);w=w+F+102.9372*B+l;D||(D={dec:0,ra:0});D.dec=r(w,0);D.ra=n(w,0);return D}function g(w,D,F){return 2451545+w+.0053*v(D)-.0069*v(2*F)}function h(w){var D=B*(134.963+13.064993*w),F=B*(93.272+13.22935*w);w=B*(218.316+13.176396*w)+6.289*B*v(D);F=5.128*B*v(F);D=385001-20905*q(D);return{ra:n(w,F),dec:r(w,
F),dist:D}}var l=Math.PI,v=Math.sin,q=Math.cos,k=Math.tan,p=Math.asin,z=Math.atan2,C=Math.acos,B=l/180,A={dec:0,ra:0},x=23.4397*B,u={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(w,D,F,E){F=B*-F;D*=B;var K=w.valueOf()/864E5-.5+2440588-2451545;w=e(K,A);F=B*(280.16+360.9856235*K)-F-w.ra;E||(E={azimuth:0,altitude:0});E.azimuth=m(F,D,w.dec);E.altitude=d(F,D,w.dec);return E}},y=[[-.83,"sunrise","sunset"]];u.addTime=function(w,D,F){y.push([w,D,F])};u.getTimes=function(w,D,
F){function E(S){var R=J,Q=I;S=C((v(S)-v(R)*v(Q))/(q(R)*q(Q)));return g(9E-4+(S+K)/(2*l)+M,N,P)}var K=B*-F,J=B*D,M=Math.round(w.valueOf()/864E5-.5+2440588-2451545-9E-4-K/(2*l));w=9E-4+(0+K)/(2*l)+M;var N=B*(357.5291+.98560028*w);D=f(N);var P=N+D+102.9372*B+l,I=r(P,0);w=g(w,N,P);D={solarNoon:t(w),nadir:t(w-.5),polarException:u.PolarException.NORMAL};var G;F=0;for(G=y.length;F<G;F+=1){var H=y[F];var L=E(H[0]*B);var O=w-(L-w);D[H[1]]=t(O);D[H[2]]=t(L)}D.polarException=function(S){S=(v(S)-v(J)*v(I))/
(q(J)*q(I));return-1>S?u.PolarException.MIDNIGHT_SUN:1<S?u.PolarException.POLAR_NIGHT:u.PolarException.NORMAL}(y[0][0]*B);return D};u.getMoonPosition=function(w,D,F){F=B*-F;D*=B;var E=w.valueOf()/864E5-.5+2440588-2451545;w=h(E);F=B*(280.16+360.9856235*E)-F-w.ra;E=d(F,D,w.dec);E+=.017*B/k(E+10.26*B/(E+5.1*B));return{azimuth:m(F,D,w.dec),altitude:E,distance:w.dist}};u.getMoonFraction=function(w){var D=w.valueOf()/864E5-.5+2440588-2451545;w=e(D);D=h(D);w=C(v(w.dec)*v(D.dec)+q(w.dec)*q(D.dec)*q(w.ra-
D.ra));w=z(149598E3*v(w),D.dist-149598E3*q(w));return(1+q(w))/2};return u})})({get exports(){return c},set exports(b){c=b}});a.SunCalc=c})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J){b=function(N){function P(){var G=N.apply(this,arguments)||this;G._handles=new t;return G}a._inheritsLoose(P,N);var I=P.prototype;I.destroy=function(){this._handles=n.destroyMaybe(this._handles);this.disconnect()};I.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager=n.destroyMaybe(this._inputManager)};I.connect=function(){const G=this.view;this._source=new x.BrowserEventSource(this.view.surface,G.input);var H=
[new D.ImmediateDoubleClick,new F.PointerClickHoldAndDrag,new E.SingleAndDoubleClick,new w.Drag(this.view.navigation),new K.VerticalTwoFingerDrag];this._inputManager=H=new u.InputManager({eventSource:this._source,recognizers:H});H.installHandlers("prevent-context-menu",[new y.PreventContextMenu],u.ViewEventPriorities.INTERNAL);this._modeDragPan=new p.PinchAndPanNavigation(G,"primary");this._modeDragRotate=new h.DragRotate(G,"secondary",J.PivotPoint.CENTER);this._modeDragZoom=new l.DragZoom(G,"tertiary");
H.installHandlers("navigation",[new z.PointerDownCancelAnimation(G),new g.DoubleClickZoom(G),new v.GamepadNavigation(G),new q.KeyboardNavigation(G,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new k.MouseWheelZoom(G),new B.SingleKeyResetTilt(G,"p"),new C.SingleKeyResetHeading(G,"n"),new h.DragRotate(G,"primary",J.PivotPoint.EYE,["b"]),new h.DragRotate(G,"secondary",J.PivotPoint.CENTER,
["b"]),new p.PinchAndPanNavigation(G,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new A.TwoFingerTilt(G)],u.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(H);this._updateMode();this._handles.add(r.watch(()=>this.view.navigation?.browserTouchPanEnabled,L=>{this._source.browserTouchPanningEnabled=!L},r.initial))};I._updateMode=function(){var G=this.primaryDragAction;if(G=M.get(this.mode)?.get(G))this._modeDragPan&&(this._modeDragPan.pointerAction=G.pan),this._modeDragRotate&&
(this._modeDragRotate.pointerAction=G.rotate),this._modeDragZoom&&(this._modeDragZoom.pointerAction=G.zoom)};a._createClass(P,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(G){"pan"!==G&&"rotate"!==G||G===this._get("primaryDragAction")||(this._set("primaryDragAction",G),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},set:function(G){"default"!==G&&"pro"!==G||G===this._get("mode")||(this._set("mode",G),this._updateMode())}},{key:"hasPendingInputs",
get:function(){return!!this._inputManager?.hasPendingInputs}},{key:"latestPointerType",get:function(){return this._inputManager?.latestPointerType}},{key:"latestPointerLocation",get:function(){return this._inputManager?.latestPointerLocation}},{key:"multiTouchActive",get:function(){return this._inputManager?.multiTouchActive??!1}},{key:"test",get:function(){return{inputManager:this._inputManager,modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}}]);
return P}(b);c.__decorate([m.property()],b.prototype,"view",void 0);c.__decorate([m.property({value:"pan"})],b.prototype,"primaryDragAction",null);c.__decorate([m.property({value:"default"})],b.prototype,"mode",null);c.__decorate([m.property({readOnly:!0})],b.prototype,"hasPendingInputs",null);c.__decorate([m.property()],b.prototype,"latestPointerType",null);c.__decorate([m.property()],b.prototype,"latestPointerLocation",null);c.__decorate([m.property()],b.prototype,"multiTouchActive",null);c.__decorate([m.property()],
b.prototype,"_inputManager",void 0);b=c.__decorate([e.subclass("esri.views.3d.input.SceneInputManager")],b);const M=new Map;c=new Map;m=new Map;c.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});c.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});m.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});m.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});M.set("default",c);M.set("pro",m);return b})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,c,b,t,n,r,m){r=function(d){function f(e,g){var h=d.call(this,!0)||this;h._view=e;h.registerIncoming("double-click",g,l=>h._handleDoubleClick(l));return h}c._inheritsLoose(f,d);f.prototype._handleDoubleClick=function(e){const g=e.data;if(m.eventMatchesPointerAction(g,"primary")){const h=this._view.state.isGlobal?new t.ZoomStepController({view:this._view,mode:"animation"}):new n.ZoomStepController({view:this._view,mode:"animation"});this._view.state.switchCameraController(h);h.zoomStep(Math.log(.5)/
Math.log(.6),b.createScreenPointArray(g.x,g.y));e.stopPropagation()}};return f}(r.InputHandler);a.DoubleClickZoom=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E){a.ZoomStepController=function(M){function N(){var I=M.apply(this,arguments)||this;I._zoomLocation=v.create();I._tmpCamera=new D.Camera;I._tmpViewDir=v.create();I._tmpRayDir={origin:v.create(),direction:v.create()};I._targetOnSphere=v.create();I._tmpCenter=v.create();I._constraintOptions={selection:z.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:C.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new D.Camera,
interactionDirection:null,tiltMode:A.TiltMode.TUMBLE};I._sphere=k.create();return I}c._inheritsLoose(N,M);var P=N.prototype;P.initialize=function(){this._intersector=F.newIntersector(this.view.state.viewingMode)};P.zoomStep=function(I,G){if(this.active){var H=this.view.state,{interactionStartCamera:L}=this._constraintOptions;L&&(this.animation.finished?L.copyFrom(H.camera):this.animation.cameraAt(1,L));var O=L=!1;this.intersectionHelper.intersectScreen(G,this._zoomLocation,0===this.view.map.ground.opacity?
u.contentIntersectorOptions:{})&&(L=0<I?!0:!1,O=!0);this._tmpCamera.copyFrom(H.camera);L?this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._tmpCenter)&&(this._tmpCamera.center=this._tmpCenter):this.intersectionHelper.intersectRay(this._tmpCamera.ray,this._intersector,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:l.copy(this._zoomLocation,this._tmpCamera.center);this._updateCamera(this._tmpCamera,I,this._zoomLocation,G,O);this.begin(this._tmpCamera)}};
P.animationSettings=function(){return{duration:r.Milliseconds(600),easing:E.outExpo}};P._updateCamera=function(I,G,H,L,O){var S=q.getReferenceEllipsoid(this.view.spatialReference);S=u.decideNavigationMode(I,L,S);var R=Math.abs(this.view.camera.position.z);l.normalize(J,I.eye);l.scale(J,J,-1);y.fromScreenAtEye(I,L,this._tmpRayDir);l.normalize(this._tmpRayDir.direction,this._tmpRayDir.direction);const Q=t.clamp(Math.min(u.ZOOM_DISTANCE_MODIFIER,1/Math.abs(l.dot(J,this._tmpRayDir.direction)))*R,u.ZOOM_MIN_DISTANCE_MODIFIER,
u.ZOOM_MAX_DISTANCE_MODIFIER);if(S===u.NavigationMode.Horizontal){G=.6**G;this._sphere[3]=l.length(H);l.subtract(this._tmpViewDir,I.center,I.eye);O=Math.min(l.length(this._tmpViewDir),Q);S=O*G;1>=G&&4>S&&(S=4,G=S/O);if(1E-6>Math.abs(O-S))return;O=l.length(I.center);this._sphere[3]!==O&&(I.center=l.scale(K,I.center,(this._sphere[3]+G*(O-this._sphere[3]))/O));l.scale(this._tmpViewDir,this._tmpViewDir,-G);I.eye=l.add(K,I.center,this._tmpViewDir);p.applyAll(this.view,I,this._constraintOptions);1E-12<
l.squaredDistance(H,I.center)&&w.intersectScreen(this._sphere,I,L,this._targetOnSphere)&&u.panToPosition(this._sphere,I,H,this._targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{S=.6**Math.abs(G);R=0<G?1:-1;l.subtract(this._tmpViewDir,H,I.eye);const V=l.length(this._tmpViewDir);L=this.view._stage.renderView.getMinimalDepthForArea(null,L[0],L[1],this.view.state.camera,60);L=n.isSome(L)?L:Q;L=O&&0<G?Math.min(L,V):L;l.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,L);
l.add(H,this._tmpRayDir.origin,this._tmpRayDir.direction);H=L*S;O=Math.max(4,1.01*I.nearFar[0]);0<G&&H<O&&(H=O,S=H/L);if(1E-6>Math.abs(L-H))return;l.scale(this._tmpRayDir.direction,this._tmpRayDir.direction,R*(1-S));I.eye=l.add(K,I.eye,this._tmpRayDir.direction);I.center=l.add(K,I.center,this._tmpRayDir.direction)}B.applySurfaceCollisionConstraint(this.view,I)};return N}(x.PointToPointAnimationController);a.ZoomStepController=b.__decorate([h.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],
a.ZoomStepController);const K=v.create(),J=v.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/ConstraintTypes ./constraintUtils/distance ./constraintUtils/InteractionType ./constraintUtils/surfaceCollision ./constraintUtils/tilt ./constraintUtils/TiltMode ../../animation/easing".split(" "),function(a,c,b,t,n,r,m,d,f,e){const g=[{type:t.ConstraintTypes.TILT,
error:function(l,v,q){return d.getTiltConstraintError(l,v,q)*v.distance},apply:d.applyTiltConstraint},{type:t.ConstraintTypes.ALTITUDE,error:c.getAltitudeConstraintError,apply:c.applyAltitudeConstraint},{type:t.ConstraintTypes.DISTANCE,error:n.getDistanceConstraintError,apply:n.applyDistanceConstraint}],h={selection:t.ConstraintTypes.ALL,interactionType:r.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:f.TiltMode.TUMBLE};a.applyAll=function(l,
v,q=h,k=v){k!==v&&k.copyFrom(v);k.computeUp(l.state.viewingMode);v=!1;for(let z=0;5>z;z++){let C=0;for(var p of g)if(b.hasConstraintType(q.selection,p.type)){const B=Math.abs(p.error(l,k,q));p.apply(l,k,q)&&(v=!0,C+=B)}if(0===C)break}p=b.hasConstraintType(q.selection,t.ConstraintTypes.COLLISION);a:switch(q.interactionType){case r.InteractionType.PAN:q=m.Mode.EYE_AND_CENTER;break a;case r.InteractionType.ASCEND:q=l.state.isGlobal?m.Mode.EYE_AND_CENTER_SCALE:m.Mode.EYE_AND_CENTER;break a;default:q=
m.Mode.EYE}p&&m.applySurfaceCollisionConstraint(l,k,q)&&(v=!0);v&&k.computeUp(l.state.viewingMode);return v};a.pixelDistanceToInteractionFactor=function(l){return e.inOutCubic(Math.min(1,l/150))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ./ConstraintTypes ./InteractionType ../../support/intersectionUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(p,z,C=m.defaultConstraintOptions){var B=p.state.constraints.altitude;B=p.state.isGlobal&&B?C.interactionType===f.InteractionType.TUMBLE&&m.hasConstraintType(C.selection,d.ConstraintTypes.TILT)?!1:!0:!1;if(!B||!p.state.constraints.altitude)return 0;var A=p.state.constraints.altitude;B=h;B.min=A.min;B.max=A.max;A=C.interactionType;if(A!==f.InteractionType.NONE){var {min:x,max:u}=B,{interactionStartCamera:y,interactionFactor:w}=C;if(y){C=A===f.InteractionType.TUMBLE||
A===f.InteractionType.ZOOM;A=g(p,y);var D=0===A?0:p.renderCoordsHelper.getAltitude(y.eye);B.min=x;B.max=u;m.adjustRangeForInteraction(A,D,C,w,.05*D,B)}}p=p.renderCoordsHelper.getAltitude(z.eye);p=c.clamp(p,B.min,B.max)-p;return 1E-6>=Math.abs(p)?0:p}const h={min:0,max:0},l=n.create(),v=n.create(),q=n.create(),k=n.create();a.applyAltitudeConstraint=function(p,z,C=m.defaultConstraintOptions){var B=g(p,z,C);if(0===B)return!1;const A=p.renderCoordsHelper,x=A.getAltitude(z.eye)+B;var u=m.interactionDirectionTowardsConstraintMinimization;
C=C.interactionDirection;B=Math.sign(B);p.renderCoordsHelper.worldUpAtPosition(z.eye,v);t.scale(v,v,B);u=u.call(m,z,C,v,l);p=t.copy(q,z.viewForward);u=A.intersectInfiniteManifold(r.wrap(z.eye,u),x,k);z.eye=b.isSome(u)?u:A.setAltitude(k,x,z.eye);z.center=e.closestPointOnRay(k,z.eye,p,z.center);return!0};a.getAltitudeConstraintError=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports","../../../../chunks/vec3","./ConstraintTypes",
"./InteractionType","./TiltMode"],function(a,c,b,t,n){b={selection:b.ConstraintTypes.NONE,interactionType:t.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:n.TiltMode.TUMBLE};a.adjustRangeForInteraction=function(r,m,d,f,e,g){0!==r&&(d?(g.min=Math.min(g.min,m),g.max=Math.max(g.max,m)):null!=f?(g.min-=Math.max(0,(m-g.min)*(1-f)),g.max+=Math.max(0,(m-g.max)*(1-f))):e&&(g.min-=Math.max(0,m-g.min-e),g.max+=Math.max(0,m-g.max-e)))};a.defaultConstraintOptions=
b;a.hasConstraintType=function(r,m){return 0!==(r&m)};a.interactionDirectionTowardsConstraintMinimization=function(r,m,d,f){m=m||r.viewForward;c.copy(f,m);c.scale(f,f,Math.sign(c.dot(m,d)));return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/ConstraintTypes":function(){define(["exports"],function(a){a.ConstraintTypes=void 0;var c=a.ConstraintTypes||(a.ConstraintTypes={});c[c.NONE=0]="NONE";c[c.TILT=1]="TILT";c[c.ALTITUDE=2]="ALTITUDE";c[c.DISTANCE=
4]="DISTANCE";c[c.COLLISION=8]="COLLISION";c[c.ALL=15]="ALL";c[c.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/InteractionType":function(){define(["exports"],function(a){a.InteractionType=void 0;var c=a.InteractionType||(a.InteractionType={});c[c.NONE=0]="NONE";c[c.ZOOM=1]="ZOOM";c[c.TUMBLE=2]="TUMBLE";c[c.LOOK_AROUND=3]="LOOK_AROUND";c[c.PAN=4]="PAN";c[c.ASCEND=5]="ASCEND";Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/TiltMode":function(){define(["exports"],function(a){a.TiltMode=void 0;var c=a.TiltMode||(a.TiltMode={});c[c.TUMBLE=0]="TUMBLE";c[c.LOOK_AROUND=1]="LOOK_AROUND";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec2f64","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/plane"],function(a,c,b,t,n){function r(f,
e,g,h){const l=d;f?(g&&h&&(l.len=b.distance(e,g)),b.copy(l.dir,f)):h?(l.len=b.distance(e,g),b.subtract(l.dir,g,e),b.scale(l.dir,l.dir,1/l.len)):(b.subtract(l.dir,g,e),b.normalize(l.dir,l.dir));return l}function m(f,e,g,h){h.clip[0]=0;h.clip[1]=g?h.len:Number.MAX_VALUE;for(g=0;g<f.length;g++){{var l=f[g],v=e;var q=h;const k=b.dot(n.normal(l),q.dir);l=-n.signedDistance(l,v);0>l&&0<=k?q=!1:-1E-6<k&&1E-6>k?q=0<l:!(0>l||0>k)||0>l&&0>k?(l/=k,0<k?l<q.clip[1]&&(q.clip[1]=l):l>q.clip[0]&&(q.clip[0]=l),q=q.clip[0]<=
q.clip[1]):q=!0}if(!q)return!1}return!0}const d={dir:t.create(),len:0,clip:c.create()};a.closestPointOnRay=function(f,e,g,h){h=b.dot(g,b.subtract(f,h,e));return b.add(f,e,b.scale(f,g,h))};a.frustumLineSegment=function(f,e,g,h){h=r(h,e,g,!0);return m(f,e,g,h)};a.frustumPoint=function(f,e){for(let g=0;6>g;g++)if(0<n.signedDistance(f[g],e))return!1;return!0};a.frustumRay=function(f,e,g,h){g=r(h,e,g,!1);return m(f,e,null,g)};a.frustumSphere=function(f,e,g){const h=e[0],l=e[1];e=e[2];return f[0][0]*h+
f[0][1]*l+f[0][2]*e+f[0][3]>g||f[1][0]*h+f[1][1]*l+f[1][2]*e+f[1][3]>g||f[2][0]*h+f[2][1]*l+f[2][2]*e+f[2][3]>g||f[3][0]*h+f[3][1]*l+f[3][2]*e+f[3][3]>g||f[4][0]*h+f[4][1]*l+f[4][2]*e+f[4][3]>g||f[5][0]*h+f[5][1]*l+f[5][2]*e+f[5][3]>g?!1:!0};a.planeSphere=function(f,e,g){return f[0]*e[0]+f[1]*e[1]+f[2]*e[2]+f[3]<g};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common ./InteractionType".split(" "),
function(a,c,b,t,n,r,m,d){function f(p,z,C=m.defaultConstraintOptions){if(!p.state.isLocal)return 0;var B=p.state.constraints.distance;if(!p.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===B)return 0;g.min=0;g.max=B;B=g;var A=C.interactionType;if(A!==d.InteractionType.NONE){var {min:x,max:u}=B,{interactionStartCamera:y,interactionFactor:w}=C;if(y){C=A===d.InteractionType.ZOOM||A===d.InteractionType.PAN;A=f(p,y);var D=0===A?0:e(p,y);B.min=x;B.max=u;m.adjustRangeForInteraction(A,D,C,w,.05*
D,B)}}p=e(p,z);p=g.max-p;return-1E-6<=p?0:p}function e(p,z){p=p.pointsOfInterest.surfaceOrigin;return p.renderLocation?b.distance(z.eye,p.renderLocation):0}const g={min:0,max:0},h=t.create(),l=t.create(),v=t.create(),q=t.create(),k=t.create();a.applyDistanceConstraint=function(p,z,C=m.defaultConstraintOptions){var B=f(p,z,C);if(0===B)return!1;var A=p.pointsOfInterest.surfaceOrigin;if(!A.renderLocation)return!1;B=e(p,z)+B;const x=b.copy(h,z.eye);C=m.interactionDirectionTowardsConstraintMinimization(z,
C.interactionDirection,b.direction(q,z.eye,A.renderLocation),v);if(!r.intersectRay(r.fromCenterAndRadius(A.renderLocation,B),n.wrap(z.eye,C),k))return!1;z.eye=k;A=b.subtract(l,z.eye,x);z.center=b.add(k,z.center,A);A=p.renderCoordsHelper.getAltitude(z.center);p=p.renderCoordsHelper.intersectInfiniteManifold(z.ray,A,k);c.isSome(p)&&(z.center=p);return!0};a.getDistanceConstraintError=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports",
"../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(a,c,b,t){a.Mode=void 0;(function(m){m[m.EYE=0]="EYE";m[m.EYE_AND_CENTER=1]="EYE_AND_CENTER";m[m.EYE_AND_CENTER_SCALE=2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const n=b.create(),r=b.create();a.applySurfaceCollisionConstraint=function(m,d,f=a.Mode.EYE){var e=m.state.constraints;if(!e.collision.enabled)return!1;var g=t.surfaceElevationBelowRenderLocation(m,d.eye);const h=m.renderCoordsHelper.getAltitude(d.eye);
e=g+e.collision.elevationMargin;if(h>=e)return!1;g=c.length(d.eye);c.subtract(n,d.center,d.eye);d.eye=m.renderCoordsHelper.setAltitude(r,e,d.eye);f===a.Mode.EYE_AND_CENTER?d.center=c.add(n,d.eye,n):f===a.Mode.EYE_AND_CENTER_SCALE&&(d.center=c.scale(n,d.center,(g-h+e)/g));return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),
function(a,c,b,t,n,r,m){function d(q,k){return q.elevationProvider?c.unwrapOr(q.elevationProvider.getElevation(k[0],k[1],k[2],q.renderCoordsHelper.spatialReference,"ground"),0):0}function f(q,k,p){if(!q.state.isGlobal||!q.stateManager.constraintsManager)return!1;const z=d(q,k);({far:q}=q.stateManager.constraintsManager.nearFarHeuristic.compute(k,p,q.renderDataExtent,z,v));q*=q;return b.squaredDistance(k,p)>q}const e={},g=t.create(),h=t.create(),l=t.create(),v={near:0,far:0};a.cameraOnContentAlongViewDirection=
function(q,k,p,z){const C=q.state.camera.clone();k&&p&&z&&(C.eye=k,C.center=p,C.up=z);k=C.ray;p=e[q.viewingMode];p||(p=m.newIntersector(q.state.viewingMode),p.options.backfacesTerrain=!q.state.isGlobal,p.options.invisibleTerrain=!0,e[q.viewingMode]=p);({isGlobal:z}=q.state);q.sceneIntersectionHelper.intersectRay(k,p,h)&&!f(q,k.origin,h)?k=!0:!q.renderCoordsHelper.intersectManifold(k,0,h)||f(q,k.origin,h)?z?(p=n.getReferenceEllipsoid(q.spatialReference).radius,p=b.dot(k.origin,k.origin)-p*p,b.scale(h,
k.direction,(0<p?Math.sqrt(p)/3:1)/b.length(k.direction)),b.add(h,h,k.origin),k=!0):k=!1:k=!0;k||b.copy(h,C.center);p=q.state.constraints;z=p.minimumPoiDistance;b.squaredDistance(C.eye,h)<z&&(k=p.collision.enabled,b.copy(l,C.viewForward),b.scale(l,l,z),k?C.eye=b.subtract(g,h,l):b.add(h,C.eye,l),q=q.renderCoordsHelper,z=q.getAltitude(C.eye),p=p.collision.elevationMargin,k&&z<p&&(b.subtract(l,h,C.eye),C.eye=q.setAltitude(g,p,C.eye),b.add(h,C.eye,l)));C.center=h;return C};a.eyeWithinExtent=function(q,
k,p,z){return c.isSome(q.renderCoordsHelper.fromRenderCoords(k.eye,g,z))&&r.containsPoint(p,g)};a.surfaceElevationBelowRenderLocation=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./IntersectorTarget ./intersectorUtils ./verticalOffsetUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){let k=function(){function x(y){this.options=new h.IntersectorOptions;this._results=new p;this.transform=new q.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=e.create();this._rayEnd=m.create();this._rayBeginTransformed=m.create();this._rayEndTransformed=m.create();this.viewingMode=null==y?g.ViewingMode.Global:y}var u=x.prototype;u.reset=function(y,w,D){this.resetWithRay(e.fromPoints(y,w,this._ray),D)};u.resetWithRay=function(y,w){this.camera=
w;y!==this._ray&&e.copy(y,this._ray);0!==this.options.verticalOffset?this.viewingMode===g.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;r.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)};u.intersect=function(y=null,w,D,F,E){this.point=w;this.filterPredicate=F;this.tolerance=null==D?1E-5:D;w=q.getVerticalOffsetObject3D(this.verticalOffset);if(b.isSome(y)&&0<y.length){const K=
E?J=>{E(J)&&this.intersectObject(J)}:J=>{this.intersectObject(J)};for(const J of y)y=J.getSpatialQueryAccelerator&&J.getSpatialQueryAccelerator(),b.isSome(y)?(b.isSome(w)?y.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,K,w):y.forEachAlongRay(this._ray.origin,this._ray.direction,K),this.options.selectionMode&&this.options.hud&&y.forEachDegenerateObject(K)):J.objects.forAll(M=>K(M))}this.sortResults()};u.intersectObject=function(y){const w=y.geometries;if(w){var D=y.transformation,
F=q.getVerticalOffsetObject3D(this.verticalOffset);for(const E of w){if(!E.visible)continue;const {material:K,id:J}=E;this.transform.setAndInvalidateLazyTransforms(D,E.shaderTransformation);r.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);r.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const M=this.transform.transform;b.isSome(F)&&(F.objectTransform=this.transform);K.intersect(E,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,
(N,P,I,G,H,L)=>{if(0<=N&&(!b.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEnd,N))){var O=G?this._results.hud:this._results,S=G?R=>{const Q=new l.HudTarget(y,J,I,L);R.set(h.IntersectorType.HUD,Q,N,P,n.IDENTITY,H)}:R=>R.set(h.IntersectorType.OBJECT,{object:y,geometryId:J,triangleNr:I},N,P,M,H);(null==O.min.drapedLayerOrder||H>=O.min.drapedLayerOrder)&&(null==O.min.dist||N<O.min.dist)&&S(O.min);this.options.store!==h.StoreResults.MIN&&(null==O.max.drapedLayerOrder||H<
O.max.drapedLayerOrder)&&(null==O.max.dist||N>O.max.dist)&&S(O.max);this.options.store===h.StoreResults.ALL&&(G?(G=new C(this._ray),S(G),this._results.hud.all.push(G)):(G=new z(this._ray),S(G),this._results.all.push(G)))}})}}};u.sortResults=function(y=this._results.all){y.sort((w,D)=>w.dist!==D.dist?b.unwrapOr(w.dist,0)-b.unwrapOr(D.dist,0):w.drapedLayerOrder!==D.drapedLayerOrder?b.unwrapOr(w.drapedLayerOrder,Number.MAX_VALUE)-b.unwrapOr(D.drapedLayerOrder,Number.MAX_VALUE):b.unwrapOr(D.drapedLayerGraphicOrder,
Number.MIN_VALUE)-b.unwrapOr(w.drapedLayerGraphicOrder,Number.MIN_VALUE))};c._createClass(x,[{key:"results",get:function(){return this._results}},{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}}]);return x}(),p=function(){function x(){this.min=new z(e.create());this.max=new z(e.create());this.hud={min:new C(e.create()),max:new C(e.create()),all:[]};this.ground=new z(e.create());this.all=[]}x.prototype.init=
function(u){this.min.init(u);this.max.init(u);this.ground.init(u);this.all.length=0;this.hud.min.init(u);this.hud.max.init(u);this.hud.all.length=0};return x}(),z=function(){function x(y){this.intersector=h.IntersectorType.OBJECT;this.normal=m.create();this.transformation=n.create();this._ray=e.create();this.init(y)}var u=x.prototype;u.getIntersectionPoint=function(y){if(!v.isValidIntersectorResult(this))return!1;r.scale(B,this.ray.direction,this.dist);r.add(y,this.ray.origin,B);return!0};u.getTransformedNormal=
function(y){r.copy(A,this.normal);A[3]=0;d.transformMat4(A,A,this.transformation);r.copy(y,A);return r.normalize(y,y)};u.init=function(y){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=h.IntersectorType.OBJECT;e.copy(y,this._ray)};u.set=function(y,w,D,F,E,K,J){this.intersector=y;this.dist=D;r.copy(this.normal,b.unwrapOr(F,m.UNIT_Z));t.copy(this.transformation,b.unwrapOr(E,n.IDENTITY));this.target=w;this.drapedLayerOrder=K;this.drapedLayerGraphicOrder=
J};u.copy=function(y){e.copy(y.ray,this._ray);this.intersector=y.intersector;this.dist=y.dist;this.target=y.target;this.drapedLayerOrder=y.drapedLayerOrder;this.drapedLayerGraphicOrder=y.drapedLayerGraphicOrder;r.copy(this.normal,y.normal);t.copy(this.transformation,y.transformation)};c._createClass(x,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return b.isSome(this.dist)?(r.scale(B,this.ray.direction,this.dist),r.length(B)):null}}]);return x}(),C=function(x){function u(){var y=
x.apply(this,arguments)||this;y.intersector=h.IntersectorType.HUD;return y}c._inheritsLoose(u,x);return u}(z);const B=m.create(),A=f.create();a.DEFAULT_TOLERANCE=1E-5;a.newIntersector=function(x){return new k(x)};a.newIntersectorResult=function(x){return new z(x)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],function(a){a.IntersectorType=void 0;(function(c){c[c.OBJECT=0]="OBJECT";c[c.HUD=1]="HUD";
c[c.TERRAIN=2]="TERRAIN";c[c.OVERLAY=3]="OVERLAY";c[c.I3S=4]="I3S";c[c.PCL=5]="PCL";c[c.LOD=6]="LOD";c[c.VOXEL=7]="VOXEL"})(a.IntersectorType||(a.IntersectorType={}));a.StoreResults=void 0;(function(c){c[c.MIN=0]="MIN";c[c.MINMAX=1]="MINMAX";c[c.ALL=2]="ALL"})(a.StoreResults||(a.StoreResults={}));a.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.filteredLayerUids=
[];this.store=a.StoreResults.ALL};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/IntersectorTarget":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/vec3f64"],function(a,c,b,t){let n=function(e,g,h){this.object=e;this.geometryId=g;this.triangleNr=h},r=function(e){function g(h,l,v,q){h=e.call(this,h,l,v)||this;h.center=b.isSome(q)?t.clone(q):null;return h}c._inheritsLoose(g,e);return g}(n),
m=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);return g}(r),d=function(e){this.layerUid=e},f=function(e){function g(h,l){h=e.call(this,h)||this;h.graphicUid=l;return h}c._inheritsLoose(g,e);return g}(d);a.Graphic3DTarget=f;a.HudTarget=r;a.LayerTarget=d;a.ObjectTarget=n;a.ValidHudTarget=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/boundedPlane ./IntersectorInterfaces".split(" "),
function(a,c,b,t,n,r){function m(f){return c.isSome(f)&&c.isSome(f.dist)}const d=t.create();a.isHudIntersectorResult=function(f){return m(f)&&f.intersector===r.IntersectorType.HUD&&!!f.target&&"center"in f.target&&c.isSome(f.target.center)};a.isObjectIntersectorResult=function(f){return m(f)&&f.intersector===r.IntersectorType.OBJECT&&!!f.target};a.isValidIntersectorResult=m;a.sliceFilterPredicate=function(f){return(e,g,h)=>{b.lerp(d,e,g,h);return!n.extrusionContainsPoint(f,d)}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/sphere".split(" "),function(a,c,b,t,n,r,m,d,f,e,g,h,l){let v=function(){function D(){this._transform=
m.create();this._transformInverse=new q({value:this._transform},r.invert,m.create);this._transformInverseTranspose=new q(this._transformInverse,r.transpose,m.create);this._transformTranspose=new q({value:this._transform},r.transpose,m.create);this._transformInverseRotation=new q({value:this._transform},t.normalFromMat4Legacy,n.create)}var F=D.prototype;F._invalidateLazyTransforms=function(){this._transformInverse.invalidate();this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();
this._transformInverseRotation.invalidate()};F.setTransformMatrix=function(E){r.copy(this._transform,E)};F.multiplyTransform=function(E){r.multiply(this._transform,this._transform,E)};F.set=function(E){r.copy(this._transform,E);this._invalidateLazyTransforms()};F.setAndInvalidateLazyTransforms=function(E,K){this.setTransformMatrix(E);this.multiplyTransform(K);this._invalidateLazyTransforms()};c._createClass(D,[{key:"transform",get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},
{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return D}(),q=function(){function D(F,E,K){this._original=F;this._update=E;this._dirty=!0;this._transform=K()}D.prototype.invalidate=function(){this._dirty=!0};c._createClass(D,[{key:"value",get:function(){this._dirty&&(this._update(this._transform,this._original.value),
this._dirty=!1);return this._transform}}]);return D}(),k=function(){function D(E=0){this.offset=E;this.tmpVertex=h.create()}var F=D.prototype;F.applyToVertex=function(E,K,J){const M=E+this.localOrigin[0],N=K+this.localOrigin[1],P=J+this.localOrigin[2],I=this.offset/Math.sqrt(M*M+N*N+P*P);this.tmpVertex[0]=E+M*I;this.tmpVertex[1]=K+N*I;this.tmpVertex[2]=J+P*I;return this.tmpVertex};F.applyToAabb=function(E){for(var K=0;3>K;++K)p[K]=E[0+K]+this.localOrigin[K],z[K]=E[3+K]+this.localOrigin[K],C[K]=p[K];
K=this.applyToVertex(p[0],p[1],p[2]);for(var J=0;3>J;++J)E[J]=K[J],E[J+3]=K[J];K=N=>{N=this.applyToVertex(N[0],N[1],N[2]);for(let P=0;3>P;++P)E[P+0]=Math.min(E[P+0],N[P]),E[P+3]=Math.max(E[P+3],N[P])};for(J=1;8>J;++J){for(var M=0;3>M;++M)C[M]=0===(J&1<<M)?p[M]:z[M];K(C)}J=0;for(M=0;3>M;++M)0>p[M]*z[M]&&(J|=1<<M);if(0!==J&&7!==J)for(M=0;8>M;++M)if(0===(J&M)){for(let N=0;3>N;++N)C[N]=J[N]?0:0!==(M&1<<N)?p[N]:z[N];K(C)}for(K=0;3>K;++K)E[K+0]-=this.localOrigin[K],E[K+3]-=this.localOrigin[K];return E};
return D}();const p=h.create(),z=h.create(),C=h.create();let B=function(){function D(E=0){this.componentLocalOriginLength=0;this._tmpVertex=h.create();this._mbs=l.create();this._obb={center:h.create(),halfSize:g.create(),quaternion:null};this._offset=this._totalOffset=0;this._resetOffset(E)}var F=D.prototype;F._resetOffset=function(E){this._totalOffset=this._offset=E};F.applyToVertex=function(E,K,J){const M=J+this.componentLocalOriginLength,N=this._totalOffset/Math.sqrt(E*E+K*K+M*M);this._tmpVertex[0]=
E+E*N;this._tmpVertex[1]=K+K*N;this._tmpVertex[2]=J+M*N;return this._tmpVertex};F.applyToAabb=function(E){const K=E[0],J=E[1],M=E[2]+this.componentLocalOriginLength,N=E[3],P=E[4],I=E[5]+this.componentLocalOriginLength;var G=0>K*N?0:Math.min(Math.abs(K),Math.abs(N)),H=0>J*P?0:Math.min(Math.abs(J),Math.abs(P)),L=0>M*I?0:Math.min(Math.abs(M),Math.abs(I));G=Math.sqrt(G*G+H*H+L*L);if(G<this._totalOffset)return E[0]-=0>K?this._totalOffset:0,E[1]-=0>J?this._totalOffset:0,E[2]-=0>M?this._totalOffset:0,E[3]+=
0<N?this._totalOffset:0,E[4]+=0<P?this._totalOffset:0,E[5]+=0<I?this._totalOffset:0,E;H=Math.max(Math.abs(K),Math.abs(N));L=Math.max(Math.abs(J),Math.abs(P));const O=Math.max(Math.abs(M),Math.abs(I));H=this._totalOffset/Math.sqrt(H*H+L*L+O*O);G=this._totalOffset/G;E[0]+=K*(0<K?H:G);E[1]+=J*(0<J?H:G);E[2]+=M*(0<M?H:G);E[3]+=N*(0>N?H:G);E[4]+=P*(0>P?H:G);E[5]+=I*(0>I?H:G);return E};F.applyToMbs=function(E){const K=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]),J=this._totalOffset/K;this._mbs[0]=E[0]+E[0]*
J;this._mbs[1]=E[1]+E[1]*J;this._mbs[2]=E[2]+E[2]*J;this._mbs[3]=E[3]+E[3]*this._totalOffset/K;return this._mbs};F.applyToObb=function(E){var K=E.center;const J=this._totalOffset/Math.sqrt(K[0]*K[0]+K[1]*K[1]+K[2]*K[2]);this._obb.center[0]=K[0]+K[0]*J;this._obb.center[1]=K[1]+K[1]*J;this._obb.center[2]=K[2]+K[2]*J;e.transformQuat(this._obb.halfSize,E.halfSize,E.quaternion);e.add(this._obb.halfSize,this._obb.halfSize,E.center);K=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+
this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);this._obb.halfSize[0]+=this._obb.halfSize[0]*K;this._obb.halfSize[1]+=this._obb.halfSize[1]*K;this._obb.halfSize[2]+=this._obb.halfSize[2]*K;e.subtract(this._obb.halfSize,this._obb.halfSize,E.center);d.conjugate(w,E.quaternion);e.transformQuat(this._obb.halfSize,this._obb.halfSize,w);this._obb.halfSize[0]*=0>this._obb.halfSize[0]?-1:1;this._obb.halfSize[1]*=0>this._obb.halfSize[1]?-1:1;this._obb.halfSize[2]*=
0>this._obb.halfSize[2]?-1:1;this._obb.quaternion=E.quaternion;return this._obb};c._createClass(D,[{key:"offset",get:function(){return this._offset},set:function(E){this._resetOffset(E)}},{key:"componentOffset",set:function(E){this._totalOffset=this._offset+E}},{key:"localOrigin",set:function(E){this.componentLocalOriginLength=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2])}}]);return D}(),A=function(){function D(E=0){this.offset=E;this.sphere=l.create();this.tmpVertex=h.create()}var F=D.prototype;F.applyToVertex=
function(E,K,J){const M=this.objectTransform.transform;let N=M[0]*E+M[4]*K+M[8]*J+M[12],P=M[1]*E+M[5]*K+M[9]*J+M[13];E=M[2]*E+M[6]*K+M[10]*J+M[14];K=this.offset/Math.sqrt(N*N+P*P+E*E);N+=N*K;P+=P*K;E+=E*K;K=this.objectTransform.inverse;this.tmpVertex[0]=K[0]*N+K[4]*P+K[8]*E+K[12];this.tmpVertex[1]=K[1]*N+K[5]*P+K[9]*E+K[13];this.tmpVertex[2]=K[2]*N+K[6]*P+K[10]*E+K[14];return this.tmpVertex};F.applyToMinMax=function(E,K){const J=this.offset/Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);E[0]+=E[0]*J;E[1]+=
E[1]*J;E[2]+=E[2]*J;E=this.offset/Math.sqrt(K[0]*K[0]+K[1]*K[1]+K[2]*K[2]);K[0]+=K[0]*E;K[1]+=K[1]*E;K[2]+=K[2]*E};F.applyToAabb=function(E){var K=this.offset/Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]);E[0]+=E[0]*K;E[1]+=E[1]*K;E[2]+=E[2]*K;K=this.offset/Math.sqrt(E[3]*E[3]+E[4]*E[4]+E[5]*E[5]);E[3]+=E[3]*K;E[4]+=E[4]*K;E[5]+=E[5]*K;return E};F.applyToBoundingSphere=function(E){const K=Math.sqrt(E[0]*E[0]+E[1]*E[1]+E[2]*E[2]),J=this.offset/K;this.sphere[0]=E[0]+E[0]*J;this.sphere[1]=E[1]+E[1]*J;this.sphere[2]=
E[2]+E[2]*J;this.sphere[3]=E[3]+E[3]*this.offset/K;return this.sphere};return D}();const x=new A,u=new B,y=new k,w=f.create();a.I3SVerticalOffsetGlobalViewingMode=B;a.IntersectorTransform=v;a.Object3DVerticalOffsetGlobalViewingMode=A;a.TERRAIN_ID="terrain";a.TerrainVerticalOffsetGlobalViewingMode=k;a.getVerticalOffsetI3S=function(D){return b.isSome(D)?(u.offset=D,u):null};a.getVerticalOffsetObject3D=function(D){return b.isSome(D)?(x.offset=D,x):null};a.getVerticalOffsetTerrain=function(D){return b.isSome(D)?
(y.offset=D,y):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../chunks/sphere ./common ./ConstraintTypes ./InteractionType ./TiltMode ../../state/utils/viewUtils".split(" "),function(a,
c,b,t,n,r,m,d,f,e,g,h,l,v,q){function k(F,E,K=g.defaultConstraintOptions,J=!0){D.eyeCenterDistance=0;D.requiresTwoSteps=!1;const M=p(F,E,K,void 0,D);if(0===M)return!1;n.fromRotation(A,-M,E.viewRight);switch(K.tiltMode){case v.TiltMode.LOOK_AROUND:m.transformMat4(B,E.viewForward,A);m.scale(B,B,D.eyeCenterDistance);E.center=m.add(x,E.eye,B);break;case v.TiltMode.TUMBLE:m.subtract(B,E.center,E.eye);m.transformMat4(B,B,A);E.eye=m.subtract(x,E.center,B);break;default:c.neverReached(K.tiltMode)}E.up=m.transformMat4(x,
E.up,A);return D.requiresTwoSteps&&J?k(F,E,K,!1):!0}function p(F,E,K=g.defaultConstraintOptions,J=g.defaultConstraintOptions,M){if(!F.state.constraints.tilt)return 0;var N=F.state.constraints.tilt(E.distance,y);if(K.interactionType!==l.InteractionType.NONE){var {interactionStartCamera:P,interactionFactor:I}=K;if(P){var {min:G,max:H}=N,L=p(F,P,g.defaultConstraintOptions,K),O=0===L?0:q.viewAngle(F.renderCoordsHelper,P.center,P.eye);N.min=G;N.max=H;K.interactionType===l.InteractionType.TUMBLE?(g.hasConstraintType(K.selection,
h.ConstraintTypes.ALTITUDE)&&C(F,P,N),g.adjustRangeForInteraction(L,O,!0,I,u,N)):g.adjustRangeForInteraction(L,O,!1,I,u,N)}}J.interactionType===l.InteractionType.TUMBLE&&g.hasConstraintType(J.selection,h.ConstraintTypes.ALTITUDE)&&C(F,J.interactionStartCamera,N);if(K.tiltMode===v.TiltMode.LOOK_AROUND||J.tiltMode===v.TiltMode.LOOK_AROUND){a:{M&&(M.requiresTwoSteps=!1);switch(F.viewingMode){case "global":K=w;L=F.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;J=L+f.getReferenceEllipsoid(F.spatialReference).radius;
L=F.renderCoordsHelper.intersectManifold(E.ray,L,x);K.eyeCenterDistance=E.distance;K.centerIsOnSurface=!1;t.isSome(L)?(K.eyeCenterDistance=m.distance(E.eye,L),K.tiltAtCenter=q.viewAngle(F.renderCoordsHelper,L,E.eye),K.centerIsOnSurface=!0):F.state.isLocal?K.tiltAtCenter=q.viewAngle(F.renderCoordsHelper,E.center,E.eye):(e.closestPointOnSilhouette(e.fromRadius(e.tmpSphere,J),E.ray,x),K.eyeCenterDistance=m.distance(E.eye,x),K.tiltAtCenter=b.acosClamped(-m.dot(E.viewForward,m.normalize(x,x))));K.radius=
J;K.eyeRadius=m.length(E.eye);K.constraints=F.state.constraints;E=b.clamp(K.tiltAtCenter,N.min,N.max);if(1E-9<Math.abs(K.tiltAtCenter-E)){if(K.centerIsOnSurface){{const {constraints:S,eyeCenterDistance:R,tiltAtCenter:Q}=K;E=Q;F=S.clampTilt(R,Q);N=z(K,F);if(S.clampTilt(N,Q)!==F)for(N=0;10>N&&1E-9<Math.abs(F-E);)J=(E+F)/2,L=z(K,J),L=S.clampTilt(L,J),1E-9<Math.abs(L-J)?E=J:F=J,N++;E=F}N=E;F=b.asinClamped(K.radius/K.eyeRadius*Math.sin(K.tiltAtCenter));N=b.asinClamped(K.radius/K.eyeRadius*Math.sin(N));
F=K.eyeRadius>K.radius?F-N:N-F}else E=K.constraints.clampTilt(K.eyeCenterDistance,K.tiltAtCenter),M&&E<Math.PI/2&&(M.requiresTwoSteps=!0,E=Math.PI/2-1E-5),F=K.tiltAtCenter-Math.PI/2-(E-Math.PI/2);M&&(M.eyeCenterDistance=z(K,E));M=F}else M=0;break a;case "local":J=q.viewAngle(F.renderCoordsHelper,E.center,E.eye);K=b.clamp(J,N.min,N.max);N=J-K;1E-9<Math.abs(N)?(M&&(J=F.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,F=F.renderCoordsHelper.getAltitude(E.eye)-J,K=Math.cos(K),M.eyeCenterDistance=
1E-4<Math.abs(K)?F/K:E.distance),M=N):M=0;break a}M=void 0}return M}M=q.viewAngle(F.renderCoordsHelper,E.center,E.eye);K=b.clamp(M,N.min,N.max);M-=K;M=1E-9<Math.abs(M)?M:0;return M}function z(F,E){if(!F.centerIsOnSurface)return F.eyeCenterDistance;E=Math.PI-b.clamp(E,0,Math.PI);const K=b.asinClamped(F.radius/F.eyeRadius*Math.sin(E)),J=Math.sin(Math.PI-E-K)/Math.sin(E);return F.eyeRadius<F.radius&&1<J?Math.sin(Math.PI-E-(Math.PI-K))/Math.sin(E)*F.eyeRadius:J*F.eyeRadius}function C(F,E,K){var J=F.state.constraints;
if(!F.state.isLocal&&J.altitude&&E){var M=m.squaredLength(E.center),N=Math.sqrt(M);E=E.distance;var P=f.getReferenceEllipsoid(F.spatialReference).radius;F=J.altitude.min+P;J=J.altitude.max+P;F=(F*F-E*E-M)/(-2*N*E);K.min=Math.max(K.min,Math.min(Math.PI-b.acosClamped((J*J-E*E-M)/(-2*N*E)),K.max));K.max=Math.min(K.max,Math.PI-b.acosClamped(F))}}const B=d.create(),A=r.create(),x=d.create(),u=b.deg2rad(5),y={min:0,max:0},w={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,
tiltAtCenter:0},D={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=k;a.getTiltConstraintError=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,c,b,t){const n=t.create(),r=t.create();a.viewAngle=function(m,d,f){m.worldUpAtPosition(d,n);b.subtract(r,f,d);m=b.length(r);return 0===m?0:c.acosClamped(b.dot(r,n)/
m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function c(O){return O}function b(O){const S=2*(O-Math.sqrt((O-1)*O)),R=S/2/O;return Q=>Q<R?O*Q*Q:S*Q-S+1}function t(O,S){return(R,Q)=>R<S?S*O(R/S,Q):1-O((1-R)/(1-S),Q)*(1-S)}const n=O=>O*O,r=O=>1-n(1-O),m=O=>.5>O?n(2*O)/2:(1-n(1-2*(O-.5))+1)/2,d=O=>O*O*O,f=O=>1-d(1-O),e=O=>.5>O?d(2*O)/2:(1-d(1-2*(O-.5))+1)/2,g=O=>O*O*O*O,h=O=>1-g(1-O),l=O=>.5>O?g(2*O)/2:(1-g(1-
2*(O-.5))+1)/2,v=O=>O*O*O*O*O,q=O=>1-v(1-O),k=O=>.5>O?v(2*O)/2:(1-v(1-2*(O-.5))+1)/2,p=O=>-Math.cos(O*Math.PI/2)+1,z=O=>1-p(1-O),C=O=>.5>O?p(2*O)/2:(1-p(1-2*(O-.5))+1)/2,B=O=>2**(10*(O-1)),A=O=>1-2**(10*(1-O-1)),x=O=>.5>O?2**(10*(2*O-1))/2:(1-2**(10*(1-2*(O-.5)-1))+1)/2,u=O=>-(Math.sqrt(1-O*O)-1),y=O=>1-u(1-O),w=O=>.5>O?u(2*O)/2:(1-u(1-2*(O-.5))+1)/2,D=t(b(1),1),F=t(b(1),0),E=t(b(1),.5),K=t(b(2),1),J=t(b(2),0),M=t(b(2),.5),N=t(b(3),1),P=t(b(3),0),I=t(b(3),.5),G=t(b(4),1),H=t(b(4),0),L=t(b(4),.5);
a.EasingFunctions={linear:c,"in-quad":n,"out-quad":r,"in-out-quad":m,"in-coast-quad":D,"out-coast-quad":F,"in-out-coast-quad":E,"in-cubic":d,"out-cubic":f,"in-out-cubic":e,"in-coast-cubic":K,"out-coast-cubic":J,"in-out-coast-cubic":M,"in-quart":g,"out-quart":h,"in-out-quart":l,"in-coast-quart":N,"out-coast-quart":P,"in-out-coast-quart":I,"in-quint":v,"out-quint":q,"in-out-quint":k,"in-coast-quint":G,"out-coast-quint":H,"in-out-coast-quint":L,"in-sine":p,"out-sine":z,"in-out-sine":C,"in-expo":B,"out-expo":A,
"in-out-expo":x,"in-circ":u,"out-circ":y,"in-out-circ":w};a.inCirc=u;a.inCoastCubic=K;a.inCoastQuad=D;a.inCoastQuart=N;a.inCoastQuint=G;a.inCubic=d;a.inExpo=B;a.inOutCirc=w;a.inOutCoastCubic=M;a.inOutCoastQuad=E;a.inOutCoastQuart=I;a.inOutCoastQuint=L;a.inOutCubic=e;a.inOutExpo=x;a.inOutQuad=m;a.inOutQuart=l;a.inOutQuint=k;a.inOutSine=C;a.inQuad=n;a.inQuart=g;a.inQuint=v;a.inSine=p;a.linear=c;a.outCirc=y;a.outCoastCubic=J;a.outCoastQuad=F;a.outCoastQuart=P;a.outCoastQuint=H;a.outCubic=f;a.outExpo=
A;a.outQuad=r;a.outQuart=h;a.outQuint=q;a.outSine=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){a.PointToPointAnimationController=function(p){function z(B){B=p.call(this,B)||this;B.mode="interaction";B._hasTarget=!1;return B}c._inheritsLoose(z,p);var C=z.prototype;C.initialize=function(){this.animation=new e.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new f};C.begin=function(B,A){this._hasTarget=!0;A=this.animationSettings(A);q.copyFrom(this.view.state.camera);const x=l.newIntersector(this.view.state.viewingMode);
this.intersectionHelper.intersectRay(q.ray,x,k)&&(q.center=k);this.animation.update(q,B,A);this.animation.finished&&this.finish()};C.finish=function(){this.animation.currentTime=this.animation.time;p.prototype.finish.call(this)};C.stepController=function(B,A){this._hasTarget&&this.animation.step(B,A)};C.onControllerEnd=function(B){this._hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,B),this.animation.currentTime=this.animation.time);p.prototype.onControllerEnd.call(this,
B)};C.animationSettings=function(B={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...B,easing:"string"===typeof B.easing?v.EasingFunctions[B.easing]:B.easing}};c._createClass(z,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",get:function(){return this._hasTarget&&this.animation.finished}}]);
return z}(g.AnimationController);b.__decorate([t.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);b.__decorate([t.property({readOnly:!0})],a.PointToPointAnimationController.prototype,"isInteractive",null);a.PointToPointAnimationController=b.__decorate([m.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const q=new h.Camera,k=d.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(a,c,b,t,n,r,m,d){const f=n.create();n=function(){function e(h){this.currentTime=b.Milliseconds(0);this._animation=new d.Animation(()=>new r(h));this._current=new r(h)}var g=e.prototype;g.update=function(h,
l,v){const q=this._animation.definition.source,k=this._animation.definition.target,p=t.subtract(f,l.center,h.center),z=t.length(p);1E-5<=z?(p[0]/=z,p[1]/=z,p[2]/=z):(p[0]=0,p[1]=1,p[0]=0);t.copy(q.lookAtDirection,p);t.copy(k.lookAtDirection,p);q.copyFromRenderCamera(h);k.copyFromRenderCamera(l);this._current.copyFrom(q);this._animation.update(q,k,v);this.currentTime=b.Milliseconds(0);h.almostEquals(l)&&(this.currentTime=this._animation.time)};g.cameraAt=function(h,l){this._animation.cameraAt(h,this._current);
l=l||new m.Camera;this._current.copyToRenderCamera(l);return l};g.step=function(h,l){this.finished||(this.currentTime=b.Milliseconds(this.currentTime+b.millisecondsFromSeconds(h)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,l)};c._createClass(e,[{key:"finished",get:function(){return this.currentTime>=this._animation.time}},{key:"time",get:function(){return this._animation.time}}]);return e}();a.Animation=n;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(a,c,b,t,n,r,m){const d=n.create(),f=n.create(),e=n.create(),g=n.create(),h=n.create(),l=n.create();var v=n.fromValues(0,0,1),q=n.fromValues(0,1,0),k=n.fromValues(1,0,0);const p=b.create();return function(){function z(B=r.ViewingMode.Global){this.viewingMode=
B;this.center=n.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=n.clone(q)}var C=z.prototype;C.pixelsPerPanAtZoom=function(B){return this.size/2/(this._zoomToPanScale*B)};C.zoomAtPixelsPerPan=function(B){return this.size/2/(this._zoomToPanScale*B)};C.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};C.compareTo=function(B,A){A||(A={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(this.viewingMode===r.ViewingMode.Global){var x=t.length(this.center);
const u=t.length(B.center);x=(x+u)/2;A.pan=m.angle(this.center,B.center)*x}else A.pan=t.distance(this.center,B.center);x=Math.abs(B.yaw-this.yaw);x>=Math.PI&&(x=2*Math.PI-x);A.rotate=Math.max(x,Math.abs(B.pitch-this.pitch));A.sourceZoom=this.distance;A.targetZoom=B.distance;return A};C.interpolate=function(B,A,x){this.viewingMode===r.ViewingMode.Global?m.slerp(B.center,A.center,x.pan,this.center):t.lerp(this.center,B.center,A.center,x.pan);this.distance=isFinite(A.distance)?a.lerp(B.distance,A.distance,
x.zoom):B.distance;this.pitch=a.lerp(B.pitch,A.pitch,x.rotate);B=B.yaw;A=A.yaw;Math.abs(A-B)>=Math.PI&&(B+=2*(B<A?1:-1)*Math.PI);this.yaw=a.lerp(B,A,x.rotate)};C.copyFrom=function(B){t.copy(this.center,B.center);this.pitch=B.pitch;this.yaw=B.yaw;this.distance=B.distance;t.copy(this.lookAtDirection,B.lookAtDirection);this.size=B.size;this.copyFromCommon(B);this.viewingMode=B.viewingMode};C.copyFromRenderCamera=function(B){const A=this._lookAtOrientation(B.center,p);t.copy(this.center,B.center);t.subtract(g,
B.center,B.eye);t.transformMat3(g,g,A);t.transformMat3(h,B.up,A);this.distance=t.length(g);0!==this.distance&&(g[0]/=this.distance,g[1]/=this.distance,g[2]/=this.distance);this.pitch=this._eyeUpToPitch(g);this.yaw=this._eyeUpToYaw(g,h);this.size=Math.sqrt(B.width*B.width+B.height*B.height);this.copyFromCommon(B)};C.copyFromCommon=function(B){this.fov=B.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};C.copyToRenderCamera=function(B){const A=this._lookAtOrientation(this.center,p);c.transpose(A,A);
this._axisAngleVec3(k,this.pitch-Math.PI/2,q,g);this._axisAngleVec3(v,this.yaw,g);this._axisAngleVec3(k,this.pitch-Math.PI/2,v,h);this._axisAngleVec3(v,this.yaw,h);t.scale(g,g,this.distance);t.transformMat3(g,g,A);t.transformMat3(h,h,A);B.center=this.center;B.eye=t.subtract(g,this.center,g);B.up=h};C._axisAngleVec3=function(B,A,x,u=x){const y=Math.cos(A);A=Math.sin(A);t.scale(d,x,y);t.cross(f,B,x);t.scale(f,f,A);t.scale(e,B,(1-y)*t.dot(B,x));return t.add(u,t.add(u,d,f),e)};C._lookAtOrientation=function(B,
A=b.create()){this._upAtLookAt(B,e);t.cross(d,this.lookAtDirection,e);t.normalize(d,d);0===d[0]&&0===d[1]&&0===d[2]&&t.copy(d,k);t.cross(f,e,d);t.normalize(f,f);A[0]=d[0];A[1]=f[0];A[2]=e[0];A[3]=d[1];A[4]=f[1];A[5]=e[1];A[6]=d[2];A[7]=f[2];A[8]=e[2];return A};C._upAtLookAt=function(B,A){return this.viewingMode===r.ViewingMode.Local?t.copy(A,v):t.normalize(A,B)};C._eyeUpToPitch=function(B){return Math.PI-m.angle(v,B)};C._eyeUpToYaw=function(B,A){.5>Math.abs(A[2])?(t.copy(l,A),0<B[2]&&t.scale(l,l,
-1)):t.copy(l,B);t.cross(f,l,v);t.normalize(f,f);return m.angle(k,f,v)};return z}()})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),function(a,c,b,t,n,r,m){const d={zoom:0,pan:0,rotate:0};let f=function(){function e(h){this._createCamera=h;this._time=b.Milliseconds(0);this.definition=new n.Definition(h);this.path=new m.Path}var g=e.prototype;g.update=function(h,
l,v){this.definition.update(h,l,v);this.path.update(this.definition,v);this._time=this._applyTimeSettings(b.millisecondsFromSeconds(isFinite(this.path.time)?this.path.time:b.Seconds(0)),v);this._easing=v.easing?v.easing:1E3<=this._time?t.inOutCoastQuad:t.outExpo};g.cameraAt=function(h,l){l=l||this._createCamera();h=Math.min(Math.max(0,h),1);h=this._normalizedEasing(h);h=this.path.interpolateComponentsAt(h,d);l.interpolate(this.definition.source,this.definition.target,h);return l};g._normalizedEasing=
function(h){const l=this._easing(0,this._time),v=this._easing(1,this._time);return(this._easing(h,this._time)-l)/(v-l)};g._applyTimeSettings=function(h,l){const v=null!=l.speedFactor?l.speedFactor:1;null!=l.duration?h=l.duration:null!=l.speedFactor&&(h=b.Milliseconds(h/v));return b.Milliseconds(Math.min(Math.max(null!=l.minDuration?l.minDuration:r.defaultSettings.minDuration/v,h),null!=l.maxDuration?l.maxDuration:r.defaultSettings.maxDuration/v))};c._createClass(e,[{key:"time",get:function(){return this._time}}]);
return e}();a.Animation=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(a,c,b){let t=function(){function n(m){this._createCamera=m;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:b.defaultSettings.desiredScreenFlow};this.source=m();this.target=m()}var r=n.prototype;r.clone=function(){const m=new n(this._createCamera);
m.copyFrom(this);return m};r.copyFrom=function(m){this.update(m.source,m.target,m.settings)};r.update=function(m,d,f){this.source!==m&&this.source.copyFrom(m);this.target!==d&&this.target.copyFrom(d);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=f.desiredScreenFlow?f.desiredScreenFlow:b.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*this.target.size;this.halfWindowSize=this.target.size/2};r.halfWindowPanAtZoom=
function(m){m=this.target.pixelsPerPanAtZoom(m);return this.halfWindowSize/m};c._createClass(n,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<this.compared.rotate}}]);return n}();a.Definition=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],
function(a,c){c={desiredScreenFlow:2,minDuration:c.Milliseconds(500),maxDuration:c.Milliseconds(8E3)};a.defaultSettings=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),function(a,c,b,t,n,r){t=function(m){function d(e,g){var h=m.call(this)||this;h._preallocSegments=[new n.Segment,new n.Segment,new n.Segment];h._ascensionSegment=
null;h._descensionSegment=null;h.update(e,g);return h}c._inheritsLoose(d,m);var f=d.prototype;f.update=function(e,g){if(e){this.definition?this.definition.copyFrom(e):this.definition=e.clone();var h=null;g&&g.apex&&(h=r.optimalDistance(e,g.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==h?this._updateWithoutApex():this._updateWithApex(h,g?.apex)}};f.segmentInterpolateComponentsAt=function(e,g,h){h=e.interpolateComponentsAt(g,h);e===this._ascensionSegment?h.zoom=
b.outQuad(h.zoom):e===this._descensionSegment&&(h.zoom=b.inQuad(h.zoom));return h};f._updateWithApex=function(e,g){const [h,l,v]=this._preallocSegments,q=g?.ascensionFactor??.5;g=Math.min(1-q,null!=g?.ascensionFactor&&null!=g.descensionFactor?g.descensionFactor:.5);const k=1-q-g;h.definition?h.definition.copyFrom(this.definition):h.definition=this.definition.clone();h.definition.compared.targetZoom=e;h.definition.compared.pan=this.definition.compared.pan*q;h.definition.compared.rotate=this.definition.compared.rotate*
q;h.update();this._ascensionSegment=h;this.segments.push(h);0<k&&(l.definition?l.definition.copyFrom(this.definition):l.definition=this.definition.clone(),l.definition.copyFrom(this.definition),l.definition.compared.sourceZoom=e,l.definition.compared.targetZoom=e,l.definition.compared.pan=this.definition.compared.pan*k,l.definition.compared.rotate=this.definition.compared.rotate*k,l.update(),this.segments.push(l));v.definition?v.definition.copyFrom(this.definition):v.definition=this.definition.clone();
v.definition.compared.sourceZoom=e;v.definition.compared.pan=this.definition.compared.pan*g;v.definition.compared.rotate=this.definition.compared.rotate*g;v.update();this._descensionSegment=v;this.segments.push(v)};f._updateWithoutApex=function(){const [e]=this._preallocSegments;e.update(this.definition);this.segments.push(e)};return d}(t.Path);a.Path=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/time"],function(a,c,b){let t=function(){function n(){this.segments=[]}var r=n.prototype;r.interpolateComponentsAt=function(m,d){m=Math.min(Math.max(m,0),1);m*=this.time;let f=0,e=0;const g=this.definition;for(let h=0;h<this.segments.length;h++){const l=this.segments[h],v=l.definition;if(m<=l.time||h===this.segments.length-1)return d=this.segmentInterpolateComponentsAt(l,0===l.time?0:m/l.time,d),g.hasPan&&!isNaN(d.pan)&&isFinite(g.compared.pan)?d.pan=(f+v.compared.pan*d.pan)/g.compared.pan:
d.pan=1,g.hasRotate&&!isNaN(d.rotate)&&isFinite(g.compared.rotate)?d.rotate=(e+v.compared.rotate*d.rotate)/g.compared.rotate:d.rotate=1,g.hasZoom&&!isNaN(d.zoom)&&isFinite(v.compared.targetZoom)?(m=this.segments[0].definition.compared.sourceZoom,d.zoom=(d.zoom*(v.compared.targetZoom-v.compared.sourceZoom)+v.compared.sourceZoom-m)/(this.segments[this.segments.length-1].definition.compared.targetZoom-m)):d.zoom=1,d;m-=l.time;f+=v.compared.pan;e+=v.compared.rotate}};r.segmentInterpolateComponentsAt=
function(m,d,f){return m.interpolateComponentsAt(d,f)};c._createClass(n,[{key:"time",get:function(){return this.segments.reduce((m,d)=>b.Seconds(m+d.time),b.Seconds(0))}}]);return n}();a.Path=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,c,b){let t=function(){function n(m){m&&this.update(m)}var r=n.prototype;r.update=function(m){m&&
(this.definition?this.definition.copyFrom(m):this.definition=m.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};r._updatePrecomputedVariables=function(){var m=this.definition;const d=m.compared,f=d.sourceZoom,e=d.targetZoom;this._zoomSign=f>e?1:-1;this._panPixelsAtSource=d.pan*m.source.pixelsPerPanAtZoom(f);m=(m.source.pixelsPerRotateAtZoom(f)+m.target.pixelsPerRotateAtZoom(e))/2;this._rotatePixels=d.rotate*m};r._updatePixelFlow=function(){var m=this.definition.compared.sourceZoom,
d=this.definition.compared.targetZoom;const {hasZoom:f,hasPan:e,hasRotate:g}=this.definition;var h=0,l=0;f&&(e&&(h=(d/m-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),g&&(l=Math.log(m/d)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;m=this.definition.desiredPixelFlow;f&&e&&g?(d=h+l+h*l,this._zoomPixelFlow=h*l/d*m,this._panPixelFlow=l/d*m,this._rotatePixelFlow=h/d*
m):f&&e?(l=1+h,this._zoomPixelFlow=h/l*m,this._panPixelFlow=1/l*m):f&&g?(h=1+l,this._zoomPixelFlow=l/h*m,this._rotatePixelFlow=1/h*m):e&&g?(h=this._panPixelsAtSource/this._rotatePixels,l=1+h,this._panPixelFlow=h/l*m,this._rotatePixelFlow=1/l*m):e?this._panPixelFlow=m:f?this._zoomPixelFlow=m:g&&(this._rotatePixelFlow=m);this._time=g?this.rotateTime:f?this.zoomTime:e?this.panTime:b.Seconds(0)};r._interpolateComponentsZoom=function(m){if(0===m||1===m)return m;if(this.definition.hasZoom){const d=this.definition.compared.sourceZoom,
f=this.definition.compared.targetZoom;return(d*(d/f)**-m-d)/(f-d)}return m};r._interpolateComponentsPan=function(m){if(0===m||1===m)return m;if(this.definition.hasPan&&this.definition.hasZoom){const d=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(d*m*this._time)-1)/(d*Math.LN2)}return m};r._interpolateComponentsRotate=function(m){return m};r.interpolateComponentsAt=function(m,d){m=Math.min(Math.max(m,0),1);const f=this._interpolateComponentsZoom(m),
e=this._interpolateComponentsPan(m);m=this._interpolateComponentsRotate(m);d?(d.zoom=f,d.pan=e,d.rotate=m):d={zoom:f,pan:e,rotate:m};return d};c._createClass(n,[{key:"time",get:function(){return this._time}},{key:"rotateTime",get:function(){return this.definition.hasRotate?b.Seconds(this._rotatePixels/this._rotatePixelFlow):b.Seconds(0)}},{key:"zoomTime",get:function(){return this.definition.hasZoom?b.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*
this._zoomSign*this.definition.halfWindowSize/this._zoomPixelFlow):b.Seconds(0)}},{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const m=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return b.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*m+1)/(m*this._zoomPixelFlow))}return b.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return b.Seconds(0)}}]);return n}();a.Segment=t;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports","./functions"],function(a,c){function b(t,n){const r=Math.max(t.compared.sourceZoom,t.compared.targetZoom);t=t.source.zoomAtPixelsPerPan(t.desiredPixelFlow/t.compared.pan)/2;return t<r?null!=n.maximumDistance?r+(n.maximumDistance-r)/2:1.5*r:n.maximumDistance?Math.min(n.maximumDistance,t):t}a.optimalDistance=function(t,n){let r=b(t,n);const m={ascensionFactor:null!=n.ascensionFactor?n.ascensionFactor:
.5,descensionFactor:null!=n.descensionFactor?n.descensionFactor:.5};var d=0===m.ascensionFactor,f=0===m.descensionFactor;const e=d?c.tAscensionZoomOnly:c.tAscensionZoomPan,g=d?c.dtAscensionZoomOnly:c.dtAscensionZoomPan,h=d?c.ddtAscensionZoomOnly:c.ddtAscensionZoomPan,l=f?c.tDescensionZoomOnly:c.tDescensionZoomPan,v=f?c.dtDescensionZoomOnly:c.dtDescensionZoomPan,q=f?c.ddtDescensionZoomOnly:c.ddtDescensionZoomPan;d=x=>e(t,x,m)+c.tPanion(t,x,m)+l(t,x,m);f=x=>g(t,x,m)+c.dtPanion(t,x,m)+v(t,x,m);const k=
x=>h(t,x,m)+c.ddtPanion(t,x,m)+q(t,x,m);let p=d(r);const z=c.tBaseLine(t),C=n.maximumIterations||20,B=null!=n.maximumDistance?n.maximumDistance:Infinity;for(n=0;n<C;n++){var A=(f(r)+1E-6)/k(r);if(isNaN(A)||r>=B&&0>A){if(!isFinite(B))return null;r=B;p=d(r);break}r-=A;if(r<t.compared.sourceZoom||r<t.compared.targetZoom)return null;A=d(r);if(.005>=Math.abs(A-p)/p)break;p=A}return p>.7*z||r<t.compared.sourceZoom||r<t.compared.targetZoom?null:r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=function(c,b){return-c.halfWindowSize/(b*b*c.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(c,b,t){const n=b-c.compared.sourceZoom,r=1/n,m=1/b,d=Math.log(c.compared.sourceZoom*m);t=(t.ascensionFactor*Math.LN2*c.compared.pan+c.halfWindowPanAtZoom(n))/c.halfWindowPanAtZoom(1);return c.halfWindowSize*r*(-2*r*m*t+2*r*d+2*m-2*d*t/(n*n)-t/(b*b))/(c.desiredPixelFlow*Math.LN2)};
a.ddtDescensionZoomOnly=function(c,b){return-c.halfWindowSize/(b*b*c.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=function(c,b,t){const n=b-c.compared.targetZoom,r=1/n,m=1/b,d=Math.log(b/c.compared.targetZoom);t=(c.halfWindowPanAtZoom(b)+t.descensionFactor*Math.LN2*c.compared.pan-c.halfWindowPanAtZoom(c.compared.targetZoom))/c.halfWindowPanAtZoom(1);return c.halfWindowSize*r*(-2*r*m*t-2*r*d+2*m+2*d*t/(n*n)-t/(b*b))/(c.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(c,b,t){return-2*c.compared.pan*
c.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(c.desiredPixelFlow*c.halfWindowPanAtZoom(b*b*b))};a.dtAscensionZoomOnly=function(c,b){return c.halfWindowSize/(b*c.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(c,b,t){const n=1/b,r=Math.log(c.compared.sourceZoom*n),m=1/c.desiredPixelFlow,d=1/Math.LN2;b-=c.compared.sourceZoom;const f=1/b;t=(t.ascensionFactor*Math.LN2*c.compared.pan+c.halfWindowPanAtZoom(b))/c.halfWindowPanAtZoom(1);return c.halfWindowSize*n*m*d*f*t-c.halfWindowSize*
r*m*d*f+c.halfWindowSize*r*m*d*t/(b*b)};a.dtDescensionZoomOnly=function(c,b){return c.halfWindowSize/(b*c.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomPan=function(c,b,t){const n=Math.log(b/c.compared.targetZoom),r=1/c.desiredPixelFlow,m=1/Math.LN2,d=-b+c.compared.targetZoom,f=1/d;t=(-c.halfWindowPanAtZoom(b)-t.descensionFactor*Math.LN2*c.compared.pan+c.halfWindowPanAtZoom(c.compared.targetZoom))/c.halfWindowPanAtZoom(1);return-c.halfWindowSize*n*r*m*f+c.halfWindowSize*n*r*m*t/(d*d)+c.halfWindowSize*
r*m*f*t/b};a.dtPanion=function(c,b,t){return c.compared.pan*c.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(c.desiredPixelFlow*c.halfWindowPanAtZoom(b*b))};a.tAscensionZoomOnly=function(c,b){return-c.halfWindowSize*Math.log(c.compared.sourceZoom/b)/(c.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(c,b,t){const n=c.halfWindowPanAtZoom(b-c.compared.sourceZoom);return-c.halfWindowSize*(t.ascensionFactor*Math.LN2*c.compared.pan+n)*Math.log(c.compared.sourceZoom/b)/(c.desiredPixelFlow*
Math.LN2*n)};a.tBaseLine=function(c){const b=Math.LN2*c.compared.pan,t=c.halfWindowPanAtZoom(c.compared.sourceZoom-c.compared.targetZoom),n=c.halfWindowSize*Math.log(c.compared.sourceZoom/c.compared.targetZoom)/(c.desiredPixelFlow*Math.LN2*t);return c.compared.sourceZoom<=c.compared.targetZoom?n*(b-t):n*(b+t)};a.tDescensionZoomOnly=function(c,b){return c.halfWindowSize*Math.log(b/c.compared.targetZoom)/(c.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(c,b,t){return c.halfWindowSize*(-c.halfWindowPanAtZoom(b)-
t.descensionFactor*Math.LN2*c.compared.pan+c.halfWindowPanAtZoom(c.compared.targetZoom))*Math.log(b/c.compared.targetZoom)/(c.desiredPixelFlow*Math.LN2*c.halfWindowPanAtZoom(-b+c.compared.targetZoom))};a.tPanion=function(c,b,t){return-c.compared.pan*c.halfWindowSize*(t.ascensionFactor+t.descensionFactor-1)/(c.desiredPixelFlow*c.halfWindowPanAtZoom(b))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){a.AnimationController=function(v){function q(){var p=v.apply(this,arguments)||this;p._asyncResult=null;return p}c._inheritsLoose(q,v);var k=q.prototype;k.onControllerStart=function(){this.state=l.State.Running;t.isSome(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};k.updateStateFromViewAnimation=function(){!t.isSome(this.viewAnimation)||this.state!==l.State.Ready&&this.state!==l.State.Running||
(this.viewAnimation.state===h.State.FINISHED?this.finish():this.viewAnimation.state===h.State.STOPPED&&(this.state=l.State.Stopped))};k.onControllerEnd=function(){t.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===l.State.Finished?this.viewAnimation.finish():this.state===l.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===l.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(n.createAbortError()))};k.finish=function(){this.finishController()};
c._createClass(q,[{key:"canStop",get:function(){return!0}},{key:"asyncResult",get:function(){return this._asyncResult},set:function(p){this._asyncResult&&(this._asyncResult.reject(n.createAbortError()),this._asyncResult=null);this.state===l.State.Finished||this.state===l.State.Stopped?(t.assertIsSome(p),this.state===l.State.Finished?p.resolve():p.reject(n.createAbortError())):this._asyncResult=p}}]);return q}(l.CameraController);a.AnimationController=b.__decorate([g.subclass("esri.views.3d.state.controllers.AnimationController")],
a.AnimationController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m,d){a.State=void 0;(function(f){f.Ready=
"ready";f.Rejected="rejected";f.Running="running";f.Stopped="stopped";f.Finished="finished"})(a.State||(a.State={}));a.CameraController=function(f){function e(h){h=f.call(this,h)||this;h.state=a.State.Ready;return h}c._inheritsLoose(e,f);var g=e.prototype;g.stopController=function(){return this.canStop?(this.state=a.State.Stopped,!0):!1};g.finishController=function(){this.state=a.State.Finished};c._createClass(e,[{key:"active",get:function(){return this.state===a.State.Running}},{key:"isInteractive",
get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return e}(t);b.__decorate([n.property({constructOnly:!0})],a.CameraController.prototype,"view",void 0);b.__decorate([n.property({readOnly:!0})],a.CameraController.prototype,"active",null);b.__decorate([n.property()],a.CameraController.prototype,"state",void 0);b.__decorate([n.property({readOnly:!0})],a.CameraController.prototype,"isInteractive",null);a.CameraController=b.__decorate([d.subclass("esri.views.3d.state.controllers.CameraController")],
a.CameraController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A){function x(za,sa,ua){ua=r.fromRotation(p.sm4d.get(),ua[3],h.axis(ua));t.isNone(ua)||r.exactEquals(ua,m.IDENTITY)||(e.subtract(fa,za.eye,sa),e.transformMat4(fa,fa,ua),za.eye=e.add(fa,fa,sa),e.subtract(fa,za.center,sa),e.transformMat4(fa,fa,ua),za.center=e.add(fa,fa,sa),za.up=e.transformMat4(fa,za.up,ua))}function u(za,sa,ua,oa){return Math.sin(za/e.length(sa))*(ua+oa.radius)}function y(za,sa,ua,oa){ua=z.fromScreenAtEye(sa,ua,va);if(t.isNone(ua))return!1;
q.closestPointOnSilhouette(za,ua,S);return q.intersectRay(za,ua,oa)?e.squaredDistance(S,ua.origin)<e.squaredDistance(oa,ua.origin)?(e.copy(oa,S),!1):!0:(e.subtract(R,sa.eye,sa.center),e.normalize(R,R),v.fromNormalAndOffset(R,-e.dot(e.normalize(R,R),S),Q),v.intersectRay(Q,ua,oa),!1)}function w(za,sa,ua,oa,xa,Ea){var Ia=0;e.cross(na,za,sa);e.subtract(ka,za,sa);e.length(za)<=xa||!oa.aboveGround?(e.cross(ua,ka,oa.eye),Ia=e.dot(za,sa)/(e.length(za)*e.length(sa)),.9999>Ia?Ia=b.acosClamped(Ia):(za=e.length(e.cross(g.create(),
za,sa))/(e.length(za)*e.length(sa)),Ia=b.asinClamped(za)),Ea=Math.cos(b.clamp(c.cyclicalPI.normalize(b.deg2rad(Ea)),0,L)),Ia=-Ia-Math.max(0,e.length(sa)-xa)/(Ea*xa)):(e.subtract(V,oa.eye,oa.center),e.cross(ua,ka,V),Ia=-e.length(ka)/xa);e.normalize(ua,ua);e.scale(ua,ua,e.length(na));return Ia}function D(za,sa,ua,oa){oa=Math.cos(b.clamp(c.cyclicalPI.normalize(b.deg2rad(oa)),0,L));sa=sa>ua?-(sa-ua)/(oa*ua):sa<-ua?Math.PI-(sa+ua)/(oa*ua):b.acosClamped(sa/ua);return((za>ua?-(za-ua)/(oa*ua):za<-ua?Math.PI-
(za+ua)/(oa*ua):b.acosClamped(za/ua))-sa)*ua}function F(za,sa,ua,oa,xa,Ea,Ia,Na,Oa,Ja){Na=D(za[2],sa[2],Ea[3],Na);sa=Oa?D(za[0],sa[0],Ea[3],180):sa[0]-za[0];za=Math.sin(Ia)*sa-Math.cos(Ia)*Na;Ia=Math.cos(Ia)*sa+Math.sin(Ia)*Na;e.normalize(fa,xa);xa=Oa?za/Math.sqrt(Math.abs(Ea[3]**2-e.dot(ua,fa)**2)):za/Ea[3];ua=Ia/Math.sqrt(Math.abs(Ea[3]**2-e.dot(ua,oa)**2));d.set(Ja,xa,ua)}function E(za,sa,ua,oa,xa,Ea,Ia,Na,Oa,Ja){e.cross(na,za,sa);l.coordinateSystemFromOneAxisAndNormalVector(Ea.up,Ea.eye,T,U,Y);
l.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Ea.eye,aa,X,W);e.copy(ua,X);e.copy(oa,aa);e.normalize(ua,ua);e.scale(ua,ua,e.length(na));l.vectorCoordinates(za,e.normalize(U,U),e.normalize(Y,Y),e.normalize(T,T),ba);l.vectorCoordinates(sa,U,Y,T,da);F(ba,da,za,aa,X,Ia,Na,Oa,Ja,xa)}function K(za,sa,ua,oa,xa,Ea,Ia){r.fromRotation(ja,xa,oa);r.fromRotation(ia,Ia,Ea);r.multiply(Z,ja,ia);e.subtract(sa,za,ua);e.transformMat4(sa,sa,Z);e.add(sa,sa,ua)}function J(za,sa,ua,oa,xa,Ea){r.fromRotation(ja,oa,
ua);r.fromRotation(ia,Ea,xa);r.multiply(Z,ja,ia);e.subtract(fa,za.eye,sa);e.transformMat4(fa,fa,Z);za.eye=e.add(fa,fa,sa);e.subtract(fa,za.center,sa);e.transformMat4(fa,fa,Z);za.center=e.add(fa,fa,sa);e.subtract(fa,za.up,sa);e.transformMat4(fa,fa,Z);za.up=e.add(fa,fa,sa)}function M(za,sa,ua,oa,xa,Ea){return(Math.abs(oa)>Math.PI-H.Angle||Math.abs(oa)<H.Angle)&&(Math.abs(za[2])<ua*H.Pole||Math.abs(sa)>ua)&&Ea.aboveGround&&xa<H.Tilt}function N(za,sa,ua,oa,xa,Ea){Ea?(h.fromPoints(ua,oa,ca),x(sa,za,ca)):
(ua=w(ua,oa,pa,sa,za[3],xa),x(sa,za,h.wrapAxisAngle(pa,ua)))}function P(za,sa,ua,oa,xa,Ea,Ia){const Na=Ia?20:1;e.copy(ha,oa);la.copyFrom(sa);let Oa;for(let Ja=0;Ja<Na&&1E-12<e.squaredDistance(ua,ha);Ja++)if(oa=e.squaredDistance(ua,ha),E(ua,ha,X,aa,ea,la,za,xa,Ea,Ia),J(la,za,aa,ea[1],X,ea[0]),K(ha,ha,za,aa,ea[1],X,ea[0]),Oa=e.squaredDistance(ua,ha),Oa<oa||0===Ja)sa.copyFrom(la);else break}a.SpherePickPointFallback=void 0;(function(za){za[za.Ellipsoid=0]="Ellipsoid";za[za.Silhouette=1]="Silhouette"})(a.SpherePickPointFallback||
(a.SpherePickPointFallback={}));A={exclude:new Set([A.TERRAIN_ID])};const I=n.createScreenPointArray();a.NavigationMode=void 0;(function(za){za[za.Vertical=0]="Vertical";za[za.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const G={Elevation:3E4,Angle:b.deg2rad(16)},H={Pole:.95,Angle:b.deg2rad(18),Tilt:45},L=b.deg2rad(80),O=g.create(),S=g.create(),R=g.create(),Q=v.create(),V=g.create(),aa=g.create(),X=g.create(),W=g.create(),T=g.create(),U=g.create(),Y=g.create(),ba=g.create(),
da=g.create(),ea=f.create(),ca=h.create(),ja=m.create(),ia=m.create(),Z=m.create(),ha=g.create(),fa=g.create(),ka=g.create(),la=new B.Camera,na=g.create(),pa=g.create(),va={origin:g.create(),direction:g.create()},wa={origin:g.create(),direction:g.create()};a.DISTANCE_CLAMP_VALUES=[1,3E8];a.MIN_HEIGHT_LIMIT=50;a.PAN_DISTANCE_MODIFIER=5;a.PIVOT_DISTANCE_MODIFIER=30;a.PreservingHeadingThreshold=H;a.ROTATE_PIVOT_DISTANCE_MODIFIER=5;a.ROTATE_PIVOT_MIN_DISTANCE_MODIFIER=10;a.ROTATE_SCREEN_PIXEL_AREA=90;
a.SCREEN_PIXEL_AREA=80;a.TiltThresholdPanningSpeed=L;a.VerticalPanTresholds=G;a.ZOOM_DISTANCE_MODIFIER=8;a.ZOOM_MAX_DISTANCE_MODIFIER=1508E5;a.ZOOM_MIN_DISTANCE_MODIFIER=200;a.applyPanPlanar=function(za,sa,ua){e.subtract(O,ua,sa);za.eye=e.subtract(fa,za.eye,O);za.center=e.subtract(fa,za.center,O)};a.applyPanSphericalDirectRotation=N;a.applyPanSphericalPreserveHeading=P;a.applyRotation=x;a.applyRotationWithTwoAxes=J;a.applyZoomOnSphere=function(za,sa,ua){sa.getScreenCenter(I);C.intersectScreen(za,
sa,I,fa)&&(sa.center=fa);za=sa.distance;ua*=za;1E-6>Math.abs(za-ua)||(ua=e.scale(p.sv3d.get(),sa.viewForward,ua),sa.eye=e.subtract(fa,sa.center,ua))};a.applyZoomToPoint=function(za,sa,ua,oa){const xa=p.sv3d.get();ua=1-ua;e.subtract(xa,sa,za.eye);const Ea=e.length(xa);let Ia=Ea*(1-ua);0<=ua&&Ia<oa&&(Ia=oa,ua=-(Ia-Ea)/Ea);1E-6>Math.abs(Ea-Ia)||(e.scale(xa,xa,ua),za.eye=e.add(fa,za.eye,xa),za.center=e.lerp(fa,za.center,sa,ua))};a.centroid=function(za,sa){e.set(sa,0,0,0);for(const ua of za)e.add(sa,sa,
ua);e.scale(sa,sa,1/za.length)};a.contentIntersectorOptions=A;a.decideNavigationMode=function(za,sa,ua){if(e.length(za.eye)-ua.radius>G.Elevation)return a.NavigationMode.Horizontal;z.fromScreenAtEye(za,sa,wa);return-Math.sign(za.relativeElevation)*(.5*Math.PI+k.angle(za.eye,wa.direction))<G.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};a.intersectPlaneFromScreenPoint=function(za,sa,ua,oa){return v.intersectRay(za,z.fromScreen(sa,ua,va),oa)};a.intersectPlaneFromScreenPointAtEye=function(za,
sa,ua,oa){return v.intersectRay(za,z.fromScreenAtEye(sa,ua,va),oa)};a.lengthFromPoints=D;a.normalizeCoordinate=function(za,sa,ua){ua[0]=sa[0]/(za.fullWidth/za.pixelRatio);ua[1]=sa[1]/(za.fullHeight/za.pixelRatio);return ua};a.normalizeRotationDelta=function(za){for(;za>Math.PI;)za-=2*Math.PI;for(;za<-Math.PI;)za+=2*Math.PI;return za};a.offSurfaceTiltToEyeTiltGlobal=function(za,sa,ua,oa){return u(Math.PI/2,sa,ua,oa)+(za-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=u;a.panMotionToRotationMatrix=function(za,
sa,ua,oa,xa,Ea,Ia,Na,Oa){if(M(za.center,e.dot(za.up,za.center),e.length(za.center),-c.cyclicalPI.normalize(b.deg2rad(Ea)),Ia,sa))switch(za=-c.cyclicalPI.normalize(b.deg2rad(xa)),{eye:xa}=sa,l.coordinateSystemFromOneAxisAndNormalVector([0,0,1],xa,aa,X,W),xa=ua.translation[0]*oa.pan,Ea="zoom"===Oa.mode?0:ua.translation[1]*oa.pan,sa=Math.max(Math.sqrt(Math.abs(1-e.dot(sa.center,aa)**2/e.length(sa.center)**2)),.5),Ia=-Math.cos(za)*Ea+Math.sin(za)*xa,r.rotate(Na.pan.matrix,Na.pan.matrix,(Math.sin(za)*
Ea+Math.cos(za)*xa)/sa,aa),Na.pan.enabled=!0,Oa.mode){case "pan":r.rotate(Na.pan.matrix,Na.pan.matrix,Ia,X);Na.pan.enabled=!0;break;case "zoom":Na.zoom=-ua.translation[1]*oa.zoom}else{const {eye:Ja,viewRight:Sa}=sa;sa=e.cross(p.sv3d.get(),Sa,Ja);za=ua.translation[0]*oa.pan;0!==za&&(r.rotate(Na.pan.matrix,Na.pan.matrix,-za,sa),Na.pan.enabled=!0);switch(Oa.mode){case "pan":ua=ua.translation[1]*oa.pan;0!==ua&&(r.rotate(Na.pan.matrix,Na.pan.matrix,ua,Sa),Na.pan.enabled=!0);break;case "zoom":Na.zoom=-ua.translation[1]*
oa.zoom}}};a.panToPosition=function(za,sa,ua,oa,xa,Ea,Ia){M(ua,e.dot(sa.up,ua),za[3],-c.cyclicalPI.normalize(b.deg2rad(xa)),Ea,sa)?P(za,sa,ua,oa,-c.cyclicalPI.normalize(b.deg2rad(xa)),Ea,Ia):N(za,sa,ua,oa,Ea,Ia)};a.pickPointAndInitSphere=function(za,sa,ua,oa,xa,Ea){const Ia=g.create(),Na=q.create();let Oa=!0,Ja=!0;za.intersectScreen(ua,Ia,Ea)?Na[3]=e.length(Ia):(Ja=!1,Na[3]=sa.aboveGround&&xa!==a.SpherePickPointFallback.Ellipsoid?Math.max(e.length(sa.center),.9*oa.radius):e.length(sa.eye)-sa.relativeElevation,
xa===a.SpherePickPointFallback.Silhouette?y(Na,sa,ua,Ia):Oa=C.intersectScreen(Na,sa,ua,Ia));return{sphere:Na,scenePickPoint:Oa?Ia:null,hasGeometryIntersection:Ja}};a.preserveHeadingThreshold=M;a.rotatePointAroundTwoAxes=K;a.rotationAngleAndAxisDirectRotation=w;a.rotationAnglesAndAxesHeadingPreserving=E;a.rotationAnglesHeadingPreserving=F;a.sphereOrPlanePointFromScreenPoint=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),
function(a,c,b,t,n,r){function m(l=e){return[l[0],l[1],l[2],l[3]]}function d(l,v,q,k,p=m()){p[0]=l;p[1]=v;p[2]=q;p[3]=k;return p}function f(l,v){l[3]=v;return l}const e=[0,0,1,0],g=b.create(),h=b.create();a.UP=e;a.angle=function(l){return l[3]};a.axis=function(l){return l};a.compose=function(l,v,q){c.setAxisAngle(g,l,l[3]);c.setAxisAngle(h,v,v[3]);c.multiply(g,h,g);return f(q,c.getAxisAngle(q,g))};a.copy=function(l,v=m()){return d(l[0],l[1],l[2],l[3],v)};a.create=m;a.fromAxisAndAngle=function(l,v){const q=
m();t.copy(q,l);q[3]=v;return q};a.fromPoints=function(l,v,q){t.cross(q,l,v);t.normalize(q,q);q[3]=n.angle(l,v);return q};a.fromValues=d;a.setAngle=f;a.wrap=function(l,v,q,k){return d(l,v,q,k,r.sv4d.get())};a.wrapAxisAngle=function(l,v){return d(l[0],l[1],l[2],v,r.sv4d.get())};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/vectorStacks".split(" "),
function(a,c,b,t,n,r){function m(f,e,g){const h=b.castRenderScreenPointArray3(t.copy(r.sv3d.get(),e));h[2]=0;if(!f.unprojectFromRenderScreen(h,g.origin))return null;e=b.castRenderScreenPointArray3(t.copy(r.sv3d.get(),e));e[2]=1;f=f.unprojectFromRenderScreen(e,r.sv3d.get());if(c.isNone(f))return null;n.subtract(g.direction,f,g.origin);return g}function d(f,e,g){n.copy(g.origin,f.eye);e=n.set(r.sv3d.get(),e[0],e[1],1);f=f.unprojectFromRenderScreen(e,r.sv3d.get());if(c.isNone(f))return null;n.subtract(g.direction,
f,g.origin);return g}a.fromRender=m;a.fromRenderAtEye=d;a.fromScreen=function(f,e,g){return m(f,f.screenToRender(e,b.castRenderScreenPointArray3(r.sv3d.get())),g)};a.fromScreenAtEye=function(f,e,g){return d(f,f.screenToRender(e,b.castRenderScreenPointArray3(r.sv3d.get())),g)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports","../../../../geometry/support/ray","../../../../chunks/sphere","./ray"],function(a,c,b,
t){const n=c.create();a.intersectScreen=function(r,m,d,f){m=t.fromScreenAtEye(m,d,n);return b.intersectRay(r,m,f)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../../animation/easing".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){a.ZoomStepController=function(F){function E(){var J=F.apply(this,arguments)||this;J._zoomLocation=v.create();J._tmpCamera=new A.Camera;J._tmpRayDir=v.create();J._tmpCenter=v.create();J._constraintOptions={selection:k.ConstraintTypes.ALL,interactionType:p.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new A.Camera,interactionDirection:null,tiltMode:z.TiltMode.TUMBLE};return J}c._inheritsLoose(E,F);var K=E.prototype;K.zoomStep=
function(J,M){if(this.active){var N=this.view.state,{interactionStartCamera:P}=this._constraintOptions;P&&(this.animation.finished?P.copyFrom(N.camera):this.animation.cameraAt(1,P));this._tmpCamera.copyFrom(N.camera);P=x.newIntersector(this.view.state.viewingMode);N=!1;0<J?(N=this.intersectionHelper.intersectScreenFreePointFallback(M,this._zoomLocation,0===this.view.map.ground.opacity?B.contentIntersectorOptions:{}),this.intersectionHelper.intersectRay(this._tmpCamera.ray,P,this._tmpCenter)&&(this._tmpCamera.center=
this._tmpCenter)):this.intersectionHelper.intersectRay(this._tmpCamera.ray,P,this._zoomLocation)?this._tmpCamera.center=this._zoomLocation:l.copy(this._zoomLocation,this._tmpCamera.center);J=.6**J;M=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,M[0],M[1],this.view.state.camera,60);l.subtract(D,this._tmpCamera.eye,this._zoomLocation);l.normalize(D,D);P=t.clamp(Math.min(B.ZOOM_DISTANCE_MODIFIER,1/Math.abs(l.dot(w,D)))*Math.abs(this.view.camera.position.z),B.ZOOM_MIN_DISTANCE_MODIFIER,
B.ZOOM_MAX_DISTANCE_MODIFIER);if(M=n.isSome(M)?M:P)if(P=v.create(),l.subtract(P,this._zoomLocation,this._tmpCamera.eye),M<l.length(P)||!N)l.normalize(P,P),l.add(this._zoomLocation,this._tmpCamera.eye,l.scale(P,P,M));this._updateCamera(this._tmpCamera,J,this._zoomLocation);this.begin(this._tmpCamera)}};K.animationSettings=function(){return{duration:r.Milliseconds(600),easing:u.outExpo}};K._updateCamera=function(J,M,N){l.subtract(this._tmpRayDir,N,J.eye);const P=l.length(this._tmpRayDir);let I=P*M;
const G=Math.max(4,1.01*J.nearFar[0]);0!==I&&(1>=M&&I<G&&(I=G,M=I/P),1E-6>Math.abs(P-I)||(l.scale(this._tmpRayDir,this._tmpRayDir,M),J.eye=l.subtract(y,N,this._tmpRayDir),J.center=l.lerp(y,J.center,N,1-M),q.applyAll(this.view,J,this._constraintOptions)))};return E}(C.PointToPointAnimationController);a.ZoomStepController=b.__decorate([h.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const y=v.create(),w=v.fromValues(0,0,1),D=v.create();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(c,b){if("touch"===c.pointerType)return!1;switch(b){case "primary":return 0===c.button;case "secondary":return 2===c.button;case "tertiary":return 1===c.button}};a.eventMatchesPointerAction=function(c,b){switch(b){case "primary":return"touch"===c.pointerType||0===c.button;case "secondary":return"touch"!==c.pointerType&&2===c.button;case "tertiary":return"touch"!==
c.pointerType&&1===c.button}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,c,b,t,n,r){n=function(m){function d(f,e,g,h){var l=m.call(this,!0)||this;l._view=f;l.pointerAction=e;l._pivot=g;l.registerIncoming("drag",h,
v=>l._handleDrag(v));return l}c._inheritsLoose(d,m);d.prototype._handleDrag=function(f){const e=f.data;if(!(1<e.pointers.size)&&r.eventMatchesMousePointerAction(f.data,this.pointerAction)){var g=b.createScreenPointArray(e.center.x,e.center.y);switch(e.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=new t.RotateController({view:this._view,pivot:this._pivot});this._view.state.switchCameraController(this._cameraController);
this._cameraController.begin(g);break;case "update":this._cameraController&&this._cameraController.update(g);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}f.stopPropagation()}};return d}(n.InputHandler);Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>t.PivotPoint});a.DragRotate=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y){a.PivotPoint=void 0;(function(F){F[F.CENTER=0]="CENTER";F[F.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=function(F){function E(J){J=F.call(this,J)||this;J.pivot=a.PivotPoint.CENTER;J._rotScale=0;J._lastPoint=v.create();J._tmpWorldUp=k.create();J._tmpViewDir=k.create();J._tmpRotCurPoint=v.create();J._tmpTransf=h.create();J._tmpAxis=k.create();J._tmpPivotPoint=k.create();J._pivotPos=k.create();J._constraintOptions={selection:C.ConstraintTypes.ALL,
interactionType:B.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:A.TiltMode.TUMBLE};return J}c._inheritsLoose(E,F);var K=E.prototype;K.initialize=function(){this._rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5};K.begin=function(J){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:q.copy(this._pivotPos,this.startCamera.eye);this._constraintOptions.interactionType=B.InteractionType.LOOK_AROUND;this._constraintOptions.tiltMode=A.TiltMode.LOOK_AROUND;
this._constraintOptions.selection=C.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:const M=this._intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this._pivotPos,0===this.view.map.ground.opacity?y.contentIntersectorOptions:{});M||q.copy(this._pivotPos,this.startCamera.center);this._constrainPivotPoint(J,M);this.startCamera.center=this._pivotPos;this._constraintOptions.interactionType=B.InteractionType.TUMBLE;this._constraintOptions.tiltMode=A.TiltMode.TUMBLE;this._constraintOptions.selection=
C.ConstraintTypes.ALL&~C.ConstraintTypes.DISTANCE}this._constraintOptions.interactionStartCamera=this.startCamera;y.normalizeCoordinate(this.startCamera,J,this._lastPoint)}};K._constrainPivotPoint=function(J,M){const N=this.startCamera,P=k.create();q.subtract(P,this._pivotPos,N.eye);const I=q.length(P);var G=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(N.eye,D);G=Math.max(Math.min(y.ROTATE_PIVOT_DISTANCE_MODIFIER,1/Math.abs(q.dot(D,N.viewForward)))*G,y.ROTATE_PIVOT_MIN_DISTANCE_MODIFIER);
M&&(G=Math.min(I,G));var H=p.getReferenceEllipsoid(this.view.spatialReference),L=r.createScreenPointArray(N.width/N.pixelRatio*.5,N.height/N.pixelRatio*.5);H=y.decideNavigationMode(this.startCamera,L,H);L=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,N.fullWidth/N.pixelRatio*.5,N.fullHeight/N.pixelRatio*.5,N,2.5*y.ROTATE_SCREEN_PIXEL_AREA,y.ROTATE_SCREEN_PIXEL_AREA);J=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,J[0],J[1],N,y.ROTATE_SCREEN_PIXEL_AREA);
if(n.isSome(L)||n.isSome(J))L=n.unwrapOr(L,J),J=n.isNone(J)||H===y.NavigationMode.Horizontal?L:J,G=L>J?J:L,G=M?Math.min(G,I):G;q.normalize(P,P);q.copy(this._pivotPos,q.add(this._tmpPivotPoint,N.eye,q.scale(this._tmpPivotPoint,P,G)))};K.update=function(J){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,J,this.currentCamera.center,this._pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this._pivotPos,this.currentCamera.eye=
this._applyRotation(this.currentCamera,J,this.currentCamera.eye,this._pivotPos)}z.applyAll(this.view,this.currentCamera,this._constraintOptions);this.commitCamera()}};K.end=function(){this.active&&this.finishController()};K._applyRotation=function(J,M,N,P){this.view.renderCoordsHelper.worldUpAtPosition(P,this._tmpWorldUp);y.normalizeCoordinate(J,M,this._tmpRotCurPoint);M=(this._lastPoint[1]-this._tmpRotCurPoint[1])*this._rotScale;let I=(this._tmpRotCurPoint[0]-this._lastPoint[0])*this._rotScale;q.subtract(this._tmpViewDir,
N,P);N=q.length(this._tmpViewDir);N=t.acosClamped(q.dot(this._tmpViewDir,this._tmpWorldUp)/N);if(this.pivot===a.PivotPoint.EYE){const G=.5*Math.PI-N,H=.495*Math.PI;M=G-Math.max(-H,Math.min(H,G+-.5*M))}M=t.clamp(M+N,x.TiltDefault.min,x.TiltDefault.max)-N;q.cross(this._tmpAxis,J.up,this._tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(I=-I);g.fromRotation(this._tmpTransf,I,this._tmpWorldUp);g.rotate(this._tmpTransf,this._tmpTransf,M,this._tmpAxis);q.transformMat4(this._tmpViewDir,this._tmpViewDir,this._tmpTransf);
J.up=q.transformMat4(w,J.up,this._tmpTransf);q.add(w,P,this._tmpViewDir);l.copy(this._lastPoint,this._tmpRotCurPoint);return w};c._createClass(E,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return E}(u.InteractiveController);b.__decorate([m.property()],a.RotateController.prototype,"pivot",void 0);a.RotateController=b.__decorate([e.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const w=k.create(),D=k.create();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../ViewStateManager ./CameraController ../../webgl-engine/lib/Camera".split(" "),function(a,c,b,t,n,r,m,d,f,e){a.InteractiveController=
function(g){function h(){var v=g.apply(this,arguments)||this;v.startCamera=new e.Camera;v.currentCamera=new e.Camera;v._lastInteraction=0;return v}c._inheritsLoose(h,g);var l=h.prototype;l.stepController=function(v,q){q.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(q)};l.onControllerStart=function(v){this.state=f.State.Running;this.startCamera.copyFrom(v);this.currentCamera.copyFrom(v)};l.onControllerEnd=function(v){v.copyViewFrom(this.currentCamera)};l.commitCamera=function(){this._lastInteraction=
performance.now();setTimeout(()=>this.notifyChange("isInteractive"),d.INTERACTING_TIMEOUT);this.view.state.updateCamera(v=>this.stepController(0,v));this.steppingFinished&&this.finishController()};c._createClass(h,[{key:"isInteractive",get:function(){return performance.now()-this._lastInteraction<d.INTERACTING_TIMEOUT}}]);return h}(f.CameraController);b.__decorate([t.property({readOnly:!0})],a.InteractiveController.prototype,"isInteractive",null);b.__decorate([t.property()],a.InteractiveController.prototype,
"_lastInteraction",void 0);a.InteractiveController=b.__decorate([m.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ViewStateManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../webgl-engine/lib/RenderFeature ../../support/RenderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G){a.ViewStateManager=function(V){function aa(W){var T=V.call(this,W)||this;T._propertiesPool=new M.PropertiesPool({frustum:F.Frustum},c._assertThisInitialized(T));T._cameraSetByUser=!1;T._gotoOperation=null;T.constraintsManager=null;T.ready=!1;T._windowDevicePixelRatio=1;T._devicePixelRatioOverride=null;T._cameraChangeTime=0;T._updatingIgnoreRenderState=!1;T.test={viewStateManager:c._assertThisInitialized(T),contentCameraResetState:new Map,
setDevicePixelRatio:U=>T._devicePixelRatioOverride=U,renderState:null,get maximumPixelRatio(){return this.viewStateManager.view.qualitySettings.maximumPixelRatio},set updatingIgnoreRenderState(U){this.viewStateManager._updatingIgnoreRenderState=U},get updatingIgnoreRenderState(){return this.viewStateManager._updatingIgnoreRenderState||d.isSome(this.renderState)}};return T}c._inheritsLoose(aa,V);var X=aa.prototype;X.installContentCameraReset=function(W){this.removeHandles("content-camera-reset");this.test.contentCameraResetState.clear();
if(!this.view.state.fixedContentCamera)return!1;const T=this.zoom,U=this.view.state.camera.distance**2,Y=p.fromArray(this.view.state.camera.center),ba=W.sticky?this.contentCamera.clone():null;this.addHandles([f.watch(()=>this.contentCamera,()=>{W.sticky||(this.removeHandles("content-camera-reset"),this.test.contentCameraResetState.clear())}),f.watch(()=>this.zoom,da=>{void 0!==da&&void 0!==T&&(this.test.contentCameraResetState.set("view.zoom",Math.abs(da-T)/2),2<Math.abs(da-T)?this.contentCamera=
null:this.view.state.fixedContentCamera||(this.contentCamera=ba))}),f.watch(()=>this.view.state.camera,da=>{da=k.squaredDistance(Y,da.center);this.test.contentCameraResetState.set("camera.center",da/U);da>U?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=ba)})],"content-camera-reset");return!0};X._paddingToArray=function(W,T,U){W?z.set(U,W.top||0,W.right||0,W.bottom||0,W.left||0):z.set(U,0,0,0,0);for(W=0;4>W;W++)U[W]=Math.round(U[W]*T)};X.initialize=function(){this._cameraChangeTime=
performance.now();this.addHandles([f.on(()=>this.view.state.events,"before-camera-change",W=>W&&this._updateElevation(W)),f.watch(()=>this.view.state?.camera,(W,T)=>this._cameraChangedHandler(W,T),f.sync)]);f.when(()=>this.view.state?.camera,W=>this._updateElevation(W),{once:!0,sync:!0});this.addHandles([e.addFrameTask({prepare:()=>this._prepareFrame()}),f.watch(()=>this.view.state.cameraController,()=>{this._cameraSetByUser=!0;this.removeHandles("pending-initial-view")}),f.on(()=>this.view.state.events,
"camera-projection-changed",()=>this.notifyChange("scale"))])};X.destroy=function(){this.exit();this._propertiesPool=d.destroyMaybe(this._propertiesPool)};X.init=function(){this.constraintsManager=new D.ConstraintsManager({view:this.view});this._prepareFrame();var W=this._getInitialProperties();this._cameraSetByUser=!1;this._set("ready",!0);for(const T of W)this.set(T.name,T.value);this._cameraSetByUser||((W=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(W)?
this._setInitialView(W):this.view.state.viewingMode===u.ViewingMode.Local&&this.addHandles(f.when(()=>this.view.basemapTerrain.ready,()=>{this.removeHandles("pending-initial-view");this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),"pending-initial-view"))};X.exit=function(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this._cameraSetByUser=!1,this.removeHandles("pending-initial-view"),this.constraintsManager=
d.destroyMaybe(this.constraintsManager))};X.goTo=function(){var W=c._asyncToGenerator(function*(T,U){U={animate:!0,...U};d.isSome(this._gotoOperation)&&this._gotoOperation.abort(U.animate);this._gotoOperation=new E.GoToOperation(T,U,this.view);this.view.resourceController.scheduler.stopFrame();return this._gotoOperation});return function(T,U){return W.apply(this,arguments)}}();X.debugSetCameraOnContent=function(){this.setStateCamera(w.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};
X.step=function(W){const T=this.view.state,U=T?.cameraController;U&&(T.updateCamera(Y=>U.stepController(W,Y)),U.steppingFinished&&U.finishController())};X._cancelGoToOperation=function(){d.isSome(this._gotoOperation)&&(this._gotoOperation.abort(),this._gotoOperation=null)};X._getInitialProperties=function(){const W=new Set,T=[];for(const {propertyName:U,overrides:Y}of L){const ba=W.has(U),da=this._isOverridden(U);!ba&&da&&T.push({name:U,value:this._get(U)});this._clearOverride(U);(ba||da)&&Y.forEach(ea=>
W.add(ea))}return T};X._setInitialView=function(W){if(!d.isNone(W)&&!this._cameraSetByUser)if(W instanceof t)this.setStateCamera(J.externalToInternal(this.view,W),{applyConstraints:!1});else if(W instanceof n)if(W.targetGeometry instanceof B){var T=J.fromExtent(this.view,W.targetGeometry,0,.5,J.OrientationMode.LOCKED);d.isSome(T)&&this.setStateCamera(J.externalToInternal(this.view,T),{applyConstraints:!0})}else T={applyConstraints:!W.camera},W=this._viewpointToCamera(W),this.setStateCamera(W,T);else T=
J.fromExtent(this.view,W,0,.5,J.OrientationMode.LOCKED),d.isSome(T)&&this.setStateCamera(J.externalToInternal(this.view,T),{applyConstraints:!0})};X._updatePropertyBeforeReady=function(W,T){if(this.ready)return!1;this._override(W,T);T&&H.includes(W)&&this._override("hasInitialView",!0);return!0};X.isCompatible=function(W){return d.isNone(W)?!1:W instanceof n?W.camera?this.isCompatible(W.camera):this.isCompatible(W.targetGeometry):W instanceof t?this.isCompatible(W.position):W.spatialReference&&x.canProject(W.spatialReference,
this.view.spatialReference)};X._getPreservingHeadingTilt=function(W=O){this._cameraSetByUser?(W.heading=this.camera.heading,W.tilt=this.camera.tilt):(W.heading=0,W.tilt=.5);return W};X._centerPointAtDistanceToCamera=function(W,T,U=R){const {heading:Y,tilt:ba}=this._getPreservingHeadingTilt();W=J.getObserverForPointAtDistance(this.view,Y,ba,W,T,J.OrientationMode.ADJUST);if(d.isNone(W))return null;U.copyFrom(this.view.state.camera);U.eye=W.eye;U.center=W.center;U.up=W.up;return U};X._centerToCamera=
function(W){const T=this.view.pointsOfInterest.centerOnContent;T.runTask();return this._centerPointAtDistanceToCamera(W,T.distance)};X._extentToCamera=function(W){const {heading:T,tilt:U}=this._getPreservingHeadingTilt();return(W=J.fromExtent(this.view,W,T,U,J.OrientationMode.ADJUST,S))?J.externalToInternal(this.view,W):null};X._scaleToCamera=function(W){if(null==W)return null;var T=this.view.pointsOfInterest.centerOnContent;T.runTask();const U=T.renderLocation;T=T.location.latitude;if(null==T)return null;
W=J.scaleToDistance(this.view,W,T);return this._centerPointAtDistanceToCamera(U,W)};X._zoomToCamera=function(W){return this._scaleToCamera(J.zoomToScale(this.view,W))};X._viewpointToCamera=function(W){return J.externalToInternal(this.view,N.toCamera(this.view,W))};X.setStateCamera=function(W,T){if(d.isNone(W)||!this.view.state.stopActiveCameraController())return!1;this._cameraSetByUser=!0;T.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(U=>{T.positionAndOrientationOnly?
(U.eye=W.eye,U.center=W.center,U.up=W.up):U.copyFrom(W);T.applyConstraints&&y.applyAll(this.view,U)});T.applyConstraints||(this.view.state.cameraController=new K.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:W}));return!0};X._prepareFrame=function(){const {surface:W,canvas:T}=this.view;if(W&&T){this._windowDevicePixelRatio=window.devicePixelRatio;var U=this._pixelRatio,Y=Math.round(W.clientWidth*U),ba=Math.round(W.clientHeight*U);if(0!==Y&&0!==ba){if(T.width!==Y||T.height!==ba)T.width=
Y,T.height=ba;if(this.view.state){const da=this.view.state.camera;if(da.fullWidth!==Y||da.fullHeight!==ba||da.pixelRatio!==U)R.copyFrom(da),R.pixelRatio!==U&&(this._paddingToArray(this.padding,U,Q),R.padding=Q),R.fullWidth=Y,R.fullHeight=ba,R.pixelRatio=U,this.view.state.camera=R;this._updateViewState()}}}};X._updateElevation=function(W){var T=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;const U=this.view.renderCoordsHelper?.getAltitude(W.eye)??0;T=T?w.surfaceElevationBelowRenderLocation(this.view,
W.eye):0;W.relativeElevation=U-T};X._updateViewState=function(){d.isSome(this.test.renderState)?this.view.state.mode=this.test.renderState:this.view.animation?this.view.state.mode=G.RenderState.ANIMATING:this.view.interacting?this.view.state.mode=G.RenderState.INTERACTING:(this.view.state.mode===G.RenderState.ANIMATING&&(this._cameraChangeTime=0),300>=performance.now()-this._cameraChangeTime?this.view.state.mode=G.RenderState.INTERACTING:this.view.state.mode=G.RenderState.IDLE);this.view.state.rasterPixelRatio=
this._rasterPixelRatio;this.view.state.contentPixelRatio=Math.min(this._pixelRatio,this.view.qualitySettings.maximumPixelRatio)};X._cameraChangedHandler=function(W,T){W&&T&&W.almostEquals(T)||(this._cameraChangeTime=performance.now(),this._updateViewState())};c._createClass(aa,[{key:"camera",get:function(){const W=this._get("camera");if(!this.ready)return W;const T=J.internalToExternal(this.view,this.view.state.camera,S);return T&&W&&T.equals(W)?W:T.clone()},set:function(W){this._updatePropertyBeforeReady("camera",
W)||(this.view.elevationProvider?.enableElevationCache(!0),this.setStateCamera(J.externalToInternal(this.view,W),{applyConstraints:!1})||m.getLogger(this.declaredClass).error("#camera\x3d","Invalid camera",W),this.view.elevationProvider?.enableElevationCache(!1))}},{key:"contentCamera",get:function(){const W=this._get("contentCamera");if(!this.ready)return W;const T=J.internalToExternal(this.view,this.view.state.contentCamera,S);return T&&W&&T.equals(W)?W:T.clone()},set:function(W){this._updatePropertyBeforeReady("contentCamera",
W)||(W=J.externalToInternal(this.view,W),d.isNone(W)?this.view.state.contentCamera=null:(this._updateElevation(W),this.view.state.contentCamera=W))}},{key:"center",get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(W){this._updatePropertyBeforeReady("center",W)||(W?this.isCompatible(W)?this.setStateCamera(this._centerToCamera(W),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():m.getLogger(this.declaredClass).error("#center\x3d",
"Invalid center",W):m.getLogger(this.declaredClass).error("#center\x3d","Center has an incompatible spatial reference (center: "+(W.spatialReference?W.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",W):m.getLogger(this.declaredClass).error("#center\x3d","Center may not be null or undefined"))}},{key:"extent",get:function(){if(!this.ready)return this._get("extent");var W=this.view;W=J.toExtent(W,W.state.camera,W.pointsOfInterest.centerOnContent.renderLocation);return d.isSome(W)?
W:this._get("extent")},set:function(W){this._updatePropertyBeforeReady("extent",W)||(W?this.isCompatible(W)?this.setStateCamera(this._extentToCamera(W),{applyConstraints:!0})||m.getLogger(this.declaredClass).error("#extent\x3d","Invalid extent",W):m.getLogger(this.declaredClass).error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(W.spatialReference?W.spatialReference.wkid:"none")+", view: "+this.view.spatialReference?.wkid+")",W):m.getLogger(this.declaredClass).error("#extent\x3d",
"Extent may not be null or undefined"))}},{key:"frustum",get:function(){const W=this._propertiesPool.get("frustum");W.renderCoordsHelper=this.view.renderCoordsHelper;W.update(this.view.state.camera);return W}},{key:"hasInitialView",get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},{key:"scale",get:function(){if(this.ready){const W=this.view.pointsOfInterest.centerOnContent;return J.distanceToScale(this.view,W.distance,W.location.latitude)}return this._get("scale")},set:function(W){this._updatePropertyBeforeReady("scale",
W)||this.setStateCamera(this._scaleToCamera(W),{applyConstraints:!0})||m.getLogger(this.declaredClass).error("#scale\x3d","Invalid scale",W)}},{key:"padding",get:function(){if(!this.ready)return this._get("padding");var W=this.view.state.camera,T=W.padding;const U=W.pixelRatio;W=this._get("padding");const Y=Math.round(T[P.PaddingSide.TOP]/U),ba=Math.round(T[P.PaddingSide.RIGHT]/U),da=Math.round(T[P.PaddingSide.BOTTOM]/U);T=Math.round(T[P.PaddingSide.LEFT]/U);return null!=W&&W.top===Y&&W.right===ba&&
W.bottom===da&&W.left===T?W:{top:Y,right:ba,bottom:da,left:T}},set:function(W){this._updatePropertyBeforeReady("padding",W)||(this._paddingToArray(W,this.view.state.camera.pixelRatio,Q),this.view.state.updateCamera(T=>T.padding=Q))}},{key:"screenCenter",get:function(){const W=this.padding;return g.createScreenPoint((this.view.width-(W.left+W.right))/2+W.left,(this.view.height-(W.top+W.bottom))/2+W.top)}},{key:"viewpoint",get:function(){return this.ready?N.fromCamera(this.view,this.camera):this._get("viewpoint")},
set:function(W){if(!this._updatePropertyBeforeReady("viewpoint",W))if(W)if(this.isCompatible(W))this.setStateCamera(this._viewpointToCamera(W),{applyConstraints:!W.camera})||m.getLogger(this.declaredClass).error("#viewpoint\x3d","Invalid viewpoint",W);else{var T=d.isSome(W.camera)?W.camera.position:W.targetGeometry;T=d.isSome(T)&&T.spatialReference;m.getLogger(this.declaredClass).error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(T?T.wkid:"none")+", view: "+this.view.spatialReference?.wkid+
")",W)}else m.getLogger(this.declaredClass).error("#viewpoint\x3d","Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?J.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(W){this._updatePropertyBeforeReady("zoom",W)||void 0===W||this.setStateCamera(this._zoomToCamera(W),{applyConstraints:!0})||m.getLogger(this.declaredClass).error("#zoom\x3d","Invalid zoom",W)}},{key:"_pixelRatio",get:function(){return d.isSome(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:
this._usePhysicalPixelRendering?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view?.qualitySettings.maximumPixelRatio)}},{key:"_rasterPixelRatio",get:function(){return d.isSome(this._devicePixelRatioOverride)?this._devicePixelRatioOverride:this._usePhysicalPixelRenderingAny?this._windowDevicePixelRatio:Math.min(this._windowDevicePixelRatio,this.view.qualitySettings.maximumPixelRatio)}},{key:"_usePhysicalPixelRendering",get:function(){return this.view?._stage?.renderer.isFeatureEnabled(I.RenderFeature.PhysicalPixelRendering)??
!1}},{key:"_usePhysicalPixelRenderingAny",get:function(){const W=this.view?._stage?.renderer;return W&&(W.isFeatureEnabled(I.RenderFeature.PhysicalPixelRendering,G.RenderState.IDLE)||W.isFeatureEnabled(I.RenderFeature.PhysicalPixelRendering,G.RenderState.INTERACTING)||W.isFeatureEnabled(I.RenderFeature.PhysicalPixelRendering,G.RenderState.ANIMATING))}}]);return aa}(r);b.__decorate([h.property({type:t,dependsOn:["view.state.camera","ready"]})],a.ViewStateManager.prototype,"camera",null);b.__decorate([h.property({type:t,
dependsOn:["view.state.contentCamera","ready"]})],a.ViewStateManager.prototype,"contentCamera",null);b.__decorate([h.property({type:A})],a.ViewStateManager.prototype,"center",null);b.__decorate([h.property({type:B})],a.ViewStateManager.prototype,"extent",null);b.__decorate([h.property({readOnly:!0})],a.ViewStateManager.prototype,"frustum",null);b.__decorate([h.property({readOnly:!0})],a.ViewStateManager.prototype,"hasInitialView",null);b.__decorate([h.property({readOnly:!0,type:Boolean})],a.ViewStateManager.prototype,
"ready",void 0);b.__decorate([h.property({type:Number})],a.ViewStateManager.prototype,"scale",null);b.__decorate([h.property()],a.ViewStateManager.prototype,"padding",null);b.__decorate([h.property({readOnly:!0})],a.ViewStateManager.prototype,"screenCenter",null);b.__decorate([h.property({constructOnly:!0})],a.ViewStateManager.prototype,"view",void 0);b.__decorate([h.property({type:n})],a.ViewStateManager.prototype,"viewpoint",null);b.__decorate([h.property({type:Number})],a.ViewStateManager.prototype,
"zoom",null);b.__decorate([h.property({readOnly:!0})],a.ViewStateManager.prototype,"_pixelRatio",null);b.__decorate([h.property({readOnly:!0})],a.ViewStateManager.prototype,"_rasterPixelRatio",null);b.__decorate([h.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRendering",null);b.__decorate([h.property({readOnly:!0})],a.ViewStateManager.prototype,"_usePhysicalPixelRenderingAny",null);b.__decorate([h.property()],a.ViewStateManager.prototype,"_windowDevicePixelRatio",void 0);
b.__decorate([h.property()],a.ViewStateManager.prototype,"_devicePixelRatioOverride",void 0);a.ViewStateManager=b.__decorate([q.subclass("esri.views.3d.state.ViewStateManager")],a.ViewStateManager);const H="camera viewpoint extent scale center zoom".split(" "),L=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",
overrides:[]},{propertyName:"padding",overrides:[]}],O={heading:0,tilt:0},S=new t,R=new P.Camera,Q=C.create();a.INTERACTING_TIMEOUT=100;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/ConstraintTypes ../camera/constraintUtils/InteractionType ../camera/constraintUtils/TiltMode ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){a.ConstraintsManager=function(B){function A(u){var y=B.call(this,u)||this;y.nearFarHeuristic=z.createNearFarHeuristic(u.view.state.viewingMode,u.view.basemapTerrain,u.view.renderCoordsHelper.spatialReference);return y}c._inheritsLoose(A,B);var x=A.prototype;x.initialize=function(){this.addHandles([m.watch(()=>[this.view.constraints?.clipDistance?.near,this.view.constraints?.clipDistance?.far],()=>this._clipDistanceNearFarChanged()),m.watch(()=>this.view.constraints?.clipDistance?.mode,
()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",u=>this._updateCameraNearFar(u)),m.watch(()=>this.view.renderDataExtent,()=>this._updateNearFar(),m.sync),m.watch(()=>[this.view.constraints?.altitude?.min,this.view.constraints?.altitude?.max],()=>this._updateAltitude(),m.sync),m.watch(()=>this.view.constraints?.tilt?.max,()=>this._updateTiltMax(),m.sync),m.watch(()=>this.view.constraints?.tilt?.mode,()=>this._updateTilt(),m.sync),m.watch(()=>this.view.state?.camera,()=>
this._updateTiltAutoMax(),m.sync),m.watch(()=>[this.view.map?.ground?.navigationConstraint?.type,this.view.state?.constraints?.collision?.enabled],()=>this._updateCollision(),m.sync)]);this.view.state.isLocal&&this.addHandles(m.watch(()=>this.view.renderDataExtent,u=>this._updateLocalSurfaceDistance(u),m.initial));this._updateNearFar();this.view.state.viewingMode!==h.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",new C.SurfaceCollisionConstraint({view:this.view}))};
x.destroy=function(){this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};x._clipDistanceNearFarChanged=function(){const u=this.view.constraints?.clipDistance;u&&"auto"!==u.mode&&this.view.state.updateCamera(y=>this._updateCameraNearFarManual(y,u))};x._updateNearFar=function(){this.view.state.updateCamera(u=>this._updateCameraNearFar(u))};x._updateCameraNearFar=function(u){const y=this.view.constraints&&this.view.constraints.clipDistance;
"manual"===(y?y.mode:"auto")?this._updateCameraNearFarManual(u,y):this._updateCameraNearFarAuto(u,y)};x._updateCameraNearFarAuto=function(u,y){this.nearFarHeuristic.compute(u.eye,u.center,this.view.renderDataExtent,v.surfaceElevationBelowRenderLocation(this.view,u.eye),u);y&&y.autoUpdate(u.near,u.far)};x._updateCameraNearFarManual=function(u,y){y&&(u.near=y.near,u.far=y.far)};x._updateCollision=function(){var u=this.view.map?.ground?.navigationConstraint?.type;u=u?"stay-above"===u:!0;const y=this.view.state.constraints.collision;
u!==y.enabled&&((y.enabled=u)&&this._reapplyConstraints(q.ConstraintTypes.COLLISION),(u=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==u.mode||this._updateTiltAuto())};x._updateAltitude=function(){const u=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=u&&this.view.state.viewingMode!==h.ViewingMode.Local?{min:u.min,max:u.max}:null;this._reapplyConstraints()};x._updateTiltMax=function(){const u=this.view.constraints&&this.view.constraints.tilt;
u&&"auto"!==u.mode&&(this._updateTiltManual(u),this._reapplyConstraints())};x._updateTilt=function(){const u=this.view.constraints&&this.view.constraints.tilt;"manual"===(u?u.mode:"auto")?this._updateTiltManual(u):this._updateTiltAuto();this._reapplyConstraints()};x._updateTiltManual=function(u){const y=this.view.state.constraints;y.tilt=y.createConstantMaxTilt(n.deg2rad(u.max))};x._updateTiltAuto=function(){const u=this.view.state.constraints;u.tilt=u.createDefaultTilt();this._updateTiltAutoMax()};
x._updateTiltAutoMax=function(){const u=this.view.constraints&&this.view.constraints.tilt;if(u&&"auto"===u.mode){var y=this.view.state.constraints;y.tilt&&(y=y.tilt(this.view.state.camera.distance).max,u.autoUpdate(n.rad2deg(y)))}};x._updateLocalSurfaceDistance=function(u){if(!r.isNone(u)){var y=Math.max(u.width,u.height);0>=y||(null!=u.zmax&&null!=u.zmin&&(y=Math.max(y,u.zmax-u.zmin)),u=this.view.state,y=3*y/Math.atan(u.camera.fov/2),y!==u.constraints.distance&&(u.constraints.distance=y))}};x._reapplyConstraints=
function(u=q.ConstraintTypes.ALL){this.view.state.updateCamera(y=>l.applyAll(this.view,y,{selection:u,interactionType:k.InteractionType.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:p.TiltMode.TUMBLE}))};return A}(t);b.__decorate([d.property({constructOnly:!0})],a.ConstraintsManager.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=b.__decorate([g.subclass("esri.views.3d.state.ConstraintsManager")],
a.ConstraintsManager);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Extent ../../ViewingMode ../environment/atmosphereUtils".split(" "),function(a,c,b,t,n,r,m,d,f,e){function g(k,p,z,C){z=2/z;k/p>z?(C.far=k,C.near=C.far/p):(C.near=z,C.far=C.near*p);return C}
let h=function(){function k(p,z){this._elevationProvider=p;this._referenceEllipsoid=m.getReferenceEllipsoid(z);this._unitInMeters=t.getMetersPerUnitForSR(z,this._referenceEllipsoid.metersPerDegree)}k.prototype.compute=function(p,z,C,B,A){A||(A={near:0,far:0});var x=p[2]*this._unitInMeters,u=x;B=x-B;var y=this._elevationProvider?.visibleElevationBounds;y&&(x=0<=B?u-this._unitInMeters*y.min:this._unitInMeters*y.max-u);C=b.isSome(C)?C:new d({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});u=Math.max(C.xmax-
C.xmin,C.ymax-C.ymin,4*Math.max(C.xmax-C.xmin,C.ymax-C.ymin));n.subtract(q,z,p);v[0]=0<q[0]?C.xmax:C.xmin;v[1]=0<q[1]?C.ymax:C.ymin;v[2]=0<q[2]?u/2:-u/2;n.subtract(v,v,p);n.normalize(q,q);p=1.1*n.dot(v,q)*this._unitInMeters;z=Math.sqrt(x*(x+2*this._referenceEllipsoid.radius));C=Math.max(C.xmax-C.xmin,C.ymax-C.ymin);y=1E-4*C*this._unitInMeters;x=c.clamp((x-y)/(.001*C*this._unitInMeters-y),0,1);x=Math.min(c.lerp(z,p,x**3),z)*Math.max(Math.log(Math.abs(B)),1);return g(Math.min(x,Math.max(34064E4,u))/
this._unitInMeters,2E4,this._unitInMeters,A)};return k}(),l=function(){function k(p){this._referenceEllipsoid=m.getReferenceEllipsoid(p)}k.prototype.compute=function(p,z,C,B,A){A||(A={near:0,far:0});p=n.length(p);z=p-this._referenceEllipsoid.radius;z=Math.max(Math.abs(z-B),Math.abs(z));B=1.2*c.lerp(Math.sqrt(z*(z+2*(this._referenceEllipsoid.radius+Math.min(0,B)))),p+this._referenceEllipsoid.radius,e.computeInnerAltitudeFade(z));p=c.clamp(2E4-(Math.log(z)-7.983)/9.011*19E3,1E3,2E4);return g(B,p,1,
A)};return k}();const v=r.create(),q=r.create();a.createNearFarHeuristic=function(k,p,z){return k===f.ViewingMode.Global?new l(z):new h(p,z)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){a.SurfaceCollisionConstraint=function(h){function l(q){return h.call(this,q)||this}c._inheritsLoose(l,h);var v=l.prototype;v.initialize=function(){this.addHandles(this.view.basemapTerrain.on("elevation-change",q=>this._handleElevationChangeEvent(q)))};v._handleElevationChangeEvent=function(q){if(!this.view.state.cameraController){var k=this.view.state.camera;n.isSome(q.spatialReference)&&e.eyeWithinExtent(this.view,k,q.extent,q.spatialReference)&&this._applyToCurrentCamera()}};
v._applyToCurrentCamera=function(){this.view.state.updateCamera(q=>g.applySurfaceCollisionConstraint(this.view,q,g.Mode.EYE_AND_CENTER))};return l}(t);b.__decorate([r.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=b.__decorate([f.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/Frustum":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/frustum"],function(a,c,b,t,n){function r(d,f,e){d.origin=f;d.endpoint=e;b.direction(d.direction,f,e)}let m=function(){function d(e){this.renderCoordsHelper=e;this.frustum=n.create();this._points=n.createPoints();this.lines=Array(12);this._origin=t.create();this._direction=t.create();this._altitude=null;for(e=0;12>e;e++)this.lines[e]={origin:null,direction:t.create(),endpoint:null}}
var f=d.prototype;f.update=function(e){n.fromMatrix(e.viewMatrix,e.projectionMatrix,this.frustum,this._points);b.copy(this._origin,e.eye);b.copy(this._direction,e.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()};f.updatePoints=function(e){for(let g=0;g<this._points.length;g++)b.copy(this._points[g],e[g]);n.computePlanes(this.frustum,this._points);this._updateLines()};f.intersectsSphere=function(e){return n.intersectsSphere(this.frustum,e)};f.intersectsRay=
function(e){return n.intersectsRay(this.frustum,e)};f.intersectsLineSegment=function(e,g){return n.intersectsLineSegment(this.frustum,e,g)};f.intersectsPoint=function(e){return n.intersectsPoint(this.frustum,e)};f._updateLines=function(){const e=this._points;for(let g=0;4>g;g++){const h=g+4;r(this.lines[g],e[g],e[h]);r(this.lines[g+4],e[g],3===g?e[0]:e[g+1]);r(this.lines[g+8],e[h],3===g?e[4]:e[h+1])}};c._createClass(d,[{key:"planes",get:function(){return this.frustum}},{key:"points",get:function(){return this._points}},
{key:"mutablePoints",get:function(){return this._points}},{key:"direction",get:function(){return this._direction}},{key:"altitude",get:function(){return this._altitude}}]);return d}();m.planePointIndices=n.planePointIndices;m.nearFarLineIndices=[[n.PointIndex.NEAR_BOTTOM_LEFT,n.PointIndex.FAR_BOTTOM_LEFT],[n.PointIndex.NEAR_BOTTOM_RIGHT,n.PointIndex.FAR_BOTTOM_RIGHT],[n.PointIndex.NEAR_TOP_RIGHT,n.PointIndex.FAR_TOP_RIGHT],[n.PointIndex.NEAR_TOP_LEFT,n.PointIndex.FAR_TOP_LEFT]];a.Frustum=m;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/GoToOperation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../camera/constraintUtils ../camera/constraintUtils/surfaceCollision ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){let k=function(){function p(C,B,A){this.target=C;this.options=B;this.view=A;this.state="pending";this._animationController=null;this._promise=new Promise((x,u)=>{this._resolveCallback=x;this._rejectCallback=u;x=new AbortController;if(r.isSome(this.options.signal))m.onAbort(this.options.signal,()=>{this.abort()});this._abortController=x;this.waitForReady()})}var z=p.prototype;z.then=function(C,B){return this._promise.then(C,B)};z.catch=function(C){return this._promise.catch(C)};
z.resolve=function(C){if("finished"!==this.state)return this.state="finished",this._resolveCallback(C)};z.reject=function(C){if("finished"!==this.state)return this.state="finished",this._rejectCallback(C)};z.abort=function(C=!1){this._abortController.abort();switch(this.state){case "wait-for-animation-finish":!C&&r.isSome(this._animationController)&&this.view.state.cameraController===this._animationController&&this._animationController.active&&this._animationController.stopController()}this.reject(m.createAbortError())};
z.waitForReady=function(){var C=c._asyncToGenerator(function*(){this.state="wait-for-ready";if(!this.view.ready)try{yield d.whenOnce(()=>this.view.ready,this._abortController.signal)}catch(B){return this.reject(B)}this.createViewPoint()});return function(){return C.apply(this,arguments)}}();z.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this._animationController=this.options.animate?this._getAnimationController():null,q.create(this.view,this.target,this._abortController.signal).then(C=>
{"finished"!==this.state&&(C=C?this._getCameraFromViewpoint(C):null,r.isNone(C)||(this.options.animate?r.isNone(this._animationController)||this.startAnimation(C,this._animationController):(this.view.stateManager.setStateCamera(C.camera,{applyConstraints:!C.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},C=>{this.reject(C)}))};z._getCameraFromViewpoint=function(C){const B=!!(this.target instanceof t&&this.target.camera||this.target instanceof b);var A=
C.camera;if(r.isNone(A))return null;if(!this.view.stateManager.isCompatible(A))return C=(C=A.position)&&C.spatialReference,this.reject(new n("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${C?C.wkid:"none"}, view: ${this.view.spatialReference?.wkid})`,{camera:A})),null;A=v.externalToInternal(this.view,A);return r.isNone(A)?(this.reject(new n("GotoAnimation:invalid-camera","Resulting camera is invalid")),null):{viewpoint:C,camera:A,isFullySpecified:B}};
z.startAnimation=function(C,B){this.state="wait-for-animation-finish";const A=B.viewAnimation;if(r.isNone(A))this.reject(new n("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{A.update(C.viewpoint,"running");if(!B.active||r.isNone(B.viewAnimation)||B.viewAnimation.target!==C.viewpoint||this.view.state.cameraController!==B)return this.abort();if(C.isFullySpecified){var x=new l.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:C.camera});e.applySurfaceCollisionConstraint(this.view,
C.camera,e.Mode.EYE_AND_CENTER)}else f.applyAll(this.view,C.camera);B.begin(C.camera,this.options);var u=y=>{if(!r.isNone(this.view.state))switch(B.state){case g.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case g.State.Ready:case g.State.Rejected:case g.State.Running:case g.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(y)}}};
A.when(()=>{const y=this.view.state.cameraController;x&&(y&&y.active?y instanceof h.PointToPointAnimationController&&r.isSome(y.viewAnimation)&&y.viewAnimation.target===C.viewpoint&&(this.view.state.cameraController=x):r.isSome(B.viewAnimation)&&B.viewAnimation.target===C.viewpoint&&"finished"===B.state&&(this.view.state.cameraController=x))},y=>u(y));B.asyncResult={resolve:()=>u(),reject:y=>u(y)}}};z._getAnimationController=function(){let C=null;var B=null;B=this.view.state.cameraController;B instanceof
h.PointToPointAnimationController&&(B.updateStateFromViewAnimation(),B.active&&(C=B,B=C.viewAnimation));return null!=C||(C=new h.PointToPointAnimationController({view:this.view,mode:"animation"}),B=C.viewAnimation,this.view.state.switchCameraController(C))?C:(r.isSome(B)&&B.stop(),this.reject(new n("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};return p}();a.GoToOperation=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../camera/intersectionUtils ../../camera/constraintUtils/surfaceCollision ./CameraController".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){a.SurfaceCollisionCorrectionController=function(l){function v(k){k=l.call(this,k)||this;k._handles=new t;return k}c._inheritsLoose(v,l);var q=v.prototype;q.onControllerStart=function(){this.state=h.State.Running;this._handles.add(this.view.basemapTerrain.on("elevation-change",k=>this._handleElevationChangeEvent(k)));this._applyCorrection()};q.onControllerEnd=function(){this._handles.removeAll()};q.stepController=function(){};q._handleElevationChangeEvent=function(k){n.isSome(k.spatialReference)&&
!e.eyeWithinExtent(this.view,this.desiredCamera,k.extent,k.spatialReference)||this._applyCorrection()};q._applyCorrection=function(){this.view.state.updateCamera(k=>{k.copyViewFrom(this.desiredCamera);g.applySurfaceCollisionConstraint(this.view,k,g.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=h.State.Stopped)})};c._createClass(v,[{key:"desiredCamera",set:function(k){this._set("desiredCamera",k.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return v}(h.CameraController);b.__decorate([r.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=b.__decorate([f.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a.SurfaceCollisionCorrectionController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../core/Cyclical ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/Point ../../../geometry/projection ../../../geometry/SpatialReference ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ../../support/spatialReferenceSupport".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A){function x(T){return"global"===T.viewingMode?z.cameraUtilsSpherical:p.cameraUtilsPlanar}function u(T,U,Y){const ba=T.state.camera,da=ba.width/2/ba.pixelRatio;T.renderCoordsHelper.viewingMode===q.ViewingMode.Global&&null!=Y&&(U*=Math.cos(r.deg2rad(Y)));U/=T.renderCoordsHelper.unitInMeters;return da/(96*39.37/U)/Math.tan(ba.fovX/2)}function y(T,U,Y){const ba=T.state.camera;U=96*39.37/(ba.width/2/ba.pixelRatio/(U*Math.tan(ba.fovX/2)));T.renderCoordsHelper.viewingMode===
q.ViewingMode.Global&&null!=Y&&(U/=Math.cos(r.deg2rad(Y)));return U*=T.renderCoordsHelper.unitInMeters}function w(T,U,Y,ba,da,ea){if(L(ea)){const ca=new W(ea.signal);P(T,ba.heading,ba.tilt,U,Y,da,ca);ca.resolver.promise.then(ja=>{ja=H(T,ja,ba.fov);if(m.isNone(ja))ea.resolver.reject();else return ea.resolver.resolve(ja)},ja=>ea.resolver.reject(ja))}else return U=P(T,ba.heading,ba.tilt,U,Y,da),H(T,U,ba.fov,ea)}function D(T,U,Y,ba,da){return x(T).directionToHeadingTilt(U,Y,ba,da)}function F(T,U){return!!(T.basemapTerrain&&
T.renderCoordsHelper.fromRenderCoords(U,Q,T.spatialReference)&&T.elevationProvider&&m.unwrapOr(B.getElevationAtPoint(T.elevationProvider,Q),0)>(Q.z??0)-1)}function E(T,U,Y){return K.apply(this,arguments)}function K(){K=c._asyncToGenerator(function*(T,U,Y){if(!T.renderCoordsHelper.fromRenderCoords(U,Q,T.spatialReference)||!T.elevationProvider)return!1;U=Q.z??0;T=yield T.elevationProvider.queryElevation(Q.x,Q.y,U,Q.spatialReference,"ground",Y);return m.unwrapOr(T,0)>U-1});return K.apply(this,arguments)}
function J(T,U,Y){return M.apply(this,arguments)}function M(){M=c._asyncToGenerator(function*(T,U,Y){const ba=e.create();U?U instanceof h?(l.projectPointToVector(U,ba,T.renderSpatialReference),null==U.z&&null!=T.basemapTerrain&&null!=T.elevationProvider&&(U=yield T.elevationProvider.queryElevation(U.x,U.y,U.z??0,U.spatialReference,"ground",Y),m.isSome(U)&&T.renderCoordsHelper.setAltitude(ba,U))):f.copy(ba,U):f.copy(ba,T.state.camera.center);return ba});return M.apply(this,arguments)}function N(T,
U){const Y=e.create();U&&U instanceof h?(l.projectPointToVector(U,Y,T.renderSpatialReference),null==U.z&&null!=T.basemapTerrain&&null!=T.elevationProvider&&(U=B.getElevationAtPoint(T.elevationProvider,U),m.isSome(U)&&T.renderCoordsHelper.setAltitude(Y,U))):U?f.copy(Y,U):f.copy(Y,T.state.camera.center);return Y}function P(T,U,Y,ba,da,ea,ca){const ja=ba&&ba instanceof h?ba:null;if(L(ca))return J(T,ba,ca.signal).then(ia=>{I(T,U,Y,ja,ia,da,ea,ca)},ia=>ca.resolver.reject(ia)),null;ba=N(T,ba);return I(T,
U,Y,ja,ba,da,ea,ca)}function I(T,U,Y,ba,da,ea,ca,ja){if(m.isNone(ba)&&(ba=l.projectVectorToPoint(da,T.renderSpatialReference,T.spatialReference||v.WGS84),m.isNone(ba)))return null;ea=Math.max(ea,T.state.constraints.minimumPoiDistance);var ia=G(T,U,Y,da,ea,ca);const Z=x(T).eyeForCenterWithHeadingTilt,ha=Z(da,ea,ia.heading,ia.tilt);if(ca===a.OrientationMode.ADJUST&&"global"===T.viewingMode&&0<Y){const fa=()=>{var ka=ea;var la=ea;var na=x(T).eyeTiltToLookAtTilt(Y,da,la);T.state.constraints.tilt&&(la=
T.state.constraints.tilt(la),na=Math.min(na,.5*Math.PI),na=la.min*(1-.7)+.7*na);ka=x(T).lookAtTiltToEyeTilt(na,da,ka);ca=1>Y-ka?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST;return I(T,U,ka,ba,da,ea,ca,ja)};ia=T.map.ground.navigationConstraint;if(!ia||"stay-above"===ia.type){if(F(T,ha.eye))return fa();if(L(ja))return E(T,ha.eye,ja.signal).then(ka=>{if(ka)return fa();ja.resolver.resolve({eye:ha.eye,up:ha.up,center:e.clone(da),heading:ha.heading,tilt:ha.tilt});return null}),null}}ia=!ja||L(ja)?
{center:e.create(),eye:e.create(),up:e.create(),tilt:0,heading:0}:ja;ia.eye=ha.eye;ia.up=ha.up;ia.center=e.clone(da);ia.heading=ha.heading;ia.tilt=ha.tilt;L(ja)&&ja.resolver.resolve(ia);return ia}function G(T,U,Y,ba,da,ea){var ca=0;if(ea=ea===a.OrientationMode.ADJUST)if(ca=T.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(da/ca)/Math.LN2)ea=!0;else{var ja=T.renderSpatialReference,ia=T.spatialReference||v.WGS84;ea=l.projectVectorToPoint(ba,ja,ia);ja=l.projectVectorToPoint(T.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
ja,ia);m.isNone(ea)||m.isNone(ja)?ea=!1:(ca*=Math.tan(.5*T.state.camera.fov),ea=5<ja.distance(ea)/ca)}ea?(U=0,Y=x(T).eyeTiltToLookAtTilt(Y,ba,da),T.state.constraints.tilt?(ea=T.state.constraints.tilt(da),ea.max=Math.min(ea.max,.5*Math.PI),ca=Math.min(Y,ea.min*(1-.7)+.7*ea.max)):ca=Y):ca=x(T).eyeTiltToLookAtTilt(Y,ba,da);Y=ca=T.state.constraints.clampTilt(da,ca);Y=x(T).lookAtTiltToEyeTilt(Y,ba,da);return{heading:U,tilt:Y}}function H(T,U,Y,ba){if(m.isNone(U))return null;T=l.projectVectorToPoint(U.eye,
T.renderSpatialReference,T.spatialReference||v.WGS84);return m.isNone(T)?null:m.isSome(ba)?(ba.position=T,ba.heading=U.heading,ba.tilt=U.tilt,ba.fov=Y,ba):new b(T,U.heading,U.tilt,Y)}function L(T){return T&&"resolver"in T}const O=n.getLogger("esri.views.3d.support.cameraUtils"),S=e.create(),R={heading:0,tilt:0},Q=new h,V=new t.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),aa=new t.Cyclical(-180,180);a.OrientationMode=void 0;(function(T){T[T.LOCKED=0]="LOCKED";T[T.ADJUST=1]="ADJUST"})(a.OrientationMode||
(a.OrientationMode={}));const X=e.create();let W=function(T){this.signal=T;this.resolver=d.createResolver()};a.AsyncContext=W;a.computeScale=function(T,U){l.projectVectorToVector(U.center,T.renderSpatialReference,S,v.WGS84);return y(T,U.distance,S[1])};a.directionToHeadingTilt=D;a.distanceToScale=y;a.externalToInternal=function(T,U){if(m.isNone(U))return null;var Y=T.renderSpatialReference;const ba=x(T).headingTiltToDirectionUp,da=e.create();if(!l.projectPointToVector(U.position,da,Y))return null;
Y=ba(da,U.heading,U.tilt);f.scale(Y.direction,Y.direction,T.state.camera.distance);f.add(Y.direction,Y.direction,da);T=k.cameraOnContentAlongViewDirection(T,da,Y.direction,Y.up);T.fov=r.deg2rad(U.fov);return T};a.fromCenterDistance=w;a.fromCenterScale=function(T,U,Y,ba,da,ea){Y=u(T,Y,U.latitude);return w(T,U,Y,ba,da,ea)};a.fromExtent=function(T,U,Y,ba,da,ea=null){if(T.state.isGlobal){if(!A.isSpatialReferenceSupported(U.spatialReference,q.ViewingMode.Global))return L(ea)&&ea.resolver.reject(),null;
var ca=new h(U.xmin,U.ymin,U.spatialReference);const ha=new h(U.xmax,U.ymax,U.spatialReference),fa=U.spatialReference.isGeographic?aa:V;var ja=new h({x:fa.center(ca.x,ha.x),y:(ha.y+ca.y)/2,z:null!=U.zmax&&null!=U.zmin?(U.zmax+U.zmin)/2:void 0,spatialReference:U.spatialReference});const ka=g.getReferenceEllipsoid(U.spatialReference);var ia=C.getGreatCircleSpanAt(ja,ca,ha);var Z=ia.lon;ia=ia.lat;fa.diff(ca.x,ha.x)>fa.range/2&&(Z+=ka.halfCircumference);Z=Math.min(Z,ka.halfCircumference);ia=Math.min(ia,
ka.halfCircumference)}else ja=m.unwrapOr(T.renderSpatialReference,U.spatialReference),ja.equals(U.spatialReference)||(U=l.project(U,ja)),Z=U.xmax-U.xmin,ia=U.ymax-U.ymin,ja=new h({x:U.xmin+.5*Z,y:U.ymin+.5*ia,z:null!=U.zmax&&null!=U.zmin?(U.zmax+U.zmin)/2:void 0,spatialReference:ja});ca=T.state.camera;U=Math.max(1/Math.tan(ca.fovX/2)*Z*.5,1/Math.tan(ca.fovY/2)*ia*.5,1/Math.tan(ca.fov/2)*(null!=U.zmax&&null!=U.zmin?U.zmax-U.zmin:0)*.5)/1;if(L(ea))Z=new W(ea.signal),P(T,Y,ba,ja,U,da,Z),Z.resolver.promise.then(ha=>
{ha=H(T,ha,T.camera.fov);if(m.isNone(ha))ea.resolver.reject();else return ea.resolver.resolve(ha)},ha=>ea.resolver.reject(ha));else return Y=P(T,Y,ba,ja,U,da),H(T,Y,T.camera.fov,ea)};a.getObserverForPointAtDistance=P;a.headingTiltToDirectionUp=function(T,U,Y,ba,da){return x(T).headingTiltToDirectionUp(U,Y,ba,da)};a.internalToExternal=function(T,U,Y){const ba=T.renderSpatialReference,da=D(T,U.eye,U.viewForward,U.up,R);T=T.spatialReference||v.WGS84;l.projectVectorToVector(U.eye,ba,X,T)||(T=v.WGS84,
l.projectVectorToVector(U.eye,ba,X,T));if(m.isNone(Y))return new b(new h(X,T),da.heading,da.tilt,r.rad2deg(U.fov));Y.position.x=X[0];Y.position.y=X[1];Y.position.z=X[2];Y.position.spatialReference=T;Y.heading=da.heading;Y.tilt=da.tilt;Y.fov=r.rad2deg(U.fov);return Y};a.observerToCamera=H;a.scaleToDistance=u;a.scaleToZoom=function(T,U){if(T=T.basemapTerrain?.tilingScheme)return T.levelAtScale(U);O.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(T,
U,Y){const ba=l.projectVectorToPoint(Y,T.renderSpatialReference,T.spatialReference||v.WGS84);if(m.isNone(ba))return null;var da=Math.tan(U.fovX/2),ea=Math.tan(U.fovY/2);U=f.dist(U.eye,Y);da*=2*U;ea*=2*U;return"global"===T.viewingMode?z.toExtent(T,ba,da,ea):p.toExtent(T,ba,da,ea)};a.zoomToScale=function(T,U){if(T=T.basemapTerrain?.tilingScheme)return T.scaleAtLevel(U);O.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection ../views/3d/support/cameraUtilsInternal".split(" "),function(a,c,b,t,n,r,m,d,f){function e(A,x,u,y=f.createDirectionUp()){const {direction:w,up:D}=y;b.fromZRotation(z,-c.deg2rad(x));b.rotateX(z,z,c.deg2rad(u));n.transformMat4(w,p,z);n.scale(w,w,-1);n.transformMat4(D,k,z);return y}function g(A,x,u,y){return f.directionToHeadingTilt(x,u,y,p,k)}function h(A,
x,u,y){const w=e(A,u,y),D=r.create();n.scale(D,w.direction,-x);n.add(D,D,A);return{up:w.up,eye:D,heading:u,tilt:y}}function l(A){return c.rad2deg(A)}function v(A){return c.deg2rad(A)}function q(A,x,u,y,w){const D=A.renderSpatialReference;A=A.map&&A.spatialReference||x.spatialReference;d.projectPointToVector(x,C,D);d.projectPointToVector(x,B,D);C[0]-=u/2;B[0]+=u/2;C[1]-=y/2;B[1]+=y/2;d.projectVectorToVector(C,D,C,A);d.projectVectorToVector(B,D,B,A);w?(w.xmin=C[0],w.ymin=C[1],w.xmax=B[0],w.ymax=B[1],
w.spatialReference=A):w=new m(C[0],C[1],B[0],B[1],A);return w}const k=r.fromValues(0,1,0),p=r.fromValues(0,0,1),z=t.create(),C=r.create(),B=r.create();t=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:g,eyeForCenterWithHeadingTilt:h,eyeTiltToLookAtTilt:v,headingTiltToDirectionUp:e,lookAtTiltToEyeTilt:l,toExtent:q},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsPlanar=t;a.directionToHeadingTilt=g;a.eyeForCenterWithHeadingTilt=h;a.eyeTiltToLookAtTilt=v;a.headingTiltToDirectionUp=
e;a.lookAtTiltToEyeTilt=l;a.toExtent=q})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,c,b,t){const n=t.create(),r=t.create();a.createDirectionUp=function(){return{direction:t.create(),up:t.create()}};a.directionToHeadingTilt=function(m,d,f,e,g){let h=b.normalize(n,m),l=b.dot(h,e);const v=0<l;l=Math.abs(l);.99<l&&(l=Math.abs(b.dot(d,e)),.99>l?(b.copy(h,d),v&&b.scale(h,h,-1)):h=null);
d=0;h&&(b.scale(r,e,b.dot(e,h)),b.subtract(h,h,r),d=b.dot(h,g)/(b.length(h)*b.length(g)),b.cross(r,h,g),d=(0<b.dot(r,e)?1:-1)*c.rad2deg(c.acosClamped(d)));m=c.rad2deg(c.acosClamped(-b.dot(e,m)/b.length(m)));if(!f)return{heading:d,tilt:m};f.heading=d;f.tilt=m;return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/Cyclical ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/ellipsoidUtils ../geometry/Extent ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){function v(E,K,J,M=h.createDirectionUp()){r.cross(D,E,x);0===r.dot(D,D)&&r.cross(D,E,u);t.fromRotation(w,-b.deg2rad(K),E);t.rotate(w,w,-b.deg2rad(J),D);const {up:N,direction:P}=M;r.cross(N,D,E);r.normalize(N,N);r.transformMat4(N,N,w);r.normalize(P,E);r.negate(P,P);r.transformMat4(P,P,w);return M}function q(E,K,J,M){const N=D,P=F;r.normalize(N,E);r.cross(F,N,x);0===r.dot(F,F)&&r.cross(F,N,u);r.cross(P,F,N);return h.directionToHeadingTilt(K,J,M,N,P)}function k(E,
K,J,M){const N={eye:m.create(),up:null,tilt:M,heading:J},P=D;P[0]=E[0];P[1]=E[2];P[2]=-E[1];J=b.deg2rad(J);var I=b.deg2rad(M);M=Math.sin(J);J=Math.cos(J);var G=Math.sin(I),H=Math.cos(I);const L=r.length(P);if(1E-8>Math.abs(I))I=K+L;else{var O=L/G,S=b.asinClamped(K/O);I=O*Math.sin(Math.PI-I-S)}H*=K;O=K*K*G*G;S=J*J*O;const R=I-H,Q=R*R;var V=S*(S+Q-P[1]*P[1]);if(0>V)return r.scale(N.eye,P,I/L),N.tilt=0,z(N,E);var aa=Math.sqrt(V);const X=P[1]*R;V=S+Q;aa=0<J?-aa+X:aa+X;if(1E-8>Math.abs(V))return 1E-8>
L?(N.eye[0]=0,N.eye[1]=0,N.eye[2]=K):r.scale(N.eye,P,I/L),N.tilt=0,p(N.eye),z(N,E);N.eye[1]=aa/V;K*=G;aa=N.eye[1]*N.eye[1];G=1-aa;V=Math.sqrt(G);O=S*aa+M*M*O-2*J*K*N.eye[1]*V*R+G*Q;if(1E-8>Math.abs(O))return r.scale(N.eye,P,I/L),N.tilt=0,p(N.eye),z(N,E);N.eye[0]=(G*(I*P[0]-H*P[0])-K*V*(P[0]*N.eye[1]*J+P[2]*M))/O;N.eye[2]=(G*(I*P[2]-H*P[2])-K*V*(P[2]*N.eye[1]*J-P[0]*M))/O;r.scale(N.eye,N.eye,I);p(N.eye);return z(N,E)}function p(E){const K=E[1];E[1]=-E[2];E[2]=K}function z(E,K){K=v(K,E.heading,E.tilt);
E.up=K.up;return E}function C(E,K,J){K=r.length(K);J=b.asinClamped(J/(Math.sqrt(J*J+K*K-2*J*K*Math.cos(Math.PI-E))/Math.sin(E)));return b.rad2deg(E-J)}function B(E,K,J){E=b.deg2rad(E);K=r.length(K);return b.asinClamped(J/(K/Math.sin(E)))+E}function A(E,K,J,M,N){function P(L){const O=Math.PI/2;L=c.cyclical2PI.normalize(L,-O);L>O&&(L=Math.PI-L);return L}var I=K.latitude;var G=d.getReferenceEllipsoid(E.spatialReference).radius;K=K.longitude;var H=l.getLonDeltaForDistance(I,J,G)/2;J=K-H;K+=H;I=b.deg2rad(I);
I=(1+Math.sin(I))/(1-Math.sin(I));H=(I+1)*Math.tan(M/G/2);I=1.5*Math.PI-2*Math.atan(.5*(H+Math.sqrt(4*I+H*H)));M=I+M/G;I=P(I);M=P(M);M<I&&(G=M,M=I,I=G);I=Math.max(b.rad2deg(I),-90);M=Math.min(b.rad2deg(M),90);K=y.monotonic(J,K);180<K-J&&(G=(K-J-180)/2,J+=G,K-=G);G=E.spatialReference&&E.spatialReference.isGeographic?E.spatialReference:e.WGS84;N?(N.xmin=J,N.ymin=I,N.xmax=K,N.ymax=M,N.spatialReference=G):N=new f(J,I,K,M,G);E.spatialReference&&E.spatialReference.isWebMercator&&g.geographicToWebMercator(N,
!1,N);return N}const x=m.fromValues(0,0,1),u=r.normalize(m.create(),m.fromValues(1,1,1)),y=new c.Cyclical(-180,180),w=n.create(),D=m.create(),F=m.create();n=Object.freeze(Object.defineProperty({__proto__:null,directionToHeadingTilt:q,eyeForCenterWithHeadingTilt:k,eyeTiltToLookAtTilt:B,headingTiltToDirectionUp:v,lookAtTiltToEyeTilt:C,toExtent:A},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsSpherical=n;a.directionToHeadingTilt=q;a.eyeForCenterWithHeadingTilt=k;a.eyeTiltToLookAtTilt=B;a.headingTiltToDirectionUp=
v;a.lookAtTiltToEyeTilt=C;a.toExtent=A})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../core/maybe","../../../layers/graphics/dehydratedFeatureUtils"],function(a,c,b){function t(n){return"array"in n}a.SamplePosition=function(n,r=null,m=0){this.array=n;this.spatialReference=r;this.offset=m};a.getElevationAtPoint=function(n,r,m="ground"){if(b.isDehydratedPoint(r))return n.getElevation(r.x,r.y,r.z||0,r.spatialReference,m);if(t(r)){let d=r.offset;return n.getElevation(r.array[d++],
r.array[d++],r.array[d]||0,c.unwrapOr(r.spatialReference,n.spatialReference),m)}return n.getElevation(r[0],r[1],r[2]||0,n.spatialReference,m)};a.isSamplePosition=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(c){return"point"===c.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports",
"../../geometry/support/SupportedGCSWkids","../ViewingMode"],function(a,c,b){a.isSpatialReferenceSupported=function(t,n){return null==t?!1:null==n?!0:n===b.ViewingMode.Local?t.isGeographic?t.isWGS84||t.wkid===c.SupportedGCSWkids.CGCS2000:!0:t.isWebMercator||t.isWGS84||t.wkid===c.SupportedGCSWkids.CGCS2000||t.wkid===c.SupportedGCSWkids.GCSMARS2000||t.wkid===c.SupportedGCSWkids.GCSMARS2000_SPHERE||t.wkid===c.SupportedGCSWkids.GCSMOON2000};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Cyclical ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/scaleUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Geometry".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J){function M(oa){return 360-f.cyclicalDegrees.normalize(oa)}function N(oa){return f.cyclicalDegrees.normalize(360-oa)}function P(oa){g.isSome(oa)&&oa.resolver&&oa.resolver.reject();return null}function I(oa,xa,Ea,Ia=null){if(!xa)return P(Ia);var Na=oa.spatialReference||E.WGS84;if(g.isSome(xa.camera)){oa=u.project(xa.camera.position,Na);if(g.isNone(oa))return P(Ia);xa=xa.camera.clone();xa.position=oa;oa=xa;g.isSome(Ia)&&Ia.resolver&&
Ia.resolver.resolve(oa);return oa}if(g.isNone(xa.targetGeometry))return P(Ia);var Oa=xa.get("targetGeometry.spatialReference");if(Oa&&!u.canProject(Oa,Na))return P(Ia);Na=w.internalToExternal(oa,oa.state.camera);Oa=w.OrientationMode.ADJUST;null!=xa.rotation&&(Na.heading=M(xa.rotation),Oa=w.OrientationMode.LOCKED);null!=Ea&&(Na.tilt=Ea);if("point"===xa.targetGeometry.type){const Ja=xa.targetGeometry;Ea=xa.targetGeometry.clone();xa=null!=xa.scale?w.scaleToDistance(oa,xa.scale,Ja.latitude):oa.state.camera.distance;
return w.fromCenterDistance(oa,Ea,xa,Na,Oa,Ia)}return(xa=xa.targetGeometry.extent)?w.fromExtent(oa,xa,Na.heading,Na.tilt,Oa,Ia):P(Ia)}function G(){G=c._asyncToGenerator(function*(oa,xa,Ea){if(xa&&oa.spatialReference){var Ia={target:void 0};if("declaredClass"in xa||Array.isArray(xa))Ia.target=xa;else{for(var Na in xa)Ia[Na]=xa[Na];xa.center&&!Ia.target&&(Ia.target=xa.center)}xa=Ia}else xa=null;if(!xa)throw new e("viewpointutils-create:no-target","Missing target for creating viewpoint");Ia=new b({fov:oa.camera.fov});
Na=new r({camera:Ia});if(xa.target instanceof r)return oa=yield X(oa,xa.target,xa,Ea,Na),Z(oa);if(xa.target instanceof b)return Z(T(oa,xa.target,Na));var Oa=null!=xa.scale||null!=xa.zoom;if(xa.target instanceof K){var Ja=xa.target.xmin===xa.target.xmax||xa.target.ymin===xa.target.ymax;return Oa||Ja?Z(yield U(oa,xa,xa.target.center,Ia,Ea,Na)):Z(yield ea(oa,xa,xa.target,Ia,Ea,Na))}Ja={boundingBox:C.empty(),hasZ:!1,screenSpaceObjects:[]};var Sa=Oa?(Sa=H(oa,xa))?x.getResolutionInMetersForScale(Sa):void 0:
void 0;yield V(oa,xa.target,Sa,Ja);if(isFinite(Ja.boundingBox[0])){C.center(Ja.boundingBox,ha);sa.x=ha[0];sa.y=ha[1];sa.z=ha[2];sa.spatialReference=oa.spatialReference;isFinite(sa.z)&&Ja.hasZ?Sa=C.isPoint(Ja.boundingBox):(sa.z=void 0,Sa=B.isPoint(C.toRect(Ja.boundingBox,na)));if(Oa||Sa)return Z(yield U(oa,xa,sa,Ia,Ea,Na));Oa=Ja.screenSpaceObjects;if(Oa.length){Sa=Number.NEGATIVE_INFINITY;for(let Ua=0;Ua<Oa.length;Ua++){const Za=Oa[Ua].screenSpaceBoundingRect;Sa=Math.max(Sa,Math.abs(Za[0]),Math.abs(Za[1]),
Math.abs(Za[2]),Math.abs(Za[3]))}Oa=.66-Sa/Math.min(oa.width,oa.height)*2}else Oa=.66;return Z(yield ja(oa,xa,sa,Ja.boundingBox,Oa,Ia,Ea,Na))}return xa.position?(Ea=y.cameraOnContentAlongViewDirection(oa),k.copy(pa,Ea.viewForward),w.directionToHeadingTilt(oa,Ea.eye,pa,Ea.up,za),Ia.position=new F(xa.position),Ia.heading=null!=xa.heading?xa.heading:za.heading,Ia.tilt=null!=xa.tilt?xa.tilt:za.tilt,oa=O(oa,null,Ia,Na),Z(oa)):Z(yield ba(oa,xa,Ia,Ea,Na))});return G.apply(this,arguments)}function H(oa,xa){return null==
xa.scale&&null!=xa.zoom?w.zoomToScale(oa,xa.zoom):xa.scale}function L(oa,xa){let Ea=!1;null!=xa.heading?(oa.heading=xa.heading,Ea=!0):null!=xa.rotation&&(oa.heading=M(xa.rotation),Ea=!0);null!=xa.tilt&&(oa.tilt=xa.tilt,Ea=!0);null!=xa.fov&&(oa.fov=xa.fov);return Ea}function O(oa,xa,Ea,Ia){const Na=oa.spatialReference||E.WGS84;xa=g.isSome(xa)?xa:w.externalToInternal(oa,Ea);if(g.isNone(xa))return Ia;Ia.targetGeometry=z.projectVectorToPoint(xa.center,oa.renderSpatialReference,Na);Ia.scale=w.computeScale(oa,
xa);Ia.rotation=N(Ea.heading);Ia.camera=Ea;return Ia}function S(oa,xa,Ea){var Ia=()=>new e("viewpointutils:invalid-geometry","The target is missing a valid geometry");if(!xa)throw Ia();if(!u.canProject(xa.spatialReference,oa.spatialReference))throw new e("viewpointutils:incompatible-spatialreference",`Spatial reference (${xa.spatialReference?xa.spatialReference.wkid:"unknown"}) is incompatible with the view (${oa.spatialReference?.wkid})`,{geometry:xa});const Na=[];if(!xa.hasZ&&oa.basemapTerrain){switch(xa.type){case "point":var Oa=
xa;break;case "multipoint":case "polyline":Oa=xa.extent?.center;break;case "mesh":Oa=xa.origin;break;case "extent":Oa=xa.center;break;case "polygon":Oa=xa.centroid}Oa&&g.isSome(oa.basemapTerrain.spatialReference)&&u.canProject(Oa,oa.basemapTerrain.spatialReference)&&oa.elevationProvider?ha[2]=g.unwrapOr(D.getElevationAtPoint(oa.elevationProvider,Oa),0):ha[2]=0}(0,ua[xa.type])(xa,Ja=>{Na.push(Ja[0],Ja[1],Ja[2])},ha);Oa=Na.length/3;if(0===Oa)throw Ia();Ia=Array(Na.length);if(z.projectBuffer(Na,xa.spatialReference,
0,Ia,oa.spatialReference,0,Oa))for(xa.hasZ&&(Ea.hasZ=!0),oa=0;oa<Ia.length;oa+=3)xa.hasZ?(ha[0]=Ia[oa+0],ha[1]=Ia[oa+1],ha[2]=Ia[oa+2]):(ha[0]=Ia[oa+0],ha[1]=Ia[oa+1]),C.expandWithVec3(Ea.boundingBox,ha)}function R(oa,xa,Ea,Ia){return Q.apply(this,arguments)}function Q(){Q=c._asyncToGenerator(function*(oa,xa,Ea,Ia){const Na=yield m.result(oa.whenViewForGraphic(xa));if(!1!==Na.ok&&!g.isNone(Na.value)&&"whenGraphicBounds"in Na.value)if(Ea=yield m.result(Na.value.whenGraphicBounds(xa,{minDemResolution:Ea})),
!1===Ea.ok)S(oa,xa.geometry,Ia);else{var {screenSpaceObjects:Oa,boundingBox:Ja}=Ea.value;C.expandWithAABB(Ia.boundingBox,Ja);Oa&&Oa.forEach(Sa=>{Ia.screenSpaceObjects.push(Sa)});isFinite(Ja[2])&&(Ia.hasZ=!0)}else S(oa,xa.geometry,Ia)});return Q.apply(this,arguments)}function V(oa,xa,Ea,Ia){return aa.apply(this,arguments)}function aa(){aa=c._asyncToGenerator(function*(oa,xa,Ea,Ia){if(Array.isArray(xa)&&2===xa.length){const Na=xa[0],Oa=xa[1];if("number"===typeof Na&&"number"===typeof Oa){sa.x=Na;sa.y=
Oa;sa.z=void 0;sa.spatialReference=oa.spatialReference?.isGeographic?oa.spatialReference:E.WGS84;S(oa,sa,Ia);return}}xa&&"function"===typeof xa.map?yield h.eachAlways(xa.map(Na=>V(oa,Na,Ea,Ia))):xa instanceof J?S(oa,xa,Ia):xa instanceof n&&(yield R(oa,xa,Ea,Ia))});return aa.apply(this,arguments)}function X(oa,xa,Ea,Ia,Na){return W.apply(this,arguments)}function W(){W=c._asyncToGenerator(function*(oa,xa,Ea,Ia,Na){if(g.isSome(xa.camera))return T(oa,xa.camera,Na);Na.scale=xa.scale;Na.rotation=xa.rotation;
Na.targetGeometry=g.isSome(xa.targetGeometry)?xa.targetGeometry.clone():null;Na.camera=null;null!=Ea.heading?Na.rotation=N(Ea.heading):null!=Ea.rotation&&(Na.rotation=Ea.rotation);xa=H(oa,Ea);null!=xa&&(Na.scale=xa);Ia=new w.AsyncContext(Ia);I(oa,Na,Ea.tilt,Ia);Na.camera=yield Ia.resolver.promise;return Na});return W.apply(this,arguments)}function T(oa,xa,Ea){const Ia=u.project(xa.position,oa.spatialReference);if(g.isNone(Ia))return null;xa=xa.clone();xa.fov=oa.camera.fov;xa.position=Ia;return O(oa,
null,xa,Ea)}function U(oa,xa,Ea,Ia,Na,Oa){return Y.apply(this,arguments)}function Y(){Y=c._asyncToGenerator(function*(oa,xa,Ea,Ia,Na,Oa){if(g.isNone(Ea))throw new e("createfromcenter","invalid point");Oa.targetGeometry=Ea.clone();var Ja=y.cameraOnContentAlongViewDirection(oa);if(xa.position)return Ea=Oa.targetGeometry,xa=xa.position,Na=oa.renderSpatialReference,z.projectPointToVector(xa,va,Na),z.projectPointToVector(Ea,wa,Na),Oa.targetGeometry=new F(Ea),Ia.position=new F(xa),k.subtract(pa,wa,va),
w.directionToHeadingTilt(oa,va,pa,Ja.up,Ia),Oa.scale=w.distanceToScale(oa,k.distance(va,wa),Oa.targetGeometry.latitude),Oa.rotation=N(Ia.heading),Oa.camera=Ia,Oa;if(xa.zoomFactor){var Sa=Ja.distance/xa.zoomFactor;const Ua=k.scale(ha,Ja.viewForward,-Sa);Ja.eye=k.add(ha,Ja.center,Ua);Oa.scale=w.distanceToScale(oa,Sa,Ea.latitude)}w.internalToExternal(oa,Ja,Ia);Sa=L(Ia,xa)?w.OrientationMode.LOCKED:w.OrientationMode.ADJUST;xa.zoomFactor||(xa=H(oa,xa),null==xa?(z.projectPointToVector(Ea,ha,oa.renderSpatialReference),
A.intersectsPoint(Ja.frustum,ha)?Oa.scale=w.distanceToScale(oa,k.distance(Ja.eye,ha),Ea.latitude):Oa.scale=w.computeScale(oa,Ja)):Oa.scale=xa,Ja=new w.AsyncContext(Na),w.fromCenterScale(oa,Oa.targetGeometry,Oa.scale,Ia,Sa,Ja),Oa.camera=yield Ja.resolver.promise);return Oa});return Y.apply(this,arguments)}function ba(oa,xa,Ea,Ia,Na){return da.apply(this,arguments)}function da(){da=c._asyncToGenerator(function*(oa,xa,Ea,Ia,Na){var Oa=y.cameraOnContentAlongViewDirection(oa);Oa=z.projectVectorToPoint(Oa.center,
oa.renderSpatialReference,oa.spatialReference);return U(oa,xa,Oa,Ea,Ia,Na)});return da.apply(this,arguments)}function ea(oa,xa,Ea,Ia,Na,Oa){return ca.apply(this,arguments)}function ca(){ca=c._asyncToGenerator(function*(oa,xa,Ea,Ia,Na,Oa){Oa.targetGeometry=Ea.clone();const Ja=y.cameraOnContentAlongViewDirection(oa);w.internalToExternal(oa,Ja,Ia);xa=L(Ia,xa)?w.OrientationMode.LOCKED:w.OrientationMode.ADJUST;Na=new w.AsyncContext(Na);w.fromExtent(oa,Ea,Ia.heading,Ia.tilt,xa,Na);Oa.camera=yield Na.resolver.promise;
return Oa});return ca.apply(this,arguments)}function ja(oa,xa,Ea,Ia,Na,Oa,Ja,Sa){return ia.apply(this,arguments)}function ia(){ia=c._asyncToGenerator(function*(oa,xa,Ea,Ia,Na,Oa,Ja,Sa){Sa.targetGeometry=Ea.clone();const Ua=y.cameraOnContentAlongViewDirection(oa);var Za=0;null!=Ea.z?Za=Ea.z:oa.basemapTerrain&&oa.elevationProvider&&(Za=g.unwrap(D.getElevationAtPoint(oa.elevationProvider,Ea)));k.set(ha,Ea.x,Ea.y,Za);z.computeTranslationToOriginAndRotation(oa.spatialReference,ha,fa,oa.renderSpatialReference);
l.fromMat4(ka,fa);l.transpose(ka,ka);C.empty(la);Ea=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var ma=0;ma<Ea.length;ma++){const Ya=Ea[ma];let bb=Ia[Ya[2]];isFinite(bb)||(bb=Za);k.set(ha,Ia[Ya[0]],Ia[Ya[1]],bb);z.projectVectorToVector(ha,oa.spatialReference,ha,oa.renderSpatialReference);C.expandWithVec3(la,k.transformMat3(ha,ha,ka))}Ia=C.width(la);Za=C.height(la);Ea=C.depth(la);ma=1/Math.tan(Ua.fovY/2);Na=Math.max(.5*Math.sqrt(Ia*Ia+Ea*Ea)*Math.max(ma,1/Math.tan(Ua.fovX/
2))+.5*Za,.5*Za*ma+.5*Math.max(Ia,Ea))/Na;w.internalToExternal(oa,Ua,Oa);xa=L(Oa,xa)?w.OrientationMode.LOCKED:w.OrientationMode.ADJUST;Sa.scale=w.distanceToScale(oa,Na,Sa.targetGeometry.latitude);Ja=new w.AsyncContext(Ja);w.fromCenterScale(oa,Sa.targetGeometry,Sa.scale,Oa,xa,Ja);Sa.camera=yield Ja.resolver.promise;return Sa});return ia.apply(this,arguments)}function Z(oa){oa&&g.isSome(oa.camera)&&(oa.rotation=N(oa.camera.heading));return oa}const ha=p.create(),fa=q.create(),ka=v.create(),la=C.create(),
na=B.create(),pa=p.create(),va=p.create(),wa=p.create(),za={heading:0,tilt:0},sa=new F,ua={point(oa,xa,Ea){Ea[0]=oa.x;Ea[1]=oa.y;null!=oa.z&&(Ea[2]=oa.z);xa(Ea)},polygon(oa,xa,Ea){const Ia=oa.hasZ;for(let Na=0;Na<oa.rings.length;Na++){const Oa=oa.rings[Na];for(let Ja=0;Ja<Oa.length;Ja++)Ea[0]=Oa[Ja][0],Ea[1]=Oa[Ja][1],Ia&&(Ea[2]=Oa[Ja][2]),xa(Ea)}},polyline(oa,xa,Ea){const Ia=oa.hasZ;for(let Na=0;Na<oa.paths.length;Na++){const Oa=oa.paths[Na];for(let Ja=0;Ja<Oa.length;Ja++)Ea[0]=Oa[Ja][0],Ea[1]=Oa[Ja][1],
Ia&&(Ea[2]=Oa[Ja][2]),xa(Ea)}},multipoint(oa,xa,Ea){const Ia=oa.points;oa=oa.hasZ;for(let Na=0;Na<Ia.length;Na++)Ea[0]=Ia[Na][0],Ea[1]=Ia[Na][1],oa&&(Ea[2]=Ia[Na][2]),xa(Ea)},extent(oa,xa,Ea){null!=oa.zmin&&null!=oa.zmax?(xa(k.set(Ea,oa.xmin,oa.ymin,oa.zmin)),xa(k.set(Ea,oa.xmax,oa.ymin,oa.zmin)),xa(k.set(Ea,oa.xmin,oa.ymax,oa.zmin)),xa(k.set(Ea,oa.xmax,oa.ymax,oa.zmin)),xa(k.set(Ea,oa.xmin,oa.ymin,oa.zmax)),xa(k.set(Ea,oa.xmax,oa.ymin,oa.zmax)),xa(k.set(Ea,oa.xmin,oa.ymax,oa.zmax)),xa(k.set(Ea,oa.xmax,
oa.ymax,oa.zmax))):(xa(k.set(Ea,oa.xmin,oa.ymin,Ea[2])),xa(k.set(Ea,oa.xmax,oa.ymin,Ea[2])),xa(k.set(Ea,oa.xmin,oa.ymax,Ea[2])),xa(k.set(Ea,oa.xmax,oa.ymax,Ea[2])))},mesh(oa,xa,Ea){if(oa=oa.vertexAttributes&&oa.vertexAttributes.position)for(let Ia=0;Ia<oa.length;Ia+=3)xa(k.set(Ea,oa[Ia+0],oa[Ia+1],oa[Ia+2]))}};a.create=function(oa,xa,Ea){return G.apply(this,arguments)};a.fromCamera=function(oa,xa,Ea=null){g.isNone(Ea)&&(Ea=new r);return O(oa,null,xa.clone(),Ea)};a.headingToRotation=N;a.rotationToHeading=
M;a.toCamera=I;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,c,b,t,n,r,m){r=function(d){function f(e,g,h){var l=d.call(this,!0)||this;l._view=e;l.pointerAction=g;l.registerIncoming("drag",
h,v=>l._handleDrag(v));return l}c._inheritsLoose(f,d);f.prototype._handleDrag=function(e){const g=e.data;if(!(1<g.pointers.size)&&m.eventMatchesMousePointerAction(e.data,this.pointerAction)){var h=b.createScreenPointArray(g.center.x,g.center.y);switch(g.action){case "start":this._cameraController&&(this._cameraController.end(),this._cameraController=null);this._cameraController=this._view.state.isGlobal?new t.ZoomController({view:this._view}):new n.ZoomController({view:this._view});this._view.state.switchCameraController(this._cameraController);
this._cameraController.begin(h);break;case "update":this._cameraController&&this._cameraController.update(h);break;case "end":this._cameraController&&(this._cameraController.end(),this._cameraController=null)}e.stopPropagation()}};return f}(r.InputHandler);a.DragZoom=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/surfaceCollision ../../../camera/constraintUtils/TiltMode ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F){a.ZoomController=function(J){function M(){var P=J.apply(this,arguments)||this;P._pickPoint=k.create();P._tmpP0=v.create();P._panAxisAngle=z.create();P._tmpRayDir=k.create();P._tmpRayDirPick=k.create();P._targetOnSphere=k.create();P._navMode=D.NavigationMode.Horizontal;P._tmpRay={origin:k.create(),direction:k.create()};P.dragBeginPoint=r.createScreenPointArray();P._normalizedAnchorPoint=v.create();P._constraintOptions={selection:A.ConstraintTypes.ALL_EXCEPT_COLLISION,
interactionType:x.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:y.TiltMode.TUMBLE};P._sphere=C.create();P._hasPickPoint=!1;return P}c._inheritsLoose(M,J);var N=M.prototype;N.begin=function(P){if(this.active){l.copy(this.dragBeginPoint,P);D.normalizeCoordinate(this.startCamera,P,this._normalizedAnchorPoint);var I=p.getReferenceEllipsoid(this.view.spatialReference),G=D.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,P,I,D.SpherePickPointFallback.Ellipsoid,
0===this.view.map.ground.opacity?D.contentIntersectorOptions:{});this._navMode=D.decideNavigationMode(this.startCamera,P,I);if(this._navMode===D.NavigationMode.Horizontal)this._hasPickPoint=!!G.scenePickPoint,this._pickPoint=n.unwrapOr(G.scenePickPoint,this._pickPoint),this._sphere=G.sphere;else{F.fromScreenAtEye(this.startCamera,P,this._tmpRay);q.normalize(this._tmpRay.direction,this._tmpRay.direction);let H;n.isSome(G.scenePickPoint)&&(q.subtract(this._tmpRayDirPick,this.startCamera.eye,G.scenePickPoint),
H=q.length(this._tmpRayDirPick));I=Math.abs(this.view.camera.position.z);this.view.renderCoordsHelper.worldUpAtPosition(this.startCamera.eye,K);I=t.clamp(Math.min(D.PIVOT_DISTANCE_MODIFIER,1/Math.abs(q.dot(K,this._tmpRay.direction)))*I,D.DISTANCE_CLAMP_VALUES[0],D.DISTANCE_CLAMP_VALUES[1]);P=this.view._stage.renderView.getMinimalDepthForArea(null,P[0],P[1],this.view.state.camera,D.SCREEN_PIXEL_AREA);I=n.isSome(P)?P:I;I=null!=H?Math.min(I,H):I;this._hasPickPoint=!0;q.scale(this._tmpRay.direction,this._tmpRay.direction,
I);q.add(this._pickPoint,this._tmpRay.origin,this._tmpRay.direction)}this._constraintOptions.interactionStartCamera=this.startCamera}};N.update=function(P){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this._navMode===D.NavigationMode.Horizontal){q.subtract(this._tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var I=q.length(this._tmpRayDir);D.normalizeCoordinate(this.currentCamera,
P,this._tmpP0);var G=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]),H=I*2**G;const L=this.view.state.constraints.minimumPoiDistance;0>G&&H<L&&(H=L);if(1E-6>Math.abs(I-H))return;this._hasPickPoint&&H<I&&(G=1-(1-H/I)*(1-this._sphere[3]/q.length(this.currentCamera.center)),this.currentCamera.center=q.scale(E,this.currentCamera.center,G));q.scale(this._tmpRayDir,this._tmpRayDir,-H/I);this.currentCamera.eye=q.add(E,this.currentCamera.center,this._tmpRayDir);this._constraintOptions.interactionFactor=
B.pixelDistanceToInteractionFactor(l.distance(this.dragBeginPoint,P));B.applyAll(this.view,this.currentCamera,this._constraintOptions);this._hasPickPoint&&(D.sphereOrPlanePointFromScreenPoint(this._sphere,this.currentCamera,this.dragBeginPoint,this._targetOnSphere),z.fromPoints(this._pickPoint,this._targetOnSphere,this._panAxisAngle),D.applyRotation(this.currentCamera,this._sphere,this._panAxisAngle))}else{I=q.length(this._tmpRay.direction);D.normalizeCoordinate(this.currentCamera,P,this._tmpP0);
P=12*(this._normalizedAnchorPoint[1]-this._tmpP0[1]);H=I*2**P;G=this.view.state.constraints.minimumPoiDistance;0>P&&H<G&&(H=G);if(1E-6>Math.abs(I-H))return;q.scale(this._tmpRayDir,this._tmpRay.direction,1-H/I);this.currentCamera.eye=q.add(E,this.currentCamera.eye,this._tmpRayDir);this.currentCamera.center=q.add(E,this.currentCamera.center,this._tmpRayDir)}u.applySurfaceCollisionConstraint(this.view,this.currentCamera);this.commitCamera()}};N.end=function(){this.active&&this.finishController()};c._createClass(M,
[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return M}(w.InteractiveController);a.ZoomController=b.__decorate([h.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const E=k.create(),K=k.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../InteractiveController ../../utils/navigationUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){a.ZoomController=function(D){function F(){var K=D.apply(this,arguments)||this;K._tmpP=k.create();K._tmpDir=k.create();K._tmpN=k.create();K._tmpP0=v.create();K._tmpPoi=k.create();K._tmpRayDir=k.create();K.dragBeginPoint=r.createScreenPointArray();K._normalizedAnchorPoint=v.create();K._constraintOptions={selection:C.ConstraintTypes.ALL,interactionType:B.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:k.create(),
tiltMode:A.TiltMode.TUMBLE};K._plane=p.create();return K}c._inheritsLoose(F,D);var E=F.prototype;E.begin=function(K){if(this.active){l.copy(this.dragBeginPoint,K);u.normalizeCoordinate(this.startCamera,K,this._normalizedAnchorPoint);var J=this._intersectionHelper.intersectScreenFreePointFallback(K,this._tmpP,0===this.view.map.ground.opacity?u.contentIntersectorOptions:{});q.subtract(this._tmpDir,this._tmpP,this.startCamera.eye);var M=q.length(this._tmpDir);q.normalize(this._tmpDir,this._tmpDir);var N=
Math.abs(this.view.camera.position.z);N=t.clamp(Math.min(u.PIVOT_DISTANCE_MODIFIER,1/Math.abs(q.dot(w,this._tmpDir)))*N,u.DISTANCE_CLAMP_VALUES[0],u.DISTANCE_CLAMP_VALUES[1]);K=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,K[0],K[1],this.view.state.camera,u.SCREEN_PIXEL_AREA);N=n.isSome(K)?K:N;N=J?Math.min(N,M):N;q.scale(this._tmpDir,this._tmpDir,N);q.add(this._tmpP,this.startCamera.eye,this._tmpDir);q.subtract(this._tmpN,this.startCamera.eye,this.startCamera.center);q.normalize(this._tmpN,
this._tmpN);0>this._tmpN[1]&&q.negate(this._tmpN,this._tmpN);p.fromPositionAndNormal(this._tmpP,this._tmpN,this._plane);this._constraintOptions.interactionStartCamera=this.startCamera}};E.update=function(K){if(this.active){u.intersectPlaneFromScreenPoint(this._plane,this.currentCamera,this.dragBeginPoint,this._tmpPoi)||q.copy(this._tmpPoi,this.currentCamera.center);u.normalizeCoordinate(this.currentCamera,K,this._tmpP0);var J=4*(this._tmpP0[1]-this._normalizedAnchorPoint[1]);l.copy(this._normalizedAnchorPoint,
this._tmpP0);q.subtract(this._tmpRayDir,this._tmpPoi,this.currentCamera.eye);var M=q.length(this._tmpRayDir),N=M*(1-J);this._constraintOptions.interactionDirection&&(q.copy(this._constraintOptions.interactionDirection,this._tmpRayDir),q.scale(this._constraintOptions.interactionDirection,this._constraintOptions.interactionDirection,Math.sign(J)/M));var P=this.view.state.constraints.minimumPoiDistance;0<=J&&N<P&&(N=P,J=-(N-M)/M);1E-6>Math.abs(M-N)||(q.scale(this._tmpRayDir,this._tmpRayDir,J),this.currentCamera.eye=
q.add(y,this.currentCamera.eye,this._tmpRayDir),q.lerp(y,this.currentCamera.center,this._tmpPoi,J),y[2]=this._tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],y[2]):Math.min(this.startCamera.center[2],y[2]),this.currentCamera.center=y,this._constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(l.distance(this.dragBeginPoint,K)),z.applyAll(this.view,this.currentCamera,this._constraintOptions),this.commitCamera())}};E.end=function(){this.active&&this.finishController()};
c._createClass(F,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return F}(x.InteractiveController);a.ZoomController=b.__decorate([h.subclass("esri.views.3d.state.controllers.local.ZoomController")],a.ZoomController);const y=k.create(),w=k.fromValues(0,0,1);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/reactiveUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(a,c,b,t,n,r){r=function(m){function d(e){var g=m.call(this,!0)||this;g._view=e;g._watchHandles=new b;g._handle=g.registerIncoming("gamepad",h=>g._handleEventGamepad(h));g._handle.pause();return g}c._inheritsLoose(d,m);var f=d.prototype;f.onInstall=function(e){m.prototype.onInstall.call(this,e);this._watchHandles.add([t.watch(()=>this._view.navigation.gamepad.enabled,g=>{g?this._handle.resume():(this._handle.pause(),this._cameraControllerGamepad&&(this._cameraControllerGamepad.finishController(),
this._cameraControllerGamepad=null))},t.initial),t.watch(()=>this._view.navigation.gamepad.device,g=>{this._cameraControllerGamepad&&g&&this._cameraControllerGamepad.gamepadDevice!==g&&(this._cameraControllerGamepad.finishController(),this._cameraControllerGamepad=null)})])};f.onUninstall=function(){this._watchHandles.removeAll();m.prototype.onUninstall.call(this)};f._handleEventGamepad=function(e){var g=this._view.navigation.gamepad.device;if(!g||e.data.device===g)if((g=this._cameraControllerGamepad&&
this._cameraControllerGamepad.active)||n.GamepadKeyboardController.activatesFor(this._view,e.data))g||(g=new n.GamepadKeyboardController({view:this._view,gamepadDevice:e.data.device}),this._view.state.switchCameraController(g)&&(this._cameraControllerGamepad=g)),this._cameraControllerGamepad&&this._cameraControllerGamepad.active&&this._cameraControllerGamepad.gamepadDevice===e.data.device&&this._cameraControllerGamepad.handleEventGamepad(e.data)};return d}(r.InputHandler);a.GamepadNavigation=r;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/ConstraintTypes ../../camera/constraintUtils/InteractionType ../../camera/constraintUtils/TiltMode ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J){a.GamepadKeyboardController=function(S){function R(V){V=S.call(this,V)||this;V._filteredSurfaceElevation=0;V._transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};V._keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];V._tmpCamera=new K.Camera;V._headingStart=0;V._constraintOptions={selection:B.ConstraintTypes.ALL,interactionType:A.InteractionType.NONE,interactionStartCamera:new K.Camera,interactionFactor:0,interactionDirection:null,
tiltMode:x.TiltMode.LOOK_AROUND};return V}c._inheritsLoose(R,S);var Q=R.prototype;Q.handleEventGamepad=function(V){const aa=J.extractTransformation(V,this.view.navigation.gamepad,this._transformation);("end"===V.action||J.isZeroTransformation(aa))&&this.finishController()};Q.activateDirection=function(V){this._keysButtonState[V]=1;J.extractTransformationKeyboard(this._keysButtonState,this._transformation)};Q.deactivateDirection=function(V){this._keysButtonState[V]=0;V=J.extractTransformationKeyboard(this._keysButtonState,
this._transformation);J.isZeroTransformation(V)&&this.finishController()};Q.onControllerStart=function(V){this._filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this._headingStart=this.view.camera.heading;S.prototype.onControllerStart.call(this,V)};Q._updateFilteredSurfaceElevation=function(V){this._filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this._filteredSurfaceElevation)*V};Q.stepController=function(V,aa){this._updateStartHeading();
this._updateFilteredSurfaceElevation(V);this.currentCamera.copyViewFrom(aa);this._updateCameraCenter();this._constraintOptions.interactionStartCamera?.copyFrom(this.currentCamera);this._calculateControlTransformation(V,this.currentCamera,G);this._applyDisabledMovementTypes(G);this._applyPan(G.pan);this._applyRotate(G.rotate);this._applyZoom(G.zoom);this._applyAscend(G.ascend);this._constraintOptions.interactionType=A.InteractionType.NONE;this._constraintOptions.selection=B.ConstraintTypes.COLLISION;
C.applyAll(this.view,this.currentCamera,this._constraintOptions);S.prototype.stepController.call(this,V,aa)};Q._updateStartHeading=function(){0!==this._transformation.heading&&(this._headingStart=this.view.camera.heading)};Q._applyRotate=function(V){if(V.enabled){var aa=this.currentCamera;l.subtract(H,aa.center,aa.eye);l.transformMat4(H,H,V.matrix);aa.center=l.add(H,H,aa.eye);aa.up=l.transformMat4(H,aa.up,V.matrix);this._constraintOptions.interactionType=A.InteractionType.LOOK_AROUND;this._constraintOptions.selection=
B.ConstraintTypes.ALL_EXCEPT_COLLISION;C.applyAll(this.view,aa,this._constraintOptions)}};Q._applyPan=function(V,aa=this.currentCamera){V.enabled&&(aa.eye=l.transformMat4(H,aa.eye,V.matrix),aa.center=l.transformMat4(H,aa.center,V.matrix),this.view.state.isGlobal&&(aa.up=l.transformMat4(H,aa.up,V.matrix)),this._constraintOptions.interactionType=A.InteractionType.PAN,this._constraintOptions.selection=B.ConstraintTypes.ALL,C.applyAll(this.view,aa,this._constraintOptions))};Q._applyZoom=function(V){if(V){var aa=
this.currentCamera.viewForward;this.currentCamera.eye=l.add(H,this.currentCamera.eye,l.scale(z.sv3d.get(),aa,V));l.copy(L,aa);l.negate(L,L);this._constraintOptions.interactionDirection=L;this._constraintOptions.interactionType=A.InteractionType.ZOOM;this._constraintOptions.selection=B.ConstraintTypes.ALL_EXCEPT_COLLISION;C.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}};Q._applyAscend=function(V){if(V){var aa=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,
z.sv3d.get());this._constraintOptions.interactionDirection=l.copy(L,aa);this.view.state.isGlobal?(aa=l.length(this.currentCamera.eye),V=(aa+V)/aa,this.currentCamera.eye=l.scale(H,this.currentCamera.eye,V),this.currentCamera.center=l.scale(H,this.currentCamera.center,V)):(V=l.scale(z.sv3d.get(),aa,V),this.currentCamera.eye=l.add(H,this.currentCamera.eye,V),this.currentCamera.center=l.add(H,this.currentCamera.center,V));this._updateCameraCenter();this._constraintOptions.interactionType=A.InteractionType.ASCEND;
this._constraintOptions.selection=B.ConstraintTypes.COLLISION;C.applyAll(this.view,this.currentCamera,this._constraintOptions)&&this._updateCameraCenter();this._constraintOptions.selection=B.ConstraintTypes.ALL_EXCEPT_COLLISION;C.applyAll(this.view,this.currentCamera,this._constraintOptions);this._constraintOptions.interactionDirection=null}};Q._calculateControlTransformation=function(V,aa,X){X.zoom=0;X.ascend=0;X.pan.enabled=!1;g.identity(X.pan.matrix);X.rotate.enabled=!1;g.identity(X.rotate.matrix);
V=this._computeVelocities(V);this.view.state.isLocal?this._calculateControlTransformationLocal(V,aa,X):this._calculateControlTransformationGlobal(V,aa,X)};Q._updateCameraCenter=function(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,H)};Q._calculateControlTransformationLocal=function(V,aa,X){const {viewRight:W,viewForward:T}=aa,U=this._transformation;var Y=
this.view.navigation.gamepad,ba=l.set(z.sv3d.get(),T[0],T[1],0);l.normalize(ba,ba);var da=U.translation[0]*V.pan;0!==da&&(da=l.scale(z.sv3d.get(),W,da),g.translate(X.pan.matrix,X.pan.matrix,da),X.pan.enabled=!0);switch(Y.mode){case "pan":Y=-U.translation[1]*V.pan;0!==Y&&(ba=l.scale(z.sv3d.get(),ba,Y),g.translate(X.pan.matrix,X.pan.matrix,ba),X.pan.enabled=!0);X.zoom=U.zoom*V.zoom;break;case "zoom":X.zoom=(-U.translation[1]+U.zoom)*V.zoom;break;default:t.neverReached(Y.mode)}X.ascend=U.translation[2]*
V.ascend;ba=-U.heading*V.rotate;0!==ba&&(g.rotate(X.rotate.matrix,X.rotate.matrix,ba,this.view.renderCoordsHelper.worldUpAtPosition(aa.eye,z.sv3d.get())),X.rotate.enabled=!0);V=U.tilt*V.rotate;aa=D.viewAngle(this.view.renderCoordsHelper,aa.center,aa.eye);if(aa=n.clamp(aa+V,u.TiltDefault.min,u.TiltDefault.max)-aa)g.rotate(X.rotate.matrix,X.rotate.matrix,aa,W),X.rotate.enabled=!0};Q._calculateControlTransformationGlobal=function(V,aa,X){const {eye:W,viewRight:T}=aa,U=this._transformation;var Y=this.view.navigation.gamepad,
ba=l.cross(z.sv3d.get(),T,W);l.normalize(ba,ba);l.negate(ba,ba);w.panMotionToRotationMatrix(this.startCamera,aa,U,V,this.view.camera.heading,this._headingStart,this.view.camera.tilt,X,Y);this._tmpCamera.copyFrom(this.currentCamera);this._applyPan(G.pan,this._tmpCamera);Y=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;X.ascend=U.translation[2]*V.ascend;ba=-U.heading*V.rotate;0!==ba&&(g.rotate(X.rotate.matrix,X.rotate.matrix,ba,this._tmpCamera.eye),X.rotate.enabled=!0);
aa=this._clampTiltDeltaGlobalToValidRange(U.tilt*V.rotate,aa.ray,Y);0!==aa&&(g.rotate(X.rotate.matrix,X.rotate.matrix,aa,this._tmpCamera.viewRight),X.rotate.enabled=!0);X.zoom+=U.zoom*V.zoom};Q._clampTiltDeltaGlobalToValidRange=function(V,aa,X){const W=q.getReferenceEllipsoid(this.view.spatialReference),T=w.onSurfaceTiltToEyeTiltGlobal(u.TiltDefault.min,aa.origin,X,W);var U=0;let Y=0;U=z.sv3d.get();this.view.renderCoordsHelper.intersectManifold(aa,X,U)?(U=D.viewAngle(this.view.renderCoordsHelper,
U,aa.origin),U=w.onSurfaceTiltToEyeTiltGlobal(U,aa.origin,X,W),Y=w.onSurfaceTiltToEyeTiltGlobal(u.TiltDefault.max,aa.origin,X,W)):(p.closestPointOnSilhouette(p.fromRadius(p.tmpSphere,X+W.radius),aa,U),U=n.acosClamped(-l.dot(aa.direction,l.normalize(U,U))),U=w.offSurfaceTiltToEyeTiltGlobal(U,aa.origin,X,W),Y=w.offSurfaceTiltToEyeTiltGlobal(u.TiltDefault.max,aa.origin,X,W));return n.clamp(U+V,T,Y)-U};Q._getPointAbsoluteSurfaceElevation=function(V,aa,X){const {renderCoordsHelper:W}=this.view,T=W.getAltitude(V);
aa+=Math.abs(T-aa);W.setAltitude(X,aa,V);return aa};Q._clampedDistanceToSurface=function(V,aa){const {renderCoordsHelper:X}=this.view,{camera:W}=this.view.state;var {direction:T}=F.headingTiltToDirectionUp(this.view,aa,0,80,O);T=X.intersectManifoldClosestSilhouette(k.wrap(aa,T),V,z.sv3d.get());T=l.distance(aa,T);V=X.intersectManifoldClosestSilhouette(k.wrap(aa,l.direction(z.sv3d.get(),aa,W.center)),V,z.sv3d.get());aa=l.distance(aa,V);return Math.min(T,aa)};Q._computeHeadingRotateRadius=function(V){const {renderCoordsHelper:aa,
state:X}=this.view,{camera:W,isGlobal:T}=X;var U=aa.intersectManifoldClosestSilhouette(W.ray,this._filteredSurfaceElevation,z.sv3d.get());if(T){const Y=l.subtract(z.sv3d.get(),V,U);U=l.length(Y);l.scale(Y,Y,1/U);V=l.normalize(z.sv3d.get(),V);V=n.acosClamped(l.dot(V,Y));return U*Math.sin(Math.min(N,V))}V=l.copy(z.sv3d.get(),V);aa.setAltitude(V,this._filteredSurfaceElevation);return l.distance(U,V)};Q._minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:5};Q._computeVelocities=
function(V){var aa=this._filteredSurfaceElevation,X=aa+q.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:W,isGlobal:T}=this.view.state;var U=z.sv3d.get();const Y=this._getPointAbsoluteSurfaceElevation(W.eye,aa,U);var ba=this._clampedDistanceToSurface(aa,U);const da=W.width/2,ea=.75*W.width,ca=.75*W.width;var ja=ba*Math.tan(.5*W.fovX)/da;X=ja/X;U=ja/this._computeHeadingRotateRadius(U);ja=(T?X:ja)*ea*V;aa=Y-aa;aa=Math.max(this._minimumAscendVelocity()*V,2**(ea*V/da)*aa-aa);ba=
2**(ea*V/da)*ba-ba;V*=n.clamp(U*ca,P,I);return{pan:ja,ascend:aa,zoom:ba,rotate:V}};Q._applyDisabledMovementTypes=function(V){!r.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&this.view.state.viewingMode!==this.disableMovements.mode||(V.zoom=this.disableMovements.zoom?0:V.zoom,V.ascend=this.disableMovements.ascend?0:V.ascend,V.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&g.identity(V.pan.matrix),V.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&
g.identity(V.rotate.matrix))};R.activatesFor=function(V,aa){V=J.extractTransformation(aa,V.navigation.gamepad,M);return!("end"===aa.action||J.isZeroTransformation(V))};return R}(y.InteractiveController);b.__decorate([m.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);b.__decorate([m.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=b.__decorate([e.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],
a.GamepadKeyboardController);const M={translation:[0,0,0],heading:0,tilt:0,zoom:0},N=n.deg2rad(80),P=n.deg2rad(30),I=n.deg2rad(80),G={zoom:0,ascend:0,pan:{enabled:!1,matrix:h.create()},rotate:{enabled:!1,matrix:h.create()}},H=v.create(),L=v.create(),O=E.createDirectionUp();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,c){function b(t){let n=t*t;0>t&&(n*=-1);return n}a.extractTransformation=
function(t,n,r){const m=t.state;t=t.device;n="forward-down"===n.tiltDirection?1:-1;"standard"===t.deviceType?(r.translation[0]=b(m.axes[0]),r.translation[1]=b(m.axes[1]),r.translation[2]=b(m.buttons[7])-b(m.buttons[6]),r.heading=b(m.axes[2]),r.tilt=b(m.axes[3])):"spacemouse"===t.deviceType&&(r.translation[0]=1.2*b(m.axes[0]),r.translation[1]=1.2*b(m.axes[1]),r.translation[2]=2*-b(m.axes[2]),r.heading=1.2*b(m.axes[5]),r.tilt=1.2*b(m.axes[3]));r.tilt*=n;c.scale(r.translation,r.translation,1);return r};
a.extractTransformationKeyboard=function(t,n){n.translation[0]=t[1]-t[0];n.translation[1]=t[3]-t[2];n.translation[2]=t[4]-t[5];n.heading=t[7]-t[6];n.tilt=t[8]-t[9];n.zoom=t[10]-t[11];return n};a.isZeroTransformation=function(t){return 0===t.translation[0]&&0===t.translation[1]&&0===t.translation[2]&&0===t.heading&&0===t.tilt&&0===t.zoom};a.resetTransformation=function(t){t.translation[0]=0;t.translation[1]=0;t.translation[2]=0;t.heading=0;t.tilt=0;return t};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,c,b,t,n){var r;(function(m){m[m.LEFT=0]="LEFT";m[m.RIGHT=1]="RIGHT";m[m.FORWARD=2]="FORWARD";m[m.BACKWARD=3]="BACKWARD";m[m.UP=4]="UP";m[m.DOWN=5]="DOWN";m[m.HEADINGLEFT=6]="HEADINGLEFT";m[m.HEADINGRIGHT=7]="HEADINGRIGHT";m[m.TILTUP=8]="TILTUP";
m[m.TILTDOWN=9]="TILTDOWN";m[m.ZOOMIN=10]="ZOOMIN";m[m.ZOOMOUT=11]="ZOOMOUT"})(r||(r={}));n=function(m){function d(e,g){var h=m.call(this,!0)||this;h._view=e;h._disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:b.ViewingMode.Local};h._keyToNumber={[g.left]:r.LEFT,[g.right]:r.RIGHT,[g.forward]:r.FORWARD,[g.backward]:r.BACKWARD,[g.up]:r.UP,[g.down]:r.DOWN,[g.headingLeft]:r.HEADINGLEFT,[g.headingRight]:r.HEADINGRIGHT,[g.tiltUp]:r.TILTUP,[g.tiltDown]:r.TILTDOWN,[g.zoomIn]:r.ZOOMIN,[g.zoomOut]:r.ZOOMOUT};
h.registerIncoming("key-down",null,l=>h._handleKeyDown(l));h.registerIncoming("key-up",null,l=>h._handleKeyUp(l));h.registerIncoming("blur",null,()=>h._handleBlur());return h}c._inheritsLoose(d,m);var f=d.prototype;f._handleKeyDown=function(e){if(!e.data.native.ctrlKey&&!e.data.native.metaKey){var g=this._keyToNumber[e.data.key];null!=g&&(this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active||(this._cameraControllerKeyboard=new t.GamepadKeyboardController({view:this._view,disableMovements:this._disableMovements}),
this._view.state.switchCameraController(this._cameraControllerKeyboard)),this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.activateDirection(g),e.stopPropagation()))}};f._handleBlur=function(){this._cameraControllerKeyboard&&this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.finishController(),this._cameraControllerKeyboard=null)};f._handleKeyUp=function(e){if(!e.data.native.ctrlKey&&!e.data.native.metaKey){var g=this._keyToNumber[e.data.key];null!=g&&this._cameraControllerKeyboard&&
this._cameraControllerKeyboard.active&&(this._cameraControllerKeyboard.deactivateDirection(g),e.stopPropagation())}};return d}(n.InputHandler);a.KeyboardNavigation=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(a,c,b,t,n,r){r=function(m){function d(f,e){var g=m.call(this,!0)||this;g._view=f;g.registerIncoming("mouse-wheel",e,h=>g._handleMouseWheel(h));return g}c._inheritsLoose(d,m);d.prototype._handleMouseWheel=function(f){if(this._view.navigation.mouseWheelZoomEnabled){var e=f.data;this._cameraController&&this._cameraController.active||(this._cameraController=this._view.state.isGlobal?new t.ZoomStepController({view:this._view,mode:"interaction"}):new n.ZoomStepController({view:this._view,mode:"interaction"}),
this._view.state.switchCameraController(this._cameraController));this._cameraController.zoomStep(-1/60*e.deltaY,b.createScreenPointArray(e.x,e.y));f.preventDefault();f.stopPropagation()}};return d}(r.InputHandler);a.MouseWheelZoom=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,c,b,t,n,r){n=function(m){function d(e,g,h){var l=m.call(this,!0)||this;l._view=e;l.pointerAction=g;l._lastEndTimestamp=0;l._lastTimestamp=0;l.registerIncoming("drag",h,v=>l._handleDrag(v));return l}c._inheritsLoose(d,m);var f=d.prototype;f._handleDrag=function(e){if("mouse"!==e.data.pointerType||r.eventMatchesMousePointerAction(e.data,this.pointerAction)){var g=e.timestamp-this._lastEndTimestamp;g=this._momentum&&this._momentum.active&&40>g;switch(e.data.action){case "start":case "update":if(g)break;
this._controller&&this._controller.active?2<e.data.timestamp-this._lastTimestamp&&(this._controller.update(e.data),this._lastTimestamp=e.timestamp):this._startController(e);break;case "end":case "removed":this._endController(e,!0);break;case "added":this._endController(e,!1),this._startController(e)}e.stopPropagation()}};f._endController=function(e,g){this._controller&&this._controller.active&&(this._lastEndTimestamp=e.timestamp,e=this._controller.end(e.data),g&&e&&(this._momentum=e,this._view.state.switchCameraController(this._momentum)));
this._controller=null};f._startController=function(e){this._controller=this._createController();this._view.state.switchCameraController(this._controller);this._controller.begin(e.data);this._lastTimestamp=e.timestamp};f._createController=function(){return this._view.state.isGlobal?new b.PinchAndPanController({view:this._view}):new t.PinchAndPanController({view:this._view})};return d}(n.InputHandler);a.PinchAndPanNavigation=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Cyclical ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/ellipsoidUtils ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L){a.PinchAndPanController=function(O){function S(){var Q=O.apply(this,arguments)||this;Q._smoothRotation=new w.ExponentialFalloff(.05);Q._rotationAxis=k.create();Q._beginAngle=0;Q._beginHeading=0;Q._panningPlane=C.create();Q._beginRadius=0;Q._smoothScaling=new w.ExponentialFalloff(.05);Q._zoomCenterScreen=m.createScreenPointArray();Q._zoomMomentumEstimator=new L.ZoomMomentumEstimator;Q._rotationMomentumEstimator=new H.RotationMomentumEstimator;
Q._panSphericalMomentumEstimator=new G.PanSphericalMomentumEstimator;Q._panPlanarMomentumEstimator=new I.PanPlanarMomentumEstimator;Q._adjustedSphere=B.create();Q._tmp3d=k.create();Q._tmpScreenPointArray=m.createScreenPointArray();Q._beginScreenPoint=m.createScreenPointArray();Q._beginScenePoint=k.create();Q._screenPickPoint=m.createScreenPointArray();Q._scenePickPoint=k.create();Q._mode=N.NavigationMode.Horizontal;Q._sphere=B.create();Q._pointerCount=0;Q._tmpInteractionDirection=k.create();Q._constraintOptions=
{selection:x.ConstraintTypes.ALL,interactionType:u.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new P.Camera,interactionDirection:null,tiltMode:y.TiltMode.TUMBLE};return Q}c._inheritsLoose(S,O);var R=S.prototype;R.begin=function(Q){if(this.active){var V=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=V;this._rotationMomentumEstimator.enabled=V;this._panPlanarMomentumEstimator.enabled=V;this._panSphericalMomentumEstimator.enabled=V;this._beginHeading=-t.cyclicalPI.normalize(n.deg2rad(this.view.camera.heading));
this._beginRadius=Q.radius;this._pointerCount=Q.pointers.size;this._beginAngle=Q.angle;this._smoothRotation.reset();m.screenPointObjectToArray(Q.center,this._screenPickPoint);v.copy(this._beginScreenPoint,this._screenPickPoint);V=p.getReferenceEllipsoid(this.view.spatialReference);var aa=N.pickPointAndInitSphere(this._intersectionHelper,this.startCamera,this._screenPickPoint,V,N.SpherePickPointFallback.Silhouette,0===this.view.map.ground.opacity?N.contentIntersectorOptions:{});r.isNone(aa.scenePickPoint)||
(this._scenePickPoint=aa.scenePickPoint,this._sphere=aa.sphere,q.copy(this._beginScenePoint,this._scenePickPoint),this._mode=N.decideNavigationMode(this.startCamera,this._screenPickPoint,V),this._mode===N.NavigationMode.Vertical&&this._preparePlanarPanMode(Q,aa.hasGeometryIntersection),this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera))}};R.update=function(Q){if(this.active){this.currentCamera.copyFrom(this.startCamera);var V=1<Q.pointers.size;this._mode===N.NavigationMode.Horizontal?
(V&&this._zoomSpherical(Q),this._panningSpherical(Q),V&&this._rotateSpherical(Q)):(V&&this._zoomPlanar(Q),this._panningPlanar(Q),V&&this._rotatePlanar(Q));this.commitCamera()}};R.end=function(Q){Q.pointers.size===this._pointerCount&&this.update(Q);this.finishController();if(Q=this._zoomMomentumEstimator.evaluateMomentum())return this._mode===N.NavigationMode.Horizontal?new M.ZoomSphericalMomentumController({view:this.view,momentum:Q,screenCenter:this._zoomCenterScreen,sceneCenter:this._beginScenePoint,
radius:this._sphere[3]}):new J.ZoomPlanarMomentumController({view:this.view,momentum:Q,zoomCenter:this._beginScenePoint});if(Q=this._rotationMomentumEstimator.evaluateMomentum())return new K.RotationMomentumController({view:this.view,momentum:Q,center:this._sphere,axis:this._rotationAxis});if(this._mode===N.NavigationMode.Horizontal){if(Q=this._panSphericalMomentumEstimator.evaluateMomentum())return new E.PanSphericalMomentumController({view:this.view,momentum:Q})}else if(Q=this._panPlanarMomentumEstimator.evaluateMomentum())return new F.PanPlanarMomentumController({view:this.view,
momentum:Q});return null};R._preparePlanarPanMode=function(Q,V){var aa=q.negate(this._tmp3d,this.startCamera.viewForward);C.fromPositionAndNormal(this._scenePickPoint,aa,this._panningPlane);var X=m.createScreenPointArray(this._screenPickPoint[0],0);aa=k.create();var W=q.length(this.startCamera.eye);this._adjustedSphere[3]=W<this._sphere[3]?W-100:this._sphere[3];N.sphereOrPlanePointFromScreenPoint(this._adjustedSphere,this.startCamera,X,aa);X=m.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(aa,
X);aa=k.create();X=k.create();W=k.create();q.subtract(aa,this._scenePickPoint,this.currentCamera.eye);const T=q.length(aa);q.normalize(aa,aa);var U=N.PAN_DISTANCE_MODIFIER*Math.max(Math.abs(this.view.camera.position.z),N.MIN_HEIGHT_LIMIT);const Y=this.view._stage.renderView.getMinimalDepthForArea(null,this._screenPickPoint[0],this._screenPickPoint[1],this.view.state.camera,N.SCREEN_PIXEL_AREA);U=r.isSome(Y)?Y:U;U=V?Math.min(U,T):U;q.copy(W,q.add(X,this.currentCamera.eye,q.scale(X,aa,U)));this._panningPlane[3]=
-q.dot(C.normal(this._panningPlane),W);this.startCamera.center=q.add(X,this.startCamera.eye,q.scale(X,this.startCamera.viewForward,U));Q=m.screenPointObjectToArray(Q.center,this._tmpScreenPointArray);N.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.startCamera,Q,this._beginScenePoint)};R._zoomSpherical=function(Q){const V=this._beginRadius/Q.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(Q.radius,40),120);this._smoothScaling.update(V);N.applyZoomOnSphere(this._sphere,this.currentCamera,
this._smoothScaling.value);m.screenPointObjectToArray(Q.center,this._zoomCenterScreen);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*Q.timestamp);this._constraintOptions.interactionType=u.InteractionType.ZOOM;this._constraintOptions.interactionFactor=A.pixelDistanceToInteractionFactor(Q.radius-this._beginRadius);A.applyAll(this.view,this.currentCamera,this._constraintOptions)};R._panningSpherical=function(Q){const V=m.screenPointObjectToArray(Q.center,this._tmpScreenPointArray);N.sphereOrPlanePointFromScreenPoint(this._sphere,
this.currentCamera,V,this._tmp3d);N.preserveHeadingThreshold(this._beginScenePoint,q.dot(this.currentCamera.up,this._beginScenePoint),this._sphere[3],this._beginHeading,this.view.camera.tilt,this.startCamera)?(N.applyPanSphericalPreserveHeading(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this._beginHeading,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumPreserveHeading(V,this._tmp3d,.001*Q.timestamp,this.startCamera,this._sphere,this._beginHeading,this.view.camera.tilt)):
(N.applyPanSphericalDirectRotation(this._sphere,this.currentCamera,this._beginScenePoint,this._tmp3d,this.view.camera.tilt,!1),this._panSphericalMomentumEstimator.addMomentumDirectRotation(V,this._tmp3d,.001*Q.timestamp,this.startCamera,this._sphere[3],this.view.camera.tilt));this._constraintOptions.interactionType=u.InteractionType.PAN;this._constraintOptions.interactionFactor=A.pixelDistanceToInteractionFactor(v.distance(this._screenPickPoint,V));A.applyAll(this.view,this.currentCamera,this._constraintOptions)};
R._rotateSpherical=function(Q){q.normalize(this._rotationAxis,this._scenePickPoint);this.currentCamera.aboveGround||q.negate(this._rotationAxis,this._rotationAxis);var V=this._smoothRotation.value,aa=N.normalizeRotationDelta(Q.angle-V);V+=aa;this._smoothRotation.gain=.00125*Math.min(Math.max(Q.radius,40),120);this._smoothRotation.update(V);aa=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(aa,.001*Q.timestamp);N.applyRotation(this.currentCamera,this._sphere,z.wrapAxisAngle(this._rotationAxis,
aa));this._constraintOptions.interactionType=u.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=A.pixelDistanceToInteractionFactor(Q.radius*V);A.applyAll(this.view,this.currentCamera,this._constraintOptions)};R._panningPlanar=function(Q){const V=m.screenPointObjectToArray(Q.center,this._tmpScreenPointArray);N.intersectPlaneFromScreenPointAtEye(this._panningPlane,this.currentCamera,V,this._tmp3d)&&(N.applyPanPlanar(this.currentCamera,this._beginScenePoint,this._tmp3d),this._panPlanarMomentumEstimator.add(V,
this._tmp3d,.001*Q.timestamp),this._constraintOptions.interactionType=u.InteractionType.PAN,this._constraintOptions.interactionFactor=A.pixelDistanceToInteractionFactor(v.distance(this._beginScreenPoint,V)),this._constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this._tmpInteractionDirection),A.applyAll(this.view,this.currentCamera,this._constraintOptions),this._constraintOptions.interactionDirection=null)};R._zoomPlanar=function(Q){const V=
this._beginRadius/Q.radius;this._smoothScaling.gain=.001875*Math.min(Math.max(Q.radius,40),120);this._smoothScaling.update(V);this._zoomMomentumEstimator.add(this._smoothScaling.value,.001*Q.timestamp);N.applyZoomToPoint(this.currentCamera,this._beginScenePoint,this._smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this._constraintOptions.interactionType=u.InteractionType.ZOOM;this._constraintOptions.interactionFactor=A.pixelDistanceToInteractionFactor(Q.radius-this._beginRadius);
A.applyAll(this.view,this.currentCamera,this._constraintOptions)};R._rotatePlanar=function(Q){q.copy(this._rotationAxis,this._beginScenePoint);this.currentCamera.aboveGround||q.negate(this._rotationAxis,this._rotationAxis);var V=this._smoothRotation.value;let aa=Q.angle-V;aa=N.normalizeRotationDelta(aa);this._smoothRotation.gain=.00125*Math.min(Math.max(Q.radius,40),120);this._smoothRotation.update(V+aa);V=this._smoothRotation.value-this._beginAngle;this._rotationMomentumEstimator.add(V,.001*Q.timestamp);
N.applyRotation(this.currentCamera,this._sphere,z.wrapAxisAngle(this._rotationAxis,V));this._constraintOptions.interactionType=u.InteractionType.TUMBLE;this._constraintOptions.interactionFactor=A.pixelDistanceToInteractionFactor(Q.radius*V);A.applyAll(this.view,this.currentCamera,this._constraintOptions)};c._createClass(S,[{key:"_intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return S}(D.InteractiveController);a.PinchAndPanController=b.__decorate([l.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],
a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/util":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(r){this._gain=r}var n=t.prototype;n.reset=function(r){this._value=r};n.update=function(r){this._value=void 0===this._value?r:this._gain*r+(1-this._gain)*this._value};c._createClass(t,[{key:"gain",set:function(r){this._gain=r}},{key:"value",get:function(){return void 0===
this._value?0:this._value}}]);return t}();a.ExponentialFalloff=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){a.PanPlanarMomentumController=function(l){function v(q){q=l.call(this,q)||this;q.interactionType=e.InteractionType.PAN;q._tmpPan=f.create();return q}c._inheritsLoose(v,l);v.prototype.momentumStep=function(q,k){q=this.momentum.value(q);d.scale(this._tmpPan,this.momentum.direction,q);k.eye=d.subtract(h,k.eye,this._tmpPan);k.center=d.subtract(h,k.center,this._tmpPan);this.constraintOptions.interactionDirection=this._tmpPan};return v}(g.MomentumController);b.__decorate([t.property({constructOnly:!0})],
a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=b.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const h=f.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){a.MomentumController=function(p){function z(){var B=p.apply(this,arguments)||this;B._beginCamera=new k.Camera;B._elapsedTimeSec=0;B.constraintOptions={selection:h.ConstraintTypes.ALL,interactionType:l.InteractionType.PAN,interactionFactor:0,interactionStartCamera:new k.Camera,interactionDirection:null,tiltMode:v.TiltMode.TUMBLE};return B}c._inheritsLoose(z,p);var C=z.prototype;C.initialize=function(){this.constraintOptions.interactionType=this.interactionType;
this.viewAnimation=new e};C.onControllerStart=function(B){this._beginCamera.copyFrom(B);this.constraintOptions.interactionStartCamera=this._beginCamera;p.prototype.onControllerStart.call(this,B)};C.stepController=function(B,A){A.copyViewFrom(this._beginCamera);this._elapsedTimeSec+=B;this.momentumStep(this._elapsedTimeSec,A);g.applyAll(this.view,A,this.constraintOptions)};c._createClass(z,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this._elapsedTimeSec)}}]);return z}(q.AnimationController);
a.MomentumController=b.__decorate([f.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){const l=f.create(),v=f.create();a.PanSphericalMomentumController=function(q){function k(p){p=q.call(this,p)||this;p.interactionType=e.InteractionType.PAN;return p}c._inheritsLoose(k,q);k.prototype.momentumStep=function(p,z){const C=this.momentum.value1(p);p=this.momentum.value2(p);d.copy(v,z.eye);d.normalize(v,v);d.cross(this.momentum.axis2,v,this.momentum.axis1);h.applyRotationWithTwoAxes(z,l,this.momentum.axis1,C,this.momentum.axis2,p)};return k}(g.MomentumController);
b.__decorate([t.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=b.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){a.RotationMomentumController=function(l){function v(q){q=l.call(this,q)||this;q.interactionType=e.InteractionType.TUMBLE;return q}c._inheritsLoose(v,l);v.prototype.momentumStep=function(q,k){q=this.momentum.value(q);h.applyRotation(k,this.center,f.wrapAxisAngle(this.axis,q))};c._createClass(v,[{key:"center",set:function(q){this._set("center",d.clone(q))}},{key:"axis",set:function(q){this._set("axis",d.clone(q))}}]);return v}(g.MomentumController);b.__decorate([t.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);b.__decorate([t.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);b.__decorate([t.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=b.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){a.ZoomPlanarMomentumController=function(l){function v(q){q=l.call(this,q)||this;q.interactionType=e.InteractionType.ZOOM;q.constraintOptions.interactionDirection=f.create();return q}c._inheritsLoose(v,l);v.prototype.momentumStep=function(q,k){const {interactionDirection:p}=this.constraintOptions;p&&(d.copy(p,k.eye),q=this.momentum.valueDelta(0,q),h.applyZoomToPoint(k,this.zoomCenter,q,this.view.state.constraints.minimumPoiDistance),d.direction(p,k.eye,p))};c._createClass(v,
[{key:"zoomCenter",set:function(q){this._set("zoomCenter",f.clone(q))}}]);return v}(g.MomentumController);b.__decorate([t.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);b.__decorate([t.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=b.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],a.ZoomPlanarMomentumController);Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/InteractionType ./MomentumController ../../utils/navigationUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){a.ZoomSphericalMomentumController=function(k){function p(C){C=k.call(this,C)||this;C.interactionType=l.InteractionType.ZOOM;C.radius=0;C._tmpSceneCenter=f.create();C._tmpZoomAxisAngle=e.create();C._sphere=g.create();return C}c._inheritsLoose(p,k);var z=p.prototype;z.initialize=function(){this._sphere[3]=this.radius};z.momentumStep=function(C,B){C=this.momentum.valueDelta(0,C);q.applyZoomOnSphere(this._sphere,B,C);this.constraintOptions.interactionType=l.InteractionType.ZOOM;
h.applyAll(this.view,B,this.constraintOptions);q.sphereOrPlanePointFromScreenPoint(this._sphere,B,this.screenCenter,this._tmpSceneCenter);e.fromPoints(this.sceneCenter,this._tmpSceneCenter,this._tmpZoomAxisAngle);q.applyRotation(B,this._sphere,this._tmpZoomAxisAngle);this.constraintOptions.interactionType=l.InteractionType.PAN};c._createClass(p,[{key:"screenCenter",set:function(C){this._set("screenCenter",t.createScreenPointArray(C[0],C[1]))}},{key:"sceneCenter",set:function(C){this._set("sceneCenter",
f.clone(C))}}]);return p}(v.MomentumController);b.__decorate([n.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"momentum",void 0);b.__decorate([n.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);b.__decorate([n.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);b.__decorate([n.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=
b.__decorate([d.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,c,b,t,n,r){let m=function(d){function f(e,g,h,l,v){e=d.call(this,e,g,h)||this;e._sceneVelocity=
l;e.direction=v;return e}c._inheritsLoose(f,d);f.prototype.value=function(e){return d.prototype.valueFromInitialVelocity.call(this,this._sceneVelocity,e)};return f}(r.Momentum);r=function(){function d(e=300,g=12,h=.84){this._minimumInitialVelocity=e;this._stopVelocity=g;this._friction=h;this.enabled=!0;this._time=new n.FilteredFiniteDifference(.6);this._screen=[new n.FilteredFiniteDifference(.4),new n.FilteredFiniteDifference(.4)];this._scene=[new n.FilteredFiniteDifference(.6),new n.FilteredFiniteDifference(.6),
new n.FilteredFiniteDifference(.6)];this._tmpDirection=t.create()}var f=d.prototype;f.add=function(e,g,h){!this.enabled||this._time.hasLastValue()&&.015>this._time.computeDelta(h)||(this._screen[0].update(e[0]),this._screen[1].update(e[1]),this._scene[0].update(g[0]),this._scene[1].update(g[1]),this._scene[2].update(g[2]),this._time.update(h))};f.reset=function(){this._screen[0].reset();this._screen[1].reset();this._scene[0].reset();this._scene[1].reset();this._scene[2].reset();this._time.reset()};
f.evaluateMomentum=function(){if(!this.enabled||!this._screen[0].hasFilteredDelta()||!this._time.hasFilteredDelta())return null;var e=this._screen[0].filteredDelta,g=this._screen[1].filteredDelta;e=null==e||null==g?0:Math.sqrt(e*e+g*g);g=this._time.filteredDelta;e=null==g||null==e?0:e/g;return Math.abs(e)<this._minimumInitialVelocity?null:this.createMomentum(e,this._stopVelocity,this._friction)};f.createMomentum=function(e,g,h){b.set(this._tmpDirection,this._scene[0].filteredDelta??0,this._scene[1].filteredDelta??
0,this._scene[2].filteredDelta??0);const l=b.length(this._tmpDirection);0<l&&b.scale(this._tmpDirection,this._tmpDirection,1/l);const v=this._time.filteredDelta;return new m(e,g,h,null==v?0:l/v,this._tmpDirection)};return d}();a.PanPlanarMomentum=m;a.PanPlanarMomentumEstimator=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports"],function(a){let c=function(){function b(n){this._gain=n;this.filteredDelta=this.lastValue=
void 0}var t=b.prototype;t.update=function(n){if(this.hasLastValue()){const r=this.computeDelta(n);this._updateDelta(r)}this.lastValue=n};t.reset=function(){this.filteredDelta=this.lastValue=void 0};t.hasLastValue=function(){return void 0!==this.lastValue};t.hasFilteredDelta=function(){return void 0!==this.filteredDelta};t.computeDelta=function(n){return void 0===this.lastValue?NaN:n-this.lastValue};t._updateDelta=function(n){this.filteredDelta=void 0!==this.filteredDelta?(1-this._gain)*this.filteredDelta+
this._gain*n:n};return b}();a.FilteredFiniteDifference=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(r,m,d){this._initialVelocity=r;this._stopVelocity=m;this._friction=d;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}var n=t.prototype;n.isFinished=function(r){return r>
this.duration};n.value=function(r){return this.valueFromInitialVelocity(this._initialVelocity,r)};n.valueDelta=function(r,m){const d=this.value(r);return this.value(r+m)-d};n.valueFromInitialVelocity=function(r,m){m=Math.min(m,this.duration);const d=1-this.friction;return r*(d**m-1)/Math.log(d)};c._createClass(t,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);return t}();a.Momentum=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(a,c,b,t,n,r,m,d,f){let e=function(g){function h(v,q,k,p,z,C=0,B){v=g.call(this,v,q,k)||this;v._angularVelocity1=p;v.axis1=z;v.angularVelocity2=C;v.axis2=B;return v}c._inheritsLoose(h,g);var l=h.prototype;l.value1=
function(v){return g.prototype.valueFromInitialVelocity.call(this,this._angularVelocity1,v)};l.value2=function(v){return g.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,v)};return h}(f.Momentum);f=function(){function g(l=300,v=12,q=.84){this._minimumInitialVelocity=l;this._stopVelocity=v;this._friction=q;this.enabled=!0;this._tmpAxis1=n.create();this._tmpAxis2=n.create();this._tmpAngles=b.create();this._time=new m.FilteredFiniteDifference(.3);this._screen=[new m.FilteredFiniteDifference(.4),
new m.FilteredFiniteDifference(.4)];this._angle1=new d.FilteredValue(.6);this._angle2=new d.FilteredValue(.6);this._axis1=n.create();this._axis2=n.create();this._lastScene=n.create()}var h=g.prototype;h.addMomentumDirectRotation=function(l,v,q,k,p,z){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(q))return;k=r.rotationAngleAndAxisDirectRotation(this._lastScene,v,this._tmpAxis2,k,p,z);this._angle2.update(0);1E-5>t.squaredLength(this._tmpAxis2)?k=0:t.normalize(this._axis1,
this._tmpAxis2);this._angle1.update(k);t.copy(this._lastScene,v)}this._screen[0].update(l[0]);this._screen[1].update(l[1]);this._time.update(q)}};h.addMomentumPreserveHeading=function(l,v,q,k,p,z,C){if(this.enabled){if(this._time.hasLastValue()){if(.01>this._time.computeDelta(q))return;r.rotationAnglesAndAxesHeadingPreserving(this._lastScene,v,this._tmpAxis2,this._tmpAxis1,this._tmpAngles,k,p,z,C,!1);1E-5>t.squaredLength(this._tmpAxis2)?(this._angle1.update(0),this._angle2.update(0)):(this._angle1.update(this._tmpAngles[1]),
this._angle2.update(this._tmpAngles[0]),t.normalize(this._axis1,this._tmpAxis1),t.normalize(this._axis2,this._tmpAxis2));t.copy(this._lastScene,v)}this._screen[0].update(l[0]);this._screen[1].update(l[1]);this._time.update(q)}};h.reset=function(){this._screen[0].reset();this._screen[1].reset();this._angle1.reset();this._angle2.reset();this._time.reset()};h.evaluateMomentum=function(){if(!this.enabled||!this._screen[0].hasFilteredDelta())return null;var l=this._screen[0].filteredDelta,v=this._screen[1].filteredDelta;
l=null==l||null==v?null:Math.sqrt(l*l+v*v);v=this._time.filteredDelta;l=null==l||null==v?0:l/v;return Math.abs(l)<this._minimumInitialVelocity?null:this.createMomentum(l,this._stopVelocity,this._friction)};h.createMomentum=function(l,v,q){const k=this._time.filteredDelta,p=this._angle1.filteredValue,z=this._angle2.filteredValue;return new e(l,v,q,null==k||null==p?0:p/k,this._axis1,null==k||null==z?0:z/k,this._axis2)};return g}();a.PanSphericalMomentum=e;a.PanSphericalMomentumEstimator=f;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(r){this._gain=r}var n=t.prototype;n.update=function(r){this.filteredValue=void 0!==this.filteredValue?(1-this._gain)*this.filteredValue+this._gain*r:r};n.reset=function(){this.filteredValue=void 0};c._createClass(t,[{key:"hasFilteredValue",get:function(){return void 0!==this.filteredValue}}]);return t}();a.FilteredValue=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,c,b){b=function(t){function n(r=3,m=.01,d=.95,f=12){return t.call(this,r,m,d,f)||this}c._inheritsLoose(n,t);n.prototype.add=function(r,m){const d=this.value.lastValue;if(null!=d){for(r-=d;r>Math.PI;)r-=2*Math.PI;for(;r<-Math.PI;)r+=2*Math.PI;r=d+r}t.prototype.add.call(this,r,m)};return n}(b.MomentumEstimator);
a.RotationMomentumEstimator=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,c,b,t){let n=function(){function r(d=2.5,f=.01,e=.95,g=12){this._minimumInitialVelocity=d;this._stopVelocity=f;this._friction=e;this._maxVelocity=g;this.enabled=!0;this.value=new b.FilteredFiniteDifference(.8);this.time=new b.FilteredFiniteDifference(.3)}var m=
r.prototype;m.add=function(d,f){if(this.enabled&&null!=f){if(this.time.hasLastValue()){if(.01>this.time.computeDelta(f))return;if(this.value.hasFilteredDelta()){const e=this.value.computeDelta(d);0>this.value.filteredDelta*e&&this.value.reset()}}this.time.update(f);this.value.update(d)}};m.reset=function(){this.value.reset();this.time.reset()};m.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta()||!this.time.hasFilteredDelta())return null;let d=this.value.filteredDelta/this.time.filteredDelta;
d=c.clamp(d,-this._maxVelocity,this._maxVelocity);return Math.abs(d)<this._minimumInitialVelocity?null:this.createMomentum(d,this._stopVelocity,this._friction)};m.createMomentum=function(d,f,e){return new t.Momentum(d,f,e)};return r}();a.MomentumEstimator=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(a,c,b,t){let n=function(r){function m(f,
e,g){return r.call(this,f,e,g)||this}c._inheritsLoose(m,r);var d=m.prototype;d.value=function(f){f=r.prototype.value.call(this,f);return Math.exp(f)};d.valueDelta=function(f,e){const g=r.prototype.value.call(this,f);f=r.prototype.value.call(this,f+e);return Math.exp(f-g)};return m}(b.Momentum);b=function(r){function m(f=2.5,e=.01,g=.95,h=12){return r.call(this,f,e,g,h)||this}c._inheritsLoose(m,r);var d=m.prototype;d.add=function(f,e){r.prototype.add.call(this,Math.log(f),e)};d.createMomentum=function(f,
e,g){return new n(f,e,g)};return m}(t.MomentumEstimator);a.ZoomMomentum=n;a.ZoomMomentumEstimator=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/screenUtils ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/Error ../../../../../core/has ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/ConstraintTypes ../../../camera/constraintUtils/InteractionType ../../../camera/constraintUtils/TiltMode ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M){const N=q.fromValues(0,0,1);var P=16/180*Math.PI;a.PinchAndPanController=function(I){function G(){var L=I.apply(this,arguments)||this;L._rotationValueSmooth=new x.ExponentialFalloff(.05);L._scalingValueSmooth=new x.ExponentialFalloff(.05);L._planeHorizontal=p.create();L._planeVertical=p.create();L._rotationMomentumEstimator=new J.RotationMomentumEstimator;L._panMomentumEstimator=new K.PanPlanarMomentumEstimator(300,12,.9);L._zoomMomentumEstimator=
new M.ZoomMomentumEstimator;L._beginRadius=0;L._beginCenter=q.create();L._beginAngle=0;L._tmpPoints=[];L._panMode=F.NavigationMode.Horizontal;L._beginCenterScreen=r.createScreenPointArray();L._tmpCentroid3d=q.create();L._tmpCentroid2d=r.createScreenPointArray();L._tmp2d=r.createScreenPointArray();L._pointerCount=0;L._constraintOptions={selection:C.ConstraintTypes.ALL,interactionType:B.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new E.Camera,interactionDirection:null,tiltMode:A.TiltMode.TUMBLE};
return L}c._inheritsLoose(G,I);var H=G.prototype;H.begin=function(L){if(this.active){var O=this.view.navigation.momentumEnabled;this._zoomMomentumEstimator.enabled=O;this._rotationMomentumEstimator.enabled=O;this._panMomentumEstimator.enabled=O;this._beginRadius=L.radius;this._pointerCount=L.pointers.size;this._beginAngle=L.angle;this._rotationValueSmooth.reset();this._scalingValueSmooth.reset();r.screenPointObjectToArray(L.center,this._beginCenterScreen);p.fromNormalAndOffset(N,0,this._planeHorizontal);
var S=q.create();O=this._intersectionHelper.intersectScreenFreePointFallback(this._beginCenterScreen,S,0===this.view.map.ground.opacity?F.contentIntersectorOptions:{});var R=q.create();v.negate(R,this.startCamera.viewForward);var Q=q.create();v.copy(Q,N);var V=v.dot(R,Q);this._panMode=t.asinClamped(0>V?-V:V)>=P?F.NavigationMode.Horizontal:F.NavigationMode.Vertical;var aa=Math.min(F.PAN_DISTANCE_MODIFIER,1/Math.abs(v.dot(Q,this.startCamera.viewForward)))*Math.max(Math.abs(this.view.camera.position.z),
F.MIN_HEIGHT_LIMIT);p.setOffsetFromPoint(this._planeHorizontal,this._planeHorizontal,S);this.startCamera.aboveGround||p.negate(this._planeHorizontal,this._planeHorizontal);var X=q.create(),W=q.create(),T=q.create();v.subtract(X,S,this.currentCamera.eye);var U=v.length(X);v.normalize(X,X);this._panMode===F.NavigationMode.Vertical?(v.scale(Q,Q,V),v.subtract(this._planeVertical,R,Q),v.normalize(this._planeVertical,this._planeVertical),p.setOffsetFromPoint(this._planeVertical,this._planeVertical,S),S=
this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this._beginCenterScreen[0],this._beginCenterScreen[1],this.view.state.camera,F.SCREEN_PIXEL_AREA),aa=n.isSome(S)?S:aa,aa=O?Math.min(aa,U):aa,v.copy(T,v.add(W,this.currentCamera.eye,v.scale(W,X,aa))),this._planeVertical[3]=-v.dot(this._planeVertical,T),this._computePlanePoints(L.pointers,this._planeVertical,this.startCamera,this._tmpPoints)):(v.copy(T,v.add(W,this.currentCamera.eye,v.scale(W,X,O?U:aa))),this._planeHorizontal[3]=
-v.dot(p.normal(this._planeHorizontal),T),this._computePlanePoints(L.pointers,this._planeHorizontal,this.startCamera,this._tmpPoints));F.centroid(this._tmpPoints,this._beginCenter);this._constraintOptions.interactionStartCamera?.copyFrom(this.startCamera)}};H.update=function(L){if(this.active){this.currentCamera.copyFrom(this.startCamera);var O=1<L.pointers.size,S=this._panMode===F.NavigationMode.Horizontal?this._planeHorizontal:this._planeVertical,R=this._beginCenter;if(O){var Q=this._beginRadius/
L.radius;this._scalingValueSmooth.gain=.001875*Math.min(Math.max(L.radius,40),120);this._scalingValueSmooth.update(Q);F.applyZoomToPoint(this.currentCamera,R,this._scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this._zoomMomentumEstimator.add(this._scalingValueSmooth.value,.001*L.timestamp);this._constraintOptions.interactionType=B.InteractionType.ZOOM;this._constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(Math.abs(L.radius-this._beginRadius));z.applyAll(this.view,
this.currentCamera,this._constraintOptions)}this._computePlanePoints(L.pointers,S,this.currentCamera,this._tmpPoints);F.centroid(this._tmpPoints,this._tmpCentroid3d);r.screenPointObjectToArray(L.center,this._tmpCentroid2d);F.applyPanPlanar(this.currentCamera,R,this._tmpCentroid3d);this._panMomentumEstimator.add(this._tmpCentroid2d,this._tmpCentroid3d,.001*L.timestamp);this._constraintOptions.interactionType=B.InteractionType.PAN;this._constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(l.distance(this._beginCenterScreen,
this._tmpCentroid2d));z.applyAll(this.view,this.currentCamera,this._constraintOptions);O&&(O=this._planeHorizontal,S=this._rotationValueSmooth.value,Q=F.normalizeRotationDelta(L.angle-S),this._rotationValueSmooth.gain=.00125*Math.min(Math.max(L.radius,40),120),this._rotationValueSmooth.update(S+Q),S=this._rotationValueSmooth.value-this._beginAngle,this._rotationMomentumEstimator.add(S,.001*L.timestamp),F.applyRotation(this.currentCamera,R,k.wrapAxisAngle(O,S)),this._constraintOptions.interactionType=
B.InteractionType.TUMBLE,this._constraintOptions.interactionFactor=z.pixelDistanceToInteractionFactor(Math.abs(L.radius*S)),z.applyAll(this.view,this.currentCamera,this._constraintOptions));this.commitCamera()}};H.end=function(L){L.pointers.size===this._pointerCount&&this.update(L);this.finishController();return(L=this._zoomMomentumEstimator.evaluateMomentum())?new D.ZoomPlanarMomentumController({view:this.view,momentum:L,zoomCenter:this._beginCenter}):(L=this._rotationMomentumEstimator.evaluateMomentum())?
new w.RotationMomentumController({view:this.view,momentum:L,center:this._beginCenter,axis:p.normal(this._planeHorizontal)}):(L=this._panMomentumEstimator.evaluateMomentum())?new y.PanPlanarMomentumController({view:this.view,momentum:L}):null};H._computePlanePoints=function(L,O,S,R){R.length=L.size;const Q=this._tmp2d;let V=0;L.forEach(aa=>{Q[0]=aa.x;Q[1]=aa.y;void 0===R[V]&&(R[V]=q.create());F.intersectPlaneFromScreenPointAtEye(O,S,Q,R[V]);V+=1});return R};c._createClass(G,[{key:"_intersectionHelper",
get:function(){return this.view.sceneIntersectionHelper}}]);return G}(u.InteractiveController);a.PinchAndPanController=b.__decorate([h.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],a.PinchAndPanController);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,c,b){b=function(t){function n(r,
m){var d=t.call(this,!0)||this;d.view=r;d.registerIncoming("pointer-down",m,()=>d.view.state.stopActiveCameraController());return d}c._inheritsLoose(n,t);return n}(b.InputHandler);a.PointerDownCancelAnimation=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,c,b){b=function(t){function n(r,m,d){m=t.call(this,m,d)||this;m.view=r;
return m}c._inheritsLoose(n,t);n.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>{})};return n}(b.SingleKey);a.SingleKeyResetHeading=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,c,b){b=function(t){function n(r,m){var d=t.call(this,!0)||this;d.key=r;d.registerIncoming("key-down",m,f=>d._handleKeyDown(f));
return d}c._inheritsLoose(n,t);n.prototype._handleKeyDown=function(r){r.data.key===this.key&&(this.activate(),r.stopPropagation())};return n}(b.InputHandler);a.SingleKey=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,c,b){b=function(t){function n(r,m,d){m=t.call(this,m,d)||this;m.view=r;return m}c._inheritsLoose(n,t);n.prototype.activate=
function(){this.view.goTo({tilt:0}).catch(()=>{})};return n}(b.SingleKey);a.SingleKeyResetTilt=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../state/controllers/RotateController","../../../input/InputHandler"],function(a,c,b,t,n){n=function(r){function m(d,f=!1){var e=r.call(this,!0)||this;e._view=d;e._invert=f;e.registerIncoming("vertical-two-finger-drag",
g=>e._handleTwoFinger(g));return e}c._inheritsLoose(m,r);m.prototype._handleTwoFinger=function(d){const f=b.createScreenPointArray(0,d.data.delta*(this._invert?-1:1));switch(d.data.action){case "begin":this._cameraController?.end();this._cameraController=new t.RotateController({view:this._view,pivot:t.PivotPoint.CENTER});this._view.state.switchCameraController(this._cameraController);this._cameraController.begin(f);break;case "update":this._cameraController?.update(f);break;case "end":this._cameraController?.end(),
this._cameraController=null}};return m}(n.InputHandler);a.TwoFingerTilt=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),function(a,c,b,t,n,r,m){const d=b("edge"),f=b("chrome"),e=b("ff"),g=b("safari");b=function(){function l(q,k){this._input=k;this._active={};this._callback=()=>{};
this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=q;q.getAttribute("tabindex")||q.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,
"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new r.GamepadSource(q,this._input);this._gamepadSource.onEvent=p=>this._callback("gamepad",p)}var v=l.prototype;v.destroy=function(){this._callback=()=>{};this.activeEvents=null;this._activePointerCaptures.forEach(q=>{this._releasePointerCaptureSafe(q)});this._gamepadSource=t.destroyMaybe(this._gamepadSource);
this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};v.setPointerCapture=function(q,k){k?(this._element.setPointerCapture(q.pointerId),this._activePointerCaptures.add(q.pointerId)):(this._releasePointerCaptureSafe(q.pointerId),this._activePointerCaptures.delete(q.pointerId))};v._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?"esri-view-surface--touch-none":"esri-view-surface--touch-pan");
this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};v._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};v._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");this._element.classList.remove("esri-view-surface--touch-pan");
this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};v._releasePointerCaptureSafe=function(q){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(q)||this._element.releasePointerCapture(q)}catch(k){}};v._updateNormalizedPointerLikeEvent=function(q,k){q=m.createScreenPointFromNativeEvent(this._element,q);l.test.disableSubpixelCoordinates&&(q.x=Math.round(q.x),q.y=Math.round(q.y));k.x=q.x;k.y=q.y;return k};v._handleKey=function(q,k){const p=n.eventKey(k);
p&&"key-up"===q&&this._keyDownState.delete(p);k={native:k,key:p,repeat:!!p&&this._keyDownState.has(p)};p&&"key-down"===q&&this._keyDownState.add(k.key);this._callback(q,k)};v._handlePointer=function(q,k){k=this._updateNormalizedPointerLikeEvent(k,{native:k,x:0,y:0,pointerType:k.pointerType,button:k.button,buttons:k.buttons,eventId:this._eventId++});this._callback(q,k)};v._handlePointerPreventDefault=function(q,k){const p=this._updateNormalizedPointerLikeEvent(k,{native:k,x:0,y:0,pointerType:k.pointerType,
button:k.button,buttons:k.buttons,eventId:this._eventId++});k.preventDefault();this._callback(q,p)};v._handleMouseWheel=function(q,k){let p=k.deltaY;switch(k.deltaMode){case 0:d&&(p=p/document.documentElement.clientHeight*600);break;case 1:p*=30;break;case 2:p*=900}d?p*=.7:f||g?p*=.6:e&&(p*=1.375);const z=Math.abs(p);100<z&&(p=p/z*200/(1+Math.exp(-.02*(z-100))));k=this._updateNormalizedPointerLikeEvent(k,{native:k,x:0,y:0,deltaY:p});this._callback(q,k)};v._handlePointerCaptureLost=function(q,k){this._activePointerCaptures.delete(k.pointerId);
this._handleDefault(q,k)};v._handleDefault=function(q,k){const p={native:k};k.preventDefault();this._callback(q,p)};v._preventAltKeyDefault=function(q){"Alt"===q.key&&q.preventDefault()};v._preventMultiTouchPanning=function(q){1<q.touches.length&&q.preventDefault()};c._createClass(l,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(q){this._browserTouchPanningEnabled=q;this._updateTouchAction();this._updateTouchEventHandling()}},{key:"onEventReceived",
set:function(q){this._callback=q}},{key:"activeEvents",set:function(q){for(const k in this._active)q&&q.has(k)||(this._element.removeEventListener(h[k],this._active[k]),delete this._active[k]);q&&q.forEach(k=>{if(!this._active[k]&&h[k]){const p=(this._eventHandlers[k]||this._handleDefault).bind(this,k);this._element.addEventListener(h[k],p);this._active[k]=p}});this._gamepadSource.hasEventListeners=q?.has("gamepad")??!1}}]);return l}();b.test={disableSubpixelCoordinates:!1};const h={"key-down":"keydown",
"key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,c,b,t,n){let r=function(){function m(f,e){this._element=f;this._input=e;this._hasEventListeners=!1;this._onConnectGamepad=g=>{this._connectGamepad(g.gamepad)};this._onDisconnectGamepad=g=>{g=g.gamepad;const h=g.index,l=this._inputDevices[h];l&&(this._emitGamepadEvent(g,n.extractState(l),!1),this._inputDevices.splice(h,1),this._latestUpdate.splice(h,1),this._input.gamepad.devices.remove(l),
this.ensurePollingState())};this._frameTask=null;this._latestUpdate=[];this._inputDevices=[];this._callback=null;f=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&f)this._forEachGamepad(g=>this._connectGamepad(g)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}var d=m.prototype;d.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",
this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))};d._connectGamepad=function(f){const e=new t(f);"unknown"!==e.deviceType&&(this._inputDevices[f.index]=e,this._input.gamepad.devices.add(e));this.ensurePollingState()};d.ensurePollingState=function(){this._eventsEnabled?this._startPolling():this._stopPolling()};d._startPolling=function(){null==this._frameTask&&(this._frameTask=b.addFrameTask({update:()=>this._readGamepadState()}))};d._stopPolling=
function(){null!=this._frameTask&&(this._frameTask.remove(),this._frameTask=null,this._latestUpdate=[])};d._readGamepadState=function(){const f=document.hasFocus(),e=this._element.contains(document.activeElement),g="document"===this._input.gamepad.enabledFocusMode&&!f||"view"===this._input.gamepad.enabledFocusMode&&!e;this._forEachGamepad(h=>{var l=this._inputDevices[h.index];if(l){var v=this._latestUpdate[h.index];l=n.extractState(l);var q=g||n.stateIdle(l);v&&(v.timestamp===h.timestamp||!v.active&&
q||n.stateEqual(v.state,l))||this._emitGamepadEvent(h,l,!q)}})};d._forEachGamepad=function(f){const e=window.navigator.getGamepads();for(let g=0;g<e.length;g++){const h=e[g];this._validate(h)&&f(h)}};d._emitGamepadEvent=function(f,e,g){var h=this._latestUpdate[f.index];if((h=h&&h.active)||g)this._latestUpdate[f.index]={timestamp:f.timestamp,state:e,active:g},this._callback&&this._callback({device:this._inputDevices[f.index],state:e,action:!h&&g?"start":h&&g?"update":"end"})};d._validate=function(f){if(!f||
!f.connected)return!1;for(let e=0;e<f.axes.length;e++)if(isNaN(f.axes[e]))return!1;return!0};c._createClass(m,[{key:"hasEventListeners",set:function(f){this._hasEventListeners!==f&&(this._hasEventListeners=f,this.ensurePollingState())}},{key:"_eventsEnabled",get:function(){return this.supported&&0<this._inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(f){this._callback=f}}]);return m}();a.GamepadSource=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],
function(a){a.extractState=function(c){const b=c.native;return b?{buttons:b.buttons.map(t=>t.pressed?t.value?t.value:1:0),axes:b.axes.map(t=>{{var n=c.axisThreshold;const r=Math.abs(t);t=r<n?0:Math.sign(t)*(r-n)/(1-n)}return t})}:{buttons:[],axes:[]}};a.stateEqual=function(c,b){if(c.axes.length!==b.axes.length||c.buttons.length!==b.buttons.length)return!1;for(var t=0;t<c.axes.length;t++)if(c.axes[t]!==b.axes[t])return!1;for(t=0;t<c.buttons.length;t++)if(c.buttons[t]!==b.buttons[t])return!1;return!0};
a.stateIdle=function(c){for(var b=0;b<c.axes.length;b++)if(0!==c.axes[b])return!1;for(b=0;b<c.buttons.length;b++)if(0!==c.buttons[b])return!1;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../InputHandler"],function(a,c,b){b=function(t){function n(){var r=t.call(this,!0)||this;r.registerIncoming("context-menu",m=>{m.data.native.preventDefault()});return r}
c._inheritsLoose(n,t);return n}(b.InputHandler);a.PreventContextMenu=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../core/time ../InputHandler ./support".split(" "),function(a,c,b,t,n,r){function m(g){const h=[];g.forEach(l=>{h.push(b.createScreenPoint(l.event.x,l.event.y))});return r.fitCircleLSQ(h)}function d(g){const h=m(g);let l=0;g.forEach(v=>
{var q=e(v,h);for(q-=v.lastAngle;q>Math.PI;)q-=2*Math.PI;for(;q<-Math.PI;)q+=2*Math.PI;q=v.lastAngle+q;v.lastAngle=q;l+=q-v.initialAngle});l/=g.size||1;return{angle:l,radius:h.radius,center:h.center}}function f(g){const h=new Map;g.forEach((l,v)=>h.set(v,l.event));return h}function e(g,h){g=g.event;return Math.atan2(g.y-h.center.y,g.x-h.center.x)}n=function(g){function h(v){var q=g.call(this,!1)||this;q._navigationTouch=v;q._startStateModifiers=new Set;q._activePointerMap=new Map;q._isDragging=!1;
q._isCurrentDragSuppressed=!1;q._drag=q.registerOutgoing("drag");q.registerIncoming("pointer-drag",q._handlePointerDrag.bind(c._assertThisInitialized(q)));q.registerIncoming("pointer-up",q._handlePointerUpAndPointerLost.bind(c._assertThisInitialized(q)));q.registerIncoming("pointer-capture-lost",q._handlePointerUpAndPointerLost.bind(c._assertThisInitialized(q)));q.registerIncoming("pointer-cancel",q._handlePointerUpAndPointerLost.bind(c._assertThisInitialized(q)));return q}c._inheritsLoose(h,g);var l=
h.prototype;l._createPayload=function(v,q,k,p){return{action:v,pointerType:this._pointerType,button:this._mouseButton,buttons:q.buttons,timestamp:p,pointers:f(this._activePointerMap),pointer:q,angle:k.angle,radius:k.radius,center:k.center}};l._addPointer=function(v){var q=v.native.pointerId;const k=d(this._activePointerMap).angle;v={event:v,initialAngle:0,lastAngle:0};this._activePointerMap.set(q,v);q=e(v,m(this._activePointerMap));v.initialAngle=q;v.lastAngle=q;this._updatePointerAngles(k)};l._updatePointer=
function(v){if(!v||null!=v.x||null!=v.y){var q=this._activePointerMap.get(v.native.pointerId);q?q.event=v:this._addPointer(v)}};l._removePointer=function(v){const q=d(this._activePointerMap).angle;this._activePointerMap.delete(v);this._updatePointerAngles(q)};l._updatePointerAngles=function(v){const q=d(this._activePointerMap);this._activePointerMap.forEach(k=>{k.initialAngle=e(k,q)-v;k.lastAngle=e(k,q)-v})};l._emitEvent=function(v,q,k){const p=d(this._activePointerMap);this._drag.emit(this._createPayload(v,
q,p,k),void 0,this._startStateModifiers)};l._handlePointerUpAndPointerLost=function(v){const q=v.data.native.pointerId,k=t.Milliseconds(v.timestamp);this._activePointerMap.get(q)&&(1===this._activePointerMap.size?(this._updatePointer(v.data),!this._isCurrentDragSuppressed&&this._emitEvent("end",v.data,k),this._isCurrentDragSuppressed=this._isDragging=!1,this._removePointer(q)):(this._removePointer(q),this._emitEvent("removed",v.data,t.Milliseconds(v.timestamp))))};l._handlePointerDrag=function(v){const q=
v.data,k=q.currentEvent,p=t.Milliseconds(v.timestamp);switch(q.action){case "start":case "update":this._isDragging?this._activePointerMap.has(k.native.pointerId)?(this._updatePointer(k),!this._isCurrentDragSuppressed&&this._emitEvent("update",k,p)):(this._addPointer(k),this._emitEvent("added",k,p),this._isCurrentDragSuppressed=this._isSuppressed):(this._updatePointer(k),this._pointerType=v.data.startEvent.pointerType,this._mouseButton=v.data.startEvent.button,this._startStateModifiers=v.modifiers,
this._isDragging=!0,this._isCurrentDragSuppressed=this._isSuppressed,!this._isCurrentDragSuppressed&&this._emitEvent("start",k,p))}};c._createClass(h,[{key:"_isSuppressed",get:function(){return!!this._navigationTouch&&!this._navigationTouch.browserTouchPanEnabled&&"touch"===this._pointerType&&1===this._activePointerMap.size}}]);return h}(n.InputHandler);a.Button=void 0;(function(g){g[g.Left=0]="Left";g[g.Middle=1]="Middle";g[g.Right=2]="Right";g[g.Back=3]="Back";g[g.Forward=4]="Forward";g[g.Undefined=
-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,c){a.euclideanDistance=function(b,t){const n=t.x-b.x;b=t.y-b.y;return Math.sqrt(n*n+b*b)};a.fitCircleLSQ=function(b,t){t?(t.radius=0,t.center.x=0,t.center.y=0):t={radius:0,center:c.createScreenPoint()};if(0===b.length)return t;if(1===b.length)return t.center.x=b[0].x,t.center.y=
b[0].y,t;if(2===b.length){const [k,p]=b,[z,C]=[p.x-k.x,p.y-k.y];t.radius=Math.sqrt(z*z+C*C)/2;t.center.x=(k.x+p.x)/2;t.center.y=(k.y+p.y)/2;return t}let n=0,r=0;for(t=0;t<b.length;t++)n+=b[t].x,r+=b[t].y;n/=b.length;r/=b.length;var m=b.map(k=>k.x-n),d=b.map(k=>k.y-r);let f=t=0;var e=0,g=0,h=0,l=0,v=0;for(var q=0;q<m.length;q++){const k=m[q],p=d[q],z=k*k,C=p*p;t+=z;f+=C;e+=k*p;g+=z*k;h+=C*p;l+=k*C;v+=p*z}m=t;d=e;q=f;g=.5*(g+l);h=.5*(h+v);v=m*q-e*d;l=(g*q-h*d)/v;h=(m*h-e*g)/v;v=c.createScreenPoint(l+
n,h+r);return{radius:Math.sqrt(l*l+h*h+(t+f)/b.length),center:v}};a.getPointerId=function(b){({native:b}=b);const {pointerId:t,button:n,pointerType:r}=b;return"mouse"===r?`${t}:${n}`:`${r}`};a.manhattanDistance=function(b,t){return Math.abs(t.x-b.x)+Math.abs(t.y-b.y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),
function(a,c,b,t,n,r){t=function(m){function d(e=n.DefaultParameters.maximumDoubleClickDelay,g=n.DefaultParameters.maximumDoubleClickDistance,h=n.DefaultParameters.maximumDoubleTouchDelay,l=n.DefaultParameters.maximumDoubleTouchDistance,v=b.clock){var q=m.call(this,!1)||this;q._maximumDoubleClickDelay=e;q._maximumDoubleClickDistance=g;q._maximumDoubleTouchDelay=h;q._maximumDoubleTouchDistance=l;q._clock=v;q._pointerState=new Map;q._immediateDoubleClick=q.registerOutgoing("immediate-double-click");
q.registerIncoming("pointer-down",q._handlePointerDown.bind(c._assertThisInitialized(q)));q.registerIncoming("pointer-up",q._handlePointerUp.bind(c._assertThisInitialized(q)));return q}c._inheritsLoose(d,m);var f=d.prototype;f.onUninstall=function(){this._pointerState.forEach(e=>{e.immediateDoubleClick&&e.immediateDoubleClick.timeoutHandle.remove()});m.prototype.onUninstall.call(this)};f._handlePointerDown=function(e){e=e.data;const g=r.getPointerId(e);this._pointerState.has(g)||(this._pointerState.set(g,
{downButton:e.native.button,immediateDoubleClick:null}),this.startCapturingPointer(e.native))};f._handlePointerUp=function(e){const g=e.data;var h=r.getPointerId(g);if((h=this._pointerState.get(h))&&h.downButton===g.native.button){const l=h.immediateDoubleClick;if(l){l.timeoutHandle.remove();const v="touch"===e.data.native.pointerType?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;r.manhattanDistance(l,e.data)>v?this._startImmediateDoubleClick(e,h):(this._immediateDoubleClick.emit(e.data,
void 0,l.modifiers),this._removeState(g))}else this._startImmediateDoubleClick(e,h)}};f._startImmediateDoubleClick=function(e,g){g.immediateDoubleClick={x:e.data.x,y:e.data.y,modifiers:e.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(e.data),"touch"===e.data.native.pointerType?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay)}};f._removeState=function(e){const g=r.getPointerId(e);this._pointerState.delete(g);this.stopCapturingPointer(e.native);this.refreshHasPendingInputs()};
return d}(t.InputHandler);a.ImmediateDoubleClick=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),function(a,c,b,t,n,r,m){const d={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};r=function(f){function e(h=
d.maximumDoubleClickDelay,l=d.maximumDoubleClickDistance,v=d.maximumDoubleTouchDelay,q=d.maximumDoubleTouchDistance,k=b.clock){var p=f.call(this,!1)||this;p._maximumDoubleClickDelay=h;p._maximumDoubleClickDistance=l;p._maximumDoubleTouchDelay=v;p._maximumDoubleTouchDistance=q;p._clock=k;p._pointerState=new Map;p._click=p.registerOutgoing("click");p._doubleClick=p.registerOutgoing("double-click");p.registerIncoming("immediate-click",p._handleImmediateClick.bind(c._assertThisInitialized(p)));p.registerIncoming("pointer-down",
p._handlePointerDown.bind(c._assertThisInitialized(p)));return p}c._inheritsLoose(e,f);var g=e.prototype;g.onUninstall=function(){this._pointerState.forEach(h=>h.doubleClickTimer=n.removeMaybe(h.doubleClickTimer))};g._clearDoubleClickTimer=function(h,l){const v=this._pointerState.get(h);v&&(v.doubleClickTimer=n.removeMaybe(v.doubleClickTimer),l&&this._click.emit(v.event.data,void 0,v.event.modifiers),this._pointerState.delete(h),this.refreshHasPendingInputs())};g._doubleClickTimeoutExceeded=function(h){const l=
this._pointerState.get(h);1===l.pointerDownCount&&this._click.emit(l.event.data,void 0,l.event.modifiers);l.doubleClickTimer=null;this._pointerState.delete(h);this.refreshHasPendingInputs()};g._getPointerId=function(h){const {pointerId:l,pointerType:v,button:q}=h.native;return"mouse"===v?`${l}:${q}`:`${v}`};g._handleImmediateClick=function(h){const l=h.data;var {pointerType:v}=l.native;const q=this._getPointerId(l);if(this._pointerState.has(q)){var k=this._pointerState.get(q),{data:p,modifiers:z}=
k.event;v="touch"===v?this._maximumDoubleTouchDistance:this._maximumDoubleClickDistance;m.manhattanDistance(p,l)>v?(this._clearDoubleClickTimer(q,!0),this._startClick(h)):(this._clearDoubleClickTimer(q,!1),2===k.pointerDownCount&&this._doubleClick.emit(p,void 0,z))}else this._startClick(h)};g._handlePointerDown=function(h){h=m.getPointerId(h.data);if(h=this._pointerState.get(h))h.pointerDownCount+=1};g._startClick=function(h){var {data:l}=h;const {native:{pointerType:v}}=l,q=m.getPointerId(l);l=this._clock.setTimeout(()=>
this._doubleClickTimeoutExceeded(q),"touch"===v?this._maximumDoubleTouchDelay:this._maximumDoubleClickDelay);this._pointerState.set(q,{event:h,doubleClickTimer:l,pointerDownCount:1});this.refreshHasPendingInputs()};c._createClass(e,[{key:"hasPendingInputs",get:function(){return t.someMap(this._pointerState,h=>null!=h.doubleClickTimer)}}]);return e}(r.InputHandler);a.DefaultParameters=d;a.SingleAndDoubleClick=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/maybe ../InputHandler ./support".split(" "),
function(a,c,b,t,n,r){const m={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};n=function(d){function f(g=m.maximumClickDelay,h=m.movementUntilMouseDrag,l=m.movementUntilPenDrag,v=m.movementUntilTouchDrag,q=m.holdDelay,k=b.clock){var p=d.call(this,!1)||this;p._maximumClickDelay=g;p._movementUntilMouseDrag=h;p._movementUntilPenDrag=l;p._movementUntilTouchDrag=v;p._holdDelay=q;p._clock=k;p._pointerState=new Map;p._pointerDrag=p.registerOutgoing("pointer-drag");
p._immediateClick=p.registerOutgoing("immediate-click");p._pointerHold=p.registerOutgoing("hold");p.registerIncoming("pointer-down",p._handlePointerDown.bind(c._assertThisInitialized(p)));p.registerIncoming("pointer-up",z=>{p._handlePointerLoss(z,"pointer-up")});p.registerIncoming("pointer-capture-lost",z=>{p._handlePointerLoss(z,"pointer-capture-lost")});p.registerIncoming("pointer-cancel",z=>{p._handlePointerLoss(z,"pointer-cancel")});p._moveHandle=p.registerIncoming("pointer-move",p._handlePointerMove.bind(c._assertThisInitialized(p)));
p._moveHandle.pause();return p}c._inheritsLoose(f,d);var e=f.prototype;e.onUninstall=function(){this._pointerState.forEach(g=>{g.holdTimeout=t.removeMaybe(g.holdTimeout)});d.prototype.onUninstall.call(this)};e._handlePointerDown=function(g){const h=g.data,l=h.native.pointerId;var v=null;0===this._pointerState.size&&(v=this._clock.setTimeout(()=>{const q=this._pointerState.get(l);q&&(q.isDragging||(this._pointerHold.emit(q.previousEvent,void 0,g.modifiers),q.holdEmitted=!0),q.holdTimeout=null)},this._holdDelay));
v={startEvent:h,previousEvent:h,startTimestamp:g.timestamp,isDragging:!1,downButton:h.native.button,holdTimeout:v,modifiers:new Set};this._pointerState.set(l,v);this.startCapturingPointer(h.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(g)};e._createPointerDragData=function(g,h,l){return{action:g,startEvent:h.startEvent,previousEvent:h.previousEvent,currentEvent:l}};e._handlePointerMove=function(g){const h=g.data,l=this._pointerState.get(h.native.pointerId);if(l){if(l.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",
l,h),void 0,l.modifiers);else{const v=r.euclideanDistance(h,l.startEvent),q=this._getDragThreshold(h.native.pointerType);v>q&&this._startDragging(g)}l.previousEvent=h}};e._getDragThreshold=function(g){switch(g){case "touch":return this._movementUntilTouchDrag;case "pen":return this._movementUntilPenDrag;default:return this._movementUntilMouseDrag}};e._startDragging=function(g){const h=g.data,l=h.native.pointerId;this._pointerState.forEach(v=>{null!=v.holdTimeout&&(v.holdTimeout.remove(),v.holdTimeout=
null);v.isDragging||(v.modifiers=g.modifiers,v.isDragging=!0,l===v.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",v,h)):this._pointerDrag.emit(this._createPointerDragData("start",v,v.previousEvent),g.timestamp))})};e._handlePointerLoss=function(g,h){const l=g.data,v=l.native.pointerId,q=this._pointerState.get(v);q&&(null!=q.holdTimeout&&(q.holdTimeout.remove(),q.holdTimeout=null),q.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",q,"pointer-up"===
h?l:q.previousEvent),void 0,q.modifiers):"pointer-up"===h&&q.downButton===l.native.button&&g.timestamp-q.startTimestamp<=this._maximumClickDelay&&!q.holdEmitted&&this._immediateClick.emit(l),this._pointerState.delete(v),this.stopCapturingPointer(l.native),0===this._pointerState.size&&this._moveHandle.pause())};return f}(n.InputHandler);a.DefaultParameters=m;a.PointerClickHoldAndDrag=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../DragEventSeparator","../InputHandler"],function(a,c,b,t){t=function(n){function r(d=20,f=40){var e=n.call(this,!1)||this;e._threshold=d;e._maxDelta=f;e._state="ready";e._emittedArtificalEnd2=!1;e._vertical=e.registerOutgoing("vertical-two-finger-drag");e._artificalDrag=e.registerOutgoing("drag");e._dragEventSeparator=new b.DragEventSeparator({start:(g,h)=>e._observeStart(g,h),update:(g,h,l)=>e._observeUpdate(g,h,l),end:(g,h)=>e._observeEnd(h)});e.registerIncoming("drag",
g=>e._dragEventSeparator.handle(g));return e}c._inheritsLoose(r,n);var m=r.prototype;m._observeStart=function(d,f){1===d&&this._emittedArtificalEnd2&&(this._emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:f.data.button,buttons:f.data.buttons,pointerType:f.data.pointerType,timestamp:f.data.timestamp,pointers:f.data.pointers,pointer:f.data.pointer,angle:f.data.angle,radius:f.data.radius,center:f.data.center}),f.stopPropagation());this._state=2===d?"ready":"failed"};m._observeUpdate=
function(d,f,e){"failed"!==this._state&&2===d&&("active"===this._state?(this._vertical.emit({delta:f.data.center.y-this._thresholdReachedCenter.y,action:"update"}),f.stopPropagation()):this._checkMovementWithinLimits(f.data,e.data)?this._checkVerticalThresholdReached(f.data,e.data)&&(this._state="active",this._emittedArtificalEnd2=!0,this._thresholdReachedCenter=f.data.center,this._artificalDrag.emit({action:"end",button:f.data.button,buttons:f.data.buttons,pointerType:f.data.pointerType,timestamp:f.data.timestamp,
pointers:f.data.pointers,pointer:f.data.pointer,angle:f.data.angle,radius:f.data.radius,center:f.data.center}),this._vertical.emit({delta:f.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),f.stopPropagation()):this._state="failed")};m._observeEnd=function(d){"active"===this._state&&(this._vertical.emit({delta:d.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this._state="ready",d.stopPropagation())};m._checkMovementWithinLimits=function(d,f){let e=-Infinity,g=Infinity,h=-Infinity,
l=Infinity;for(const {x:z,y:C}of f.pointers.values())e=Math.max(e,z),g=Math.min(g,z),h=Math.max(h,C),l=Math.min(l,C);let v=-Infinity,q=Infinity,k=-Infinity,p=Infinity;for(const {x:z,y:C}of d.pointers.values())v=Math.max(v,z),q=Math.min(q,z),k=Math.max(k,C),p=Math.min(p,C);return Math.abs(d.center.x-f.center.x)<this._threshold&&Math.abs(v-q-(e-g))<=this._maxDelta&&Math.abs(k-p-(h-l))<=this._maxDelta};m._checkVerticalThresholdReached=function(d,f){let e=Math.abs(d.center.y-f.center.y);d.pointers.forEach((g,
h)=>{h=f.pointers.get(h);e=Math.min(e,Math.abs(g.y-h.y))});return e>=this._threshold};c._createClass(r,[{key:"failed",get:function(){return"failed"===this._state}}]);return r}(t.InputHandler);a.VerticalTwoFingerDrag=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){let c=function(){function b(n){this._callbacks=n;this._currentCount=0;this._callbacks.condition||(this._callbacks.condition=()=>!0)}var t=b.prototype;
t.handle=function(n){const r=n.data,m=r.pointers.size;switch(r.action){case "start":this._currentCount=m;this._emitStart(n);break;case "added":this._emitEnd(this._previousEvent);this._currentCount=m;this._emitStart(n);break;case "update":this._emitUpdate(n);break;case "removed":this._startEvent&&this._emitEnd(this._previousEvent);this._currentCount=m;this._emitStart(n);break;case "end":this._emitEnd(n),this._currentCount=0}this._previousEvent=n};t._emitStart=function(n){this._startEvent=n;this._callbacks.condition?.(this._currentCount,
n)&&this._callbacks.start(this._currentCount,n,this._startEvent)};t._emitUpdate=function(n){this._callbacks.condition?.(this._currentCount,n)&&this._callbacks.update(this._currentCount,n,this._startEvent)};t._emitEnd=function(n){this._callbacks.condition?.(this._currentCount,n)&&this._callbacks.end(this._currentCount,n,this._startEvent);this._startEvent=null};return b}();a.DragEventSeparator=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){function C(A){A=A.layer;return!(!A||!A.featureReduction||"selection"!==A.featureReduction.type)}function B(A){(A=A.graphics3DGraphics)&&A.forEach(x=>x.clearVisibilityFlag(k.VisibilityFlag.DECONFLICTION))}a.GraphicsDeconflictor=function(A){function x(){var y=A.apply(this,arguments)||this;y._handles=new t;y._contexts=new Map;y._viewState=new q.DeconflictorViewState;y.visibilityGroup=k.VisibilityGroup.GRAPHIC;y._iconMarginFactor=-.1;return y}c._inheritsLoose(x,
A);var u=x.prototype;u.initialize=function(){this._handles.add([m.watch(()=>this.view?.state?.camera,()=>{this._updateViewState();this.setDirty()}),m.watch(()=>this.view?.map?.ground?.opacity,(y,w)=>{1!==y&&1!==w||this.setDirty()}),m.watch(()=>this.view?.slicePlane,()=>{this._updateSlicePlane();this._slicePlaneChanged()},m.initial)]);this._frameTask=this.view.resourceController.scheduler.registerTask(z.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new p.LabelDeconflictor({view:this.view,parent:this})};
u.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};u.setDirty=function(){0<this._contexts.size&&(A.prototype.setDirty.call(this),this._labels.setDirty())};u.runTask=function(y){A.prototype.runTask.call(this,y);this.running||this._labels.setDirty()};u.setInitialIconVisibilityFlag=function(y,w){y=!(this._graphicSupportsDeconfliction(w)&&C(y));w.setVisibilityFlag(k.VisibilityFlag.DECONFLICTION,
y,k.VisibilityGroup.GRAPHIC)};u._updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())};u._updateSlicePlane=function(){const y=this.view?this.view.slicePlane:null;r.isSome(y)&&v.transform(y,this._viewState.camera.viewMatrix,this._viewState.slicePlane);this._viewState.slicePlaneEnabled=r.isSome(y)};u._slicePlaneChanged=function(){n.someMap(this._contexts,(y,w)=>w.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};
u.addGraphicsOwner=function(y){const w=this._getGraphicsContext(y);return{addGraphic:D=>this._addGraphic(y,w,D),removeGraphic:D=>this._removeGraphic(w,D),labelingInfoChange:()=>this._labels.enabledChanged(y,w),featureReductionChange:()=>this.enabledChanged(y,w),slicePlaneEnabledChange:()=>this._slicePlaneEnabledChanged(y,w),clear:()=>w.forEach(D=>this._removeGraphic(w,D.graphics3DGraphic))}};u.removeGraphicsOwner=function(y){const w=this._contexts.get(y);w&&(w.forEach(D=>this._removeGraphic(w,D.graphics3DGraphic)),
this._contexts.delete(y),this.setDirty())};u._addGraphic=function(y,w,D){const F=D.graphic.uid;D=new q.DeconflictorGraphic(D,y.symbolCreationContext.slicePlaneEnabled);w.set(F,D);C(y)&&this.addToActiveGraphics(D);y.labelsEnabled&&this._labels.addToActiveGraphics(D)};u._removeGraphic=function(y,w){w=w.graphic.uid;const D=y.get(w);D&&(this.removeFromActiveGraphics(D),this._labels.removeFromActiveGraphics(D),y.delete(w),this.setDirty())};u.enabledChanged=function(y,w){const D=C(y);D||B(y);this.modifyGraphics(w,
D)};u._slicePlaneEnabledChanged=function(y,w){const D=y.symbolCreationContext.slicePlaneEnabled;w.forEach(F=>F.slicePlaneEnabled=D);this.setDirty()};u.getGraphicsLayers=function(y){return y.layers};u._graphicSupportsDeconfliction=function(y){if(y.isDraped)return!1;y=y.layers;if(!y||!y.length)return!1;for(const w of y)if(this.layerSupportsDeconfliction(w))return!0;return!1};u._getGraphicsContext=function(y){var w=this._contexts.get(y);if(w)return w;w=new Map;this._contexts.set(y,w);this.setDirty();
return w};c._createClass(x,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(y){this._iconMarginFactor=y;this.setDirty()}}]);return x}(q.Deconflictor);a.GraphicsDeconflictor=b.__decorate([l.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../support/debugFlags ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/ScaleInfo".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M){function*N(ba){if(Map.prototype.entries){ba=ba.entries();for(let da=ba.next();!da.done;da=ba.next())yield da.value[1]}else yield*ba.values()}function*P(ba,da,ea){da.clear();ba.forEach((ja,ia)=>{const Z=da.pushNew();Z.id=ia;Z.visible=ja.graphics3DGraphic.hasVisibilityFlag(w.VisibilityFlag.DECONFLICTION,ea);Z.prio=ja.info?ja.info[ea].distance:Number.MAX_VALUE});yield;const ca=da.iterableSort((ja,ia)=>ja.visible!==ia.visible?ja.visible?
-1:1:ja.prio!==ia.prio?ja.prio-ia.prio:ja.id-ia.id);for(let ja=ca.next();!ja.done;ja=ca.next())yield;da.forAll(ja=>{const ia=ba.get(ja.id);ia&&(ba.delete(ja.id),ba.set(ja.id,ia))});da.clear()}const I=k.create(),G=z.create(),H=z.create(),L=k.create(),O=l.create(),S=u.create(),R=x.create(),Q=k.create(),V=B.create();let aa=function(){this.aabr=B.create();this.distance=0;this.visible=this.culled=!1};a.State=void 0;(function(ba){ba[ba.Idle=0]="Idle";ba[ba.Process=1]="Process";ba[ba.Sort=2]="Sort";ba[ba.Deconflict=
3]="Deconflict";ba[ba.NumStates=4]="NumStates"})(a.State||(a.State={}));let X=function(){function ba(){this.camera=new F.Camera;this.slicePlane=A.create();this.slicePlaneEnabled=!1}ba.prototype.copyFrom=function(da){this.camera.copyFrom(da.camera);A.copy(da.slicePlane,this.slicePlane);this.slicePlaneEnabled=da.slicePlaneEnabled};return ba}();a.Deconflictor=function(ba){function da(ca){ca=ba.call(this,ca)||this;ca._dirty=!1;ca._runningViewState=new X;ca._state=a.State.Idle;ca._active=new Map;ca._visible=
new Map;ca._iterators=new T;ca._accBinsNumX=15;ca._accBinsNumY=20;ca._accBinsSizeX=0;ca._accBinsSizeY=0;ca._accBins=null;ca.accNumTests=0;return ca}c._inheritsLoose(da,ba);var ea=da.prototype;ea.destroy=function(){this._active.clear();this._visible.clear();this._iterators=null};ea.setDirty=function(){!this._dirty&&0<this._active.size&&(this._dirty=!0,this.notifyChange("updating"))};ea.runTask=function(ca){switch(this._state){case a.State.Idle:this._startUpdate(),ca.madeProgress();case a.State.Process:if(this._state=
a.State.Process,!this._processActiveGraphics(ca))break;case a.State.Sort:if(this._state=a.State.Sort,!this._sortVisibleGraphics(ca))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(ca))break;default:y.drawAccelerationStruct(this,this._visible),this._state=a.State.Idle,this.notifyChange("updating")}};ea.modifyGraphics=function(ca,ja){ja?ca.forEach(ia=>this.addToActiveGraphics(ia)):ca.forEach(ia=>this.removeFromActiveGraphics(ia));this.setDirty()};ea.layerSupportsDeconfliction=
function(ca){if(r.isNone(ca)||"object3d"!==ca.type)return!1;ca=ca.stageObject;return 1===(ca?ca.geometries.length:0)&&ca?.geometries[0]?.material instanceof J.HUDMaterial?!0:!1};ea._startUpdate=function(){y.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);const {fullWidth:ca,fullHeight:ja}=this._runningViewState.camera;this._initBins(ca,ja);this._resetIterators()};ea.addToActiveGraphics=function(ca){ca.info[this.visibilityGroup]=new aa;this._active.set(ca.graphics3DGraphic.graphic.uid,
ca);this.setDirty()};ea.removeFromActiveGraphics=function(ca){this._visible.delete(ca.graphics3DGraphic.graphic.uid);const ja=ca.graphics3DGraphic;ja.destroyed||ja.clearVisibilityFlag(w.VisibilityFlag.DECONFLICTION,this.visibilityGroup);delete ca.info[this.visibilityGroup];this._active.delete(ca.graphics3DGraphic.graphic.uid);this.setDirty()};ea._processActiveGraphics=function(ca){const ja=this._ensureActiveGraphicsIterator(),ia=h.invertOrIdentity(O,this._runningViewState.camera.projectionMatrix),
Z="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?S:null;let ha=0;r.isSome(Z)&&(q.transformMat4(Z,k.ZEROS,this._runningViewState.camera.viewMatrix),Z[3]=C.getReferenceEllipsoid(this.view.spatialReference).radius,ha=u.distanceToSilhouette(Z,k.ZEROS));for(;!ca.done;){ca.madeProgress();var fa=ja.next();if(!0===fa.done)return this._resetActiveGraphicsIterator(),!0;const ka=(fa=fa.value)&&fa.info[this.visibilityGroup];ka&&(this._collectGraphics3DGraphics(fa,
ia,Z,ha),ka.culled?this._visible.delete(fa.graphics3DGraphic.graphic.uid):this._visible.set(fa.graphics3DGraphic.graphic.uid,fa))}return!1};ea._sortVisibleGraphics=function(ca){const ja=this._ensureSortGraphicsIterator();for(;!ca.done;){const ia=ja.next();ca.madeProgress();if(!0===ia.done)return this._resetSortGraphicsIterator(),!0}return!1};ea._deconflictVisibleGraphics=function(ca){const ja=this._ensureVisibleGraphicsIterator(),ia=this.visibilityGroup===w.VisibilityGroup.LABEL;for(;!ca.done;){ca.madeProgress();
var Z=ja.next();if(!0===Z.done)return this._resetVisibleGraphicsIterator(),!0;Z=Z.value;const fa=Z.info[this.visibilityGroup];if(fa&&!fa.culled){var ha=Z.graphics3DGraphic;(ha=(!ia||ha.isVisible())&&!this._isConflicted(Z))&&this._addToBins(Z);fa.visible=ha;this._setGraphicVisibility(Z,ha);y.drawPoly(fa,ha)}}return!1};ea._resetIterators=function(){this._iterators.active=null;this._iterators.visible=null;this._iterators.sort=null};ea._ensureActiveGraphicsIterator=function(){this._iterators.active||
(this._iterators.active=N(this._active));return this._iterators.active};ea._resetActiveGraphicsIterator=function(){this._iterators.active=null};ea._ensureVisibleGraphicsIterator=function(){this._iterators.visible||(this._iterators.visible=N(this._visible));return this._iterators.visible};ea._resetVisibleGraphicsIterator=function(){this._iterators.visible=null};ea._ensureSortGraphicsIterator=function(){this._iterators.sort||(this._iterators.sort=P(this._visible,this._iterators.sortArray,this.visibilityGroup));
return this._iterators.sort};ea._resetSortGraphicsIterator=function(){this._iterators.sort=null};ea._collectGraphics3DGraphics=function(ca,ja,ia,Z){var ha=ca.graphics3DGraphic;if(!ha.destroyed){var fa=ca.info[this.visibilityGroup];if(ha.isVisible(w.VisibilityGroup.GRAPHIC,w.VisibilityFlag.DECONFLICTION)){var ka=this.getGraphicsLayers(ha);B.empty(fa.aabr);ha=null;for(const la of ka)if(this.layerSupportsDeconfliction(la)){ka=la.stageObject.geometries[0].material;if(r.isNone(ha)){ha=Y;this._getProjectionInfo(la,
ja,ha);if(ha.isOutsideScreen||this._isCulledBySlice(ca,I)||r.isSome(ia)&&this._isCulledByHorizon(ha,ia,Z)){fa.culled=!0;return}!D.TESTS_DISABLE_OPTIMIZATIONS&&fa.visible&&(ha.distance*=.7)}this._expandBoundingRect(fa,la,ka,ha)}r.isNone(ha)?fa.culled=!0:(fa.distance=ha.distance,fa.culled=!1)}else fa.culled=!0}};ea._getProjectionInfo=function(ca,ja,ia){const Z=this._runningViewState.camera;ca=ca.stageObject;var ha=ca.geometries[0];const fa=ha.material;var ka=u.getCenter(ca.boundingVolumeWorldSpace.bounds);
q.transformMat4(I,ka,Z.viewMatrix);ka=ha.vertexAttributes;ha=ka.get(K.VertexAttribute.NORMAL).data;ka=ka.get(K.VertexAttribute.AUXPOS1).data;fa.applyShaderOffsetsView(I,ha,ca.transformation,ka,Z,ia.scaleInfo,I);p.set(G,I[0],I[1],I[2],1);p.transformMat4(H,G,Z.projectionMatrix);q.scale(ia.positionNDC,H,1/H[3]);fa.applyShaderOffsetsNDC(ia.positionNDC,ka,Z,ia.positionNDC,L);ia.distanceWithoutPolygonOffset=Z.depthNDCToWorld(L[2]);ia.distance=L[2]===ia.positionNDC[2]?ia.distanceWithoutPolygonOffset:Z.depthNDCToWorld(ia.positionNDC[2]);
p.set(H,ia.positionNDC[0],ia.positionNDC[1],ia.positionNDC[2],1);p.transformMat4(G,H,ja);p.scale(G,G,1/G[3]);q.set(ia.positionView,I[0],I[1],I[2])};ea._isCulledByHorizon=function(ca,ja,ia){q.copy(R.direction,ca.positionView);q.set(R.origin,0,0,0);return u.intersectRay(ja,R,Q)?ca.distanceWithoutPolygonOffset>ia:!1};ea._isCulledBySlice=function(ca,ja){return ca.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&A.extrusionContainsPoint(this._runningViewState.slicePlane,ja)};ea._expandBoundingRect=
function(ca,ja,ia,{positionNDC:Z,scaleInfo:ha}){const fa=this._runningViewState.camera;ja=ja.getScreenSize(U);E.applyPrecomputedScaleFactor(ja,ha.factor,ja);ja[0]*=fa.pixelRatio;ja[1]*=fa.pixelRatio;ia=B.offset(ia.calculateRelativeScreenBounds(ja,ha.factorAlignment.scale,V),n.lerp(0,fa.fullWidth,.5+.5*Z[0]),n.lerp(0,fa.fullHeight,.5+.5*Z[1]));Z=this.iconMarginFactor;0!==Z&&(Z*=Math.min(B.width(ia),B.height(ia)),ia[0]-=Z,ia[1]-=Z,ia[2]+=Z,ia[3]+=Z);B.expand(ca.aabr,ia,ca.aabr)};ea._isConflicted=function(ca){const ja=
ca.graphics3DGraphic.graphic.uid;ca=ca.info[this.visibilityGroup];for(let ia=Math.floor(ca.aabr[0]/this._accBinsSizeX);ia<=Math.floor(ca.aabr[2]/this._accBinsSizeX);ia++)if(!(0>ia||ia>=this._accBinsNumX))for(let Z=Math.floor(ca.aabr[1]/this._accBinsSizeY);Z<=Math.floor(ca.aabr[3]/this._accBinsSizeY);Z++){if(0>Z||Z>=this._accBinsNumY)continue;const ha=this._accBins[ia][Z];for(let fa=0;fa<ha.length;fa++){const ka=ha.data[fa],la=ka.info[this.visibilityGroup];if(la&&la.visible&&ka.graphics3DGraphic.graphic.uid!==
ja&&(this.accNumTests++,B.intersects(la.aabr,ca.aabr)))return!0}}return!1};ea._initBins=function(ca,ja){if(null==this._accBins){this._accBins=[];for(var ia=0;ia<this._accBinsNumX;ia++){this._accBins.push([]);var Z=this._accBins[this._accBins.length-1];for(let ha=0;ha<this._accBinsNumY;ha++)Z.push(new m)}}else for(ia=0;ia<this._accBinsNumX;ia++)for(Z=0;Z<this._accBinsNumY;Z++)this._accBins[ia][Z].clear();this._accBinsSizeX=ca/this._accBinsNumX;this._accBinsSizeY=ja/this._accBinsNumY;this.accNumTests=
0};ea._addToBins=function(ca){var ja=ca.info[this.visibilityGroup],ia=Math.floor(ja.aabr[0]/this._accBinsSizeX);const Z=Math.floor(ja.aabr[2]/this._accBinsSizeX),ha=Math.floor(ja.aabr[1]/this._accBinsSizeY);for(ja=Math.floor(ja.aabr[3]/this._accBinsSizeY);ia<=Z;ia++)if(!(0>ia||ia>=this._accBinsNumX))for(let fa=ha;fa<=ja;fa++)0>fa||fa>=this._accBinsNumY||this._accBins[ia][fa].push(ca)};ea._setGraphicVisibility=function(ca,ja){ca=ca.graphics3DGraphic;ca.destroyed||(ca.setVisibilityFlag(w.VisibilityFlag.DECONFLICTION,
ja,this.visibilityGroup),this.visibilityGroup===w.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(ca,ja))};c._createClass(da,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},{key:"updating",get:function(){return this._state!==a.State.Idle||this._dirty}},{key:"updatingProgress",get:function(){if(!this.updating)return 1;const ca=this._state/a.State.NumStates;return this._dirty?.5*ca:ca}},{key:"running",get:function(){return this.view.ready&&
null!=this.view.state&&this.updating}}]);return da}(t);b.__decorate([d.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);b.__decorate([d.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=b.__decorate([g.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);let W=function(){},T=function(ba=null,da=null,ea=null){this.active=ba;this.visible=da;this.sort=ea;this.sortArray=new m({allocator:ca=>ca||new W})};const U=v.create(),
Y=new (function(){function ba(){this.positionView=k.create();this.positionNDC=k.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo=new M.ScaleInfo}c._createClass(ba,[{key:"isOutsideScreen",get:function(){const da=this.positionNDC;return-1>da[0]||-1>da[1]||-1>da[2]||1<=da[0]||1<=da[1]}}]);return ba}());a.DeconflictorGraphic=function(ba,da){this.graphics3DGraphic=ba;this.slicePlaneEnabled=da;this.info={}};a.DeconflictorViewState=X;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,c){function b(g,h,l,v,q){d&&(d(),d=null);const k=f.height,p=e;p.beginPath();p.lineWidth=1;p.strokeStyle=q;p.moveTo(g,k-l);p.lineTo(h,k-l);p.stroke();p.lineTo(h,k-v);p.stroke();p.lineTo(h,k-l);p.stroke();p.lineTo(g,k-l);p.stroke();p.lineTo(g,k-l);p.stroke();p.closePath()}let t=!1,n=!1,r=!1,m=!1,d=null,f,e;a.drawAccelerationStruct=function(g,h){if(n&&e){d&&(d(),d=null);var l=e,v=0;for(let q=
0;q<g.accBinsNumX;q++)for(let k=0;k<g.accBinsNumY;k++){const p=g.accBins[q][g.accBinsNumY-1-k];v+=p.length;const z=q*g.accBinsSizeX,C=(q+1)*g.accBinsSizeX,B=k*g.accBinsSizeY,A=(k+1)*g.accBinsSizeY;l.fillText(p.length.toFixed(),z+5,B+15);b(z,C,B,A,"blue")}l.fillText("total totalShownLabels: "+v,70,40);l.fillText("total visible labels: "+h.size,70,50);l.fillText("total numTests: "+g.accNumTests,70,30)}};a.drawPoly=function(g,h){t&&(h&&r||!h&&m)&&b(g.aabr[0],g.aabr[2],g.aabr[1],g.aabr[3],h?"green":"red")};
a.prepare=function(g){r=c.DECONFLICTOR_SHOW_VISIBLE;m=c.DECONFLICTOR_SHOW_INVISIBLE;t=r||m;n=c.DECONFLICTOR_SHOW_GRID;d=null;t||n?d=()=>{null==f&&(f=document.createElement("canvas"),f.setAttribute("id","canvas2d"),g.surface.parentElement.style.position="relative",g.surface.parentElement.appendChild(f));var {state:h}=g;const {camera:l,pixelRatio:v}=h,{width:q,height:k}=l;h=k*v;f.setAttribute("width",`${q*v}px`);f.setAttribute("height",`${h}px`);f.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${q}px;height:${k}px`);
e=f.getContext("2d");e.clearRect(0,0,q,k);e.font="12px Arial"}:f&&(f.parentElement.removeChild(f),f=null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/enums":function(){define(["exports"],function(a){a.VisibilityGroup=void 0;(function(c){c[c.GRAPHIC=0]="GRAPHIC";c[c.LABEL=1]="LABEL";c[c._COUNT=2]="_COUNT"})(a.VisibilityGroup||(a.VisibilityGroup={}));a.VisibilityFlag=void 0;(function(c){c[c.USER_SETTING=0]="USER_SETTING";c[c.SCALE_RANGE=1]="SCALE_RANGE";
c[c.FILTER=2]="FILTER";c[c.DECONFLICTION=3]="DECONFLICTION";c[c._COUNT=4]="_COUNT"})(a.VisibilityFlag||(a.VisibilityFlag={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../ViewingMode"],function(a,c,b,t){function n(h,l,v){const q=v.parameters;v=v.paddingPixelsOverride;e.scale=Math.min(q.divisor/(l-q.offset),
1);e.factor=Math.abs(h*h*h);e.minPixelSize=q.minPixelSize;e.paddingPixels=v;return e}function r(h,l){return 0===h?l.minPixelSize:l.minPixelSize*(1+2*l.paddingPixels/h)}function m(h,l){return Math.max(b.lerp(h*l.scale,h,l.factor),r(h,l))}let d=function(){function h(v,q,k,p={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},z){this._viewingMode=v;this._description=q;this._ellipsoidRadius=k;this.parameters=p;this._paddingPixelsOverride=z;this._viewingMode===t.ViewingMode.Local?
(this._coverageCompensation=this._surfaceCoverageCompensationLocal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this._coverageCompensation=this._surfaceCoverageCompensationGlobal,this._calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}var l=h.prototype;l.update=function(v){if(this.parameters&&this.parameters.camera.fovY===v.fovY&&this.parameters.camera.distance===v.distance)return!1;this._calculateParameters(v,
this._ellipsoidRadius,this.parameters);return!0};l.overridePadding=function(v){return v!==this.paddingPixelsOverride?new h(this._viewingMode,this._description,this._ellipsoidRadius,this.parameters,v):this};l._calculateParameters=function(v,q,k){const {scaleStart:p,scaleFallOffRange:z,minPixelSize:C}=this._description,{fovY:B,distance:A}=v;var x=this._calculateCurvatureDependentParameters(v,q);q=this._coverageCompensation(v,q,x);const {tiltAngle:u,scaleFallOffFactor:y}=x,w=Math.sin(u)*A,D=.5*Math.PI-
u-B*(.5-p*q);x=w/Math.cos(D);q=(x-w/Math.cos(D+B*z*q)*y)/(1-y);k.camera.fovY=v.fovY;k.camera.distance=v.distance;k.offset=q;k.divisor=x-q;k.minPixelSize=C;return k};l._calculateCurvatureDependentParametersLocal=function(v,q,k=g){k.tiltAngle=this._description.curvatureDependent.min.tiltAngle;k.scaleFallOffFactor=this._description.curvatureDependent.min.scaleFallOffFactor;return k};l._calculateCurvatureDependentParametersGlobal=function(v,q,k=g){const p=this._description.curvatureDependent;v=1+v.distance/
q;v=Math.sqrt(v*v-1);const [z,C]=[p.min.curvature,p.max.curvature];v=b.clamp((v-z)/(C-z),0,1);const [B,A]=[p.min,p.max];k.tiltAngle=b.lerp(B.tiltAngle,A.tiltAngle,v);k.scaleFallOffFactor=b.lerp(B.scaleFallOffFactor,A.scaleFallOffFactor,v);return k};l._surfaceCoverageCompensationLocal=function(v,q,k){return(v.fovY-k.tiltAngle)/v.fovY};l._surfaceCoverageCompensationGlobal=function(v,q,k){const p=q*q;k=k.tiltAngle+.5*Math.PI;const {fovY:z,distance:C}=v;v=C*C+p-2*Math.cos(k)*C*q;const B=Math.sqrt(v);
return(Math.acos(Math.sqrt(v-p)/B)-Math.asin(q/(B/Math.sin(k)))+.5*z)/z};c._createClass(h,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return h}();const f={curvatureDependent:{min:{curvature:b.deg2rad(10),tiltAngle:b.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:b.deg2rad(70),tiltAngle:b.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},e={scale:0,factor:0,minPixelSize:0,paddingPixels:0},
g={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(h,l,v=[0,0]){l=Math.min(Math.max(l.scale,r(h[1],l)/Math.max(1E-5,h[1])),1);v[0]=h[0]*l;v[1]=h[1]*l;return v};a.applyScaleFactor=m;a.getLabelSettings=function(h,l){const {curvatureDependent:v,scaleStart:q,scaleFallOffRange:k}=f;return new d(h,{curvatureDependent:{min:{curvature:v.min.curvature,tiltAngle:v.min.tiltAngle,scaleFallOffFactor:.7},max:{curvature:v.max.curvature,tiltAngle:v.max.tiltAngle,scaleFallOffFactor:.95}},
scaleStart:q,scaleFallOffRange:k,minPixelSize:14},l)};a.getSettings=function(h,l){return new d(h,f,l)};a.precomputeScaleFactor=function(h,l,v,q){h=n(h,l,v);h.minPixelSize=0;h.paddingPixels=0;h=m(1,h);q.scale=h;q.factor=0;q.minPixelSize=v.parameters.minPixelSize;q.paddingPixels=v.paddingPixelsOverride};a.scale=function(h,l,v,q){return m(h,n(l,v,q))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/buffer/BufferView ../../support/debugFlags ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./ScaleInfo ./internal/bufferWriterUtils ./internal/MaterialUtil ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P){function I(fa,ka,la,na=S){e.copy(na,fa.anchorPosition);na[0]*=-ka[0];na[1]*=-ka[1];na[0]+=fa.screenOffset[0]*la;na[1]+=fa.screenOffset[1]*la;return na}function G(fa,ka,la,na,pa,va,wa,za){ka=ka-pa-(0<za[0]?na[0]*za[0]:0);let sa=ka+na[0]+2*pa;la=la-pa-(0<za[1]?na[1]*za[1]:0);pa=la+na[1]+2*pa;za=wa.distanceFieldBoundingBox;wa.textureIsSignedDistanceField&&n.isSome(za)&&(ka+=na[0]*za[0],la+=na[1]*za[1],sa-=na[0]*(1-za[2]),pa-=
na[1]*(1-za[3]),ka-=va,sa+=va,la-=va,pa+=va);return fa[0]>ka&&fa[0]<sa&&fa[1]>la&&fa[1]<pa}let H=function(fa){function ka(na){na=fa.call(this,na,new ja)||this;na._configuration=new P.HUDMaterialTechniqueConfiguration;return na}c._inheritsLoose(ka,fa);var la=ka.prototype;la.getConfiguration=function(na,pa){this._configuration.output=na;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVerticalOffset=!!this.parameters.verticalOffset;this._configuration.hasScreenSizePerspective=
!!this.parameters.screenSizePerspective;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?A.HUDSpace.Screen:A.HUDSpace.World;this._configuration.hasPolygonOffset=this.parameters.polygonOffset;this._configuration.isDraped=this.parameters.isDraped;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this._configuration.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField;
this._configuration.vvSize=!!this.parameters.vvSizeEnabled;this._configuration.vvColor=!!this.parameters.vvColorEnabled;this._configuration.occlusionPass=pa.slot===y.RenderSlot.OCCLUSION_PIXELS&&this.parameters.occlusionTest&&(na===B.ShaderOutput.Color||na===B.ShaderOutput.Alpha);na===B.ShaderOutput.Color&&(this._configuration.debugDrawLabelBorder=!!z.LABELS_SHOW_BORDER);na===B.ShaderOutput.Highlight&&(this._configuration.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion);this._configuration.depthEnabled=
this.parameters.depthEnabled;this._configuration.transparencyPassType=pa.transparencyPassType;this._configuration.hasMultipassGeometry=pa.multipassGeometry.enabled;this._configuration.hasMultipassTerrain=pa.multipassTerrain.enabled;this._configuration.cullAboveGround=pa.multipassTerrain.cullAboveGround;return this._configuration};la.intersect=function(na,pa,va,wa,za,sa){if(va.options.selectionMode&&va.options.hud&&na.visible){wa=this.parameters;var ua=za=1;r.fromMat4(W,pa);if(n.isSome(na.shaderTransformer)){ua=
na.shaderTransformer(da);za=ua[0];ua=ua[5];var oa=W,xa=oa[0],Ea=oa[1],Ia=oa[2],Na=oa[3],Oa=oa[4],Ja=oa[5],Sa=oa[6],Ua=oa[7],Za=oa[8],ma=1/Math.sqrt(xa*xa+Ea*Ea+Ia*Ia);const Ya=1/Math.sqrt(Na*Na+Oa*Oa+Ja*Ja),bb=1/Math.sqrt(Sa*Sa+Ua*Ua+Za*Za);oa[0]=xa*ma;oa[1]=Ea*ma;oa[2]=Ia*ma;oa[3]=Na*Ya;oa[4]=Oa*Ya;oa[5]=Ja*Ya;oa[6]=Sa*bb;oa[7]=Ua*bb;oa[8]=Za*bb}oa=na.vertexAttributes.get(F.VertexAttribute.POSITION);xa=na.vertexAttributes.get(F.VertexAttribute.SIZE);Ea=na.vertexAttributes.get(F.VertexAttribute.NORMAL);
na=na.vertexAttributes.get(F.VertexAttribute.AUXPOS1);D.assert(3<=oa.size);Ia=va.point;Na=va.camera;Oa=M.calculateAnchorPosForRendering(wa);za*=Na.pixelRatio;ua*=Na.pixelRatio;Ja="screen"===this.parameters.centerOffsetUnits;for(Sa=0;Sa<oa.data.length/oa.size;Sa++)Ua=Sa*oa.size,h.set(R,oa.data[Ua],oa.data[Ua+1],oa.data[Ua+2]),h.transformMat4(R,R,pa),Ua=Sa*xa.size,ea[0]=xa.data[Ua]*za,ea[1]=xa.data[Ua+1]*ua,h.transformMat4(R,R,Na.viewMatrix),Ua=Sa*na.size,h.set(Y,na.data[Ua+0],na.data[Ua+1],na.data[Ua+
2]),Ja||(R[0]+=Y[0],R[1]+=Y[1],0!==Y[2]&&(Ua=Y[2],h.normalize(Y,R),h.subtract(R,R,h.scale(Y,Y,Ua)))),Ua=Sa*Ea.size,h.set(Q,Ea.data[Ua],Ea.data[Ua+1],Ea.data[Ua+2]),this._normalAndViewAngle(Q,W,Na,ba),this._applyVerticalOffsetTransformationView(R,ba,Na,O),Na.applyProjection(R,V),-1<V[0]&&(V[0]=Math.floor(V[0]),V[1]=Math.floor(V[1]),Ja&&(Y[0]||Y[1])&&(V[0]+=Y[0],0!==Y[1]&&(V[1]+=w.applyScaleFactor(Y[1],O.factorAlignment)),Na.unapplyProjection(V,R)),V[0]+=this.parameters.screenOffset[0],V[1]+=this.parameters.screenOffset[1],
w.applyPrecomputedScaleFactor(ea,O.factor,ea),Ua=1*Na.pixelRatio,Za=0,wa.textureIsSignedDistanceField&&(Za=wa.outlineSize*Na.pixelRatio/2),Ia&&G(Ia,V[0],V[1],ea,Ua,Za,wa,Oa)&&(Za=va.ray,h.transformMat4(X,R,d.invert(U,Na.viewMatrix)),V[0]=Ia[0],V[1]=Ia[1],Na.unprojectFromRenderScreen(V,R)&&(Ua=l.create(),h.copy(Ua,Za.direction),ma=1/h.length(Ua),h.scale(Ua,Ua,ma),Za=h.distance(Za.origin,R)*ma,sa(Za,Ua,-1,!0,1,X))))}};la.intersectDraped=function(na,pa,va,wa,za,sa){pa=na.vertexAttributes.get(F.VertexAttribute.POSITION);
va=na.vertexAttributes.get(F.VertexAttribute.SIZE);const ua=this.parameters,oa=M.calculateAnchorPosForRendering(ua);let xa=1;var Ea=1;n.isSome(na.shaderTransformer)&&(Ea=na.shaderTransformer(da),xa=Ea[0],Ea=Ea[5]);xa*=na.screenToWorldRatio;Ea*=na.screenToWorldRatio;const Ia=2*na.screenToWorldRatio;for(let Ja=0;Ja<pa.data.length/pa.size;Ja++){var Na=Ja*pa.size;const Sa=pa.data[Na];Na=pa.data[Na+1];var Oa=Ja*va.size;ea[0]=va.data[Oa]*xa;ea[1]=va.data[Oa+1]*Ea;Oa=0;ua.textureIsSignedDistanceField&&(Oa=
ua.outlineSize*na.screenToWorldRatio/2);G(wa,Sa,Na,ea,Ia,Oa,ua,oa)&&za(sa.dist,sa.normal,-1,!1)}};la.createBufferWriter=function(){return new ha(this)};la._normalAndViewAngle=function(na,pa,va,wa){q.isMat4(pa)&&(pa=r.fromMat4(T,pa));h.transformMat3(wa.normal,na,pa);h.transformMat4(wa.normal,wa.normal,va.viewInverseTransposeMatrix);wa.cosAngle=h.dot(aa,ca);return wa};la._updateScaleInfo=function(na,pa,va){const wa=this.parameters;n.isSome(wa.screenSizePerspective)?w.precomputeScaleFactor(va,pa,wa.screenSizePerspective,
na.factor):(na.factor.scale=1,na.factor.factor=0,na.factor.minPixelSize=0,na.factor.paddingPixels=0);n.isSome(wa.screenSizePerspectiveAlignment)?w.precomputeScaleFactor(va,pa,wa.screenSizePerspectiveAlignment,na.factorAlignment):(na.factorAlignment.factor=na.factor.factor,na.factorAlignment.scale=na.factor.scale,na.factorAlignment.minPixelSize=na.factor.minPixelSize,na.factorAlignment.paddingPixels=na.factor.paddingPixels)};la.applyShaderOffsetsView=function(na,pa,va,wa,za,sa,ua){pa=this._normalAndViewAngle(pa,
va,za,ba);this._applyVerticalGroundOffsetView(na,pa,za,ua);this._applyVerticalOffsetTransformationView(ua,pa,za,sa);this._applyPolygonOffsetView(ua,pa,wa[3],za,ua);this._applyCenterOffsetView(ua,wa,ua);return ua};la.applyShaderOffsetsNDC=function(na,pa,va,wa,za){this._applyCenterOffsetNDC(na,pa,va,wa);n.isSome(za)&&h.copy(za,wa);this._applyPolygonOffsetNDC(wa,pa,va,wa);return wa};la._applyPolygonOffsetView=function(na,pa,va,wa,za){var sa=wa.aboveGround?1:-1;va=Math.sign(va);0===va&&(va=sa);sa*=va;
if(0>=this.parameters.shaderPolygonOffset)return h.copy(za,na);pa=t.clamp(Math.abs(pa.cosAngle),.01,1);wa=1-Math.sqrt(1-pa*pa)/pa/wa.viewport[2];0<sa?h.scale(za,na,wa):h.scale(za,na,1/wa);return za};la._applyVerticalGroundOffsetView=function(na,pa,va,wa){const za=h.length(na),sa=va.aboveGround?1:-1;va=.5*va.computeRenderPixelSizeAtDist(za);pa=h.scale(R,pa.normal,sa*va);h.add(wa,na,pa);return wa};la._applyVerticalOffsetTransformationView=function(na,pa,va,wa){const za=this.parameters;if(!za.verticalOffset||
!za.verticalOffset.screenLength){if(za.screenSizePerspective||za.screenSizePerspectiveAlignment){var sa=h.length(na);this._updateScaleInfo(wa,sa,pa.cosAngle)}else wa.factor.scale=1,wa.factorAlignment.scale=1;return na}sa=h.length(na);const ua=n.unwrapOr(za.screenSizePerspectiveAlignment,za.screenSizePerspective);va=J.verticalOffsetAtDistance(va,sa,za.verticalOffset,pa.cosAngle,ua);this._updateScaleInfo(wa,sa,pa.cosAngle);h.scale(pa.normal,pa.normal,va);return h.add(na,na,pa.normal)};la._applyCenterOffsetView=
function(na,pa,va){const wa="screen"!==this.parameters.centerOffsetUnits;va!==na&&h.copy(va,na);wa&&(va[0]+=pa[0],va[1]+=pa[1],pa[2]&&(h.normalize(Q,va),h.add(va,va,h.scale(Q,Q,pa[2]))));return va};la._applyCenterOffsetNDC=function(na,pa,va,wa){const za="screen"!==this.parameters.centerOffsetUnits;wa!==na&&h.copy(wa,na);za||(wa[0]+=pa[0]/va.fullWidth*2,wa[1]+=pa[1]/va.fullHeight*2);return wa};la._applyPolygonOffsetNDC=function(na,pa,va,wa){const za=this.parameters.shaderPolygonOffset;na!==wa&&h.copy(wa,
na);za&&(na=va.aboveGround?1:-1,wa[2]-=(na*Math.sign(pa[3])||na)*za);return wa};la.requiresSlot=function(na,pa){if(pa===B.ShaderOutput.Color||pa===B.ShaderOutput.Alpha||pa===B.ShaderOutput.Highlight||pa===B.ShaderOutput.ObjectAndLayerIdColor){if(na===y.RenderSlot.DRAPED_MATERIAL)return!0;const {drawInSecondSlot:va,occlusionTest:wa}=this.parameters;return na===(va?y.RenderSlot.LABEL_MATERIAL:y.RenderSlot.HUD_MATERIAL)||wa&&na===y.RenderSlot.OCCLUSION_PIXELS}return!1};la.createGLMaterial=function(na){return new L(na)};
la.calculateRelativeScreenBounds=function(na,pa,va=k.create()){I(this.parameters,na,pa,va);va[2]=va[0]+na[0];va[3]=va[1]+na[1];return va};return ka}(u.Material),L=function(fa){function ka(na){return fa.call(this,{...na,...na.material.parameters})||this}c._inheritsLoose(ka,fa);var la=ka.prototype;la.selectProgram=function(na){return this.ensureTechnique(N.HUDMaterialTechnique,na)};la.beginSlot=function(na){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);
return this.selectProgram(na)};return ka}(x.GLTextureMaterial);const O=new E.ScaleInfo,S=g.create(),R=l.create(),Q=l.create(),V=v.create(),aa=l.create(),X=l.create(),W=m.create(),T=m.create(),U=f.create(),Y=l.create(),ba={normal:aa,cosAngle:0},da=f.create(),ea=[0,0],ca=l.fromValues(0,0,1);let ja=function(fa){function ka(){var la=fa.apply(this,arguments)||this;la.renderOccluded=u.RenderOccludedFlag.Occlude;la.color=v.fromValues(1,1,1,1);la.texCoordScale=[1,1];la.polygonOffset=!1;la.anchorPosition=
g.fromValues(.5,.5);la.screenOffset=[0,0];la.shaderPolygonOffset=1E-5;la.textureIsSignedDistanceField=!1;la.outlineColor=v.fromValues(1,1,1,1);la.outlineSize=0;la.vvSizeEnabled=!1;la.vvSizeMinSize=[1,1,1];la.vvSizeMaxSize=[100,100,100];la.vvSizeOffset=[0,0,0];la.vvSizeFactor=[1,1,1];la.vvColorEnabled=!1;la.vvColorValues=[0,0,0,0,0,0,0,0];la.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];la.hasSlicePlane=!1;la.pixelSnappingEnabled=!0;la.occlusionTest=!0;la.binaryHighlightOcclusion=
!0;la.centerOffsetUnits="world";la.drawInSecondSlot=!1;la.depthEnabled=!0;la.isDraped=!1;return la}c._inheritsLoose(ka,fa);return ka}(x.GLTextureMaterialBindParameters);const ia=C.newLayout().vec3f(F.VertexAttribute.POSITION).vec3f(F.VertexAttribute.NORMAL).vec2f(F.VertexAttribute.UV0).vec4u8(F.VertexAttribute.COLOR).vec2f(F.VertexAttribute.SIZE).vec4f(F.VertexAttribute.AUXPOS1).vec4f(F.VertexAttribute.AUXPOS2),Z=ia.clone().vec4u8(F.VertexAttribute.OBJECTANDLAYERIDCOLOR);let ha=function(){function fa(la){this._material=
la;this.vertexBufferLayout=b("enable-feature:objectAndLayerId-rendering")?Z:ia}var ka=fa.prototype;ka.allocate=function(la){return this.vertexBufferLayout.createBuffer(la)};ka.elementCount=function(la){return 6*la.indices.get(F.VertexAttribute.POSITION).length};ka.write=function(la,na,pa,va,wa){K.writePosition(pa.indices.get(F.VertexAttribute.POSITION),pa.vertexAttributes.get(F.VertexAttribute.POSITION).data,la,va.position,wa,6);K.writeNormal(pa.indices.get(F.VertexAttribute.NORMAL),pa.vertexAttributes.get(F.VertexAttribute.NORMAL).data,
na,va.normal,wa,6);la=pa.vertexAttributes.get(F.VertexAttribute.UV0).data;var za;if(null==la||4>la.length){la=this._material.parameters;var sa=za=0;var ua=la.texCoordScale[0];var oa=la.texCoordScale[1]}else za=la[0],sa=la[1],ua=la[2],oa=la[3];ua=Math.min(1.99999,ua+1);oa=Math.min(1.99999,oa+1);la=pa.indices.get(F.VertexAttribute.POSITION).length;na=wa;var xa=va.uv0;for(var Ea=0;Ea<la;++Ea)xa.set(na,0,za),xa.set(na,1,sa),na+=1,xa.set(na,0,ua),xa.set(na,1,sa),na+=1,xa.set(na,0,ua),xa.set(na,1,oa),na+=
1,xa.set(na,0,ua),xa.set(na,1,oa),na+=1,xa.set(na,0,za),xa.set(na,1,oa),na+=1,xa.set(na,0,za),xa.set(na,1,sa),na+=1;K.writeColor(pa.indices.get(F.VertexAttribute.COLOR),pa.vertexAttributes.get(F.VertexAttribute.COLOR).data,4,va.color,wa,6);za=pa.indices.get(F.VertexAttribute.SIZE);sa=pa.vertexAttributes.get(F.VertexAttribute.SIZE).data;la=za.length;ua=va.size;na=wa;for(oa=0;oa<la;++oa){xa=sa[2*za[oa]];Ea=sa[2*za[oa]+1];for(let Ia=0;6>Ia;++Ia)ua.set(na,0,xa),ua.set(na,1,Ea),na+=1}pa.indices.get(F.VertexAttribute.AUXPOS1)&&
pa.vertexAttributes.get(F.VertexAttribute.AUXPOS1)?K.writeBufferVec4(pa.indices.get(F.VertexAttribute.AUXPOS1),pa.vertexAttributes.get(F.VertexAttribute.AUXPOS1).data,va.auxpos1,wa,6):K.writeBufferVec4Zeros(va.auxpos1,wa,6*la);pa.indices.get(F.VertexAttribute.AUXPOS2)&&pa.vertexAttributes.get(F.VertexAttribute.AUXPOS2)?K.writeBufferVec4(pa.indices.get(F.VertexAttribute.AUXPOS2),pa.vertexAttributes.get(F.VertexAttribute.AUXPOS2).data,va.auxpos2,wa,6):K.writeBufferVec4Zeros(va.auxpos2,wa,6*la);n.isSome(pa.objectAndLayerIdColor)&&
pa.indices.get(F.VertexAttribute.POSITION)&&(la=pa.indices.get(F.VertexAttribute.POSITION).length,va=va.getField(F.VertexAttribute.OBJECTANDLAYERIDCOLOR,p.BufferViewVec4u8),K.writeObjectAndLayerIdColor(pa.objectAndLayerIdColor,va,la,wa,6))};return fa}();a.HUDMaterial=H;a.Parameters=ja;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function c(t){return t instanceof Float32Array&&16<=t.length}function b(t){return Array.isArray(t)&&
16<=t.length}a.isMat4=function(t){return c(t)||b(t)};a.isMat4f32=c;a.isMat4f64=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ./HUDUniforms ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../../lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e){a.HUDSpace=void 0;(function(g){g[g.World=0]="World";g[g.Screen=1]="Screen";g[g.COUNT=2]="COUNT"})(a.HUDSpace||(a.HUDSpace={}));a.HUD=function(g,h){g.include(t.ScreenSizePerspective);g.attributes.add(e.VertexAttribute.POSITION,"vec3");g.attributes.add(e.VertexAttribute.NORMAL,"vec3");g.attributes.add(e.VertexAttribute.AUXPOS1,"vec4");g=g.vertex;n.addProjViewLocalOrigin(g,h);n.addCameraPosition(g,h);g.uniforms.add([new r.Float4PassUniform("viewport",(l,v)=>v.camera.fullViewport),
new m.FloatPassUniform("polygonOffset",l=>l.shaderPolygonOffset),new m.FloatPassUniform("cameraGroundRelative",(l,v)=>v.camera.aboveGround?1:-1),new m.FloatPassUniform("renderTransparentlyOccludedHUD",(l,v)=>v.renderTransparentlyOccludedHUD===b.HUDTransparentRenderStyle.Occluded?1:v.renderTransparentlyOccludedHUD===b.HUDTransparentRenderStyle.NotOccluded?0:.75),new f.Texture2DPassUniform("hudVisibilityTexture",(l,v)=>v.hudVisibilityTexture)]);h.hasVerticalOffset&&c.addVerticalOffset(g);g.constants.add("smallOffsetAngle",
"float",.984807753012208);g.code.add(d.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);g.code.add(d.glsl`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`);h.isDraped&&!h.hasVerticalOffset||n.addViewNormal(g);h.isDraped||(g.uniforms.add(new m.FloatPassUniform("perDistancePixelRatio",(l,v)=>Math.tan(v.camera.fovY/2)/(v.camera.fullViewport[2]/2))),g.code.add(d.glsl`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`));h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen&&g.uniforms.add(new m.FloatPassUniform("pixelRatio",(l,v)=>v.camera.pixelRatio));h.hasScreenSizePerspective&&t.addScreenSizePerspectiveAlignment(g);g.code.add(d.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${h.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${h.hasScreenSizePerspective?h.hasVerticalOffset||h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${h.hasVerticalOffset?h.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${h.hasVerticalOffset?d.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${h.screenCenterOffsetUnitsEnabled!==a.HUDSpace.Screen?d.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?h.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${h.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);g.code.add(d.glsl`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(a,c,b,t,n,r,m){function d(e){e.uniforms.add(new r.Float4PassUniform("verticalOffset",(g,h)=>{const {minWorldLength:l,maxWorldLength:v,
screenLength:q}=g.verticalOffset;return c.set(f,q*(h.camera.pixelRatio||1),Math.tan(.5*h.camera.fovY)/(.5*h.camera.fullViewport[3]),l,v)}))}const f=b.create();a.VerticalOffset=function(e,g){const h=e.vertex;g.hasVerticalOffset?(d(h),g.hasScreenSizePerspective&&(e.include(t.ScreenSizePerspective),t.addScreenSizePerspectiveAlignment(h),n.addCameraPosition(e.vertex,g)),h.code.add(m.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${g.spherical?m.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:m.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${g.hasScreenSizePerspective?m.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:m.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):h.code.add(m.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.addVerticalOffset=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec4","../../../../../../chunks/vec4f64","../../shaderModules/Float4PassUniform","../../shaderModules/interfaces"],function(a,c,b,t,n){function r(d){return c.set(m,d.parameters.divisor,
d.parameters.offset,d.parameters.minPixelSize,d.paddingPixelsOverride)}const m=b.create();a.ScreenSizePerspective=function(d){d.vertex.code.add(n.glsl`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`);d.vertex.code.add(n.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);d.vertex.code.add(n.glsl`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`);d.vertex.code.add(n.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`);d.vertex.code.add(n.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);d.vertex.code.add(n.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`);d.vertex.code.add(n.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.addScreenSizePerspective=function(d){d.uniforms.add(new t.Float4PassUniform("screenSizePerspective",f=>r(f.screenSizePerspective)))};a.addScreenSizePerspectiveAlignment=function(d){d.uniforms.add(new t.Float4PassUniform("screenSizePerspectiveAlignment",f=>r(f.screenSizePerspectiveAlignment||f.screenSizePerspective)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../chunks/mat4 ../../../../../../chunks/mat4f32 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f){const e=b.create(),g=n.create();a.addCameraPosition=function(h,l){l.instancedDoublePrecision?h.constants.add("cameraPosition","vec3",n.ZEROS):h.uniforms.add(new r.Float3DrawUniform("cameraPosition",(v,q)=>t.set(g,q.camera.viewInverseTransposeMatrix[3]-v.origin[0],q.camera.viewInverseTransposeMatrix[7]-v.origin[1],q.camera.viewInverseTransposeMatrix[11]-v.origin[2])))};a.addProjViewLocalOrigin=function(h,l){l.instancedDoublePrecision?h.uniforms.add([new f.Matrix4PassUniform("proj",
(v,q)=>q.camera.projectionMatrix),new f.Matrix4PassUniform("view",(v,q)=>c.translate(e,q.camera.viewMatrix,t.set(g,q.camera.viewInverseTransposeMatrix[3],q.camera.viewInverseTransposeMatrix[7],q.camera.viewInverseTransposeMatrix[11]))),new m.Float3PassUniform("localOrigin",(v,q)=>t.set(g,q.camera.viewInverseTransposeMatrix[3],q.camera.viewInverseTransposeMatrix[7],q.camera.viewInverseTransposeMatrix[11]))]):h.uniforms.add([new f.Matrix4PassUniform("proj",(v,q)=>q.camera.projectionMatrix),new d.Matrix4DrawUniform("view",
(v,q)=>c.translate(e,q.camera.viewMatrix,v.origin)),new r.Float3DrawUniform("localOrigin",v=>v.origin)])};a.addViewNormal=function(h){h.uniforms.add(new f.Matrix4PassUniform("viewNormal",(l,v)=>v.camera.viewInverseTransposeMatrix))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,
t){b=function(n){function r(m,d){return n.call(this,m,"mat4",t.BindType.Draw,(f,e,g)=>f.setUniformMatrix4fv(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Matrix4DrawUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDUniforms":function(){define(["exports"],function(a){a.HUDTransparentRenderStyle=void 0;var c=a.HUDTransparentRenderStyle||(a.HUDTransparentRenderStyle={});c[c.Occluded=0]="Occluded";c[c.NotOccluded=
1]="NotOccluded";c[c.Both=2]="Both";c[c.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3f64 ../core/shaderModules/interfaces ./AnimationTimer ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),function(a,c,b,t,n,r,m,d,f,e){m=function(g){function h(v,
q){var k=g.call(this)||this;k.type=d.ContentObjectType.Material;k.supportsEdges=!1;k._visible=!0;k._renderPriority=0;k._insertOrder=0;k._vertexAttributeLocations=f.Default3D;k._pp0=t.fromValues(0,0,1);k._pp1=t.fromValues(0,0,0);k._parameters=e.copyParameters(v,q);k.validateParameters(k._parameters);return k}c._inheritsLoose(h,g);var l=h.prototype;l.dispose=function(){};l.update=function(v){return!1};l.setParameters=function(v,q=!0){e.updateParameters(this._parameters,v)&&(this.validateParameters(this._parameters),
q&&this.parametersChanged())};l.validateParameters=function(v){};l.shouldRender=function(v){return this.isVisible()&&this.isVisibleForOutput(v.output)&&0!==(this.renderOccluded&v.renderOccludedMask)};l.isVisibleForOutput=function(v){return!0};l.isVisible=function(){return this._visible};l.parametersChanged=function(){b.isSome(this.repository)&&this.repository.materialChanged(this)};l.intersectDraped=function(v,q,k,p,z,C){this._pp0[0]=this._pp1[0]=p[0];this._pp0[1]=this._pp1[1]=p[1];return this.intersect(v,
q,k,this._pp0,this._pp1,z)};c._createClass(h,[{key:"parameters",get:function(){return this._parameters}},{key:"visible",get:function(){return this._visible},set:function(v){v!==this._visible&&(this._visible=v,this.parametersChanged())}},{key:"renderOccluded",get:function(){return this.parameters.renderOccluded}},{key:"renderPriority",get:function(){return this._renderPriority},set:function(v){v!==this._renderPriority&&(this._renderPriority=v,this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},
set:function(v){v!==this._insertOrder&&(this._insertOrder=v,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return h}(m.ContentObject);r=function(g){function h(l,v,q){v=g.call(this,v,q)||this;v.camera=l;return v}c._inheritsLoose(h,g);return h}(r.Parameters);a.RenderOccludedFlag=void 0;(function(g){g[g.Occlude=1]="Occlude";g[g.Transparent=2]="Transparent";g[g.OccludeAndTransparent=4]="OccludeAndTransparent";g[g.OccludeAndTransparentStencil=
8]="OccludeAndTransparentStencil";g[g.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));n=function(g){function h(){var l=g.apply(this,arguments)||this;l.renderOccluded=a.RenderOccludedFlag.Occlude;return l}c._inheritsLoose(h,g);return h}(n.NoParameters);a.Material=m;a.MaterialParameters=n;a.UpdateParameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/ContentObjectType ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){function h(w,D,F,E,K,J){if(!t.isNone(w)){var M=q(D,F,A);m.setMin(B,w.bbMin);m.setMax(B,w.bbMax);t.isSome(K)&&K.applyToAabb(B);if(k(B,D,M,E)){const {primitiveIndices:N,indices:P,position:I}=w;M=N?N.length:P.length/3;if(1E3<M&&(w=w.getChildren(),void 0!==w)){for(const G of w)h(G,D,F,E,K,J);return}l(D,F,0,M,P,I,N,K,J)}}}function l(w,D,F,E,K,J,M,N,P){if(M){const {data:ca,stride:ja}=J;J=w[0];var I=w[1];w=w[2];var G=D[0]-J,H=D[1]-I;for(D=D[2]-w;F<E;++F){var L=M[F],O=3*L,
S=ja*K[O++],R=ca[S++],Q=ca[S++],V=ca[S];S=ja*K[O++];var aa=ca[S++],X=ca[S++],W=ca[S];S=ja*K[O];O=ca[S++];var T=ca[S++];S=ca[S];t.isSome(N)&&([R,Q,V]=N.applyToVertex(R,Q,V,F),[aa,X,W]=N.applyToVertex(aa,X,W,F),[O,T,S]=N.applyToVertex(O,T,S,F));aa-=R;X-=Q;W-=V;O-=R;T-=Q;S-=V;var U=H*S-T*D,Y=D*O-S*G;const ia=G*T-O*H;var ba=aa*U+X*Y+W*ia;if(!(Math.abs(ba)<=Number.EPSILON)){R=J-R;Q=I-Q;V=w-V;U=R*U+Q*Y+V*ia;if(0<ba){if(0>U||U>ba)continue}else if(0<U||U<ba)continue;Y=Q*W-X*V;V=V*aa-W*R;Q=R*X-aa*Q;R=G*Y+
H*V+D*Q;if(0<ba){if(0>R||U+R>ba)continue}else if(0<R||U+R<ba)continue;V=(O*Y+T*V+S*Q)/ba;0<=V&&(aa=v(aa,X,W,O,T,S,x),P(V,aa,L,!1))}}}else{var {data:da,stride:ea}=J;M=w[0];J=w[1];I=w[2];w=D[0]-M;G=D[1]-J;H=D[2]-I;for(let ca=F,ja=3*F;ca<E;++ca)if(O=ea*K[ja++],Q=da[O++],V=da[O++],W=da[O],O=ea*K[ja++],D=da[O++],F=da[O++],L=da[O],O=ea*K[ja++],aa=da[O++],X=da[O++],O=da[O],t.isSome(N)&&([Q,V,W]=N.applyToVertex(Q,V,W,ca),[D,F,L]=N.applyToVertex(D,F,L,ca),[aa,X,O]=N.applyToVertex(aa,X,O,ca)),D-=Q,F-=V,L-=
W,aa-=Q,X-=V,O-=W,S=G*O-X*H,R=H*aa-O*w,ba=w*X-aa*G,T=D*S+F*R+L*ba,!(Math.abs(T)<=Number.EPSILON)){Q=M-Q;V=J-V;W=I-W;S=Q*S+V*R+W*ba;if(0<T){if(0>S||S>T)continue}else if(0<S||S<T)continue;R=V*L-F*W;W=W*D-L*Q;V=Q*F-D*V;Q=w*R+G*W+H*V;if(0<T){if(0>Q||S+Q>T)continue}else if(0<Q||S+Q<T)continue;W=(aa*R+X*W+O*V)/T;0<=W&&(D=v(D,F,L,aa,X,O,x),P(W,D,ca,!1))}}}function v(w,D,F,E,K,J,M){n.set(u,w,D,F);n.set(y,E,K,J);n.cross(M,u,y);n.normalize(M,M);return M}function q(w,D,F){return n.set(F,1/(D[0]-w[0]),1/(D[1]-
w[1]),1/(D[2]-w[2]))}function k(w,D,F,E){return p(w,D,F,E,Infinity)}function p(w,D,F,E,K){var J=(w[0]-E-D[0])*F[0],M=(w[3]+E-D[0])*F[0];let N=Math.min(J,M);J=Math.max(J,M);M=(w[1]-E-D[1])*F[1];const P=(w[4]+E-D[1])*F[1];J=Math.min(J,Math.max(M,P));if(0>J)return!1;N=Math.max(N,Math.min(M,P));if(N>J)return!1;M=(w[2]-E-D[2])*F[2];w=(w[5]+E-D[2])*F[2];J=Math.min(J,Math.max(M,w));if(0>J)return!1;N=Math.max(N,Math.min(M,w));return N>J?!1:N<K}function z(w,D){D=D?z(D):{};for(const F in w){let E=w[F];E&&E.forEach&&
(E=C(E));null==E&&F in D||(D[F]=E)}return D}function C(w){const D=[];w.forEach(F=>D.push(F));return D}const B=m.create(),A=r.create(),x=r.create(),u=r.create(),y=r.create();a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=q;a.computeNormal=v;a.copyParameters=z;a.intersectAabbInvDir=k;a.intersectAabbInvDirBefore=p;a.intersectTriangleGeometry=function(w,D,F,E,K,J){w.visible&&(w.boundingInfo?(e.assert(w.type===d.ContentObjectType.Mesh),h(w.boundingInfo,F,E,D.tolerance,K,J)):(D=
w.indices.get(g.VertexAttribute.POSITION),w=w.vertexAttributes.get(g.VertexAttribute.POSITION),l(F,E,0,D.length/3,D,w,void 0,K,J)))};a.intersectTriangles=l;a.updateParameters=function(w,D){let F=!1;for(const E in D){const K=D[E];void 0!==K&&(Array.isArray(K)?null===w[E]?(w[E]=K.slice(),F=!0):c.update(w[E],K)&&(F=!0):w[E]!==K&&(F=!0,w[E]=K))}return F};a.verticalOffsetAtDistance=function(w,D,F,E,K){let J=(F.screenLength||0)*w.pixelRatio;t.isSome(K)&&(J=f.scale(J,E,D,K));return b.clamp(J*Math.tan(.5*
w.fovY)/(.5*w.fullHeight)*D,F.minWorldLength||0,null!=F.maxWorldLength?F.maxWorldLength:Infinity)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ScaleInfo":function(){define(["exports"],function(a){let c=function(){this.paddingPixels=this.minPixelSize=this.factor=this.scale=0};a.ScaleFactor=c;a.ScaleInfo=function(){this.factor=new c;this.factorAlignment=new c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../geometry/support/buffer/BufferView ../../lib/Util ../../lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r){function m(q,k,p,z){const C=p.typedBuffer;p=p.typedBufferStride;const B=q.length;z*=p;for(let A=0;A<B;++A){const x=2*q[A];C[z]=k[x];C[z+1]=k[x+1];z+=p}}function d(q,k,p,z,C){const B=p.typedBuffer;p=p.typedBufferStride;const A=q.length;z*=p;if(null==C||1===C)for(C=0;C<A;++C){var x=3*q[C];B[z]=k[x];B[z+1]=k[x+1];B[z+2]=k[x+2];z+=p}else for(x=0;x<A;++x){const u=3*q[x];for(let y=0;y<C;++y)B[z]=k[u],B[z+1]=k[u+1],B[z+2]=k[u+2],z+=p}}function f(q,k,p,z,C=1){const B=p.typedBuffer;p=
p.typedBufferStride;const A=q.length;z*=p;if(1===C)for(C=0;C<A;++C){var x=4*q[C];B[z]=k[x];B[z+1]=k[x+1];B[z+2]=k[x+2];B[z+3]=k[x+3];z+=p}else for(x=0;x<A;++x){const u=4*q[x];for(let y=0;y<C;++y)B[z]=k[u],B[z+1]=k[u+1],B[z+2]=k[u+2],B[z+3]=k[u+3],z+=p}}function e(q,k,p,z,C,B=1){if(p){var A=z.typedBuffer;z=z.typedBufferStride;var x=q.length,u=p[0],y=p[1],w=p[2],D=p[4],F=p[5],E=p[6],K=p[8],J=p[9],M=p[10],N=p[12],P=p[13],I=p[14];C*=z;var G=0,H=0,L=0;p=b.hasIdentityRotation(p)?O=>{G=k[O]+N;H=k[O+1]+P;
L=k[O+2]+I}:O=>{const S=k[O],R=k[O+1];O=k[O+2];G=u*S+D*R+K*O+N;H=y*S+F*R+J*O+P;L=w*S+E*R+M*O+I};if(1===B)for(B=0;B<x;++B)p(3*q[B]),A[C]=G,A[C+1]=H,A[C+2]=L,C+=z;else for(let O=0;O<x;++O){p(3*q[O]);for(let S=0;S<B;++S)A[C]=G,A[C+1]=H,A[C+2]=L,C+=z}}else d(q,k,z,C,B)}function g(q,k,p,z,C,B=1){if(p){var A=z.typedBuffer;z=z.typedBufferStride;var x=q.length,u=p[0],y=p[1],w=p[2],D=p[4],F=p[5],E=p[6],K=p[8],J=p[9],M=p[10],N=!b.isOrthoNormal(p);C*=z;var P=0,I=0,G=0;p=b.hasIdentityRotation(p)?L=>{P=k[L];I=
k[L+1];G=k[L+2]}:L=>{const O=k[L],S=k[L+1];L=k[L+2];P=u*O+D*S+K*L;I=y*O+F*S+J*L;G=w*O+E*S+M*L};if(1===B)if(N)for(B=0;B<x;++B)p(3*q[B]),N=P*P+I*I+G*G,.999999>N&&1E-6<N?(N=1/Math.sqrt(N),A[C]=P*N,A[C+1]=I*N,A[C+2]=G*N):(A[C]=P,A[C+1]=I,A[C+2]=G),C+=z;else for(B=0;B<x;++B)p(3*q[B]),A[C]=P,A[C+1]=I,A[C+2]=G,C+=z;else for(let L=0;L<x;++L){p(3*q[L]);if(N){var H=P*P+I*I+G*G;.999999>H&&1E-6<H&&(H=1/Math.sqrt(H),P*=H,I*=H,G*=H)}for(H=0;H<B;++H)A[C]=P,A[C+1]=I,A[C+2]=G,C+=z}}else d(q,k,z,C,B)}function h(q,
k,p,z,C,B=1){if(p){var A=z.typedBuffer;z=z.typedBufferStride;var x=q.length,u=p[0],y=p[1],w=p[2],D=p[4],F=p[5],E=p[6],K=p[8],J=p[9],M=p[10];p=!b.isOrthoNormal(p);C*=z;if(1===B)for(B=0;B<x;++B){var N=4*q[B],P=k[N],I=k[N+1],G=k[N+2];N=k[N+3];var H=u*P+D*I+K*G,L=y*P+F*I+J*G;P=w*P+E*I+M*G;p&&(I=H*H+L*L+P*P,.999999>I&&1E-6<I&&(I=1/Math.sqrt(I),H*=I,L*=I,P*=I));A[C]=H;A[C+1]=L;A[C+2]=P;A[C+3]=N;C+=z}else for(N=0;N<x;++N){H=4*q[N];I=k[H];G=k[H+1];const O=k[H+2];H=k[H+3];L=u*I+D*G+K*O;P=y*I+F*G+J*O;I=w*I+
E*G+M*O;p&&(G=L*L+P*P+I*I,.999999>G&&1E-6<G&&(G=1/Math.sqrt(G),L*=G,P*=G,I*=G));for(G=0;G<B;++G)A[C]=L,A[C+1]=P,A[C+2]=I,A[C+3]=H,C+=z}}else f(q,k,z,C,B)}function l(q,k,p,z,C,B=1){var A=z.typedBuffer,x=z.typedBufferStride,u=q.length;C*=x;if(p===k.length&&4===p)for(A[C]=k[0],A[C+1]=k[1],A[C+2]=k[2],A[C+3]=k[3],q=new Uint32Array(z.typedBuffer.buffer,z.start),x/=4,C/=4,k=q[C],C+=x,u*=B,A=1;A<u;++A)q[C]=k,C+=x;else if(1===B)if(4===p)for(B=0;B<u;++B)p=4*q[B],A[C]=k[p],A[C+1]=k[p+1],A[C+2]=k[p+2],A[C+3]=
k[p+3],C+=x;else for(B=0;B<u;++B)p=3*q[B],A[C]=k[p],A[C+1]=k[p+1],A[C+2]=k[p+2],A[C+3]=255,C+=x;else if(4===p)for(p=0;p<u;++p){z=4*q[p];for(var y=0;y<B;++y)A[C]=k[z],A[C+1]=k[z+1],A[C+2]=k[z+2],A[C+3]=k[z+3],C+=x}else for(p=0;p<u;++p)for(z=3*q[p],y=0;y<B;++y)A[C]=k[z],A[C+1]=k[z+1],A[C+2]=k[z+2],A[C+3]=255,C+=x}function v(q,k,p,z,C=1){const B=k.typedBuffer;k=k.typedBufferStride;z*=k;if(1===C)for(C=0;C<p;++C)B[z]=q[0],B[z+1]=q[1],B[z+2]=q[2],B[z+3]=q[3],z+=k;else for(let A=0;A<p;++A)for(let x=0;x<
C;++x)B[z]=q[0],B[z+1]=q[1],B[z+2]=q[2],B[z+3]=q[3],z+=k}a.writeBufferFloat=function(q,k,p,z,C=1){const B=p.typedBuffer;p=p.typedBufferStride;const A=q.length;z*=p;if(1===C)for(C=0;C<A;++C)B[z]=k[q[C]],z+=p;else for(let x=0;x<A;++x){const u=k[q[x]];for(let y=0;y<C;y++)B[z]=u,z+=p}};a.writeBufferMat3f=function(q,k,p,z){const C=p.typedBuffer;p=p.typedBufferStride;const B=q.length;z*=p;for(let A=0;A<B;++A){const x=9*q[A];for(let u=0;9>u;++u)C[z+u]=k[x+u];z+=p}};a.writeBufferMat4f=function(q,k,p,z){const C=
p.typedBuffer;p=p.typedBufferStride;const B=q.length;z*=p;for(let A=0;A<B;++A){const x=16*q[A];for(let u=0;16>u;++u)C[z+u]=k[x+u];z+=p}};a.writeBufferVec2=m;a.writeBufferVec3=d;a.writeBufferVec4=f;a.writeBufferVec4Zeros=function(q,k,p){const z=q.typedBuffer;q=q.typedBufferStride;k*=q;for(let C=0;C<p;++C)z[k]=0,z[k+1]=0,z[k+2]=0,z[k+3]=0,k+=q};a.writeColor=l;a.writeDefaultAttributes=function(q,k,p,z,C,B){for(const u of k.fieldNames){k=q.vertexAttributes.get(u);var A=q.indices.get(u);if(k&&A)switch(u){case r.VertexAttribute.POSITION:n.assert(3===
k.size);var x=C.getField(u,t.BufferViewVec3f);n.assert(!!x,`No buffer view for ${u}`);x&&e(A,k.data,p,x,B);break;case r.VertexAttribute.NORMAL:n.assert(3===k.size);x=C.getField(u,t.BufferViewVec3f);n.assert(!!x,`No buffer view for ${u}`);x&&g(A,k.data,z,x,B);break;case r.VertexAttribute.UV0:n.assert(2===k.size);x=C.getField(u,t.BufferViewVec2f);n.assert(!!x,`No buffer view for ${u}`);x&&m(A,k.data,x,B);break;case r.VertexAttribute.COLOR:case r.VertexAttribute.SYMBOLCOLOR:n.assert(3===k.size||4===
k.size);x=C.getField(u,t.BufferViewVec4u8);n.assert(!!x,`No buffer view for ${u}`);x&&l(A,k.data,k.size,x,B);break;case r.VertexAttribute.TANGENT:n.assert(4===k.size);x=C.getField(u,t.BufferViewVec4f);n.assert(!!x,`No buffer view for ${u}`);x&&h(A,k.data,z,x,B);break;case r.VertexAttribute.PROFILERIGHT:case r.VertexAttribute.PROFILEUP:case r.VertexAttribute.PROFILEVERTEXANDNORMAL:case r.VertexAttribute.FEATUREVALUE:n.assert(4===k.size),x=C.getField(u,t.BufferViewVec4f),n.assert(!!x,`No buffer view for ${u}`),
x&&f(A,k.data,x,B)}else u===r.VertexAttribute.OBJECTANDLAYERIDCOLOR&&c.isSome(q.objectAndLayerIdColor)&&(k=q.indices.get(r.VertexAttribute.POSITION),n.assert(!!k,`No buffer view for ${u}`),k&&(k=k.length,A=C.getField(u,t.BufferViewVec4u8),v(q.objectAndLayerIdColor,A,k,B)))}};a.writeNormal=g;a.writeObjectAndLayerIdColor=v;a.writePosition=e;a.writeTangent=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ./vec4f64 ../views/3d/support/engineContent/sdfPrimitives ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4sPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/VisualVariablePassParameters".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K){function J(I){const G=new w.ShaderBuilder;var H=I.signedDistanceFieldEnabled;G.include(e.AlignPixel);G.include(g.HUD,I);G.include(d.SliceDraw,I);if(I.occlusionPass)return G.include(h.HUDOcclusionPass,I),G;const {vertex:L,fragment:O}=G;G.include(z.ScreenSizePerspective);O.include(p.RgbaFloatEncoding);O.include(k.ColorConversion);G.include(v.VisualVariables,I);G.include(f.ObjectAndLayerIdColor,I);G.varyings.add("vcolor","vec4");G.varyings.add("vtc",
"vec2");G.varyings.add("vsize","vec2");I.binaryHighlightOcclusionEnabled&&G.varyings.add("voccluded","float");L.uniforms.add([new B.Float4PassUniform("viewport",(Q,V)=>V.camera.fullViewport),new C.Float2PassUniform("screenOffset",(Q,V)=>b.set(N,2*Q.screenOffset[0]*V.camera.pixelRatio,2*Q.screenOffset[1]*V.camera.pixelRatio)),new C.Float2PassUniform("anchorPosition",Q=>M(Q)),new B.Float4PassUniform("materialColor",Q=>Q.color),new x.FloatPassUniform("pixelRatio",(Q,V)=>V.camera.pixelRatio)]);H&&(L.uniforms.add(new B.Float4PassUniform("outlineColor",
Q=>Q.outlineColor)),O.uniforms.add([new B.Float4PassUniform("outlineColor",Q=>0<Q.outlineColor[3]&&0<Q.outlineSize?Q.outlineColor:n.ZEROS),new x.FloatPassUniform("outlineSize",Q=>0<Q.outlineColor[3]&&0<Q.outlineSize?Q.outlineSize:0)]));I.hasScreenSizePerspective&&(z.addScreenSizePerspective(L),z.addScreenSizePerspectiveAlignment(L));(I.debugDrawLabelBorder||I.binaryHighlightOcclusionEnabled)&&G.varyings.add("debugBorderCoords","vec4");G.attributes.add(E.VertexAttribute.UV0,"vec2");G.attributes.add(E.VertexAttribute.COLOR,
"vec4");G.attributes.add(E.VertexAttribute.SIZE,"vec2");G.attributes.add(E.VertexAttribute.AUXPOS2,"vec4");L.code.add(y.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      forwardObjectAndLayerIdColor();

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${I.hasScreenSizePerspective?y.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:y.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${I.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${I.occlusionTestEnabled||I.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${I.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var S=y.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const R=I.pixelSnappingEnabled?H?y.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:y.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:y.glsl`posProj += quadOffset;`;I.vvColor&&L.uniforms.add([new A.Float4sPassUniform("vvColorColors",Q=>Q.vvColorColors,K.vvColorNumber),new u.FloatsPassUniform("vvColorValues",Q=>Q.vvColorValues,K.vvColorNumber)]);L.uniforms.add(new C.Float2PassUniform("textureCoordinateScaleFactor",Q=>c.isSome(Q.texture)&&c.isSome(Q.texture.descriptor.textureCoordinateScaleFactor)?Q.texture.descriptor.textureCoordinateScaleFactor:t.ONES));L.code.add(y.glsl`
    ${I.occlusionTestEnabled?"if (visible) {":""}
    ${S}
    ${I.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    ${I.output===m.ShaderOutput.ObjectAndLayerIdColor?y.glsl`vcolor.a = 1.0;`:""}

    bool alphaDiscard = vcolor.a < ${y.glsl.float(q.symbolAlphaCutoff)};
    ${H?`alphaDiscard = alphaDiscard && outlineColor.a < ${y.glsl.float(q.symbolAlphaCutoff)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${R}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${I.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${I.occlusionTestEnabled?y.glsl`} else { vtc = vec2(0.0);
      ${I.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `);O.uniforms.add(new D.Texture2DPassUniform("tex",Q=>Q.texture));S=I.debugDrawLabelBorder?y.glsl`(isBorder > 0.0 ? 0.0 : ${y.glsl.float(q.defaultMaskAlphaCutoff)})`:y.glsl.float(q.defaultMaskAlphaCutoff);H=y.glsl`
    ${I.debugDrawLabelBorder?y.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${H?y.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${y.glsl.float(r.DEFAULT_TEX_SIZE)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${S} ||
          fillPixelColor.a + outlinePixelColor.a < ${y.glsl.float(q.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${S}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:y.glsl`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${S}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${I.debugDrawLabelBorder?y.glsl`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;I.output===m.ShaderOutput.Alpha&&O.code.add(y.glsl`
      void main() {
        ${H}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `);I.output===m.ShaderOutput.ObjectAndLayerIdColor&&O.code.add(y.glsl`
      void main() {
        ${H}
        outputObjectAndLayerIdColor();
      }
      `);I.output===m.ShaderOutput.Color&&O.code.add(y.glsl`
    void main() {
      ${H}
      ${I.transparencyPassType===F.TransparencyPassType.FrontFace?"gl_FragColor.rgb /\x3d gl_FragColor.a;":""}
    }
    `);I.output===m.ShaderOutput.Highlight&&(G.include(l.OutputHighlight,I),O.code.add(y.glsl`
    void main() {
      ${H}
      ${I.binaryHighlightOcclusionEnabled?y.glsl`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return G}function M(I,G=N){if(I.textureIsSignedDistanceField){var H=I.anchorPosition;I=I.distanceFieldBoundingBox;c.isSome(I)?b.set(G,H[0]*(I[2]-I[0])+I[0],H[1]*(I[3]-I[1])+I[1]):b.set(G,0,0)}else b.copy(G,I.anchorPosition);return G}const N=t.create(),P=Object.freeze(Object.defineProperty({__proto__:null,build:J,calculateAnchorPosForRendering:M},Symbol.toStringTag,{value:"Module"}));a.HUDMaterial=P;a.build=J;a.calculateAnchorPosForRendering=M})},"esri/views/3d/support/engineContent/sdfPrimitives":function(){define(["exports",
"../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,c,b,t,n){function r(C,B=128,A=.5*B,x=0){switch(C){case "circle":return m(B,A);case "square":return d(B,A);case "cross":return e(B,A,x);case "x":return g(B,A,x);case "kite":return f(B,A);case "triangle":return h(B,A);case "arrow":return l(B,A);default:return m(B,A)}}function m(C,B){const A=C/2-.5;return z(C,k(A,A,B/2))}function d(C,B){return v(C,B,!1)}function f(C,B){return v(C,B,
!0)}function e(C,B,A=0){return q(C,B,!1,A)}function g(C,B,A=0){return q(C,B,!0,A)}function h(C,B){return z(C,p(C/2,B,B/2))}function l(C,B){const A=B/2,x=C/2,u=.8*B,y=k(x,(C-B)/2-u,Math.sqrt(u*u+A*A)),w=p(x,B,A);return z(C,(D,F)=>Math.max(w(D,F),-y(D,F)))}function v(C,B,A){A&&(B/=Math.SQRT2);return z(C,(x,u)=>{x=x-.5*C+.25;u=-u+.5*C-.75;if(A){const y=(x+u)/Math.SQRT2;u=(u-x)/Math.SQRT2;x=y}return Math.max(Math.abs(x),Math.abs(u))-.5*B})}function q(C,B,A,x=0){B-=x;A&&(B*=Math.SQRT2);const u=.5*B;return z(C,
(y,w)=>{y-=.5*C;w=-w+.5*C-1;if(A){const D=(y+w)/Math.SQRT2;w=(w-y)/Math.SQRT2;y=D}y=Math.abs(y);w=Math.abs(w);y=y>w?y>u?Math.sqrt((y-u)*(y-u)+w*w):w:w>u?Math.sqrt(y*y+(w-u)*(w-u)):y;return y-=x/2})}function k(C,B,A){return(x,u)=>{x-=C;u-=B;return Math.sqrt(x*x+u*u)-A}}function p(C,B,A){const x=Math.sqrt(B*B+A*A);return(u,y)=>{y=y-C+B/2+.75;return Math.max((B*(Math.abs(u-C)-A)+A*y)/x,-y)}}function z(C,B){const A=new Uint8Array(4*C*C);for(let x=0;x<C;x++)for(let u=0;u<C;u++){const y=u+C*x;let w=B(u,
x);w=w/C+.5;b.packFloatRGBA(w,A,4*y)}return A}a.DEFAULT_SYMBOL_SIZE_RATIO=.5;a.DEFAULT_TEX_SIZE=128;a.createArrow=l;a.createCircle=m;a.createCross=e;a.createKite=f;a.createSquare=d;a.createTexture=function(C,B=128,A=.5*B,x=0){C=r(C,B,A,x);return new t.Texture(C,{mipmap:!1,wrap:{s:n.TextureWrapMode.CLAMP_TO_EDGE,t:n.TextureWrapMode.CLAMP_TO_EDGE},width:B,height:B,components:4,noUnpackFlip:!0})};a.createTriangle=h;a.createX=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/floatRGBA":function(){define(["exports",
"./mathUtils"],function(a,c){function b(m,d=0){let f=0;for(let e=0;4>e;e++)f+=m[d+e]*n[e];return f}const t=[1,256,65536,16777216],n=[1/256,1/65536,1/16777216,1/4294967296],r=b(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(m,d,f=0){m=c.clamp(m,0,r);for(let h=0;4>h;h++){var e=Math,g=m*t[h];d[f+h]=e.floor.call(e,256*(g-Math.floor(g)))}};a.unpackFloatRGBA=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ../../../../chunks/TextureOnly.glsl ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./glUtil3D ./Util ../../../webgl/context-util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w){k=function(F){function E(J,M){var N=F.call(this)||this;N._data=J;N.type=p.ContentObjectType.Texture;N._glTexture=null;N._powerOfTwoStretchInfo=null;N._loadingPromise=null;N._loadingController=null;N.events=new n;N._passParameters=new l.TextureOnlyPassParameters;N.params=M||{};N.params.mipmap=!1!==N.params.mipmap;N.params.noUnpackFlip=N.params.noUnpackFlip||!1;N.params.preMultiplyAlpha=N.params.preMultiplyAlpha||!1;N.params.wrap=N.params.wrap||
{s:x.TextureWrapMode.REPEAT,t:x.TextureWrapMode.REPEAT};N.params.powerOfTwoResizeMode=N.params.powerOfTwoResizeMode||v.PowerOfTwoResizeMode.STRETCH;N.estimatedTexMemRequired=E._estimateTexMemRequired(N._data,N.params);N._startPreload();return N}c._inheritsLoose(E,F);var K=E.prototype;K._startPreload=function(){const J=this._data;m.isNone(J)||(J instanceof HTMLVideoElement?this._startPreloadVideoElement(J):J instanceof HTMLImageElement&&this._startPreloadImageElement(J))};K._startPreloadVideoElement=
function(J){if(!(e.isBlobProtocol(J.src)||"auto"===J.preload&&J.crossOrigin)){J.preload="auto";J.crossOrigin="anonymous";const M=!J.paused;J.src=J.src;if(M&&J.autoplay){const N=()=>{J.removeEventListener("canplay",N);J.play()};J.addEventListener("canplay",N)}}};K._startPreloadImageElement=function(J){e.isDataProtocol(J.src)||e.isBlobProtocol(J.src)||J.crossOrigin||(J.crossOrigin="anonymous",J.src=J.src)};E._getDataDimensions=function(J){return J instanceof HTMLVideoElement?{width:J.videoWidth,height:J.videoHeight}:
J};E._estimateTexMemRequired=function(J,M){if(m.isNone(J))return 0;if(f.isArrayBuffer(J)||f.isUint8Array(J))return M.encoding===v.TextureEncodingMimeType.KTX2_ENCODING?q.estimateMemoryKTX2(J,!!M.mipmap):M.encoding===v.TextureEncodingMimeType.BASIS_ENCODING?q.estimateMemoryBasis(J,!!M.mipmap):J.byteLength;const {width:N,height:P}=J instanceof Image||J instanceof ImageData||J instanceof HTMLCanvasElement||J instanceof HTMLVideoElement?E._getDataDimensions(J):M;return(M.mipmap?4/3:1)*N*P*(M.components||
4)||0};K.dispose=function(){this._data=void 0};K._createDescriptor=function(J){return{target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?x.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:x.TextureSamplingMode.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:this.params.maxAnisotropy??(this.params.mipmap?J.parameters.maxMaxAnisotropy:
1)}};K.load=function(J,M){if(m.isSome(this._glTexture))return this._glTexture;if(m.isSome(this._loadingPromise))return this._loadingPromise;const N=this._data;return m.isNone(N)?this._glTexture=new y.Texture(J,this._createDescriptor(J),null):"string"===typeof N?this._loadFromURL(J,M,N):N instanceof Image?this._loadFromImageElement(J,M,N):N instanceof HTMLVideoElement?this._loadFromVideoElement(J,M,N):N instanceof ImageData||N instanceof HTMLCanvasElement?this._loadFromImage(J,N,M):(f.isArrayBuffer(N)||
f.isUint8Array(N))&&this.params.encoding===v.TextureEncodingMimeType.DDS_ENCODING?(this._data=void 0,this._loadFromDDSData(J,N)):(f.isArrayBuffer(N)||f.isUint8Array(N))&&this.params.encoding===v.TextureEncodingMimeType.KTX2_ENCODING?(this._data=void 0,this._loadFromKTX2(J,N)):(f.isArrayBuffer(N)||f.isUint8Array(N))&&this.params.encoding===v.TextureEncodingMimeType.BASIS_ENCODING?(this._data=void 0,this._loadFromBasis(J,N)):f.isUint8Array(N)?this._loadFromPixelData(J,N):f.isArrayBuffer(N)?this._loadFromPixelData(J,
new Uint8Array(N)):null};K.frameUpdate=function(J,M,N){if(!(this._data instanceof HTMLVideoElement)||m.isNone(this._glTexture)||this._data.readyState<D.HAVE_CURRENT_DATA||N===this._data.currentTime)return N;if(m.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:P,vao:I,sourceTexture:G}=this._powerOfTwoStretchInfo;G.setData(this._data);this._drawStretchedTexture(J,M,P,I,G,this._glTexture)}else{const {videoWidth:P,videoHeight:I}=this._data,{width:G,height:H}=this._glTexture.descriptor;P!==G||
I!==H?this._glTexture.updateData(0,0,0,Math.min(P,G),Math.min(I,H),this._data):this._glTexture.setData(this._data)}this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();this.params.updateCallback&&this.params.updateCallback();return this._data.currentTime};K._loadFromDDSData=function(J,M){return this._glTexture=z.createDDSTexture(J,this._createDescriptor(J),M)};K._loadFromKTX2=function(J,M){return this._loadAsync(()=>q.createTextureKTX2(J,this._createDescriptor(J),M).then(N=>this._glTexture=
N))};K._loadFromBasis=function(J,M){return this._loadAsync(()=>q.createTextureBasis(J,this._createDescriptor(J),M).then(N=>this._glTexture=N))};K._loadFromPixelData=function(J,M){B.assert(0<this.params.width&&0<this.params.height);const N=this._createDescriptor(J);N.pixelFormat=1===this.params.components?x.PixelFormat.LUMINANCE:3===this.params.components?x.PixelFormat.RGB:x.PixelFormat.RGBA;N.width=this.params.width;N.height=this.params.height;return this._glTexture=new y.Texture(J,N,M)};K._loadFromURL=
function(J,M,N){var P=this;return this._loadAsync(function(){var I=c._asyncToGenerator(function*(G){const H=yield g.requestImage(N,{signal:G});d.throwIfAborted(G);return P._loadFromImage(J,H,M)});return function(G){return I.apply(this,arguments)}}())};K._loadFromImageElement=function(J,M,N){var P=this;return N.complete?this._loadFromImage(J,N,M):this._loadAsync(function(){var I=c._asyncToGenerator(function*(G){const H=yield h.loadImageAsync(N,N.src,!1,G);d.throwIfAborted(G);return P._loadFromImage(J,
H,M)});return function(G){return I.apply(this,arguments)}}())};K._loadFromVideoElement=function(J,M,N){return N.readyState>=D.HAVE_CURRENT_DATA?this._loadFromImage(J,N,M):this._loadFromVideoElementAsync(J,M,N)};K._loadFromVideoElementAsync=function(J,M,N){return this._loadAsync(P=>new Promise((I,G)=>{const H=()=>{N.removeEventListener("loadeddata",L);N.removeEventListener("error",O);m.removeMaybe(S)},L=()=>{N.readyState>=D.HAVE_CURRENT_DATA&&(H(),I(this._loadFromImage(J,N,M)))},O=R=>{H();G(R||new t("Failed to load video"))};
N.addEventListener("loadeddata",L);N.addEventListener("error",O);const S=d.onAbort(P,()=>O(d.createAbortError()))}))};K._loadFromImage=function(J,M,N){const P=E._getDataDimensions(M);this.params.width=P.width;this.params.height=P.height;const I=this._createDescriptor(J);I.pixelFormat=3===this.params.components?x.PixelFormat.RGB:x.PixelFormat.RGBA;if(this._requiresPowerOfTwo(J,I)&&(!r.isPowerOfTwo(P.width)||!r.isPowerOfTwo(P.height)))return this._glTexture=this._makePowerOfTwoTexture(J,M,P,I,N);I.width=
P.width;I.height=P.height;return this._glTexture=new y.Texture(J,I,M)};K._loadAsync=function(J){const M=new AbortController;this._loadingController=M;const N=J(M.signal);this._loadingPromise=N;J=()=>{this._loadingController===M&&(this._loadingController=null);this._loadingPromise===N&&(this._loadingPromise=null)};N.then(J,J);return N};K._requiresPowerOfTwo=function(J,M){var N=x.TextureWrapMode.CLAMP_TO_EDGE;N="number"===typeof M.wrapMode?M.wrapMode===N:M.wrapMode.s===N&&M.wrapMode.t===N;return J.type===
A.ContextType.WEBGL1&&(M.hasMipmap||!N)};K._makePowerOfTwoTexture=function(J,M,N,P,I){const {width:G,height:H}=N;N=r.nextHighestPowerOfTwo(G);const L=r.nextHighestPowerOfTwo(H);P.width=N;P.height=L;let O;switch(this.params.powerOfTwoResizeMode){case v.PowerOfTwoResizeMode.PAD:P.textureCoordinateScaleFactor=[G/N,H/L];O=new y.Texture(J,P);O.updateData(0,0,0,G,H,M);break;case v.PowerOfTwoResizeMode.STRETCH:case null:case void 0:O=this._stretchToPowerOfTwo(J,M,P,I());break;default:b.neverReached(this.params.powerOfTwoResizeMode)}P.hasMipmap&&
O.generateMipmap();return O};K._stretchToPowerOfTwo=function(J,M,N,P){const I=new y.Texture(J,N),G=new u.FramebufferObject(J,{colorTarget:x.TargetType.TEXTURE,depthStencilTarget:x.DepthStencilTargetType.NONE},I);M=new y.Texture(J,{target:x.TextureType.TEXTURE_2D,pixelFormat:N.pixelFormat,dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:x.TextureSamplingMode.LINEAR,flipped:!!N.flipped,maxAnisotropy:8,preMultiplyAlpha:N.preMultiplyAlpha},M);N=C.createQuadVAO(J);
const H=J.getBoundFramebufferObject();this._drawStretchedTexture(J,P,G,N,M,I);this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:N,sourceTexture:M,framebuffer:G}:(N.dispose(!0),M.dispose(),G.detachColorTexture(),G.dispose());J.bindFramebuffer(H);return I};K._drawStretchedTexture=function(J,M,N,P,I,G){this._passParameters.texture=I;J.bindFramebuffer(N);N=J.getViewport();J.setViewport(0,0,G.descriptor.width,G.descriptor.height);J.bindTechnique(M,this._passParameters,null);J.bindVAO(P);J.drawArrays(x.PrimitiveType.TRIANGLE_STRIP,
0,w.vertexCount(P,"geometry"));J.bindFramebuffer(null);J.setViewport(N.x,N.y,N.width,N.height);this._passParameters.texture=null};K.unload=function(){if(m.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:J,vao:M,sourceTexture:N}=this._powerOfTwoStretchInfo;M.dispose(!0);N.dispose();J.dispose();this._powerOfTwoStretchInfo=this._glTexture=null}m.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);if(m.isSome(this._loadingController)){const J=this._loadingController;this._loadingPromise=
this._loadingController=null;J.abort()}this.events.emit("unloaded")};c._createClass(E,[{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"glTexture",get:function(){return this._glTexture}},{key:"requiresFrameUpdates",get:function(){return this._data instanceof HTMLVideoElement}}]);return E}(k.ContentObject);var D;(function(F){F[F.HAVE_NOTHING=0]="HAVE_NOTHING";F[F.HAVE_METADATA=1]="HAVE_METADATA";F[F.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA";
F[F.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";F[F.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(D||(D={}));a.Texture=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/support/requestImageUtils":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../request"],function(a,c,b){function t(){t=c._asyncToGenerator(function*(n,r){({data:n}=yield b(n,{responseType:"image",...r}));return n});return t.apply(this,arguments)}a.requestImage=function(n,r){return t.apply(this,arguments)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,c,b,t,n,r,m,d){function f(){const h=
new m.ShaderBuilder;h.include(t.ScreenSpacePass);h.fragment.uniforms.add([new d.Texture2DPassUniform("tex",l=>l.texture),new n.Float4PassUniform("uColor",l=>l.color)]);h.fragment.code.add(r.glsl`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`);return h}let e=function(h){function l(){var v=h.apply(this,arguments)||this;v.color=b.fromValues(1,1,1,1);return v}c._inheritsLoose(l,h);return l}(r.NoParameters);const g=Object.freeze(Object.defineProperty({__proto__:null,TextureOnlyPassParameters:e,build:f},Symbol.toStringTag,{value:"Module"}));a.TextureOnly=g;a.TextureOnlyPassParameters=e;a.build=f})},"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d){function f(){return e.apply(this,arguments)}function e(){e=c._asyncToGenerator(function*(){b.isNone(z)&&(z=t.getBasisTranscoder(),p=yield z);return z});return e.apply(this,arguments)}function g(C,B,A,x,u){B=d.getBytesPerElementFormat(B?r.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:r.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(A*x*B*(u&&1<C?(4**C-1)/(3*4**(C-1)):1))}function h(C){return 1<=C.getNumImages()&&!C.isUASTC()}function l(C){return 1<=C.getFaces()&&
C.isETC1S()}function v(){v=c._asyncToGenerator(function*(C,B,A){b.isNone(p)&&(p=yield f());const x=new p.BasisFile(new Uint8Array(A));if(!h(x))return null;x.startTranscoding();C=k(C,B,x.getNumLevels(0),x.getHasAlpha(),x.getImageWidth(0,0),x.getImageHeight(0,0),(u,y)=>x.getImageTranscodedSizeInBytes(0,u,y),(u,y,w)=>x.transcodeImage(w,0,u,y,0,0));x.close();x.delete();return C});return v.apply(this,arguments)}function q(){q=c._asyncToGenerator(function*(C,B,A){b.isNone(p)&&(p=yield f());const x=new p.KTX2File(new Uint8Array(A));
if(!l(x))return null;x.startTranscoding();C=k(C,B,x.getLevels(),x.getHasAlpha(),x.getWidth(),x.getHeight(),(u,y)=>x.getImageTranscodedSizeInBytes(u,0,0,y),(u,y,w)=>x.transcodeImage(w,u,0,0,y,0,-1,-1));x.close();x.delete();return C});return q.apply(this,arguments)}function k(C,B,A,x,u,y,w,D){const {compressedTextureETC:F,compressedTextureS3TC:E}=C.capabilities,[K,J]=F?x?[n.TextureFormat.ETC2_RGBA,r.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[n.TextureFormat.ETC1_RGB,r.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:
E?x?[n.TextureFormat.BC3_RGBA,r.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[n.TextureFormat.BC1_RGB,r.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:[n.TextureFormat.RGBA32,r.PixelFormat.RGBA];x=B.hasMipmap?A:Math.min(1,A);A=[];for(let M=0;M<x;M++)A.push(new Uint8Array(w(M,K))),D(M,K,A[M]);w=1<A.length;return new m.Texture(C,{...B,samplingMode:w?r.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:r.TextureSamplingMode.LINEAR,hasMipmap:w,internalFormat:J,width:u,height:y},{type:"compressed",
levels:A})}let p=null,z=null;a.createTextureBasis=function(C,B,A){return v.apply(this,arguments)};a.createTextureKTX2=function(C,B,A){return q.apply(this,arguments)};a.estimateMemoryBasis=function(C,B){if(b.isNone(p))return C.byteLength;C=new p.BasisFile(new Uint8Array(C));B=h(C)?g(C.getNumLevels(0),C.getHasAlpha(),C.getImageWidth(0,0),C.getImageHeight(0,0),B):0;C.close();C.delete();return B};a.estimateMemoryKTX2=function(C,B){if(b.isNone(p))return C.byteLength;C=new p.KTX2File(new Uint8Array(C));
B=l(C)?g(C.getLevels(),C.getHasAlpha(),C.getWidth(),C.getHeight(),B):0;C.close();C.delete();return B};a.loadBasis=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets","../../core/maybe"],function(a,c,b,t){let n;c.getBasisTranscoder=function(){if(t.isNone(n)){const r=m=>b.getAssetUrl(`esri/libs/basisu/${m}`);n=(new Promise((m,d)=>a(["../../chunks/basis_transcoder"],m,d))).then(m=>m.basis_transcoder).then(({default:m})=>
m({locateFile:r}).then(d=>{d.initializeBasis();delete d.then;return d}))}return n};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var c=a.TextureFormat||(a.TextureFormat={});c[c.ETC1_RGB=0]="ETC1_RGB";c[c.ETC2_RGBA=1]="ETC2_RGBA";c[c.BC1_RGB=2]="BC1_RGB";c[c.BC3_RGBA=3]="BC3_RGBA";c[c.BC4_R=4]="BC4_R";c[c.BC5_RG=5]="BC5_RG";c[c.BC7_M6_RGB=6]="BC7_M6_RGB";c[c.BC7_M5_RGBA=7]="BC7_M5_RGBA";
c[c.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";c[c.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";c[c.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";c[c.ATC_RGB=11]="ATC_RGB";c[c.ATC_RGBA=12]="ATC_RGBA";c[c.FXT1_RGB=17]="FXT1_RGB";c[c.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";c[c.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";c[c.ETC2_EAC_R11=20]="ETC2_EAC_R11";c[c.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";c[c.RGBA32=13]="RGBA32";c[c.RGB565=14]="RGB565";c[c.BGR565=15]="BGR565";c[c.RGBA4444=16]="RGBA4444";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define("exports ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../webgl/enums ../../../webgl/Texture".split(" "),function(a,c,b,t,n,r){function m(l){return l.charCodeAt(0)+(l.charCodeAt(1)<<8)+(l.charCodeAt(2)<<16)+(l.charCodeAt(3)<<24)}function d(l,v){var q=new Int32Array(l,0,31);if(542327876!==q[0])return f.error("Invalid magic number in DDS header"),null;if(!(q[20]&4))return f.error("Unsupported format, must contain a FourCC code"),
null;var k=q[21];let p;switch(k){case e:k=8;p=n.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;break;case g:k=16;p=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case h:k=16;p=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return f.error("Unsupported FourCC code:",String.fromCharCode(k&255,k>>8&255,k>>16&255,k>>24&255)),null}let z=1,C=q[4],B=q[3];if(0!==(C&3)||0!==(B&3))f.warn("Rounding up compressed texture size to nearest multiple of 4."),C=C+3&-4,B=B+
3&-4;const A=C,x=B;q[2]&131072&&!1!==v&&(z=Math.max(1,q[7]));1===z||b.isPowerOfTwo(C)&&b.isPowerOfTwo(B)||(f.warn("Ignoring mipmaps of non power of two sized compressed texture."),z=1);let u=q[1]+4;const y=[];for(let w=0;w<z;++w)q=(C+3>>2)*(B+3>>2)*k,v=new Uint8Array(l,u,q),y.push(v),u+=q,C=Math.max(1,C>>1),B=Math.max(1,B>>1);return{textureData:{type:"compressed",levels:y},internalFormat:p,width:A,height:x}}const f=c.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),e=m("DXT1"),g=m("DXT3"),h=m("DXT5");
a.createDDSTexture=function(l,v,q){const {textureData:k,internalFormat:p,width:z,height:C}=t.unwrapOrThrow(d(q,v.hasMipmap??!1));v.samplingMode=1<k.levels.length?n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:n.TextureSamplingMode.LINEAR;v.hasMipmap=1<k.levels.length;v.internalFormat=p;v.width=z;v.height=C;return new r.Texture(l,v,k)};a.createDDSTextureData=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(x,u,y){if(u.hasSlicePlane){x.extensions.add("GL_OES_standard_derivatives");u.hasSliceInVertexProgram&&x.vertex.uniforms.add(y);x.fragment.uniforms.add(y);y=e.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`;var w=e.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;w=u.hasSliceHighlight?e.glsl`
        ${w}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:e.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;u.hasSliceInVertexProgram&&x.vertex.code.add(y);x.fragment.code.add(y);x.fragment.code.add(w)}else y=e.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,u.hasSliceInVertexProgram&&x.vertex.code.add(y),x.fragment.code.add(y)}function h(x,u,y){return x.instancedDoublePrecision?r.set(z,y.camera.viewInverseTransposeMatrix[3],y.camera.viewInverseTransposeMatrix[7],y.camera.viewInverseTransposeMatrix[11]):u.slicePlaneLocalOrigin}function l(x,u){return b.isSome(x)?r.subtract(C,u.origin,x):u.origin}function v(x,u,y){return x.hasSliceTranslatedView?b.isSome(u)?t.translate(A,y.camera.viewMatrix,u):y.camera.viewMatrix:
null}function q(x,u,y){if(b.isNone(y.slicePlane))return m.ZEROS;const w=h(x,u,y);u=l(w,y.slicePlane);x=v(x,w,y);return b.isSome(x)?r.transformMat4(C,u,x):u}function k(x,u,y,w){if(b.isNone(w)||b.isNone(y.slicePlane))return m.ZEROS;const D=h(x,u,y);u=l(D,y.slicePlane);x=v(x,D,y);return b.isSome(x)?(r.add(B,w,u),r.transformMat4(C,u,x),r.transformMat4(B,B,x),r.subtract(B,B,C)):w}let p=function(x){function u(y){var w=x.call(this)||this;w.slicePlaneLocalOrigin=y;return w}c._inheritsLoose(u,x);return u}(e.NoParameters);
const z=m.create(),C=m.create(),B=m.create(),A=n.create();a.SliceDraw=function(x,u){g(x,u,[new d.Float3DrawUniform("slicePlaneOrigin",(y,w)=>q(u,y,w)),new d.Float3DrawUniform("slicePlaneBasis1",(y,w)=>k(u,y,w,b.unwrap(w.slicePlane)?.basis1)),new d.Float3DrawUniform("slicePlaneBasis2",(y,w)=>k(u,y,w,b.unwrap(w.slicePlane)?.basis2))])};a.SlicePass=function(x,u){g(x,u,[new f.Float3PassUniform("slicePlaneOrigin",(y,w)=>q(u,y,w)),new f.Float3PassUniform("slicePlaneBasis1",(y,w)=>k(u,y,w,b.unwrap(w.slicePlane)?.basis1)),
new f.Float3PassUniform("slicePlaneBasis2",(y,w)=>k(u,y,w,b.unwrap(w.slicePlane)?.basis2))])};a.SlicePlaneParameters=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl":function(){define(["exports","../ShaderOutput","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,c,b,t){a.ObjectAndLayerIdColor=function(n,r){const m=r.output===c.ShaderOutput.ObjectAndLayerIdColor;r=r.objectAndLayerIdColorInstanced;
m&&(n.varyings.add("objectAndLayerIdColorVarying","vec4"),r?n.attributes.add(t.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED,"vec4"):n.attributes.add(t.VertexAttribute.OBJECTANDLAYERIDCOLOR,"vec4"));n.vertex.code.add(b.glsl`
     void forwardObjectAndLayerIdColor() {
      ${m?r?b.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor_instanced * 0.003921568627451;`:b.glsl`objectAndLayerIdColorVarying = objectAndLayerIdColor * 0.003921568627451;`:b.glsl``} }`);n.fragment.code.add(b.glsl`
      void outputObjectAndLayerIdColor() {
        ${m?b.glsl`gl_FragColor = objectAndLayerIdColorVarying;`:b.glsl``} }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define("exports ../output/ReadLinearDepth.glsl ../shading/MultipassGeometryTest.glsl ../util/RgbaFloatEncoding.glsl ../util/WebGL2Utils ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType".split(" "),
function(a,c,b,t,n,r,m,d,f){a.HUDOcclusionPass=function(e,g){const {vertex:h,fragment:l}=e;g.hasMultipassGeometry&&h.include(b.multipassGeometryTest);g.hasMultipassTerrain&&e.varyings.add("depth","float");h.code.add(m.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${g.hasMultipassGeometry?m.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${g.hasMultipassTerrain?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);g.hasMultipassTerrain&&l.include(c.ReadLinearDepth);g.hasMultipassTerrain&&l.uniforms.add([...d.createTexture2DPassSizeUniforms("terrainDepthTexture",(v,q)=>q.multipassTerrain.linearDepthTexture,g.hasWebGL2Context?f.TextureSizeUniformType.None:f.TextureSizeUniformType.InvSize),new r.Float2PassUniform("nearFar",(v,q)=>q.camera.nearFar)]);l.include(t.RgbaFloatEncoding);l.code.add(m.glsl`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${g.hasMultipassTerrain?m.glsl`
          vec2 uv = gl_FragCoord.xy;

          // Read the rgba data from the texture linear depth
          vec4 terrainDepthData = ${n.texelFetch(g,"terrainDepthTexture","uv")};

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          // If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          // Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define("exports ../../../../../../chunks/vec4f64 ../util/WebGL2Utils ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType".split(" "),function(a,c,b,t,n,r){const m=c.fromValues(1,1,0,1),d=c.fromValues(1,0,1,1);a.OutputHighlight=function(f,e){f.fragment.uniforms.add(n.createTexture2DPassSizeUniforms("depthTex",
(g,h)=>h.highlightDepthTexture,e.hasWebGL2Context?r.TextureSizeUniformType.None:r.TextureSizeUniformType.InvSize));f.fragment.constants.add("occludedHighlightFlag","vec4",m).add("unoccludedHighlightFlag","vec4",d);f.fragment.code.add(t.glsl`
    void outputHighlight() {
      vec3 fragCoord = gl_FragCoord.xyz;

      float sceneDepth = ${b.texelFetch(e,"depthTex","fragCoord.xy")}.x;
      if (fragCoord.z > sceneDepth + 5e-7) {
        gl_FragColor = occludedHighlightFlag;
      }
      else {
        gl_FragColor = unoccludedHighlightFlag;
      }
    }
  `)};a.occludedHighlightFlag=m;a.unoccludedHighlightFlag=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,c,b,t,n,r,m,d){a.VisualVariables=function(f,e){e.hasVvInstancing&&(e.vvSize||e.vvColor)&&f.attributes.add(m.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");f=f.vertex;e.vvSize?(f.uniforms.add(new c.Float3PassUniform("vvSizeMinSize",g=>g.vvSizeMinSize)),f.uniforms.add(new c.Float3PassUniform("vvSizeMaxSize",g=>g.vvSizeMaxSize)),f.uniforms.add(new c.Float3PassUniform("vvSizeOffset",g=>g.vvSizeOffset)),f.uniforms.add(new c.Float3PassUniform("vvSizeFactor",g=>g.vvSizeFactor)),f.uniforms.add(new r.Matrix3PassUniform("vvSymbolRotationMatrix",
g=>g.vvSymbolRotationMatrix)),f.uniforms.add(new c.Float3PassUniform("vvSymbolAnchor",g=>g.vvSymbolAnchor)),f.code.add(n.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),f.code.add(n.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${e.hasVvInstancing?n.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):f.code.add(n.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);e.vvColor?(f.constants.add("vvColorNumber","int",d.vvColorNumber),e.hasVvInstancing&&f.uniforms.add([new t.FloatsPassUniform("vvColorValues",g=>g.vvColorValues,d.vvColorNumber),new b.Float4sPassUniform("vvColorColors",g=>g.vvColorColors,d.vvColorNumber)]),f.code.add(n.glsl`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${e.hasVvInstancing?n.glsl`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):f.code.add(n.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d,f){return n.call(this,m,"vec4",t.BindType.Pass,(e,g,h)=>e.setUniform4fv(m,d(g,h)),f)||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Float4sPassUniform=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d,f){return n.call(this,m,"float",t.BindType.Pass,(e,g,h)=>e.setUniform1fv(m,d(g,h)),f)||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.FloatsPassUniform=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f64","../../../../chunks/vec3f64","../lib/Material"],function(a,c,b,t,n){n=function(r){function m(){var d=r.apply(this,arguments)||this;d.vvSizeEnabled=!1;d.vvSizeMinSize=t.fromValues(1,1,1);d.vvSizeMaxSize=t.fromValues(100,100,100);d.vvSizeOffset=t.fromValues(0,0,0);d.vvSizeFactor=t.fromValues(1,1,1);d.vvSizeValue=
t.fromValues(1,1,1);d.vvColorEnabled=!1;d.vvColorValues=[0,0,0,0,0,0,0,0];d.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];d.vvOpacityEnabled=!1;d.vvOpacityValues=[0,0,0,0,0,0,0,0];d.vvOpacityOpacities=[1,1,1,1,1,1,1,1];d.vvSymbolAnchor=[0,0,0];d.vvSymbolRotationMatrix=b.create();return d}c._inheritsLoose(m,r);return m}(n.MaterialParameters);a.VisualVariablePassParameters=n;a.vvColorNumber=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff":function(){define(["exports"],
function(a){a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ../../../../chunks/HUDMaterial.glsl ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){m=function(z){function C(){return z.apply(this,arguments)||this}b._inheritsLoose(C,z);var B=C.prototype;B.initializeConfiguration=function(A,x){x.hasWebGL2Context=A.rctx.type===l.ContextType.WEBGL2;x.spherical=A.viewingMode===t.ViewingMode.Global};B.initializeProgram=function(A){return new e.Program(A.rctx,C.shader.get().build(this.configuration),d.Default3D)};B._setPipelineState=function(A){const x=this.configuration,u=A===g.TransparencyPassType.NONE;var y=
A===g.TransparencyPassType.FrontFace;const w=this.configuration.hasPolygonOffset?k:null;y=(u||y)&&x.output!==n.ShaderOutput.Highlight?x.depthEnabled||x.occlusionPass?q.defaultDepthWriteParams:null:null;return q.makePipelineState({blending:x.output===n.ShaderOutput.Color||x.output===n.ShaderOutput.Alpha||x.output===n.ShaderOutput.Highlight?u?p:f.oitBlending(A):null,depthTest:{func:v.CompareFunction.LEQUAL},depthWrite:y,colorWrite:q.defaultColorWriteParams,polygonOffset:w})};B.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};
b._createClass(C,[{key:"primitiveType",get:function(){return this.configuration.occlusionPass?v.PrimitiveType.POINTS:v.PrimitiveType.TRIANGLES}}]);return C}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(h.HUDMaterial,()=>new Promise((z,C)=>a(["./HUDMaterial.glsl"],z,C)));const k={factor:0,units:-4},p=q.simpleBlendingParams(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA);c.HUDMaterialTechnique=m;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports",
"./TransparencyPassType","../../../webgl/enums","../../../webgl/renderState"],function(a,c,b,t){const n=t.separateBlendingParams(b.BlendFactor.SRC_ALPHA,b.BlendFactor.ONE,b.BlendFactor.ONE_MINUS_SRC_ALPHA,b.BlendFactor.ONE_MINUS_SRC_ALPHA),r=t.simpleBlendingParams(b.BlendFactor.ONE,b.BlendFactor.ONE),m=t.simpleBlendingParams(b.BlendFactor.ZERO,b.BlendFactor.ONE_MINUS_SRC_ALPHA),d={factor:-1,units:-2};a.OITPolygonOffset=d;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=m;a.blendingColor=r;a.blendingDefault=
n;a.getOITPolygonOffset=function(f){return f?d:null};a.oitBlending=function(f){return f===c.TransparencyPassType.FrontFace?null:f===c.TransparencyPassType.Alpha?m:r};a.oitDepthTest=function(f,e=b.CompareFunction.LESS){return f===c.TransparencyPassType.NONE||f===c.TransparencyPassType.FrontFace?e:b.CompareFunction.LEQUAL};a.oitDepthWrite=function(f){return f===c.TransparencyPassType.FrontFace?t.defaultDepthWriteParams:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d){d=function(f){function e(){var g=f.apply(this,arguments)||this;g.output=t.ShaderOutput.Color;g.screenCenterOffsetUnitsEnabled=n.HUDSpace.World;g.transparencyPassType=m.TransparencyPassType.NONE;g.spherical=!1;g.occlusionTestEnabled=!0;g.signedDistanceFieldEnabled=!1;g.vvSize=!1;g.vvColor=!1;g.hasVerticalOffset=!1;g.hasScreenSizePerspective=!1;g.debugDrawLabelBorder=!1;g.binaryHighlightOcclusionEnabled=!0;g.hasSlicePlane=!1;g.hasPolygonOffset=!1;g.depthEnabled=!0;g.pixelSnappingEnabled=
!0;g.isDraped=!1;g.hasMultipassGeometry=!1;g.hasMultipassTerrain=!1;g.cullAboveGround=!1;g.occlusionPass=!1;g.objectAndLayerIdColorInstanced=!1;return g}c._inheritsLoose(e,f);return e}(d.DefaultTechniqueConfiguration);b.__decorate([r.parameter({count:t.ShaderOutput.COUNT})],d.prototype,"output",void 0);b.__decorate([r.parameter({count:n.HUDSpace.COUNT})],d.prototype,"screenCenterOffsetUnitsEnabled",void 0);b.__decorate([r.parameter({count:m.TransparencyPassType.COUNT})],d.prototype,"transparencyPassType",
void 0);b.__decorate([r.parameter()],d.prototype,"spherical",void 0);b.__decorate([r.parameter()],d.prototype,"occlusionTestEnabled",void 0);b.__decorate([r.parameter()],d.prototype,"signedDistanceFieldEnabled",void 0);b.__decorate([r.parameter()],d.prototype,"vvSize",void 0);b.__decorate([r.parameter()],d.prototype,"vvColor",void 0);b.__decorate([r.parameter()],d.prototype,"hasVerticalOffset",void 0);b.__decorate([r.parameter()],d.prototype,"hasScreenSizePerspective",void 0);b.__decorate([r.parameter()],
d.prototype,"debugDrawLabelBorder",void 0);b.__decorate([r.parameter()],d.prototype,"binaryHighlightOcclusionEnabled",void 0);b.__decorate([r.parameter()],d.prototype,"hasSlicePlane",void 0);b.__decorate([r.parameter()],d.prototype,"hasPolygonOffset",void 0);b.__decorate([r.parameter()],d.prototype,"depthEnabled",void 0);b.__decorate([r.parameter()],d.prototype,"pixelSnappingEnabled",void 0);b.__decorate([r.parameter()],d.prototype,"isDraped",void 0);b.__decorate([r.parameter()],d.prototype,"hasMultipassGeometry",
void 0);b.__decorate([r.parameter()],d.prototype,"hasMultipassTerrain",void 0);b.__decorate([r.parameter()],d.prototype,"cullAboveGround",void 0);b.__decorate([r.parameter()],d.prototype,"occlusionPass",void 0);b.__decorate([r.parameter()],d.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([r.parameter({constValue:!0})],d.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([r.parameter({constValue:!1})],d.prototype,"hasVvInstancing",void 0);a.HUDMaterialTechniqueConfiguration=
d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/RenderState ../../../support/Scheduler".split(" "),function(a,c,b,
t,n,r,m,d,f,e,g){a.LabelDeconflictor=function(h){function l(q){q=h.call(this,q)||this;q.visibilityGroup=f.VisibilityGroup.LABEL;q.iconMarginFactor=0;q._lastDeconfliction=0;return q}c._inheritsLoose(l,h);var v=l.prototype;v.runTask=function(q){if(this.parent.running)return g.Task.YIELD;const k=performance.now();if(q.state!==e.RenderState.IDLE&&2E3>k-this._lastDeconfliction)return g.Task.YIELD;h.prototype.runTask.call(this,q);this.state===d.State.Idle&&(this._lastDeconfliction=k)};v.enabledChanged=
function(q,k){this.modifyGraphics(k,q.labelsEnabled)};v.getGraphicsLayers=function(q){return q.labelLayers};c._createClass(l,[{key:"viewState",get:function(){return this.parent.viewState}}]);return l}(d.Deconflictor);b.__decorate([t.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=b.__decorate([m.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../symbols/callouts/calloutUtils ./CreateLabelParameters ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./graphicSymbolUtils ./labelPlacement ./placementUtils ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M){function N(L){return!0===L.labelsVisible&&!!L.labelingInfo?.some(O=>!!O.symbol)}let P=function(L,O){this.labelingContext=L;this.graphics3DGraphic=O;this.textInitialized=this.rendered=this.visible=this.hasGraphics3DResources=!1;this.textRenderers=[];this.textLabelPlacements=[]},I=function(L,O,S,R,Q){this.labelClass=L;this.graphics3DSymbol=O;this.graphics3DCalloutSymbolLayer=S;this.textRenderParameters=R;this.labelFunction=Q;this.calloutSymbolLayerIndex=
0},G=function(L,O,S,R,Q,V,aa){this.layer=L;this.graphics3DCore=O;this.scaleVisibility=S;this.emptySymbolLabelSupported=R;this.elevationInfoOverride=Q;this.disablePlacement=V;this.active=aa;this.labelClassAbortController=new AbortController;this.labelClassContexts=[];this.graphics=new Map;this.labelsToInitialize=new Map;this.stageLayer=new J.WebGLLayer({pickable:!0,disableOctree:!0},L.uid)};a.Labeler=function(L){function O(R){R=L.call(this,R)||this;R._dirty=!1;R._labels=new Map;R._labelsToAdd=new Map;
R._labelsToRemove=new Map;R._labelingContexts=[];return R}c._inheritsLoose(O,L);var S=O.prototype;S.setup=function(){this.dispose();this._handles=new r;this._handles.add([g.watch(()=>this.view.state?.camera,()=>this.setDirty()),g.watch(()=>this.view.state?.rasterPixelRatio,()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(M.TaskPriority.LABELER,this)]);this._textTextureAtlas=new K.TextTextureAtlas({view:this.view});this._hudMaterialCollection=new D.MaterialCollection(this.view._stage);
this._calloutMaterialCollection=new D.MaterialCollection(this.view._stage)};S.dispose=function(){this._handles=f.destroyMaybe(this._handles);this._textTextureAtlas=f.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=f.disposeMaybe(this._hudMaterialCollection);this._calloutMaterialCollection=f.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear();this._labelsToAdd.clear();this._labelsToRemove.clear()};S._activateLabelingContext=function(R){R.graphics.forEach((Q,
V)=>{const aa=new P(R,Q);this._labels.set(V,aa);R.labelsToInitialize.set(V,aa);Q.setVisibilityFlag(B.VisibilityFlag.USER_SETTING,!0,B.VisibilityGroup.LABEL)});R.active=!0};S._deactivateLabelingContext=function(R){R.graphics.forEach((Q,V)=>{Q.setVisibilityFlag(B.VisibilityFlag.USER_SETTING,!1,B.VisibilityGroup.LABEL);this.setLabelGraphicVisibility(Q,!1);this._labels.delete(V)});R.active=!1};S._addLabelTextureToAtlas=function(R){for(const Q of R.graphics3DGraphic.labelLayers){if(!Q._labelClass)continue;
const V=R.textRenderers[Q._labelIndex];f.isSome(V)&&this._textTextureAtlas.addTextTexture(V,Q.stageObject)}R.rendered=!0};S._removeLabelTextureFromAtlas=function(R){for(const Q of R.graphics3DGraphic.labelLayers){if(!Q._labelClass)continue;const V=R.textRenderers[Q._labelIndex];f.isSome(V)&&this._textTextureAtlas.removeTextTexture(V,Q.stageObject)}R.rendered=!1};S.runTask=function(R){this._updateLabels(R);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(R);return M.Task.YIELD};S._updateLabels=
function(R){if(this._dirty){this._dirty=!1;for(const Q of this._labelingContexts)if(Q.active){if(!Q.labelClassContexts||!Q.labelClassContexts.length){if(null===Q.labelClassContexts){this._deactivateLabelingContext(Q);continue}this._createLabelClassContext(Q);if(Q.labelClassPromise&&Q.labelClassAbortController){this._dirty=!0;continue}if(!Q.labelClassContexts||!Q.labelClassContexts.length)continue}d.someMap(Q.labelsToInitialize,(V,aa)=>{this._ensureGraphics3DResources(V)&&(this._labels.set(aa,V),this.deconflictor.setDirty(),
R.madeProgress());if(V.visible&&V.textInitialized||!V.visible&&V.hasGraphics3DResources)Q.labelsToInitialize.delete(aa),R.madeProgress();return R.done})&&(this._dirty=!0)}this._labelsToRemove.forEach(Q=>this._removeLabelTextureFromAtlas(Q));this._labelsToAdd.forEach(Q=>this._addLabelTextureToAtlas(Q));this._labelsToRemove.clear();this._labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};S._createLabelClassContextAsync=function(){var R=c._asyncToGenerator(function*(Q){var V=this;const aa=
Q.labelClassAbortController?.signal;yield Q.layer.when?.();e.throwIfAborted(aa);Q.scaleVisibility&&Q.scaleVisibility.updateScaleRangeActive();const X=Q.graphics3DCore;var W=X.layer;(W=W.labelingInfo&&W.labelingInfo.filter(T=>!!T.symbol))&&0!==W.length&&(yield n.forEach(W,function(){var T=c._asyncToGenerator(function*(U,Y){var ba=U.symbol;const da=u.getGraphics3DSymbol(X.getOrCreateGraphics3DSymbol(ba));if(f.isNone(da))m.getLogger(V.declaredClass).error("Failed to create Graphics3DSymbol for label");
else{yield da.load();e.throwIfAborted(aa);var ea=null;z.hasCalloutSupport(ba)&&ba.hasVisibleCallout()&&(ea=A.make(ba,X.symbolCreationContext),yield ea.load(),e.throwIfAborted(aa));ba=yield n.result(p.createLabelFunction(U,Q.layer.fieldsIndex,V.view.spatialReference));e.throwIfAborted(aa);if(!0===ba.ok){const ca=yield V._createTextRenderParameters(da.symbol);e.throwIfAborted(aa);Q.labelClassContexts[Y]=new I(U,da,ea,ca,ba.value)}else m.getLogger(V.declaredClass).error(`Label expression failed to evaluate: ${ba.error}`)}});
return function(U,Y){return T.apply(this,arguments)}}()),e.throwIfAborted(aa))});return function(Q){return R.apply(this,arguments)}}();S._createLabelClassContext=function(){var R=c._asyncToGenerator(function*(Q){f.isNone(Q.labelClassPromise)&&(Q.labelClassPromise=this._createLabelClassContextAsync(Q).catch(V=>{if(e.isAbortError(V))throw V;Q.labelClassContexts.length=0}).then(()=>{Q.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return Q.labelClassPromise});
return function(Q){return R.apply(this,arguments)}}();S._createTextRenderParameters=function(){var R=c._asyncToGenerator(function*(Q){return(Q=Q.symbolLayers.getItemAt(0))&&"text"===Q.type?E.TextRenderParameters.fromSymbol(Q,this.view.state.rasterPixelRatio):null});return function(Q){return R.apply(this,arguments)}}();S._destroyLabelClassContext=function(R){for(var Q of R.labelClassContexts)--Q.graphics3DSymbol.referenced;Q=R.labelClassAbortController;R.labelClassAbortController=new AbortController;
f.abortMaybe(Q);R.labelClassContexts.length=0;R.labelClassPromise=null;this.notifyChange("updating")};S._createTextSymbolGraphic=function(R,Q,V,aa,X){R=new C.CreateLabelParameters(V.verticalOffset,w.horizontalPlacementFromAnchor(V.anchor),w.verticalPlacementFromAnchor(V.anchor),R.text,V.translation,V.elevationOffset,V.centerOffset,V.screenOffset,V.centerOffsetUnits,R.displayWidth,R.displayHeight);H.graphic=Q;H.renderingInfo=null;H.layer=aa;return X.createLabel(H,R,this._hudMaterialCollection,this._textTextureAtlas)};
S._createLineCalloutGraphic=function(R,Q,V,aa,X){H.graphic=R;H.layer=X;H.renderingInfo=new x.LineCalloutSymbolLayerRenderingInfo(null,Q,aa.translation,aa.centerOffset,aa.screenOffset,aa.centerOffsetUnits,aa.elevationOffset,this._calloutMaterialCollection);return V.createGraphics3DGraphic(H)};S._ensureGraphics3DResources=function(R){if(R.hasGraphics3DResources)return!1;const Q=R.graphics3DGraphic;if(Q.destroyed)return!1;this._ensureTextTextureResources(R);const V=R.labelingContext,aa=V.labelClassContexts;
if(!aa||0===aa.length||!V.emptySymbolLabelSupported&&0===Q.layers.length)return!1;var X=!1,W=Q.graphic;const T=V.layer;var U=N(V.layer);const Y=this.view._stage;for(let da=0;da<aa.length;da++){const ea=R.textRenderers[da],ca=R.textLabelPlacements[da];if(f.isNone(ea)||f.isNone(ca))continue;const ja=aa[da];var ba=ja.graphics3DSymbol;const ia=ba.symbol&&"label-3d"===ba.symbol.type?ba.symbol:null;if(ba=ba.symbolLayers[0]){ba.setElevationInfoOverride(V.elevationInfoOverride);X=this._createTextSymbolGraphic(ea,
W,ca,T,ba);if(f.isNone(X))return!1;X._labelClass=ja.labelClass;X._labelIndex=da;Q.addLabelGraphic(X,Y,V.stageLayer);Q.setVisibilityFlag(B.VisibilityFlag.USER_SETTING,U,B.VisibilityGroup.LABEL);Q.clearVisibilityFlag(B.VisibilityFlag.SCALE_RANGE,B.VisibilityGroup.LABEL);Q.setVisibilityFlag(B.VisibilityFlag.DECONFLICTION,!1,B.VisibilityGroup.LABEL);X=!0;(U=ja.graphics3DCalloutSymbolLayer)&&ca.hasLabelVerticalOffset&&(U.setElevationInfoOverride(V.elevationInfoOverride),W=this._createLineCalloutGraphic(W,
ia,U,ca,T),f.isSome(W)&&(ja.calloutSymbolLayerIndex=Q.labelLayers.length,Q.addLabelGraphic(W,Y,V.stageLayer)));break}}V.scaleVisibility&&X&&V.scaleVisibility.updateGraphicLabelScaleVisibility(Q);return R.hasGraphics3DResources=!0};S._destroyGraphics3DResources=function(R){const Q=R.labelingContext.labelClassContexts;for(const V of R.graphics3DGraphic.labelLayers){if(null==V._labelClass)continue;const aa=Q[V._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=aa)aa.onRemoveGraphic(V)}R.graphics3DGraphic.clearLabelGraphics();
R.hasGraphics3DResources=!1};S._ensureTextTextureResources=function(R){if(!R.textInitialized){var Q=R.labelingContext,V=Q.labelClassContexts;if(V&&0!==V.length){var aa=R.graphics3DGraphic.graphic;for(let T=0;T<V.length;T++){const U=V[T];R.textRenderers[T]=null;R.textLabelPlacements[T]=null;if(!U.textRenderParameters)continue;var X=U.labelFunction;let Y;if("arcade"===X.type)try{const ba=X.needsHydrationToEvaluate()?k.hydrateGraphic(aa,Q.layer):aa;Y=X.evaluate(ba)}catch(ba){Y=null}else Y=X.evaluate(aa);
if(!f.isNone(Y)&&""!==Y&&!/^\s+$/.test(Y)&&(X=U.graphics3DSymbol,X.symbolLayers[0]&&(X=y.get({graphics3DGraphic:R.graphics3DGraphic,labelSymbol:"label-3d"===X.symbol?.type?X.symbol:null,labelClass:U.labelClass,disablePlacement:Q.disablePlacement}),!f.isNone(X)))){var W=w.horizontalPlacementFromAnchor(X.anchor);W=w.textRenderAlignmentFromHorizontalPlacement(W);R.textRenderers[T]=new F.TextRenderer(Y,W,U.textRenderParameters);R.textLabelPlacements[T]=X}}R.textInitialized=!0}}};S._destroyTextTextureResources=
function(R){R.textInitialized=!1;R.textRenderers.length=0;R.textLabelPlacements.length=0};S._addGraphic=function(R,Q){const V=Q.graphic.uid;R.graphics.set(V,Q);R.active&&(Q=new P(R,Q),this._labels.set(V,Q),R.labelsToInitialize.set(V,Q));this.setDirty();this.deconflictor.setDirty()};S._removeGraphic=function(R,Q){Q=Q.graphic.uid;const V=this._labels.get(Q);R.graphics.delete(Q);V&&(this._destroyGraphic(V,Q),R.labelsToInitialize.delete(Q),this.setDirty(),this.deconflictor.setDirty())};S._destroyGraphic=
function(R,Q){this._labels.has(Q)&&(this._labels.delete(Q),this._labelsToAdd.delete(Q),this._labelsToRemove.delete(Q));R.textInitialized&&(this._removeLabelTextureFromAtlas(R),this._destroyTextTextureResources(R));R.hasGraphics3DResources&&this._destroyGraphics3DResources(R)};S._labelingInfoChange=function(){var R=c._asyncToGenerator(function*(Q,V){if(V)for(const aa of V){if(V=Q.graphics.get(aa))this._removeGraphic(Q,V),this._addGraphic(Q,V)}else return this._visibilityInfoChange(Q),this._resetLabels(Q),
this._createLabelClassContext(Q)});return function(Q,V){return R.apply(this,arguments)}}();S._globalPropertyChanged=function(R,Q){for(const V of Q.labelClassContexts){const aa=new Map;Q.graphics.forEach(X=>aa.set(X.graphic.uid,X));f.unwrap(V.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(R,aa,X=>X.labelLayers[0]);V.graphics3DCalloutSymbolLayer&&V.graphics3DCalloutSymbolLayer.globalPropertyChanged(R,aa,X=>X.labelLayers[V.calloutSymbolLayerIndex])}};S._visibilityInfoChange=function(R){const Q=
N(R.layer);Q&&!R.active&&this._activateLabelingContext(R);!Q&&R.active&&this._deactivateLabelingContext(R);this.setDirty()};S._resetAllLabels=function(){for(const R of this._labelingContexts)this._resetLabels(R)};S._resetLabels=function(R){R.graphics.forEach((Q,V)=>{if(Q=this._labels.get(V))this._destroyGraphic(Q,V),Q.visible=!1,Q.rendered=!1,R.labelsToInitialize.set(V,Q)});this._destroyLabelClassContext(R);this.setDirty();this.deconflictor.setDirty()};S._findLabelingContext=function(R){for(const Q of this._labelingContexts)if(Q.graphics3DCore===
R)return Q;return null};S.addGraphicsOwner=function(R,Q,V){const aa=V&&V.emptySymbolLabelSupported||!1,X=V&&V.elevationInfoOverride||null;V=V&&V.disablePlacement||null;if(!this._findLabelingContext(R)){var W=R.layer,T=new G(W,R,Q,aa,X,V,N(W));this.view._stage.add(T.stageLayer);this._labelingContexts.push(T);this.setDirty();return{addGraphic:U=>this._addGraphic(T,U),removeGraphic:U=>this._removeGraphic(T,U),featureReductionChange:()=>{},layerLabelsEnabled:()=>N(T.layer),labelingInfoChange:U=>this._labelingInfoChange(T,
U),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",T),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",T),visibilityInfoChange:()=>this._visibilityInfoChange(T),reset:()=>this._resetLabels(T),clear:()=>{}}}};S.removeGraphicsOwner=function(R){const Q=this._findLabelingContext(R);Q&&(R=this._labelingContexts.indexOf(Q),this._labelingContexts.splice(R,1),Q.graphics.forEach(V=>this._removeGraphic(Q,V)),this.view._stage.remove(Q.stageLayer),this.setDirty())};
S.setLabelGraphicVisibility=function(R,Q){R=R.graphic.uid;const V=this._labels.get(R);V&&V.visible!==Q&&(Q&&!V.rendered?(this._labelsToAdd.set(R,V),this._labelsToRemove.delete(R),V.textInitialized||V.labelingContext.labelsToInitialize.set(R,V)):!Q&&V.rendered&&(this._labelsToRemove.set(R,V),this._labelsToAdd.delete(R)),V.visible=Q,this.setDirty())};S.setDirty=function(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))};c._createClass(O,[{key:"running",
get:function(){return this.view.ready&&(this._dirty||this.deconflictor.running)}},{key:"updating",get:function(){return this._dirty||this._textTextureAtlas?.updating||this.deconflictor.updating||this._labelingContexts.some(R=>!!R.labelClassPromise&&!!R.labelClassAbortController)}},{key:"updatingProgress",get:function(){if(!this.updating||!this._textTextureAtlas)return 1;const R=0<this._labelingContexts.length?this._labelingContexts.reduce((Q,V)=>Q+(V.labelClassPromise&&V.labelClassAbortController?
0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*R+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>this._resetAllLabels()}}}]);return O}(t);b.__decorate([h.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);b.__decorate([h.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);b.__decorate([h.property()],a.Labeler.prototype,
"_textTextureAtlas",void 0);b.__decorate([h.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=b.__decorate([q.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const H=new x.LineCalloutCreationContext(null,null,null);a.areLabelsVisible=N;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../geometry ../../Graphic ../../core/has ../../core/lang ../../core/maybe ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures ../../geometry/SpatialReference".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(B){return"declaredClass"in B}function h(B){return"declaredClass"in B}function l(B){return"declaredClass"in B}function v(B){return r.isNone(B)?null:g(B)?B:d.fromJSON(q(B))}function q(B){const {wkid:A,wkt:x,latestWkid:u}=B.spatialReference,y={wkid:A,wkt:x,latestWkid:u};switch(B.type){case "point":const {x:w,y:D,z:F,m:E}=B;return{x:w,y:D,z:F,m:E,spatialReference:y};case "polygon":const {rings:K,hasZ:J,hasM:M}=B;return{rings:k(K),hasZ:J,hasM:M,spatialReference:y};
case "polyline":const {paths:N,hasZ:P,hasM:I}=B;return{paths:k(N),hasZ:P,hasM:I,spatialReference:y};case "extent":const {xmin:G,xmax:H,ymin:L,ymax:O,zmin:S,zmax:R,mmin:Q,mmax:V,hasZ:aa,hasM:X}=B;return{xmin:G,xmax:H,ymin:L,ymax:O,zmin:S,zmax:R,mmin:Q,mmax:V,hasZ:aa,hasM:X,spatialReference:y};case "multipoint":const {points:W,hasZ:T,hasM:U}=B;return{points:C(W)?p(W):W,hasZ:T,hasM:U,spatialReference:y}}}function k(B){return z(B)?B.map(A=>p(A)):B}function p(B){return B.map(A=>Array.from(A))}function z(B){for(const A of B)if(0!==
A.length)return C(A);return!1}function C(B){return 0<B.length&&(m.isFloat32Array(B[0])||m.isFloat64Array(B[0]))}a.clonePoint=function(B,A){if(!B)return null;if(h(B)){if(null==A)return B.clone();if(h(A))return A.copy(B)}null!=A?(A.x=B.x,A.y=B.y,A.spatialReference=B.spatialReference,B.hasZ?(A.z=B.z,A.hasZ=B.hasZ):(A.z=void 0,A.hasZ=!1),B.hasM?(A.m=B.m,A.hasM=!0):(A.m=void 0,A.hasM=!1)):(A=f.makeDehydratedPoint(B.x,B.y,B.z,B.spatialReference),B.hasM&&(A.m=B.m,A.hasM=!0));return A};a.hydrateGeometry=
v;a.hydrateGraphic=function(B,A){return B?l(B)?B:new b({layer:A,sourceLayer:A,visible:B.visible,symbol:n.clone(B.symbol),attributes:n.clone(B.attributes),geometry:v(B.geometry)}):null};a.hydratedSpatialReference=function(B){const {wkid:A,wkt:x,latestWkid:u}=B;return e.fromJSON({wkid:A,wkt:x,latestWkid:u})};a.isHydratedGeometry=g;a.isHydratedGraphic=l;a.isHydratedPoint=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/maybe ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){function v(k,p,z){if(t.isNone(k))return null;switch(p){case "point":return{x:k.x,y:k.y,z:k.z,m:k.m,hasZ:null!=k.z,hasM:null!=k.m,type:"point",spatialReference:z};case "polyline":return{paths:k.paths,hasZ:!!k.hasZ,hasM:!!k.hasM,type:"polyline",spatialReference:z};case "polygon":return{rings:k.rings,hasZ:!!k.hasZ,hasM:!!k.hasM,type:"polygon",spatialReference:z};case "multipoint":return{points:k.points,hasZ:!!k.hasZ,hasM:!!k.hasM,type:"multipoint",spatialReference:z}}}
function q(k){if(t.isNone(k))return 0;let p=32;switch(k.type){case "point":p+=42;break;case "polyline":case "polygon":var z=0;const C=2+(k.hasZ?1:0)+(k.hasM?1:0);k="polyline"===k.type?k.paths:k.rings;for(const B of k)z+=B.length;p+=8*z*C+64;p+=128*z;p=p+34+32*(k.length+1);break;case "multipoint":z=k.points.length;p+=8*z*(2+(k.hasZ?1:0)+(k.hasM?1:0))+64;p+=128*z;p=p+34+32;break;case "extent":p+=98;k.hasM&&(p+=32);k.hasZ&&(p+=32);break;case "mesh":p+=n.estimateSize(k.vertexAttributes.position),p+=n.estimateSize(k.vertexAttributes.normal),
p+=n.estimateSize(k.vertexAttributes.uv),p+=n.estimateSize(k.vertexAttributes.tangent)}return p}a.equals=l.equals;a.DehydratedFeatureClass=function(k,p,z){this.uid=k;this.geometry=p;this.attributes=z;this.visible=!0;this.centroid=this.objectId=null};a.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=
this.geometryType=null};a.computeAABB=function(k,p){d.empty(p);"mesh"===k.type&&(k=k.extent);switch(k.type){case "point":p[0]=p[3]=k.x;p[1]=p[4]=k.y;k.hasZ&&(p[2]=p[5]=k.z);break;case "polyline":for(var z=0;z<k.paths.length;z++)d.expandWithNestedArray(p,k.paths[z],!!k.hasZ);break;case "polygon":for(z=0;z<k.rings.length;z++)d.expandWithNestedArray(p,k.rings[z],!!k.hasZ);break;case "multipoint":d.expandWithNestedArray(p,k.points,!!k.hasZ);break;case "extent":p[0]=k.xmin,p[1]=k.ymin,p[3]=k.xmax,p[4]=
k.ymax,null!=k.zmin&&(p[2]=k.zmin),null!=k.zmax&&(p[5]=k.zmax)}};a.computeAABR=function(k,p){f.empty(p);"mesh"===k.type&&(k=k.extent);switch(k.type){case "point":p[0]=p[2]=k.x;p[1]=p[3]=k.y;break;case "polyline":for(var z=0;z<k.paths.length;z++)f.expandWithNestedArray(p,k.paths[z]);break;case "polygon":for(z=0;z<k.rings.length;z++)f.expandWithNestedArray(p,k.rings[z]);break;case "multipoint":f.expandWithNestedArray(p,k.points);break;case "extent":p[0]=k.xmin,p[1]=k.ymin,p[2]=k.xmax,p[3]=k.ymax}};
a.estimateGeometryObjectSize=q;a.estimateSize=function(k){let p;p=32+c.estimateAttributesObjectSize(k.attributes);return p=p+3+(8+q(k.geometry))};a.fromFeatureSetJSON=function(k){const p=g.featureGeometryTypeKebabDictionary.fromJSON(k.geometryType),z=m.fromJSON(k.spatialReference),C=k.transform,B=k.features.map(A=>{var x=k.objectIdFieldName;A={uid:r.generateUID(),objectId:x&&A.attributes?A.attributes[x]:null,attributes:A.attributes,geometry:v(A.geometry,p,z),visible:!0};x=A.geometry;if(t.isSome(x)&&
C)switch(x.type){case "point":A.geometry=e.unquantizePoint(C,x,x,x.hasZ,x.hasM);break;case "multipoint":A.geometry=e.unquantizeMultipoint(C,x,x,!!x.hasZ,!!x.hasM);break;case "polygon":A.geometry=e.unquantizePolygon(C,x,x,!!x.hasZ,!!x.hasM);break;case "polyline":A.geometry=e.unquantizePolyline(C,x,x,!!x.hasZ,!!x.hasM);break;case "extent":A.geometry=x;break;case "mesh":A.geometry=x}return A});return{geometryType:p,features:B,spatialReference:z,fields:k.fields?.map(A=>h.fromJSON(A))??[],objectIdFieldName:k.objectIdFieldName,
globalIdFieldName:k.globalIdFieldName,geohashFieldName:k.geohashFieldName,geometryProperties:k.geometryProperties,hasZ:k.hasZ,hasM:k.hasM,exceededTransferLimit:k.exceededTransferLimit,transform:null}};a.fromJSONGeometry=v;a.getObjectId=function(k,p){return null!=k.objectId?k.objectId:k.attributes&&p?k.attributes[p]:null};a.hasGeometry=function(k){return t.isSome(k.geometry)};a.hasVertices=function(k){if(t.isNone(k))return!1;switch(k.type){case "extent":case "point":return!0;case "polyline":for(const p of k.paths)if(0<
p.length)return!0;return!1;case "polygon":for(const p of k.rings)if(0<p.length)return!0;return!1;case "multipoint":return 0<k.points.length;case "mesh":return!k.loaded||0<k.vertexAttributes.position.length}};a.makeDehydratedPoint=function(k,p,z,C){return{x:k,y:p,z,hasZ:null!=z,hasM:!1,spatialReference:C,type:"point"}};a.numVertices=function(k){if(t.isNone(k))return 0;switch(k.type){case "point":return 1;case "polyline":var p=0;for(var z of k.paths)p+=z.length;return p;case "polygon":z=0;for(p of k.rings)z+=
p.length;return z;case "multipoint":return k.points.length;case "extent":return 2;case "mesh":return(k=k.vertexAttributes&&k.vertexAttributes.position)?k.length/3:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/quantizationUtils":function(){define(["exports","../../core/maybe","./jsonUtils"],function(a,c,b){function t({scale:F,translate:E},K){return Math.round((K-E[0])/F[0])}function n({scale:F,translate:E},K){return Math.round((E[1]-K)/F[1])}function r(F,
E,K){const J=[];let M,N,P,I;for(let G=0;G<K.length;G++){const H=K[G];if(0<G){if(P=t(F,H[0]),I=n(F,H[1]),P!==M||I!==N)J.push(E(H,P-M,I-N)),M=P,N=I}else M=t(F,H[0]),N=n(F,H[1]),J.push(E(H,M,N))}return 0<J.length?J:null}function m(F,E,K,J){return r(F,K?J?D:w:J?w:y,E)}function d(F,E,K,J){const M=[];K=K?J?D:w:J?w:y;for(J=0;J<E.length;J++){const N=r(F,K,E[J]);N&&3<=N.length&&M.push(N)}return M.length?M:null}function f(F,E,K,J){const M=[];K=K?J?D:w:J?w:y;for(J=0;J<E.length;J++){const N=r(F,K,E[J]);N&&2<=
N.length&&M.push(N)}return M.length?M:null}function e({scale:F,translate:E},K){return K*F[0]+E[0]}function g({scale:F,translate:E},K){return E[1]-K*F[1]}function h(F,E,K){const J=Array(K.length);if(!K.length)return J;const [M,N]=F.scale;let P=e(F,K[0][0]);F=g(F,K[0][1]);J[0]=E(K[0],P,F);for(let I=1;I<K.length;I++){const G=K[I];P+=G[0]*M;F-=G[1]*N;J[I]=E(G,P,F)}return J}function l(F,E,K){const J=Array(K.length);for(let M=0;M<K.length;M++)J[M]=h(F,E,K[M]);return J}function v(F,E,K,J){return h(F,K?J?
D:w:J?w:y,E)}function q(F,E,K,J){return l(F,K?J?D:w:J?w:y,E)}function k(F,E,K,J){return l(F,K?J?D:w:J?w:y,E)}function p(F,E,K){let [J,M]=K[0],N=Math.min(J,E[0]),P=Math.min(M,E[1]),I=Math.max(J,E[2]);E=Math.max(M,E[3]);for(let G=1;G<K.length;G++){const [H,L]=K[G];J+=H;M+=L;0>H&&(N=Math.min(N,J));0<H&&(I=Math.max(I,J));0>L?P=Math.min(P,M):0<L&&(E=Math.max(E,M))}F[0]=N;F[1]=P;F[2]=I;F[3]=E;return F}function z(F,E){if(!E.length)return null;F[0]=F[1]=Number.POSITIVE_INFINITY;F[2]=F[3]=Number.NEGATIVE_INFINITY;
for(let K=0;K<E.length;K++)p(F,F,E[K]);return F}function C(F,E,K,J,M){E.xmin=t(F,K.xmin);E.ymin=n(F,K.ymin);E.xmax=t(F,K.xmax);E.ymax=n(F,K.ymax);E!==K&&(J&&(E.zmin=K.zmin,E.zmax=K.zmax),M&&(E.mmin=K.mmin,E.mmax=K.mmax));return E}function B(F,E,K,J,M){E.points=m(F,K.points,J,M)??[];return E}function A(F,E,K,J,M){E.x=t(F,K.x);E.y=n(F,K.y);E!==K&&(J&&(E.z=K.z),M&&(E.m=K.m));return E}function x(F,E,K,J,M){F=d(F,K.rings,J,M);if(!F)return null;E.rings=F;return E}function u(F,E,K,J,M){F=f(F,K.paths,J,M);
if(!F)return null;E.paths=F;return E}const y=(F,E,K)=>[E,K],w=(F,E,K)=>[E,K,F[2]],D=(F,E,K)=>[E,K,F[2],F[3]];a.equals=function(F,E){if(F===E||null==F&&null==E)return!0;if(null==F||null==E)return!1;let K,J,M,N;F&&"upperLeft"===F.originPosition?(K=F.translate[0],J=F.translate[1],F=F.scale[0]):(K=c.isSome(F.extent)?F.extent.xmin:0,J=c.isSome(F.extent)?F.extent.ymax:0,F=F.tolerance);E&&"upperLeft"===E.originPosition?(M=E.translate[0],N=E.translate[1],E=E.scale[0]):(M=c.isSome(E.extent)?E.extent.xmin:
0,N=c.isSome(E.extent)?E.extent.ymax:0,E=E.tolerance);return K===M&&J===N&&F===E};a.getQuantizedBoundsCoordsArray=p;a.getQuantizedBoundsCoordsArrayArray=z;a.getQuantizedBoundsPaths=function(F){return z([0,0,0,0],F)};a.getQuantizedBoundsPoints=function(F){const E=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return p(E,E,F)};a.getQuantizedBoundsRings=function(F){return z([0,0,0,0],F)};a.quantizeBounds=function(F,E,K){E[0]=t(F,K[0]);E[3]=n(F,K[1]);
E[2]=t(F,K[2]);E[1]=n(F,K[3]);return E};a.quantizeExtent=C;a.quantizeGeometry=function(F,E){return F&&E?b.isPoint(E)?A(F,{},E,!1,!1):b.isPolyline(E)?u(F,{},E,!1,!1):b.isPolygon(E)?x(F,{},E,!1,!1):b.isMultipoint(E)?B(F,{},E,!1,!1):b.isExtent(E)?C(F,{},E,!1,!1):null:null};a.quantizeMultipoint=B;a.quantizePaths=f;a.quantizePoint=A;a.quantizePoints=m;a.quantizePolygon=x;a.quantizePolyline=u;a.quantizeRings=d;a.quantizeX=t;a.quantizeY=n;a.toQuantizationTransform=function(F){return F?{originPosition:"upper-left"===
F.originPosition?"upperLeft":"lower-left"===F.originPosition?"lowerLeft":F.originPosition,scale:F.tolerance?[F.tolerance,F.tolerance]:[1,1],translate:c.isSome(F.extent)?[F.extent.xmin,F.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(F,E,K){return K?(E[0]=e(F,K[0]),E[1]=g(F,K[3]),E[2]=e(F,K[2]),E[3]=g(F,K[1]),E):[e(F,E[0]),g(F,E[3]),e(F,E[2]),g(F,E[1])]};a.unquantizeCoordsArray=h;a.unquantizeCoordsArrayArray=l;a.unquantizeExtent=function(F,E,K,J,M){E.xmin=e(F,K.xmin);E.ymin=g(F,K.ymin);E.xmax=
e(F,K.xmax);E.ymax=g(F,K.ymax);E!==K&&(J&&(E.zmin=K.zmin,E.zmax=K.zmax),M&&(E.mmin=K.mmin,E.mmax=K.mmax));return E};a.unquantizeMultipoint=function(F,E,K,J,M){c.isSome(K)&&(E.points=v(F,K.points,J,M));return E};a.unquantizePaths=q;a.unquantizePoint=function(F,E,K,J,M){if(c.isNone(K))return E;E.x=e(F,K.x);E.y=g(F,K.y);E!==K&&(J&&(E.z=K.z),M&&(E.m=K.m));return E};a.unquantizePoints=v;a.unquantizePolygon=function(F,E,K,J,M){c.isSome(K)&&(E.rings=k(F,K.rings,J,M));return E};a.unquantizePolyline=function(F,
E,K,J,M){c.isSome(K)&&(E.paths=q(F,K.paths,J,M));return E};a.unquantizeRings=k;a.unquantizeX=e;a.unquantizeY=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has","../../core/maybe","../../geometry/support/spatialReferenceUtils"],function(a,c,b,t){function n(e,g){if(e===g)return!0;if(null==e||null==g||e.length!==g.length)return!1;for(let h=0;h<e.length;h++){const l=e[h],v=g[h];if(l.length!==
v.length)return!1;for(let q=0;q<l.length;q++)if(l[q]!==v[q])return!1}return!0}function r(e,g){if(e===g)return!0;if(null==e||null==g||e.length!==g.length)return!1;for(let h=0;h<e.length;h++)if(!n(e[h],g[h]))return!1;return!0}function m(e,g){return e===g||b.isSome(e)&&b.isSome(g)&&t.equals(e.spatialReference,g.spatialReference)&&e.x===g.x&&e.y===g.y&&e.z===g.z&&e.m===g.m}function d(e,g){if(e===g)return!0;if(b.isNone(e)||b.isNone(g)||e.type!==g.type)return!1;switch(e.type){case "point":return m(e,g);
case "extent":return e=e.hasZ!==g.hasZ||e.hasM!==g.hasM?!1:t.equals(e.spatialReference,g.spatialReference)?e.xmin===g.xmin&&e.ymin===g.ymin&&e.zmin===g.zmin&&e.xmax===g.xmax&&e.ymax===g.ymax&&e.zmax===g.zmax:!1,e;case "polyline":return e=e.hasZ!==g.hasZ||e.hasM!==g.hasM?!1:t.equals(e.spatialReference,g.spatialReference)?r(e.paths,g.paths):!1,e;case "polygon":return e=e.hasZ!==g.hasZ||e.hasM!==g.hasM?!1:t.equals(e.spatialReference,g.spatialReference)?r(e.rings,g.rings):!1,e;case "multipoint":return e=
e.hasZ!==g.hasZ||e.hasM!==g.hasM?!1:t.equals(e.spatialReference,g.spatialReference)?n(e.points,g.points):!1,e;case "mesh":return!1}}function f(e,g){if(e===g)return!0;if(!e||!g)return!1;const h=Object.keys(e),l=Object.keys(g);if(h.length!==l.length)return!1;for(const v of h)if(e[v]!==g[v])return!1;return!0}a.equals=function(e,g){return e===g?!0:null!=e&&null!=g&&e.objectId===g.objectId&&d(e.geometry,g.geometry)&&f(e.attributes,g.attributes)?!0:!1};a.pointEquals=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../core/maybe ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){function h(){h=b._asyncToGenerator(function*(p,z,C){if(!p||!p.symbol||!z)return q;const B=p.where,A=e.getLabelExpression(p);p=B?yield new Promise((x,u)=>a(["../../core/sql/WhereClause"],
x,u)):null;if("arcade"===A.type){const x=yield g.createLabelExpression(A.expression,C,z);if(r.isNone(x))return q;C={type:"arcade",evaluate(u){try{const y=x.evaluate({$feature:"attributes"in u?x.repurposeFeature(u):u});if(null!=y)return y.toString()}catch(y){v.error(new t("arcade-expression-error","Encountered an error when evaluating label expression for feature",{feature:u,expression:A}))}return null},needsHydrationToEvaluate(){return null==e.getSingleFieldArcadeExpression(A.expression)}}}else C=
{type:"simple",evaluate(x){return A.expression.replace(/{[^}]*}/g,u=>{var y=u.slice(1,-1);y=z.get(y);if(!y)return u;u=null;"attributes"in x?x&&x.attributes&&(u=x.attributes[y.name]):u=x.field(y.name);return null==u?"":l(u,y)})}};if(B){let x;try{x=p.WhereClause.create(B,z)}catch(y){return v.error(new t("bad-where-clause","Encountered an error when evaluating where clause, ignoring",{where:B,error:y})),q}const u=C.evaluate;C.evaluate=y=>{const w="attributes"in y?void 0:k;try{if(x.testFeature(y,w))return u(y)}catch(D){v.error(new t("bad-where-clause",
"Encountered an error when evaluating where clause for feature",{where:B,feature:y,error:D}))}return null}}return C});return h.apply(this,arguments)}function l(p,z){if(null==p)return"";const C=z.domain;if(C)if("codedValue"===C.type||"coded-value"===C.type)for(var B of C.codedValues){if(B.code===p)return B.name}else if("range"===C.type){B=+p;const A="range"in C?C.range[1]:C.maxValue;if(("range"in C?C.range[0]:C.minValue)<=B&&B<=A)return C.name}"date"===z.type||"esriFieldTypeDate"===z.type?p=m.formatDate(p,
m.convertDateFormatToIntlOptions("short-date")):f.isNumericField(z)&&(p=d.formatNumber(+p));return p?p:""}const v=n.getLogger("esri.layers.support.labelFormatUtils"),q={type:"simple",evaluate(){return null}},k={getAttribute(p,z){return p.field(z)}};c.createLabelFunction=function(p,z,C){return h.apply(this,arguments)};c.formatField=l;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/CreateLabelParameters":function(){define(["exports"],function(a){a.CreateLabelParameters=
function(c=null,b="center",t="center",n=null,r=[0,0,0],m=0,d=[0,0,0,1],f=[0,0],e="world",g=0,h=0){this.verticalOffset=c;this.horizontalPlacement=b;this.verticalPlacement=t;this.text=n;this.translation=r;this.elevationOffset=m;this.centerOffset=d;this.screenOffset=f;this.centerOffsetUnits=e;this.displayWidth=g;this.displayHeight=h};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger",
"../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,c,b,t){const n=c.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),r={line:t.Graphics3DLineCalloutSymbolLayer};a.make=function(m,d){if(!b.hasCalloutSupport(m))return n.error("Graphics3DCalloutSymbolLayerFactory#make",`symbol of type '${m.type}' does not support callouts`),null;if(!m.callout)return null;const f=r[m.callout.type];return f?new f(m,d):(n.error("Graphics3DCalloutSymbolLayerFactory#make",
`unknown or unsupported callout type ${m.callout.type}`),null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DGraphicCreationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y){k=function(K){function J(N,P){N=K.call(this,N,null,P,E)||this;N._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};N.ensureDrapedStatus(!1);return N}c._inheritsLoose(J,K);var M=J.prototype;M.doLoad=function(){var N=c._asyncToGenerator(function*(){this._material=new y.LineCalloutMaterial(this._materialParameters);this._context.stage.add(this._material)});return function(){return N.apply(this,arguments)}}();M.destroy=function(){K.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};M._perInstanceMaterialParameters=function(N){const P=this._materialParameters;P.screenOffset=N.screenOffset||r.ZEROS;P.centerOffsetUnits=N.centerOffsetUnits||"world";return P};M._defaultElevationInfoNoZ=function(){return F};M.createGraphics3DGraphic=function(N){const P=N.renderingInfo;N=N.graphic;const I=this.setGraphicElevationContext(N,new h.ElevationContext,P.elevationOffset||0);var G=P.symbol;const H="on-the-ground"===this._elevationContext.mode&&
("cim"===G.type||!G.symbolLayers.some(L=>"object"===L.type||"text"===L.type));if("label-3d"!==G.type&&H||"point-3d"===G.type&&G.symbolLayers.every(L=>"text"===L.type&&!f.textSymbolLayerSupportsVerticalOffset(L)))return null;G=p.computeCentroid(N.geometry);return t.isNone(G)?null:this._createAs3DShape(G,I,P,N.uid)};M.layerOpacityChanged=function(){t.isSome(this._material)&&this._material.setParameters(this._materialParameters)};M.layerElevationInfoChanged=function(N,P,I){I=g.elevationModeChangeUpdateType(J.elevationModeChangeTypes,
I,this._elevationContext.mode);if(I!==g.SymbolUpdateType.UPDATE)return I;N.forEach(G=>{const H=P(G);t.isSome(H)&&this.updateGraphicElevationContext(G.graphic,H)});return I};M.slicePlaneEnabledChanged=function(){if(t.isNone(this._material))return!0;this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};M.physicalBasedRenderingChanged=function(){return!0};M.pixelRatioChanged=function(){return!0};M.skipHighSymbolLodsChanged=function(){return!0};M.setGraphicElevationContext=
function(N,P,I=0){N=K.prototype.setGraphicElevationContext.call(this,N,P);N.addOffsetRenderUnits(I);return N};M.updateGraphicElevationContext=function(N,P){this.setGraphicElevationContext(N,P.elevationContext,t.isSome(P.metadata)?P.metadata.elevationOffset:0);P.needsElevationUpdates=g.needsElevationUpdates2D(P.elevationContext.mode)};M.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:C.emptySymbolComplexity.memory}};M._createVertexData=
function(N){const {translation:P,centerOffset:I}=N;N=P?new B.Attribute([P[0],P[1],P[2]],3,!0):new B.Attribute([0,0,0],3,!0);const G=I?new B.Attribute([I[0],I[1],I[2],I[3]],4,!0):new B.Attribute([0,0,0,1],4,!0);return[[u.VertexAttribute.POSITION,N],[u.VertexAttribute.NORMAL,new B.Attribute([0,0,1],3,!0)],[u.VertexAttribute.AUXPOS1,G]]};M._getOrCreateMaterial=function(N){const P=this._perInstanceMaterialParameters(N),I=y.LineCalloutMaterial.uniqueMaterialIdentifier(P);if(t.isSome(this._material)&&I===
this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(t.isSome(N.materialCollection)){let G=N.materialCollection.get(I);t.isNone(G)&&(G=new y.LineCalloutMaterial(P),N.materialCollection.add(I,G));return{material:G,isUnique:!1}}return{material:new y.LineCalloutMaterial(P),isUnique:!0}};M._createAs3DShape=function(N,P,I,G){var H=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:G,layerUid:this._context.layer.uid}),L=this._getOrCreateMaterial(I);H=new x.Geometry(L.material,
this._createVertexData(I),D,null,A.ContentObjectType.Point,H);G=z.createStageObject(this._context,N,H,P,G);if(t.isNone(G))return null;L=new v.Graphics3DObject3DGraphicLayer(this,G.object,[H],L.isUnique?[L.material]:null,null,e.perObjectElevationAligner,P);L.metadata=new q.Graphics3DObjectMetadata(I.elevationOffset);L.alignedSampledElevation=G.sampledElevation;L.needsElevationUpdates=g.needsElevationUpdates2D(P.mode);z.extendPointGraphicElevationContext(L,N,this._context.elevationProvider);return L};
c._createClass(J,[{key:"_materialParameters",get:function(){const N=new y.Parameters;var P=this.symbol,I=P.callout;N.color=t.isSome(I.color)?b.toUnitRGBA(I.color):[0,0,0,0];N.color[3]*=this._getLayerOpacity();N.size=n.pt2px(I.size||0);if(P.verticalOffset){const {screenLength:G,minWorldLength:H,maxWorldLength:L}=P.verticalOffset;N.verticalOffset={screenLength:n.pt2px(G),minWorldLength:H||0,maxWorldLength:t.isSome(L)?L:Infinity}}N.borderColor=t.isSome(I.border)&&t.isSome(I.border.color)?b.toUnitRGBA(I.border.color):
null;I="object"===P.symbolLayers.getItemAt(0).type;P="label-3d"===P.type;N.occlusionTest=!I;N.shaderPolygonOffset=I?0:void 0;N.depthHUDAlignStart=P;N.hasSlicePlane=this._context.slicePlaneEnabled;N.screenSizePerspective=this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null;return N}}]);return J}(k.Graphics3DSymbolLayer);k.elevationModeChangeTypes={definedChanged:g.SymbolUpdateType.UPDATE,staysOnTheGround:g.SymbolUpdateType.UPDATE,onTheGroundChanged:g.SymbolUpdateType.RECREATE};
const w=[0],D=[[u.VertexAttribute.POSITION,w],[u.VertexAttribute.NORMAL,w],[u.VertexAttribute.AUXPOS1,w]],F={mode:"relative-to-ground",offset:0},E={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};l=function(K){function J(){return K.apply(this,arguments)||this}c._inheritsLoose(J,K);return J}(l);a.Graphics3DLineCalloutSymbolLayer=k;a.LineCalloutCreationContext=l;a.LineCalloutSymbolLayerRenderingInfo=function(K,J,M=m.create(),N=d.create(),P=r.create(),I="world",G=0,H=null){this.renderer=K;this.symbol=
J;this.translation=M;this.centerOffset=N;this.screenOffset=P;this.centerOffsetUnits=I;this.elevationOffset=G;this.materialCollection=H};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){function v(x,u,y,w,D){let F=!1;var E=x.shaderTransformation;u=u.requiresSampledElevationInfo;p[0]=E[12];p[1]=E[13];p[2]=E[14];x.invalidateBoundingInfo();var K=x.getMutableAttribute(l.VertexAttribute.POSITION);E=K.data;K=K.size;const J=E.length/K;x=new g.SamplePosition(x.mapPositions,y);let M=0,N=0;for(let P=0;P<J;P++){z[0]=E[M];z[1]=E[M+1];z[2]=E[M+2];w(x,A);u&&(N+=A.sampledElevation);if(e.TESTS_DISABLE_OPTIMIZATIONS)E[M]=x.array[x.offset],E[M+1]=x.array[x.offset+
1],E[M+2]=A.z,m.projectBuffer(E,y,M,E,D.spatialReference,M,1),E[M]-=p[0],E[M+1]-=p[1],E[M+2]-=p[2],F=!0;else{k[0]=E[M]+p[0];k[1]=E[M+1]+p[1];k[2]=E[M+2]+p[2];D.setAltitude(k,A.z);E[M]=k[0]-p[0];E[M+1]=k[1]-p[1];E[M+2]=k[2]-p[2];const I=.01/D.unitInMeters;if(Math.abs(z[0]-E[M])>=I||Math.abs(z[1]-E[M+1])>=I||Math.abs(z[2]-E[M+2])>=I)F=!0}M+=K;x.offset+=3}return{update:F,averageGeometrySampledElevation:N/J}}const q=t.create(),k=r.create(),p=r.create(),z=r.create(),C=t.create(),B=r.create(),A=new d.SampleElevationInfo;
a.perLodInstanceElevationAligner=function(x,u,y,w,D){var F=x.graphics3DSymbolLayer.lodRenderer;if(c.isNone(F))return 0;y=u.centerPointInElevationSR;w(y,A);u="absolute-height"!==u.mode?A.sampledElevation:0;w=F.instanceData;x=x.instanceIndex;w.getGlobalTransform(x,C);F=n.set(B,C[12],C[13],C[14]);e.TESTS_DISABLE_OPTIMIZATIONS?(k[0]=y.x,k[1]=y.y,k[2]=A.z,m.computeTranslationToOriginAndRotation(y.spatialReference,k,C,D.spatialReference)&&w.setGlobalTransform(x,C)):D.setAltitudeOfTransformation(A.z,C);
D=.01/D.unitInMeters;(e.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(C[12]-F[0])>=D||Math.abs(C[13]-F[1])>=D||Math.abs(C[14]-F[2])>=D)&&w.setGlobalTransform(x,C);return u};a.perObjectElevationAligner=function(x,u,y,w,D){x=x.stageObject;const F=u.centerPointInElevationSR;y=0;x.metadata?.usesVerticalDistanceToGround?(w(F,A),f.updateVertexAttributeAuxpos1w(x,A.verticalDistanceToGround),y=A.sampledElevation):(w(F,A),"absolute-height"!==u.mode&&(y=A.sampledElevation));u=b.copy(q,x.transformation);w=n.set(B,u[12],
u[13],u[14]);e.TESTS_DISABLE_OPTIMIZATIONS?(k[0]=F.x,k[1]=F.y,k[2]=A.z,m.computeTranslationToOriginAndRotation(F.spatialReference,k,u,D.spatialReference)&&(x.transformation=u)):D.setAltitudeOfTransformation(A.z,u);D=.01/D.unitInMeters;if(Math.abs(u[12]-w[0])>=D||Math.abs(u[13]-w[1])>=D||Math.abs(u[14]-w[2])>=D)x.transformation=u;return y};a.perVertexElevationAligner=function(x,u,y,w,D){x=x.stageObject;const F=x.geometries;let E=0;for(const K of F){if(!h.isGeometryWithMapPositions(K))continue;const {update:J,
averageGeometrySampledElevation:M}=v(K,u,y,w,D);E+=M;J&&x.geometryVertexAttrsUpdated(K)}return E/F.length};a.sharedGeometryElevationAligner=function(x,u,y,w,D){x=x.stageObject;const F=x.geometries;if(0===F.length)return 0;let E=0,K=null,J=0,M=!1;for(const N of F){if(!h.isGeometryWithMapPositions(N))continue;const P=N.vertexAttributes.get(l.VertexAttribute.POSITION);if(P!==K){const {update:I,averageGeometrySampledElevation:G}=v(N,u,y,w,D);J=G;K=P;M=I}M&&x.geometryVertexAttrsUpdated(N);E+=J}return E/
F.length};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),function(a,c,b,t,n,r,m,d,f){function e(k,p,z,C,B){const A=(m.isDehydratedPoint(k)?k.z:f.isSamplePosition(k)?
k.array[k.offset+2]:k[2])||0;switch(z.mode){case "on-the-ground":z=c.unwrapOr(f.getElevationAtPoint(p,k,"ground"),0);B.verticalDistanceToGround=0;B.sampledElevation=z;B.z=z;break;case "relative-to-ground":k=c.unwrapOr(f.getElevationAtPoint(p,k,"ground"),0);z=z.geometryZWithOffset(A,C);B.verticalDistanceToGround=z;B.sampledElevation=k;B.z=z+k;break;case "relative-to-scene":k=c.unwrapOr(f.getElevationAtPoint(p,k,"scene"),0);z=z.geometryZWithOffset(A,C);B.verticalDistanceToGround=z;B.sampledElevation=
k;B.z=z+k;break;case "absolute-height":z=z.geometryZWithOffset(A,C);C=c.unwrapOr(f.getElevationAtPoint(p,k,"ground"),0);B.verticalDistanceToGround=z-C;B.sampledElevation=C;B.z=z;break;default:B.z=0}}let g=function(){this.z=this.sampledElevation=this.verticalDistanceToGround=0};a.SymbolUpdateType=void 0;(function(k){k[k.NONE=0]="NONE";k[k.UPDATE=1]="UPDATE";k[k.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||(a.SymbolUpdateType={}));const h={"absolute-height":{applyElevationAlignmentBuffer:function(k,
p,z,C,B,A,x,u){A=u.calculateOffsetRenderUnits(x);u=u.featureExpressionInfoContext;p*=3;C*=3;for(x=0;x<B;++x){const y=k[p+1],w=k[p+2];z[C+0]=k[p+0];z[C+1]=y;z[C+2]=null==u?w+A:A;p+=3;C+=3}return 0},requiresAlignment:function(k){const p=k.featureExpressionInfoContext;return 0!==k.meterUnitOffset||null!=p}},"on-the-ground":{applyElevationAlignmentBuffer:function(k,p,z,C,B,A){let x=0;const u=A.spatialReference;p*=3;C*=3;for(let y=0;y<B;++y){const w=k[p+0],D=k[p+1],F=c.unwrapOr(A.getElevation(w,D,k[p+
2],u,"ground"),0);x+=F;z[C+0]=w;z[C+1]=D;z[C+2]=F;p+=3;C+=3}return x/B},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(k,p,z,C,B,A,x,u){let y=0;x=u.calculateOffsetRenderUnits(x);u=u.featureExpressionInfoContext;const w=A.spatialReference;p*=3;C*=3;for(let D=0;D<B;++D){const F=k[p+0],E=k[p+1],K=k[p+2],J=c.unwrapOr(A.getElevation(F,E,K,w,"ground"),0);y+=J;z[C+0]=F;z[C+1]=E;z[C+2]=null==u?K+J+x:J+x;p+=3;C+=3}return y/B},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(k,
p,z,C,B,A,x,u){let y=0;x=u.calculateOffsetRenderUnits(x);u=u.featureExpressionInfoContext;const w=A.spatialReference;p*=3;C*=3;for(let D=0;D<B;++D){const F=k[p+0],E=k[p+1],K=k[p+2],J=c.unwrapOr(A.getElevation(F,E,K,w,"scene"),0);y+=J;z[C+0]=F;z[C+1]=E;z[C+2]=null==u?K+J+x:J+x;p+=3;C+=3}return y/B},requiresAlignment:()=>!0}},l=t.create(),v=new g,q=n.create();a.SampleElevationInfo=g;a.applyElevationAlignmentForHUD=function(k,p,z,C,B){e(p,z,B,C,v);d.updateVertexAttributeAuxpos1w(k,v.verticalDistanceToGround);
z=v.sampledElevation;B=b.copy(l,k.transformation);q[0]=p.x;q[1]=p.y;q[2]=v.z;r.computeTranslationToOriginAndRotation(p.spatialReference,q,B,C.spatialReference)?k.transformation=B:console.warn("Could not locate symbol object properly, it might be misplaced");return z};a.applyPerVertexElevationAlignment=function(k,p,z,C,B,A,x,u,y,w,D){const F=h[D.mode];let E=0;if(r.projectBuffer(k,p,z,C,y.spatialReference,B,u)&&(F.requiresAlignment(D)?(E=F.applyElevationAlignmentBuffer(C,B,A,x,u,y,w,D),k=A,B=x):k=C,
r.projectBuffer(k,y.spatialReference,B,A,w.spatialReference,x,u)))return E};a.elevationModeChangeUpdateType=function(k,p,z){return null==p||null==z?k.definedChanged:"on-the-ground"===p&&"on-the-ground"===z?k.staysOnTheGround:p===z||"on-the-ground"!==p&&"on-the-ground"!==z?a.SymbolUpdateType.UPDATE:k.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(k,p,z,C){e(k,p,z,C,v);return v.z};a.evaluateElevationInfoAtPoint=e;a.needsElevationUpdates2D=function(k){return"relative-to-ground"===k||
"relative-to-scene"===k};a.needsElevationUpdates3D=function(k){return"absolute-height"!==k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){function p(B){var A=B.paths[0];if(!A||0===A.length)return null;A=l.getPointOnPath(A,l.getPathLength(A)/2);return v.makeDehydratedPoint(A[0],A[1],A[2],B.spatialReference)}function z(B,A,x){x=x?B:q.clonePoint(B);return A&&B?f.projectPoint(B,x,A)?x:null:x}function C(B){if(Array.isArray(B)){for(const A of B)if(!C(A))return!1;return!0}return null==B||0<=B}a.computeCentroid=function(B,A){if("point"===B.type)return z(B,A,!1);if(q.isHydratedGeometry(B))switch(B.type){case "extent":return z(B.center,
A,!1);case "polygon":return z(B.centroid,A,!1);case "polyline":return z(p(B),A,!0);case "mesh":return z(B.origin,A,!1)}else switch(B.type){case "extent":return B=v.makeDehydratedPoint(.5*(B.xmax+B.xmin),.5*(B.ymax+B.ymin),null!=B.zmin&&null!=B.zmax&&isFinite(B.zmin)&&isFinite(B.zmax)?.5*(B.zmax+B.zmin):void 0,B.spatialReference),z(B,A,!0);case "polygon":var x=B.rings[0];x&&0!==x.length?(x=h.ringsCentroid(B.rings,!!B.hasZ),B=v.makeDehydratedPoint(x[0],x[1],x[2],B.spatialReference)):B=null;return z(B,
A,!0);case "polyline":return z(p(B),A,!0)}};a.computeObjectRotation=function(B,A,x,u=n.create()){B=B||0;A=A||0;x=x||0;0!==B&&t.rotateZ(u,u,-B/180*Math.PI);0!==A&&t.rotateX(u,u,A/180*Math.PI);0!==x&&t.rotateY(u,u,x/180*Math.PI);return u};a.computeObjectScale=function(B=r.ONES,A,x,u=1){const y=Array(3);if(c.isNone(A)||c.isNone(x))y[0]=1,y[1]=1,y[2]=1;else{let D=0;for(let F=2;0<=F;F--){const E=B[F];let K;const J=null!=E,M=0===F&&!w&&!J,N=x[F];"symbol-value"===E||M?K=0!==N?A[F]/N:1:J&&"proportional"!==
E&&isFinite(E)&&(K=0!==N?E/N:1);if(null!=K){var w=y[F]=K;D=Math.max(D,Math.abs(K))}}for(B=2;0<=B;B--)null==y[B]?y[B]=w:0===y[B]&&(y[B]=.001*D)}for(w=2;0<=w;w--)y[w]/=u;return r.fromArray(y)};a.demResolutionForBoundingBox=function(B,A,x){if(null!=x.minDemResolution)return x.minDemResolution;const u=b.getMetersPerUnitForSR(A),y=e.width(B)*u,w=e.depth(B)*u;B=e.height(B)*(A.isGeographic?1:u);return 0===y&&0===w&&0===B?x.minDemResolutionForPoints:.01*Math.max(y,w,B)};a.enlargeExtent=function(B,A,x,u=0){if(B){A||
(A=g.create());let y=.5*B.width*(x-1);x=.5*B.height*(x-1);B.width<1E-7*B.height?y+=x/20:B.height<1E-7*B.width&&(x+=y/20);m.set(A,B.xmin-y-u,B.ymin-x-u,B.xmax+y+u,B.ymax+x+u);return A}return null};a.isValidSize=C;a.mixinColorAndOpacity=function(B,A){const x=d.clone(d.ONES);c.isSome(B)&&(x[0]=B[0],x[1]=B[1],x[2]=B[2]);c.isSome(A)?x[3]=A:c.isSome(B)&&3<B.length&&(x[3]=B[3]);return x};a.overrideColor=function(B,A,x,u,y,w=[0,0,0,0]){for(let D=0;3>D;++D)c.isSome(B)&&null!=B[D]?w[D]=B[D]:c.isSome(x)&&null!=
x[D]?w[D]=x[D]:w[D]=y[D];c.isSome(A)?w[3]=A:c.isSome(u)?w[3]=u:w[3]=y[3];return w};a.updateVertexAttributeAuxpos1w=function(B,A){for(let x=0;x<B.geometries.length;++x){const u=B.geometries[x].getMutableAttribute(k.VertexAttribute.AUXPOS1);u&&u.data[3]!==A&&(u.data[3]=A,B.geometryVertexAttrsUpdated(B.geometries[x]))}};a.validateSymbolLayerSize=function(B){return C(null!=B.isPrimitive?[B.width,B.depth,B.height]:B)?null:"Symbol sizes may not be negative values"};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GeometryWithMapPositions":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./Geometry"],function(a,c,b,t){t=function(n){function r(){return n.apply(this,arguments)||this}c._inheritsLoose(r,n);return r}(t.Geometry);a.GeometryWithMapPositions=t;a.isGeometryWithMapPositions=function(n){return b.isSome(n.mapPositions)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,c,b,t,n){let r=function(){function m(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var d=m.prototype;d.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=
null;this.unit="meters"};d.addOffsetRenderUnits=function(f){this._renderUnitOffset+=f};d.geometryZWithOffset=function(f,e){e=this.calculateOffsetRenderUnits(e);return null!=this.featureExpressionInfoContext?e:f+e};d.calculateOffsetRenderUnits=function(f){let e=this._meterUnitOffset;const g=this.featureExpressionInfoContext;null!=g&&(e+=n.execute(g)*this._metersPerElevationInfoUnit);return e/f.unitInMeters+this._renderUnitOffset};d.setFromElevationInfo=function(f){this.mode=f.mode;this.unit=t.supportsUnit(f.unit)?
f.unit:"meters";this.offsetElevationInfoUnits=b.unwrapOr(f.offset,0)};d.updateFeatureExpressionInfoContext=function(f,e,g){if(b.isNone(f))this._featureExpressionInfoContext=null;else{var h=f&&f.arcade;h&&b.isSome(e)&&b.isSome(g)?(this._featureExpressionInfoContext=n.clone(f),n.setContextFeature(this._featureExpressionInfoContext,n.createFeature(h.modules,e,g))):this._featureExpressionInfoContext=f}};m.fromElevationInfo=function(f){const e=new m;b.isSome(f)&&e.setFromElevationInfo(f);return e};c._createClass(m,
[{key:"featureExpressionInfoContext",get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(f){this._unit=f;this._metersPerElevationInfoUnit=t.getMetersPerUnit(f)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"offsetMeters",set:function(f){this._meterUnitOffset=f;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",
set:function(f){this._meterUnitOffset=f*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}}]);return m}();a.ElevationContext=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/promiseUtils ../../../../layers/graphics/hydratedFeatures ../../../../support/arcadeOnDemand".split(" "),function(a,c,b,t,n,r){function m(){m=
c._asyncToGenerator(function*(f,e,g,h){f=f&&f.expression;if("string"!==typeof f)return null;var l="0"===f?0:null;if(null!=l)return{cachedResult:l};l=yield r.loadArcade();t.throwIfAborted(g);g=l.arcadeUtils;f=g.createSyntaxTree(f);return g.dependsOnView(f)?(null!=h&&h.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:g.createFunction(f),context:g.createExecContext(null,{sr:e}),modules:l}}});return m.apply(this,arguments)}const d=b.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");
a.clone=function(f){return{cachedResult:f.cachedResult,arcade:f.arcade?{func:f.arcade.func,context:f.arcade.modules.arcadeUtils.createExecContext(null,{sr:f.arcade.context.spatialReference}),modules:f.arcade.modules}:null}};a.createContext=function(f,e,g,h){return m.apply(this,arguments)};a.createContextWithoutExpressionSupport=function(f){f=f&&f.expression;return"string"===typeof f&&(f="0"===f?0:null,null!=f)?{cachedResult:f}:null};a.createFeature=function(f,e,g){return f.arcadeUtils.createFeature(e.attributes,
e.geometry,g)};a.execute=function(f){if(null!=f){if(null!=f.cachedResult)return f.cachedResult;var e=f.arcade;e=e?.modules.arcadeUtils.executeFunction(e.func,e.context);"number"!==typeof e&&(e=f.cachedResult=0);return e}return 0};a.extractExpressionInfo=function(f,e=!1){const g=(f=f&&f.featureExpressionInfo)&&f.expression;e||"0"===g||(f=null);return f??null};a.setContextFeature=function(f,e){null!=f&&null==f.cachedResult&&(e&&f.arcade?(e._geometry&&(e._geometry=n.hydrateGeometry(e._geometry)),f.arcade.modules.arcadeUtils.updateExecContext(f.arcade.context,
e)):d.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(function(){return function(a,c,b){this.graphic=a;this.renderingInfo=c;this.layer=b}})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(C){return C.isVisible()?C.parameters.transparent?h.Transparency.TRANSPARENT:h.Transparency.OPAQUE:h.Transparency.INVISIBLE}let v=function(){function C(A,x,u,y,w,D,F,E=null){this.graphics3DSymbolLayer=A;this.stageObject=x;this._uniqueGeometries=u;this._uniqueMaterials=y;this._sharedResource=w;this.elevationAligner=D;this.elevationContext=F;this._edgeState=E;this.type="object3d";this._stage=this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=
0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1}var B=C.prototype;B.initialize=function(A,x){this._stageLayer=x;this._stage=A;A.addMany(this._uniqueMaterials);A.addMany(this._uniqueGeometries);A.add(this.stageObject)};B.destroy=function(){var A=this._stage;this._stageLayer&&(A.removeMany(this._uniqueMaterials),A.removeMany(this._uniqueGeometries));A.remove(this.stageObject);this._addedToStage&&(this._stageLayer.remove(this.stageObject),this._addedToStage=!1);A=this._stage.renderer.ensureEdgeView();
A.hasObject(this.stageObject)&&A.removeObject(this.stageObject);this.stageObject.dispose();b.isSome(this._sharedResource)&&this._sharedResource.release();this._visible=!1;this._stage=this._stageLayer=null};B.layerOpacityChanged=function(A,x){if(!b.isNone(this._edgeState)){var u=l(this._edgeState.baseMaterial),y=!1;for(const w of this._edgeState.edgeMaterials)w.objectTransparency!==u&&(w.objectTransparency=u,y=!0);y&&this._resetEdgeObject(x);this._stage.renderer.ensureEdgeView().updateAllComponentOpacities(this.stageObject,
[A])}};B.slicePlaneEnabledChanged=function(A,x){b.isNone(this._edgeState)||(this._stage.renderer.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:A},!x),this._edgeState.properties.hasSlicePlane=A)};B.setVisibility=function(A){if(null!=this._stage&&this._visible!==A&&(this._visible=A,this.stageObject.visible=A,this._visible&&!this._addedToStage&&(this._stageLayer.add(this.stageObject),this._addedToStage=!0),b.isSome(this._edgeState))){const x=
this._stage.renderer.ensureEdgeView();x.hasObject(this.stageObject)?x.updateObjectVisibility(this.stageObject,A):A&&this._addOrUpdateEdgeObject(x,!1)}};B.alignWithElevation=function(A,x,u,y){null!=this.elevationAligner&&(b.isSome(u)&&f.setContextFeature(this.elevationContext.featureExpressionInfoContext,u),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,b.unwrap(A.spatialReference),(w,D)=>d.evaluateElevationInfoAtPoint(w,A,this.elevationContext,x,D),x),this._resetEdgeObject(y))};
B.alignWithAbsoluteElevation=function(A,x,u){this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,null,(y,w)=>{w.sampledElevation=A;w.verticalDistanceToGround=0;w.z=A},x);this._resetEdgeObject(u)};B.getCenterObjectSpace=function(A=n.create()){return t.copy(A,m.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};B.getBoundingBoxObjectSpace=function(A=r.create()){const x=this.stageObject.boundingVolumeObjectSpace;r.setMin(A,x.min);r.setMax(A,x.max);return A};B.computeAttachmentOrigin=
function(A){if(this.useObjectOriginAsAttachmentOrigin){var x=this.stageObject.transformation;A.render.origin[0]+=x[12];A.render.origin[1]+=x[13];A.render.origin[2]+=x[14];A.render.num++}else for(x of this.stageObject.geometries)x.computeAttachmentOrigin(p)&&(t.transformMat4(p,p,this.stageObject.transformation),t.add(A.render.origin,A.render.origin,p),A.render.num++)};B.getProjectedBoundingBox=function(){var A=c._asyncToGenerator(function*(x,u,y,w,D){D=this.getBoundingBoxObjectSpace(D);var F=z,E=r.isPoint(D)?
1:F.length;for(var K=0;K<E;K++){const J=F[K];k[0]=D[J[0]];k[1]=D[J[1]];k[2]=D[J[2]];t.transformMat4(k,k,this.stageObject.transformation);q[3*K]=k[0];q[3*K+1]=k[1];q[3*K+2]=k[2]}if(!x(q,0,E))return null;r.empty(D);x=null;this.calculateRelativeScreenBounds&&(x=this.calculateRelativeScreenBounds());for(F=0;F<3*E;F+=3){for(K=0;3>K;K++)D[K]=Math.min(D[K],q[F+K]),D[K+3]=Math.max(D[K+3],q[F+K]);x&&y.push({location:q.slice(F,F+3),screenSpaceBoundingRect:x})}if(u&&u.service&&"absolute-height"!==this.elevationContext.mode){r.center(D,
p);y="relative-to-scene"===this.elevationContext.mode?"scene":"ground";E=0;if(u.useViewElevation)E=b.unwrapOr(u.service.getElevation(p[0],p[1],y),0);else try{const J=e.demResolutionForBoundingBox(D,u.service.spatialReference,u);E=b.unwrapOr(yield u.service.queryElevation(p[0],p[1],w,J,y),0)}catch(J){}r.offset(D,0,0,-this.alignedSampledElevation+E)}return D});return function(x,u,y,w,D){return A.apply(this,arguments)}}();B.addObjectState=function(A,x){A===g.Object3DState.Highlight&&x.addObject(this.stageObject,
this.stageObject.highlight());A===g.Object3DState.MaskOccludee&&x.addObject(this.stageObject,this.stageObject.maskOccludee())};B.removeObjectState=function(A){A.removeObject(this.stageObject)};B._resetEdgeObject=function(A){if(!b.isNone(this._edgeState)){var x=this._stage.renderer.ensureEdgeView();this._visible?this._addOrUpdateEdgeObject(x,A):x.removeObject(this.stageObject)}};B._addOrUpdateEdgeObject=function(A,x){const u=this._edgeState;if(!b.isNone(u)){var y=l(u.baseMaterial);for(const w of u.edgeMaterials)w.objectTransparency=
y;A.addOrUpdateObject3D(this.stageObject,u.edgeMaterials,u.properties,!x).then(()=>this._stageLayer?.sync())}};c._createClass(C,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},{key:"visible",get:function(){return this._visible}}]);return C}();const q=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],k=n.create(),p=n.create(),z=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=
v;a.Object3DEdgeState=function(C,B,A){this.baseMaterial=C;this.edgeMaterials=B;this.properties=A};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var c=a.Transparency||(a.Transparency={});c[c.INVISIBLE=0]="INVISIBLE";c[c.TRANSPARENT=1]="TRANSPARENT";c[c.OPAQUE=2]="OPAQUE";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectMetadata":function(){define(["exports",
"../../../../core/maybe"],function(a,c){a.Graphics3DObjectMetadata=function(b,t=null){this.labelText=t;this.elevationOffset=c.unwrapOr(b,0)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){function k(x,u){x=null!=x?u.attributes[x]:0;return null!=x&&isFinite(x)?x:0}function p(x){const u={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};x&&"visualVariables"in x&&x.visualVariables&&x.visualVariables.forEach(y=>{switch(y.type){case "color":u.color=!0;if(y.stops)for(let w=0;w<y.stops.length;w++){const D=y.stops[w].color;D&&(u.opacity=!0,1>D.a&&(u.opacityAlwaysOpaque=!1))}break;case "opacity":u.opacity=!0;u.opacityAlwaysOpaque=!1;break;case "size":u.size=
!0}});return u}const z=n.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");t=function(x){function u(w,D,F,E){var K=x.call(this,F.schedule)||this;K.symbol=w;K.symbolLayer=D;K._context=F;K._elevationInfoOverride=null;K._ignoreDrivers=!1;K._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};K.complexity=null;K.logger=z;K._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};K._renderPriority=E.renderPriority;K._renderPriorityStep=E.renderPriorityStep;
K._elevationContext=new e.ElevationContext;K.complexity=K.computeComplexity();K._ignoreDrivers=E.ignoreDrivers;K._ignoreDrivers||(K._drivenProperties=p(K._context.renderer));K._updateElevationContext();return K}c._inheritsLoose(u,x);var y=u.prototype;y.getCachedSize=function(){return null};y._drivenPropertiesChanged=function(w){if(this._ignoreDrivers)return!1;const D=this._drivenProperties;w=p(w);return w.color!==D.color||w.opacity!==D.opacity||w.opacityAlwaysOpaque!==D.opacityAlwaysOpaque||w.size!==
D.size};y._logGeometryCreationWarnings=function(w,D,F,E){const K="polygons"in w?w.polygons:null,J=`${E} geometry failed to be created`;let M=null;w.projectionSuccess?!this._logGeometryValidationWarnings(D,F,E)&&K&&0===K.length&&"rings"===F&&0<D.length&&2<D[0].length&&(M=`${J} (filled rings should use clockwise winding - try reversing the order of vertices)`):M=`${J} (failed to project geometry to view spatial reference)`;M&&z.warnOncePerTick(M)};y._logGeometryValidationWarnings=function(w,D,F){F=
`${F} geometry failed to be created`;return!w.length||1===w.length&&!w[0].length?(z.warnOncePerTick(`${F} (no ${D} were defined)`),!0):Array.isArray(w)&&Array.isArray(w[0])?!1:(z.warnOncePerTick(`${F} (${D} should be defined as a 2D array)`),!0)};y._validateGeometry=function(w,D=null,F=null){return r.isSome(D)&&!D.includes(w.type)?(this.logger.warn("unsupported geometry type for "+F+` symbol: ${w.type}`),!1):"point"!==w.type||isFinite(w.x)&&isFinite(w.y)?!0:(z.warn("point coordinate is not a valid number, graphic skipped"),
!1)};y._defaultElevationInfoNoZ=function(){return C};y._defaultElevationInfoZ=function(){return B};y._updateElevationContext=function(){r.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):
this._elevationContext.reset()};y.getDefaultElevationInfo=function(w){return w.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};y.getGeometryElevationMode=function(w,D=this.getDefaultElevationInfo(w)){return this._elevationContext.mode||D.mode};y.setElevationInfoOverride=function(w){this._elevationInfoOverride=w;this._updateElevationContext()};y.setGraphicElevationContext=function(w,D){var F=r.unwrap(w.geometry);const E=this.getDefaultElevationInfo(F);D.unit=null!=this._elevationContext.unit?
this._elevationContext.unit:E.unit;D.mode=this.getGeometryElevationMode(F,E);D.offsetMeters=r.unwrapOr(this._elevationContext.meterUnitOffset,r.unwrapOr(E.offset,0));if(F=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===D.mode)D.mode="relative-to-ground",D.offsetMeters=0;D.updateFeatureExpressionInfoContext(F?g.zeroContext:this._elevationContext.featureExpressionInfoContext,w,this._context.layer);return D};y.prepareSymbolLayerPatch=function(w){};y.updateGeometry=function(w,D){return!1};
y.onRemoveGraphic=function(w){};y._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity??0;const w=this._context.layer.opacity;return null==w?1:w};y._getCombinedOpacity=function(w,D=A){let F=1;this.draped||(F*=this._getLayerOpacity());if(this._drivenProperties.opacity)return F;r.isSome(w)?F*=w.a:D.hasIntrinsicColor||(F=0);return F};y._getCombinedOpacityAndColor=function(w,D=A){D=this._getCombinedOpacity(w,
D);if(this._drivenProperties.color)return h.mixinColorAndOpacity(null,D);w=r.isSome(w)?b.toUnitRGB(w):m.ONES;return h.mixinColorAndOpacity(w,D)};y._getVertexOpacityAndColor=function(w,D=null){w=h.mixinColorAndOpacity(this._drivenProperties.color?w.color:null,this._drivenProperties.opacity?w.opacity:null);r.isSome(D)&&(w[0]*=D,w[1]*=D,w[2]*=D,w[3]*=D);return w};y.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};y.computeComplexity=function(){return q.defaultSymbolLayerComplexity(this.symbol,
this.symbolLayer)};y.globalPropertyChanged=function(w,D,F){switch(w){case "opacity":return this.layerOpacityChanged(D,F),!0;case "elevationInfo":return w=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(D,F,w)===f.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(D,F);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();case "skipHighSymbolLods":return this.skipHighSymbolLodsChanged();
default:return!1}};y.updateGraphics3DGraphicElevationInfo=function(w,D,F){let E=f.SymbolUpdateType.UPDATE;w.forEach(K=>{const J=D(K);r.isSome(J)?(this.setGraphicElevationContext(K.graphic,J.elevationContext),J.needsElevationUpdates=F(J.elevationContext.mode)):E=f.SymbolUpdateType.RECREATE});return E};y.applyRendererDiff=function(w,D){return l.ApplyRendererDiffResult.Recreate_Symbol};y.getFastUpdateAttrValues=function(w){if(!this._fastUpdates.enabled)return null;const D=this._fastUpdates.visualVariables,
F=D.size?k(D.size.field,w):0,E=D.color?k(D.color.field,w):0;w=D.opacity?k(D.opacity.field,w):0;return d.fromValues(F,E,w,0)};y.ensureDrapedStatus=function(w){if(null==this._draped)return this._draped=w,!0;w!==this.draped&&z.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");return!1};y.test=function(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>({size:this._fastUpdates?.visualVariables?.size?.field??
null,color:this._fastUpdates?.visualVariables?.color?.field??null,opacity:this._fastUpdates?.visualVariables?.opacity?.field??null,rotation:this._fastUpdates?.visualVariables?.rotation?.field??null})}};c._createClass(u,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"draped",get:function(){return this._draped}}]);return u}(v.Loadable);const C={mode:"on-the-ground",
offset:0,unit:"meters"},B={mode:"absolute-height",offset:0,unit:"meters"},A={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=t;a.getAttributeValue=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var c=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});c[c.Recreate_Symbol=0]="Recreate_Symbol";c[c.Recreate_Graphics=1]="Recreate_Graphics";c[c.Fast_Update=2]="Fast_Update";
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils"],function(a,c,b,t){let n=function(){function r(d){this.schedule=d;this._abortController=null;this._loadStatus=a.LoadStatus.LOADING;this.logger=this._loader=this._loadError=null}var m=r.prototype;m.destroy=function(){this.abortLoad()};m.load=function(d,f){if(this._loadStatus===
a.LoadStatus.LOADED)return d&&d(),b.unwrapOr(this._loader,Promise.resolve());if(this._loadStatus===a.LoadStatus.FAILED)return f&&f(this._loadError),b.unwrapOr(this._loader,Promise.resolve());b.isNone(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},e=>{this._loadError=e;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!t.isAbortError(e)&&this.logger&&
e.message&&this.logger.warn(e.message);throw e;}));this._loader.then(d,f).catch(()=>{});return this._loader};m.abortLoad=function(){b.isSome(this._abortController)?this._abortController=b.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null};c._createClass(r,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return r}();a.LoadStatus=void 0;(function(r){r[r.LOADING=0]="LOADING";r[r.LOADED=1]="LOADED";r[r.FAILED=
2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./Graphics3DPathSymbolLayerConstants ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodResources".split(" "),function(a,
c,b,t,n,r,m,d,f){function e(p){let z=0,C=0,B=0,A=!1,x=0;const u={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const y of p)b.isNone(y)||(z+=y.primitivesPerFeature,C+=y.primitivesPerCoordinate,B+=y.drawCallsPerFeature,u.bytesPerFeature+=y.memory.bytesPerFeature,u.bytesPerFeatureLabel+=y.memory.bytesPerFeatureLabel,u.bytesPerCoordinate+=y.memory.bytesPerCoordinate,u.resourceBytes+=y.memory.resourceBytes,
u.draped.bytesPerFeature+=y.memory.bytesPerFeature,u.draped.bytesPerFeatureLabel+=y.memory.bytesPerFeatureLabel,u.draped.bytesPerCoordinate+=y.memory.bytesPerCoordinate,A=A||y.estimated,++x);return{primitivesPerFeature:z,primitivesPerCoordinate:C,drawCallsPerFeature:B,estimated:A,memory:u,numComplexities:x}}function g(p,z){const C=h(p,z);var B=m.hasEdges(z)?2:0;switch(z.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:B,estimated:!1,memory:C};case "fill":return"mesh-3d"===
p.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:B,estimated:!1,memory:C}:b.isSome(z.outline)&&0<z.outline.size?{primitivesPerFeature:-4,primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:C}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:C};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:C};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,
drawCallsPerFeature:0,estimated:!1,memory:C};case "object":return z.resource&&z.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:C}:{...l(z.resource&&z.resource.primitive||t.defaultPrimitive),memory:C};case "path":var A=p=0;switch(z.profile){case "circle":p=n.PATH_NUM_CIRCLE_PROFILE_SUBDIVISIONS;break;case "quad":p=4;break;default:c.neverReached(z.profile);return}switch(z.join??"simple"){case "round":A=n.PATH_NUM_ROUND_JOIN_SUBDIVISIONS;break;
case "miter":case "bevel":A=1;break;default:return}B=2*p;A=p*A*2;let x=-2*A-B;switch(z.cap){case "none":break;case "butt":case "square":x+=2*(p-1);break;case "round":x+=2*(p*(n.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS-1)*2+p);break;default:return}return{primitivesPerFeature:x,primitivesPerCoordinate:A+B,drawCallsPerFeature:0,estimated:!1,memory:C};case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:C}}}function h(p,z){p="point-3d"===
p.type;switch(z.type){case "extrude":return z.edges&&0<z.edges.size?k.EXTRUDE_EDGES:k.EXTRUDE;case "fill":return b.isSome(z.outline)&&0<z.outline.size?k.FILL_OUTLINE:k.FILL;case "water":return k.FILL;case "line":return"round"===z.join?k.LINE_ROUND:k.LINE_MITER;case "path":switch(z.join){case "round":switch(z.profile){case "circle":return k.PATH_ROUND_CIRCLE;case "quad":return k.PATH_ROUND_QUAD;default:c.neverReached(z.profile);return}case "miter":case "bevel":switch(z.profile){case "circle":return k.PATH_MITER_CIRCLE;
case "quad":return k.PATH_MITER_QUAD;default:c.neverReached(z.profile);return}case "simple":return;default:return}case "object":return p?k.OBJECT_POINT:k.OBJECT_POLYGON;case "icon":case "text":return p?k.ICON_POINT:k.ICON_POLYGON}}function l(p){var z=q[p];if(z)return z;z=r.primitiveLodResources(p,null);z={primitivesPerFeature:f.geometriesFromLodLevelResources(z.levels[0]).reduce((C,B)=>C+B.indices.get(d.VertexAttribute.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};
return q[p]=z}const v={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,resourceBytes:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},q={},k={ICON_POINT:{bytesPerFeature:3293.7707557538765,bytesPerFeatureLabel:1020.2764,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:2213.51585392203,bytesPerFeatureLabel:1008.84664,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:4745.397589234022,
bytesPerFeatureLabel:1006.5440666666666,bytesPerCoordinate:3.8971910718981526,resourceBytes:0,draped:{bytesPerFeature:3711.9299672493826,bytesPerFeatureLabel:991.1003999999999,bytesPerCoordinate:3.916858016273668}},OBJECT_POINT:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0,resourceBytes:0,draped:{bytesPerFeature:1751.6405617660876,bytesPerFeatureLabel:1024.7827699999998,bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,
bytesPerCoordinate:4.003101524580855,resourceBytes:0,draped:{bytesPerFeature:3265.877223973855,bytesPerFeatureLabel:1002.3207366666666,bytesPerCoordinate:4.003101524580855}},LINE_MITER:{bytesPerFeature:5757.019675077085,bytesPerFeatureLabel:998.6150266666667,bytesPerCoordinate:24.456810187064043,resourceBytes:0,draped:{bytesPerFeature:4101.480288021862,bytesPerFeatureLabel:1007.7540599999999,bytesPerCoordinate:18.25629912730874}},LINE_ROUND:{bytesPerFeature:5770.95297166408,bytesPerFeatureLabel:1017.77396,
bytesPerCoordinate:24.60919037084966,resourceBytes:0,draped:{bytesPerFeature:4089.5796612121826,bytesPerFeatureLabel:987.8320266666666,bytesPerCoordinate:18.43599029126731}},PATH_MITER_CIRCLE:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863,resourceBytes:0,draped:{bytesPerFeature:36120.81813311945,bytesPerFeatureLabel:977.3815,bytesPerCoordinate:2713.2216607858863}},PATH_ROUND_CIRCLE:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,
bytesPerCoordinate:5284.873051323177,resourceBytes:0,draped:{bytesPerFeature:23268.96777866874,bytesPerFeatureLabel:985.2637,bytesPerCoordinate:5284.873051323177}},PATH_MITER_QUAD:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994,resourceBytes:0,draped:{bytesPerFeature:24548.629753007182,bytesPerFeatureLabel:964.6924,bytesPerCoordinate:2114.107276663994}},PATH_ROUND_QUAD:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293,
resourceBytes:0,draped:{bytesPerFeature:34316.219663191616,bytesPerFeatureLabel:975.7985,bytesPerCoordinate:3331.3952550120293}},FILL:{bytesPerFeature:6141.501452970723,bytesPerFeatureLabel:1008.2056066666665,bytesPerCoordinate:9.669541106191478,resourceBytes:0,draped:{bytesPerFeature:4615.812654782311,bytesPerFeatureLabel:1004.2114200000001,bytesPerCoordinate:7.378043214430644}},FILL_OUTLINE:{bytesPerFeature:9038.575581319641,bytesPerFeatureLabel:1017.9996066666668,bytesPerCoordinate:14.96569682175086,
resourceBytes:0,draped:{bytesPerFeature:6369.386021594582,bytesPerFeatureLabel:1008.9863733333334,bytesPerCoordinate:10.25287774000214}},EXTRUDE:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849,resourceBytes:0,draped:{bytesPerFeature:20071.2337049912,bytesPerFeatureLabel:1019.49468,bytesPerCoordinate:49.39369614206849}},EXTRUDE_EDGES:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031,
resourceBytes:0,draped:{bytesPerFeature:22300.21739345088,bytesPerFeatureLabel:1017.4348466666665,bytesPerCoordinate:49.40242281963031}}};a.averageSymbolComplexities=function(p){p=e(p);0<p.numComplexities&&(p.primitivesPerFeature/=p.numComplexities,p.primitivesPerCoordinate/=p.numComplexities,p.drawCallsPerFeature/=p.numComplexities,p.memory.bytesPerFeature/=p.numComplexities,p.memory.bytesPerFeatureLabel/=p.numComplexities,p.memory.bytesPerCoordinate/=p.numComplexities,p.memory.resourceBytes/=p.numComplexities,
p.memory.draped.bytesPerFeature/=p.numComplexities,p.memory.draped.bytesPerFeatureLabel/=p.numComplexities,p.memory.draped.bytesPerCoordinate/=p.numComplexities);return p};a.defaultSymbolComplexity=function(p){if("web-style"===p.type)return v;const z=p.symbolLayers.toArray().map(C=>g(p,C));return e(z)};a.defaultSymbolLayerComplexity=g;a.defaultSymbolLayerMemoryComplexity=h;a.emptySymbolComplexity=v;a.memoryEstimators=k;a.totalSymbolComplexities=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayerConstants":function(){define(["exports"],function(a){a.PATH_NUM_CIRCLE_PROFILE_SUBDIVISIONS=10;a.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.PATH_NUM_ROUND_JOIN_SUBDIVISIONS=3;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/lib/GeometryUtil","../../webgl-engine/lib/lodRendering/LodResources"],function(a,
c,b,t){const n=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(r){switch(r){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(r,m){const d=(f,e,g=!1)=>({levels:f.map(h=>{const l=e(h.tesselation);g&&b.cgToGIS(l);return{components:[new t.LodComponentResources(l)],faceCount:l.indexCount/3,minScreenSpaceRadius:h.minScreenSpaceRadius}})});
switch(r){case "sphere":return d([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],f=>b.createPolySphereGeometry(m,.5,f,!0));case "cube":return d([{tesselation:0,minScreenSpaceRadius:0}],()=>b.createBoxGeometry(m,1));case "cone":return d(n,f=>b.createConeGeometry(m,1,.5,f,!1),!0);case "inverted-cone":return d(n,f=>b.createConeGeometry(m,1,.5,f,!0),
!0);case "cylinder":return d(n,f=>b.createCylinderGeometry(m,1,.5,f,[0,0,1],[0,0,.5]));case "tetrahedron":return d([{tesselation:0,minScreenSpaceRadius:0}],()=>b.createTetrahedronGeometry(m,1),!0);case "diamond":return d([{tesselation:0,minScreenSpaceRadius:0}],()=>b.createDiamondGeometry(m,1),!0)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/maybe"],
function(a,c,b){a.LodComponentResources=function(t,n=null){this.geometry=t;this.textures=n};a.geometriesFromLodLevelResources=function(t){t=t.components.map(n=>n.geometry);return c.unique(t)};a.geometriesFromLodResources=function(t){const n=[];t.levels.forEach(r=>{r.components.forEach(m=>{n.push(m.geometry)})});return c.unique(n)};a.materialsFromLodResources=function(t){const n=[];t.levels.forEach(r=>r.components.forEach(m=>n.push(m.geometry.material)));return c.unique(n)};a.texturesFromLodResources=
function(t){const n=[];t.levels.forEach(r=>{r.components.forEach(m=>{b.isSome(m.textures)&&n.push(...m.textures)})});return c.unique(n)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),function(a,c,b,t,n,r,m,d){function f(l,v){if(t.isNone(l))return null;
const q=t.isSome(l.color)?r.fromArray(c.toUnitRGBA(l.color)):r.fromValues(0,0,0,0),k=n.pt2px(l.size),p=n.pt2px(l.extensionLength);switch(l.type){case "solid":return e({color:q,size:k,extensionLength:p,...v});case "sketch":return{...h,color:q,size:k,extensionLength:p,...v,type:"sketch"}}}function e(l){return{...g,...l,type:"solid"}}const g={color:r.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:d.Transparency.OPAQUE,hasSlicePlane:!1},h={color:r.fromValues(0,0,0,.2),size:1,
extensionLength:0,opacity:1,objectTransparency:d.Transparency.OPAQUE,hasSlicePlane:!1};a.createMaterial=function(l,v){return f(l&&l.enabled&&l.edges||null,v)};a.createMaterialFromEdges=f;a.createSolidEdgeMaterial=e;a.hasEdges=function(l){return l&&l.enabled&&(m.isExtrudeSymbol3DLayer(l)||m.isFillSymbol3DLayer(l))&&t.isSome(l.edges)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],function(a){a.isExtrudeSymbol3DLayer=
function(c){return"extrude"===c.type};a.isFillSymbol3DLayer=function(c){return"fill"===c.type};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),
function(a,c,b,t,n,r,m,d,f,e){const g=b.create();a.createStageObject=function(h,l,v,q,k,p){var z=h.clippingExtent;t.projectPointToVector(l,g,h.elevationProvider.spatialReference);if(c.isSome(z)&&!n.containsPoint(z,g))return null;t.projectPointToVector(l,g,h.renderCoordsHelper.spatialReference);z=h.localOriginFactory.getOrigin(g);k=new e.Object3D({castShadow:!1,metadata:{layerUid:h.layer.uid,graphicUid:k,usesVerticalDistanceToGround:!0}});v.shaderTransformer=p;v.localOrigin=z;k.addGeometry(v);h=d.applyElevationAlignmentForHUD(k,
l,h.elevationProvider,h.renderCoordsHelper,q);return{object:k,sampledElevation:h}};a.extendPointGraphicElevationContext=function(h,l,v){h=h.elevationContext;v=v.spatialReference;t.projectPointToVector(l,g,v);h.centerPointInElevationSR=m.makeDehydratedPoint(g[0],g[1],l.hasZ?g[2]:0,c.isSome(v)?v:null)};a.placePointOnGeometry=function(h){switch(h.type){case "point":return h;case "polygon":case "extent":return f.computeCentroid(h);case "polyline":var l=h.paths[0];if(!l||0===l.length)break;l=r.getPointOnPath(l,
r.getPathLength(l)/2);return m.makeDehydratedPoint(l[0],l[1],l[2],h.spatialReference);case "mesh":return h.origin}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){function k(x,u,y){var w=x.bbMin;x=x.bbMax;if(t.hasIdentityRotation(y))for(y=r.set(C,y[12],y[13],y[14]),r.add(B,w,y),r.add(A,x,y),w=0;3>w;++w)u.min[w]=Math.min(u.min[w],B[w]),u.max[w]=Math.max(u.max[w],A[w]);else if(r.transformMat4(B,w,y),r.exactEquals(w,x))for(w=0;3>w;++w)u.min[w]=Math.min(u.min[w],B[w]),u.max[w]=Math.max(u.max[w],B[w]);else{r.transformMat4(A,x,y);for(var D=0;3>D;++D)u.min[D]=Math.min(u.min[D],B[D],A[D]),u.max[D]=Math.max(u.max[D],B[D],A[D]);
for(D=0;3>D;++D){r.copy(B,w);r.copy(A,x);B[D]=x[D];A[D]=w[D];r.transformMat4(B,B,y);r.transformMat4(A,A,y);for(let F=0;3>F;++F)u.min[F]=Math.min(u.min[F],B[F],A[F]),u.max[F]=Math.max(u.max[F],B[F],A[F])}}}g=function(x){function u(w={}){var D=x.call(this)||this;D.type=h.ContentObjectType.Object;D._geometries=[];D._transformation=n.create();D._bvObjectSpace=new z;D._bvWorldSpace=new z;D._bvDirty=!0;D._hasVolatileTransformation=!1;D._visible=!0;D.castShadow=null!=w.castShadow?w.castShadow:!0;D.metadata=
w.metadata;D.metadata&&D.metadata.isElevationSource&&(D.metadata.lastValidElevationBB=new p);w=w.geometries;b.isSome(w)&&(D._geometries=Array.from(w));return D}c._inheritsLoose(u,x);var y=u.prototype;y.dispose=function(){this._geometries.length=0};y.addGeometry=function(w){w.visible=this._visible;this._geometries.push(w);this._hasVolatileTransformation=this._hasVolatileTransformation||w.hasVolatileTransformation;this._emit("objectGeometryAdded",{object:this,geometry:w});this._invalidateBoundingVolume()};
y.removeGeometry=function(w){if(w=this._geometries.splice(w,1)[0])this._emit("objectGeometryRemoved",{object:this,geometry:w}),this._invalidateBoundingVolume()};y.removeAllGeometries=function(){for(;0<this._geometries.length;)this.removeGeometry(0)};y.geometryVertexAttrsUpdated=function(w){this._emit("objectGeometryUpdated",{object:this,geometry:w});this._invalidateBoundingVolume()};y.maskOccludee=function(){const w=new l.Object3DStateID(e.Object3DState.MaskOccludee);for(const D of this._geometries)D.occludees=
q.addObject3DStateID(D.occludees,w);this._emit("occlusionChanged",this);return w};y.removeOcclude=function(w){for(const D of this._geometries)D.occludees=q.removeObject3DStateID(D.occludees,w);this._emit("occlusionChanged",this)};y.highlight=function(){const w=new l.Object3DStateID(e.Object3DState.Highlight);for(const D of this._geometries)D.highlights=q.addObject3DStateID(D.highlights,w);this._emit("highlightChanged",this);return w};y.removeHighlight=function(w){for(const D of this._geometries)D.highlights=
q.removeObject3DStateID(D.highlights,w);this._emit("highlightChanged",this)};y.getCombinedStaticTransformation=function(w,D){return t.multiply(D,this.transformation,w.transformation)};y._getCombinedShaderTransformation=function(w){return t.multiply(n.create(),this.transformation,w.shaderTransformation)};y.hasVolativeTransformation=function(){return this._hasVolatileTransformation};y._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();
for(var w of this._geometries){var D=w.boundingInfo;b.isSome(D)&&(k(D,this._bvObjectSpace,w.shaderTransformation),k(D,this._bvWorldSpace,this._getCombinedShaderTransformation(w)))}r.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);r.lerp(this._bvWorldSpace.bounds,this._bvWorldSpace.min,this._bvWorldSpace.max,.5);w=m.create();D=m.create();var F=f.maxScale(this.transformation);for(const M of this._geometries){var E=M.boundingInfo;if(!b.isNone(E)){var K=M.shaderTransformation,
J=f.maxScale(K);r.transformMat4(w,E.center,K);K=r.distance(w,this._bvObjectSpace.bounds);E=E.radius*J;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],K+E);r.transformMat4(D,w,this.transformation);J=r.distance(D,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],J+E*F)}}this._bvDirty=!1}};y._invalidateBoundingVolume=function(){this._bvDirty=!0;b.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)};
y._emit=function(w,D){b.isSome(this._parentLayer)&&this._parentLayer.events.emit(w,D)};c._createClass(u,[{key:"geometries",get:function(){return this._geometries}},{key:"transformation",get:function(){return this._transformation},set:function(w){t.copy(this._transformation,w);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(w){v.assert(null==this._parentLayer||null==w,"Object3D can only be added to a single Layer");
this._parentLayer=w}},{key:"visible",get:function(){return this._visible},set:function(w){if(this._visible!==w){this._visible=w;for(const D of this._geometries)D.visible=this._visible;this._emit("visibilityChanged",this)}}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();return this._bvObjectSpace}},{key:"test",get:function(){const w=this;return{hasGeometry:D=>w._geometries.includes(D),
getGeometryIndex:D=>w._geometries.indexOf(D)}}}]);return u}(g.ContentObject);let p=function(){function x(){this.min=m.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=m.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}x.prototype.isEmpty=function(){return this.max[0]<this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return x}(),z=function(x){function u(){var y=x.apply(this,arguments)||this;y.bounds=d.create();return y}c._inheritsLoose(u,x);u.prototype.init=
function(){r.set(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);r.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);d.clear(this.bounds)};return u}(p);const C=m.create(),B=m.create(),A=m.create();a.Object3D=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2f32 ../../../../chunks/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUD.glsl ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){let k=function(x){function u(w){w=x.call(this,w,new z)||this;w._configuration=new q.LineCalloutTechniqueConfiguration;w._uniqueMaterialIdentifier=u.uniqueMaterialIdentifier(w.parameters);return w}c._inheritsLoose(u,x);var y=u.prototype;y.getPassParameters=function(){return this.parameters};y.getConfiguration=function(w,D){w=D?.slot!==g.RenderSlot.LINE_CALLOUTS;this._configuration.occlusionTestEnabled=this.parameters.occlusionTest;this._configuration.hasVerticalOffset=
b.isSome(this.parameters.verticalOffset);this._configuration.hasScreenSizePerspective=b.isSome(this.parameters.screenSizePerspective);this._configuration.depthHudEnabled=w;this._configuration.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this._configuration.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?d.HUDSpace.Screen:d.HUDSpace.World;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasMultipassGeometry=D.multipassGeometry.enabled;
return this._configuration};y.intersect=function(){};y.requiresSlot=function(w,D){if(D===m.ShaderOutput.Color)switch(w){case g.RenderSlot.LINE_CALLOUTS:case g.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1};y.createGLMaterial=function(w){return new p(w)};y.createBufferWriter=function(){return new A};y.validateParameters=function(w){w=u.uniqueMaterialIdentifier(w);w!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=w)};u.uniqueMaterialIdentifier=function(w){return JSON.stringify({screenOffset:w.screenOffset||
[0,0],centerOffsetUnits:w.centerOffsetUnits||"world"})};c._createClass(u,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return u}(e.Material),p=function(x){function u(){return x.apply(this,arguments)||this}c._inheritsLoose(u,x);u.prototype.beginSlot=function(y){return this.ensureTechnique(v.LineCalloutTechnique,y)};return u}(f),z=function(x){function u(){var y=x.apply(this,arguments)||this;y.screenOffset=n.ZEROS;y.color=[0,0,0,1];y.size=1;y.occlusionTest=
!1;y.shaderPolygonOffset=1E-5;y.depthHUDAlignStart=!1;y.centerOffsetUnits="world";y.hasSlicePlane=!1;return y}c._inheritsLoose(u,x);return u}(e.MaterialParameters);const C=r.newLayout().vec3f(h.VertexAttribute.POSITION).vec3f(h.VertexAttribute.NORMAL).vec2f(h.VertexAttribute.UV0).vec4f(h.VertexAttribute.AUXPOS1),B=[t.fromValues(0,0),t.fromValues(1,0),t.fromValues(0,1),t.fromValues(1,0),t.fromValues(1,1),t.fromValues(0,1)];let A=function(){function x(){this.vertexBufferLayout=C}var u=x.prototype;u.allocate=
function(y){return this.vertexBufferLayout.createBuffer(y)};u.elementCount=function(y){return 6*y.indices.get(h.VertexAttribute.POSITION).length};u.write=function(y,w,D,F,E){l.writePosition(D.indices.get(h.VertexAttribute.POSITION),D.vertexAttributes.get(h.VertexAttribute.POSITION).data,y,F.position,E,6);l.writeNormal(D.indices.get(h.VertexAttribute.NORMAL),D.vertexAttributes.get(h.VertexAttribute.NORMAL).data,w,F.normal,E,6);l.writeBufferVec4(D.indices.get(h.VertexAttribute.AUXPOS1),D.vertexAttributes.get(h.VertexAttribute.AUXPOS1).data,
F.auxpos1,E,6);for(y=0;y<B.length;++y)F.uv0.setVec(E+y,B[y])};return x}();a.LineCalloutMaterial=k;a.Parameters=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function c(){return new Float32Array(2)}function b(q){const k=new Float32Array(2);k[0]=q[0];k[1]=q[1];return k}function t(q,k){const p=new Float32Array(2);p[0]=q;p[1]=k;return p}function n(q,k){return new Float32Array(q,k,2)}function r(){return c()}function m(){return t(1,
1)}function d(){return t(1,0)}function f(){return t(0,1)}const e=c(),g=m(),h=d(),l=f(),v=Object.freeze(Object.defineProperty({__proto__:null,ONES:g,UNIT_X:h,UNIT_Y:l,ZEROS:e,clone:b,create:c,createView:n,fromValues:t,ones:m,unitX:d,unitY:f,zeros:r},Symbol.toStringTag,{value:"Module"}));a.ONES=g;a.UNIT_X=h;a.UNIT_Y=l;a.ZEROS=e;a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.ones=m;a.unitX=d;a.unitY=f;a.vec2f32=v;a.zeros=r})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){r=function(h){function l(){return h.apply(this,arguments)||this}b._inheritsLoose(l,h);var v=l.prototype;v.initializeConfiguration=function(q,k){k.spherical=q.viewingMode===t.ViewingMode.Global};v.initializeProgram=function(q){return new d.Program(q.rctx,l.shader.get().build(this.configuration),m.Default3D)};v.setPipelineState=function(q){q=q?e.CompareFunction.ALWAYS:e.CompareFunction.LESS;return this.configuration.depthHudEnabled?g.makePipelineState({depthTest:{func:q},
depthWrite:g.defaultDepthWriteParams}):g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:q},colorWrite:g.defaultColorWriteParams})};v.initializePipeline=function(){return this.setPipelineState(this.configuration.hasMultipassGeometry)};return l}(r.ShaderTechnique);r.shader=new n.ReloadableShaderModule(f.LineCallout,()=>new Promise((h,l)=>a(["./LineCallout.glsl"],h,l)));
c.LineCalloutTechnique=r;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){function p(B){const A=new q.ShaderBuilder;A.include(m.AlignPixel);A.include(d.HUD,B);A.include(r.SliceDraw,B);A.attributes.add(k.VertexAttribute.UV0,"vec2");const {vertex:x,fragment:u}=A;x.uniforms.add([new h.Float4PassUniform("viewport",(y,w)=>w.camera.fullViewport),new l.FloatPassUniform("lineSize",(y,w)=>Math.ceil(y.size)*w.camera.pixelRatio),new g.Float2PassUniform("pixelToNDC",(y,w)=>b.set(C,2/w.camera.fullViewport[2],2/w.camera.fullViewport[3])),new l.FloatPassUniform("borderSize",
(y,w)=>c.isSome(y.borderColor)?w.camera.pixelRatio:0),new g.Float2PassUniform("screenOffset",(y,w)=>b.set(C,y.screenOffset[0]*w.camera.pixelRatio,y.screenOffset[1]*w.camera.pixelRatio))]);A.varyings.add("coverageSampling","vec4");A.varyings.add("lineSizes","vec2");B.hasMultipassGeometry&&A.varyings.add("depth","float");B.hasScreenSizePerspective&&e.addScreenSizePerspectiveAlignment(x);x.code.add(v.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${B.occlusionTestEnabled?v.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${B.hasScreenSizePerspective?v.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:v.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${B.hasMultipassGeometry?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${B.depthHudEnabled?B.depthHudAlignStartEnabled?v.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:v.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${B.hasScreenSizePerspective?v.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:v.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);u.uniforms.add([new h.Float4PassUniform("uColor",y=>z(y.color)),new h.Float4PassUniform("borderColor",y=>z(y.borderColor))]);B.hasMultipassGeometry&&(u.include(f.multipassGeometryTest,B),u.uniforms.add(new g.Float2PassUniform("inverseViewport",(y,w)=>w.inverseViewport)));u.code.add(v.glsl`
    void main() {
      ${B.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${B.depthHudEnabled?v.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:v.glsl`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return A}function z(B){return c.isSome(B)?B:n.ZEROS}const C=t.create();t=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.LineCallout=t;a.build=p})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r){r=function(m){function d(){var f=m.apply(this,arguments)||this;f.screenCenterOffsetUnitsEnabled=t.HUDSpace.World;f.spherical=!1;f.occlusionTestEnabled=!0;f.hasVerticalOffset=!1;f.hasScreenSizePerspective=!1;f.depthHudEnabled=!1;f.depthHudAlignStartEnabled=!1;f.hasSlicePlane=!1;f.hasMultipassGeometry=!1;return f}c._inheritsLoose(d,m);return d}(r.DefaultTechniqueConfiguration);b.__decorate([n.parameter({count:t.HUDSpace.COUNT})],r.prototype,"screenCenterOffsetUnitsEnabled",void 0);
b.__decorate([n.parameter()],r.prototype,"spherical",void 0);b.__decorate([n.parameter()],r.prototype,"occlusionTestEnabled",void 0);b.__decorate([n.parameter()],r.prototype,"hasVerticalOffset",void 0);b.__decorate([n.parameter()],r.prototype,"hasScreenSizePerspective",void 0);b.__decorate([n.parameter()],r.prototype,"depthHudEnabled",void 0);b.__decorate([n.parameter()],r.prototype,"depthHudAlignStartEnabled",void 0);b.__decorate([n.parameter()],r.prototype,"hasSlicePlane",void 0);b.__decorate([n.parameter()],
r.prototype,"hasMultipassGeometry",void 0);b.__decorate([n.parameter({constValue:!0})],r.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([n.parameter({constValue:!1})],r.prototype,"isDraped",void 0);a.LineCalloutTechniqueConfiguration=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,c,b){a.getGraphics3DSymbol=function(t){return t instanceof
b?t.graphics3DSymbol:t instanceof c?t:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable ./symbolComplexity".split(" "),function(a,c,b,t,n,r,m,d,f,e){const g={renderPriority:0,renderPriorityStep:1,
ignoreDrivers:!1};return function(h){function l(q,k,p){var z=h.call(this,k.schedule)||this;z._symbol=q;z._context=k;z._backgroundLayers=p;z._destroyed=!1;z.symbolLayers=[];z.referenced=0;z._extentPadding=0;return z}a._inheritsLoose(l,h);var v=l.prototype;v.doLoad=function(){var q=a._asyncToGenerator(function*(k){var p=this;let z=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(z=this._backgroundLayers.concat(z));const C=z.length;for(;this.symbolLayers.length<z.length;)this.symbolLayers.push(null);
this.symbolLayers.length=z.length;const B=[];for(let x=0;x<C;x++){var A=z.getItemAt(x);if(!1===A.enabled)continue;g.renderPriority=1-(1+x)/C;g.renderPriorityStep=1/C;g.ignoreDrivers=A._ignoreDrivers;const u=m.make(this.symbol,A,this._context,g);(A=t.onAbortOrThrow(k,()=>{this.symbolLayers[x]=null;u.destroy()}))&&B.push(A);this.symbolLayers[x]=u}yield c.forEach(this.symbolLayers,function(){var x=a._asyncToGenerator(function*(u,y){if(b.isSome(u))try{yield u.load(),p._extentPadding+=Math.max(p._extentPadding,
u.extentPadding)}catch{p.symbolLayers[y]=null}});return function(u,y){return x.apply(this,arguments)}}());B.forEach(x=>x.remove());t.throwIfAborted(k);if(this.symbolLayers.length&&!this.symbolLayers.some(x=>!!x))throw Error();});return function(k){return q.apply(this,arguments)}}();v.getSymbolLayerSize=function(q){q=this.symbolLayers[q];return b.isSome(q)?q.getCachedSize():null};v.createGraphics3DGraphic=function(q,k){const p=q.graphic,z=Array(this.symbolLayers.length);for(let C=0;C<this.symbolLayers.length;C++){const B=
this.symbolLayers[C];z[C]=b.isSome(B)?B.createGraphics3DGraphic(q):null}return new n(p,k||this,z,q.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};v.globalPropertyChanged=function(q,k){const p=this.symbolLayers.length;for(let z=0;z<p;z++){const C=this.symbolLayers[z],B=A=>{A=A.layers[z];return A instanceof r.Graphics3DObject3DGraphicLayer?A:null};if(b.isSome(C)&&
!C.globalPropertyChanged(q,k,B))return!1}return!0};v.applyRendererDiff=function(q,k){return this.loadStatus!==f.LoadStatus.LOADED?d.ApplyRendererDiffResult.Recreate_Symbol:this.symbolLayers.reduce((p,z)=>p!==d.ApplyRendererDiffResult.Recreate_Symbol&&b.isSome(z)?Math.min(p,z.applyRendererDiff(q,k)):p,d.ApplyRendererDiffResult.Fast_Update)};v.prepareSymbolPatch=function(q){if(this.loadStatus!==f.LoadStatus.FAILED&&"partial"===q.diff.type){var k=q.diff.diff;if(k.symbolLayers&&"partial"===k.symbolLayers.type){var p=
k.symbolLayers.diff;this.symbolLayers.forEach((z,C)=>{if(!b.isNone(z)){var B=p[C];if(B){const A={diff:B,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};z.prepareSymbolLayerPatch(A);q.symbolStatePatches.push(...A.symbolLayerStatePatches);A.graphics3DGraphicPatches.length&&q.graphics3DGraphicPatches.push((x,u)=>{const y=x.layers[C];b.isSome(y)&&A.graphics3DGraphicPatches.forEach(w=>w(y,u))})}}})}}};v.updateGeometry=function(q,k){for(let p=0;p<this.symbolLayers.length;p++){const z=this.symbolLayers[p];
if(b.isNone(z))continue;const C=q.layers[p];if(b.isNone(C)||!z.updateGeometry(C,k))return!1}return!0};v.onRemoveGraphic=function(q){for(let k=0;k<this.symbolLayers.length;k++){const p=this.symbolLayers[k];if(b.isNone(p))continue;const z=q.layers[k];if(b.isSome(z))p.onRemoveGraphic(z)}};v.getFastUpdateStatus=function(){let q=0,k=0,p=0;this.symbolLayers.forEach(z=>{b.isNone(z)||(z.loadStatus===f.LoadStatus.LOADING?q++:z.isFastUpdatesEnabled()?p++:k++)});return{loading:q,slow:k,fast:p}};v.queryForSnapping=
function(){var q=a._asyncToGenerator(function*(k,p,z,C){var B=this.symbolLayers.filter(b.isSome).filter(A=>b.isSome(A.queryForSnapping)).map(A=>A.queryForSnapping(k,p,z,C));B=yield Promise.all(B);t.throwIfAborted(C);return B.flat()});return function(k,p,z,C){return q.apply(this,arguments)}}();v.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{h.prototype.destroy.call(this);for(const q of this.symbolLayers)b.isSome(q)&&q.destroy();this.symbolLayers.length=
0;this._destroyed=!0}};a._createClass(l,[{key:"symbol",get:function(){return this._symbol},set:function(q){this._symbol=q;q.symbolLayers.forEach((k,p)=>{p=this.symbolLayers[p];b.isSome(p)&&(p.symbol=q,p.symbolLayer=k)})}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"symbologySnappingSupported",get:function(){return this.symbolLayers.some(q=>b.isSome(q)&&q.queryForSnapping)}},{key:"complexity",get:function(){return e.totalSymbolComplexities(this.symbolLayers.map(q=>b.get(q,
"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return l}(f.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/maybe ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){const C=new n(Array,A=>h.set(A,h.ZERO),null,10,5),B=l.create();return function(){function A(u,y,w,D,F){this.graphic=u;this.graphics3DSymbol=y;this.layers=w;this._labelLayers=[];this._auxiliaryLayers=[];var E=p.VisibilityFlag._COUNT;const K=Array(p.VisibilityGroup._COUNT);for(let J=0;J<K.length;J++)K[J]=Array(E);this._visibilityFlags=K;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;this.isElevationSource=
!1;++y.referenced;this._featureExpressionFeature=F?z.createFeature(F,u,D):null;for(const J of w)t.isSome(J)&&(this.isElevationSource=this.isElevationSource||J.isElevationSource)}var x=A.prototype;x.initialize=function(u,y){this._layer=y;this._stage=u;this._forEachSymbolLayerGraphic(w=>{w.initialize(u,y);w.setVisibility(this.isVisible())})};x.destroy=function(){this._forEachSymbolLayerGraphic(u=>u.destroy());this._auxiliaryLayers=this.layers=null;--this.graphics3DSymbol.referenced;this.graphics3DSymbol=
null};x.clearLabelGraphics=function(){this._forEachLabelGraphic(u=>u.destroy());this._labelLayers.length=0};x.addLabelGraphic=function(u,y,w){this._labelLayers.push(u);u.initialize(y,w);u.setVisibility(this.isVisible(p.VisibilityGroup.LABEL))};x.addAuxiliaryGraphic=function(u){this._auxiliaryLayers.push(u);this._layer&&(u.initialize(this._stage,this._layer),u.setVisibility(this.isVisible()))};x.isVisible=function(u=p.VisibilityGroup.GRAPHIC,y){for(let w=0;w<=u;w++){const D=this._visibilityFlags[w];
for(let F=0;F<D.length;++F)if(!1===D[F]&&F!==y)return!1}return!0};x.hasVisibilityFlag=function(u,y){return null!=this._visibilityFlags[y][u]};x.setVisibilityFlag=function(u,y,w){const D=this.isVisible(w);this._visibilityFlags[w][u]=y;const F=this.isVisible(w);if(D===F)return!1;if(w===p.VisibilityGroup.LABEL)this._forEachLabelGraphic(E=>E.setVisibility(F));else{this._forEachSymbolLayerGraphic(K=>K.setVisibility(F));const E=this.isVisible(p.VisibilityGroup.LABEL);this._forEachLabelGraphic(K=>K.setVisibility(E))}return!0};
x.clearVisibilityFlag=function(u,y=p.VisibilityGroup.GRAPHIC){return this.setVisibilityFlag(u,void 0,y)};x.computeExtent=function(u){if(!this._extent){var y=this.graphic.geometry;if(t.isNone(y))return!1;this._extent=l.create();q.computeAABR(y,this._extent);y=y.spatialReference;if(!v.equals(y,u)&&!g.projectBoundingRect(this._extent,y,this._extent,u))return this._extent=null,!1}return!0};x.getAsOptimizedGeometry=function(u,y){if(t.isSome(this._optimizedGeometry.geometry)&&this._optimizedGeometry.hasZ===
u&&this._optimizedGeometry.hasM===y)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,u,y);this._optimizedGeometry.hasZ=u;this._optimizedGeometry.hasM=y;return this._optimizedGeometry.geometry};x._convertGraphicToOptimizedGeometry=function(u,y,w){u=u.geometry;if("mesh"===u.type||"extent"===u.type)u=e.fromExtent("mesh"===u.type?u.extent:u);return k.convertFromGeometry(u,y,w)};x.computeAttachmentOrigin=function(){const u={render:{origin:f.create(),
num:0},draped:{origin:m.create(),num:0}};for(const y of this.layers)t.isNone(y)||y.computeAttachmentOrigin(u);1<u.render.num&&d.scale(u.render.origin,u.render.origin,1/u.render.num);1<u.draped.num&&r.scale(u.draped.origin,u.draped.origin,1/u.draped.num);return u};x.getProjectedBoundingBox=function(){var u=a._asyncToGenerator(function*(y,w,D,F,E){E||(E={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});E.boundingBox?h.empty(E.boundingBox):E.boundingBox=h.empty();E.requiresDrapedElevation=
!1;yield c.forEach(this.layers,function(){var K=a._asyncToGenerator(function*(J){if(!t.isNone(J)){var M="draped"===J.type?w:y,N=C.acquire();J=yield J.getProjectedBoundingBox(M,D,E.screenSpaceObjects,F,N);isFinite(J[2])&&isFinite(J[5])||(E.requiresDrapedElevation=!0);J&&h.expandWithAABB(E.boundingBox,N);C.release(N)}});return function(J){return K.apply(this,arguments)}}());return h.allFinite(E.boundingBox)||l.allFinite(h.toRect(E.boundingBox,B))?E:null});return function(y,w,D,F,E){return u.apply(this,
arguments)}}();x.needsElevationUpdates=function(){for(const u of this.layers)if(t.isSome(u)&&("object3d"===u.type||"lod-instance"===u.type)&&u.needsElevationUpdates)return!0;for(const u of this._labelLayers)if(u&&u.needsElevationUpdates)return!0;return!1};x.alignWithElevation=function(u,y,w){this._forEachRenderedGraphic(D=>{"object3d"!==D.type&&"lod-instance"!==D.type||D.alignWithElevation(u,y,this._featureExpressionFeature,w)})};x.alignWithAbsoluteElevation=function(u,y,w){this._forEachRenderedGraphic(D=>
{"object3d"===D.type&&D.alignWithAbsoluteElevation(u,y,w)})};x.addObjectStateSet=function(u,y){this._forEachSymbolLayerGraphic(w=>w.addObjectState(u,y))};x.removeObjectState=function(u){this._forEachSymbolLayerGraphic(y=>y.removeObjectState(u))};x._forEachGraphicList=function(u,y){u.forEach(w=>w&&y(w))};x._forEachSymbolLayerGraphic=function(u){this._forEachGraphicList(this.layers,u);this._forEachGraphicList(this._auxiliaryLayers,u)};x._forEachLabelGraphic=function(u){this._forEachGraphicList(this._labelLayers,
u)};x._forEachRenderedGraphic=function(u){this._forEachSymbolLayerGraphic(u);this._forEachLabelGraphic(u)};a._createClass(A,[{key:"labelLayers",get:function(){return this._labelLayers}},{key:"extent",get:function(){return this._extent}},{key:"destroyed",get:function(){return null==this.layers}},{key:"isDraped",get:function(){let u=!1;this._forEachSymbolLayerGraphic(y=>{"draped"===y.type&&(u=!0)});return u}},{key:"usedMemory",get:function(){let u=b.estimateAttributesObjectSize(this.graphic.attributes);
this._forEachSymbolLayerGraphic(y=>{const w=y.graphics3DSymbolLayer.complexity;t.isNone(w)||(y="draped"===y.type?w.memory.draped:w.memory,u+=y.bytesPerFeature,y.bytesPerCoordinate&&(u+=q.numVertices(this.graphic.geometry)*y.bytesPerCoordinate))});return u}}]);return A}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){const h={icon:t.Graphics3DIconSymbolLayer,object:m.Graphics3DObjectSymbolLayer,line:n.Graphics3DLineSymbolLayer,path:d.Graphics3DPathSymbolLayer,fill:f.Graphics3DPolygonFillSymbolLayer,extrude:b.Graphics3DExtrudeSymbolLayer,text:e.Graphics3DTextSymbolLayer,water:g.Graphics3DWaterSymbolLayer},l={"mesh-3d":{fill:r.Graphics3DMeshFillSymbolLayer}};a.make=function(v,q,k,p){const z=l[v.type]&&l[v.type][q.type]||h[q.type];return z?new z(v,q,k,p):(c.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory").error("GraphicsLayerFactory#make",
`unknown symbol type ${q.type}`),null)};a.setSymbolClass=function(v,q){h[v]=q};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Error ../../../../core/lang ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../layers/graphics/data/SnappingCandidate ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryWithMapPositions ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R){function Q(na,pa,va,wa,za,sa){const ua=Array(pa.length).fill(0);za=[[S.VertexAttribute.POSITION,new P.Attribute(wa.positions,3,!0)],[S.VertexAttribute.NORMAL,new P.Attribute(wa.normals,3,!0)],[S.VertexAttribute.COLOR,new P.Attribute(za,4,!0)],[S.VertexAttribute.SIZE,new P.Attribute(wa.heights,1,!0)]];return new H.Geometry(na,za,[[S.VertexAttribute.POSITION,pa],[S.VertexAttribute.NORMAL,pa],[S.VertexAttribute.COLOR,
ua]],wa.elevation,G.ContentObjectType.Mesh,sa,va)}function V(na,pa,va,wa,za,sa,ua,oa,xa,Ea,Ia,Na,Oa){let Ja=0;var Sa=2*wa.count,Ua=wa.index,Za=wa.count,ma=va.length/3,Ya=Sa;l.copy(Z,Na);const bb=0<Ia?1:-1;Sa=3*Ua;let Qa=0;Ua=3*Qa;let Aa=Za;Na=3*Aa;for(let Ca=0;Ca<Za;++Ca)Oa&&(Z[0]=na[Sa+0],Z[1]=na[Sa+1],Z[2]=na[Sa+2],l.normalize(Z,Z)),za[Ua+0]=na[Sa+0],za[Ua+1]=na[Sa+1],za[Ua+2]=na[Sa+2],sa[Ua+0]=pa[Sa+0],sa[Ua+1]=pa[Sa+1],sa[Ua+2]=pa[Sa+2],ua[Ua+0]=-bb*Z[0],ua[Ua+1]=-bb*Z[1],ua[Ua+2]=-bb*Z[2],oa[Qa]=
0,za[Na+0]=na[Sa+0]+Ia*Z[0],za[Na+1]=na[Sa+1]+Ia*Z[1],za[Na+2]=na[Sa+2]+Ia*Z[2],sa[Na+0]=pa[Sa+0],sa[Na+1]=pa[Sa+1],sa[Na+2]=pa[Sa+2],ua[Na+0]=bb*Z[0],ua[Na+1]=bb*Z[1],ua[Na+2]=bb*Z[2],oa[Aa]=Ia,Ua+=3,Na+=3,Sa+=3,Qa+=1,Aa+=1;Ua=Sa=0;Na=3*Ya;na=0>Ia?ka:fa;pa=0>Ia?fa:ka;for(Oa=0;Oa<ma;++Oa)Ea[Ua+0]=va[Sa+na[0]],Ea[Ua+1]=va[Sa+na[1]],Ea[Ua+2]=va[Sa+na[2]],xa[Na+0]=va[Sa+pa[0]]+Za,xa[Na+1]=va[Sa+pa[1]]+Za,xa[Na+2]=va[Sa+pa[2]]+Za,Ua+=3,Na+=3,Sa+=3;va=2*wa.count;Sa=0;X(za,sa,oa,ua,Ja,wa.pathLengths[0],
wa.count,va,xa,Sa,Ia);va+=4*wa.pathLengths[0];Sa+=2*wa.pathLengths[0];Ja+=wa.pathLengths[0];for(Ea=1;Ea<wa.pathLengths.length;++Ea)X(za,sa,oa,ua,Ja,wa.pathLengths[Ea],wa.count,va,xa,Sa,Ia),va+=4*wa.pathLengths[Ea],Sa+=2*wa.pathLengths[Ea],Ja+=wa.pathLengths[Ea]}function aa(na,pa,va,wa,za,sa,ua){wa[sa]=wa[ua];ua*=3;sa*=3;na[sa+0]=na[ua+0];na[sa+1]=na[ua+1];na[sa+2]=na[ua+2];pa[sa+0]=pa[ua+0];pa[sa+1]=pa[ua+1];pa[sa+2]=pa[ua+2];va[sa+0]=za[0];va[sa+1]=za[1];va[sa+2]=za[2]}function X(na,pa,va,wa,za,
sa,ua,oa,xa,Ea,Ia){let Na=za,Oa=za+1,Ja=za+ua,Sa=za+ua+1,Ua=oa,Za=oa+1,ma=oa+2*sa;oa=oa+2*sa+1;0>Ia&&(Na=za+ua+1,Sa=za);Ea*=3;for(let qa=0;qa<sa;++qa){qa===sa-1&&(0<Ia?(Oa=za,Sa=za+ua):(Oa=za,Na=za+ua));var Ya=na,bb=Na,Qa=Oa,Aa=Ja,Ca=U;bb*=3;Qa*=3;Aa*=3;l.set(Y,Ya[bb++],Ya[bb++],Ya[bb++]);l.set(ba,Ya[Qa++],Ya[Qa++],Ya[Qa++]);l.set(da,Ya[Aa++],Ya[Aa++],Ya[Aa++]);l.subtract(ea,ba,Y);l.subtract(ca,da,Y);l.cross(Ca,ca,ea);l.normalize(Ca,Ca);aa(na,pa,wa,va,U,Ua,Na);aa(na,pa,wa,va,U,Za,Oa);aa(na,pa,wa,
va,U,ma,Ja);aa(na,pa,wa,va,U,oa,Sa);xa[Ea++]=Ua;xa[Ea++]=ma;xa[Ea++]=oa;xa[Ea++]=Ua;xa[Ea++]=oa;xa[Ea++]=Za;Na++;Oa++;Ja++;Sa++;Ua+=2;Za+=2;ma+=2;oa+=2}}function W(na,pa,va,wa,za){na=na.stageObject;const sa=na.geometries,ua=sa.length;pa="absolute-height"!==pa.mode;let oa=0;const xa=na.transformation,Ea=g.invertOrIdentity(h.create(),xa);for(let Ia=0;Ia<ua;Ia+=2){const Na=sa[Ia];if(!L.isGeometryWithMapPositions(Na))continue;const Oa=Na.getMutableAttribute(S.VertexAttribute.POSITION).data,Ja=Na.vertexAttributes.get(S.VertexAttribute.SIZE).data,
Sa=new M.SamplePosition(Na.mapPositions),Ua=Oa.length/3;let Za=0,ma=!1,Ya=0;for(let bb=0;bb<Ua;bb++){ja[0]=Oa[Za];ja[1]=Oa[Za+1];ja[2]=Oa[Za+2];wa(Sa,ha);pa&&(Ya+=ha.sampledElevation);J.TESTS_DISABLE_OPTIMIZATIONS?(l.set(ia,Sa.array[Sa.offset+0],Sa.array[Sa.offset+1],ha.z+Ja[Za/3]),r.isSome(va)&&za.toRenderCoords(ia,va,ia)):(l.set(ia,Oa[Za+0],Oa[Za+1],Oa[Za+2]),l.transformMat4(ia,ia,xa),za.setAltitude(ia,ha.z+Ja[Za/3]));l.transformMat4(ia,ia,Ea);Oa[Za]=ia[0];Oa[Za+1]=ia[1];Oa[Za+2]=ia[2];const Qa=
.01/za.unitInMeters;if(Math.abs(ja[0]-Oa[Za])>=Qa||Math.abs(ja[1]-Oa[Za+1])>=Qa||Math.abs(ja[2]-Oa[Za+2])>=Qa)ma=!0;Sa.offset+=3;Za+=3}ma&&(Na.invalidateBoundingInfo(),na.geometryVertexAttrsUpdated(sa[Ia]),sa[Ia+1].invalidateBoundingInfo(),na.geometryVertexAttrsUpdated(sa[Ia+1]));oa+=Ya/Ua}return oa/ua}const T=["polygon","extent"];b=function(na){function pa(wa,za,sa,ua){wa=na.call(this,wa,za,sa,ua)||this;wa.ensureDrapedStatus(!1);return wa}c._inheritsLoose(pa,na);var va=pa.prototype;va.doLoad=function(){var wa=
c._asyncToGenerator(function*(){if(!this._drivenProperties.size){var za=D.validateSymbolLayerSize(this._getSymbolSize());if(za)throw new t("graphics3dextrudesymbollayer:invalid-size",za);}za=r.get(this.symbolLayer,"material","color");var sa=this._getCombinedOpacityAndColor(za);za=v.fromArray(sa);sa=sa[3];const ua=1>sa||this.needsDrivenTransparentPass;za={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:za,ambient:za,opacity:sa,transparent:ua,cullFace:ua?I.CullFaceOptions.None:
I.CullFaceOptions.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new R.DefaultMaterial(za);this._bottomMaterial=new R.DefaultMaterial({...za,cullFace:I.CullFaceOptions.Back});this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)});return function(){return wa.apply(this,arguments)}}();va.destroy=function(){na.prototype.destroy.call(this);this._material&&(this._context.stage.remove(this._material),
this._context.stage.remove(this._bottomMaterial))};va.createGraphics3DGraphic=function(wa){const za=wa.graphic;if(!this._validateGeometry(za.geometry,T,this.symbolLayer.type))return null;const sa=this._getVertexOpacityAndColor(wa.renderingInfo,255),ua=this.setGraphicElevationContext(za,new u.ElevationContext);return this._createAs3DShape(za,wa.renderingInfo,sa,ua,za.uid)};va.layerOpacityChanged=function(wa,za){var sa=r.get(this.symbolLayer,"material","color");sa=this._getCombinedOpacity(sa);const ua=
1>sa||this.needsDrivenTransparentPass;this._material.setParameters({opacity:sa,transparent:ua});this._bottomMaterial.setParameters({opacity:sa,transparent:ua});const oa=this._getLayerOpacity();wa.forEach(xa=>{xa=za(xa);r.isSome(xa)&&xa.layerOpacityChanged(oa,this._context.isAsync)})};va.layerElevationInfoChanged=function(wa,za){return this.updateGraphics3DGraphicElevationInfo(wa,za,x.needsElevationUpdates3D)};va.slicePlaneEnabledChanged=function(wa,za){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});wa.forEach(sa=>{sa=za(sa);r.isSome(sa)&&sa.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};va.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};va.pixelRatioChanged=function(){return!0};
va.skipHighSymbolLodsChanged=function(){return!0};va._getExtrusionSize=function(wa){wa=wa.size&&this._drivenProperties.size?B.getDriverAxisSizeValue(wa.size,2)??0:this._getSymbolSize();return wa/=this._context.renderCoordsHelper.unitInMeters};va.applyRendererDiff=function(wa,za){return this._drivenPropertiesChanged(za)?F.ApplyRendererDiffResult.Recreate_Symbol:F.ApplyRendererDiffResult.Recreate_Graphics};va.queryForSnapping=function(){var wa=c._asyncToGenerator(function*(za,sa,ua,oa){sa=this._getExtrusionSize(ua)*
this._context.renderCoordsHelper.unitInMeters/m.getMetersPerVerticalUnitForSR(sa);const {objectId:xa,target:Ea}=za;ua=n.clone(Ea);ua.z=(ua.z??0)+sa;switch(za.type){case "edge":const {start:Ia,end:Na}=za;za=n.clone(Ia);oa=n.clone(Na);za.z=(za.z??0)+sa;oa.z=(oa.z??0)+sa;return[C.makeEdgeCandidate(xa,ua,Infinity,za,oa)];case "vertex":return[C.makeVertexCandidate(xa,ua,Infinity),C.makeEdgeCandidate(xa,Ea,Infinity,Ea,ua)];default:return[]}});return function(za,sa,ua,oa){return wa.apply(this,arguments)}}();
va._getSymbolSize=function(){return this.symbolLayer.size??1};va._createAs3DShape=function(wa,za,sa,ua,oa){var xa=E.geometryAsPolygon(wa.geometry);if(r.isNone(xa))return null;if(0===xa.rings.length||!xa.rings.some(Xa=>0<Xa.length))return this._logGeometryValidationWarnings(xa.rings,"rings","ExtrudeSymbol3DLayer"),null;wa=N.geometryToRenderInfo(xa,this._context.elevationProvider,this._context.renderCoordsHelper,ua);this._logGeometryCreationWarnings(wa,xa.rings,"rings","ExtrudeSymbol3DLayer");var Ea=
D.computeCentroid(xa);if(r.isNone(Ea))return null;var Ia=[];const Na=k.create(),Oa=h.create(),Ja=v.create(),Sa=this._context.renderCoordsHelper.viewingMode===A.ViewingMode.Global;Sa||this._context.renderCoordsHelper.worldUpAtPosition(null,Ja);q.computeTranslationToOriginAndRotation(xa.spatialReference,[Ea.x,Ea.y,0],Oa,this._context.renderCoordsHelper.spatialReference);xa=h.create();g.invert(xa,Oa);Ea=e.create();f.normalFromMat4(Ea,xa);const {polygons:Ua,mapPositions:Za,position:ma}=wa;var Ya=ma.length/
3;const bb=new Float64Array(18*Ya),Qa=new Float64Array(18*Ya),Aa=new Float64Array(18*Ya);Ya=new Float64Array(6*Ya);let Ca=0;for(let Xa=0;Xa<Ua.length;++Xa){var qa=Ua[Xa],ya=qa.count;if(this._context.clippingExtent&&(k.empty(Na),k.expandWithBuffer(Na,qa.mapPositions),!k.intersectsClippingArea(Na,this._context.clippingExtent)))continue;const db=d.earcut(qa.mapPositions,qa.holeIndices,3);if(0===db.length)continue;const fb=Array(6*ya+db.length),jb=Array(db.length);var Da=6*ya,La=3*bb.BYTES_PER_ELEMENT;
La=new p.BufferViewVec3f64(bb.buffer,Ca*La,La,(Ca+Da)*La);var Ta=3*Qa.BYTES_PER_ELEMENT;Ta=new p.BufferViewVec3f64(Qa.buffer,Ca*Ta,Ta,(Ca+Da)*Ta);const lb=new Float64Array(Aa.buffer,3*Ca*Aa.BYTES_PER_ELEMENT,3*Da);Da=new Float64Array(Ya.buffer,1*Ca*Ya.BYTES_PER_ELEMENT,1*Da);const ob=this._getExtrusionSize(za);V(ma,Za,db,qa,La.typedBuffer,lb,Ta.typedBuffer,Da,fb,jb,ob,Ja,Sa);z.transformMat4(La,La,xa);z.transformMat3(Ta,Ta,Ea);Ca+=6*ya;qa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:oa,
layerUid:this._context.layer.uid});ya=new la(La.typedBuffer,lb,Ta.typedBuffer,Da);Ia.push(Q(this._material,fb,fb.length-jb.length,ya,sa,qa));Ia.push(Q(this._bottomMaterial,jb,0,ya,sa,qa))}if(0===Ia.length)return null;za=new O.Object3D({geometries:Ia,metadata:{layerUid:this._context.layer.uid,graphicUid:oa,isElevationSource:!0}});za.transformation=Oa;sa=K.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});sa=r.isSome(sa)?{baseMaterial:this._material,edgeMaterials:[sa],properties:{mergeGeometries:!0,
hasSlicePlane:this._context.slicePlaneEnabled}}:null;Ia=new y.Graphics3DObject3DGraphicLayer(this,za,Ia,null,null,W,ua,sa);Ia.alignedSampledElevation=wa.sampledElevation;Ia.needsElevationUpdates=x.needsElevationUpdates3D(ua.mode);return Ia};return pa}(w.Graphics3DSymbolLayer);const U=v.create(),Y=v.create(),ba=v.create(),da=v.create(),ea=v.create(),ca=v.create(),ja=v.create(),ia=v.create(),Z=v.create(),ha=new x.SampleElevationInfo,fa=[0,2,1],ka=[0,1,2];let la=function(na,pa,va,wa){this.positions=
na;this.elevation=pa;this.normals=va;this.heights=wa};a.Graphics3DExtrudeSymbolLayer=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/earcut":function(){define(["exports"],function(a){var c={};(function(b){(function(t){t=t();void 0!==t&&(b.exports=t)})(function(){function t(w,D,F){F=F||2;var E=D&&D.length,K=E?D[0]*F:w.length,J=n(w,0,K,F,!0),M=[];if(!J||J.next===J.prev)return M;var N;if(E){var P=J;var I=F;J=[];var G;E=0;for(G=D.length;E<G;E++){var H=D[E]*I;var L=E<G-1?
D[E+1]*I:w.length;H=n(w,H,L,I,!1);H===H.next&&(H.steiner=!0);L=J;var O=L.push,S=H,R=H;do{if(S.x<R.x||S.x===R.x&&S.y<R.y)R=S;S=S.next}while(S!==H);O.call(L,R)}J.sort(f);for(E=0;E<J.length;E++)I=J[E],D=P,(P=g(I,D))?(G=B(P,I),I=r(P,P.next),G=e(G),r(G,G.next),I=e(I),P=e(D===P?I:D)):P=D,P=r(P,P.next);J=P}if(w.length>80*F){var Q=N=w[0];var V=E=w[1];for(I=F;I<K;I+=F)D=w[I],P=w[I+1],D<Q&&(Q=D),P<V&&(V=P),D>N&&(N=D),P>E&&(E=P);N=Math.max(N-Q,E-V);N=0!==N?1/N:0}m(J,M,F,Q,V,N);return M}function n(w,D,F,E,K){if(K===
0<y(w,D,F,E))for(K=D;K<F;K+=E)var J=A(K,w[K],w[K+1],J);else for(K=F-E;K>=D;K-=E)J=A(K,w[K],w[K+1],J);J&&q(J,J.next)&&(w=J.next,x(J),J=w);return J}function r(w,D){if(!w)return w;D||(D=w);do{var F=!1;if(w.steiner||!q(w,w.next)&&0!==v(w.prev,w,w.next))w=w.next;else{D=w.prev;x(w);w=D;if(w===w.next)break;F=!0}}while(F||w!==D);return D}function m(w,D,F,E,K,J,M){if(w){if(!M&&J){var N=w,P=N;do null===P.z&&(P.z=h(P.x,P.y,E,K,J)),P.prevZ=P.prev,P=P.nextZ=P.next;while(P!==N);P.prevZ.nextZ=null;P.prevZ=null;
N=P;var I,G,H,L,O=1;do{P=N;var S=N=null;for(G=0;P;){G++;var R=P;for(I=H=0;I<O&&(H++,R=R.nextZ,R);I++);for(L=O;0<H||0<L&&R;)0!==H&&(0===L||!R||P.z<=R.z)?(I=P,P=P.nextZ,H--):(I=R,R=R.nextZ,L--),S?S.nextZ=I:N=I,I.prevZ=S,S=I;P=R}S.nextZ=null;O*=2}while(1<G)}for(N=w;w.prev!==w.next;){P=w.prev;R=w.next;if(J)S=d(w,E,K,J);else a:if(S=w,G=S.prev,H=S,O=S.next,0<=v(G,H,O))S=!1;else{for(I=S.next.next;I!==S.prev;){if(l(G.x,G.y,H.x,H.y,O.x,O.y,I.x,I.y)&&0<=v(I.prev,I,I.next)){S=!1;break a}I=I.next}S=!0}if(S)D.push(P.i/
F),D.push(w.i/F),D.push(R.i/F),x(w),N=w=R.next;else if(w=R,w===N){if(!M)m(r(w),D,F,E,K,J,1);else if(1===M){w=r(w);M=D;N=F;P=w;do R=P.prev,S=P.next.next,!q(R,S)&&k(R,P,P.next,S)&&C(R,S)&&C(S,R)&&(M.push(R.i/N),M.push(P.i/N),M.push(S.i/N),x(P),x(P.next),P=w=S),P=P.next;while(P!==w);w=r(P);m(w,D,F,E,K,J,2)}else if(2===M)a:{M=w;do{for(N=M.next.next;N!==M.prev;){if(P=M.i!==N.i){S=S=S=S=void 0;P=M;R=N;if(S=P.next.i!==R.i&&P.prev.i!==R.i){b:{S=P;do{if(S.i!==P.i&&S.next.i!==P.i&&S.i!==R.i&&S.next.i!==R.i&&
k(S,S.next,P,R)){S=!0;break b}S=S.next}while(S!==P);S=!1}S=!S}if(S){if(S=C(P,R)&&C(R,P)){S=P;G=!1;H=(P.x+R.x)/2;O=(P.y+R.y)/2;do S.y>O!==S.next.y>O&&S.next.y!==S.y&&H<(S.next.x-S.x)*(O-S.y)/(S.next.y-S.y)+S.x&&(G=!G),S=S.next;while(S!==P);S=G}S=S&&(v(P.prev,P,R.prev)||v(P,R.prev,R))||q(P,R)&&0<v(P.prev,P,P.next)&&0<v(R.prev,R,R.next)}P=S}if(P){w=B(M,N);M=r(M,M.next);w=r(w,w.next);m(M,D,F,E,K,J);m(w,D,F,E,K,J);break a}N=N.next}M=M.next}while(M!==w)}break}}}}function d(w,D,F,E){var K=w.prev,J=w.next;
if(0<=v(K,w,J))return!1;var M=K.x>w.x?K.x>J.x?K.x:J.x:w.x>J.x?w.x:J.x,N=K.y>w.y?K.y>J.y?K.y:J.y:w.y>J.y?w.y:J.y,P=h(K.x<w.x?K.x<J.x?K.x:J.x:w.x<J.x?w.x:J.x,K.y<w.y?K.y<J.y?K.y:J.y:w.y<J.y?w.y:J.y,D,F,E);D=h(M,N,D,F,E);F=w.prevZ;for(E=w.nextZ;F&&F.z>=P&&E&&E.z<=D;){if(F!==w.prev&&F!==w.next&&l(K.x,K.y,w.x,w.y,J.x,J.y,F.x,F.y)&&0<=v(F.prev,F,F.next))return!1;F=F.prevZ;if(E!==w.prev&&E!==w.next&&l(K.x,K.y,w.x,w.y,J.x,J.y,E.x,E.y)&&0<=v(E.prev,E,E.next))return!1;E=E.nextZ}for(;F&&F.z>=P;){if(F!==w.prev&&
F!==w.next&&l(K.x,K.y,w.x,w.y,J.x,J.y,F.x,F.y)&&0<=v(F.prev,F,F.next))return!1;F=F.prevZ}for(;E&&E.z<=D;){if(E!==w.prev&&E!==w.next&&l(K.x,K.y,w.x,w.y,J.x,J.y,E.x,E.y)&&0<=v(E.prev,E,E.next))return!1;E=E.nextZ}return!0}function f(w,D){return w.x-D.x}function e(w){if(w.next.prev===w)return w;let D=w;do{const F=D.next;if(F.prev===D||F===D||F===w)break;D=F}while(1);return D}function g(w,D){var F=D,E=w.x,K=w.y,J=-Infinity;do{if(K<=F.y&&K>=F.next.y&&F.next.y!==F.y){var M=F.x+(K-F.y)*(F.next.x-F.x)/(F.next.y-
F.y);if(M<=E&&M>J){J=M;if(M===E){if(K===F.y)return F;if(K===F.next.y)return F.next}var N=F.x<F.next.x?F:F.next}}F=F.next}while(F!==D);if(!N)return null;if(E===J)return N;D=N;M=N.x;var P=N.y,I=Infinity;F=N;do{if(E>=F.x&&F.x>=M&&E!==F.x&&l(K<P?E:J,K,M,P,K<P?J:E,K,F.x,F.y)){var G=Math.abs(K-F.y)/(E-F.x);var H;if((H=C(F,w))&&!(H=G<I)&&(H=G===I)&&!(H=F.x>N.x)&&(H=F.x===N.x)){H=N;var L=F;H=0>v(H.prev,H,L.prev)&&0>v(L.next,H,H.next)}H&&(N=F,I=G)}F=F.next}while(F!==D);return N}function h(w,D,F,E,K){w=32767*
(w-F)*K;D=32767*(D-E)*K;w=(w|w<<8)&16711935;w=(w|w<<4)&252645135;w=(w|w<<2)&858993459;D=(D|D<<8)&16711935;D=(D|D<<4)&252645135;D=(D|D<<2)&858993459;return(w|w<<1)&1431655765|((D|D<<1)&1431655765)<<1}function l(w,D,F,E,K,J,M,N){return 0<=(K-M)*(D-N)-(w-M)*(J-N)&&0<=(w-M)*(E-N)-(F-M)*(D-N)&&0<=(F-M)*(J-N)-(K-M)*(E-N)}function v(w,D,F){return(D.y-w.y)*(F.x-D.x)-(D.x-w.x)*(F.y-D.y)}function q(w,D){return w.x===D.x&&w.y===D.y}function k(w,D,F,E){var K=z(v(w,D,F)),J=z(v(w,D,E)),M=z(v(F,E,w)),N=z(v(F,E,
D));return K!==J&&M!==N||0===K&&p(w,F,D)||0===J&&p(w,E,D)||0===M&&p(F,w,E)||0===N&&p(F,D,E)?!0:!1}function p(w,D,F){return D.x<=Math.max(w.x,F.x)&&D.x>=Math.min(w.x,F.x)&&D.y<=Math.max(w.y,F.y)&&D.y>=Math.min(w.y,F.y)}function z(w){return 0<w?1:0>w?-1:0}function C(w,D){return 0>v(w.prev,w,w.next)?0<=v(w,D,w.next)&&0<=v(w,w.prev,D):0>v(w,D,w.prev)||0>v(w,w.next,D)}function B(w,D){var F=new u(w.i,w.x,w.y),E=new u(D.i,D.x,D.y),K=w.next,J=D.prev;w.next=D;D.prev=w;F.next=K;K.prev=F;E.next=F;F.prev=E;J.next=
E;E.prev=J;return E}function A(w,D,F,E){w=new u(w,D,F);E?(w.next=E.next,w.prev=E,E.next.prev=w,E.next=w):(w.prev=w,w.next=w);return w}function x(w){w.next.prev=w.prev;w.prev.next=w.next;w.prevZ&&(w.prevZ.nextZ=w.nextZ);w.nextZ&&(w.nextZ.prevZ=w.prevZ)}function u(w,D,F){this.i=w;this.x=D;this.y=F;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function y(w,D,F,E){for(var K=0,J=F-E;D<F;D+=E)K+=(w[J]-w[D])*(w[D+1]+w[J+1]),J=D;return K}t.deviation=function(w,D,F,E){var K=D&&D.length,
J=Math.abs(y(w,0,K?D[0]*F:w.length,F));if(K){K=0;for(var M=D.length;K<M;K++)J-=Math.abs(y(w,D[K]*F,K<M-1?D[K+1]*F:w.length,F))}for(K=D=0;K<E.length;K+=3){M=E[K]*F;var N=E[K+1]*F,P=E[K+2]*F;D+=Math.abs((w[M]-w[P])*(w[N+1]-w[M+1])-(w[M]-w[N])*(w[P+1]-w[M+1]))}return 0===J&&0===D?0:Math.abs((D-J)/J)};t.flatten=function(w){for(var D=w[0][0].length,F={vertices:[],holes:[],dimensions:D},E=0,K=0;K<w.length;K++){for(var J=0;J<w[K].length;J++)for(var M=0;M<D;M++)F.vertices.push(w[K][J][M]);0<K&&(E+=w[K-1].length,
F.holes.push(E))}return F};return t})})({get exports(){return c},set exports(b){c=b}});a.earcut=c})},"esri/chunks/vec32":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,c){function b(f,e,g){if(f.count!==e.count)c.mathLogger.error("source and destination buffers need to have the same number of elements");else{var h=f.count,l=g[0],v=g[1],q=g[2],k=g[4],p=g[5],z=g[6],C=g[8],B=g[9],A=g[10],x=g[12],u=g[13];g=g[14];var y=f.typedBuffer;f=f.typedBufferStride;var w=e.typedBuffer;
e=e.typedBufferStride;for(let F=0;F<h;F++){const E=F*f;var D=F*e;const K=w[D],J=w[D+1];D=w[D+2];y[E]=l*K+k*J+C*D+x;y[E+1]=v*K+p*J+B*D+u;y[E+2]=q*K+z*J+A*D+g}}}function t(f,e,g){if(f.count!==e.count)c.mathLogger.error("source and destination buffers need to have the same number of elements");else{var h=f.count,l=g[0],v=g[1],q=g[2],k=g[3],p=g[4],z=g[5],C=g[6],B=g[7];g=g[8];var A=f.typedBuffer;f=f.typedBufferStride;var x=e.typedBuffer;e=e.typedBufferStride;for(let y=0;y<h;y++){const w=y*f;var u=y*e;
const D=x[u],F=x[u+1];u=x[u+2];A[w]=l*D+k*F+C*u;A[w+1]=v*D+p*F+B*u;A[w+2]=q*D+z*F+g*u}}}function n(f,e,g){const h=Math.min(f.count,e.count),l=f.typedBuffer;f=f.typedBufferStride;const v=e.typedBuffer;e=e.typedBufferStride;for(let q=0;q<h;q++){const k=q*f,p=q*e;l[k]=g*v[p];l[k+1]=g*v[p+1];l[k+2]=g*v[p+2]}}function r(f,e){const g=Math.min(f.count,e.count),h=f.typedBuffer;f=f.typedBufferStride;const l=e.typedBuffer;e=e.typedBufferStride;for(let k=0;k<g;k++){const p=k*f;var v=k*e;const z=l[v],C=l[v+1];
v=l[v+2];var q=z*z+C*C+v*v;0<q&&(q=1/Math.sqrt(q),h[p]=q*z,h[p+1]=q*C,h[p+2]=q*v)}}function m(f,e,g){const h=Math.min(f.count,e.count),l=f.typedBuffer;f=f.typedBufferStride;const v=e.typedBuffer;e=e.typedBufferStride;for(let q=0;q<h;q++){const k=q*f,p=q*e;l[k]=v[p]>>g;l[k+1]=v[p+1]>>g;l[k+2]=v[p+2]>>g}}const d=Object.freeze(Object.defineProperty({__proto__:null,normalize:r,scale:n,shiftRight:m,transformMat3:t,transformMat4:b},Symbol.toStringTag,{value:"Module"}));a.normalize=r;a.scale=n;a.shiftRight=
m;a.transformMat3=t;a.transformMat4=b;a.vec3=d})},"esri/geometry/support/buffer/math/common":function(){define(["exports","../../../../core/Logger"],function(a,c){c=c.getLogger("esri.views.3d.support.buffer.math");a.mathLogger=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/SnappingCandidate":function(){define(["exports"],function(a){a.makeEdgeCandidate=function(c,b,t,n,r,m=!1){return{objectId:c,target:b,distance:t,type:"edge",start:n,end:r,draped:m}};
a.makeVertexCandidate=function(c,b,t){return{objectId:c,target:b,distance:t,type:"vertex"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../core/maybe","../visualVariables/support/visualVariableUtils"],function(a,c,b,t,n){function r(e,g){if(!e||e.symbol)return null;g=g&&g.renderer;return e&&t.isSome(g)&&g.getObservationRenderer?g.getObservationRenderer(e):
g}function m(e,g){return d.apply(this,arguments)}function d(){d=c._asyncToGenerator(function*(e,g){if(t.isSome(e.symbol))return e.symbol;const h=r(e,g);return t.isSome(h)?h.getSymbolAsync(e,g):null});return d.apply(this,arguments)}function f(){f=c._asyncToGenerator(function*(e,g){var h=r(e,g),l=yield m(e,g);if(!l)return null;l={renderer:h,symbol:l};if(!(h&&"visualVariables"in h&&h.visualVariables))return l;g=n.getVisualVariableValues(h,e,g)??[];e=["proportional","proportional","proportional"];for(const {variable:v,
value:q}of g)"color"===v.type?l.color=b.toUnitRGBA(q):"size"===v.type?"outline"===v.target?l.outlineSize=q:(g=v.axis,h=v.useSymbolValue?"symbol-value":q,"width"===g?e[0]=h:"depth"===g?e[1]=h:"height"===g?e[2]=h:e[0]="width-and-depth"===g?e[1]=h:e[1]=e[2]=h):"opacity"===v.type?l.opacity=q:"rotation"===v.type&&"tilt"===v.axis?l.tilt=q:"rotation"===v.type&&"roll"===v.axis?l.roll=q:"rotation"===v.type&&(l.heading=q);if(isFinite(e[0])||isFinite(e[1])||isFinite(e[2]))l.size=e;return l});return f.apply(this,
arguments)}a.getDriverAxisSizeValue=function(e,g=0){e=e[g];return"number"===typeof e&&isFinite(e)?e:null};a.getDriverAxisSizeValueAny=function(e){for(let g=0;3>g;g++){const h=e[g];if("number"===typeof h)return isFinite(h)?h:0}return 0};a.getRenderer=r;a.getRenderingInfo=function(e,g){const h=r(e,g);if(t.isSome(e.symbol))var l=e.symbol;else l=r(e,g),l=t.isSome(l)&&"dot-density"!==l.type?l.getSymbol(e,g):null;if(t.isNone(l))return null;l={renderer:h,symbol:l};if(t.isNone(h)||!("visualVariables"in h)||
!h.visualVariables)return l;g=n.getVisualVariableValues(h,e,g)??[];e=["proportional","proportional","proportional"];for(const {variable:v,value:q}of g)switch(v.type){case "color":l.color=q.toRgba();break;case "size":if("outline"===v.target)l.outlineSize=q;else switch(g=v.useSymbolValue?"symbol-value":q,v.axis){case "width":e[0]=g;break;case "depth":e[1]=g;break;case "height":e[2]=g;break;case "width-and-depth":e[0]=e[1]=g;break;default:e[0]=e[1]=e[2]=g}break;case "opacity":l.opacity=q;break;case "rotation":switch(v.axis){case "tilt":l.tilt=
q;break;case "roll":l.roll=q;break;default:l.heading=q}}if("proportional"!==e[0]||"proportional"!==e[1]||"proportional"!==e[2])l.size=e;return l};a.getRenderingInfoAsync=function(e,g){return f.apply(this,arguments)};a.getSymbolAsync=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/maybe ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,c,b,t,n,r,m,d,f){a.PolygonCreationDataBase=function(e,g,h){this.renderData=e;this.layerUid=g;this.graphicUid=h;this.outGeometries=[]};a.createColorGeometry=function(e){const g=[[m.VertexAttribute.POSITION,e.indices]],h=[[m.VertexAttribute.POSITION,new t.Attribute(e.attributeData.position,3,!0)]];b.isSome(e.attributeData.color)&&(h.push([m.VertexAttribute.COLOR,new t.Attribute(e.attributeData.color,4,!0)]),g.push([m.VertexAttribute.COLOR,Array(e.indices.length).fill(0)]));b.isSome(e.attributeData.uvMapSpace)&&
(h.push([m.VertexAttribute.UVMAPSPACE,new t.Attribute(e.attributeData.uvMapSpace,4,!0)]),g.push([m.VertexAttribute.UVMAPSPACE,e.indices]));b.isSome(e.attributeData.boundingRect)&&(h.push([m.VertexAttribute.BOUNDINGRECT,new t.Attribute(e.attributeData.boundingRect,9,!0)]),g.push([m.VertexAttribute.BOUNDINGRECT,e.indices]));return new r.Geometry(e.material,h,g,e.mapPositions,n.ContentObjectType.Mesh,e.attributeData.objectAndLayerIdColor)};a.createWaterGeometry=function(e){const g=[[m.VertexAttribute.POSITION,
e.indices],[m.VertexAttribute.UV0,e.indices]],h=[[m.VertexAttribute.POSITION,new t.Attribute(e.attributeData.position,3,!0)],[m.VertexAttribute.UV0,new t.Attribute(e.attributeData.uv0,2,!0)]];return new r.Geometry(e.material,h,g,e.mapPositions)};a.geometryAsPolygon=function(e){switch(e.type){case "extent":if(e instanceof d)return f.fromExtent(e);break;case "polygon":return e}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/renderInfoUtils/polygon":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/DoubleArray".split(" "),
function(a,c,b,t,n,r,m,d){function f(k,p,z=null){return k.filter(({count:C})=>1<C).map(({index:C,count:B})=>{const A=3*C,x=3*B;return b.isSome(z)?new h(C,B,d.doubleSubArray(p,A,x),d.doubleSubArray(z,A,x)):new g(C,B,d.doubleSubArray(p,A,x))})}function e(k,p,z=null){const C=(b.isSome(z),[]);for(const {index:B,count:A,holeIndices:x,pathLengths:u}of k){if(1>=A)continue;k=3*B;const y=3*A,w=x.map(D=>D-B);k=b.isSome(z)?new l(B,A,d.doubleSubArray(p,3*B,3*A),d.doubleSubArray(z,k,y),w,u):new v(B,A,d.doubleSubArray(p,
3*B,3*A),w,u);C.push(k)}return C}let g=function(k,p,z){this.index=k;this.count=p;this.position=z},h=function(k){function p(z,C,B,A){z=k.call(this,z,C,B)||this;z.mapPositions=A;return z}c._inheritsLoose(p,k);return p}(g),l=function(k){function p(z,C,B,A,x,u){z=k.call(this,z,C,B,A)||this;z.holeIndices=x;z.pathLengths=u;return z}c._inheritsLoose(p,k);return p}(h),v=function(k){function p(z,C,B,A,x){z=k.call(this,z,C,B)||this;z.holeIndices=A;z.pathLengths=x;return z}c._inheritsLoose(p,k);return p}(g),
q=function(k,p,z,C,B,A){this.position=k;this.mapPositions=p;this.polygons=z;this.outlines=C;this.projectionSuccess=B;this.sampledElevation=A};a.PolygonRenderInfo=q;a.PolygonVertexData=l;a.PolygonVertexDataDraped=v;a.geometryToRenderInfo=function(k,p,z,C){const B=n.pathsToTriangulationInfo(k.rings,!!k.hasZ,n.CounterClockwiseMode.CCW_IS_HOLE),A=d.newDoubleArray(B.position.length);k=r.applyPerVertexElevationAlignment(B.position,k.spatialReference,0,A,0,B.position,0,B.position.length/3,p,z,C);p=null!=
k;return new q(B.position,A,e(B.polygons,B.position,A),f(B.outlines,B.position,A),p,k)};a.geometryToRenderInfoDraped=function(k,p){const z=n.pathsToTriangulationInfo(k.rings,!1,n.CounterClockwiseMode.CCW_IS_HOLE);k=t.projectBuffer(z.position,k.spatialReference,0,z.position,p,0,z.position.length/3);for(p=2;p<z.position.length;p+=3)z.position[p]=m.DRAPED_Z;return{position:z.position,polygons:e(z.polygons,z.position),outlines:f(z.outlines,z.position),projectionSuccess:k}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/geometry/support/triangulationUtils":function(){define(["exports","../../chunks/earcut","./coordsUtils","./meshUtils/deduplicate","../../views/3d/webgl-engine/lib/DoubleArray"],function(a,c,b,t,n){function r(f,e,g){if(1===f.length)return f[0];e=n.newDoubleArray(e);g=new Uint32Array(g);let h=0,l=0,v=0;for(const q of f){for(f=0;f<q.position.length;f++)e[h++]=q.position[f];for(f=0;f<q.faces.length;f++)g[l++]=q.faces[f]+v;v=h/3}return{position:e,faces:g}}function m(f,e,g){const h=
f.length,l=Array(h),v=Array(h),q=Array(h);let k=0,p=0,z=0;var C=0;for(var B=0;B<h;++B)C+=f[B].length;C=n.newDoubleArray(3*C);B=0;for(let y=h-1;0<=y;y--){var A=f[y],x=g===a.CounterClockwiseMode.CCW_IS_HOLE?!b.isClockwise(A,!1,!1):!1;if(x&&1!==h)l[k++]=A;else{var u=A.length;for(let w=0;w<k;++w)u+=l[w].length;u={index:B,pathLengths:Array(k+1),count:u,holeIndices:Array(k)};u.pathLengths[0]=A.length;0<A.length&&(q[z++]={index:B,count:A.length});B=x?d(A,A.length-1,-1,C,B,A.length,e):d(A,0,1,C,B,A.length,
e);for(A=0;A<k;++A)x=l[A],u.holeIndices[A]=B,u.pathLengths[A+1]=x.length,0<x.length&&(q[z++]={index:B,count:x.length}),B=d(x,0,1,C,B,x.length,e);k=0;0<u.count&&(v[p++]=u)}}for(f=0;f<k;++f)g=l[f],0<g.length&&(q[z++]={index:B,count:g.length}),B=d(g,0,1,C,B,g.length,e);v.length=p;q.length=z;return{position:C,polygons:v,outlines:q}}function d(f,e,g,h,l,v,q){l*=3;for(let k=0;k<v;++k){const p=f[e];h[l++]=p[0];h[l++]=p[1];h[l++]=q?p[2]:0;e+=g}return l/3}a.CounterClockwiseMode=void 0;(function(f){f[f.NONE=
0]="NONE";f[f.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode={}));a.pathsToTriangulationInfo=m;a.triangulate=function(f){f=m(f.rings,f.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE);const e=[];let g=0,h=0;for(var l of f.polygons){const q=l.index,k=n.doubleSubArray(f.position,3*q,3*l.count);var v=l.holeIndices.map(p=>p-q);v=new Uint32Array(c.earcut(k,v,3));e.push({position:k,faces:v});g+=k.length;h+=v.length}l=r(e,g,h);f=Array.isArray(l.position)?t.deduplicate(l.position,
3,{originalIndices:l.faces}):t.deduplicate(l.position.buffer,6,{originalIndices:l.faces});l.position=new Float64Array(f.buffer);l.faces=f.indices;return l};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports","../../../core/mathUtils","../../../views/3d/webgl-engine/lib/Indices"],function(a,c,b){let t=null;a.deduplicate=function(n,r,m){var d=Array.isArray(n),f=d?n.length/r:n.byteLength/(4*r),e=d?n:new Uint32Array(n,
0,f*r),g=m?.minReduction??0;const h=(n=m?.originalIndices||null)?n.length:0;var l=m?.componentOffsets||null;m=0;if(l)for(var v=0;v<l.length-1;v++){var q=l[v+1]-l[v];q>m&&(m=q)}else m=f;var k=Math.floor(1.1*m)+1;if(null==t||t.length<2*k)t=new Uint32Array(c.nextHighestPowerOfTwo(2*k));for(m=0;m<2*k;m++)t[m]=0;m=0;const p=(q=!!l&&!!n)?h:f;v=b.newIndexArray(f/3);var z=new Uint32Array(h),C=0!==g?Math.ceil(7.84*1.96/(g*g)*g*(1-g)):p,B=1,A=l?l[1]:p;for(let D=0;D<p;D++){if(D===C){var x=1-m/D;if(x+1.96*Math.sqrt(x*
(1-x)/D)<g)return null;C*=2}if(D===A){for(A=0;A<2*k;A++)t[A]=0;if(n)for(A=l[B-1];A<l[B];A++)z[A]=v[n[A]];A=l[++B]}x=q?n[D]:D;const F=x*r;var u=0;for(var y=0;y<r;y++)u=e[F+y]+u|0,u=u+(u<<11)+(u>>>2)|0;u>>>=0;y=u%k;let E=m;for(;0!==t[2*y+1];){if(t[2*y]===u){const K=t[2*y+1]-1;var w=K*r;a:{for(let J=0;J<r;J++)if(e[F+J]!==e[w+J]){w=!1;break a}w=!0}if(w){E=v[K];break}}y++;y>=k&&(y-=k)}E===m&&(t[2*y]=u,t[2*y+1]=x+1,m++);v[x]=E}if(0!==g&&1-m/f<g)return null;if(q){for(f=l[B-1];f<z.length;f++)z[f]=v[n[f]];
v=b.compactIndices(z)}d=d?Array(m):new Uint32Array(m*r);m=0;for(C=0;C<p;C++)if(v[C]===m){f=e;g=(q?n[C]:C)*r;l=d;k=m*r;z=r;for(B=0;B<z;B++)l[k+B]=f[g+B];m++}if(n&&!q){r=new Uint32Array(h);for(e=0;e<r.length;e++)r[e]=v[n[e]];v=b.compactIndices(r)}return{buffer:Array.isArray(d)?d:d.buffer,indices:v,uniqueCount:m}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayFramebufferObject ./OverlayRenderTarget ../webgl-engine/core/shaderLibrary/ShaderOutput ../../../chunks/TextureOnly.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/SSAOHelper ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lib/TransparencyPassType ../webgl-engine/lib/UpdatePolicy ../webgl-engine/lighting/Lightsources ../webgl-engine/materials/StippleTextureRepository ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V,aa,X,W,T,U,Y){a.OverlayRenderer=function(ca){function ja(Z){Z=ca.call(this,Z)||this;Z._overlays=null;Z._overlayRenderTarget=null;Z._hasHighlights=!1;Z._rendersOccluded=!1;Z._hasWater=!1;Z._handles=new r;Z._renderers=new Map;Z._sortedDrapeSourceRenderersDirty=!1;Z._sortedRenderers=new f;Z._passParameters=new F.TextureOnlyPassParameters;Z._rctx=null;Z._materialRepository=null;Z._screenToWorldRatio=1;Z._localOriginFactory=
null;Z._camera=new K.Camera;Z.worldToPCSRatio=1;Z.events=new n;Z.longitudeCyclical=null;return Z}c._inheritsLoose(ja,ca);var ia=ja.prototype;ia.initialize=function(){const Z=this.view._stage.renderView;this._rctx=Z.renderingContext;const ha=Z.waterTextureRepository;this._stippleTextureRepository=new X.StippleTextureRepository(Z.renderingContext);this._shaderTechniqueRepository=new E.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:C.ViewingMode.Local,stippleTextureRepository:this._stippleTextureRepository,
waterTextureRepository:ha});this._renderContext=new I.OverlayRenderContext(this._rctx,new H.ShadowMap(this._rctx,this.view.state.viewingMode),new O.SSAOHelper(this.view,this._shaderTechniqueRepository,this._rctx,()=>{}));this._handles.add([e.watch(()=>ha.updating,()=>this.events.emit("content-changed"),e.syncAndInitial),e.watch(()=>this.spatialReference,fa=>this._localOriginFactory=new N.GridLocalOriginFactory(fa),e.syncAndInitial),e.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=
!0)]);this._materialRepository=new J.GLMaterialRepository(Z.textureRepository,this._shaderTechniqueRepository,fa=>{0<(fa.renderOccluded&ea)!==this._rendersOccluded&&this._updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating");this.notifyChange("isEmpty")},()=>this.events.emit("content-changed"));this._bindParameters.slot=G.RenderSlot.DRAPED_MATERIAL;this._bindParameters.highlightDepthTexture=M.createEmptyDepthTexture(this._rctx);this._camera.near=1;this._camera.far=
1E4;this._camera.relativeElevation=null;this._bindParameters.camera=this._camera;this._bindParameters.transparencyPassType=Q.TransparencyPassType.NONE;this._bindParameters.newLighting.noonFactor=0;this._bindParameters.newLighting.globalFactor=0;this._bindParameters.newLighting.set([new aa.AmbientLight(z.fromValues(1,1,1))]);this._handles.add(this.view.resourceController.scheduler.registerTask(W.TaskPriority.STAGE,this))};ia.destroy=function(){this._handles.destroy();this._renderers.forEach(Z=>Z.destroy());
this._renderers.clear();this._debugTextureTechnique=d.releaseMaybe(this._debugTextureTechnique);this._passParameters.texture=d.disposeMaybe(this._passParameters.texture);this._bindParameters.highlightDepthTexture=d.disposeMaybe(this._bindParameters.highlightDepthTexture);this._shaderTechniqueRepository=d.destroyMaybe(this._shaderTechniqueRepository);this._temporaryFBO=d.disposeMaybe(this._temporaryFBO);this._quadVAO=d.disposeMaybe(this._quadVAO);this.disposeOverlays()};ia.createGeometryDrapeSourceRenderer=
function(Z){return this.createDrapeSourceRenderer(Z,L.SortedRenderGeometryRenderer)};ia.createDrapeSourceRenderer=function(Z,ha,fa){const ka=this._renderers.get(Z);d.isSome(ka)&&ka.destroy();ha=new ha({...fa,rendererContext:this,drapeSource:Z});this._renderers.set(Z,ha);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in Z&&this._handles.add(e.watch(()=>Z.fullOpacity,()=>this.events.emit("content-changed")),Z);return ha};ia.removeDrapeSourceRenderer=function(Z){if(!d.isNone(Z)){var ha=this._renderers.get(Z);
d.isNone(ha)||(this._sortedDrapeSourceRenderersDirty=!0,this._renderers.delete(Z),this._handles.remove(Z),ha.destroy())}};ia.collectUnusedRenderTargetMemory=function(Z){let ha=!1;if(d.isSome(this._overlayRenderTarget))for(const fa of this._overlayRenderTarget.renderTargets){const [ka,la]=this.overlays;ha=this._overlayRenderTarget.validateUsageForTarget(ka.validTargets[fa.type]||!la.validTargets[fa.type],fa,Z)||ha}return ha};ia.ensureDrapeTargets=function(Z){d.isSome(this._overlays)&&this._overlays.forEach(ha=>
ha.hasTargetWithoutRasterImage=g.someSet(Z,fa=>fa.drapeTargetType===B.DrapeTargetType.WithoutRasterImage))};ia.ensureDrapeSources=function(Z){d.isSome(this._overlays)&&this._overlays.forEach(ha=>{ha.hasDrapedFeatureSource=g.someSet(Z,fa=>fa.drapeSourceType===B.DrapeSourceType.Features);ha.hasDrapedRasterSource=g.someSet(Z,fa=>fa.drapeSourceType===B.DrapeSourceType.RasterImage)})};ia.ensureOverlays=function(Z,ha){d.isNone(this._overlays)&&(this._overlayRenderTarget=new w.OverlayRenderTarget(this._rctx),
this._overlays=[new u.Overlay(x.OverlayIndex.INNER,this._overlayRenderTarget),new u.Overlay(x.OverlayIndex.OUTER,this._overlayRenderTarget)]);this.ensureDrapeTargets(Z);this.ensureDrapeSources(ha)};ia.disposeOverlays=function(){this._overlays=null;this._overlayRenderTarget=d.disposeMaybe(this._overlayRenderTarget);this.events.emit("textures-disposed")};ia.runTask=function(Z){this._processDrapeSources(Z,()=>!0)};ia._processDrapeSources=function(Z,ha){let fa=!1;for(const [ka,la]of this._renderers){if(Z.done)break;
(ka.destroyed||ha(ka))&&la.commitChanges()&&(fa=!0,Z.madeProgress())}this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,fa=!0,this._updateSortedDrapeSourceRenderers());fa&&(d.isSome(this._overlays)&&0===this._renderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.notifyChange("isEmpty"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())};ia.processSyncDrapeSources=function(){this._processDrapeSources(W.noBudget,
Z=>Z.updatePolicy===V.UpdatePolicy.SYNC)};ia.updateAnimation=function(Z){let ha=!1;this._renderers.forEach(fa=>ha=fa.updateAnimation(Z)||ha);return ha};ia.updateDrapeSourceOrder=function(){this._sortedDrapeSourceRenderersDirty=!0};ia.drawTarget=function(Z,ha,fa){const ka=Z.canvasGeometries;if(0===ka.numViews)return!1;this._screenToWorldRatio=fa*Z.mapUnitsPerPixel;const la=ha.output;if(this.isEmpty||la===D.ShaderOutput.Highlight&&!this.hasHighlights||la===D.ShaderOutput.Normal&&!this.hasWater||!Z.hasSomeSizedView())return!1;
const na=ha.fbo;if(!na.isValid())return!1;const pa=2*Z.resolution,va=Z.resolution;na.resize(pa,va);const wa=this._rctx;this._camera.pixelRatio=Z.pixelRatio*fa;this._renderContext.output=la;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=la===D.ShaderOutput.Normal?G.RenderSlot.DRAPED_WATER:G.RenderSlot.DRAPED_MATERIAL;Z.applyViewport(this._rctx);na.bind(wa);Z.index===x.OverlayIndex.INNER&&
(wa.setClearColor(0,0,0,0),wa.clearSafe(T.ClearBufferBit.COLOR_BUFFER_BIT));ha.type===x.RenderTargetType.Occluded&&(this._renderContext.renderOccludedMask=ea);if(A.OVERLAY_DRAW_DEBUG_TEXTURE&&ha.type!==x.RenderTargetType.Occluded)for(fa=0;fa<ka.numViews;fa++)this._setViewParameters(ka.extents[fa],Z),this._drawDebugTexture(Z.resolution,da[Z.index]);0<this._renderers.size&&this._sortedRenderers.forAll(({drapeSource:za,renderer:sa})=>{if(ha.type!==x.RenderTargetType.ColorNoRasterImage||za.drapeSourceType!==
B.DrapeSourceType.RasterImage){({fullOpacity:za}=za);var ua=d.isSome(za)&&1>za&&la===D.ShaderOutput.Color;ua&&(this.bindTemporaryFramebuffer(this._rctx,pa,va),wa.clearSafe(T.ClearBufferBit.COLOR_BUFFER_BIT));for(let oa=0;oa<ka.numViews;oa++)this._setViewParameters(ka.extents[oa],Z),sa.render(this._renderContext);ua&&d.isSome(this._temporaryFBO)&&(na.bind(wa),this.view._stage.renderView.compositingHelper.compositeOverlay(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),za,Z.index))}});
wa.bindFramebuffer(null);na.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};ia.bindTemporaryFramebuffer=function(Z,ha,fa){d.isNone(this._temporaryFBO)&&(this._temporaryFBO=new y.OverlayFramebufferObject(Z,!1));this._temporaryFBO.resize(ha,fa);this._temporaryFBO.bind(Z)};ia.reloadShaders=function(){var Z=c._asyncToGenerator(function*(){yield this._shaderTechniqueRepository.reloadAll()});return function(){return Z.apply(this,arguments)}}();ia.notifyContentChanged=function(){this.events.emit("content-changed")};
ia.intersect=function(Z,ha,fa,ka){let la=0;for(const na of this._renderers.values())la=na.intersect?.(Z,ha,fa,ka,la)??la};ia._updateSortedDrapeSourceRenderers=function(){this._sortedRenderers.clear();if(0!==this._renderers.size){var Z=this.view.map.allLayers;this._renderers.forEach((ha,fa)=>{const ka=Z.indexOf(fa.layer),la=0<=ka;this._sortedRenderers.push(new ba(fa,ha,this._renderers.size*(fa.renderGroup??(la?B.DrapedRenderGroup.MapLayer:B.DrapedRenderGroup.ViewLayer))+(la?ka:0)))});this._sortedRenderers.sort((ha,
fa)=>ha.index-fa.index)}};ia._setViewParameters=function(Z,ha){const fa=this._camera;fa.viewport=[0,0,ha.resolution,ha.resolution];k.ortho(fa.projectionMatrix,0,Z[2]-Z[0],0,Z[3]-Z[1],fa.near,fa.far);k.fromTranslation(fa.viewMatrix,[-Z[0],-Z[1],0])};ia._updateHasWater=function(){const Z=m.someMap(this._renderers,ha=>ha.hasWater);Z!==this._hasWater&&(this._hasWater=Z,this.events.emit("has-water",Z))};ia._updateHasHighlights=function(){const Z=m.someMap(this._renderers,ha=>ha.hasHighlights);Z!==this._hasHighlights&&
(this._hasHighlights=Z,this.events.emit("has-highlights",Z))};ia._updateRendersOccluded=function(){const Z=m.someMap(this._renderers,ha=>ha.rendersOccluded);Z!==this._rendersOccluded&&(this._rendersOccluded=Z,this.events.emit("renders-occluded",Z))};ia._drawDebugTexture=function(Z,ha){this._ensureDebugPatternResources(Z,Z,ha);Z=this._rctx;Z.bindTechnique(this._debugTextureTechnique,this._passParameters,null);Z.bindVAO(this._quadVAO);Z.drawArrays(T.PrimitiveType.TRIANGLE_STRIP,0,Y.vertexCount(this._quadVAO,
"geometry"))};ia._ensureDebugPatternResources=function(Z,ha,fa){p.set(this._passParameters.color,fa[0],fa[1],fa[2]);if(!this._passParameters.texture){fa=new Uint8Array(Z*ha*4);var ka=0;for(let la=0;la<ha;la++)for(let na=0;na<Z;na++){const pa=Math.floor(na/10),va=Math.floor(la/10);2>pa||2>va||10*pa>Z-20||10*va>ha-20?(fa[ka++]=255,fa[ka++]=255,fa[ka++]=255,fa[ka++]=255):(fa[ka++]=255,fa[ka++]=255,fa[ka++]=255,pa&1&&va&1?fa[ka++]=na&1^la&1?0:255:fa[ka++]=pa&1^va&1?0:128)}this._passParameters.texture=
new U.Texture(this._rctx,{target:T.TextureType.TEXTURE_2D,pixelFormat:T.PixelFormat.RGBA,dataType:T.PixelType.UNSIGNED_BYTE,samplingMode:T.TextureSamplingMode.NEAREST,width:Z,height:ha},fa);Z=new R.TextureTechniqueConfiguration;Z.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(S.TextureTechnique,Z);this._quadVAO=M.createQuadVAO(this._rctx)}};c._createClass(ja,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},{key:"rctx",get:function(){return this._rctx}},
{key:"materialRepository",get:function(){return this._materialRepository}},{key:"screenToWorldRatio",get:function(){return this._screenToWorldRatio}},{key:"localOriginFactory",get:function(){return this._localOriginFactory}},{key:"updating",get:function(){return this._sortedDrapeSourceRenderersDirty||m.someMap(this._renderers,Z=>Z.updating)}},{key:"hasOverlays",get:function(){return d.isSome(this._overlays)&&d.isSome(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return d.isSome(this._overlayRenderTarget)?
this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"overlays",get:function(){return d.unwrapOr(this._overlays,[])}},{key:"running",get:function(){return this.updating}},{key:"isEmpty",get:function(){return A.OVERLAY_DRAW_DEBUG_TEXTURE?!1:!m.someMap(this._renderers,Z=>!Z.isEmpty)}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},{key:"test",get:function(){return{drapedRenderers:Array.from(this._renderers.values()),
getDrapeSourceRenderer:Z=>this._renderers.get(Z)}}}]);return ja}(t);b.__decorate([h.property()],a.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);b.__decorate([h.property({autoDestroy:!0})],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);b.__decorate([h.property({autoDestroy:!0})],a.OverlayRenderer.prototype,"_stippleTextureRepository",void 0);b.__decorate([h.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);b.__decorate([h.property()],
a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);b.__decorate([h.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);b.__decorate([h.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);b.__decorate([h.property()],a.OverlayRenderer.prototype,"isEmpty",null);a.OverlayRenderer=b.__decorate([q.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);let ba=function(ca,ja,ia){this.drapeSource=ca;this.renderer=ja;this.index=ia};const da=[[1,
.5,.5],[.5,.5,1]],ea=P.RenderOccludedFlag.OccludeAndTransparent;a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=ea;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/interfaces":function(){define(["exports"],function(a){a.DrapeSourceType=void 0;(function(c){c[c.RasterImage=0]="RasterImage";c[c.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));a.DrapedRenderGroup=void 0;(function(c){c[c.MapLayer=0]="MapLayer";c[c.ViewLayer=1]="ViewLayer";c[c.Outline=2]=
"Outline";c[c.SnappingHint=3]="SnappingHint"})(a.DrapedRenderGroup||(a.DrapedRenderGroup={}));a.DrapeTargetType=void 0;(function(c){c[c.WithRasterImage=0]="WithRasterImage";c[c.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],function(a){a.OverlayIndex=void 0;(function(c){c[c.INNER=0]="INNER";c[c.OUTER=1]="OUTER"})(a.OverlayIndex||
(a.OverlayIndex={}));a.PatchType=void 0;(function(c){c[c.REGULAR=0]="REGULAR";c[c.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";c[c.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";c[c.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.NeighborIndex=void 0;(function(c){c[c.NORTH=0]="NORTH";c[c.NORTH_EAST=1]="NORTH_EAST";c[c.EAST=2]="EAST";c[c.SOUTH_EAST=3]="SOUTH_EAST";c[c.SOUTH=4]="SOUTH";c[c.SOUTH_WEST=5]="SOUTH_WEST";c[c.WEST=6]="WEST";c[c.NORTH_WEST=7]="NORTH_WEST"})(a.NeighborIndex||(a.NeighborIndex=
{}));a.LODSnapping=void 0;(function(c){c[c.OFF=0]="OFF";c[c.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.RenderTargetType=void 0;(function(c){c[c.Color=0]="Color";c[c.ColorNoRasterImage=1]="ColorNoRasterImage";c[c.Highlight=2]="Highlight";c[c.Water=3]="Water";c[c.Occluded=4]="Occluded";c[c.ObjectAndLayerIdColor=5]="ObjectAndLayerIdColor"})(a.RenderTargetType||(a.RenderTargetType={}));a.TextureUpdate=void 0;(function(c){c[c.FADING=0]="FADING";c[c.IMMEDIATE=1]="IMMEDIATE";c[c.UNFADED=2]="UNFADED"})(a.TextureUpdate||
(a.TextureUpdate={}));a.TileFrustumVisibility=void 0;(function(c){c[c.INSIDE=0]="INSIDE";c[c.INTERSECTS=1]="INTERSECTS";c[c.OUTSIDE=2]="OUTSIDE"})(a.TileFrustumVisibility||(a.TileFrustumVisibility={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Overlay":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry/support/aaBoundingRect ./interfaces ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/LocalOriginFactory".split(" "),
function(a,c,b,t,n,r){a.OverlaySource=void 0;(function(f){f[f.None=0]="None";f[f.ColorAndWater=1]="ColorAndWater";f[f.Highlight=2]="Highlight";f[f.Occluded=3]="Occluded";f[f.ObjectAndLayerIdColor=4]="ObjectAndLayerIdColor"})(a.OverlaySource||(a.OverlaySource={}));let m=function(){function f(g,h){this.index=g;this.renderTargets=h;this._extent=b.create();this.resolution=0;this.renderLocalOrigin=r.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new d;this.hasTargetWithoutRasterImage=
this.hasDrapedRasterSource=this.hasDrapedFeatureSource=!1;this.index=g;this.validTargets=Array(h.renderTargets.length).fill(!1)}var e=f.prototype;e.getValidTexture=function(g){return this.validTargets[g]?this.renderTargets.getTarget(g).getTexture():null};e.getColorTexture=function(g){return(g=g===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(t.RenderTargetType.Color):g===a.OverlaySource.Highlight?this.renderTargets.getTarget(t.RenderTargetType.Highlight):g===a.OverlaySource.ObjectAndLayerIdColor?
this.renderTargets.getTarget(t.RenderTargetType.ObjectAndLayerIdColor):this.renderTargets.getTarget(t.RenderTargetType.Occluded))?g.getTexture():null};e.getColorTextureNoRasterImage=function(){return this._needsColorWithoutRasterImage?this.getValidTexture(t.RenderTargetType.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(t.RenderTargetType.Color):null};e.getNormalTexture=function(g){return(g=g===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(t.RenderTargetType.Water):
null)?g.getTexture():null};e.draw=function(g,h){const l=this.computeRenderTargetValidityBitfield();for(const v of this.renderTargets.renderTargets)this.validTargets[v.type]=v.type!==t.RenderTargetType.ColorNoRasterImage||this._needsColorWithoutRasterImage?g.drawTarget(this,v,h):!1;g=this.computeRenderTargetValidityBitfield();return l^g?n.ValidationState.CHANGED:n.ValidationState.UNCHANGED};e.computeRenderTargetValidityBitfield=function(){const g=this.validTargets;return+g[t.RenderTargetType.Color]|
+g[t.RenderTargetType.ColorNoRasterImage]<<1|+g[t.RenderTargetType.Highlight]<<2|+g[t.RenderTargetType.Water]<<3|+g[t.RenderTargetType.Occluded]<<4};e.setupGeometryViewsCyclical=function(g){this.setupGeometryViewsDirect();var h=.001*g.range;if(this._extent[0]-h<=g.min){const l=this.canvasGeometries.extents[this.canvasGeometries.numViews++];b.offset(this._extent,g.range,0,l)}this._extent[2]+h>=g.max&&(h=this.canvasGeometries.extents[this.canvasGeometries.numViews++],b.offset(this._extent,-g.range,
0,h))};e.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1;b.copy(this.canvasGeometries.extents[0],this._extent)};e.hasSomeSizedView=function(){for(let g=0;g<this.canvasGeometries.numViews;g++){const h=this.canvasGeometries.extents[g];if(h[0]!==h[2]&&h[1]!==h[3])return!0}return!1};e.applyViewport=function(g){g.setViewport(this.index===t.OverlayIndex.INNER?0:this.resolution,0,this.resolution,this.resolution)};c._createClass(f,[{key:"extent",get:function(){return this._extent}},{key:"_needsColorWithoutRasterImage",
get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}}]);return f}(),d=function(){this.extents=[b.create(),b.create(),b.create()];this.numViews=0};a.Overlay=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports","../../../../chunks/vec3f64"],function(a,c){let b=function(t,n){this.vec3=t;this.id=n};a.LocalOrigin=b;a.fromValues=function(t,n,r,m){return new b(c.fromValues(t,
n,r),m)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec2f32 ../../webgl/enums ../../webgl/FramebufferObject".split(" "),function(a,c,b,t,n,r){let m=function(){function d(e,g){this._size=t.create();this._fbo=null;this._fbo=new r.FramebufferObject(e,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.NONE},
{target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:g,maxAnisotropy:8,width:0,height:0})}var f=d.prototype;f.dispose=function(){this._fbo=b.disposeMaybe(this._fbo)};f.getTexture=function(){return this._fbo?this._fbo.colorTexture:null};f.isValid=function(){return null!==this._fbo};f.resize=function(e,g){this._size[0]=e;this._size[1]=g;this._fbo.resize(this._size[0],
this._size[1])};f.bind=function(e){e.bindFramebuffer(this._fbo)};f.generateMipMap=function(){const e=this._fbo.colorTexture;e.descriptor.hasMipmap&&e.generateMipmap()};f.disposeRenderTargetMemory=function(){this._fbo?.resize(0,0)};c._createClass(d,[{key:"gpuMemoryUsage",get:function(){return this._fbo?.gpuMemoryUsage??0}}]);return d}();a.OverlayFramebufferObject=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayRenderTarget":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/has ./interfaces ./OverlayFramebufferObject ../webgl-engine/core/shaderLibrary/ShaderOutput".split(" "),
function(a,c,b,t,n,r){let m=function(f,e,g,h=!0){this.output=e;this.type=g;this.valid=!1;this.lastUsed=Infinity;this.fbo=new n.OverlayFramebufferObject(f,h)},d=function(){function f(g){this.renderTargets=[new m(g,r.ShaderOutput.Color,t.RenderTargetType.Color),new m(g,r.ShaderOutput.Color,t.RenderTargetType.ColorNoRasterImage),new m(g,r.ShaderOutput.Highlight,t.RenderTargetType.Highlight,!1),new m(g,r.ShaderOutput.Normal,t.RenderTargetType.Water),new m(g,r.ShaderOutput.Color,t.RenderTargetType.Occluded)];
b("enable-feature:objectAndLayerId-rendering")&&this.renderTargets.push(new m(g,r.ShaderOutput.ObjectAndLayerIdColor,t.RenderTargetType.ObjectAndLayerIdColor))}var e=f.prototype;e.getTarget=function(g){return this.renderTargets[g].fbo};e.dispose=function(){for(const g of this.renderTargets)g.fbo.dispose()};e.disposeRenderTargetMemory=function(){for(const g of this.renderTargets)g.fbo.disposeRenderTargetMemory()};e.validateUsageForTarget=function(g,h,l){if(g)h.lastUsed=l;else if(1E3<l-h.lastUsed)h.fbo.disposeRenderTargetMemory(),
h.lastUsed=Infinity;else if(Infinity>h.lastUsed)return!0;return!1};c._createClass(f,[{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((g,h)=>g+h.fbo.gpuMemoryUsage,0)}}]);return f}();a.OverlayRenderTarget=d;a.RenderTargetDescriptor=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"../../../../../core/NestedMap","./ShaderTechniqueConfiguration"],function(a,c,b,t,n){let r=function(){function f(g){this._context=g;this._perConstructorInstances=new t.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}var e=f.prototype;e.destroy=function(){this._perConstructorInstances.forEach(g=>g.forEach(h=>h.technique.destroy()));this._perConstructorInstances.clear()};e.acquire=function(g,h=d){const l=h.key;let v=this._perConstructorInstances.get(g,l);if(b.isNone(v)){const q=new g(this._context,
h,()=>this.release(q));v=new m(q);this._perConstructorInstances.set(g,l,v)}++v.refCount;return v.technique};e.releaseAndAcquire=function(g,h,l){if(b.isSome(l)){if(h.key===l.key)return l;this.release(l)}return this.acquire(g,h)};e.release=function(g){b.isNone(g)||this._perConstructorInstances.empty||(g=this._perConstructorInstances.get(g.constructor,g.key),b.isNone(g)||(--g.refCount,0===g.refCount&&(g.refZeroFrame=this._frameCounter)))};e.frameUpdate=function(){this._frameCounter++;-1!==this._keepAliveFrameCount&&
this._perConstructorInstances.forEach((g,h)=>{g.forEach((l,v)=>{0===l.refCount&&l.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(l.technique.destroy(),this._perConstructorInstances.delete(h,v))})})};e.reloadAll=function(){var g=c._asyncToGenerator(function*(){var h=this;const l=[];this._perConstructorInstances.forEach((v,q)=>{const k=function(){var p=c._asyncToGenerator(function*(z,C){if(C=C.shader)yield C.reload(),z.forEach(B=>B.technique.reload(h._context))});return function(z,C){return p.apply(this,
arguments)}}();l.push(k(v,q))});yield Promise.all(l)});return function(){return g.apply(this,arguments)}}();c._createClass(f,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return f}(),m=function(f){this.technique=f;this.refZeroFrame=this.refCount=0};const d=new n.ShaderTechniqueConfiguration;a.ShaderTechniqueRepository=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/NestedMap ./Util".split(" "),
function(a,c,b,t,n,r){let m=function(){function f(g,h,l,v){this._textureRepository=g;this._techniqueRepository=h;this.materialChanged=l;this.requestRender=v;this._id2glMaterialRef=new n.NestedMap}var e=f.prototype;e.dispose=function(){this._textureRepository.destroy()};e.acquire=function(g,h,l){this._ownMaterial(g);if(!g.requiresSlot(h,l))return null;h=this._id2glMaterialRef.get(l,g.id);t.isNone(h)&&(h=g.createGLMaterial({material:g,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,
output:l}),h=new d(h),this._id2glMaterialRef.set(l,g.id,h));h.ref();return h.glMaterial};e.release=function(g,h){const l=this._id2glMaterialRef.get(h,g.id);t.isSome(l)&&(l.unref(),l.referenced||(t.disposeMaybe(l.glMaterial),this._id2glMaterialRef.delete(h,g.id)))};e._ownMaterial=function(g){t.isSome(g.repository)&&g.repository!==this&&b.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository").error("Material is already owned by a different material repository");g.repository=this};return f}(),
d=function(){function f(g){this.glMaterial=g;this._refCnt=0}var e=f.prototype;e.ref=function(){++this._refCnt};e.unref=function(){--this._refCnt;r.assert(0<=this._refCnt)};c._createClass(f,[{key:"referenced",get:function(){return 0<this._refCnt}}]);return f}();a.GLMaterialRepository=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ./Attribute ./ContentObjectType ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){let z=function(){function B(x){this._originSR=x;this._origins=new Map;this._objects=new Map;this._gridSize=5E5;this._rootOriginId="root/"+t.generateUID()}var A=B.prototype;A.getOrigin=function(x){var u=this._origins.get(this._rootOriginId);if(null==u){u=v.gridLocalOriginFactory.rootOrigin;if(b.isSome(u))return this._origins.set(this._rootOriginId,h.fromValues(u[0],u[1],u[2],this._rootOriginId)),this.getOrigin(x);x=h.fromValues(x[0]+Math.random()-.5,x[1]+
Math.random()-.5,x[2]+Math.random()-.5,this._rootOriginId);this._origins.set(this._rootOriginId,x);return x}var y=this._gridSize;const w=Math.round(x[0]/y),D=Math.round(x[1]/y),F=Math.round(x[2]/y),E=`${w}/${D}/${F}`;let K=this._origins.get(E);const J=.5*y;n.subtract(C,x,u.vec3);C[0]=Math.abs(C[0]);C[1]=Math.abs(C[1]);C[2]=Math.abs(C[2]);if(C[0]<J&&C[1]<J&&C[2]<J)return K&&(y=Math.max(...C),n.subtract(C,x,K.vec3),C[0]=Math.abs(C[0]),C[1]=Math.abs(C[1]),C[2]=Math.abs(C[2]),Math.max(...C)<y)?K:u;K||
(K=h.fromValues(w*y,D*y,F*y,E),this._origins.set(E,K));return K};A._drawOriginBox=function(x,u=m.fromValues(1,1,0,1)){const y=window.view,w=y._stage;var D=u.toString();if(!this._objects.has(D)){this._material=new p.RibbonLineMaterial({width:2,color:u});w.add(this._material);u=new k.WebGLLayer({pickable:!1});var F=new l.Object3D({castShadow:!1});w.add(F);u.add(F);w.add(u);this._objects.set(D,F)}D=this._objects.get(D);u=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];F=u.length;const E=Array(3*F),K=[],J=.5*
this._gridSize;for(let M=0;M<F;M++)E[3*M]=x[0]+(u[M]&1?J:-J),E[3*M+1]=x[1]+(u[M]&2?J:-J),E[3*M+2]=x[2]+(u[M]&4?J:-J),0<M&&K.push(M-1,M);d.projectBuffer(E,this._originSR,0,E,y.renderSpatialReference,0,F);x=new g.Geometry(this._material,[[q.VertexAttribute.POSITION,new f.Attribute(E,3,!0)]],[[q.VertexAttribute.POSITION,K]],null,e.ContentObjectType.Line);w.add(x);D.addGeometry(x)};c._createClass(B,[{key:"test",get:function(){const x=this;return{set gridSize(u){x._gridSize=u}}}}]);return B}();const C=
r.create();a.GridLocalOriginFactory=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(a){a.gridLocalOriginFactory={rootOrigin:null};a.textTextureAtlas={orderedRepackingEnabled:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree ./UpdatePolicy".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){m=function(h){function l(q,k=""){var p=h.call(this)||this;p.apiLayerUid=k;p.type=d.ContentObjectType.Layer;p.events=new b;p.sliceable=!1;p._objects=new r;p._objectsAdded=new r;p._stageHandles=new t;p.apiLayerUid=k;p.visible=q?.visible??!0;p.pickable=q?.pickable??!0;p.updatePolicy=q?.updatePolicy??g.UpdatePolicy.ASYNC;p._disableOctree=q?.disableOctree??!1;return p}c._inheritsLoose(l,h);var v=l.prototype;v.destroy=function(){this.detachStage();this._stage=null};v.attachStage=
function(q){this.detachStage();this._stage=q;for(const k of f.DirtyEventNames)this._stageHandles.add(this.events.on(k,p=>q.handleEvent(k,p)))};v.detachStage=function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};v.add=function(q){this._objects.push(q);q.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:q});n.isSome(this._octree)&&this._objectsAdded.push(q)};v.remove=function(q){this._objects.removeUnordered(q)&&(q.parentLayer=null,this.events.emit("layerObjectRemoved",
{layer:this,object:q}),n.isSome(this._octree)&&(this._objectsAdded.removeUnordered(q)||this._octree.remove([q])))};v.addMany=function(q){this._objects.pushArray(q);for(const k of q)k.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:q});n.isSome(this._octree)&&this._objectsAdded.pushArray(q)};v.removeMany=function(q){const k=[];this._objects.removeUnorderedMany(q,q.length,k);if(0!==k.length){for(const p of k)p.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,
objects:k});if(n.isSome(this._octree)){for(q=0;q<k.length;)this._objectsAdded.removeUnordered(k[q])?(k[q]=k[k.length-1],--k.length):++q;this._octree.remove(k)}}};v.sync=function(){n.isSome(this._stage)&&this.updatePolicy!==g.UpdatePolicy.SYNC&&this._stage.syncLayer(this.id)};v.notifyObjectBBChanged=function(q,k){n.isSome(this._octree)&&!this._objectsAdded.includes(q)&&this._octree.update(q,k)};v.getSpatialQueryAccelerator=function(){n.isNone(this._octree)&&50<this._objects.length&&!this._disableOctree?
(this._octree=new e(q=>q.boundingVolumeWorldSpace.bounds),this._octree.add(this._objects.data,this._objects.length)):n.isSome(this._octree)&&0<this._objectsAdded.length&&(this._octree.add(this._objectsAdded.data,this._objectsAdded.length),this._objectsAdded.clear());return this._octree};v.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",this)};v.invalidateSpatialQueryAccelerator=function(){this._octree=n.destroyMaybe(this._octree);
this._objectsAdded.clear()};c._createClass(l,[{key:"objects",get:function(){return this._objects}}]);return l}(m.ContentObject);a.WebGLLayer=m;a.isWebGLLayer=function(h){return n.isSome(h)&&h.type===d.ContentObjectType.Layer};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved objectGeometryUpdated".split(" ");
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),function(a,c,b,t,n,r,m,d,f,e){function g(G,H,L){L[0]=G[0]+H;L[1]=G[1]+H;L[2]=G[2]+H}function h(G,
H,L,O){if(1===H)G=L(G[0]),f.copy(G,O);else{w[0]=Infinity;w[1]=Infinity;w[2]=Infinity;D[0]=-Infinity;D[1]=-Infinity;D[2]=-Infinity;for(let V=0;V<H;V++){var S=L(G[V]);if(k(S[3])){var R=w,Q=S;R[0]=Math.min(R[0],Q[0]-Q[3]);R[1]=Math.min(R[1],Q[1]-Q[3]);R[2]=Math.min(R[2],Q[2]-Q[3]);R=D;R[0]=Math.max(R[0],S[0]+S[3]);R[1]=Math.max(R[1],S[1]+S[3]);R[2]=Math.max(R[2],S[2]+S[3])}}n.lerp(O,w,D,.5);O[3]=Math.max(D[0]-w[0],D[1]-w[1],D[2]-w[2])/2}}function l(G,H,L){if(!P.length)for(var O=0;8>O;++O)P.push({index:0,
distance:0});for(O=0;8>O;++O){const S=C[O];P.data[O].index=O;P.data[O].distance=q(G,H,S)}P.sort((S,R)=>S.distance-R.distance);for(G=0;8>G;++G)L[G]=P.data[G].index}function v(G,H){let L=Infinity,O;for(let S=0;8>S;++S){const R=q(G,H,B[S]);R<L&&(L=R,O=B[S])}return O}function q(G,H,L){return H*(G[0]*L[0]+G[1]*L[1]+G[2]*L[2])}function k(G){return!isNaN(G)&&-Infinity!==G&&Infinity!==G&&0<G}let p=function(){function G(L,O){this._objectToBoundingSphere=L;this._maximumObjectsPerNode=10;this._maximumDepth=
20;this._degenerateObjects=new Set;this._root=new z;this._objectCount=0;O&&(void 0!==O.maximumObjectsPerNode&&(this._maximumObjectsPerNode=O.maximumObjectsPerNode),void 0!==O.maximumDepth&&(this._maximumDepth=O.maximumDepth))}var H=G.prototype;H.destroy=function(){this._degenerateObjects.clear();z.clearPool();x[0]=null;F.prune();P.prune()};H.add=function(L,O=L.length){this._objectCount+=O;this._grow(L,O);const S=z.acquire();for(let R=0;R<O;R++){const Q=L[R];this._isDegenerate(Q)?this._degenerateObjects.add(Q):
(S.init(this._root),this._add(Q,S))}z.release(S)};H.remove=function(L,O=null){this._objectCount-=L.length;const S=z.acquire();for(const R of L)L=c.isSome(O)?O:f.copy(this._objectToBoundingSphere(R),E),k(L[3])?(S.init(this._root),this._remove(R,L,S)):this._degenerateObjects.delete(R);z.release(S);this._shrink()};H.update=function(L,O){if(k(O[3])||!this._isDegenerate(L))x[0]=L,L=x,this.remove(L,O),this.add(L)};H.forEachAlongRay=function(L,O,S){const R=d.wrap(L,O);this._forEachNode(this._root,Q=>{if(!this._intersectsNode(R,
Q))return!1;Q=Q.node;Q.terminals.forAll(V=>{this._intersectsObject(R,V)&&S(V)});null!==Q.residents&&Q.residents.forAll(V=>{this._intersectsObject(R,V)&&S(V)});return!0})};H.forEachAlongRayWithVerticalOffset=function(L,O,S,R){const Q=d.wrap(L,O);this._forEachNode(this._root,V=>{if(!this._intersectsNodeWithOffset(Q,V,R))return!1;V=V.node;V.terminals.forAll(aa=>{this._intersectsObjectWithOffset(Q,aa,R)&&S(aa)});null!==V.residents&&V.residents.forAll(aa=>{this._intersectsObjectWithOffset(Q,aa,R)&&S(aa)});
return!0})};H.forEach=function(L){this._forEachNode(this._root,O=>{O=O.node;O.terminals.forAll(L);null!==O.residents&&O.residents.forAll(L);return!0});this._degenerateObjects.forEach(L)};H.forEachDegenerateObject=function(L){this._degenerateObjects.forEach(L)};H.findClosest=function(L,O,S,R=()=>!0,Q=Infinity){let V=Infinity,aa=Infinity,X=null;const W=v(L,O),T=U=>{--Q;if(R(U)){var Y=this._objectToBoundingSphere(U);if(m.intersectsSphere(S,Y)){var ba=q(L,O,f.getCenter(Y)),da=ba-Y[3];Y=ba+Y[3];da<V&&
(V=da,aa=Y,X=U)}}};this._forEachNodeDepthOrdered(this._root,U=>{if(0>=Q||!m.intersectsSphere(S,U.bounds))return!1;n.scale(y,W,U.halfSize);n.add(y,y,U.bounds);if(q(L,O,y)>aa)return!1;U=U.node;U.terminals.forAll(Y=>T(Y));null!==U.residents&&U.residents.forAll(Y=>T(Y));return!0},L,O);return X};H.forEachInDepthRange=function(L,O,S,R,Q,V,aa){let X=-Infinity,W=Infinity;const T={setRange:ea=>{S===G.DepthOrder.FRONT_TO_BACK?(X=Math.max(X,ea.near),W=Math.min(W,ea.far)):(X=Math.max(X,-ea.far),W=Math.min(W,
-ea.near))}};T.setRange(R);const U=q(O,S,L),Y=v(O,S),ba=v(O,-S),da=ea=>{if(aa(ea)){var ca=this._objectToBoundingSphere(ea),ja=f.getCenter(ca);ja=q(O,S,ja)-U;var ia=ja+ca[3];ja-ca[3]>W||ia<X||!m.intersectsSphere(V,ca)||Q(ea,T)}};this._forEachNodeDepthOrdered(this._root,ea=>{if(!m.intersectsSphere(V,ea.bounds))return!1;n.scale(y,Y,ea.halfSize);n.add(y,y,ea.bounds);if(q(O,S,y)-U>W)return!1;n.scale(y,ba,ea.halfSize);n.add(y,y,ea.bounds);if(q(O,S,y)-U<X)return!1;ea=ea.node;ea.terminals.forAll(ca=>da(ca));
null!==ea.residents&&ea.residents.forAll(ca=>da(ca));return!0},O,S)};H.forEachNode=function(L){this._forEachNode(this._root,O=>L(O.node,O.bounds,O.halfSize))};H.forEachNeighbor=function(L,O){const S=f.getRadius(O),R=f.getCenter(O),Q=X=>{const W=this._objectToBoundingSphere(X);var T=f.getRadius(W);T=S+T;return 0>=n.squaredDistance(f.getCenter(W),R)-T*T?L(X):!0};let V=!0;const aa=X=>{V&&(V=Q(X))};this._forEachNode(this._root,X=>{var W=f.getRadius(X.bounds);W=S+W;if(0<n.squaredDistance(f.getCenter(X.bounds),
R)-W*W)return!1;X=X.node;X.terminals.forAll(aa);V&&null!==X.residents&&X.residents.forAll(aa);return V});V&&this.forEachDegenerateObject(aa)};H._intersectsNode=function(L,O){g(O.bounds,2*-O.halfSize,w);g(O.bounds,2*O.halfSize,D);return e.rayBoxTest(L.origin,L.direction,w,D)};H._intersectsNodeWithOffset=function(L,O,S){g(O.bounds,2*-O.halfSize,w);g(O.bounds,2*O.halfSize,D);S.applyToMinMax(w,D);return e.rayBoxTest(L.origin,L.direction,w,D)};H._intersectsObject=function(L,O){O=this._objectToBoundingSphere(O);
return 0<O[3]?f.intersectsRay(O,L):!0};H._intersectsObjectWithOffset=function(L,O,S){O=this._objectToBoundingSphere(O);return 0<O[3]?f.intersectsRay(S.applyToBoundingSphere(O),L):!0};H._forEachNode=function(L,O){L=z.acquire().init(L);const S=[L];for(;0!==S.length;){L=S.pop();if(O(L)&&!L.isLeaf())for(let R=0;R<L.node.children.length;R++)L.node.children[R]&&S.push(z.acquire().init(L).advance(R));z.release(L)}};H._forEachNodeDepthOrdered=function(L,O,S,R=G.DepthOrder.FRONT_TO_BACK){L=z.acquire().init(L);
const Q=[L];for(l(S,R,I);0!==Q.length;){L=Q.pop();if(O(L)&&!L.isLeaf())for(S=7;0<=S;--S)R=I[S],L.node.children[R]&&Q.push(z.acquire().init(L).advance(R));z.release(L)}};H._remove=function(L,O,S){F.clear();O=S.advanceTo(O,(R,Q)=>{F.push(R.node);F.push(Q)})?S.node.terminals:S.node.residents;O.removeUnordered(L);if(0===O.length)for(L=F.length-2;0<=L&&this._purge(F.data[L],F.data[L+1]);L-=2);};H._nodeIsEmpty=function(L){if(0!==L.terminals.length)return!1;if(null!==L.residents)return 0===L.residents.length;
for(let O=0;O<L.children.length;O++)if(L.children[O])return!1;return!0};H._purge=function(L,O){0<=O&&(L.children[O]=null);return this._nodeIsEmpty(L)?(null===L.residents&&(L.residents=new t({shrink:!0})),!0):!1};H._add=function(L,O){O.advanceTo(this._objectToBoundingSphere(L))?O.node.terminals.push(L):(O.node.residents.push(L),O.node.residents.length>this._maximumObjectsPerNode&&O.depth<this._maximumDepth&&this._split(O))};H._split=function(L){const O=L.node.residents;L.node.residents=null;for(let S=
0;S<O.length;S++){const R=z.acquire().init(L);this._add(O.getItemAt(S),R);z.release(R)}};H._grow=function(L,O){0!==O&&(h(L,O,S=>this._objectToBoundingSphere(S),K),k(K[3])&&!this._fitsInsideTree(K)&&(this._nodeIsEmpty(this._root.node)?(f.copy(K,this._root.bounds),this._root.halfSize=1.25*this._root.bounds[3],this._root.updateBoundsRadiusFromHalfSize()):(L=this._rootBoundsForRootAsSubNode(K),this._placingRootViolatesMaxDepth(L)?this._rebuildTree(K,L):this._growRootAsSubNode(L),z.release(L))))};H._rebuildTree=
function(L,O){n.copy(J,O.bounds);J[3]=O.halfSize;h([L,J],2,S=>S,M);L=z.acquire().init(this._root);this._root.initFrom(null,M,M[3]);this._root.increaseHalfSize(1.25);this._forEachNode(L,S=>{this.add(S.node.terminals.data,S.node.terminals.length);null!==S.node.residents&&this.add(S.node.residents.data,S.node.residents.length);return!0});z.release(L)};H._placingRootViolatesMaxDepth=function(L){const O=Math.log(L.halfSize/this._root.halfSize)*Math.LOG2E;let S=0;this._forEachNode(this._root,R=>{S=Math.max(S,
R.depth);return S+O<=this._maximumDepth});return S+O>this._maximumDepth};H._rootBoundsForRootAsSubNode=function(L){var O=L[3],S=-Infinity;const R=this._root.bounds,Q=this._root.halfSize;for(var V=0;3>V;V++){var aa=Math.max(0,Math.ceil((R[V]-Q-(L[V]-O))/(2*Q)));const X=Math.max(0,Math.ceil((L[V]+O-(R[V]+Q))/(2*Q)))+1;S=Math.max(S,2**Math.ceil(Math.log(aa+X)*Math.LOG2E));N[V].min=aa;N[V].max=X}for(L=0;3>L;L++)O=N[L].min,V=N[L].max,aa=(S-(O+V))/2,O+=Math.ceil(aa),V+=Math.floor(aa),u[L]=R[L]-Q-O*Q*2+
(V+O)*Q;S*=Q;u[3]=S*A;return z.acquire().initFrom(null,u,S,0)};H._growRootAsSubNode=function(L){const O=this._root.node;n.copy(K,this._root.bounds);K[3]=this._root.halfSize;this._root.init(L);L.advanceTo(K,null,!0);L.node.children=O.children;L.node.residents=O.residents;L.node.terminals=O.terminals};H._shrink=function(){for(;;){const L=this._findShrinkIndex();if(-1===L)break;this._root.advance(L);this._root.depth=0}};H._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;
let L=null;const O=this._root.node.children;let S=0,R=0;for(;R<O.length&&null==L;)S=R++,L=O[S];for(;R<O.length;)if(O[R++])return-1;return S};H._isDegenerate=function(L){L=this._objectToBoundingSphere(L)[3];return!k(L)};H._fitsInsideTree=function(L){const O=this._root.bounds,S=this._root.halfSize;return L[3]<=S&&L[0]>=O[0]-S&&L[0]<=O[0]+S&&L[1]>=O[1]-S&&L[1]<=O[1]+S&&L[2]>=O[2]-S&&L[2]<=O[2]+S};a._createClass(G,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},
{key:"root",get:function(){return this._root.node}},{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return G}(),z=function(){function G(){this.bounds=f.create();this.halfSize=0;this.initFrom(null,null,0,0)}var H=G.prototype;H.init=function(L){return this.initFrom(L.node,L.bounds,L.halfSize,L.depth)};H.initFrom=function(L,O,S,R=this.depth){this.node=
c.isSome(L)?L:G.createEmptyNode();c.isSome(O)&&f.copy(O,this.bounds);this.halfSize=S;this.depth=R;return this};H.increaseHalfSize=function(L){this.halfSize*=L;this.updateBoundsRadiusFromHalfSize()};H.updateBoundsRadiusFromHalfSize=function(){this.bounds[3]=this.halfSize*A};H.advance=function(L){let O=this.node.children[L];O||(O=G.createEmptyNode(),this.node.children[L]=O);this.node=O;this.halfSize/=2;this.depth++;L=C[L];this.bounds[0]+=L[0]*this.halfSize;this.bounds[1]+=L[1]*this.halfSize;this.bounds[2]+=
L[2]*this.halfSize;this.updateBoundsRadiusFromHalfSize();return this};H.advanceTo=function(L,O,S=!1){for(;;){if(this.isTerminalFor(L))return O&&O(this,-1),!0;if(this.isLeaf()){if(!S)return O&&O(this,-1),!1;this.node.residents=null}const R=this._childIndex(L);O&&O(this,R);this.advance(R)}};H.isLeaf=function(){return null!=this.node.residents};H.isTerminalFor=function(L){return L[3]>this.halfSize/2};H._childIndex=function(L){const O=this.bounds;return(O[0]<L[0]?1:0)+(O[1]<L[1]?2:0)+(O[2]<L[2]?4:0)};
G.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new t({shrink:!0}),residents:new t({shrink:!0})}};G.acquire=function(){return G._pool.acquire()};G.release=function(L){G._pool.release(L)};G.clearPool=function(){G._pool.prune()};return G}();z._pool=new b(z);(function(G){G=G.DepthOrder||(G.DepthOrder={});G[G.FRONT_TO_BACK=1]="FRONT_TO_BACK";G[G.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(p||(p={}));const C=[r.fromValues(-1,-1,-1),r.fromValues(1,-1,-1),r.fromValues(-1,
1,-1),r.fromValues(1,1,-1),r.fromValues(-1,-1,1),r.fromValues(1,-1,1),r.fromValues(-1,1,1),r.fromValues(1,1,1)],B=[r.fromValues(-1,-1,-1),r.fromValues(-1,-1,1),r.fromValues(-1,1,-1),r.fromValues(-1,1,1),r.fromValues(1,-1,-1),r.fromValues(1,-1,1),r.fromValues(1,1,-1),r.fromValues(1,1,1)],A=Math.sqrt(3),x=[null],u=f.create(),y=r.create(),w=r.create(),D=r.create(),F=new t,E=f.create(),K=f.create(),J=f.create(),M=f.create(),N=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],P=new t,I=[0,0,0,0,0,0,0,0];return p})},
"esri/views/3d/webgl-engine/lib/UpdatePolicy":function(){define(["exports"],function(a){a.UpdatePolicy=void 0;var c=a.UpdatePolicy||(a.UpdatePolicy={});c[c.ASYNC=0]="ASYNC";c[c.SYNC=1]="SYNC";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechniqueConfiguration ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D){function F(ia,Z,ha,fa,ka){for(let la=0;la<ka;la++)ha[fa++]=ia[Z++];return fa}function E(ia,Z,ha){Z=Z.get(A.VertexAttribute.POSITION).data;ha=ha?ha.get(A.VertexAttribute.POSITION):null;return ia.isClosed?ha?2<ha.length:6<Z.length:!1}var K;(function(ia){ia[ia.LEFT_JOIN_START=-2]="LEFT_JOIN_START";ia[ia.LEFT_JOIN_END=-1]="LEFT_JOIN_END";ia[ia.LEFT_CAP_START=-4]="LEFT_CAP_START";ia[ia.LEFT_CAP_END=-5]="LEFT_CAP_END";ia[ia.RIGHT_JOIN_START=
2]="RIGHT_JOIN_START";ia[ia.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";ia[ia.RIGHT_CAP_START=4]="RIGHT_CAP_START";ia[ia.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(K||(K={}));let J=function(ia){function Z(fa){fa=ia.call(this,fa,new N)||this;fa._configuration=new D.RibbonLineTechniqueConfiguration;fa._vertexAttributeLocations=w.vertexAttributeLocations;fa._layout=fa.createLayout();return fa}c._inheritsLoose(Z,ia);var ha=Z.prototype;ha.isClosed=function(fa,ka){return this.parameters.isClosed?ka?2<ka.length:6<fa.length:
!1};ha.getConfiguration=function(fa,ka){this._configuration.output=fa;this._configuration.draped=ka.slot===C.RenderSlot.DRAPED_MATERIAL;fa=r.isSome(this.parameters.stipplePattern)&&fa!==k.ShaderOutput.Highlight;this._configuration.stippleEnabled=fa;this._configuration.stippleOffColorEnabled=fa&&r.isSome(this.parameters.stippleOffColor);this._configuration.stippleScaleWithLineWidth=fa&&this.parameters.stippleScaleWithLineWidth;this._configuration.stipplePreferContinuous=fa&&this.parameters.stipplePreferContinuous;
this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.roundJoins="round"===this.parameters.join;this._configuration.capType=this.parameters.cap;fa=this._configuration;if(r.isSome(this.parameters.markerParameters)){var la=this.parameters.markerParameters;la=la.anchor===u.LineMarkerAnchor.Tip&&la.hideOnShortSegments&&"begin-end"===la.placement&&la.worldSpace}else la=!1;fa.applyMarkerOffset=la;this._configuration.hasPolygonOffset=
this.parameters.hasPolygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvColor=this.parameters.vvColorEnabled;this._configuration.vvOpacity=this.parameters.vvOpacityEnabled;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.innerColorEnabled=0<this.parameters.innerWidth&&r.isSome(this.parameters.innerColor);this._configuration.falloffEnabled=0<this.parameters.falloff;this._configuration.occluder=this.parameters.renderOccluded===z.RenderOccludedFlag.OccludeAndTransparentStencil;
this._configuration.transparencyPassType=ka.transparencyPassType;this._configuration.hasMultipassTerrain=ka.multipassTerrain.enabled;this._configuration.cullAboveGround=ka.multipassTerrain.cullAboveGround;this._configuration.wireframe=this.parameters.wireframe;return this._configuration};ha.intersectDraped=function(fa,ka,la,na,pa,va){if(la.options.selectionMode){ka=fa.vertexAttributes.get(A.VertexAttribute.POSITION).data;la=fa.vertexAttributes.get(A.VertexAttribute.SIZE);var wa=this.parameters.width;
this.parameters.vvSizeEnabled?(la=fa.vertexAttributes.get(A.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],wa*=n.clamp(this.parameters.vvSizeOffset[0]+la*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])):la&&(wa*=la.data[0]);la=na[0];na=na[1];fa=(wa/2+4)*fa.screenToWorldRatio;wa=Number.MAX_VALUE;var za=0;for(let Ea=0;Ea<ka.length-5;Ea+=3){var sa=ka[Ea],ua=ka[Ea+1],oa=la-sa,xa=na-ua;sa=ka[Ea+3]-sa;ua=ka[Ea+4]-ua;const Ia=n.clamp((sa*oa+ua*xa)/(sa*sa+
ua*ua),0,1);oa=sa*Ia-oa;xa=ua*Ia-xa;xa=oa*oa+xa*xa;xa<wa&&(wa=xa,za=Ea/3)}wa<fa*fa&&pa(va.dist,va.normal,za,!1)}};ha.intersect=function(fa,ka,la,na,pa,va){if(la.options.selectionMode&&fa.visible)if(B.isTranslationMatrix(ka)){var wa=fa.vertexAttributes;pa=wa.get(A.VertexAttribute.POSITION).data;na=this.parameters.width;if(this.parameters.vvSizeEnabled){var za=wa.get(A.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0];na*=n.clamp(this.parameters.vvSizeOffset[0]+za*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],
this.parameters.vvSizeMaxSize[0])}else wa.has(A.VertexAttribute.SIZE)&&(na*=wa.get(A.VertexAttribute.SIZE).data[0]);var sa=la.camera,ua=O;d.copy(ua,la.point);za=na*sa.pixelRatio/2+4*sa.pixelRatio;f.set(Y[0],ua[0]-za,ua[1]+za,0);f.set(Y[1],ua[0]+za,ua[1]+za,0);f.set(Y[2],ua[0]+za,ua[1]-za,0);f.set(Y[3],ua[0]-za,ua[1]-za,0);for(na=0;4>na;na++)if(!sa.unprojectFromRenderScreen(Y[na],ba[na]))return;v.fromPoints(sa.eye,ba[0],ba[1],da);v.fromPoints(sa.eye,ba[1],ba[2],ea);v.fromPoints(sa.eye,ba[2],ba[3],
ca);v.fromPoints(sa.eye,ba[3],ba[0],ja);var oa=Number.MAX_VALUE;na=0;fa=E(this.parameters,wa,fa.indices)?pa.length-2:pa.length-5;for(wa=0;wa<fa;wa+=3){I[0]=pa[wa]+ka[12];I[1]=pa[wa+1]+ka[13];I[2]=pa[wa+2]+ka[14];var xa=(wa+3)%pa.length;G[0]=pa[xa]+ka[12];G[1]=pa[xa+1]+ka[13];G[2]=pa[xa+2]+ka[14];if(!(0>v.signedDistance(da,I)&&0>v.signedDistance(da,G)||0>v.signedDistance(ea,I)&&0>v.signedDistance(ea,G)||0>v.signedDistance(ca,I)&&0>v.signedDistance(ca,G)||0>v.signedDistance(ja,I)&&0>v.signedDistance(ja,
G))){sa.projectToRenderScreen(I,S);sa.projectToRenderScreen(G,R);if(0>S[2]&&0<R[2])f.subtract(H,I,G),xa=sa.frustum,xa=-v.signedDistance(xa[h.PlaneIndex.NEAR],I)/f.dot(H,v.normal(xa[h.PlaneIndex.NEAR])),f.scale(H,H,xa),f.add(I,I,H),sa.projectToRenderScreen(I,S);else if(0<S[2]&&0>R[2])f.subtract(H,G,I),xa=sa.frustum,xa=-v.signedDistance(xa[h.PlaneIndex.NEAR],G)/f.dot(H,v.normal(xa[h.PlaneIndex.NEAR])),f.scale(H,H,xa),f.add(G,G,H),sa.projectToRenderScreen(G,R);else if(0>S[2]&&0>R[2])continue;S[2]=0;
R[2]=0;xa=l.distance2(l.fromPoints(S,R,aa),ua);xa<oa&&(oa=xa,f.copy(Q,I),f.copy(V,G),na=wa/3)}}ka=la.rayBegin;la=la.rayEnd;oa<za*za&&(pa=Number.MAX_VALUE,l.closestLineSegmentPoint(l.fromPoints(Q,V,aa),l.fromPoints(ka,la,X),L)&&(f.subtract(L,L,ka),pa=f.length(L),f.scale(L,L,1/pa),pa/=f.distance(ka,la)),va(pa,L,na,!1))}else t.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial").error("intersection assumes a translation-only matrix")};ha.createLayout=function(){const fa=q.newLayout().vec3f(A.VertexAttribute.POSITION).f32(A.VertexAttribute.SUBDIVISIONFACTOR).vec2f(A.VertexAttribute.UV0).vec3f(A.VertexAttribute.AUXPOS1).vec3f(A.VertexAttribute.AUXPOS2);
this.parameters.vvSizeEnabled?fa.f32(A.VertexAttribute.SIZEFEATUREATTRIBUTE):fa.f32(A.VertexAttribute.SIZE);this.parameters.vvColorEnabled?fa.f32(A.VertexAttribute.COLORFEATUREATTRIBUTE):fa.vec4f(A.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&fa.f32(A.VertexAttribute.OPACITYFEATUREATTRIBUTE);b("enable-feature:objectAndLayerId-rendering")&&fa.vec4u8(A.VertexAttribute.OBJECTANDLAYERIDCOLOR);return fa};ha.createBufferWriter=function(){return new P(this._layout,this.parameters)};ha.requiresSlot=
function(fa,ka){return ka===k.ShaderOutput.Color||ka===k.ShaderOutput.Alpha||ka===k.ShaderOutput.Highlight||ka===k.ShaderOutput.Depth||ka===k.ShaderOutput.ObjectAndLayerIdColor?fa===C.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===z.RenderOccludedFlag.OccludeAndTransparentStencil?fa===C.RenderSlot.OPAQUE_MATERIAL||fa===C.RenderSlot.OCCLUDER_MATERIAL||fa===C.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:ka===k.ShaderOutput.Color||ka===k.ShaderOutput.Alpha?fa===(this.parameters.writeDepth?
C.RenderSlot.TRANSPARENT_MATERIAL:C.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):fa===C.RenderSlot.OPAQUE_MATERIAL:!1};ha.createGLMaterial=function(fa){return new M(fa)};ha.validateParameters=function(fa){"miter"!==fa.join&&(fa.miterLimit=0);r.isSome(fa.markerParameters)&&(fa.markerScale=fa.markerParameters.width/fa.width)};return Z}(z.Material),M=function(ia){function Z(){var fa=ia.apply(this,arguments)||this;fa._stipplePattern=null;return fa}c._inheritsLoose(Z,ia);var ha=Z.prototype;ha.dispose=
function(){ia.prototype.dispose.call(this);this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null};ha._updateOccludeeState=function(fa){fa.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:fa.hasOccludees})};ha.beginSlot=function(fa){this._output!==k.ShaderOutput.Color&&this._output!==k.ShaderOutput.Alpha||this._updateOccludeeState(fa);const ka=this._material.parameters.stipplePattern;this._stipplePattern!==ka&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,
ka)),this._stipplePattern=ka);return this.ensureTechnique(w.RibbonLineTechnique,fa)};return Z}(p),N=function(ia){function Z(){var ha=ia.apply(this,arguments)||this;ha.width=0;ha.color=g.ONES;ha.join="miter";ha.cap=D.CapType.BUTT;ha.miterLimit=5;ha.writeDepth=!0;ha.hasPolygonOffset=!1;ha.stippleTexture=null;ha.stippleScaleWithLineWidth=!1;ha.stipplePreferContinuous=!0;ha.markerParameters=null;ha.markerScale=1;ha.hasSlicePlane=!1;ha.vvFastUpdate=!1;ha.isClosed=!1;ha.falloff=0;ha.innerWidth=0;ha.hasOccludees=
!1;ha.wireframe=!1;return ha}c._inheritsLoose(Z,ia);return Z}(x.VisualVariablePassParameters),P=function(){function ia(ha,fa){this._parameters=fa;this.numJoinSubdivisions=0;this.vertexBufferLayout=ha;ha=fa.stipplePattern?1:0;switch(this._parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=ha;break;case "round":this.numJoinSubdivisions=y.RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS+ha}}var Z=ia.prototype;Z._isClosed=function(ha){return E(this._parameters,ha.vertexAttributes,ha.indices)};
Z.allocate=function(ha){return this.vertexBufferLayout.createBuffer(ha)};Z.elementCount=function(ha){var fa=ha.indices.get(A.VertexAttribute.POSITION).length/2+1;ha=this._isClosed(ha);fa=(ha?2:4)+((ha?fa:fa-1)-(ha?0:1))*(2*this.numJoinSubdivisions+4);fa+=2;this._parameters.wireframe&&(fa=2+4*(fa-2));return fa};Z.write=function(ha,fa,ka,la,na){fa=W;const pa=T,va=U,wa=ka.vertexAttributes.get(A.VertexAttribute.POSITION).data;var za=ka.indices&&ka.indices.get(A.VertexAttribute.POSITION);const sa=ka.vertexAttributes.get(A.VertexAttribute.DISTANCETOSTART)?.data;
za&&za.length!==2*(wa.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");let ua=1,oa=0;this._parameters.vvSizeEnabled?oa=ka.vertexAttributes.get(A.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:ka.vertexAttributes.has(A.VertexAttribute.SIZE)&&(ua=ka.vertexAttributes.get(A.VertexAttribute.SIZE).data[0]);let xa=[1,1,1,1],Ea=0;this._parameters.vvColorEnabled?Ea=ka.vertexAttributes.get(A.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:ka.vertexAttributes.has(A.VertexAttribute.COLOR)&&
(xa=ka.vertexAttributes.get(A.VertexAttribute.COLOR).data);const Ia=b("enable-feature:objectAndLayerId-rendering")?ka.objectAndLayerIdColor:null;let Na=0;this._parameters.vvOpacityEnabled&&(Na=ka.vertexAttributes.get(A.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);za=wa.length/3;const Oa=new Float32Array(la.buffer),Ja=b("enable-feature:objectAndLayerId-rendering")?new Uint8Array(la.buffer):null,Sa=this.vertexBufferLayout.stride/4;let Ua=na*Sa;na=Ua;let Za=0;const ma=sa?(qa,ya,Da)=>Za=sa[Da]:(qa,
ya,Da)=>Za+=f.distance(qa,ya),Ya=b("enable-feature:objectAndLayerId-rendering"),bb=(qa,ya,Da,La,Ta,Xa,db)=>{Oa[Ua++]=ya[0];Oa[Ua++]=ya[1];Oa[Ua++]=ya[2];Oa[Ua++]=La;Oa[Ua++]=db;Oa[Ua++]=Ta;Oa[Ua++]=qa[0];Oa[Ua++]=qa[1];Oa[Ua++]=qa[2];Oa[Ua++]=Da[0];Oa[Ua++]=Da[1];Oa[Ua++]=Da[2];this._parameters.vvSizeEnabled?Oa[Ua++]=oa:Oa[Ua++]=ua;this._parameters.vvColorEnabled?Oa[Ua++]=Ea:(qa=Math.min(4*Xa,xa.length-4),Oa[Ua++]=xa[qa],Oa[Ua++]=xa[qa+1],Oa[Ua++]=xa[qa+2],Oa[Ua++]=xa[qa+3]);this._parameters.vvOpacityEnabled&&
(Oa[Ua++]=Na);Ya&&(r.isSome(Ia)&&(Ja[4*Ua]=Ia[0],Ja[4*Ua+1]=Ia[1],Ja[4*Ua+2]=Ia[2],Ja[4*Ua+3]=Ia[3]),Ua++)};Ua+=Sa;f.set(pa,wa[0],wa[1],wa[2]);ha&&f.transformMat4(pa,pa,ha);if(ka=this._isClosed(ka)){var Qa=wa.length-3;f.set(fa,wa[Qa],wa[Qa+1],wa[Qa+2]);ha&&f.transformMat4(fa,fa,ha)}else f.set(va,wa[3],wa[4],wa[5]),ha&&f.transformMat4(va,va,ha),bb(pa,pa,va,1,K.LEFT_CAP_START,0,0),bb(pa,pa,va,1,K.RIGHT_CAP_START,0,0),f.copy(fa,pa),f.copy(pa,va);Qa=ka?0:1;const Aa=ka?za:za-1;for(let qa=Qa;qa<Aa;qa++){var Ca=
(qa+1)%za*3;f.set(va,wa[Ca],wa[Ca+1],wa[Ca+2]);ha&&f.transformMat4(va,va,ha);ma(fa,pa,qa);bb(fa,pa,va,0,K.LEFT_JOIN_END,qa,Za);bb(fa,pa,va,0,K.RIGHT_JOIN_END,qa,Za);Ca=this.numJoinSubdivisions;for(let ya=0;ya<Ca;++ya){const Da=(ya+1)/(Ca+1);bb(fa,pa,va,Da,K.LEFT_JOIN_END,qa,Za);bb(fa,pa,va,Da,K.RIGHT_JOIN_END,qa,Za)}bb(fa,pa,va,1,K.LEFT_JOIN_START,qa,Za);bb(fa,pa,va,1,K.RIGHT_JOIN_START,qa,Za);f.copy(fa,pa);f.copy(pa,va)}ka?(f.set(va,wa[3],wa[4],wa[5]),ha&&f.transformMat4(va,va,ha),Za=ma(fa,pa,Aa),
bb(fa,pa,va,0,K.LEFT_JOIN_END,Qa,Za),bb(fa,pa,va,0,K.RIGHT_JOIN_END,Qa,Za)):(Za=ma(fa,pa,Aa),bb(fa,pa,pa,0,K.LEFT_CAP_END,Aa,Za),bb(fa,pa,pa,0,K.RIGHT_CAP_END,Aa,Za));F(Oa,na+Sa,Oa,na,Sa);Ua=F(Oa,Ua-Sa,Oa,Ua,Sa);this._parameters.wireframe&&this._addWireframeVertices(la,na,Ua,Sa)};Z._addWireframeVertices=function(ha,fa,ka,la){const na=new Float32Array(ha.buffer,ka*Float32Array.BYTES_PER_ELEMENT);ha=new Float32Array(ha.buffer,fa*Float32Array.BYTES_PER_ELEMENT,ka-fa);fa=0;for(ka=0;ka<ha.length-1;ka+=
2*la)fa=F(ha,ka,na,fa,la),fa=F(ha,ka+2*la,na,fa,la),fa=F(ha,ka+1*la,na,fa,la),fa=F(ha,ka+2*la,na,fa,la),fa=F(ha,ka+1*la,na,fa,la),fa=F(ha,ka+3*la,na,fa,la)};return ia}();const I=e.create(),G=e.create(),H=e.create(),L=e.create(),O=e.create(),S=m.createRenderScreenPointArray3(),R=m.createRenderScreenPointArray3(),Q=e.create(),V=e.create(),aa=l.create(),X=l.create(),W=e.create(),T=e.create(),U=e.create(),Y=[m.createRenderScreenPointArray3(),m.createRenderScreenPointArray3(),m.createRenderScreenPointArray3(),
m.createRenderScreenPointArray3()],ba=[e.create(),e.create(),e.create(),e.create()],da=v.create(),ea=v.create(),ca=v.create(),ja=v.create();a.Parameters=N;a.RibbonLineMaterial=J;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m){a.LineMarkerSpace=void 0;(function(d){d[d.Draped=0]="Draped";d[d.Screen=1]="Screen";d[d.World=2]="World";d[d.COUNT=3]="COUNT"})(a.LineMarkerSpace||(a.LineMarkerSpace={}));a.LineMarkerAnchor=void 0;(function(d){d[d.Center=0]="Center";d[d.Tip=1]="Tip";d[d.COUNT=2]="COUNT"})(a.LineMarkerAnchor||(a.LineMarkerAnchor={}));m=function(d){function f(){var e=d.apply(this,arguments)||this;e.output=t.ShaderOutput.Color;e.transparencyPassType=r.TransparencyPassType.NONE;e.occluder=!1;e.hasSlicePlane=
!1;e.writeDepth=!1;e.space=a.LineMarkerSpace.Screen;e.hideOnShortSegments=!1;e.hasCap=!1;e.anchor=a.LineMarkerAnchor.Center;e.hasTip=!1;e.vvSize=!1;e.vvColor=!1;e.vvOpacity=!1;e.hasOccludees=!1;e.hasMultipassTerrain=!1;e.cullAboveGround=!1;return e}c._inheritsLoose(f,d);return f}(m.DefaultTechniqueConfiguration);b.__decorate([n.parameter({count:t.ShaderOutput.COUNT})],m.prototype,"output",void 0);b.__decorate([n.parameter({count:r.TransparencyPassType.COUNT})],m.prototype,"transparencyPassType",void 0);
b.__decorate([n.parameter()],m.prototype,"occluder",void 0);b.__decorate([n.parameter()],m.prototype,"hasSlicePlane",void 0);b.__decorate([n.parameter()],m.prototype,"writeDepth",void 0);b.__decorate([n.parameter({count:a.LineMarkerSpace.COUNT})],m.prototype,"space",void 0);b.__decorate([n.parameter()],m.prototype,"hideOnShortSegments",void 0);b.__decorate([n.parameter()],m.prototype,"hasCap",void 0);b.__decorate([n.parameter({count:a.LineMarkerAnchor.COUNT})],m.prototype,"anchor",void 0);b.__decorate([n.parameter()],
m.prototype,"hasTip",void 0);b.__decorate([n.parameter()],m.prototype,"vvSize",void 0);b.__decorate([n.parameter()],m.prototype,"vvColor",void 0);b.__decorate([n.parameter()],m.prototype,"vvOpacity",void 0);b.__decorate([n.parameter()],m.prototype,"hasOccludees",void 0);b.__decorate([n.parameter()],m.prototype,"hasMultipassTerrain",void 0);b.__decorate([n.parameter()],m.prototype,"cullAboveGround",void 0);b.__decorate([n.parameter({constValue:!0})],m.prototype,"hasVvInstancing",void 0);b.__decorate([n.parameter({constValue:!0})],
m.prototype,"hasSliceTranslatedView",void 0);a.LineMarkerTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../core/maybe ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w){function D(E){const K=new A.ShaderBuilder,{vertex:J,fragment:M}=K,N=E.hasMultipassTerrain&&(E.output===t.ShaderOutput.Color||E.output===t.ShaderOutput.Alpha);K.include(h.PiUtils);K.include(m.RibbonVertexPosition,E);K.include(f.LineStipple,E);const P=E.applyMarkerOffset&&!E.draped;P&&(J.uniforms.add(new z.FloatPassUniform("markerScale",R=>R.markerScale)),K.include(e.MarkerSizing,{space:y.LineMarkerSpace.World}));E.output===t.ShaderOutput.Depth&&
K.include(d.OutputDepth,E);K.include(r.ObjectAndLayerIdColor,E);q.addProjViewLocalOrigin(J,E);J.uniforms.add([new B.Matrix4PassUniform("inverseProjectionMatrix",(R,Q)=>Q.camera.inverseProjectionMatrix),new k.Float2PassUniform("nearFar",(R,Q)=>Q.camera.nearFar),new z.FloatPassUniform("miterLimit",R=>"miter"!==R.join?0:R.miterLimit),new p.Float4PassUniform("viewport",(R,Q)=>Q.camera.fullViewport)]);J.constants.add("LARGE_HALF_FLOAT","float",65500);K.attributes.add(u.VertexAttribute.POSITION,"vec3");
K.attributes.add(u.VertexAttribute.SUBDIVISIONFACTOR,"float");K.attributes.add(u.VertexAttribute.UV0,"vec2");K.attributes.add(u.VertexAttribute.AUXPOS1,"vec3");K.attributes.add(u.VertexAttribute.AUXPOS2,"vec3");K.varyings.add("vColor","vec4");K.varyings.add("vpos","vec3");b.addLinearDepth(K);N&&K.varyings.add("depth","float");const I=E.capType===w.CapType.ROUND,G=E.stippleEnabled&&E.stippleScaleWithLineWidth||I;G&&K.varyings.add("vLineWidth","float");const H=E.stippleEnabled&&E.stippleScaleWithLineWidth;
H&&K.varyings.add("vLineSizeInv","float");const L=E.innerColorEnabled||I;L&&K.varyings.add("vLineDistance","float");const O=E.stippleEnabled&&I,S=E.falloffEnabled||O;S&&K.varyings.add("vLineDistanceNorm","float");I&&(K.varyings.add("vSegmentSDF","float"),K.varyings.add("vReverseSegmentSDF","float"));J.code.add(C.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);J.code.add(C.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);b.addCalculateLinearDepth(K);J.code.add(C.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${N?"depth \x3d pos.z;":""}
      linearDepth = calculateLinearDepth(nearFar,pos.z);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);J.uniforms.add(new z.FloatPassUniform("pixelRatio",(R,Q)=>Q.camera.pixelRatio));J.code.add(C.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${G?C.glsl`vLineWidth = lineWidth;`:""}
      ${H?C.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);
  `);P&&J.code.add(C.glsl`vec4 other = isStartVertex ? next : prev;
bool markersHidden = areWorldMarkersHidden(pos, other);
if(!isJoin && !markersHidden) {
pos.xyz += normalize(other.xyz - pos.xyz) * getWorldMarkerSize(pos) * 0.5;
}`);J.code.add(C.glsl`clipAndTransform(pos, prev, next, isStartVertex);
vec2 left = (pos.xy - prev.xy);
vec2 right = (next.xy - pos.xy);
float leftLen = length(left);
float rightLen = length(right);`);(E.stippleEnabled||I)&&J.code.add(C.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${I?C.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);J.code.add(C.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);E.roundJoins?J.code.add(C.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${E.stippleEnabled?C.glsl`min(1.0, subdivisionFactor * ${C.glsl.float(1.5)})`:C.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):J.code.add(C.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);J.code.add(C.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${E.capType!==w.CapType.BUTT?C.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);J.code.add(C.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${S||L?C.glsl`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${L?C.glsl`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${S?C.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);I&&J.code.add(C.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);E.stippleEnabled&&(E.draped?J.uniforms.add(new z.FloatPassUniform("worldToScreenRatio",(R,Q)=>1/Q.screenToPCSRatio)):J.code.add(C.glsl`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),J.code.add(C.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),E.draped?J.code.add(C.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):J.code.add(C.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),J.uniforms.add(new z.FloatPassUniform("stipplePatternPixelSize",R=>f.computePixelSize(R))),J.code.add(C.glsl`
      float patternLength = ${E.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `));J.code.add(C.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${E.wireframe&&!E.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
      forwardObjectAndLayerIdColor();
    }
  }
  `);N&&K.include(g.multipassTerrainTest,E);K.include(n.SliceDraw,E);M.include(v.ColorConversion);M.code.add(C.glsl`
  void main() {
    discardBySlice(vpos);
    ${N?"terrainDepthTest(gl_FragCoord, depth);":""}
  `);E.wireframe?M.code.add(C.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(I&&M.code.add(C.glsl`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${C.glsl.float(l.symbolAlphaCutoff)}) {
        discard;
      }
    `),O?M.code.add(C.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${C.glsl.float(l.symbolAlphaCutoff)}, stippleCoverage);
      `):M.code.add(C.glsl`float stippleAlpha = getStippleAlpha();`),M.uniforms.add(new p.Float4PassUniform("intrinsicColor",R=>R.color)),E.output!==t.ShaderOutput.ObjectAndLayerIdColor&&M.code.add(C.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);`),M.code.add(C.glsl`vec4 color = intrinsicColor * vColor;`),E.innerColorEnabled&&(M.uniforms.add(new p.Float4PassUniform("innerColor",R=>c.unwrapOr(R.innerColor,R.color))),M.uniforms.add(new z.FloatPassUniform("innerWidth",(R,Q)=>R.innerWidth*
Q.camera.pixelRatio)),M.code.add(C.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),M.code.add(C.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),E.falloffEnabled&&(M.uniforms.add(new z.FloatPassUniform("falloff",R=>R.falloff)),M.code.add(C.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)));M.code.add(C.glsl`
    ${E.output===t.ShaderOutput.ObjectAndLayerIdColor?C.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${C.glsl.float(l.symbolAlphaCutoff)}) {
      discard;
    }

    ${E.output===t.ShaderOutput.Alpha?C.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${E.output===t.ShaderOutput.Color?C.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${E.output===t.ShaderOutput.Color&&E.transparencyPassType===x.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${E.output===t.ShaderOutput.Highlight?C.glsl`gl_FragColor = vec4(1.0);`:""}
    ${E.output===t.ShaderOutput.Depth?C.glsl`outputDepth(linearDepth);`:""}
    ${E.output===t.ShaderOutput.ObjectAndLayerIdColor?C.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return K}const F=Object.freeze(Object.defineProperty({__proto__:null,RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS:1,build:D},Symbol.toStringTag,{value:"Module"}));a.RIBBONLINE_NUM_ROUND_JOIN_SUBDIVISIONS=1;a.RibbonLine=F;a.build=D})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,c,b,t,n,r,m,d){a.RibbonVertexPosition=function(f,e){const g=f.vertex;g.uniforms.add(new t.FloatPassUniform("intrinsicWidth",h=>h.width));e.vvSize?(f.attributes.add(m.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),g.uniforms.add(new c.Float3PassUniform("vvSizeMinSize",h=>h.vvSizeMinSize)),g.uniforms.add(new c.Float3PassUniform("vvSizeMaxSize",h=>h.vvSizeMaxSize)),g.uniforms.add(new c.Float3PassUniform("vvSizeOffset",h=>h.vvSizeOffset)),g.uniforms.add(new c.Float3PassUniform("vvSizeFactor",
h=>h.vvSizeFactor)),g.code.add(r.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(f.attributes.add(m.VertexAttribute.SIZE,"float"),g.code.add(r.glsl`float getSize(){
return intrinsicWidth * size;
}`));e.vvOpacity?(f.attributes.add(m.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),g.constants.add("vvOpacityNumber","int",8),g.uniforms.add([new n.FloatsPassUniform("vvOpacityValues",h=>h.vvOpacityValues,8),new n.FloatsPassUniform("vvOpacityOpacities",h=>h.vvOpacityOpacities,8)]),g.code.add(r.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):g.code.add(r.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);e.vvColor?(f.attributes.add(m.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),g.constants.add("vvColorNumber","int",d.vvColorNumber),g.uniforms.add(new n.FloatsPassUniform("vvColorValues",h=>h.vvColorValues,d.vvColorNumber)),g.uniforms.add(new b.Float4sPassUniform("vvColorColors",h=>h.vvColorColors,d.vvColorNumber)),g.code.add(r.glsl`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(f.attributes.add(m.VertexAttribute.COLOR,"vec4"),g.code.add(r.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutput","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,c,b,t){a.OutputDepth=function(n,r){n.fragment.include(b.RgbaFloatEncoding);switch(r.output){case c.ShaderOutput.Shadow:case c.ShaderOutput.ShadowHighlight:case c.ShaderOutput.ShadowExcludeHighlight:n.extensions.add("GL_OES_standard_derivatives");
n.fragment.code.add(t.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 20.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`);break;case c.ShaderOutput.Depth:n.fragment.code.add(t.glsl`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../../../../../../core/maybe ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../util/WebGL2Utils ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType ../../../materials/StippleTextureRepository ../../../shaders/ensureColor4".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(k,p){const z=!(p.draped&&p.stipplePreferContinuous),{vertex:C,fragment:B}=k;B.include(b.RgbaFloatEncoding);p.draped||(t.addCameraPosition(C,p),C.uniforms.add(new m.FloatPassUniform("worldToScreenPerDistanceRatio",(A,x)=>1/x.camera.perScreenPixelRatio)),C.code.add(d.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));k.varyings.add("vStippleDistance","float");p.stippleRequiresClamp&&k.varyings.add("vStippleDistanceLimits","vec2");p.stippleRequiresStretchMeasure&&k.varyings.add("vStipplePatternStretch","float");C.code.add(d.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${q};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);C.code.add(d.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);C.code.add(d.glsl`
    if (segmentLengthPseudoScreen >= ${z?"patternLength":"1e4"}) {
  `);C.uniforms.add(new m.FloatPassUniform("pixelRatio",(A,x)=>x.camera.pixelRatio));C.code.add(d.glsl`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${p.stippleRequiresStretchMeasure?d.glsl`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `);B.constants.add("stippleTexturePadding","float",g.STIPPLE_TEXTURE_PADDING);B.uniforms.add(f.createTexture2DPassSizeUniforms("stipplePatternTexture",A=>A.stippleTexture,p.hasWebGL2Context?e.TextureSizeUniformType.None:e.TextureSizeUniformType.Size));B.uniforms.add([new m.FloatPassUniform("stipplePatternSDFNormalizer",A=>{A=A.stipplePattern;return c.isSome(A)?(Math.floor(.5*(g.computeLongestPattern(A)-1))+.5)/A.pixelRatio:1}),new m.FloatPassUniform("stipplePatternPixelSizeInv",A=>1/v(A))]);B.code.add(d.glsl`
    float padStippleTexture(float u) {
      float paddedTextureSize = ${n.textureSize(p,"stipplePatternTexture")}.x;
      float unpaddedTextureSize = paddedTextureSize - stippleTexturePadding;

      return (u * unpaddedTextureSize + stippleTexturePadding * 0.5) / paddedTextureSize;
    }
  `);B.code.add(d.glsl`
    float getStippleSDF(out bool isClamped) {
      ${p.stippleRequiresClamp?d.glsl`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:d.glsl`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${p.stippleScaleWithLineWidth?d.glsl`u *= vLineSizeInv;`:""}
      u = padStippleTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${p.stippleRequiresStretchMeasure?d.glsl`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:d.glsl`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${p.stippleScaleWithLineWidth?d.glsl`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:d.glsl`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `);p.stippleOffColorEnabled?(B.uniforms.add(new r.Float4PassUniform("stippleOffColor",A=>h.ensureColor4(A.stippleOffColor))),B.code.add(d.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):B.code.add(d.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}function v(k){const p=k.stipplePattern;return c.isSome(p)?g.computeTextureSize(k.stipplePattern)/p.pixelRatio:1}const q=d.glsl.float(.4);a.LineStipple=function(k,p){k.constants.add("stippleAlphaColorDiscard","float",.001);k.constants.add("stippleAlphaHighlightDiscard","float",.5);p.stippleEnabled?l(k,p):k.fragment.code.add(d.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};a.computePixelSize=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/StippleTextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/maybe ../core/shaderModules/interfaces ../../../webgl/enums ../../../webgl/Texture".split(" "),function(a,c,b,t,n,r,m){function d(l){return l.pattern.map(v=>Math.round(v*l.pixelRatio))}
function f(l){if(t.isNone(l))return 1;l=d(l);return Math.floor(l.reduce((v,q)=>v+q))}function e(l){return d(l).reduce((v,q)=>Math.max(v,q))}let g=function(){function l(q){this._rctx=q;this._cache=new Map}var v=l.prototype;v.destroy=function(){this._cache.forEach(q=>t.disposeMaybe(q.stippleTexture));this._cache.clear()};v._acquire=function(q){if(t.isNone(q))return null;const k=this._patternId(q);var p=this._cache.get(k);if(p)return p.refCount++,p;var z=d(q),C=1/q.pixelRatio;p=f(q);q=e(q);const B=(Math.floor(.5*
(q-1))+.5)*C;q=[];let A=1;for(var x of z){for(let D=0;D<x;D++)q.push(A*(Math.min(D,x-1-D)+.5)*C/B*.5+.5);A=-A}x=Math.round(z[0]/2);x=[...q.slice(x),...q.slice(0,x)];p+=2;z=new Uint8Array(4*p);C=4;for(var u of x)b.packFloatRGBA(u,z,C),C+=4;z.copyWithin(0,C-4,C);z.copyWithin(C,4,8);const {encodedData:y,paddedPixels:w}={encodedData:z,paddedPixels:p};u=new h(new m.Texture(this._rctx,{width:w,height:1,internalFormat:r.PixelFormat.RGBA,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE},
y));this._cache.set(k,u);return u};v.release=function(q){if(!t.isNone(q)){q=this._patternId(q);var k=this._cache.get(q);k&&(k.refCount--,0===k.refCount&&(t.isSome(k.stippleTexture)&&k.stippleTexture.dispose(),this._cache.delete(q)))}};v.swap=function(q,k){k=this._acquire(k);this.release(q);return k};v._patternId=function(q){return`${q.pattern.join(",")}-r${q.pixelRatio}`};return l}(),h=function(l){function v(q){var k=l.call(this)||this;k.stippleTexture=q;k.refCount=1;return k}c._inheritsLoose(v,l);
return v}(n.NoParameters);a.STIPPLE_TEXTURE_PADDING=2;a.StippleTextureRepository=g;a.computeLongestPattern=e;a.computeTextureSize=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../core/maybe","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,c,b,t){const n=t.create();a.ensureColor4=function(r){return c.isNone(r)?t.ZEROS:4===r.length?r:b.set(n,r[0],r[1],r[2],1)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl":function(){define("exports ../../../../../../core/maybe ../../../../support/engineContent/marker ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../shaders/LineMarkerTechniqueConfiguration".split(" "),function(a,c,b,t,n,r){a.MarkerSizing=function(m,d){const f=m.vertex;m.constants.add("markerSizePerLineWidth","float",b.MARKER_SIZE_PER_LINE_WIDTH);f.uniforms.add(new t.FloatPassUniform("pixelRatio",
(e,g)=>g.camera.pixelRatio));c.isNone(f.uniforms.get("markerScale"))&&f.constants.add("markerScale","float",1);f.code.add(n.glsl`float getLineWidth() {
return max(getSize(), 1.0) * pixelRatio;
}
float getScreenMarkerSize() {
return markerSizePerLineWidth * markerScale * getLineWidth();
}`);d.space===r.LineMarkerSpace.World&&(f.constants.add("maxSegmentLengthFraction","float",.45),f.uniforms.add(new t.FloatPassUniform("perRenderPixelRatio",(e,g)=>g.camera.perRenderPixelRatio)),f.code.add(n.glsl`float getWorldMarkerSize(vec4 pos) {
float distanceToCamera = length(pos.xyz);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
return getScreenMarkerSize() * screenToWorldRatio;
}
bool areWorldMarkersHidden(vec4 pos, vec4 other) {
vec3 midPoint = mix(pos.xyz, other.xyz, 0.5);
float distanceToCamera = length(midPoint);
float screenToWorldRatio = perRenderPixelRatio * distanceToCamera * 0.5;
float worldMarkerSize = getScreenMarkerSize() * screenToWorldRatio;
float segmentLen = length(pos.xyz - other.xyz);
return worldMarkerSize > maxSegmentLengthFraction * segmentLen;
}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/marker":function(){define(["exports","./sdfPrimitives"],function(a,c){a.MARKER_SIZE_PER_LINE_WIDTH=10;a.MARKER_SYMBOL_SIZE=32;a.MARKER_TEXTURE_SIZE=64;a.MARKER_THICKNESS=6.4;a.MARKER_TIP_THICKNESS_FACTOR=.25;a.prepareMarkerResources=function(b,t){return b.fromData(`${t}-marker`,()=>c.createTexture(t,64,32,6.4))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m){a.CapType=void 0;(function(d){d[d.BUTT=0]="BUTT";d[d.SQUARE=1]="SQUARE";d[d.ROUND=2]="ROUND";d[d.COUNT=3]="COUNT"})(a.CapType||(a.CapType={}));m=function(d){function f(){var e=d.apply(this,arguments)||this;e.output=t.ShaderOutput.Color;e.capType=a.CapType.BUTT;e.transparencyPassType=r.TransparencyPassType.NONE;e.occluder=!1;e.hasSlicePlane=!1;e.hasPolygonOffset=!1;e.writeDepth=!1;e.draped=!1;e.stippleEnabled=!1;e.stippleOffColorEnabled=!1;e.stippleScaleWithLineWidth=!1;e.stipplePreferContinuous=
!0;e.roundJoins=!1;e.applyMarkerOffset=!1;e.vvSize=!1;e.vvColor=!1;e.vvOpacity=!1;e.falloffEnabled=!1;e.innerColorEnabled=!1;e.hasOccludees=!1;e.hasMultipassTerrain=!1;e.cullAboveGround=!1;e.wireframe=!1;e.objectAndLayerIdColorInstanced=!1;return e}c._inheritsLoose(f,d);return f}(m.DefaultTechniqueConfiguration);b.__decorate([n.parameter({count:t.ShaderOutput.COUNT})],m.prototype,"output",void 0);b.__decorate([n.parameter({count:a.CapType.COUNT})],m.prototype,"capType",void 0);b.__decorate([n.parameter({count:r.TransparencyPassType.COUNT})],
m.prototype,"transparencyPassType",void 0);b.__decorate([n.parameter()],m.prototype,"occluder",void 0);b.__decorate([n.parameter()],m.prototype,"hasSlicePlane",void 0);b.__decorate([n.parameter()],m.prototype,"hasPolygonOffset",void 0);b.__decorate([n.parameter()],m.prototype,"writeDepth",void 0);b.__decorate([n.parameter()],m.prototype,"draped",void 0);b.__decorate([n.parameter()],m.prototype,"stippleEnabled",void 0);b.__decorate([n.parameter()],m.prototype,"stippleOffColorEnabled",void 0);b.__decorate([n.parameter()],
m.prototype,"stippleScaleWithLineWidth",void 0);b.__decorate([n.parameter()],m.prototype,"stipplePreferContinuous",void 0);b.__decorate([n.parameter()],m.prototype,"roundJoins",void 0);b.__decorate([n.parameter()],m.prototype,"applyMarkerOffset",void 0);b.__decorate([n.parameter()],m.prototype,"vvSize",void 0);b.__decorate([n.parameter()],m.prototype,"vvColor",void 0);b.__decorate([n.parameter()],m.prototype,"vvOpacity",void 0);b.__decorate([n.parameter()],m.prototype,"falloffEnabled",void 0);b.__decorate([n.parameter()],
m.prototype,"innerColorEnabled",void 0);b.__decorate([n.parameter()],m.prototype,"hasOccludees",void 0);b.__decorate([n.parameter()],m.prototype,"hasMultipassTerrain",void 0);b.__decorate([n.parameter()],m.prototype,"cullAboveGround",void 0);b.__decorate([n.parameter()],m.prototype,"wireframe",void 0);b.__decorate([n.parameter({constValue:!0})],m.prototype,"stippleRequiresClamp",void 0);b.__decorate([n.parameter({constValue:!0})],m.prototype,"stippleRequiresStretchMeasure",void 0);b.__decorate([n.parameter({constValue:!0})],
m.prototype,"hasVvInstancing",void 0);b.__decorate([n.parameter({constValue:!0})],m.prototype,"hasSliceTranslatedView",void 0);b.__decorate([n.parameter()],m.prototype,"objectAndLayerIdColorInstanced",void 0);a.RibbonLineTechniqueConfiguration=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){const k=new Map([[h.VertexAttribute.POSITION,0],[h.VertexAttribute.SUBDIVISIONFACTOR,1],[h.VertexAttribute.UV0,2],[h.VertexAttribute.AUXPOS1,3],[h.VertexAttribute.AUXPOS2,4],[h.VertexAttribute.COLOR,5],[h.VertexAttribute.COLORFEATUREATTRIBUTE,5],[h.VertexAttribute.SIZE,6],[h.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[h.VertexAttribute.OPACITYFEATUREATTRIBUTE,7],[h.VertexAttribute.OBJECTANDLAYERIDCOLOR,8]]);r=function(z){function C(){return z.apply(this,arguments)||
this}b._inheritsLoose(C,z);var B=C.prototype;B.initializeProgram=function(A){return new d.Program(A.rctx,C.shader.get().build(this.configuration),k)};B._makePipelineState=function(A,x){const u=this.configuration,y=A===g.TransparencyPassType.NONE,w=A===g.TransparencyPassType.FrontFace;return q.makePipelineState({blending:u.output===t.ShaderOutput.Color||u.output===t.ShaderOutput.Alpha?y?m.blendingDefault:m.oitBlending(A):null,depthTest:{func:m.oitDepthTest(A)},depthWrite:y?u.writeDepth?q.defaultDepthWriteParams:
null:m.oitDepthWrite(A),colorWrite:q.defaultColorWriteParams,stencilWrite:u.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:u.hasOccludees?x?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:y||w?u.hasPolygonOffset?p:null:m.OITPolygonOffset})};B.initializePipeline=function(){var A=this.configuration;A.occluder&&(A=A.hasPolygonOffset?p:null,this._occluderPipelineTransparent=q.makePipelineState({blending:m.blendingDefault,polygonOffset:A,depthTest:e.depthCompareAlways,depthWrite:null,
colorWrite:q.defaultColorWriteParams,stencilWrite:null,stencilTest:e.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=q.makePipelineState({blending:m.blendingDefault,polygonOffset:A,depthTest:e.depthCompareAlways,depthWrite:null,colorWrite:q.defaultColorWriteParams,stencilWrite:e.stencilWriteMaskOff,stencilTest:e.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=q.makePipelineState({blending:null,polygonOffset:A,depthTest:e.depthCompareLess,depthWrite:null,colorWrite:null,
stencilWrite:e.stencilWriteMaskOn,stencilTest:e.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,!1)};B.getPipelineState=function(A,x){return x?this._occludeePipelineState:this.configuration.occluder?A===f.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:A===f.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:
z.prototype.getPipelineState.call(this,A,x)};b._createClass(C,[{key:"primitiveType",get:function(){return this.configuration.wireframe?v.PrimitiveType.LINES:v.PrimitiveType.TRIANGLE_STRIP}}]);return C}(r.ShaderTechnique);r.shader=new n.ReloadableShaderModule(l.RibbonLine,()=>new Promise((z,C)=>a(["./RibbonLine.glsl"],z,C)));const p={factor:0,units:-4};c.RibbonLineTechnique=r;c.vertexAttributeLocations=k;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports",
"./basicInterfaces","../../../webgl/enums"],function(a,c,b){const t={func:b.CompareFunction.LESS},n={function:{func:b.CompareFunction.ALWAYS,ref:c.StencilBits.OutlineVisualElementMask,mask:c.StencilBits.OutlineVisualElementMask},operation:{fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.ZERO}},r={function:{func:b.CompareFunction.ALWAYS,ref:c.StencilBits.OutlineVisualElementMask,mask:c.StencilBits.OutlineVisualElementMask},operation:{fail:b.StencilOperation.KEEP,
zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.REPLACE}},m={function:{func:b.CompareFunction.EQUAL,ref:c.StencilBits.OutlineVisualElementMask,mask:c.StencilBits.OutlineVisualElementMask},operation:{fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP}};c={function:{func:b.CompareFunction.NOTEQUAL,ref:c.StencilBits.OutlineVisualElementMask,mask:c.StencilBits.OutlineVisualElementMask},operation:{fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP}};
a.depthCompareAlways={func:b.CompareFunction.ALWAYS};a.depthCompareLess=t;a.renderWhenBitIsNotSet=d=>({function:{func:b.CompareFunction.NOTEQUAL,ref:d,mask:d},operation:{fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=d=>({function:{func:b.CompareFunction.ALWAYS,ref:d,mask:d},operation:{fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.REPLACE}});a.stencilBaseAllZerosParams=n;a.stencilToolMaskBaseParams=
r;a.stencilToolMaskOccluderParams=m;a.stencilToolTransparentOccluderParams=c;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/time ../core/shaderLibrary/ShaderOutput ./BindParameters ./Camera ./Material".split(" "),function(a,c,b,t,n,r,m,d){let f=function(){function h(l,
v,q,k=null){this.rctx=l;this.sliceHelper=k;this.lastFrameCamera=new m.Camera;this.output=n.ShaderOutput.Color;this.renderOccludedMask=g;this.bindParameters=new r.BindParameters(v,q,b.isSome(k)?k.plane:null)}h.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=g};return h}(),e=function(h){function l(v,q,k,p,z){v=h.call(this,v,k,p,z)||this;v.offscreenRenderingHelper=q;v.sliceHelper=z;v.time=t.Milliseconds(0);return v}c._inheritsLoose(l,h);return l}(f);const g=d.RenderOccludedFlag.Occlude|
d.RenderOccludedFlag.OccludeAndTransparent|d.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=f;a.RenderContext=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../ViewingMode ./CascadeCamera ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A){function x(da,ea){f.set(U,da[ea],da[ea+3]);return U}a.SnapshotSlot=void 0;(function(da){da[da.Highlight=0]="Highlight";da[da.Default=1]="Default"})(a.SnapshotSlot||(a.SnapshotSlot={}));let u=function(){this.camera=new k.CascadeCamera;this.lightMat=d.create()},y=function(){function da(ca,ja){this._rctx=ca;this._viewingMode=ja;this._enabled=!1;this._snapshots=[];this._textureSize=0;this._numCascades=1;this._maxNumCascades=4;this._projectionView=d.create();
this._projectionViewInverse=d.create();this._modelViewLight=d.create();this._splitSchemeLambda=0;this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=v.create();this._cascades=[new u,new u,new u,new u];this._lastOrigin=null;this._maxTextureSize=Math.min(b("esri-mobile")?2048:8192,this._rctx.parameters.maxTextureSize)}var ea=da.prototype;ea.dispose=function(){this.enabled=!1;this.disposeOffscreenBuffers()};ea.disposeOffscreenBuffers=function(){this._discardDepthTexture();this._discardAllSnapshots()};
ea.getSnapshot=function(ca){return this.enabled?this._snapshots[ca]:null};ea.start=function(ca,ja,ia){p.assert(this.enabled);this._textureSize=this._computeTextureSize(ca.fullWidth,ca.fullHeight);this._ensureDepthTexture();const {near:Z,far:ha}=this._clampNearFar(ia);this._computeCascadeDistances(ha,Z);this._setupMatrices(ca,ja);const {viewMatrix:fa,projectionMatrix:ka}=ca;for(ca=0;ca<this._numCascades;++ca)this._constructCascade(ca,ka,fa,ja);this._lastOrigin=null;this.clear()};ea.finish=function(ca){p.assert(this.enabled);
this._rctx.bindFramebuffer(ca)};ea.getShadowMapMatrices=function(ca){if(!this._lastOrigin||!g.exactEquals(ca,this._lastOrigin)){this._lastOrigin=this._lastOrigin||h.create();g.copy(this._lastOrigin,ca);for(let ja=0;ja<this._numCascades;++ja){m.translate(G,this._cascades[ja].lightMat,ca);for(let ia=0;16>ia;++ia)H[16*ja+ia]=G[ia]}}return H};ea.takeCascadeSnapshotTo=function(ca,ja){p.assert(this.enabled);var ia=this._ensureSnapshot(ja);this._bindFbo();ja=this._rctx;ia=ja.bindTexture(ia,B.Texture.TEXTURE_UNIT_FOR_UPDATES);
ja.gl.copyTexSubImage2D(z.TextureType.TEXTURE_2D,0,ca.camera.viewport[0],ca.camera.viewport[1],ca.camera.viewport[0],ca.camera.viewport[1],ca.camera.viewport[2],ca.camera.viewport[3]);ja.bindTexture(ia,B.Texture.TEXTURE_UNIT_FOR_UPDATES)};ea.clear=function(){const ca=this._rctx;this._bindFbo();ca.setClearColor(1,1,1,1);ca.clearSafe(z.ClearBufferBit.COLOR_BUFFER_BIT|z.ClearBufferBit.DEPTH_BUFFER_BIT)};ea._computeTextureSize=function(ca,ja){return Math.min(this._maxTextureSize,2*2**Math.round(.5*Math.log(ca*
ca+ja*ja)*Math.LOG2E+.35))};ea._ensureDepthTexture=function(){n.isSome(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize||(this._discardDepthTexture(),this._depthTexture=new B.Texture(this._rctx,{target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:z.TextureSamplingMode.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize}),this._fbo=new C.FramebufferObject(this._rctx,
{colorTarget:z.TargetType.TEXTURE,depthStencilTarget:z.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:this._textureSize,height:this._textureSize},this._depthTexture))};ea._ensureSnapshot=function(ca){let ja=this._snapshots[ca];if(n.isSome(ja)&&ja.descriptor.width===this._textureSize)return ja;this._discardSnapshot(ca);ja=new B.Texture(this._rctx,{target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:z.TextureSamplingMode.NEAREST,
flipped:!0,width:this._textureSize,height:this._textureSize});return this._snapshots[ca]=ja};ea._discardDepthTexture=function(){this._fbo=n.disposeMaybe(this._fbo);this._depthTexture=n.disposeMaybe(this._depthTexture)};ea._discardSnapshot=function(ca){this._snapshots[ca]=n.disposeMaybe(this._snapshots[ca])};ea._discardAllSnapshots=function(){for(let ca=0;ca<this._snapshots.length;++ca)this._discardSnapshot(ca);this._snapshots.length=0};ea._bindFbo=function(){const ca=this._rctx;ca.unbindTexture(this._depthTexture);
ca.bindFramebuffer(this._fbo)};ea._constructCascade=function(ca,ja,ia,Z){const ha=this._cascades[ca];var fa=-this._cascadeDistances[ca],ka=-this._cascadeDistances[ca+1];fa=(ja[10]*fa+ja[14])/Math.abs(ja[11]*fa+ja[15]);ja=(ja[10]*ka+ja[14])/Math.abs(ja[11]*ka+ja[15]);p.assert(fa<ja);for(ka=0;8>ka;++ka){l.set(D,0===ka%4||3===ka%4?-1:1,0===ka%4||1===ka%4?-1:1,4>ka?fa:ja,1);var la=F[ka];l.transformMat4(la,D,this._projectionViewInverse);la[0]/=la[3];la[1]/=la[3];la[2]/=la[3]}g.negate(P,F[0]);ha.camera.viewMatrix=
m.translate(w,this._modelViewLight,P);for(fa=0;8>fa;++fa)g.transformMat4(F[fa],F[fa],ha.camera.viewMatrix);fa=F[0][2];ja=F[0][2];for(ka=1;8>ka;++ka)fa=Math.min(fa,F[ka][2]),ja=Math.max(ja,F[ka][2]);fa-=200;ja+=200;ha.camera.near=-ja;ha.camera.far=-fa;ka=ha.camera;la=1/F[0][3];var na=1/F[4][3];p.assert(la<na);la+=Math.sqrt(la*na);var pa=Math.sin(t.acosClamped(ia[2]*Z[0]+ia[6]*Z[1]+ia[10]*Z[2]));ia=F;var va=la/pa;Z=E;var wa=K,za=J;na=M;la=N;f.set(L,0,0);for(var sa=0;4>sa;++sa)f.add(L,L,ia[sa]);f.scale(L,
L,.25);f.set(O,0,0);for(sa=4;8>sa;++sa)f.add(O,O,ia[sa]);f.scale(O,O,.25);f.lerp(S[0],ia[4],ia[5],.5);f.lerp(S[1],ia[5],ia[6],.5);f.lerp(S[2],ia[6],ia[7],.5);f.lerp(S[3],ia[7],ia[4],.5);sa=0;var ua=f.squaredDistance(S[0],L);for(var oa=1;4>oa;++oa){var xa=f.squaredDistance(S[oa],L);xa<ua&&(ua=xa,sa=oa)}f.subtract(R,S[sa],ia[sa+4]);sa=R[0];R[0]=-R[1];R[1]=sa;f.subtract(Q,O,L);0>f.dot(Q,R)&&f.negate(R,R);f.lerp(R,R,Q,pa);f.normalize(R,R);pa=sa=f.dot(f.subtract(V,ia[0],L),R);for(ua=1;8>ua;++ua)oa=f.dot(f.subtract(V,
ia[ua],L),R),oa<pa?pa=oa:oa>sa&&(sa=oa);f.copy(Z,L);f.scale(V,R,pa-va);f.add(Z,Z,V);oa=-1;xa=1;va=ua=0;for(let Ea=0;8>Ea;++Ea){f.subtract(aa,ia[Ea],Z);f.normalize(aa,aa);const Ia=R[0]*aa[1]-R[1]*aa[0];0<Ia?Ia>oa&&(oa=Ia,ua=Ea):Ia<xa&&(xa=Ia,va=Ea)}p.verify(0<oa,"leftArea");p.verify(0>xa,"rightArea");f.scale(X,R,pa);f.add(X,X,L);f.scale(W,R,sa);f.add(W,W,L);T[0]=-R[1];T[1]=R[0];wa=p.rayRay2D(Z,ia[va],W,f.add(V,W,T),1,wa);za=p.rayRay2D(Z,ia[ua],W,V,1,za);na=p.rayRay2D(Z,ia[ua],X,f.add(V,X,T),1,na);
ia=p.rayRay2D(Z,ia[va],X,V,1,la);p.verify(wa,"rayRay");p.verify(za,"rayRay");p.verify(na,"rayRay");p.verify(ia,"rayRay");za=E;ia=K;Z=M;na=N;la=ka.projectionMatrix;f.subtract(Y,Z,na);f.scale(Y,Y,.5);ba[0]=Y[0];ba[1]=Y[1];ba[2]=0;ba[3]=Y[1];ba[4]=-Y[0];ba[5]=0;ba[6]=Y[0]*Y[0]+Y[1]*Y[1];ba[7]=Y[0]*Y[1]-Y[1]*Y[0];ba[8]=1;ba[6]=-f.dot(x(ba,0),za);ba[7]=-f.dot(x(ba,1),za);za=f.dot(x(ba,0),Z)+ba[6];wa=f.dot(x(ba,1),Z)+ba[7];va=f.dot(x(ba,0),na)+ba[6];na=f.dot(x(ba,1),na)+ba[7];za=-(za+va)/(wa+na);ba[0]+=
ba[1]*za;ba[3]+=ba[4]*za;ba[6]+=ba[7]*za;za=1/(f.dot(x(ba,0),Z)+ba[6]);wa=1/(f.dot(x(ba,1),Z)+ba[7]);ba[0]*=za;ba[3]*=za;ba[6]*=za;ba[1]*=wa;ba[4]*=wa;ba[7]*=wa;ba[2]=ba[1];ba[5]=ba[4];ba[8]=ba[7];ba[7]+=1;za=f.dot(x(ba,1),ia)+ba[7];wa=f.dot(x(ba,2),ia)+ba[8];va=f.dot(x(ba,1),Z)+ba[7];na=f.dot(x(ba,2),Z)+ba[8];za=-.5*(za/wa+va/na);ba[1]+=ba[2]*za;ba[4]+=ba[5]*za;ba[7]+=ba[8]*za;za=f.dot(x(ba,1),ia)+ba[7];wa=f.dot(x(ba,2),ia)+ba[8];va=-wa/za;ba[1]*=va;ba[4]*=va;ba[7]*=va;la[0]=ba[0];la[1]=ba[1];la[2]=
0;la[3]=ba[2];la[4]=ba[3];la[5]=ba[4];la[6]=0;la[7]=ba[5];la[8]=0;la[9]=0;la[10]=1;la[11]=0;la[12]=ba[6];la[13]=ba[7];la[14]=0;la[15]=ba[8];ka.projectionMatrix[10]=2/(fa-ja);ka.projectionMatrix[14]=-(fa+ja)/(fa-ja);m.multiply(ha.lightMat,ha.camera.projectionMatrix,ha.camera.viewMatrix);fa=this._textureSize/2;ha.camera.viewport=[0===ca%2?0:fa,0===Math.floor(ca/2)?0:fa,fa,fa]};ea._setupMatrices=function(ca,ja){m.multiply(this._projectionView,ca.projectionMatrix,ca.viewMatrix);m.invert(this._projectionViewInverse,
this._projectionView);ca=this._viewingMode===q.ViewingMode.Global?ca.eye:g.set(P,0,0,1);m.lookAt(this._modelViewLight,[0,0,0],[-ja[0],-ja[1],-ja[2]],ca)};ea._clampNearFar=function(ca){let {near:ja,far:ia}=ca;2>ja&&(ja=2);2>ia&&(ia=2);ja>=ia&&(ja=2,ia=4);return{near:ja,far:ia}};ea._computeCascadeDistances=function(ca,ja){this._numCascades=Math.min(1+Math.floor(p.logWithBase(ca/ja,4)),this._maxNumCascades);const ia=(ca-ja)/this._numCascades;ca=(ca/ja)**(1/this._numCascades);let Z=ja;for(let ha=0;ha<
this._numCascades+1;++ha)this._cascadeDistances[ha]=t.lerp(Z,ja,this._splitSchemeLambda),Z*=ca,ja+=ia};c._createClass(da,[{key:"depthTexture",get:function(){return this._depthTexture}},{key:"textureSize",get:function(){return this._textureSize}},{key:"numCascades",get:function(){return this._numCascades}},{key:"cascadeDistances",get:function(){return l.set(this._usedCascadeDistances,this._cascadeDistances[0],1<this._numCascades?this._cascadeDistances[1]:Infinity,2<this._numCascades?this._cascadeDistances[2]:
Infinity,3<this._numCascades?this._cascadeDistances[3]:Infinity)}},{key:"maxCascades",get:function(){return this._maxNumCascades},set:function(ca){this._maxNumCascades=t.clamp(Math.floor(ca),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(ca){this._enabled=ca;ca||(this._discardDepthTexture(),this._discardAllSnapshots())}},{key:"ready",get:function(){return this._enabled&&n.isSome(this._depthTexture)}},{key:"cascades",get:function(){for(let ca=0;ca<this._numCascades;++ca)I[ca]=
this._cascades[ca];I.length=this._numCascades;return I}},{key:"gpuMemoryUsage",get:function(){return this._snapshots.reduce((ca,ja)=>ca+A.getGpuMemoryUsage(ja),this._fbo?.gpuMemoryUsage??0)}},{key:"test",get:function(){const ca=this;return{maxNumCascades:this._maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(ja){ca._splitSchemeLambda=ja},get splitSchemeLambda(){return ca._splitSchemeLambda}}}}]);return da}();const w=d.create(),D=v.create(),F=[];for(let da=
0;8>da;++da)F.push(v.create());const E=e.create(),K=e.create(),J=e.create(),M=e.create(),N=e.create(),P=h.create(),I=[],G=d.create(),H=new Float32Array(64),L=e.create(),O=e.create(),S=[e.create(),e.create(),e.create(),e.create()],R=e.create(),Q=e.create(),V=e.create(),aa=e.create(),X=e.create(),W=e.create(),T=e.create(),U=e.create(),Y=e.create(),ba=r.create();a.ShadowMap=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CascadeCamera":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4f64 ./Camera".split(" "),
function(a,c,b,t,n,r,m,d,f){a.CascadeCamera=function(e){function g(){var h=e.apply(this,arguments)||this;h._projectionMatrix=d.create();return h}c._inheritsLoose(g,e);c._createClass(g,[{key:"projectionMatrix",get:function(){return this._projectionMatrix}}]);return g}(f.Camera);b.__decorate([t.property()],a.CascadeCamera.prototype,"_projectionMatrix",void 0);b.__decorate([t.property({readOnly:!0})],a.CascadeCamera.prototype,"projectionMatrix",null);a.CascadeCamera=b.__decorate([m.subclass("esri.views.3d.webgl-engine.lib.CascadeCamera")],
a.CascadeCamera);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec2f64 ../../terrain/Intersector ./ChangeSet ./Intersector ./IntersectorInterfaces ./ModelDirtyTypes ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){function B(u,y,w,D,F,E,K){const J=new l.OverlayTarget(E,K,y);y=M=>{M.set(k.IntersectorType.OVERLAY,J,u.dist,u.normal,u.transformation,w,D)};(null==F.results.min.drapedLayerOrder||w>=F.results.min.drapedLayerOrder)&&(null==F.results.min.dist||F.results.ground.dist<=F.results.min.dist)&&y(F.results.min);F.options.store!==k.StoreResults.MIN&&(null==F.results.max.drapedLayerOrder||w<F.results.max.drapedLayerOrder)&&(null==F.results.max.dist||F.results.ground.dist>
F.results.max.dist)&&y(F.results.max);F.options.store===k.StoreResults.ALL&&(E=q.newIntersectorResult(F.ray),y(E),F.results.all.push(E))}a.SortedRenderGeometryRenderer=function(u){function y(D){D=u.call(this,D)||this;D._pending=new A;D._changes=new v.ChangeSet;D._materialRenderers=new Map;D._sortedMaterialRenderers=new m;D._geometries=new Map;D._hasHighlights=!1;D._hasWater=!1;return D}c._inheritsLoose(y,u);var w=y.prototype;w.destroy=function(){this._changes.prune();this._materialRenderers.forEach(D=>
D.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear();this._geometries.clear()};w.commitChanges=function(){if(!this.updating)return!1;this._processAddsRemoves();let D=!1,F=!1,E=!1;z.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((K,J)=>{let M=this._materialRenderers.get(J);!M&&0<K.adds.length&&(M=new C.MergedRenderer(this.rctx,this._materialRepository,J),this._materialRenderers.set(J,M),E=F=D=!0);if(M){var N=F||M.hasHighlights,P=E||M.hasWater;M.modify(K);
F=F||N!==M.hasHighlights;E=E||P!==M.hasWater;M.isEmpty&&(this._materialRenderers.delete(J),M.dispose(),D=!0)}});this._changes.clear();D&&this._updateSortedMaterialRenderers();F&&(this._hasHighlights=n.someMap(this._materialRenderers,K=>K.hasHighlights));E&&(this._hasWater=n.someMap(this._materialRenderers,K=>K.hasWater));this.notifyChange("updating");return!0};w.addGeometries=function(D,F){if(0!==D.length){var E=this._validateRenderGeometries(D);for(var K of E)this._geometries.set(K.id,K);K=this._pending.empty;
for(const J of E)this._pending.adds.add(J);K&&this.notifyChange("updating");F===p.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(D)}};w.removeGeometries=function(D,F){const E=this._pending.empty,K=this._pending.adds;for(const J of D)K.has(J)?(this._pending.removed.add(J),K.delete(J)):this._pending.removed.has(J)||this._pending.removes.add(J),this._geometries.delete(r.unwrap(J.id));E&&!this._pending.empty&&this.notifyChange("updating");F===p.DirtyOperation.UPDATE&&this._notifyGraphicGeometryChanged(D)};
w.modifyGeometries=function(D,F){const E=0===this._changes.updates.length;for(const K of D){const J=this._changes.updates.pushNew();J.renderGeometry=this._validateRenderGeometry(K);J.updateType=F}E&&0<this._changes.updates.length&&this.notifyChange("updating");switch(F){case p.DirtyState.TRANSFORMATION:case p.DirtyState.GEOMETRY:return this._notifyGraphicGeometryChanged(D);case p.DirtyState.VISIBILITY:return this._notifyGraphicVisibilityChanged(D)}};w.updateAnimation=function(D){let F=!1;this._sortedMaterialRenderers.forAll(E=>
F=E.updateAnimation(D)||F);return F};w.render=function(D){this._sortedMaterialRenderers.forAll(F=>{F.material.shouldRender(D)&&F.render(D.output,D.bindParameters)})};w.intersect=function(D,F,E,K,J){this._geometries.forEach(M=>{if(!K||K(M)){this._intersectRenderGeometry(M,E,F,0,D,J);var N=this.rendererContext.longitudeCyclical;N&&(M.boundingSphere[0]-M.boundingSphere[3]<N.min&&this._intersectRenderGeometry(M,E,F,N.range,D,J),M.boundingSphere[0]+M.boundingSphere[3]>N.max&&this._intersectRenderGeometry(M,
E,F,-N.range,D,J));J++}});return J};w._updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let D=0;this._materialRenderers.forEach((F,E)=>{E.insertOrder=D++;this._sortedMaterialRenderers.push(F)});this._sortedMaterialRenderers.sort((F,E)=>{const K=E.material.renderPriority-F.material.renderPriority;return 0!==K?K:F.material.insertOrder-E.material.insertOrder})};w._processAddsRemoves=function(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));
this._changes.removes.pushArray(Array.from(this._pending.removes));for(let D=0;D<this._changes.updates.length;)this._pending.has(this._changes.updates.data[D].renderGeometry)?this._changes.updates.removeUnorderedIndex(D):D++;this._pending.clear()};w._intersectRenderGeometry=function(D,F,E,K,J,M){if(D.visible){var N=0;K+=D.transformation[12];N=D.transformation[13];x[0]=E[0]-K;x[1]=E[1]-N;D.screenToWorldRatio=this.rendererContext.screenToWorldRatio;D.material.intersectDraped(D,null,J,x,(P,I,G)=>{B(F,
G,D.material.renderPriority,M,J,D.layerUid,D.graphicUid)},F)}};w._notifyGraphicGeometryChanged=function(D){if(!r.isNone(this.drapeSource.notifyGraphicGeometryChanged))for(const E of D)if(D=E.graphicUid,r.isSome(D)&&D!==F){this.drapeSource.notifyGraphicGeometryChanged(D);var F=D}};w._notifyGraphicVisibilityChanged=function(D){if(!r.isNone(this.drapeSource.notifyGraphicVisibilityChanged))for(const E of D)if(D=E.graphicUid,r.isSome(D)&&D!==F){this.drapeSource.notifyGraphicVisibilityChanged(D);var F=
D}};w._validateRenderGeometries=function(D){for(const F of D)this._validateRenderGeometry(F);return D};w._validateRenderGeometry=function(D){r.isNone(D.localOrigin)&&(D.localOrigin=this._localOriginFactory.getOrigin(D.boundingSphere));return D};c._createClass(y,[{key:"updating",get:function(){return!this._pending.empty||0<this._changes.updates.length}},{key:"rctx",get:function(){return this.rendererContext.rctx}},{key:"_materialRepository",get:function(){return this.rendererContext.materialRepository}},
{key:"_localOriginFactory",get:function(){return this.rendererContext.localOriginFactory}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return n.someMap(this._materialRenderers,D=>D.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);
return y}(t);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,"drapeSource",void 0);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,"rctx",null);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,"rendererContext",void 0);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRepository",null);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,
"_localOriginFactory",null);b.__decorate([d.property({readOnly:!0})],a.SortedRenderGeometryRenderer.prototype,"isEmpty",null);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRenderers",void 0);b.__decorate([d.property()],a.SortedRenderGeometryRenderer.prototype,"_geometries",void 0);a.SortedRenderGeometryRenderer=b.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);let A=function(){function u(){this.adds=
new Set;this.removes=new Set;this.removed=new Set}var y=u.prototype;y.has=function(w){return this.adds.has(w)||this.removes.has(w)||this.removed.has(w)};y.clear=function(){this.adds.clear();this.removes.clear();this.removed.clear()};c._createClass(u,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}}]);return u}();const x=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Intersector":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/IntersectorTarget","../webgl-engine/lib/intersectorUtils"],function(a,c,b,t,n){t=function(r){function m(d,f,e){d=r.call(this,d,f)||this;d.triangleNr=e;return d}c._inheritsLoose(m,r);return m}(t.Graphic3DTarget);a.OverlayTarget=t;a.isOverlayIntersectorResult=function(r){return n.isValidIntersectorResult(r)&&r.intersector===b.IntersectorType.OVERLAY&&!!r.target};a.isTerrainIntersectorResult=
function(r){return n.isValidIntersectorResult(r)&&r.intersector===b.IntersectorType.TERRAIN&&!!r.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray"],function(a,c,b){let t=function(){function r(){this.adds=new b;this.removes=new b;this.updates=new b({allocator:d=>d||new n,deallocator:d=>{d.renderGeometry=null;return d}})}var m=r.prototype;
m.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};m.prune=function(){this.adds.prune();this.removes.prune();this.updates.prune()};c._createClass(r,[{key:"empty",get:function(){return 0===this.adds.length&&0===this.removes.length&&0===this.updates.length}}]);return r}(),n=function(){};a.ChangeSet=t;a.MaterialChangeSet=function(){this.adds=[];this.removes=[];this.updates=[]};a.RenderGeometryUpdate=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],
function(a){a.DirtyOperation=void 0;(function(c){c[c.ADD=0]="ADD";c[c.UPDATE=1]="UPDATE";c[c.REMOVE=2]="REMOVE"})(a.DirtyOperation||(a.DirtyOperation={}));a.DirtyState=void 0;(function(c){c[c.NONE=0]="NONE";c[c.VISIBILITY=1]="VISIBILITY";c[c.GEOMETRY=2]="GEOMETRY";c[c.TRANSFORMATION=4]="TRANSFORMATION";c[c.HIGHLIGHT=8]="HIGHLIGHT";c[c.OCCLUDEE=16]="OCCLUDEE"})(a.DirtyState||(a.DirtyState={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports",
"./ChangeSet"],function(a,c){a.splitRenderGeometryChangeSetByMaterial=function(b){const t=new Map,n=r=>{let m=t.get(r);m||(m=new c.MaterialChangeSet,t.set(r,m));return m};b.removes.forAll(r=>{1<=r.geometry.indexCount&&n(r.material).removes.push(r)});b.adds.forAll(r=>{1<=r.geometry.indexCount&&n(r.material).adds.push(r)});b.updates.forAll(r=>{1<=r.renderGeometry.geometry.indexCount&&n(r.renderGeometry.material).updates.push(r)});return t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/arrayUtils ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/NestedMap ../../../../../core/PooledArray ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../core/shaderLibrary/ShaderOutput ../../lib/AppleAmdDriverHelper ../../lib/GLMaterials ../../lib/Material ../../lib/ModelDirtyTypes ../../lib/Util ../DrawParameters ../WaterMaterial ./BufferRange ./Instance ./PerBufferData ./PerOriginData ./VaoCache".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){function y(I,G){let H;if(!I.some(O=>{if(O.numElements<G)return!1;H=O;return!0}))return null;const L=H.from;H.from+=G;H.from>=H.to&&I.removeUnordered(H);return L}function w(I){P.length<I&&(P=new Float32Array(I));return P}function D(I){I*=4;return 262144>I?262144:Math.max(Math.min(262144*Math.ceil(1.5*I/262144),16777216),I)}let F=function(){function I(H,L,O){this._rctx=H;this._materialRepository=L;this.material=O;this._dataByOrigin=new Map;this._appleAmdDriverHelper=
null;this._hasOccludees=this._hasHighlights=!1;this._glMaterials=new l.GLMaterials(this.material,this._materialRepository);this._bufferWriter=O.createBufferWriter();this._vaoCache=new u.VaoCache(H,O.vertexAttributeLocations,e.glLayout(this._bufferWriter.vertexBufferLayout));this._rctx.driverTest.drawArraysRequiresIndicesTypeReset.result&&(this._appleAmdDriverHelper=new h.AppleAmdDriverHelper(this._rctx))}var G=I.prototype;G.dispose=function(){this._glMaterials.destroy();this._dataByOrigin.forEach(H=>
H.dispose());this._dataByOrigin.clear();this._vaoCache.dispose();this._appleAmdDriverHelper?.dispose()};G.forEachGeometry=function(H){this._dataByOrigin.forEach(L=>L.buffers.forEach(O=>O.instances.forEach(S=>H(S.geometry))))};G.modify=function(H){this._updateGeometries(H.updates);this._addAndRemoveGeometries(H.adds,H.removes);this._updateDrawCommands()};G._updateGeometries=function(H){const L=this._bufferWriter,O=L.vertexBufferLayout.stride/4;for(const R of H){H=R.renderGeometry;const Q=this._dataByOrigin.get(H.localOrigin.id)?.findBuffer(H.id);
if(n.isNone(Q))break;const V=Q.instances.get(H.id);if(R.updateType&(q.DirtyState.GEOMETRY|q.DirtyState.TRANSFORMATION)){var S=L.elementCount(V.geometry.geometry)*O;S=w(S);const aa=L.vertexBufferLayout.createView(S.buffer);this._writeGeometry(H,aa,0);Q.vao.vertexBuffers.geometry.setSubData(S,V.from*O,0,V.numElements*O)}R.updateType&(q.DirtyState.HIGHLIGHT|q.DirtyState.OCCLUDEE|q.DirtyState.VISIBILITY)&&(Q.drawCommandsDirty=!0)}};G._computeDeltas=function(H,L){const O=new r.NestedMap;for(var S of H){H=
S.localOrigin;if(n.isNone(H))continue;let R=O.get(H.id,null);n.isNone(R)&&(R=new E(H.vec3),O.set(H.id,null,R));R.changes.push(S)}for(const R of L)L=R.localOrigin,n.isNone(L)||(S=this._dataByOrigin.get(L.id)?.findBuffer(R.id),n.isNone(S)||(H=O.get(L.id,S),n.isNone(H)&&(H=new E(L.vec3),O.set(L.id,S,H)),H.changes.push(R)));return O};G._addAndRemoveGeometries=function(H,L){const {_bufferWriter:O,_dataByOrigin:S}=this,R=O.vertexBufferLayout.stride/4,Q=this._computeDeltas(H,L);Q.forEach((V,aa)=>{const X=
V.get(null),W=n.isSome(X)?X.changes:[];Q.delete(aa,null);let T=S.get(aa);V.forEach((U,Y)=>{Q.delete(aa,Y);if(n.isNone(Y))k.assert(!1,"No VAO for removed geometries");else if(Y.instances.size===U.changes.length)this._vaoCache.deleteVao(Y.vao),b.removeUnordered(T.buffers,Y),0===T.buffers.length&&0===W.length&&S.delete(aa);else{var ba=Y.numElements,da=Y.vao.size/4,ea=W.reduce((ja,ia)=>ja+O.elementCount(ia.geometry),0),ca=U.changes.reduce((ja,ia)=>ja+O.elementCount(ia.geometry),0);ba=Math.min((ba+ea-
ca)*R,4194304);ea=ba>da;65536<ba&&ba<da/2?(U.changes.forEach(({id:ja})=>Y.deleteInstance(ja)),Y.instances.forEach(({geometry:ja})=>W.push(ja)),this._vaoCache.deleteVao(Y.vao),b.removeUnordered(T.buffers,Y)):ea?this._applyAndRebuild(Y,W,U):this._applyRemoves(Y,U)}});if(0<W.length)for(n.isNone(T)&&(T=new x.PerOriginData(X.origin),S.set(aa,T)),T.buffers.forEach(U=>this._applyAdds(U,W));0<W.length;)T.buffers.push(this._applyAndRebuild(new A.PerBufferData,W,null))})};G._updateDrawCommands=function(){this._hasOccludees=
this._hasHighlights=!1;this._dataByOrigin.forEach(H=>{H.buffers.forEach(L=>{L.drawCommandsDirty&&(L.hasHiddenInstances=!1,L.hasHighlights=!1,L.hasOccludees=!1,t.someMap(L.instances,O=>{L.updateDrawState(O);return L.hasHiddenInstances&&L.hasHighlights&&L.hasOccludees}),L.updateDrawCommands(this._bufferWriter.vertexBufferLayout.stride));this._hasHighlights=this._hasHighlights||L.hasHighlights;this._hasOccludees=this._hasOccludees||L.hasOccludees})})};G._applyAndRebuild=function(H,L,O){if(n.isSome(O))for(var S of O.changes)H.deleteInstance(S.id);
const R=this._bufferWriter;O=R.vertexBufferLayout.stride;S=O/4;var Q=Math.floor(4194304/S);let V=H.numElements;for(;0<L.length;){const T=L.pop();var aa=R.elementCount(T.geometry);if(V+aa>Q&&0<V){L.push(T);break}V+=aa;aa=new B.Instance(T,0,0);k.assert(null==H.instances.get(T.id));H.addInstance(T.id,aa)}L=V*S;Q=w(L);const X=R.vertexBufferLayout.createView(Q.buffer);let W=0;H.hasHiddenInstances=!1;H.hasHighlights=!1;H.hasOccludees=!1;H.instances.forEach((T,U)=>{this._writeGeometry(T.geometry,X,W);const Y=
W;W+=R.elementCount(T.geometry.geometry);H.updateInstance(U,Y,W);H.updateDrawState(T)});this._vaoCache.deleteVao(H.vao);H.vao=this._vaoCache.newVao(D(L));H.vao.vertexBuffers.geometry.setSubData(Q,0,0,W*S);H.holes.clear();L=H.holes.pushNew();L.from=W;L.to=Math.floor(H.vao.size/O);H.updateDrawCommands(O);return H};G._applyRemoves=function(H,L){if(0!==L.changes.length){for(var O of L.changes){var S=O.id;if(L=H.instances.get(S)){H.deleteInstance(S);if(S=N.back()){if(S.to===L.from){S.to=L.to;continue}if(S.from===
L.to){S.from=L.from;continue}}S=N.pushNew();S.from=L.from;S.to=L.to}}C.mergeAdjacentRanges(N);var R=this._bufferWriter.vertexBufferLayout.stride/4;O=N.reduce((aa,X)=>Math.max(aa,X.numElements),0)*R;var Q=w(O);Q.fill(0,0,O);var V=H.vao.vertexBuffers.geometry;N.forAll(aa=>V.setSubData(Q,aa.from*R,0,aa.numElements*R));H.holes.pushArray(N.data,N.length);N.forAll((aa,X)=>N.data[X]=null);N.clear();H.drawCommandsDirty=!0}};G._applyAdds=function(H,L){if(0!==L.length)if(A.hasVao(H)){var O=this._bufferWriter,
S=O.vertexBufferLayout.stride/4,R=H.numElements,Q=L.reduce((da,ea)=>da+O.elementCount(ea.geometry),0);R=Math.min((R+Q)*S,4194304);Q=4*R;if(H.vao.size<D(4128768)&&Q>H.vao.size)this._applyAndRebuild(H,L,null);else{C.mergeAdjacentRanges(H.holes);var V=[];for(var aa of L)Q=O.elementCount(aa.geometry),Q=y(H.holes,Q),V.push(Q);var X=H.vao.vertexBuffers.geometry,W=0,T=0,U=0,Y=w(R),ba=O.vertexBufferLayout.createView(Y.buffer);L.forEach((da,ea)=>{ea=V[ea];if(!n.isNone(ea)){if(U!==ea){var ca=U-T;0<ca&&X.setSubData(Y,
T*S,0,ca*S);T=ea;W=0}ca=O.elementCount(da.geometry);this._writeGeometry(da,ba,W);W+=ca;U=ea+ca;ea=new B.Instance(da,ea,ea+ca);k.assert(null==H.instances.get(da.id));H.addInstance(da.id,ea);H.drawCommandsDirty=!0}});aa=U-T;0<aa&&X.setSubData(Y,T*S,0,aa*S);b.filterInPlace(L,(da,ea)=>n.isNone(V[ea]))}}else this._applyAndRebuild(H,L,null)};G._writeGeometry=function(H,L,O){var S=H.localOrigin.vec3;k.setMatrixTranslation3(K,-S[0],-S[1],-S[2]);S=d.multiply(J,K,H.transformation);d.invert(M,S);d.transpose(M,
M);this._bufferWriter.write(S,M,H.geometry,L,O)};G.updateAnimation=function(H){return this.material.update(H)};G.requiresSlot=function(H,L){return this.material.requiresSlot(H,L)};G.render=function(H,L){if(!this.requiresSlot(L.slot,H))return!1;const O=H===g.ShaderOutput.Highlight||H===g.ShaderOutput.ShadowHighlight;if(O&&!this._hasHighlights)return!1;const S=H===g.ShaderOutput.ShadowExcludeHighlight,R=!(O||S),Q=this._rctx;let V;const aa=()=>{if(n.isSome(V))return V;const X=this._glMaterials.load(Q,
L.slot,H);if(n.isNone(X))return null;V=X.beginSlot(L);if(n.isNone(V))return null;Q.bindTechnique(V,this.material.parameters,L);return V};this._appleAmdDriverHelper?.resetIndicesType();for(const X of this._dataByOrigin.values())for(const W of X.buffers){if(O&&!W.hasHighlights)continue;const T=(O?W.drawCommandsHighlight:S&&W.needsMultipleCommands()?W.drawCommandsShadowHighlightRest:W.drawCommandsDefault)||null,U=R&&W.drawCommandsOccludees||null;if(T?.length||U?.length){const Y=aa();if(n.isNone(Y))return!1;
Y.program.bindDraw(new p.DrawParameters(X.origin),L,this.material.parameters);Y.ensureAttributeLocations(W.vao);Q.bindVAO(W.vao);T?.length&&(Y.bindPipelineState(Q,L.slot,!1),T.forAll(ba=>Q.drawArrays(Y.primitiveType,ba.first,ba.count)));U?.length&&(Y.bindPipelineState(Q,L.slot,!0),U.forAll(ba=>Q.drawArrays(Y.primitiveType,ba.first,ba.count)))}}return n.isSome(V)};c._createClass(I,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},
{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this.material instanceof z.WaterMaterial}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this.material.renderOccluded!==v.RenderOccludedFlag.Occlude}},{key:"numGeometries",get:function(){let H=0;this._dataByOrigin.forEach(L=>H+=L.buffers.reduce((O,S)=>O+=S.instances.size,0));return H}},{key:"test",get:function(){return{material:this.material,glMaterials:this._glMaterials,
dataByOrigin:this._dataByOrigin}}}]);return I}(),E=function(I){this.origin=I;this.changes=[]};const K=f.create(),J=f.create(),M=f.create(),N=new m({allocator:I=>I||new C.BufferRange,deallocator:null});let P=new Float32Array(65536);a.MergedRenderer=F;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AppleAmdDriverHelper":function(){define(["exports","../../../webgl/BufferObject","../../../webgl/enums"],function(a,c,b){let t=function(){function n(m){this._rctx=
m;this._indexBuffer=this._createIndexbuffer();this._program=this._createProgram()}var r=n.prototype;r._createProgram=function(){return this._rctx.programCache.acquire("\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }","\n    void main(void) {\n      gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }",new Map([]))};r._createIndexbuffer=function(){return c.BufferObject.createIndex(this._rctx,b.Usage.STATIC_DRAW,new Uint32Array([0]))};r.resetIndicesType=
function(){this._program.compiled&&this._indexBuffer&&(this._rctx.bindVAO(null),this._rctx.useProgram(this._program),this._rctx.bindBuffer(this._indexBuffer,b.BufferType.ELEMENT_ARRAY_BUFFER),this._rctx.drawElements(b.PrimitiveType.POINTS,1,b.DataType.UNSIGNED_INT,0))};r.dispose=function(){this._program.dispose();this._indexBuffer.dispose()};return n}();a.AppleAmdDriverHelper=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports",
"../../../../core/maybe","./basicInterfaces"],function(a,c,b){let t=function(){function n(m,d){this._material=m;this._repository=d;this._map=new Map}var r=n.prototype;r.destroy=function(){this._map.forEach((m,d)=>{c.isSome(m)&&this._repository.release(this._material,d)})};r.load=function(m,d,f){if(!this._material.requiresSlot(d,f))return null;this._map.has(f)||this._map.set(f,this._repository.acquire(this._material,d,f));d=this._map.get(f);if(c.isSome(d)){if(d.ensureResources(m)===b.ResourceState.LOADED)return d;
this._repository.requestRender()}return null};return n}();a.GLMaterials=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(a,c,b,t){t=function(n){function r(m=b.create()){var d=n.call(this)||this;d.origin=m;d.slicePlaneLocalOrigin=d.origin;return d}c._inheritsLoose(r,
n);return r}(t.VertexNormalDrawParameters);a.DrawParameters=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/compilerUtils ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e){let g=function(l){function v(){var q=l.apply(this,arguments)||this;q.transformNormalViewFromGlobal=t.create();return q}c._inheritsLoose(v,l);return v}(m.VertexPositionPassParameters),h=function(l){function v(){var q=l.apply(this,arguments)||this;q.transformNormalGlobalFromModel=t.create();q.toMapSpace=n.create();return q}c._inheritsLoose(v,l);return v}(m.VertexPositionDrawParameters);a.VertexNormal=function(l,v){switch(v.normalType){case r.NormalAttributeType.Attribute:case r.NormalAttributeType.CompressedAttribute:l.include(r.NormalAttribute,
v);l.varyings.add("vNormalWorld","vec3");l.varyings.add("vNormalView","vec3");l.vertex.uniforms.add([new f.Matrix3DrawUniform("transformNormalGlobalFromModel",q=>q.transformNormalGlobalFromModel),new e.Matrix3PassUniform("transformNormalViewFromGlobal",q=>q.transformNormalViewFromGlobal)]);l.vertex.code.add(d.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`);break;case r.NormalAttributeType.Ground:l.include(m.VertexPosition,v);l.varyings.add("vNormalWorld","vec3");l.vertex.code.add(d.glsl`
        void forwardNormal() {
          vNormalWorld = ${v.spherical?d.glsl`normalize(vPositionWorldCameraRelative);`:d.glsl`vec3(0.0, 0.0, 1.0);`}
        }
        `);break;case r.NormalAttributeType.ScreenDerivative:l.vertex.code.add(d.glsl`void forwardNormal() {}`);break;default:b.neverReached(v.normalType);case r.NormalAttributeType.COUNT:}};a.VertexNormalDrawParameters=h;a.VertexNormalPassParameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../util/DecodeNormal.glsl","../../shaderModules/interfaces",
"../../../lib/VertexAttribute"],function(a,c,b,t,n){a.NormalAttributeType=void 0;(function(r){r[r.Attribute=0]="Attribute";r[r.CompressedAttribute=1]="CompressedAttribute";r[r.Ground=2]="Ground";r[r.ScreenDerivative=3]="ScreenDerivative";r[r.COUNT=4]="COUNT"})(a.NormalAttributeType||(a.NormalAttributeType={}));a.NormalAttribute=function(r,m){switch(m.normalType){case a.NormalAttributeType.CompressedAttribute:r.include(b.DecodeNormal);r.attributes.add(n.VertexAttribute.NORMALCOMPRESSED,"vec2");r.vertex.code.add(t.glsl`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`);break;case a.NormalAttributeType.Attribute:r.attributes.add(n.VertexAttribute.NORMAL,"vec3");r.vertex.code.add(t.glsl`vec3 normalModel() {
return normal;
}`);break;case a.NormalAttributeType.ScreenDerivative:r.extensions.add("GL_OES_standard_derivatives");r.fragment.code.add(t.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`);break;default:c.neverReached(m.normalType);case a.NormalAttributeType.COUNT:case a.NormalAttributeType.Ground:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.DecodeNormal=function(b){const t=c.glsl`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;b.vertex.code.add(t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/AnimationTimer ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./DefaultBufferWriter ./DefaultLayouts ./TriangleMaterial ./WaterGLMaterial ./WaterTechnique".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){l=function(p){function z(B){B=p.call(this,B,new k)||this;B._configuration=new q.WaterTechniqueConfiguration;B.animation=new m.AnimationTimer;return B}c._inheritsLoose(z,p);var C=z.prototype;C.getConfiguration=function(B,A){this._configuration.output=B;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.receiveShadows=this.parameters.receiveShadows;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=
this.parameters.transparent;this._configuration.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections;this._configuration.hasCloudsReflections=this.parameters.hasCloudsReflections;this._configuration.isDraped=this.parameters.isDraped;this._configuration.transparencyPassType=A.transparencyPassType;this._configuration.enableOffset=A.camera.relativeElevation<f.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=A.multipassTerrain.enabled;this._configuration.cullAboveGround=A.multipassTerrain.cullAboveGround;
return this._configuration};C.update=function(B){this.animation.enabled=35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(B.camera.relativeElevation,B.camera.distance);B=this.animation.advance(B);this.setParameters({timeElapsed:b.secondsFromMilliseconds(this.animation.time)*this.parameters.animationSpeed},!1);return this.animation.enabled&&B};C.requiresSlot=function(B,A){switch(A){case r.ShaderOutput.Normal:return B===e.RenderSlot.DRAPED_WATER;case r.ShaderOutput.Color:if(this.parameters.isDraped)return B===
e.RenderSlot.DRAPED_MATERIAL;break;case r.ShaderOutput.Alpha:break;case r.ShaderOutput.Highlight:return B===e.RenderSlot.OPAQUE_MATERIAL||B===e.RenderSlot.DRAPED_MATERIAL;default:return!1}A=e.RenderSlot.OPAQUE_MATERIAL;this.parameters.transparent&&(A=this.parameters.writeDepth?e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);return B===A};C.createGLMaterial=function(B){return new v.WaterGLMaterial(B)};C.createBufferWriter=function(){return new g.DefaultBufferWriter(h.PositionUVLayout)};
return z}(l.TriangleMaterial);let k=function(p){function z(){var C=p.apply(this,arguments)||this;C.waveStrength=.06;C.waveTextureRepeat=32;C.waveDirection=t.fromValues(1,0);C.waveVelocity=.05;C.flowStrength=.015;C.flowOffset=-.5;C.animationSpeed=.35;C.timeElapsed=0;C.color=n.fromValues(0,0,0,0);C.transparent=!0;C.writeDepth=!0;C.hasSlicePlane=!1;C.isDraped=!1;C.receiveShadows=!0;C.hasScreenSpaceReflections=!1;C.hasCloudsReflections=!1;return C}c._inheritsLoose(z,p);return z}(d.MaterialParameters);
a.WaterMaterial=l;a.WaterMaterialParameters=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultBufferWriter":function(){define(["exports","../lib/VertexAttribute","./internal/bufferWriterUtils"],function(a,c,b){let t=function(){function n(m){this.vertexBufferLayout=m}var r=n.prototype;r.allocate=function(m){return this.vertexBufferLayout.createBuffer(m)};r.elementCount=function(m){return m.indices.get(c.VertexAttribute.POSITION).length};
r.write=function(m,d,f,e,g){b.writeDefaultAttributes(f,this.vertexBufferLayout,m,d,e,g)};return n}();a.DefaultBufferWriter=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultLayouts":function(){define(["exports","../../support/buffer/InterleavedLayout","../lib/VertexAttribute"],function(a,c,b){const t=c.newLayout().vec3f(b.VertexAttribute.POSITION),n=c.newLayout().vec3f(b.VertexAttribute.POSITION).vec2f(b.VertexAttribute.UV0),r=c.newLayout().vec3f(b.VertexAttribute.POSITION).vec4u8(b.VertexAttribute.COLOR),
m=c.newLayout().vec3f(b.VertexAttribute.POSITION).vec4u8(b.VertexAttribute.OBJECTANDLAYERIDCOLOR),d=c.newLayout().vec3f(b.VertexAttribute.POSITION).vec2f(b.VertexAttribute.UV0).vec4u8(b.VertexAttribute.OBJECTANDLAYERIDCOLOR);c=c.newLayout().vec3f(b.VertexAttribute.POSITION).vec4u8(b.VertexAttribute.COLOR).vec4u8(b.VertexAttribute.OBJECTANDLAYERIDCOLOR);a.PositionColorLayout=r;a.PositionColorLayoutObjectAndLayerId=c;a.PositionLayout=t;a.PositionLayoutObjectAndLayerId=m;a.PositionUVLayout=n;a.PositionUVLayoutObjectAndLayerId=
d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/TriangleMaterial":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../lib/Material","./internal/MaterialUtil"],function(a,c,b,t){b=function(n){function r(){return n.apply(this,arguments)||this}c._inheritsLoose(r,n);r.prototype.intersect=function(m,d,f,e,g,h){return t.intersectTriangleGeometry(m,f,e,g,void 0,h)};return r}(b.Material);a.TriangleMaterial=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ./WaterTechnique".split(" "),function(a,c,b,t,n,r){n=function(m){function d(){return m.apply(this,arguments)||this}c._inheritsLoose(d,m);var f=d.prototype;f._updateShadowState=function(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&this._material.setParameters({receiveShadows:e.shadowMap.enabled})};
f._updateSSRState=function(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})};f._updateCloudsReflectionState=function(e){e=b.isSome(e.cloudsFade.data);e!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:e})};f.ensureResources=function(e){return this._techniqueRepository.constructionContext.waterTextureRepository.ensureResources(e)};f.beginSlot=function(e){this._output===
t.ShaderOutput.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e));this._material.setParameters(this._techniqueRepository.constructionContext.waterTextureRepository.passParameters);return this.ensureTechnique(r.WaterTechnique,e)};return d}(n);a.WaterGLMaterial=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/shading/WaterDistortion.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/TransparencyPassType ./DefaultTechniqueConfiguration ../../../../chunks/WaterSurface.glsl ../../../webgl/context-util ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){d=function(B){function A(){return B.apply(this,arguments)||this}b._inheritsLoose(A,B);return A}(d.WaterDistortionPassParameters);e=function(B){function A(){return B.apply(this,arguments)||this}b._inheritsLoose(A,B);var x=A.prototype;x.initializeConfiguration=function(u,y){y.hasWebGL2Context=u.rctx.type===z.ContextType.WEBGL2;y.spherical=u.viewingMode===n.ViewingMode.Global;y.doublePrecisionRequiresObfuscation=u.rctx.driverTest.doublePrecisionRequiresObfuscation.result};
x.initializeProgram=function(u){return new v.Program(u.rctx,A.shader.get().build(this.configuration),h.Default3D)};x._setPipelineState=function(u){const y=this.configuration,w=u===q.TransparencyPassType.NONE,D=u===q.TransparencyPassType.FrontFace;return C.makePipelineState({blending:y.output!==r.ShaderOutput.Normal&&y.output!==r.ShaderOutput.Highlight&&y.transparent?w?l.blendingDefault:l.oitBlending(u):null,depthTest:{func:l.oitDepthTest(u)},depthWrite:w?y.writeDepth?C.defaultDepthWriteParams:null:
l.oitDepthWrite(u),colorWrite:C.defaultColorWriteParams,polygonOffset:w||D?null:l.getOITPolygonOffset(y.enableOffset)})};x.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return A}(e.ShaderTechnique);e.shader=new f.ReloadableShaderModule(p.WaterSurface,()=>new Promise((B,A)=>a(["../shaders/WaterSurface.glsl"],B,A)));f=function(B){function A(){var x=B.apply(this,arguments)||this;x.output=r.ShaderOutput.Color;x.transparencyPassType=q.TransparencyPassType.NONE;
x.spherical=!1;x.receiveShadows=!1;x.hasSlicePlane=!1;x.transparent=!1;x.enableOffset=!0;x.writeDepth=!1;x.hasScreenSpaceReflections=!1;x.doublePrecisionRequiresObfuscation=!1;x.hasCloudsReflections=!1;x.isDraped=!1;x.hasMultipassTerrain=!1;x.cullAboveGround=!1;return x}b._inheritsLoose(A,B);return A}(k.DefaultTechniqueConfiguration);t.__decorate([g.parameter({count:r.ShaderOutput.COUNT})],f.prototype,"output",void 0);t.__decorate([g.parameter({count:q.TransparencyPassType.COUNT})],f.prototype,"transparencyPassType",
void 0);t.__decorate([g.parameter()],f.prototype,"spherical",void 0);t.__decorate([g.parameter()],f.prototype,"receiveShadows",void 0);t.__decorate([g.parameter()],f.prototype,"hasSlicePlane",void 0);t.__decorate([g.parameter()],f.prototype,"transparent",void 0);t.__decorate([g.parameter()],f.prototype,"enableOffset",void 0);t.__decorate([g.parameter()],f.prototype,"writeDepth",void 0);t.__decorate([g.parameter()],f.prototype,"hasScreenSpaceReflections",void 0);t.__decorate([g.parameter()],f.prototype,
"doublePrecisionRequiresObfuscation",void 0);t.__decorate([g.parameter()],f.prototype,"hasCloudsReflections",void 0);t.__decorate([g.parameter()],f.prototype,"isDraped",void 0);t.__decorate([g.parameter()],f.prototype,"hasMultipassTerrain",void 0);t.__decorate([g.parameter()],f.prototype,"cullAboveGround",void 0);t.__decorate([g.parameter({constValue:m.PBRMode.Water})],f.prototype,"pbrMode",void 0);t.__decorate([g.parameter({constValue:!0})],f.prototype,"useCustomDTRExponentForWater",void 0);t.__decorate([g.parameter({constValue:!0})],
f.prototype,"highStepCount",void 0);t.__decorate([g.parameter({constValue:!1})],f.prototype,"useFillLights",void 0);c.WaterMaterialPassParameters=d;c.WaterTechnique=e;c.WaterTechniqueConfiguration=f;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./FoamRendering.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){let h=function(q){function k(){return q.apply(this,arguments)||this}c._inheritsLoose(k,q);return k}(e.NoParameters);const l=r.create(),v=t.create();a.WaterDistortion=function(q){q.fragment.uniforms.add(new g.Texture2DPassUniform("texWaveNormal",k=>k.waveNormal));q.fragment.uniforms.add(new g.Texture2DPassUniform("texWavePerturbation",k=>k.wavePertubation));q.fragment.uniforms.add([new f.Float4PassUniform("waveParams",k=>n.set(l,k.waveStrength,k.waveTextureRepeat,k.flowStrength,
k.flowOffset)),new d.Float2PassUniform("waveDirection",k=>b.set(v,k.waveDirection[0]*k.waveVelocity,k.waveDirection[1]*k.waveVelocity))]);q.include(m.FoamIntensity);q.fragment.code.add(e.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};a.WaterDistortionPassParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.FoamColor=function(b){b.fragment.code.add(c.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(b){b.fragment.code.add(c.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){function y(D){const F=new A.ShaderBuilder,{vertex:E,fragment:K}=F;p.addProjViewLocalOrigin(E,D);F.include(n.Transform,D);F.attributes.add(u.VertexAttribute.POSITION,"vec3");F.attributes.add(u.VertexAttribute.UV0,"vec2");const J=new z.Float4PassUniform("waterColor",M=>M.color);if(D.output===b.ShaderOutput.Color&&D.isDraped)return F.varyings.add("vpos","vec3"),E.uniforms.add(J),E.code.add(B.glsl`
        void main(void) {
          if (waterColor.a < ${B.glsl.float(q.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),K.uniforms.add(J),K.code.add(B.glsl`void main() {
gl_FragColor = waterColor;
}`),F;if(D.output===b.ShaderOutput.Color||D.output===b.ShaderOutput.Alpha)F.include(e.NormalUtils,D),F.include(c.ForwardLinearDepth,D),F.varyings.add("vuv","vec2"),F.varyings.add("vpos","vec3"),F.varyings.add("vnormal","vec3"),F.varyings.add("vtbnMatrix","mat3"),D.hasMultipassTerrain&&F.varyings.add("depth","float"),E.uniforms.add(J),E.code.add(B.glsl`
      void main(void) {
        if (waterColor.a < ${B.glsl.float(q.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${D.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${D.output===b.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);F.include(f.multipassTerrainTest,D);switch(D.output){case b.ShaderOutput.Alpha:F.include(t.SliceDraw,D);K.uniforms.add(J);K.code.add(B.glsl`
        void main() {
          discardBySlice(vpos);
          ${D.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `);break;case b.ShaderOutput.Color:F.include(d.MainLighting,D);F.include(m.EvaluateAmbientLighting,{pbrMode:g.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});F.include(v.WaterDistortion);F.include(t.SliceDraw,D);F.include(h.ReadShadowMapDraw,D);F.include(l.Water,D);K.uniforms.add([J,new C.FloatPassUniform("timeElapsed",M=>M.timeElapsed),E.uniforms.get("view"),E.uniforms.get("localOrigin")]);p.addCameraPosition(K,D);K.include(k.ColorConversion);d.addMainLightDirection(K);d.addMainLightIntensity(K);
K.code.add(B.glsl`
      void main() {
        discardBySlice(vpos);
        ${D.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${D.receiveShadows?B.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view * vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, mainLightDirection, waterColor.rgb, mainLightIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${D.transparencyPassType===x.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `);break;case b.ShaderOutput.Normal:F.include(e.NormalUtils,D);F.include(v.WaterDistortion,D);F.include(t.SliceDraw,D);F.varyings.add("vpos","vec3");F.varyings.add("vuv","vec2");E.uniforms.add(J);E.code.add(B.glsl`
        void main(void) {
          if (waterColor.a < ${B.glsl.float(q.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `);K.uniforms.add(new C.FloatPassUniform("timeElapsed",M=>M.timeElapsed));K.code.add(B.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`);break;case b.ShaderOutput.Highlight:F.include(r.OutputHighlight,D),F.varyings.add("vpos","vec3"),E.uniforms.add(J),E.code.add(B.glsl`
      void main(void) {
        if (waterColor.a < ${B.glsl.float(q.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),F.include(t.SliceDraw,D),K.code.add(B.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return F}const w=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.WaterSurface=w;a.build=y})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.NormalUtils=function(b,t){t.spherical?b.vertex.code.add(c.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):b.vertex.code.add(c.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);t.spherical?b.vertex.code.add(c.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):b.vertex.code.add(c.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f64 ../util/RgbaFloatEncoding.glsl ../util/WebGL2Utils ../../shaderModules/Float4PassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sDrawUniform ../../shaderModules/Matrix4sPassUniform ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(q,k){q=q.fragment;q.include(t.RgbaFloatEncoding);q.uniforms.add([...g.createTexture2DPassSizeUniforms("shadowMapTex",(p,z)=>z.shadowMap.depthTexture,k.hasWebGL2Context?h.TextureSizeUniformType.None:h.TextureSizeUniformType.Size),new m.IntegerPassUniform("numCascades",(p,z)=>z.shadowMap.numCascades),new r.Float4PassUniform("cascadeDistances",(p,z)=>z.shadowMap.cascadeDistances)]);q.code.add(d.glsl`
    int chooseCascade(float depth, out mat4 mat) {
      vec4 distance = cascadeDistances;

      // choose correct cascade
      int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;

      mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];

      return i;
    }

    vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
      vec4 lv = mat * vec4(_vpos, 1.0);
      lv.xy /= lv.w;
      return 0.5 * lv.xyz + vec3(0.5);
    }

    vec2 cascadeCoordinates(int i, vec3 lvpos) {
      return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
    }

    float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
      return rgba2float(texture2D(_depthTex, uv));
    }

    float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
      return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
    }

    float filterShadow(vec2 uv, vec3 lvpos, float textureSize, sampler2D _depthTex) {
      float halfPixelSize = 0.5 / textureSize;

      // filter, offset by half pixels
      vec2 st = fract((vec2(halfPixelSize) + uv) * textureSize);

      float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
      float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
      float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);

      return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
    }

    float readShadowMap(const in vec3 _vpos, float _linearDepth) {
      mat4 mat;
      int i = chooseCascade(_linearDepth, mat);

      if (i >= numCascades) { return 0.0; }

      vec3 lvpos = lightSpacePosition(_vpos, mat);

      // vertex completely outside? -> no shadow
      if (lvpos.z >= 1.0) { return 0.0; }
      if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }

      // calc coord in cascade texture
      vec2 uv = cascadeCoordinates(i, lvpos);

      vec2 textureSize = ${n.textureSize(k,"shadowMapTex")};

      return filterShadow(uv, lvpos, textureSize.x, shadowMapTex);
    }
  `)}let v=function(q){function k(){var p=q.apply(this,arguments)||this;p.origin=b.create();return p}c._inheritsLoose(k,q);return k}(d.NoParameters);a.ReadShadowMapBindParameters=v;a.ReadShadowMapDraw=function(q,k){k.receiveShadows&&(q.fragment.uniforms.add(new f.Matrix4sDrawUniform("shadowMapMatrix",(p,z)=>z.shadowMap.getShadowMapMatrices(p.origin),4)),l(q,k))};a.ReadShadowMapPass=function(q,k){k.receiveShadows&&(q.fragment.uniforms.add(new e.Matrix4sPassUniform("shadowMapMatrix",(p,z)=>z.shadowMap.getShadowMapMatrices(p.origin),
4)),l(q,k))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"int",t.BindType.Pass,(f,e,g)=>f.setUniform1i(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.IntegerPassUniform=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d,f){return n.call(this,m,"mat4",t.BindType.Draw,(e,g,h)=>e.setUniformMatrix4fv(m,d(g,h)),f)||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Matrix4sDrawUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sPassUniform":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d,f){return n.call(this,m,"mat4",t.BindType.Pass,(e,g,h)=>e.setUniformMatrix4fv(m,d(g,h)),f)||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Matrix4sPassUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e){a.Water=function(g,h){g.include(t.PhysicallyBasedRenderingWater,h);g.include(b.Gamma);g.include(c.FoamColor);h.hasCloudsReflections&&g.include(r.CloudsParallaxShading,h);h.hasScreenSpaceReflections&&g.include(n.ScreenSpaceReflections,h);g=g.fragment;g.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",
3E5).add("ssrHeightFadeEnd","float",5E5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);g.code.add(d.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);g.uniforms.add([new m.FloatPassUniform("lightingSpecularStrength",(l,v)=>v.lighting.mainLight.specularStrength),new m.FloatPassUniform("lightingEnvironmentStrength",(l,v)=>v.lighting.mainLight.environmentStrength)]);g.code.add(d.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);h.hasCloudsReflections&&g.code.add(d.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`);h.hasScreenSpaceReflections?(g.uniforms.add([new f.Matrix4PassUniform("view",(l,v)=>v.ssr.camera.viewMatrix),new e.Texture2DPassUniform("lastFrameColorTexture",(l,v)=>v.ssr.lastFrameColorTexture),new m.FloatPassUniform("fadeFactor",(l,v)=>v.ssr.fadeFactor)]),g.code.add(d.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view * vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3 * dCoords.y), 0.0, 1.0) * heightMod * fadeFactor;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorTexture, reprojectedCoordinate).xyz) *
reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod * 0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor +
reflSea * seaColorMod + specular + foam);`)):g.code.add(d.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);h.hasCloudsReflections?h.hasScreenSpaceReflections?g.code.add(d.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):g.code.add(d.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):g.code.add(d.glsl`return waterRenderedColor;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,c,b,t,n){a.PhysicallyBasedRendering=function(r,m){const d=r.fragment.code;r.include(t.PiUtils);if(m.pbrMode===b.PBRMode.Normal||m.pbrMode===b.PBRMode.Schematic||m.pbrMode===b.PBRMode.Terrain||
m.pbrMode===b.PBRMode.TerrainWithWater)d.add(n.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),d.add(n.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`);if(m.pbrMode===b.PBRMode.Normal||m.pbrMode===b.PBRMode.Schematic)r.include(c.AnalyticalSkyModel),d.add(n.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),d.add(n.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),d.add(n.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),d.add(n.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};a.PhysicallyBasedRenderingWater=function(r,m){const d=r.fragment.code;r.include(t.PiUtils);d.add(n.glsl`
  struct PBRShadingWater
  {
      float NdotL;   // cos angle between normal and light direction
      float NdotV;   // cos angle between normal and view direction
      float NdotH;   // cos angle between normal and half vector
      float VdotH;   // cos angle between view direction and half vector
      float LdotH;   // cos angle between light direction and half vector
      float VdotN;   // cos angle between view direction and normal vector
  };

  float dtrExponent = ${m.useCustomDTRExponentForWater?"2.2":"2.0"};
  `);d.add(n.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`);d.add(n.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`);d.add(n.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`);d.add(n.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.AnalyticalSkyModel=function(b){b=b.fragment.code;b.add(c.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);b.add(c.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);b.add(c.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/BufferRange":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(n=0,r=0){this.from=n;this.to=r}c._createClass(t,[{key:"numElements",get:function(){return this.to-this.from}}]);return t}();a.BufferRange=b;a.mergeAdjacentRanges=function(t){const n=new Map;t.forAll(m=>n.set(m.from,m));let r=!0;for(;r;)r=!1,t.forEach(m=>
{const d=n.get(m.to);d&&(m.to=d.to,n.delete(d.from),t.removeUnordered(d),r=!0)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./BufferRange"],function(a,c,b,t){t=function(n){function r(m,d,f){d=n.call(this,d,f)||this;d.geometry=m;return d}c._inheritsLoose(r,n);c._createClass(r,[{key:"isVisible",get:function(){return this.geometry.visible}},
{key:"hasHighlights",get:function(){return b.isSome(this.geometry.highlights)&&this.isVisible}},{key:"hasOccludees",get:function(){return b.isSome(this.geometry.occludees)}}]);return r}(t.BufferRange);a.Instance=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerBufferData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ./BufferRange ./DrawCommand".split(" "),
function(a,c,b,t,n,r){function m(){return new t({allocator:g=>g||new r.DrawCommand,deallocator:g=>g})}function d(g,h){const l=g.back();null==l?(g=g.pushNew(),g.first=h.from,g.count=h.numElements):l.first+l.count>=h.from?l.count=h.from-l.first+h.numElements:(g=g.pushNew(),g.first=h.from,g.count=h.numElements)}let f=function(){function g(){this._numElements=0;this._instances=new Map;this.holes=new t({allocator:l=>l||new n.BufferRange,deallocator:null});this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=
!1;this.drawCommandsDirty=!0;this.drawCommandsDefault=m();this.drawCommandsHighlight=m();this.drawCommandsOccludees=m();this.drawCommandsShadowHighlightRest=m()}var h=g.prototype;h.addInstance=function(l,v){this.deleteInstance(l);this._instances.set(l,v);this._numElements+=v.numElements};h.deleteInstance=function(l){const v=this._instances.get(l);v&&(this._numElements-=v.numElements,this._instances.delete(l))};h.updateInstance=function(l,v,q){if(l=this._instances.get(l))this._numElements-=l.numElements,
l.from=v,l.to=q,this._numElements+=l.numElements};h.updateDrawState=function(l){l.isVisible?(l.hasHighlights&&(this.hasHighlights=!0),l.hasOccludees&&(this.hasOccludees=!0)):this.hasHiddenInstances=!0};h.updateDrawCommands=function(l){this.drawCommandsDefault.clear();this.drawCommandsHighlight.clear();this.drawCommandsOccludees.clear();this.drawCommandsShadowHighlightRest.clear();this.drawCommandsDirty=!1;if(0!==this._instances.size)if(this.needsMultipleCommands()){l=Array.from(this._instances.values()).sort((q,
k)=>q.from===k.from?q.to-k.to:q.from-k.from);for(var v of l)v.isVisible&&(d(v.hasOccludees?this.drawCommandsOccludees:this.drawCommandsDefault,v),d(v.hasHighlights?this.drawCommandsHighlight:this.drawCommandsShadowHighlightRest,v))}else{const q=this.drawCommandsDefault.pushNew();v=this.holes.front();b.isSome(this.vao)&&1===this.holes.length&&v.to===Math.floor(this.vao.size/l)?(q.first=0,q.count=v.from):(q.first=Infinity,q.count=0,this._instances.forEach(k=>{q.first=Math.min(q.first,k.from);q.count=
Math.max(q.count,k.to)}),q.count-=q.first)}};h.needsMultipleCommands=function(){return this.hasOccludees||this.hasHighlights||this.hasHiddenInstances};c._createClass(g,[{key:"numElements",get:function(){return this._numElements}},{key:"instances",get:function(){return this._instances}}]);return g}(),e=function(g){function h(){return g.apply(this,arguments)||this}c._inheritsLoose(h,g);return h}(f);a.PerBufferData=f;a.PerVaoData=e;a.hasVao=function(g){return b.isSome(g.vao)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/DrawCommand":function(){define(["exports"],function(a){a.DrawCommand=function(){this.count=this.first=0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/PerOriginData":function(){define(["exports"],function(a){let c=function(){function b(n){this.origin=n;this.buffers=[]}var t=b.prototype;t.dispose=function(){this.buffers.forEach(n=>n.vao.dispose());
this.buffers.length=0};t.findBuffer=function(n){return this.buffers.find(r=>r.instances.has(n))};return b}();a.PerOriginData=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/renderers/VaoCache":function(){define("exports ../../../../../core/maybe ../../../../../core/MemCache ../../../../../core/uid ../../lib/VertexArrayObject ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),function(a,c,b,t,n,r,m){function d(g,h){if(h===b.RemoveMode.ALL)g.forEach(l=>
l.dispose());else return h=g.pop(),g=g.length*h.size,h.dispose(),g}const f=b.MIN_PRIORITY+1;let e=function(){function g(l,v,q){this._rctx=l;this._locations=v;this._layout=q;this._cache=l.newCache(`VaoCache ${t.generateUID()}`,d)}var h=g.prototype;h.dispose=function(){this._cache.destroy()};h.newVao=function(l){var v=l.toString();const q=this._cache.pop(v);if(c.isSome(q)){const k=q.pop();0<q.length&&this._cache.put(v,q,l*q.length,f);return k}v=new n.VertexArrayObject(this._rctx,this._locations,{geometry:this._layout},
{geometry:r.BufferObject.createVertex(this._rctx,m.Usage.STATIC_DRAW)});v.vertexBuffers.geometry.setSize(l);return v};h.deleteVao=function(l){if(c.isNone(l))return null;const v=l.size,q=v.toString(),k=this._cache.pop(q);c.isSome(k)?(k.push(l),this._cache.put(q,k,v*k.length,-1)):this._cache.put(q,[l],v,-1);return null};return g}();a.VaoCache=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/time ../../../../chunks/vec2 ./glUtil3D ./SSAOBlurTechnique ./SSAONoiseData ./SSAOTechnique ../../../../chunks/SSAO.glsl ../shaders/SSAOParameters ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){let k=function(){function p(C,B,A,x){this._view=C;this._techniqueRepository=B;this._rctx=A;this._requestRender=x;this._quadVAO=null;this._passParameters=new g.SSAOPassParameters;this._drawParameters=new g.BlurDrawParameters}var z=p.prototype;z.dispose=function(){this.enabled=!1;this._quadVAO=b.disposeMaybe(this._quadVAO)};z.disposeOffscreenBuffers=function(){b.applySome(this._ssaoFBO,C=>C.resize(0,0));b.applySome(this._blur0FBO,C=>C.resize(0,0));b.applySome(this._blur1FBO,
C=>C.resize(0,0))};z.render=function(C,B,A,x){if(!(b.isNone(this._enableTime)||b.isNone(A)||b.isNone(x)||b.isNone(this._ssaoFBO)||b.isNone(this._blur0FBO)||b.isNone(this._blur1FBO)))if(this.active){0===this._enableTime&&(this._enableTime=B);var u=this._rctx,y=C.camera,w=this._view.qualitySettings.fadeDuration;B=0<w?Math.min(w,B-this._enableTime)/w:1;this._passParameters.normalTexture=x;this._passParameters.depthTexture=A;this._passParameters.projScale=1/y.computeRenderPixelSizeAtDist(1);this._passParameters.intensity=
2/e.getRadius(y)**6*B;A=y.fullViewport;x=A[2];y=A[3];w=x/2;var D=y/2;this._ssaoFBO.resize(x,y);this._blur0FBO.resize(w,D);this._blur1FBO.resize(w,D);b.isNone(this._quadVAO)&&(this._quadVAO=r.createQuadVAO(this._rctx));u.bindFramebuffer(this._ssaoFBO);u.setViewport(0,0,x,y);u.bindTechnique(this._ssaoTechnique,this._passParameters,C).bindDraw(this._drawParameters,C,this._passParameters);u.bindVAO(this._quadVAO);var F=q.vertexCount(this._quadVAO,"geometry");u.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,
0,F);var E=u.bindTechnique(this._blurTechnique,this._passParameters,C);u.setViewport(0,0,w,D);u.bindFramebuffer(this._blur0FBO);this._drawParameters.colorTexture=this._ssaoFBO.colorTexture;n.set(this._drawParameters.blurSize,0,2/y);E.bindDraw(this._drawParameters,C,this._passParameters);u.setViewport(0,0,w,D);u.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,F);u.bindFramebuffer(this._blur1FBO);this._drawParameters.colorTexture=this._blur0FBO.colorTexture;n.set(this._drawParameters.blurSize,2/x,0);E.bindDraw(this._drawParameters,
C,this._passParameters);u.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,F);u.setViewport(A[0],A[1],A[2],A[3]);1>B&&this._requestRender()}else this._enableTime=B,this._requestRender()};z._enable=function(){if(!b.isSome(this._enableTime)){var C={target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGBA,dataType:h.PixelType.UNSIGNED_BYTE,samplingMode:h.TextureSamplingMode.LINEAR,wrapMode:h.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0},B={colorTarget:h.TargetType.TEXTURE,depthStencilTarget:h.DepthStencilTargetType.NONE};
this._ssaoFBO=new l.FramebufferObject(this._rctx,B,C);this._blur0FBO=new l.FramebufferObject(this._rctx,B,C);this._blur1FBO=new l.FramebufferObject(this._rctx,B,C);C=Uint8Array.from(atob(d.noiseData),A=>A.charCodeAt(0));this._passParameters.noiseTexture=new v.Texture(this._rctx,{target:h.TextureType.TEXTURE_2D,pixelFormat:h.PixelFormat.RGB,dataType:h.PixelType.UNSIGNED_BYTE,hasMipmap:!0,width:32,height:32},C);b.isNone(this._ssaoTechnique)&&(this._ssaoTechnique=this._techniqueRepository.acquire(f.SSAOTechnique));
b.isNone(this._blurTechnique)&&(this._blurTechnique=this._techniqueRepository.acquire(m.SSAOBlurTechnique));this._enableTime=t.Milliseconds(0);this._requestRender()}};z._disable=function(){this._enableTime=null;this._passParameters.noiseTexture=b.disposeMaybe(this._passParameters.noiseTexture);this._blur1FBO=b.disposeMaybe(this._blur1FBO);this._blur0FBO=b.disposeMaybe(this._blur0FBO);this._ssaoFBO=b.disposeMaybe(this._ssaoFBO)};c._createClass(p,[{key:"enabled",get:function(){return b.isSome(this._enableTime)},
set:function(C){C?this._enable():this._disable()}},{key:"active",get:function(){return this.enabled&&this._ssaoTechnique.compiled&&this._blurTechnique.compiled}},{key:"colorTexture",get:function(){return b.isSome(this._blur1FBO)?this._blur1FBO.colorTexture:null}},{key:"gpuMemoryUsage",get:function(){return(b.isSome(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(b.isSome(this._blur1FBO)?this._blur1FBO.gpuMemoryUsage:0)+(b.isSome(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}},{key:"test",get:function(){return{ssao:this._ssaoFBO,
blur:this._blur1FBO}}}]);return p}();a.SSAOHelper=k;a.blurSizePixels=2;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAOBlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAOBlur.glsl ../../../webgl/renderState".split(" "),function(a,c,b,t,n,r,m,d,f){n=function(e){function g(){return e.apply(this,
arguments)||this}b._inheritsLoose(g,e);var h=g.prototype;h.initializeProgram=function(l){return new m.Program(l.rctx,g.shader.get().build(),r.Default3D)};h.initializePipeline=function(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})};return g}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.SSAOBlur,()=>new Promise((e,g)=>a(["../shaders/SSAOBlur.glsl"],e,g)));c.SSAOBlurTechnique=n;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAOBlur.glsl":function(){define("exports ./vec3 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){function h(){const v=new f.ShaderBuilder,q=v.fragment;v.include(b.ScreenSpacePass);q.include(t.ReadLinearDepth);q.uniforms.add([new g.Texture2DPassUniform("depthMap",k=>k.depthTexture),new e.Texture2DDrawUniform("tex",k=>k.colorTexture),new n.Float2DrawUniform("blurSize",k=>k.blurSize),new m.FloatPassUniform("projScale",(k,p)=>{p=c.distance(p.camera.eye,p.camera.center);return 5E4<p?Math.max(0,k.projScale-(p-5E4)):k.projScale}),new r.Float2PassUniform("nearFar",(k,
p)=>p.camera.nearFar)]);q.code.add(d.glsl`
    void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
      float c = texture2D(tex, uv).r;
      float d = linearDepthFromTexture(depthMap, uv, nearFar);

      float ddiff = d - center_d;

      float w = exp(-r * r * ${d.glsl.float(.08)} - ddiff * ddiff * sharpness);
      wTotal += w;
      bTotal += w * c;
    }
  `);q.code.add(d.glsl`
    void main(void) {
      float b = 0.0;
      float w_total = 0.0;

      float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

      float sharpness = -0.05 * projScale / center_d;
      for (int r = -${d.glsl.int(4)}; r <= ${d.glsl.int(4)}; ++r) {
        float rf = float(r);
        vec2 uvOffset = uv + rf * blurSize;
        blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
      }

      gl_FragColor = vec4(b / w_total);
    }
  `);return v}const l=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}));a.SSAOBlur=l;a.build=h})},"esri/views/3d/webgl-engine/lib/SSAONoiseData":function(){define(["exports"],function(a){a.noiseData="eXKEvZaUc66cjIKElE1jlJ6MjJ6Ufkl+jn2fcXp5jBx7c6KEflSGiXuXeW6OWs+tfqZ2Yot2Y7Zzfo2BhniEj3xoiXuXj4eGZpqEaHKDWjSMe7palFlzc3BziYOGlFVzg6Zzg7CUY5JrjFF7eYJ4jIKEcyyEonSXe7qUfqZ7j3xofqZ2c4R5lFZ5Y0WUbppoe1l2cIh2ezyUho+BcHN2cG6DbpqJhqp2e1GcezhrdldzjFGUcyxjc3aRjDyEc1h7Sl17c6aMjH92pb6Mjpd4dnqBjMOEhqZleIOBYzB7gYx+fnqGjJuEkWlwnCx7fGl+c4hjfGyRe5qMlNOMfnqGhIWHc6OMi4GDc6aMfqZuc6aMzqJzlKZ+lJ6Me3qRfoFue0WUhoR5UraEa6qMkXiPjMOMlJOGe7JrUqKMjK6MeYRzdod+Sl17boiPc6qEeYBlcIh2c1WEe7GDiWCDa0WMjEmMdod+Y0WcdntzhmN8WjyMjKJjiXtzgYxYaGd+a89zlEV7e2GJfnd+lF1rcK5zc4p5cHuBhL6EcXp5eYB7fnh8iX6HjIKEeaxuiYOGc66RfG2Ja5hzjlGMjEmMe9OEgXuPfHyGhPeEdl6JY02McGuMfnqGhFiMa3WJfnx2l4hwcG1uhmN8c0WMc39og1GBbrCEjE2EZY+JcIh2cIuGhIWHe0mEhIVrc09+gY5+eYBlnCyMhGCDl3drfmmMgX15aGd+gYx+fnuRfnhzY1SMsluJfnd+hm98WtNrcIuGh4SEj0qPdkqOjFF7jNNjdnqBgaqUjMt7boeBhnZ4jDR7c5pze4GGjEFrhLqMjHyMc0mUhKZze4WEa117kWlwbpqJjHZ2eX2Bc09zeId+e0V7WlF7jHJ2l72BfId8l3eBgXyBe897jGl7c66cgW+Xc76EjKNbgaSEjGx4fId8jFFjgZB8cG6DhlFziZhrcIh2fH6HgUqBgXiPY8dahGFzjEmMhEFre2dxhoBzc5SGfleGe6alc7aUeYBlhKqUdlp+cH5za4OEczxza0Gcc4J2jHZ5iXuXjH2Jh5yRjH2JcFx+hImBjH+MpddCl3dreZeJjIt8ZW18bm1zjoSEeIOBlF9oh3N7hlqBY4+UeYFwhLJjeYFwaGd+gUqBYxiEYot2fqZ2ondzhL6EYyiEY02Ea0VjgZB8doaGjHxoc66cjEGEiXuXiXWMiZhreHx8frGMe75rY02Ec5pzfnhzlEp4a3VzjM+EhFFza3mUY7Zza1V5e2iMfGyRcziEhDyEkXZ2Y4OBnCx7g5t2eyBjgV6EhEFrcIh2dod+c4Z+nJ5zjm15jEmUeYxijJp7nL6clIpjhoR5WrZraGd+fnuRa6pzlIiMg6ZzfHx5foh+eX1ufnB5eX1ufnB5aJt7UqKMjIh+e3aBfm5lbYSBhGFze6J4c39oc0mUc4Z+e0V7fKFVe0WEdoaGY02Ec4Z+Y02EZYWBfH6HgU1+gY5+hIWUgW+XjJ57ebWRhFVScHuBfJ6PhBx7WqJzlM+Ujpd4gHZziX6HjHmEgZN+lJt5boiPe2GJgX+GjIGJgHZzeaxufnB5hF2JtdN7jJ57hp57hK6ElFVzg6ZzbmiEbndzhIWHe3uJfoFue3qRhJd2j3xoc65zlE1jc3p8lE1jhniEgXJ7e657vZaUc3qBh52BhIF4aHKDa9drgY5+c52GWqZzbpqJe8tjnM+UhIeMfo2BfGl+hG1zSmmMjKJjZVaGgX15c1lze0mEp4OHa3mUhIWHhDyclJ6MeYOJkXiPc0VzhFiMlKaEboSJa5Jze41re3qRhn+HZYWBe0mEc4p5fnORbox5lEp4hGFjhGGEjJuEc1WEhLZjeHeGa7KlfHx2hLaMeX1ugY5+hIWHhKGPjMN7c1WEho1zhoBzZYx7fnhzlJt5exyUhFFziXtzfmmMa6qMYyiEiXxweV12kZSMeWqXSl17fnhzxmmMrVGEe1mcc4p5eHeGjK6MgY5+doaGa6pzlGV7g1qBh4KHkXiPeW6OaKqafqZ2eXZ5e1V7jGd7boSJc3BzhJd2e0mcYot2h1RoY8dahK6EQmWEWjx7e1l2lL6UgXyBdnR4eU9zc0VreX1umqaBhld7fo2Bc6KEc5Z+hDyEcIeBWtNrfHyGe5qMhMuMe5qMhEGEbVVupcNzg3aHhIF4boeBe0mEdlptc39ofFl5Y8uUlJOGiYt2UmGEcyxjjGx4jFF7a657ZYWBnElzhp57iXtrgZN+tfOEhIOBjE2HgU1+e8tjjKNbiWCDhE15gUqBgYN7fnqGc66ce9d7iYSBj0qPcG6DnGGcT3eGa6qMZY+JlIiMl4hwc3aRdnqBlGV7eHJ2hLZjfnuRhDyEeX6MSk17g6Z+c6aUjHmEhIF4gXyBc76EZW18fGl+fkl+jCxrhoVwhDyUhIqGlL2DlI6EhJd2tdN7eYORhEGMa2Faa6pzc3Bzc4R5lIRznM+UY9eMhDycc5Z+c4p5c4iGY117pb6MgXuPrbJafnx2eYOJeXZ5e657hDyEcziElKZjfoB5eHeGj4WRhGGEe6KGeX1utTStc76EhFGJnCyMa5hzfH6HnNeceYB7hmN8gYuMhIVrczSMgYF8h3N7c5pza5hzjJqEYIRdgYuMlL2DeYRzhGGEeX1uhLaEc4iGeZ1zdl6JhrVteX6Me2iMfm5lWqJzSpqEa6pzdnmchHx2c6OMhNdrhoR5g3aHczxzeW52gV6Ejm15frGMc0Vzc4Z+l3drfniJe+9rWq5rlF1rhGGEhoVwe9OEfoh+e7pac09+c3qBY0lrhDycdnp2lJ6MiYOGhGCDc3aRlL2DlJt5doaGdnp2gYF8gWeOjF2Uc4R5c5Z+jEmMe7KEc4mEeYJ4dmyBe0mcgXiPbqJ7eYB7fmGGiYSJjICGlF1reZ2PnElzbpqJfH6Hc39oe4WEc5eJhK6EhqyJc3qBgZB8c09+hEmEaHKDhFGJc5SGiXWMUpaEa89zc6OMnCyMiXtrho+Be5qMc7KEjJ57dmN+hKGPjICGbmiEe7prdod+hGCDdnmchBx7eX6MkXZ2hGGEa657hm98jFFjY5JreYOJgY2EjHZ2a295Y3FajJ6Mc1J+YzB7e4WBjF2Uc4R5eV12gYxzg1qBeId+c9OUc5pzjFFjgY5+hFiMlIaPhoR5lIpjjIKBlNdSe7KEeX2BfrGMhIqGc65zjE2UhK6EklZ+QmWEeziMWqZza3VzdnR4foh+gYF8n3iJiZhrnKp7gYF8eId+lJ6Me1lrcIuGjKJjhmN8c66MjFF7a6prjJ6UnJ5zezyUfruRWlF7nI5zfHyGe657h4SEe8tjhBx7jFFjc09+c39ojICMeZeJeXt+YzRzjHZ2c0WEcIeBeXZ5onSXkVR+gYJ+eYFwdldzgYF7eX2BjJ6UiXuXlE1jh4SEe1mchLJjc4Z+hqZ7eXZ5bm1zlL6Ue5p7iWeGhKqUY5pzjKJjcIeBe8t7gXyBYIRdlEp4a3mGnK6EfmmMZpqEfFl5gYxzjKZuhGFjhoKGhHx2fnx2eXuMe3aBiWeGvbKMe6KGa5hzYzB7gZOBlGV7hmN8hqZlYot2Y117a6pzc6KEfId8foB5rctrfneJfJ6PcHN2hFiMc5pzjH92c0VzgY2EcElzdmCBlFVzg1GBc65zY4OBboeBcHiBeYJ4ewxzfHx5lIRzlEmEnLKEbk1zfJ6PhmN8eYBljBiEnMOEiXxwezyUcIeBe76EdsKEeX2BdnR4jGWUrXWMjGd7fkl+j4WRlEGMa5Jzho+BhDyEfnqMeXt+g3aHlE1jczClhNN7ZW18eHx8hGFjZW18iXWMjKJjhH57gYuMcIuGWjyMe4ZtjJuExmmMj4WRdntzi4GDhFFzYIRdnGGcjJp7Y0F7e4WEkbCGiX57fnSHa657a6prhBCMe3Z+SmmMjH92eHJ2hK6EY1FzexhrvbKMnI5za4OEfnd+eXuMhImBe897hLaMjN+EfG+BeIOBhF1+eZeJi4GDkXZ2eXKEgZ6Ejpd4c2GHa1V5e5KUfqZuhCx7jKp7lLZrg11+hHx2hFWUoot2nI5zgbh5mo9zvZaUe3qRbqKMfqZ2kbCGhFiM";
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAO.glsl ../../../webgl/renderState".split(" "),function(a,c,b,t,n,r,m,d,f){n=function(e){function g(){return e.apply(this,arguments)||this}b._inheritsLoose(g,
e);var h=g.prototype;h.initializeProgram=function(l){return new m.Program(l.rctx,g.shader.get().build(),r.Default3D)};h.initializePipeline=function(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})};return g}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.SSAO,()=>new Promise((e,g)=>a(["../shaders/SSAO.glsl"],e,g)));c.SSAOTechnique=n;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/SSAO.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(){const k=new g.ShaderBuilder,p=k.fragment;k.include(n.ScreenSpacePass);p.include(r.ReadLinearDepth);k.include(m.CameraSpace);p.uniforms.add(new f.FloatPassUniform("radius",(z,C)=>v(C.camera)));p.code.add(e.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`);p.code.add(e.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`);p.uniforms.add([new d.Float2PassUniform("nearFar",(z,C)=>C.camera.nearFar),new h.Texture2DPassUniform("normalMap",z=>z.normalTexture),new h.Texture2DPassUniform("depthMap",z=>z.depthTexture),new d.Float2PassUniform("zScale",(z,C)=>m.getZScale(C)),new f.FloatPassUniform("projScale",z=>z.projScale),new h.Texture2DPassUniform("rnm",z=>z.noiseTexture),new d.Float2PassUniform("rnmScale",(z,C)=>b.set(q,C.camera.fullWidth/c.unwrap(z.noiseTexture).descriptor.width,C.camera.fullHeight/c.unwrap(z.noiseTexture).descriptor.height)),
new f.FloatPassUniform("intensity",z=>z.intensity),new d.Float2PassUniform("screenSize",(z,C)=>b.set(q,C.camera.fullWidth,C.camera.fullHeight))]);p.code.add(e.glsl`
    void main(void) {
      fillSphere();
      vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
      float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

      if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
        gl_FragColor = vec4(0.0);
        return;
      }

      vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

      // get the normal of current fragment
      vec4 norm4 = texture2D(normalMap, uv);
      vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
      bool isTerrain = norm4.w<0.5;

      float sum = .0;
      vec3 tapPixelPos;

      // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
      // bug or deviation from CE somewhere else?
      float ps = projScale / (2.0 * currentPixelPos.z * zScale.x + zScale.y);

      for(int i = 0; i < ${e.glsl.int(16)}; ++i) {
        vec2 unitOffset = reflect(sphere[i], fres).xy;
        vec2 offset = vec2(-unitOffset * radius * ps);

        //don't use current or very nearby samples
        if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

        vec2 tc = vec2(gl_FragCoord.xy + offset);
        if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
        vec2 tcTap = tc / screenSize;
        float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

        if (isTerrain) {
          bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
          if (isTerrainTap) {
            continue;
          }
        }

        tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

        sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
      }

      // output the result
      float A = max(1.0 - sum * intensity / float(${e.glsl.int(16)}),0.0);

      // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
      A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
      gl_FragColor = vec4(A);
    }
  `);return k}function v(k){return Math.max(10,20*k.computeRenderPixelSizeAtDist(Math.abs(4*k.relativeElevation)))}const q=t.create();t=Object.freeze(Object.defineProperty({__proto__:null,build:l,getRadius:v},Symbol.toStringTag,{value:"Module"}));a.SSAO=t;a.build=l;a.getRadius=v})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,c,b,t,n,r,m,d){function f(h){return 0===h.camera.projectionMatrix[11]?c.set(g,0,1):c.set(g,1,0)}const e=n.create(),g=b.create();a.CameraSpace=function(h){h.fragment.uniforms.add(new m.Float4PassUniform("projInfo",(l,v)=>{l=v.camera.projectionMatrix;v=0===l[11]?t.set(e,2/(v.camera.fullWidth*l[0]),2/(v.camera.fullHeight*l[5]),(1+l[12])/l[0],(1+l[13])/l[5]):t.set(e,-2/(v.camera.fullWidth*l[0]),-2/(v.camera.fullHeight*l[5]),(1-l[8])/l[0],(1-l[9])/l[5]);return v}));h.fragment.uniforms.add(new r.Float2PassUniform("zScale",
(l,v)=>f(v)));h.fragment.code.add(d.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};a.getZScale=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/SSAOParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2f64","../core/shaderModules/interfaces"],function(a,c,b,t){let n=function(d){function f(){var e=d.apply(this,arguments)||this;e.projScale=1;return e}c._inheritsLoose(f,d);return f}(t.NoParameters),r=function(d){function f(){var e=d.apply(this,arguments)||this;e.intensity=
1;return e}c._inheritsLoose(f,d);return f}(n);t=function(d){function f(){return d.apply(this,arguments)||this}c._inheritsLoose(f,d);return f}(t.NoParameters);let m=function(d){function f(){var e=d.apply(this,arguments)||this;e.blurSize=b.create();return e}c._inheritsLoose(f,d);return f}(t);a.BlurDrawParameters=m;a.BlurPassParameters=n;a.SSAODrawParameters=t;a.SSAOPassParameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e){r=function(g){function h(){return g.apply(this,arguments)||this}b._inheritsLoose(h,g);var l=h.prototype;l.initializeProgram=function(v){return new d.Program(v.rctx,h.shader.get().build(),m.Default3D)};l.initializePipeline=function(){return this.configuration.hasAlpha?e.makePipelineState({blending:e.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:e.defaultColorWriteParams}):
e.makePipelineState({colorWrite:e.defaultColorWriteParams})};return h}(r.ShaderTechnique);r.shader=new n.ReloadableShaderModule(t.TextureOnly,()=>new Promise((g,h)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],g,h)));c.TextureTechnique=r;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,c,b,t){let n=function(r){function m(){var d=r.apply(this,arguments)||this;d.hasAlpha=!1;return d}c._inheritsLoose(m,r);return m}(t.ShaderTechniqueConfiguration);b.__decorate([t.parameter()],n.prototype,"hasAlpha",void 0);a.TextureTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./DefaultBufferWriter ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){v=function(P){function I(H){H=P.call(this,H,w)||this;H.supportsEdges=!0;H._configuration=new x.DefaultMaterialTechniqueConfiguration;var L=H.parameters;const O=d.newLayout().vec3f(p.VertexAttribute.POSITION).vec3f(p.VertexAttribute.NORMAL),S=L.textureId||L.normalTextureId||L.metallicRoughnessTextureId||L.emissiveTextureId||L.occlusionTextureId;L.hasVertexTangents&&O.vec4f(p.VertexAttribute.TANGENT);S&&O.vec2f(p.VertexAttribute.UV0);L.hasVertexColors&&
O.vec4u8(p.VertexAttribute.COLOR);L.hasSymbolColors&&O.vec4u8(p.VertexAttribute.SYMBOLCOLOR);b("enable-feature:objectAndLayerId-rendering")&&O.vec4u8(p.VertexAttribute.OBJECTANDLAYERIDCOLOR);H._vertexBufferLayout=O;return H}c._inheritsLoose(I,P);var G=I.prototype;G.isVisibleForOutput=function(H){return H===f.ShaderOutput.Shadow||H===f.ShaderOutput.ShadowExcludeHighlight||H===f.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0};G.isVisible=function(){var H=this.parameters;if(!P.prototype.isVisible.call(this)||
0===H.layerOpacity)return!1;const {instanced:L,hasVertexColors:O,hasSymbolColors:S,vvColorEnabled:R}=H,Q=t.isSome(L)&&L.includes("color"),V="replace"===H.colorMixMode,aa=0<H.opacity;H=H.externalColor&&0<H.externalColor[3];return O&&(Q||R||S)?V?!0:aa:O?V?H:aa:Q||R||S?V?!0:aa:V?H:aa};G.getConfiguration=function(H,L){this._configuration.output=H;this._configuration.hasNormalTexture=!!this.parameters.normalTextureId;this._configuration.hasColorTexture=!!this.parameters.textureId;this._configuration.hasVertexTangents=
this.parameters.hasVertexTangents;this._configuration.instanced=!!this.parameters.instanced;this._configuration.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.hasVerticalOffset=t.isSome(this.parameters.verticalOffset);this._configuration.hasScreenSizePerspective=t.isSome(this.parameters.screenSizePerspective);this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasSliceHighlight=
this.parameters.hasSliceHighlight;this._configuration.alphaDiscardMode=this.parameters.textureAlphaMode;this._configuration.normalType=this.parameters.normalType;this._configuration.transparent=this.parameters.transparent;this._configuration.writeDepth=this.parameters.writeDepth;t.isSome(this.parameters.customDepthTest)&&(this._configuration.customDepthTest=this.parameters.customDepthTest);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.cullFace=this.parameters.hasSlicePlane?
h.CullFaceOptions.None:this.parameters.cullFace;this._configuration.hasMultipassTerrain=L.multipassTerrain.enabled;this._configuration.cullAboveGround=L.multipassTerrain.cullAboveGround;this._configuration.hasModelTransformation=t.isSome(this.parameters.modelTransformation);if(H===f.ShaderOutput.Color||H===f.ShaderOutput.Alpha)this._configuration.hasVertexColors=this.parameters.hasVertexColors,this._configuration.hasSymbolColors=this.parameters.hasSymbolColors,this._configuration.doubleSidedMode=
this.parameters.treeRendering?e.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?e.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?e.NormalsDoubleSidedMode.WindingOrder:e.NormalsDoubleSidedMode.None,this._configuration.instancedColor=t.isSome(this.parameters.instanced)&&this.parameters.instanced.includes("color"),this._configuration.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,
this._configuration.receiveAmbientOcclusion=L.ssaoHelper.active?this.parameters.receiveSSAO:!1,this._configuration.vvColor=this.parameters.vvColorEnabled,this._configuration.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this._configuration.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?g.PBRMode.Schematic:g.PBRMode.Normal:g.PBRMode.Disabled,this._configuration.hasMetallicRoughnessTexture=!!this.parameters.metallicRoughnessTextureId,this._configuration.hasEmissionTexture=
!!this.parameters.emissiveTextureId,this._configuration.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this._configuration.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this._configuration.transparencyPassType=L.transparencyPassType,this._configuration.enableOffset=L.camera.relativeElevation<q.OITPolygonOffsetLimit,this._configuration.snowCover=this.hasSnowCover(L),this._configuration.hasColorTextureTransform=!!this.parameters.colorTextureTransformMatrix,
this._configuration.hasNormalTextureTransform=!!this.parameters.normalTextureTransformMatrix,this._configuration.hasEmissionTextureTransform=!!this.parameters.emissiveTextureTransformMatrix,this._configuration.hasOcclusionTextureTransform=!!this.parameters.occlusionTextureTransformMatrix,this._configuration.hasMetallicRoughnessTextureTransform=!!this.parameters.metallicRoughnessTextureTransformMatrix;return this._configuration};G.hasSnowCover=function(H){return t.isSome(H.weather)&&H.weatherVisible&&
"snowy"===H.weather.type&&"enabled"===H.weather.snowCover};G.intersect=function(H,L,O,S,R,Q){if(t.isSome(this.parameters.verticalOffset)){const aa=O.camera;n.set(M,L[12],L[13],L[14]);L=null;switch(O.viewingMode){case m.ViewingMode.Global:L=n.normalize(K,M);break;case m.ViewingMode.Local:L=n.copy(K,E)}let X=0;var V=n.subtract(N,M,aa.eye);const W=n.length(V);V=n.scale(V,V,1/W);let T=null;this.parameters.screenSizePerspective&&(T=n.dot(L,V));X+=B.verticalOffsetAtDistance(aa,W,this.parameters.verticalOffset,
T??0,this.parameters.screenSizePerspective);n.scale(L,L,X);n.transformMat3(J,L,O.transform.inverseRotation);S=n.subtract(D,S,J);R=n.subtract(F,R,J)}B.intersectTriangleGeometry(H,O,S,R,z.getVerticalOffsetObject3D(O.verticalOffset),Q)};G.requiresSlot=function(H,L){return L===f.ShaderOutput.Color||L===f.ShaderOutput.Alpha||L===f.ShaderOutput.Depth||L===f.ShaderOutput.Normal||L===f.ShaderOutput.Shadow||L===f.ShaderOutput.ShadowHighlight||L===f.ShaderOutput.ShadowExcludeHighlight||L===f.ShaderOutput.Highlight||
L===f.ShaderOutput.ObjectAndLayerIdColor?H===(this.parameters.transparent?this.parameters.writeDepth?k.RenderSlot.TRANSPARENT_MATERIAL:k.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:k.RenderSlot.OPAQUE_MATERIAL)||H===k.RenderSlot.DRAPED_MATERIAL:!1};G.createGLMaterial=function(H){return new y(H)};G.createBufferWriter=function(){return new C.DefaultBufferWriter(this._vertexBufferLayout)};return I}(v.Material);let y=function(P){function I(H){return P.call(this,{...H,...H.material.parameters})||
this}c._inheritsLoose(I,P);var G=I.prototype;G._updateShadowState=function(H){H.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:H.shadowMap.enabled})};G._updateOccludeeState=function(H){H.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:H.hasOccludees})};G.beginSlot=function(H){if(this._output===f.ShaderOutput.Color||this._output===f.ShaderOutput.Alpha)this._updateShadowState(H),
this._updateOccludeeState(H);const L=this._material.parameters;this.updateTexture(L.textureId);const O=H.camera.viewInverseTransposeMatrix;n.set(L.origin,O[3],O[7],O[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(L.treeRendering?u.RealisticTreeTechnique:A.DefaultMaterialTechnique,H)};return I}(l.GLTextureMaterial);l=function(P){function I(){var G=P.apply(this,arguments)||this;G.initTextureTransparent=!1;G.treeRendering=!1;G.hasVertexTangents=!1;return G}
c._inheritsLoose(I,P);return I}(A.DefaultMaterialPassParameters);const w=new l,D=r.create(),F=r.create(),E=r.fromValues(0,0,1),K=r.create(),J=r.create(),M=r.create(),N=r.create();a.DefaultGLMaterial=y;a.DefaultMaterial=v;a.DefaultMaterialParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,c,b){a.NormalsDoubleSidedMode=
void 0;(function(t){t[t.None=0]="None";t[t.View=1]="View";t[t.WindingOrder=2]="WindingOrder";t[t.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||(a.NormalsDoubleSidedMode={}));a.Normals=function(t,n){t=t.fragment;t.code.add(b.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(n.doubleSidedMode){case a.NormalsDoubleSidedMode.None:t.code.add(b.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:t.code.add(b.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:t.code.add(b.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:c.neverReached(n.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../../../../chunks/DefaultMaterial.glsl ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w){let D=function(F){function E(){var K=F.apply(this,arguments)||this;K.isSchematic=!1;K.usePBR=!1;K.mrrFactors=n.fromValues(0,1,.5);K.hasVertexColors=!1;K.hasSymbolColors=!1;K.doubleSided=!1;K.doubleSidedType="normal";K.cullFace=q.CullFaceOptions.Back;K.emissiveFactor=n.fromValues(0,0,0);K.instancedDoublePrecision=!1;K.normalType=f.NormalAttributeType.Attribute;K.receiveSSAO=!0;K.receiveShadows=!0;K.castShadows=!0;K.shadowMappingEnabled=!1;
K.ambient=n.fromValues(.2,.2,.2);K.diffuse=n.fromValues(.8,.8,.8);K.externalColor=r.fromValues(1,1,1,1);K.colorMixMode="multiply";K.opacity=1;K.layerOpacity=1;K.origin=n.create();K.hasSlicePlane=!1;K.hasSliceHighlight=!0;K.offsetTransparentBackfaces=!1;K.vvSizeEnabled=!1;K.vvSizeMinSize=[1,1,1];K.vvSizeMaxSize=[100,100,100];K.vvSizeOffset=[0,0,0];K.vvSizeFactor=[1,1,1];K.vvSizeValue=[1,1,1];K.vvColorEnabled=!1;K.vvColorValues=[0,0,0,0,0,0,0,0];K.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,
0,0,1,0,0,0,1,0,0,0,1,0,0,0];K.vvSymbolAnchor=[0,0,0];K.vvSymbolRotationMatrix=t.create();K.vvOpacityEnabled=!1;K.vvOpacityValues=[];K.vvOpacityOpacities=[];K.transparent=!1;K.writeDepth=!0;K.customDepthTest=q.DepthTestFunction.Less;K.textureAlphaMode=q.AlphaDiscardMode.Blend;K.textureAlphaCutoff=h.defaultMaskAlphaCutoff;K.textureAlphaPremultiplied=!1;K.hasOccludees=!1;K.renderOccluded=p.RenderOccludedFlag.Occlude;return K}b._inheritsLoose(E,F);return E}(g.VertexNormalPassParameters);g=function(F){function E(){var K=
F.apply(this,arguments)||this;K.origin=n.create();K.slicePlaneLocalOrigin=K.origin;return K}b._inheritsLoose(E,F);return E}(g.VertexNormalDrawParameters);v=function(F){function E(){return F.apply(this,arguments)||this}b._inheritsLoose(E,F);var K=E.prototype;K.initializeConfiguration=function(J,M){M.hasWebGL2Context=J.rctx.type===u.ContextType.WEBGL2;M.spherical=J.viewingMode===m.ViewingMode.Global;M.doublePrecisionRequiresObfuscation=J.rctx.driverTest.doublePrecisionRequiresObfuscation.result;M.textureCoordinateType=
M.hasColorTexture||M.hasMetallicRoughnessTexture||M.hasEmissionTexture||M.hasOcclusionTexture||M.hasNormalTexture?e.TextureCoordinateAttributeType.Default:e.TextureCoordinateAttributeType.None;M.objectAndLayerIdColorInstanced=M.instanced};K.initializeProgram=function(J){return this._initializeProgram(J,E.shader)};K._initializeProgram=function(J,M){return new C.Program(J.rctx,M.get().build(this.configuration),k.Default3D)};K._convertDepthTestFunction=function(J){return J===q.DepthTestFunction.Lequal?
y.CompareFunction.LEQUAL:y.CompareFunction.LESS};K._makePipeline=function(J,M){const N=this.configuration,P=J===A.TransparencyPassType.NONE,I=J===A.TransparencyPassType.FrontFace;var G=w.makePipelineState,H=N.output!==d.ShaderOutput.Color&&N.output!==d.ShaderOutput.Alpha||!N.transparent?null:P?z.blendingDefault:z.oitBlending(J);var L=N.cullFace!==q.CullFaceOptions.None?!0:N.hasSlicePlane?!1:!N.transparent&&!N.doubleSidedMode;return G.call(w,{blending:H,culling:L?w.cullingParams(N.cullFace):null,depthTest:{func:z.oitDepthTest(J,
this._convertDepthTestFunction(N.customDepthTest))},depthWrite:P||I?N.writeDepth?w.defaultDepthWriteParams:null:null,colorWrite:w.defaultColorWriteParams,stencilWrite:N.hasOccludees?B.stencilWriteMaskOn:null,stencilTest:N.hasOccludees?M?B.stencilToolMaskBaseParams:B.stencilBaseAllZerosParams:null,polygonOffset:P||I?null:z.getOITPolygonOffset(N.enableOffset)})};K.initializePipeline=function(){this._occludeePipelineState=this._makePipeline(this.configuration.transparencyPassType,!0);return this._makePipeline(this.configuration.transparencyPassType,
!1)};K.getPipelineState=function(J,M){return M?this._occludeePipelineState:F.prototype.getPipelineState.call(this,J,M)};return E}(v.ShaderTechnique);v.shader=new l.ReloadableShaderModule(x.DefaultMaterial,()=>new Promise((F,E)=>a(["./DefaultMaterial.glsl"],F,E)));c.DefaultMaterialDrawParameters=g;c.DefaultMaterialPassParameters=D;c.DefaultMaterialTechnique=v;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../core/maybe ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q){function V(X){const W=new O.ShaderBuilder,{vertex:T,fragment:U,varyings:Y}=W;N.addProjViewLocalOrigin(T,X);W.include(g.PositionAttribute);Y.add("vpos","vec3");W.include(E.VisualVariables,X);W.include(f.InstancedDoublePrecision,X);W.include(k.VerticalOffset,X);X.hasColorTextureTransform&&W.include(F.colorTextureUV);if(X.output===r.ShaderOutput.Color||X.output===r.ShaderOutput.Alpha)X.hasNormalTextureTransform&&
W.include(F.normalTextureUV),X.hasEmissionTextureTransform&&W.include(F.emissiveTextureUV),X.hasOcclusionTextureTransform&&W.include(F.occlusionTextureUV),X.hasMetallicRoughnessTextureTransform&&W.include(F.metallicRoughnessTextureUV),N.addCameraPosition(T,X),W.include(e.NormalAttribute,X),W.include(d.Transform,X),X.normalType===e.NormalAttributeType.Attribute&&X.offsetBackfaces&&W.include(n.Offset),W.include(z.ComputeNormalTexture,X),W.include(q.VertexNormal,X),X.instancedColor&&W.attributes.add(Q.VertexAttribute.INSTANCECOLOR,
"vec4"),Y.add("localvpos","vec3"),W.include(l.TextureCoordinateAttribute,X),W.include(t.ForwardLinearDepth,X),W.include(h.SymbolColor,X),W.include(v.VertexColor,X),T.uniforms.add(new I.Float4PassUniform("externalColor",ba=>ba.externalColor)),Y.add("vcolorExt","vec4"),X.hasMultipassTerrain&&Y.add("depth","float"),X.hasModelTransformation&&T.uniforms.add(new L.Matrix4PassUniform("model",ba=>c.isSome(ba.modelTransformation)?ba.modelTransformation:b.IDENTITY)),T.code.add(H.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${X.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${H.glsl.float(K.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${X.normalType===e.NormalAttributeType.Attribute?H.glsl`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${X.hasVertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${X.hasModelTransformation?"model,":""} vpos);
          ${X.normalType===e.NormalAttributeType.Attribute&&X.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${X.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
        ${X.hasColorTextureTransform?H.glsl`forwardColorUV();`:""}
        ${X.hasNormalTextureTransform?H.glsl`forwardNormalUV();`:""}
        ${X.hasEmissionTextureTransform?H.glsl`forwardEmissiveUV();`:""}
        ${X.hasOcclusionTextureTransform?H.glsl`forwardOcclusionUV();`:""}
        ${X.hasMetallicRoughnessTextureTransform?H.glsl`forwardMetallicRoughnessUV();`:""}
      }
    `);X.output===r.ShaderOutput.Alpha&&(W.include(m.SliceDraw,X),W.include(J.DiscardOrAdjustAlphaPass,X),W.include(x.multipassTerrainTest,X),U.uniforms.add([new G.FloatPassUniform("opacity",ba=>ba.opacity),new G.FloatPassUniform("layerOpacity",ba=>ba.layerOpacity)]),X.hasColorTexture&&U.uniforms.add(new S.Texture2DPassUniform("tex",ba=>ba.texture)),U.include(M.MixExternalColor),U.code.add(H.glsl`
      void main() {
        discardBySlice(vpos);
        ${X.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${X.hasColorTexture?H.glsl`
                vec4 texColor = texture2D(tex, ${X.hasColorTextureTransform?H.glsl`colorUV`:H.glsl`vuv0`});
                ${X.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:H.glsl`vec4 texColor = vec4(1.0);`}
        ${X.hasVertexColors?H.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:H.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `));X.output===r.ShaderOutput.Color&&(W.include(m.SliceDraw,X),W.include(B.EvaluateSceneLighting,X),W.include(C.EvaluateAmbientOcclusion,X),W.include(J.DiscardOrAdjustAlphaPass,X),W.include(X.instancedDoublePrecision?D.ReadShadowMapPass:D.ReadShadowMapDraw,X),W.include(x.multipassTerrainTest,X),N.addCameraPosition(U,X),U.uniforms.add([T.uniforms.get("localOrigin"),new P.Float3PassUniform("ambient",ba=>ba.ambient),new P.Float3PassUniform("diffuse",ba=>ba.diffuse),new G.FloatPassUniform("opacity",
ba=>ba.opacity),new G.FloatPassUniform("layerOpacity",ba=>ba.layerOpacity)]),X.hasColorTexture&&U.uniforms.add(new S.Texture2DPassUniform("tex",ba=>ba.texture)),W.include(w.PhysicallyBasedRenderingParameters,X),W.include(y.PhysicallyBasedRendering,X),U.include(M.MixExternalColor),W.include(u.Normals,X),B.addAmbientBoostFactor(U),B.addLightingGlobalFactor(U),A.addMainLightIntensity(U),U.code.add(H.glsl`
      void main() {
        discardBySlice(vpos);
        ${X.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${X.hasColorTexture?H.glsl`
                vec4 texColor = texture2D(tex, ${X.hasColorTextureTransform?H.glsl`colorUV`:H.glsl`vuv0`});
                ${X.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:H.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${X.normalType===e.NormalAttributeType.ScreenDerivative?H.glsl`
                vec3 normal = screenDerivativeNormal(localvpos);`:H.glsl`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${X.pbrMode===w.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        vec3 posWorld = vpos + localOrigin;

        float additionalAmbientScale = additionalDirectedAmbientLight(posWorld);
        float shadow = ${X.receiveShadows?"readShadowMap(vpos, linearDepth)":X.spherical?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

        vec3 matColor = max(ambient, diffuse);
        ${X.hasVertexColors?H.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:H.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${X.hasNormalTexture?H.glsl`
                mat3 tangentSpace = ${X.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:H.glsl`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${X.spherical?H.glsl`normalize(posWorld);`:H.glsl`vec3(0.0, 0.0, 1.0);`}

        ${X.snowCover?H.glsl`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${X.pbrMode===w.PBRMode.Normal||X.pbrMode===w.PBRMode.Schematic?H.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${X.snowCover?H.glsl`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:H.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${X.transparencyPassType===R.TransparencyPassType.Color?H.glsl`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `));W.include(p.DefaultMaterialAuxiliaryPasses,X);return W}const aa=Object.freeze(Object.defineProperty({__proto__:null,build:V},Symbol.toStringTag,{value:"Module"}));a.DefaultMaterial=aa;a.build=V})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,c){a.Offset=function(b){b.vertex.code.add(c.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../ShaderOutput ../util/DoublePrecision.glsl ../util/View.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderTechnique/ShaderTechniqueConfiguration ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){let v=function(k){function p(){var z=k.apply(this,arguments)||this;z.instancedDoublePrecision=!1;return z}c._inheritsLoose(p,k);return p}(g.ShaderTechniqueConfiguration);b.__decorate([g.parameter()],v.prototype,"instancedDoublePrecision",void 0);const q=n.create();a.InstancedDoubleConfiguration=v;a.InstancedDoublePrecision=function(k,p){p.instanced&&p.instancedDoublePrecision&&(k.attributes.add(h.VertexAttribute.MODELORIGINHI,"vec3"),k.attributes.add(h.VertexAttribute.MODELORIGINLO,
"vec3"),k.attributes.add(h.VertexAttribute.MODEL,"mat3"),k.attributes.add(h.VertexAttribute.MODELNORMAL,"mat3"));k=k.vertex;p.instancedDoublePrecision&&(k.include(m.DoublePrecision,p),k.uniforms.add(new f.Float3DrawUniform("viewOriginHi",(z,C)=>l.encodeDoubleHi(t.set(q,C.camera.viewInverseTransposeMatrix[3],C.camera.viewInverseTransposeMatrix[7],C.camera.viewInverseTransposeMatrix[11]),q))),k.uniforms.add(new f.Float3DrawUniform("viewOriginLo",(z,C)=>l.encodeDoubleLo(t.set(q,C.camera.viewInverseTransposeMatrix[3],
C.camera.viewInverseTransposeMatrix[7],C.camera.viewInverseTransposeMatrix[11]),q))));k.code.add(e.glsl`
    vec3 calculateVPos() {
      ${p.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `);k.code.add(e.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${p.instancedDoublePrecision?e.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);k.code.add(e.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${p.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `);p.output===r.ShaderOutput.Normal&&(d.addViewNormal(k),k.code.add(e.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${p.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `));p.hasVertexTangents&&k.code.add(e.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${p.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(a,c,b,t,n,r){a.SymbolColor=function(m,d){d.hasSymbolColors?(m.include(c.DecodeSymbolColor),m.attributes.add(n.VertexAttribute.SYMBOLCOLOR,
"vec4"),m.varyings.add("colorMixMode","mediump float"),m.vertex.code.add(t.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(m.fragment.uniforms.add(new b.IntegerPassUniform("colorMixMode",f=>r.colorMixModes[f.colorMixMode])),m.vertex.code.add(t.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,c,b){a.DecodeSymbolColor=function(t){t.vertex.code.add(b.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${b.glsl.int(c.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${b.glsl.int(c.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${b.glsl.int(c.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${b.glsl.int(c.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils","../../../../core/maybe"],function(a,c,b){a.ColorMixModeEnum=void 0;(function(t){t[t.Multiply=1]="Multiply";t[t.Ignore=2]="Ignore";t[t.Replace=3]="Replace";t[t.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(t,n,r){if(b.isNone(t)||n===a.ColorMixModeEnum.Ignore)r[0]=255,r[1]=255,r[2]=
255,r[3]=255;else{var m=c.clamp(Math.round(85*t[3]),0,85);n=0===m||n===a.ColorMixModeEnum.Tint?0:n===a.ColorMixModeEnum.Replace?85:170;r[0]=c.clamp(Math.round(255*t[0]),0,255);r[1]=c.clamp(Math.round(255*t[1]),0,255);r[2]=c.clamp(Math.round(255*t[2]),0,255);r[3]=m+n}};a.parseColorMixMode=function(t){switch(t){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;
default:return a.ColorMixModeEnum.Multiply}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,c,b){a.VertexColor=function(t,n){n.hasVertexColors?(t.attributes.add(b.VertexAttribute.COLOR,"vec4"),t.varyings.add("vColor","vec4"),t.vertex.code.add(c.glsl`void forwardVertexColor() { vColor = color; }`),t.vertex.code.add(c.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):
t.vertex.code.add(c.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../../../../../../core/maybe ../../../../../../chunks/mat4f64 ../ForwardLinearDepth.glsl ../ShaderOutput ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/ObjectAndLayerIdColor.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/View.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform ../../../lib/basicInterfaces".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B){a.DefaultMaterialAuxiliaryPasses=function(A,x){const {vertex:u,fragment:y}=A,w=x.hasModelTransformation;w&&u.uniforms.add(new z.Matrix4PassUniform("model",F=>c.isSome(F.modelTransformation)?F.modelTransformation:b.IDENTITY));const D=x.hasColorTexture&&x.alphaDiscardMode!==B.AlphaDiscardMode.Opaque;switch(x.output){case n.ShaderOutput.Depth:case n.ShaderOutput.Shadow:case n.ShaderOutput.ShadowHighlight:case n.ShaderOutput.ShadowExcludeHighlight:case n.ShaderOutput.ObjectAndLayerIdColor:k.addProjViewLocalOrigin(u,
x);A.include(m.Transform,x);A.include(e.TextureCoordinateAttribute,x);A.include(v.VisualVariables,x);A.include(h.OutputDepth,x);A.include(r.SliceDraw,x);A.include(f.ObjectAndLayerIdColor,x);t.addNearFar(A);A.varyings.add("depth","float");D&&y.uniforms.add(new C.Texture2DPassUniform("tex",F=>F.texture));u.code.add(p.glsl`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPositionWithDepth(proj, view, ${w?"model,":""} vpos, nearFar, depth);
            forwardTextureCoordinates();
            forwardObjectAndLayerIdColor();
          }
        `);A.include(q.DiscardOrAdjustAlphaPass,x);y.code.add(p.glsl`
          void main(void) {
            discardBySlice(vpos);
            ${D?p.glsl`
                    vec4 texColor = texture2D(tex, ${x.hasColorTextureTransform?p.glsl`colorUV`:p.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            ${x.output===n.ShaderOutput.ObjectAndLayerIdColor?p.glsl`outputObjectAndLayerIdColor();`:p.glsl`outputDepth(depth);`}
          }
        `);break;case n.ShaderOutput.Normal:k.addProjViewLocalOrigin(u,x);A.include(m.Transform,x);A.include(d.NormalAttribute,x);A.include(g.VertexNormal,x);A.include(e.TextureCoordinateAttribute,x);A.include(v.VisualVariables,x);D&&y.uniforms.add(new C.Texture2DPassUniform("tex",F=>F.texture));A.varyings.add("vPositionView","vec3");u.code.add(p.glsl`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            ${x.normalType===d.NormalAttributeType.Attribute?p.glsl`
            vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${w?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `);A.include(r.SliceDraw,x);A.include(q.DiscardOrAdjustAlphaPass,x);y.code.add(p.glsl`
          void main() {
            discardBySlice(vpos);
            ${D?p.glsl`
                    vec4 texColor = texture2D(tex, ${x.hasColorTextureTransform?p.glsl`colorUV`:p.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}

            ${x.normalType===d.NormalAttributeType.ScreenDerivative?p.glsl`
                vec3 normal = screenDerivativeNormal(vPositionView);`:p.glsl`
                vec3 normal = normalize(vNormalWorld);
                if (gl_FrontFacing == false) normal = -normal;`}
            gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
          }
        `);break;case n.ShaderOutput.Highlight:k.addProjViewLocalOrigin(u,x),A.include(m.Transform,x),A.include(e.TextureCoordinateAttribute,x),A.include(v.VisualVariables,x),D&&y.uniforms.add(new C.Texture2DPassUniform("tex",F=>F.texture)),u.code.add(p.glsl`
          void main(void) {
            vpos = calculateVPos();
            vpos = subtractOrigin(vpos);
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, ${w?"model,":""} vpos);
            forwardTextureCoordinates();
          }
        `),A.include(r.SliceDraw,x),A.include(q.DiscardOrAdjustAlphaPass,x),A.include(l.OutputHighlight,x),y.code.add(p.glsl`
          void main() {
            discardBySlice(vpos);
            ${D?p.glsl`
                    vec4 texColor = texture2D(tex, ${x.hasColorTextureTransform?p.glsl`colorUV`:p.glsl`vuv0`});
                    discardOrAdjustAlpha(texColor);`:""}
            outputHighlight();
          }
        `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define("exports ./DiscardOrAdjustAlphaBlend.glsl ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(a,c,b,t,n,r){function m(d,f,e){const g=d.fragment;f.alphaDiscardMode!==r.AlphaDiscardMode.Mask&&f.alphaDiscardMode!==r.AlphaDiscardMode.MaskBlend||
g.uniforms.add(e);switch(f.alphaDiscardMode){case r.AlphaDiscardMode.Blend:return d.include(c.DiscardOrAdjustAlphaBlend);case r.AlphaDiscardMode.Opaque:g.code.add(n.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case r.AlphaDiscardMode.Mask:g.code.add(n.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case r.AlphaDiscardMode.MaskBlend:d.fragment.code.add(n.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}a.DiscardOrAdjustAlphaDraw=function(d,f){m(d,f,new b.FloatDrawUniform("textureAlphaCutoff",e=>e.textureAlphaCutoff))};a.DiscardOrAdjustAlphaPass=function(d,f){m(d,f,new t.FloatPassUniform("textureAlphaCutoff",
e=>e.textureAlphaCutoff))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl":function(){define(["exports","./AlphaCutoff","../../shaderModules/interfaces"],function(a,c,b){a.DiscardOrAdjustAlphaBlend=function(t){t.fragment.code.add(b.glsl`
    #define discardOrAdjustAlpha(color) { if (color.a < ${b.glsl.float(c.symbolAlphaCutoff)}) { discard; } }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"float",t.BindType.Draw,(f,e,g)=>f.setUniform1f(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.FloatDrawUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../util/WebGL2Utils ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){a.ComputeNormalTexture=
function(h,l){const v=h.fragment;l.hasVertexTangents?(h.attributes.add(g.VertexAttribute.TANGENT,"vec4"),h.varyings.add("vTangent","vec4"),l.doubleSidedMode===t.NormalsDoubleSidedMode.WindingOrder?v.code.add(r.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):v.code.add(r.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(h.extensions.add("GL_OES_standard_derivatives"),v.code.add(r.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`));l.textureCoordinateType!==c.TextureCoordinateAttributeType.None&&(h.include(b.VertexTextureCoordinates,l),h=l.supportsTextureAtlas?l.hasWebGL2Context?f.TextureSizeUniformType.None:f.TextureSizeUniformType.Size:f.TextureSizeUniformType.None,v.uniforms.add(l.pbrTextureBindType===e.BindType.Pass?d.createTexture2DPassSizeUniforms("normalTexture",q=>q.textureNormal,h):m.createTexture2DDrawSizeUniforms("normalTexture",q=>q.textureNormal,h)),v.code.add(r.glsl`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${l.supportsTextureAtlas?r.glsl`vtc.size = ${n.textureSize(l,"normalTexture")};`:""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define("exports ../util/WebGL2Utils ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType ../../../lib/SSAOHelper".split(" "),function(a,c,b,t,n,r){a.EvaluateAmbientOcclusion=function(m,d){m=m.fragment;d.receiveAmbientOcclusion?(m.uniforms.add(t.createTexture2DPassSizeUniforms("ssaoTex",
(f,e)=>e.ssaoHelper.colorTexture,d.hasWebGL2Context?n.TextureSizeUniformType.None:n.TextureSizeUniformType.InvSize)),m.constants.add("blurSizePixelsInverse","float",1/r.blurSizePixels),m.code.add(b.glsl`
      float evaluateAmbientOcclusionInverse() {
        vec2 ssaoTextureSizeInverse = ${c.textureSize(d,"ssaoTex",!0)};
        return texture2D(ssaoTex, gl_FragCoord.xy * blurSizePixelsInverse * ssaoTextureSizeInverse).a;
      }

      float evaluateAmbientOcclusion() {
        return 1.0 - evaluateAmbientOcclusionInverse();
      }
    `)):m.code.add(b.glsl`float evaluateAmbientOcclusionInverse() { return 1.0; }
float evaluateAmbientOcclusion() { return 0.0; }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ../../../../../../core/compilerUtils ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(q){q.constants.add("ambientBoostFactor","float",h.ambientBoost)}function v(q){q.uniforms.add(new e.FloatPassUniform("lightingGlobalFactor",(k,p)=>p.lighting.globalFactor))}a.EvaluateSceneLighting=function(q,k){const p=q.fragment;q.include(t.EvaluateAmbientOcclusion,k);k.pbrMode!==m.PBRMode.Disabled&&q.include(r.PhysicallyBasedRendering,k);q.include(b.EvaluateAmbientLighting,k);q.include(d.PiUtils);p.code.add(g.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${k.pbrMode===m.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);l(p);v(p);n.addMainLightDirection(p);p.code.add(g.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${k.spherical?g.glsl`normalize(vPosWorld)`:g.glsl`vec3(0.0, 0.0, 1.0)`}, mainLightDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);n.addMainLightIntensity(p);p.code.add(g.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * mainLightIntensity;
}`);switch(k.pbrMode){case m.PBRMode.Disabled:case m.PBRMode.WaterOnIntegratedMesh:case m.PBRMode.Water:q.include(n.MainLighting,k);p.code.add(g.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);break;case m.PBRMode.Normal:case m.PBRMode.Schematic:p.code.add(g.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`);p.code.add(g.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`);k.useFillLights?p.uniforms.add(new f.BooleanPassUniform("hasFillLights",(z,C)=>C.enableFillLights)):p.constants.add("hasFillLights","bool",!1);p.code.add(g.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * mainLightIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * mainLightIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`);p.uniforms.add([new e.FloatPassUniform("lightingSpecularStrength",(z,C)=>C.lighting.mainLight.specularStrength),new e.FloatPassUniform("lightingEnvironmentStrength",(z,C)=>C.lighting.mainLight.environmentStrength)]);p.code.add(g.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * mainLightIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * mainLightIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`);p.code.add(g.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${k.pbrMode===m.PBRMode.Schematic?g.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:g.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `);break;case m.PBRMode.Terrain:case m.PBRMode.TerrainWithWater:q.include(n.MainLighting,k);p.code.add(g.glsl`const float roughnessTerrain = 0.5;
const float specularityTerrain = 0.5;
const vec3 fresnelReflectionTerrain = vec3(0.04);
vec3 evaluateTerrainLighting(vec3 n, vec3 c, float shadow, float ssao, vec3 al, vec3 vd, vec3 nup) {
vec3 viewDirection = -vd;
vec3 h = normalize(viewDirection + mainLightDirection);
float NdotL = clamp(dot(n, mainLightDirection), 0.001, 1.0);
float NdotV = clamp(abs(dot(n, viewDirection)), 0.001, 1.0);
float NdotH = clamp(dot(n, h), 0.0, 1.0);
float NdotNG = clamp(dot(n, nup), -1.0, 1.0);
vec3 albedoLinear = pow(c, vec3(GAMMA_SRGB));
float lightness = 0.3 * albedoLinear[0] + 0.5 * albedoLinear[1] + 0.2 * albedoLinear[2];
vec3 f0 = (0.85 * lightness + 0.15) * fresnelReflectionTerrain;
vec3 f90 =  vec3(clamp(dot(f0, vec3(50.0 * 0.33)), 0.0, 1.0));
vec3 mainLightIrradianceComponent = (1. - shadow) * NdotL * mainLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(n, ssao) + al;
vec3 ambientSky = ambientLightIrradianceComponent + mainLightIrradianceComponent;
vec3 indirectDiffuse = ((1.0 - NdotNG) * mainLightIrradianceComponent + (1.0 + NdotNG ) * ambientSky) * 0.5;
vec3 outDiffColor = albedoLinear * (1.0 - f0) * indirectDiffuse / PI;
vec3 mainLightRadianceComponent = normalDistribution(NdotH, roughnessTerrain) * mainLightIntensity;
vec2 dfg = prefilteredDFGAnalytical(roughnessTerrain, NdotV);
vec3 specularColor = f0 * dfg.x + f90 * dfg.y;
vec3 specularComponent = specularityTerrain * specularColor * mainLightRadianceComponent;
vec3 outColorLinear = outDiffColor + specularComponent;
vec3 outColor = pow(outColorLinear, vec3(INV_GAMMA_SRGB));
return outColor;
}`);break;default:c.neverReached(k.pbrMode);case m.PBRMode.COUNT:}};a.addAmbientBoostFactor=l;a.addLightingGlobalFactor=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/TextureTransformUV.glsl":function(){define(["exports","../../../../../../core/maybe","../../../../../../chunks/mat3f32","../../shaderModules/interfaces","../../shaderModules/Matrix3PassUniform"],function(a,c,b,t,n){a.colorTextureUV=function(r){r.vertex.uniforms.add(new n.Matrix3PassUniform("colorTextureTransformMatrix",
m=>c.isSome(m.colorTextureTransformMatrix)?m.colorTextureTransformMatrix:b.create()));r.varyings.add("colorUV","vec2");r.vertex.code.add(t.glsl`void forwardColorUV(){
colorUV = (colorTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.emissiveTextureUV=function(r){r.vertex.uniforms.add(new n.Matrix3PassUniform("emissiveTextureTransformMatrix",m=>c.isSome(m.emissiveTextureTransformMatrix)?m.emissiveTextureTransformMatrix:b.create()));r.varyings.add("emissiveUV","vec2");r.vertex.code.add(t.glsl`void forwardEmissiveUV(){
emissiveUV = (emissiveTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.metallicRoughnessTextureUV=function(r){r.vertex.uniforms.add(new n.Matrix3PassUniform("metallicRoughnessTextureTransformMatrix",m=>c.isSome(m.metallicRoughnessTextureTransformMatrix)?m.metallicRoughnessTextureTransformMatrix:b.create()));r.varyings.add("metallicRoughnessUV","vec2");r.vertex.code.add(t.glsl`void forwardMetallicRoughnessUV(){
metallicRoughnessUV = (metallicRoughnessTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.normalTextureUV=function(r){r.vertex.uniforms.add(new n.Matrix3PassUniform("normalTextureTransformMatrix",m=>c.isSome(m.normalTextureTransformMatrix)?m.normalTextureTransformMatrix:b.create()));r.varyings.add("normalUV","vec2");r.vertex.code.add(t.glsl`void forwardNormalUV(){
normalUV = (normalTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};a.occlusionTextureUV=function(r){r.vertex.uniforms.add(new n.Matrix3PassUniform("occlusionTextureTransformMatrix",m=>c.isSome(m.occlusionTextureTransformMatrix)?m.occlusionTextureTransformMatrix:b.create()));r.varyings.add("occlusionUV","vec2");r.vertex.code.add(t.glsl`void forwardOcclusionUV(){
occlusionUV = (occlusionTextureTransformMatrix * vec3(vuv0, 1.0)).xy;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function c(){const m=new Float32Array(9);m[0]=1;m[4]=1;m[8]=1;return m}function b(m){const d=new Float32Array(9);d[0]=m[0];d[1]=m[1];d[2]=m[2];d[3]=m[3];d[4]=m[4];d[5]=m[5];d[6]=m[6];d[7]=m[7];d[8]=m[8];return d}function t(m,d,f,e,g,h,l,v,q){const k=new Float32Array(9);k[0]=m;k[1]=d;k[2]=f;k[3]=e;k[4]=g;k[5]=h;k[6]=l;k[7]=v;k[8]=q;return k}function n(m,d){return new Float32Array(m,
d,9)}const r=Object.freeze(Object.defineProperty({__proto__:null,clone:b,create:c,createView:n,fromValues:t},Symbol.toStringTag,{value:"Module"}));a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.mat3f32=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,c,b,t){a.MixExternalColor=function(n){n.include(b.ColorConversion);n.code.add(t.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${t.glsl.int(c.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${t.glsl.int(c.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${t.glsl.int(c.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${t.glsl.int(c.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${t.glsl.int(c.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){h=function(l){function v(){var q=l.apply(this,arguments)||this;q.output=t.ShaderOutput.Color;q.alphaDiscardMode=e.AlphaDiscardMode.Opaque;q.doubleSidedMode=m.NormalsDoubleSidedMode.None;q.pbrMode=d.PBRMode.Disabled;q.cullFace=e.CullFaceOptions.None;q.transparencyPassType=g.TransparencyPassType.NONE;q.normalType=n.NormalAttributeType.Attribute;q.textureCoordinateType=r.TextureCoordinateAttributeType.None;q.customDepthTest=e.DepthTestFunction.Less;q.spherical=!1;q.hasVertexColors=
!1;q.hasSymbolColors=!1;q.hasVerticalOffset=!1;q.hasSlicePlane=!1;q.hasSliceHighlight=!0;q.hasColorTexture=!1;q.hasMetallicRoughnessTexture=!1;q.hasEmissionTexture=!1;q.hasOcclusionTexture=!1;q.hasNormalTexture=!1;q.hasScreenSizePerspective=!1;q.hasVertexTangents=!1;q.hasOccludees=!1;q.hasMultipassTerrain=!1;q.hasModelTransformation=!1;q.offsetBackfaces=!1;q.vvSize=!1;q.vvColor=!1;q.receiveShadows=!1;q.receiveAmbientOcclusion=!1;q.textureAlphaPremultiplied=!1;q.instanced=!1;q.instancedColor=!1;q.objectAndLayerIdColorInstanced=
!1;q.instancedDoublePrecision=!1;q.doublePrecisionRequiresObfuscation=!1;q.writeDepth=!0;q.transparent=!1;q.enableOffset=!0;q.cullAboveGround=!1;q.snowCover=!1;q.hasColorTextureTransform=!1;q.hasEmissionTextureTransform=!1;q.hasNormalTextureTransform=!1;q.hasOcclusionTextureTransform=!1;q.hasMetallicRoughnessTextureTransform=!1;return q}c._inheritsLoose(v,l);return v}(h.DefaultTechniqueConfiguration);b.__decorate([f.parameter({count:t.ShaderOutput.COUNT})],h.prototype,"output",void 0);b.__decorate([f.parameter({count:e.AlphaDiscardMode.COUNT})],
h.prototype,"alphaDiscardMode",void 0);b.__decorate([f.parameter({count:m.NormalsDoubleSidedMode.COUNT})],h.prototype,"doubleSidedMode",void 0);b.__decorate([f.parameter({count:d.PBRMode.COUNT})],h.prototype,"pbrMode",void 0);b.__decorate([f.parameter({count:e.CullFaceOptions.COUNT})],h.prototype,"cullFace",void 0);b.__decorate([f.parameter({count:g.TransparencyPassType.COUNT})],h.prototype,"transparencyPassType",void 0);b.__decorate([f.parameter({count:n.NormalAttributeType.COUNT})],h.prototype,
"normalType",void 0);b.__decorate([f.parameter({count:r.TextureCoordinateAttributeType.COUNT})],h.prototype,"textureCoordinateType",void 0);b.__decorate([f.parameter({count:e.DepthTestFunction.COUNT})],h.prototype,"customDepthTest",void 0);b.__decorate([f.parameter()],h.prototype,"spherical",void 0);b.__decorate([f.parameter()],h.prototype,"hasVertexColors",void 0);b.__decorate([f.parameter()],h.prototype,"hasSymbolColors",void 0);b.__decorate([f.parameter()],h.prototype,"hasVerticalOffset",void 0);
b.__decorate([f.parameter()],h.prototype,"hasSlicePlane",void 0);b.__decorate([f.parameter()],h.prototype,"hasSliceHighlight",void 0);b.__decorate([f.parameter()],h.prototype,"hasColorTexture",void 0);b.__decorate([f.parameter()],h.prototype,"hasMetallicRoughnessTexture",void 0);b.__decorate([f.parameter()],h.prototype,"hasEmissionTexture",void 0);b.__decorate([f.parameter()],h.prototype,"hasOcclusionTexture",void 0);b.__decorate([f.parameter()],h.prototype,"hasNormalTexture",void 0);b.__decorate([f.parameter()],
h.prototype,"hasScreenSizePerspective",void 0);b.__decorate([f.parameter()],h.prototype,"hasVertexTangents",void 0);b.__decorate([f.parameter()],h.prototype,"hasOccludees",void 0);b.__decorate([f.parameter()],h.prototype,"hasMultipassTerrain",void 0);b.__decorate([f.parameter()],h.prototype,"hasModelTransformation",void 0);b.__decorate([f.parameter()],h.prototype,"offsetBackfaces",void 0);b.__decorate([f.parameter()],h.prototype,"vvSize",void 0);b.__decorate([f.parameter()],h.prototype,"vvColor",
void 0);b.__decorate([f.parameter()],h.prototype,"receiveShadows",void 0);b.__decorate([f.parameter()],h.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([f.parameter()],h.prototype,"textureAlphaPremultiplied",void 0);b.__decorate([f.parameter()],h.prototype,"instanced",void 0);b.__decorate([f.parameter()],h.prototype,"instancedColor",void 0);b.__decorate([f.parameter()],h.prototype,"objectAndLayerIdColorInstanced",void 0);b.__decorate([f.parameter()],h.prototype,"instancedDoublePrecision",
void 0);b.__decorate([f.parameter()],h.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([f.parameter()],h.prototype,"writeDepth",void 0);b.__decorate([f.parameter()],h.prototype,"transparent",void 0);b.__decorate([f.parameter()],h.prototype,"enableOffset",void 0);b.__decorate([f.parameter()],h.prototype,"cullAboveGround",void 0);b.__decorate([f.parameter()],h.prototype,"snowCover",void 0);b.__decorate([f.parameter()],h.prototype,"hasColorTextureTransform",void 0);b.__decorate([f.parameter()],
h.prototype,"hasEmissionTextureTransform",void 0);b.__decorate([f.parameter()],h.prototype,"hasNormalTextureTransform",void 0);b.__decorate([f.parameter()],h.prototype,"hasOcclusionTextureTransform",void 0);b.__decorate([f.parameter()],h.prototype,"hasMetallicRoughnessTextureTransform",void 0);b.__decorate([f.parameter({constValue:!0})],h.prototype,"hasVvInstancing",void 0);b.__decorate([f.parameter({constValue:!1})],h.prototype,"useCustomDTRExponentForWater",void 0);b.__decorate([f.parameter({constValue:!1})],
h.prototype,"supportsTextureAtlas",void 0);b.__decorate([f.parameter({constValue:!0})],h.prototype,"useFillLights",void 0);a.DefaultMaterialTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderTechnique/ReloadableShaderModule ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),
function(a,c,b,t,n,r,m,d){m=function(f){function e(){return f.apply(this,arguments)||this}b._inheritsLoose(e,f);var g=e.prototype;g.initializeConfiguration=function(h,l){f.prototype.initializeConfiguration.call(this,h,l);l.hasMetallicRoughnessTexture=!1;l.hasEmissionTexture=!1;l.hasOcclusionTexture=!1;l.hasNormalTexture=!1;l.hasModelTransformation=!1;l.normalType=t.NormalAttributeType.Attribute;l.doubleSidedMode=n.NormalsDoubleSidedMode.WindingOrder;l.hasVertexTangents=!1};g.initializeProgram=function(h){return this._initializeProgram(h,
e.shader)};return e}(m.DefaultMaterialTechnique);m.shader=new r.ReloadableShaderModule(d.RealisticTree,()=>new Promise((f,e)=>a(["./RealisticTree.glsl"],f,e)));c.RealisticTreeTechnique=m;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I){function G(L){const O=new M.ShaderBuilder,{vertex:S,fragment:R,varyings:Q}=O;D.addProjViewLocalOrigin(S,L);O.include(f.PositionAttribute);Q.add("vpos","vec3");O.include(x.VisualVariables,L);O.include(m.InstancedDoublePrecision,L);O.include(l.VerticalOffset,L);if(L.output===t.ShaderOutput.Color||L.output===t.ShaderOutput.Alpha)D.addCameraPosition(O.vertex,L),O.include(d.NormalAttribute,L),O.include(r.Transform,L),L.offsetBackfaces&&
O.include(b.Offset),L.instancedColor&&O.attributes.add(I.VertexAttribute.INSTANCECOLOR,"vec4"),Q.add("vNormalWorld","vec3"),Q.add("localvpos","vec3"),L.hasMultipassTerrain&&Q.add("depth","float"),O.include(g.TextureCoordinateAttribute,L),O.include(c.ForwardLinearDepth,L),O.include(e.SymbolColor,L),O.include(h.VertexColor,L),S.uniforms.add(new E.Float4PassUniform("externalColor",V=>V.externalColor)),Q.add("vcolorExt","vec4"),S.code.add(J.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${L.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${J.glsl.float(u.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${L.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${L.hasMultipassTerrain?J.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);L.output===t.ShaderOutput.Alpha&&(O.include(n.SliceDraw,L),O.include(y.DiscardOrAdjustAlphaPass,L),O.include(z.multipassTerrainTest,L),R.uniforms.add([new K.FloatPassUniform("opacity",V=>V.opacity),new K.FloatPassUniform("layerOpacity",V=>V.layerOpacity)]),L.hasColorTexture&&R.uniforms.add(new N.Texture2DPassUniform("tex",V=>V.texture)),R.include(w.MixExternalColor),R.code.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${L.hasMultipassTerrain?J.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${L.hasColorTexture?J.glsl`
                vec4 texColor = texture2D(tex, ${L.hasColorTextureTransform?J.glsl`colorUV`:J.glsl`vuv0`});
                ${L.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        ${L.hasVertexColors?J.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `));L.output===t.ShaderOutput.Color&&(O.include(n.SliceDraw,L),O.include(k.EvaluateSceneLighting,L),O.include(q.EvaluateAmbientOcclusion,L),O.include(y.DiscardOrAdjustAlphaPass,L),O.include(L.instancedDoublePrecision?A.ReadShadowMapPass:A.ReadShadowMapDraw,L),O.include(z.multipassTerrainTest,L),D.addCameraPosition(O.fragment,L),p.addMainLightDirection(R),k.addAmbientBoostFactor(R),k.addLightingGlobalFactor(R),R.uniforms.add([S.uniforms.get("localOrigin"),S.uniforms.get("view"),new F.Float3PassUniform("ambient",
V=>V.ambient),new F.Float3PassUniform("diffuse",V=>V.diffuse),new K.FloatPassUniform("opacity",V=>V.opacity),new K.FloatPassUniform("layerOpacity",V=>V.layerOpacity)]),L.hasColorTexture&&R.uniforms.add(new N.Texture2DPassUniform("tex",V=>V.texture)),O.include(B.PhysicallyBasedRenderingParameters,L),O.include(C.PhysicallyBasedRendering,L),R.include(w.MixExternalColor),O.extensions.add("GL_OES_standard_derivatives"),p.addMainLightIntensity(R),R.code.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${L.hasMultipassTerrain?J.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${L.hasColorTexture?J.glsl`
                vec4 texColor = texture2D(tex, ${L.hasColorTextureTransform?J.glsl`colorUV`:J.glsl`vuv0`});
                ${L.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${L.pbrMode===B.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${L.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":L.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${L.hasVertexColors?J.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${L.snowCover?J.glsl`albedo = mix(albedo, vec3(1), 0.9);`:J.glsl``}
        ${J.glsl`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -mainLightDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * mainLightIntensity;`}
        ${L.pbrMode===B.PBRMode.Normal||L.pbrMode===B.PBRMode.Schematic?L.spherical?J.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:J.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:J.glsl``}
        ${L.pbrMode===B.PBRMode.Normal||L.pbrMode===B.PBRMode.Schematic?J.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * mainLightIntensity[2];
                ${L.snowCover?J.glsl`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:J.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${L.transparencyPassType===P.TransparencyPassType.Color?J.glsl`gl_FragColor = premultiplyAlpha(gl_FragColor);`:J.glsl``}
      }
    `));O.include(v.DefaultMaterialAuxiliaryPasses,L);return O}const H=Object.freeze(Object.defineProperty({__proto__:null,build:G},Symbol.toStringTag,{value:"Module"}));a.RealisticTree=H;a.build=G})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ../support/FastSymbolUpdates ../../support/engineContent/sdfPrimitives ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V){function aa(da){return d.isNone(da)?!1:"cross"===da||"x"===da}const X=h.create(),W=v.fromValues(0,0,1);n=G.DEFAULT_TEX_SIZE;const T=G.DEFAULT_SYMBOL_SIZE_RATIO,U=[T/2,T/2,1-T/2,1-T/2];n=[n*T,n*T];K=function(da){function ea(ja,ia,Z,ha){ja=da.call(this,ja,ia,Z,ha)||this;ja._cimLayers=null;ja._cimSymbolMaterials=new Map;ja._cimSymbolTextures=new Map;ja._cimMaterialParametersInfo=null;ja._cimRequiredFields=null;
ja._cimScaleFactorOrFunction=null;ja._size=null;ja._symbolTextureRatio=1;ja._outlineSize=0;ja._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return ja}b._inheritsLoose(ea,da);var ca=ea.prototype;ca.getCachedSize=function(){return{size:this._getIconSize()}};ca.doLoad=function(){var ja=b._asyncToGenerator(function*(ia){this._validateOrThrow();const Z=this._prepareMaterialParameters();var ha=this._getPrimitive();if(d.isSome(ha))this._prepareResourcesPrimitive(Z,ha);else{ha=A.getIconHref(this.symbolLayer);
const fa=g.dataComponents(ha);fa&&"application/json"===fa.mediaType?yield this._prepareResourcesCIM(Z,JSON.parse(fa.data),ia):yield this._prepareResourcesHref(Z,ha,ia)}});return function(ia){return ja.apply(this,arguments)}}();ca._validateOrThrow=function(){if(!this._drivenProperties.size){var ja=J.validateSymbolLayerSize(this._getIconSize());if(ja)throw new m("graphics3diconsymbollayer:invalid-size",ja);}};ca._getIconSize=function(){var ja=this.symbolLayer;ja=Math.round(null!=ja.size?e.pt2px(ja.size):
16);return this._drivenProperties.size?Math.max(ja,64):ja};ca._generateTextureCIM=function(ja){const ia=this._getGraphicHash(ja);let Z=""===ia?null:this._cimSymbolTextures.get(ia);Z||(ja=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol3D(this._cimLayers,ja,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},void 0,void 0),this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",ja.anchorPosition),Z=new R.Texture(ja.imageData,{width:ja.imageData.width,
height:ja.imageData.height,powerOfTwoResizeMode:L.PowerOfTwoResizeMode.PAD}),this._cimSymbolTextures.set(ia,Z),this._context.stage.add(Z));return Z};ca._computeSize=function(ja,ia){ja=ja.width/ja.height;return 1<ja?[ia,Math.round(ia/ja)]:[Math.round(ia*ja),ia]};ca._prepareMaterialParameters=function(){const ja={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},ia=this.symbol;if(ia&&"point-3d"===ia.type&&ia.hasVisibleVerticalOffset()){const {screenLength:Z,
minWorldLength:ha,maxWorldLength:fa}=ia.verticalOffset;ja.verticalOffset={screenLength:e.pt2px(Z),minWorldLength:ha||0,maxWorldLength:d.isSome(fa)?fa:Infinity}}this._context.screenSizePerspectiveEnabled&&(ja.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);ja.occlusionTest=!0;ja.hasSlicePlane=this._context.slicePlaneEnabled;return ja};ca._prepareResourcesPrimitive=function(ja,ia){var Z=this._getOutlineSize();if(aa(ia)&&0===Z)throw Error("Nothing to render");this._outlineSize=
Z;ja.color=this._getFillColor();ja.outlineColor=this._getOutlineColor();ja.outlineSize=this._outlineSize;d.isSome(this._context.sharedResources.textures)&&(Z=this._context.sharedResources.textures.fromData(`${ia}-icon`,()=>G.createTexture(ia)),this._texture=Z.texture,this._releaseTexture=Z,ja.textureId=this._texture.id);ja.textureIsSignedDistanceField=!0;ja.distanceFieldBoundingBox=U;Z=this._getIconSize();this._size=[Z,Z];this._symbolTextureRatio=1/T;this._createMaterialAndAddToStage(ja,this._context.stage)};
ca._prepareResourcesHref=function(){var ja=b._asyncToGenerator(function*(ia,Z,ha){this._outlineSize=this._getOutlineSize();ia.color=this._getFillColor();ia.outlineColor=this._getOutlineColor();ia.outlineSize=this._outlineSize;ia.textureIsSignedDistanceField=!1;const fa=this._getIconSize(),ka=fa*this._context.graphicsCoreOwner.view.state.rasterPixelRatio;if(d.isSome(this._context.sharedResources.textures)){ha=yield r.result(this._context.sharedResources.textures.fromUrl(Z,ka,{signal:ha}));if(!1===
ha.ok)throw f.throwIfAbortError(ha.error),new m("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${Z})`);this._releaseTexture=ha.value;Z=ha.value.texture;this._size=this._computeSize(Z.params,fa);ia.textureId=Z.id}this._createMaterialAndAddToStage(ia,this._context.stage)});return function(ia,Z,ha){return ja.apply(this,arguments)}}();ca._prepareResourcesCIM=function(){var ja=b._asyncToGenerator(function*(ia,Z,ha){Z=new V({data:Z});if(!this._context.sharedResources.cimSymbolRasterizer){var fa=
(yield new Promise((pa,va)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],pa,va))).CIMSymbolRasterizer;f.throwIfAborted(ha);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new fa(this._context.renderCoordsHelper.spatialReference,!0))}fa=this._context.layer.fields?this._context.layer.fields.map(pa=>pa.toJSON()):null;this._cimLayers=yield this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(Z,fa,this._context.renderer&&"dictionary"===
this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:ha});let ka;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(Z=this._context.renderer,isNaN(Z.scaleExpression)){const pa=yield C.createRendererExpression(Z.scaleExpression,this._context.layer.spatialReference,fa);ka=(va,wa,za)=>{va=x(pa,va,{$view:za},"esriGeometryPoint",wa);return null!==va?va:1}}else var la=Number(Z.scaleExpression);this._cimScaleFactorOrFunction=
la||ka||1;la=this._context.renderer?yield this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];f.throwIfAborted(ha);const na=this._context.layer.fieldsIndex;this._cimRequiredFields=la.map(pa=>na.get(pa).name);this._cimMaterialParametersInfo=ia;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=!1});return function(ia,
Z,ha){return ja.apply(this,arguments)}}();ca._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||B.defaultPrimitive};ca._getOutlineSize=function(){var ja=0;ja=this.symbolLayer;if(d.isSome(ja.outline)&&null!=ja.outline.size)return Math.max(e.pt2px(ja.outline.size),0);ja=this._getPrimitive();ja=aa(ja)?1.5:0;return Math.max(ja,0)};ca._getOutlineColor=function(){const ja=this._getLayerOpacity(),
ia=d.get(this.symbolLayer,"outline","color");if(d.isSome(ia)){const Z=t.toUnitRGB(ia);return[Z[0],Z[1],Z[2],ia.a*ja]}return[0,0,0,0]};ca._getFillColor=function(){if(aa(this._getPrimitive()))return u.TRANSPARENT_UNIT;const ja=d.isNone(this._getPrimitive()),ia=d.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(ia,{hasIntrinsicColor:ja})};ca._getAnchorPos=function(ja,ia){return"relative"===ja?l.fromValues((ia.x||0)+.5,-(ia.y||0)+.5):ja in N.namedAnchorToHUDMaterialAnchorPos?
N.namedAnchorToHUDMaterialAnchorPos[ja]:N.namedAnchorToHUDMaterialAnchorPos.center};ca._createMaterialAndAddToStage=function(ja,ia){this._fastUpdates=this._cimLayers?{enabled:!1}:I.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&Object.assign(ja,this._fastUpdates.materialParameters);if(this._cimLayers){let Z=d.isSome(ja.textureId)?this._cimSymbolMaterials.get(ja.textureId):null;Z||(Z=new Q.HUDMaterial(ja),this._cimSymbolMaterials.set(d.unwrapOr(ja.textureId,
0),Z),ia.add(Z));return Z}this._material=new Q.HUDMaterial(ja);ia.add(this._material);return this._material};ca._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(ja=>{ja.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};ca.destroy=function(){da.prototype.destroy.call(this);this._forEachMaterial(ja=>this._context.stage.remove(ja));this._material=
null;this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(ja=>this._context.stage.remove(ja));this._cimSymbolTextures.clear();this._releaseTexture=d.releaseMaybe(this._releaseTexture)};ca._getScaleFactor=function(ja,ia){if(this._drivenProperties.size&&ja.size){for(let Z=0;3>Z;Z++){const ha=ja.size[Z];ha&&"symbol-value"!==ha&&"proportional"!==ha&&(ja.size[Z]=e.pt2px(ha))}if("symbol-value"===ja.size[0])return 1;if(isFinite(+ja.size[0]))return+ja.size[0]/ia;if(isFinite(+ja.size[2]))return+ja.size[2]/
ia}return 1};ca.createGraphics3DGraphic=function(ja){const ia=ja.graphic;if(!this._validateGeometry(ia.geometry))return null;var Z=[0,0];let ha;if(this._cimLayers){if(!this._cimLayers.length)return null;var fa=this._generateTextureCIM(ia);ha=this._createMaterialAndAddToStage({textureId:fa.id,...this._cimMaterialParametersInfo},this._context.stage);Z=[fa.params.width,fa.params.height]}else Z=this._size,ha=d.unwrap(this._material);fa=P.placePointOnGeometry(ia.geometry);if(d.isNone(fa))return this.logger.warn(`unsupported geometry type for icon symbol: ${ia.geometry.type}`),
null;var ka=ja.renderingInfo;const la=this._getVertexOpacityAndColor(ka);let na=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(na=this._getScaleFactor(ka,Z[0]>Z[1]?Z[0]:Z[1]));na*=this._symbolTextureRatio;Z=l.fromValues(Z[0]*na,Z[1]*na);ka=this.setGraphicElevationContext(ia,new D.ElevationContext);this.ensureDrapedStatus("on-the-ground"===ka.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(ia,fa,ha,la,Z,ja.layer.uid):this._createAs3DShape(ia,
fa,ha,la,Z,ka,ia.uid)};ca.layerOpacityChanged=function(){const ja=this._getFillColor(),ia=this._getOutlineColor();this._forEachMaterial(Z=>{Z.setParameters({color:ja});Z.setParameters({outlineColor:ia})})};ca.layerElevationInfoChanged=function(ja,ia,Z){const ha=this._elevationContext.mode;Z=w.elevationModeChangeUpdateType(ea.elevationModeChangeTypes,Z,ha);if(Z!==w.SymbolUpdateType.UPDATE)return Z;const fa=w.needsElevationUpdates2D(ha)||"absolute-height"===ha;return this.updateGraphics3DGraphicElevationInfo(ja,
ia,()=>fa)};ca.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(ja=>{ja.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};ca.physicalBasedRenderingChanged=function(){return!0};ca.pixelRatioChanged=function(){return this._getPrimitive()?!0:!1};ca.skipHighSymbolLodsChanged=function(){return!0};ca.applyRendererDiff=function(ja,ia){for(const Z in ja.diff)switch(Z){case "visualVariables":if(I.updateFastSymbolUpdatesState(this._fastUpdates,ia,this._fastVisualVariableConvertOptions()))d.isSome(this._material)&&
this._material.setParameters(this._fastUpdates.materialParameters);else return M.ApplyRendererDiffResult.Recreate_Symbol;break;default:return M.ApplyRendererDiffResult.Recreate_Symbol}return M.ApplyRendererDiffResult.Fast_Update};ca._defaultElevationInfoNoZ=function(){return Y};ca._createAs3DShape=function(ja,ia,Z,ha,fa,ka,la){const na=this.getFastUpdateAttrValues(ja);ja=na?wa=>I.evaluateModelTransform(this._fastUpdates.materialParameters,na,wa):void 0;const pa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:la,
layerUid:this._context.layer.uid});ha=O.createPointGeometry(Z,W,null,ha,fa,ba,null,na,pa);la=P.createStageObject(this._context,ia,ha,ka,la,ja);if(d.isNone(la))return null;const va=new E.Graphics3DObject3DGraphicLayer(this,la.object,[ha],null,null,y.perObjectElevationAligner,ka);va.alignedSampledElevation=la.sampledElevation;va.needsElevationUpdates=w.needsElevationUpdates2D(ka.mode)||"absolute-height"===ka.mode;va.getScreenSize=this._createScreenSizeGetter(fa,ja);va.calculateRelativeScreenBounds=
wa=>Z.calculateRelativeScreenBounds(va.getScreenSize(),1,wa);P.extendPointGraphicElevationContext(va,ia,this._context.elevationProvider);return va};ca._createAsOverlay=function(ja,ia,Z,ha,fa,ka){Z.renderPriority=this._renderPriority;const la=k.create();p.projectPointToVector(ia,la,this._context.overlaySR);la[2]=H.DRAPED_Z;ia=this._context.clippingExtent;if(d.isSome(ia)&&!z.containsPoint(ia,la))return null;const na=this.getFastUpdateAttrValues(ja);ia=na?wa=>I.evaluateModelTransform(this._fastUpdates.materialParameters,
na,wa):void 0;const pa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:ja.uid,layerUid:this._context.layer.uid});ha=O.createPointGeometry(Z,W,la,ha,fa,null,null,na,pa);ja=new S.RenderGeometry(ha,{layerUid:ka,graphicUid:ja.uid,shaderTransformer:ia});la[3]=0;q.copy(ja.boundingSphere,la);const va=new F(this,[ja],null,this._context.drapeSourceRenderer);va.getScreenSize=this._createScreenSizeGetter(fa,ia);va.calculateRelativeScreenBounds=wa=>Z.calculateRelativeScreenBounds(va.getScreenSize(),
1,wa);return va};ca._createScreenSizeGetter=function(ja,ia){const Z=this._outlineSize+2;if(this._fastUpdates.enabled){const ka=ja[0]/this._symbolTextureRatio,la=ja[1]/this._symbolTextureRatio;return(na=l.create())=>{const pa=ia(X);na[0]=pa[0]*ka+Z;na[1]=pa[5]*la+Z;return na}}const ha=ja[0]/this._symbolTextureRatio+Z,fa=ja[1]/this._symbolTextureRatio+Z;return(ka=l.create())=>{ka[0]=ha;ka[1]=fa;return ka}};ca._fastVisualVariableConvertOptions=function(){var ja=this._size[0]>this._size[1]?this._size[0]:
this._size[1];const ia=v.fromValues(ja,ja,ja),Z=e.px2pt(1);ja*=Z;ja=v.fromValues(ja,ja,ja);return{modelSize:ia,symbolSize:ja,unitInMeters:Z,transformation:{anchor:v.ZEROS,scale:v.ONES,rotation:v.ZEROS}}};ca._getGraphicHash=function(ja){let ia="";for(const Z of this._cimRequiredFields)ia+=Z+ja.attributes[Z];return ia};ca._forEachMaterial=function(ja){d.isSome(this._material)&&ja(this._material);this._cimSymbolMaterials.forEach(ja)};ca.test=function(){return{...da.prototype.test.call(this),material:this._material}};
return ea}(K.Graphics3DSymbolLayer);K.PRIMITIVE_SIZE=n;K.elevationModeChangeTypes={definedChanged:w.SymbolUpdateType.UPDATE,staysOnTheGround:w.SymbolUpdateType.NONE,onTheGroundChanged:w.SymbolUpdateType.RECREATE};const Y={mode:"relative-to-ground",offset:0},ba=k.fromValues(0,0,0,1);c.Graphics3DIconSymbolLayer=K;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../core/maybe",
"../../../geometry/support/quantizationUtils"],function(a,c,b,t){function n(m){const d={};switch(m){case "esriGeometryPoint":return(f,e,g,h)=>t.unquantizePoint(e,d,f,g,h);case "esriGeometryPolygon":return(f,e,g,h)=>t.unquantizePolygon(e,d,f,g,h);case "esriGeometryPolyline":return(f,e,g,h)=>t.unquantizePolyline(e,d,f,g,h);case "esriGeometryMultipoint":return(f,e,g,h)=>t.unquantizeMultipoint(e,d,f,g,h);default:return c.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${m}`)),
f=>f}}const r=new Map;return function(m,d,f,e,g){if(b.isNone(m))return null;if(m.referencesGeometry()&&g){const {transform:h,hasZ:l,hasM:v}=g;r.has(e)||r.set(e,n(e));e=r.get(e)(d.geometry,h,l,v);d={...d,geometry:e}}d=m.repurposeFeature(d);try{return m.evaluate({...f,$feature:d})}catch(h){return c.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",h),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],
function(a,c){c=c.ZEROS;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),
function(a,c,b,t,n,r,m,d,f){let e=function(){function v(k,p,z,C){this.graphics3DSymbolLayer=k;this.renderGeometries=p;this.boundingBox=z;this._drapeSourceRenderer=C;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=this._visible=!1}var q=v.prototype;q.initialize=function(k){this.stage=k};q.setVisibility=function(k){if(null!=this.stage&&this._visible!==k)if((this._visible=k)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,
f.DirtyOperation.ADD);else if(k||this._addedToStage){for(const p of this.renderGeometries)p.visible=this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,f.DirtyState.VISIBILITY)}};q.destroy=function(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,f.DirtyOperation.REMOVE);this._visible=this._addedToStage=!1;this.stage=null};q.getCenterObjectSpace=function(k=t.create()){return b.set(k,0,0,0)};q.getBoundingBoxObjectSpace=function(k=
n.create()){return n.empty(k)};q.addObjectState=function(k,p){k===d.Object3DState.Highlight&&(this.renderGeometries.forEach(z=>{const C=z.geometry.addHighlight();p.addRenderGeometry(z,C,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,f.DirtyState.HIGHLIGHT))};q.removeObjectState=function(k){this.renderGeometries.forEach(p=>{k.removeRenderGeometry(p)})};q.removeRenderGeometryObjectState=function(k,p){k.geometry.removeHighlight(p);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,
f.DirtyState.HIGHLIGHT)};q.computeAttachmentOrigin=function(k){for(const p of this.renderGeometries)p.geometry.computeAttachmentOrigin(l)&&(k.draped.origin[0]+=l[0],k.draped.origin[1]+=l[1],k.draped.num++)};q.getProjectedBoundingBox=function(){var k=a._asyncToGenerator(function*(p,z,C,B,A){n.empty(A);for(let x=0;x<this.renderGeometries.length;x++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[x],p,g,C),n.expandWithRect(A,g);if(z){n.center(A,l);let x;p=m.demResolutionForBoundingBox(A,
z.service.spatialReference,z);try{x=yield z.service.queryElevation(l[0],l[1],B,p,"ground")}catch(u){}c.isSome(x)&&(A[2]=Math.min(A[2],x),A[5]=Math.max(A[5],x))}return A});return function(p,z,C,B,A){return k.apply(this,arguments)}}();q._getRenderGeometryProjectedBoundingRect=function(k,p,z,C){if(this.boundingBox)n.set(h,this.boundingBox);else{k=k.boundingSphere;const B=k[3];h[0]=k[0]-B;h[1]=k[1]-B;h[2]=k[2]-B;h[3]=k[0]+B;h[4]=k[1]+B;h[5]=k[2]+B}p(h,0,2);this.calculateRelativeScreenBounds&&C.push({location:n.center(h),
screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return n.toRect(h,z)};return v}();const g=r.create(),h=n.create(),l=t.create();return e})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../chunks/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,c,b){const t=Object.freeze({left:0,center:.5,right:1});c=Object.freeze({"bottom-left":c.fromValues(0,0),bottom:c.fromValues(.5,0),"bottom-right":c.fromValues(1,0),left:c.fromValues(0,.5),center:c.fromValues(.5,
.5),right:c.fromValues(1,.5),"top-left":c.fromValues(0,1),top:c.fromValues(.5,1),"top-right":c.fromValues(1,1)});a.anchorFromPlacements=function(n,r){switch(r){case "bottom":return"left"===n?"bottom-left":"right"===n?"bottom-right":"bottom";case "center":return n;case "top":return"left"===n?"top-left":"right"===n?"top-right":"top"}};a.horizontalPlacementFromAnchor=function(n){switch(n){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";
case "bottom-right":case "right":case "top-right":return"right"}};a.horizontalPlacementToAnchorX=t;a.namedAnchorToHUDMaterialAnchorPos=c;a.textRenderAlignmentFromHorizontalPlacement=function(n){switch(n){case "left":return b.TextRenderAlignment.Left;case "right":return b.TextRenderAlignment.Right;default:return b.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(n){return"middle"===n?"center":n};a.verticalPlacementFromAnchor=function(n){switch(n){case "bottom-left":case "bottom":case "bottom-right":return"bottom";
case "left":case "center":case "right":return"center";case "top-left":case "top":case "top-right":return"top"}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../core/maybe","../../support/debugFlags"],function(a,c,b,t,n){function r(v,q,k){v.canvas||(v.canvas=document.createElement("canvas"));v.canvas.width=q;v.canvas.height=
k;return v.canvas}let m=function(){function v(k,p,z,C=2048){this.text=k;this._alignment=p;this._parameters=z;this._maxSize=C;this._textWidths=[];this._lineWidths=[];this._metricsCached=this._renderPixelRatio=null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${k}`;this._lines=k.split(/\r?\n/)}var q=v.prototype;q._getLineXOffset=function(k){switch(this._alignment){case a.TextRenderAlignment.Left:return this._backgroundHorizontalPadding;case a.TextRenderAlignment.Center:return(this.displayWidth-
this._lineWidths[k])/2;case a.TextRenderAlignment.Right:return this.displayWidth-this._backgroundHorizontalPadding-this._lineWidths[k]}};q.render=function(k,p=0,z=0){k.save();p/=this.renderPixelRatio;z/=this.renderPixelRatio;const C=p,B=z;var A=this._haloSize,x=this._firstLineYOffset;p+=A;z+=x+this._baselinePosition;const u=0<this._haloSize;u&&this._renderHalo(k,C,B,A,x);this._setFontProperties(k,this._renderedFontSize);for(A=0;A<this._lines.length;++A){const y=this._lines[A],w=this._getLineXOffset(A);
u&&(k.globalCompositeOperation="destination-out",k.fillStyle="rgb(0, 0, 0)",this._fillText(k,y,p+w,z),this._renderLineDecoration(k,p+w,z,this._textWidths[A]));k.globalCompositeOperation="source-over";k.fillStyle=this._parameters.textStyle;this._fillText(k,y,p+this._getLineXOffset(A),z);this._renderLineDecoration(k,p+w,z,this._textWidths[A]);z+=this._lineSpacing}if(n.TEXT_SHOW_BASELINE)for(k.strokeStyle="rgb(255, 0, 255, 0.5)",k.setLineDash([2,2]),k.lineWidth=1,p=B+x,z=0;z<this._lines.length;++z)x=
p+this._baselinePosition,this._drawLine(k,[C,x],[C+this.displayWidth,x]),p+=this._lineSpacing;n.TEXT_SHOW_BORDER&&(k.strokeStyle="rgb(255, 0, 255, 0.5)",k.setLineDash([]),k.lineWidth=1,this._drawBox(k,[C,B],[this.displayWidth,this.displayHeight]));this._hasBackground&&(this._roundedRect(k,C,B,this._parameters.definition.background.borderRadius*this.renderPixelRatio),k.globalCompositeOperation="destination-over",k.fillStyle=this._parameters.backgroundStyle,k.fill());k.restore()};q._renderLineDecoration=
function(k,p,z,C,B=!1){if("none"!==this._parameters.definition.font.decoration&&0!==C){var A=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":z+=2*A;break;case "line-through":z-=.33*this._baselinePosition}var x=B?this._haloSize:0;k.strokeStyle=B?this._parameters.haloStyle:this._parameters.textStyle;k.lineWidth=this._toRenderUnit(A+2*x);k.beginPath();k.moveTo(this._toRenderUnit(p-x),this._toRenderUnit(z));k.lineTo(this._toRenderUnit(p+
C+x),this._toRenderUnit(z));k.stroke()}};q._roundedRect=function(k,p,z,C){p=this._toRenderUnit(p);z=this._toRenderUnit(z);const B=this.renderedWidth,A=this.renderedHeight;0===C?k.rect(p,z,B,A):(C=b.clamp(C,0,Math.floor(A/2)),k.beginPath(),k.moveTo(p,z+C),k.arcTo(p,z,p+C,z,C),k.lineTo(p+B-C,z),k.arcTo(p+B,z,p+B,z+C,C),k.lineTo(p+B,z+A-C),k.arcTo(p+B,z+A,p+B-C,z+A,C),k.lineTo(p+C,z+A),k.arcTo(p,z+A,p,z+A-C,C),k.closePath())};q._renderHalo=function(k,p,z,C,B){const A=this.renderedWidth,x=this.renderedHeight,
u=r(f,Math.max(A,512),Math.max(x,512)),y=u.getContext("2d");y.clearRect(0,0,A,x);this._setFontProperties(y,this._renderedFontSize);y.fillStyle=this._parameters.haloStyle;y.strokeStyle=this._parameters.haloStyle;var w=3>this._renderedHaloSize;y.lineJoin=w?"miter":"round";w?this._renderHaloEmulated(y,C,B):this._renderHaloNative(y,C,B);B+=this._baselinePosition;for(w=0;w<this._lines.length;++w){const D=this._getLineXOffset(w);this._renderLineDecoration(y,C+D,B,this._textWidths[w],!0);B+=this._lineSpacing}k.globalAlpha=
this._parameters.definition.halo.color[3];k.drawImage(u,0,0,A,x,this._toRenderUnit(p),this._toRenderUnit(z),A,x);k.globalAlpha=1};q._renderHaloEmulated=function(k,p,z){z+=this._baselinePosition;for(let C=0;C<this._lines.length;++C){const B=this._lines[C],A=this._getLineXOffset(C);for(const [x,u]of d)this._fillText(k,B,p+A+this._haloSize*x,z+this._haloSize*u);z+=this._lineSpacing}};q._renderHaloNative=function(k,p,z){const C=2*this._haloSize;z+=this._baselinePosition;for(let B=0;B<this._lines.length;++B){const A=
this._lines[B],x=this._getLineXOffset(B);for(let u=0;5>u;u++)k.lineWidth=this._toRenderUnit((.6+.1*u)*C),this._strokeText(k,A,p+x,z);z+=this._lineSpacing}};q._setFontProperties=function(k,p){k.font=this._parameters.fontString(p);k.textAlign="left";k.textBaseline="alphabetic"};q._toRenderUnit=function(k){return k*this.renderPixelRatio};q._toRoundedRenderUnit=function(k){return Math.round(k*this.renderPixelRatio)};q._fillText=function(k,p,z,C){k.fillText(p,this._toRenderUnit(z),this._toRenderUnit(C))};
q._strokeText=function(k,p,z,C){k.strokeText(p,this._toRenderUnit(z),this._toRenderUnit(C))};q._drawLine=function(k,p,z){k.beginPath();k.moveTo(this._toRoundedRenderUnit(p[0])+.5,this._toRoundedRenderUnit(p[1])+.5);k.lineTo(this._toRoundedRenderUnit(z[0])+.5,this._toRoundedRenderUnit(z[1])+.5);k.stroke()};q._drawBox=function(k,p,z){var C=this._toRenderUnit(p[0]);p=this._toRenderUnit(p[1]);var B=this._toRenderUnit(z[0]);const A=this._toRenderUnit(z[1]);z=Math.floor(C)+.5;C=Math.ceil(C+B)-.5;B=Math.floor(p)+
.5;p=Math.ceil(p+A)-.5;k.beginPath();k.moveTo(z,B);k.lineTo(C,B);k.lineTo(C,p);k.lineTo(z,p);k.lineTo(z,B);k.stroke()};c._createClass(v,[{key:"displayWidth",get:function(){return Math.ceil(this._displayWidth+2*this._backgroundHorizontalPadding)}},{key:"displayHeight",get:function(){return Math.ceil(this._lineSpacing*(this._lines.length-1)+this._lineHeight+2*this._haloSize+this._backgroundTopPadding+this._backgroundBottomPadding)}},{key:"renderedWidth",get:function(){return Math.ceil(this._toRenderUnit(this.displayWidth))}},
{key:"renderedHeight",get:function(){return Math.ceil(this._toRenderUnit(this.displayHeight))}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this._firstLineYOffset+this._baselinePosition)}},{key:"_firstLineYOffset",get:function(){return this._backgroundTopPadding+this._haloSize}},{key:"_metrics",get:function(){if(t.isNone(this._metricsCached)){const z=r(f,512,512).getContext("2d");this._setFontProperties(z,this._fontSize);let C=2*this._haloSize;var k=this._parameters.definition.font;
if("italic"===k.style||"oblique"===k.style||"bold"===k.weight||"bolder"===k.weight)C+=.3*z.measureText("A").width;this._textWidths.length=0;let B=this._lineWidths.length=0,A,x,u=0,y=0;this._lines.forEach((w,D)=>{w=z.measureText(w);const F=w.width,E=F+C;this._textWidths.push(F);this._lineWidths.push(E);B=Math.max(B,E);u=Math.max(u,w.actualBoundingBoxAscent);y=Math.max(y,w.actualBoundingBoxDescent);0===D&&(A=w);D===this._lines.length-1&&(x=w)});k=z.font;var p=l.get(k);p||(p=z.measureText(e),p=new h(p.actualBoundingBoxAscent,
p.actualBoundingBoxDescent),l.set(k,p));u=Math.max(u,p.actualBoundingBoxAscent);y=Math.max(y,p.actualBoundingBoxDescent);this._metricsCached=new g(u-(this._hasBackground?A.actualBoundingBoxAscent:u),y-(this._hasBackground?x.actualBoundingBoxDescent:y),u+y,B,u)}return this._metricsCached}},{key:"_lineSpacing",get:function(){return(this._lineHeight+this._linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"_lineHeight",get:function(){return this._metrics.lineHeight}},{key:"_linePadding",
get:function(){return.2*this._lineHeight}},{key:"_baselinePosition",get:function(){return this._metrics.baselinePosition}},{key:"_renderedFontSize",get:function(){return this._toRenderUnit(this._fontSize)}},{key:"_fontSize",get:function(){return this._parameters.definition.size}},{key:"_renderedHaloSize",get:function(){return this._toRenderUnit(this._haloSize)}},{key:"_haloSize",get:function(){return this._parameters.haloSize}},{key:"_backgroundHorizontalPadding",get:function(){return this._hasBackground?
this._parameters.definition.background.padding[0]:0}},{key:"_backgroundVerticalPadding",get:function(){return this._hasBackground?this._parameters.definition.background.padding[1]:0}},{key:"_backgroundTopPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingTop)}},{key:"_backgroundBottomPadding",get:function(){return Math.max(0,this._backgroundVerticalPadding-this._metrics.paddingBottom)}},{key:"_hasBackground",get:function(){return!!this._parameters.backgroundStyle}},
{key:"renderPixelRatio",get:function(){if(t.isNone(this._renderPixelRatio)){const k=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this._maxSize?Math.min(k,Math.min(this._maxSize/this.displayWidth,this._maxSize/this.displayHeight)):k}return this._renderPixelRatio}},{key:"_displayWidth",get:function(){return this._metrics.displayWidth}}]);return v}();const d=[];for(let v=0;360>v;v+=22.5)d.push([Math.cos(Math.PI*v/180),Math.sin(Math.PI*v/180)]);a.TextRenderAlignment=void 0;(function(v){v[v.Left=
0]="Left";v[v.Center=1]="Center";v[v.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const f={canvas:null},e=(()=>{let v="";for(let q=32;127>q;q++)v+=String.fromCharCode(q);return v})();let g=function(v,q,k,p,z){this.paddingTop=v;this.paddingBottom=q;this.lineHeight=k;this.displayWidth=p;this.baselinePosition=z},h=function(v,q){this.actualBoundingBoxAscent=v;this.actualBoundingBoxDescent=q};const l=new Map;a.TextRenderer=m;a.getTextHelperCanvas=r;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){function h(N){return null!==N&&void 0!==N}function l(N){return"number"===typeof N}function v(N){return"string"===
typeof N}function q(N,P){N&&N.push(P)}function k(N,P,I,G=m.create()){N=N||0;P=P||0;I=I||0;0!==N&&r.rotateZ(G,G,-N/180*Math.PI);0!==P&&r.rotateX(G,G,P/180*Math.PI);0!==I&&r.rotateY(G,G,I/180*Math.PI);return G}function p(N,P,I,G,H){const L=N.minSize,O=N.maxSize;if(N.expression)return q(H,"Could not convert size info: expression not supported"),!1;if(N.useSymbolValue)return N=G.symbolSize[I],P.minSize[I]=N,P.maxSize[I]=N,P.offset[I]=P.minSize[I],P.factor[I]=0,P.type[I]=a.FastSizeType.DefinedSize,!0;
if(h(N.field)){if(h(N.stops)){if(2===N.stops.length&&l(N.stops[0].size)&&l(N.stops[1].size))return z(N.stops[0].size,N.stops[1].size,N.stops[0].value,N.stops[1].value,P,I),P.type[I]=a.FastSizeType.DefinedSize,!0;q(H,"Could not convert size info: stops only supported with 2 elements");return!1}if(l(L)&&l(O)&&h(N.minDataValue)&&h(N.maxDataValue))return z(L,O,N.minDataValue,N.maxDataValue,P,I),P.type[I]=a.FastSizeType.DefinedSize,!0;if(null!=e.meterIn[N.valueUnit])return P.minSize[I]=-Infinity,P.maxSize[I]=
Infinity,P.offset[I]=0,P.factor[I]=1/e.meterIn[N.valueUnit],P.type[I]=a.FastSizeType.DefinedSize,!0;if("unknown"===N.valueUnit)return q(H,"Could not convert size info: proportional size not supported"),!1;q(H,"Could not convert size info: scale-dependent size not supported");return!1}if(!h(N.field)){if(N.stops&&N.stops[0]&&l(N.stops[0].size))return P.minSize[I]=N.stops[0].size,P.maxSize[I]=N.stops[0].size,P.offset[I]=P.minSize[I],P.factor[I]=0,P.type[I]=a.FastSizeType.DefinedSize,!0;if(l(L))return P.minSize[I]=
L,P.maxSize[I]=L,P.offset[I]=L,P.factor[I]=0,P.type[I]=a.FastSizeType.DefinedSize,!0}q(H,"Could not convert size info: unsupported variant of sizeInfo");return!1}function z(N,P,I,G,H,L){G=0<Math.abs(G-I)?(P-N)/(G-I):0;H.minSize[L]=0<G?N:P;H.maxSize[L]=0<G?P:N;H.offset[L]=N-I*G;H.factor[L]=G}function C(N,P,I,G){if(N.normalizationField||N.valueRepresentation)return q(G,"Could not convert size info: unsupported property"),null;var H=N.field;if(null!=H&&!v(H))return q(G,"Could not convert size info: field is not a string"),
null;if(!P.size)P.size={field:N.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined]};else if(N.field)if(!P.size.field)P.size.field=N.field;else if(N.field!==P.size.field)return q(G,"Could not convert size info: multiple fields in use"),null;switch(N.axis){case "width":return(H=p(N,P.size,0,I,G))?P:null;case "height":return(H=p(N,P.size,2,I,G))?P:null;case "depth":return(H=p(N,P.size,1,I,G))?P:null;case "width-and-depth":return(H=
p(N,P.size,0,I,G))&&p(N,P.size,1,I,G),H?P:null;case null:case void 0:case "all":return(H=(H=(H=p(N,P.size,0,I,G))&&p(N,P.size,1,I,G))&&p(N,P.size,2,I,G))?P:null;default:return q(G,`Could not convert size info: unknown axis "${N.axis}""`),null}}function B(N,P,I){for(let G=0;3>G;++G){let H=P.unitInMeters;N.type[G]===a.FastSizeType.DefinedSize&&(H*=P.modelSize[G],N.type[G]=a.FastSizeType.DefinedScale);N.minSize[G]/=H;N.maxSize[G]/=H;N.offset[G]/=H;N.factor[G]/=H}if(N.type[0]!==a.FastSizeType.Undefined)P=
0;else if(N.type[1]!==a.FastSizeType.Undefined)P=1;else if(N.type[2]!==a.FastSizeType.Undefined)P=2;else return q(I,"No size axis contains a valid size or scale"),!1;for(I=0;3>I;++I)N.type[I]===a.FastSizeType.Undefined&&(N.minSize[I]=N.minSize[P],N.maxSize[I]=N.maxSize[P],N.offset[I]=N.offset[P],N.factor[I]=N.factor[P],N.type[I]=N.type[P]);return!0}function A(N,P,I){N[4*P]=I.r/255;N[4*P+1]=I.g/255;N[4*P+2]=I.b/255;N[4*P+3]=I.a}function x(N,P,I){if(N.normalizationField)return q(I,"Could not convert color info: unsupported property"),
null;if(v(N.field))if(N.stops){if(8<N.stops.length)return q(I,"Could not convert color info: too many color stops"),null;P.color={field:N.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};N=N.stops;for(I=0;8>I;++I){const G=N[Math.min(I,N.length-1)];P.color.values[I]=G.value;A(P.color.colors,I,G.color)}}else return q(I,"Could not convert color info: missing stops or colors"),null;else if(N.stops&&0<=N.stops.length)for(N=N.stops&&0<=N.stops.length&&
N.stops[0].color,P.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},I=0;8>I;I++)P.color.values[I]=Infinity,A(P.color.colors,I,N);else return q(I,"Could not convert color info: no field and no colors/stops"),null;return P}function u(N,P,I){if(N.normalizationField)return q(I,"Could not convert opacity info: unsupported property"),null;if(v(N.field))if(N.stops){if(8<N.stops.length)return q(I,"Could not convert opacity info: too many opacity stops"),
null;P.opacity={field:N.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};N=N.stops;for(I=0;8>I;++I){const G=N[Math.min(I,N.length-1)];P.opacity.values[I]=G.value;P.opacity.opacityValues[I]=G.opacity}}else return q(I,"Could not convert opacity info: missing stops or opacities"),null;else if(N.stops&&0<=N.stops.length)for(N=N.stops&&0<=N.stops.length?N.stops[0].opacity:0,P.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},I=0;8>I;I++)P.opacity.values[I]=Infinity,
P.opacity.opacityValues[I]=N;else return q(I,"Could not convert opacity info: no field and no opacities/stops"),null;return P}function y(N,P,I){N=2===I&&"arithmetic"===N.rotationType;P.offset[I]=N?90:0;P.factor[I]=N?-1:1;P.type[I]=1}function w(N,P,I){if(!v(N.field))return q(I,"Could not convert rotation info: field is not a string"),null;if(!P.rotation)P.rotation={field:N.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(N.field)if(!P.rotation.field)P.rotation.field=N.field;else if(N.field!==
P.rotation.field)return q(I,"Could not convert rotation info: multiple fields in use"),null;switch(N.axis){case "tilt":return y(N,P.rotation,0),P;case "roll":return y(N,P.rotation,1),P;case null:case void 0:case "heading":return y(N,P.rotation,2),P;default:return q(I,`Could not convert rotation info: unknown axis "${N.axis}""`),null}}function D(N,P,I){if(!N)return null;const G=!P.supportedTypes||!!P.supportedTypes.size,H=!P.supportedTypes||!!P.supportedTypes.color,L=!P.supportedTypes||!!P.supportedTypes.rotation,
O=!!P.supportedTypes&&!!P.supportedTypes.opacity,S=N.reduce((R,Q)=>{if(!R)return R;if(Q.valueExpression)return q(I,"Could not convert visual variables: arcade expressions not supported"),null;switch(Q.type){case "size":return G?C(Q,R,P,I):R;case "color":return H?x(Q,R,I):R;case "opacity":return O?u(Q,R,I):null;case "rotation":return L?w(Q,R,I):R;default:return null}},{size:null,color:null,opacity:null,rotation:null});return 0<N.length&&S&&!S.size&&!S.color&&!S.opacity&&!S.rotation||S&&S.size&&!B(S.size,
P,I)?null:S}function F(N,P,I){if(!!N!==!!P||N&&N.field!==P.field)return!1;if(N&&"rotation"===I)for(I=0;3>I;I++)if(N.type[I]!==P.type[I]||N.offset[I]!==P.offset[I]||N.factor[I]!==P.factor[I])return!1;return!0}function E(N,P){const I={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},
G=N&&null!=N.size;N&&N.size?(I.vvSizeEnabled=!0,I.vvSizeMinSize=N.size.minSize,I.vvSizeMaxSize=N.size.maxSize,I.vvSizeOffset=N.size.offset,I.vvSizeFactor=N.size.factor):N&&G&&(I.vvSizeValue=P.transformation.scale);N&&G&&(I.vvSymbolAnchor=P.transformation.anchor,I.vvSymbolRotationMatrix=n.create(),r.identity(M),k(P.transformation.rotation[2],P.transformation.rotation[0],P.transformation.rotation[1],M),t.fromMat4(I.vvSymbolRotationMatrix,M));N&&N.color&&(I.vvColorEnabled=!0,I.vvColorValues=N.color.values,
I.vvColorColors=N.color.colors);N&&N.opacity&&(I.vvOpacityEnabled=!0,I.vvOpacityValues=N.opacity.values,I.vvOpacityOpacities=N.opacity.opacityValues);return I}a.FastSizeType=void 0;(function(N){N[N.Undefined=0]="Undefined";N[N.DefinedSize=1]="DefinedSize";N[N.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=void 0;(function(N){N[N.Undefined=0]="Undefined";N[N.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));const K=m.create(),J=
f.create(),M=m.create();a.convertVisualVariables=D;a.evaluateModelTransform=function(N,P,I){if(!N.vvSizeEnabled)return I;r.copy(K,I);I=N.vvSymbolRotationMatrix;r.set(M,I[0],I[1],I[2],0,I[3],I[4],I[5],0,I[6],I[7],I[8],0,0,0,0,1);r.multiply(K,K,M);for(I=0;3>I;++I)J[I]=b.clamp(N.vvSizeOffset[I]+P[0]*N.vvSizeFactor[I],N.vvSizeMinSize[I],N.vvSizeMaxSize[I]);r.scale(K,K,J);r.translate(K,K,N.vvSymbolAnchor);return K};a.evaluateModelTransformScale=function(N,P,I){if(!P.vvSizeEnabled)return d.set(N,1,1,1);
for(let G=0;3>G;++G)N[G]=b.clamp(P.vvSizeOffset[G]+I[0]*P.vvSizeFactor[G],P.vvSizeMinSize[G],P.vvSizeMaxSize[G]);return N};a.getMaterialParameters=E;a.initFastSymbolUpdatesState=function(N,P){return!N||g.TESTS_DISABLE_FAST_UPDATES?{enabled:!1}:(N=D(N.visualVariables,P))?{enabled:!0,visualVariables:N,materialParameters:E(N,P),requiresShaderTransformation:N&&null!=N.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(N,P,I){if(!P||!N.enabled)return!1;const G=N.visualVariables;P=D(P.visualVariables,
I);if(!(P&&F(G.size,P.size,"size")&&F(G.color,P.color,"color")&&F(G.rotation,P.rotation,"rotation")&&F(G.opacity,P.opacity,"opacity")))return!1;N.visualVariables=P;N.materialParameters=E(P,I);N.requiresShaderTransformation=P&&null!=P.size;return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../support/mathUtils".split(" "),
function(a,c,b,t,n,r,m,d,f){let e=function(){function h(v,q={}){this.geometry=v;this.boundingSphere=d.create();this.screenToWorldRatio=1;this._transformation=r.create();this._shaderTransformationDirty=!0;this.id=t.generateUID();this.layerUid=q.layerUid;this.graphicUid=q.graphicUid;this.boundingInfo=q.boundingInfo;this.shaderTransformer=q.shaderTransformer;this.castShadow=q.castShadow?q.castShadow:!1}var l=h.prototype;l.updateTransformation=function(v){v(this._transformation);this._shaderTransformationDirty=
!0;this.computeBoundingSphere(this._transformation,this.boundingSphere)};l.shaderTransformationChanged=function(){this._shaderTransformationDirty=!0};l.computeBoundingSphere=function(v,q,k=f.maxScale(v)){b.isNone(this.boundingInfo)||(m.transformMat4(q,this.boundingInfo.center,v),q[3]=this.boundingInfo.radius*k)};c._createClass(h,[{key:"transformation",get:function(){return this._transformation}},{key:"hasShaderTransformation",get:function(){return b.isSome(this.shaderTransformer)}},{key:"material",
get:function(){return this.geometry.material}},{key:"type",get:function(){return this.geometry.type}},{key:"shaderTransformation",get:function(){if(b.isNone(this.shaderTransformer))return this.transformation;this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=r.create()),n.copy(this._shaderTransformation,this.shaderTransformer(this.transformation)),this._shaderTransformationDirty=!1);return this._shaderTransformation}},{key:"indices",get:function(){return this.geometry.indices}},
{key:"vertexAttributes",get:function(){return this.geometry.vertexAttributes}},{key:"highlights",get:function(){return this.geometry.highlights}},{key:"occludees",get:function(){return this.geometry.occludees}},{key:"visible",get:function(){return this.geometry.visible},set:function(v){this.geometry.visible=v}}]);return h}(),g=function(h){function l(){return h.apply(this,arguments)||this}c._inheritsLoose(l,h);return l}(e);a.RenderGeometry=e;a.ValidatedRenderGeometry=g;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../../support/debugFlags ../../support/engineContent/line ../../support/engineContent/marker ../../support/renderInfoUtils/line ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J){const M=["polyline","polygon","extent"];b=function(P){function I(H,L,O,S){return P.call(this,H,L,O,S)||this}c._inheritsLoose(I,P);var G=I.prototype;G.doLoad=function(){var H=c._asyncToGenerator(function*(){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&
this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?C.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size&&0>(null!=this.symbolLayer.size?this.symbolLayer.size:r.px2pt(1)))throw new t("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._markerTexture=n.isSome(this.symbolLayer.marker)&&n.isSome(this._context.sharedResources.textures)?x.prepareMarkerResources(this._context.sharedResources.textures,
z.parseLineMarkerStyle(this.symbolLayer.marker.style)):null});return function(){return H.apply(this,arguments)}}();G._getMaterialParameters=function(H,L=!1){const O=this._getCombinedOpacityAndColor(L&&this._markerColor||this._materialColor);this._patternHidesLine&&!L&&(O[3]=0);H={width:this._computeMaterialWidth(this.symbolLayer?.size),color:O,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:z.parseCapType(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:H,
stipplePattern:F.getStipplePatternForLinePattern(this.symbolLayer.pattern),stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...H,...this._fastUpdates.materialParameters}:H};G.destroy=function(){P.prototype.destroy.call(this);this._forEachMaterial(H=>this._context.stage.remove(H));this._markerMaterialCached=this._wireframeRingMaterialCached=this._wireframeLineMaterialCached=this._ringMaterialCached=this._lineMaterialCached=null;this._markerTexture=n.releaseMaybe(this._markerTexture)};
G._getDrivenSize=function(H){return this._drivenProperties.size&&H.size?r.pt2px(e.getDriverAxisSizeValueAny(H.size)):1};G._getSizeFeatureAttributeData=function(H){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?k.getAttributeValue(this._fastUpdates.visualVariables.size.field,H):null};G._getDrivenColor=function(H){const L=d.fromValues(1,1,1,1);this._drivenProperties.color&&H.color&&(L[0]=H.color[0],L[1]=H.color[1],L[2]=H.color[2],0<H.color.length&&(L[3]=H.color[3]));this._drivenProperties.opacity&&
H.opacity&&(L[3]=H.opacity);return L};G._getColorFeatureAttributeData=function(H){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color?k.getAttributeValue(this._fastUpdates.visualVariables.color.field,H):null};G._getOpacityFeatureAttributeData=function(H){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?k.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,H):null};G.createGraphics3DGraphic=function(H){const L=H.graphic;if(!this._validateGeometry(L.geometry,
M,this.symbolLayer.type))return null;const O=this.setGraphicElevationContext(L,new l.ElevationContext);this.ensureDrapedStatus("on-the-ground"===O.mode);return this.draped?this._createAsOverlay(H,this._context.layer.uid):this._createAs3DShape(H,O,L.uid)};G.applyRendererDiff=function(H,L){for(const O in H.diff)switch(O){case "visualVariables":if(C.updateFastSymbolUpdatesState(this._fastUpdates,L,this._vvConvertOptions))this._forEachMaterial(S=>S.setParameters(this._fastUpdates.materialParameters));
else return p.ApplyRendererDiffResult.Recreate_Symbol;break;default:return p.ApplyRendererDiffResult.Recreate_Symbol}return p.ApplyRendererDiffResult.Fast_Update};G.prepareSymbolLayerPatch=function(H){if("partial"===H.diff.type){var L=H.diff.diff,O={};"complete"===L.size?.type&&(O.width=this._computeMaterialWidth(L.size.newValue),delete L.size);"complete"===L.cap?.type&&(O.cap=z.parseCapType(n.unwrapOr(L.cap.newValue,"butt")),delete L.cap);var S=this._prepareMarkerPatch(H,L);this._prepareMaterialPatch(H,
L,S);H.symbolLayerStatePatches.push(()=>this._forEachMaterial(R=>R.setParameters(O)))}};G.layerOpacityChanged=function(){this._forEachMaterial((H,L)=>this._updateMaterialLayerOpacity(H,L))};G._forEachMaterial=function(H){n.isSome(this._lineMaterialCached)&&H(this._lineMaterialCached);n.isSome(this._ringMaterialCached)&&H(this._ringMaterialCached);n.isSome(this._wireframeLineMaterialCached)&&H(this._wireframeLineMaterialCached);n.isSome(this._wireframeRingMaterialCached)&&H(this._wireframeRingMaterialCached);
n.isSome(this._markerMaterialCached)&&H(this._markerMaterialCached,!0)};G._updateMaterialLayerOpacity=function(H,L=!1){var O=H.parameters.color;const S=n.get(this.symbolLayer,"material","color");L=this._patternHidesLine&&!L?0:this._getCombinedOpacity(S);O=d.fromValues(O[0],O[1],O[2],L);H.setParameters({color:O})};G.layerElevationInfoChanged=function(H,L,O){const S=this._elevationContext.mode;O=h.elevationModeChangeUpdateType(I.elevationModeChangeTypes,O,S);if(O!==h.SymbolUpdateType.UPDATE)return O;
const R=h.needsElevationUpdates2D(S);return this.updateGraphics3DGraphicElevationInfo(H,L,()=>R)};G.slicePlaneEnabledChanged=function(){const H={hasSlicePlane:this._context.slicePlaneEnabled};this._forEachMaterial(L=>L.setParameters(H));return!0};G.physicalBasedRenderingChanged=function(){return!0};G.pixelRatioChanged=function(){return!0};G.skipHighSymbolLodsChanged=function(){return!0};G._getGeometryAsPolygonOrPolyline=function(H){switch(H.type){case "extent":if(H instanceof K)return J.fromExtent(H);
break;case "polygon":case "polyline":return H}return null};G._createAs3DShape=function(H,L,O){const S=this._getGeometryAsPolygonOrPolyline(H.graphic.geometry);var R="polygon"===S.type?S.rings:S.paths,Q=[];const V=f.create(),aa=u.geometryToRenderInfo(S,this._context.elevationProvider,this._context.renderCoordsHelper,L);this._logGeometryCreationWarnings(aa,R,"polygon"===S.type?"rings":"paths","LineSymbol3DLayer");for(R=0;R<aa.lines.length;R++){var X=aa.lines[R],W=X.position;X=X.mapPositions;if(n.isSome(this._context.clippingExtent)&&
(f.empty(V),f.expandWithBuffer(V,X),!f.intersectsClippingArea(V,this._context.clippingExtent)))continue;W=this._createGeometry("polygon"===S.type?this._ringMaterial:this._lineMaterial,H,W,X,S.type,N.ELEVATED,O);Q.push(W);B.LINE_WIREFRAMES&&Q.push(W.instantiate({material:"polygon"===S.type?this._wireframeRingMaterial:this._wireframeLineMaterial}));n.isSome(this._markerMaterial)&&Q.push(W.instantiate({material:this._markerMaterial}))}if(0===Q.length)return null;H=new y.Object3D({geometries:Q,castShadow:!1,
metadata:{layerUid:this._context.layer.uid,graphicUid:O}});Q=new q.Graphics3DObject3DGraphicLayer(this,H,Q,null,null,g.sharedGeometryElevationAligner,L);Q.alignedSampledElevation=aa.sampledElevation;Q.needsElevationUpdates=h.needsElevationUpdates2D(L.mode);return Q};G._createGeometry=function(H,L,O,S,R,Q,V){R="polygon"===R;const aa=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color,X=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size;V=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:V,
layerUid:this._context.layer.uid});return A.createGeometry(H,{overlayInfo:Q===N.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:R,mapPositions:S,attributeData:{position:O,size:X?null:this._getDrivenSize(L.renderingInfo),color:aa?null:this._getDrivenColor(L.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(L.graphic),colorFeature:this._getColorFeatureAttributeData(L.graphic),opacityFeature:this._getOpacityFeatureAttributeData(L.graphic)}},
V)};G._createAsOverlay=function(H,L){const O=H.graphic,S=this._getGeometryAsPolygonOrPolyline(O.geometry);var R="polygon"===S.type?S.rings:S.paths;const Q="polygon"===S.type?this._ringMaterial:this._lineMaterial;Q.renderPriority=this._renderPriority;const V=B.LINE_WIREFRAMES?"polygon"===S.type?this._wireframeRingMaterial:this._wireframeLineMaterial:null,aa=this._markerMaterial;n.isSome(V)&&(V.renderPriority=this._renderPriority-.001);n.isSome(aa)&&(aa.renderPriority=this._renderPriority-.002);const X=
[],W=f.create(),T=f.empty();var U=u.geometryToRenderInfoDraped(S,this._context.overlaySR);this._logGeometryCreationWarnings(U,R,"polygon"===S.type?"rings":"paths","LineSymbol3DLayer");for(const Y of U.lines)if(f.empty(W),f.expandWithBuffer(W,Y.position),f.intersectsClippingArea(W,this._context.clippingExtent)){f.expandWithAABB(T,W);R=ba=>{ba=this._createGeometry(ba,H,Y.position,void 0,S.type,N.DRAPED,O.uid);ba=new w.RenderGeometry(ba,{layerUid:L,graphicUid:O.uid});X.push(ba);return ba};if(n.isSome(aa)){U=
R(aa);const ba=n.unwrap(this.symbolLayer.marker).placement;"begin"!==ba&&"begin-end"!==ba||f.expandWithBuffer(W,Y.position,0,1);"end"!==ba&&"begin-end"!==ba||f.expandWithBuffer(W,Y.position,Y.position.length-3,1);this._updateBoundingSphere(U,W)}U=R(Q);this._updateBoundingSphere(U,W);B.LINE_WIREFRAMES&&(R=R(V),this._updateBoundingSphere(R,W))}return new v(this,X,T,this._context.drapeSourceRenderer)};G._updateBoundingSphere=function(H,L){m.set(H.boundingSphere,.5*(L[0]+L[3]),.5*(L[1]+L[4]),0,.5*Math.sqrt((L[3]-
L[0])*(L[3]-L[0])+(L[4]-L[1])*(L[4]-L[1])))};G._computeMaterialWidth=function(H){H=n.unwrapOr(H,r.px2pt(1));return this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?r.pt2px(1):1:r.pt2px(H)};G._prepareMaterialPatch=function(H,L,O){var S=L.material;n.isNone(S)?O.changed&&O.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterialCached,H):"collection"!==S.type&&(S="complete"===S.type?n.applySome(S.newValue,
R=>R.color):"complete"===S.diff.color?.type?S.diff.color.newValue:null,S=this._getCombinedOpacityAndColor(S),O.useMaterialColor&&this._patchMaterialColor(d.clone(S),this._markerMaterialCached,H),this._patternHidesLine&&(S[3]=0),this._patchMaterialColor(S,this._lineMaterialCached,H),delete L.material)};G._prepareMarkerPatch=function(H,L){var O=L.marker;if(n.isNone(O)||"partial"!==O.type||n.isSome(O.diff.style)||n.isSome(O.diff.placement)||n.isSome(O.diff.color)&&"complete"!==O.diff.color.type)return{changed:!1,
useMaterialColor:n.isNone(this._markerColor)};O=O.diff.color;if(n.isNone(O))return delete L.marker,{changed:!1,useMaterialColor:n.isNone(this._markerColor)};O=n.unwrap(O.newValue);if(n.isNone(O))return delete L.marker,{changed:!0,useMaterialColor:!0};this._patchMaterialColor(this._getCombinedOpacityAndColor(O),this._markerMaterialCached,H);delete L.marker;return{changed:!0,useMaterialColor:!1}};G._patchMaterialColor=function(H,L,O){n.isNone(L)||O.symbolLayerStatePatches.push(()=>L.setParameters({color:H}))};
c._createClass(I,[{key:"_materialColor",get:function(){return n.applySome(this.symbolLayer.material,H=>H.color)}},{key:"_markerColor",get:function(){return n.applySome(this.symbolLayer.marker,H=>H.color)}},{key:"_lineMaterial",get:function(){n.isNone(this._lineMaterialCached)&&(this._lineMaterialCached=new E.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterialCached));return this._lineMaterialCached}},{key:"_ringMaterial",get:function(){n.isNone(this._ringMaterialCached)&&
(this._ringMaterialCached=new E.RibbonLineMaterial(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterialCached));return this._ringMaterialCached}},{key:"_wireframeLineMaterial",get:function(){n.isNone(this._wireframeLineMaterialCached)&&(this._wireframeLineMaterialCached=new E.RibbonLineMaterial({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterialCached));return this._wireframeLineMaterialCached}},{key:"_wireframeRingMaterial",
get:function(){n.isNone(this._wireframeRingMaterialCached)&&(this._wireframeRingMaterialCached=new E.RibbonLineMaterial({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterialCached));return this._wireframeRingMaterialCached}},{key:"_markerMaterial",get:function(){n.isNone(this._markerMaterialCached)&&n.isSome(this.symbolLayer.marker)&&n.isSome(this._markerTexture)&&(this._markerMaterialCached=new D.LineMarkerMaterial({...this._getMaterialParameters(!1,
!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterialCached));return this._markerMaterialCached}},{key:"_patternHidesLine",get:function(){const H=this.symbolLayer.pattern;return n.isSome(H)&&"style"===H.type&&"none"===H.style}}]);return I}(k.Graphics3DSymbolLayer);b.elevationModeChangeTypes={definedChanged:h.SymbolUpdateType.RECREATE,staysOnTheGround:h.SymbolUpdateType.NONE,onTheGroundChanged:h.SymbolUpdateType.RECREATE};
var N;(function(P){P[P.DRAPED=0]="DRAPED";P[P.ELEVATED=1]="ELEVATED"})(N||(N={}));a.Graphics3DLineSymbolLayer=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/lineUtils":function(){define(["exports","../../../../core/has","../../webgl-engine/shaders/RibbonLineTechniqueConfiguration"],function(a,c,b){a.parseCapType=function(t){switch(t){case "butt":return b.CapType.BUTT;case "square":return b.CapType.SQUARE;case "round":return b.CapType.ROUND;default:return null}};
a.parseLineMarkerStyle=function(t){return"diamond"===t?"kite":t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/engineContent/line":function(){define("exports ../../../../core/maybe ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../ViewingMode ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/DoubleArray ../../webgl-engine/lib/FloatArray ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){const k=n.create(),p=n.create();a.createGeometry=function(z,C,B=null){const A=[],x=[],u=C.mapPositions,{attributeData:{position:y},removeDuplicateStartEnd:w}=C;var D=y.length;D=y[0]===y[D-3]&&y[1]===y[D-2]&&y[2]===y[D-1]&&w;var F=y.length/3-(D?1:0),E=Array(2*(F-1)),K=D?y.slice(0,y.length-3):y,J=0;for(var M=0;M<F-1;M++)E[J++]=M,E[J++]=M+1;x.push([q.VertexAttribute.POSITION,new e.Attribute(K,3,D)]);A.push([q.VertexAttribute.POSITION,E]);F=x[0][1].data;D=Array(A[0][1].length).fill(0);
c.isSome(C.attributeData.colorFeature)||(x.push([q.VertexAttribute.COLOR,new e.Attribute(c.unwrapOr(C.attributeData.color,r.ONES),4)]),A.push([q.VertexAttribute.COLOR,D]));c.isSome(C.attributeData.sizeFeature)||(x.push([q.VertexAttribute.SIZE,new e.Attribute([c.unwrapOr(C.attributeData.size,1)],1,!0)]),A.push([q.VertexAttribute.SIZE,D]));c.isSome(C.attributeData.normal)&&(x.push([q.VertexAttribute.NORMAL,new e.Attribute(C.attributeData.normal,3)]),A.push([q.VertexAttribute.NORMAL,D]));E=C.attributeData.colorFeature;
c.isNone(E)||(x.push([q.VertexAttribute.COLORFEATUREATTRIBUTE,new e.Attribute([E],1,!0)]),A.push([q.VertexAttribute.COLOR,D]));E=C.attributeData.sizeFeature;c.isNone(E)||(x.push([q.VertexAttribute.SIZEFEATUREATTRIBUTE,new e.Attribute([E],1,!0)]),A.push([q.VertexAttribute.SIZEFEATUREATTRIBUTE,D]));E=C.attributeData.opacityFeature;c.isNone(E)||(x.push([q.VertexAttribute.OPACITYFEATUREATTRIBUTE,new e.Attribute([E],1,!0)]),A.push([q.VertexAttribute.OPACITYFEATUREATTRIBUTE,D]));if(!c.isNone(C.overlayInfo)&&
C.overlayInfo.renderCoordsHelper.viewingMode===f.ViewingMode.Global&&C.overlayInfo.spatialReference.isGeographic){D=h.newDoubleArray(F.length);C=m.getReferenceEllipsoid(C.overlayInfo.spatialReference);for(E=0;E<D.length;E+=3)d.lonLatToWebMercatorComparable(F,E,D,E,C);C=F.length/3;F=l.newFloatArray(C+1);E=k;K=p;M=J=0;t.set(E,D[M++],D[M++],D[M++]);F[0]=0;for(let N=1;N<C+1;++N)N===C&&(M=0),t.set(K,D[M++],D[M++],D[M++]),J+=b.dist(E,K),F[N]=J,[E,K]=[K,E];x.push([q.VertexAttribute.DISTANCETOSTART,new e.Attribute(F,
1,!0)]);A.push([q.VertexAttribute.DISTANCETOSTART,A[0][1]])}return new v.Geometry(z,x,A,u,g.ContentObjectType.Line,B)};a.lineStripsToParameters=function(z,C){if(c.isNone(z)||0===z.length)return[];const B=[];z.forEach(A=>{const x=h.newDoubleArray(3*A.length);A.forEach((u,y)=>{x[3*y]=u[0];x[3*y+1]=u[1];x[3*y+2]=u[2]});B.push({attributeData:{position:x,normal:C},removeDuplicateStartEnd:!1})});return B};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/renderInfoUtils/line":function(){define("exports ../../../../core/maybe ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ../../layers/graphics/elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/DoubleArray".split(" "),
function(a,c,b,t,n,r,m){function d(f,e,g=null){const h=[];for(const {index:l,count:v}of f){if(1>=v)continue;f=3*l;const q=3*v;h.push({position:m.doubleSubArray(e,3*l,3*v),mapPositions:c.isSome(g)?m.doubleSubArray(g,f,q):void 0})}return h}a.geometryToRenderInfo=function(f,e,g,h){const {position:l,outlines:v}=t.pathsToTriangulationInfo("polygon"===f.type?f.rings:f.paths,!!f.hasZ,"polygon"===f.type?t.CounterClockwiseMode.CCW_IS_HOLE:t.CounterClockwiseMode.NONE),q=m.newDoubleArray(l.length);f=n.applyPerVertexElevationAlignment(l,
f.spatialReference,0,q,0,l,0,l.length/3,e,g,h);e=null!=f;return{lines:e?d(v,l,q):[],projectionSuccess:e,sampledElevation:f}};a.geometryToRenderInfoDraped=function(f,e){const {position:g,outlines:h}=t.pathsToTriangulationInfo("polygon"===f.type?f.rings:f.paths,!1,"polygon"===f.type?t.CounterClockwiseMode.CCW_IS_HOLE:t.CounterClockwiseMode.NONE);f=b.projectBuffer(g,f.spatialReference,0,g,e,0,g.length/3);for(e=2;e<g.length;e+=3)g[e]=r.DRAPED_Z;return{lines:f?d(h,g):[],projectionSuccess:f}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){let k=function(x){function u(w){w=x.call(this,w,new z)||this;w._vertexAttributeLocations=l.vertexAttributeLocations;w._configuration=new v.LineMarkerTechniqueConfiguration;w._layout=w.createLayout();return w}c._inheritsLoose(u,x);var y=u.prototype;y.dispose=function(){};y.getConfiguration=function(w,D){this._configuration.output=w;this._configuration.space=D.slot===e.RenderSlot.DRAPED_MATERIAL?v.LineMarkerSpace.Draped:this.parameters.worldSpace?v.LineMarkerSpace.World:
v.LineMarkerSpace.Screen;this._configuration.hideOnShortSegments=this.parameters.hideOnShortSegments;this._configuration.hasCap=this.parameters.cap!==q.CapType.BUTT;this._configuration.anchor=this.parameters.anchor;this._configuration.hasTip=this.parameters.hasTip;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.vvColor=this.parameters.vvColorEnabled;
this._configuration.vvOpacity=this.parameters.vvOpacityEnabled;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.occluder=this.parameters.renderOccluded===f.RenderOccludedFlag.OccludeAndTransparentStencil;this._configuration.transparencyPassType=D.transparencyPassType;this._configuration.hasMultipassTerrain=D.multipassTerrain.enabled;this._configuration.cullAboveGround=D.multipassTerrain.cullAboveGround;return this._configuration};y.intersect=function(){};y.createLayout=
function(){const w=r.newLayout().vec3f(g.VertexAttribute.POSITION).vec2f(g.VertexAttribute.UV0).vec3f(g.VertexAttribute.AUXPOS1);this.parameters.worldSpace&&w.vec3f(g.VertexAttribute.NORMAL);this.parameters.vvSizeEnabled?w.f32(g.VertexAttribute.SIZEFEATUREATTRIBUTE):w.f32(g.VertexAttribute.SIZE);this.parameters.vvColorEnabled?w.f32(g.VertexAttribute.COLORFEATUREATTRIBUTE):w.vec4f(g.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&w.f32(g.VertexAttribute.OPACITYFEATUREATTRIBUTE);return w};
y.createBufferWriter=function(){return new C(this._layout,this.parameters)};y.requiresSlot=function(w,D){return D===m.ShaderOutput.Color||D===m.ShaderOutput.Alpha||D===m.ShaderOutput.Highlight||D===m.ShaderOutput.Depth?w===e.RenderSlot.DRAPED_MATERIAL?!0:this.parameters.renderOccluded===f.RenderOccludedFlag.OccludeAndTransparentStencil?w===e.RenderSlot.OPAQUE_MATERIAL||w===e.RenderSlot.OCCLUDER_MATERIAL||w===e.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL:D===m.ShaderOutput.Color||D===m.ShaderOutput.Alpha?
w===(this.parameters.writeDepth?e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):w===e.RenderSlot.OPAQUE_MATERIAL:!1};y.createGLMaterial=function(w){return new p(w)};return u}(f.Material),p=function(x){function u(){return x.apply(this,arguments)||this}c._inheritsLoose(u,x);var y=u.prototype;y._updateParameters=function(w){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(l.LineMarkerTechnique,
w)};y._updateOccludeeState=function(w){w.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:w.hasOccludees})};y.beginSlot=function(w){this._output!==m.ShaderOutput.Color&&this._output!==m.ShaderOutput.Alpha||this._updateOccludeeState(w);return this._updateParameters(w)};return u}(d.GLTextureMaterial),z=function(x){function u(){var y=x.apply(this,arguments)||this;y.width=0;y.color=[1,1,1,1];y.placement="end";y.cap=q.CapType.BUTT;y.anchor=v.LineMarkerAnchor.Center;
y.hasTip=!1;y.worldSpace=!1;y.hideOnShortSegments=!1;y.writeDepth=!0;y.hasSlicePlane=!1;y.vvFastUpdate=!1;y.hasOccludees=!1;return y}c._inheritsLoose(u,x);return u}(h.VisualVariablePassParameters),C=function(){function x(y,w){this.vertexBufferLayout=y;this._parameters=w}var u=x.prototype;u.allocate=function(y){return this.vertexBufferLayout.createBuffer(y)};u.elementCount=function(){return"begin-end"===this._parameters.placement?12:6};u.write=function(y,w,D,F,E){const K=D.vertexAttributes.get(g.VertexAttribute.POSITION).data,
J=K.length/3;let M=[1,0,0];w=D.vertexAttributes.get(g.VertexAttribute.NORMAL);this._parameters.worldSpace&&b.isSome(w)&&(M=w.data);let N=1,P=0;this._parameters.vvSizeEnabled?P=D.vertexAttributes.get(g.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:D.vertexAttributes.has(g.VertexAttribute.SIZE)&&(N=D.vertexAttributes.get(g.VertexAttribute.SIZE).data[0]);let I=[1,1,1,1],G=0;this._parameters.vvColorEnabled?G=D.vertexAttributes.get(g.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:D.vertexAttributes.has(g.VertexAttribute.COLOR)&&
(I=D.vertexAttributes.get(g.VertexAttribute.COLOR).data);let H=0;this._parameters.vvOpacityEnabled&&(H=D.vertexAttributes.get(g.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const L=new Float32Array(F.buffer);let O=this.vertexBufferLayout.stride/4*E;const S=(Q,V,aa,X)=>{L[O++]=Q[0];L[O++]=Q[1];L[O++]=Q[2];L[O++]=aa[0];L[O++]=aa[1];L[O++]=V[0];L[O++]=V[1];L[O++]=V[2];this._parameters.worldSpace&&(L[O++]=M[0],L[O++]=M[1],L[O++]=M[2]);this._parameters.vvSizeEnabled?L[O++]=P:L[O++]=N;this._parameters.vvColorEnabled?
L[O++]=G:(Q=Math.min(4*X,I.length-4),L[O++]=I[Q+0],L[O++]=I[Q+1],L[O++]=I[Q+2],L[O++]=I[Q+3]);this._parameters.vvOpacityEnabled&&(L[O++]=H)};let R;(function(Q){Q[Q.ASCENDING=1]="ASCENDING";Q[Q.DESCENDING=-1]="DESCENDING"})(R||(R={}));D=(Q,V)=>{const aa=t.set(B,K[3*Q],K[3*Q+1],K[3*Q+2]),X=A;let W=Q+V;do t.set(X,K[3*W],K[3*W+1],K[3*W+2]),W+=V;while(t.equals(aa,X)&&0<=W&&W<J);y&&(t.transformMat4(aa,aa,y),t.transformMat4(X,X,y));S(aa,X,[-1,-1],Q);S(aa,X,[1,-1],Q);S(aa,X,[1,1],Q);S(aa,X,[-1,-1],Q);S(aa,
X,[1,1],Q);S(aa,X,[-1,1],Q)};F=this._parameters.placement;"begin"!==F&&"begin-end"!==F||D(0,R.ASCENDING);"end"!==F&&"begin-end"!==F||D(J-1,R.DESCENDING)};return x}();const B=n.create(),A=n.create();a.LineMarkerMaterial=k;a.Parameters=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){const q=new Map([[h.VertexAttribute.POSITION,0],[h.VertexAttribute.UV0,2],[h.VertexAttribute.AUXPOS1,3],[h.VertexAttribute.NORMAL,4],[h.VertexAttribute.COLOR,5],[h.VertexAttribute.COLORFEATUREATTRIBUTE,5],[h.VertexAttribute.SIZE,6],[h.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[h.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);r=function(k){function p(){return k.apply(this,arguments)||this}b._inheritsLoose(p,k);var z=p.prototype;z.initializeProgram=function(C){return new d.Program(C.rctx,
p.shader.get().build(this.configuration),q)};z._makePipelineState=function(C,B){const A=this.configuration,x=C===g.TransparencyPassType.NONE;return v.makePipelineState({blending:A.output===t.ShaderOutput.Color||A.output===t.ShaderOutput.Alpha?x?m.blendingDefault:m.oitBlending(C):null,depthTest:{func:m.oitDepthTest(C)},depthWrite:x?A.writeDepth?v.defaultDepthWriteParams:null:m.oitDepthWrite(C),colorWrite:v.defaultColorWriteParams,stencilWrite:A.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:A.hasOccludees?
B?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})};z.initializePipeline=function(){this.configuration.occluder&&(this._occluderPipelineTransparent=v.makePipelineState({blending:m.blendingDefault,depthTest:e.depthCompareAlways,depthWrite:null,colorWrite:v.defaultColorWriteParams,stencilWrite:null,stencilTest:e.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=v.makePipelineState({blending:m.blendingDefault,depthTest:e.depthCompareAlways,
depthWrite:null,colorWrite:v.defaultColorWriteParams,stencilWrite:e.stencilWriteMaskOff,stencilTest:e.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=v.makePipelineState({blending:null,depthTest:e.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:e.stencilWriteMaskOn,stencilTest:e.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,
!1)};z.getPipelineState=function(C,B){return B?this._occludeePipelineState:this.configuration.occluder?C===f.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:C===f.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:k.prototype.getPipelineState.call(this,C,B)};return p}(r.ShaderTechnique);r.shader=new n.ReloadableShaderModule(l.LineMarker,()=>new Promise((k,p)=>a(["./LineMarker.glsl"],k,p)));c.LineMarkerTechnique=r;c.vertexAttributeLocations=
q;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/support/engineContent/marker ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MarkerSizing.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){function y(D){const F=new C.ShaderBuilder,E=D.hasMultipassTerrain&&(D.output===t.ShaderOutput.Color||D.output===t.ShaderOutput.Alpha),K=D.space===u.LineMarkerSpace.World;D.hasTip&&K&&F.extensions.add("GL_OES_standard_derivatives");F.include(r.RibbonVertexPosition,D);F.include(d.MarkerSizing,D);D.output===t.ShaderOutput.Depth&&F.include(m.OutputDepth,D);const {vertex:J,fragment:M}=F;M.include(h.RgbaFloatEncoding);l.addProjViewLocalOrigin(J,D);
F.attributes.add(x.VertexAttribute.POSITION,"vec3");F.attributes.add(x.VertexAttribute.UV0,"vec2");F.attributes.add(x.VertexAttribute.AUXPOS1,"vec3");F.varyings.add("vColor","vec4");F.varyings.add("vpos","vec3");F.varyings.add("vUV","vec2");F.varyings.add("vSize","float");b.addLinearDepth(F);E&&F.varyings.add("depth","float");D.hasTip&&F.varyings.add("vLineWidth","float");J.uniforms.add([new v.Float2PassUniform("nearFar",(N,P)=>P.camera.nearFar),new q.Float4PassUniform("viewport",(N,P)=>P.camera.fullViewport)]);
J.code.add(p.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);J.code.add(p.glsl`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
float interpolation = (-vnp - pos.z) / (prev.z - pos.z);
prev = mix(pos, prev, interpolation);
}
}`);K?(F.attributes.add(x.VertexAttribute.NORMAL,"vec3"),l.addViewNormal(J),J.constants.add("tiltThreshold","float",.7),J.code.add(p.glsl`vec3 perpendicular(vec3 v) {
vec3 n = (viewNormal * vec4(normal.xyz, 1.0)).xyz;
vec3 n2 = cross(v, n);
vec3 forward = vec3(0.0, 0.0, 1.0);
float tiltDot = dot(forward, n);
return abs(tiltDot) < tiltThreshold ? n : n2;
}`)):J.code.add(p.glsl`vec2 perpendicular(vec2 v) {
return vec2(v.y, -v.x);
}`);J.code.add(p.glsl`
      #define vecN ${K?"vec3":"vec2"}

      vecN normalizedSegment(vecN pos, vecN prev) {
        vecN segment = pos - prev;
        float segmentLen = length(segment);

        // normalize or zero if too short
        return (segmentLen > 0.001) ? segment / segmentLen : ${K?"vec3(0.0, 0.0, 0.0)":"vec2(0.0, 0.0)"};
      }

      vecN displace(vecN pos, vecN prev, float displacementLen) {
        vecN segment = normalizedSegment(pos, prev);

        vecN displacementDirU = perpendicular(segment);
        vecN displacementDirV = segment;

        ${D.anchor===u.LineMarkerAnchor.Tip?"pos -\x3d 0.5 * displacementLen * displacementDirV;":""}

        return pos + displacementLen * (uv0.x * displacementDirU + uv0.y * displacementDirV);
      }
    `);D.space===u.LineMarkerSpace.Screen&&(J.uniforms.add(new z.Matrix4PassUniform("inverseProjectionMatrix",(N,P)=>P.camera.inverseProjectionMatrix)),J.code.add(p.glsl`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),J.code.add(p.glsl`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),J.uniforms.add(new k.FloatPassUniform("perScreenPixelRatio",(N,P)=>P.camera.perScreenPixelRatio)),J.code.add(p.glsl`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${D.hasCap?"\n                if(prev.z \x3e posLeft.z) {\n                  vec2 diff \x3d posLeft.xy - posRight.xy;\n                  planeOrigin.xy +\x3d perpendicular(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `));J.uniforms.add(new k.FloatPassUniform("pixelRatio",(N,P)=>P.camera.pixelRatio));b.addCalculateLinearDepth(F);J.code.add(p.glsl`void main(void) {
if (uv0.y == 0.0) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
}
else {
float lineWidth = getLineWidth();
float screenMarkerSize = getScreenMarkerSize();
vec4 pos  = view * vec4(position.xyz, 1.0);
vec4 prev = view * vec4(auxpos1.xyz, 1.0);
clip(pos, prev);`);K?(D.hideOnShortSegments&&J.code.add(p.glsl`if (areWorldMarkersHidden(pos, prev)) {
gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
return;
}`),J.code.add(p.glsl`pos.xyz = displace(pos.xyz, prev.xyz, getWorldMarkerSize(pos));
vec4 displacedPosScreen = projectAndScale(pos);`)):(J.code.add(p.glsl`vec4 posScreen = projectAndScale(pos);
vec4 prevScreen = projectAndScale(prev);
vec4 displacedPosScreen = posScreen;
displacedPosScreen.xy = displace(posScreen.xy, prevScreen.xy, screenMarkerSize);`),D.space===u.LineMarkerSpace.Screen&&J.code.add(p.glsl`vec2 displacementDirU = perpendicular(normalizedSegment(posScreen.xy, prevScreen.xy));
vec3 lineRight = inverseProject(posScreen + lineWidth * vec4(displacementDirU.xy, 0.0, 0.0));
vec3 lineLeft = pos.xyz + (pos.xyz - lineRight);
pos = toFront(displacedPosScreen, lineLeft, lineRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`));J.code.add(p.glsl`
        ${E?"depth \x3d pos.z;":""}
        linearDepth = calculateLinearDepth(nearFar,pos.z);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1]
        vUV = (uv0 + 1.0) / 2.0;

        ${K?"":"vUV *\x3d displacedPosScreen.w;"}

        ${D.hasTip?"vLineWidth \x3d lineWidth;":""}

        vSize = screenMarkerSize;
        vColor = getColor();

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `);E&&F.include(f.multipassTerrainTest,D);F.include(n.SliceDraw,D);M.uniforms.add([new q.Float4PassUniform("intrinsicColor",N=>N.color),new B.Texture2DPassUniform("tex",N=>N.texture)]);M.include(g.ColorConversion);F.constants.add("texelSize","float",1/c.MARKER_TEXTURE_SIZE);M.code.add(p.glsl`float markerAlpha(vec2 samplePos) {
samplePos += vec2(0.5, -0.5) * texelSize;
float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
float distance = sdf * vSize;
distance -= 0.5;
return clamp(0.5 - distance, 0.0, 1.0);
}`);D.hasTip&&(F.constants.add("relativeMarkerSize","float",c.MARKER_SYMBOL_SIZE/c.MARKER_TEXTURE_SIZE),F.constants.add("relativeTipLineWidth","float",c.MARKER_TIP_THICKNESS_FACTOR),M.code.add(p.glsl`
    float tipAlpha(vec2 samplePos) {
      // Convert coordinates s.t. they are in pixels and relative to the tip of an arrow marker
      samplePos -= vec2(0.5, 0.5 + 0.5 * relativeMarkerSize);
      samplePos *= vSize;

      float halfMarkerSize = 0.5 * relativeMarkerSize * vSize;
      float halfTipLineWidth = 0.5 * max(1.0, relativeTipLineWidth * vLineWidth);

      ${K?"halfTipLineWidth *\x3d fwidth(samplePos.y);":""}

      float distance = max(abs(samplePos.x) - halfMarkerSize, abs(samplePos.y) - halfTipLineWidth);
      return clamp(0.5 - distance, 0.0, 1.0);
    }
  `));F.constants.add("symbolAlphaCutoff","float",e.symbolAlphaCutoff);M.code.add(p.glsl`
  void main() {
    discardBySlice(vpos);
    ${E?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    ${K?"vec2 samplePos \x3d vUV;":"vec2 samplePos \x3d vUV * gl_FragCoord.w;"}

    ${D.hasTip?"finalColor.a *\x3d max(markerAlpha(samplePos), tipAlpha(samplePos));":"finalColor.a *\x3d markerAlpha(samplePos);"}

    ${D.output===t.ShaderOutput.ObjectAndLayerIdColor?p.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < symbolAlphaCutoff) {
      discard;
    }

    ${D.output===t.ShaderOutput.Alpha?p.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${D.output===t.ShaderOutput.Color?p.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${D.output===t.ShaderOutput.Color&&D.transparencyPassType===A.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${D.output===t.ShaderOutput.Highlight?p.glsl`gl_FragColor = vec4(1.0);`:""}
    ${D.output===t.ShaderOutput.Depth?p.glsl`outputDepth(linearDepth);`:""}
  }
  `);return F}const w=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.LineMarker=w;a.build=y})},"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports","../../../../core/maybe"],function(a,c){function b(m,d=2){return c.isNone(m)?m:{pattern:m.slice(),pixelRatio:d}}function t(m){return c.isSome(m)?b(r[m],8):null}const n={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},r={dash:n.dash,"dash-dot":[...n.dash,
...n.dot],dot:n.dot,"long-dash":n["long-dash"],"long-dash-dot":[...n["long-dash"],...n.dot],"long-dash-dot-dot":[...n["long-dash"],...n.dot,...n.dot],none:null,"short-dash":n["short-dash"],"short-dash-dot":[...n["short-dash"],...n["short-dot"]],"short-dash-dot-dot":[...n["short-dash"],...n["short-dot"],...n["short-dot"]],"short-dot":n["short-dot"],solid:null};a.createStipplePattern=b;a.createStipplePatternSimple=function(m,d=2){return{pattern:[m,m],pixelRatio:d}};a.getStipplePatternForLinePattern=
function(m){return c.isSome(m)&&"style"===m.type?t(m.style):null};a.getStipplePatternForPatternStyle=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ../../../ViewingMode ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/FloatArray ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Indices ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V,aa){const X=["mesh"];t=function(ha){function fa(la,na,pa,va){la=ha.call(this,la,na,pa,va)||this;la._materials=new Map;la._textures=new Map;la.ensureDrapedStatus(!1);return la}c._inheritsLoose(fa,ha);var ka=fa.prototype;ka.doLoad=function(){var la=c._asyncToGenerator(function*(){M.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new V.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=
new V.NativeLineMaterial({color:[0,1,1,1]}))});return function(){return la.apply(this,arguments)}}();ka.destroy=function(){ha.prototype.destroy.call(this);this._context.stage.removeMany(Array.from(this._materials.values(),la=>la.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};ka.createGraphics3DGraphic=function(la){const na=la.graphic;if(!this._validateGeometry(na.geometry,X,"fill on mesh-3d"))return null;const pa=this.setGraphicElevationContext(na,
new D.ElevationContext);return this._createAs3DShape(na,la.renderingInfo,pa,na.uid)};ka.layerOpacityChanged=function(la,na){const pa=this._getLayerOpacity();this._materials.forEach(va=>{va.material.setParameters({layerOpacity:pa});const wa=va.material.parameters;this._setMaterialTransparentParameter(wa,va);va.material.setParameters({transparent:wa.transparent})});la.forEach(va=>{va=na(va);n.isSome(va)&&va.layerOpacityChanged(pa,this._context.isAsync)})};ka.layerElevationInfoChanged=function(la,na){return this.updateGraphics3DGraphicElevationInfo(la,
na,w.needsElevationUpdates3D)};ka.slicePlaneEnabledChanged=function(la,na){this._materials.forEach(pa=>{pa.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});la.forEach(pa=>{pa=na(pa);n.isSome(pa)&&pa.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};ka.physicalBasedRenderingChanged=function(){const la=this._usePBR();this._materials.forEach(na=>na.material.setParameters({usePBR:la}));return!0};ka.pixelRatioChanged=function(){return!0};
ka.skipHighSymbolLodsChanged=function(){return!0};ka._requiresSymbolVertexColors=function(){return this._drivenProperties.color||this._drivenProperties.opacity};ka._colorOrTextureUid=function(la){return n.isNone(la)?"-":la instanceof b?la.toHex():la.contentHash};ka._materialPropertiesDefault=function(la,na){const pa=this._requiresSymbolVertexColors(),va=!!la.vertexAttributes.color;la=!!la.vertexAttributes.tangent;return{hasSymbolVertexColors:pa,hasVertexColors:va,hasVertexTangents:la,uid:`vc:${va},vt:${la},vct${na},svc:${pa}`}};
ka._materialProperties=function(la,na,pa){la=this._materialPropertiesDefault(la,pa);if(!na.material)return la;const {color:va,colorTexture:wa,normalTexture:za,doubleSided:sa,alphaCutoff:ua,alphaMode:oa}=na.material;pa=this._colorOrTextureUid(va);var xa=this._colorOrTextureUid(wa),Ea=this._colorOrTextureUid(za);la.color=va;la.colorTexture=wa;la.normalTexture=za;la.uid=`${la.uid},cmuid:${pa},ctmuid:${xa},ntmuid:${Ea},ds:${sa},ac:${ua},am:${oa}`;if(na.material instanceof k){const {metallic:Ia,roughness:Na,
metallicRoughnessTexture:Oa,emissiveColor:Ja,emissiveTexture:Sa,occlusionTexture:Ua}=na.material;pa=this._colorOrTextureUid(Oa);xa=this._colorOrTextureUid(Ja);Ea=this._colorOrTextureUid(Sa);const Za=this._colorOrTextureUid(Ua);la.metallic=Ia;la.roughness=Na;la.metallicRoughnessTexture=Oa;la.emissiveColor=Ja;la.emissiveTexture=Sa;la.occlusionTexture=Ua;la.colorTextureTransform=na.material.colorTextureTransform;la.normalTextureTransform=na.material.normalTextureTransform;la.emissiveTextureTransform=
na.material.emissiveTextureTransform;la.occlusionTextureTransform=na.material.occlusionTextureTransform;la.metallicRoughnessTextureTransform=na.material.metallicRoughnessTextureTransform;la.uid=`${la.uid},mrm:${Ia},mrr:${Na},mrt:${pa},emuid:${xa},etmuid:${Ea},otmuid:${Za}`}return la};ka._setInternalColorValueParameters=function(la,na){na.diffuse=b.toUnitRGB(la);na.opacity=la.a};ka._getLoadableTextureResource=function(la){return la.data?la.data:la.url};ka._getInternalTextureId=function(la){la=this._getInternalTexture(la,
P.AlphaDiscardMode.Opaque);return n.isSome(la)?la.id:null};ka._getInternalTexture=function(la,na){const pa=this._getLoadableTextureResource(la);if(!pa)return null;const va=`${la.contentHash}/${na}`;let wa=this._textures.get(va);wa||(wa=new S.Texture(x.isEncodedMeshTexture(pa)?pa.data:pa,{mipmap:!0,wrap:this._castTextureWrap(la.wrap),noUnpackFlip:!0,preMultiplyAlpha:x.isEncodedMeshTexture(pa)?!1:na!==P.AlphaDiscardMode.Opaque,encoding:x.isEncodedMeshTexture(pa)&&n.isSome(pa.encoding)?pa.encoding:void 0}),
this._textures.set(va,wa),this._context.stage.add(wa),this._context.stage.loadImmediate(wa));return wa};ka._castTextureWrap=function(la="repeat"){return"string"===typeof la?(la=this._castTextureWrapIndividual(la),{s:la,t:la}):{s:this._castTextureWrapIndividual(la.horizontal),t:this._castTextureWrapIndividual(la.vertical)}};ka._castTextureWrapIndividual=function(la){switch(la){case "clamp":return aa.TextureWrapMode.CLAMP_TO_EDGE;case "mirror":return aa.TextureWrapMode.MIRRORED_REPEAT;default:return aa.TextureWrapMode.REPEAT}};
ka._setInternalMaterialParameters=function(la,na){n.isSome(la.color)&&this._setInternalColorValueParameters(la.color,na);if(n.isSome(la.colorTexture)){const pa=this._getInternalTexture(la.colorTexture,na.textureAlphaMode);n.isSome(pa)?(na.textureId=pa.id,na.textureAlphaPremultiplied=!!pa.params.preMultiplyAlpha):na.textureId=void 0}n.isSome(la.normalTexture)&&(na.normalTextureId=this._getInternalTextureId(la.normalTexture));n.isSome(la.emissiveColor)&&(na.emissiveFactor=b.toUnitRGB(la.emissiveColor));
n.isSome(la.emissiveTexture)&&(na.emissiveTextureId=this._getInternalTextureId(la.emissiveTexture));n.isSome(la.occlusionTexture)&&(na.occlusionTextureId=this._getInternalTextureId(la.occlusionTexture));n.isSome(la.metallicRoughnessTexture)&&(na.metallicRoughnessTextureId=this._getInternalTextureId(la.metallicRoughnessTexture));na.colorTextureTransformMatrix=u.getTransformMatrix(la.colorTextureTransform);na.normalTextureTransformMatrix=u.getTransformMatrix(la.normalTextureTransform);na.occlusionTextureTransformMatrix=
u.getTransformMatrix(la.occlusionTextureTransform);na.emissiveTextureTransformMatrix=u.getTransformMatrix(la.emissiveTextureTransform);na.metallicRoughnessTextureTransformMatrix=u.getTransformMatrix(la.metallicRoughnessTextureTransform)};ka._setExternalMaterialParameters=function(la){var na=this._drivenProperties.color;let pa=n.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;na?la.externalColor=h.ONES:(na=n.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:
null,n.isSome(na)?la.externalColor=b.toUnitRGBA(na):(pa=null,la.externalColor=h.ONES));pa&&(la.colorMixMode=pa);la.castShadows=!!this.symbolLayer.castShadows};ka._hasTransparentVertexColors=function(la){la=la.vertexAttributes.color;if(n.isNone(la))return!1;for(let na=3;na<la.length;na+=4)if(255!==la[na])return!0;return!1};ka._getOrCreateMaterial=function(la,na){var pa=na.material?.color,va=na.material?.colorTexture,wa=na.material?.alphaMode;const za="blend"===wa;pa="opaque"!==wa&&(this._hasTransparentVertexColors(la)||
n.isSome(pa)&&1>pa.a||n.isSome(va)&&va.transparent||za);la=this._materialProperties(la,na,pa);if(va=this._materials.get(la.uid))return va.material;pa={material:null,isComponentTransparent:pa,alphaMode:na.material?na.material.alphaMode:"opaque"};va=null==la.metallicRoughnessTexture&&null==la.metallic&&null==la.roughness;wa={usePBR:this._usePBR(),isSchematic:va,hasVertexColors:la.hasVertexColors,hasSymbolColors:la.hasSymbolVertexColors,hasVertexTangents:la.hasVertexTangents,ambient:g.ZEROS,diffuse:g.ONES,
opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:P.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};va||(wa.mrrFactors=[null!=la.metallic?la.metallic:1,null!=la.roughness?la.roughness:1,.5]);na.material&&(wa.doubleSided=na.material.doubleSided,wa.cullFace=na.material.doubleSided?P.CullFaceOptions.None:P.CullFaceOptions.Back,wa.textureAlphaCutoff=na.material.alphaCutoff);this._setExternalMaterialParameters(wa);
this._setMaterialTransparentParameter(wa,pa);this._setInternalMaterialParameters(la,wa);na=new Q.DefaultMaterial(wa);pa.material=na;this._materials.set(la.uid,pa);this._context.stage.add(na);return na};ka._usePBR=function(){return this._context.physicalBasedRenderingEnabled};ka._setMaterialTransparentParameter=function(la,na){la.transparent=this.needsDrivenTransparentPass||na.isComponentTransparent||1>la.layerOpacity||1>la.opacity||la.externalColor&&1>la.externalColor[3];la.textureAlphaMode="auto"===
na.alphaMode?la.transparent?P.AlphaDiscardMode.MaskBlend:P.AlphaDiscardMode.Opaque:"opaque"===na.alphaMode?P.AlphaDiscardMode.Opaque:"mask"===na.alphaMode?P.AlphaDiscardMode.Mask:P.AlphaDiscardMode.Blend};ka._addDebugNormals=function(la,na){var pa=na.length,va=la.spatialReference.isGeographic?20015077/180:1;const wa=.1*Math.max(la.extent.width*va,la.extent.height*va,la.extent.zmax-la.extent.zmin);var za=[];const sa=[];la=[];va=[];for(let Na=0;Na<pa;Na++){var ua=na[Na],oa=ua.vertexAttributes.get(R.VertexAttribute.POSITION),
xa=ua.vertexAttributes.get(R.VertexAttribute.NORMAL);const Oa=ua.indices.get(R.VertexAttribute.POSITION);ua=ua.indices.get(R.VertexAttribute.NORMAL);oa=oa.data;xa=xa.data;for(let Ja=0;Ja<Oa.length;Ja++){var Ea=3*Oa[Ja];const Sa=3*ua[Ja];for(var Ia=0;3>Ia;Ia++)za.push(oa[Ea+Ia]);for(Ia=0;3>Ia;Ia++)za.push(oa[Ea+Ia]+xa[Sa+Ia]*wa);sa.push(sa.length);sa.push(sa.length);if(0===Ja%3){this._calculateFaceNormal(oa,Oa,Ja,da);this._getFaceVertices(oa,Oa,Ja,U,Y,ba);e.add(U,U,Y);e.add(U,U,ba);e.scale(U,U,1/3);
for(Ea=0;3>Ea;Ea++)la.push(U[Ea]);for(Ea=0;3>Ea;Ea++)la.push(U[Ea]+da[Ea]*wa);va.push(va.length);va.push(va.length)}}}pa=na[0].transformation;za=new H.Geometry(this._debugVertexNormalMaterial,[[R.VertexAttribute.POSITION,new N.Attribute(za,3,!0)]],[[R.VertexAttribute.POSITION,sa]],null,I.ContentObjectType.Line);na.push(za);za.transformation=pa;la=new H.Geometry(this._debugFaceNormalMaterial,[[R.VertexAttribute.POSITION,new N.Attribute(la,3,!0)]],[[R.VertexAttribute.POSITION,va]],null,I.ContentObjectType.Line);
la.transformation=pa;na.push(la)};ka._createAs3DShape=function(la,na,pa,va){la=la.geometry;if("mesh"!==la.type)return null;na=this._createGeometryInfo(la,na,va);if(n.isNone(na))return null;const {geometries:wa,objectTransformation:za}=na;M.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(la,wa);va=new O.Object3D({geometries:wa,metadata:{layerUid:this._context.layer.uid,graphicUid:va}});va.transformation=za;na=K.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});na=n.isSome(na)?new F.Object3DEdgeState(wa[0].material,
[na],{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}):null;na=new F.Graphics3DObject3DGraphicLayer(this,va,wa,null,null,y.perObjectElevationAligner,pa,na);na.needsElevationUpdates=w.needsElevationUpdates3D(pa.mode);na.useObjectOriginAsAttachmentOrigin=!0;pa.centerPointInElevationSR=this._getCenterPointInElevationSR(va);const {elevationProvider:sa,renderCoordsHelper:ua}=this._context;na.alignedSampledElevation=y.perObjectElevationAligner(na,pa,sa.spatialReference,(oa,xa)=>w.evaluateElevationInfoAtPoint(oa,
sa,pa,ua,xa),ua);return na};ka._getCenterPointInElevationSR=function(la){const na=B.makeDehydratedPoint(0,0,0,n.isSome(this._context.elevationProvider.spatialReference)?this._context.elevationProvider.spatialReference:null);l.projectVectorToDehydratedPoint([la.transformation[12],la.transformation[13],la.transformation[14]],this._context.renderCoordsHelper.spatialReference,na);return na};ka._createComponentNormals=function(la,na,pa,va){switch(pa.shading||"flat"){default:case "source":return this._createComponentNormalsSource(la,
na,pa,va);case "flat":return this._createComponentNormalsFlat(la,va);case "smooth":return this._createComponentNormalsSmooth(la,va)}};ka._createComponentNormalsSource=function(la,na,pa,va){if(n.isNone(na))return this._createComponentNormalsFlat(la,va);let wa=!1;if(!pa.trustSourceNormals)for(pa=0;pa<va.length;pa+=3){this._calculateFaceNormal(la,va,pa,da);for(let za=0;3>za;za++){const sa=3*va[pa+za];U[0]=na[sa+0];U[1]=na[sa+1];U[2]=na[sa+2];0>e.dot(da,U)&&(na[sa+0]=-na[sa+0],na[sa+1]=-na[sa+1],na[sa+
2]=-na[sa+2],wa=!0)}}return new W(na,va,wa)};ka._createComponentNormalsFlat=function(la,na){const pa=G.newFloatArray(na.length),va=Array(3*na.length);for(let wa=0;wa<na.length;wa+=3){const za=this._calculateFaceNormal(la,na,wa,da);for(let sa=0;3>sa;sa++)pa[wa+sa]=za[sa],va[wa+sa]=wa/3}return new W(pa,va,!1)};ka._createComponentNormalsSmooth=function(la,na){const pa={};for(var va=0;va<na.length;va+=3){var wa=this._calculateFaceNormal(la,na,va,da);for(var za=0;3>za;za++){var sa=na[va+za];let ua=pa[sa];
ua||(ua={normal:g.create(),count:0},pa[sa]=ua);e.add(ua.normal,ua.normal,wa);ua.count++}}la=G.newFloatArray(3*na.length);va=Array(3*na.length);for(wa=0;wa<na.length;wa++){za=pa[na[wa]];1!==za.count&&(e.normalize(za.normal,za.normal),za.count=1);for(sa=0;3>sa;sa++)la[3*wa+sa]=za.normal[sa];va[wa]=wa}return new W(la,va,!1)};ka._getFaceVertices=function(la,na,pa,va,wa,za){const sa=3*na[pa+0],ua=3*na[pa+1];na=3*na[pa+2];va[0]=la[sa+0];va[1]=la[sa+1];va[2]=la[sa+2];wa[0]=la[ua+0];wa[1]=la[ua+1];wa[2]=
la[ua+2];za[0]=la[na+0];za[1]=la[na+1];za[2]=la[na+2]};ka._calculateFaceNormal=function(la,na,pa,va){this._getFaceVertices(la,na,pa,U,Y,ba);e.subtract(Y,Y,U);e.subtract(ba,ba,U);e.cross(U,Y,ba);e.normalize(va,U);return va};ka._getOrCreateComponents=function(la){return n.unwrapOr(la.components,ia)};ka._createPositionBuffer=function(la,na){let pa=la.vertexAttributes.position;const va=na.reprojection===Z.ECEF?na.transformBeforeProject:null;n.isSome(va)&&(pa=C.transformPosition(pa,new Float64Array(pa.length),
va));if(na.reprojection===Z.NONE)return na.needsBufferCopy?new Float64Array(pa):pa;na=n.isSome(va)?pa:new Float64Array(pa.length);l.projectBuffer(pa,la.spatialReference,0,na,this._context.renderCoordsHelper.spatialReference,0,pa.length/3);return na};ka._createNormalBuffer=function(la,na,pa){let va=la.vertexAttributes.normal;if(n.isNone(va))return null;var wa=pa.reprojection===Z.ECEF?pa.transformBeforeProject:null;n.isSome(wa)&&(va=C.transformNormal(va,new Float32Array(va.length),wa));if("local"===
this._context.graphicsCoreOwner.view.viewingMode||pa.reprojection===Z.NONE)return pa.needsBufferCopy&&la.vertexAttributes.normal===va?new Float32Array(va):va;pa=la.vertexAttributes.position;wa=n.isSome(wa)?va:new Float32Array(va.length);return C.projectNormalToPCPF(va,pa,na,la.spatialReference,wa)};ka._createTangentBuffer=function(la,na,pa){let va=la.vertexAttributes.tangent;if(n.isNone(va))return null;var wa=pa.reprojection===Z.ECEF?pa.transformBeforeProject:null;n.isSome(wa)&&(va=C.transformTangent(va,
new Float32Array(va.length),wa));if("local"===this._context.graphicsCoreOwner.view.viewingMode||pa.reprojection===Z.NONE)return pa.needsBufferCopy&&la.vertexAttributes.normal===va?new Float32Array(va):va;pa=la.vertexAttributes.position;wa=n.isSome(wa)?va:new Float32Array(va.length);return C.projectTangentToPCPF(va,pa,na,la.spatialReference,wa)};ka._createColorBuffer=function(la){return la.vertexAttributes.color};ka._createSymbolColorBuffer=function(la){if(this._requiresSymbolVertexColors()){la=this._getVertexOpacityAndColor(la);
const na=J.parseColorMixMode(n.get(this.symbolLayer,"material","colorMixMode")),pa=new Uint8Array(4);J.encodeSymbolColor(la,na,pa);return pa}return null};ka._createBuffers=function(la,na){var pa=la.vertexAttributes&&la.vertexAttributes.position;if(!pa)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var va=la.vertexAttributes.normal;const wa=la.vertexAttributes.uv;var za=la.vertexAttributes.tangent;if(n.isSome(va)&&va.length!==pa.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),
null;if(n.isSome(za)&&za.length/4!==pa.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(n.isSome(wa)&&wa.length/2!==pa.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;za=this._computeReprojectionInfo(la);pa=this._createPositionBuffer(la,za);va=this._createColorBuffer(la);na=this._createSymbolColorBuffer(na);const sa=this._createNormalBuffer(la,
pa,za),ua=this._createTangentBuffer(la,pa,za);la=za.reprojection===Z.NONE&&n.isSome(za.objectTransformation)?za.objectTransformation:this._transformOriginLocal(la,pa,sa,ua);za=za.reprojection===Z.NONE&&n.isSome(za.geometryTransformation)?za.geometryTransformation:f.create();return{positionBuffer:pa,normalBuffer:sa,tangentBuffer:ua,uvBuffer:wa,colorBuffer:va,symbolColorBuffer:na,objectTransformation:la,geometryTransformation:za}};ka._computeReprojectionInfo=function(la){var na=n.isSome(la.transform);
const pa=na&&la.transform.geographic?Z.NONE:this._context.renderCoordsHelper.viewingMode===A.ViewingMode.Local?Z.NONE:Z.ECEF;if(na){if(pa===Z.NONE)return na=f.create(),l.computeTranslationToOriginAndRotation(la.spatialReference,la.transform.origin,na,this._context.renderCoordsHelper.spatialReference),la=f.clone(la.transform.localMatrix),{reprojection:pa,objectTransformation:na,geometryTransformation:la,needsBufferCopy:!1};na=d.fromTranslation(f.create(),la.transform.origin);d.multiply(na,na,la.transform.localMatrix);
return{reprojection:pa,transformBeforeProject:na,needsBufferCopy:!0}}return{reprojection:pa,needsBufferCopy:!0}};ka._transformOriginLocal=function(la,na,pa,va){const wa=this._context.renderCoordsHelper.spatialReference;var za=la.anchor;T[0]=za.x;T[1]=za.y;T[2]=za.z;za=f.create();l.computeTranslationToOriginAndRotation(la.spatialReference,T,za,wa);la=p.BufferViewVec3f64.fromTypedArray(na);d.invert(ea,za);z.transformMat4(la,la,ea);if(n.isSome(pa)||n.isSome(va))r.fromMat4(ca,za),r.transpose(ca,ca),n.isSome(pa)&&
(pa=p.BufferViewVec3f.fromTypedArray(pa),z.transformMat3(pa,pa,ca)),n.isSome(va)&&(va=p.BufferViewVec3f.fromTypedArray(va,4*va.BYTES_PER_ELEMENT),z.transformMat3(va,va,ca));return za};ka._validateFaces=function(la,na){la=la.vertexAttributes.position.length/3;if(na=na.faces){let pa=-1;for(let va=0;va<na.length;va++){const wa=na[va];wa>pa&&(pa=wa)}if(la<=pa)return this.logger.warn(`Vertex index ${pa} is out of bounds of the mesh position buffer`),!1}else if(0!==la%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0};ka._getOrCreateFaces=function(la,na){return na.faces?na.faces:L.generateDefaultIndexArray(la.vertexAttributes.position.length/3)};ka._isOutsideClippingArea=function(la){if(!this._context.clippingExtent)return!1;var na=la.vertexAttributes&&la.vertexAttributes.position;if(!na)return!1;const pa=this._context.elevationProvider.spatialReference,va=na.length/3;n.isSome(pa)&&!la.spatialReference.equals(pa)&&(na=new Float64Array(na.length),l.projectBuffer(la.vertexAttributes.position,la.spatialReference,
0,na,pa,0,va));v.empty(ja);v.expandWithBuffer(ja,na,0,va);return!v.intersectsClippingArea(ja,this._context.clippingExtent)};ka._createGeometryInfo=function(la,na,pa){if(!l.canProjectWithoutEngine(la.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(la))return null;na=this._createBuffers(la,na);if(n.isNone(na))return null;const {positionBuffer:va,uvBuffer:wa,
colorBuffer:za,symbolColorBuffer:sa,normalBuffer:ua,tangentBuffer:oa,objectTransformation:xa,geometryTransformation:Ea}=na;var Ia=this._getOrCreateComponents(la);na=[];let Na=!1;for(const Sa of Ia){if(!this._validateFaces(la,Sa))return null;var Oa=this._getOrCreateFaces(la,Sa);if(0===Oa.length)continue;var Ja=this._createComponentNormals(va,ua,Sa,Oa);Ja.didFlipNormals&&(Na=!0);Ia=[[R.VertexAttribute.POSITION,new N.Attribute(va,3,!0)],[R.VertexAttribute.NORMAL,new N.Attribute(Ja.normals,3,!0)]];Ja=
[[R.VertexAttribute.POSITION,Oa],[R.VertexAttribute.NORMAL,Ja.indices]];n.isSome(za)&&(Ia.push([R.VertexAttribute.COLOR,new N.Attribute(za,4,!0)]),Ja.push([R.VertexAttribute.COLOR,Oa]));n.isSome(sa)&&(Ia.push([R.VertexAttribute.SYMBOLCOLOR,new N.Attribute(sa,4,!0)]),Ja.push([R.VertexAttribute.SYMBOLCOLOR,Array(Oa.length).fill(0)]));n.isSome(wa)&&(Ia.push([R.VertexAttribute.UV0,new N.Attribute(wa,2,!0)]),Ja.push([R.VertexAttribute.UV0,Oa]));n.isSome(oa)&&(Ia.push([R.VertexAttribute.TANGENT,new N.Attribute(oa,
4,!0)]),Ja.push([R.VertexAttribute.TANGENT,Oa]));Oa=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:pa,layerUid:this._context.layer.uid});const Ua=this._getOrCreateMaterial(la,Sa);Ia=new H.Geometry(Ua,Ia,Ja,null,I.ContentObjectType.Mesh,Oa);Ia.transformation=Ea;na.push(Ia)}Na&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:na,
objectTransformation:xa}};return fa}(E.Graphics3DSymbolLayer);let W=function(ha,fa,ka){this.normals=ha;this.indices=fa;this.didFlipNormals=ka};const T=g.create(),U=g.create(),Y=g.create(),ba=g.create(),da=g.create(),ea=f.create(),ca=m.create(),ja=v.create(),ia=[new q];var Z;(function(ha){ha[ha.NONE=0]="NONE";ha[ha.ECEF=1]="ECEF"})(Z||(Z={}));a.Graphics3DMeshFillSymbolLayer=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){var l;const v=n.getLogger("esri.geometry.support.MeshComponent");b=l=function(q){function k(z){z=q.call(this,z)||this;z.faces=null;z.material=null;z.shading="source";z.trustSourceNormals=!1;return z}a._inheritsLoose(k,q);k.from=function(z){return f.ensureClass(l,z)};var p=k.prototype;p.castFaces=function(z){return h.castArray(z,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},v)};p.castMaterial=function(z){return z&&"object"===typeof z&&("metallic"in z||
"roughness"in z||"metallicRoughnessTexture"in z)?f.ensureClass(g,z):f.ensureClass(e,z)};p.clone=function(){return new l({faces:t.clone(this.faces),shading:this.shading,material:t.clone(this.material),trustSourceNormals:this.trustSourceNormals})};p.cloneWithDeduplication=function(z,C){z={faces:t.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(z,C):null,trustSourceNormals:this.trustSourceNormals};return new l(z)};return k}(b.JSONSupport);c.__decorate([r.property({json:{write:!0}})],
b.prototype,"faces",void 0);c.__decorate([m.cast("faces")],b.prototype,"castFaces",null);c.__decorate([r.property({type:e,json:{write:!0}})],b.prototype,"material",void 0);c.__decorate([m.cast("material")],b.prototype,"castMaterial",null);c.__decorate([r.property({type:String,json:{write:!0}})],b.prototype,"shading",void 0);c.__decorate([r.property({type:Boolean})],b.prototype,"trustSourceNormals",void 0);return b=l=c.__decorate([d.subclass("esri.geometry.support.MeshComponent")],b)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./MeshTexture".split(" "),
function(a,c,b,t,n,r,m,d,f,e){var g;t=g=function(h){function l(q){q=h.call(this,q)||this;q.color=null;q.colorTexture=null;q.normalTexture=null;q.alphaMode="auto";q.alphaCutoff=.5;q.doubleSided=!0;return q}a._inheritsLoose(l,h);var v=l.prototype;v.clone=function(){return this.cloneWithDeduplication(null,new Map)};v.cloneWithDeduplication=function(q,k){const p=n.isSome(q)?q.get(this):null;if(p)return p;k=new g(this.clonePropertiesWithDeduplication(k));n.isSome(q)&&q.set(this,k);return k};v.clonePropertiesWithDeduplication=
function(q){return{color:n.isSome(this.color)?this.color.clone():null,colorTexture:n.isSome(this.colorTexture)?this.colorTexture.cloneWithDeduplication(q):null,normalTexture:n.isSome(this.normalTexture)?this.normalTexture.cloneWithDeduplication(q):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided,colorTextureTransform:n.isSome(this.colorTextureTransform)?this.colorTextureTransform:null,normalTextureTransform:n.isSome(this.normalTextureTransform)?this.normalTextureTransform:
null}};return l}(t.JSONSupport);c.__decorate([r.property({type:b,json:{write:!0}})],t.prototype,"color",void 0);c.__decorate([r.property({type:e,json:{write:!0}})],t.prototype,"colorTexture",void 0);c.__decorate([r.property({type:e,json:{write:!0}})],t.prototype,"normalTexture",void 0);c.__decorate([r.property({nonNullable:!0,json:{write:!0}})],t.prototype,"alphaMode",void 0);c.__decorate([r.property({nonNullable:!0,json:{write:!0}})],t.prototype,"alphaCutoff",void 0);c.__decorate([r.property({nonNullable:!0,
json:{write:!0}})],t.prototype,"doubleSided",void 0);c.__decorate([r.property()],t.prototype,"colorTextureTransform",void 0);c.__decorate([r.property()],t.prototype,"normalTextureTransform",void 0);return t=g=c.__decorate([f.subclass("esri.geometry.support.MeshMaterial")],t)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/imageUtils ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){var l;const v=new WeakMap;let q=0;b=l=function(k){function p(C){C=k.call(this,C)||this;C.wrap="repeat";return C}a._inheritsLoose(p,k);var z=p.prototype;z.writeData=function(C,B,A,x){C instanceof HTMLImageElement?(C={type:"image-element",src:h.toJSON(C.src,x),crossOrigin:C.crossOrigin},B[A]=C):C instanceof HTMLCanvasElement?(C=C.getContext("2d").getImageData(0,0,C.width,C.height),C={type:"canvas-element",imageData:this._encodeImageData(C)},B[A]=C):C instanceof HTMLVideoElement?
(C={type:"video-element",src:h.toJSON(C.src,x),autoplay:C.autoplay,loop:C.loop,muted:C.muted,crossOrigin:C.crossOrigin,preload:C.preload},B[A]=C):C instanceof ImageData&&(C={type:"image-data",imageData:this._encodeImageData(C)},B[A]=C)};z.readData=function(C){switch(C.type){case "image-element":var B=new Image;B.src=C.src;B.crossOrigin=C.crossOrigin;return B;case "canvas-element":return C=this._decodeImageData(C.imageData),B=document.createElement("canvas"),B.width=C.width,B.height=C.height,B.getContext("2d").putImageData(C,
0,0),B;case "image-data":return this._decodeImageData(C.imageData);case "video-element":return B=document.createElement("video"),B.src=C.src,B.crossOrigin=C.crossOrigin,B.autoplay=C.autoplay,B.loop=C.loop,B.muted=C.muted,B.preload=C.preload,B}};z.clone=function(){const C={url:this.url,data:this.data,wrap:this._cloneWrap()};return new l(C)};z.cloneWithDeduplication=function(C){var B=C.get(this);if(B)return B;B=this.clone();C.set(this,B);return B};z._cloneWrap=function(){return"string"===typeof this.wrap?
this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};z._encodeImageData=function(C){let B="";for(let A=0;A<C.data.length;A++)B+=String.fromCharCode(C.data[A]);return{data:btoa(B),width:C.width,height:C.height}};z._decodeImageData=function(C){const B=atob(C.data),A=new Uint8ClampedArray(B.length);for(let x=0;x<B.length;x++)A[x]=B.charCodeAt(x);return t.wrapImageData(A,C.width,C.height)};z._imageDataContainsTransparent=function(C){for(let B=3;B<C.data.length;B+=4)if(255!==C.data[B])return!0;
return!1};p.from=function(C){return"string"===typeof C?new l({url:C}):C instanceof HTMLImageElement||C instanceof HTMLCanvasElement||C instanceof ImageData||C instanceof HTMLVideoElement?new l({data:C}):m.ensureClass(l,C)};a._createClass(p,[{key:"url",get:function(){return this._get("url")||null},set:function(C){this._set("url",C);C&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(C){this._set("data",C);C&&this._set("url",null)}},{key:"transparent",
get:function(){var C=this.data,B=this.url;return C instanceof HTMLCanvasElement?this._imageDataContainsTransparent(C.getContext("2d").getImageData(0,0,C.width,C.height)):C instanceof ImageData?this._imageDataContainsTransparent(C):B&&(C=B.substr(B.length-4,4).toLowerCase(),B=B.substr(0,15).toLocaleLowerCase(),".png"===C||"data:image/png;"===B)?!0:!1},set:function(C){this._overrideIfSome("transparent",C)}},{key:"contentHash",get:function(){const C="string"===typeof this.wrap?this.wrap:"object"===typeof this.wrap?
`${this.wrap.horizontal}/${this.wrap.vertical}`:"",B=(A="")=>`d:${A},t:${this.transparent},w:${C}`;if(null!=this.url)return B(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return B(this.data.src);v.has(this.data)||v.set(this.data,++q);return B(v.get(this.data))}return B()}}]);return p}(n.JSONSupport);c.__decorate([r.property({type:String,json:{write:h.write}})],b.prototype,"url",null);c.__decorate([r.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),
r.property()],b.prototype,"data",null);c.__decorate([g.writer("data")],b.prototype,"writeData",null);c.__decorate([f.reader("data")],b.prototype,"readData",null);c.__decorate([r.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],b.prototype,"transparent",null);c.__decorate([r.property({json:{write:!0}})],b.prototype,"wrap",void 0);c.__decorate([r.property({readOnly:!0})],b.prototype,"contentHash",null);return b=l=c.__decorate([e.subclass("esri.geometry.support.MeshTexture")],
b)})},"esri/core/imageUtils":function(){define(["exports"],function(a){function c(n,r,m){m||(b||(b=document.createElement("canvas"),b.width=1,b.height=1),m=b);return m.getContext("2d").createImageData(n,r)}let b=null,t=!0;a.createEmptyImageData=function(n,r,m){if(!n||!r)throw Error("Cannot construct image data without dimensions");if(t)try{return new ImageData(n,r)}catch(d){t=!1}return c(n,r,m)};a.wrapImageData=function(n,r,m,d){if(!r||!m)throw Error("Cannot construct image data without dimensions");
if(t)try{return new ImageData(n,r,m)}catch(f){t=!1}r=c(r,m,d);r.data.set(n,0);return r};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture".split(" "),
function(a,c,b,t,n,r,m,d,f,e){var g;r=g=function(h){function l(q){q=h.call(this,q)||this;q.emissiveColor=null;q.emissiveTexture=null;q.occlusionTexture=null;q.metallic=1;q.roughness=1;q.metallicRoughnessTexture=null;return q}a._inheritsLoose(l,h);var v=l.prototype;v.clone=function(){return this.cloneWithDeduplication(null,new Map)};v.cloneWithDeduplication=function(q,k){const p=t.isSome(q)?q.get(this):null;if(p)return p;k=new g(this.clonePropertiesWithDeduplication(k));t.isSome(q)&&q.set(this,k);
return k};v.clonePropertiesWithDeduplication=function(q){return{...h.prototype.clonePropertiesWithDeduplication.call(this,q),emissiveColor:t.isSome(this.emissiveColor)?this.emissiveColor.clone():null,emissiveTexture:t.isSome(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(q):null,occlusionTexture:t.isSome(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(q):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:t.isSome(this.metallicRoughnessTexture)?
this.metallicRoughnessTexture.cloneWithDeduplication(q):null,occlusionTextureTransform:t.isSome(this.occlusionTextureTransform)?this.occlusionTextureTransform:null,emissiveTextureTransform:t.isSome(this.emissiveTextureTransform)?this.emissiveTextureTransform:null,metallicRoughnessTextureTransform:t.isSome(this.metallicRoughnessTextureTransform)?this.metallicRoughnessTextureTransform:null}};return l}(f);c.__decorate([n.property({type:b,json:{write:!0}})],r.prototype,"emissiveColor",void 0);c.__decorate([n.property({type:e,
json:{write:!0}})],r.prototype,"emissiveTexture",void 0);c.__decorate([n.property({type:e,json:{write:!0}})],r.prototype,"occlusionTexture",void 0);c.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],r.prototype,"metallic",void 0);c.__decorate([n.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],r.prototype,"roughness",void 0);c.__decorate([n.property({type:e,json:{write:!0}})],r.prototype,"metallicRoughnessTexture",void 0);c.__decorate([n.property()],
r.prototype,"occlusionTextureTransform",void 0);c.__decorate([n.property()],r.prototype,"emissiveTextureTransform",void 0);c.__decorate([n.property()],r.prototype,"metallicRoughnessTextureTransform",void 0);return r=g=c.__decorate([d.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],r)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d,f){function e(q,k,p,z){const {loggerTag:C,stride:B}=k;return 0!==q.length%B?(z.error(C,`Invalid array length, expected a multiple of ${B}`),new p([])):q}function g(q,k,p,z,C){if(!q)return q;if(q instanceof k)return e(q,z,k,C);for(const B of p)if(q instanceof B)return e(new k(q),z,k,C);if(Array.isArray(q))return e(new k(q),z,k,C);p=p.map(B=>`'${B.name}'`);C.error(`Failed to set property, expected one of ${p}, but got ${q.constructor.name}`);return new k([])}function h(q,k,
p){const z=Array(q.length);for(let C=0;C<q.length;C++)z[C]=q[C];k[p]=z}var l;const v=r.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=l=function(q){function k(z){z=q.call(this,z)||this;z.color=null;z.position=new Float64Array(0);z.uv=null;z.normal=null;z.tangent=null;return z}c._inheritsLoose(k,q);var p=k.prototype;p.castColor=function(z){return g(z,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},v)};p.castPosition=function(z){z&&z instanceof Float32Array&&
v.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");return g(z,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},v)};p.castUv=function(z){return g(z,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},v)};p.castNormal=function(z){return g(z,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},v)};p.castTangent=function(z){return g(z,Float32Array,[Float64Array],
{loggerTag:".tangent\x3d",stride:4},v)};p.clone=function(){const z={position:n.clone(this.position),uv:n.clone(this.uv),normal:n.clone(this.normal),tangent:n.clone(this.tangent),color:n.clone(this.color)};return new l(z)};p.clonePositional=function(){const z={position:n.clone(this.position),normal:n.clone(this.normal),tangent:n.clone(this.tangent),uv:this.uv,color:this.color};return new l(z)};return k}(t.JSONSupport);b.__decorate([m.property({json:{write:h}})],a.MeshVertexAttributes.prototype,"color",
void 0);b.__decorate([d.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);b.__decorate([m.property({nonNullable:!0,json:{write:h}})],a.MeshVertexAttributes.prototype,"position",void 0);b.__decorate([d.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);b.__decorate([m.property({json:{write:h}})],a.MeshVertexAttributes.prototype,"uv",void 0);b.__decorate([d.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);b.__decorate([m.property({json:{write:h}})],a.MeshVertexAttributes.prototype,
"normal",void 0);b.__decorate([d.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);b.__decorate([m.property({json:{write:h}})],a.MeshVertexAttributes.prototype,"tangent",void 0);b.__decorate([d.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=l=b.__decorate([f.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../spatialReferenceEllipsoidUtils ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(y,w,D,F,E,K){if(w){var J=D.count,M=e.getSphericalPCPF(E);if(p(E))for(D=0;D<J;D++)F.getVec(D,B),w.getVec(D,A),f.computeTranslationToOriginAndRotation(M,B,x,M),t.fromMat4(u,x),y===C.FROM_PCPF&&t.transpose(u,u),m.transformMat3(A,A,u),K.setVec(D,A);else for(E=0;E<J;E++){F.getVec(E,B);w.getVec(E,A);f.computeTranslationToOriginAndRotation(M,B,x,M);t.fromMat4(u,x);var N=h.y2lat(D.get(E,1));N=Math.cos(N);y===C.TO_PCPF&&(N=1/N);u[0]*=N;u[1]*=N;u[2]*=N;u[3]*=
N;u[4]*=N;u[5]*=N;y===C.FROM_PCPF&&t.transpose(u,u);m.transformMat3(A,A,u);m.normalize(A,A);K.setVec(E,A)}return K}}function k(y){return p(y)||y.isWebMercator}function p(y){return y.isWGS84||g.isCGCS2000(y)||g.isMars(y)||g.isMoon(y)}const z=c.getLogger("esri.geometry.support.meshUtils.normalProjection");var C;(function(y){y[y.TO_PCPF=0]="TO_PCPF";y[y.FROM_PCPF=1]="FROM_PCPF"})(C||(C={}));const B=d.create(),A=d.create(),x=r.create(),u=n.create();a.projectFromPCPF=function(y,w,D){f.projectBuffer(y,
e.getSphericalPCPF(D),0,w,D,0,y.length/3);return w};a.projectNormalFromPCPF=function(y,w,D,F,E){if(!k(F))return z.error("Cannot convert to spatial reference from PCPF"),E;q(C.FROM_PCPF,l.BufferViewVec3f.fromTypedArray(y),l.BufferViewVec3f64.fromTypedArray(w),l.BufferViewVec3f64.fromTypedArray(D),F,l.BufferViewVec3f.fromTypedArray(E));return E};a.projectNormalToPCPF=function(y,w,D,F,E){if(!k(F))return z.error("Cannot convert spatial reference to PCPF"),E;q(C.TO_PCPF,l.BufferViewVec3f.fromTypedArray(y),
l.BufferViewVec3f64.fromTypedArray(w),l.BufferViewVec3f64.fromTypedArray(D),F,l.BufferViewVec3f.fromTypedArray(E));return E};a.projectTangentFromPCPF=function(y,w,D,F,E){if(!k(F))return z.error("Cannot convert to spatial reference from PCPF"),E;q(C.FROM_PCPF,l.BufferViewVec3f.fromTypedArray(y,16),l.BufferViewVec3f64.fromTypedArray(w),l.BufferViewVec3f64.fromTypedArray(D),F,l.BufferViewVec3f.fromTypedArray(E,16));for(w=3;w<y.length;w+=4)E[w]=y[w];return E};a.projectTangentToPCPF=function(y,w,D,F,E){if(!k(F))return z.error("Cannot convert spatial reference to PCPF"),
E;q(C.TO_PCPF,l.BufferViewVec3f.fromTypedArray(y,4*Float32Array.BYTES_PER_ELEMENT),l.BufferViewVec3f64.fromTypedArray(w),l.BufferViewVec3f64.fromTypedArray(D),F,l.BufferViewVec3f.fromTypedArray(E,4*Float32Array.BYTES_PER_ELEMENT));for(w=3;w<y.length;w+=4)E[w]=y[w];return E};a.projectToPCPF=function(y,w,D){f.projectBuffer(y,w,0,D,e.getSphericalPCPF(w),0,y.length/3);return D};a.transformNormal=function(y,w,D){if(b.isNone(y))return w;t.normalFromMat4(u,D);y=l.BufferViewVec3f.fromTypedArray(y);D=l.BufferViewVec3f.fromTypedArray(w);
v.transformMat3(D,y,u);t.isOrthoNormal(u)||v.normalize(D,D);return w};a.transformPosition=function(y,w,D){if(b.isNone(y))return w;y=l.BufferViewVec3f64.fromTypedArray(y);const F=l.BufferViewVec3f64.fromTypedArray(w);v.transformMat4(F,y,D);return w};a.transformTangent=function(y,w,D){if(b.isNone(y))return w;t.normalFromMat4(u,D);D=l.BufferViewVec3f.fromTypedArray(y,4*Float32Array.BYTES_PER_ELEMENT);const F=l.BufferViewVec3f.fromTypedArray(w,4*Float32Array.BYTES_PER_ELEMENT);v.transformMat3(F,D,u);
t.isOrthoNormal(u)||v.normalize(F,F);if(y!==w)for(D=3;D<y.length;D+=4)w[D]=y[D];return w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/resourceUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../webgl-engine/lib/basicInterfaces"],function(a,c,b){function t(){t=c._asyncToGenerator(function*(m){return new Promise((d,f)=>{const e=new Blob([m]),g=new FileReader;g.onload=()=>{d(JSON.parse(g.result))};g.onerror=h=>{f(h)};
g.readAsText(e)})});return t.apply(this,arguments)}function n(){n=c._asyncToGenerator(function*(m,d){return d===b.TextureEncodingMimeType.KTX2_ENCODING?new r(m):new Promise((f,e)=>{const g=new Blob([m],{type:d}),h=URL.createObjectURL(g),l=new Image,v=()=>{URL.revokeObjectURL(h);"decode"in l?l.decode().then(()=>f(l),()=>f(l)).then(k):(f(l),k())},q=p=>{URL.revokeObjectURL(h);e(p);k()},k=()=>{l.removeEventListener("load",v);l.removeEventListener("error",q)};l.addEventListener("load",v);l.addEventListener("error",
q);l.src=h})});return n.apply(this,arguments)}let r=function(m){this.data=m;this.type="encoded-mesh-texture";this.encoding=b.TextureEncodingMimeType.KTX2_ENCODING};a.EncodedMeshTexture=r;a.imageFromBinaryData=function(m,d){return n.apply(this,arguments)};a.isEncodedMeshTexture=function(m){return"encoded-mesh-texture"===m?.type};a.jsonFromBinaryData=function(m){return t.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/TextureTransformUtils":function(){define(["exports",
"../../../../core/maybe","../../../../chunks/mat3f32","../../../../chunks/vec2f32","../../../../chunks/mat3"],function(a,c,b,t,n){a.getTransformMatrix=function(r){if(c.isNone(r))return null;var m=c.isSome(r.offset)?r.offset:t.ZEROS,d=c.isSome(r.rotation)?r.rotation:0;r=c.isSome(r.scale)?r.scale:t.ONES;m=b.fromValues(1,0,0,0,1,0,m[0],m[1],1);d=b.fromValues(Math.cos(d),-Math.sin(d),0,Math.sin(d),Math.cos(d),0,0,0,1);r=b.fromValues(r[0],0,0,0,r[1],0,0,0,1);const f=b.create();n.multiply(f,d,r);n.multiply(f,
m,f);return f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./DefaultLayouts ./internal/bufferWriterUtils ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w){var D;(function(Y){Y[Y.START=0]="START";Y[Y.END=1]="END"})(D||(D={}));let F=function(Y){function ba(ea){ea=Y.call(this,ea,new J)||this;ea._configuration=new w.NativeLineTechniqueConfiguration;return ea}c._inheritsLoose(ba,Y);var da=ba.prototype;da.getConfiguration=function(ea,ca){this._configuration.output=ea;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.hasVertexColors=this.parameters.hasVertexColors;
this._configuration.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._configuration.draped=ca.slot===z.RenderSlot.DRAPED_MATERIAL;ea=n.isSome(this.parameters.stipplePattern);this._configuration.stippleEnabled=ea;this._configuration.stippleOffColorEnabled=ea&&n.isSome(this.parameters.stippleOffColor);this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.stipplePreferContinuous=this.parameters.stipplePreferContinuous;return this._configuration};da.intersect=
function(ea,ca,ja,ia,Z,ha){if(ja.options.selectionMode&&ea.visible)if(C.isTranslationMatrix(ca)){Z=ea.vertexAttributes.get(B.VertexAttribute.POSITION).data;var fa=ja.camera,ka=Q;m.copy(ka,ja.point);d.set(V[0],ka[0]-2,ka[1]+2,0);d.set(V[1],ka[0]+2,ka[1]+2,0);d.set(V[2],ka[0]+2,ka[1]-2,0);d.set(V[3],ka[0]-2,ka[1]-2,0);for(ea=0;4>ea;ea++)if(!fa.unprojectFromRenderScreen(V[ea],aa[ea]))return;l.fromPoints(fa.eye,aa[0],aa[1],X);l.fromPoints(fa.eye,aa[1],aa[2],W);l.fromPoints(fa.eye,aa[2],aa[3],T);l.fromPoints(fa.eye,
aa[3],aa[0],U);ia=Number.MAX_VALUE;ea=0;for(let na=0;na<Z.length-5;na+=3)if(M[0]=Z[na]+ca[12],M[1]=Z[na+1]+ca[13],M[2]=Z[na+2]+ca[14],N[0]=Z[na+3]+ca[12],N[1]=Z[na+4]+ca[13],N[2]=Z[na+5]+ca[14],!(0>l.signedDistance(X,M)&&0>l.signedDistance(X,N)||0>l.signedDistance(W,M)&&0>l.signedDistance(W,N)||0>l.signedDistance(T,M)&&0>l.signedDistance(T,N)||0>l.signedDistance(U,M)&&0>l.signedDistance(U,N))){fa.projectToRenderScreen(M,G);fa.projectToRenderScreen(N,H);if(0>G[2]&&0<H[2]){d.subtract(P,M,N);var la=
fa.frustum;la=-l.signedDistance(la[g.PlaneIndex.NEAR],M)/d.dot(P,l.normal(la[g.PlaneIndex.NEAR]));d.scale(P,P,la);d.add(M,M,P);fa.projectToRenderScreen(M,G)}else if(0<G[2]&&0>H[2])d.subtract(P,N,M),la=fa.frustum,la=-l.signedDistance(la[g.PlaneIndex.NEAR],N)/d.dot(P,l.normal(la[g.PlaneIndex.NEAR])),d.scale(P,P,la),d.add(N,N,P),fa.projectToRenderScreen(N,H);else if(0>G[2]&&0>H[2])continue;G[2]=0;H[2]=0;la=h.distance2(h.fromPoints(G,H,S),ka);la<ia&&(ia=la,d.copy(L,M),d.copy(O,N),ea=na/3)}ca=ja.rayBegin;
ja=ja.rayEnd;4>ia&&(ia=Number.MAX_VALUE,h.closestLineSegmentPoint(h.fromPoints(L,O,S),h.fromPoints(ca,ja,R),I)&&(d.subtract(I,I,ca),ia=d.length(I),d.scale(I,I,1/ia),ia/=d.distance(ca,ja)),ha(ia,I,ea,!1))}else b.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial").error("intersection assumes a translation-only matrix")};da.intersectDraped=function(ea,ca,ja,ia,Z,ha){if(ja.options.selectionMode){ca=ea.vertexAttributes.get(B.VertexAttribute.POSITION).data;var fa=ea.vertexAttributes.get(B.VertexAttribute.SIZE);
ja=ia[0];ia=ia[1];ea=(((fa?fa.data[0]:0)+1)/2+4)*ea.screenToWorldRatio;fa=Number.MAX_VALUE;var ka=0;for(let wa=0;wa<ca.length-5;wa+=3){var la=ca[wa],na=ca[wa+1],pa=ja-la,va=ia-na;la=ca[wa+3]-la;na=ca[wa+4]-na;const za=t.clamp((la*pa+na*va)/(la*la+na*na),0,1);pa=la*za-pa;va=na*za-va;va=pa*pa+va*va;va<fa&&(fa=va,ka=wa/3)}fa<ea*ea&&Z(ha.dist,ha.normal,ka,!1)}};da.requiresSlot=function(ea,ca){return(ca===q.ShaderOutput.Color||ca===q.ShaderOutput.Highlight||ca===q.ShaderOutput.ObjectAndLayerIdColor)&&
(ea===z.RenderSlot.OPAQUE_MATERIAL||ea===z.RenderSlot.DRAPED_MATERIAL)};da.createGLMaterial=function(ea){return new E(ea)};da.createBufferWriter=function(){const ea=this.parameters.hasVertexColors?x.PositionColorLayout:x.PositionLayout;return n.isNone(this.parameters.stipplePattern)?new A.DefaultBufferWriter(ea):new K(ea.clone().vec3f(B.VertexAttribute.AUXPOS1).vec2f(B.VertexAttribute.UV0))};return ba}(p.Material),E=function(Y){function ba(){var ea=Y.apply(this,arguments)||this;ea._stipplePattern=
null;return ea}c._inheritsLoose(ba,Y);var da=ba.prototype;da.dispose=function(){Y.prototype.dispose.call(this);this._stippleTextureRepository.release(this._stipplePattern);this._stipplePattern=null};da._updateOccludeeState=function(ea){ea.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:ea.hasOccludees})};da.beginSlot=function(ea){this._output===q.ShaderOutput.Color&&this._updateOccludeeState(ea);const ca=this._material.parameters.stipplePattern;this._stipplePattern!==
ca&&(this._material.setParameters(this._stippleTextureRepository.swap(this._stipplePattern,ca)),this._stipplePattern=ca);return this.ensureTechnique(y.NativeLineTechnique,ea)};return ba}(k),K=function(){function Y(da){this.vertexBufferLayout=da}var ba=Y.prototype;ba.allocate=function(da){return this.vertexBufferLayout.createBuffer(da)};ba.elementCount=function(da){return da.indices.get(B.VertexAttribute.POSITION).length};ba.write=function(da,ea,ca,ja,ia){u.writeDefaultAttributes(ca,this.vertexBufferLayout,
da,ea,ja,ia);this._writeAuxpos1(da,ca,ja,ia);this._writeUV0(da,ca,ja,ia)};ba._writeAuxpos1=function(da,ea,ca,ja){var ia=ca.getField(B.VertexAttribute.AUXPOS1,v.BufferViewVec3f);ca=ea.indices.get(B.VertexAttribute.POSITION);ea=ea.vertexAttributes.get(B.VertexAttribute.POSITION).data;const Z=ia.typedBufferStride;ia=ia.typedBuffer;ja*=Z;for(let fa=0;fa<ca.length-1;fa+=2)for(const ka of[1,0]){var ha=3*ca[fa+ka];const la=ea[ha],na=ea[ha+1];ha=ea[ha+2];const pa=da[1]*la+da[5]*na+da[9]*ha+da[13],va=da[2]*
la+da[6]*na+da[10]*ha+da[14];ia[ja]=da[0]*la+da[4]*na+da[8]*ha+da[12];ia[ja+1]=pa;ia[ja+2]=va;ja+=Z}};ba._writeUV0=function(da,ea,ca,ja){var ia=ca.getField(B.VertexAttribute.UV0,v.BufferViewVec2f),Z=ea.indices.get(B.VertexAttribute.POSITION);ca=ea.vertexAttributes.get(B.VertexAttribute.POSITION).data;const ha=ea.vertexAttributes.get(B.VertexAttribute.DISTANCETOSTART)?.data;ea=ia.typedBufferStride;ia=ia.typedBuffer;ja*=ea;let fa=0;ia[ja]=D.START;ia[ja+1]=fa;ja+=ea;var ka=3*Z[0];ka=d.set(M,ca[ka],ca[ka+
1],ca[ka+2]);da&&d.transformMat4(ka,ka,da);const la=N,na=Z.length-1;let pa=1;const va=ha?(za,sa,ua)=>fa=ha[ua]:(za,sa,ua)=>fa+=d.distance(za,sa);for(let za=1;za<na;za+=2){var wa=3*Z[za];d.set(la,ca[wa],ca[wa+1],ca[wa+2]);da&&d.transformMat4(la,la,da);va(ka,la,pa++);for(wa=0;2>wa;++wa)ia[ja]=1-wa,ia[ja+1]=fa,ja+=ea;d.copy(ka,la)}Z=3*Z[na];d.set(la,ca[Z],ca[Z+1],ca[Z+2]);da&&d.transformMat4(la,la,da);va(ka,la,pa);ia[ja]=D.END;ia[ja+1]=fa};return Y}(),J=function(Y){function ba(){var da=Y.apply(this,
arguments)||this;da.color=e.ONES;da.hasVertexColors=!1;da.hasSlicePlane=!1;da.width=1;da.stipplePreferContinuous=!0;da.hasOccludees=!1;da.stippleTexture=null;return da}c._inheritsLoose(ba,Y);return ba}(p.MaterialParameters);const M=f.create(),N=f.create(),P=f.create(),I=f.create(),G=r.createRenderScreenPointArray3(),H=r.createRenderScreenPointArray3(),L=f.create(),O=f.create(),S=h.create(),R=h.create(),Q=f.create(),V=[r.createRenderScreenPointArray3(),r.createRenderScreenPointArray3(),r.createRenderScreenPointArray3(),
r.createRenderScreenPointArray3()],aa=[f.create(),f.create(),f.create(),f.create()],X=l.create(),W=l.create(),T=l.create(),U=l.create();a.NativeLineMaterial=F;a.Parameters=J;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){r=function(v){function q(){return v.apply(this,arguments)||this}b._inheritsLoose(q,v);var k=q.prototype;k.initializeConfiguration=function(p,z){z.hasWebGL2Context=p.rctx.type===g.ContextType.WEBGL2};k.initializeProgram=function(p){return new d.Program(p.rctx,q.shader.get().build(this.configuration),m.Default3D)};k.initializePipeline=function(){const p=this.configuration,z=l.separateBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,
h.BlendFactor.ONE_MINUS_SRC_ALPHA),C=(B,A=null,x=null)=>l.makePipelineState({blending:A,depthTest:f.depthCompareLess,depthWrite:x,colorWrite:l.defaultColorWriteParams,stencilWrite:p.hasOccludees?f.stencilWriteMaskOn:null,stencilTest:p.hasOccludees?B?f.stencilToolMaskBaseParams:f.stencilBaseAllZerosParams:null});return p.output===t.ShaderOutput.Color?(this._occludeePipelineState=C(!0,p.transparent||this._stippleEnabled?z:null,l.defaultDepthWriteParams),C(!1,p.transparent||this._stippleEnabled?z:null,
l.defaultDepthWriteParams)):C(!1)};k.getPipelineState=function(p,z){return z?this._occludeePipelineState:v.prototype.getPipelineState.call(this,p,z)};b._createClass(q,[{key:"_stippleEnabled",get:function(){return this.configuration.stippleEnabled&&this.configuration.output!==t.ShaderOutput.Highlight}},{key:"primitiveType",get:function(){return h.PrimitiveType.LINES}}]);return q}(r.ShaderTechnique);r.shader=new n.ReloadableShaderModule(e.NativeLine,()=>new Promise((v,q)=>a(["./NativeLine.glsl"],v,
q)));c.NativeLineTechnique=r;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(p){const z=new l.ShaderBuilder,{vertex:C,fragment:B}=z;z.include(t.Transform,p);z.include(n.VertexColor,p);z.include(m.LineStipple,p);f.addProjViewLocalOrigin(C,p);p.stippleEnabled&&(z.attributes.add(v.VertexAttribute.UV0,"vec2"),z.attributes.add(v.VertexAttribute.AUXPOS1,"vec3"),C.uniforms.add(new e.Float4PassUniform("viewport",(A,x)=>x.camera.fullViewport)));z.attributes.add(v.VertexAttribute.POSITION,"vec3");z.varyings.add("vpos","vec3");C.code.add(h.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`);p.stippleEnabled&&(C.code.add(h.glsl`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),p.draped?C.uniforms.add(new g.FloatPassUniform("worldToScreenRatio",(A,x)=>1/x.screenToPCSRatio)):C.code.add(h.glsl`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),C.code.add(h.glsl`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),p.draped?C.code.add(h.glsl`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):C.code.add(h.glsl`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),C.uniforms.add(new g.FloatPassUniform("stipplePatternPixelSize",A=>m.computePixelSize(A))),C.code.add(h.glsl`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`));C.code.add(h.glsl`}`);p.output===c.ShaderOutput.Highlight&&z.include(r.OutputHighlight,p);z.include(b.SliceDraw,p);B.uniforms.add(new g.FloatPassUniform("alphaCoverage",(A,x)=>Math.min(1,A.width*x.camera.pixelRatio)));p.hasVertexColors||B.uniforms.add(new e.Float4PassUniform("constantColor",A=>A.color));B.code.add(h.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${p.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    ${p.output===c.ShaderOutput.ObjectAndLayerIdColor?h.glsl`finalColor.a = 1.0;`:""}

    if (finalColor.a < ${h.glsl.float(d.symbolAlphaCutoff)}) {
      discard;
    }

    ${p.output===c.ShaderOutput.Color?h.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${p.output===c.ShaderOutput.Highlight?h.glsl`outputHighlight();`:""}
  }
  `);return z}const k=Object.freeze(Object.defineProperty({__proto__:null,build:q},Symbol.toStringTag,{value:"Module"}));a.NativeLine=k;a.build=q})},"esri/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),function(a,c,b,t,n,r){r=function(m){function d(){var f=
m.apply(this,arguments)||this;f.output=t.ShaderOutput.Color;f.hasSlicePlane=!1;f.hasVertexColors=!1;f.transparent=!1;f.draped=!1;f.stippleEnabled=!1;f.stippleOffColorEnabled=!1;f.stipplePreferContinuous=!0;f.hasOccludees=!1;return f}c._inheritsLoose(d,m);return d}(r.DefaultTechniqueConfiguration);b.__decorate([n.parameter({count:t.ShaderOutput.COUNT})],r.prototype,"output",void 0);b.__decorate([n.parameter()],r.prototype,"hasSlicePlane",void 0);b.__decorate([n.parameter()],r.prototype,"hasVertexColors",
void 0);b.__decorate([n.parameter()],r.prototype,"transparent",void 0);b.__decorate([n.parameter()],r.prototype,"draped",void 0);b.__decorate([n.parameter()],r.prototype,"stippleEnabled",void 0);b.__decorate([n.parameter()],r.prototype,"stippleOffColorEnabled",void 0);b.__decorate([n.parameter()],r.prototype,"stipplePreferContinuous",void 0);b.__decorate([n.parameter()],r.prototype,"hasOccludees",void 0);b.__decorate([n.parameter({constValue:!1})],r.prototype,"stippleRequiresClamp",void 0);b.__decorate([n.parameter({constValue:!1})],
r.prototype,"stippleScaleWithLineWidth",void 0);b.__decorate([n.parameter({constValue:!1})],r.prototype,"stippleRequiresStretchMeasure",void 0);a.NativeLineTechniqueConfiguration=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G){let H=function(V,aa,X,W,T,U,Y,ba,da,ea,ca,ja){this.lodResources=V;this.lodRenderer=aa;this.stageResources=X;this.originalMaterialParameters=W;this.resourceSize=T;this.isEsriSymbolResource=U;this.isWosr=Y;this.resourceBoundingBox=ba;this.symbolSize=da;this.extentPadding=ea;this.physicalBasedRenderingEnabled=ca;this.pivotOffset=ja};A=function(V){function aa(W,T,U,Y){W=V.call(this,W,T,U,Y)||this;W._resources=null;W._optionalFields=
[];W._instanceIndexToGraphicUid=new Map;W._hasLoadedPBRTextures=!1;W._disposeResourceHandles=[];W.ensureDrapedStatus(!1);W._hasLoadedPBRTextures=U.physicalBasedRenderingEnabled;return W}c._inheritsLoose(aa,V);var X=aa.prototype;X.getCachedSize=function(){const [W,T,U]=n.isSome(this._resources)?this._resources.symbolSize:[1,1,1];return{width:W,depth:T,height:U}};X.doLoad=function(){var W=c._asyncToGenerator(function*(T){if(!this._drivenProperties.size&&x.validateSymbolLayerSize(this.symbolLayer))throw Error();
const U=this.symbolLayer;this._resources=this._isPrimitive?yield this._createResourcesForPrimitive(U.resource?U.resource.primitive:q.defaultPrimitive,T):yield this._createResourcesForUrl(U.resource.href,T);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=this.computeComplexity()});return function(T){return W.apply(this,arguments)}}();X._setMaterialTransparencyParams=function(W,T=n.get(this.symbolLayer,"material","color")){T=this._getCombinedOpacity(T);
const U=1>T||this.needsDrivenTransparentPass;W.transparent=U;W.opacity=T;W.cullFace=U?M.CullFaceOptions.None:M.CullFaceOptions.Back;return W};X._createResourcesForPrimitive=function(){var W=c._asyncToGenerator(function*(T,U){if(!E.isValidPrimitive(T))throw Error(`Unknown object symbol primitive: ${T}`);var Y=this.symbolLayer;const ba=v.create(k.objectSymbolLayerPrimitiveBoundingBox(T)),da=g.fromArray(v.size(ba)),ea=g.fromArray(k.objectSymbolLayerSizeWithResourceSize(da,Y)),ca=e.length(ea);var ja=
{usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:g.ONES,diffuse:g.ONES,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const ia=!!ja.usePBR;this._setMaterialTransparencyParams(ja);const Z=this.symbol;if("point-3d"===Z.type&&Z.verticalOffset){const {screenLength:ha,minWorldLength:fa,maxWorldLength:ka}=Z.verticalOffset;ja.verticalOffset={screenLength:m.pt2px(ha),
minWorldLength:fa||0,maxWorldLength:n.isSome(ka)?ka:Infinity};ja.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ja.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ja.externalColor=h.ONES:(Y=n.isSome(Y.material)?Y.material.color:null,Y=n.isSome(Y)?b.toUnitRGBA(Y):h.ONES,ja.externalColor=Y);this._fastUpdates=J.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(ba,ea,da,n.none));ja.instanced=
["transformation"];this._fastUpdates.enabled?(Object.assign(ja,this._fastUpdates.materialParameters),ja.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(ja.instanced.push("color"),this._optionalFields.push("color"));t("enable-feature:objectAndLayerId-rendering")&&(ja.instanced.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));ja=new G.DefaultMaterial(ja);ja=E.primitiveLodResources(T,ja);if(!ja)throw Error(`Unknown object symbol primitive: ${T}`);
T=I.materialsFromLodResources(ja).map(ha=>({opacity:1,transparent:ha.parameters.transparent}));Y=yield this._createStageResources(ja,ia,U);U=yield this._createLodRenderer(ja,U);return new H(ja,U,Y,T,da,!1,!1,ba,ea,ca,ia,n.none)});return function(T,U){return W.apply(this,arguments)}}();X._createResourcesForUrl=function(){var W=c._asyncToGenerator(function*(T,U){var Y=["transformation"],ba={materialParamsMixin:{instanced:Y,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},
streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=J.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(n.none,n.none,n.none,n.none));this._fastUpdates.enabled?(Object.assign(ba.materialParamsMixin,this._fastUpdates.materialParameters),Y.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(Y.push("color"),this._optionalFields.push("color"));
t("enable-feature:objectAndLayerId-rendering")&&(Y.push("objectAndLayerIdColor"),this._optionalFields.push("objectAndLayerIdColor"));Y=this.symbol;if("point-3d"===Y.type&&Y.verticalOffset){const {screenLength:va,minWorldLength:wa,maxWorldLength:za}=Y.verticalOffset;ba.materialParamsMixin.verticalOffset={screenLength:m.pt2px(va),minWorldLength:wa||0,maxWorldLength:n.isSome(za)?za:Infinity};ba.materialParamsMixin.castShadows=!1}ba.signal=U;ba.usePBR=this._context.physicalBasedRenderingEnabled;ba.skipHighLods=
this._context.skipHighSymbolLods;Y=ba.usePBR;var da=yield D.fetch(T,ba);T=da.isEsriSymbolResource;ba=da.isWosr;const ea=w.makeLodResources(da.lods);ea.levels.sort((va,wa)=>va.minScreenSpaceRadius-wa.minScreenSpaceRadius);const ca=this._context,ja=this._getExternalColorParameters(this.symbolLayer.material);var ia=n.get(this.symbolLayer,"material","color");const Z=this._getCombinedOpacity(ia,{hasIntrinsicColor:!0}),ha=this.needsDrivenTransparentPass;var fa=I.materialsFromLodResources(ea);ia=I.materialsFromLodResources(ea).map(va=>
({opacity:va.parameters.opacity||1,transparent:va.parameters.transparent}));fa.forEach(va=>{const wa=va.parameters;va.setParameters(ja);const za=wa.opacity*Z;va.setParameters({opacity:za,transparent:1>za||ha||wa.transparent});ca.screenSizePerspectiveEnabled&&va.setParameters({screenSizePerspective:ca.sharedResources.screenSizePerspectiveSettings})});da=da.referenceBoundingBox;const ka=g.fromArray(v.size(da)),la=g.fromArray(ea.levels[0].pivotOffset),na=g.fromArray(k.objectSymbolLayerSizeWithResourceSize(ka,
this.symbolLayer)),pa=e.length(na);J.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(da,na,ka,la))&&fa.forEach(va=>va.setParameters(this._fastUpdates.materialParameters));fa=yield this._createStageResources(ea,Y,U);U=yield this._createLodRenderer(ea,U);return new H(ea,U,fa,ia,ka,T,ba,da,na,pa,Y,la)});return function(T,U){return W.apply(this,arguments)}}();X._addDisposeResource=function(W){this._disposeResourceHandles.push(W)};X._createStageResources=
function(){var W=c._asyncToGenerator(function*(T,U,Y){const ba=this._context.stage,da=I.materialsFromLodResources(T);U!==this._context.physicalBasedRenderingEnabled&&this.physicalBasedRenderingChanged();ba.addMany(da);this._addDisposeResource(()=>ba.removeMany(da));const ea=I.texturesFromLodResources(T);ba.addMany(ea);this._addDisposeResource(()=>ba.removeMany(ea));yield ba.load(ea,Y);r.throwIfAborted(Y);const ca=I.geometriesFromLodResources(T);ba.addMany(ca);this._addDisposeResource(()=>ba.removeMany(ca));
return{materials:da,textures:ea,geometries:ca}});return function(T,U,Y){return W.apply(this,arguments)}}();X._createLodRenderer=function(){var W=c._asyncToGenerator(function*(T,U){const Y=this._context.stage,ba=new P.LodRenderer({symbol:T,optionalFields:this._optionalFields,metadata:{layerUid:this._context.layer.uid,graphicUid:da=>this._instanceIndexToGraphicUid.get(da),notifyGraphicGeometryChanged:da=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(da)),notifyGraphicVisibilityChanged:da=>
this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(da))},shaderTransformation:this._fastUpdates.enabled?{applyTransform:(da,ea,ca)=>{da.getFeatureAttribute(ea,R);d.copy(ca,J.evaluateModelTransform(this._fastUpdates.materialParameters,R,ca))},scaleFactor:(da,ea,ca)=>{ea.getFeatureAttribute(ca,R);return J.evaluateModelTransformScale(da,this._fastUpdates.materialParameters,R)}}:null},this._context.scheduler);ba.slicePlaneEnabled=this._context.slicePlaneEnabled;this._addDisposeResource(()=>
{Y.removeRenderPlugin(ba);ba.destroy()});yield Y.addRenderPlugin(ba.slots,ba,U);return ba});return function(T,U){return W.apply(this,arguments)}}();X._getExternalColorParameters=function(W){const T={};this._drivenProperties.color?T.externalColor=h.ONES:n.isSome(W)&&n.isSome(W.color)?T.externalColor=b.toUnitRGBA(W.color):(T.externalColor=h.ONES,T.colorMixMode="ignore");return T};X.destroy=function(){V.prototype.destroy.call(this);this._cleanupResources()};X._cleanupResources=function(){this._disposeResourceHandles.forEach(W=>
W());this._disposeResourceHandles.length=0;this._resources=null};X.createGraphics3DGraphic=function(W){const T=W.graphic;if(!this._validateGeometry(T.geometry))return null;const U=F.placePointOnGeometry(T.geometry);if(n.isNone(U))return this.logger.warn(`unsupported geometry type for icon symbol: ${T.geometry.type}`),null;const Y=this.setGraphicElevationContext(T,new C.ElevationContext);return this._createAs3DShape(T,U,W.renderingInfo,Y,T.uid,W.layer.uid)};X.notifyDestroyGraphicLayer=function(W){this._instanceIndexToGraphicUid.delete(W.instanceIndex)};
X.graphicLayerToGraphicId=function(){return 0};X.layerOpacityChanged=function(){if(!n.isNone(this._resources)){var W=this._drivenProperties.opacity,T=!this._isPrimitive,U=this._resources.stageResources.materials,Y=this._resources.originalMaterialParameters;for(let ea=0;ea<U.length;ea++){const ca=U[ea];var ba=n.get(this.symbolLayer,"material","color"),da=Y[ea];ba=this._getCombinedOpacity(ba,{hasIntrinsicColor:T})*da.opacity;da=1>ba||W||da.transparent;ca.setParameters({opacity:ba,transparent:da});this._isPrimitive&&
ca.setParameters({cullFace:da?M.CullFaceOptions.None:M.CullFaceOptions.Back})}}};X.layerElevationInfoChanged=function(W,T){return this.updateGraphics3DGraphicElevationInfo(W,T,z.needsElevationUpdates3D)};X.slicePlaneEnabledChanged=function(){if(n.isNone(this._resources))return!0;this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const W of this._resources.stageResources.materials)W.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};X.physicalBasedRenderingChanged=
function(){if(n.isNone(this._resources))return!0;const {stageResources:W,isWosr:T}=this._resources;for(const U of W.materials)this._isPrimitive?U.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):T||U.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!1});return!1===this._hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this._hasLoadedPBRTextures=!0,!1):!0};X.pixelRatioChanged=function(){return!0};X.skipHighSymbolLodsChanged=
function(){return!1};X.applyRendererDiff=function(W,T){if(n.isNone(this._resources))return u.ApplyRendererDiffResult.Recreate_Symbol;const {stageResources:{materials:U},lodRenderer:Y,resourceBoundingBox:ba,symbolSize:da,resourceSize:ea,pivotOffset:ca}=this._resources;for(const ja in W.diff)switch(ja){case "visualVariables":if(J.updateFastSymbolUpdatesState(this._fastUpdates,T,this._fastVisualVariableConvertOptions(ba,da,ea,ca))){for(const ia of U)ia.setParameters(this._fastUpdates.materialParameters);
Y.notifyShaderTransformationChanged()}else return u.ApplyRendererDiffResult.Recreate_Symbol;break;default:return u.ApplyRendererDiffResult.Recreate_Symbol}return u.ApplyRendererDiffResult.Fast_Update};X.computeComplexity=function(){if(n.isNone(this._resources))return V.prototype.computeComplexity.call(this);var W=this._resources.lodResources;const T=I.geometriesFromLodLevelResources(W.levels[0]).reduce((ba,da)=>ba+da.indices.get(N.VertexAttribute.POSITION).length,0)/3,U=ba=>Array.from(ba.vertexAttributes.values()).reduce((da,
ea)=>da+(ea.data.buffer?.byteLength??0),0)+Array.from(ba.indices.values()).reduce((da,ea)=>da+(Array.isArray(ea)?12*ea.length:ea.buffer.byteLength),0);var Y=I.texturesFromLodResources(W).reduce((ba,da)=>ba+(da.params.encoding&&"image/ktx2"===da.params.encoding?da.estimatedTexMemRequired:da.estimatedTexMemRequired/4),0);W=I.geometriesFromLodResources(W).reduce((ba,da)=>ba+U(da),0);Y+=W;Y={...K.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer),resourceBytes:Y};return{primitivesPerFeature:T,
primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:Y}};X._hasLodRenderer=function(){return n.isSome(this._resources)};X._createAs3DShape=function(W,T,U,Y,ba,da){if(!this._hasLodRenderer()||n.isNone(this._resources))return null;W=this.getFastUpdateAttrValues(W);const ea=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?x.mixinColorAndOpacity(U.color,U.opacity):null;var ca=this._context.clippingExtent;l.projectPointToVector(T,L,this._context.elevationProvider.spatialReference);
if(n.isSome(ca)&&!v.containsPoint(ca,L))return null;ca=this._requiresTerrainElevation(Y);const ja=this._computeGlobalTransform(T,Y,S,Q);U=this._computeLocalTransform(this._resources,this.symbolLayer,U,O);const ia=this._resources.lodRenderer.instanceData,Z=ia.addInstance();this._instanceIndexToGraphicUid.set(Z,ba);ia.setLocalTransform(Z,U,!1);ia.setGlobalTransform(Z,ja);W&&ia.setFeatureAttribute(Z,W);ea&&ia.setColor(Z,ea);n.isSome(this._context.stage.renderView.objectAndLayerIdRenderHelper)&&ia.setObjectAndLayerIdColor(Z,
this._context.stage.renderView.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor({graphicUid:ba,layerUid:da}));ba=new B(this,Z,p.perLodInstanceElevationAligner,Y);ca&&(ba.alignedSampledElevation=Q.sampledElevation);ba.needsElevationUpdates=z.needsElevationUpdates3D(Y.mode);F.extendPointGraphicElevationContext(ba,T,this._context.elevationProvider);return ba};X._computeGlobalTransform=function(W,T,U,Y){z.evaluateElevationInfoAtPoint(W,this._context.elevationProvider,T,this._context.renderCoordsHelper,
Y);L[0]=W.x;L[1]=W.y;L[2]=Y.z;l.computeTranslationToOriginAndRotation(W.spatialReference,L,U,this._context.renderCoordsHelper.spatialReference);return U};X._computeLocalTransform=function(W,T,U,Y){d.identity(Y);this._applyObjectRotation(U,!1,Y);this._applyObjectRotation(T,!0,Y);this._applyObjectScale(W,U,Y);this._applyAnchor(W,T,Y);return Y};X._applyObjectScale=function(W,T,U){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(W=x.computeObjectScale(this._drivenProperties.size&&
T.size?T.size:W.symbolSize,W.symbolSize,W.resourceSize,this._context.renderCoordsHelper.unitInMeters),1===W[0]&&1===W[1]&&1===W[2]||d.scale(U,U,W))};X.prepareSymbolLayerPatch=function(W){if("partial"===W.diff.type){var T=W.diff.diff;this._preparePatchTransform(W,T);this._preparePatchColor(W,T)}};X.updateGeometry=function(W,T){if(n.isNone(this._resources))return!0;const U=T&&F.placePointOnGeometry(T);if(n.isNone(U))return!1;T=this.getGeometryElevationMode(T);if(W.elevationContext.mode!==T)return!1;
this._computeGlobalTransform(U,W.elevationContext,S,Q);this._requiresTerrainElevation(W.elevationContext)&&(W.alignedSampledElevation=Q.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(W.instanceIndex,S,!0);F.extendPointGraphicElevationContext(W,U,this._context.elevationProvider);return!0};X._preparePatchTransform=function(W,T){if((T.heading||T.tilt||T.roll||T.width||T.height||T.depth||T.anchor||T.anchorPosition)&&!n.isNone(this._resources)){var U=(fa,ka,la)=>n.unwrapOr(null!=
fa&&"complete"===fa.type?fa.newValue:ka,la),Y=U(T.heading,this.symbolLayer.heading,0),ba=U(T.tilt,this.symbolLayer.tilt,0),da=U(T.roll,this.symbolLayer.roll,0),ea=U(T.width,this.symbolLayer.width,void 0),ca=U(T.height,this.symbolLayer.height,void 0),ja=U(T.depth,this.symbolLayer.depth,void 0),ia=U(T.anchor,this.symbolLayer.anchor,void 0);U=U(T.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete T.heading;delete T.tilt;delete T.roll;delete T.width;delete T.height;delete T.depth;delete T.anchor;
delete T.anchorPosition;var Z={heading:Y,tilt:ba,roll:da,anchor:ia,anchorPosition:U},ha=this._resources;this.loadStatus===y.LoadStatus.LOADED&&W.symbolLayerStatePatches.push(()=>{ha.symbolSize=g.fromArray(k.objectSymbolLayerSizeWithResourceSize(ha.resourceSize,{width:ea,height:ca,depth:ja,isPrimitive:this.symbolLayer.isPrimitive}))});W.graphics3DGraphicPatches.push((fa,ka)=>{ka=this._computeLocalTransform(ha,Z,ka,O);ha.lodRenderer.instanceData.setLocalTransform(fa.instanceIndex,ka,!0)})}};X._preparePatchColor=
function(W,T){if(T.material&&"partial"===T.material.type&&(T=T.material.diff,T.color&&"complete"===T.color.type&&null!=T.color.newValue&&null!=T.color.oldValue)){var U=T.color.newValue,Y=n.isSome(U)?b.toUnitRGBA(U):h.ONES;delete T.color;var ba=this._resources;n.isNone(ba)||W.graphics3DGraphicPatches.push(da=>{this._hasPerInstanceColor()?(ba.lodRenderer.instanceData.setColor(da.instanceIndex,Y),da=this._setMaterialTransparencyParams({},U)):da=this._setMaterialTransparencyParams({externalColor:Y},U);
for(const ea of ba.stageResources.materials)ea.setParameters(da)})}};X._requiresTerrainElevation=function(W){return"absolute-height"!==W.mode};X._applyObjectRotation=function(W,T,U){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&T))return x.computeObjectRotation(W.heading,W.tilt,W.roll,U)};X._computeAnchor=function(W,T,U){const Y=g.create();switch(U.anchor){case "center":e.copy(Y,v.center(W));e.negate(Y,Y);break;case "top":T=v.center(W);e.set(Y,-T[0],-T[1],-W[5]);
break;case "bottom":T=v.center(W);e.set(Y,-T[0],-T[1],-W[2]);break;case "relative":T=v.center(W);W=v.size(W);U=(U=U.anchorPosition)?g.fromValues(U.x,U.y,U.z):g.ZEROS;e.multiply(Y,W,U);e.add(Y,Y,T);e.negate(Y,Y);break;default:n.isSome(T)?e.negate(Y,T):e.copy(Y,g.ZEROS)}return Y};X._applyAnchor=function(W,T,U){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(W=this._computeAnchor(W.resourceBoundingBox,W.pivotOffset,T))&&d.translate(U,U,W)};X._hasPerInstanceColor=function(){return this._drivenProperties.color||
this._drivenProperties.opacity};X._fastVisualVariableConvertOptions=function(W,T,U,Y){const ba=n.isSome(W)?g.fromArray(v.size(W)):g.ONES;W=n.isSome(W)?this._computeAnchor(W,Y,this.symbolLayer):g.ZEROS;Y=this._context.renderCoordsHelper.unitInMeters;U=x.computeObjectScale(n.isSome(T)?T:void 0,T,U,Y);const da=g.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:ba,symbolSize:n.isSome(T)?T:g.ONES,unitInMeters:Y,transformation:{anchor:W,scale:U,
rotation:da}}};c._createClass(aa,[{key:"extentPadding",get:function(){return n.isSome(this._resources)?this._resources.extentPadding:0}},{key:"_isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",get:function(){return n.isSome(this._resources)?this._resources.lodRenderer:null}}]);return aa}(A.Graphics3DSymbolLayer);const L=g.create(),O=f.create(),S=f.create(),R=h.create(),Q=new z.SampleElevationInfo;a.Graphics3DObjectSymbolLayer=A;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./elevationAlignmentUtils ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),function(a,c,b,t,n,r,m,d,f,
e,g){let h=function(){function z(B,A,x,u){this.graphics3DSymbolLayer=B;this.instanceIndex=A;this.elevationAligner=x;this.elevationContext=u;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var C=z.prototype;C.initialize=function(){};C.setVisibility=function(B){const A=this._lodRenderer.instanceData;B!==A.getVisible(this.instanceIndex)&&A.setVisible(this.instanceIndex,B)};C.destroy=function(){null!=this.instanceIndex&&
(this._lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};C.alignWithElevation=function(B,A,x){this.elevationAligner&&(d.setContextFeature(this.elevationContext.featureExpressionInfoContext,x),x=this.elevationAligner(this,this.elevationContext,B.spatialReference,(u,y)=>m.evaluateElevationInfoAtPoint(u,B,this.elevationContext,A,y),A),c.isSome(x)&&(this.alignedSampledElevation=x))};C.getCenterObjectSpace=function(B=n.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,
p);return t.transformMat4(B,this._lodRenderer.baseBoundingSphere.center,p)};C.getBoundingBoxObjectSpace=function(B=r.create()){this._lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,p);const A=this._lodRenderer.baseBoundingBox;r.empty(B);for(let x=0;8>x;++x)t.set(v,0===(x&1)?A[0]:A[3],0===(x&2)?A[1]:A[4],0===(x&4)?A[2]:A[5]),t.transformMat4(v,v,p),r.expandWithVec3(B,v);return B};C.computeAttachmentOrigin=function(B){this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,
p);B.render.origin[0]+=p[12];B.render.origin[1]+=p[13];B.render.origin[2]+=p[14];B.render.num++};C.getProjectedBoundingBox=function(){var B=a._asyncToGenerator(function*(A,x,u,y,w){w=this.getBoundingBoxObjectSpace(w);var D=k;const F=r.isPoint(w)?1:D.length;this._lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,p);for(var E=0;E<F;E++){const K=D[E];v[0]=w[K[0]];v[1]=w[K[1]];v[2]=w[K[2]];t.transformMat4(v,v,p);l[3*E]=v[0];l[3*E+1]=v[1];l[3*E+2]=v[2]}if(!A(l,0,F))return null;r.empty(w);
A=null;this.calculateRelativeScreenBounds&&(A=this.calculateRelativeScreenBounds());for(D=0;D<3*F;D+=3){for(E=0;3>E;E++)w[E]=Math.min(w[E],l[D+E]),w[E+3]=Math.max(w[E+3],l[D+E]);A&&u.push({location:l.slice(D,D+3),screenSpaceBoundingRect:A})}if(x&&(r.center(w,q),"absolute-height"!==this.elevationContext.mode)){let K;u=f.demResolutionForBoundingBox(w,x.service.spatialReference,x);try{K=yield x.service.queryElevation(q[0],q[1],y,u,"ground")}catch(J){}c.isSome(K)&&r.offset(w,0,0,-this.alignedSampledElevation+
K)}return w});return function(A,x,u,y,w){return B.apply(this,arguments)}}();C.addObjectState=function(B,A){B===e.Object3DState.Highlight&&(B=new g.Object3DStateID(B),this._addHighlightId(B),A.addExternal(x=>{this._removeHighlightId(x)},B))};C.removeObjectState=function(B){this._highlights.forEach(A=>B.remove(A))};C._addHighlightId=function(B){this._highlights.add(B);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};C._removeHighlightId=function(B){this._highlights.delete(B);this._lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this._highlights.size)};a._createClass(z,[{key:"_lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return z}();const l=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],v=n.create(),q=n.create(),k=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],p=b.create();return h})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../../../core/maybe","../../webgl-engine/lib/lodRendering/LodResources"],function(a,c,b){function t(n){const r=
[];n.stageResources.geometries.forEach(m=>{r.push(new b.LodComponentResources(m,n.stageResources.textures))});return{components:r,minScreenSpaceRadius:c.unwrapOr(n.lodThreshold,0),pivotOffset:n.pivotOffset}}a.makeLodResources=function(n){return{levels:n.map(r=>t(r))}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../geometry/support/buffer/utils ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ../../glTF/internal/resourceUtils ../../glTF/internal/TextureTransformUtils ./ProcessedObjectResource ./wosrLoader ../../webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../../webgl/enums ../../../../chunks/vec22 ../../../../chunks/vec43 ../../../../chunks/vec33".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I){function G(){G=c._asyncToGenerator(function*(R,Q){R=H(b.adjustStaticAGOUrl(R));if("wosr"===R.fileType){R=yield Q.cache?Q.cache.loadWOSR(R.url,Q):x.load(R.url,Q);const {engineResources:da,referenceBoundingBox:ea}=x.processLoadResult(R,Q);return{lods:da,referenceBoundingBox:ea,isEsriSymbolResource:!1,isWosr:!0}}const V=yield Q.cache?Q.cache.loadGLTF(R.url,Q,!!Q.usePBR):p.loadGLTF(new k.DefaultLoadingContext(Q.streamDataRequester),
R.url,Q,Q.usePBR),aa=t.get(V.model.meta,"ESRI_proxyEllipsoid"),X=V.meta.isEsriSymbolResource&&t.isSome(aa)&&V.meta.uri.includes("/RealisticTrees/");if(X&&!V.customMeta.esriTreeRendering){V.customMeta.esriTreeRendering=!0;a:for(let da=0;da<V.model.lods.length;++da){var W=V.model.lods[da];for(var T of W.parts){W=T.attributes.normal;if(t.isNone(W))break a;const ea=T.attributes.position,ca=ea.count,ja=e.create(),ia=e.create(),Z=e.create(),ha=q.createBuffer(h.BufferViewVec4u8,ca),fa=q.createBuffer(h.BufferViewVec3f,
ca),ka=m.invert(d.create(),T.transform);for(let la=0;la<ca;la++){ea.getVec(la,ia);W.getVec(la,ja);f.transformMat4(ia,ia,T.transform);f.subtract(Z,ia,aa.center);f.divide(Z,Z,aa.radius);const na=Z[2];var U=f.length(Z);U=Math.min(.45+.55*U*U,1);f.divide(Z,Z,aa.radius);null!==ka&&f.transformMat4(Z,Z,ka);f.normalize(Z,Z);da+1!==V.model.lods.length&&1<V.model.lods.length&&(-1<na?f.lerp(Z,Z,ja,.2):f.lerp(Z,Z,ja,Math.min(-4*na-3.8,1)));fa.setVec(la,Z);ha.set(la,0,255*U);ha.set(la,1,255*U);ha.set(la,2,255*
U);ha.set(la,3,255)}T.attributes.normal=fa;T.attributes.color=ha}}}T=!!Q.usePBR;const {engineResources:Y,referenceBoundingBox:ba}=L(V,V.meta.isEsriSymbolResource?{usePBR:T,isSchematic:!1,treeRendering:X,mrrFactors:[0,1,.2]}:{usePBR:T,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]},{...Q.materialParamsMixin,treeRendering:X},Q.skipHighLods&&null==R.specifiedLodIndex?{skipHighLods:!0}:{skipHighLods:!1,singleLodIndex:R.specifiedLodIndex});return{lods:Y,referenceBoundingBox:ba,isEsriSymbolResource:V.meta.isEsriSymbolResource,
isWosr:!1}});return G.apply(this,arguments)}function H(R){const Q=R.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return Q?{fileType:"gltf",url:Q[1],specifiedLodIndex:null!=Q[4]?Number(Q[4]):null}:R.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:R,specifiedLodIndex:null}:{fileType:"unknown",url:R,specifiedLodIndex:null}}function L(R,Q,V,aa){const X=R.model,W=[],T=new Map,U=new Map,Y=X.lods.length,ba=g.empty();X.lods.forEach((da,ea)=>{const ca=!0===aa.skipHighLods&&(1<Y&&0===ea||3<Y&&1===ea)||
!1===aa.skipHighLods&&null!=aa.singleLodIndex&&ea!==aa.singleLodIndex;if(!ca||0===ea){var ja=new A.ProcessedObjectResource(da.name,da.lodThreshold,[0,0,0]);da.parts.forEach(ia=>{const Z=ca?new K.DefaultMaterial({}):O(X,ia,ja,Q,V,T,U);var ha=t.isSome(Z)?Z:new K.DefaultMaterial({});const fa=ia.attributes.position.count;a:{var ka=ia.indices||fa;switch(ia.primitiveType){case M.PrimitiveType.TRIANGLES:ka=z.trianglesToTriangles(ka);break a;case M.PrimitiveType.TRIANGLE_STRIP:ka=z.triangleStripToTriangles(ka);
break a;case M.PrimitiveType.TRIANGLE_FAN:ka=z.triangleFanToTriangles(ka);break a}ka=void 0}var la=q.createBuffer(h.BufferViewVec3f,fa);l.transformMat4(la,ia.attributes.position,ia.transform);la=[[E.VertexAttribute.POSITION,new y.Attribute(la.typedBuffer,la.elementCount,!0)]];const na=[[E.VertexAttribute.POSITION,ka]];if(t.isSome(ia.attributes.normal)){var pa=q.createBuffer(h.BufferViewVec3f,fa);n.normalFromMat4(S,ia.transform);l.transformMat3(pa,ia.attributes.normal,S);la.push([E.VertexAttribute.NORMAL,
new y.Attribute(pa.typedBuffer,pa.elementCount,!0)]);na.push([E.VertexAttribute.NORMAL,ka])}t.isSome(ia.attributes.tangent)&&(pa=q.createBuffer(h.BufferViewVec4f,fa),n.normalFromMat4(S,ia.transform),v.transformMat3(pa,ia.attributes.tangent,S),la.push([E.VertexAttribute.TANGENT,new y.Attribute(pa.typedBuffer,pa.elementCount,!0)]),na.push([E.VertexAttribute.TANGENT,ka]));t.isSome(ia.attributes.texCoord0)&&(pa=q.createBuffer(h.BufferViewVec2f,fa),N.normalizeIntegerBuffer(pa,ia.attributes.texCoord0),
la.push([E.VertexAttribute.UV0,new y.Attribute(pa.typedBuffer,pa.elementCount,!0)]),na.push([E.VertexAttribute.UV0,ka]));if(t.isSome(ia.attributes.color)){pa=q.createBuffer(h.BufferViewVec4u8,fa);if(4===ia.attributes.color.elementCount)ia.attributes.color instanceof h.BufferViewVec4f?v.scale(pa,ia.attributes.color,255):ia.attributes.color instanceof h.BufferViewVec4u8?P.copy(pa,ia.attributes.color):ia.attributes.color instanceof h.BufferViewVec4u16&&v.scale(pa,ia.attributes.color,1/256);else{P.fill(pa,
255,255,255,255);const za=new h.BufferViewVec3u8(pa.buffer,0,4);ia.attributes.color instanceof h.BufferViewVec3f?l.scale(za,ia.attributes.color,255):ia.attributes.color instanceof h.BufferViewVec3u8?I.copy(za,ia.attributes.color):ia.attributes.color instanceof h.BufferViewVec3u16&&l.scale(za,ia.attributes.color,1/256)}la.push([E.VertexAttribute.COLOR,new y.Attribute(pa.typedBuffer,pa.elementCount,!0)]);na.push([E.VertexAttribute.COLOR,ka])}ia={geometry:new D.Geometry(ha,la,na),vertexCount:fa};const {geometry:va,
vertexCount:wa}=ia;ia=va.boundingInfo;t.isSome(ia)&&0===ea&&(g.expandWithVec3(ba,ia.bbMin),g.expandWithVec3(ba,ia.bbMax));t.isSome(Z)&&(ja.stageResources.geometries.push(va),ja.numberOfVertices+=wa)});ca||W.push(ja)}});return{engineResources:W,referenceBoundingBox:ba}}function O(R,Q,V,aa,X,W,T){const U=Q.material+(Q.attributes.normal?"_normal":"")+(Q.attributes.color?"_color":"")+(Q.attributes.texCoord0?"_texCoord0":"")+(Q.attributes.tangent?"_tangent":""),Y=R.materials.get(Q.material);var ba=t.isSome(Q.attributes.texCoord0);
const da=t.isSome(Q.attributes.normal);if(t.isNone(Y))return null;a:{switch(Y.alphaMode){case "BLEND":var ea=w.AlphaDiscardMode.Blend;break a;case "MASK":ea=w.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:ea=w.AlphaDiscardMode.Opaque;break a}ea=void 0}if(!W.has(U)){if(ba){var ca=(la,na=!1)=>{if(t.isSome(la)&&!T.has(la)){const pa=R.textures.get(la);if(t.isSome(pa)){const va=pa.data;T.set(la,new F.Texture(C.isEncodedMeshTexture(va)?va.data:va,{...pa.parameters,preMultiplyAlpha:C.isEncodedMeshTexture(va)?
!1:na,encoding:C.isEncodedMeshTexture(va)&&t.isSome(va.encoding)?va.encoding:void 0}))}}};ca(Y.textureColor,ea!==w.AlphaDiscardMode.Opaque);ca(Y.textureNormal);ca(Y.textureOcclusion);ca(Y.textureEmissive);ca(Y.textureMetallicRoughness)}ca=Y.color[0]**(1/J.COLOR_GAMMA);const ja=Y.color[1]**(1/J.COLOR_GAMMA),ia=Y.color[2]**(1/J.COLOR_GAMMA),Z=Y.emissiveFactor[0]**(1/J.COLOR_GAMMA),ha=Y.emissiveFactor[1]**(1/J.COLOR_GAMMA),fa=Y.emissiveFactor[2]**(1/J.COLOR_GAMMA),ka=t.isSome(Y.textureColor)&&ba?T.get(Y.textureColor):
null;W.set(U,new K.DefaultMaterial({...aa,transparent:ea===w.AlphaDiscardMode.Blend,customDepthTest:w.DepthTestFunction.Lequal,textureAlphaMode:ea,textureAlphaCutoff:Y.alphaCutoff,diffuse:[ca,ja,ia],ambient:[ca,ja,ia],opacity:Y.opacity,doubleSided:Y.doubleSided,doubleSidedType:"winding-order",cullFace:Y.doubleSided?w.CullFaceOptions.None:w.CullFaceOptions.Back,hasVertexColors:!!Q.attributes.color,hasVertexTangents:!!Q.attributes.tangent,normalType:da?u.NormalAttributeType.Attribute:u.NormalAttributeType.ScreenDerivative,
castShadows:!0,receiveSSAO:!0,textureId:t.isSome(ka)?ka.id:void 0,colorMixMode:Y.colorMixMode,normalTextureId:t.isSome(Y.textureNormal)&&ba?T.get(Y.textureNormal).id:void 0,textureAlphaPremultiplied:t.isSome(ka)&&!!ka.params.preMultiplyAlpha,occlusionTextureId:t.isSome(Y.textureOcclusion)&&ba?T.get(Y.textureOcclusion).id:void 0,emissiveTextureId:t.isSome(Y.textureEmissive)&&ba?T.get(Y.textureEmissive).id:void 0,metallicRoughnessTextureId:t.isSome(Y.textureMetallicRoughness)&&ba?T.get(Y.textureMetallicRoughness).id:
void 0,emissiveFactor:[Z,ha,fa],mrrFactors:[Y.metallicFactor,Y.roughnessFactor,aa.mrrFactors[2]],isSchematic:!1,colorTextureTransformMatrix:B.getTransformMatrix(Y.colorTextureTransform),normalTextureTransformMatrix:B.getTransformMatrix(Y.normalTextureTransform),occlusionTextureTransformMatrix:B.getTransformMatrix(Y.occlusionTextureTransform),emissiveTextureTransformMatrix:B.getTransformMatrix(Y.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:B.getTransformMatrix(Y.metallicRoughnessTextureTransform),
...X}))}Q=W.get(U);V.stageResources.materials.push(Q);ba&&(ba=ja=>{t.isSome(ja)&&V.stageResources.textures.push(T.get(ja))},ba(Y.textureColor),ba(Y.textureNormal),ba(Y.textureOcclusion),ba(Y.textureEmissive),ba(Y.textureMetallicRoughness));return Q}const S=r.create();a.fetch=function(R,Q){return G.apply(this,arguments)};a.gltfToEngineResources=L;a.parseUrl=H;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/vec42":function(){define(["exports","../geometry/support/buffer/math/common"],
function(a,c){function b(f,e,g){if(f.count!==e.count)c.mathLogger.error("source and destination buffers need to have the same number of elements");else{var h=f.count,l=g[0],v=g[1],q=g[2],k=g[3],p=g[4],z=g[5],C=g[6],B=g[7],A=g[8],x=g[9],u=g[10],y=g[11],w=g[12],D=g[13],F=g[14];g=g[15];var E=f.typedBuffer;f=f.typedBufferStride;var K=e.typedBuffer;e=e.typedBufferStride;for(let M=0;M<h;M++){const N=M*f;var J=M*e;const P=K[J],I=K[J+1],G=K[J+2];J=K[J+3];E[N]=l*P+p*I+A*G+w*J;E[N+1]=v*P+z*I+x*G+D*J;E[N+2]=
q*P+C*I+u*G+F*J;E[N+3]=k*P+B*I+y*G+g*J}}}function t(f,e,g){if(f.count!==e.count)c.mathLogger.error("source and destination buffers need to have the same number of elements");else{var h=f.count,l=g[0],v=g[1],q=g[2],k=g[3],p=g[4],z=g[5],C=g[6],B=g[7];g=g[8];var A=f.typedBuffer;f=f.typedBufferStride;var x=e.typedBuffer;e=e.typedBufferStride;for(let y=0;y<h;y++){const w=y*f;var u=y*e;const D=x[u],F=x[u+1],E=x[u+2];u=x[u+3];A[w]=l*D+k*F+C*E;A[w+1]=v*D+p*F+B*E;A[w+2]=q*D+z*F+g*E;A[w+3]=u}}}function n(f,
e){const g=Math.min(f.count,e.count),h=f.typedBuffer;f=f.typedBufferStride;const l=e.typedBuffer;e=e.typedBufferStride;for(let k=0;k<g;k++){const p=k*f;var v=k*e;const z=l[v],C=l[v+1];v=l[v+2];var q=z*z+C*C+v*v;0<q&&(q=1/Math.sqrt(q),h[p]=q*z,h[p+1]=q*C,h[p+2]=q*v)}}function r(f,e,g){const h=Math.min(f.count,e.count),l=f.typedBuffer;f=f.typedBufferStride;const v=e.typedBuffer;e=e.typedBufferStride;for(let q=0;q<h;q++){const k=q*f,p=q*e;l[k]=g*v[p];l[k+1]=g*v[p+1];l[k+2]=g*v[p+2];l[k+3]=g*v[p+3]}}
function m(f,e,g){const h=Math.min(f.count,e.count),l=f.typedBuffer;f=f.typedBufferStride;const v=e.typedBuffer;e=e.typedBufferStride;for(let q=0;q<h;q++){const k=q*f,p=q*e;l[k]=v[p]>>g;l[k+1]=v[p+1]>>g;l[k+2]=v[p+2]>>g;l[k+3]=v[p+3]>>g}}const d=Object.freeze(Object.defineProperty({__proto__:null,normalize:n,scale:r,shiftRight:m,transformMat3:t,transformMat4:b},Symbol.toStringTag,{value:"Module"}));a.normalize=n;a.scale=r;a.shiftRight=m;a.transformMat3=t;a.transformMat4=b;a.vec4=d})},"esri/geometry/support/buffer/utils":function(){define("exports ./types ../../../chunks/mat32 ../../../chunks/mat42 ../../../chunks/scalar ../../../chunks/vec22 ../../../chunks/vec33 ../../../chunks/vec43".split(" "),
function(a,c,b,t,n,r,m,d){a.mat3=b.mat3;a.mat4=t.mat4;a.scalar=n.scalar;a.vec2=r.vec2;a.vec3=m.vec3;a.vec4=d.vec4;a.createBuffer=function(f,e){return new f(new ArrayBuffer(e*f.ElementCount*c.elementTypeSize(f.ElementType)))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat32":function(){define(["exports"],function(a){function c(t,n,r){const m=t.typedBuffer;t=t.typedBufferStride;const d=n.typedBuffer,f=n.typedBufferStride;n=r?r.count:n.count;let e=(r&&r.dstIndex?r.dstIndex:
0)*t;r=(r&&r.srcIndex?r.srcIndex:0)*f;for(let g=0;g<n;++g){for(let h=0;9>h;++h)m[e+h]=d[r+h];e+=t;r+=f}}const b=Object.freeze(Object.defineProperty({__proto__:null,copy:c},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.mat3=b})},"esri/chunks/mat42":function(){define(["exports"],function(a){function c(t,n,r){const m=t.typedBuffer;t=t.typedBufferStride;const d=n.typedBuffer,f=n.typedBufferStride;n=r?r.count:n.count;let e=(r&&r.dstIndex?r.dstIndex:0)*t;r=(r&&r.srcIndex?r.srcIndex:0)*f;for(let g=0;g<
n;++g){for(let h=0;16>h;++h)m[e+h]=d[r+h];e+=t;r+=f}}const b=Object.freeze(Object.defineProperty({__proto__:null,copy:c},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.mat4=b})},"esri/chunks/scalar":function(){define(["exports"],function(a){function c(n,r,m){const d=n.typedBuffer;n=n.typedBufferStride;const f=r.typedBuffer,e=r.typedBufferStride;r=m?m.count:r.count;let g=(m&&m.dstIndex?m.dstIndex:0)*n;m=(m&&m.srcIndex?m.srcIndex:0)*e;for(let h=0;h<r;++h)d[g]=f[m],g+=n,m+=e}function b(n,r){const m=
n.count;r||(r=new n.TypedArrayConstructor(m));for(let d=0;d<m;d++)r[d]=n.get(d);return r}const t=Object.freeze(Object.defineProperty({__proto__:null,copy:c,makeDense:b},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.makeDense=b;a.scalar=t})},"esri/chunks/vec22":function(){define(["exports","../geometry/support/buffer/types"],function(a,c){function b(m,d,f){const e=m.typedBuffer;m=m.typedBufferStride;const g=d.typedBuffer,h=d.typedBufferStride;d=f?f.count:d.count;let l=(f&&f.dstIndex?f.dstIndex:
0)*m;f=(f&&f.srcIndex?f.srcIndex:0)*h;for(let v=0;v<d;++v)e[l]=g[f],e[l+1]=g[f+1],l+=m,f+=h}function t(m,d,f){const e=m.typedBuffer,g=m.typedBufferStride,h=d.typedBuffer,l=d.typedBufferStride,v=f?f.count:d.count;let q=(f&&f.dstIndex?f.dstIndex:0)*g,k=(f&&f.srcIndex?f.srcIndex:0)*l;if(c.isInteger(d.elementType))if(f=c.maximumValue(d.elementType),c.isSigned(d.elementType))for(d=0;d<v;++d)e[q]=Math.max(h[k]/f,-1),e[q+1]=Math.max(h[k+1]/f,-1),q+=g,k+=l;else for(d=0;d<v;++d)e[q]=h[k]/f,e[q+1]=h[k+1]/f,
q+=g,k+=l;else b(m,d,f);return m}function n(m,d,f,e){const g=m.typedBuffer,h=m.typedBufferStride;m=e?.count??m.count;e=(e?.dstIndex??0)*h;for(let l=0;l<m;++l)g[e]=d,g[e+1]=f,e+=h}const r=Object.freeze(Object.defineProperty({__proto__:null,copy:b,fill:n,normalizeIntegerBuffer:t},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.fill=n;a.normalizeIntegerBuffer=t;a.vec2=r})},"esri/chunks/vec33":function(){define(["exports"],function(a){function c(n,r,m){const d=n.typedBuffer;n=n.typedBufferStride;const f=
r.typedBuffer,e=r.typedBufferStride;r=m?m.count:r.count;let g=(m&&m.dstIndex?m.dstIndex:0)*n;m=(m&&m.srcIndex?m.srcIndex:0)*e;for(let h=0;h<r;++h)d[g]=f[m],d[g+1]=f[m+1],d[g+2]=f[m+2],g+=n,m+=e}function b(n,r,m,d,f){const e=n.typedBuffer,g=n.typedBufferStride;n=f?.count??n.count;f=(f?.dstIndex??0)*g;for(let h=0;h<n;++h)e[f]=r,e[f+1]=m,e[f+2]=d,f+=g}const t=Object.freeze(Object.defineProperty({__proto__:null,copy:c,fill:b},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.fill=b;a.vec3=t})},"esri/chunks/vec43":function(){define(["exports"],
function(a){function c(n,r,m){const d=n.typedBuffer;n=n.typedBufferStride;const f=r.typedBuffer,e=r.typedBufferStride;r=m?m.count:r.count;let g=(m&&m.dstIndex?m.dstIndex:0)*n;m=(m&&m.srcIndex?m.srcIndex:0)*e;for(let h=0;h<r;++h)d[g]=f[m],d[g+1]=f[m+1],d[g+2]=f[m+2],d[g+3]=f[m+3],g+=n,m+=e}function b(n,r,m,d,f,e){const g=n.typedBuffer,h=n.typedBufferStride;n=e?.count??n.count;e=(e?.dstIndex??0)*h;for(let l=0;l<n;++l)g[e]=r,g[e+1]=m,g[e+2]=d,g[e+3]=f,e+=h}const t=Object.freeze(Object.defineProperty({__proto__:null,
copy:c,fill:b},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.fill=b;a.vec4=t})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(a,c,b,t,n,r,m,d){let f=function(){function g(l){this._streamDataRequester=l}var h=g.prototype;h.loadJSON=function(){var l=c._asyncToGenerator(function*(v,
q){return this._load("json",v,q)});return function(v,q){return l.apply(this,arguments)}}();h.loadBinary=function(){var l=c._asyncToGenerator(function*(v,q){return d.isDataProtocol(v)?(m.throwIfAborted(q),d.dataToArrayBuffer(v)):this._load("binary",v,q)});return function(v,q){return l.apply(this,arguments)}}();h.loadImage=function(){var l=c._asyncToGenerator(function*(v,q){return this._load("image",v,q)});return function(v,q){return l.apply(this,arguments)}}();h._load=function(){var l=c._asyncToGenerator(function*(v,
q,k){if(r.isNone(this._streamDataRequester))return(yield b(q,{responseType:e[v]})).data;v=yield t.result(this._streamDataRequester.request(q,v,k));if(!0===v.ok)return v.value;m.throwIfAbortError(v.error);throw new n("",`Request for resource failed: ${v.error}`);});return function(v,q,k){return l.apply(this,arguments)}}();return g}();const e={image:"image",binary:"array-buffer",json:"json"};a.DefaultLoadingContext=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../chunks/mat4f64 ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d){function f(){f=c._asyncToGenerator(function*(k,p,z={},C=!0){const B=yield m.GLTFResource.load(k,p,z),A=`gltf_${v++}`,x={lods:[],materials:new Map,textures:new Map,meta:e(B)};k=!(!B.json.asset.extras||"symbolResource"!==B.json.asset.extras.ESRI_type);const u=new Map;yield g(B,function(){var w=c._asyncToGenerator(function*(D,F,E,K){const J=u.get(E)??0;u.set(E,J+1);var M=void 0!==D.mode?D.mode:d.PrimitiveType.TRIANGLES,N=M===d.PrimitiveType.TRIANGLES||M===d.PrimitiveType.TRIANGLE_STRIP||
M===d.PrimitiveType.TRIANGLE_FAN?M:null;if(t.isNone(N))b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Unsupported primitive mode ("+d.PrimitiveType[M]+"). Skipping primitive.");else if(B.hasPositions(D)){M=B.getPositionData(D,z);var P=B.getMaterial(D,z,C),I=B.hasNormals(D)?B.getNormalData(D,z):null,G=B.hasTangents(D)?B.getTangentData(D,z):null,H=B.hasTextureCoordinates(D)?B.getTextureCoordinates(D,z):null,L=B.hasVertexColors(D)?B.getVertexColors(D,z):null;D=B.getIndexData(D,z);F={transform:n.clone(F),
attributes:{position:yield M,normal:I?yield I:null,texCoord0:H?yield H:null,color:L?yield L:null,tangent:G?yield G:null},indices:yield D,primitiveType:N,material:l(x,yield P,A)};N=null;t.isSome(x.meta)&&t.isSome(x.meta.ESRI_lod)&&"screenSpaceRadius"===x.meta.ESRI_lod.metric&&(N=x.meta.ESRI_lod.thresholds[E]);x.lods[E]=x.lods[E]||{parts:[],name:K,lodThreshold:N};x.lods[E].parts[J]=F}else b.getLogger("esri.views.3d.glTF").warn("Skipping primitive without POSITION vertex attribute.")});return function(D,
F,E,K){return w.apply(this,arguments)}}());for(var y of x.lods)y.parts=y.parts.filter(w=>!!w);y=yield B.getLoadedBuffersSize();return{model:x,meta:{isEsriSymbolResource:k,uri:B.uri},customMeta:{},size:y}});return f.apply(this,arguments)}function e(k){let p=null;k.json.nodes.forEach(z=>{z=z.extras;t.isSome(z)&&(z.ESRI_proxyEllipsoid||z.ESRI_lod)&&(p=z)});return p}function g(k,p){return h.apply(this,arguments)}function h(){h=c._asyncToGenerator(function*(k,p){function z(y,w){return C.apply(this,arguments)}
function C(){C=c._asyncToGenerator(function*(y,w){const D=B.nodes[y];y=k.getNodeTransform(y);null!=D.weights&&b.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] Morph targets are not supported.");if(null!=D.mesh){const F=B.meshes[D.mesh];for(const E of F.primitives)u.push(p(E,y,w,F.name))}for(const F of D.children||[])u.push(z(F,w))});return C.apply(this,arguments)}const B=k.json;var A=B.scenes[B.scene||0].nodes;const x=1<A.length,u=[];for(const y of A)A=B.nodes[y],u.push(z(y,0)),A.extensions&&
A.extensions.MSFT_lod&&Array.isArray(A.extensions.MSFT_lod.ids)&&!x&&A.extensions.MSFT_lod.ids.forEach((w,D)=>z(w,D+1));yield Promise.all(u)});return h.apply(this,arguments)}function l(k,p,z){const C=A=>{const x=`${z}_tex_${A&&A.id}${A&&A.name?"_"+A.name:""}`;A&&!k.textures.has(x)&&(A=r.makeTextureSource(A.data,{wrap:{s:A.wrapS,t:A.wrapT},mipmap:q.includes(A.minFilter),noUnpackFlip:!0}),k.textures.set(x,A));return x},B=`${z}_mat_${p.id}_${p.name}`;k.materials.has(B)||(p=r.makeMaterialParameters({color:[p.color[0],
p.color[1],p.color[2]],opacity:p.color[3],alphaMode:p.alphaMode,alphaCutoff:p.alphaCutoff,doubleSided:p.doubleSided,colorMixMode:p.ESRI_externalColorMixMode,textureColor:p.colorTexture?C(p.colorTexture):void 0,textureNormal:p.normalTexture?C(p.normalTexture):void 0,textureOcclusion:p.occlusionTexture?C(p.occlusionTexture):void 0,textureEmissive:p.emissiveTexture?C(p.emissiveTexture):void 0,textureMetallicRoughness:p.metallicRoughnessTexture?C(p.metallicRoughnessTexture):void 0,emissiveFactor:[p.emissiveFactor[0],
p.emissiveFactor[1],p.emissiveFactor[2]],colorTextureTransform:p.colorTextureTransform,normalTextureTransform:p.normalTextureTransform,occlusionTextureTransform:p.occlusionTextureTransform,emissiveTextureTransform:p.emissiveTextureTransform,metallicRoughnessTextureTransform:p.metallicRoughnessTextureTransform,metallicFactor:p.metallicFactor,roughnessFactor:p.roughnessFactor}),k.materials.set(B,p));return B}let v=0;const q=[d.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,d.TextureSamplingMode.LINEAR_MIPMAP_NEAREST];
a.loadGLTF=function(k,p){return f.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports","../../webgl/enums"],function(a,c){a.makeMaterialParameters=function(b={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,
colorTextureTransform:null,normalTextureTransform:null,occlusionTextureTransform:null,emissiveTextureTransform:null,metallicRoughnessTextureTransform:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...b}};a.makeTextureSource=function(b,t={}){return{data:b,parameters:{wrap:{s:c.TextureWrapMode.REPEAT,t:c.TextureWrapMode.REPEAT,...t.wrap},noUnpackFlip:!0,mipmap:!1,...t}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/Logger ../../../../core/MapUtils ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ./resourceUtils ../../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B){function A(E){switch(E.componentType){case B.DataType.BYTE:return new l.BufferViewVec2i8(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount);case B.DataType.UNSIGNED_BYTE:return new l.BufferViewVec2u8(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount);case B.DataType.SHORT:return new l.BufferViewVec2i16(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount);case B.DataType.UNSIGNED_SHORT:return new l.BufferViewVec2u16(E.raw,
E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount);case B.DataType.UNSIGNED_INT:return new l.BufferViewVec2u32(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount);case B.DataType.FLOAT:return new l.BufferViewVec2f(E.raw,E.byteOffset,E.byteStride,E.byteOffset+E.byteStride*E.entryCount)}}let x=function(){function E(J,M,N,P){this._context=J;this.uri=M;this.json=N;this._glbBuffer=P;this._bufferLoaders=new Map;this._textureLoaders=new Map;this._textureCache=new Map;this._materialCache=
new Map;this._nodeParentMap=new Map;this._nodeTransformCache=new Map;this._supportedExtensions=["KHR_texture_basisu"];this._baseUri=z.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();if(null==N.scenes)throw new b("gltf-loader-unsupported-feature","Scenes must be defined.");if(null==N.meshes)throw new b("gltf-loader-unsupported-feature","Meshes must be defined");if(null==N.nodes)throw new b("gltf-loader-unsupported-feature","Nodes must be defined.");
this._computeNodeParents()}E.load=function(){var J=c._asyncToGenerator(function*(M,N,P){if(m.isDataProtocol(N)){var I=m.dataComponents(N);if(I&&"model/gltf-binary"!==I.mediaType)try{const G=JSON.parse(I.isBase64?atob(I.data):I.data);return new E(M,N,G)}catch{}I=m.dataToArrayBuffer(N);if(E._isGLBData(I))return this._fromGLBData(M,N,I)}if(N.endsWith(".gltf"))return P=yield M.loadJSON(N,P),new E(M,N,P);I=yield M.loadBinary(N,P);if(E._isGLBData(I))return this._fromGLBData(M,N,I);P=yield M.loadJSON(N,
P);return new E(M,N,P)});return function(M,N,P){return J.apply(this,arguments)}}();E._isGLBData=function(J){if(null==J)return!1;J=new q.BinaryStreamReader(J);return 4<=J.remainingBytes()&&1179937895===J.readUint32()};E._fromGLBData=function(){var J=c._asyncToGenerator(function*(M,N,P){P=yield E._parseGLBData(P);return new E(M,N,P.json,P.binaryData)});return function(M,N,P){return J.apply(this,arguments)}}();E._parseGLBData=function(){var J=c._asyncToGenerator(function*(M){const N=new q.BinaryStreamReader(M);
if(12>N.remainingBytes())throw new b("gltf-loader-error","GLB binary data is insufficiently large.");var P=N.readUint32(),I=N.readUint32();const G=N.readUint32();if(1179937895!==P)throw new b("gltf-loader-error","Magic first 4 bytes do not fit to expected GLB value.");if(M.byteLength<G)throw new b("gltf-loader-error","GLB binary data is smaller than header specifies.");if(2!==I)throw new b("gltf-loader-unsupported-feature","An unsupported GLB container version was detected. Only version 2 is supported.");
M=0;let H,L;for(;8<=N.remainingBytes();){P=N.readUint32();I=N.readUint32();if(0===M){if(1313821514!==I)throw new b("gltf-loader-error","First GLB chunk must be JSON.");if(0>P)throw new b("gltf-loader-error","No JSON data found.");H=yield C.jsonFromBinaryData(N.readUint8Array(P))}else if(1===M){if(5130562!==I)throw new b("gltf-loader-unsupported-feature","Second GLB chunk expected to be BIN.");L=N.readUint8Array(P)}else t.getLogger("esri.views.3d.glTF").warn("[Unsupported Feature] More than 2 GLB chunks detected. Skipping.");
M+=1}if(!H)throw new b("gltf-loader-error","No GLB JSON chunk detected.");return{json:H,binaryData:L}});return function(M){return J.apply(this,arguments)}}();var K=E.prototype;K.getBuffer=function(){var J=c._asyncToGenerator(function*(M,N){const P=this.json.buffers[M];if(null==P.uri){if(null==this._glbBuffer)throw new b("gltf-loader-error","GLB buffer not present");return this._glbBuffer}M=yield this._getBufferLoader(M,N);if(M.byteLength!==P.byteLength)throw new b("gltf-loader-error","Buffer byte lengths should match.");
return M});return function(M,N){return J.apply(this,arguments)}}();K._getBufferLoader=function(){var J=c._asyncToGenerator(function*(M,N){const P=this._bufferLoaders.get(M);if(P)return P;N=this._context.loadBinary(this._resolveUri(this.json.buffers[M].uri),N).then(I=>new Uint8Array(I));this._bufferLoaders.set(M,N);return N});return function(M,N){return J.apply(this,arguments)}}();K.getAccessor=function(){var J=c._asyncToGenerator(function*(M,N){if(!this.json.accessors)throw new b("gltf-loader-unsupported-feature",
"Accessors missing.");M=this.json.accessors[M];if(null==M?.bufferView)throw new b("gltf-loader-unsupported-feature","Some accessor does not specify a bufferView.");if(M.type in[k.AttributeType.MAT2,k.AttributeType.MAT3,k.AttributeType.MAT4])throw new b("gltf-loader-unsupported-feature",`AttributeType ${M.type} is not supported`);const P=this.json.bufferViews[M.bufferView];N=yield this.getBuffer(P.buffer,N);const I=D[M.type],G=F[M.componentType],H=I*G,L=P.byteStride||H;return{raw:N.buffer,byteStride:L,
byteOffset:N.byteOffset+(P.byteOffset||0)+(M.byteOffset||0),entryCount:M.count,isDenselyPacked:L===H,componentCount:I,componentByteSize:G,componentType:M.componentType,min:M.min,max:M.max,normalized:!!M.normalized}});return function(M,N){return J.apply(this,arguments)}}();K.getIndexData=function(){var J=c._asyncToGenerator(function*(M,N){if(null!=M.indices)if(M=yield this.getAccessor(M.indices,N),M.isDenselyPacked)switch(M.componentType){case B.DataType.UNSIGNED_BYTE:return new Uint8Array(M.raw,M.byteOffset,
M.entryCount);case B.DataType.UNSIGNED_SHORT:return new Uint16Array(M.raw,M.byteOffset,M.entryCount);case B.DataType.UNSIGNED_INT:return new Uint32Array(M.raw,M.byteOffset,M.entryCount)}else switch(M.componentType){case B.DataType.UNSIGNED_BYTE:return v.makeDense(this._wrapAccessor(l.BufferViewUint8,M));case B.DataType.UNSIGNED_SHORT:return v.makeDense(this._wrapAccessor(l.BufferViewUint16,M));case B.DataType.UNSIGNED_INT:return v.makeDense(this._wrapAccessor(l.BufferViewUint32,M))}});return function(M,
N){return J.apply(this,arguments)}}();K.getPositionData=function(){var J=c._asyncToGenerator(function*(M,N){if(null==M.attributes.POSITION)throw new b("gltf-loader-unsupported-feature","No POSITION vertex data found.");M=yield this.getAccessor(M.attributes.POSITION,N);if(M.componentType!==B.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for POSITION vertex attribute, but found "+B.DataType[M.componentType]);if(3!==M.componentCount)throw new b("gltf-loader-unsupported-feature",
"POSITION vertex attribute must have 3 components, but found "+M.componentCount.toFixed());return this._wrapAccessor(l.BufferViewVec3f,M)});return function(M,N){return J.apply(this,arguments)}}();K.getNormalData=function(){var J=c._asyncToGenerator(function*(M,N){if(null==M.attributes.NORMAL)throw new b("gltf-loader-error","No NORMAL vertex data found.");M=yield this.getAccessor(M.attributes.NORMAL,N);if(M.componentType!==B.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for NORMAL vertex attribute, but found "+
B.DataType[M.componentType]);if(3!==M.componentCount)throw new b("gltf-loader-unsupported-feature","NORMAL vertex attribute must have 3 components, but found "+M.componentCount.toFixed());return this._wrapAccessor(l.BufferViewVec3f,M)});return function(M,N){return J.apply(this,arguments)}}();K.getTangentData=function(){var J=c._asyncToGenerator(function*(M,N){if(null==M.attributes.TANGENT)throw new b("gltf-loader-error","No TANGENT vertex data found.");M=yield this.getAccessor(M.attributes.TANGENT,
N);if(M.componentType!==B.DataType.FLOAT)throw new b("gltf-loader-unsupported-feature","Expected type FLOAT for TANGENT vertex attribute, but found "+B.DataType[M.componentType]);if(4!==M.componentCount)throw new b("gltf-loader-unsupported-feature","TANGENT vertex attribute must have 4 components, but found "+M.componentCount.toFixed());return new l.BufferViewVec4f(M.raw,M.byteOffset,M.byteStride,M.byteOffset+M.byteStride*M.entryCount)});return function(M,N){return J.apply(this,arguments)}}();K.getTextureCoordinates=
function(){var J=c._asyncToGenerator(function*(M,N){if(null==M.attributes.TEXCOORD_0)throw new b("gltf-loader-error","No TEXCOORD_0 vertex data found.");M=yield this.getAccessor(M.attributes.TEXCOORD_0,N);if(2!==M.componentCount)throw new b("gltf-loader-unsupported-feature","TEXCOORD_0 vertex attribute must have 2 components, but found "+M.componentCount.toFixed());if(M.componentType===B.DataType.FLOAT)return this._wrapAccessor(l.BufferViewVec2f,M);if(!M.normalized)throw new b("gltf-loader-unsupported-feature",
"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return A(M)});return function(M,N){return J.apply(this,arguments)}}();K.getVertexColors=function(){var J=c._asyncToGenerator(function*(M,N){if(null==M.attributes.COLOR_0)throw new b("gltf-loader-error","No COLOR_0 vertex data found.");M=yield this.getAccessor(M.attributes.COLOR_0,N);if(4!==M.componentCount&&3!==M.componentCount)throw new b("gltf-loader-unsupported-feature","COLOR_0 attribute must have 3 or 4 components, but found "+
M.componentCount.toFixed());if(4===M.componentCount){if(M.componentType===B.DataType.FLOAT)return this._wrapAccessor(l.BufferViewVec4f,M);if(M.componentType===B.DataType.UNSIGNED_BYTE)return this._wrapAccessor(l.BufferViewVec4u8,M);if(M.componentType===B.DataType.UNSIGNED_SHORT)return this._wrapAccessor(l.BufferViewVec4u16,M)}else if(3===M.componentCount){if(M.componentType===B.DataType.FLOAT)return this._wrapAccessor(l.BufferViewVec3f,M);if(M.componentType===B.DataType.UNSIGNED_BYTE)return this._wrapAccessor(l.BufferViewVec3u8,
M);if(M.componentType===B.DataType.UNSIGNED_SHORT)return this._wrapAccessor(l.BufferViewVec3u16,M)}throw new b("gltf-loader-unsupported-feature","Unsupported component type for COLOR_0 attribute: "+B.DataType[M.componentType]);});return function(M,N){return J.apply(this,arguments)}}();K.hasPositions=function(J){return void 0!==J.attributes.POSITION};K.hasNormals=function(J){return void 0!==J.attributes.NORMAL};K.hasVertexColors=function(J){return void 0!==J.attributes.COLOR_0};K.hasTextureCoordinates=
function(J){return void 0!==J.attributes.TEXCOORD_0};K.hasTangents=function(J){return void 0!==J.attributes.TANGENT};K.getMaterial=function(){var J=c._asyncToGenerator(function*(M,N,P){var I=M.material?this._materialCache.get(M.material):void 0;if(!I){I=null!=M.material?p.material(this.json.materials[M.material]):p.material();const G=I.pbrMetallicRoughness,H=this.hasVertexColors(M),L=this.getTexture(G.baseColorTexture,N),O=this.getTexture(I.normalTexture,N),S=P?this.getTexture(I.occlusionTexture,
N):void 0,R=P?this.getTexture(I.emissiveTexture,N):void 0;N=P?this.getTexture(G.metallicRoughnessTexture,N):void 0;M=null!=M.material?M.material:-1;I={alphaMode:I.alphaMode,alphaCutoff:I.alphaCutoff,color:G.baseColorFactor,doubleSided:!!I.doubleSided,colorTexture:yield L,normalTexture:yield O,name:I.name,id:M,occlusionTexture:yield S,emissiveTexture:yield R,emissiveFactor:I.emissiveFactor,metallicFactor:G.metallicFactor,roughnessFactor:G.roughnessFactor,metallicRoughnessTexture:yield N,hasVertexColors:H,
ESRI_externalColorMixMode:I.extras.ESRI_externalColorMixMode,colorTextureTransform:G?.baseColorTexture?.extensions?.KHR_texture_transform,normalTextureTransform:I.normalTexture?.extensions?.KHR_texture_transform,occlusionTextureTransform:I.occlusionTexture?.extensions?.KHR_texture_transform,emissiveTextureTransform:I.emissiveTexture?.extensions?.KHR_texture_transform,metallicRoughnessTextureTransform:G?.metallicRoughnessTexture?.extensions?.KHR_texture_transform}}return I});return function(M,N,P){return J.apply(this,
arguments)}}();K.getTexture=function(){var J=c._asyncToGenerator(function*(M,N){if(M){if(0!==(M.texCoord||0))throw new b("gltf-loader-unsupported-feature","Only TEXCOORD with index 0 is supported.");var P=M.index;M=this.json.textures[P];var I=p.textureSampler(null!=M.sampler?this.json.samplers[M.sampler]:{}),G=this._getTextureSourceId(M),H=this.json.images[G],L=yield this._loadTextureImageData(P,M,N);return n.getOrCreateMapValue(this._textureCache,P,()=>{const O=R=>33071===R||33648===R||10497===R,
S=R=>{throw new b("gltf-loader-error",`Unexpected TextureSampler WrapMode: ${R}`);};return{data:L,wrapS:O(I.wrapS)?I.wrapS:S(I.wrapS),wrapT:O(I.wrapT)?I.wrapT:S(I.wrapT),minFilter:I.minFilter,name:H.name,id:P}})}});return function(M,N){return J.apply(this,arguments)}}();K.getNodeTransform=function(J){if(void 0===J)return u;var M=this._nodeTransformCache.get(J);if(!M){M=this.getNodeTransform(this._getNodeParent(J));const N=this.json.nodes[J];N.matrix?M=f.multiply(e.create(),M,N.matrix):N.translation||
N.rotation||N.scale?(M=e.clone(M),N.translation&&f.translate(M,M,N.translation),N.rotation&&(w[3]=g.getAxisAngle(w,N.rotation),f.rotate(M,M,w[3],w)),N.scale&&f.scale(M,M,N.scale)):M=e.clone(M);this._nodeTransformCache.set(J,M)}return M};K._wrapAccessor=function(J,M){return new J(M.raw,M.byteOffset,M.byteStride,M.byteOffset+M.byteStride*(M.entryCount-1)+M.componentByteSize*M.componentCount)};K._resolveUri=function(J){return m.makeAbsolute(J,this._baseUri)};K._getNodeParent=function(J){return this._nodeParentMap.get(J)};
K._checkVersionSupported=function(){const J=d.Version.parse(this.json.asset.version,"glTF");y.validate(J)};K._checkRequiredExtensionsSupported=function(){const J=this.json;if(J.extensionsRequired&&!J.extensionsRequired.every(M=>this._supportedExtensions.includes(M)))throw new b("gltf-loader-unsupported-feature","gltf loader was not able to load unsupported feature. Required extensions: "+J.extensionsRequired.join(", "));};K._computeNodeParents=function(){this.json.nodes.forEach((J,M)=>{J.children&&
J.children.forEach(N=>{this._nodeParentMap.set(N,M)})})};K._loadTextureImageData=function(){var J=c._asyncToGenerator(function*(M,N,P){const I=this._textureLoaders.get(M);if(I)return I;N=this._createTextureLoader(N,P);this._textureLoaders.set(M,N);return N});return function(M,N,P){return J.apply(this,arguments)}}();K._getTextureSourceId=function(J){if(void 0!==J.extensions&&null!==J.extensions.KHR_texture_basisu)return J.extensions.KHR_texture_basisu.source;if(null!==J.source)return J.source;throw new b("gltf-loader-unsupported-feature",
"Source is expected to be defined for a texture. It can also be omitted in favour of an KHR_texture_basisu extension tag.");};K._createTextureLoader=function(){var J=c._asyncToGenerator(function*(M,N){M=this._getTextureSourceId(M);M=this.json.images[M];if(M.uri)return M.uri.endsWith(".ktx2")?(N=yield this._context.loadBinary(this._resolveUri(M.uri),N),new C.EncodedMeshTexture(new Uint8Array(N))):this._context.loadImage(this._resolveUri(M.uri),N);if(null==M.bufferView)throw new b("gltf-loader-unsupported-feature",
"Image bufferView must be defined.");if(null==M.mimeType)throw new b("gltf-loader-unsupported-feature","Image mimeType must be defined.");const P=this.json.bufferViews[M.bufferView];N=yield this.getBuffer(P.buffer,N);if(null!=P.byteStride)throw new b("gltf-loader-unsupported-feature","byteStride not supported for image buffer");return C.imageFromBinaryData(new Uint8Array(N.buffer,N.byteOffset+(P.byteOffset||0),P.byteLength),M.mimeType)});return function(M,N){return J.apply(this,arguments)}}();K.getLoadedBuffersSize=
function(){var J=c._asyncToGenerator(function*(){if(this._glbBuffer)return this._glbBuffer.byteLength;const M=yield r.eachAlwaysValues(Array.from(this._bufferLoaders.values())),N=yield r.eachAlwaysValues(Array.from(this._textureLoaders.values()));return M.reduce((P,I)=>P+(I?.byteLength??0),0)+N.reduce((P,I)=>P+(I?C.isEncodedMeshTexture(I)?I.data.byteLength:I.width*I.height*4:0),0)});return function(){return J.apply(this,arguments)}}();return E}();const u=f.fromXRotation(e.create(),Math.PI/2),y=new d.Version(2,
0,"glTF"),w=h.create(),D={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},F={[B.DataType.BYTE]:1,[B.DataType.UNSIGNED_BYTE]:1,[B.DataType.SHORT]:2,[B.DataType.UNSIGNED_SHORT]:2,[B.DataType.FLOAT]:4,[B.DataType.UNSIGNED_INT]:4};a.GLTFResource=x;a.TRANSFORM_GLTF_TO_ENGINE=u;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/Version":function(){define(["exports","./Error"],function(a,c){let b=function(){function t(r,m,d=""){this.major=r;this.minor=m;this._context=d}var n=t.prototype;n.lessThan=
function(r,m){return this.major<r||r===this.major&&this.minor<m};n.since=function(r,m){return!this.lessThan(r,m)};n.validate=function(r){if(this.major!==r.major)throw new c((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:r});};n.clone=function(){return new t(this.major,this.minor,this._context)};t.parse=function(r,m=""){const [d,f]=r.split(".");var e=/^\s*\d+\s*$/;
if(!d||!d.match||!d.match(e))throw new c((m&&m+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:r});if(!f||!f.match||!f.match(e))throw new c((m&&m+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:r});r=parseInt(d,10);e=parseInt(f,10);return new t(r,e,m)};return t}();a.Version=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],
function(a){let c=function(){function b(n){this._data=n;this._offset4=0;this._dataUint32=new Uint32Array(this._data,0,Math.floor(this._data.byteLength/4))}var t=b.prototype;t.readUint32=function(){const n=this._offset4;this._offset4+=1;return this._dataUint32[n]};t.readUint8Array=function(n){const r=4*this._offset4;this._offset4+=n/4;return new Uint8Array(this._data,r,n)};t.remainingBytes=function(){return this._data.byteLength-4*this._offset4};return b}();a.BinaryStreamReader=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(a){a.AttributeType=void 0;(function(c){c.SCALAR="SCALAR";c.VEC2="VEC2";c.VEC3="VEC3";c.VEC4="VEC4";c.MAT2="MAT2";c.MAT3="MAT3";c.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(c){c[c.ARRAY_BUFFER=34962]="ARRAY_BUFFER";c[c.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||(a.BufferViewTarget={}));Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils","../../../webgl/enums"],function(a,c,b){const t={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},n={pbrMetallicRoughness:t,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},r={ESRI_externalColorMixMode:"tint"},m={magFilter:b.TextureSamplingMode.LINEAR,minFilter:b.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,wrapS:b.TextureWrapMode.REPEAT,
wrapT:b.TextureWrapMode.REPEAT};a.material=(d={})=>{const f={...t,...d.pbrMetallicRoughness};var e={...r,...d.extras};switch(e.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:c.neverReached(e.ESRI_externalColorMixMode),e.ESRI_externalColorMixMode="tint"}return{...n,...d,pbrMetallicRoughness:f,extras:e}};a.textureSampler=d=>({...m,...d});Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],
function(a){a.splitURI=function(c){let b,t;c.replace(/^(.*\/)?([^/]*)$/,(n,r,m)=>{b=r||"";t=m||"";return""});return{dirPart:b,filePart:t}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/Indices"],function(a,c,b){a.triangleFanToTriangles=function(t){var n="number"===typeof t?t:t.length;if(3>n)return new Uint16Array(0);n-=2;const r=65536>=n?new Uint16Array(3*
n):new Uint32Array(3*n);if("number"===typeof t){t=0;for(var m=0;m<n;++m)r[t++]=0,r[t++]=m+1,r[t++]=m+2;return r}m=t[0];let d=t[1],f=0;for(let e=0;e<n;++e){const g=t[e+2];r[f++]=m;r[f++]=d;d=r[f++]=g}return r};a.triangleStripToTriangles=function(t){var n="number"===typeof t?t:t.length;if(3>n)return[];n-=2;const r=b.newIndexArray(n);if("number"===typeof t){t=0;for(var m=0;m<n;m+=1)0===m%2?(r[t++]=m,r[t++]=m+1):(r[t++]=m+1,r[t++]=m),r[t++]=m+2}else{m=0;for(let g=0;g<n;g+=1)if(0===g%2){var d=t[g],f=t[g+
1],e=t[g+2];r[m++]=d;r[m++]=f;r[m++]=e}else d=t[g+1],f=t[g],e=t[g+2],r[m++]=d,r[m++]=f,r[m++]=e}return r};a.trianglesToTriangles=function(t,n=b.generateDefaultIndexArray){return"number"===typeof t?n(t):c.isUint16Array(t)||c.isUint8Array(t)?new Uint32Array(t):t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ProcessedObjectResource":function(){define(["exports"],function(a){let c=function(){this.geometries=[];this.materials=[];this.textures=[]};a.ProcessedObjectResource=
function(b,t,n){this.name=b;this.lodThreshold=t;this.pivotOffset=n;this.stageResources=new c;this.numberOfVertices=0};a.ProcessedObjectStageResources=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/NestedMap ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B){function A(){A=c._asyncToGenerator(function*(P,I){P=yield x(P,I);I=yield E(P.textureDefinitions??{},I);let G=0;for(const H in I)if(I.hasOwnProperty(H)){const L=I[H];G+=L?.image?L.image.width*L.image.height*4:0}return{resource:P,textures:I,size:G+n.estimateNestedObjectSize(P)}});return A.apply(this,arguments)}function x(P,I){return u.apply(this,arguments)}function u(){u=c._asyncToGenerator(function*(P,I){const G=d.isSome(I)&&I.streamDataRequester;if(G)return y(P,
G,I);P=yield t.result(b(P,d.unwrap(I)));if(!0===P.ok)return P.value.data;e.throwIfAbortError(P.error);D(P.error)});return u.apply(this,arguments)}function y(P,I,G){return w.apply(this,arguments)}function w(){w=c._asyncToGenerator(function*(P,I,G){P=yield t.result(I.request(P,"json",G));if(!0===P.ok)return P.value;e.throwIfAbortError(P.error);D(P.error.details.url)});return w.apply(this,arguments)}function D(P){throw new r("",`Request for object resource failed: ${P}`);}function F(P){const I=l.empty();
P.forEach(G=>{G=G.boundingInfo;d.isSome(G)&&(l.expandWithVec3(I,G.bbMin),l.expandWithVec3(I,G.bbMax))});return I}function E(P,I){return K.apply(this,arguments)}function K(){K=c._asyncToGenerator(function*(P,I){const G=[];for(const O in P){var H=P[O],L=H.images[0].data;if(!L){M.warn("Externally referenced texture data is not yet supported");continue}L=H.encoding+";base64,"+L;const S="/textureDefinitions/"+O,R="rgba"===H.channels?H.alphaChannelUsage||"transparency":"none",Q={noUnpackFlip:!0,wrap:{s:B.TextureWrapMode.REPEAT,
t:B.TextureWrapMode.REPEAT},preMultiplyAlpha:J(R)!==k.AlphaDiscardMode.Opaque};H=d.isSome(I)&&I.disableTextures?Promise.resolve(null):v.requestImage(L,I);G.push(H.then(V=>({refId:S,image:V,params:Q,alphaChannelUsage:R})))}P=yield Promise.all(G);I={};for(const O of P)I[O.refId]=O;return I});return K.apply(this,arguments)}function J(P){switch(P){case "mask":return k.AlphaDiscardMode.Mask;case "maskAndTransparency":return k.AlphaDiscardMode.MaskBlend;case "none":return k.AlphaDiscardMode.Opaque;case "transparency":return k.AlphaDiscardMode.Blend;
default:return k.AlphaDiscardMode.Blend}}const M=m.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),N=new g.Version(1,2,"wosr");a.createTextureResources=E;a.load=function(P,I){return A.apply(this,arguments)};a.processLoadResult=function(P,I){const G=[],H=[],L=[],O=new f.NestedMap,S=P.resource;var R=g.Version.parse(S.version||"1.0","wosr");N.validate(R);R=S.model.name;const Q=S.model.geometries,V=S.materialDefinitions??{};P=P.textures;let aa=0;const X=new Map;for(let ja=0;ja<Q.length;ja++){var W=
Q[ja],T=W,U=T.params,Y=U.topology,ba=!0;U.vertexAttributes||(M.warn("Geometry must specify vertex attributes"),ba=!1);switch(U.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:Y=U.faces;if(!Y)M.warn("Indexed geometries must specify faces"),ba=!1;else if(U.vertexAttributes)for(const ia in U.vertexAttributes)(U=Y[ia])&&U.values?(null!=U.valueType&&"UInt32"!==U.valueType&&(M.warn(`Unsupported indexed geometry indices type '${U.valueType}', only UInt32 is currently supported`),
ba=!1),null!=U.valuesPerElement&&1!==U.valuesPerElement&&(M.warn(`Unsupported indexed geometry values per element '${U.valuesPerElement}', only 1 is currently supported`),ba=!1)):(M.warn(`Indexed geometry does not specify face indices for '${ia}' attribute`),ba=!1);break;default:M.warn(`Unsupported topology '${Y}'`),ba=!1}T.params.material||(M.warn("Geometry requires material"),ba=!1);T=T.params.vertexAttributes;for(const ia in T)T[ia].values||(M.warn("Geometries with externally defined attributes are not yet supported"),
ba=!1);if(ba){ba=W.params;Y=ba.material;U=ba.texture;T=W.params.vertexAttributes;ba=[];for(const ia in T){var da=T[ia];ba.push([ia,new q.Attribute(da.values,da.valuesPerElement,!0)])}T=[];if("PerAttributeArray"!==W.params.topology){W=W.params.faces;for(const ia in W)T.push([ia,W[ia].values])}W=U;if((U=P&&P[W])&&!X.has(W)){const {image:ia,params:Z}=U;da=new z.Texture(ia,Z);H.push(da);X.set(W,da)}da=(da=X.get(W))?da.id:void 0;var ea=O.get(Y,W);if(d.isNone(ea)){ea=Y.substring(Y.lastIndexOf("/")+1);ea=
V[ea].params;1===ea.transparency&&(ea.transparency=0);var ca=U&&U.alphaChannelUsage;ca=0<ea.transparency||"transparency"===ca||"maskAndTransparency"===ca;const ia=U?J(U.alphaChannelUsage):void 0;U={ambient:h.fromArray(ea.diffuse),diffuse:h.fromArray(ea.diffuse),opacity:1-(ea.transparency||0),transparent:ca,textureAlphaMode:ia,textureAlphaCutoff:.33,textureId:da,initTextureTransparent:!0,doubleSided:!0,cullFace:k.CullFaceOptions.None,colorMixMode:ea.externalColorMixMode||"tint",textureAlphaPremultiplied:U?
!!U.params.preMultiplyAlpha:!1};d.isSome(I)&&I.materialParamsMixin&&Object.assign(U,I.materialParamsMixin);ea=new C.DefaultMaterial(U);O.set(Y,W,ea)}L.push(ea);ba=new p.Geometry(ea,ba,T);aa+=T.position?T.position.length:0;G.push(ba)}}return{engineResources:[{name:R,stageResources:{textures:H,materials:L,geometries:G},pivotOffset:S.model.pivotOffset,numberOfVertices:aa,lodThreshold:null}],referenceBoundingBox:F(G)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],
function(a){a.COLOR_GAMMA=2.1;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ../../core/shaderLibrary/ShaderOutput ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderSlot ../Util ../VertexAttribute ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../support/Scheduler ../../../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G){function H(T,U,Y){const ba=T.allocateHead();T=T.view;N.encodeDoubleVec3(U.modelOrigin,Y,T.modelOriginHi,T.modelOriginLo,ba);T.model.copyFrom(ba,U.model,Y);T.modelNormal.copyFrom(ba,U.modelNormal,Y);U.color&&T.color&&T.color.copyFrom(ba,U.color,Y);U.objectAndLayerIdColor&&T.objectAndLayerIdColor&&T.objectAndLayerIdColor.copyFrom(ba,U.objectAndLayerIdColor,Y);U.featureAttribute&&T.featureAttribute&&T.featureAttribute.copyFrom(ba,
U.featureAttribute,Y)}function L(T){let U=p.newLayout().vec3f(w.VertexAttribute.MODELORIGINHI).vec3f(w.VertexAttribute.MODELORIGINLO).mat3f(w.VertexAttribute.MODEL).mat3f(w.VertexAttribute.MODELNORMAL);n.isSome(T)&&T.includes("color")&&(U=U.vec4f(w.VertexAttribute.INSTANCECOLOR));n.isSome(T)&&T.includes("featureAttribute")&&(U=U.vec4f(w.VertexAttribute.INSTANCEFEATUREATTRIBUTE));n.isSome(T)&&T.includes("objectAndLayerIdColor")&&(U=U.vec4u8(w.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED));return U}
const O=T=>{const U=T.baseBoundingSphere.radius;T=T.levels.map(Y=>Y.minScreenSpaceRadius);return new E.LevelSelector(U,T)};a.LodRenderer=function(T){function U(ba,da){var ea=T.call(this,ba)||this;ea.type=A.IntersectorType.LOD;ea.isGround=!1;ea._levels=[];ea._defaultRenderInstanceData=[];ea._highlightRenderInstanceData=[];ea._instanceIndex=0;ea._cycleStartIndex=0;ea._slicePlane=!1;ea._camera=new C.Camera;ea._updateCyclesWithStaticCamera=-1;ea._needFullCycle=!1;ea.slots=[u.RenderSlot.OPAQUE_MATERIAL,
u.RenderSlot.TRANSPARENT_MATERIAL];ea.canRender=!0;ea._instanceData=new D.InstanceData({shaderTransformation:ba.shaderTransformation},ba.optionalFields);ea._frameTask=da.registerTask(I.TaskPriority.LOD_RENDERER,c._assertThisInitialized(ea));return ea}c._inheritsLoose(U,T);var Y=U.prototype;Y.initialize=function(){this._instanceBufferLayout=L(this.optionalFields);this._glInstanceBufferLayout=k.glLayout(this._instanceBufferLayout,1);this._instanceData.events.on("instances-changed",()=>this._requestUpdateCycle());
this._instanceData.events.on("instance-transform-changed",({index:ba})=>{this._requestUpdateCycle();this.metadata.notifyGraphicGeometryChanged(ba)});this._instanceData.events.on("instance-visibility-changed",({index:ba})=>{this._requestUpdateCycle(!0);this.metadata.notifyGraphicVisibilityChanged(ba)});this._instanceData.events.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0))};Y.destroy=function(){this._frameTask.remove()};Y.initializeRenderContext=function(){var ba=c._asyncToGenerator(function*(da,
ea){this._context=da;const ca=da.renderContext.rctx,ja=yield Promise.allSettled(this.symbol.levels.map(Z=>{this._defaultRenderInstanceData.push(new J.RenderInstanceData(ca,this._instanceBufferLayout));this._highlightRenderInstanceData.push(new J.RenderInstanceData(ca,this._instanceBufferLayout));return K.LodLevel.create(da,Z,ea)})),ia=ja.map(Z=>"fulfilled"===Z.status?Z.value:null).filter(n.isSome);if(r.isAborted(ea)||ia.length!==ja.length){ia.forEach(Z=>Z.destroy());r.throwIfAborted(ea);for(const Z of ja)if("rejected"===
Z.status)throw Z.reason;}this._levels=ia;this._levelSelector=O(this)});return function(da,ea){return ba.apply(this,arguments)}}();Y.uninitializeRenderContext=function(){this._invalidateOctree();this._levels.forEach(ba=>ba.destroy());this._defaultRenderInstanceData.forEach(ba=>ba.destroy());this._highlightRenderInstanceData.forEach(ba=>ba.destroy())};Y.prepareRender=function(ba){if(!q.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){const da=ba.bindParameters.contentCamera.equals(this._camera);
this._camera.copyFrom(ba.bindParameters.contentCamera);da||this._requestUpdateCycle()}this._needFullCycle&&(this.runTask(I.noBudget),this._needFullCycle=!1)}};Y.render=function(ba){this.baseMaterial.isVisible()&&this.baseMaterial.isVisibleForOutput(ba.output)&&(ba.rctx.bindVAO(),ba.output!==z.ShaderOutput.Highlight&&ba.output!==z.ShaderOutput.ShadowHighlight&&this._renderComponents(ba,this._defaultRenderInstanceData),ba.output!==z.ShaderOutput.ShadowExcludeHighlight&&this._renderComponents(ba,this._highlightRenderInstanceData))};
Y.intersect=function(ba,da,ea,ca){if(this.baseMaterial.isVisible()&&!n.isNone(this._octree)){var ja=l.create();h.subtract(ja,ca,ea);var ia=Z=>{this._instanceData.getCombinedModelTransform(Z,Q);ba.transform.set(Q);h.transformMat4(V,ea,ba.transform.inverse);h.transformMat4(aa,ca,ba.transform.inverse);const ha=this._instanceData.getState(Z),fa=this._instanceData.getLodLevel(Z),ka=this._levels.length;y.assert(0!==(ha&D.StateFlags.ACTIVE),"invalid instance state");y.assert(0<=fa&&fa<ka,"invaid lod level");
this._levels[fa].intersect(ba,da,V,aa,Z,this.metadata,ka)};this.baseMaterial.parameters.verticalOffset?this._octree.forEach(ia):this._octree.forEachAlongRay(ea,ja,ia)}};Y.queryDepthRange=function(ba){return this._queryDepthRangeOctree(ba)};Y.notifyShaderTransformationChanged=function(){this._invalidateOctree();this._requestUpdateCycle()};Y._invalidateOctree=function(){this._octreeCached=n.destroyMaybe(this._octreeCached)};Y._queryDepthRangeOctree=function(ba){if(n.isNone(this._octree))return{near:Infinity,
far:-Infinity};var da=ba.viewForward,ea=this._octree.findClosest(da,x.DepthOrder.FRONT_TO_BACK,ba.frustum);const ca=this._octree.findClosest(da,x.DepthOrder.BACK_TO_FRONT,ba.frustum);if(null==ea||null==ca)return{near:Infinity,far:-Infinity};const ja=ba.eye,ia=this._instanceData.view;ia.boundingSphere.getVec(ea,R);h.subtract(R,R,ja);ea=h.dot(R,da)-R[3];ia.boundingSphere.getVec(ca,R);h.subtract(R,R,ja);da=h.dot(R,da)+R[3];return{near:Math.max(ba.near,ea),far:Math.min(ba.far,da)}};Y._requestUpdateCycle=
function(ba=!1){this._updateCyclesWithStaticCamera=-1;this._cycleStartIndex=this._instanceIndex;ba&&(this._needFullCycle=!0,this._context.requestRender())};Y._startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._defaultRenderInstanceData.forEach(ba=>ba.startUpdateCycle());this._highlightRenderInstanceData.forEach(ba=>ba.startUpdateCycle())};Y.runTask=function(ba){const {_enableLevelSelection:da,_camera:ea,_levelSelector:ca}=this;this._defaultRenderInstanceData.forEach(na=>na.beginUpdate());
this._highlightRenderInstanceData.forEach(na=>na.beginUpdate());const ja=this._instanceData,ia=ja.view;let Z=ja.size;const ha=ja.capacity;let fa=this._instanceIndex;for(let na=0;na<Z&&!ba.done;++na){fa===this._cycleStartIndex&&this._startUpdateCycle();const pa=ia.state.get(fa);var ka=0;if(pa&D.StateFlags.ALLOCATED){var la=ia.lodLevel.get(fa);pa&D.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[la].freeTail();pa&D.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[la].freeTail();
pa&D.StateFlags.REMOVE?ja.freeInstance(fa):pa&D.StateFlags.VISIBLE?(la=0,da&&(ia.modelOrigin.getVec(fa,S),la=ca.selectLevel(S,ja.getCombinedMedianScaleFactor(fa),ea)),ka=pa&~(D.StateFlags.ACTIVE|D.StateFlags.TRANSFORM_CHANGED),0<=la&&(pa&D.StateFlags.HIGHLIGHT?(H(this._highlightRenderInstanceData[la],ia,fa),ka|=D.StateFlags.HIGHLIGHT_ACTIVE):(H(this._defaultRenderInstanceData[la],ia,fa),ka|=D.StateFlags.DEFAULT_ACTIVE)),ia.state.set(fa,ka),ia.lodLevel.set(fa,la)):(ka=pa&~(D.StateFlags.ACTIVE|D.StateFlags.TRANSFORM_CHANGED),
ia.state.set(fa,ka));n.isSome(this._octreeCached)&&(la=!!(pa&D.StateFlags.ACTIVE),ka=!!(ka&D.StateFlags.ACTIVE),!la&&ka?this._octreeCached.addInstance(fa):la&&!ka?this._octreeCached.removeInstance(fa):la&&ka&&pa&D.StateFlags.TRANSFORM_CHANGED&&(this._octreeCached.removeInstance(fa),this._octreeCached.addInstance(fa)));fa=fa+1===ha?0:fa+1;ba.madeProgress()}else fa=fa+1===ha?0:fa+1,Z++}this._instanceIndex=fa;this._defaultRenderInstanceData.forEach(na=>na.endUpdate());this._highlightRenderInstanceData.forEach(na=>
na.endUpdate());this._context.requestRender()};Y._renderComponents=function(ba,da){this.levels.forEach((ea,ca)=>{const ja=ea.components.map(ia=>this._beginComponent(ba,da[ca],ia));ea.components.forEach((ia,Z)=>this._renderComponent(ba,ja[Z],da[ca],ia,ca))})};Y._beginComponent=function(ba,da,ea){const {bindParameters:ca,rctx:ja,output:ia}=ba;if(0===da.size||!ea.material.requiresSlot(ca.slot,ba.output))return null;ba=ea.glMaterials.load(ja,ca.slot,ia);return n.isSome(ba)?ba.beginSlot(ca):null};Y._renderComponent=
function(ba,da,ea,ca,ja){if(!n.isNone(da)){var {bindParameters:ia,rctx:Z}=ba,ha=Z.bindTechnique(da,ca.material.parameters,ia);Z.bindVAO(ca.vao);da.ensureAttributeLocations(ca.vao);ha.bindDraw(W,ia,ca.material.parameters);q.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&ba.output===z.ShaderOutput.Color&&(ha.setUniform4fv("externalColor",X[Math.min(ja,X.length-1)]),ha.setUniform1i("colorMixMode",M.colorMixModes.replace));var fa=Z.capabilities.instancing;ba=ea.capacity;ja=ea.headIndex;ha=ea.tailIndex;var ka=
ea.firstIndex,la=this._glInstanceBufferLayout,na=(pa,va)=>{G.bindVertexBufferLayout(Z,B.Default3D,ea.buffer,la,pa);fa.drawArraysInstanced(da.primitiveType,0,ca.vertexCount,va-pa);G.unbindVertexBufferLayout(Z,B.Default3D,ea.buffer,la)};ca.material.parameters.transparent&&null!=ka?ja>ha?(y.assert(ka>=ha&&ka<=ja,"invalid firstIndex"),na(ka,ja),na(ha,ka)):ja<ha&&(ka<=ja?(y.assert(0<=ka&&ka<=ja,"invalid firstIndex"),na(ka,ja),na(ha,ba),na(0,ka)):(y.assert(ka>=ha&&ka<=ba,"invalid firstIndex"),na(ka,ba),
na(0,ja),na(ha,ka))):ja>ha?na(ha,ja):ja<ha&&(na(0,ja),na(ha,ba));Z.bindVAO(null)}};c._createClass(U,[{key:"_enableLevelSelection",get:function(){return 1<this.symbol.levels.length}},{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-
1].components[0].material}},{key:"slicePlaneEnabled",get:function(){return this._slicePlane},set:function(ba){this._slicePlane=ba}},{key:"layerUid",get:function(){return this.metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){const ba={cpu:0,gpu:0};this._defaultRenderInstanceData.forEach(da=>{da=da.memoryUsage;ba.cpu+=da.cpu;ba.gpu+=da.gpu});this._highlightRenderInstanceData.forEach(da=>{da=da.memoryUsage;ba.cpu+=da.cpu;ba.gpu+=da.gpu});
return ba}},{key:"renderStats",get:function(){const ba=this._instanceData.size,da=[];this._levels.forEach((ea,ca)=>{ca=this._defaultRenderInstanceData[ca].size+this._highlightRenderInstanceData[ca].size;ea=ea.triangleCount;da.push({renderedInstances:ca,renderedTriangles:ca*ea,trianglesPerInstance:ea})});return{totalInstances:ba,renderedInstances:da.reduce((ea,ca)=>ea+ca.renderedInstances,0),renderedTriangles:da.reduce((ea,ca)=>ea+ca.renderedTriangles,0),levels:da}}},{key:"needsTransparentPass",get:function(){return this._levels.some(ba=>
ba.components.some(da=>da.material.requiresSlot(u.RenderSlot.TRANSPARENT_MATERIAL,z.ShaderOutput.Color)))}},{key:"needsHighlight",get:function(){return this._highlightRenderInstanceData.some(ba=>0<ba.size)}},{key:"_octree",get:function(){if(n.isNone(this._octreeCached)){const ba=this._instanceData,da=ba.view?.state;if(!da)return null;this._octreeCached=new F.InstanceOctree(ba,this.baseBoundingSphere);for(let ea=0;ea<ba.capacity;++ea)da.get(ea)&D.StateFlags.ACTIVE&&this._octreeCached.addInstance(ea)}return this._octreeCached}},
{key:"running",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}}]);return U}(t);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"symbol",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"optionalFields",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"metadata",void 0);b.__decorate([m.property({constructOnly:!0})],a.LodRenderer.prototype,"shaderTransformation",void 0);b.__decorate([m.property()],
a.LodRenderer.prototype,"_instanceData",void 0);b.__decorate([m.property()],a.LodRenderer.prototype,"_cycleStartIndex",void 0);b.__decorate([m.property({readOnly:!0})],a.LodRenderer.prototype,"_enableLevelSelection",null);b.__decorate([m.property()],a.LodRenderer.prototype,"_updateCyclesWithStaticCamera",void 0);b.__decorate([m.property({readOnly:!0})],a.LodRenderer.prototype,"running",null);a.LodRenderer=b.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.lodRendering.LodRenderer")],a.LodRenderer);
const S=l.create(),R=v.create(),Q=g.create(),V=l.create(),aa=l.create(),X=[v.fromValues(1,0,1,1),v.fromValues(0,0,1,1),v.fromValues(0,1,0,1),v.fromValues(1,1,0,1),v.fromValues(1,0,0,1)],W=new P.DefaultMaterialDrawParameters;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/Evented ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A){a.StateFlags=void 0;(function(F){F[F.ALLOCATED=1]="ALLOCATED";F[F.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";F[F.VISIBLE=4]="VISIBLE";F[F.HIGHLIGHT=8]="HIGHLIGHT";F[F.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";F[F.REMOVE=32]="REMOVE";F[F.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";F[F.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let x=function(F){this.localTransform=F.getField(A.VertexAttribute.LOCALTRANSFORM,p.BufferViewMat4f64);this.globalTransform=
F.getField(A.VertexAttribute.GLOBALTRANSFORM,p.BufferViewMat4f64);this.modelOrigin=F.getField(A.VertexAttribute.MODELORIGIN,p.BufferViewVec3f64);this.model=F.getField(A.VertexAttribute.MODEL,p.BufferViewMat3f);this.modelNormal=F.getField(A.VertexAttribute.MODELNORMAL,p.BufferViewMat3f);this.modelScaleFactors=F.getField(A.VertexAttribute.MODELSCALEFACTORS,p.BufferViewVec2f);this.boundingSphere=F.getField(A.VertexAttribute.BOUNDINGSPHERE,p.BufferViewVec4f64);this.color=F.getField(A.VertexAttribute.COLOR,
p.BufferViewVec4f);this.featureAttribute=F.getField(A.VertexAttribute.FEATUREATTRIBUTE,p.BufferViewVec4f);this.state=F.getField(A.VertexAttribute.STATE,p.BufferViewUint8);this.lodLevel=F.getField(A.VertexAttribute.LODLEVEL,p.BufferViewUint8);this.objectAndLayerIdColor=F.getField(A.VertexAttribute.OBJECTANDLAYERIDCOLOR,p.BufferViewVec4u8)};a.InstanceData=function(F){function E(J,M){J=F.call(this,J)||this;J.events=new n;J._capacity=0;J._size=0;J._next=0;J._buffer=null;J._view=null;let N=C.newLayout().mat4f64(A.VertexAttribute.LOCALTRANSFORM).mat4f64(A.VertexAttribute.GLOBALTRANSFORM).vec4f64(A.VertexAttribute.BOUNDINGSPHERE).vec3f64(A.VertexAttribute.MODELORIGIN).mat3f(A.VertexAttribute.MODEL).mat3f(A.VertexAttribute.MODELNORMAL).vec2f(A.VertexAttribute.MODELSCALEFACTORS);
M.includes("color")&&(N=N.vec4f(A.VertexAttribute.COLOR));M.includes("featureAttribute")&&(N=N.vec4f(A.VertexAttribute.FEATUREATTRIBUTE));N=N.u8(A.VertexAttribute.STATE).u8(A.VertexAttribute.LODLEVEL);M.includes(A.VertexAttribute.OBJECTANDLAYERIDCOLOR)&&(N=N.vec4u8(A.VertexAttribute.OBJECTANDLAYERIDCOLOR));N.alignTo(8);J._layout=N;return J}c._inheritsLoose(E,F);var K=E.prototype;K.addInstance=function(){this._size+1>this._capacity&&this._grow();const J=this._findSlot();this._view.state.set(J,a.StateFlags.ALLOCATED);
this._size++;this.events.emit("instances-changed");return J};K.removeInstance=function(J){const M=this._view.state;B.assert(0<=J&&J<this._capacity&&0!==(M.get(J)&a.StateFlags.ALLOCATED),"invalid instance handle");this._getStateFlag(J,a.StateFlags.ACTIVE)?this._setStateFlags(J,a.StateFlags.REMOVE):this.freeInstance(J);this.events.emit("instances-changed")};K.freeInstance=function(J){const M=this._view.state;B.assert(0<=J&&J<this._capacity&&0!==(M.get(J)&a.StateFlags.ALLOCATED),"invalid instance handle");
M.set(J,0);this._size--};K.setLocalTransform=function(J,M,N=!0){this._view.localTransform.setMat(J,M);N&&this.updateModelTransform(J)};K.getLocalTransform=function(J,M){this._view.localTransform.getMat(J,M)};K.setGlobalTransform=function(J,M,N=!0){this._view.globalTransform.setMat(J,M);N&&this.updateModelTransform(J)};K.getGlobalTransform=function(J,M){this._view.globalTransform.getMat(J,M)};K.updateModelTransform=function(J){const M=this._view;var N=u;const P=y;M.localTransform.getMat(J,w);M.globalTransform.getMat(J,
D);const I=l.multiply(D,D,w);q.set(N,I[12],I[13],I[14]);M.modelOrigin.setVec(J,N);g.fromMat4(P,I);M.model.setMat(J,P);N=z.scaleFromMatrix(u,I);N.sort();M.modelScaleFactors.set(J,0,N[1]);M.modelScaleFactors.set(J,1,N[2]);g.invert(P,P);g.transpose(P,P);M.modelNormal.setMat(J,P);this._setStateFlags(J,a.StateFlags.TRANSFORM_CHANGED);this.events.emit("instance-transform-changed",{index:J})};K.getModelTransform=function(J,M){const N=this._view;N.model.getMat(J,y);N.modelOrigin.getVec(J,u);M[0]=y[0];M[1]=
y[1];M[2]=y[2];M[3]=0;M[4]=y[3];M[5]=y[4];M[6]=y[5];M[7]=0;M[8]=y[6];M[9]=y[7];M[10]=y[8];M[11]=0;M[12]=u[0];M[13]=u[1];M[14]=u[2];M[15]=1};K.applyShaderTransformation=function(J,M){r.isSome(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,J,M)};K.getCombinedModelTransform=function(J,M){this.getModelTransform(J,M);r.isSome(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,J,M);return M};K.getCombinedLocalTransform=function(J,M){this._view.localTransform.getMat(J,
M);r.isSome(this.shaderTransformation)&&this.shaderTransformation.applyTransform(this,J,M);return M};K.getCombinedMaxScaleFactor=function(J){let M=this._view.modelScaleFactors.get(J,1);r.isSome(this.shaderTransformation)&&(J=this.shaderTransformation.scaleFactor(u,this,J),M*=Math.max(J[0],J[1],J[2]));return M};K.getCombinedMedianScaleFactor=function(J){let M=this._view.modelScaleFactors.get(J,0);if(r.isSome(this.shaderTransformation)){const P=this.shaderTransformation.scaleFactor(u,this,J);J=P[0];
var N=P[1];M*=Math.max(Math.min(J,N),Math.min(Math.max(J,N),P[2]))}return M};K.getModel=function(J,M){this._view.model.getMat(J,M)};K.setFeatureAttribute=function(J,M){this._view.featureAttribute.setVec(J,M)};K.getFeatureAttribute=function(J,M){this._view.featureAttribute.getVec(J,M)};K.setColor=function(J,M){this._view.color.setVec(J,M)};K.setObjectAndLayerIdColor=function(J,M){this._view.objectAndLayerIdColor.setVec(J,M)};K.getColor=function(J,M){this._view.color.getVec(J,M)};K.setVisible=function(J,
M){M!==this.getVisible(J)&&(this._setStateFlag(J,a.StateFlags.VISIBLE,M),this.events.emit("instance-visibility-changed",{index:J}))};K.getVisible=function(J){return this._getStateFlag(J,a.StateFlags.VISIBLE)};K.setHighlight=function(J,M){M!==this.getHighlight(J)&&(this._setStateFlag(J,a.StateFlags.HIGHLIGHT,M),this.events.emit("instance-highlight-changed"))};K.getHighlight=function(J){return this._getStateFlag(J,a.StateFlags.HIGHLIGHT)};K.getState=function(J){return this._view.state.get(J)};K.getLodLevel=
function(J){return this._view.lodLevel.get(J)};K.countFlags=function(J){let M=0;for(let N=0;N<this._capacity;++N)this.getState(N)&J&&++M;return M};K._setStateFlags=function(J,M){const N=this._view.state;M|=N.get(J);N.set(J,M)};K._clearStateFlags=function(J,M){const N=this._view.state;M=N.get(J)&~M;N.set(J,M)};K._setStateFlag=function(J,M,N){N?this._setStateFlags(J,M):this._clearStateFlags(J,M)};K._getStateFlag=function(J,M){return!!(this._view.state.get(J)&M)};K._grow=function(){const J=Math.max(1024,
Math.floor(2*this._capacity)),M=this._layout.createBuffer(J);if(this._buffer){const N=new Uint8Array(this._buffer.buffer);(new Uint8Array(M.buffer)).set(N)}this._capacity=J;this._buffer=M;this._view=new x(this._buffer)};K._findSlot=function(){const J=this._view.state;let M=this._next;for(;J.get(M)&a.StateFlags.ALLOCATED;)M=M+1===this._capacity?0:M+1;this._next=M+1===this._capacity?0:M+1;return M};c._createClass(E,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},
{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}}]);return E}(t);b.__decorate([m.property({constructOnly:!0})],a.InstanceData.prototype,"shaderTransformation",void 0);b.__decorate([m.property()],a.InstanceData.prototype,"_size",void 0);b.__decorate([m.property({readOnly:!0})],a.InstanceData.prototype,"size",null);a.InstanceData=b.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.lodRendering.InstanceData")],a.InstanceData);const u=k.create(),
y=h.create(),w=v.create(),D=v.create();a.InstanceDataView=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(a,c,b,t,n,r,m){m=function(d){function f(g,h){var l=d.call(this,v=>n.wrap(l._instanceData.view.boundingSphere.getVec(v,
l._tmpSphere)),{maximumDepth:25})||this;l._tmpSphere=n.create();l._tmpMat4=b.create();l._instanceData=g;l._boundingSphere=h;return l}c._inheritsLoose(f,d);var e=f.prototype;e.addInstance=function(g){const h=this._instanceData.view.boundingSphere,l=this._instanceData.getCombinedModelTransform(g,this._tmpMat4);t.transformMat4(this._tmpSphere,this._boundingSphere.center,l);this._tmpSphere[3]=this._boundingSphere.radius*r.maxScale(l);h.setVec(g,this._tmpSphere);this.add([g])};e.removeInstance=function(g){this.remove([g])};
return f}(m);a.InstanceOctree=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports"],function(a){let c=function(){function b(t,n){this._worldSpaceRadius=t;this._minScreenSpaceRadii=n}b.prototype.selectLevel=function(t,n,r){t=r.computeScreenPixelSizeAt(t);n=this._worldSpaceRadius*n/t;t=0;for(r=1;r<this._minScreenSpaceRadii.length;++r)n>=this._minScreenSpaceRadii[r]&&(t=r);return t};return b}();a.LevelSelector=
c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),function(a,c,b,t,n,r,m){let d=function(){function f(g,h){this.minScreenSpaceRadius=g;this.components=h}f.create=function(){var g=c._asyncToGenerator(function*(h,
l,v){const q=yield Promise.allSettled(l.components.map(p=>h.controller.schedule(()=>new m.LodComponentData(h,p),v))),k=q.map(p=>"fulfilled"===p.status?p.value:null).filter(b.isSome);if(t.isAborted(v)||k.length!==q.length){k.forEach(p=>p.destroy());t.throwIfAborted(v);for(const p of q)if("rejected"===p.status)throw p.reason;}return new f(l.minScreenSpaceRadius,k)});return function(h,l,v){return g.apply(this,arguments)}}();var e=f.prototype;e.destroy=function(){this.components.forEach(g=>g.destroy())};
e.intersect=function(g,h,l,v,q,k,p){this.components.forEach(z=>z.intersect(g,h,l,v,q,k,this.boundingSphere,p))};c._createClass(f,[{key:"boundingBox",get:function(){if(b.isNone(this._boundingBox)){const g=r.empty();this.components.forEach(h=>{b.isSome(h.boundingInfo)&&(r.expandWithVec3(g,h.boundingInfo.bbMin),r.expandWithVec3(g,h.boundingInfo.bbMax))});this._boundingBox=g}return this._boundingBox}},{key:"boundingSphere",get:function(){if(b.isNone(this._boundingSphere)){const g=this.boundingBox,h=n.create();
r.center(g,h);this._boundingSphere={center:h,radius:.5*r.diameter(g)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((g,h)=>g+h.triangleCount,0)}}]);return f}();a.LodLevel=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../VertexArrayObject ./Intersector ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){let h=function(){function l(q,k){const p=q.renderContext.rctx;k=k.geometry;this._materialRepository=q.materialRepository;k.material.setParameters({instancedDoublePrecision:!0});q=k.material.createBufferWriter();const z=q.vertexBufferLayout,C=q.elementCount(k),B=q.allocate(C);q.write(null,null,k,B,0);this.geometry=k;this.material=k.material;this.glMaterials=new n.GLMaterials(k.material,this._materialRepository);this.vertexBufferLayout=z;this.vbo=e.BufferObject.createVertex(p,
g.Usage.STATIC_DRAW,B.buffer);this.vao=new d.VertexArrayObject(p,t.Default3D,{geometry:b.glLayout(z)},{geometry:this.vbo});this.vertexCount=C}var v=l.prototype;v.destroy=function(){this.glMaterials.destroy();this.vbo.dispose();this.vao.dispose()};v.intersect=function(q,k,p,z,C,B,A,x){const u=this.geometry.id;this.material.intersect(this.geometry,q.transform.transform,q,p,z,(y,w,D,F,E)=>{0<=y&&(null==k||k(q.rayBegin,q.rayEnd,y))&&(D=new f.LodTarget(B.layerUid,B.graphicUid(C),u,D,A,x),(null==q.results.min.drapedLayerOrder||
E>=q.results.min.drapedLayerOrder)&&(null==q.results.min.dist||y<q.results.min.dist)&&q.results.min.set(m.IntersectorType.LOD,D,y,w,q.transform.transform,E),q.options.store!==m.StoreResults.MIN&&(null==q.results.max.drapedLayerOrder||E>=q.results.max.drapedLayerOrder)&&(null==q.results.max.dist||y>q.results.max.dist)&&q.results.max.set(m.IntersectorType.LOD,D,y,w,q.transform.transform,E),q.options.store===m.StoreResults.ALL&&(F=r.newIntersectorResult(q.results.min.ray),F.set(m.IntersectorType.LOD,
D,y,w,q.transform.transform,E),q.results.all.push(F)))})};c._createClass(l,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return l}();a.LodComponentData=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../IntersectorInterfaces","../IntersectorTarget","../intersectorUtils"],
function(a,c,b,t,n){t=function(r){function m(d,f,e,g,h,l){var v=r.call(this,d,f)||this;v.layerUid=d;v.graphicUid=f;v.geometryId=e;v.triangleNr=g;v.baseBoundingSphere=h;v.numLodLevels=l;return v}c._inheritsLoose(m,r);return m}(t.Graphic3DTarget);a.LodTarget=t;a.isLodIntersectorResult=function(r){return n.isValidIntersectorResult(r)&&r.intersector===b.IntersectorType.LOD&&!!r.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,c,b,t,n,r){let m=function(f){this.modelOriginHi=f.getField(n.VertexAttribute.MODELORIGINHI,b.BufferViewVec3f);this.modelOriginLo=f.getField(n.VertexAttribute.MODELORIGINLO,b.BufferViewVec3f);this.model=f.getField(n.VertexAttribute.MODEL,b.BufferViewMat3f);this.modelNormal=f.getField(n.VertexAttribute.MODELNORMAL,b.BufferViewMat3f);this.color=f.getField(n.VertexAttribute.INSTANCECOLOR,b.BufferViewVec4f);this.featureAttribute=f.getField(n.VertexAttribute.INSTANCEFEATUREATTRIBUTE,b.BufferViewVec4f);
this.objectAndLayerIdColor=f.getField(n.VertexAttribute.OBJECTANDLAYERIDCOLOR_INSTANCED,b.BufferViewVec4u8)},d=function(){function f(g,h){this._tailIndex=this._headIndex=0;this._firstIndex=null;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=g;this._instanceBufferLayout=h;this._elementSize=h.stride;this._capacity=1}var e=f.prototype;e.destroy=function(){this._buffer&&this._buffer.destroy()};e.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=
null};e.startUpdateCycle=function(){this._captureFirstIndex=!0};e.beginUpdate=function(){t.assert(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};e.endUpdate=function(){t.assert(this._updating,"not updating");this.size<.3*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};e.allocateHead=function(){t.assert(this._updating,"not updating");this.isFull&&
this._grow();const g=this.headIndex;this._captureFirstIndex&&(this._firstIndex=g,this._captureFirstIndex=!1);this._incrementHead();t.assert(this._headIndex!==this._tailIndex,"invalid pointers");return g};e.freeTail=function(){t.assert(this._updating,"not updating");t.assert(0<this.size,"invalid size");const g=this._tailIndex===this._firstIndex;this._incrementTail();g&&(this._firstIndex=this._tailIndex)};e._grow=function(){this._resize(Math.max(1024,Math.floor(2*this._capacity)))};e._shrink=function(){this._resize(Math.max(1024,
Math.floor(.5*this._capacity)))};e._resize=function(g){t.assert(this._updating,"not updating");if(g!==this._capacity){var h=new r(this._rctx,this._elementSize,g);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const l=this.size,v=this._compactInstances(h);t.assert(v===l,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=v;this._prevHeadIndex=0}this._resized=!0;this._capacity=g;this._buffer=h;this._view=
new m(this._instanceBufferLayout.createView(this._buffer.array))}};e._compactInstances=function(g){const h=this._headIndex,l=this._tailIndex;return l<h?(this._buffer.copyRange(l,h,g),h-l):l>h?(this._buffer.copyRange(l,this._capacity,g),0<h&&this._buffer.copyRange(0,h,g,this._capacity-l),h+(this._capacity-l)):0};e._incrementHead=function(g=1){this._headIndex=(this._headIndex+g)%this._capacity};e._incrementTail=function(g=1){this._tailIndex=(this._tailIndex+g)%this._capacity};e._transferRange=function(g,
h){g<h?this._buffer.transferRange(g,h):g>h&&(0<h&&this._buffer.transferRange(0,h),this._buffer.transferRange(g,this._capacity))};c._createClass(f,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const g=this._headIndex,h=this._tailIndex;return g>=h?g-h:g+this._capacity-h}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===
(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return f}();a.RenderInstanceData=d;a.RenderInstanceDataView=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,c,b){return function(){function t(r,m,d){this._elementSize=m;this._buffer=c.BufferObject.createVertex(r,b.Usage.STATIC_DRAW);this.resize(d)}var n=t.prototype;n.destroy=function(){this._buffer.dispose()};n.copyRange=function(r,m,d,f=0){r=new Uint8Array(this.array,r*this.elementSize,(m-r)*this.elementSize);(new Uint8Array(d.array,f*this.elementSize)).set(r)};n.transferAll=function(){this._buffer.setData(this._array)};n.transferRange=
function(r,m){r*=this._elementSize;m*=this._elementSize;this._buffer.setSubData(new Uint8Array(this._array),r,r,m)};n.resize=function(r){const m=r*this._elementSize,d=new ArrayBuffer(m);this._array&&(r>=this._capacity?(new Uint8Array(d)).set(new Uint8Array(this._array)):(new Uint8Array(d)).set((new Uint8Array(this._array)).subarray(0,r*this._elementSize)));this._array=d;this._buffer.setSize(m);this._capacity=r};a._createClass(t,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",
get:function(){return this._capacity}},{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return t}()})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/Error ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat2 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DPathSymbolLayerConstants ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/DoubleArray ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K){function J(R,Q,V){switch(Q){default:case D.UpVectorAlignment.World:for(var aa of R.vertices){e.add(H,aa.pos,R.offset);V.worldUpAtPosition(H,H);aa.setFrameFromUpVector(H);aa.rotationFrameUp=aa.frame.up;d.set(aa.rotationRight,1,0);e.scale(H,aa.frame.up,e.dot(aa.frame.up,aa.vLeft));e.subtract(H,aa.vLeft,H);e.negate(H,H);e.normalize(H,H);e.scale(L,aa.frame.up,e.dot(aa.frame.up,aa.vRight));e.subtract(L,aa.vRight,L);e.normalize(L,L);e.cross(O,
aa.rotationFrameUp,aa.vLeft);var X=Math.sign(e.dot(O,aa.vRight));aa.rotationAngle=X*(Math.PI-n.acosClamped(e.dot(H,L)));0<Math.abs(aa.rotationAngle)&&(X=n.reciprocalClamped(Math.cos(.5*aa.rotationAngle)),m.set(aa.miterStretch,1+(X-1),0,0,1));aa.maxStretchDistance=Math.abs(aa.vMinSiblingLength/Math.cos(.5*(Math.PI-aa.rotationAngle)))}break;case D.UpVectorAlignment.Path:e.add(H,R.vertices[0].pos,R.offset);V.worldUpAtPosition(H,H);F.computeMinimumRotationTangentFrame(R,H);for(X of R.vertices)R=Math.sign(e.dot(X.frame.right,
X.vRight)),e.cross(X.rotationFrameUp,X.vRight,X.vLeft),e.scale(X.rotationFrameUp,X.rotationFrameUp,R),e.normalize(X.rotationFrameUp,X.rotationFrameUp),V=e.dot(X.rotationFrameUp,X.frame.up),aa=e.dot(X.rotationFrameUp,X.frame.right),e.scale(H,X.frame.up,-aa),e.scale(L,X.frame.right,V),e.add(H,H,L),e.normalize(H,H),F.vertexSpaceToProfileSpace(X.rotationRight,X.frame,H),e.negate(H,X.vLeft),X.rotationAngle=-R*(Math.PI-n.acosClamped(e.dot(H,X.vRight))),0<Math.abs(X.rotationAngle)&&(R=n.reciprocalClamped(Math.cos(.5*
X.rotationAngle)),m.set(X.miterStretch,1+(R-1)*X.rotationRight[0]*X.rotationRight[0],(R-1)*X.rotationRight[0]*X.rotationRight[1],(R-1)*X.rotationRight[0]*X.rotationRight[1],1+(R-1)*X.rotationRight[1]*X.rotationRight[1])),X.maxStretchDistance=Math.abs(X.vMinSiblingLength*n.reciprocalClamped(Math.cos(.5*(Math.PI-X.rotationAngle))))}}function M(R,Q,V){switch(R){case "symbol-value":return V;case "proportional":return Q;default:return R}}function N(R,Q,V,aa,X){R=R.stageObject;Q=R.geometries;var W=0;I.spatialReference=
X.spatialReference;for(const ba of Q){if(!D.isPathGeometry(ba))continue;V=ba.path;const da=V.builder.path;G.spatialReference=ba.geometrySR;var T=da,U=aa,Y=X;let ea=0;for(const ca of T.vertices)U(ca.posES,S),ea+=S.sampledElevation,e.add(H,ca.pos,T.offset),Y.setAltitude(H,S.z),e.subtract(ca.pos,H,T.offset);T.updatePathVertexInformation();W+=ea/T.vertices.length;ba.upVectorAlignment!==D.UpVectorAlignment.World&&J(da,ba.upVectorAlignment,X);V.onPathChanged();ba.invalidateBoundingInfo();R.geometryVertexAttrsUpdated(ba)}return W/
Q.length}const P=["polyline"];b=function(R){function Q(aa,X,W,T){aa=R.call(this,aa,X,W,T)||this;aa._intrinsicSize=f.fromValues(1,1);aa._upVectorAlignment=D.UpVectorAlignment.Path;aa._stencilWidth=.1;aa.ensureDrapedStatus(!1);return aa}c._inheritsLoose(Q,R);var V=Q.prototype;V.doLoad=function(){var aa=c._asyncToGenerator(function*(){var X=r.isSome(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height;const W=r.isSome(this.symbolLayer.height)?this.symbolLayer.height:X;this._vvConvertOptions=
{modelSize:[1,1,1],symbolSize:[X,1,W],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?x.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};var T=this.symbolLayer.anchor||"center";this._upVectorAlignment=
"heading"===this.symbolLayer.profileRotation?D.UpVectorAlignment.World:D.UpVectorAlignment.Path;var U=this.symbolLayer.profile||"circle";switch(U){default:case "circle":this._profile=F.createCircleProfile(z.PATH_NUM_CIRCLE_PROFILE_SUBDIVISIONS);break;case "quad":this._profile=F.creatQuadProfile()}var Y=[0,0];"center"!==T&&(Y={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[T],this._profile.translate(Y[0],Y[1]));switch(this.symbolLayer.join){case "round":this._extruder=new F.MiterExtruder(0,z.PATH_NUM_ROUND_JOIN_SUBDIVISIONS);
break;case "bevel":this._extruder=new F.MiterExtruder(0,1);break;case "miter":this._extruder=new F.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new F.SimpleExtruder}T=this.symbolLayer.cap||"butt";switch(T){case "none":this._startCap=new F.NoCapBuilder;this._endCap=new F.NoCapBuilder;break;default:this._startCap=new F.TriangulationCapBuilder(this._profile,0);this._endCap=new F.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new F.TriangulationCapBuilder(this._profile,
-.5);this._endCap=new F.TriangulationCapBuilder(this._profile,.5,!0);break;case "round":U="quad"===U?!0:!1,this._startCap=new F.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:U,subdivisions:z.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS}),this._endCap=new F.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:U,subdivisions:z.PATH_NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS})}U=r.get(this.symbolLayer,"material","color");Y=this._getCombinedOpacityAndColor(U);U=g.fromArray(Y);Y=Y[3];const ba=
1>Y||this.needsDrivenTransparentPass;T={diffuse:U,ambient:U,opacity:Y,transparent:ba,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,cullFace:ba||"none"===T?u.CullFaceOptions.None:u.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(d.set(this._intrinsicSize,X,W),!B.isValidSize(this._intrinsicSize[0])||!B.isValidSize(this._intrinsicSize[1])))throw new t("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");
this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||d.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);this._fastUpdates.enabled?(X={...T,...this._fastUpdates.materialParameters,size:f.fromArray(this._intrinsicSize)},this._material=new K.PathMaterial(X)):(T.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new E.DefaultMaterial(T));this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});this._context.stage.add(this._material)});return function(){return aa.apply(this,arguments)}}();V.destroy=function(){R.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};V.createGraphics3DGraphic=function(aa){const X=aa.graphic;if(!this._validateGeometry(X.geometry,P,this.symbolLayer.type))return null;const W=this.setGraphicElevationContext(X,new k.ElevationContext);return this._createAs3DShape(X,aa.renderingInfo,W,X.uid)};V.layerOpacityChanged=
function(){var aa=r.get(this.symbolLayer,"material","color");aa=this._getCombinedOpacity(aa);this._material.setParameters({opacity:aa,transparent:1>aa||this.needsDrivenTransparentPass})};V.layerElevationInfoChanged=function(aa,X){return this.updateGraphics3DGraphicElevationInfo(aa,X,q.needsElevationUpdates3D)};V.slicePlaneEnabledChanged=function(){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};V.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});return!0};V.pixelRatioChanged=function(){return!0};V.skipHighSymbolLodsChanged=function(){return!0};V.applyRendererDiff=function(aa,X){for(const W in aa.diff)switch(W){case "visualVariables":if(x.updateFastSymbolUpdatesState(this._fastUpdates,X,this._vvConvertOptions))this._material.setParameters(this._fastUpdates.materialParameters);else return A.ApplyRendererDiffResult.Recreate_Symbol;break;default:return A.ApplyRendererDiffResult.Recreate_Symbol}return A.ApplyRendererDiffResult.Fast_Update};
V._getVertexData=function(aa){let X=0;const W=aa.paths,T=[],U=aa.spatialReference,Y=this._context.elevationProvider.spatialReference,ba=this._context.renderCoordsHelper.spatialReference;for(var da of W)X+=da.length;da=y.newDoubleArray(3*X);const ea=y.newDoubleArray(3*X);let ca=0;for(const ja of W){T.push({index:ca,numVertices:ja.length});for(const ia of ja)da[ca++]=ia[0],da[ca++]=ia[1],da[ca++]=aa.hasZ?ia[2]:0}aa=!0;r.isSome(Y)&&!U.equals(Y)&&(aa=h.projectBuffer(da,U,0,da,Y,0,X));r.isSome(Y)&&!Y.equals(ba)?
h.projectBuffer(da,Y,0,ea,ba,0,X):this._copyVertices(da,0,ea,0,X);return{pathVertexDataInfos:T,vertexDataES:da,vertexDataRS:ea,projectionSuccess:aa,terrainElevation:0}};V._copyVertices=function(aa,X,W,T,U){X*=3;T*=3;for(let Y=0;Y<U;++Y)W[T++]=aa[X++],W[T++]=aa[X++],W[T++]=aa[X++]};V._createAs3DShape=function(aa,X,W,T){var U=aa.geometry,Y=[];const ba=U.spatialReference,da=l.create(),ea=this._context.renderCoordsHelper;G.spatialReference=ba;const ca=this._getVertexData(U);if(!ca.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),
null;if(0===ca.pathVertexDataInfos.length)return 0!==U.paths.length&&U.paths.some(ha=>0<ha.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)"),null;for(const ha of ca.pathVertexDataInfos){U=ha.index;var ja=ha.numVertices;if(2>ja)continue;if(r.isSome(this._context.clippingExtent)&&(l.empty(da),l.expandWithBuffer(da,ca.vertexDataES,3*U,ja),!l.intersectsClippingArea(da,this._context.clippingExtent)))continue;var ia=[];for(var Z=U;Z<U+3*ja;){const la=Z++,
na=Z++,pa=Z++,va=new F.PathVertex;e.set(va.posES,ca.vertexDataES[la],ca.vertexDataES[na],ca.vertexDataES[pa]);const wa=q.evaluateElevationAlignmentAtPoint(va.posES,this._context.elevationProvider,W,ea);e.set(H,ca.vertexDataRS[la],ca.vertexDataRS[na],ca.vertexDataRS[pa]);ea.setAltitude(H,wa);e.copy(va.pos,H);ia.push(va)}U=new F.Path(ia);J(U,this._upVectorAlignment,this._context.renderCoordsHelper);U=new F.Builder(U,this._profile,this._extruder,this._startCap,this._endCap);ja=null;this._fastUpdates.enabled?
(Z=this._fastUpdates.visualVariables,ja=Z.size?C.getAttributeValue(Z.size.field,aa):0,ia=Z.color?C.getAttributeValue(Z.color.field,aa):0,Z=Z.opacity?C.getAttributeValue(Z.opacity.field,aa):0,ja=new F.FastUpdatePathGeometry(U,ja,ia,Z)):(ja=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(ia=X.size,ja[0]*=M(ia[0],"symbol-value"===ia[2]?this.symbolLayer.height||0:ia[2],this.symbolLayer.width||0),ja[1]*=M(ia[2],"symbol-value"===ia[0]?this.symbolLayer.width||0:ia[0],this.symbolLayer.height||
0)),ia=void 0,this._drivenProperties.color&&(ia=X.color),this._drivenProperties.opacity&&null!=X.opacity&&(ia=ia?[ia[0],ia[1],ia[2],X.opacity]:[1,1,1,X.opacity]),U=new F.StaticPathGeometry(U),U.bake(ja),ia&&U.bakeVertexColors(ia),ja=U);const {vertexAttributes:fa,indices:ka}=ja.createGeometryData();U=this._context.stage.renderView.getObjectAndLayerIdColor({graphicUid:T,layerUid:this._context.layer.uid});U=new D.PathGeometry(this._material,fa,ka,ja,ba,this._upVectorAlignment,this._stencilWidth,U);U.transformation=
ja.xform;Y.push(U)}if(0===Y.length)return null;aa=new w.Object3D({geometries:Y,metadata:{layerUid:this._context.layer.uid,graphicUid:T}});Y=new p.Graphics3DObject3DGraphicLayer(this,aa,Y,null,null,N,W);Y.alignedSampledElevation=ca.terrainElevation;Y.needsElevationUpdates=q.needsElevationUpdates3D(W.mode);return Y};return Q}(C.Graphics3DSymbolLayer);const I=v.makeDehydratedPoint(0,0,0,null),G=v.makeDehydratedPoint(0,0,0,null),H=g.create(),L=g.create(),O=g.create(),S=new q.SampleElevationInfo;a.Graphics3DPathSymbolLayer=
b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,c){function b(w,D){w[0]=D[0];w[1]=D[1];w[2]=D[2];w[3]=D[3];return w}function t(w){w[0]=1;w[1]=0;w[2]=0;w[3]=1;return w}function n(w,D,F,E,K){w[0]=D;w[1]=F;w[2]=E;w[3]=K;return w}function r(w,D){if(w===D){const F=D[1];w[1]=D[2];w[2]=F}else w[0]=D[0],w[1]=D[2],w[2]=D[1],w[3]=D[3];return w}function m(w,D){const F=D[0],E=D[1],K=D[2];D=D[3];let J=F*D-K*E;if(!J)return null;
J=1/J;w[0]=D*J;w[1]=-E*J;w[2]=-K*J;w[3]=F*J;return w}function d(w,D){const F=D[0];w[0]=D[3];w[1]=-D[1];w[2]=-D[2];w[3]=F;return w}function f(w){return w[0]*w[3]-w[2]*w[1]}function e(w,D,F){const E=D[0],K=D[1],J=D[2];D=D[3];const M=F[0],N=F[1],P=F[2];F=F[3];w[0]=E*M+J*N;w[1]=K*M+D*N;w[2]=E*P+J*F;w[3]=K*P+D*F;return w}function g(w,D,F){const E=D[0],K=D[1],J=D[2];D=D[3];const M=Math.sin(F);F=Math.cos(F);w[0]=E*F+J*M;w[1]=K*F+D*M;w[2]=E*-M+J*F;w[3]=K*-M+D*F;return w}function h(w,D,F){const E=D[1],K=D[2],
J=D[3],M=F[0];F=F[1];w[0]=D[0]*M;w[1]=E*M;w[2]=K*F;w[3]=J*F;return w}function l(w,D){const F=Math.sin(D);D=Math.cos(D);w[0]=D;w[1]=F;w[2]=-F;w[3]=D;return w}function v(w,D){w[0]=D[0];w[1]=0;w[2]=0;w[3]=D[1];return w}function q(w){return"mat2("+w[0]+", "+w[1]+", "+w[2]+", "+w[3]+")"}function k(w){return Math.sqrt(w[0]**2+w[1]**2+w[2]**2+w[3]**2)}function p(w,D,F,E){w[2]=E[2]/E[0];F[0]=E[0];F[1]=E[1];F[3]=E[3]-w[2]*F[1];return[w,D,F]}function z(w,D,F){w[0]=D[0]+F[0];w[1]=D[1]+F[1];w[2]=D[2]+F[2];w[3]=
D[3]+F[3];return w}function C(w,D,F){w[0]=D[0]-F[0];w[1]=D[1]-F[1];w[2]=D[2]-F[2];w[3]=D[3]-F[3];return w}function B(w,D){return w[0]===D[0]&&w[1]===D[1]&&w[2]===D[2]&&w[3]===D[3]}function A(w,D){const F=w[0],E=w[1],K=w[2];w=w[3];const J=D[0],M=D[1],N=D[2];D=D[3];const P=c.getEpsilon();return Math.abs(F-J)<=P*Math.max(1,Math.abs(F),Math.abs(J))&&Math.abs(E-M)<=P*Math.max(1,Math.abs(E),Math.abs(M))&&Math.abs(K-N)<=P*Math.max(1,Math.abs(K),Math.abs(N))&&Math.abs(w-D)<=P*Math.max(1,Math.abs(w),Math.abs(D))}
function x(w,D,F){w[0]=D[0]*F;w[1]=D[1]*F;w[2]=D[2]*F;w[3]=D[3]*F;return w}function u(w,D,F,E){w[0]=D[0]+F[0]*E;w[1]=D[1]+F[1]*E;w[2]=D[2]+F[2]*E;w[3]=D[3]+F[3]*E;return w}const y=Object.freeze(Object.defineProperty({__proto__:null,LDU:p,add:z,adjoint:d,copy:b,determinant:f,equals:A,exactEquals:B,frob:k,fromRotation:l,fromScaling:v,identity:t,invert:m,mul:e,multiply:e,multiplyScalar:x,multiplyScalarAndAdd:u,rotate:g,scale:h,set:n,str:q,sub:C,subtract:C,transpose:r},Symbol.toStringTag,{value:"Module"}));
a.LDU=p;a.add=z;a.adjoint=d;a.copy=b;a.determinant=f;a.equals=A;a.exactEquals=B;a.frob=k;a.fromRotation=l;a.fromScaling=v;a.identity=t;a.invert=m;a.mat2=y;a.mul=e;a.multiply=e;a.multiplyScalar=x;a.multiplyScalarAndAdd=u;a.rotate=g;a.scale=h;a.set=n;a.str=q;a.sub=C;a.subtract=C;a.transpose=r})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./ContentObjectType","./Geometry"],function(a,c,b,t){t=function(n){function r(m,d,f,
e,g,h,l,v){m=n.call(this,m,d,f,null,b.ContentObjectType.Mesh,v)||this;m.path=e;m.geometrySR=g;m.upVectorAlignment=h;m.stencilWidth=l;return m}c._inheritsLoose(r,n);return r}(t.Geometry);a.UpVectorAlignment=void 0;(function(n){n[n.World=0]="World";n[n.Path=1]="Path"})(a.UpVectorAlignment||(a.UpVectorAlignment={}));a.PathGeometry=t;a.isPathGeometry=function(n){return"upVectorAlignment"in n};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat2f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./Attribute ./FloatArray ./GeometryUtil ./Indices ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){function z(){return{up:f.create(),right:f.create()}}let C=function(){function aa(){this.pos=f.create();this.posES=f.create();this.vLeft=f.create();this.vRight=f.create();this.vMinSiblingLength=0;this.frame=z();this.rotationFrameUp=f.create();this.rotationRight=m.create();this.rotationAngle=0;this.miterStretch=b.create();this.maxStretchDistance=0}aa.prototype.setFrameFromUpVector=function(X){d.copy(this.frame.up,X);d.add(L,this.vLeft,this.vRight);d.normalize(L,
L);d.scale(H,this.frame.up,d.dot(L,this.frame.up));d.subtract(R,L,H);d.normalize(R,R);d.cross(this.frame.right,R,this.frame.up)};return aa}(),B=function(){function aa(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=[]}var X=aa.prototype;X.addVertex=function(W,T){this.vertices.push(m.clone(W));this.vertexNormals.push(m.clone(T));return this.vertices.length-1};X.addPole=function(W,T=null){this.poles.push({position:m.clone(W),normal:T?m.clone(T):null});return this.poles.length-
1};X.addSegment=function(W,T=null){this.vertexIndices.push(W.v0);this.vertexIndices.push(W.v1);T&&(this.poleIndices.push(T.v0),this.poleIndices.push(T.v1))};X.translate=function(W,T){for(const U of this.vertices)U[0]+=W,U[1]+=T;for(const U of this.poles)U.position[0]+=W,U.position[1]+=T};c._createClass(aa,[{key:"numSegments",get:function(){return this.vertexIndices.length/2}}]);return aa}(),A=function(){function aa(X){this.vertices=X;this.offset=f.create();this.xform=n.create();d.copy(this.offset,
this.vertices[Math.floor((X.length-1)/2)].pos);for(const W of this.vertices)d.subtract(W.pos,W.pos,this.offset);t.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}aa.prototype.updatePathVertexInformation=function(){const X=this.vertices.length;var W=this.vertices[0];W.index=0;W.vLeft=f.create();d.subtract(W.vRight,this.vertices[1].pos,W.pos);let T=d.length(W.vRight);W.vMinSiblingLength=T;d.normalize(W.vRight,W.vRight);var U=W;for(W=1;W<X;++W){const Y=this.vertices[W];
Y.index=W;Y.vLeft=U.vRight;W<X-1?(d.subtract(Y.vRight,this.vertices[W+1].pos,Y.pos),U=d.length(Y.vRight),Y.vMinSiblingLength=Math.min(T,U),T=U,d.normalize(Y.vRight,Y.vRight)):(d.copy(Y.vRight,Y.vLeft),Y.vMinSiblingLength=T);U=Y}};return aa}(),x=function(){function aa(){}var X=aa.prototype;X.numProfilesPerJoin=function(){return 1};X.extrude=function(W,T,U){for(let Y=0;Y<T.vertices.length;++Y)U(W.index,W.frame,T.vertices[Y],T.vertexNormals[Y],!1)};return aa}(),u=function(){function aa(W=.8*Math.PI,
T=1){this.cutoffAngle=W;this.numBendSubdivisions=T}var X=aa.prototype;X.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};X.extrude=function(W,T,U){var Y=Q;if(Math.abs(W.rotationAngle)>=this.cutoffAngle)for(var ba=0;ba<this.numBendSubdivisions+1;++ba){t.fromRotation(V,.5*-W.rotationAngle+ba*W.rotationAngle/this.numBendSubdivisions,W.rotationFrameUp);var da=Y,ea=W.frame,ca=V;d.transformMat4(da.up,ea.up,ca);d.transformMat4(da.right,ea.right,ca);for(da=0;da<T.vertices.length;++da)0<=r.dot(T.vertices[da],
W.rotationRight)*W.rotationAngle?U(W.index,Y,T.vertices[da],T.vertexNormals[da],!1):(r.transformMat2(P,T.vertices[da],W.miterStretch),U(W.index,W.frame,P,T.vertexNormals[da],!0))}else for(Y=0;Y<this.numBendSubdivisions+1;++Y)for(ba=0;ba<T.vertices.length;++ba)da=0<=r.dot(T.vertices[ba],W.rotationRight)*W.rotationAngle,r.transformMat2(P,T.vertices[ba],W.miterStretch),U(W.index,W.frame,P,T.vertexNormals[ba],da?!1:!0)};return aa}(),y=function(){function aa(){}aa.prototype.rebuildConnectingProfileGeometry=
function(X,W,T){for(let U=0;U<W.vertices.length;++U)T(X.index,X.frame,W.vertices[U],W.vertexNormals[U],0,0)};return aa}(),w=function(aa){function X(){return aa.call(this)||this}c._inheritsLoose(X,aa);var W=X.prototype;W.getNumVertices=function(){return 0};W.getNumIndices=function(){return 0};W.rebuildCapGeometry=function(){};W.buildTopology=function(){};return X}(y),D=function(aa){function X(T,U=0,Y=!1){var ba=aa.call(this)||this;ba.profile=T;ba.profilePlaneOffset=U;ba.flip=Y;return ba}c._inheritsLoose(X,
aa);var W=X.prototype;W.getNumVertices=function(){return this.profile.vertices.length};W.getNumIndices=function(){return 3*this.profile.numSegments};W.rebuildConnectingProfileGeometry=function(T,U,Y){for(let ba=0;ba<U.vertices.length;++ba)Y(T.index,T.frame,U.vertices[ba],U.vertexNormals[ba],this.profilePlaneOffset,0)};W.rebuildCapGeometry=function(T,U){const Y=I;r.set(Y,0,0);const ba=this.flip?1:-1;for(let da=0;da<this.profile.vertices.length;++da)U(T.index,T.frame,this.profile.vertices[da],Y,this.profilePlaneOffset,
ba)};W.buildTopology=function(T,U){T=this.vertexBufferStart+this.profile.vertexIndices[0];for(let Y=1;Y<this.profile.numSegments;++Y){const ba=this.vertexBufferStart+this.profile.vertexIndices[2*Y],da=this.vertexBufferStart+this.profile.vertexIndices[2*Y+1];this.flip?U(da,ba,T):U(T,ba,da)}};return X}(y),F=function(aa){function X(T){var U=aa.call(this)||this;U.flip=!1;U.sign=0;U.breakNormals=!1;U.numSegments=3;U.profile=T.profile;U.flip=T.flip;U.sign=U.flip?1:-1;U.breakNormals=T.breakNormals;U.numSegments=
T.subdivisions;return U}c._inheritsLoose(X,aa);var W=X.prototype;W.getNumVertices=function(){let T=0;T=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(T+=this.profile.vertices.length);return T+=this.profile.poles.length};W.getNumIndices=function(){let T;T=2*this.profile.numSegments*(this.numSegments-1);for(let U=0;U<this.profile.numSegments;++U)T=this.profile.poleIndices[this.profile.vertexIndices[2*U]]===this.profile.poleIndices[this.profile.vertexIndices[2*U+1]]?T+1:T+2;return 3*
T};W.rebuildCapGeometry=function(T,U){const Y=T.frame,ba=.5*this.sign,da=P,ea=I;r.set(ea,0,0);for(var ca=0;ca<this.profile.poles.length;++ca){var ja=this.profile.poles[ca];ja.normal?U(T.index,Y,ja.position,ja.normal,ba,0):U(T.index,Y,ja.position,ea,ba,this.sign)}if(this.breakNormals)for(ca=0;ca<this.profile.vertices.length;++ca)U(T.index,Y,this.profile.vertices[ca],this.profile.vertexNormals[ca],0,0);for(ca=0;ca<this.numSegments-1;++ca){var ia=(1-(ca+1)/this.numSegments)*Math.PI*.5;ja=Math.sin(ia);
ia=Math.cos(ia);for(let Z=0;Z<this.profile.vertices.length;++Z){const ha=this.profile.poles[this.profile.poleIndices[Z]];r.subtract(da,this.profile.vertices[Z],ha.position);r.scale(da,da,ja);ha.normal?(r.add(da,da,ha.position),U(T.index,Y,da,ha.normal,ba*ia,0)):(r.normalize(ea,da),r.scale(ea,ea,ja),r.add(da,da,ha.position),U(T.index,Y,da,ea,ba*ia,this.sign*ia))}}};W.buildTopology=function(T,U){T=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;const Y=
this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let ba=0;ba<this.profile.numSegments;++ba){const da=this.profile.vertexIndices[2*ba],ea=this.profile.vertexIndices[2*ba+1],ca=this.vertexBufferStart+this.profile.poleIndices[da],ja=this.vertexBufferStart+this.profile.poleIndices[ea];let ia=T+da,Z=T+ea;for(let ha=0;ha<this.numSegments-1;++ha){const fa=Y+ha*this.profile.vertices.length+da,ka=Y+ha*this.profile.vertices.length+
ea;this.flip?(U(fa,Z,ia),U(Z,fa,ka)):(U(ia,Z,fa),U(ka,fa,Z));ia=fa;Z=ka}this.flip?(U(ca,Z,ia),ca!==ja&&U(ca,ja,Z)):(U(ia,Z,ca),ca!==ja&&U(Z,ja,ca))}};return X}(y),E=function(){function aa(W,T,U,Y,ba,da={}){this.options=da;this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._extrusionVertexCount=0;this.profile=T;this.path=W;this.extruder=U;this.startCap=Y;this.endCap=ba;W=this.path.vertices.length-2;this.numExtrusionProfiles=U.numProfilesPerJoin()*W+2;this.numNormalsTotal=this.numVerticesTotal=
T.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;T=this.startCap.getNumVertices();this.numVerticesTotal+=T;this.numNormalsTotal+=T;this.endCap.vertexBufferStart=this.numVerticesTotal;T=this.endCap.getNumVertices();this.numVerticesTotal+=T;this.numNormalsTotal+=T;this.pathVertexData=l.newFloatArray(1*this.numVerticesTotal);this.profileRightAxisData=l.newFloatArray(4*this.numVerticesTotal);this.profileUpAxisData=l.newFloatArray(4*this.numVerticesTotal);
this.profileVertexAndNormalData=l.newFloatArray(4*this.numVerticesTotal);this.originData=l.newFloatArray(3*this.path.vertices.length);this._rebuildGeometry();this.buildTopology()}var X=aa.prototype;X.emitVertex=function(W,T,U,Y,ba){this.profileRightAxisData[4*this._extrusionVertexCount]=T.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=T.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=T.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=T.up[0];this.profileUpAxisData[4*
this._extrusionVertexCount+1]=T.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=T.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=U[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=U[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=Y[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=Y[1];this.pathVertexData[this._extrusionVertexCount]=W;ba?(W=this.path.vertices[W],this.profileRightAxisData[4*this._extrusionVertexCount+
3]=W.rotationRight[0]*W.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=W.rotationRight[1]*W.maxStretchDistance):(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};X.emitCapVertex=function(W,T,U,Y,ba,da){this.profileRightAxisData[4*this._extrusionVertexCount]=T.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=T.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+
2]=T.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=T.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=T.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=T.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=U[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=U[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=Y[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=Y[1];this.pathVertexData[this._extrusionVertexCount]=
W;this.profileRightAxisData[4*this._extrusionVertexCount+3]=ba;this.profileUpAxisData[4*this._extrusionVertexCount+3]=da;++this._extrusionVertexCount};X._rebuildGeometry=function(){const W=(Y,ba,da,ea,ca)=>this.emitVertex(Y,ba,da,ea,ca),T=(Y,ba,da,ea,ca,ja)=>this.emitCapVertex(Y,ba,da,ea,ca,ja);this._extrusionVertexCount=0;for(var U of this.path.vertices)this.originData[3*U.index]=U.pos[0],this.originData[3*U.index+1]=U.pos[1],this.originData[3*U.index+2]=U.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],
this.profile,T);for(U=1;U<this.path.vertices.length-1;++U)this.extruder.extrude(this.path.vertices[U],this.profile,W);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,T);this.startCap.rebuildCapGeometry(this.path.vertices[0],T);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],T)};X.buildTopology=function(){const W=this.profile.vertices.length,T=this.profile.numSegments,U=this.numExtrusionProfiles-1;var Y=T*U*6;
this.startCap.indexBufferStart=Y;this.startCap.firstProfileVertexIndex=0;Y+=this.startCap.getNumIndices();this.endCap.indexBufferStart=Y;this.endCap.firstProfileVertexIndex=W*(this.numExtrusionProfiles-1);const ba=[],da=[],ea=[];Y=(ca,ja,ia)=>{ba.push(ca);ba.push(ja);ba.push(ia);da.push(ca);da.push(ja);da.push(ia);ea.push(this.pathVertexData[ca]);ea.push(this.pathVertexData[ja]);ea.push(this.pathVertexData[ia])};for(let ca=0;ca<T;++ca){const ja=this.profile.vertexIndices[2*ca],ia=this.profile.vertexIndices[2*
ca+1];for(let Z=0;Z<U;++Z){const ha=Z*W+ja,fa=(Z+1)*W+ia,ka=Z*W+ia;Y(ha,(Z+1)*W+ja,fa);Y(ha,fa,ka)}}this.startCap.buildTopology(this.path.vertices[0],Y);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],Y);this.vertexIndices=q.compactIndices(ba);this.normalIndices=q.compactIndices(da);this.pathVertexIndices=q.compactIndices(ea)};X.onPathChanged=function(){this._rebuildGeometry()};return aa}(),K=function(){function aa(X){this.builder=X}aa.prototype.onPathChanged=function(){this.builder.onPathChanged()};
c._createClass(aa,[{key:"xform",get:function(){return this.builder.path.xform}}]);return aa}(),J=function(aa){function X(T){T=aa.call(this,T)||this;T.vertexAttributePosition=null;T.vertexAttributeNormal=null;T.vertexAttributeColor=null;T.vertexAttributePosition=l.newFloatArray(3*T.builder.numVerticesTotal);T.vertexAttributeNormal=l.newFloatArray(3*T.builder.numNormalsTotal);T.vertexAttributeColor=new Uint8Array(4);T.vertexAttributeColor[0]=255;T.vertexAttributeColor[1]=255;T.vertexAttributeColor[2]=
255;T.vertexAttributeColor[3]=255;return T}c._inheritsLoose(X,aa);var W=X.prototype;W.bakeVertexColors=function(T){this.vertexAttributeColor[0]=255*T[0];this.vertexAttributeColor[1]=255*T[1];this.vertexAttributeColor[2]=255*T[2];this.vertexAttributeColor[3]=255*(3<T.length?T[3]:1)};W.bake=function(T){this.size=T;for(let da=0;da<this.builder.numVerticesTotal;++da){var U=this.builder.pathVertexData[da],Y=0===U||U===this.builder.path.vertices.length-1;U*=3;var ba=N;d.set(ba,this.builder.originData[U++],
this.builder.originData[U++],this.builder.originData[U]);U=4*da;const ea=H,ca=P,ja=L,ia=O,Z=S;let ha=0,fa=0;d.set(ia,this.builder.profileRightAxisData[U],this.builder.profileRightAxisData[U+1],this.builder.profileRightAxisData[U+2]);d.set(Z,this.builder.profileUpAxisData[U],this.builder.profileUpAxisData[U+1],this.builder.profileUpAxisData[U+2]);r.set(ca,this.builder.profileVertexAndNormalData[U]*T[0],this.builder.profileVertexAndNormalData[U+1]*T[1]);if(Y)d.cross(ja,Z,ia),ha=this.builder.profileRightAxisData[U+
3]*T[0],fa=this.builder.profileUpAxisData[U+3];else{Y=I;const ka=G;r.set(Y,this.builder.profileRightAxisData[U+3],this.builder.profileUpAxisData[U+3]);const la=r.length(Y);r.normalize(Y,Y);const na=r.dot(ca,Y);if(Math.abs(na)>la){r.set(ka,-Y[1],Y[0]);const pa=r.dot(ca,ka);r.scale(Y,Y,la*Math.sign(na));r.scale(ka,ka,pa);r.add(ca,Y,ka)}d.set(ja,0,0,0)}d.set(ea,ia[0]*ca[0]+Z[0]*ca[1],ia[1]*ca[0]+Z[1]*ca[1],ia[2]*ca[0]+Z[2]*ca[1]);this.vertexAttributePosition[3*da]=ba[0]+ea[0]+ja[0]*ha;this.vertexAttributePosition[3*
da+1]=ba[1]+ea[1]+ja[1]*ha;this.vertexAttributePosition[3*da+2]=ba[2]+ea[2]+ja[2]*ha;ba=P;r.set(ba,this.builder.profileVertexAndNormalData[U+2],this.builder.profileVertexAndNormalData[U+3]);this.vertexAttributeNormal[3*da]=ia[0]*ba[0]+Z[0]*ba[1]+ja[0]*fa;this.vertexAttributeNormal[3*da+1]=ia[1]*ba[0]+Z[1]*ba[1]+ja[1]*fa;this.vertexAttributeNormal[3*da+2]=ia[2]*ba[0]+Z[2]*ba[1]+ja[2]*fa}};W.createGeometryData=function(){const T=[[k.VertexAttribute.POSITION,this.builder.vertexIndices],[k.VertexAttribute.NORMAL,
this.builder.normalIndices]],U=[[k.VertexAttribute.POSITION,new h.Attribute(this.vertexAttributePosition,3,!0)],[k.VertexAttribute.NORMAL,new h.Attribute(this.vertexAttributeNormal,3,!0)]];this.vertexAttributeColor&&(T.push([k.VertexAttribute.COLOR,Array(this.builder.vertexIndices.length).fill(0)]),U.push([k.VertexAttribute.COLOR,new h.Attribute(this.vertexAttributeColor,4)]));return{vertexAttributes:U,indices:T}};W.onPathChanged=function(){aa.prototype.onPathChanged.call(this);this.bake(this.size)};
W.intersect=function(T,U,Y){const ba=this.builder.vertexIndices,da=new h.Attribute(this.vertexAttributePosition,3);p.intersectTriangles(T,U,0,ba.length/3,ba,da,void 0,void 0,Y)};return X}(K),M=function(aa){function X(W,T,U,Y){var ba=aa.call(this,W)||this;ba.sizeAttributeValue=T;ba.colorAttributeValue=U;ba.opacityAttributeValue=Y;ba.vvData=null;ba.baked=new J(W);ba.vvData=l.newFloatArray(4*ba.builder.path.vertices.length);for(W=0;W<ba.builder.path.vertices.length;++W)ba.vvData[4*W]=T,ba.vvData[4*W+
1]=U,ba.vvData[4*W+2]=Y,ba.vvData[4*W+3]=0===W||W===ba.builder.path.vertices.length-1?1:0;return ba}c._inheritsLoose(X,aa);X.prototype.createGeometryData=function(){return{vertexAttributes:[[k.VertexAttribute.POSITION,new h.Attribute(this.builder.originData,3,!0)],[k.VertexAttribute.PROFILERIGHT,new h.Attribute(this.builder.profileRightAxisData,4,!0)],[k.VertexAttribute.PROFILEUP,new h.Attribute(this.builder.profileUpAxisData,4,!0)],[k.VertexAttribute.PROFILEVERTEXANDNORMAL,new h.Attribute(this.builder.profileVertexAndNormalData,
4,!0)],[k.VertexAttribute.FEATUREVALUE,new h.Attribute(this.vvData,4,!0)]],indices:[[k.VertexAttribute.POSITION,this.builder.pathVertexIndices],[k.VertexAttribute.PROFILERIGHT,this.builder.vertexIndices],[k.VertexAttribute.PROFILEUP,this.builder.vertexIndices],[k.VertexAttribute.PROFILEVERTEXANDNORMAL,this.builder.vertexIndices],[k.VertexAttribute.FEATUREVALUE,this.builder.pathVertexIndices]]}};return X}(K);const N=f.create(),P=m.create(),I=m.create(),G=m.create(),H=f.create(),L=f.create(),O=f.create(),
S=f.create(),R=f.create(),Q=z(),V=n.create();a.Builder=E;a.CapBuilder=y;a.Extruder=function(){};a.FastUpdatePathGeometry=M;a.MiterExtruder=u;a.NoCapBuilder=w;a.Path=A;a.PathGeometryData=K;a.PathVertex=C;a.Profile=B;a.RoundCapBuilder=F;a.SimpleExtruder=x;a.StaticPathGeometry=J;a.TriangulationCapBuilder=D;a.computeMinimumRotationTangentFrame=function(aa,X){let W=null;const T=aa.vertices.length,U=f.create(),Y=f.create(),ba=f.create(),da=f.create(),ea=f.create(),ca=f.create(),ja=e.create();let ia=aa.vertices[0];
d.copy(Y,X);d.set(U,0,1,0);v.makeOrthoBasisDirUpFallback(ia.vRight,Y,U,U,ba,Y,.99619469809);d.copy(ia.frame.up,Y);d.copy(ia.frame.right,ba);W=ia;for(X=1;X<T;++X){ia=aa.vertices[X];d.add(ea,ia.vLeft,ia.vRight);let Z=d.length(ea);0<Z?(Z=1/Math.sqrt(Z),ea[0]*=Z,ea[1]*=Z,ea[2]*=Z):(ea[0]=ia.vRight[0],ea[1]=ia.vRight[1],ea[2]=ia.vRight[2]);d.add(ca,W.pos,W.frame.up);e.fromPositionAndNormal(ia.pos,ea,ja);e.intersectRay(ja,g.wrap(ca,ia.vLeft),da)?(d.subtract(da,da,ia.pos),d.normalize(Y,da),d.cross(ba,ea,
Y),d.normalize(ba,ba)):v.makeOrthoBasisDirUpFallback(ea,W.frame.up,W.frame.right,U,ba,Y,.99619469809);d.copy(ia.frame.up,Y);d.copy(ia.frame.right,ba);W=ia}};a.creatQuadProfile=function(){const aa=new B,X=m.fromValues(-.5,-.5),W=m.fromValues(.5,-.5),T=m.fromValues(.5,.5),U=m.fromValues(-.5,.5),Y=m.fromValues(0,-1),ba=m.fromValues(1,0),da=m.fromValues(0,1),ea=m.fromValues(-1,0);aa.addPole(m.fromValues(0,.5),da);aa.addPole(m.fromValues(0,.5));aa.addPole(m.fromValues(0,-.5));aa.addPole(m.fromValues(0,
-.5),Y);aa.addVertex(X,Y);aa.addVertex(W,Y);aa.addSegment({v0:0,v1:1},{v0:3,v1:3});aa.addVertex(W,ba);aa.addVertex(T,ba);aa.addSegment({v0:2,v1:3},{v0:2,v1:1});aa.addVertex(T,da);aa.addVertex(U,da);aa.addSegment({v0:4,v1:5},{v0:0,v1:0});aa.addVertex(U,ea);aa.addVertex(X,ea);aa.addSegment({v0:6,v1:7},{v0:1,v1:2});return aa};a.createCircleProfile=function(aa=20){const X=new B,W={v0:0,v1:0};X.addPole(m.fromValues(0,0));for(var T=0;T<aa;++T){var U=2*T*Math.PI/aa,Y=Math.cos(U);const ba=Math.sin(U);U=m.fromValues(.5*
Y,.5*ba);Y=m.fromValues(Y,ba);X.addVertex(U,Y)}for(T=0;T<aa-1;++T)X.addSegment({v0:T,v1:T+1},W);X.addSegment({v0:aa-1,v1:0},W);return X};a.makeFrame=z;a.profileSpaceToVertexSpace=function(aa,X,W){aa[0]=W[0]*X.right[0]+W[1]*X.up[0];aa[1]=W[0]*X.right[1]+W[1]*X.up[1];aa[2]=W[0]*X.right[2]+W[1]*X.up[2]};a.vertexSpaceToProfileSpace=function(aa,X,W){r.set(aa,d.dot(W,X.right),d.dot(W,X.up))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat2f64":function(){define(["exports"],
function(a){function c(){return[1,0,0,1]}function b(m){return[m[0],m[1],m[2],m[3]]}function t(m,d,f,e){return[m,d,f,e]}function n(m,d){return new Float64Array(m,d,4)}const r=Object.freeze(Object.defineProperty({__proto__:null,clone:b,create:c,createView:n,fromValues:t},Symbol.toStringTag,{value:"Module"}));a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.mat2f64=r})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/shading/Normals.glsl ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderSlot ../lib/VertexAttribute ./DefaultBufferWriter ./PathTechnique ./internal/MaterialUtil".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){e=function(C){function B(x){x=C.call(this,x,new z)||this;x.supportsEdges=!0;x._vertexAttributeLocations=q.vertexAttributeLocations;x._configuration=new q.PathTechniqueConfiguration;x._vertexBufferLayout=B.getVertexBufferLayout();return x}c._inheritsLoose(B,C);var A=B.prototype;A.getConfiguration=function(x,u){this._configuration.output=x;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.vvColor=this.parameters.vvColorEnabled;this._configuration.vvOpacity=
this.parameters.vvOpacityEnabled;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(x===m.ShaderOutput.Color||x===m.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?d.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?d.NormalsDoubleSidedMode.WindingOrder:
d.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=u.ssaoHelper.active?this.parameters.receiveSSAO:!1;this._configuration.transparencyPassType=u.transparencyPassType;this._configuration.hasMultipassTerrain=u.multipassTerrain.enabled;this._configuration.cullAboveGround=u.multipassTerrain.cullAboveGround;return this._configuration};A.isVisibleForOutput=function(x){return x===m.ShaderOutput.Shadow||x===m.ShaderOutput.ShadowExcludeHighlight||
x===m.ShaderOutput.ShadowHighlight?this.parameters.castShadows:!0};A.isVisible=function(){return C.prototype.isVisible.call(this)&&0<this.parameters.opacity};A.intersect=function(x,u,y,w,D,F){if(g.isPathGeometry(x)){u=x.path;var E=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){var K=this.parameters.vvSizeOffset,J=this.parameters.vvSizeFactor;const M=this.parameters.vvSizeMinSize,N=this.parameters.vvSizeMaxSize,P=u.sizeAttributeValue;E[0]*=b.clamp(K[0]+P*J[0],M[0],
N[0]);E[1]*=b.clamp(K[2]+P*J[2],M[2],N[2])}K=Math.max(E[0],E[1]);x=x.boundingInfo;t.isNone(x)?this._intersectTriangles(u,E,w,D,F):(x=n.fromValues(x.bbMin[0]-K,x.bbMin[1]-K,x.bbMin[2]-K,x.bbMax[0]+K,x.bbMax[1]+K,x.bbMax[2]+K),K=[D[0]-w[0],D[1]-w[1],D[2]-w[2]],J=Math.sqrt(K[0]*K[0]+K[1]*K[1]+K[2]*K[2]),k.intersectAabbInvDir(x,w,[J/K[0],J/K[1],J/K[2]],y.tolerance)&&this._intersectTriangles(u,E,w,D,F))}};A._intersectTriangles=function(x,u,y,w,D){x.baked.size&&x.baked.size[0]===u[0]&&x.baked.size[1]===
u[1]||x.baked.bake(u);x.baked.intersect(y,w,D)};A.createBufferWriter=function(){return new v.DefaultBufferWriter(this._vertexBufferLayout)};A.requiresSlot=function(x,u){switch(u){case m.ShaderOutput.Shadow:case m.ShaderOutput.ShadowHighlight:case m.ShaderOutput.ShadowExcludeHighlight:if(!this.parameters.castShadows)return!1;case m.ShaderOutput.Color:case m.ShaderOutput.Alpha:case m.ShaderOutput.Depth:case m.ShaderOutput.Normal:case m.ShaderOutput.Highlight:case m.ShaderOutput.ObjectAndLayerIdColor:return x===
(this.parameters.transparent?h.RenderSlot.TRANSPARENT_MATERIAL:h.RenderSlot.OPAQUE_MATERIAL)||x===h.RenderSlot.DRAPED_MATERIAL;default:return!1}};A.createGLMaterial=function(x){return new p(x)};B.getVertexBufferLayout=function(){return r.newLayout().vec3f(l.VertexAttribute.POSITION).vec4f(l.VertexAttribute.PROFILERIGHT).vec4f(l.VertexAttribute.PROFILEUP).vec4f(l.VertexAttribute.PROFILEVERTEXANDNORMAL).vec4f(l.VertexAttribute.FEATUREVALUE)};return B}(e.Material);let p=function(C){function B(){return C.apply(this,
arguments)||this}c._inheritsLoose(B,C);var A=B.prototype;A._updateOccludeeState=function(x){x.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:x.hasOccludees})};A._updateShadowState=function(x){(t.isNone(this.technique)||x.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:x.shadowMap.enabled})};A.beginSlot=function(x){if(this._output===m.ShaderOutput.Color||this._output===m.ShaderOutput.Alpha)this._updateShadowState(x),
this._updateOccludeeState(x);return this.ensureTechnique(q.PathTechnique,x)};return B}(f),z=function(C){function B(){var A=C.apply(this,arguments)||this;A.doubleSided=!1;A.doubleSidedType="normal";A.receiveSSAO=!0;A.receiveShadows=!1;A.castShadows=!0;A.hasSlicePlane=!1;A.transparent=!1;A.hasOccludees=!1;return A}c._inheritsLoose(B,C);return B}(q.PathPassParameters);a.PathMaterial=e;a.PathMaterialParameters=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ./DefaultTechniqueConfiguration ../../../../chunks/Path.glsl ../../../webgl/context-util ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x){const u=new Map([[z.VertexAttribute.POSITION,0],[z.VertexAttribute.PROFILERIGHT,1],[z.VertexAttribute.PROFILEUP,2],[z.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[z.VertexAttribute.FEATUREVALUE,4]]);d=function(y){function w(){var D=y.apply(this,arguments)||this;D.ambient=n.fromValues(.2,.2,.2);D.diffuse=n.fromValues(.8,.8,.8);D.specular=n.fromValues(0,0,0);D.opacity=1;return D}b._inheritsLoose(w,y);return w}(d.PathVertexPositionPassParameters);h=
function(y){function w(){return y.apply(this,arguments)||this}b._inheritsLoose(w,y);var D=w.prototype;D.initializeConfiguration=function(F,E){E.hasWebGL2Context=F.rctx.type===A.ContextType.WEBGL2;E.spherical=F.viewingMode===r.ViewingMode.Global;E.doublePrecisionRequiresObfuscation=F.rctx.driverTest.doublePrecisionRequiresObfuscation.result};D.initializeProgram=function(F){return new q.Program(F.rctx,w.shader.get().build(this.configuration),u)};D.initializePipeline=function(){const F=this.configuration.transparencyPassType,
E=this.configuration,K=F===p.TransparencyPassType.NONE,J=F===p.TransparencyPassType.FrontFace;return x.makePipelineState({blending:E.output!==m.ShaderOutput.Color&&E.output!==m.ShaderOutput.Alpha||!E.transparent?null:K?v.blendingDefault:v.oitBlending(F),culling:E.hasSlicePlane&&!E.transparent&&E.doubleSidedMode!==f.NormalsDoubleSidedMode.None?x.frontFaceCullingParams:null,depthTest:{func:v.oitDepthTest(F)},depthWrite:K||J?x.defaultDepthWriteParams:null,colorWrite:x.defaultColorWriteParams,stencilWrite:E.hasOccludees?
k.stencilWriteMaskOn:null,stencilTest:E.hasOccludees?k.stencilBaseAllZerosParams:null,polygonOffset:K||J?null:v.OITPolygonOffset})};return w}(h.ShaderTechnique);h.shader=new g.ReloadableShaderModule(B.Path,()=>new Promise((y,w)=>a(["../shaders/Path.glsl"],y,w)));g=function(y){function w(){var D=y.apply(this,arguments)||this;D.output=m.ShaderOutput.Color;D.doubleSidedMode=f.NormalsDoubleSidedMode.None;D.transparencyPassType=p.TransparencyPassType.NONE;D.spherical=!1;D.receiveShadows=!1;D.receiveAmbientOcclusion=
!1;D.vvSize=!1;D.vvColor=!1;D.vvOpacity=!1;D.hasSlicePlane=!1;D.transparent=!1;D.hasOccludees=!1;D.hasMultipassTerrain=!1;D.cullAboveGround=!1;D.doublePrecisionRequiresObfuscation=!1;return D}b._inheritsLoose(w,y);return w}(C.DefaultTechniqueConfiguration);t.__decorate([l.parameter({count:m.ShaderOutput.COUNT})],g.prototype,"output",void 0);t.__decorate([l.parameter({count:f.NormalsDoubleSidedMode.COUNT})],g.prototype,"doubleSidedMode",void 0);t.__decorate([l.parameter({count:p.TransparencyPassType.COUNT})],
g.prototype,"transparencyPassType",void 0);t.__decorate([l.parameter()],g.prototype,"spherical",void 0);t.__decorate([l.parameter()],g.prototype,"receiveShadows",void 0);t.__decorate([l.parameter()],g.prototype,"receiveAmbientOcclusion",void 0);t.__decorate([l.parameter()],g.prototype,"vvSize",void 0);t.__decorate([l.parameter()],g.prototype,"vvColor",void 0);t.__decorate([l.parameter()],g.prototype,"vvOpacity",void 0);t.__decorate([l.parameter()],g.prototype,"hasSlicePlane",void 0);t.__decorate([l.parameter()],
g.prototype,"transparent",void 0);t.__decorate([l.parameter()],g.prototype,"hasOccludees",void 0);t.__decorate([l.parameter()],g.prototype,"hasMultipassTerrain",void 0);t.__decorate([l.parameter()],g.prototype,"cullAboveGround",void 0);t.__decorate([l.parameter()],g.prototype,"doublePrecisionRequiresObfuscation",void 0);t.__decorate([l.parameter({constValue:e.PBRMode.Disabled})],g.prototype,"pbrMode",void 0);t.__decorate([l.parameter({constValue:!0})],g.prototype,"hasVvInstancing",void 0);t.__decorate([l.parameter({constValue:!1})],
g.prototype,"useCustomDTRExponentForWater",void 0);t.__decorate([l.parameter({constValue:!1})],g.prototype,"useFillLights",void 0);c.PathPassParameters=d;c.PathTechnique=h;c.PathTechniqueConfiguration=g;c.vertexAttributeLocations=u;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ./PositionAttribute.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){let h=function(l){function v(){var q=l.apply(this,arguments)||this;q.size=b.fromValues(1,1);return q}c._inheritsLoose(v,l);return v}(g.VisualVariablePassParameters);a.PathVertexPosition=function(l,v){const q=e.VertexAttribute.FEATUREVALUE;l.attributes.add(q,"vec4");const k=l.vertex;k.code.add(f.glsl`
  bool isCapVertex() {
    return ${q}.w == 1.0;
  }
  `);k.uniforms.add(new n.Float2PassUniform("size",p=>p.size));v.vvSize?(k.uniforms.add(new r.Float3PassUniform("vvSizeMinSize",p=>p.vvSizeMinSize)),k.uniforms.add(new r.Float3PassUniform("vvSizeMaxSize",p=>p.vvSizeMaxSize)),k.uniforms.add(new r.Float3PassUniform("vvSizeOffset",p=>p.vvSizeOffset)),k.uniforms.add(new r.Float3PassUniform("vvSizeFactor",p=>p.vvSizeFactor)),k.code.add(f.glsl`
    vec2 getSize() {
      return size * clamp(vvSizeOffset + ${q}.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
    }
    `)):k.code.add(f.glsl`vec2 getSize(){
return size;
}`);v.vvOpacity?(k.constants.add("vvOpacityNumber","int",8),k.uniforms.add([new d.FloatsPassUniform("vvOpacityValues",p=>p.vvOpacityValues,8),new d.FloatsPassUniform("vvOpacityOpacities",p=>p.vvOpacityOpacities,8)]),k.code.add(f.glsl`
    vec4 applyOpacity(vec4 color) {
      float value = ${q}.z;
      if (value <= vvOpacityValues[0]) {
        return vec4( color.xyz, vvOpacityOpacities[0]);
      }

      for (int i = 1; i < vvOpacityNumber; ++i) {
        if (vvOpacityValues[i] >= value) {
          float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
          return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
        }
      }

      return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
    }
    `)):k.code.add(f.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);v.vvColor?(k.constants.add("vvColorNumber","int",g.vvColorNumber),k.uniforms.add([new d.FloatsPassUniform("vvColorValues",p=>p.vvColorValues,g.vvColorNumber),new m.Float4sPassUniform("vvColorColors",p=>p.vvColorColors,g.vvColorNumber)]),k.code.add(f.glsl`
    vec4 getColor() {
      float value = ${q}.y;
      if (value <= vvColorValues[0]) {
        return applyOpacity(vvColorColors[0]);
      }

      for (int i = 1; i < vvColorNumber; ++i) {
        if (vvColorValues[i] >= value) {
          float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
          return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
        }
      }

      return applyOpacity(vvColorColors[vvColorNumber - 1]);
    }
    `)):k.code.add(f.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);l.include(t.PositionAttribute);l.attributes.add(e.VertexAttribute.PROFILERIGHT,"vec4");l.attributes.add(e.VertexAttribute.PROFILEUP,"vec4");l.attributes.add(e.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");k.code.add(f.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);k.code.add(f.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);k.code.add(f.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);k.code.add(f.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.PathVertexPositionPassParameters=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x){function u(w){const D=new A.ShaderBuilder,{vertex:F,fragment:E}=D;p.addProjViewLocalOrigin(F,w);D.varyings.add("vpos","vec3");D.include(r.PathVertexPosition,w);if(w.output===b.ShaderOutput.Color||w.output===b.ShaderOutput.Alpha)D.include(n.Transform,w),D.include(q.ReadShadowMapDraw,w),D.include(c.ForwardLinearDepth,w),D.varyings.add("vnormal","vec3"),D.varyings.add("vcolor","vec4"),w.hasMultipassTerrain&&D.varyings.add("depth","float"),F.code.add(B.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${w.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${w.output===b.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);D.include(h.multipassTerrainTest,w);switch(w.output){case b.ShaderOutput.Alpha:D.include(t.SliceDraw,w);E.uniforms.add(new C.FloatPassUniform("opacity",K=>K.opacity));E.code.add(B.glsl`
      void main() {
        discardBySlice(vpos);
        ${w.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `);break;case b.ShaderOutput.Color:D.include(t.SliceDraw,w);D.include(e.EvaluateSceneLighting,w);D.include(f.EvaluateAmbientOcclusion,w);D.include(q.ReadShadowMapDraw,w);D.include(l.Normals,w);p.addCameraPosition(E,w);e.addAmbientBoostFactor(E);e.addLightingGlobalFactor(E);E.uniforms.add([F.uniforms.get("localOrigin"),new z.Float3PassUniform("ambient",K=>K.ambient),new z.Float3PassUniform("diffuse",K=>K.diffuse),new z.Float3PassUniform("specular",K=>K.specular),new C.FloatPassUniform("opacity",
K=>K.opacity)]);E.include(k.ColorConversion);g.addMainLightIntensity(E);E.code.add(B.glsl`
        void main() {
          discardBySlice(vpos);
          ${w.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          shadingParams.viewDirection = normalize(vpos - cameraPosition);
          shadingParams.normalView = vnormal;
          vec3 normal = shadingNormal(shadingParams);
          float ssao = evaluateAmbientOcclusionInverse();

          float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
          ${w.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":w.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
          vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
          float combinedOpacity = vcolor.a * opacity;
          albedo += 0.25 * specular; // don't completely ignore specular for now

          vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
          gl_FragColor = vec4(shadedColor, combinedOpacity);
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
          ${w.transparencyPassType===x.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
        }
      `);break;case b.ShaderOutput.Depth:case b.ShaderOutput.Shadow:case b.ShaderOutput.ShadowHighlight:case b.ShaderOutput.ShadowExcludeHighlight:D.include(n.Transform,w);c.addNearFar(D);D.varyings.add("depth","float");F.code.add(B.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`);D.include(t.SliceDraw,w);D.include(m.OutputDepth,w);E.code.add(B.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);break;case b.ShaderOutput.Normal:D.include(n.Transform,w);D.include(v.NormalUtils,w);p.addViewNormal(F);D.varyings.add("vnormal","vec3");F.code.add(B.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`);D.include(t.SliceDraw,w);E.code.add(B.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`);break;case b.ShaderOutput.Highlight:D.include(n.Transform,w),D.include(v.NormalUtils,w),D.varyings.add("vnormal","vec3"),F.code.add(B.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),D.include(t.SliceDraw,w),D.include(d.OutputHighlight,w),E.code.add(B.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`)}return D}const y=Object.freeze(Object.defineProperty({__proto__:null,build:u},Symbol.toStringTag,{value:"Module"}));a.Path=y;a.build=u})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../support/engineContent/line ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/DoubleArray ../../webgl-engine/lib/FloatArray ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E){const K=["polyline","polygon","extent"];l=function(P){function I(H,L,O,S){H=P.call(this,H,L,O,S)||this;H._needsUV=!1;H._hasOutline=!1;return H}c._inheritsLoose(I,P);var G=I.prototype;G.doLoad=function(){var H=c._asyncToGenerator(function*(){});return function(){return H.apply(this,arguments)}}();G._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};G._ensureFillMaterial=function(){if(!t.isSome(this._material)){var H=
t.get(this.symbolLayer,"material","color");H=this._getCombinedOpacityAndColor(H);this._material=p.createMaterial(this.symbolLayer,{color:H,transparent:1>H[3]||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped});this._needsUV=this._material instanceof F.PatternMaterial;this._context.stage.add(this._material)}};G._ensureOutlineMaterial=function(){const H=this.symbolLayer.outline;!t.isSome(this._outlineMaterial)&&
this._isValidOutline(H)&&(this._hasOutline=!0,this._outlineMaterial=(L=>{const O=D.getStipplePatternForLinePattern(H.pattern);return new E.RibbonLineMaterial({width:L,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:O,stippleScaleWithLineWidth:!0,cap:q.parseCapType(H.patternCap||"butt")})})(n.pt2px(H.size)),this._context.stage.add(this._outlineMaterial))};G._isValidOutline=function(H){return t.isSome(H)&&null!=H.size&&0<H.size&&
t.isSome(H.color)&&(t.isNone(H.pattern)||"style"!==H.pattern.type||"none"!==H.pattern.style)};G.destroy=function(){P.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};G.createGraphics3DGraphic=function(H){const L=H.graphic;if(!this._validateGeometry(L.geometry,K,this.symbolLayer.type))return null;H=this._getVertexOpacityAndColor(H.renderingInfo,255);const O=this.setGraphicElevationContext(L,
new e.ElevationContext);this.ensureDrapedStatus("on-the-ground"===O.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(L,H):this._createAs3DShape(L,H,O)};G.layerOpacityChanged=function(){if(t.isSome(this._material)){var H=this._material.parameters.color,L=t.get(this.symbolLayer,"material","color");L=this._getCombinedOpacity(L);this._material.setParameters({color:[H[0],H[1],H[2],L],transparent:1>L||this.needsDrivenTransparentPass})}t.isSome(this._outlineMaterial)&&(H=this._outlineMaterial.parameters.color,
this._outlineMaterial.setParameters({color:[H[0],H[1],H[2],this._getOutlineOpacity()]}))};G.layerElevationInfoChanged=function(H,L,O){const S=this._elevationContext.mode;O=f.elevationModeChangeUpdateType(I.elevationModeChangeTypes,O,S);if(O!==f.SymbolUpdateType.UPDATE)return O;const R=f.needsElevationUpdates2D(S);return this.updateGraphics3DGraphicElevationInfo(H,L,()=>R)};G.slicePlaneEnabledChanged=function(){t.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
t.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};G.physicalBasedRenderingChanged=function(){return!0};G.pixelRatioChanged=function(){return!0};G.skipHighSymbolLodsChanged=function(){return!0};G._createAs3DShape=function(H,L,O){const S=k.geometryAsPolygon(H.geometry);if(t.isNone(S))return null;var R=B.geometryToRenderInfo(S,this._context.elevationProvider,this._context.renderCoordsHelper,O);L=new M(R,L,this._context.layer.uid,
H.uid);R=L.renderData.position.length/3;this._needsUV&&(L.uvMapSpace=x.newFloatArray(4*R,!0),L.boundingRect=A.newDoubleArray(9*R,!0),z.createMapSpaceUVCoords(L.uvMapSpace,L.boundingRect,L.renderData.position,this._context.renderCoordsHelper));L.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(L);this._createAs3DShapeFill(L);this._hasOutline&&this._createAs3DShapeOutline(L);this._logGeometryCreationWarnings(L.renderData,S.rings,"rings","FillSymbol3DLayer");if(0===L.outGeometries.length)return null;
H=new u.Object3D({geometries:L.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:H.uid}});H=new h.Graphics3DObject3DGraphicLayer(this,H,L.outGeometries,null,null,p.uvElevationAligner,O);H.alignedSampledElevation=L.renderData.sampledElevation;H.needsElevationUpdates=f.needsElevationUpdates2D(O.mode);return H};G._createAs3DShapeFill=function(H){var L=H.renderData.polygons;for(const {position:O,mapPositions:S,holeIndices:R,index:Q,count:V}of L){if(t.isSome(this._context.clippingExtent)&&
(d.empty(J),d.expandWithBuffer(J,S),!d.intersectsClippingArea(J,this._context.clippingExtent)))continue;L=r.earcut(S,R,3);0!==L.length&&(L=k.createColorGeometry({material:t.unwrap(this._material),indices:L,mapPositions:S,attributeData:{position:O,color:H.color,uvMapSpace:this._needsUV?x.floatSubArray(H.uvMapSpace,4*Q,4*V):null,boundingRect:this._needsUV?A.doubleSubArray(H.boundingRect,9*Q,9*V):null,objectAndLayerIdColor:H.objectAndLayerIdColor}}),H.outGeometries.push(L))}};G._createAs3DShapeOutline=
function(H){if(this._hasOutline){var L=H.renderData.outlines;for(let O=0;O<L.length;++O){const {mapPositions:S,position:R}=L[O];if(t.isSome(this._context.clippingExtent)&&(d.empty(J),d.expandWithBuffer(J,S),!d.intersectsClippingArea(J,this._context.clippingExtent)))continue;const Q=C.createGeometry(t.unwrap(this._outlineMaterial),{overlayInfo:null,removeDuplicateStartEnd:!0,mapPositions:S,attributeData:{position:R}},H.objectAndLayerIdColor),V=Q.vertexAttributes.get(w.VertexAttribute.POSITION);V.data===
R&&(V.data=A.doubleArrayFrom(R));H.outGeometries.push(Q)}}};G._createAsOverlay=function(H,L){const O=k.geometryAsPolygon(H.geometry);if(t.isNone(O))return null;t.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;t.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=this._renderPriority);const S=B.geometryToRenderInfoDraped(O,this._context.overlaySR);H=new N(S,L,this._context.layer.uid,H.uid);L=H.renderData.position.length/3;this._needsUV&&(H.uvMapSpace=
x.newFloatArray(4*L,!0),z.createMapSpaceUVCoordsDraped(H.uvMapSpace,H.renderData.position,this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode));H.outBoundingBox=d.empty();H.objectAndLayerIdColor=this._context.stage.renderView?.getObjectAndLayerIdColor(H);this._createAsOverlayFill(H);this._hasOutline&&this._createAsOverlayOutline(H);this._logGeometryCreationWarnings(H.renderData,O.rings,"rings","FillSymbol3DLayer");return 0===H.outGeometries.length?null:new g(this,H.outGeometries,
H.outBoundingBox,this._context.drapeSourceRenderer)};G._createAsOverlayFill=function(H){var L=H.renderData.polygons;for(const {position:S,holeIndices:R,index:Q,count:V}of L)if(L=d.empty(J),d.expandWithBuffer(L,S),d.intersectsClippingArea(L,this._context.clippingExtent)){var O=r.earcut(S,R,3);0!==O.length&&(d.expandWithAABB(H.outBoundingBox,L),O=k.createColorGeometry({material:t.unwrap(this._material),indices:O,attributeData:{position:S,color:H.color,uvMapSpace:this._needsUV?x.floatSubArray(H.uvMapSpace,
4*Q,4*V):null,objectAndLayerIdColor:H.objectAndLayerIdColor}}),O=new y.RenderGeometry(O,H),m.set(O.boundingSphere,.5*(L[0]+L[3]),.5*(L[1]+L[4]),0,.5*Math.sqrt((L[3]-L[0])*(L[3]-L[0])+(L[4]-L[1])*(L[4]-L[1]))),H.outGeometries.push(O))}};G._createAsOverlayOutline=function(H){if(this._hasOutline){var L=H.renderData.outlines;for(let S=0;S<L.length;++S){var {position:O}=L[S];d.empty(J);d.expandWithBuffer(J,O);if(!d.intersectsClippingArea(J,this._context.clippingExtent))continue;d.expandWithAABB(H.outBoundingBox,
J);O=C.createGeometry(t.unwrap(this._outlineMaterial),{overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:!0,attributeData:{position:O}},H.objectAndLayerIdColor);O=new y.RenderGeometry(O,H);const R=J;m.set(O.boundingSphere,.5*(R[0]+R[3]),.5*(R[1]+R[4]),0,.5*Math.sqrt((R[3]-R[0])*(R[3]-R[0])+(R[4]-R[1])*(R[4]-R[1])));H.outGeometries.push(O)}}};G._getOutlineOpacity=function(){const H=t.get(this.symbolLayer,"outline","color");
return(this.draped?1:this._getLayerOpacity())*(t.isSome(H)?H.a:0)};G._getOutlineColor=function(){const H=t.get(this.symbolLayer,"outline","color"),L=this._getOutlineOpacity();return v.mixinColorAndOpacity(t.isSome(H)?b.toUnitRGB(H):null,L)};G.test=function(){return{...P.prototype.test.call(this),createAsOverlay:(H,L)=>this._createAsOverlay(H,L),createAs3DShape:(H,L,O)=>this._createAs3DShape(H,L,O)}};return I}(l.Graphics3DSymbolLayer);l.elevationModeChangeTypes={definedChanged:f.SymbolUpdateType.RECREATE,
staysOnTheGround:f.SymbolUpdateType.NONE,onTheGroundChanged:f.SymbolUpdateType.RECREATE};const J=d.create();let M=function(P){function I(G,H,L,O){G=P.call(this,G,L,O)||this;G.color=H;return G}c._inheritsLoose(I,P);return I}(k.PolygonCreationDataBase),N=function(P){function I(G,H,L,O){G=P.call(this,G,L,O)||this;G.color=H;return G}c._inheritsLoose(I,P);return I}(k.PolygonCreationDataBase);a.Graphics3DPolygonFillSymbolLayer=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(q,k,p){if(b.isSome(q)){if("none"===q.style||"solid"===q.style)return"none"===q.style&&(k.color=t.fromValues(0,0,0,0),k.transparent=!0),new d.ColorMaterial(k);k.style=h(q.style);k.draped=p.isDraped;return new f.PatternMaterial(k)}return new d.ColorMaterial(k)}function h(q){switch(q){case "horizontal":return e.Style.Horizontal;case "vertical":return e.Style.Vertical;case "cross":return e.Style.Cross;case "forward-diagonal":return e.Style.ForwardDiagonal;case "backward-diagonal":return e.Style.BackwardDiagonal;
case "diagonal-cross":return e.Style.DiagonalCross}}function l(q){return q.material instanceof f.PatternMaterial&&!q.material.parameters.draped}function v(q,k){if(l(q)){const p=q.vertexAttributes.get(m.VertexAttribute.POSITION).data,z=q.getMutableAttribute(m.VertexAttribute.UVMAPSPACE).data;q=q.getMutableAttribute(m.VertexAttribute.BOUNDINGRECT).data;r.createMapSpaceUVCoords(z,q,p,k)}}a.createMaterial=function(q,k,p){return g(q&&q.pattern||null,k,p)};a.createMaterialFromPattern=g;a.parsePatternStyle=
h;a.requiresUVUpdates=l;a.updateMapSpaceUVCoords=v;a.uvElevationAligner=function(q,k,p,z,C){k=n.perVertexElevationAligner(q,k,p,z,C);q=q.stageObject.geometries;for(const B of q)v(B,C);return k};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/support/plane ../../../ViewingMode ../../webgl-engine/lib/DoubleArray".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(J,M,N,P,I,G,H){r.set(J,M*I[0]+N*G[0]+P*H[0],M*I[1]+N*G[1]+P*H[1],M*I[2]+N*G[2]+P*H[2])}const v=m.create(),q=m.create(),k=e.create(),p=m.create(),z=m.create(),C=m.create(),B=n.create(),A=n.create(),x=m.create(),u=m.create(),y=m.create(),w=b.create(),D=m.create(),F=m.create(),E=m.create(),K=m.create();a.createMapSpaceUVCoords=function(J,M,N,P,I=1){r.set(p,1,0,0);r.set(z,0,1,0);r.set(C,0,0,1);r.set(K,0,0,0);for(var G=0;G<N.length-3;G+=3)K[0]+=N[G],K[1]+=N[G+
1],K[2]+=N[G+2];r.scale(v,K,1/(N.length/3-1));G=N.length/3-1;if(e.fromManyPointsSampleAt(N,k,0,Math.floor(G/3),Math.floor(2/3*G))){c.isSome(P)?(P.basisMatrixAtPosition(v,w),r.set(D,w[0],w[1],w[2]),r.set(F,w[4],w[5],w[6]),r.set(E,w[8],w[9],w[10])):(r.set(D,1,0,0),r.set(F,0,1,0),r.set(E,0,0,1));P=e.normal(k);0>r.dot(P,E)&&r.scale(P,P,-1);r.copy(C,P);G=r.dot(P,F);var H=r.dot(P,D);Math.abs(G)<Math.abs(H)?(r.scaleAndAdd(p,D,P,-H),r.normalize(p,p),r.cross(z,p,P),r.normalize(z,z),r.scale(z,z,-1)):(r.scaleAndAdd(z,
F,P,-G),r.normalize(z,z),r.cross(p,z,P),r.normalize(p,p))}t.set(B,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);t.set(A,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(P=0;P<N.length;P+=3)r.set(q,N[P],N[P+1],N[P+2]),G=r.dot(p,q),H=r.dot(z,q),B[0]=Math.min(B[0],G),B[1]=Math.min(B[1],H),A[0]=Math.max(A[0],G),A[1]=Math.max(A[1],H);P=r.dot(C,v);l(x,B[0],B[1],P,p,z,C);l(u,A[0],B[1],P,p,z,C);l(y,B[0],A[1],P,p,z,C);r.subtract(u,u,x);r.scale(u,u,.5);r.subtract(y,y,x);r.scale(y,y,.5);r.add(x,x,
u);r.add(x,x,y);P=B[0]-B[0]%I;G=B[1]-B[1]%I;for(H=0;H<N.length;H+=3){r.set(q,N[H],N[H+1],N[H+2]);var L=H/3,O=4*L;J[O]=(r.dot(p,q)-P)/I;J[O+1]=(r.dot(z,q)-G)/I;J[O+2]=P/I;J[O+3]=G/I;L*=9;for(O=0;3>O;O++)M[L+O]=x[O],M[L+O+3]=u[O],M[L+O+6]=y[O]}};a.createMapSpaceUVCoordsDraped=function(J,M,N,P,I=1){if(N.isGeographic&&P===g.ViewingMode.Global){P=h.newDoubleArray(M.length);var G=M.length;N=d.getReferenceEllipsoid(N);for(var H=0;H<G;H+=3)f.lonLatToWebMercatorComparable(M,H,P,H,N);M=P}t.set(B,Number.POSITIVE_INFINITY,
Number.POSITIVE_INFINITY);for(P=0;P<M.length;P+=3)B[0]=Math.min(B[0],M[P]),B[1]=Math.min(B[1],M[P+1]);P=B[0]-B[0]%I;G=B[1]-B[1]%I;for(N=0;N<M.length;N+=3)H=N/3*4,J[H]=(M[N]-P)/I,J[H+1]=(M[N+1]-G)/I,J[H+2]=P/I,J[H+3]=G/I};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./DefaultBufferWriter ./DefaultLayouts ./TriangleMaterial ../shaders/ColorMaterialTechnique ../shaders/ColorMaterialTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){l=function(z){function C(A){A=z.call(this,A,new p)||this;A.supportsEdges=!0;A._configuration=new q.ColorMaterialTechniqueConfiguration;return A}c._inheritsLoose(C,z);var B=C.prototype;B.getConfiguration=function(A,x){this._configuration.output=A;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=
this.parameters.transparent;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.transparencyPassType=x.transparencyPassType;this._configuration.enableOffset=x.camera.relativeElevation<f.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=x.multipassTerrain.enabled;this._configuration.cullAboveGround=x.multipassTerrain.cullAboveGround;return this._configuration};
B.requiresSlot=function(A,x){return x===n.ShaderOutput.Color||x===n.ShaderOutput.Alpha||x===n.ShaderOutput.Highlight||x===n.ShaderOutput.Depth&&this.parameters.writeLinearDepth||x===n.ShaderOutput.ObjectAndLayerIdColor?A===e.RenderSlot.DRAPED_MATERIAL?!0:x===n.ShaderOutput.Highlight?A===e.RenderSlot.OPAQUE_MATERIAL:A===(this.parameters.transparent?this.parameters.writeDepth?e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:e.RenderSlot.OPAQUE_MATERIAL):!1};B.createGLMaterial=
function(A){return new k(A)};B.createBufferWriter=function(){return new g.DefaultBufferWriter(b("enable-feature:objectAndLayerId-rendering")?h.PositionColorLayoutObjectAndLayerId:h.PositionColorLayout)};return C}(l.TriangleMaterial);let k=function(z){function C(){return z.apply(this,arguments)||this}c._inheritsLoose(C,z);var B=C.prototype;B._updateOccludeeState=function(A){A.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:A.hasOccludees})};B.beginSlot=
function(A){this._output!==n.ShaderOutput.Color&&this._output!==n.ShaderOutput.Alpha||this._updateOccludeeState(A);return this.ensureTechnique(v.ColorMaterialTechnique,A)};return C}(m),p=function(z){function C(){var B=z.apply(this,arguments)||this;B.color=t.ZEROS;B.transparent=!1;B.writeDepth=!0;B.writeLinearDepth=!1;B.hasVertexColors=!1;B.polygonOffset=!1;B.hasSlicePlane=!1;B.cullFace=r.CullFaceOptions.None;B.hasOccludees=!1;return B}c._inheritsLoose(C,z);return C}(d.MaterialParameters);a.ColorMaterial=
l;a.Parameters=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../../../../chunks/ColorMaterial.glsl ../../../webgl/context-util ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){r=function(k){function p(){return k.apply(this,arguments)||this}b._inheritsLoose(p,k);var z=p.prototype;z.initializeConfiguration=function(C,B){B.hasWebGL2Context=C.rctx.type===l.ContextType.WEBGL2};z.initializeProgram=function(C){return new f.Program(C.rctx,p.shader.get().build(this.configuration),m.Default3D)};z._createPipeline=function(C,B){const A=this.configuration,x=C===g.TransparencyPassType.NONE,u=C===g.TransparencyPassType.FrontFace;return v.makePipelineState({blending:A.output!==
t.ShaderOutput.Color&&A.output!==t.ShaderOutput.Alpha||!A.transparent?null:x?d.blendingDefault:d.oitBlending(C),culling:v.cullingParams(A.cullFace),depthTest:{func:d.oitDepthTest(C)},depthWrite:x||u?A.writeDepth?v.defaultDepthWriteParams:null:null,colorWrite:v.defaultColorWriteParams,stencilWrite:A.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:A.hasOccludees?B?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:x||u?A.polygonOffset?q:null:d.getOITPolygonOffset(A.enableOffset)})};
z.initializePipeline=function(){this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,!0);return this._createPipeline(this.configuration.transparencyPassType,!1)};z.getPipelineState=function(C,B){return B?this._occludeePipelineState:k.prototype.getPipelineState.call(this,C,B)};return p}(r.ShaderTechnique);r.shader=new n.ReloadableShaderModule(h.ColorMaterial,()=>new Promise((k,p)=>a(["./ColorMaterial.glsl"],k,p)));const q={factor:1,units:1};c.ColorMaterialTechnique=
r;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/ObjectAndLayerIdColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){function C(A){const x=new k.ShaderBuilder,{vertex:u,fragment:y}=x,w=A.output===b.ShaderOutput.Depth,D=A.hasMultipassTerrain&&(A.output===b.ShaderOutput.Color||A.output===b.ShaderOutput.Alpha);l.addProjViewLocalOrigin(u,A);x.include(n.Transform,A);x.include(m.VertexColor,A);x.include(r.ObjectAndLayerIdColor,A);x.attributes.add(z.VertexAttribute.POSITION,"vec3");x.varyings.add("vpos","vec3");D&&x.varyings.add("depth","float");w&&(x.include(d.OutputDepth,
A),c.addNearFar(x),c.addLinearDepth(x));u.code.add(q.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      forwardObjectAndLayerIdColor();
      ${D?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${w?q.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:q.glsl`transformPosition(proj, view, vpos);`}
    }
  `);x.include(t.SliceDraw,A);D&&x.include(e.multipassTerrainTest,A);y.include(h.ColorConversion);y.uniforms.add(new v.Float4PassUniform("eColor",F=>F.color));A.output===b.ShaderOutput.Highlight&&x.include(f.OutputHighlight,A);y.code.add(q.glsl`
  void main() {
    discardBySlice(vpos);
    ${D?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${A.hasVertexColors?"vColor * eColor;":"eColor;"}

    ${A.output===b.ShaderOutput.ObjectAndLayerIdColor?q.glsl`fColor.a = 1.0;`:""}

    if (fColor.a < ${q.glsl.float(g.symbolAlphaCutoff)}) {
      discard;
    }

    ${A.output===b.ShaderOutput.Alpha?q.glsl`gl_FragColor = vec4(fColor.a);`:""}

    ${A.output===b.ShaderOutput.Color?q.glsl`gl_FragColor = highlightSlice(fColor, vpos); ${A.transparencyPassType===p.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
    ${A.output===b.ShaderOutput.Highlight?q.glsl`outputHighlight();`:""};
    ${A.output===b.ShaderOutput.Depth?q.glsl`outputDepth(linearDepth);`:""};
    ${A.output===b.ShaderOutput.ObjectAndLayerIdColor?q.glsl`outputObjectAndLayerIdColor();`:""}
  }
  `);return x}const B=Object.freeze(Object.defineProperty({__proto__:null,build:C},Symbol.toStringTag,{value:"Module"}));a.ColorMaterial=B;a.build=C})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/TransparencyPassType ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d){d=function(f){function e(){var g=f.apply(this,arguments)||this;g.output=t.ShaderOutput.Color;g.cullFace=r.CullFaceOptions.None;g.hasSlicePlane=!1;g.hasVertexColors=!1;g.transparent=!1;g.polygonOffset=!1;g.enableOffset=!0;g.writeDepth=!0;g.hasOccludees=!1;g.transparencyPassType=m.TransparencyPassType.NONE;g.hasMultipassTerrain=!1;g.cullAboveGround=!1;g.objectAndLayerIdColorInstanced=!1;return g}c._inheritsLoose(e,f);return e}(d.DefaultTechniqueConfiguration);b.__decorate([n.parameter({count:t.ShaderOutput.COUNT})],
d.prototype,"output",void 0);b.__decorate([n.parameter({count:r.CullFaceOptions.COUNT})],d.prototype,"cullFace",void 0);b.__decorate([n.parameter()],d.prototype,"hasSlicePlane",void 0);b.__decorate([n.parameter()],d.prototype,"hasVertexColors",void 0);b.__decorate([n.parameter()],d.prototype,"transparent",void 0);b.__decorate([n.parameter()],d.prototype,"polygonOffset",void 0);b.__decorate([n.parameter()],d.prototype,"enableOffset",void 0);b.__decorate([n.parameter()],d.prototype,"writeDepth",void 0);
b.__decorate([n.parameter()],d.prototype,"hasOccludees",void 0);b.__decorate([n.parameter({count:m.TransparencyPassType.COUNT})],d.prototype,"transparencyPassType",void 0);b.__decorate([n.parameter()],d.prototype,"hasMultipassTerrain",void 0);b.__decorate([n.parameter()],d.prototype,"cullAboveGround",void 0);b.__decorate([n.parameter()],d.prototype,"objectAndLayerIdColorInstanced",void 0);a.ColorMaterialTechniqueConfiguration=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/basicInterfaces ../lib/GLMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./DefaultBufferWriter ./PatternStyle ./TriangleMaterial ./internal/bufferWriterUtils ../shaders/PatternTechnique".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){k=function(x){function u(w){w=x.call(this,w,new A)||this;w.supportsEdges=!0;w._vertexAttributeLocations=z.vertexAttributeLocations;w._configuration=new z.PatternTechniqueConfiguration;return w}c._inheritsLoose(u,x);var y=u.prototype;y.getConfiguration=function(w,D){this._configuration.output=w;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;
this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.style=this.parameters.style;this._configuration.patternSpacing=this.parameters.patternSpacing;this._configuration.lineWidth=this.parameters.lineWidth;this._configuration.draped=this.parameters.draped;this._configuration.transparencyPassType=D.transparencyPassType;this._configuration.enableOffset=D.camera.relativeElevation<e.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=
D.multipassTerrain.enabled;this._configuration.cullAboveGround=D.multipassTerrain.cullAboveGround;return this._configuration};y.requiresSlot=function(w,D){return D===r.ShaderOutput.Color||D===r.ShaderOutput.Alpha||D===r.ShaderOutput.Highlight||D===r.ShaderOutput.Depth&&this.parameters.writeLinearDepth?w===g.RenderSlot.DRAPED_MATERIAL?!0:D===r.ShaderOutput.Highlight?w===g.RenderSlot.OPAQUE_MATERIAL:w===(this.parameters.writeDepth?g.RenderSlot.TRANSPARENT_MATERIAL:g.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):
!1};y.createGLMaterial=function(w){return new C(w)};y.createBufferWriter=function(){const w=n.newLayout().vec3f(l.VertexAttribute.POSITION).vec4u8(l.VertexAttribute.COLOR).vec4f(l.VertexAttribute.UVMAPSPACE);this.parameters.draped||w.mat3f(l.VertexAttribute.BOUNDINGRECT);return new B(w)};return u}(k.TriangleMaterial);let C=function(x){function u(){return x.apply(this,arguments)||this}c._inheritsLoose(u,x);var y=u.prototype;y._updateParameters=function(w){return this.ensureTechnique(z.PatternTechnique,
w)};y._updateOccludeeState=function(w){w.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:w.hasOccludees})};y.beginSlot=function(w){this._output!==r.ShaderOutput.Color&&this._output!==r.ShaderOutput.Alpha||this._updateOccludeeState(w);return this._updateParameters(w)};return u}(d),B=function(x){function u(){return x.apply(this,arguments)||this}c._inheritsLoose(u,x);var y=u.prototype;y.write=function(w,D,F,E,K){for(const M of this.vertexBufferLayout.fieldNames){D=
F.vertexAttributes.get(M);const N=F.indices.get(M);if(D&&N)switch(M){case l.VertexAttribute.POSITION:h.assert(3===D.size);var J=E.getField(M,t.BufferViewVec3f);J&&p.writePosition(N,D.data,w,J,K);break;case l.VertexAttribute.COLOR:h.assert(3===D.size||4===D.size);(J=E.getField(M,t.BufferViewVec4u8))&&p.writeColor(N,D.data,D.size,J,K);break;case l.VertexAttribute.UVMAPSPACE:h.assert(4===D.size);(J=E.getField(M,t.BufferViewVec4f))&&p.writeBufferVec4(N,D.data,J,K);break;case l.VertexAttribute.BOUNDINGRECT:h.assert(9===
D.size),(J=E.getField(M,t.BufferViewMat3f))&&this.writeBoundingRect(N,D.data,w,J,K)}}};y.writeBoundingRect=function(w,D,F,E,K){const J=E.typedBuffer;E=E.typedBufferStride;const M=w.length;K*=E;for(let P=0;P<M;++P){const I=9*w[P];var N=D[I];const G=D[I+1],H=D[I+2];J[K]=F[0]*N+F[4]*G+F[8]*H+F[12];J[K+1]=F[1]*N+F[5]*G+F[9]*H+F[13];J[K+2]=F[2]*N+F[6]*G+F[10]*H+F[14];for(N=3;9>N;++N)J[K+N]=D[I+N];K+=E}};return u}(v.DefaultBufferWriter),A=function(x){function u(){var y=x.apply(this,arguments)||this;y.color=
b.fromValues(1,1,1,1);y.writeDepth=!0;y.writeLinearDepth=!1;y.hasVertexColors=!1;y.polygonOffset=!1;y.hasSlicePlane=!1;y.cullFace=m.CullFaceOptions.None;y.hasOccludees=!1;y.style=q.Style.Cross;y.patternSpacing=10;y.lineWidth=1;y.draped=!0;return y}c._inheritsLoose(u,x);return u}(f.MaterialParameters);a.Parameters=A;a.PatternMaterial=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],function(a){a.Style=
void 0;var c=a.Style||(a.Style={});c[c.Horizontal=0]="Horizontal";c[c.Vertical=1]="Vertical";c[c.Cross=2]="Cross";c[c.ForwardDiagonal=3]="ForwardDiagonal";c[c.BackwardDiagonal=4]="BackwardDiagonal";c[c.DiagonalCross=5]="DiagonalCross";c[c.COUNT=6]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/TransparencyPassType ../lib/VertexAttribute ../materials/DefaultTechniqueConfiguration ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/context-util ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){m=function(x){function u(){return x.apply(this,arguments)||this}b._inheritsLoose(u,x);var y=u.prototype;y.initializeConfiguration=function(w,D){D.hasWebGL2Context=w.rctx.type===z.ContextType.WEBGL2};y.initializeProgram=function(w){return new g.Program(w.rctx,u.shader.get().build(this.configuration),A)};y._setPipelineState=function(w,D){const F=this.configuration,E=w===l.TransparencyPassType.NONE,K=w===l.TransparencyPassType.FrontFace;return C.makePipelineState({blending:F.output===
n.ShaderOutput.Color||F.output===n.ShaderOutput.Alpha?E?e.blendingDefault:e.oitBlending(w):null,culling:C.cullingParams(F.cullFace),depthTest:{func:e.oitDepthTest(w)},depthWrite:E?F.writeDepth?C.defaultDepthWriteParams:null:e.oitDepthWrite(w),colorWrite:C.defaultColorWriteParams,stencilWrite:F.hasOccludees?h.stencilWriteMaskOn:null,stencilTest:F.hasOccludees?D?h.stencilToolMaskBaseParams:h.stencilBaseAllZerosParams:null,polygonOffset:E||K?F.polygonOffset?B:null:e.getOITPolygonOffset(F.enableOffset)})};
y.initializePipeline=function(){this._occludeePipelineState=this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,!1)};y.getPipelineState=function(w,D){return D?this._occludeePipelineState:x.prototype.getPipelineState.call(this,w,D)};return u}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(p.Pattern,()=>new Promise((x,u)=>a(["./Pattern.glsl"],x,u)));const B={factor:1,units:1};r=function(x){function u(){var y=
x.apply(this,arguments)||this;y.output=n.ShaderOutput.Color;y.cullFace=f.CullFaceOptions.None;y.transparencyPassType=l.TransparencyPassType.NONE;y.hasSlicePlane=!1;y.hasVertexColors=!1;y.polygonOffset=!1;y.writeDepth=!0;y.hasOccludees=!1;y.enableOffset=!0;y.hasMultipassTerrain=!1;y.cullAboveGround=!1;return y}b._inheritsLoose(u,x);return u}(q.DefaultTechniqueConfiguration);t.__decorate([d.parameter({count:n.ShaderOutput.COUNT})],r.prototype,"output",void 0);t.__decorate([d.parameter({count:f.CullFaceOptions.COUNT})],
r.prototype,"cullFace",void 0);t.__decorate([d.parameter({count:k.Style.COUNT})],r.prototype,"style",void 0);t.__decorate([d.parameter({count:l.TransparencyPassType.COUNT})],r.prototype,"transparencyPassType",void 0);t.__decorate([d.parameter()],r.prototype,"hasSlicePlane",void 0);t.__decorate([d.parameter()],r.prototype,"hasVertexColors",void 0);t.__decorate([d.parameter()],r.prototype,"polygonOffset",void 0);t.__decorate([d.parameter()],r.prototype,"writeDepth",void 0);t.__decorate([d.parameter()],
r.prototype,"hasOccludees",void 0);t.__decorate([d.parameter()],r.prototype,"patternSpacing",void 0);t.__decorate([d.parameter()],r.prototype,"lineWidth",void 0);t.__decorate([d.parameter()],r.prototype,"enableOffset",void 0);t.__decorate([d.parameter()],r.prototype,"draped",void 0);t.__decorate([d.parameter()],r.prototype,"hasMultipassTerrain",void 0);t.__decorate([d.parameter()],r.prototype,"cullAboveGround",void 0);const A=new Map([[v.VertexAttribute.POSITION,0],[v.VertexAttribute.COLOR,3],[v.VertexAttribute.UVMAPSPACE,
4],[v.VertexAttribute.BOUNDINGRECT,5]]);c.PatternTechnique=m;c.PatternTechniqueConfiguration=r;c.vertexAttributeLocations=A;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/TransparencyPassType ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){function B(u){const y=new k.ShaderBuilder,w=u.hasMultipassTerrain&&(u.output===b.ShaderOutput.Color||u.output===b.ShaderOutput.Alpha);u.draped||y.extensions.add("GL_OES_standard_derivatives");const {vertex:D,fragment:F}=y;h.addProjViewLocalOrigin(D,u);y.include(n.Transform,u);y.include(r.VertexColor,u);u.draped?D.uniforms.add(new v.FloatPassUniform("worldToScreenRatio",(K,J)=>1/J.screenToPCSRatio)):y.attributes.add(z.VertexAttribute.BOUNDINGRECT,"mat3");
y.attributes.add(z.VertexAttribute.POSITION,"vec3");y.attributes.add(z.VertexAttribute.UVMAPSPACE,"vec4");y.varyings.add("vpos","vec3");y.varyings.add("vuv","vec2");w&&y.varyings.add("depth","float");var E=u.style===C.Style.ForwardDiagonal||u.style===C.Style.BackwardDiagonal||u.style===C.Style.DiagonalCross;E&&D.code.add(q.glsl`
      const mat2 rotate45 = mat2(${q.glsl.float(.70710678118)}, ${q.glsl.float(-.70710678118)},
                                 ${q.glsl.float(.70710678118)}, ${q.glsl.float(.70710678118)});
    `);u.draped||(h.addCameraPosition(D,u),D.uniforms.add(new v.FloatPassUniform("worldToScreenPerDistanceRatio",(K,J)=>1/J.camera.perScreenPixelRatio)),D.code.add(q.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),D.code.add(q.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),D.code.add(q.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${q.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));D.code.add(q.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${E?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${E?" * rotate45":""};

      ${u.draped?"":q.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${q.glsl.float(u.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);if(E=u.output===b.ShaderOutput.Depth)y.include(m.OutputDepth,u),c.addNearFar(y),c.addLinearDepth(y);D.code.add(q.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${w?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${E?q.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:q.glsl`transformPosition(proj, view, vpos);`}
    }
  `);y.include(t.SliceDraw,u);F.include(g.ColorConversion);u.draped&&F.uniforms.add(new v.FloatPassUniform("texelSize",(K,J)=>1/J.camera.pixelRatio));u.output===b.ShaderOutput.Highlight&&y.include(d.OutputHighlight,u);w&&y.include(f.multipassTerrainTest,u);u.output!==b.ShaderOutput.Highlight&&(F.code.add(q.glsl`
      const float lineWidth = ${q.glsl.float(u.lineWidth)};
      const float spacing = ${q.glsl.float(u.patternSpacing)};
      const float spacingINV = ${q.glsl.float(1/u.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),u.draped||F.code.add(q.glsl`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));F.uniforms.add(new l.Float4PassUniform("uColor",K=>K.color));F.code.add(q.glsl`
    void main() {
      discardBySlice(vpos);
      ${w?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${u.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${u.output!==b.ShaderOutput.Highlight?q.glsl`color.a *= ${A(u)};`:""}

      ${u.output===b.ShaderOutput.ObjectAndLayerIdColor?q.glsl`color.a = 1.0;`:""}

      if (color.a < ${q.glsl.float(e.symbolAlphaCutoff)}) {
        discard;
      }

      ${u.output===b.ShaderOutput.Alpha?q.glsl`gl_FragColor = vec4(color.a);`:""}

      ${u.output===b.ShaderOutput.Color?q.glsl`gl_FragColor = color; ${u.transparencyPassType===p.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
      ${u.output===b.ShaderOutput.Highlight?q.glsl`outputHighlight();`:""}
      ${u.output===b.ShaderOutput.Depth?q.glsl`outputDepth(linearDepth);`:""};
    }
  `);return y}function A(u){function y(w){return u.draped?q.glsl`coverage(vuv.${w}, texelSize)`:q.glsl`sample(vuv.${w})`}switch(u.style){case C.Style.ForwardDiagonal:case C.Style.Horizontal:return y("y");case C.Style.BackwardDiagonal:case C.Style.Vertical:return y("x");case C.Style.DiagonalCross:case C.Style.Cross:return q.glsl`
        1.0 - (1.0 - ${y("x")}) * (1.0 - ${y("y")})
      `;default:return"0.0"}}const x=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}));a.Pattern=x;a.build=B})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./CreateLabelParameters ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DObjectMetadata ./Graphics3DSymbolLayer ./graphicUtils ./placementUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x){function u(F,E,K){F&&F.forEach(J=>{const M=E(J);t.isSome(M)&&K(M,J.graphic)})}function y(F,E){if("baseline"===E.verticalPlacement)return E=p.horizontalPlacementToAnchorX[E.horizontalPlacement],F=t.isSome(F)?F.baselineAnchorY:0,m.fromValues(E,F);F=p.anchorFromPlacements(E.horizontalPlacement,E.verticalPlacement);return p.namedAnchorToHUDMaterialAnchorPos[F]}const w=[0,0,1];q=function(F){function E(J,M,N,P){J=F.call(this,J,M,N,P)||this;J._elevationOptions=
{supportsOffsetAdjustment:!0,supportsOnTheGround:!1};J.ensureDrapedStatus(!1);return J}c._inheritsLoose(E,F);var K=E.prototype;K.doLoad=function(){var J=c._asyncToGenerator(function*(){if(!this._drivenProperties.size){const M=k.validateSymbolLayerSize(this.symbolLayer.size);if(M)throw new b("graphics3dtextsymbollayer:invalid-size",M);}yield this._createTextRenderParameters()});return function(){return J.apply(this,arguments)}}();K._createTextRenderParameters=function(){var J=c._asyncToGenerator(function*(){this._textRenderParameters=
yield B.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.state.rasterPixelRatio)});return function(){return J.apply(this,arguments)}}();K.destroy=function(){F.prototype.destroy.call(this)};K.createGraphics3DGraphic=function(J){J=J.graphic;const M=z.placePointOnGeometry(J.geometry);if(t.isNone(M))return this.logger.warn(`unsupported geometry type for text symbol: ${J.geometry.type}`),null;const N=this.symbolLayer.text;if(t.isNone(N)||""===N)return null;var P=d.hasCalloutSupport(this.symbol)&&
this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(t.isSome(P)&&!d.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;P=new f.CreateLabelParameters(P,this.symbolLayer.horizontalAlignment,p.verticalPlacementFromAlignment(this.symbolLayer.verticalAlignment));
return this._createAs3DShape(J,M,N,P)};K.createLabel=function(J,M,N,P){J=J.graphic;const I=z.placePointOnGeometry(J.geometry);if(t.isNone(I))return this.logger.warn(`unsupported geometry type for label: ${J.geometry.type}`),null;const G=M.text;return!G||/^\s+$/.test(G)?null:this._createAs3DShape(J,I,G,M,N,P)};K.setGraphicElevationContext=function(J,M,N=0){J=F.prototype.setGraphicElevationContext.call(this,J,M);J.addOffsetRenderUnits(N);return J};K.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");
return!1};K.layerElevationInfoChanged=function(J,M){u(J,M,(N,P)=>{this.updateGraphicElevationContext(P,N)});return g.SymbolUpdateType.UPDATE};K.slicePlaneEnabledChanged=function(J,M){u(J,M,N=>{for(const P of N.stageObject.geometries)P.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};K.physicalBasedRenderingChanged=function(){return!0};K.pixelRatioChanged=function(){return!1};K.skipHighSymbolLodsChanged=function(){return!0};K.updateGraphicElevationContext=function(J,
M){const N=M.elevationContext;this.setGraphicElevationContext(J,N,t.isSome(M.metadata)?M.metadata.elevationOffset:0);M.needsElevationUpdates=g.needsElevationUpdates2D(N.mode)||"absolute-height"===N.mode};K._defaultElevationInfoNoZ=function(){return D};K._createAs3DShape=function(J,M,N,P,I,G){const H=this.setGraphicElevationContext(J,new h.ElevationContext,P.elevationOffset);var L="polyline"===t.get(J.geometry,"type"),O=J.uid;let S=null;J=null;if(t.isNone(G)){var R=p.textRenderAlignmentFromHorizontalPlacement(P.horizontalPlacement);
S=new A(N,R,this._textRenderParameters);let aa=null;if(t.isSome(this._context.sharedResources.textures)){J=this._context.sharedResources.textures.fromData(S.key,()=>t.unwrap(S).create(),()=>{t.isSome(aa)&&aa.release()});R=this._context.stage.renderView.textureRepository.acquire(J.texture.id);if(t.isNone(R)||n.isPromiseLike(R))return J.release(),null;aa=R}}R=y(S,P);R={occlusionTest:!0,screenOffset:P.screenOffset,anchorPosition:R,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:P.centerOffsetUnits,
drawInSecondSlot:!0};t.isSome(G)?R.textureId=G.id:t.isSome(J)&&(R.textureId=J.texture.id);if(t.isSome(P.verticalOffset)){const {screenLength:aa,minWorldLength:X,maxWorldLength:W}=P.verticalOffset;R.verticalOffset={screenLength:r.pt2px(aa),minWorldLength:X||0,maxWorldLength:t.isSome(W)?W:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:aa,screenSizePerspectiveSettingsLabels:X}=this._context.sharedResources;R.screenSizePerspective=X.overridePadding(this._textRenderParameters.haloSize+
this._textRenderParameters.definition.background.padding[0]);R.screenSizePerspectiveAlignment=aa}L&&(R.shaderPolygonOffset=1E-4);R.hasSlicePlane=this._context.slicePlaneEnabled;t.isSome(I)?(L=JSON.stringify(R),G=I.get(L),t.isNone(G)&&(G=new x.HUDMaterial(R),I.add(L,G))):G=new x.HUDMaterial(R);L=P.translation;R=t.isSome(S)?m.fromValues(S.displayWidth,S.displayHeight):m.ZEROS;L=C.createPointGeometry(G,w,L,null,R,P.centerOffset,[0,0],null);O=z.createStageObject(this._context,M,L,H,O);if(t.isNone(O))return null;
I=new l.Graphics3DObject3DGraphicLayer(this,O.object,[L],t.isNone(I)?[G]:null,J,e.perObjectElevationAligner,H);I.alignedSampledElevation=O.sampledElevation;I.needsElevationUpdates=g.needsElevationUpdates2D(H.mode)||"absolute-height"===H.mode;const {displayWidth:Q,displayHeight:V}=t.isSome(S)?S:P;I.getScreenSize=(aa=m.create())=>{aa[0]=Q;aa[1]=V;return aa};N=new v.Graphics3DObjectMetadata(P.elevationOffset,N);I.metadata=N;z.extendPointGraphicElevationContext(I,M,this._context.elevationProvider);return I};
return E}(q.Graphics3DSymbolLayer);const D={mode:"relative-to-ground",offset:0};a.Graphics3DTextSymbolLayer=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64".split(" "),function(a,c,b,t,n,r,m){let d=function(){function f(g){this.definition=
g;this.key=JSON.stringify(g);this.haloSize=Math.round(g.halo.size);this.textStyle=this._colorToRGBA(g.color);this.haloStyle=this._colorToRGB(g.halo.color);this.backgroundStyle=0!==g.background.color[3]?this._colorToRGBA(g.background.color):null}var e=f.prototype;e.fontString=function(g){const h=this.definition.font;return`${h.style} ${h.weight} ${g}px ${h.family}, sans-serif`};e._colorToRGB=function(g){return`rgb(${g.slice(0,3).map(h=>Math.floor(255*h)).toString()})`};e._colorToRGBA=function(g){return`rgba(${g.slice(0,
3).map(h=>Math.floor(255*h)).toString()},${g[3]})`};f.fromSymbol=function(){var g=c._asyncToGenerator(function*(h,l){var v=n.get(h,"material","color");const q=n.mapOr(v,m.ZEROS,b.toUnitRGBA);v=n.mapOr(h.size,12,r.pt2px);const k=h.lineHeight,p=n.isSome(h.background)?n.unwrap(b.toUnitRGBA(h.background.color)):m.ZEROS,z={family:n.mapOr(h.font,"sans-serif",B=>B.family),decoration:n.mapOr(h.font,"none",B=>B.decoration),weight:n.mapOr(h.font,"normal",B=>B.weight),style:n.mapOr(h.font,"normal",B=>B.style)};
var C=h.halo;C=n.isSome(C)&&n.isSome(C.color)&&0<C.size?{size:r.pt2px(C.size),color:b.toUnitRGBA(C.color)}:{size:0,color:m.ZEROS};h=new f({color:q,size:v,background:{color:p,padding:n.isSome(h.background)?[.65*v,.5*v]:[0,0],borderRadius:n.isSome(h.background)?.375*v:0},lineSpacingFactor:k,font:z,halo:C,pixelRatio:l});l=h.fontString(v);try{yield document.fonts.load(l)}catch(B){t.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters").warnOnce(`Failed to preload font '${l}'. Some text symbology may be rendered using the default browser font.`)}return h});
return function(h,l){return g.apply(this,arguments)}}();return f}();a.TextRenderParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces","./TextRenderer","./Texture","../../../webgl/enums"],function(a,c,b,t,n){const r={canvas:null};return function(){function m(d,f,e){this._renderer=new b.TextRenderer(d,f,e)}m.prototype.create=function(){const d=
b.getTextHelperCanvas(r,this._renderer.renderedWidth,this._renderer.renderedHeight),f=d.getContext("2d");f.save();this._renderer.render(f,0,0);f.restore();return new t.Texture(d,{wrap:{s:n.TextureWrapMode.CLAMP_TO_EDGE,t:n.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:c.PowerOfTwoResizeMode.PAD})};a._createClass(m,[{key:"key",get:function(){return this._renderer.key}},{key:"baselineAnchorY",get:function(){return 1-this._renderer.firstRenderedBaselinePosition/
this._renderer.renderedHeight}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}}]);return m}()})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../support/renderInfoUtils/polygon ../../webgl-engine/lib/DoubleArray ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w){const D=["polyline","polygon","extent"];z=function(P){function I(H,L,O,S){return P.call(this,H,L,O,S)||this}c._inheritsLoose(I,P);var G=I.prototype;G.doLoad=function(){var H=c._asyncToGenerator(function*(){});return function(){return H.apply(this,arguments)}}();G.destroy=function(){P.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};G.createGraphics3DGraphic=function(H){H=H.graphic;if(!this._validateGeometry(H.geometry,
D,this.symbolLayer.type))return null;const L=this.setGraphicElevationContext(H,new q.ElevationContext);this.ensureDrapedStatus("on-the-ground"===L.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(H):this._createAs3DShape(H,L,H.uid)};G.ensureMaterial=function(){if(!t.isSome(this._material)){var H=new y.WaterMaterialParameters,L=this.symbolLayer.color;t.isSome(L)&&(H.color=b.toUnitRGBA(L));L=this._getCombinedOpacity(L,{hasIntrinsicColor:!0});H.color=[H.color[0],H.color[1],H.color[2],
L];H.transparent=1>L||this.needsDrivenTransparentPass;H.waveDirection=t.isSome(this.symbolLayer.waveDirection)?I.headingVectorFromAngle(this.symbolLayer.waveDirection):d.fromValues(0,0);L=w.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];H.waveStrength=L.waveStrength;H.waveTextureRepeat=L.textureRepeat;H.waveVelocity=L.waveVelocity;H.flowStrength=L.perturbationStrength;H.hasSlicePlane=this._context.slicePlaneEnabled;H.isDraped=this.draped;this._material=new y.WaterMaterial(H);
this._context.stage.add(this._material)}};G.layerOpacityChanged=function(){if(!t.isNone(this._material)){var H=this._material.parameters.color,L=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameters({color:[H[0],H[1],H[2],L],transparent:1>L||this.needsDrivenTransparentPass})}};G.layerElevationInfoChanged=function(H,L,O){const S=this._elevationContext.mode;O=v.elevationModeChangeUpdateType(I.elevationModeChangeTypes,O,S);if(O!==v.SymbolUpdateType.UPDATE)return O;
const R=v.needsElevationUpdates2D(S);return this.updateGraphics3DGraphicElevationInfo(H,L,()=>R)};G.slicePlaneEnabledChanged=function(){t.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};G.physicalBasedRenderingChanged=function(){return!0};G.pixelRatioChanged=function(){return!0};G.skipHighSymbolLodsChanged=function(){return!0};G._createAs3DShape=function(H,L,O){H=C.geometryAsPolygon(H.geometry);if(t.isNone(H))return null;var S=B.geometryToRenderInfo(H,
this._context.elevationProvider,this._context.renderCoordsHelper,L);const R=S.position.length/3,Q=A.newDoubleArray(2*R);this._createUVCoordsFromVertices(Q,S.mapPositions,R,this._context.elevationProvider.spatialReference);S=new M(S,Q);this._create3DShapeGeometries(S);this._logGeometryCreationWarnings(S.renderData,H.rings,"rings","WaterSymbol3DLayer");if(0===S.outGeometries.length)return null;O=new x.Object3D({geometries:S.outGeometries,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:O}});
O=new p.Graphics3DObject3DGraphicLayer(this,O,S.outGeometries,null,null,l.perVertexElevationAligner,L);O.alignedSampledElevation=S.renderData.sampledElevation;O.needsElevationUpdates=v.needsElevationUpdates2D(L.mode);return O};G._createUVCoordsFromVertices=function(H,L,O,S){S=n.getMetersPerUnitForSR(S);h.empty(E);for(var R=0;R<O;R++)m.set(K,L[3*R],L[3*R+1]),h.expandPointInPlace(E,K);f.scale(E,E,S);R=E[1]%I.unitSizeOfTexture;F[0]=E[0]-E[0]%I.unitSizeOfTexture;F[1]=E[1]-R;for(R=0;R<O;R++)H[2*R]=(L[3*
R]*S-F[0])/I.unitSizeOfTexture,H[2*R+1]=(L[3*R+1]*S-F[1])/I.unitSizeOfTexture};G._create3DShapeGeometries=function(H){var L=H.renderData.polygons;const O=H.uvCoords;for(const {count:S,index:R,position:Q,mapPositions:V,holeIndices:aa}of L){if(t.isSome(this._context.clippingExtent)&&(g.empty(J),g.expandWithBuffer(J,V),!g.intersectsClippingArea(J,this._context.clippingExtent)))continue;L=r.earcut(V,aa,3);if(0===L.length)continue;const X=A.doubleSubArray(O,2*R,2*S);L=C.createWaterGeometry({material:t.unwrap(this._material),
indices:L,mapPositions:V,attributeData:{position:Q,uv0:X}});H.outGeometries.push(L)}};G._createAsOverlay=function(H){const L=C.geometryAsPolygon(H.geometry);if(t.isNone(L))return null;t.unwrap(this._material).renderPriority=this._renderPriority;const O=B.geometryToRenderInfoDraped(L,this._context.overlaySR),S=O.position.length/3,R=A.newDoubleArray(2*S);this._createUVCoordsFromVertices(R,O.position,S,this._context.overlaySR);H=new N(O,R,this._context.layer.uid,H.uid);H.outBoundingBox=g.empty();this._createAsOverlayWater(H);
this._logGeometryCreationWarnings(H.renderData,L.rings,"rings","WaterSymbol3DLayer");return 0===H.outGeometries.length?null:new k(this,H.outGeometries,H.outBoundingBox,this._context.drapeSourceRenderer)};G._createAsOverlayWater=function(H){const L=H.uvCoords;var O=H.renderData.polygons;for(const {position:R,holeIndices:Q,index:V,count:aa}of O)if(g.empty(J),g.expandWithBuffer(J,R),g.intersectsClippingArea(J,this._context.clippingExtent)&&(g.expandWithAABB(H.outBoundingBox,J),O=r.earcut(R,Q,3),0!==
O.length)){var S=A.doubleSubArray(L,2*V,2*aa);O=C.createWaterGeometry({material:t.unwrap(this._material),indices:O,attributeData:{position:R,uv0:S}});O=new u.RenderGeometry(O,H);S=J;f.set(O.boundingSphere,.5*(S[0]+S[3]),.5*(S[1]+S[4]),0,.5*Math.sqrt((S[3]-S[0])*(S[3]-S[0])+(S[4]-S[1])*(S[4]-S[1])));H.outGeometries.push(O)}};I.headingVectorFromAngle=function(H){const L=d.create();H=e.toRadian(H);L[0]=Math.sin(H);L[1]=Math.cos(H);return L};G.test=function(){return{...P.prototype.test.call(this),create3DShape:H=>
this._createAs3DShape(H.graphic,H.elevationContext,H.graphicUid),ensureMaterial:()=>this.ensureMaterial()}};return I}(z.Graphics3DSymbolLayer);z.unitSizeOfTexture=100;z.elevationModeChangeTypes={definedChanged:v.SymbolUpdateType.RECREATE,staysOnTheGround:v.SymbolUpdateType.NONE,onTheGroundChanged:v.SymbolUpdateType.RECREATE};const F=d.create(),E=h.create(),K=d.create(),J=g.create();let M=function(P){function I(G,H){G=P.call(this,G,null,null)||this;G.uvCoords=H;return G}c._inheritsLoose(I,P);return I}(C.PolygonCreationDataBase),
N=function(P){function I(G,H,L,O){G=P.call(this,G,L,O)||this;G.uvCoords=H;return G}c._inheritsLoose(I,P);return I}(C.PolygonCreationDataBase);a.Graphics3DWaterSymbolLayer=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports"],function(a){a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,
textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},
"moderate-medium":{waveStrength:.09,perturbationStrength:.03,textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./interfaces","./Loadable","./symbolComplexity"],function(a,c,b,t,n){return function(r){function m(f,e,g){e=r.call(this,e)||this;e.symbol=f;e._convert=g;e.symbologySnappingSupported=!1;e.graphics3DSymbol=null;e.referenced=0;return e}a._inheritsLoose(m,r);var d=m.prototype;d.getSymbolLayerSize=function(f){return c.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.getSymbolLayerSize(f):null};d.doLoad=function(){var f=a._asyncToGenerator(function*(e){e=yield this.symbol.fetchSymbol({signal:e});e.id=this.symbol.id;this.graphics3DSymbol=this._convert(e);c.isSome(this.graphics3DSymbol)&&(yield this.graphics3DSymbol.load())});return function(e){return f.apply(this,arguments)}}();d.createGraphics3DGraphic=function(f){return c.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(f,this):null};d.globalPropertyChanged=function(f,
e){return c.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(f,e):!1};d.applyRendererDiff=function(f,e){return c.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.applyRendererDiff(f,e):b.ApplyRendererDiffResult.Recreate_Symbol};d.prepareSymbolPatch=function(f){c.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(f)};d.updateGeometry=function(f,e){return c.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(f,e):!1};d.onRemoveGraphic=
function(){};d.getFastUpdateStatus=function(){return c.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};d.destroy=function(){c.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;r.prototype.destroy.call(this)};a._createClass(m,[{key:"symbolLayers",get:function(){return c.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}},{key:"extentPadding",get:function(){return c.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.extentPadding:0}},{key:"complexity",get:function(){return c.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:n.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===this.graphics3DSymbol}}]);return m}(t.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){function h(w){w=e.getGraphics3DSymbol(w.graphics3DGraphic.graphics3DSymbol);return t.isSome(w)?w.symbol.symbolLayers.getItemAt(0):null}function l(w,D){var F=D.graphics3DGraphic.graphic.geometry;if(t.isNone(F))return null;if(t.isSome(D.disablePlacement))return D.labelClass.labelPlacement?(B.warnOncePerTick(v(w.placement,D.disablePlacement.logEntityDescription)),q(D)):w;F=F.type;switch(F){case "polyline":case "polygon":case "extent":case "multipoint":if(D.labelClass.labelPlacement)return B.warnOncePerTick(v(w.placement,
`'${F}' geometries`)),q(D)}return w}function v(w,D){return`the requested label placement '${w}' is currently unsupported for ${D} in SceneView.`}function q(w){const D=w.graphics3DGraphic.graphic.geometry;if(t.isNone(D))return null;switch(D.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return w=h(w),t.isSome(w)&&"extrude"===w.type?A["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};
case "point":return A["above-center"];case "mesh":return A["above-center"]}}function k(w,D=u){({graphics3DGraphic:w}=w);w=w.layers[0];(w=t.isSome(w)?w.stageObject.geometries[0].material:null)&&w instanceof g.HUDMaterial?(w=w.parameters.anchorPosition,D[0]=2*(w[0]-.5),D[1]=2*(w[1]-.5)):(D[0]=0,D[1]=0);return D}function p(w,D,F){F=t.isSome(F)?F.getBoundingBoxObjectSpace(y):y;F=m.fromValues(F[3]-F[0],F[4]-F[1],F[5]-F[2]);w.centerOffset[0]=Math.sqrt(F[0]*F[0]+F[1]*F[1])/2*D.normalizedOffset[0];const E=
w.translation[2],K=F[2]/2*D.normalizedOffset[1];w.translation[2]=0;w.elevationOffset=E+K;F=r.length(F);w.centerOffset[2]=F/2*D.normalizedOffset[2]}function z(w){const D=w.labelClass.labelPlacement,{labelSymbol:F,graphics3DGraphic:E}=w;var K=e.getGraphics3DSymbol(E.graphics3DSymbol);K=t.applySome(K,J=>"point-3d"===J.symbol.type?J.symbol:null);w=A[D]||q(w);if(t.isSome(K)&&K.supportsCallout()&&K.hasVisibleVerticalOffset()&&!E.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:C(K.verticalOffset),
anchor:null,normalizedOffset:null};if(F&&F.hasVisibleVerticalOffset()&&(t.isNone(K)||!K.supportsCallout()||!K.verticalOffset||E.isDraped)){a:switch(w.placement){case "above-center":K=!0;break a;default:K=!1}return K?{placement:"above-center",verticalOffset:C(F.verticalOffset),anchor:"bottom",normalizedOffset:[0,w.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(B.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+
D+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function C(w){const {screenLength:D,minWorldLength:F,maxWorldLength:E}=w;return{screenLength:D,minWorldLength:F,maxWorldLength:E}}const B=b.getLogger("esri.views.3d.layers.graphics.labelPlacement"),A={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",
normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",
normalizedOffset:[1,0,0],anchor:"left"}};c={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],
"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const w in c){const D=A[w];c[w].forEach(F=>{A[F]=D})}Object.freeze&&(Object.freeze(A),Object.keys(A).forEach(w=>{Object.freeze(A[w]);Object.freeze(A[w].normalizedOffset)}));const x=[0,0],u=[0,0],y=f.create();a.get=function(w){var D=z(w);if(t.isNone(D))return null;if(D.anchor)var F=D;else{F=w.labelClass.labelPlacement;var E=A[F],K=E||q(w);F&&!E&&B.warnOncePerTick(`the requested label placement '${F}' is currently unsupported in SceneView.`);
F=l(K,w)}if(t.isNone(F))return null;E=!!D.hasLabelVerticalOffset;D={anchor:F.anchor,verticalOffset:D.verticalOffset,screenOffset:n.create(),centerOffset:d.fromValues(0,0,0,-1),centerOffsetUnits:"world",translation:m.create(),elevationOffset:0,hasLabelVerticalOffset:E};E=w.graphics3DGraphic.graphic.geometry;if(t.isNone(E))w=null;else{switch(E.type){case "point":K=h(w);if(!t.isNone(K))switch(E=w.graphics3DGraphic.layers[0],t.isSome(E)?E.getCenterObjectSpace(D.translation):r.set(D.translation,0,0,0),
K.type){case "icon":case "text":({graphics3DGraphic:K}=w);E=t.isSome(E)?E.getScreenSize():null;!K.isDraped&&t.isSome(E)?(w=k(w),x[0]=E[0]/2*(F.normalizedOffset[0]-w[0]),x[1]=E[1]/2*(F.normalizedOffset[1]-w[1]),D.screenOffset[0]=x[0],D.hasLabelVerticalOffset?(D.centerOffset[1]=x[1],D.centerOffsetUnits="screen"):D.screenOffset[1]=x[1]):D.hasLabelVerticalOffset||"center"===D.anchor||(A[w.labelClass.labelPlacement]&&B.warnOncePerTick(`the requested placement '${F.placement}' is currently unsupported for draped graphics`),
D.anchor="center");break;case "object":p(D,F,E)}break;case "polygon":E=h(w);if(!t.isNone(E))switch(E.type){case "extrude":w=w.graphics3DGraphic.layers[0],t.isSome(w)?(w.getBoundingBoxObjectSpace(y),f.center(y,D.translation),D.translation[2]=f.height(y)/2):r.set(D.translation,0,0,0),p(D,F,w)}break;case "mesh":p(D,F,w.graphics3DGraphic.layers[0])}w=D}return w};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],
function(a){let c=function(){function b(n){this._stage=n;this._materials=new Map}var t=b.prototype;t.get=function(n){return this._materials.get(n)};t.add=function(n,r){this._materials.set(n,r);this._stage.add(r)};t.dispose=function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return b}();a.MaterialCollection=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./ContentObjectType ./testUtils ./VertexAttribute ../../../support/Scheduler ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A){let x=function(){this.offset={x:0,y:0};this.uvMinMax=q.create()},u=function(w,D){this.textId=w;this.textRenderer=D;this.placement=new x;this.rendered=!1};a.TextTextureAtlas=function(w){function D(E){E=w.call(this,E)||this;E.type=k.ContentObjectType.Texture;E.id=f.generateUID();E.events=new n;E._glTexture=null;E._needsClear=!1;E._elementsToAddOrUpdate=new Map;E._elementsToRemove=new Map;E._elementsToRender=new Map;E._elements=new Map;E._stageObjects=
new Map;E.updating=!1;return E}c._inheritsLoose(D,w);var F=D.prototype;F.initialize=function(){this._stage=this.view._stage;this._canvas=this._create2DCanvas();this._ctx=this._canvas.getContext("2d");this._stage.add(this);const E=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(E);this._update2DCanvasSize();this._resetAtlasCursor()};F.unload=function(){this._glTexture=d.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")};F._createDescriptor=
function(E){return{target:B.TextureType.TEXTURE_2D,pixelFormat:B.PixelFormat.RGBA,dataType:B.PixelType.UNSIGNED_BYTE,wrapMode:B.TextureWrapMode.CLAMP_TO_EDGE,flipped:!0,samplingMode:B.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:E.parameters.maxMaxAnisotropy}};F.load=function(E){if(d.isSome(this._glTexture))return this._glTexture;this._glTexture=new A.Texture(E,this._createDescriptor(E),this._canvas);this._frameWorker=this.view.resourceController.scheduler.registerTask(C.TaskPriority.TEXT_TEXTURE_ATLAS,
this);this.setDirty();return this._glTexture};F.dispose=function(){this._elementsToRender=this._elementsToRemove=this._elementsToAddOrUpdate=this._elements=null;this._frameWorker=d.removeMaybe(this._frameWorker);this._glTexture&&(this._stage.remove(this),this._glTexture=d.disposeMaybe(this._glTexture));this._canvas.width=0;this._canvas.height=0;this._ctx=this._canvas=null};F._create2DCanvas=function(){const E=document.createElement("canvas");E.setAttribute("id","canvas2d");E.setAttribute("style",
"display:none");E.setAttribute("width",(512).toString());E.setAttribute("height",(512).toString());return E};F._update2DCanvasSize=function(){this._canvas.setAttribute("width",this._atlas.size.width.toString());this._canvas.setAttribute("height",this._atlas.size.height.toString())};F._createAtlasRegion=function(E=512){this._atlas={size:{width:E,height:E},cursor:{x:0,y:0},lineHeight:0}};F._computeAtlasResolution=function(E,K){E=Math.max(E,K);E=m.nextHighestPowerOfTwo(E+256);return E=Math.min(E,4096)};
F._resizeAtlas=function(E,K){K=K||E;const J=this._atlas;J.size.width=E;J.size.height=K;d.isSome(this._glTexture)&&this._glTexture.resize(E,K);this._update2DCanvasSize()};F._resetAtlasCursor=function(){const E=this._atlas;E.cursor.x=2;E.cursor.y=4;E.lineHeight=0;this._needsClear=!0};F._getAtlasUsage=function(){const E=this._atlas;return(E.cursor.x+E.cursor.y*E.size.width)/(E.size.width*E.size.height)};F._getExpectedAtlasUsage=function(){const E=this._elementsToRemove.size,K=this._elementsToAddOrUpdate.size,
J=this._elements.size;return this._getAtlasUsage()/J*(J+K-E)};F._addAtlasElement=function(E,K,J,M){const N=this._atlas,{renderedWidth:P,renderedHeight:I}=E.textRenderer;E.placement.offset.x=N.cursor.x;E.placement.offset.y=N.cursor.y;v.set(E.placement.uvMinMax,E.placement.offset.x/N.size.width,1-(E.placement.offset.y+I)/N.size.height,(E.placement.offset.x+P)/N.size.width,1-E.placement.offset.y/N.size.height);N.cursor.x+=J;N.lineHeight=Math.max(N.lineHeight,M);this._elements.set(K,E)};F._removeAtlasElement=
function(E){if(E&&this._elements.has(E.textId)){const K=E.placement.offset;this._ctx.clearRect(K.x,K.y,E.textRenderer.renderedWidth,E.textRenderer.renderedHeight);this._elements.delete(E.textId)}};F._ensureStageObjects=function(E){var K=this._stageObjects.get(E);if(K)return K;K=new Set;this._stageObjects.set(E,K);return K};F._addStageObject=function(E,K){this._ensureStageObjects(E).add(K)};F._removeStageObject=function(E,K){(E=this._stageObjects.get(E))&&E.delete(K)&&(K.geometries[0].vertexAttributes.get(z.VertexAttribute.SIZE).data=
[0,0],K.geometryVertexAttrsUpdated(K.geometries[0]))};F._processAddition=function(E,K){const J=this._atlas;var M=E.textId;const N=E.textRenderer.renderedWidth+2,P=E.textRenderer.renderedHeight+2+2;if(J.cursor.x+N<J.size.width&&J.cursor.y+P<J.size.height)this._addAtlasElement(E,M,N,P),this._elementsToRender.set(M,E),this._elementsToAddOrUpdate.delete(M);else if(J.cursor.y+P+J.lineHeight<J.size.height)J.cursor.x=2,J.cursor.y+=J.lineHeight,J.lineHeight=0,this._addAtlasElement(E,M,N,P),this._elementsToRender.set(M,
E),this._elementsToAddOrUpdate.delete(M);else{E=this._getExpectedAtlasUsage();(M=.85<E&&4096>J.size.width)&&this._resizeAtlas(2*J.size.width,2*J.size.height);if(!K||!M&&.95<E&&4096===J.size.width)return this._processRemovals(),y.OK;this._repack();return y.REPACK}return y.OK};F._processRemovals=function(){this._elementsToRemove.forEach((E,K)=>{const J=this._stageObjects.get(K);J&&0!==J.size||this._removeAtlasElement(E);J&&0===J.size&&this._stageObjects.delete(K)});this._elementsToRemove.clear()};F._repack=
function(){this._processRemovals();this._elements.forEach((E,K)=>{E.rendered=!1;this._elementsToAddOrUpdate.set(K,E)});this._elements.clear();this._resetAtlasCursor();this._elementsToRender.clear()};F._processRenderingRequest=function(E){this._ctx.clearRect(E.placement.offset.x,E.placement.offset.y,E.textRenderer.renderedWidth,E.textRenderer.renderedHeight);E.textRenderer.render(this._ctx,E.placement.offset.x,E.placement.offset.y);const K=this._stageObjects.get(E.textId);K&&K.forEach(J=>{J.geometries[0].vertexAttributes.get(z.VertexAttribute.UV0).data=
new Float32Array(E.placement.uvMinMax);J.geometries[0].vertexAttributes.get(z.VertexAttribute.SIZE).data=[E.textRenderer.displayWidth,E.textRenderer.displayHeight];J.geometryVertexAttrsUpdated(J.geometries[0])});E.rendered=!0};F.runTask=function(E,K=!0){if(d.isNone(this._glTexture))return C.Task.YIELD;let J=!1;r.someMap(this._elementsToAddOrUpdate,(N,P)=>(N=this._elements.get(P))&&N.rendered?((N=this._stageObjects.get(P))&&N.forEach(I=>{const G=I.geometries[0].vertexAttributes,H=this._elements.get(P);
G.get(z.VertexAttribute.UV0).data=H.placement.uvMinMax;G.get(z.VertexAttribute.SIZE).data=[H.textRenderer.displayWidth,H.textRenderer.displayHeight];I.geometryVertexAttrsUpdated(I.geometries[0])}),this._elementsToAddOrUpdate.delete(P),E.madeProgress(),!1):this._processAddition(this._elementsToAddOrUpdate.get(P),K)===y.REPACK?J=!0:!1);if(J)this.runTask(C.noBudget,!1),E.madeProgress();else{var M=!1;0<this._elementsToRender.size&&this._needsClear&&(this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),
this._needsClear=!1);r.someMap(this._elementsToRender,(N,P)=>{this._processRenderingRequest(N);this._elementsToRender.delete(P);M=!0;E.madeProgress();return E.done});M&&this._glTexture.setData(this._canvas);this.updating=0<this._elementsToRender.size;!this.updating&&p.textTextureAtlas.orderedRepackingEnabled&&(this.repackOrdered(),E.madeProgress())}};F.addTextTexture=function(E,K){const J=E.key;this._elementsToAddOrUpdate.has(J)||this._elementsToAddOrUpdate.set(J,new u(J,E));this._addStageObject(J,
K);this._elementsToRemove.delete(J);this.setDirty()};F.removeTextTexture=function(E,K){E=E.key;this._elementsToRemove.set(E,this._elements.get(E));this._removeStageObject(E,K)};F.setDirty=function(){this._glTexture&&(this.updating=!0)};F.repackOrdered=function(){if(0!==this._elements.size){var E=[];this._elements.forEach((J,M)=>E.push({element:J,key:M}));var K=!0;for(let J=0;J<E.length-1;J++)if(0<E[J].key.localeCompare(E[J+1].key)){K=!1;break}if(!K||this._elementsToRemove.size){E.sort((J,M)=>J.key.localeCompare(M.key));
this._elements.clear();for(const {element:J,key:M}of E)this._elements.set(M,J);this._repack();this.setDirty()}}};c._createClass(D,[{key:"width",get:function(){return this._atlas.size.width}},{key:"height",get:function(){return this._atlas.size.height}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"glTexture",get:function(){return this._glTexture}},{key:"running",get:function(){return this.updating}},{key:"test",get:function(){const {_elements:E,_stageObjects:K,_elementsToRemove:J,_atlas:M}=
this,N=this;return{elements:E,stageObjects:K,elementsToRemove:J,atlas:M,resizeAtlas:(P,I)=>N._resizeAtlas(P,I),run:(P,I)=>N.runTask(P,I)}}}]);return D}(t);b.__decorate([e.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);b.__decorate([e.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=b.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],a.TextTextureAtlas);var y;(function(w){w[w.OK=0]="OK";w[w.REPACK=1]="REPACK"})(y||
(y={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){a.FeatureTileTree3D=function(x){function u(w){w=x.call(this,w)||this;w.tiles=new n;w.tileSize=512;w._idToTile=new Map;w._handles=new r;w._clients=new Set;w._dirty=!1;w._pendingTiles=null;w._newTiles=new f;return w}c._inheritsLoose(u,x);var y=u.prototype;y.initialize=function(){this._handles.add([e.watch(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),e.sync),e.watch(()=>[this.tileSize,this.cameraOnSurface?.location,this.tilingScheme,this.viewState?.contentCamera,
this.focus?.location],()=>this._setDirty(),e.syncAndInitial)]);this.scheduler&&(this._frameWorker=this.scheduler.registerTask(C.TaskPriority.FEATURE_TILE_TREE,this))};y.destroy=function(){this._frameWorker=d.removeMaybe(this._frameWorker);this._handles=d.destroyMaybe(this._handles)};y.addClient=function(){const w=B++;this._clients.add(w);1===this._clients.size&&this._setDirty();return{remove:()=>this._removeClient(w)}};y._removeClient=function(w){this._clients.delete(w);this._hasClients||this._clear()};
y._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(C.noBudget))};y._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};y.runTask=function(w){this._dirty=!1;this._pendingTiles||(this._startUpdate(),d.isSome(this._frameWorker)&&(this._frameWorker.priority=C.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(w);!this._pendingTiles&&
d.isSome(this._frameWorker)&&(this._frameWorker.priority=C.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")};y._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new p.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,this.focus.location,this.cameraOnSurface.location.z??0),this._pendingTiles=this._getRootTiles()):
this._clear())};y._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};y._getRootTiles=function(){const {tilingScheme:w}=this;return this._rootTileIds.map(D=>new k.FeatureTileDescriptor3D(D[0],D[1],D[2],w))};y._purgeHorizonTiles=function(w){w.sort((D,F)=>{D=D.measures.screenRect;F=F.measures.screenRect;return D[1]+D[3]-(F[1]+F[3])});q.empty(A);for(let D=0;D<w.length;D++)if(q.expand(A,w.data[D].measures.screenRect,A),10<q.height(A))return w.data.slice(D,
w.length);return[]};y._subdivideTilesForView=function(w){if(this._pendingTiles){for(var {tilingScheme:D}=this;0<this._pendingTiles.length&&!w.done;){const F=this._pendingTiles.pop();w.madeProgress();if(!this._filterExtentRect||q.intersects(this._filterExtentRect,F.extent))this._tileMeasurements.updateTile(F),F.measures.visibility!==k.Visibility.INVISIBLE&&(F.measures.shouldSplit?(D.ensureMaxLod(F.lij[0]+1),this._pendingTiles.push(...F.getChildren())):this._newTiles.push(F))}0===this._pendingTiles.length&&
(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};y._updateTiles=function(w){for(var D of this.tiles.items)D.used=!1;w=w.filter(F=>{const E=this._idToTile.get(F.id);E?(E.copyMeasurementsFrom(F),E.used=!0):this._idToTile.set(F.id,F);return!E});D=this.tiles.items.filter(F=>F.used?!1:(this._idToTile.delete(F.id),!0));this.tiles.removeMany(D);this.tiles.addMany(w);this._sortTiles()};y._sortTiles=function(){this.viewState.fixedContentCamera||
this.tiles.sort((w,D)=>w.measures.visibility!==D.measures.visibility?w.measures.visibility===k.Visibility.VISIBLE_ON_SURFACE?-1:1:w.measures.distance-D.measures.distance);this.tiles.forEach((w,D)=>w.loadPriority=D)};c._createClass(u,[{key:"tilingScheme",get:function(){const w=this.tilingSchemeOwner.tilingScheme;return w?w.clone():null}},{key:"filterExtent",set:function(w){if(d.isSome(w)&&!w.spatialReference.equals(this.viewState.spatialReference))m.getLogger(this.declaredClass).error("#extent","extent spatial reference needs to be in the same spatial reference as the view");
else{var D=this._get("filterExtent");D===w||d.isSome(D)&&w&&D.equals(w)||(w=d.isSome(w)?w.clone():null,this._set("filterExtent",w),this._setDirty())}}},{key:"_filterExtentRect",get:function(){if(d.isNone(this.filterExtent))return null;const w=q.create();z.toBoundingRect(this.filterExtent,w,this.tilingScheme.spatialReference);return w}},{key:"_rootTileIds",get:function(){const {tilingScheme:w}=this;return this._filterExtentRect&&w?w.rootTilesInExtent(this._filterExtentRect):[[0,0,0]]}},{key:"suspended",
set:function(w){w!==this._get("suspended")&&(this._set("suspended",w),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}},{key:"running",get:function(){return this.updating}}]);return u}(t);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);b.__decorate([g.property({constructOnly:!0})],
a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);b.__decorate([g.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"terrain",void 0);b.__decorate([g.property()],a.FeatureTileTree3D.prototype,"tiles",
void 0);b.__decorate([g.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);b.__decorate([g.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);b.__decorate([g.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);b.__decorate([g.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_filterExtentRect",null);b.__decorate([g.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"_rootTileIds",null);b.__decorate([g.property({value:!1})],a.FeatureTileTree3D.prototype,
"suspended",null);b.__decorate([g.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=b.__decorate([v.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let B=0;const A=q.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports","../../../../geometry/support/aaBoundingRect"],function(a,c){let b=function(){function t(r,m,d,f=null){this.lij=
[0,0,0];this.extent=c.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:c.create(),distance:0,shouldSplit:!1};this.used=!1;f&&this.acquire(r,m,d,f)}var n=t.prototype;n.acquire=function(r,m,d,f){this.tilingScheme=f;this.id=t.id(r,m,d);this.lij[0]=r;this.lij[1]=m;this.lij[2]=d;f.getExtent(r,m,d,this.extent);this.resolution=f.resolutionAtLevel(r)};n.release=function(){this.tilingScheme=null};n.getChildren=function(r){const m=this.lij[0]+
1,d=2*this.lij[1],f=2*this.lij[2];if(!r)return[new t(m,d,f,this.tilingScheme),new t(m,d+1,f,this.tilingScheme),new t(m,d,f+1,this.tilingScheme),new t(m,d+1,f+1,this.tilingScheme)];r[0].acquire(m,d,f,this.tilingScheme);r[1].acquire(m,d+1,f,this.tilingScheme);r[2].acquire(m,d,f+1,this.tilingScheme);r[3].acquire(m,d+1,f+1,this.tilingScheme);return r};n.copyMeasurementsFrom=function(r){this.measures.visibility=r.measures.visibility;this.measures.shouldSplit=r.measures.shouldSplit;this.measures.distance=
r.measures.distance;c.copy(r.measures.screenRect,this.measures.screenRect)};t.id=function(r,m,d){return`${r}/${m}/${d}`};return t}();a.Visibility=void 0;(function(t){t[t.INVISIBLE=0]="INVISIBLE";t[t.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";t[t.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){let h=function(){function B(x){this._camera=new g.Camera;this._focusOnMap=[0,0];this._screenRect=n.create();this._tileSize=x.tileSize;this._renderCoordsHelper=x.renderCoordsHelper;this._tilingScheme=x.tilingScheme;this._visibility=new e.FeatureTileVisibility3D(x.renderCoordsHelper)}var A=B.prototype;A.begin=function(x,u,y){this._camera.copyFrom(x);this._surfaceElevation=y;this._focusOnMap[0]=u.x;this._focusOnMap[1]=u.y;n.fromValues(0,0,x.fullWidth,x.fullHeight,this._screenRect);
this._visibility.begin(this._camera,y)};A.end=function(){this._visibility.end()};A.updateTile=function(x){x.measures.visibility=this._visibility.calculate(x);x.measures.distance=n.distance(x.extent,this._focusOnMap);x.measures.visibility!==f.Visibility.INVISIBLE&&this._updateScreenMeasure(x)};A._updateScreenMeasure=function(x){const u=x.measures.screenRect;n.empty(u);let y=0;const w=x.lij[0]+2,D=x.lij[1]<<2,F=x.lij[2]<<2;var E=this._tileSizeWithBias(x);E*=E;for(let K=0;4>K;K++)for(let J=0;4>J;J++)if(y+=
this._computeScreenArea(x,w,D+K,F+J,u),y>E){x.measures.shouldSplit=!0;return}x.measures.shouldSplit=!1};A._tileSizeWithBias=function(x){return x.measures.visibility===f.Visibility.VISIBLE_WHEN_EXTENDED?5*this._tileSize:this._tileSize};A._computeScreenArea=function(x,u,y,w,D){this._projectToScreen(u,y,w,x.measures.visibility===f.Visibility.VISIBLE_WHEN_EXTENDED,v);n.empty(l);for(x=0;4>x;x++)n.expandPointInPlace(l,v[x]);n.expand(D,l,D);return d.areaPoints2d(v[0],v[1],v[2])+d.areaPoints2d(v[0],v[2],
v[3])};A._projectToScreen=function(x,u,y,w,D){this._tilingScheme.ensureMaxLod(x);this._tilingScheme.getExtent(x,u,y,q);this._toRenderCoords(q,0,3,p[0]);this._toRenderCoords(q,2,3,p[1]);this._toRenderCoords(q,2,1,p[2]);this._toRenderCoords(q,0,1,p[3]);w&&(this._projectToPlane(p,this._camera.frustum[r.PlaneIndex.NEAR]),this._projectToPlane(p,this._camera.frustum[r.PlaneIndex.TOP]),this._projectToPlane(p,this._camera.frustum[r.PlaneIndex.BOTTOM]));for(x=0;4>x;x++)this._camera.projectToRenderScreen(p[x],
C),this._camera.renderToScreen(C,D[x])};A._projectToPlane=function(x,u){for(var y=0;4>y;y++)z[y]=m.signedDistance(u,x[y]);y=Math.max(z[0],z[1],z[2],z[3]);if(0<y)for(u=b.scale(k,m.normal(u),-y),y=0;4>y;y++)b.add(x[y],x[y],u)};A._toRenderCoords=function(x,u,y,w){k[0]=x[u];k[1]=x[y];k[2]=this._surfaceElevation;this._renderCoordsHelper.toRenderCoords(k,this._tilingScheme.spatialReference,w);return w};return B}();const l=n.create(),v=[c.createScreenPointArray(),c.createScreenPointArray(),c.createScreenPointArray(),
c.createScreenPointArray()],q=n.create(),k=t.create(),p=[t.create(),t.create(),t.create(),t.create()],z=[0,0,0,0],C=c.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){let v=function(){function C(A){this._renderCoordsHelper=A;this._surfaceElevation=0;this._cache=new Map;this._frustum=new h.Frustum(A);this._extendedFrustum=new h.Frustum(A);this._intersector=new l.FrustumExtentIntersection({renderCoordsHelper:A});this._renderCoordsHelper=A}var B=C.prototype;B.begin=function(A,x){this._surfaceElevation=x;this._aboveGround=this._renderCoordsHelper.getAltitude(A.eye)>x;this._frustum.update(A);this._shortenFrustumFarPlane(this._frustum);
this._updateExtendedFrustum(A)};B.end=function(){this._cache.clear()};B.calculate=function(A){if(this._allTilesInvisible)return g.Visibility.INVISIBLE;const x=this._renderCoordsHelper.viewingMode===e.ViewingMode.Global&&2<=A.lij[0]&&6>A.lij[0],u=this._getOrCalculateSingleTileVisibility(A,!x);return u!==g.Visibility.INVISIBLE&&x?this._calculateAggregatedChildrenVisibility(A):u};B._shortenFrustumFarPlane=function(A){var x=h.Frustum.nearFarLineIndices;const u=A.mutablePoints;for(const y of x){const [w,
D]=y;x=u[w];t.subtract(q,u[D],x);t.scale(q,q,.95);t.add(u[D],x,q)}A.updatePoints(u)};B._calculateAggregatedChildrenVisibility=function(A){let x=g.Visibility.INVISIBLE;var u=this._cache.get(A.id);if(null!=u)return u;u=z.acquire();A.getChildren(u);for(const y of u){const w=this.calculate(y);if(w!==g.Visibility.INVISIBLE&&(x=w,w===g.Visibility.VISIBLE_ON_SURFACE))break}z.release(u);this._cache.set(A.id,x);return x};B._getOrCalculateSingleTileVisibility=function(A,x){var u=this._cache.get(A.id);if(null!=
u)return u;u=this._calculateSingleTileVisibility(A);x&&this._cache.set(A.id,u);return u};B._calculateSingleTileVisibility=function(A){if(!this._aboveGround&&this._renderCoordsHelper.viewingMode===e.ViewingMode.Global&&12>A.lij[0]){if(this._calculateSingleTileVisibilitySided(A,!1)===g.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(A,!0)}else return this._calculateSingleTileVisibilitySided(A,this._aboveGround)};B._calculateSingleTileVisibilitySided=function(A,x){this._intersector.update(A.extent,
A.tilingScheme.spatialReference,this._surfaceElevation,x);A=r.getReferenceEllipsoid(A.tilingScheme.spatialReference).radius;return this._intersector.isVisibleInFrustum(this._extendedFrustum,A)?this._intersector.isVisibleInFrustum(this._frustum,A,!0)?g.Visibility.VISIBLE_ON_SURFACE:g.Visibility.VISIBLE_WHEN_EXTENDED:g.Visibility.INVISIBLE};B._updateExtendedFrustum=function(A){this._extendedFrustum.update(A);this._shortenFrustumFarPlane(this._extendedFrustum);var x=this._renderCoordsHelper.worldUpAtPosition(A.eye,
q);this._aboveGround||t.negate(x,x);x=c.acosClamped(-t.dot(x,A.viewForward));this._allTilesInvisible=x>(Math.PI+A.fovY)/2;if(!this._allTilesInvisible&&(this._hasExtendedFrustum=x>A.fovY/2)){A=this._extendedFrustumParameters();x=this._extendedFrustum.mutablePoints;for(let u=0;4>u;u++){const y=A.pointIndices[u],w=x[y],D=this._renderCoordsHelper.getAltitude(w);if(A.needsAltitudeAdjustment(D)){this._renderCoordsHelper.worldUpAtPosition(w,q);switch(y){case m.PointIndex.FAR_BOTTOM_LEFT:case m.PointIndex.FAR_TOP_LEFT:case m.PointIndex.NEAR_BOTTOM_LEFT:case m.PointIndex.NEAR_TOP_LEFT:d.projectVector(this._extendedFrustum.planes[m.PlaneIndex.LEFT],
q,q);break;case m.PointIndex.FAR_BOTTOM_RIGHT:case m.PointIndex.FAR_TOP_RIGHT:case m.PointIndex.NEAR_BOTTOM_RIGHT:case m.PointIndex.NEAR_TOP_RIGHT:d.projectVector(this._extendedFrustum.planes[m.PlaneIndex.RIGHT],q,q)}t.scale(q,q,A.direction);this._renderCoordsHelper.intersectInfiniteManifold(f.wrap(w,q),A.zWithMargin,w)}}this._extendedFrustum.updatePoints(x);d.fromPoints(x[m.PointIndex.NEAR_BOTTOM_LEFT],x[m.PointIndex.NEAR_BOTTOM_RIGHT],x[m.PointIndex.NEAR_TOP_RIGHT],k);d.fromPoints(x[m.PointIndex.NEAR_BOTTOM_RIGHT],
x[m.PointIndex.NEAR_TOP_RIGHT],x[m.PointIndex.NEAR_TOP_LEFT],p);0>t.dot(d.normal(k),d.normal(p))&&(A=this._extendedFrustum.mutablePoints,this._aboveGround?[A[m.PointIndex.NEAR_BOTTOM_LEFT],A[m.PointIndex.NEAR_BOTTOM_RIGHT]]=[A[m.PointIndex.NEAR_BOTTOM_RIGHT],A[m.PointIndex.NEAR_BOTTOM_LEFT]]:[A[m.PointIndex.NEAR_TOP_LEFT],A[m.PointIndex.NEAR_TOP_RIGHT]]=[A[m.PointIndex.NEAR_TOP_RIGHT],A[m.PointIndex.NEAR_TOP_LEFT]],this._extendedFrustum.updatePoints(A))}};B._extendedFrustumParameters=function(){return this._aboveGround?
this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()};B._extendedFrustumParametersAboveSurface=function(){const A=this._surfaceElevation-1;return{zWithMargin:A,pointIndices:h.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(x){return x>A}}};B._extendedFrustumParametersBelowSurface=function(){const A=this._surfaceElevation+1;return{zWithMargin:A,pointIndices:h.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(x){return x<A}}};
return C}();const q=n.create(),k=d.create(),p=d.create(),z=new b(Array,C=>{4!==C.length&&(C[0]=new g.FeatureTileDescriptor3D,C[1]=new g.FeatureTileDescriptor3D,C[2]=new g.FeatureTileDescriptor3D,C[3]=new g.FeatureTileDescriptor3D)},C=>{C[0].release();C[1].release();C[2].release();C[3].release()});a.FeatureTileVisibility3D=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){const z=.5*Math.PI,C=z/Math.PI*180;let B=function(){function E(J){this._renderCoordsHelper=J.renderCoordsHelper;this._extent=Array(4);this._planes=Array(6);this._maxSpan=0;this._center={origin:m.create(),direction:m.create()};for(J=0;4>J;J++)this._extent[J]={origin:m.create(),direction:m.create(),cap:{next:null,direction:m.create()}},this._planes[J]=v.create();this._planes[h.PlaneIndex.NEAR]=v.create();this._planes[h.PlaneIndex.FAR]=v.create();this._planesWithoutFar=
this._planes.slice(0,5)}var K=E.prototype;K.update=function(J,M,N,P=!0){const I=this._extent;this._toRenderBoundingExtent(J,M,N);r.add(this._center.origin,I[0].origin,I[2].origin);r.scale(this._center.origin,this._center.origin,.5);this._renderCoordsHelper.worldUpAtPosition(this._center.origin,this._center.direction);P||r.scale(this._center.direction,this._center.direction,-1);for(N=0;4>N;N++){const G=I[N];this._renderCoordsHelper.worldUpAtPosition(G.origin,G.direction);const H=I[3===N?0:N+1];G.cap.next=
H.origin;r.direction(G.cap.direction,G.origin,H.origin);v.fromVectorsAndPoint(G.direction,G.cap.direction,G.origin,this._planes[N]);P||r.scale(G.direction,G.direction,-1)}v.fromVectorsAndPoint(I[0].cap.direction,I[1].cap.direction,I[0].origin,this._planes[h.PlaneIndex.NEAR]);P?v.negate(this._planes[h.PlaneIndex.NEAR],this._planes[h.PlaneIndex.FAR]):(v.copy(this._planes[h.PlaneIndex.FAR],this._planes[h.PlaneIndex.NEAR]),v.negate(this._planes[h.PlaneIndex.NEAR],this._planes[h.PlaneIndex.NEAR]));this._maxSpan=
Math.max(Math.abs(J[0]-J[2]),Math.abs(J[1]-J[3]));this._maxSpanSpatialReference=M;this._minGlobalAltitude=.9*d.getReferenceEllipsoid(this._maxSpanSpatialReference).radius};K.isVisibleInFrustum=function(J,M,N=!1){if(null==J)return!1;if(this._renderCoordsHelper.viewingMode===k.ViewingMode.Global){if(this._maxSpan>(this._maxSpanSpatialReference.isGeographic?C:z*M))return!0;if(null!=J.altitude&&J.altitude>=this._minGlobalAltitude)return this._isVisibleInFrustumGlobal(J)}if(0===this._maxSpan)return M=
this._extent[0],!N&&J.intersectsRay(q.wrap(M.origin,M.direction))?!0:!1;for(M=0;M<this._extent.length;M++){var P=this._extent[M];if(!N&&J.intersectsRay(q.wrap(P.origin,P.direction))||J.intersectsLineSegment(l.fromPoints(P.origin,P.cap.next,F),P.cap.direction))return!0}N=N?this._planes:this._planesWithoutFar;for(M=0;M<J.lines.length;M++)if(P=J.lines[M],p.frustumLineSegment(N,P.origin,P.endpoint,P.direction))return!0;return!1};K._toRenderBoundingExtentGlobal=function(J,M,N){g.center(J,x);x[2]=N;f.computeTranslationToOriginAndRotation(M,
x,u,this._renderCoordsHelper.spatialReference);t.invert(y,u);e.empty(w);for(const {x0:P,x1:I,y0:G,y1:H}of A)for(let L=0;5>L;L++){const O=L/4;x[0]=b.lerp(J[P],J[I],O);x[1]=b.lerp(J[G],J[H],O);x[2]=N;f.projectVectorToVector(x,M,x,this._renderCoordsHelper.spatialReference);r.transformMat4(x,x,y);e.expandWithVec3(w,x)}r.set(this._extent[0].origin,w[0],w[1],w[2]);r.set(this._extent[1].origin,w[3],w[1],w[2]);r.set(this._extent[2].origin,w[3],w[4],w[2]);r.set(this._extent[3].origin,w[0],w[4],w[2]);for(J=
0;4>J;++J)r.transformMat4(this._extent[J].origin,this._extent[J].origin,u)};K._toRenderBoundingExtentLocal=function(J,M,N){f.projectBoundingRect(J,M,D,this._renderCoordsHelper.spatialReference);r.set(this._extent[0].origin,D[0],D[1],N);r.set(this._extent[1].origin,D[2],D[1],N);r.set(this._extent[2].origin,D[2],D[3],N);r.set(this._extent[3].origin,D[0],D[3],N)};K._toRenderBoundingExtent=function(J,M,N){switch(this._renderCoordsHelper.viewingMode){case k.ViewingMode.Global:this._toRenderBoundingExtentGlobal(J,
M,N);break;case k.ViewingMode.Local:this._toRenderBoundingExtentLocal(J,M,N);break;default:c.neverReached(this._renderCoordsHelper.viewingMode)}};K._isVisibleInFrustumGlobal=function(J){if(0>v.signedDistance(J.planes[h.PlaneIndex.NEAR],this._center.origin)&&0>r.dot(this._center.direction,J.direction))return!0;for(let M=0;4>M;M++){const N=this._extent[M];if(0>v.signedDistance(J.planes[h.PlaneIndex.NEAR],N.origin)&&0>r.dot(N.direction,J.direction))return!0}return!1};return E}();const A=[{x0:0,y0:1,
x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],x=m.create(),u=n.create(),y=n.create(),w=e.create(),D=g.create(),F=l.create();a.FrustumExtentIntersection=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(a,c,b,t){const n=b.create();a.projectToBoundingBox=function(r,m,d){if(c.isNone(r)||c.isNone(d))return!1;
let f;n[0]=null!=r.xmin?r.xmin:0;n[1]=null!=r.ymin?r.ymin:0;n[2]=null!=r.zmin?r.zmin:0;f=t.projectBuffer(n,r.spatialReference,0,m,d,0,1);n[0]=null!=r.xmax?r.xmax:0;n[1]=null!=r.ymax?r.ymax:0;n[2]=null!=r.zmax?r.zmax:0;f=f&&t.projectBuffer(n,r.spatialReference,0,m,d,3,1);null==r.xmin&&(m[0]=-Infinity);null==r.ymin&&(m[1]=-Infinity);null==r.zmin&&(m[2]=-Infinity);null==r.xmax&&(m[3]=Infinity);null==r.ymax&&(m[4]=Infinity);null==r.zmax&&(m[5]=Infinity);return f};a.toBoundingRect=function(r,m,d){if(c.isNone(r)||
c.isNone(d))return!1;let f;n[0]=null!=r.xmin?r.xmin:0;n[1]=null!=r.ymin?r.ymin:0;n[2]=null!=r.zmin?r.zmin:0;f=t.projectBuffer(n,r.spatialReference,0,n,d,0,1);m[0]=n[0];m[1]=n[1];n[0]=null!=r.xmax?r.xmax:0;n[1]=null!=r.ymax?r.ymax:0;n[2]=null!=r.zmax?r.zmax:0;f=f&&t.projectBuffer(n,r.spatialReference,0,n,d,0,1);m[2]=n[0];m[3]=n[1];null==r.xmin&&(m[0]=-Infinity);null==r.ymin&&(m[1]=-Infinity);null==r.xmax&&(m[2]=Infinity);null==r.ymax&&(m[3]=Infinity);return f};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/ellipsoidUtils ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera ../../support/RenderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A){b=function(u){function y(){var D=u.apply(this,arguments)||this;D._propertiesPool=new C.PropertiesPool({camera:B.Camera},a._assertThisInitialized(D));D._lastSeenCameraProjectionValues=new B.Camera;D.mode=A.RenderState.ANIMATING;D.rasterPixelRatio=1;D.contentPixelRatio=1;D.events=new t;D.viewingMode=q.ViewingMode.Global;D._cameraChanged=!1;D._updateQueue=[];D._processingUpdates=!1;return D}a._inheritsLoose(y,u);var w=y.prototype;w.init=function(D,
F){this._set("viewingMode",D);this._set("spatialReference",F);this._set("constraints",new k.Constraints({mode:this.viewingMode}))};w.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new C.PropertiesPool({camera:B.Camera},this)};w.createInitialCamera=function(){if(this.viewingMode===q.ViewingMode.Global){const D=l.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new B.Camera({eye:h.fromValues(4*D,0,0),center:h.fromValues(D,0,0),up:h.fromValues(0,
0,1)})}else this.camera=new B.Camera({eye:h.fromValues(0,0,100),center:h.fromValues(0,0,0),up:h.fromValues(0,1,0)})};w.switchCameraController=function(D){this.cameraController=D;return D.state!==z.State.Rejected};w.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};w.updateCamera=function(D){this._updateQueue.push(D);this._processUpdateQueue()};w._processUpdateQueue=function(){if(0!==this._updateQueue.length&&!this._processingUpdates){this._processingUpdates=
!0;var D=this._updateQueue.shift();x.copyFrom(this._get("camera"));D(x);this.camera=x;this._processingUpdates=!1;this._processUpdateQueue()}};w._cameraProjectionChanged=function(D,F){return D.fov!==F.fov||D.fullViewport[0]!==F.fullViewport[0]||D.fullViewport[1]!==F.fullViewport[1]||D.fullViewport[2]!==F.fullViewport[2]||D.fullViewport[3]!==F.fullViewport[3]||D.padding[B.PaddingSide.TOP]!==F.padding[B.PaddingSide.TOP]||D.padding[B.PaddingSide.RIGHT]!==F.padding[B.PaddingSide.RIGHT]||D.padding[B.PaddingSide.BOTTOM]!==
F.padding[B.PaddingSide.BOTTOM]||D.padding[B.PaddingSide.LEFT]!==F.padding[B.PaddingSide.LEFT]?!0:!1};a._createClass(y,[{key:"animation",get:function(){return this.cameraController instanceof p.AnimationController&&n.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(D){D!==x&&x.copyFrom(D);x.computeUp(this.viewingMode);this.events.emit("before-camera-change",x);D=this._get("camera");this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,
x)&&(this._lastSeenCameraProjectionValues.copyFrom(x),this.events.emit("camera-projection-changed",this._lastSeenCameraProjectionValues));if(!D||!D.equals(x))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(x)),this._cameraChanged=!D||!D.almostEquals(x)){const F=g.afterDispatch(()=>{this._cameraChanged=!1;F.remove()})}}},{key:"pixelRatio",get:function(){return this.camera.pixelRatio}},{key:"contentCamera",get:function(){return n.unwrapOr(this._contentCamera,this.camera)},set:function(D){this._contentCamera=
n.isSome(D)?D.clone():null}},{key:"fixedContentCamera",get:function(){return n.isSome(this._contentCamera)}},{key:"isGlobal",get:function(){return this.viewingMode===q.ViewingMode.Global}},{key:"isLocal",get:function(){return this.viewingMode===q.ViewingMode.Local}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},
set:function(D){this.stopActiveCameraController()?(D&&(this.removeHandles("ViewStateHandles"),this.addHandles(r.when(()=>D.state===z.State.Finished||D.state===z.State.Stopped,()=>{this._set("cameraController",null);this.updateCamera(F=>D.onControllerEnd(F))},{sync:!0,once:!0}),"ViewStateHandles"),D.onControllerStart(this.camera)),this._set("cameraController",D)):D&&(D.state=z.State.Rejected)}}]);return y}(b);c.__decorate([m.property()],b.prototype,"mode",void 0);c.__decorate([m.property({readOnly:!0,
type:v})],b.prototype,"animation",null);c.__decorate([m.property({type:B.Camera})],b.prototype,"camera",null);c.__decorate([m.property({readOnly:!0})],b.prototype,"pixelRatio",null);c.__decorate([m.property()],b.prototype,"rasterPixelRatio",void 0);c.__decorate([m.property()],b.prototype,"contentPixelRatio",void 0);c.__decorate([m.property({})],b.prototype,"_contentCamera",void 0);c.__decorate([m.property({type:B.Camera})],b.prototype,"contentCamera",null);c.__decorate([m.property({readOnly:!0})],
b.prototype,"fixedContentCamera",null);c.__decorate([m.property({readOnly:!0})],b.prototype,"constraints",void 0);c.__decorate([m.property({readOnly:!0})],b.prototype,"events",void 0);c.__decorate([m.property({readOnly:!0})],b.prototype,"isGlobal",null);c.__decorate([m.property({readOnly:!0})],b.prototype,"isLocal",null);c.__decorate([m.property({readOnly:!0})],b.prototype,"viewingMode",void 0);c.__decorate([m.property({readOnly:!0})],b.prototype,"spatialReference",void 0);c.__decorate([m.property()],
b.prototype,"navigating",null);c.__decorate([m.property()],b.prototype,"stationary",null);c.__decorate([m.property()],b.prototype,"_cameraChanged",void 0);c.__decorate([m.property()],b.prototype,"cameraController",null);c=b=c.__decorate([e.subclass("esri.views.3d.state.ViewState")],b);const x=new B.Camera;return c})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(u){C&&C.viewingMode===u||(C=h.newIntersector(u));return C}let k=function(){function u(w,D,F){this.viewingMode=w;this._forEachLayer=D;this._view=F;this._externalIntersectionHandlers=new b;this._tolerance=h.DEFAULT_TOLERANCE;this._tmpRay=d.create();this._tmpRegion=m.create();this._validateHUDIntersector=h.newIntersector(this.viewingMode);this._validateHUDIntersector.options.hud=!1}var y=u.prototype;y.intersectScreen=function(w,D,F){return this.intersectRay(this._getPickRay(w,
this._tmpRay),q(this.viewingMode),D,F)};y.intersectScreenFreePointFallback=function(w,D,F){return this.intersectRayFreePointFallback(this._getPickRay(w,this._tmpRay),D,F)};y.intersectRayFreePointFallback=function(w,D,F){return this.intersectRay(w,q(this.viewingMode),D,F)||this._intersectRayFreePointLocal(w,D)};y.intersectRay=function(w,D,F,E){D.options.selectionMode=!1;D.options.store=l.StoreResults.MIN;this.computeIntersection(w,D,E);return D.results.min?D.results.min.getIntersectionPoint(F):!1};
y.getCenterRayWithSubpixelOffset=function(w,D,F=.5,E=.5){w.getRenderCenter(x,F,E);x[0]+=.0466;x[1]-=.0123;return g.fromRenderAtEye(w,x,D)};y.intersectIntersectorScreen=function(w,D,F){this.computeIntersection(this._getPickRay(w,this._tmpRay),D,F)};y.intersectToolIntersectorScreen=function(w,D,F){w=this._getPickRay(w,this._tmpRay);this.intersectToolIntersectorRay(w,D,F)};y.intersectToolIntersectorRay=function(w,D,F){D.options.selectionMode=!0;this.computeIntersection(w,D,F);const E=D.results.min;this._view.basemapTerrain&&
this._view.basemapTerrain.opaque||v.isValidIntersectorResult(E)&&E.intersector!==l.IntersectorType.TERRAIN||(D.options.selectionMode=!1,this.computeIntersection(w,D,F))};y.setTolerance=function(w=h.DEFAULT_TOLERANCE){this._tolerance=w};y.addIntersectionHandler=function(w){this._externalIntersectionHandlers.push(w);this._externalIntersectionHandlers.sort((D,F)=>D.type===l.IntersectorType.TERRAIN?1:F.type===l.IntersectorType.TERRAIN?-1:0)};y.removeIntersectionHandler=function(w){null!=this._externalIntersectionHandlers.removeUnordered(w)&&
this._externalIntersectionHandlers.sort((D,F)=>D.type===l.IntersectorType.TERRAIN?1:F.type===l.IntersectorType.TERRAIN?-1:0)};y._getPickRay=function(w,D){return g.fromScreen(this._view.state.camera,w,D)};y._intersectRayFreePointLocal=function(w,D){if(this.viewingMode!==e.ViewingMode.Local||c.isNone(w))return!1;n.add(D,w.origin,n.normalize(f.sv3d.get(),w.direction));return!1};y.intersectElevationFromScreen=function(w,D,F=0,E=null){return this._intersectElevation(this._getPickRay(w,this._tmpRay),D,
F,E)};y._intersectElevation=function(w,D,F=0,E=null){if(c.isNone(w))return null;var K=c.isSome(D)?D.mode:"absolute-height",J=c.isSome(D)?c.unwrapOr(D.offset,0):0,M="on-the-ground"!==K?J+F:0;D=M/this._view.renderCoordsHelper.unitInMeters;if("absolute-height"===K)return this._view.renderCoordsHelper.intersectInfiniteManifold(w,M,A)?(F=this._view.computeMapPointFromVec3d(A),F.z??(F.z=0),F.z-=J,F):null;J=this._view.state.camera;const N=t.castRenderScreenPointArray3(f.sv3d.get());J.projectToRenderScreen(w.origin,
N);M=new B(null,this._forEachLayer);const P=this._view.slicePlane,I=c.isSome(P)?v.sliceFilterPredicate(P):null,G=h.newIntersector(this.viewingMode);G.options.store=l.StoreResults.MIN;G.options.verticalOffset=D;D=w.origin;w=n.add(f.sv3d.get(),D,w.direction);G.reset(D,w,J);G.point=N;const H=c.isSome(E)?"type"in E&&"graphics"===E.type?L=>L.metadata?.layerUid!==E.uid:L=>L.metadata?.graphicUid!==E.uid:null;switch(K){case "relative-to-scene":G.intersect(M.layers,N,this._tolerance,null,L=>(c.isNone(H)||
H(L))&&!!L.metadata?.isElevationSource);this._externalIntersectionHandlers.forAll(L=>{L.type!==l.IntersectorType.I3S&&L.type!==l.IntersectorType.TERRAIN||L.intersect(G,L.slicePlaneEnabled?I:null,G.rayBegin,G.rayEnd,N)});break;case "on-the-ground":case "relative-to-ground":this._externalIntersectionHandlers.forAll(L=>{L.isGround&&L.intersect(G,L.slicePlaneEnabled?I:null,G.rayBegin,G.rayEnd,N)})}return G.results.min.getIntersectionPoint(A)?(K=this._view.computeMapPointFromVec3d(A),K.z=F,K):null};y.computeIntersection=
function(w,D,F){if(!c.isNone(w)){var E=this._view.state.camera,K=t.castRenderScreenPointArray3(f.sv3d.get());E.projectToRenderScreen(w.origin,K);var J=new B(F,this._forEachLayer);D.options.selectOpaqueTerrainOnly=!F||!("include"in F||"exclude"in F);var M=w.origin,N=n.add(f.sv3d.get(),w.origin,w.direction);D.reset(M,N,E);D.intersect(J.layers,K,this._tolerance);w=this._view.slicePlane;var P=c.isSome(w)?v.sliceFilterPredicate(w):null;D.intersect(J.sliceableLayers,K,this._tolerance,P);var I=F&&(F.requiresGroundFeedback||
F.enableDraped);this._externalIntersectionHandlers.forAll(G=>{var H=G.layerUid;const L=Array.isArray(H);H=L?H:[H];L&&(D.options.filteredLayerUids=[]);let O=!1;for(const S of H)J.filterLayerUid(S)?O=!0:L&&D.options.filteredLayerUids.push(S);D.options.isFiltered=!O;(G.isGround&&I||!D.options.isFiltered)&&G.intersect(D,G.slicePlaneEnabled?P:null,M,N,K)});w=f.sv3d.get();E=this._view.basemapTerrain;if(F&&F.enableDraped&&c.isSome(E.spatialReference)&&D.results.ground.getIntersectionPoint(w)){F=E.overlayManager.renderer;
const G=this._view.renderCoordsHelper.spatialReference,H=f.sv3d.get();this._view.renderCoordsHelper.fromRenderCoords(w,H,E.spatialReference);H[2]=c.unwrapOr(this._view.elevationProvider?.getElevation(w[0],w[1],w[2],G,"ground"),0);F.intersect(D,H,D.results.ground,L=>J.filterRenderGeometry(L))}D.sortResults();this._processHUDResults(D)}};y._processHUDResults=function(w){var D=w.results.hud;m.copy(this._tmpRegion,m.NEGATIVE_INFINITY);const F=this._view.state.camera,E=[],K=this._tmpRegion;var J=H=>{const L=
new z(H);F.projectToRenderScreen(H.target.center,L.screenPoint);L.screenPoint[0]=Math.floor(L.screenPoint[0]);L.screenPoint[1]=Math.floor(L.screenPoint[1]);E.push(L);m.expandPointInPlace(K,L.screenPoint)};w.sortResults(D.all);c.isSome(D.min.dist)&&J(D.min);for(var M of D.all)D.min.target.object!==M.target.object&&D.max.target.object!==M.target.object&&J(M);c.isSome(D.max.dist)&&D.max.target.object!==D.min.target.object&&J(D.max);if(E.length){K[0]===K[2]&&(K[2]+=1);K[1]===K[3]&&(K[3]+=1);D=F.fullWidth;
J=F.fullHeight;var N=Math.max(0,K[0]-1),P=Math.max(0,K[1]-1);M=Math.min(m.width(K)+2,D-N);var I=Math.min(m.height(K)+2,J-P),G=new Uint8Array(M*I*4);this._view._stage.renderer.readHUDVisibility(N,P,M,I,G);N=!0;P=c.isNone(w.results.max.dist);I=0;for(const H of E)for(const L of p)if(G[4*(Math.min(H.screenPoint[0]+L[0],D)-K[0]+(Math.min(H.screenPoint[1]+L[1],J)-K[1])*M)]){N&&(w.results.min.copy(H.result),N=!1);P&&w.results.max.copy(H.result);w.options.store===l.StoreResults.ALL&&w.results.all.splice(I++,
0,H.result);break}}};return u}();const p=(()=>{const u=[];for(let y=-1;1>=y;y++)for(let w=-1;1>=w;w++)u.push([w+1,y+1]);return u})();let z=function(u){this.result=u;this.screenPoint=t.createRenderScreenPointArray3()},C,B=function(){function u(w,D){this.layers=[];this.sliceableLayers=[];this.include=w?.include;this.exclude=w?.exclude;D(F=>{F.pickable&&this.filterLayerUid(F.apiLayerUid)&&(F.sliceable?this.sliceableLayers:this.layers).push(F)})}var y=u.prototype;y.filterLayerUid=function(w){const {include:D,
exclude:F}=this;return c.isNone(w)?null==D&&null==F:(null==D||D.has(w))&&(null==F||!F.has(w))};y.filterRenderGeometry=function(w){return this.filterLayerUid(w.layerUid)};return u}();const A=r.create(),x=t.createRenderScreenPointArray3();a.SceneIntersectionHelper=k;a.isIntersectionHandler=function(u){return"object"===typeof u&&"intersect"in u};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../layers/graphics/ElevationQuery".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){function v(q,k,p,z,C,B,A){for(const x of k)k=x.getElevation(p,z,C,B,A),r.isSome(k)&&(q=r.isSome(q)?Math.max(k,q):k);return q}a.CombinedElevationProvider=function(q){function k(z){z=q.call(this,z)||this;z._im=[];z._ground=[];z._scene=[];z._handles=new Map;z.lastElevationQuery=null;z.elevationCacheEnabled=!1;return z}c._inheritsLoose(k,q);var p=k.prototype;p.destroy=function(){this._elevationQueryCached=r.destroyMaybe(this._elevationQueryCached)};p.enableElevationCache=
function(z){z||(this.lastElevationQuery=null);this.elevationCacheEnabled=z};p.getElevation=function(z,C,B,A,x){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var u=this.lastElevationQuery;if(z===u.x&&C===u.y&&B===u.z&&h.equals(A,u.spatialReference)&&x===u.queryContext)return u.result}u=v(null,this._im,z,C,B,A,x);r.isNone(u)&&(u=v(u,this._ground,z,C,B,A,x));"scene"===x&&(u=v(u,this._scene,z,C,B,A,x));this.elevationCacheEnabled&&(this.lastElevationQuery={x:z,y:C,z:B,spatialReference:A,
queryContext:x,result:u});return u};p.queryElevation=function(z,C,B,A,x,u=null,y=0){const w=m.createResolver();this._elevationQuery.queryElevation(z,C,u,y).then(D=>{"scene"===x&&(D=v(D,this._scene,z,C,B,A,x));w.resolve(D)}).catch(D=>{m.isAbortError(D)?w.reject(D):w.resolve(this.getElevation(z,C,B,A,x))});return w.promise};p.register=function(z,C){this._handles.set(C,C.on("elevation-change",B=>this.emit("elevation-change",B)));this._providersFromContext(z).push(C)};p.unregister=function(z){this._handles.has(z)&&
(this._handles.get(z)?.remove(),this._handles.delete(z));for(const C of[this._im,this._ground,this._scene]){const B=C.indexOf(z);-1<B&&C.splice(B,1)}};p._providersFromContext=function(z){switch(z){case "ground":return this._ground;case "im":return this._im;case "scene":return this._scene}};c._createClass(k,[{key:"spatialReference",get:function(){return this.view?.basemapTerrain?.spatialReference}},{key:"_elevationQuery",get:function(){r.isNone(this._elevationQueryCached)&&(this._elevationQueryCached=
new l.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQueryCached}}]);return k}(n.EventedMixin(t));b.__decorate([d.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,"view",void 0);b.__decorate([d.property()],a.CombinedElevationProvider.prototype,"spatialReference",null);a.CombinedElevationProvider=b.__decorate([g.subclass("esri.views.3d.support.CombinedElevationProvider")],
a.CombinedElevationProvider);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),function(a,c,b,t,n,r,m,d){b=function(){function e(h,l){this.spatialReference=h;this._view=l}var g=e.prototype;g.getElevation=
function(h,l,v){return this._view.elevationProvider.getElevation(h,l,0,this.spatialReference,v)};g.queryElevation=function(){var h=c._asyncToGenerator(function*(l,v,q,k,p){return this._view.elevationProvider.queryElevation(l,v,0,this.spatialReference,p,q,k)});return function(l,v,q,k,p){return h.apply(this,arguments)}}();return e}();let f=function(){function e(h,l,v,q){this.spatialReference=l;this._getElevationQueryProvider=v;this._queries=[];this._queryOptions={...q,ignoreInvisibleLayers:!0};this._frameTask=
h.registerTask(m.TaskPriority.ELEVATION_QUERY,this)}var g=e.prototype;g.destroy=function(){this._frameTask.remove()};g.queryElevation=function(h,l,v,q=0){return new Promise((k,p)=>{const z={x:h,y:l,minDemResolution:q,result:{resolve:k,reject:p},signal:v};this._queries.push(z);r.onAbort(v,()=>{t.remove(this._queries,z);p(r.createAbortError())})})};g.runTask=function(h){const l=this._queries;this._queries=[];const v=this._getElevationQueryProvider();if(v){var q=l.map(C=>[C.x,C.y]),k=l.reduce((C,B)=>
Math.min(C,B.minDemResolution),Infinity);q=new d({points:q,spatialReference:this.spatialReference});var p=1<l.length&&l.some(C=>!!C.signal)?new AbortController:null,z=n.isSome(p)?p.signal:l[0].signal;if(n.isSome(p)){let C=0;l.forEach(B=>r.onAbort(B.signal,()=>{C++;B.result.reject(r.createAbortError());C===l.length&&p.abort()}))}v.queryElevation(q,{...this._queryOptions,minDemResolution:k,signal:z}).then(C=>{l.forEach((B,A)=>{n.isSome(B.signal)&&B.signal.aborted?B.result.reject(r.createAbortError()):
B.result.resolve(C.geometry.points[A][2])})}).catch(C=>{l.forEach(B=>B.result.reject(C))})}else l.forEach(C=>C.result.reject());h.madeProgress()};c._createClass(e,[{key:"running",get:function(){return 0<this._queries.length}},{key:"test",get:function(){const h=this;return{update:()=>0<h._queries.length&&h.runTask(m.noBudget)}}}]);return e}();a.ElevationQuery=f;a.ViewElevationProvider=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has",
"../../../core/time"],function(a,c){function b(){const n=!!a("esri-mobile"),r=!!a("ios"),m=c.Milliseconds(400);return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1,skipHighSymbolLods:!0},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25E3},sceneService:{object:{lodFactor:.2,lodCrossfadeinDuration:c.Milliseconds(0),lodCrossfadeoutDuration:c.Milliseconds(0),lodCrossfadeUncoveredDuration:c.Milliseconds(0)},
point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:c.Milliseconds(0)},fadeDuration:c.Milliseconds(0),antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:n?
.8:1,polylineLodFactor:n?1.2:1.5,snapshotAvailable:!r,skipHighSymbolLods:!1},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:c.Milliseconds(0),lodCrossfadeoutDuration:c.Milliseconds(0),lodCrossfadeUncoveredDuration:m},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:n},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),
textureFadeDuration:m},fadeDuration:m,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:n?600:750,additionalCacheMemory:n?0:150,frameRate:0,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:n?1.2:2,polylineLodFactor:n?1.2:2,snapshotAvailable:!r,skipHighSymbolLods:!1},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5E4},sceneService:{object:{lodFactor:1,lodCrossfadeinDuration:c.Milliseconds(0),
lodCrossfadeoutDuration:c.Milliseconds(0),lodCrossfadeUncoveredDuration:m},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:m},fadeDuration:m,antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:n?900:1500,additionalCacheMemory:0,frameRate:0,maximumPixelRatio:n?
1:Infinity}}}let t=function(){function n(){}n.isValidProfile=function(r){return r in n.profiles};n.getDefaultProfile=function(){return a("esri-iPhone")?"low":"medium"};n.apply=function(r,m){r=n.profiles[r];m.graphics3D.maxTotalNumberOfFeatures=r.graphics3D.maxTotalNumberOfFeatures;m.graphics3D.maxTotalNumberOfPrimitives=r.graphics3D.maxTotalNumberOfPrimitives;m.graphics3D.polygonLodFactor=r.graphics3D.polygonLodFactor;m.graphics3D.polylineLodFactor=r.graphics3D.polylineLodFactor;m.graphics3D.snapshotAvailable=
r.graphics3D.snapshotAvailable;m.graphics3D.skipHighSymbolLods=r.graphics3D.skipHighSymbolLods;const d=m.sceneService.object,f=r.sceneService.object;d.lodFactor=f.lodFactor;d.lodCrossfadeinDuration=f.lodCrossfadeinDuration;d.lodCrossfadeoutDuration=f.lodCrossfadeoutDuration;d.lodCrossfadeUncoveredDuration=f.lodCrossfadeUncoveredDuration;m.sceneService.point.lodFactor=r.sceneService.point.lodFactor;m.sceneService.integratedMesh.lodFactor=r.sceneService.integratedMesh.lodFactor;m.sceneService.pointCloud.lodFactor=
r.sceneService.pointCloud.lodFactor;m.sceneService.uncompressedTextureDownsamplingEnabled=r.sceneService.uncompressedTextureDownsamplingEnabled;m.tiledSurface.lodBias=r.tiledSurface.lodBias;m.tiledSurface.angledSplitBias=r.tiledSurface.angledSplitBias;m.tiledSurface.reduceTileLevelDifferences=r.tiledSurface.reduceTileLevelDifferences;m.tiledSurface.textureFadeDuration=r.tiledSurface.textureFadeDuration;m.heatmap.pixelRatio=r.heatmap.pixelRatio;m.heatmap.maxTotalNumberOfFeatures=r.heatmap.maxTotalNumberOfFeatures;
m.fadeDuration=r.fadeDuration;m.antialiasingEnabled=r.antialiasingEnabled;m.physicallyBasedRenderingEnabled=r.physicalBasedRenderingEnabled;m.highQualityTransparency=r.highQualityTransparency;m.memoryLimit=r.memoryLimit;m.additionalCacheMemory=r.additionalCacheMemory;m.frameRate=r.frameRate;m.maximumPixelRatio=r.maximumPixelRatio};return n}();t.test={reset(){const n=b();for(const r in n)t.profiles[r]=n[r]}};(t||(t={})).profiles=b();return t})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f32 ../../../chunks/vec4f64".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){const h=new b([0,255,255]),l=new b([0,0,0]);t=function(v){function q(){var k=v.apply(this,arguments)||this;k.color=h.clone();k.haloColor=null;k.haloOpacity=1;k.fillOpacity=.25;k.shadowOpacity=.4;k.shadowColor=l.clone();k.shadowDifference=.2;return k}a._inheritsLoose(q,v);q.toEngineOptions=function(k){const p=b.toUnitRGBA(k.color??h),z=n.isSome(k.haloColor)?b.toUnitRGBA(k.haloColor):p,C=b.toUnitRGBA(k.shadowColor??l),B=k.haloOpacity??1,A=k.fillOpacity??.25,x=k.shadowOpacity??
.4;k=k.shadowDifference??.2;return{color:e.fromValues(p[0],p[1],p[2],p[3]),haloColor:e.fromValues(z[0],z[1],z[2],z[3]),haloOpacity:B,haloOpacityOccluded:.25*B,fillOpacity:A,fillOpacityOccluded:.25*A,shadowOpacity:x,shadowColor:g.fromValues(C[0],C[1],C[2],C[3]),occludedShadowOpacity:x*(1-k)}};return q}(t);c.__decorate([r.property({type:b})],t.prototype,"color",void 0);c.__decorate([r.property({type:b})],t.prototype,"haloColor",void 0);c.__decorate([r.property()],t.prototype,"haloOpacity",void 0);c.__decorate([r.property()],
t.prototype,"fillOpacity",void 0);c.__decorate([r.property()],t.prototype,"shadowOpacity",void 0);c.__decorate([r.property({type:b})],t.prototype,"shadowColor",void 0);c.__decorate([r.property()],t.prototype,"shadowDifference",void 0);return t=c.__decorate([f.subclass("esri.views.3d.support.HighlightOptions")],t)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function c(){return new Float32Array(4)}function b(C){const B=new Float32Array(4);B[0]=C[0];B[1]=C[1];B[2]=C[2];B[3]=C[3];
return B}function t(C,B,A,x){const u=new Float32Array(4);u[0]=C;u[1]=B;u[2]=A;u[3]=x;return u}function n(C,B){return new Float32Array(C,B,4)}function r(){return c()}function m(){return t(1,1,1,1)}function d(){return t(1,0,0,0)}function f(){return t(0,1,0,0)}function e(){return t(0,0,1,0)}function g(){return t(0,0,0,1)}const h=c(),l=m(),v=d(),q=f(),k=e(),p=g(),z=Object.freeze(Object.defineProperty({__proto__:null,ONES:l,UNIT_W:p,UNIT_X:v,UNIT_Y:q,UNIT_Z:k,ZEROS:h,clone:b,create:c,createView:n,fromValues:t,
ones:m,unitW:g,unitX:d,unitY:f,unitZ:e,zeros:r},Symbol.toStringTag,{value:"Module"}));a.ONES=l;a.UNIT_W=p;a.UNIT_X=v;a.UNIT_Y=q;a.UNIT_Z=k;a.ZEROS=h;a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.ones=m;a.unitW=g;a.unitX=d;a.unitY=f;a.unitZ=e;a.vec4f32=z;a.zeros=r})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/ellipsoidUtils ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){b=function(){function h(l,v){this.spatialReference=v;this.unitInMeters=n.getMetersPerUnitForSR(this.spatialReference,r.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=m.getGeometryServiceURL(l&&l.get("portalItem")).catch(()=>{throw new t("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}h.prototype.toGeographic=function(){var l=c._asyncToGenerator(function*(v){var q=yield this._geometryServiceURLPromise;
let k=!0;Array.isArray(v[0])&&"number"!==typeof v[0]||(v=[v],k=!1);v=v.map(p=>p instanceof e?p:new e(p,this.spatialReference));v=new f({geometries:v,outSpatialReference:g.WGS84});q=(yield d.project(q,v)).map(p=>"point"===p.type?[p.x,p.y]:void 0).filter(p=>!!p);return k?q:q[0]});return function(v){return l.apply(this,arguments)}}();return h}();a.MapCoordsHelper=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,c,b,t,n,r,m){function d(){return f.apply(this,arguments)}function f(){f=c._asyncToGenerator(function*(g=null,h){if(b.geometryServiceUrl)return b.geometryServiceUrl;if(!g)throw new t("internal:geometry-service-url-not-configured");g="portal"in g?g.portal||n.getDefault():g;yield g.load({signal:h});h=g.helperServices?.geometry?.url;if(!h)throw new t("internal:geometry-service-url-not-configured");return h});return f.apply(this,arguments)}function e(){e=c._asyncToGenerator(function*(g,h,l=
null,v){l=yield d(l,v);const q=new m;q.geometries=[g];q.outSpatialReference=h;if((g=yield r.project(l,q,{signal:v}))&&Array.isArray(g)&&1===g.length)return g[0];throw new t("internal:geometry-service-projection-failed");});return e.apply(this,arguments)}a.getGeometryServiceURL=d;a.projectGeometry=function(g,h){return e.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/geometryService/project":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),
function(a,c,b,t,n,r,m,d){function f(){f=c._asyncToGenerator(function*(g,h,l){h=e(h);g=r.parseUrl(g);const v={...g.query,f:"json",...h.toJSON()},q=h.outSpatialReference,k=n.getJsonType(h.geometries[0]);h=r.asValidOptions(v,l);return b(g.path+"/project",h).then(({data:{geometries:p}})=>m.decodeGeometries(p,k,q))});return f.apply(this,arguments)}const e=t.ensureType(d);a.project=function(g,h,l){return f.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,c,b,t,n,r,m,d){b=function(f){function e(g){g=f.call(this,g)||this;g.geometries=[];g.outSpatialReference=null;g.transformation=null;g.transformForward=null;return g}a._inheritsLoose(e,f);e.prototype.toJSON=function(){const g=this.geometries.map(v=>v.toJSON()),h=this.geometries[0],l={};l.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());l.inSR=h.spatialReference.wkid||JSON.stringify(h.spatialReference.toJSON());l.geometries=JSON.stringify({geometryType:d.getJsonType(h),
geometries:g});this.transformation&&(l.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=this.transformForward&&(l.transformForward=this.transformForward);return l};return e}(b.JSONSupport);c.__decorate([t.property()],b.prototype,"geometries",void 0);c.__decorate([t.property({json:{read:{source:"outSR"}}})],b.prototype,"outSpatialReference",void 0);c.__decorate([t.property()],b.prototype,"transformation",void 0);c.__decorate([t.property()],b.prototype,"transformForward",
void 0);return b=c.__decorate([m.subclass("esri.rest.support.ProjectParameters")],b)})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m,d){let f=function(q){function k(){var p=q.apply(this,
arguments)||this;p.minTotalNumberOfFeatures=2E3;p.maxTotalNumberOfFeatures=5E4;p.maxTotalNumberOfPrimitives=17E5;p.snapshotAvailable=!0;p.polygonLodFactor=1;p.polylineLodFactor=1;p.skipHighSymbolLods=!1;return p}a._inheritsLoose(k,q);return k}(b);c.__decorate([n.property()],f.prototype,"minTotalNumberOfFeatures",void 0);c.__decorate([n.property()],f.prototype,"maxTotalNumberOfFeatures",void 0);c.__decorate([n.property()],f.prototype,"maxTotalNumberOfPrimitives",void 0);c.__decorate([n.property()],
f.prototype,"snapshotAvailable",void 0);c.__decorate([n.property()],f.prototype,"polygonLodFactor",void 0);c.__decorate([n.property()],f.prototype,"polylineLodFactor",void 0);c.__decorate([n.property()],f.prototype,"skipHighSymbolLods",void 0);f=c.__decorate([d.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],f);let e=function(q){function k(){var p=q.apply(this,arguments)||this;p.lodFactor=1;return p}a._inheritsLoose(k,q);return k}(b);c.__decorate([n.property()],e.prototype,"lodFactor",
void 0);e=c.__decorate([d.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],e);let g=function(q){function k(){var p=q.apply(this,arguments)||this;p.lodCrossfadeinDuration=t.Milliseconds(0);p.lodCrossfadeoutDuration=t.Milliseconds(0);p.lodCrossfadeUncoveredDuration=t.Milliseconds(0);return p}a._inheritsLoose(k,q);return k}(e);g=c.__decorate([d.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],g);let h=function(q){function k(){var p=q.apply(this,arguments)||
this;p.object=new g;p.point=new e;p.integratedMesh=new e;p.pointCloud=new e;p.uncompressedTextureDownsamplingEnabled=!1;return p}a._inheritsLoose(k,q);return k}(b);c.__decorate([n.property({type:g})],h.prototype,"object",void 0);c.__decorate([n.property({type:e})],h.prototype,"point",void 0);c.__decorate([n.property({type:e})],h.prototype,"integratedMesh",void 0);c.__decorate([n.property({type:e})],h.prototype,"pointCloud",void 0);c.__decorate([n.property()],h.prototype,"uncompressedTextureDownsamplingEnabled",
void 0);h=c.__decorate([d.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],h);let l=function(q){function k(){var p=q.apply(this,arguments)||this;p.lodBias=0;p.angledSplitBias=1;p.reduceTileLevelDifferences=!0;p.textureFadeDuration=t.Milliseconds(400);return p}a._inheritsLoose(k,q);return k}(b);c.__decorate([n.property()],l.prototype,"lodBias",void 0);c.__decorate([n.property()],l.prototype,"angledSplitBias",void 0);c.__decorate([n.property()],l.prototype,"reduceTileLevelDifferences",
void 0);c.__decorate([n.property()],l.prototype,"textureFadeDuration",void 0);l=c.__decorate([d.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],l);let v=function(q){function k(){var p=q.apply(this,arguments)||this;p.pixelRatio=1;p.maxTotalNumberOfFeatures=5E4;return p}a._inheritsLoose(k,q);return k}(b);c.__decorate([n.property()],v.prototype,"pixelRatio",void 0);c.__decorate([n.property()],v.prototype,"maxTotalNumberOfFeatures",void 0);v=c.__decorate([d.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],
v);b=function(q){function k(){var p=q.apply(this,arguments)||this;p.graphics3D=new f;p.sceneService=new h;p.tiledSurface=new l;p.heatmap=new v;p.fadeDuration=t.Milliseconds(400);p.antialiasingEnabled=!0;p.physicallyBasedRenderingEnabled=!1;p.highQualityTransparency=!0;p.memoryLimit=void 0;p.additionalCacheMemory=void 0;p.frameRate=void 0;p.maximumPixelRatio=Infinity;return p}a._inheritsLoose(k,q);return k}(b);c.__decorate([n.property({type:f})],b.prototype,"graphics3D",void 0);c.__decorate([n.property({type:h})],
b.prototype,"sceneService",void 0);c.__decorate([n.property({type:l})],b.prototype,"tiledSurface",void 0);c.__decorate([n.property({type:v})],b.prototype,"heatmap",void 0);c.__decorate([n.property()],b.prototype,"fadeDuration",void 0);c.__decorate([n.property()],b.prototype,"antialiasingEnabled",void 0);c.__decorate([n.property()],b.prototype,"physicallyBasedRenderingEnabled",void 0);c.__decorate([n.property()],b.prototype,"highQualityTransparency",void 0);c.__decorate([n.property()],b.prototype,
"memoryLimit",void 0);c.__decorate([n.property()],b.prototype,"additionalCacheMemory",void 0);c.__decorate([n.property()],b.prototype,"frameRate",void 0);c.__decorate([n.property()],b.prototype,"maximumPixelRatio",void 0);return b=c.__decorate([d.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],b)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../core/libs/gl-matrix-2/types/vec3 ../../../geometry/projection ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vector ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode ../../support/spatialReferenceSupport".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){function z(B){if(p.isSpatialReferenceSupported(B,k.ViewingMode.Global))return 1;B=g.renderSRFromViewSR(!1,B);return n.getMetersPerUnitForSR(B)}let C=function(){function B(x,u,y,w){this.viewingMode=x;this.spatialReference=u;this.unitInMeters=y;this._coordinateSystem=w;this._tmpCoordinateSystem=g.create(w)}var A=B.prototype;A.getAltitude=function(x){return g.altitudeAt(this._coordinateSystem,x)};A.setAltitude=function(x,u,y=x){return g.setAltitudeAt(this._coordinateSystem,
y,u,x)};A.setAltitudeOfTransformation=function(x,u){g.setAltitudeOfTransformation(this._coordinateSystem,u,x,u)};A.worldUpAtPosition=function(x,u){return g.normalAt(this._coordinateSystem,x,u)};A.worldBasisAtPosition=function(x,u,y){return g.axisAt(this._coordinateSystem,x,u,y)};A.basisMatrixAtPosition=function(x,u){const y=this.worldBasisAtPosition(x,e.Axis.X,v.sv3d.get()),w=this.worldBasisAtPosition(x,e.Axis.Y,v.sv3d.get());x=this.worldBasisAtPosition(x,e.Axis.Z,v.sv3d.get());r.set(u,y[0],y[1],
y[2],0,w[0],w[1],w[2],0,x[0],x[1],x[2],0,0,0,0,1);return u};A.headingAtPosition=function(x,u){const y=this.worldUpAtPosition(x,v.sv3d.get());x=this.worldBasisAtPosition(x,e.Axis.Y,v.sv3d.get());u=l.angleAroundAxis(u,x,y);return b.rad2deg(u)};A.intersectManifoldClosestSilhouette=function(x,u,y){g.elevate(this._coordinateSystem,u,this._tmpCoordinateSystem);g.intersectRayClosestSilhouette(this._tmpCoordinateSystem,x,y);return y};A.intersectManifold=function(x,u,y){g.elevate(this._coordinateSystem,u,
this._tmpCoordinateSystem);u=v.sv3d.get();return g.intersectRay(this._tmpCoordinateSystem,x,u)?m.copy(y,u):null};A.intersectInfiniteManifold=function(x,u,y){if(this.viewingMode===k.ViewingMode.Global)return this.intersectManifold(x,u,y);g.elevate(this._coordinateSystem,u,this._tmpCoordinateSystem);u=this._tmpCoordinateSystem.value;const w=v.sv3d.get();return h.intersectRay(u.plane,x,w)?m.copy(y,w):null};A.toRenderCoords=function(x,u,y){return q.isDehydratedPoint(x)?f.projectPointToVector(x,u,this.spatialReference):
f.projectVectorToVector(x,u,y,this.spatialReference)};A.fromRenderCoords=function(x,u,y=null){return q.isDehydratedPoint(u)?(t.isSome(y)&&(u.spatialReference=y),f.projectVectorToDehydratedPoint(x,this.spatialReference,u)):d.isVec3(u)?f.projectVectorToVector(x,this.spatialReference,u,y)?u:null:f.projectVectorToPoint(x,this.spatialReference,u)};B.create=function(x,u){switch(x){case k.ViewingMode.Local:return new B(k.ViewingMode.Local,u,n.getMetersPerUnitForSR(u),g.createLocal());case k.ViewingMode.Global:return new B(k.ViewingMode.Global,
u,1,g.createGlobal(u))}};B.renderUnitScaleFactor=function(x,u){return z(x)/z(u)};c._createClass(B,[{key:"extent",set:function(x){x&&g.setExtent(this._coordinateSystem,x,this._coordinateSystem)}}]);return B}();a.RenderCoordsHelper=C;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/gl-matrix-2/types/vec3":function(){define(["exports","../../../typedArrayUtil"],function(a,c){function b(n){return c.isFloat32Array(n)&&3<=n.length}function t(n){return(c.isFloat64Array(n)||
Array.isArray(n))&&3<=n.length}a.isVec3=function(n){return b(n)||t(n)};a.isVec3f32=b;a.isVec3f64=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){t=function(z){function C(){var B=z.apply(this,arguments)||this;B.updating=!1;return B}c._inheritsLoose(C,z);return C}(t);b.__decorate([f.property({readOnly:!0})],t.prototype,"updating",void 0);t=b.__decorate([h.subclass("esri.views.3d.support.ResourceControllerMain")],t);let p=function(z){function C(){var A=z.apply(this,arguments)||this;A._immediateTask=k.ImmediateTask;A._normalTask=k.ImmediateTask;A._frameTask=null;return A}c._inheritsLoose(C,z);var B=C.prototype;
B.initialize=function(){this._scheduler=k.newScheduler();this._memoryController=v.newMemoryController(this.view);this._streamDataLoader=new q.StreamDataLoader;this._streamDataLoader.setup(l.maxDownloadSlots,l.downloadSlotsPerClient,this._scheduler);this.addHandles([r.watch(()=>this.view.state?.mode,A=>{null!=A&&(this._scheduler.state=A)},r.sync),r.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=m.addFrameTask({update:A=>this._frame(A)});this._immediateTask=this._scheduler.registerTask(k.TaskPriority.RESOURCE_CONTROLLER_IMMEDIATE);
this._normalTask=this._scheduler.registerTask(k.TaskPriority.RESOURCE_CONTROLLER)};B.destroy=function(){this._immediateTask.remove();this._normalTask.remove();this._frameTask=n.removeMaybe(this._frameTask);this._streamDataLoader=n.destroyMaybe(this._streamDataLoader);this._memoryController=n.destroyMaybe(this._memoryController);this._scheduler=n.destroyMaybe(this._scheduler)};B.createStreamDataRequester=function(A){const x=this._streamDataLoader;return{request(u,y,w){return x.request(u,y,A,w)},get busy(){return!x.hasDownloadSlots(A)}}};
B._frame=function(A){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(d.secondsFromMilliseconds(A.deltaTime)),!this._scheduler))return;this._scheduler.updateBudget(A)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};B._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};c._createClass(C,[{key:"immediate",get:function(){return this._immediateTask}},{key:"normal",get:function(){return this._normalTask}},
{key:"updating",get:function(){return!!(this._memoryController?.updating||this._streamDataLoader?.updating||this._immediateTask?.updating)}},{key:"scheduler",get:function(){return this._scheduler}},{key:"memoryController",get:function(){return this._memoryController}},{key:"test",get:function(){return{getQueueStats:A=>this._streamDataLoader.test.loadQueue.getStatsForType(A)}}}]);return C}(t);b.__decorate([f.property({constructOnly:!0})],p.prototype,"view",void 0);b.__decorate([f.property()],p.prototype,
"_scheduler",void 0);b.__decorate([f.property()],p.prototype,"_memoryController",void 0);b.__decorate([f.property()],p.prototype,"_streamDataLoader",void 0);b.__decorate([f.property()],p.prototype,"_immediateTask",void 0);b.__decorate([f.property()],p.prototype,"_normalTask",void 0);b.__decorate([f.property({readOnly:!0})],p.prototype,"updating",null);p=b.__decorate([h.subclass("esri.views.3d.support.ResourceControllerImpl")],p);a.newResourceController=function(z){return new p({view:z})};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/index":function(){define(["exports"],function(a){a.ClientType=void 0;(function(b){b[b.ELEVATION=0]="ELEVATION";b[b.BASEMAP=1]="BASEMAP";b[b.I3S_INDEX=2]="I3S_INDEX";b[b.I3S_DATA=3]="I3S_DATA";b[b.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const c=(()=>{const b=[];b[a.ClientType.ELEVATION]=10;b[a.ClientType.BASEMAP]=10;b[a.ClientType.I3S_INDEX]=10;b[a.ClientType.I3S_DATA]=10;b[a.ClientType.SYMBOLOGY]=5;return b})();a.downloadSlotsPerClient=
c;a.maxDownloadSlots=30;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/MemCache ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../layers/support/MemoryManagedLayerView".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){let l=function(v){function q(p){p=v.call(this,p)||this;p._quality=1;p._memoryUsed=0;p._updating=!1;p.minQuality=.1;p._stableQuality=0;p._downscaleMemoryUsed=0;p._canFastRecover=!1;p._memoryPredicted=0;p._cacheStorage=new m.MemCacheStorage;p._warnMemoryUsage=null;p._numQualityChanges=0;p._maxMemory=500;p._additionalCacheMemory=100;return p}c._inheritsLoose(q,v);var k=q.prototype;k.destroy=function(){this._cacheStorage.destroy()};k.newCache=function(p,z){return new m.MemCache(p,
this._cacheStorage,z)};k.resetStableQuality=function(){this._stableQuality=0};k.disableMemCache=function(){this.additionalCacheMemory=-4096};k.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var p=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(p){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=
0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,p=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=
this._quality,p=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this._updating=p}};k._updateQuality=function(p){p=Math.min(Math.max(p,this.minQuality),1);if(p===this._quality)return!1;this._quality=p;++this._numQualityChanges;return!0};k._layersUpdating=function(){return this.view.allLayerViews.some(p=>!!p.updating)};k._updateMemory=function(){let p=0,z=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(p+=this.view.basemapTerrain.getUsedMemory());
var C=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderer.edgeView;r.isSome(C)&&(p+=C.usedMemory);this.view.allLayerViews&&this.view.allLayerViews.forEach(A=>{if(h.isMemoryManagedLayerView(A)){const x=A.ignoresMemoryFactor()?this._quality:1;p+=A.getUsedMemory()*x;z+=A.getUnloadedMemory()*x}});var B=r.isNone(this._warnMemoryUsage)||Math.round(10*p)!==Math.round(10*this._warnMemoryUsage);C=1048576*this.maxMemory;if(p>C&&B){this._warnMemoryUsage=p;B=x=>(x/1048576).toLocaleString(void 0,
{maximumFractionDigits:1})+" MB";const A=Math.round(100*this._quality);n.getLogger(this.declaredClass).warn(`Memory Limit exceeded! Limit: ${B(C)} Current: ${B(p)} Projected: ${B(p+z)} Quality: ${A}%`)}this._memoryUsed=p/C;this._memoryPredicted=(p+z)/C;this._cacheStorage.maxSize=Math.max(0,C-p+1048576*this.additionalCacheMemory)};c._createClass(q,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(p){null==p||0>=p||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<p&&
this._updateQuality(1),this._maxMemory=p)}},{key:"additionalCacheMemory",get:function(){return this._additionalCacheMemory},set:function(p){null!=p&&0<=p&&(this._additionalCacheMemory=p)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._memoryUsed}},{key:"test",get:function(){const p=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const z=p._numQualityChanges;p._numQualityChanges=
0;return z}}}}]);return q}(t);b.__decorate([d.property({constructOnly:!0})],l.prototype,"view",void 0);b.__decorate([d.property()],l.prototype,"maxMemory",null);b.__decorate([d.property()],l.prototype,"additionalCacheMemory",null);b.__decorate([d.property()],l.prototype,"memoryFactor",null);b.__decorate([d.property()],l.prototype,"updating",null);b.__decorate([d.property()],l.prototype,"usedMemory",null);b.__decorate([d.property()],l.prototype,"_quality",void 0);b.__decorate([d.property()],l.prototype,
"_memoryUsed",void 0);b.__decorate([d.property()],l.prototype,"_updating",void 0);b.__decorate([d.property()],l.prototype,"_stableQuality",void 0);b.__decorate([d.property()],l.prototype,"_maxMemory",void 0);b.__decorate([d.property()],l.prototype,"_additionalCacheMemory",void 0);l=b.__decorate([g.subclass("esri.views.3d.support.MemoryController")],l);a.newMemoryController=function(v){return new l({view:v})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports"],
function(a){a.isMemoryManagedLayerView=function(c){return"function"===typeof c.getUsedMemory};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){function p(A){if(2>A.byteLength)return"unknown";A=new Uint8Array(A,0,A.byteLength);return 137===A[0]&&80===A[1]?"image/png":71===A[0]&&73===A[1]?"image/gif":66===A[0]&&77===A[1]?"image/bmp":255===A[0]&&216===A[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(A){function x(){var y=A.apply(this,arguments)||this;y._tasks=new Map;y._onLoadQueue=[];y._doneQueue=[];y.updating=!1;return y}c._inheritsLoose(x,A);var u=x.prototype;u.setup=function(y,w,D){this._loadQueue=
new v.AsyncWorkerQueue((F,E)=>this._startLoading(F,E),(F,E)=>this._doneLoadingCB(F,E),y,w);D&&(this._frameTask=D.registerTask(k.TaskPriority.STREAM_DATA_LOADER,this))};u.destroy=function(){this._frameTask=f.removeMaybe(this._frameTask);this._tasks.forEach(y=>f.abortMaybe(y.abortController));this._loadQueue=f.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null};u.hasDownloadSlots=function(y){return this._loadQueue.hasQuota(y)};u.request=function(y,w,D,F={}){const E=e.createResolver();
E.__signal=f.isSome(F)?F.signal:null;const K=this._createOrUpdateTask(y,w,D,F,E);e.onAbort(F,()=>this._cancelRequest(K,E));return E.promise};u._createTask=function(y,w,D,F,E,K){y=new B(y,w,D,F,E);this._updateTask(y,K);this._tasks.set(E,y);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(y);return y};u._cancelRequest=function(y,w){r.removeUnordered(y.resolvers,w);w.reject(e.createAbortError());0===y.resolvers.length&&(y.status===a.TaskStatus.DOWNLOADING&&(y.status=a.TaskStatus.CANCELLED,
this._loadQueue.cancel(y),y.abortController?.abort(),y.request=null,y.abortController=null),y.status=a.TaskStatus.CANCELLED,this._tasks.delete(y.key),0===this._tasks.size&&this._set("updating",!1))};u._updateTask=function(y,w){y.resolvers.push(w)};u._createOrUpdateTask=function(y,w,D,F,E){const K=`${f.isSome(F)&&F.uid||y}:${w}:${D}`,J=this._tasks.get(K);return J?(this._updateTask(J,E),J):this._createTask(y,F,w,D,K,E)};u._doneLoadingCB=function(y,w){this._loadQueue&&(q.assert(y.status===a.TaskStatus.DOWNLOADING),
y.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:y,err:w}):this._doneLoading(y,w))};u.runTask=function(y){for(;!y.done&&0<this._onLoadQueue.length;){var w=this._onLoadQueue.shift();e.throwIfAborted(w.task.abortController);w.task.abortController=null;w.callback(w.task);y.madeProgress()}for(;!y.done&&0<this._doneQueue.length;)w=this._doneQueue.shift(),w.task.status!==a.TaskStatus.DOWNLOADED&&(w.err=w.err||e.createAbortError()),this._doneLoading(w.task,w.err),y.madeProgress()};
u._doneLoading=function(y,w){if(w&&!e.isAbortError(w)&&0<y.numRetries)--y.numRetries,this._loadQueue.push(y);else{var D=y.result instanceof HTMLImageElement?0:y.resolvers.length;for(const F of y.resolvers)if(w)e.isAbortError(w)?F.reject(w):F.reject(new m("stream-data-loader:request-error",`Failed to request resource at '${y.url}'. ${w}`,{url:y.url,error:w}));else{--D;const E=0>=D?y.result:d.clone(y.result);F.resolve(E)}this._tasks.delete(y.key);0===this._tasks.size&&this._set("updating",!1)}};u._startLoading=
function(y,w){if(y.status===a.TaskStatus.CANCELLED)return!1;y.startTime=performance.now();y.status=a.TaskStatus.DOWNLOADING;let D,F;switch(y.docType){case "binary":F="array-buffer";D=0;break;case "image":F="image";break;case "image+type":F="array-buffer";break;default:F="json"}y.abortController=new AbortController;const E=y.abortController.signal;y.request=t(y.url,{...y.options,responseType:F,timeout:D,signal:E});let K=()=>{};const J=N=>{y.duration=performance.now()-y.startTime;y.size=N instanceof
ArrayBuffer?N.byteLength:y.size||0;y.result=N;this._frameTask?this._onLoadQueue.push({callback:w,task:y}):(y.abortController=null,w(y))},M=N=>{y.status===a.TaskStatus.DOWNLOADING&&w(y,N);K()};if("image+type"!==y.docType)return y.request.then(N=>J(N.data),M),!0;y.request.then(N=>{N=N.data;const P=p(N);F="image";y.size=N.byteLength;if("unknown"===P)y.request=t(y.url,{responseType:F,timeout:D,signal:E}),y.request.then(G=>J(G.data),M);else{N=new Blob([N],{type:P});var I=window.URL.createObjectURL(N);
K=()=>window.URL.revokeObjectURL(I);y.request=t(I,{responseType:F,timeout:D,signal:E});y.request.then(G=>J(new C(G.data,P,K)),M)}},M);return!0};c._createClass(x,[{key:"running",get:function(){return 0<this._doneQueue.length||0<this._onLoadQueue.length}},{key:"test",get:function(){return{loadQueue:this._loadQueue}}}]);return x}(n);b.__decorate([g.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=b.__decorate([l.subclass("esri.views.3d.support.StreamDataLoader")],
a.StreamDataLoader);const z={numRetries:0};let C=function(){function A(x,u,y){this.image=x;this.type=u;this.release=y}c._createClass(A,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return A}(),B=function(A){function x(u,y,w,D,F){D=A.call(this,D)||this;D.url=u;D.options=y;D.docType=w;D.key=F;D.result=null;D.status=a.TaskStatus.QUEUED;D.request=null;D.abortController=null;D.resolvers=[];D.startTime=0;D.numRetries=z.numRetries;return D}c._inheritsLoose(x,A);return x}(v.BaseTask);
a.TaskStatus=void 0;(function(A){A[A.QUEUED=1]="QUEUED";A[A.DOWNLOADING=2]="DOWNLOADING";A[A.DOWNLOADED=3]="DOWNLOADED";A[A.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=C;a.test=z;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,c,b){let t=function(m){this.typeWorkerQuota=m;this.tasks=[];this.numWorkers=
0;this.statistics=new n},n=function(){this.speed=this.duration=this.size=this.requests=0},r=function(){function m(f,e,g,h){this._workerFunc=f;this._callbackFunc=e;this._maxTotalNumWorkers=g;this._totalNumWorkers=0;this._clients=h.map(l=>new t(l))}var d=m.prototype;d.destroy=function(){this._clients.length=0};d.hasQuota=function(f){return(f=this._clients[f])?this._totalNumWorkers<this._maxTotalNumWorkers||f.numWorkers+f.tasks.length<f.typeWorkerQuota:!1};d.push=function(f){const e=this._clients[f.client];
e&&(this._totalNumWorkers<this._maxTotalNumWorkers?(e.numWorkers++,this._totalNumWorkers++,this._workerFunc(f,(g,h)=>this._taskCallback(g,h))):e.tasks.push(f))};d.cancel=function(f){this._taskFinished(f);f._cancelled=!0};d._taskFinished=function(f){const e=this._clients[f.client];this._totalNumWorkers--;e.numWorkers--;e.statistics.requests++;e.statistics.size+=f.size||0;e.statistics.duration+=f.duration||0;e.statistics.speed=0<e.statistics.duration?e.statistics.size/e.statistics.duration:0;b.assert(0<=
e.numWorkers);this._next()};d._next=function(){for(const f of this._clients)if(f&&f.numWorkers<f.typeWorkerQuota&&this._processQueue(f))return;for(const f of this._clients)if(f&&this._processQueue(f))break};d._processQueue=function(f){for(;0<f.tasks.length;)if(this._workerFunc(f.tasks.shift(),(e,g)=>this._taskCallback(e,g)))return f.numWorkers++,this._totalNumWorkers++,!0;return!1};d._taskCallback=function(f,e){f._cancelled||(this._callbackFunc(f,e),this._taskFinished(f))};d.getStatsForType=function(f){return(f=
this._clients[f])?{quota:f.typeWorkerQuota,workers:f.numWorkers,queueSize:f.tasks.length,requestStats:f.statistics}:null};c._createClass(m,[{key:"test",get:function(){const f=this;return{set workerFunc(e){f._workerFunc=e}}}}]);return m}();a.AsyncWorkerQueue=r;a.BaseTask=function(m){this.client=m;this._cancelled=!1;this.duration=this.size=0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/byteSizeEstimations",
"../../../core/maybe","../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(a,c,b,t,n){return function(r){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];if(c.isSome(r.resourceController)){var m=r.resourceController.memoryController;this.totalMemory=(m.maxMemory??0)*a.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(m.usedMemory*this.totalMemory);this.quality=m.memoryFactor;
this.load=r.resourceController.scheduler.load}this.terrainMemory=r.basemapTerrain?.getUsedMemory()??0;m=r._stage&&r._stage.renderView&&r._stage.renderer.edgeView;this.edgesMemory=c.isSome(m)?m.usedMemory:0;r.allLayerViews.items.forEach(d=>{(b.isMemoryManagedLayerView(d)||n.isSurfaceLayerView(d))&&this.layerPerformanceInfos.push(new t(d,r))});this.layerPerformanceInfos.sort((d,f)=>f.memory-d.memory)}})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView",
"../terrain/terrainUtils"],function(a,c){return function(b,t){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=b.layer;this.memory=c.isSurfaceLayerView(b)?t.basemapTerrain.getUsedMemoryForLayerView(b):b.getUsedMemory();a.isPerformanceInfoLayerView(b)&&(b=b.performanceInfo,this.displayedNumberOfFeatures=b.displayedNumberOfFeatures,this.maximumNumberOfFeatures=b.maximumNumberOfFeatures,this.totalNumberOfFeatures=b.totalNumberOfFeatures)}})},
"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],function(a){a.isPerformanceInfoLayerView=function(c){return"performanceInfo"in c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../core/maybe ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ./interfaces ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(u){return"imagery-tile"===u?.type||"wcs"===u?.type}function h(u){return"imagery-tile-3d"===u?.type}function l(u){return"tile-3d"===u?.type}function v(u){return"vector-tile-3d"===u?.type}function q(u){return"wmts-3d"===u?.type}function k(u){return"elevation-3d"===u?.type}function p(u){return u&&(l(u)||h(u)||v(u)||q(u))}function z(u,y,w,D){return A[D].checkIfTileInfoSupportedForViewSR(u,w,y)}function C(u,y,w){u=n.getTileMaxtrixSetFromActiveLayer(u);if(b.isSome(u))if(c.isCollection(u)){if(u=
u.find(D=>null==z(D.tileInfo,D.fullExtent,y,w)))return{tileInfo:u.tileInfo,fullExtent:u.fullExtent}}else return{tileInfo:u.tileInfo,fullExtent:u.fullExtent};return{tileInfo:null,fullExtent:null}}function B(u){return u.isWGS84||u.isWebMercator||t.isCGCS2000(u)||!t.isEarth(u)}const A={[r.ViewingMode.Global]:e.terrainUtilsSpherical,[r.ViewingMode.Local]:f.terrainUtilsPlanar};a.ENABLE_TERRAIN_INTERNAL_CHECKS=!1;a.ENABLE_WATERPROOFNESS_TESTS=!1;const x={force512VTL:!1};f=[d.NeighborIndex.NORTH,d.NeighborIndex.EAST,
d.NeighborIndex.SOUTH,d.NeighborIndex.WEST];e=[d.NeighborIndex.NORTH_EAST,d.NeighborIndex.SOUTH_EAST,d.NeighborIndex.SOUTH_WEST,d.NeighborIndex.NORTH_WEST];a.almostEquals=function(u,y,w=1E-5){return Math.abs(u-y)<w};a.checkIfTileInfoSupportedForView=z;a.enableTerrainInternalChecks=function(u){a.ENABLE_TERRAIN_INTERNAL_CHECKS=u};a.enableTerrainWaterproofnessChecks=function(u){a.ENABLE_WATERPROOFNESS_TESTS=u;a.ENABLE_TERRAIN_INTERNAL_CHECKS=a.ENABLE_TERRAIN_INTERNAL_CHECKS||u};a.eps=1E-5;a.getLayerWithExtentRange=
function(u){return h(u)?{fullExtent:u.fullExtent,minScale:u.layer.minScale,maxScale:u.layer.maxScale,tilemapCache:null}:u.layer};a.getTileInfoAndExtentFromWMTSLayer=C;a.getTiledLayerInfo=function(u,y,w){var D=null;let F=null;if("wmts"===u?.type)u=C(u,y,w),D=u.tileInfo,F=u.fullExtent;else if(F=g(u)?u.getCompatibleFullExtent(y):u.fullExtent,D=w===r.ViewingMode.Local,g(u))D=u.getCompatibleTileInfo(y,F,D);else if("vector-tile"===u?.type){D=D&&!B(y)||x.force512VTL;const E=u.tileInfo.spatialReference.isGeographic;
D=D?u.tileInfo:u.tileInfo.getOrCreateCompatible(256,E?1:2)}else D=u.tileInfo;return b.isSome(D)&&b.isSome(F)&&null==z(D,F,y,w)?{tileInfo:D,fullExtent:F}:null};a.internalAssert=function(u,y){if(a.ENABLE_TERRAIN_INTERNAL_CHECKS&&!u)throw u=Error().stack?.slice(5),console.warn("Terrain internal: "+(y?y:"")+" at "+u),Error("Assertion failed"+(y?": "+y:""));};a.isBlendableLayerView=function(u){return u&&(l(u)||q(u)||h(u)||v(u))};a.isEast=function(u){return u===d.NeighborIndex.NORTH_EAST||u===d.NeighborIndex.EAST||
u===d.NeighborIndex.SOUTH_EAST};a.isElevationLayerView=k;a.isGroupLayerView=function(u){return"group"===u?.type};a.isImageryTileLayerView=h;a.isImageryTileRenderInfo=function(u){u=u?.sourceLayerInfo?.data;return b.isSome(u)&&"type"in u&&"raster-tile"===u.type};a.isMapTileLayerView=p;a.isNorth=function(u){return u===d.NeighborIndex.NORTH_EAST||u===d.NeighborIndex.NORTH||u===d.NeighborIndex.NORTH_WEST};a.isNorthCorner=function(u){return u===d.NeighborIndex.NORTH_WEST||u===d.NeighborIndex.NORTH_EAST};
a.isProjectableRasterLayer=g;a.isRasterTileRenderInfo=function(u){u=u?.sourceLayerInfo?.data;return u instanceof HTMLImageElement||u instanceof m.ImageWithType||u instanceof HTMLCanvasElement||u instanceof ImageData};a.isSouth=function(u){return u===d.NeighborIndex.SOUTH_EAST||u===d.NeighborIndex.SOUTH||u===d.NeighborIndex.SOUTH_WEST};a.isSurfaceLayerView=function(u){return p(u)||k(u)};a.isTextureTileRenderInfo=function(u){u=u?.sourceLayerInfo?.data;return b.isSome(u)&&"type"in u&&"tile-texture"===
u.type};a.isTileLayerView=l;a.isVectorTileLayerView=v;a.isVectorTileRenderInfo=function(u){u=u?.sourceLayerInfo?.data;return b.isSome(u)&&"type"in u&&"vector-tile"===u.type};a.isWMTSLayerView=q;a.isWest=function(u){return u===d.NeighborIndex.NORTH_WEST||u===d.NeighborIndex.WEST||u===d.NeighborIndex.SOUTH_WEST};a.isWestCorner=function(u){return u===d.NeighborIndex.NORTH_WEST||u===d.NeighborIndex.SOUTH_WEST};a.lij2s=function(u){return"["+u[0]+","+u[1]+","+u[2]+"]"};a.neighborCornerIndices=e;a.neighborEdgeIndices=
f;a.oppositeCorner=function(u){return u===d.NeighborIndex.NORTH_EAST?d.NeighborIndex.SOUTH_WEST:u===d.NeighborIndex.NORTH_WEST?d.NeighborIndex.SOUTH_EAST:u===d.NeighborIndex.SOUTH_WEST?d.NeighborIndex.NORTH_EAST:d.NeighborIndex.NORTH_WEST};a.oppositeEdge=function(u){return u===d.NeighborIndex.NORTH?d.NeighborIndex.SOUTH:u===d.NeighborIndex.EAST?d.NeighborIndex.WEST:u===d.NeighborIndex.SOUTH?d.NeighborIndex.NORTH:d.NeighborIndex.EAST};a.releaseTileData=function(u){b.isSome(u)&&"release"in u&&u.release();
return null};a.test=x;a.useFetchTileForLayer=function(u){return u.fetchTile&&!1!==u.hasOverriddenFetchTile};a.v32s=function(u){return"("+u[0]+","+u[1]+","+u[2]+")"};a.vtlAssumes256PixelSizeAsDefault=B;a.weakAssert=function(u,y){u||console.warn("Terrain: "+y)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ../core/maybe ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,c,b,t,n,r,m,d,f){function e(z,C,B=0){z=z.extent;return b.isNone(z)?!1:0===B?m.containsPoint(z,C):m.containsPointWithMargin(z,C,B*Math.min(z[2]-z[0],z[3]-z[1]))}function g(z,C,B,A){t.copy(v,B);v[A]=C[A];A=t.subtract(v,v,C);var x=t.subtract(q,z,C);x=t.dot(x,A);const u=t.dot(A,A);C=0>=x?C:u<=x?B:t.add(v,C,t.scale(A,A,x/u));z=t.subtract(v,z,C);return Math.PI/2-Math.atan(z[2]/Math.sqrt(z[0]*z[0]+z[1]*z[1]))}function h(z,C,B){z=z.extent;if(b.isNone(z))return 0;k[0]=z[0];k[1]=z[1];k[2]=B;p[0]=
z[2];p[1]=z[3];p[2]=B;z=B=Infinity;C[0]<k[0]?B=g(C,k,p,0):C[0]>p[0]&&(B=g(C,p,k,0));C[1]<k[1]?z=g(C,k,p,1):C[1]>p[1]&&(z=g(C,p,k,1));return Math.min(B,z)}function l(z,C,B){if(b.isNone(z))return f.getMissingTileInfoError();if(z.spatialReference.isGeographic&&!r.canProjectToWGS84ComparableLonLat(z.spatialReference))return new c("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var A=f.TilingScheme.checkUnsupported(z);if(b.isSome(A))return A;
if(b.isNone(B))return new c("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");{var x=z.lods;A=x[0].resolution*2**x[0].level;var u=[A*z.size[0],A*z.size[1]];const y=[z.origin.x,z.origin.y];B=m.fromExtent(B);const w=m.create();f.TilingScheme.computeRowColExtent(B,u,y,w);u=(w[2]-w[0])*(w[3]-w[1]);u>d.MAX_ROOT_TILES?(x=x[0].scale*2**x[0].level,A=Math.max((B[3]-B[1])/z.size[1],(B[2]-B[0])/z.size[0])*x/A,B=Math.floor(Math.log(A)/Math.log(10)),A=Math.ceil(A/10**B)*10**B,A=new c("tilingscheme:too-many-root-tiles",
"Scale of level 0 of the tiling scheme (1:"+Math.floor(x).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+A.toLocaleString()+".",{level0Scale:x,suggestedLevel0Scale:A,requiredNumRootTiles:u,allowedNumRootTiles:d.MAX_ROOT_TILES})):A=null}if(A)return A;z=z.spatialReference;return!b.isSome(C)||z.equals(C)||C.isWGS84&&z.isWebMercator?null:new c("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const v=n.create(),
q=n.create(),k=n.create(),p=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:l,isInsideExtent:e,tiltToExtentEdge:h},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=l;a.isInsideExtent=e;a.terrainUtilsPlanar=n;a.tiltToExtentEdge=h})},"esri/chunks/terrainUtilsSpherical":function(){define("exports ../core/Error ../core/maybe ../geometry/projection ../geometry/support/spatialReferenceUtils ../views/3d/terrain/TilingScheme".split(" "),
function(a,c,b,t,n,r){function m(){return!0}function d(){return 0}function f(g,h){if(b.isNone(g))return r.getMissingTileInfoError();const l=g.lods.length-1,v=g.spatialReference,q=t.canProjectToWGS84ComparableLonLat(v)||n.isMars(v)||n.isMoon(v);if(v.isWebMercator){if(!r.TilingScheme.makeWebMercatorAuxiliarySphere(l).compatibleWith(g))return new c("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(q){if(!r.TilingScheme.makeGCSWithTileSize(g.spatialReference,
g.size[0],l).compatibleWith(g))return g.spatialReference.isWGS84?new c("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new c("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new c("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(b.isSome(h)&&!g.spatialReference.equals(h))return new c("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}const e=Object.freeze(Object.defineProperty({__proto__:null,checkIfTileInfoSupportedForViewSR:f,isInsideExtent:m,tiltToExtentEdge:d},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=f;a.isInsideExtent=m;a.terrainUtilsSpherical=e;a.tiltToExtentEdge=d})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/maybe ../../../core/reactiveUtils ../../../geometry/ellipsoidUtils ../layers/graphics/ObjectResourceCache ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){let v=function(){function k(z){this.streamDataRequester=this.textures=null;this._graphicsOwners=[];this.cimSymbolRasterizer=this._screenSizePerspectiveHandles=null;this._viewState=z.viewState;this._view=z.view;this._pointsOfInterest=z.pointsOfInterest;this.streamDataRequester=z.resourceController.createStreamDataRequester(e.ClientType.SYMBOLOGY);this.objectResourceCache=new f.ObjectResourceCache((B,A)=>z.resourceController.memoryController.newCache(B,A));this.textures=
new g.StreamTextureCollection(this.streamDataRequester,z.view._stage,{preMultiplyAlpha:!0,wrap:{s:l.TextureWrapMode.CLAMP_TO_EDGE,t:l.TextureWrapMode.CLAMP_TO_EDGE}},z.resourceController.scheduler);const C=d.getReferenceEllipsoid(this._view.spatialReference).radius;this.screenSizePerspectiveSettings=h.getSettings(z.viewingMode,C);this.screenSizePerspectiveSettingsLabels=h.getLabelSettings(z.viewingMode,C)}var p=k.prototype;p.destroy=function(){r.destroyMaybe(this.textures);this.streamDataRequester=
this.textures=null};p.addGraphicsOwner=function(z){if(!z)return n.makeHandle();this._graphicsOwners.push(z);const C=m.watch(()=>z.layer?.screenSizePerspectiveEnabled,()=>this._updateScreenSizePerspectiveEnabled());this._updateScreenSizePerspectiveEnabled();return n.makeHandle(()=>{C.remove();b.removeUnordered(this._graphicsOwners,z);this._updateScreenSizePerspectiveEnabled()})};p._updateScreenSizePerspectiveEnabled=function(){var z=this._graphicsOwners.some(C=>!0===C.layer?.screenSizePerspectiveEnabled);
z&&!this._screenSizePerspectiveHandles?(this._screenSizePerspectiveHandles=new t,z=()=>this._updateScreenSizePerspectiveSettings(),this._screenSizePerspectiveHandles.add([m.watch(()=>this._pointsOfInterest.centerOnSurfaceInfrequent.distance,z,m.sync),this._viewState.events.on("camera-projection-changed",z)]),this._updateScreenSizePerspectiveSettings()):z||(this._screenSizePerspectiveHandles=r.destroyMaybe(this._screenSizePerspectiveHandles))};p._updateScreenSizePerspectiveSettings=function(){q.distance=
this._pointsOfInterest.centerOnSurfaceInfrequent.distance;q.fovY=this._viewState.camera.fovY;this.screenSizePerspectiveSettings.update(q);this.screenSizePerspectiveSettingsLabels.update(q);this._view._stage.renderView.requestRender()};c._createClass(k,[{key:"test",get:function(){return{screenSizePerspectiveHandles:this._screenSizePerspectiveHandles}}}]);return k}();const q={distance:0,fovY:0};a.SharedSymbolResources=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),
function(a,c,b,t,n,r,m){let d=function(){function f(g){this._gltfLoading=new Map;this._wosrLoading=new Map;this._gltfMemCache=g("gltf-resources",()=>{});this._wosrMemCache=g("wosr-resources",()=>{})}var e=f.prototype;e.destroy=function(){this._gltfLoading.forEach(g=>g.abortController.abort());this._wosrLoading.forEach(g=>g.abortController.abort());this._gltfMemCache.destroy();this._wosrMemCache.destroy()};e.loadGLTF=function(g,h,l){const v=l?`gltfPBR:${g}`:`gltf:${g}`,q=this._gltfMemCache.get(v);
return b.isSome(q)?Promise.resolve(q):this._loadOnce(this._gltfLoading,this._gltfMemCache,v,k=>r.loadGLTF(new n.DefaultLoadingContext(k.streamDataRequester),g,k,l),h)};e.loadWOSR=function(g,h){const l=`wosr:${g}:${h.disableTextures}`,v=this._wosrMemCache.get(l);return b.isSome(v)?Promise.resolve(v):this._loadOnce(this._wosrLoading,this._wosrMemCache,l,q=>m.load(g,q),h)};e._loadOnce=function(){var g=c._asyncToGenerator(function*(h,l,v,q,k){t.throwIfAborted(k);const p=t.onAbort(k,()=>this._abortLoad(h,
v));var z=h.get(v);z?z.refCount++:(z=new AbortController,q=q({...k,signal:z.signal}),z={refCount:1,abortController:z,promise:q},h.set(v,z));try{const C=yield z.promise;l.put(v,C,C.size);h.delete(v);t.throwIfAborted(k);return C}finally{b.removeMaybe(p)}});return function(h,l,v,q,k){return g.apply(this,arguments)}}();e._abortLoad=function(g,h){const l=g.get(h);b.isSome(l)&&0<--l.refCount||(g.delete(h),b.isSome(l)&&l.abortController.abort())};return f}();a.ObjectResourceCache=d;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Texture".split(" "),function(a,c,b,t,n,r,m,d){r=function(f){function e(h,l,v,q){l=f.call(this,l,q)||this;l._streamDataRequester=h;l._parameters=v;return l}c._inheritsLoose(e,f);var g=e.prototype;g.fromUrl=
function(){var h=c._asyncToGenerator(function*(l,v,q){var k=this;t.throwIfAborted(q);q=b.isSome(q)?q.signal:null;const p=this.makeUid(l,v);var z=this._textureRequests.get(p);if(!z){z=new AbortController;const C=this._streamDataRequester.request(l,"image",{uid:p,signal:z.signal}),B=z={referenceCount:0,texture:null,textureAsync:null,abortController:z};this._textureRequests.set(p,z);z.textureAsync=C.then(function(){var A=c._asyncToGenerator(function*(x){x=k._createTexture(l,x,v);B.texture=x;B.abortController=
null;k._stage.add(x);yield k._stage.load(x);return{uid:p,texture:x,release:()=>k._release(p)}});return function(x){return A.apply(this,arguments)}}(),A=>{B.abortController=null;throw A;})}z.referenceCount++;try{return yield t.whenOrAbort(z.textureAsync,q)}catch(C){throw this._release(p),C;}});return function(l,v,q){return h.apply(this,arguments)}}();g._createTexture=function(h,l,v){const q={...this._parameters,powerOfTwoResizeMode:m.PowerOfTwoResizeMode.PAD};if(n.isSVG(h)){if(v||0===l.width&&0===
l.height)h=l.width?l.height/l.width:1,v=v||64,1<h?(l.width=Math.round(v/h),l.height=v):(l.width=v,l.height=Math.round(v*h));this._stage.renderView?.renderingContext.driverTest.svgPremultipliesAlpha.result&&(q.preMultiplyAlpha=!1)}q.width=l.width;q.height=l.height;return new d.Texture(l,q)};return e}(r.TextureCollection);a.StreamTextureCollection=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E){a.PointsOfInterest=function(P){function I(H){H=P.call(this,H)||this;H._handles=new n;H._tmpRay=v.create();H._centerRayDirty=!0;H._surfaceAltitudeAtCenter=0;H._surfaceAltitudeAtCenterDirty=!0;H._contentAltitudeAtCenter=0;H._contentAltitudeAtCenterDirty=!0;H._propertiesPool=new p.PropertiesPool({renderPointOfView:K},c._assertThisInitialized(H));H.renderPointOfView=l.create();H._pois=[];H._debugCenters=new Map;return H}c._inheritsLoose(I,
P);var G=I.prototype;G.initialize=function(){const {state:H,basemapTerrain:L,renderCoordsHelper:O,map:S}=this.view;this._surfaceIntersector=w.newIntersector(H.viewingMode);this._surfaceIntersector.options.backfacesTerrain=H.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=D.StoreResults.MIN;this._contentIntersector=w.newIntersector(H.viewingMode);var R=()=>this._estimateSurfaceAltitudeAtCenter();const Q=this.view.resourceController.scheduler,
V=r.unwrap(this.view.basemapTerrain?.elevationQueryCache),aa={state:H,scheduler:Q,surface:L,renderCoordsHelper:O};this._set("centerOnSurfaceInfrequent",new B.CenterOnSurface({...aa,task:E.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:R}));this._set("centerOnSurfaceFrequent",new B.CenterOnSurface({...aa,task:E.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:R}));this._set("centerOnContent",new B.CenterOnSurface({...aa,task:E.TaskPriority.POINT_OF_INTEREST_FREQUENT,
estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new C.CameraOnSurface({...aa,cache:V,task:E.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:S}));this._set("surfaceGeometryUpdates",new y.SurfaceGeometryUpdates({...aa,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new A.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:O}));
this._set("surfaceOrigin",new u.StableSurfaceCenter({cache:V,view:this.view}));this._set("focus",new x.Focus({state:H,scheduler:Q,surface:L,renderCoordsHelper:O,centerOnSurface:this.centerOnSurfaceInfrequent,estimateSurfaceIntersectionAtRenderPoint:(X,W)=>this._estimateSurfaceIntersectionAtRenderPoint(X,this.view.state.contentCamera,W)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.cameraOnSurface,this.focus);R=this.view.graphics;this._debugCenters.set(this.centerOnContent,
new k.PointGraphics(R,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new k.PointGraphics(R,"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new k.PointGraphics(R,"red","CenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new k.PointGraphics(R,"blue","CameraOnSurface"));this._debugCenters.set(this.focus,new k.PointGraphics(R,"green","Focus"));this._handles.add([m.watch(()=>H.contentCamera,X=>this._cameraChanged(X),m.sync),m.watch(()=>
L.extent,()=>this._updateCenterPointsOfInterest()),m.when(()=>!L.updating,()=>this._updateCenterPointsOfInterest(),m.sync),m.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),m.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),m.when(()=>q.SHOW_POI,X=>this._setDebug(X),m.initial)]);this._cameraChanged(this.view.state.contentCamera);for(const X of this._pois)X.runTask()};G.destroy=function(){this._setDebug(!1);
this._handles.destroy();this._propertiesPool.destroy();for(const H of this._pois)H.destroy();this.surfaceOrigin.destroy()};G._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const H=this._centerRay;if(r.isNone(H))return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(H,this._contentIntersector,J,N)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(J):
this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter};G._estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const H=this._centerRay;if(r.isNone(H))return this._surfaceAltitudeAtCenter;const L=H.origin,O=h.add(J,H.origin,H.direction);this._surfaceIntersector.resetWithRay(H,this.view.state.contentCamera);
this.view.basemapTerrain.intersect(this._surfaceIntersector,null,L,O);this._surfaceIntersector.results.min.getIntersectionPoint(J)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(J));return this._surfaceAltitudeAtCenter};G._estimateSurfaceIntersectionAtRenderPoint=function(H,L,O){H=z.fromRenderAtEye(L,H,M);if(r.isNone(H))return null;const S=H.origin,R=h.add(J,H.origin,H.direction);this._surfaceIntersector.resetWithRay(H,L);this.view.basemapTerrain.intersect(this._surfaceIntersector,
null,S,R);return this._surfaceIntersector.results.min.getIntersectionPoint(O)?O:null};G._cameraChanged=function(H){this._updateCenterPointsOfInterest();H=H.eye;h.exactEquals(this.renderPointOfView,H)||this._set("renderPointOfView",h.copy(this._propertiesPool.get("renderPointOfView"),H))};G._updateCenterPointsOfInterest=function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const H of this._pois)H.updateRenderLocation()};G._updateCenterOnContent=
function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};G._setDebug=function(H){if(H)for(const L of this._pois)this._handles.add(m.watch(()=>L.renderLocation,O=>this._debugCenters.get(L)?.show(O,L.renderCoordsHelper.spatialReference),m.initial),"debug");else this._debugCenters.forEach(L=>L.hide()),this._handles.remove("debug")};c._createClass(I,[{key:"updating",get:function(){return!(!this.surfaceGeometryUpdates?.updating&&!this._pois.some(H=>H.updating))}},{key:"_centerRay",
get:function(){this._centerRayDirty&&(this._centerRayCached=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.contentCamera,this._tmpRay),this._centerRayDirty=!1);return this._centerRayCached}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const H of this._pois)H.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return I}(t);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnContent",
void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);b.__decorate([d.property({readOnly:!0})],
a.PointsOfInterest.prototype,"surfaceOrigin",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",void 0);b.__decorate([d.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);b.__decorate([d.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=b.__decorate([g.subclass("esri.views.3d.support.PointsOfInterest")],
a.PointsOfInterest);const K=Array,J=l.create(),M=v.create(),N={exclude:new Set([F.TERRAIN_ID])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/maybe ../../../geometry/Point ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer".split(" "),function(a,c,b,t,n,r,m,d,f){c=function(){function e(h,l,v=""){this.graphics=
h;this._symbol=new m({symbolLayers:[new d({material:{color:l},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new f({text:v,halo:{color:"white",size:1/.75},material:{color:l},size:12})]})}var g=e.prototype;g.show=function(h,l){n.isNone(l)||(this.hide(),h=new r({x:h[0],y:h[1],z:h[2],spatialReference:l}),this._graphic=new b({geometry:h,symbol:this._symbol}),this.graphics.add(this._graphic))};g.hide=function(){n.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=
null)};return e}();a.PointGraphics=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../ViewingMode ../cameraUtils ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){const C=Array;a.CameraOnSurface=function(A){function x(y){y=A.call(this,y)||this;y._dirty=!1;y._propertiesPool=new k.PropertiesPool({location:l,renderLocation:C},c._assertThisInitialized(y));y._estimatedSurfaceAltitude=0;y._pendingElevationQueryController=null;y.renderLocation=h.create();y._tmpPoint=new l;return y}c._inheritsLoose(x,A);var u=x.prototype;u.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,this));
this.runTask();if(this.map){const y=()=>this._setDirty();this.handles.add(r.on(()=>this.map?.ground?.layers,"change",y,{onListenerAdd:y,onListenerRemove:y}))}this._updateRenderLocation()};u.destroy=function(){this._cancelPendingRequest();this._propertiesPool=t.destroyMaybe(this._propertiesPool)};u.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};u._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};u._cancelPendingRequest=function(){const y=
this._pendingElevationQueryController;y&&(this._pendingElevationQueryController=null,y.abort(),this.notifyChange("updating"))};u.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(!this.map||!this.map.ground)return this._updateSurfaceAltitude(0),z.Task.YIELD;var y=this.state.spatialReference;this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this._tmpPoint,y);y=1E5<(this._tmpPoint.z??0)&&this.renderCoordsHelper.viewingMode===v.ViewingMode.Global&&
(y.isWGS84||y.isWebMercator);let w=new AbortController;this.map.ground.queryElevation(this._tmpPoint,{signal:w.signal,cache:this.cache,minDemResolution:y?1E6:0}).then(D=>this._updateSurfaceAltitude(D.geometry.z??0)).catch(D=>{n.isAbortError(D)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===w&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));w=null});this._pendingElevationQueryController=w;return z.Task.YIELD};u._updateSurfaceAltitude=
function(y){this._estimatedSurfaceAltitude!==y&&(this._estimatedSurfaceAltitude=y,this._updateRenderLocation())};u._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(B,this._estimatedSurfaceAltitude,this._camera.eye);g.exactEquals(this._get("renderLocation"),B)||(this._set("renderLocation",g.copy(this._propertiesPool.get("renderLocation"),B)),this.notifyChange("renderLocation"))};c._createClass(x,[{key:"_camera",get:function(){return this.state.contentCamera}},{key:"location",get:function(){const y=
this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,y,this.state.spatialReference);return y}},{key:"scale",get:function(){const y=this._camera,w=g.distance(y.eye,this.renderLocation);return q.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:y}},w,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);
return x}(p.PointOfInterest);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cache",void 0);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);b.__decorate([m.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);b.__decorate([m.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);b.__decorate([m.property({readOnly:!0})],
a.CameraOnSurface.prototype,"renderLocation",void 0);b.__decorate([m.property({readOnly:!0})],a.CameraOnSurface.prototype,"scale",null);b.__decorate([m.property({readOnly:!0})],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=b.__decorate([e.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const B=h.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d,f){a.PointOfInterest=function(e){function g(h){h=e.call(this,h)||this;h.handles=new n;return h}c._inheritsLoose(g,e);g.prototype.destroy=function(){this.handles.destroy()};return g}(t);b.__decorate([r.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);b.__decorate([r.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);b.__decorate([r.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=
b.__decorate([f.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/Point ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){const B=Array;a.CenterOnSurface=function(y){function w(F){F=y.call(this,F)||this;F._propertiesPool=new p.PropertiesPool({location:l,renderLocation:B},c._assertThisInitialized(F));F._currentSurfaceAltitude=0;F._latestSurfaceAltitude=0;F.distance=0;F.renderLocation=g.create();F.updating=!1;return F}c._inheritsLoose(w,y);var D=w.prototype;D.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()};D.destroy=function(){this._frameWorker=
n.removeMaybe(this._frameWorker);this._propertiesPool=n.destroyMaybe(this._propertiesPool)};D.updateRenderLocation=function(){this.updating=!0;this._updateRenderLocation()};D.runTask=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this.updating=!1;return C.Task.YIELD};D._updateRenderLocation=function(){const F=A;let E=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,F);var K=this._currentSurfaceAltitude!==this._latestSurfaceAltitude;
!E&&K&&(E=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,F))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);K=x;E&&this._latestSurfaceAltitudeChangesDistanceSignificantly(F,K)&&(e.copy(F,K),this._currentSurfaceAltitude=this._latestSurfaceAltitude);E?this.distance=e.distance(this._camera.eye,F):(e.scale(F,this._camera.viewForward,this._get("distance")),e.add(F,F,this._camera.eye));e.exactEquals(this._get("renderLocation"),F)||this._set("renderLocation",e.copy(this._propertiesPool.get("renderLocation"),
F))};D._calculateSurfaceIntersection=function(F,E){var K=this._camera;if(!this.renderCoordsHelper.intersectManifold(K.ray,F,E))return!1;if(this.state.isGlobal){const J=h.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;F=J+F;const M=e.squaredLength(K.eye),N=M<F*F,P=e.distance(K.eye,E);N&&P>J/4&&(e.scale(E,K.viewForward,F-Math.sqrt(M)),e.add(E,E,K.eye))}else K=this.surface?.ready?this.surface.extent:null,n.isSome(K)&&v.projectBoundingRect(K,this.surface?.spatialReference,u,this.renderCoordsHelper.spatialReference)&&
(E[0]=t.clamp(E[0],u[0],u[2]),E[1]=t.clamp(E[1],u[1],u[3]));return!0};D._latestSurfaceAltitudeChangesDistanceSignificantly=function(F,E){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==F)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,E)){if(k.TESTS_DISABLE_OPTIMIZATIONS)return!0;const K=this._camera.eye;F=e.distance(K,F);E=e.distance(K,E);if(.05<Math.abs(E-F)/F)return!0}return!1};c._createClass(w,[{key:"_camera",get:function(){return this.state.contentCamera}},
{key:"location",get:function(){const F=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,F,this.state.spatialReference);return F}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}},{key:"running",get:function(){return this.updating}}]);return w}(z.PointOfInterest);b.__decorate([r.property({constructOnly:!0})],a.CenterOnSurface.prototype,"scheduler",void 0);b.__decorate([r.property({constructOnly:!0})],a.CenterOnSurface.prototype,
"task",void 0);b.__decorate([r.property()],a.CenterOnSurface.prototype,"distance",void 0);b.__decorate([r.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);b.__decorate([r.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);b.__decorate([r.property({readOnly:!0})],a.CenterOnSurface.prototype,"renderLocation",void 0);b.__decorate([r.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=b.__decorate([f.subclass("esri.views.3d.support.CenterOnSurface")],
a.CenterOnSurface);const A=g.create(),x=g.create(),u=q.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../core/Evented","../../../../core/Handles","../../../../core/maybe"],function(a,c,b,t){let n=function(){function m(f){this._handles=new b;this.events=new c;this._contentLayerViews=f.contentLayerViews;this._handles.add(this._contentLayerViews.on("change",e=>this._layerViewsChanged(e)));
this._layerViewsChanged({added:this._contentLayerViews.toArray(),removed:[],moved:[],target:this._contentLayerViews})}var d=m.prototype;d.destroy=function(){this._handles=t.destroyMaybe(this._handles)};d._layerViewsChanged=function(f){f.added.forEach(e=>{"esri.views.3d.layers.SceneLayerView3D"===e.declaredClass&&this._handles.add(e.on("visible-geometry-changed",()=>this._contentChanged()),e.uid)});f.removed.forEach(e=>this._handles.remove(e.uid))};d._contentChanged=function(){this.events.emit("request-update",
r)};return m}();const r={};a.ContentGeometryUpdates=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){const B=Array;a.Focus=function(y){function w(F){F=y.call(this,F)||this;F._propertiesPool=new k.PropertiesPool({location:v,renderLocation:B},c._assertThisInitialized(F));F._dirty=!0;F.renderLocation=F._propertiesPool.get("renderLocation");return F}c._inheritsLoose(w,y);var D=w.prototype;D.initialize=function(){this.handles.add([r.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),r.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);
this.scheduler&&this.handles.add(this.scheduler.registerTask(C.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};D.destroy=function(){this._propertiesPool=n.destroyMaybe(this._propertiesPool)};D.runTask=function(){var F=this._get("renderLocation");const E=this.centerOnSurface.renderLocation;var K=this.renderCoordsHelper,J=this.state.contentCamera;this._dirty=!1;K.worldUpAtPosition(E,A);K=Math.max(0,(Math.acos(h.dot(A,J.viewForward))-.5*Math.PI)*(J.aboveGround?1:-1));if(Number.isNaN(K))return F&&h.equals(F,
E)||(F=this._propertiesPool.get("renderLocation"),h.copy(F,E),this._set("renderLocation",F)),C.Task.YIELD;K=1-t.clamp(K/(.5*Math.PI),0,1);K*=K*K;this._calculateScreenHorizontalEdgeOnSurface(u);J=this._propertiesPool.get("renderLocation");h.lerp(J,E,u,K);F&&h.equals(F,J)||this._set("renderLocation",J);return C.Task.YIELD};D._calculateScreenHorizontalEdgeOnSurface=function(F){const E=this.state.contentCamera;var K=E.getRenderCenter(m.createRenderScreenPointArray3());K[1]=E.aboveGround?E.padding[z.PaddingSide.BOTTOM]:
E.fullHeight-E.padding[z.PaddingSide.TOP];if(this.estimateSurfaceIntersectionAtRenderPoint(K,F))return F;const J=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return E.unprojectFromRenderScreen(K,x)&&(h.subtract(x,x,E.eye),K=h.normalize(x,x),this.renderCoordsHelper.intersectManifold(q.wrap(E.eye,K),J,F))?F:this.renderCoordsHelper.setAltitude(F,J,E.eye)};D.updateRenderLocation=function(){this._dirty=!0};c._createClass(w,[{key:"updating",get:function(){return this._dirty||
this.centerOnSurface.updating}},{key:"location",get:function(){const F=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,F,this.state.spatialReference);return F}},{key:"running",get:function(){return this._dirty}}]);return w}(p.PointOfInterest);b.__decorate([d.property()],a.Focus.prototype,"_dirty",void 0);b.__decorate([d.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);b.__decorate([d.property({constructOnly:!0})],a.Focus.prototype,
"centerOnSurface",void 0);b.__decorate([d.property({constructOnly:!0})],a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);b.__decorate([d.property({readOnly:!0})],a.Focus.prototype,"updating",null);b.__decorate([d.property({readOnly:!0})],a.Focus.prototype,"location",null);b.__decorate([d.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=b.__decorate([g.subclass("esri.views.3d.support.pointsOfInterest.Focus")],a.Focus);const A=l.create(),x=l.create(),u=
l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){a.StableSurfaceCenter=function(k){function p(C){C=k.call(this,C)||this;C.location=null;C._updateController=null;C._handles=new n;return C}c._inheritsLoose(p,k);var z=p.prototype;z.initialize=function(){this.view.state.isLocal&&(this._handles.add([d.watch(()=>[this.surfaceView?.spatialReference,this.surfaceView?.extent],()=>this._update()),d.on(()=>this.surface?.layers,"change",()=>this._update())]),this._update())};z.destroy=function(){this._handles.destroy()};
z._update=function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(!this.surfaceView||r.isNone(this.surfaceView.extent)||r.isNone(this.surfaceView.spatialReference))this._set("location",null);else{var C=q.center(this.surfaceView.extent);C=new v({x:C[0],y:C[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=new AbortController,this.surface.queryElevation(C,
{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(B=>{this._updateController=null;this._set("location",B.geometry)}).catch(B=>{m.isAbortError(B)||B&&"elevation-query:invalid-layer"===B.name||console.error("StableSurfaceCenter failed to update: ",B)})):this._set("location",C)}};c._createClass(p,[{key:"surface",get:function(){return this.view.map?.ground}},{key:"surfaceView",get:function(){return this.view.basemapTerrain}},{key:"renderLocation",get:function(){if(!this.location)return null;
const C=l.create();this.view.renderCoordsHelper.toRenderCoords(this.location,C);return C}}]);return p}(t);b.__decorate([f.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);b.__decorate([f.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);b.__decorate([f.property()],a.StableSurfaceCenter.prototype,"surface",null);b.__decorate([f.property()],a.StableSurfaceCenter.prototype,"surfaceView",null);b.__decorate([f.property({readOnly:!0})],a.StableSurfaceCenter.prototype,
"location",void 0);b.__decorate([f.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=b.__decorate([h.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){a.SurfaceGeometryUpdates=function(z){function C(A){A=z.call(this,A)||this;A._tileGeometryUpdateExtent=h.empty();A._tileGeometryUpdateSpatialReference=null;A.events=new n;A.updating=!1;return A}c._inheritsLoose(C,z);var B=C.prototype;B.initialize=function(){this.addHandles([this.surface.on("elevation-change",A=>this._tileGeometryChanged(A)),this.scheduler.registerTask(l.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};B.runTask=function(){if(!this.updating)return l.Task.YIELD;
this._tileGeometryUpdateSpatialReference&&this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",v);h.empty(this._tileGeometryUpdateExtent);this._set("updating",!1);return l.Task.YIELD};B._tileGeometryChanged=function(A){this._tileGeometryUpdateSpatialReference=r.unwrap(A.spatialReference);h.expand(this._tileGeometryUpdateExtent,A.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)};B._furthestCenterOnSurface=
function(){let A=this.centerOnSurfaces[0];for(let x=1;x<this.centerOnSurfaces.length;x++){const u=this.centerOnSurfaces[x];u.distance>A.distance&&(A=u)}return A};B._centerIntersectsExtent=function(A,x){const u=this.state.contentCamera.eye,y=p,w=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(u,q,x);this.renderCoordsHelper.fromRenderCoords(w.renderLocation,k,x);q[0]<k[0]?(y[0]=q[0],y[2]=k[0]):(y[0]=k[0],y[2]=q[0]);q[1]<k[1]?(y[1]=q[1],y[3]=k[1]):(y[1]=k[1],y[3]=q[1]);return h.intersects(y,
A)};c._createClass(C,[{key:"running",get:function(){return this.updating}}]);return C}(t);b.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);b.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);b.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);b.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);
b.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);b.__decorate([m.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=b.__decorate([e.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const v={},q=g.create(),k=g.create(),p=h.empty();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../core/support/WatchUpdatingTracking ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/ElevationTileData ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./ScaleRangeQueries ./SphericalPatch ./SplitLimits ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../webgl-engine/lib/basicInterfaces ../../support/RenderState ../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V,aa,X,W,T,U,Y,ba,da,ea,ca,ja,ia,Z,ha,fa,ka,la,na,pa,va,wa,za,sa,ua,oa,xa){function Ea(Ya,bb){return Ya[0]===bb[0]&&Ya[1]===bb[1]&&Ya[2]===bb[2]}function Ia(Ya){Ya=Ya.children;if(!Ya[0])return!1;for(const bb of Ya)if(bb.shouldLoad)return!0;for(const bb of Ya)if(Ia(bb))return!0;return!1}function Na(Ya,bb,Qa){for(const Aa of Ya)if(Aa.containsPointXY(bb,Qa)){for(Ya=Aa;Ya&&!Ya.renderData;)Ya=Ya.children[(bb>Ya.extentMidX?
1:0)+(Qa<Ya.extentMidY?2:0)];return X.sampleElevation(bb,Qa,Ya?.renderData?.geometryState.samplerData??null)}return null}n=function(Ya){function bb(Aa){var Ca=Ya.call(this,Aa)||this;Ca._scaleRangeQueries=new ea.ScaleRangeQueries;Ca._iteratorPool=new l(pa.IteratorPreorder,qa=>qa.remove=()=>Ca._iteratorPool.release(qa));Ca._postorderIterator=new pa.IteratorPostorder;Ca._hasPendingUpdates=!1;Ca._pendingUpdates=0;Ca._asyncWorkItems=0;Ca._allTilesDirty=!0;Ca._allTilesSorted=!0;Ca._visibleCached=!1;Ca._usedMemory=
null;Ca._performanceInfo=new ha;Ca._viewChanged=!1;Ca._inFrameTask=!1;Ca._viewChangeUpdateDirty=!1;Ca._eyePosRenderSR=u.create();Ca._eyePosSurfaceSR=u.create();Ca._splitLimits=new ja.SplitLimits;Ca._frustum=J.create();Ca._viewProjectionMatrix=A.create();Ca._layerViews=[[],[]];Ca._layerIndexByUid=[new Map,new Map];Ca._basemapLayerViewHandles=new Map;Ca._handles=new f;Ca._watchUpdatingTracking=new w.WatchUpdatingTracking;Ca._frameTask=xa.ImmediateTask;Ca._allTiles=new v;Ca._upsampleInfoPool=new l(wa.UpsampleInfo);
Ca._rootTilesExtent=K.create();Ca.updatingProgress=0;Ca._maxNumUpdating=1;Ca.maxTextureScale=1.2;Ca._spatialReference=E.WebMercator;Ca.visibleElevationBounds=new aa.ElevationBounds(Infinity,-Infinity);Ca.rootTileElevationBounds=new aa.ElevationBounds(Infinity,-Infinity);Ca._updatingRootTiles=!1;Ca._pendingTilesForElevationUpdateEvent=new Set;Ca._pendingTilesToUpdate=new Set;Ca.totalGeometryUpdates=0;Ca.totalTileUpdates=0;Ca.oneBatchPerFrameTask=!0;Ca._layerViewsDirty=!1;Ca._shading=!0;Ca._isWebMercator=
!1;Ca._isWebMercatorOnPlateeCarree=!1;Ca._isGlobal=!Aa.view?.state?.isLocal;return Ca}c._inheritsLoose(bb,Ya);var Qa=bb.prototype;Qa.initialize=function(){this._lercDecoder=H.acquireDecoder(this.view.resourceController);this._tilePool=this.view.state.isLocal?new l(ba.PlanarPatch):new l(ca.SphericalPatch);var Aa=this.view.resourceController.memoryController;this._upsampleMapCache=Aa.newCache("esri.views.3d.terrain.upsample",qa=>qa.unloadMapData());this._elevationQueryCache=new P.ElevationQueryTileCache(Aa.newCache("elevation-query"));
this._set("overlayManager",new Y.OverlayManager({surface:this}));this._handles.add([k.watch(()=>this.overlayManager.hasHighlights,qa=>this._renderer.setNeedsHighlight(qa)),k.watch(()=>this.overlayManager.rendersOccluded,qa=>this._renderer.setRenderOccludedOverlay(qa)),k.watch(()=>this.overlayManager.renderer.isEmpty,()=>this._evaluateTransparency())],"overlayManager");this._renderer=new Z.TerrainRenderer({_overlayRenderer:this.overlayManager.renderer,_ellipsoidRadius:D.getReferenceEllipsoid(this.view.spatialReference).radius,
_stage:this.view._stage,_allTiles:this._allTiles});this._handles.add([k.watch(()=>this.baseOpacity,()=>{this._handleLayerViewChanges();this._updateTileTextures(this._evaluateTransparency()?T.TextureUpdate.UNFADED:T.TextureUpdate.IMMEDIATE)},k.syncAndInitial),k.watch(()=>this.hasCompositeBlendMode,()=>this._updateTileTextures(this._evaluateTransparency()?T.TextureUpdate.UNFADED:T.TextureUpdate.IMMEDIATE),k.syncAndInitial),k.watch(()=>this.renderingDisabled,()=>this.view?._stage?.renderer.setParameters({terrainRenderingEnabled:!this.renderingDisabled}),
k.sync),k.watch(()=>this.backgroundColor,qa=>{this._handleLayerViewChanges();this._renderer.updateTileBackground(qa)},k.syncAndInitial),k.watch(()=>this.snapLevel,()=>this._viewChanged=!0,k.sync),k.watch(()=>this.view.pointsOfInterest,qa=>{this._renderer.pointsOfInterest=qa;this._watchUpdatingTracking.removeAll();qa&&this._watchUpdatingTracking.add(()=>qa.focus.renderLocation,()=>this._allTilesSorted=!1)}),k.watch(()=>S.TERRAIN_TILE_TREE_SHOW_TILES,qa=>{qa&&!this._treeDebugger?(new Promise((ya,Da)=>
a(["../layers/support/TerrainTileTree3DDebugger"],ya,Da))).then(({TerrainTileTree3DDebugger:ya})=>{!this._treeDebugger&&S.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new ya({view:this.view}))}):qa||(this._treeDebugger=h.destroyMaybe(this._treeDebugger))},k.initial)]);({spatialReference:Aa}=this.view);this._extentHelper=W.create(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:Aa});const Ca=new m({getCollections:()=>this.view?.defaultsFromMap?.mapCollections?.map(({layers:qa})=>
qa),getChildrenFunction:qa=>qa&&"layers"in qa?qa.layers:null});Aa=new va.TilingSchemeLogic({layers:Ca,extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:Aa});this._set("tilingSchemeLogic",Aa);this._updateTilingScheme();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(Q.ClientType.ELEVATION);this._mapDataRequester=this.view.resourceController.createStreamDataRequester(Q.ClientType.BASEMAP);this._frameTask=this.view.resourceController.scheduler.registerTask(xa.TaskPriority.TERRAIN_SURFACE,
this);this._handles.add([k.watch(()=>this._extentHelper.stencilEnabledExtents,qa=>this._renderer.setStencilEnabledLayerExtents(qa),k.initial),k.watch(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),k.sync),k.watch(()=>this.extent,()=>this._updateRootTiles(),k.initial),this.view.on("resize",()=>this._viewChangeUpdate()),k.watch(()=>{const qa=this.view,ya=qa.state;return[this._lodBias,this.lodSnapping,qa.resourceController?.memoryController?.memoryFactor,ya.camera,ya.contentCamera,
ya.fixedContentCamera]},()=>this._viewChangeUpdate(),k.syncAndInitial),k.watch(()=>this.view.qualitySettings?.tiledSurface?.textureFadeDuration,qa=>this._renderer.textureFadingEnabled=0<qa,k.initial),k.watch(()=>this.view.qualitySettings?.physicallyBasedRenderingEnabled,qa=>this._renderer.pbrMode=qa?sa.PBRMode.Terrain:sa.PBRMode.Disabled,k.initial),k.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),k.sync)]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=
!0));this._handles.add([k.watch(()=>this.view?.map.ground.shading,()=>{this._updateShadingIfChanged()})]);this._updateShading();this._layerViewsDirty=!0;this._handleLayerViewChanges()};Qa.destroy=function(){this._frameTask.remove();this._handles.destroy();this._watchUpdatingTracking.destroy();this._lercDecoder=h.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._upsampleMapCache=h.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=h.destroyMaybe(this._elevationQueryCache);const Aa=
this.tilingSchemeLogic.layers;this._set("tilingSchemeLogic",h.destroyMaybe(this.tilingSchemeLogic));Aa.destroy();this._basemapLayerViewHandles.forEach((Ca,qa)=>this._unregisterTiledLayerView(qa));this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",h.destroyMaybe(this.overlayManager));this._tilePool=h.destroyMaybe(this._tilePool);ka.Tile.prune();this._treeDebugger=h.destroyMaybe(this._treeDebugger);this._renderer=h.destroyMaybe(this._renderer);this._iteratorPool=h.destroyMaybe(this._iteratorPool);
this._set("view",null);this._upsampleInfoPool=h.destroyMaybe(this._upsampleInfoPool);L.printAllocations();la.printAllocations()};Qa.intersect=function(Aa,Ca,qa,ya){this._renderer.intersect(Aa,Ca,qa,ya)};Qa.getElevation=function(Aa,Ca,qa,ya){const Da=this._rootTiles;if(h.isNone(Da)||!Da.length||0===Da[0].layerInfo[U.LayerClass.ELEVATION].length)return null;const La=Oa;La[0]=Aa;La[1]=Ca;La[2]=qa;return F.projectVectorToVector(La,ya,La,this._spatialReference)?Na(Da,La[0],La[1]):(e.getLogger(this.declaredClass).error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null)};Qa.getElevations=function(Aa,Ca,qa){const ya=this._rootTiles;var Da=ya?ya[0].layerInfo[U.LayerClass.ELEVATION].length:0;if(h.isNone(ya)||!ya.length||0===Da)for(Aa=0;Aa<Ca;++Aa)qa(Aa,null);else for(Da=0;Da<Ca;++Da){var La=3*Da;La=Na(ya,Aa[La+0],Aa[La+1]);qa(Da,La)}};Qa.getScale=function(Aa){if(!this.tilingScheme)return null;if(!F.projectPointToVector(Aa,Oa,this.spatialReference))return e.getLogger(this.declaredClass).error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),
null;Aa=this._rootTiles;if(h.isSome(Aa))for(var Ca of Aa)if(Ca?.containsPoint(Oa)){for(;Ca.children[0]&&!Ca.rendered;){Aa=Ca.children[0].extent;let qa=0;Oa[0]>Aa[2]&&(qa+=1);Oa[1]<Aa[1]&&(qa+=2);Ca=Ca.children[qa]}return this._getLodBiasCorrectedScale(Ca.level)}return Infinity};Qa.getSphereElevationBounds=function(Aa,Ca,qa,ya,Da){Oa[0]=Aa;Oa[1]=Ca;Oa[2]=qa;Oa[3]=ya;if(!F.projectVectorToVector(Oa,Da,Oa,this.tilingScheme?.spatialReference))return e.getLogger(this.declaredClass).error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),
null;let La=Infinity,Ta=-Infinity;const Xa=db=>{if(db&&K.intersectsSphere(db.extent,Oa))if(db.isLeaf||db.rendered)La=Math.min(La,db.elevationBounds[0]),Ta=Math.max(Ta,db.elevationBounds[1]);else for(const fb of db.children)Xa(fb)};Aa=this._rootTiles;if(h.isSome(Aa))for(const db of Aa)Xa(db);return{min:La,max:Ta}};Qa.getSphereScale=function(Aa,Ca){if(!this.tilingScheme)return null;if(!F.projectPointToVector(Aa,Oa,this.spatialReference))return e.getLogger(this.declaredClass).error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),
null;Oa[3]=Ca;let qa=null;const ya=Da=>{if(Da&&K.intersectsSphere(Da.extent,Oa)){const La=Da.children;if(La[0]&&!Da.rendered)for(const Ta of La)ya(Ta);else Da=this._getLodBiasCorrectedScale(Da.level),qa=null==qa?Da:Math.min(qa,Da)}};Aa=this._rootTiles;if(h.isSome(Aa))for(const Da of Aa)ya(Da);return qa};Qa.queryVisibleScaleRange=function(Aa,Ca,qa,ya){Ca=Ca?this.tilingScheme.levelAtScale(Ca):0;qa=qa?this.tilingScheme.levelAtScale(qa):Infinity;const Da=this._lodBias;this._scaleRangeQueries.queryVisibleLevelRange(Aa,
Ca+Da,qa+Da,ya)};Qa._evaluateTransparency=function(){var Aa=this.baseOpacity;const Ca=this.overlayManager.renderer.isEmpty;var qa=this._renderer.transparency;Aa=this._allSurfaceLayersTransparent()?Ca?Z.TransparencyMode.Empty:Z.TransparencyMode.TransparentWithDraped:1<=Aa&&!this.hasCompositeBlendMode&&!this._renderer.slicePlaneEnabled?Z.TransparencyMode.Opaque:Z.TransparencyMode.Semitransparent;if(qa=qa!==Aa)this._renderer.transparency=Aa,this.view?._stage?.renderer.setParameters({terrainTransparency:this._renderer.transparency});
return qa};Qa._updateTilingScheme=function(){const Aa=this.tilingSchemeLogic.tilingScheme;if(Aa!==this.tilingScheme){fa.weakAssert(!!Aa,"tiling scheme cannot be reset to undefined");this._isGlobal=!this.view?.state?.isLocal;this.tilingScheme&&this._removeAllTiles();var Ca=Aa?.spatialReference??E.WebMercator;this._spatialReference=Ca;this._isWebMercatorOnPlateeCarree=(this._isWebMercator=!!Ca?.isWebMercator)&&M.isPlateCarree(this.view?.renderSpatialReference);this._set("tilingScheme",Aa);this._updateClippingExtent();
Aa&&(this._updateTiledLayers(),this._renderer.setTileSize(Aa.pixelSize),this.overlayManager.setSpatialReference(Aa.spatialReference),this._updateRootTiles())}};Qa._acquireTile=function(Aa,Ca,qa,ya){const Da=this._tilePool.acquire();Sa[0]=Aa;Sa[1]=Ca;Sa[2]=qa;Da.init(Sa,ya,this);return Da};Qa._updateRootTiles=function(){const {extent:Aa,tilingScheme:Ca}=this;if(Ca){var qa=Ja,ya=Ca.rootTilesInExtent(Aa,qa,5*ia.MAX_ROOT_TILES);if(h.isSome(this._rootTiles)){if(ya.length>ia.MAX_ROOT_TILES){e.getLogger(this.declaredClass).warn(ia.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);
return}const Da=this._rootTiles.map(Ta=>Ta.lij),La=r.difference(Da,ya,Ea);this._updatingRootTiles=!0;if(0<La.removed.length||0<La.added.length){const Ta=this._rootTiles.filter(Xa=>-1<La.removed.findIndex(db=>Ea(db,Xa.lij))?(this._purgeTile(Xa),!1):!0);La.added.forEach(Xa=>Ta.push(this._newRootTile(Xa)));this._setRootTiles(Ta)}}else this._updatingRootTiles=!0,ya.length>ia.MAX_ROOT_TILES&&(e.getLogger(this.declaredClass).warn(ia.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),ya=Ca.rootTilesInExtent(Aa,qa,ia.MAX_ROOT_TILES)),
this._setRootTiles(ya.map(Da=>this._newRootTile(Da)));K.equals(qa,this._rootTilesExtent)||(this._rootTilesExtent=K.create(qa));this._visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._updateAllTileGeometries();this._updatingRootTiles=!1;this.checkAllTilesWaterproofness()}};Qa._updateAllTileGeometries=function(){const Aa=this._allTiles.filter(Ca=>Ca.isLoaded&&Ca.intersectsClippingArea);Aa.forEach(Ca=>this._renderer.updateTileGeometryState(Ca));
Aa.forEach(Ca=>Ca.renderData.updateNeighborData());this._updateTilesGeometries(Aa);this._pendingTilesToUpdate.clear()};Qa._updateTilesGeometries=function(Aa){if(0!==Aa.length){Aa.sort(pa.compareTilesByLij);var Ca=this.renderer;Aa.forEach(qa=>Ca.updateGeometryIfNeeded(qa));Aa.forEach(qa=>this._pendingTilesForElevationUpdateEvent.add(qa))}};Qa._shouldSplit=function(Aa){return Aa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.snapLevel)===na.TileUpdate.SPLIT};Qa._newRootTile=function(Aa){Aa=
this._acquireTile(0,Aa[1],Aa[2],null);this._shouldSplit(Aa)&&Aa.setPendingUpdate(na.TileUpdate.SPLIT);this._loadTile(Aa);this._markTileToUpdate(Aa);this._updateRootTileElevationBounds();return Aa};Qa._setRootTiles=function(Aa){this._rootTiles=Aa;this._allTiles.clear();if(h.isSome(Aa)){const Ca=this._iteratorPool.acquire();for(Ca.reset(Aa);!Ca.done;)this._allTiles.push(Ca.next());Ca.remove()}this._renderer.setRootTiles(this._rootTiles);this._updateTilesVisibility(Aa)};Qa._runViewChangeUpdateIfDirty=
function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};Qa._viewChangeUpdate=function(){this.view&&!this.suspended&&this.tilingScheme&&this._visibleCached&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),this._updateTilesVisibility(this._rootTiles)))};Qa._updateClippingStatus=function(Aa){Aa.updateClippingStatus(this.extent)&&Aa.resetPendingUpdate(na.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(Aa)};
Qa._updateTilesVisibility=function(Aa){if(!h.isNone(Aa)){var Ca=pa.hasLoadableSiblings(Aa),qa=this.visibleElevationBounds,ya=Ca?qa.min:Infinity;Ca=Ca?qa.max:-Infinity;var Da=this.extent,La=this._viewProjectionMatrix;this.setTileTreeDirty();var Ta=this._iteratorPool.acquire();for(Ta.reset(Aa);!Ta.done;)Aa=Ta.next(),Aa.updateClippingStatus(Da)&&Aa.resetPendingUpdate(na.TileUpdate.GEOMETRY)&&this._updateTileGeometryState(Aa),Aa.setPendingUpdate(na.TileUpdate.RENDERDATA),Aa.computeVisibility(),Aa.updateScreenDepth(La),
Aa.renderData&&(ya=Math.min(Aa.elevationBounds[0],ya),Ca=Math.max(Aa.elevationBounds[1],Ca));Ta.remove();this._allTilesDirty=this._viewChanged=!0;this._batchUpdatePendingTileGeometries();isFinite(ya)&&isFinite(Ca)&&(qa.min!==ya||qa.max!==Ca)&&(this.visibleElevationBounds=new aa.ElevationBounds(ya,Ca))}};Qa._updateRootTileElevationBounds=function(){let Aa=Infinity,Ca=-Infinity;var qa=this._rootTiles;h.isSome(qa)&&qa.forEach(({elevationBounds:ya})=>{Aa=Math.min(Aa,ya[0]);Ca=Math.max(Ca,ya[1])});qa=
this.rootTileElevationBounds;if(qa.min!==Aa||qa.max!==Ca)this.rootTileElevationBounds=new aa.ElevationBounds(Aa,Ca)};Qa._updateViewDependentParameters=function(){const {camera:Aa,contentCamera:Ca}=this.view.state,qa=Math.tan(.5*Ca.fovX),ya=Math.tan(.5*Ca.fovY),Da=this.tilingScheme.pixelSize,La=2**-this._lodBias*Aa.pixelRatio;this._splitLimits.aboveGround=Aa.aboveGround;this._splitLimits.fovX=qa;this._splitLimits.fovY=ya;this._splitLimits.relativeWidthLimit=Da/Aa.width*this.maxTextureScale*La;this._splitLimits.relativeHeightLimit=
Da/Aa.height*this.maxTextureScale*La;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this.view.state.fixedContentCamera?(h.isNone(this._splitLimits.frustum)&&(this._splitLimits.frustum=J.create()),J.copy(this._splitLimits.frustum,Ca.frustum)):this._splitLimits.frustum=null;J.copy(this._frustum,Aa.frustum);B.multiply(this._viewProjectionMatrix,Ca.projectionMatrix,Ca.viewMatrix);x.copy(this._eyePosRenderSR,
Ca.eye);F.projectVectorToVector(Aa.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};Qa._updateRenderData=function(Aa){Aa.rendered&&!Aa.shouldLoad&&(Ia(Aa)?this._loadChildren(Aa):Aa.isLeaf&&(Aa.parent?.shouldLoad??!1)&&this._loadParent(Aa))};Qa._updateTileGeometryState=function(Aa){Aa.updateVisibility();this._renderer.updateTileGeometryState(Aa)&&this._markTileToUpdate(Aa);this._usedMemory=null};Qa._markAllTileNeighborsForGeometryUpdate=function(Aa){const Ca=this._pendingTilesToUpdate;
Aa.forEachLoadedNeighbor(qa=>{Ca.add(qa)})};Qa._updateTileTexture=function(Aa,Ca){const qa=Aa.resetPendingUpdate(na.TileUpdate.TEXTURE_FADING)?na.TileUpdate.TEXTURE_FADING:Aa.resetPendingUpdate(na.TileUpdate.TEXTURE_NOFADING)?na.TileUpdate.TEXTURE_NOFADING:!1;qa&&(this._renderer.updateTileTexture(Aa,qa),this._usedMemory=null,Ca.madeProgress())};Qa._emitElevationUpdateEventForTiles=function(){const Aa=Za.extent;K.empty(Aa);this._pendingTilesForElevationUpdateEvent.forEach(Ca=>K.expand(Aa,Ca.extent,
Aa));this._pendingTilesForElevationUpdateEvent.clear();Za.spatialReference=this.spatialReference;this.emit("elevation-change",Za)};Qa.runTask=function(Aa){this._handleLayerViewChanges(Aa);this._frameTask.processQueue(Aa);this.renderer.processScaleRangeQueries(this._scaleRangeQueries,Aa);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateAllTilesStatus(Aa);this._sortTiles(Aa);const Ca=!this.view.state.fixedContentCamera;this._mergeAndSplit(Aa,Ca);this._updateElevation(Aa);
this._updateTextures(Aa);Ca||this._mergeAndSplit(Aa,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();this._batchUpdatePendingTileGeometries();this._emitElevationUpdateEventForTiles();Aa.done&&Aa.hasProgressed?this.requestUpdate():this.getUsedMemory();this.notifyChange("updatingProgressValue")};Qa._updateAllTilesStatus=function(Aa){if(this._viewChanged&&this._rootTiles&&!Aa.done){this._viewChanged=!1;var Ca=this._iteratorPool.acquire();Ca.reset(this._rootTiles);for(var qa=this.snapLevel,
ya=this._splitLimits,Da=this._eyePosRenderSR;!Ca.done;){var La=Ca.next(),Ta=La.shouldSplit(ya,Da,qa);if(Ta===na.TileUpdate.SPLIT)La.resetPendingUpdate(na.TileUpdate.MERGE),La.isLeaf&&(La.setPendingUpdate(na.TileUpdate.SPLIT),Ca.skipSubtree()),La.rendered&&La.setPendingUpdate(na.TileUpdate.RENDERDATA);else if(La.resetPendingUpdate(na.TileUpdate.SPLIT)&&La.updateAgentSuspension(),Ta===na.TileUpdate.VSPLITMERGE&&La.updateAgents(U.LayerClass.ELEVATION),Ca.skipSubtree(),!La.isLeaf){La.setPendingUpdate(na.TileUpdate.MERGE);
La.resetPendingUpdate(na.TileUpdate.SPLIT);Ta=this._iteratorPool.acquire();Ta.resetOne(La);La=this._viewProjectionMatrix;for(let Xa=Ta.next();!Ta.done;Xa=Ta.next())this._updateClippingStatus(Xa),Xa.updateVisibility(),Xa.updateScreenDepth(La);Ta.remove()}}Ca.remove();this.requestUpdate();!this.shortBatches&&this.oneBatchPerFrameTask||this._batchUpdatePendingTileGeometries();Aa.madeProgress()}};Qa._sortTiles=function(Aa){Aa.done||this._allTilesSorted||(pa.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),
this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),Aa.madeProgress())};Qa._markTileToUpdate=function(Aa){fa.internalAssert(Aa.isLoaded);Aa.intersectsClippingArea&&(this._pendingTilesToUpdate.add(Aa),this._markAllTileNeighborsForGeometryUpdate(Aa))};Qa._batchUpdatePendingTileGeometries=function(){const Aa=this._pendingTilesToUpdate;if(0!==Aa.size){var Ca=Array.from(this._pendingTilesToUpdate.keys()).filter(Da=>Da.isLoaded&&Da.intersectsClippingArea),qa=(Da,La)=>{!La?.isLoaded||
!La.intersectsClippingArea||La.level<Da.level||Aa.has(La)||(Aa.add(La),Ca.push(La),La.renderData.updateNeighborData())};Ca.sort(pa.compareTilesByLij);var ya=Ca.length;for(let Da=0;Da<ya;++Da){const La=Ca[Da];fa.internalAssert(La.isLoaded);fa.internalAssert(La.intersectsClippingArea);const Ta=La.renderData;Ta.updateNeighborData();const Xa=Ta._dirtyEdgeResolutions,db=Ta.geometryState.neighborData;for(let fb=0;4>fb;++fb)if(Xa&1<<fb){const jb=Ta.geometryState.neighborData.edgePeerNeighbors[fb];jb&&jb?.level>=
La.level&&jb.forAllSubtreeOnSide(fa.oppositeEdge(fa.neighborEdgeIndices[fb]),lb=>lb.isLoaded&&lb.intersectsClippingArea?(fa.internalAssert(Aa.has(lb)||0>pa.compareTilesByLij(La,lb)),qa(La,lb),!0):!1);qa(La,db.cornerPeerNeighbors[fb]);qa(La,db.cornerPeerNeighbors[(fb+1)%4])}}Aa.clear();this._updateTilesGeometries(Ca);fa.ENABLE_TERRAIN_INTERNAL_CHECKS&&fa.ENABLE_WATERPROOFNESS_TESTS&&this.checkAllTilesWaterproofness()}};Qa._mergeAndSplit=function(Aa,Ca){if(!this.suspended&&!Aa.done&&this._allTilesDirty){this._allTilesDirty=
!1;this.requestUpdate();for(var qa=!1,ya=this.view.state.fixedContentCamera,Da=!1;!Aa.done;){Da=!0;let La=!1;const Ta=!this._allTiles.some(Xa=>{if(!qa&&!ya&&!Xa.visible)return Aa.done;let db=Xa;if(Xa.resetPendingUpdate(na.TileUpdate.MERGE)){if(!Ca)return Xa.setPendingUpdate(na.TileUpdate.MERGE),Aa.done;for(;db.parent?.resetPendingUpdate(na.TileUpdate.MERGE);)db=db.parent;this._mergeTile(db);La=!0;Aa.madeProgress()}else Xa.resetPendingUpdate(na.TileUpdate.SPLIT)&&(this._splitTile(Xa),La=!0,Aa.madeProgress());
!Aa.done&&db===Xa&&Xa.resetPendingUpdate(na.TileUpdate.RENDERDATA)&&(this._updateRenderData(Xa),Aa.madeProgress());return Aa.done});La&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(Ta)if(!qa)qa=!0;else{if(!La)break}else this._allTilesDirty=!0}Da?Aa.madeProgress():this._allTilesDirty=!0;!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries();this._sortTiles(Aa)}};Qa._updateElevation=function(Aa){Aa.done||(this._allTiles.some(Ca=>{Ca.resetPendingUpdate(na.TileUpdate.GEOMETRY)&&(this._updateTileGeometryState(Ca),
this._updateTileTexture(Ca,Aa),this.shortBatches&&this._batchUpdatePendingTileGeometries(),Aa.madeProgress());return Aa.done}),!this.oneBatchPerFrameTask&&this._batchUpdatePendingTileGeometries())};Qa._updateTextures=function(Aa){Aa.done||this._allTiles.some(Ca=>{this._updateTileTexture(Ca,Aa);return Aa.done})};Qa._updateClippingExtent=function(){this.spatialReference&&(this.updateTileOverlayParams(ua.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())};Qa._getLodBiasCorrectedScale=
function(Aa){const Ca=this.tilingScheme.levels;Aa=g.clamp(Aa-this._lodBias,0,Ca.length-1);const qa=Aa-Math.floor(Aa);return Ca[Math.floor(Aa)].scale*(1-qa)+Ca[Math.ceil(Aa)].scale*qa};Qa._removeAllTiles=function(){h.isSome(this._rootTiles)&&(this._rootTiles.forEach(Aa=>this._purgeTile(Aa)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this._visible=!1};Qa._purgeDescendantTiles=function(Aa){if(!Aa.children[0])return!1;let Ca=!1;for(let qa=0;4>qa;++qa)Ca=this._purgeTile(Aa.children[qa])||
Ca;Aa.unsetChildren();return Ca};Qa._purgeTile=function(Aa){const Ca=this._purgeDescendantTiles(Aa)||Aa.rendered;this._allTiles.removeUnordered(Aa);this._unloadTile(Aa);this._tilePool.release(Aa);return Ca};Qa._unloadTile=function(Aa){this._pendingTilesToUpdate.delete(Aa);this._pendingTilesForElevationUpdateEvent.delete(Aa);Aa.unload(this._renderer)};Qa._splitTile=function(Aa){fa.weakAssert(Aa.isLeaf,"tile that is already split should not be split again!");const Ca=Aa.level+1,qa=2*Aa.lij[1],ya=2*
Aa.lij[2];Aa.setChildren(this._createTile(Ca,qa,ya,Aa),this._createTile(Ca,qa,ya+1,Aa),this._createTile(Ca,qa+1,ya,Aa),this._createTile(Ca,qa+1,ya+1,Aa));Aa.setPendingUpdate(na.TileUpdate.RENDERDATA);Aa.updateAgentSuspension();this._allTiles.pushArray(Aa.children);this._allTilesDirty=!0;++this._performanceInfo.numSplit};Qa._emitTileScaleChange=function(Aa,Ca=Aa.level){ma.spatialReference=this.spatialReference;ma.extent=Aa.extent;ma.scale=this._getLodBiasCorrectedScale(Ca);this.emit("scale-change",
ma)};Qa._createTile=function(Aa,Ca,qa,ya){fa.weakAssert(!!ya,"_createTile sanity check");Aa=this._acquireTile(Aa,Ca,qa,ya);Aa.updateClippingStatus(this.extent);Aa.updateScreenDepth(this._viewProjectionMatrix);this._shouldSplit(Aa)&&Aa.setPendingUpdate(na.TileUpdate.SPLIT);return Aa};Qa._mergeTile=function(Aa){fa.weakAssert(!Aa.hasPendingUpdate(na.TileUpdate.SPLIT),"_mergeTile sanity check");this._purgeDescendantTiles(Aa)&&(fa.weakAssert(!Aa.renderData,"_mergeTile sanity check"),this._loadTile(Aa),
this._markTileToUpdate(Aa),this._emitTileScaleChange(Aa),this.shortBatches&&this._batchUpdatePendingTileGeometries());this._allTilesDirty=!0;++this._performanceInfo.numMerged};Qa._loadChildren=function(Aa){fa.weakAssert(Aa.rendered,"parent should be rendered");this._unloadTile(Aa);const Ca=Aa.children;Ca.forEach(qa=>this._loadTile(qa));Ca.forEach(qa=>this._pendingTilesToUpdate.add(qa));this._markAllTileNeighborsForGeometryUpdate(Aa);this._emitTileScaleChange(Aa,Aa.level+1);this.shortBatches&&this._batchUpdatePendingTileGeometries()};
Qa._loadParent=function(Aa){Aa=Aa.parent;this._unloadChildren(Aa);this._loadTile(Aa);this._markTileToUpdate(Aa);this._emitTileScaleChange(Aa,Aa.level);this.shortBatches&&this._batchUpdatePendingTileGeometries()};Qa._unloadChildren=function(Aa){Aa=Aa.children;if(Aa[0])for(let Ca=0;4>Ca;++Ca){const qa=Aa[Ca];this._unloadChildren(qa);this._unloadTile(qa)}};Qa._loadTile=function(Aa){Aa.load();Aa.setPendingUpdate(na.TileUpdate.RENDERDATA);this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&
this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(Aa)};Qa._elevationDataArrived=function(Aa,Ca,qa){qa=new X.ElevationData(Aa.lij,Aa.extent,qa);Aa.dataArrived(Ca,U.LayerClass.ELEVATION,qa);qa=[Aa];Aa=Aa.level;const ya=this._iteratorPool.acquire();for(ya.reset(qa);!ya.done;){const Da=ya.next();Da.findElevationBoundsForLayer(Ca,Aa);Da.computeElevationBounds()}0===Aa&&this._updateRootTileElevationBounds();ya.remove();this._updateTilesVisibility(qa)};Qa._handleLayerViewChanges=function(Aa=
xa.noBudget){if(this._layerViewsDirty){var Ca=this._layerViewsDirty=!1,qa=new Set,ya=-1;for(const La of this.view.allLayerViews.items)if(qa.add(La.uid),fa.isSurfaceLayerView(La)||fa.isGroupLayerView(La))if(this._basemapLayerViewHandles.has(La.uid)&&!fa.isGroupLayerView(La)){var Da=this._layerClassFromLayerView(La);Da=this._getLayerIdxByUID(Da,La.uid);if(h.isSome(Da)){if(Da<ya||h.isNone(ya))Ca=!0;ya=Da}}else this._registerTiledLayerView(La),La.layer.loaded&&(Ca=!0);this._basemapLayerViewHandles.forEach((La,
Ta)=>{qa.has(Ta)||(this._unregisterTiledLayerView(Ta),Ca=!0)});Ca&&this._updateTiledLayers();this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._evaluateTransparency();Aa.madeProgress()}};Qa._allSurfaceLayersTransparent=function(){let Aa=0===this.view.map?.ground?.opacity;for(const Ca of this.view.allLayerViews.items)if(fa.isMapTileLayerView(Ca)&&!G.isBaseLayer(Ca.layer)&&0!==Ca.fullOpacity){Aa=!1;break}return Aa};Qa._hasCompositeBlendMode=function(){for(const Aa of this.view.allLayerViews.items)if((fa.isBlendableLayerView(Aa)||
fa.isGroupLayerView(Aa))&&za.isCompositeBlendMode(za.blendModeFromString[Aa.layer.blendMode]))return!0;return!1};Qa._layerClassFromLayerView=function(Aa){return fa.isElevationLayerView(Aa)?U.LayerClass.ELEVATION:U.LayerClass.MAP};Qa._registerTiledLayerView=function(Aa){const Ca=[];(fa.isBlendableLayerView(Aa)||fa.isGroupLayerView(Aa))&&Ca.push(k.watch(()=>Aa.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(T.TextureUpdate.UNFADED)}));if(!fa.isGroupLayerView(Aa)){var qa=
this._layerClassFromLayerView(Aa);Ca.push(k.watch(()=>Aa.suspended,()=>this._updateTiledLayers()));Ca.push(k.watch(()=>Aa.fullOpacity,()=>this._updateTileTextures(T.TextureUpdate.UNFADED)));Ca.push(k.watch(()=>"effectiveScaleRange"in Aa.layer?Aa.layer.effectiveScaleRange:null,()=>this._restartAllAgents(qa)));Aa.on("data-changed",()=>{const ya=this._getLayerIdxByUID(qa,Aa.uid);h.isSome(ya)&&this._invalidateLayerData(ya,qa)});this._basemapLayerViewHandles.set(Aa.uid,Ca)}};Qa._unregisterTiledLayerView=
function(Aa){const Ca=this._basemapLayerViewHandles.get(Aa);if(Ca){for(let qa=0;qa<Ca.length;qa++)Ca[qa].remove();this._basemapLayerViewHandles.delete(Aa)}};Qa._updateTiledLayers=function(){if(this.tilingScheme&&!this.view.suspended){var Aa=[[],[]],Ca=null;this.view.allLayerViews.forEach(ya=>{if(ya.layer&&!ya.suspended&&fa.isSurfaceLayerView(ya)&&ya.fullExtent){var Da=this._layerClassFromLayerView(ya);if(Da===U.LayerClass.MAP){const La=ya.displayLevelRange.maxLevel;Infinity!==La&&(null===Ca||La>Ca)&&
(Ca=La)}Aa[Da].push(ya)}});for(const ya of U.LayerClasses){var qa=this._layerViews[ya];const Da=Aa[ya];Da.reverse();const La=Da.length;let Ta=qa.length!==La;const Xa=Array(La),db=Array(qa.length);this._layerIndexByUid[ya].clear();for(let fb=0;fb<La;fb++){this._layerIndexByUid[ya].set(Da[fb].uid,fb);const jb=qa.indexOf(Da[fb]);Xa[fb]=jb;fb!==jb&&(Ta=!0);-1<jb&&(db[jb]=fb)}if(Ta){qa=this._postorderIterator;for(qa.reset(this._rootTiles);!qa.done;)qa.next().modifyLayers(db,Xa,ya);this._layerViews[ya]=
Da;this._restartAllAgents(ya);this._updateTilesVisibility(this._rootTiles)}}this.tilingScheme.ensureMaxLod(Ca)&&this._viewChangeUpdate()}};Qa._restartAllAgents=function(Aa){const Ca=this._postorderIterator;for(Ca.reset(this._rootTiles);!Ca.done;){const qa=Ca.next();qa.restartAgents(Aa);Aa===U.LayerClass.ELEVATION&&qa.computeElevationBounds()}this._updateRootTileElevationBounds()};Qa.layerViewByIndex=function(Aa,Ca){return this._layerViews[Ca][Aa]};Qa.numLayers=function(Aa){return this._layerViews[Aa].length};
Qa._updateTileTextures=function(Aa){this._allTiles.forAll(Ca=>{Ca.updateAgents(U.LayerClass.MAP);Aa===T.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(Ca,na.TileUpdate.TEXTURE_NOFADING):Ca.updateRenderData(U.LayerClass.MAP,Aa)});this._evaluateTransparency()};Qa._invalidateLayerData=function(Aa,Ca){this._allTiles.forAll(qa=>qa.removeLayerAgent(Aa,Ca));this._allTiles.forAll(qa=>qa.invalidateLayerData(Aa,Ca))};Qa.setTileTreeDirty=function(){this._allTilesDirty=!0};Qa.requestRender=function(Aa=
ua.RenderRequestType.UPDATE){this.renderer.setNeedsRender(Aa)};Qa.requestUpdate=function(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)};Qa.requestTileData=function(Aa,Ca,qa,ya){const Da=this.layerViewByIndex(Ca,qa);Ca=Da.layer;if(!Ca.tilemapCache||fa.isVectorTileLayerView(Da))return this._requestTileData(Aa,qa,Da,ya);++this._asyncWorkItems;return Ca.tilemapCache.fetchAvailability(Aa.lij[0],Aa.lij[1],Aa.lij[2],{...ya,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(La=>{--this._asyncWorkItems;
q.throwIfAborted(ya);q.isAbortError(La)||this._dataMissing(Aa,qa,Da,{notInTilemap:!0});throw La;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(Aa,qa,Da,ya),ya.signal))};Qa._requestTileData=function(Aa,Ca,qa,ya){return Ca===U.LayerClass.ELEVATION?fa.isElevationLayerView(qa)?this._requestElevationTileData(Aa,qa,ya):Promise.reject():fa.isMapTileLayerView(qa)?this._requestMapTileData(Aa,qa,ya):Promise.reject()};Qa._requestElevationTileData=function(Aa,Ca,qa){++this._asyncWorkItems;const ya=
Ta=>{if(!q.isAborted(qa)){var Xa=this._layerIndexByUid[U.LayerClass.ELEVATION].get(Ca.uid);null==Xa?e.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer %d %s",U.LayerClass.ELEVATION,Aa.lij.toString()):(this._usedMemory=null,this.requestUpdate(),this._elevationDataArrived(Aa,Xa,Ta))}},Da=Ta=>{q.isAbortError(Ta)||(this._dataMissing(Aa,U.LayerClass.ELEVATION,Ca,Ta),this.requestUpdate())};if(fa.useFetchTileForLayer(Ca.layer))return Ca.layer.fetchTile(Aa.lij[0],Aa.lij[1],
Aa.lij[2],{noDataValue:ia.ELEVATION_NODATA_VALUE,signal:qa.signal}).then(Ta=>{if(q.isAborted(qa))e.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");else return this._frameTask.schedule(()=>ya(Ta),qa.signal,Da)},Da).finally(()=>{--this._asyncWorkItems});const La=Ca.getTileUrl(Aa.lij[0],Aa.lij[1],Aa.lij[2]);return this._elevationDataRequester.request(La,"binary",qa).then(Ta=>this._lercDecoder.decode(Ta,
{noDataValue:ia.ELEVATION_NODATA_VALUE},qa.signal)).then(Ta=>{Ta?ya(new I.ElevationTileData(Ta)):Da(Error("LERC decoding failed"))},Da).finally(()=>{--this._asyncWorkItems})};Qa._requestMapTileData=function(Aa,Ca,qa){++this._asyncWorkItems;const ya=(db,fb)=>{--this._asyncWorkItems;fa.releaseTileData(fb);q.isAborted(qa)||(this._dataMissing(Aa,U.LayerClass.MAP,Ca,db),this.requestUpdate())},Da=db=>fb=>ya(fb,db),La=db=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();q.isAborted(qa)?
fa.releaseTileData(db):this._mapTileDataArrived(Aa,Ca,db)},qa.signal,Da(db)).catch(Da(db)),Ta=(db,fb=null)=>this._frameTask.schedule(()=>ya(db,fb));if(fa.isVectorTileLayerView(Ca)){var Xa=Ca.schemaHelper.getLevelRowColumn(Aa.lij);return Ca.fetchTile(Xa[0],Xa[1],Xa[2],qa).then(La,Ta)}if(fa.isImageryTileLayerView(Ca))return Ca.fetchTile(Aa.lij[0],Aa.lij[1],Aa.lij[2],qa).then(La,Ta);if(fa.isTileLayerView(Ca)&&fa.useFetchTileForLayer(Ca.layer))return Ca.layer.fetchTile(Aa.lij[0],Aa.lij[1],Aa.lij[2],qa).then(db=>
{q.isAborted(qa)?(e.getLogger(this.declaredClass).warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),Ta(q.createAbortError())):La(db)},Ta);Xa=Ca.getTileUrl(Aa.lij[0],Aa.lij[1],Aa.lij[2]);N.isRefreshableLayer(Ca.layer)&&Ca.layer.refreshTimestamp&&(Xa+=`${Xa.includes("?")?"\x26":"?"}_ts=${Ca.layer.refreshTimestamp}`);return this._mapDataRequester.request(Xa,Ca.hasMixedImageFormats?"image+type":"image",qa).then(La,
Ta)};Qa._mapTileDataArrived=function(Aa,Ca,qa){Ca=this._getLayerIdxByUID(U.LayerClass.MAP,Ca.uid);h.isSome(Ca)?Aa.dataArrived(Ca,U.LayerClass.MAP,qa):(fa.releaseTileData(qa),e.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer"))};Qa._getLayerIdxByUID=function(Aa,Ca){return this._layerIndexByUid[Aa].get(Ca)};Qa._dataMissing=function(Aa,Ca,qa,ya){qa=this._getLayerIdxByUID(Ca,qa.uid);h.isSome(qa)?Aa.dataMissing(qa,Ca,ya):e.getLogger(this.declaredClass).warn("TerrainSurface: received data from unknown layer")};
Qa.updateTileOverlayParams=function(Aa){this._rootTiles&&this.overlayManager&&(this._allTiles.forAll(Ca=>{Ca.renderData&&this.overlayManager.setTileParameters(Ca)}),this._renderer.setNeedsRender(Aa))};Qa.getUsedMemory=function(){if(!this.tilingScheme)return 0;h.isNone(this._usedMemory)&&(this._usedMemory=this._recalculateUsedMemory());return h.isSome(this._usedMemory)?this._usedMemory:0};Qa._recalculateUsedMemory=function(){return this.tilingScheme?this._allTiles.reduce((Aa,Ca)=>Aa+Ca.usedMemory,
0):null};Qa.getUsedMemoryForLayerView=function(Aa){let Ca=0;const qa=this._layerClassFromLayerView(Aa),ya=this._getLayerIdxByUID(qa,Aa.uid);h.isSome(ya)&&this._allTiles.forAll(Da=>Ca+=Da.getUsedMemoryForLayer(qa,ya));return Ca};Qa.getTile=function(Aa){if(h.isNone(Aa)||h.isNone(this._rootTiles))return null;const Ca=Aa.split("/").map(La=>+La);if(0===Ca[0])return this._rootTiles.find(La=>La.lij[1]===Ca[1]&&La.lij[2]===Ca[2]);Aa=2**Ca[0];const qa=Math.floor(Ca[1]/Aa),ya=Math.floor(Ca[2]/Aa);let Da;this._rootTiles.some(La=>
La.lij[1]===qa&&La.lij[2]===ya?(Da=La,!0):!1);if(Da){for(Aa=1<<Ca[0]-1;Da.lij[0]<Ca[0];){let La=Ca[1]&Aa?2:0;0<(Ca[2]&Aa)&&La++;if(!Da.children[La])return null;Da=Da.children[La];Aa>>=1}fa.weakAssert(Da.lij[0]===Ca[0]&&Da.lij[1]===Ca[1]&&Da.lij[2]===Ca[2],"not the right tile?");return Da}return null};Qa.checkAllTilesWaterproofness=function(){if(fa.ENABLE_WATERPROOFNESS_TESTS){var Aa=this._rootTiles;if(!h.isNone(Aa)){var Ca=Da=>0<Da?.renderData?.geometryInfo?.indices?.length,qa=Da=>{if(Da.intersectsClippingArea)if(Da.renderData&&
!Da.renderData.geometryState&&console.error("Tile[",Da.lij,"] has renderData but not geometryState"),Da.renderData&&!Da.renderData.geometryInfo&&console.error("Tile[",Da.lij,"] has renderData but not geometryInfo"),!Da.renderData?.geometryInfo||0<(Da.renderData.geometryInfo.indices?.length??0)||console.error("Tile[",Da.lij,"] has renderData but no indices - geometryInfo: ",Da.renderData.geometryInfo),Ca(Da)){Da.checkGeometryWaterproofness();for(const Xa of Da.children){var La=Xa,Ta=Da;Ca(La)&&console.error("Tile[",
La.lij,"] has geometry although parent[",Ta.lij,"] has geom")}}else if(Da.isLeaf)console.error("Tile[",Da.lij,"] has no geometry and no children, from root to leaf");else for(La of Da.children)qa(La)},ya=Da=>{const La=Da.parent?.visible??!0,Ta=Da.visible;Da.computeVisibility();const Xa=Da.visible;Ta!==Xa&&La&&console.error(" Tile[",Da.lij,"] has out of date visibility: ",Ta," instead of ",Xa);if(!Da.isLeaf)for(const db of Da.children)ya(db)};for(const Da of Aa)qa(Da),ya(Da)}}};Qa._updateShadingIfChanged=
function(){this.view?.map?.ground?.shading!==this._shading&&this._updateShading()};Qa._updateShading=function(){const Aa=this.view?.map?.ground?.shading;this._shading=Aa;this.renderer&&(this.renderer.shading=Aa,this.renderer.setNeedsRender());this._updateAllTileGeometries()};Qa.isEastEndWrap=function(Aa){return this.isGlobal&&Aa[2]===this.lijEastEnd(Aa[0])-1};Qa.isWestEndWrap=function(Aa){return this.isGlobal&&0===Aa[2]};Qa.lijEastEnd=function(Aa){const Ca=h.isSome(this.spatialReference)&&this.spatialReference.isGeographic;
return 2**(Aa+(Ca?1:0))};Qa.wrapEastWest=function(Aa){const Ca=this.lijEastEnd(Aa[0]),qa=Aa[2];return 0<=qa&&qa<Ca?Aa:this.isGlobal?[Aa[0],Aa[1],(qa+(0>qa?Ca:0))%Ca]:null};Qa.enableInternalChecks=function(Aa){fa.enableTerrainInternalChecks(Aa)};Qa.enableWaterproofnessChecks=function(Aa){fa.enableTerrainWaterproofnessChecks(Aa)};c._createClass(bb,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",get:function(){if(this.lodSnapping===
T.LODSnapping.ON){var Aa=this.view,Ca=this.tilingScheme;const qa=Aa.pointsOfInterest?.cameraOnSurface?.scale;if(qa&&Ca){const ya=Aa.state.contentCamera;Aa=O.directionToHeadingTilt(Aa,ya.eye,ya.viewForward,ya.up).tilt;90<Aa&&(Aa=180-Aa);Aa=2*(Aa/90)**2;Ca=Ca.levelAtScale(qa);return Math.round(Ca-Aa)}}return null}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?T.LODSnapping.ON:T.LODSnapping.OFF}},{key:"upsampleInfoPool",get:function(){return this._upsampleInfoPool}},
{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",get:function(){return this._elevationQueryCache}},{key:"mapTileRequester",get:function(){return this._mapDataRequester}},{key:"_userClippingExtent",get:function(){var {spatialReference:Aa}=this,{clippingArea:Ca}=this.view;if(h.isNone(Ca)||h.isNone(Aa))return null;const qa=K.create();Aa=R.toBoundingRect(Ca,qa,Aa)?qa:null;Ca=this._get("extent");return K.equals(Aa,Ca)?Ca:Aa}},{key:"rootTilesExtent",get:function(){return this._rootTilesExtent}},
{key:"extent",get:function(){const Aa=K.intersection(this.groundExtent,this._userClippingExtent,K.create()),Ca=this._get("extent");return K.equals(Aa,Ca)?Ca:Aa}},{key:"groundExtent",get:function(){return h.isSome(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}},{key:"_tilingSchemeExtent",get:function(){return this.tilingSchemeLogic?.extent}},{key:"updating",get:function(){this._hasPendingUpdates||(this._maxNumUpdating=1);return!!((this.running||this._watchUpdatingTracking.updating||
0<this._asyncWorkItems)&&this.ready&&!this.suspended||this.overlayManager.updating)}},{key:"running",get:function(){return(this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||!this._allTilesSorted||this._layerViewsDirty||this._scaleRangeQueries.updating||this._frameTask.updating)&&this.ready&&!this.suspended}},{key:"updatingProgressValue",get:function(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-this._pendingUpdates/this._maxNumUpdating}},{key:"baseOpacity",
get:function(){return this.view.map.ground.opacity},set:function(Aa){this.view.map.ground.opacity=Aa}},{key:"viewingMode",get:function(){return this.view.state.viewingMode}},{key:"ready",get:function(){return h.isSome(this._rootTiles)}},{key:"renderOrder",set:function(Aa){this._renderer.renderOrder=Aa;this._set("renderOrder",Aa)}},{key:"rootTiles",get:function(){return this._rootTiles}},{key:"spatialReference",get:function(){return this.tilingScheme?.spatialReference??null}},{key:"backgroundColor",
get:function(){return this.view.map.ground.surfaceColor},set:function(Aa){this.view.map.ground.surfaceColor=Aa}},{key:"slicePlaneEnabled",set:function(Aa){this._renderer.slicePlaneEnabled=Aa;this._set("slicePlaneEnabled",Aa);this._evaluateTransparency()}},{key:"tilingSchemeLocked",get:function(){return this.tilingSchemeLogic?.tilingSchemeLocked??!1}},{key:"velvetOverground",set:function(Aa){this._renderer.velvetOverground=Aa;this._set("velvetOverground",Aa)}},{key:"wireframe",get:function(){return this._renderer.wireframe},
set:function(Aa){Aa!==this._renderer.wireframe&&(this._renderer.wireframe=Aa,this._updateAllTileGeometries())}},{key:"_visible",set:function(Aa){Aa!==this._visibleCached&&(this._visibleCached=Aa,this._renderer.setVisibility(Aa),this.suspended=!Aa)}},{key:"opaque",get:function(){return this._renderer.transparency===Z.TransparencyMode.Opaque}},{key:"suspended",set:function(Aa){this._set("suspended",Aa);this._viewChangeUpdate()}},{key:"textureFadeDuration",get:function(){return this.view.qualitySettings.tiledSurface.textureFadeDuration??
0}},{key:"updatingRootTiles",get:function(){return this._updatingRootTiles}},{key:"_lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*ia.MAX_MEMORY_LOD_BIAS}},{key:"shortBatches",get:function(){return this.view.state.mode!==oa.RenderState.IDLE}},{key:"performanceInfo",get:function(){const Aa=this._performanceInfo;Aa.numNodes=this._allTiles.length;Aa.numLeaves=Aa.numVisible=Aa.numRendered=Aa.numLoadedPerLevel.length=
Aa.numRenderedPerLevel.length=0;this._allTiles.forAll(Ca=>{Ca.isLeaf&&Aa.numLeaves++;const qa=Ca.level;Ca.renderData&&(Aa.numLoadedPerLevel[qa]=(Aa.numLoadedPerLevel[qa]||0)+1);Ca.visible&&(Aa.numVisible++,Ca.rendered&&(Aa.numRenderedPerLevel[qa]=(Aa.numRenderedPerLevel[qa]||0)+1,Aa.numRendered++))});return Aa}},{key:"renderPatchBorders",get:function(){return this._renderer.renderPatchBorders},set:function(Aa){this._renderer.renderPatchBorders=Aa}},{key:"visualizeNormals",get:function(){return this._renderer.visualizeNormals},
set:function(Aa){this._renderer.visualizeNormals=Aa}},{key:"renderingDisabled",get:function(){return this._renderer.renderingDisabled},set:function(Aa){this._renderer.renderingDisabled=Aa}},{key:"test",get:function(){const Aa=this;return{renderer:Aa._renderer,lercDecoder:Aa._lercDecoder,forceReload:()=>{h.isSome(Aa._rootTiles)&&0<Aa._rootTiles.length&&(Aa._mergeTile(Aa._rootTiles[0]),Aa._viewChangeUpdate())},getTiles:()=>Aa._allTiles.toArray(),getRenderedTiles(){Ua.clear();Aa._allTiles.forAll(qa=>
{qa.visible&&qa.rendered&&Ua.push(qa)});const Ca=Ua.toArray();pa.sortTiles(Aa.renderOrder,Ca);return Ca},lockTilingScheme(Ca,qa){Aa._extentHelper.defaultTiledLayersExtent=qa;Aa.tilingSchemeLogic.test.lockTilingScheme(Ca)}}}},{key:"isGlobal",get:function(){return this._isGlobal}},{key:"shading",get:function(){return this._shading}},{key:"isWebMercator",get:function(){return this._isWebMercator}},{key:"isWebMercatorOnPlateeCarree",get:function(){return this._isWebMercatorOnPlateeCarree}}]);return bb}(d.EventedMixin(n));
b.__decorate([p.property()],n.prototype,"_renderer",void 0);b.__decorate([p.property({constructOnly:!0})],n.prototype,"_scaleRangeQueries",void 0);b.__decorate([p.property()],n.prototype,"_hasPendingUpdates",void 0);b.__decorate([p.property()],n.prototype,"_asyncWorkItems",void 0);b.__decorate([p.property()],n.prototype,"_allTilesDirty",void 0);b.__decorate([p.property()],n.prototype,"_allTilesSorted",void 0);b.__decorate([p.property()],n.prototype,"_viewChanged",void 0);b.__decorate([p.property({readOnly:!0})],
n.prototype,"_watchUpdatingTracking",void 0);b.__decorate([p.property()],n.prototype,"_frameTask",void 0);b.__decorate([p.property({readOnly:!0})],n.prototype,"snapLevel",null);b.__decorate([p.property({readOnly:!0})],n.prototype,"lodSnapping",null);b.__decorate([p.property({constructOnly:!0})],n.prototype,"view",void 0);b.__decorate([p.property()],n.prototype,"_userClippingExtent",null);b.__decorate([p.property()],n.prototype,"_rootTilesExtent",void 0);b.__decorate([p.property({readOnly:!0})],n.prototype,
"extent",null);b.__decorate([p.property({readOnly:!0})],n.prototype,"groundExtent",null);b.__decorate([p.property({readOnly:!0})],n.prototype,"_tilingSchemeExtent",null);b.__decorate([p.property({readOnly:!0})],n.prototype,"updating",null);b.__decorate([p.property({readOnly:!0})],n.prototype,"running",null);b.__decorate([p.property(V.updatingProgress)],n.prototype,"updatingProgress",void 0);b.__decorate([p.property({readOnly:!0})],n.prototype,"updatingProgressValue",null);b.__decorate([p.property()],
n.prototype,"_maxNumUpdating",void 0);b.__decorate([p.property()],n.prototype,"baseOpacity",null);b.__decorate([p.property()],n.prototype,"hasCompositeBlendMode",void 0);b.__decorate([p.property({readOnly:!0})],n.prototype,"overlayManager",void 0);b.__decorate([p.property({readOnly:!0})],n.prototype,"viewingMode",null);b.__decorate([p.property()],n.prototype,"maxTextureScale",void 0);b.__decorate([p.property({readOnly:!0})],n.prototype,"ready",null);b.__decorate([p.property({value:da.RenderOrder.FRONT_TO_BACK})],
n.prototype,"renderOrder",null);b.__decorate([p.property({readOnly:!0})],n.prototype,"rootTiles",null);b.__decorate([p.property()],n.prototype,"_rootTiles",void 0);b.__decorate([p.property({readOnly:!0})],n.prototype,"spatialReference",null);b.__decorate([p.property({type:t})],n.prototype,"backgroundColor",null);b.__decorate([p.property({value:!1})],n.prototype,"slicePlaneEnabled",null);b.__decorate([p.property({readOnly:!0})],n.prototype,"tilingScheme",void 0);b.__decorate([p.property({readOnly:!0})],
n.prototype,"tilingSchemeLocked",null);b.__decorate([p.property({readOnly:!0})],n.prototype,"tilingSchemeLogic",void 0);b.__decorate([p.property({value:!0})],n.prototype,"velvetOverground",null);b.__decorate([p.property()],n.prototype,"wireframe",null);b.__decorate([p.property({value:!1})],n.prototype,"suspended",null);b.__decorate([p.property()],n.prototype,"textureFadeDuration",null);b.__decorate([p.property()],n.prototype,"visibleElevationBounds",void 0);b.__decorate([p.property()],n.prototype,
"rootTileElevationBounds",void 0);b.__decorate([p.property()],n.prototype,"_layerViewsDirty",void 0);b.__decorate([p.property()],n.prototype,"renderPatchBorders",null);b.__decorate([p.property()],n.prototype,"visualizeNormals",null);b.__decorate([p.property()],n.prototype,"renderingDisabled",null);b=n=b.__decorate([C.subclass("esri.views.3d.terrain.TerrainSurface")],n);const Oa=y.create(),Ja=K.create(),Sa=[0,0,0],Ua=new v,Za={spatialReference:null,extent:K.create(),context:"ground"},ma={spatialReference:null,
extent:null,scale:0};return b})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],function(a){let c=function(){function b(n){this._store=n}var t=b.prototype;t.destroy=function(){this._store.destroy()};t.get=function(n){return this._store.get(n)};t.put=function(n,r){this._store.put(n,r,r.values.byteLength+256)};return b}();a.ElevationQueryTileCache=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ElevationTileData":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../../core/maybe"],function(a,c,b){let t=function(){function n(r,m,d,f){this._maxValue=this._minValue=this._hasNoDataValues=null;"pixelData"in r?(this.values=r.pixelData,this.width=r.width,this.height=r.height,this.noDataValue=r.noDataValue):(this.values=r,this.width=m,this.height=d,this.noDataValue=f)}n.prototype._ensureBounds=function(){if(!b.isSome(this._minValue)){var {noDataValue:r,values:m}=this,d=Infinity,f=-Infinity,e=!0;for(const g of m)g===r?this._hasNoDataValues=
!0:(d=g<d?g:d,f=g>f?g:f,e=!1);e?this._maxValue=this._minValue=0:(this._minValue=d,this._maxValue=-3E38<f?f:0)}};c._createClass(n,[{key:"hasNoDataValues",get:function(){b.isNone(this._hasNoDataValues)&&(this._hasNoDataValues=this.values.includes(this.noDataValue));return this._hasNoDataValues}},{key:"minValue",get:function(){this._ensureBounds();return b.unwrap(this._minValue)}},{key:"maxValue",get:function(){this._ensureBounds();return b.unwrap(this._maxValue)}}]);return n}();a.ElevationTileData=
t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/workers/WorkerHandle"],function(a,c,b,t){let n=function(m){function d(e=null){var g=m.call(this,"LercWorker","_decode",{_decode:h=>[h.buffer]},e,{strategy:"dedicated"})||this;g.schedule=e;g.ref=0;return g}c._inheritsLoose(d,m);var f=d.prototype;f.decode=function(e,g,h){return e&&0!==e.byteLength?this.invoke({buffer:e,
options:g},h):Promise.resolve(null)};f.release=function(){0>=--this.ref&&(r.forEach((e,g)=>{e===this&&r.delete(g)}),this.destroy())};return d}(t.WorkerHandle);const r=new Map;a.acquireDecoder=function(m=null){let d=r.get(b.unwrap(m));d||(b.isSome(m)?(d=new n(f=>m.immediate.schedule(f)),r.set(m,d)):(d=new n,r.set(null,d)));++d.ref;return d};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../arrayUtils ../handleUtils ../Logger ../maybe ../promiseUtils ./workers".split(" "),
function(a,c,b,t,n,r,m,d){let f=function(){function e(h,l,v,q,k={}){this._mainMethod=l;this._transferLists=v;this._listeners=[];this._promise=d.open(h,{...k,schedule:q}).then(p=>{if(void 0===this._thread){this._thread=p;this._promise=null;k.hasInitialize&&this.broadcast({},"initialize");for(const z of this._listeners)this._connectListener(z)}else p.close()});this._promise.catch(p=>n.getLogger("esri.core.workers.WorkerHandle").error(`Failed to initialize ${h} worker: ${p}`))}var g=e.prototype;g.on=
function(h,l){const v={removed:!1,eventName:h,callback:l,threadHandle:null};this._listeners.push(v);this._connectListener(v);return t.makeHandle(()=>{v.removed=!0;b.remove(this._listeners,v);this._thread&&r.isSome(v.threadHandle)&&v.threadHandle.remove()})};g.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null};g.invoke=function(h,l){return this.invokeMethod(this._mainMethod,h,l)};g.invokeMethod=function(h,l,v){if(this._thread){var q=this._transferLists[h];
q=q?q(l):[];return this._thread.invoke(h,l,{transferList:q,signal:v})}return this._promise?this._promise.then(()=>{m.throwIfAborted(v);return this.invokeMethod(h,l,v)}):Promise.reject(null)};g.broadcast=function(h,l){return this._thread?Promise.all(this._thread.broadcast(l,h)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(h,l)):Promise.reject()};g._connectListener=function(h){this._thread&&this._thread.on(h.eventName,h.callback).then(l=>{h.removed||(h.threadHandle=l)})};c._createClass(e,
[{key:"promise",get:function(){return this._promise}}]);return e}();a.WorkerHandle=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(a,c,b,t,n,r,m,d,f){f=function(g){function h(v,q,k,p,z,C,B,A=null){q=
g.call(this,v,q,k,p,z,C,4096,4096)||this;q._memCache=A;q.type="vector-tile";q._referenced=0;q._hasSymbolBuckets=!1;q._memoryUsedByLayerData=0;q.layerData=new Map;q.layerCount=0;q.status="loading";q.allSymbolsFadingOut=!1;q.lastOpacityUpdate=0;q.symbols=new Map;q.isCoverage=!1;q.neededForCoverage=!1;q.decluttered=!1;q.invalidating=!1;q.parentTile=null;q.childrenTiles=new Set;q._processed=!1;q._referenced=1;q.styleRepository=B;q.id=v.id;return q}c._inheritsLoose(h,g);var l=h.prototype;l.setData=function(v){this.changeDataImpl(v);
this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};l.deleteLayerData=function(v){let q=!1;for(const k of v)this.layerData.has(k)&&(v=this.layerData.get(k),this._memoryUsedByLayerData-=v.memoryUsed,v.type===r.BucketType.SYMBOL&&this.symbols.has(k)&&(this.symbols.delete(k),q=!0),v.destroy(),this.layerData.delete(k),this.layerCount--);b.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData);q&&this.emit("symbols-changed");this.requestRender()};
l.processed=function(){return this._processed};l.hasData=function(){return 0<this.layerCount};l.dispose=function(){"unloaded"!==this.status&&(e.delete(this),h._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};l.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};l.retain=function(){++this._referenced};l.changeDataImpl=function(v){let q=!1;if(v){const {bucketsWithData:k,
emptyBuckets:p}=v;v=this._createRenderBuckets(k);if(p&&0<p.byteLength){const z=new Uint32Array(p);for(const C of z)this._deleteLayerData(C)}for(const [z,C]of v)this._deleteLayerData(z),C.type===r.BucketType.SYMBOL&&(this.symbols.set(z,C.symbols),q=!0),this._memoryUsedByLayerData+=C.memoryUsed,this.layerData.set(z,C),this.layerCount++;b.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const [,k]of this.layerData)k.type===
r.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);q&&this.emit("symbols-changed")};l.attachWithContext=function(v){this.stage={context:v,trashDisplayObject(q){q.processDetach()},untrashDisplayObject(){return!1}}};l.setTransform=function(v){g.prototype.setTransform.call(this,v);var q=this.resolution/(v.resolution*v.pixelRatio);const k=this.width/this.rangeX*q;q*=this.height/this.rangeY;const p=[0,0];v.toScreen(p,[this.x,this.y]);const z=this.transforms.tileUnitsToPixels;t.identity(z);t.translate(z,
z,p);t.rotate(z,z,Math.PI*v.rotation/180);t.scale(z,z,[k,q,1])};l._createTransforms=function(){return{dvs:n.create(),tileMat3:n.create(),tileUnitsToPixels:n.create()}};h._destroyRenderBuckets=function(v){if(v){var q=new Set;v.forEach(k=>{q.has(k)||(k.destroy(),q.add(k))});v.clear()}};l._createRenderBuckets=function(v){const q=new Map,k=new Map;for(const p of v){v=this._deserializeBucket(p,k);for(const z of v.layerUIDs)q.set(z,v)}return q};l._deserializeBucket=function(v,q){let k=q.get(v);if(k)return k;
switch((new Uint32Array(v))[0]){case r.BucketType.FILL:k=new m.FillRenderBucket(v,this.styleRepository);break;case r.BucketType.LINE:k=new m.LineRenderBucket(v,this.styleRepository);break;case r.BucketType.SYMBOL:k=new m.SymbolRenderBucket(v,this.styleRepository,this);break;case r.BucketType.CIRCLE:k=new m.CircleRenderBucket(v,this.styleRepository)}q.set(v,k);return k};l._deleteLayerData=function(v){if(this.layerData.has(v)){var q=this.layerData.get(v);this._memoryUsedByLayerData-=q.memoryUsed;q.destroy();
this.layerData.delete(v);this.layerCount--}};c._createClass(h,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<d.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<d.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||
"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+256)/(this._referenced||1)}}]);return h}(f.TiledDisplayObject);const e=new Map;a.VectorTile=f;a.printAllocations=function(){e.forEach((g,h)=>{console.log(`\n${h.key}:`);g[0].forEach(l=>console.log(l));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");g[1].forEach(l=>console.log(l))})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.BucketType=void 0;(function(c){c[c.FILL=1]="FILL";c[c.LINE=2]="LINE";c[c.SYMBOL=3]="SYMBOL";c[c.CIRCLE=4]="CIRCLE"})(a.BucketType||(a.BucketType={}));a.ShaderProgramType=void 0;(function(c){c[c.BACKGROUND=0]="BACKGROUND";c[c.FILL=1]="FILL";c[c.OUTLINE=2]="OUTLINE";c[c.LINE=3]="LINE";c[c.ICON=4]="ICON";c[c.CIRCLE=5]="CIRCLE";c[c.TEXT=6]="TEXT";c[c.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||(a.ShaderProgramType=
{}));a.StyleUpdateType=void 0;(function(c){c[c.PAINTER_CHANGED=0]="PAINTER_CHANGED";c[c.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";c[c.LAYER_CHANGED=2]="LAYER_CHANGED";c[c.LAYER_REMOVED=3]="LAYER_REMOVED";c[c.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(a,c,b,t,n,r,m,d){let f=function(){function v(k,p){this.layerUIDs=[];this.isDestroyed=!1;this._data=k;this.memoryUsed=k.byteLength;let z=1;k=new Uint32Array(k);this.layerUIDs=[];const C=k[z++];for(let B=0;B<C;B++)this.layerUIDs[B]=k[z++];this.bufferDataOffset=z;p&&(this.layer=p.getStyleLayerByUID(this.layerUIDs[0]))}var q=v.prototype;q.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};q.prepareForRendering=function(k){b.isNone(this._data)||(this.doPrepareForRendering(k,
this._data,this.bufferDataOffset),this._data=null)};c._createClass(v,[{key:"isPreparedForRendering",get:function(){return b.isNone(this._data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return v}(),e=function(v){function q(p,z){z=v.call(this,p,z)||this;z.type=t.BucketType.LINE;z.lineIndexStart=0;z.lineIndexCount=0;p=new Uint32Array(p);let C=z.bufferDataOffset;z.lineIndexStart=p[C++];z.lineIndexCount=p[C++];const B=p[C++];if(0<B){const A=new Map;for(let x=0;x<B;x++){const u=p[C++],
y=p[C++],w=p[C++];A.set(u,[y,w])}z.patternMap=A}z.bufferDataOffset=C;return z}c._inheritsLoose(q,v);var k=q.prototype;k.hasData=function(){return 0<this.lineIndexCount};k.triangleCount=function(){return this.lineIndexCount/3};k.doDestroy=function(){b.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();b.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();b.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=
null;this.memoryUsed=0};k.doPrepareForRendering=function(p,z,C){z=new Uint32Array(z);var B=new Int32Array(z.buffer);const A=z[C++];this.lineVertexBuffer=r.BufferObject.createVertex(p,m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*C,A));C+=A;B=z[C++];this.lineIndexBuffer=r.BufferObject.createIndex(p,m.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*C,B));C+=B;C=this.layer.lineMaterial;this.lineVertexArrayObject=new d.VertexArrayObject(p,C.getAttributeLocations(),C.getLayoutInfo(),{geometry:this.lineVertexBuffer},
this.lineIndexBuffer)};return q}(f),g=function(v){function q(p,z){z=v.call(this,p,z)||this;z.type=t.BucketType.FILL;z.fillIndexStart=0;z.fillIndexCount=0;z.outlineIndexStart=0;z.outlineIndexCount=0;p=new Uint32Array(p);let C=z.bufferDataOffset;z.fillIndexStart=p[C++];z.fillIndexCount=p[C++];z.outlineIndexStart=p[C++];z.outlineIndexCount=p[C++];const B=p[C++];if(0<B){const A=new Map;for(let x=0;x<B;x++){const u=p[C++],y=p[C++],w=p[C++];A.set(u,[y,w])}z.patternMap=A}z.bufferDataOffset=C;return z}c._inheritsLoose(q,
v);var k=q.prototype;k.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};k.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};k.doDestroy=function(){b.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();b.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();b.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;b.isSome(this.outlineVertexArrayObject)&&
this.outlineVertexArrayObject.dispose();b.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();b.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};k.doPrepareForRendering=function(p,z,C){z=new Uint32Array(z);var B=new Int32Array(z.buffer),A=z[C++];this.fillVertexBuffer=r.BufferObject.createVertex(p,m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*C,A));C+=A;A=z[C++];
this.fillIndexBuffer=r.BufferObject.createIndex(p,m.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*C,A));C+=A;A=z[C++];this.outlineVertexBuffer=r.BufferObject.createVertex(p,m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*C,A));C+=A;B=z[C++];this.outlineIndexBuffer=r.BufferObject.createIndex(p,m.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*C,B));C+=B;z=this.layer;C=z.fillMaterial;z=z.outlineMaterial;this.fillVertexArrayObject=new d.VertexArrayObject(p,C.getAttributeLocations(),C.getLayoutInfo(),{geometry:this.fillVertexBuffer},
this.fillIndexBuffer);this.outlineVertexArrayObject=new d.VertexArrayObject(p,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return q}(f),h=function(v){function q(p,z,C){z=v.call(this,p,z)||this;z.type=t.BucketType.SYMBOL;z.iconPerPageElementsMap=new Map;z.glyphPerPageElementsMap=new Map;z.symbolInstances=[];z.isIconSDF=!1;z.opacityChanged=!1;z.lastOpacityUpdate=0;z.symbols=[];const B=new Uint32Array(p),A=new Int32Array(p);p=new Float32Array(p);
let x=z.bufferDataOffset;z.isIconSDF=!!B[x++];var u=B[x++];for(var y=0;y<u;y++){var w=B[x++],D=B[x++],F=B[x++];z.iconPerPageElementsMap.set(w,[D,F])}u=B[x++];for(y=0;y<u;y++)w=B[x++],D=B[x++],F=B[x++],z.glyphPerPageElementsMap.set(w,[D,F]);u=B[x++];y=B[x++];z.iconOpacity=new Int32Array(u);z.textOpacity=new Int32Array(y);x=n.deserializeSymbols(B,A,p,x,z.symbols,C);z.bufferDataOffset=x;return z}c._inheritsLoose(q,v);var k=q.prototype;k.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<
this.glyphPerPageElementsMap.size};k.triangleCount=function(){let p=0;for(const [,z]of this.iconPerPageElementsMap)p+=z[1];for(const [,z]of this.glyphPerPageElementsMap)p+=z[1];return p/3};k.doDestroy=function(){b.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();b.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();b.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();b.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=
this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;b.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();b.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();b.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();b.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};k.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=
!1;var p=b.unwrap(this.iconOpacity),z=b.unwrap(this.iconOpacityBuffer);0<p.length&&p.byteLength===z.size&&z.setSubData(p,0,0,p.length);p=b.unwrap(this.textOpacity);z=b.unwrap(this.textOpacityBuffer);0<p.length&&p.byteLength===z.size&&z.setSubData(p,0,0,p.length)}};k.doPrepareForRendering=function(p,z,C){z=new Uint32Array(z);var B=new Int32Array(z.buffer),A=z[C++];this.iconVertexBuffer=r.BufferObject.createVertex(p,m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*C,A));C+=A;A=z[C++];this.iconIndexBuffer=
r.BufferObject.createIndex(p,m.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*C,A));C+=A;A=z[C++];this.textVertexBuffer=r.BufferObject.createVertex(p,m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*C,A));C+=A;B=z[C++];this.textIndexBuffer=r.BufferObject.createIndex(p,m.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*C,B));C+=B;this.iconOpacityBuffer=r.BufferObject.createVertex(p,m.Usage.STATIC_DRAW,b.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=r.BufferObject.createVertex(p,m.Usage.STATIC_DRAW,
b.unwrap(this.textOpacity).buffer);z=this.layer;C=z.iconMaterial;z=z.textMaterial;this.iconVertexArrayObject=new d.VertexArrayObject(p,C.getAttributeLocations(),C.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new d.VertexArrayObject(p,z.getAttributeLocations(),z.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return q}(f),l=function(v){function q(p,z){z=v.call(this,
p,z)||this;z.type=t.BucketType.CIRCLE;z.circleIndexStart=0;z.circleIndexCount=0;p=new Uint32Array(p);let C=z.bufferDataOffset;z.circleIndexStart=p[C++];z.circleIndexCount=p[C++];z.bufferDataOffset=C;return z}c._inheritsLoose(q,v);var k=q.prototype;k.hasData=function(){return 0<this.circleIndexCount};k.triangleCount=function(){return this.circleIndexCount/3};k.doDestroy=function(){b.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();b.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();
b.isSome(this.circleIndexBuffer)&&this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};k.doPrepareForRendering=function(p,z,C){z=new Uint32Array(z);var B=new Int32Array(z.buffer);const A=z[C++];this.circleVertexBuffer=r.BufferObject.createVertex(p,m.Usage.STATIC_DRAW,new Int32Array(B.buffer,4*C,A));C+=A;B=z[C++];this.circleIndexBuffer=r.BufferObject.createIndex(p,m.Usage.STATIC_DRAW,new Uint32Array(z.buffer,4*C,B));C+=
B;C=this.layer.circleMaterial;this.circleVertexArrayObject=new d.VertexArrayObject(p,C.getAttributeLocations(),C.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return q}(f);a.CircleRenderBucket=l;a.FillRenderBucket=g;a.LineRenderBucket=e;a.RenderBucketBase=f;a.SymbolRenderBucket=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"../enums","./core"],function(a,c,b,t){let n=function(){function r(d,f,e){this._rows=Math.ceil(f/e);this._columns=Math.ceil(d/e);this._cellSize=e;this.cells=Array(this._rows);for(d=0;d<this._rows;d++)for(this.cells[d]=Array(this._columns),f=0;f<this._columns;f++)this.cells[d][f]=[]}var m=r.prototype;m.getCell=function(d,f){f=Math.min(Math.max(Math.floor(f/this._cellSize),0),this._rows-1);d=Math.min(Math.max(Math.floor(d/this._cellSize),0),this._columns-1);return this.cells[f]&&this.cells[f][d]||null};
m.getCellSpan=function(d,f,e,g){return[Math.min(Math.max(Math.floor(d/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(f/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(e/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(g/this._cellSize),0),this.rows-1)]};c._createClass(r,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return r}();a.GridIndex=n;a.deserializeSymbols=
function(r,m,d,f,e,g){const h=m[f++];for(let q=0;q<h;q++){const k=new t.VTLSymbol(g);k.xTile=m[f++];k.yTile=m[f++];k.hash=m[f++];k.priority=m[f++];var l=m[f++];for(var v=0;v<l;v++){const p=m[f++],z=m[f++],C=m[f++],B=m[f++],A=!!m[f++],x=m[f++],u=d[f++],y=d[f++],w=m[f++],D=m[f++];k.colliders.push({xTile:p,yTile:z,dxPixels:C,dyPixels:B,hard:A,partIndex:x,width:w,height:D,minLod:u,maxLod:y})}l=r[f++];for(v=0;v<l;v++)k.textVertexRanges.push([r[f++],r[f++]]);l=r[f++];for(v=0;v<l;v++)k.iconVertexRanges.push([r[f++],
r[f++]]);e.push(k)}return f};a.tileCoordChange=function(r,m,d,f,e,g){d-=e;if(0<=d)return(m>>d)+(f-(g<<d))*(r>>d);d=-d;return m-(g-(f<<d))*(r>>d)<<d};a.writeOpacityToBuffers=function(r,m,d){for(const [q,k]of r.symbols){{var f=r,e=m,g=d,h=k;const p=f.layerData.get(q);if(p.type===b.BucketType.SYMBOL){for(const z of h){h=z.unique;var l=void 0;if(z.selectedForRendering){var v=h.parts[0];l=v.startOpacity;v=v.targetOpacity;f.allSymbolsFadingOut=f.allSymbolsFadingOut&&0===v;l=g?Math.floor(127*l)|v<<7:v?255:
0;l|=l<<24|l<<16|l<<8}else l=0;for(const [C,B]of z.iconVertexRanges)for(v=C;v<C+B;v+=4)p.iconOpacity[v/4]=l;z.selectedForRendering?(l=h.parts[1],h=l.startOpacity,l=l.targetOpacity,f.allSymbolsFadingOut=f.allSymbolsFadingOut&&0===l,h=g?Math.floor(127*h)|l<<7:l?255:0,l=h<<24|h<<16|h<<8|h):l=0;for(const [C,B]of z.textVertexRanges)for(h=C;h<C+B;h+=4)p.textOpacity[h/4]=l}p.lastOpacityUpdate=e;p.opacityChanged=!0}}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],
function(a){a.VTLSymbol=function(c){this.hash=this.yTile=this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=c};a.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=
32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(a,c,b,t,n){t=function(r){function m(f,e,g,h,l,v,q=l,k=v){var p=r.call(this)||this;p.triangleCountReportedInDebug=0;p.triangleCount=0;p.texture=null;p.key=new n(f);p.resolution=
e;p.x=g;p.y=h;p.width=l;p.height=v;p.rangeX=q;p.rangeY=k;return p}c._inheritsLoose(m,r);var d=m.prototype;d.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};d.setTransform=function(f){const e=this.resolution/(f.resolution*f.pixelRatio),g=this.transforms.tileMat3,[h,l]=f.toScreenNoRotation([0,0],[this.x,this.y]);b.set(g,this.width/this.rangeX*e,0,0,0,this.height/this.rangeY*e,0,h,l,1);b.multiply(this.transforms.dvs,f.displayViewMat3,g)};return m}(t.DisplayObject);a.TiledDisplayObject=
t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/DisplayObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/has ../../../core/maybe ../../../core/promiseUtils".split(" "),function(a,c,b,t,n,r){const m=1/t("mapview-transitions-duration");b=function(d){function f(){var g=d.apply(this,arguments)||this;g._fadeOutResolver=null;g._fadeInResolver=null;g._clips=null;g.computedVisible=!0;g.computedOpacity=1;
g.fadeTransitionEnabled=!1;g.inFadeTransition=!1;g._isReady=!1;g._opacity=1;g.parent=null;g._stage=null;g._visible=!0;return g}c._inheritsLoose(f,d);var e=f.prototype;e._getTransforms=function(){n.isNone(this._transforms)&&(this._transforms=this._createTransforms());return this._transforms};e.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.opacity=1;this.computedOpacity=0;this.fadeTransitionEnabled=
!0;this._fadeInResolver=r.createResolver();this.requestRender();return this._fadeInResolver.promise};e.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this.opacity=0;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=r.createResolver();this.requestRender();return this._fadeOutResolver.promise};e.endTransitions=function(){this._fadeInResolver?.();this._fadeInResolver=null;this._fadeOutResolver?.();
this._fadeOutResolver=null;this.computedOpacity=this.visible?this.opacity:0;this.requestRender()};e.beforeRender=function(g){this.updateTransitionProperties(g.deltaTime,g.state.scale)};e.afterRender=function(g){this._fadeInResolver&&this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};e.remove=function(){this.parent?.removeChild(this)};e.setTransform=function(g){};
e.processRender=function(g){this.stage&&this.computedVisible&&this.doRender(g)};e.requestRender=function(){this.stage&&this.stage.requestRender()};e.processDetach=function(){this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.onDetach();this.emit("detach")};e.updateTransitionProperties=function(g,h){if(this.fadeTransitionEnabled){h=this._fadeOutResolver||!this.visible?0:this.opacity;const l=this.computedOpacity;
l===h?this.computedVisible=this.visible:(g*=m,this.computedOpacity=l>h?Math.max(h,l-g):Math.min(h,l+g),this.computedVisible=0<this.computedOpacity,g=h===this.computedOpacity,this.inFadeTransition=!g,g||this.requestRender())}else this.computedOpacity=this.opacity,this.computedVisible=this.visible};e.onAttach=function(){};e.onDetach=function(){};e.doRender=function(g){};e.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};c._createClass(f,[{key:"clips",get:function(){return this._clips},
set:function(g){this._clips=g;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(g){this._opacity!==g&&(this._opacity=Math.min(1,Math.max(g,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(g){if(this._stage!==g){var h=this._stage;(this._stage=g)?this._stage?.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):h?.trashDisplayObject(this)}}},{key:"transforms",
get:function(){return this._getTransforms()}},{key:"visible",get:function(){return this._visible},set:function(g){this._visible!==g&&(this._visible=g,this.requestRender())}}]);return f}(b);a.DisplayObject=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(a,c){let b=function(){function t(r,m,d,f){this.set(r,m,d,f)}t.getId=function(r,m,d,f){return"object"===
typeof r?`${r.level}/${r.row}/${r.col}/${r.world}`:`${r}/${m}/${d}/${f}`};var n=t.prototype;n.acquire=function(r,m,d,f){this.set(r,m,d,f)};n.contains=function(r){const m=r.level-this.level;return 0<=m&&this.row===r.row>>m&&this.col===r.col>>m&&this.world===r.world};n.equals=function(r){return this.level===r.level&&this.row===r.row&&this.col===r.col&&this.world===r.world};n.clone=function(){return new t(this)};n.release=function(){this.world=this.col=this.row=this.level=0};n.set=function(r,m,d,f){if(null==
r)this.world=this.col=this.row=this.level=0;else if("object"===typeof r)this.level=r.level||0,this.row=r.row||0,this.col=r.col||0,this.world=r.world||0;else if("string"===typeof r){const [e,g,h,l]=r.split("/");this.level=parseFloat(e);this.row=parseFloat(g);this.col=parseFloat(h);this.world=parseFloat(l)}else this.level=+r,this.row=+m,this.col=+d,this.world=+f||0;return this};n.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};n.getParentKey=function(){return 0>=this.level?
null:new t(this.level-1,this.row>>1,this.col>>1,this.world)};n.getChildKeys=function(){const r=this.level+1,m=this.row<<1,d=this.col<<1,f=this.world;return[new t(r,m,d,f),new t(r,m,d+1,f),new t(r,m+1,d,f),new t(r,m+1,d+1,f)]};n.compareRowMajor=function(r){return this.row<r.row?-1:this.row>r.row?1:this.col<r.col?-1:this.col>r.col?1:0};a._createClass(t,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(r){this.set(r)}},{key:"hash",get:function(){return(this.world&
3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}}]);return t}();b.pool=new c(b,null,null,25,50);return b})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){let c=
function(){function b(t=0,n=0){this.min=t;this.max=n;this.level=0;this.hasNoDataValues=!1}b.prototype.copyFrom=function(t){this.min=t.min;this.max=t.max;this.level=t.level;this.hasNoDataValues=t.hasNoDataValues};return b}();a.ElevationBounds=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationData":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../layers/support/ElevationSamplerData ../support/mathUtils ./TerrainConst".split(" "),
function(a,c,b,t,n,r){let m=function(){function f(e,g,h){this.type="elevation";this.level=e[0];this.i=e[1];this.j=e[2];this.extent=g;this.samplerData=new t.ElevationSamplerData(h,g)}f.prototype.computeMinMaxValue=function(e,g,h,l){l.min=Infinity;l.max=-Infinity;l.hasNoDataValues=!1;e-=this.level;if(0>=e)return l;var v=2**e;if(Math.floor(g/v)!==this.i||Math.floor(h/v)!==this.j)return l;var q=Infinity,k=-Infinity,p=this.samplerData.data.width,z=this.samplerData.data.values,C=.5*r.ELEVATION_NODATA_VALUE;
e=(p-1)/v;h=(h-this.j*v)*e;let B=(g-this.i*v)*e;if(1>e){const u=Math.floor(h),y=Math.floor(B);var A=u+y*p;g=z[A];v=z[A+1];var x=z[A+p];A=z[A+p+1];if(g+v+x+A<C)return q=h-u,C=B-y,k=n.bilerp(g,v,x,A,q,C),p=n.bilerp(g,v,x,A,q+e,C),z=n.bilerp(g,v,x,A,q,C+e),e=n.bilerp(g,v,x,A,q+e,C+e),l.min=Math.min(k,p,z,e),l.max=Math.max(k,p,z,e),l;h=u;B=y;e=1}else h=Math.floor(h),B=Math.floor(B),e=Math.ceil(e);for(g=h;g<=h+e;g++)for(v=B;v<=B+e;v++)x=z[g+v*p],x<C?(q=Math.min(q,x),k=Math.max(k,x)):l.hasNoDataValues=
!0;l.min=q;l.max=k;return l};return f}();const d=.5*r.ELEVATION_NODATA_VALUE;a.ElevationData=m;a.sampleElevation=function(f,e,g){if(b.isNone(g))return null;for(const k of g){if(!k)continue;var h=k.safeWidth;g=c.clamp(k.dy*(k.y1-e),0,h);h=c.clamp(k.dx*(f-k.x0),0,h);const p=Math.floor(g),z=Math.floor(h);var l=k.data.width,v=p*l+z,q=k.data.values;const C=q[v],B=q[v+1];v+=l;l=q[v];q=q[v+1];if(C+l+B+q<d)return g-=p,h-=z,f=C+(B-C)*h,f+(l+(q-l)*h-f)*g}return null};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/ElevationSamplerData":function(){define(["exports"],function(a){a.ElevationSamplerData=function(c,b){this.data=c;this.safeWidth=.99999999*(c.width-1);this.dx=(c.width-1)/(b[2]-b[0]);this.dy=(c.width-1)/(b[3]-b[1]);this.x0=b[0];this.y1=b[3]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){function p(B,A){return r.isSome(B)&&!B.spatialReference.equals(A)?g.projectWithoutEngine(B,B.spatialReference,A):B}a.ExtentHelper=function(B){function A(u){u=B.call(this,u)||this;u._handles=new n;return u}c._inheritsLoose(A,B);var x=A.prototype;x.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};x.destroy=function(){this._handles=r.destroyMaybe(this._handles)};x._computeStencilEnabledExtents=
function(){const u=[];this.layerViews.forEach(y=>{y=y.layer;"IntegratedMeshLayer"===y.operationalLayerType&&null!=this.viewSpatialReference&&(y=p(y.fullExtent,this.viewSpatialReference),r.isSome(y)&&u.push(h.fromExtent(y)))});return u};c._createClass(A,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}}]);
return A}(t);b.__decorate([m.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);b.__decorate([m.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);b.__decorate([m.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);b.__decorate([m.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);b.__decorate([m.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);b.__decorate([m.property()],a.ExtentHelper.prototype,
"defaultTiledLayersExtent",void 0);b.__decorate([m.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);b.__decorate([m.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=b.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelper")],a.ExtentHelper);let z=function(B){function A(){return B.apply(this,arguments)||this}c._inheritsLoose(A,B);var x=A.prototype;x._computeLayerViewsExtent=function(){return this._globalExtent};x._computeTiledLayersExtent=
function(){return this._globalExtent};c._createClass(A,[{key:"_globalExtent",get:function(){return this.viewSpatialReference.isWebMercator?q.WEBMERCATOR_WORLD_EXTENT:q.GEOGRAPHIC_WORLD_EXTENT}}]);return A}(a.ExtentHelper);z=b.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],z);let C=function(B){function A(){return B.apply(this,arguments)||this}c._inheritsLoose(A,B);var x=A.prototype;x._computeLayerViewsExtent=function(){const u=h.empty(),y=this.viewSpatialReference;this.layerViews.forEach(F=>
{const E=F.layer;!F.isResolved()||"graphics"===E.type&&E.internal||(F=p("fullExtentInLocalViewSpatialReference"in F&&F.fullExtentInLocalViewSpatialReference||F.layer.fullExtent,y),h.expand(u,F,u))});const w=h.allFinite(u)?u:null,D=this._get("layerViewsExtent");return h.equals(w,D)?D:w};x._computeTiledLayersExtent=function(){const u=this.tilingScheme;if(!u)return null;const y=this.viewSpatialReference,w=h.empty();this.layers.forEach(E=>{if(E.loaded&&l.isTiledLayer(E)){const M=k.getTiledLayerInfo(E,
y,v.ViewingMode.Local);if(!r.isNone(M)){var {tileInfo:K,fullExtent:J}=M;r.isSome(K)&&r.isSome(J)&&(k.isProjectableRasterLayer(E)||u.compatibleWith(K)&&J.spatialReference.equals(u.spatialReference))&&h.expand(w,J,w)}}});h.expand(w,this.defaultTiledLayersExtent,w);const D=h.allFinite(w)?w:null,F=this._get("tiledLayersExtent");return h.equals(D,F)?F:D};return A}(a.ExtentHelper);C=b.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelperLocal")],C);a.create=function(B,A){return B===v.ViewingMode.Global?
new z(A):new C(A)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;var c=a.LayerClass||(a.LayerClass={});c[c.ELEVATION=0]="ELEVATION";c[c.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/ellipsoidUtils ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S){const R=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let Q;a.OverlayManager=function(ba){function da(ca){ca=ba.call(this,ca)||this;ca._handles=new r;ca._spatialReference=null;ca._renderSR=null;ca._overlaySREqualsRenderSR=!0;ca._drapeSources=new Set;ca._drapeTargets=new Set;ca._placementDirty=!1;ca._contentUpdated=!1;ca._drawTexturesDirty=
!1;ca._drawTexturesAnimateDirty=!1;ca._hasUnusedRenderTargets=!1;ca._longitudeCyclical=null;ca._latestOriginId=0;ca._maxResolution=m("esri-mobile")?2048:4096;ca._animationTimeLast=0;return ca}c._inheritsLoose(da,ba);var ea=da.prototype;ea.initialize=function(){const ca=this._view;this.renderer=new N.OverlayRenderer({view:ca,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});this._groundIntersector=I.newIntersector(this._view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=
!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty();this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",ja=>ca._stage?.renderer.setParameters({hasOverlayWater:ja})),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",()=>this.setDrawTexturesDirty()),
this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),e.watch(()=>[ca.pointsOfInterest?.renderPointOfView,ca.pointsOfInterest?.centerOnSurfaceFrequent?.location],()=>this.setPlacementDirty()),e.watch(()=>[ca.state?.pixelRatio,ca.state?.contentPixelRatio],()=>this.setPlacementDirty(),e.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),ca.on("resize",()=>this.setPlacementDirty()),ca.resourceController.scheduler.registerTask(S.TaskPriority.OVERLAY,this),ca._stage.renderView.events.on("force-camera-for-screenshot",
ja=>{this._updateOverlays(S.noBudget,ja,P.RenderRequestType.BACKGROUND);this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,P.RenderRequestType.BACKGROUND,ja.pixelRatio)})]);ca._stage?.renderer.setParameters({renderOverlay:ja=>{this._contentUpdated=!1;this.renderer.processSyncDrapeSources();this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(ja),this._drawOverlayTextures(this.renderer.overlays,P.RenderRequestType.UPDATE));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}})};
ea.destroy=function(){this._handles=f.destroyMaybe(this._handles);f.isSome(Q)&&(Q.hide(),Q=null)};ea.setSpatialReference=function(ca){this._spatialReference=ca;this.renderer.spatialReference=ca;this._longitudeCyclical=null;const ja=this._view.renderSpatialReference;f.isSome(ca)&&f.isSome(ja)?(this._renderSR=ja,this._overlaySREqualsRenderSR=ca.equals(this._renderSR),this._isSpherical&&(this._longitudeCyclical=ca.isWebMercator?new n.Cyclical(-2.0037508342787E7,2.0037508342787E7):new n.Cyclical(-180,
180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()};ea.registerDrapeSource=function(ca,ja,ia){this._drapeSources.add(ca);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ja=this.renderer.createDrapeSourceRenderer(ca,ja,ia);this._updateDrapeSourceExtent(ca);this._setContentDirty();this.notifyChange("running");return ja};ea.registerGeometryDrapeSource=function(ca){return this.registerDrapeSource(ca,
L.SortedRenderGeometryRenderer)};ea._updateDrapeSourceExtent=function(ca){2===this.renderer.overlays.length&&f.isSome(ca.setDrapingExtent)&&f.isSome(this._spatialReference)&&ca.setDrapingExtent(this.renderer.overlays,this._spatialReference)};ea.unregisterDrapeSource=function(ca){this._drapeSources.has(ca)&&(this._drapeSources.delete(ca),this.renderer.removeDrapeSourceRenderer(ca),this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))};ea.registerDrapeTarget=
function(ca){this._drapeTargets.add(ca);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)};ea.updateOverlayResult=function(){this._view._stage?.renderer.setParameters({overlays:this.renderer.overlays})};ea.unregisterDrapeTarget=function(ca){this._drapeTargets.delete(ca);this.renderer.ensureDrapeTargets(this._drapeTargets)};ea._setContentDirty=function(){this.setPlacementDirty();this.setDrawTexturesDirty()};ea.setPlacementDirty=function(){this._placementDirty=!0};ea.runTask=function(ca){return this._updateOverlays(ca,
this._view.state.contentCamera,P.RenderRequestType.UPDATE)};ea._updateOverlays=function(ca,ja,ia){if(!this._spatialReference)return S.Task.YIELD;var Z=this._computeOverlayResolution(ja);this._computeOverlayExtents(ja,Z,X);const ha=u.width(X.inner)/u.width(X.outer);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ja=this._updateOverlay(M.OverlayIndex.INNER,X.inner,Z,1*X.pixelRatioAdjustment,X.mapUnitsPerPixel);Z=this._updateOverlay(M.OverlayIndex.OUTER,X.outer,Z,ha*X.pixelRatioAdjustment,
X.mapUnitsPerPixel);if(ja===Y.EXTENT||Z===Y.EXTENT)this._drapeSources.forEach(fa=>this._updateDrapeSourceExtent(fa)),this.surface.updateTileOverlayParams(ia);ja===Y.NONE&&Z===Y.NONE||this.setDrawTexturesDirty();this._placementDirty=!1;ca.madeProgress()};ea._computeOverlayResolution=function(ca){const ja=this._view.state.contentPixelRatio;return Math.min(d.nextHighestPowerOfTwo(Math.max(ca.fullWidth/ca.pixelRatio*ja,ca.fullHeight/ca.pixelRatio*ja)+256),this._maxResolution)};ea._updateOverlay=function(ca,
ja,ia,Z,ha){if(0===this.renderer.overlays.length)return Y.NONE;ca=this.renderer.overlays[ca];const fa=ca.mapUnitsPerPixel;ca.mapUnitsPerPixel=ha;ca.pixelRatio=Z;Z=ca.extent;const ka=K.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(ja[2]-ja[0],ja[3]-ja[1],Z[2]-Z[0],Z[3]-Z[1]);if(Math.abs(Z[0]-ja[0])<=ka&&Math.abs(Z[1]-ja[1])<=ka&&Math.abs(Z[2]-ja[2])<=ka&&Math.abs(Z[3]-ja[3])<=ka&&ia===ca.resolution)return fa===ha?Y.NONE:Y.RERENDER_ONLY;u.copy(ca.extent,ja);ca.resolution=ia;ja=u.center(ca.extent);ca.renderLocalOrigin=
G.fromValues(ja[0],ja[1],0,`OV_${this._latestOriginId++}`);return Y.EXTENT};ea.setTileParameters=function(ca){const ja=ca.renderData.overlay;if(0<this.renderer.overlays.length){const ia=this.renderer.overlays[M.OverlayIndex.INNER],Z=this.renderer.overlays[M.OverlayIndex.OUTER];ca=ca.extent;this._rectInsideRect(ia.extent,ca)||this._rectanglesOverlap(ca,ia.extent)||this._rectanglesOverlap(ca,Z.extent)?(this._setTileOverlayData(ca,M.OverlayIndex.INNER,ja),this._setTileOverlayData(ca,M.OverlayIndex.OUTER,
ja)):(this._clearTileOverlayData(M.OverlayIndex.INNER,ja),this._clearTileOverlayData(M.OverlayIndex.OUTER,ja))}else this._clearTileOverlayData(M.OverlayIndex.INNER,ja),this._clearTileOverlayData(M.OverlayIndex.OUTER,ja)};ea.overlayPixelSizeInMapUnits=function(ca){if(0===this.renderer.overlays.length)return 0;const ja=this.renderer.overlays[M.OverlayIndex.INNER],ia=this.renderer.overlays[M.OverlayIndex.OUTER];ca=this._pointIsInExtent(ca,ja.extent)?ja:ia;return(ca.extent[2]-ca.extent[0])/ca.resolution};
ea._setTileOverlayData=function(ca,ja,ia){if(0!==this.renderer.overlays.length){var Z=this.renderer.overlays[ja].extent,ha=u.width(Z),fa=u.height(Z),ka=ca[0];if(this._longitudeCyclical){ka=this._longitudeCyclical.minimalMonotonic(Z[0],ka);const la=this._longitudeCyclical.minimalMonotonic(Z[0],ca[2]);ka>la&&(ka=la-(ca[2]-ca[0]))}ia.setScale(ja,u.width(ca)/ha,u.height(ca)/fa);ia.setOffset(ja,(ka-Z[0])/ha,(ca[1]-Z[1])/fa)}};ea._clearTileOverlayData=function(ca,ja){ja.setScale(ca,-1,-1);ja.setOffset(ca,
-1,-1)};ea.reloadShaders=function(){var ca=c._asyncToGenerator(function*(){O.removeLoadedShaderModules();yield this.renderer.reloadShaders();this.setDrawTexturesDirty();this.runTask(S.noBudget)});return function(){return ca.apply(this,arguments)}}();ea._dispatchAnimationUpdate=function(ca){var ja=g.Milliseconds(ca-this._animationTimeLast);if(ja>=this.surface.view._stage.renderer.animationTimestep||f.isSome(this._view.state.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)ja=
g.Milliseconds(ja/this.surface.view._stage.renderer.animationTimeDilation),ja=new H.UpdateParameters(this._view.state.camera,ja,this._view.state.forcedAnimationTime),this.renderer.updateAnimation(ja)&&(this._drawTexturesAnimateDirty=!0),this._animationTimeLast=ca};ea.setDrawTexturesDirty=function(){this.renderer.hasOverlays?(this._drawTexturesDirty=this._contentUpdated=!0,this._view._stage.renderView.requestRender()):this.setPlacementDirty()};ea._intersectGroundFromView=function(ca,ja,ia,Z){ia=this._view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(ca,
U,ja,ia);if(f.isNone(ia))return!1;ja=ia.origin;ia=p.add(aa,ia.origin,ia.direction);this._groundIntersector.reset(ja,ia,ca);this._groundIntersector.intersect([]);this._view.basemapTerrain.intersect(this._groundIntersector,null,ja,ia);return this._groundIntersector.results.min.getIntersectionPoint(Z)};ea._findHorizonBasedPointOfInterest=function(ca,ja){var ia=.5;ia=this._view.renderCoordsHelper.getAltitude(ca.eye);const Z=this._view.pointsOfInterest.centerOnSurfaceFrequent;var ha=d.clamp(Z.estimatedSurfaceAltitude,
ca.aboveGround?-Infinity:ia+1E-5,ca.aboveGround?ia-1E-5:Infinity);ia=ca.aboveGround;if("global"===this._view.viewingMode){var fa=aa;w.closestPointOnSilhouette(w.fromRadius(w.tmpSphere,A.getReferenceEllipsoid(this._view.spatialReference).radius+ha),y.wrap(ca.eye,ca.viewForward),fa);p.subtract(fa,fa,ca.eye);ha=n.cyclicalPI.normalize(D.angleAroundAxis(ca.viewForward,fa,ca.viewRight))/ca.fovY+.5;fa=0>=ha||1<=ha?.5:.55;ia=ia?fa*ha:ha+fa*(1-ha)}else ha=B.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-ca.viewForward[2])),
1,0),ha=C.transformMat4(ha,ha,ca.projectionMatrix)[1],ha=d.clamp(.5+.5*ha,0,1),ia=1===ha||0===ha?.5:ia?.55*ha:1-.55*(1-ha);return this._intersectGroundFromView(ca,.5,ia,ja)?p.sqrDist(ja,ca.eye)<Z.distance*Z.distance:!1};ea._computeOverlayExtents=function(ca,ja,ia){var Z=this._view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,ha=z.create();this._findHorizonBasedPointOfInterest(ca,ha)||p.copy(ha,Z);var fa=Math.max(.1,p.distance(ca.eye,ha));Z=E.viewAngle(this._view.renderCoordsHelper,Z,ca.eye);
const ka=Math.PI/2-Math.abs(Z-Math.PI/2);K.OVERLAY_SHOW_CENTER?(f.isNone(Q)&&(Q=new J.PointGraphics(this._view.graphics,"red")),Q.show(ha,this._renderSR)):f.isSome(Q)&&Q.hide();this._overlaySREqualsRenderSR||x.projectVectorToVector(ha,this._renderSR,ha,this._spatialReference);Z=this.surface.extent;var la=!this._isSpherical&&f.isSome(this._spatialReference)&&this._spatialReference.isGeographic,na=la&&f.isSome(this._spatialReference)?1/A.getReferenceEllipsoid(this._spatialReference).metersPerDegree:
1;fa=ca.perScreenPixelRatio/this._view.state.contentPixelRatio*fa*na;ia.mapUnitsPerPixel=fa/this._worldToPCSRatio;fa=ja*fa/2;var pa=!1;la=la?90:Infinity;this._isSpherical&&f.isSome(Z)&&f.isSome(this._spatialReference)&&(this._spatialReference.isWebMercator?(fa/=Math.cos(F.y2lat(ha[1])),la=Z[3]):(pa=!0,fa/=A.getReferenceEllipsoid(this._spatialReference).metersPerDegree,la=90),fa>=la&&(fa=la,ha[1]=0,this._spatialReference.isWebMercator&&(ha[0]=0)));na=1;pa&&(na=1/Math.max(.2,Math.cos(Math.abs(d.deg2rad(ha[1])))),
180<fa*na&&(na=180/fa),ia.mapUnitsPerPixel*=na);pa=Math.log(2)/12;fa=Math.exp(Math.round(Math.log(fa)/pa)*pa);const va=fa*na;pa=.5*ja/(32*va);var wa=.5*ja/(32*fa);ha[0]=Math.round(ha[0]*pa)/pa;ha[1]=Math.round(ha[1]*wa)/wa;pa=ia.inner;pa[0]=ha[0]-va;pa[1]=ha[1]-fa;pa[2]=ha[0]+va;pa[3]=ha[1]+fa;this._isSpherical&&this._shiftExtentToFitBounds(pa,Infinity,la);wa=ia.outer;6*va>u.width(Z)?u.copy(wa,f.unwrap(Z)):ka<=.25*Math.PI?(wa[0]=pa[0]-va,wa[1]=pa[1]-fa,wa[2]=pa[2]+va,wa[3]=pa[3]+fa):(x.projectVectorToVector(ca.eye,
this._renderSR,aa,this._spatialReference),k.subtract(V,ha,aa),ca=-Math.atan2(V[1],V[0])+.125*Math.PI,0>ca&&(ca+=2*Math.PI),C.scale(V,R[Math.floor(ca/(.25*Math.PI))],2*fa),V[0]*=na,V[2]*=na,C.add(wa,pa,V));this._isSpherical?(wa[0]=this._longitudeCyclical.clamp(wa[0]),wa[2]=this._longitudeCyclical.clamp(wa[2]),wa[1]=Math.max(wa[1],-la),wa[3]=Math.min(wa[3],la)):(ca=u.intersection(pa,Z,W),ha=u.intersection(wa,Z,T),u.contains(ca,ha)&&(wa[2]=wa[0],wa[3]=wa[1]));ja=Math.abs(pa[2]-pa[0])/ja;ia.mapUnitsPerPixel=
Math.max(ia.mapUnitsPerPixel,ja);ia.pixelRatioAdjustment=ia.mapUnitsPerPixel/ja};ea._drawOverlayTextures=function(ca,ja,ia=this._view.state.contentPixelRatio){if(0!==ca.length&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var Z=this._drawTexturesDirty;this._drawTexturesAnimateDirty=this._drawTexturesDirty=!1;var ha=this._drawOverlay(ca[M.OverlayIndex.INNER],ia);ca=this._drawOverlay(ca[M.OverlayIndex.OUTER],ia);ha!==P.ValidationState.CHANGED&&ca!==P.ValidationState.CHANGED||this.surface.updateTileOverlayParams(P.RenderRequestType.UPDATE);
this._collectUnusedRenderTargetMemory();this.updateOverlayResult();Z?(this.surface.requestRender(ja),ja===P.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(P.RenderRequestType.BACKGROUND)}};ea._drawOverlay=function(ca,ja){this._longitudeCyclical?ca.setupGeometryViewsCyclical(this._longitudeCyclical):ca.setupGeometryViewsDirect();return ca.draw(this.renderer,ja)};ea._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const ca=
performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(ca)}};ea._rectanglesOverlap=function(ca,ja){return f.isNone(ca)?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(ja[0],ja[2],ca[0])||this._longitudeCyclical.contains(ja[0],ja[2],ca[2])||this._longitudeCyclical.contains(ca[0],ca[2],ja[0]))&&!(ca[1]>ja[3]||ca[3]<ja[1]):u.intersects(ca,ja)};ea._rectInsideRect=function(ca,ja){return f.isNone(ja)?!1:this._longitudeCyclical?this._longitudeCyclical.contains(ca[0],
ca[2],ja[0])&&this._longitudeCyclical.contains(ca[0],ca[2],ja[2])&&ja[1]>ca[1]&&ja[3]<ca[3]:u.contains(ca,ja)};ea._pointIsInExtent=function(ca,ja){if(this._longitudeCyclical)return this._longitudeCyclical.contains(ja[0],ja[2],ca.x)&&ca.y>=ja[1]&&ca.y<=ja[3];const ia=ca.x;ca=ca.y;return ia>ja[0]&&ia<ja[2]&&ca>ja[1]&&ca<ja[3]};ea._shiftExtentToFitBounds=function(ca,ja,ia){let Z=0,ha=0;ca[0]<-ja?Z=ca[0]+ja:ca[2]>ja&&(Z=ja-ca[2]);ca[1]<-ia?ha=ca[1]+ia:ca[3]>ia&&(ha=ia-ca[3]);u.offset(ca,Z,ha)};c._createClass(da,
[{key:"running",get:function(){return this._placementDirty&&(0<this._drapeSources.size||0<this._view.graphics.length||K.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}},{key:"_isSpherical",get:function(){return this._view.state.isGlobal}},{key:"_worldToPCSRatio",get:function(){return f.isSome(this._spatialReference)&&this._spatialReference.isGeographic&&!this._view.state.isLocal?A.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}},{key:"_view",
get:function(){return this.surface.view}},{key:"suspended",get:function(){return this.surface.suspended}},{key:"updating",get:function(){return this.running||this.renderer.updating||this._contentUpdated}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"gpuMemoryUsage",get:function(){return this.renderer.gpuMemoryUsage}},{key:"test",
get:function(){return{renderer:this.renderer,update:()=>this.runTask(S.noBudget)}}}]);return da}(t);b.__decorate([h.property()],a.OverlayManager.prototype,"_spatialReference",void 0);b.__decorate([h.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);b.__decorate([h.property()],a.OverlayManager.prototype,"_placementDirty",void 0);b.__decorate([h.property()],a.OverlayManager.prototype,"_contentUpdated",void 0);b.__decorate([h.property()],a.OverlayManager.prototype,"_isSpherical",null);
b.__decorate([h.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);b.__decorate([h.property({autoDestroy:!0})],a.OverlayManager.prototype,"renderer",void 0);b.__decorate([h.property({constructOnly:!0})],a.OverlayManager.prototype,"surface",void 0);b.__decorate([h.property()],a.OverlayManager.prototype,"suspended",null);b.__decorate([h.property()],a.OverlayManager.prototype,"updating",null);b.__decorate([h.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);b.__decorate([h.property({type:Boolean})],
a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=b.__decorate([q.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);const V=B.create(),aa=z.create(),X={inner:u.create(),outer:u.create(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},W=u.create(),T=u.create(),U=y.create();var Y;(function(ba){ba[ba.NONE=0]="NONE";ba[ba.EXTENT=1]="EXTENT";ba[ba.RERENDER_ONLY=2]="RERENDER_ONLY"})(Y||(Y={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],
function(a){a.removeLoadedShaderModules=function(){const c=globalThis.require?.modules;if(c){const b=Object.keys(c);for(const t of b)-1!==t.search(".glsl")&&delete c[t]}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ./interfaces ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){let v=function(k){function p(C,B,A){var x=k.call(this)||this;x._horizontalScaleFactor=1;x._extentInRenderSR=d.create();void 0!==C&&x.init(C,B,A);return x}c._inheritsLoose(p,k);var z=p.prototype;z.init=function(C,B,A){k.prototype.init.call(this,C,B,A);C=A.view.renderSpatialReference;A=A.spatialReference;this._horizontalScaleFactor=B=b.isSome(C)&&f.isPlateCarree(C)&&b.isSome(A)&&A.isGeographic?this.ellipsoid.radius*Math.PI/180:1;A=this._extentInRenderSR;C=this.extent;
if(this.surface.isWebMercatorOnPlateeCarree)B=t.fromValues(C[0],C[1],0),n.projectVectorToVector(B,r.WebMercator,B,r.PlateCarree),C=t.fromValues(C[2],C[3],0),n.projectVectorToVector(C,r.WebMercator,C,r.PlateCarree),A[0]=B[0],A[1]=B[1],A[2]=C[0],A[3]=C[1];else for(let x=0;4>x;++x)A[x]=C[x]*B;this.centerAtSeaLevel[0]=.5*(A[0]+A[2]);this.centerAtSeaLevel[1]=.5*(A[1]+A[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(A[2]-A[0],A[3]-A[1]);this._edgeLen2=this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()};
z.updateRadiusAndCenter=function(){this._updateCenter();var C=this._extentInRenderSR;const B=.5*(C[2]-C[0]);C=.5*(C[3]-C[1]);this._center[h.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(B*B+C*C),.5*(this.elevationBounds[0]-this.elevationBounds[1]))};z._calculateFrustumVisibilityStatus=function(C){var B=this._aabb();const A=B[0],x=B[1],u=B[2],y=B[3],w=B[4];B=B[5];let D=!0;for(let E=0;6>E;E++){var F=C[E];const K=F[0],J=F[1],M=F[2];F=F[3];if(0<=K*(0<K?A:y)+J*(0<J?x:w)+M*(0<M?u:B)+F)return e.TileFrustumVisibility.OUTSIDE;
D=D&&0>=K*(0>K?A:y)+J*(0>J?x:w)+M*(0>M?u:B)+F}return D?e.TileFrustumVisibility.INSIDE:e.TileFrustumVisibility.INTERSECTS};z._aabb=function(){const C=this._extentInRenderSR;return m.wrap(C[0],C[1],this.elevationBounds[0],C[2],C[3],this.elevationBounds[1])};z.intersectsRay=function(C,B,A,x){q[0]=1/B[0];q[1]=1/B[1];q[2]=1/B[2];return l.intersectAabbInvDirBefore(this._aabb(),C,q,A,x)};z.createGeometry=function(){g.createPlanarGlobePatch(this.renderData,this._horizontalScaleFactor);this.setMemoryDirty()};
z.getDefaultVerticesPerSide=function(){return 9>this.level?3:2};z.updateCornerElevations=function(){g.updateCornersPlanar(this.renderData,this._horizontalScaleFactor)};z.updateEdgeElevations=function(){g.updateEdgesAndCornersPlanar(this.renderData,this._horizontalScaleFactor)};c._createClass(p,[{key:"horizontalScale",get:function(){return this._horizontalScaleFactor}}]);return p}(h.Tile);const q=t.create();a.PlanarPatch=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec4 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./terrainUtils ./Tile ./tileUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(I){if(I.tile.intersectsClippingArea){var G=I.geometryState,H=G.numVerticesPerSide;const ua=H-2;--H;var L=I.geometryInfo,O=L.vertexAttributes,S=O.position;const oa=O.uv0;O=O.normalCompressed;var R=I.tile,Q=R.extent;const xa=Q[0],Ea=Q[2],Ia=Q[1];Q=Q[3];R=R.ellipsoid.radius;G=G.samplerData;var V=I.localOrigin;I=V[0];const Na=V[1];V=V[2];const Oa=S.typedBuffer;S=S.typedBufferStride;const Ja=1/H;L=L.boundingBox;let Sa=0;if(1<=ua){var aa=Ia*(1-Ja)+Q*Ja,X=
M.sinLatLUT[1],W=M.cosLatLUT[1];for(var T=1;T<=ua;T++){var U=T*Ja,Y=M.sinLonLUT[T],ba=M.cosLonLUT[T],da=R+m.sampleElevation(xa*(1-U)+Ea*U,aa,G);ba=-I+da*ba*W;Y=-Na+da*Y*W;da=-V+da*X;f.minMaxBoundingBox(ba,Y,da,L);var ea=(T-1)*S;Oa[ea]=ba;Oa[ea+1]=Y;Oa[ea+2]=da;f.encodeUVInBuffer(oa,T-1,U,Ja)}}for(aa=1;aa<=ua;aa++){X=aa*Ja;X=Ia*(1-X)+Q*X;W=M.sinLatLUT[aa];T=M.cosLatLUT[aa];Y=aa+1;U=Y*Ja;ba=Ia*(1-U)+Q*U;da=M.sinLatLUT[Y];Y=M.cosLatLUT[Y];var ca=M.sinLonLUT[0];ea=M.cosLonLUT[0];var ja=R+m.sampleElevation(xa,
X,G);ea=ea*T*ja-I;ca=ca*T*ja-Na;ja=W*ja-V;var ia=Sa*S;let Ua=Oa[ia],Za=Oa[ia+1];ia=Oa[ia+2];for(let ma=1;ma<=ua;ma++){var Z=ma*Ja,ha=xa*(1-Z)+Ea*Z,fa=M.sinLonLUT[ma],ka=M.cosLonLUT[ma];let Ya=ka*T,bb=fa*T,Qa=W;var la=0,na=0,pa=0;pa=na=la=0;ma<ua?(pa=(Sa+1)*S,la=Oa[pa],na=Oa[pa+1],pa=Oa[pa+2]):(na=M.sinLonLUT[H],la=M.cosLonLUT[H],pa=R+m.sampleElevation(Ea,X,G),la=la*T*pa-I,na=na*T*pa-Na,pa=W*pa-V);var va=ea,wa=ca,za=ja;ea=Ua;ca=Za;ja=ia;Ua=la;Za=na;ia=pa;la-=va;na-=wa;pa-=za;va=wa=za=0;if(1<aa)va=
(Sa-ua)*S,za=Oa[va],wa=Oa[va+1],va=Oa[va+2];else{va=M.sinLatLUT[0];wa=M.cosLatLUT[0];var sa=R+m.sampleElevation(ha,Ia,G);za=ka*wa*sa-I;wa=fa*wa*sa-Na;va=va*sa-V}ha=R+m.sampleElevation(ha,ba,G);ka=ka*Y*ha-I;fa=fa*Y*ha-Na;ha=da*ha-V;if(aa<ua){sa=Sa+ua;const Aa=sa*S;Oa[Aa]=ka;Oa[Aa+1]=fa;Oa[Aa+2]=ha;f.minMaxBoundingBox(ka,fa,ha,L);f.encodeUVInBuffer(oa,sa,Z,U)}Z=za-ka;fa=wa-fa;ka=va-ha;.999>Qa*Qa&&(Ya=pa*fa-na*ka,bb=la*ka-pa*Z,Qa=na*Z-la*fa);Z=1/Math.sqrt(Ya*Ya+bb*bb+Qa*Qa);f.encodeNormalToBufferFromValues(O,
Sa,Ya*Z,bb*Z,Qa*Z);++Sa}}}}function k(I){I.tile.intersectsClippingArea&&(D(I),p(I))}function p(I,G=!1){var H=I.geometryState;const L=I.geometryInfo,O=H.neighborData,S=I.tile,R=S.level,Q=S.extent,V=S.ellipsoid.radius;var aa=S.extentInRadians;const X=aa[0],W=aa[2],T=aa[1];aa=aa[3];const U=H.samplerData,Y=Q[0],ba=Q[2],da=Q[1],ea=Q[3],ca=z(I),ja=L.boundingBox;H=I.localOrigin;const ia=H[0],Z=H[1],ha=H[2];H=S.surface.shading||!0;var fa=L.vertexAttributes,ka=fa.position;const la=ka.typedBuffer,na=ka.typedBufferStride,
pa=fa.uv0;for(let za=0;4>za;++za){const sa=1===za||3===za;fa=O.edgeResolutions[za];h.internalAssert(c.isPowerOfTwo(fa));const ua=fa+1;var va=g.neighborTileIfLoadedOrSelf(S,O.edgePeerNeighbors[za]);if(K(S,va,za)){w(I,za,va);continue}const oa=b.isSome(va);h.internalAssert(!oa||va.level===S.level);h.internalAssert(!oa||0>=v.compareTilesByLij(S,va));ka=va?.renderData?.geometryState;if(h.ENABLE_TERRAIN_INTERNAL_CHECKS){var wa=S.surface;if(!va&&wa&&!wa.updatingRootTiles){const La=h.neighborEdgeIndices[za],
Ta=S.findNeighborTile(La,Xa=>Xa.isLoaded||Xa.isLeaf||Xa.level===S.level);Ta?Ta.intersectsClippingArea&&(h.internalAssert(!Ta.isLoaded),h.internalAssert(!Ta.isLeaf),h.internalAssert(Ta.level===R)):h.internalAssert(b.isNone(wa?.rootTiles)||!S.shouldHaveNeighbor(La))}}const xa=1===za?Q[2]:Q[0],Ea=(va=va?.extent)&&sa?1===za?va[0]:va[2]:xa,Ia=0===za?Q[3]:Q[1],Na=1===za?1:0,Oa=0===za?1:0,Ja=1===za?W:X,Sa=0===za?aa:T,Ua=Math.sin(Ja),Za=Math.cos(Ja),ma=Math.sin(Sa),Ya=Math.cos(Sa),bb=ka?.samplerData;ka=(La,
Ta,Xa)=>m.sampleElevation(La,Ta,U);wa=(La,Ta,Xa)=>.5*(m.sampleElevation(La,Ta,U)+m.sampleElevation(Xa,Ta,bb));const Qa=oa?wa:ka,Aa=L.outerEdges[za],Ca=G&&3<ua?ua-3:1;ka=b.isSome(U)&&U.some(La=>null!=La);wa=b.isSome(bb)&&bb.some(La=>null!=La);const qa=ka||wa,ya=1/fa,Da=Aa.index0;H?(h.internalAssert(!va||h.almostEquals(va[2]-va[0],Q[2]-Q[0])),(()=>{const La=1===za?-1:3===za?1:0,Ta=0===za?-1:2===za?1:0,Xa=(Q[2]-Q[0])*ya,db=La*Xa,fb=Ta*Xa,jb=W-X,lb=sa?La*jb*ya:0,ob=sa?0:Ta*ya,xb=Oa,Nb=sa?Ja+lb:Ja,Bb=
sa?Math.sin(Nb):Ua,rb=sa?Math.cos(Nb):Za,mb=sa?Ja-lb:Ja,eb=sa?Math.sin(mb):Ua,cb=sa?Math.cos(mb):Za,Ka=sa?Sa:ca(xb+ob),Ha=sa?ma:Math.sin(Ka),ra=sa?Ya:Math.cos(Ka),Ga=sa?Sa:ca(xb-ob),Pa=sa?ma:Math.sin(Ga),Ra=sa?Ya:Math.cos(Ga);let Va=0,ab=0,hb=0;const ib=0*ya,kb=sa?xa:Y*(1-ib)+ba*ib,pb=sa?Ea:kb,ub=sa?da*(1-ib)+ea*ib:Ia,Eb=sa?Ja:X*(1-ib)+W*ib,Ib=sa?Ua:Math.sin(Eb),tb=sa?Za:Math.cos(Eb),nb=sa?ca(ib):Sa,yb=sa?Math.sin(nb):ma,Fb=sa?Math.cos(nb):Ya,Jb=V+Qa(kb,ub,pb);Va=tb*Fb*Jb;ab=Ib*Fb*Jb;hb=yb*Jb;let Pb=
0,Gb=0,Tb=0;const zb=1*ya,Rb=sa?xa:Y*(1-zb)+ba*zb,Qb=sa?Ea:Rb,Ob=sa?da*(1-zb)+ea*zb:Ia,Kb=sa?Ja:X*(1-zb)+W*zb,Sb=sa?Ua:Math.sin(Kb),vb=sa?Za:Math.cos(Kb),Wb=sa?ca(zb):Sa,wb=sa?Math.sin(Wb):ma,ec=sa?Math.cos(Wb):Ya,Ab=V+Qa(Rb,Ob,Qb);Pb=vb*ec*Ab;Gb=Sb*ec*Ab;Tb=wb*Ab;for(let Hb=1;Hb<ua-1;Hb+=Ca){let fc=0,dc=0,Yb=0;const Xb=(Hb+1)*ya,gc=sa?xa:Y*(1-Xb)+ba*Xb,tc=sa?Ea:gc,yc=sa?da*(1-Xb)+ea*Xb:Ia,mc=sa?Ja:X*(1-Xb)+W*Xb,zc=sa?Ua:Math.sin(mc),te=sa?Za:Math.cos(mc),wd=sa?ca(Xb):Sa,ue=sa?Math.sin(wd):ma,Yc=
sa?Math.cos(wd):Ya,Zc=V+Qa(gc,yc,tc);fc=te*Yc*Zc;dc=zc*Yc*Zc;Yb=ue*Zc;const xd=fc,yd=dc,zd=Yb,Dc=Pb,$c=Gb,Ec=Tb;Pb=xd;Gb=yd;Tb=zd;const Ad=Da+Hb,ad=Ad*na,Bd=Dc-ia,Cd=$c-Z,Dd=Ec-ha;la[ad]=Bd;la[ad+1]=Cd;la[ad+2]=Dd;f.minMaxBoundingBox(Bd,Cd,Dd,ja);const Ed=Hb*ya;f.encodeUVInBuffer(pa,Ad,sa?Na:Ed,sa?Ed:Oa);const bd=Va,cd=ab,ve=hb;Va=Dc;ab=$c;hb=Ec;const Ac=Dc,Bc=$c,uc=Ec,Fc=1/Math.sqrt(Ac*Ac+Bc*Bc+uc*uc),Fd=uc*Fc;let vc=0,nc=0,wc=0;if(qa&&.999>Fd*Fd){let Gc=0,Hc=0,dd=0;const ed=0===za?-1:1;Gc=ed*(xd-
bd);Hc=ed*(yd-cd);dd=ed*(zd-ve);const oc=Hb*ya,Gd=sa?xa:Y*(1-oc)+ba*oc,we=sa?Ea:Gd,Hd=sa?da*(1-oc)+ea*oc:Ia,Id=sa?Ja:X*(1-oc)+W*oc,Jd=sa?Ua:Math.sin(Id),Kd=sa?Za:Math.cos(Id),Ld=sa?ca(oc):Sa,Md=sa?Math.sin(Ld):ma,Nd=sa?Math.cos(Ld):Ya;let fd=Ac,gd=Bc,hd=uc;if(oa){const id=V+m.sampleElevation(we-db,Hd-fb,bb),xe=sa?eb:Jd,ye=sa?Md:Pa,Od=sa?Nd:Ra;fd=(sa?cb:Kd)*Od*id;gd=xe*Od*id;hd=ye*id}const jd=V+m.sampleElevation(Gd+db,Hd+fb,U),Pd=sa?Nd:ra,Qd=(sa?rb:Kd)*Pd*jd,Rd=(sa?Bb:Jd)*Pd*jd,Sd=(sa?Md:Ha)*jd;oa||
(fd=2*Ac-Qd,gd=2*Bc-Rd,hd=2*uc-Sd);const kd=3===za?-1:1,Td=kd*(fd-Qd),Ud=kd*(gd-Rd),Vd=kd*(hd-Sd);vc=dd*Ud-Hc*Vd;nc=Gc*Vd-dd*Td;wc=Hc*Td-Gc*Ud;const ld=1/Math.sqrt(vc*vc+nc*nc+wc*wc);vc*=ld;nc*=ld;wc*=ld}else vc=Ac*Fc,nc=Bc*Fc,wc=uc*Fc;Aa.setNormalFromValues(Hb,vc,nc,wc)}})()):(()=>{for(let lb=1;lb<ua-1;lb+=Ca){var La=lb*ya;const ob=sa?Na:La,xb=sa?La:Oa;var Ta=sa?xa:Y*(1-La)+ba*La,Xa=sa?da*(1-La)+ea*La:Ia;const Nb=sa?Ea:Ta;var db=sa?Ja:X*(1-La)+W*La,fb=sa?Ua:Math.sin(db);db=sa?Za:Math.cos(db);var jb=
sa?ca(La):Sa;La=sa?Math.sin(jb):ma;jb=sa?Math.cos(jb):Ya;Ta=Qa(Ta,Xa,Nb);Ta=V+Ta;db=db*jb*Ta-ia;fb=fb*jb*Ta-Z;La=La*Ta-ha;f.minMaxBoundingBox(db,fb,La,ja);Ta=Da+lb;Xa=Ta*na;la[Xa]=db;la[Xa+1]=fb;la[Xa+2]=La;f.encodeUVInBuffer(pa,Ta,ob,xb)}})()}}function z(I){I=I.tile;if(I.surface.isWebMercator){const H=I.extent,L=I.ellipsoid.radius;return O=>Math.PI/2-2*Math.atan(Math.exp(-(H[1]*(1-O)+H[3]*O)/L))}const G=I.extentInRadians;return H=>G[1]*(1-H)+G[3]*H}function C(I){const G=I.tile;if(G.intersectsClippingArea)if(G.surface.shading){{const H=
I.tile,L=I.geometryState,O=L.samplerData,S=I.localOrigin,R=H.surface.isWebMercatorOnPlateeCarree,Q=L.clippingArea,V=b.isSome(Q)?Q:N,aa=H.extent,X=aa[0],W=aa[1],T=aa[2],U=aa[3],Y=Math.max(X,V[0]),ba=Math.min(T,V[2]),da=Math.max(W,V[1]),ea=Math.min(U,V[3]),ca=H.ellipsoid.radius,ja=H.horizontalScale,ia=L.numVerticesPerSide,Z=ia-1,ha=ia-2,fa=I.geometryInfo,ka=fa.vertexAttributes,la=ka.position,na=ka.uv0,pa=ka.normalCompressed,va=fa.uvRange,wa=va[0],za=va[1],sa=va[2],ua=va[3],oa=fa.boundingBox,xa=S[0],
Ea=S[1],Ia=S[2],Na=la.typedBuffer,Oa=la.typedBufferStride;let Ja=0;const Sa=c.clamp(W,da,ea),Ua=R?(Math.PI/2-2*Math.atan(Math.exp(-Sa/ca)))*ca:Sa*ja,Za=1/Z,ma=c.clamp(W*(1-Za)+U*Za,da,ea);let Ya=Ua,bb=R?(Math.PI/2-2*Math.atan(Math.exp(-ma/ca)))*ca:ma*ja;for(let Qa=1;Qa<=ha;Qa++){const Aa=Qa/Z,Ca=c.clamp(W*(1-Aa)+U*Aa,da,ea),qa=c.clamp(Aa,za,ua),ya=bb,Da=(Qa-1)/Z,La=c.clamp(W*(1-Da)+U*Da,da,ea),Ta=Ya,Xa=(Qa+1)/Z,db=c.clamp(W*(1-Xa)+U*Xa,da,ea),fb=R?(Math.PI/2-2*Math.atan(Math.exp(-db/ca)))*ca:db*ja,
jb=c.clamp(Xa,za,ua);Ya=bb;bb=fb;const lb=c.clamp(X,Y,ba);let ob=lb*ja,xb=m.sampleElevation(lb,Ca,O);const Nb=1/Z,Bb=c.clamp(Nb,wa,sa),rb=c.clamp(X*(1-Bb)+T*Bb,Y,ba);let mb=Bb,eb=rb,cb=rb*ja,Ka=m.sampleElevation(rb,Ca,O);if(1===Qa){const Ha=cb-xa,ra=Ya-Ea,Ga=Ka-Ia,Pa=0*Oa;Na[Pa]=Ha;Na[Pa+1]=ra;Na[Pa+2]=Ga;f.minMaxBoundingBox(Ha,ra,Ga,oa);const Ra=c.clamp(Nb,wa,sa);f.encodeUVInBuffer(na,Ja,Ra,qa)}for(let Ha=1;Ha<=ha;Ha++){const ra=cb,Ga=Ka,Pa=(Ha+1)/Z,Ra=c.clamp(Pa,wa,sa),Va=c.clamp(X*(1-Pa)+T*Pa,
Y,ba),ab=eb;eb=Va;const hb=Ja+1,ib=hb*Oa;if(1===Qa||Ha===ha){const zb=m.sampleElevation(Va,Ca,O),Rb=Va*ja,Qb=ya,Ob=zb;if(1===Qa&&Ha<ha){const Kb=Rb-xa,Sb=Qb-Ea,vb=Ob-Ia;Na[ib]=Kb;Na[ib+1]=Sb;Na[ib+2]=vb;f.minMaxBoundingBox(Kb,Sb,vb,oa);f.encodeUVInBuffer(na,hb,Ra,qa)}cb=Rb;Ka=Ob}else cb=Na[ib]+xa,Ka=Na[ib+2]+Ia;const kb=cb,pb=Ka,ub=ob,Eb=xb;ob=ra;xb=Ga;const Ib=(Ja-ha)*Oa,tb=1===Qa?m.sampleElevation(ab,La,O):Na[Ib+2]+Ia,nb=m.sampleElevation(ab,db,O);if(Qa<ha){const zb=Ja+ha,Rb=zb*Oa,Qb=ra-xa,Ob=fb-
Ea,Kb=nb-Ia;Na[Rb]=Qb;Na[Rb+1]=Ob;Na[Rb+2]=Kb;f.minMaxBoundingBox(Qb,Ob,Kb,oa);const Sb=mb;mb=Ra;f.encodeUVInBuffer(na,zb,Sb,jb)}const yb=kb-ub,Fb=Ta-fb,Jb=Fb*(pb-Eb),Pb=yb*(tb-nb),Gb=-Fb*yb,Tb=Jb*Jb+Pb*Pb+Gb*Gb;if(0===Tb)f.encodeNormalToBufferFromValues(pa,Ja,0,0,1);else{const zb=1/Math.sqrt(Tb);f.encodeNormalToBufferFromValues(pa,Ja,Jb*zb,Pb*zb,Gb*zb)}++Ja}}}}else{const H=I.geometryState,L=H.samplerData,O=I.tile,S=I.localOrigin,R=O.surface.isWebMercatorOnPlateeCarree,Q=H.clippingArea,V=b.isSome(Q)?
Q:N,aa=O.extent,X=aa[0],W=aa[1],T=aa[2],U=aa[3],Y=Math.max(X,V[0]),ba=Math.min(T,V[2]),da=Math.max(W,V[1]),ea=Math.min(U,V[3]),ca=S[0],ja=S[1],ia=S[2],Z=O.horizontalScale,ha=x(R,O.ellipsoid.radius,Z),fa=H.numVerticesPerSide,ka=fa-1,la=fa-2,na=I.geometryInfo,pa=na.uvRange,va=pa[0],wa=pa[1],za=pa[2],sa=pa[3],ua=na.boundingBox,oa=na.vertexAttributes,xa=oa.position,Ea=oa.uv0;let Ia=0;for(let Na=1;Na<=la;Na++){const Oa=Na/ka,Ja=c.clamp(W*(1-Oa)+U*Oa,da,ea),Sa=c.clamp(Oa,wa,sa),Ua=ha(Ja)-ja;for(let Za=
1;Za<=la;Za++){const ma=Za/ka,Ya=c.clamp(X*(1-ma)+T*ma,Y,ba),bb=c.clamp(ma,va,za),Qa=m.sampleElevation(Ya,Ja,L),Aa=Ya*Z-ca,Ca=Qa-ia;f.minMaxBoundingBox(Aa,Ua,Ca,ua);xa.setValues(Ia,Aa,Ua,Ca);f.encodeUVInBuffer(Ea,Ia,bb,Sa);++Ia}}}}function B(I,G){I.tile.intersectsClippingArea&&(D(I),A(I,!1))}function A(I,G){const H=I.geometryState,L=H.neighborData,O=I.tile,S=O.surface,R=S.shading||!0,Q=O.extent,V=H.clippingArea,aa=b.isSome(V)?V:N,X=Q[0],W=Q[2],T=Q[1],U=Q[3],Y=[U>aa[3],W>aa[2],T<aa[1],X<aa[0]],ba=
I.geometryInfo,da=O.horizontalScale,ea=x(S.isWebMercatorOnPlateeCarree,O.ellipsoid.radius,da),ca=ba.boundingBox,ja=ba.uvRange[0],ia=ba.uvRange[1],Z=ba.uvRange[2],ha=ba.uvRange[3],fa=Math.max(X,aa[0]),ka=Math.min(W,aa[2]),la=Math.max(T,aa[1]),na=Math.min(U,aa[3]),pa=I.localOrigin,va=pa[0],wa=pa[1],za=pa[2],sa=H.samplerData;for(let ua=0;4>ua;++ua){const oa=1===ua||3===ua,xa=L.edgeResolutions[ua];h.internalAssert(c.isPowerOfTwo(xa));const Ea=xa+1,Ia=Y[ua],Na=g.neighborTileIfLoadedOrSelf(O,L.edgePeerNeighbors[ua]);
if(!Ia&&K(O,Na,ua)){w(I,ua,Na);continue}const Oa=b.isSome(Na)&&!Ia,Ja=Na?.renderData?.geometryState;if(h.ENABLE_TERRAIN_INTERNAL_CHECKS&&(h.internalAssert(!Oa||Na.level===O.level),h.internalAssert(!Oa||0>=v.compareTilesByLij(O,Na)),O&&!Na&&!S.updatingRootTiles)){const ya=h.neighborEdgeIndices[ua],Da=O.findNeighborTile(ya,La=>La.isLoaded||La.isLeaf||La.level===O.level);S.updatingRootTiles||(Da?Da.intersectsClippingArea&&(h.internalAssert(!Da.isLoaded),h.internalAssert(!Da.isLeaf),h.internalAssert(Da.level===
O.level)):h.internalAssert(b.isNone(S?.rootTiles)||!O.shouldHaveNeighbor(ya)))}const Sa=c.clamp(1===ua?W:X,fa,ka),Ua=c.clamp(0===ua?U:T,la,na),Za=Ja?.samplerData,ma=ba.outerEdges[ua],Ya=G&&3<Ea?Ea-3:1,bb=c.clamp(1===ua?1:0,ja,Z),Qa=c.clamp(0===ua?1:0,ia,ha),Aa=(ya,Da)=>m.sampleElevation(ya,Da,sa),Ca=(ya,Da)=>.5*(m.sampleElevation(ya,Da,Za)+m.sampleElevation(ya,Da,sa)),qa=Oa?Ca:Aa;if(R){const ya=(W-X)/xa,Da=oa?1===ua?ya:-ya:0,La=oa?0:0===ua?ya:-ya,Ta=-Da,Xa=-La;let db=0,fb=0,jb=0;const lb=0/xa,ob=
oa?Sa:c.clamp(X*(1-lb)+W*lb,fa,ka),xb=oa?c.clamp(T*(1-lb)+U*lb,la,na):Ua,Nb=qa(ob,xb);db=ob*da;fb=ea(xb);jb=Nb;let Bb=0,rb=0,mb=0;const eb=1/xa,cb=oa?Sa:c.clamp(X*(1-eb)+W*eb,fa,ka),Ka=oa?c.clamp(T*(1-eb)+U*eb,la,na):Ua,Ha=qa(cb,Ka),ra=cb*da,Ga=ea(Ka),Pa=Ha;Bb=ra;rb=Ga;mb=Pa;for(let Ra=1;Ra<Ea-1;Ra+=Ya){const Va=Ra/xa,ab=Bb,hb=rb,ib=mb,kb=oa?bb:c.clamp(Va,ja,Z),pb=oa?c.clamp(Va,ia,ha):Qa,ub=ab-va,Eb=hb-wa,Ib=ib-za;f.minMaxBoundingBox(ab,Eb,Ib,ca);ma.setVertexFromValuesRawPositionUV(Ra,ub,Eb,Ib,kb,
pb);const tb=(Ra+1)/xa,nb=oa?Sa:c.clamp(X*(1-tb)+W*tb,fa,ka),yb=oa?c.clamp(T*(1-tb)+U*tb,la,na):Ua,Fb=qa(nb,yb);Bb=nb*da;rb=ea(yb);mb=Fb;const Jb=Bb,Pb=rb,Gb=mb,Tb=db,zb=fb,Rb=jb;db=ab;fb=hb;jb=ib;let Qb=0,Ob=0,Kb=0;if(oa){const vb=Pb-hb,Wb=Gb-ib,wb=zb-hb,ec=Rb-ib,Ab=c.clamp(T*(1-Va)+U*Va,la,na),Hb=Sa+Ta,fc=Hb*da,dc=m.sampleElevation(Hb,Ab,sa),Yb=fc-ab,Xb=dc-ib,gc=3===ua?-1:1;Qb=gc*(-wb+vb)*Xb;Ob=gc*Yb*(-ec+Wb);Kb=-gc*Yb*(-wb+vb);if(Oa){const tc=Sa+Da,yc=tc*da,mc=m.sampleElevation(tc,Ab,Za),zc=yc-
ab;Qb=(-wb+vb)*(Xb-(mc-ib));Ob=(Yb-zc)*(-ec+Wb);Kb=-(Yb-zc)*(-wb+vb)}}else{const vb=Jb-ab,Wb=Gb-ib,wb=Tb-ab,ec=Rb-ib,Ab=c.clamp(X*(1-Va)+W*Va,fa,ka),Hb=Ua+Xa,fc=m.sampleElevation(Ab,Hb,sa)-ib,dc=ea(Hb)-hb,Yb=2===ua?-1:1;Qb=Yb*dc*(-ec+Wb);Ob=Yb*(-wb+vb)*fc;Kb=-Yb*dc*(-wb+vb);if(Oa){const Xb=Ab,gc=Ua+La,tc=ea(gc),yc=m.sampleElevation(Xb,gc,Za)-ib,mc=tc-hb;Qb=(-dc+mc)*(-ec+Wb);Ob=(-wb+vb)*(-fc+yc);Kb=-(-dc+mc)*(-wb+vb)}}const Sb=1/Math.sqrt(Qb*Qb+Ob*Ob+Kb*Kb);ma.setNormalFromValues(Ra,Qb*Sb,Ob*Sb,Kb*
Sb)}}else for(let ya=1;ya<Ea-1;ya+=Ya){const Da=ya/xa,La=oa?Sa:c.clamp(X*(1-Da)+W*Da,fa,ka),Ta=oa?c.clamp(T*(1-Da)+U*Da,la,na):Ua,Xa=oa?bb:c.clamp(Da,ja,Z),db=oa?c.clamp(Da,ia,ha):Qa,fb=qa(La,Ta),jb=La*da-va,lb=ea(Ta)-wa,ob=fb-za;f.minMaxBoundingBox(jb,lb,ob,ca);ma.setVertexFromValuesRawPositionUV(ya,jb,lb,ob,Xa,db)}}}function x(I,G,H){return I?L=>(Math.PI/2-2*Math.atan(Math.exp(-L/G)))*G:L=>L*H}function u(I,G,H,L,O,S){const R=G-1,Q=I.vertexAttributes.count,V=2*(Math.min(G-2,L[1])-Math.max(1,L[0]))*
(Math.min(G-2,O[1])-Math.max(1,O[0])),aa=h.neighborEdgeIndices.map((ja,ia)=>0===ia&&O[1]<G-2||1===ia&&L[1]<G-2||2===ia&&1<O[0]||3===ia&&1<L[0]),X=I.outerEdges.reduce((ja,ia,Z)=>ja+(aa[Z]?0:R-2+ia.count-1),0),W=H.reduce((ja,ia)=>ja+R*(2*(ia.latitudeResolution-1)+1),0),T=S?2:1,U=3*(V+X+W)*T,Y=65536<=Q?new Uint32Array(U):new Uint16Array(U);let ba=0;const da=G-2,ea=R-2;h.internalAssert(0<=ea);const ca=(ja,ia,Z,ha,fa,ka)=>{var la=ja*fa;ja=ka[la];const na=ka[la+1];la=ka[la+2];var pa=ia*fa;ia=ka[pa];const va=
ka[pa+1];pa=ka[pa+2];var wa=Z*fa;Z=ka[wa];const za=ka[wa+1];wa=ka[wa+2];const sa=ha*fa;ha=ka[sa];fa=ka[sa+1];ka=ka[sa+2];return(ia-ha)*(ia-ha)+(va-fa)*(va-fa)+(pa-ka)*(pa-ka)>(ja-Z)*(ja-Z)+(na-za)*(na-za)+(la-wa)*(la-wa)};if(S){const ja=(ia,Z,ha)=>{Y[ba++]=ia;Y[ba++]=Z;Y[ba++]=Z;Y[ba++]=ha;Y[ba++]=ha;Y[ba++]=ia;h.ENABLE_TERRAIN_INTERNAL_CHECKS&&(h.internalAssert(ia<Q),h.internalAssert(Z<Q),h.internalAssert(ha<Q),h.internalAssert(ba<=U))};(()=>{for(let ia=Math.max(O[0],1)-1;ia<Math.min(O[1],G-2)-1;++ia){const Z=
ia*da;for(let ha=Math.max(L[0],1)-1;ha<Math.min(L[1],G-2)-1;++ha){const fa=ia*da+ha,ka=fa+1,la=ka+da,na=la-1,pa=Z+ha,va=pa+1,wa=va+da;ca(pa,va,wa,wa-1,I.vertexAttributes.position.typedBufferStride,I.vertexAttributes.position.typedBuffer)?(ja(fa,ka,la),ja(la,na,fa)):(ja(fa,ka,na),ja(na,la,ka))}}})();h.internalAssert(ba===3*V*T);(()=>{for(let Z=0;4>Z;++Z){const ha=ba;if(aa[Z])continue;const fa=I.outerEdges[Z],ka=I.innerEdges[Z];let la=0,na=0;const pa=fa.count,va=ka.count;h.internalAssert(va===R-1);
let wa=0;const za=1===Z||2===Z?(sa,ua,oa)=>ja(sa,ua,oa):(sa,ua,oa)=>ja(sa,oa,ua);for(;la<pa-1||na<va-1;){const sa=ka.getVertexIndex(na),ua=fa.getVertexIndex(la);var ia=la<pa-1;const oa=na<va-1,xa=ia?R*(la+.5)/(pa-1):0,Ea=oa?1+ea*(na+.5)/(va-1):0;ia&&(!oa||xa<=Ea)?(++la,h.ENABLE_TERRAIN_INTERNAL_CHECKS&&h.internalAssert(la<pa),ia=fa.getVertexIndex(la),za(sa,ua,ia)):(++na,h.ENABLE_TERRAIN_INTERNAL_CHECKS&&h.internalAssert(na<va),ia=ka.getVertexIndex(na),za(sa,ua,ia));wa++}h.ENABLE_TERRAIN_INTERNAL_CHECKS&&
(h.internalAssert(la===pa-1),h.internalAssert(na===va-1),h.internalAssert(wa===pa+va-2),h.internalAssert(wa===R-2+fa.count-1),h.internalAssert(ba===ha+3*wa*T))}})();h.internalAssert(ba===3*(V+X)*T);H.forEach(ia=>{var Z=I.outerEdges[ia.connectedOuterEdgeOffset];let ha=Z.getVertexIndex(0);Z=Z.stride;for(let fa=0;fa<ia.latitudeResolution;++fa){const ka=0===fa?ia.rowOffset:ha+G;for(let la=0;la<R;la++)ja(ha,ha+1,ka+la),fa<ia.latitudeResolution-1&&ja(ha+1,ka+la+1,ka+la),ha+=Z;ha=ka;Z=1}})}else(()=>{var ja=
Math.max(O[0],1)-1;const ia=Math.min(O[1],G-2)-1,Z=Math.max(L[0],1)-1,ha=Math.min(L[1],G-2)-1;for(;ja<ia;++ja){const fa=ja*da;for(let ka=Z;ka<ha;++ka){const la=fa+ka,na=la+1,pa=na+da,va=pa-1;ca(la,na,pa,va,I.vertexAttributes.position.typedBufferStride,I.vertexAttributes.position.typedBuffer)?(Y[ba]=la,Y[ba+1]=na,Y[ba+2]=pa,Y[ba+3]=pa,Y[ba+4]=va,Y[ba+5]=la):(Y[ba]=la,Y[ba+1]=na,Y[ba+2]=va,Y[ba+3]=va,Y[ba+4]=na,Y[ba+5]=pa);ba+=6}}})(),h.internalAssert(ba===3*V*T),(()=>{for(let fa=0;4>fa;++fa){if(aa[fa])continue;
var ja=I.outerEdges[fa],ia=I.innerEdges[fa];let ka=0,la=0;const na=ja.count,pa=ia.count;h.internalAssert(pa===R-1);var Z=1===fa||2===fa;const va=Z?1:2;Z=Z?2:1;const wa=ja.index0;ja=ja.stride;const za=ia.index0;for(ia=ia.stride;ka<na-1||la<pa-1;){const sa=za+la*ia,ua=wa+ka*ja;var ha=ka<na-1;const oa=la<pa-1,xa=ha?R*(ka+.5)/(na-1):0,Ea=oa?1+ea*(la+.5)/(pa-1):0;(ha=ha&&(!oa||xa<=Ea))?++ka:++la;ha=ha?ua+ja:sa+ia;Y[ba]=sa;Y[ba+va]=ua;Y[ba+Z]=ha;ba+=3}}})(),h.internalAssert(ba===3*(V+X)*T),H.forEach(ja=>
{var ia=I.outerEdges[ja.connectedOuterEdgeOffset];let Z=ia.getVertexIndex(0);ia=ia.stride;for(let ha=0;ha<ja.latitudeResolution;++ha){const fa=0===ha?ja.rowOffset:Z+G;for(let ka=0;ka<R;ka++){const la=fa+ka;Y[ba]=Z;Y[ba+1]=Z+1;Y[ba+2]=la;ha<ja.latitudeResolution-1?(Y[ba+3]=Z+1,Y[ba+4]=la+1,Y[ba+5]=la,ba+=6):ba+=3;Z+=ia}Z=fa;ia=1}});h.internalAssert(ba===U);I.indices=Y;I.indexCount=U}function y(I,G){const H=I.localOrigin,L=I.geometryInfo;I=I.geometryState.neighborData.edgeResolutions;const O=L.numVerticesPerSide-
2,S=L.vertexAttributes;for(let Q=0;4>Q;++Q){var R=0===Q||2===Q;L.innerEdges[Q]=new f.EdgeDescriptor(S,H,(0===Q?O-1:0)*O+(1===Q?O-1:0),(R?0:1)*O+(R?1:0),O);R=I[Q]+1;L.outerEdges[Q]=new f.EdgeDescriptor(S,H,G,1,R);G+=R}}function w(I,G,H){var L=(G+2)%4,O=I.tile,S=O.level-H.level;const R=1===G||3===G,Q=I.geometryState.neighborData.edgeResolutions[G];h.internalAssert(c.isPowerOfTwo(Q));const V=Q+1;var aa=I.geometryInfo;const X=aa.boundingBox;var W=aa.outerEdges[G];const T=aa.uvRange[0],U=aa.uvRange[1],
Y=aa.uvRange[2];aa=aa.uvRange[3];const ba=c.clamp(1===G?1:0,T,Y),da=c.clamp(0===G?1:0,U,aa);var ea=H.renderData,ca=ea.geometryState,ja=ea.geometryInfo.outerEdges[L];G=O.getNeighborEdgeStartVertexIndex(G,H)*Q;S=Q*2**S;h.internalAssert(ca.neighborData.edgeResolutions[L]===S);h.internalAssert(ja.count-1===S);L=ea.localOrigin[0]-I.localOrigin[0];S=ea.localOrigin[1]-I.localOrigin[1];I=ea.localOrigin[2]-I.localOrigin[2];var ia=W.attributes;ea=W.index0;W=W.stride;ca=ia.position.typedBuffer;H=ia.position.typedBufferStride;
O=ia.normalCompressed.typedBuffer;const Z=ia.normalCompressed.typedBufferStride;ia=ia.uv0;var ha=ja.attributes;const fa=ja.index0;ja=ja.stride;const ka=ha.position.typedBuffer,la=ha.position.typedBufferStride,na=ha.normalCompressed.typedBuffer;ha=ha.normalCompressed.typedBufferStride;for(let za=1;za<V-1;++za){const sa=ea+W*za;var pa=fa+ja*(G+za),va=sa*H,wa=pa*la;const ua=ka[wa]+L,oa=ka[wa+1]+S;wa=ka[wa+2]+I;ca[va]=ua;ca[va+1]=oa;ca[va+2]=wa;f.minMaxBoundingBox(ua,oa,wa,X);va=sa*Z;pa*=ha;O[va]=na[pa];
O[va+1]=na[pa+1];va=za/Q;pa=R?ba:c.clamp(va,T,Y);va=R?c.clamp(va,U,aa):da;f.encodeUVInBuffer(ia,sa,pa,va)}}function D(I){const G=I.geometryState,H=I.localOrigin,L=G.neighborData.cornerNeighborData,O=I.geometryInfo,S=O.outerEdges,R=O.boundingBox,Q=I.tile,V="local"===I.tile.surface.view?.viewingMode,aa=Q.ellipsoid.radius,X=Q.extentInRadians,W=Q.horizontalScale;let T=0,U=0,Y=0;const ba=()=>{const Qa=I.geometryState.clippingArea,Aa=Q.extent,Ca=b.isSome(Qa)&&(Aa[3]>Qa[3]||Aa[2]>Qa[2]||Aa[1]<Qa[1]||Aa[0]<
Qa[0]),qa=x(Q.surface.isWebMercatorOnPlateeCarree,Q.ellipsoid.radius,W);return(ya,Da,La)=>{ya=0===ya?wa[0]:wa[2];Da=0===Da?wa[1]:wa[3];ya=Ca?c.clamp(ya,Qa[0],Qa[2]):ya;Da=Ca?c.clamp(Da,Qa[1],Qa[3]):Da;T=ya*W;U=qa(Da);Y=La}},da=(Qa,Aa,Ca)=>{var qa=X[0===Aa?1:3];Qa=X[0===Qa?0:2];Aa=Math.cos(qa);qa=Math.sin(qa);const ya=Math.sin(Qa);Ca=aa+Ca;T=Math.cos(Qa)*Aa*Ca;U=ya*Aa*Ca;Y=qa*Ca},ea=V?ba():da;let ca=0,ja=0,ia=0,Z=0,ha=0,fa=0,ka=0,la=0,na=0;const pa=V&&I.tile.surface.isWebMercatorOnPlateeCarree,va=
(Qa,Aa,Ca,qa,ya)=>{var Da=0,La=0;let Ta=0;V?(Ca=pa?(Math.PI/2-2*Math.atan(Math.exp(-Ca/aa)))*aa:Ca*W,Da=Aa*W-T,La=Ca-U,Ta=qa-Y):(Da=z(Qa),Qa=Qa.tile,La=Qa.extent,Qa=Qa.extentInRadians,Aa=(Aa-La[0])/(La[2]-La[0]),Aa=Qa[0]*(1-Aa)+Qa[2]*Aa,Da=Da((Ca-La[1])/(La[3]-La[1])),Ca=Math.cos(Da),Qa=Math.sin(Da),La=Math.sin(Aa),qa=aa+qa,Da=Math.cos(Aa)*Ca*qa-T,La=La*Ca*qa-U,Ta=Qa*qa-Y);switch(ya){case 0:ka+=Da;la+=La;na+=Ta;break;case 1:Z-=Da;ha-=La;fa-=Ta;break;case 2:ka-=Da;la-=La;na-=Ta;break;case 3:Z+=Da,
ha+=La,fa+=Ta}},wa=Q.extent,za=G.clippingArea,sa=b.isSome(za)?za:N,ua=wa[0],oa=wa[2],xa=wa[1],Ea=wa[3],Ia=[Ea>sa[3],oa>sa[2],xa<sa[1],ua<sa[0]],Na=Math.max(ua,sa[0]),Oa=Math.min(oa,sa[2]),Ja=Math.max(xa,sa[1]),Sa=Math.min(Ea,sa[3]),Ua=O.uvRange[0],Za=O.uvRange[1],ma=O.uvRange[2],Ya=O.uvRange[3],bb=Qa=>{Qa=L[Qa].cornerTiles;ja=ca=0;ia=1;var Aa=Infinity;for(var Ca=0;4>Ca;++Ca)Aa=Math.min(Aa,Qa[Ca]?.level??Infinity);for(Ca=0;4>Ca;++Ca){var qa=Qa[Ca];P[Ca]=qa?.level===Aa?qa:null}Qa=1;Aa=0;for(Ca=0;4>
Ca;++Ca)if(qa=P[Ca])Qa=Math.max(Qa,qa?.renderData.geometryState.numVerticesPerSide),Aa=qa.extent[2]-qa.extent[0];h.internalAssert(1<Qa);Qa=Aa/Qa;for(Aa=0;4>Aa;++Aa){var ya=P[(Aa+3)%4],Da=P[Aa%4];if(ya||Da){qa=0===Aa?1:1===Aa?2:2===Aa?3:0;var La=0===Aa?2:1===Aa?3:2===Aa?0:1;if(ya&&Da){var Ta=J[Aa][0]*Qa,Xa=J[Aa][1]*Qa,db=ya.extent;Ca=db[0===qa||1===qa?2:0]+Ta;qa=db[0===qa||3===qa?3:1]+Xa;db=Da.extent;Ta=db[0===La||1===La?2:0]+Ta;La=db[0===La||3===La?3:1]+Xa;ya=ya.renderData;Xa=Da.renderData;Da=m.sampleElevation(Ca,
qa,ya.geometryState.samplerData);La=m.sampleElevation(Ta,La,Xa.geometryState.samplerData);va(ya,Ca,qa,.5*(Da+La),Aa)}else Ca=ya??Da,ya=ya?qa:La,Da=Ca.extent,La=J[Aa],qa=Da[0===ya||1===ya?2:0]+La[0]*Qa,ya=Da[0===ya||3===ya?3:1]+La[1]*Qa,Ca=Ca.renderData,Da=m.sampleElevation(qa,ya,Ca.geometryState.samplerData),va(Ca,qa,ya,Da,Aa)}}V||(Qa=Math.sqrt(T*T+U*U+Y*Y),ca=T/Qa,ja=U/Qa,ia=Y/Qa);Qa=Math.sqrt(Z*Z+ha*ha+fa*fa);Z/=Qa;ha/=Qa;fa/=Qa;Qa=Math.sqrt(ka*ka+la*la+na*na);ka/=Qa;la/=Qa;na/=Qa;if(V||.999>ia*
ia)ca=fa*la-ha*na,ja=Z*na-fa*ka,ia=ha*ka-Z*la,Qa=1/Math.sqrt(ca*ca+ja*ja+ia*ia),ca*=Qa,ja*=Qa,ia*=Qa};for(let Qa=0;4>Qa;++Qa){const Aa=Qa,Ca=(Qa+1)%4,qa=0===Qa||1===Qa?1:0,ya=0===Qa||3===Qa?1:0,Da=c.clamp(qa,Ua,ma),La=c.clamp(ya,Za,Ya),Ta=S[Aa],Xa=0===Qa||3===Qa?Ta.count-1:0,db=S[Ca],fb=0===Qa||1===Qa?db.count-1:0,jb=L[Qa].cornerTiles;let lb=-1;for(let Bb=0;4>Bb;++Bb){const rb=jb[Bb];rb&&(-1===lb||0<v.compareTilesByLij(jb[lb],rb))&&(lb=Bb)}const ob=lb,xb=jb[ob],Nb=xb!==Q;ja=ca=0;ia=1;if(Nb){const Bb=
Q.level-xb.level,rb=2**Bb,mb=[xb.lij[0]+Bb,xb.lij[1]*rb,xb.lij[2]*rb],eb=[mb[1]+rb===Q.lij[1],0===Qa&&(1===ob||0===ob&&xb!==jb[3])||1===Qa&&(0===ob||1===ob&&xb!==jb[2]),mb[1]===Q.lij[1]+1,2===Qa&&(3===ob||2===ob&&xb!==jb[1])||3===Qa&&(2===ob||3===ob&&xb!==jb[0])],cb=eb.reduce((vb,Wb)=>vb+(Wb?1:0),0);h.internalAssert(1===cb||2===cb);let Ka=-1,Ha=-1;const ra=xb.renderData;if(1===cb){const vb=eb.findIndex(wb=>wb);h.internalAssert(0<=vb&&3>=vb);Ka=(vb+2)%4;const Wb=I.geometryState.neighborData.edgeResolutions[vb];
Ha=Q.getNeighborEdgeStartVertexIndex(vb,xb)*Wb+Wb*(0===vb&&0===Qa||1===vb&&0===Qa||2===vb&&1===Qa||3===vb&&3===Qa?1:0)}else{h.internalAssert(eb[1]||eb[3]);Ka=eb[1]?3:1;const vb=ra.geometryState.neighborData.edgeResolutions[Ka];Ha=0===Qa||3===Qa?0:vb}const Ga=ra.geometryInfo.outerEdges[Ka],Pa=Ta.index0+Xa*Ta.stride,Ra=db.index0+fb*db.stride,Va=Ga.index0+Ha*Ga.stride,ab=Ga.attributes.position,hb=ab.typedBuffer,ib=Va*ab.typedBufferStride,kb=I.localOrigin,pb=Ga.localOrigin,ub=hb[ib]+pb[0]-kb[0],Eb=hb[ib+
1]+pb[1]-kb[1],Ib=hb[ib+2]+pb[2]-kb[2];f.minMaxBoundingBox(ub,Eb,Ib,R);const tb=Ta.attributes.position,nb=tb.typedBuffer,yb=Pa*tb.typedBufferStride;nb[yb]=ub;nb[yb+1]=Eb;nb[yb+2]=Ib;const Fb=db.attributes.position,Jb=Fb.typedBuffer,Pb=Ra*Fb.typedBufferStride;Jb[Pb]=ub;Jb[Pb+1]=Eb;Jb[Pb+2]=Ib;f.encodeUVInBuffer(Ta.attributes.uv0,Pa,Da,La);f.encodeUVInBuffer(db.attributes.uv0,Ra,Da,La);const Gb=Ga.attributes.normalCompressed.typedBuffer,Tb=Va*Ga.attributes.normalCompressed.typedBufferStride,zb=Ta.attributes.normalCompressed,
Rb=zb.typedBuffer,Qb=Pa*zb.typedBufferStride;Rb[Qb]=Gb[Tb];Rb[Qb+1]=Gb[Tb+1];const Ob=db.attributes.normalCompressed,Kb=Ob.typedBuffer,Sb=Ra*Ob.typedBufferStride;Kb[Sb]=Gb[Tb];Kb[Sb+1]=Gb[Tb+1]}else{const Bb=Ia[Ca];let rb=void 0;if(Ia[Aa]||Bb){const Ka=c.clamp(ua*(1-qa)+oa*qa,Na,Oa),Ha=c.clamp(xa*(1-ya)+Ea*ya,Ja,Sa);rb=m.sampleElevation(Ka,Ha,G.samplerData)}else rb=F(jb);ea(qa,ya,rb);bb(Qa);const mb=T-H[0],eb=U-H[1],cb=Y-H[2];f.minMaxBoundingBox(mb,eb,cb,R);Ta.setVertexFromValuesRawPositionUVNormal(Xa,
mb,eb,cb,Da,La,ca,ja,ia);db.setVertexFromValuesRawPositionUVNormal(fb,mb,eb,cb,Da,La,ca,ja,ia)}}for(let Qa=0;4>Qa;++Qa)P[Qa]=null}function F(I){const G=I.reduce((S,R)=>Math.min(S,R?.level??Infinity),Infinity);h.ENABLE_TERRAIN_INTERNAL_CHECKS&&(h.internalAssert(!I[0]||!I[2]||l.isCornerNeighbor(I[0],I[2],d.NeighborIndex.SOUTH_WEST)),h.internalAssert(!I[1]||!I[3]||l.isCornerNeighbor(I[1],I[3],d.NeighborIndex.NORTH_WEST)));let H=0,L=0;for(let S=0;4>S;++S){var O=I[S];if(O&&O.level===G){const R=O.extent;
O=m.sampleElevation(R[0===S||1===S?0:2],R[0===S||3===S?1:3],O.renderData?.geometryState?.samplerData);L+=O;H++}}I=H?L/H:0;h.internalAssert(null!=I);return I}function E(I){const G=I.geometryInfo.vertexAttributes.position.typedBuffer;I.vao.vertexBuffers.geometry.setSubData(G,0,0,G.length)}function K(I,G,H){if(!G)return!1;I=v.compareTilesByLij(I,G);return 0<I||0===I&&2<=H}const J=[[0,1],[1,0],[0,-1],[-1,0]],M=new e.PatchGeometryLUT,N=r.fromValues(-Infinity,-Infinity,Infinity,Infinity),P=[null,null,null,
null];a.createInternalVerticesPositionsSpherical=function(I){var G=I.geometryState,H=G.numVerticesPerSide;const L=H-2;--H;var O=I.geometryInfo,S=O.vertexAttributes,R=S.position;S=S.uv0;var Q=I.tile,V=Q.extent;const aa=V[0],X=V[2],W=V[1];V=V[3];Q=Q.ellipsoid.radius;G=G.samplerData;var T=I.localOrigin;I=T[0];const U=T[1];T=T[2];O=O.boundingBox;const Y=R.typedBuffer;R=R.typedBufferStride;let ba=0;for(let ja=1;ja<=L;ja++){const ia=ja/H,Z=W*(1-ia)+V*ia,ha=M.sinLatLUT[ja],fa=M.cosLatLUT[ja];for(let ka=
1;ka<=L;ka++){const la=ka/H;var da=M.sinLonLUT[ka],ea=M.cosLonLUT[ka],ca=Q+m.sampleElevation(aa*(1-la)+X*la,Z,G);ea=ea*fa*ca-I;da=da*fa*ca-U;ca=ha*ca-T;f.minMaxBoundingBox(ea,da,ca,O);const na=ba*R;Y[na]=ea;Y[na+1]=da;Y[na+2]=ca;f.encodeUVInBuffer(S,ba,la,ia);++ba}}};a.createPlanarGlobePatch=function(I,G){var H=I.tile.extent;G=I.geometryState;var L=H[0],O=H[1],S=H[2]-L,R=H[3]-O,Q=G.clippingArea;H=b.isSome(Q)?Math.max(0,(Q[0]-L)/S):0;const V=b.isSome(Q)?Math.max(0,(Q[1]-O)/R):0;L=b.isSome(Q)?Math.min(1,
(Q[2]-L)/S):1;O=b.isSome(Q)?Math.min(1,(Q[3]-O)/R):1;S=G.numVerticesPerSide;R=(S-2)**2;Q=G.neighborData.edgeResolutions.reduce((X,W)=>X+W+1,0);Q=f.acquireTerrainAttributes(R+Q);const aa=I.geometryInfo;n.empty(aa.boundingBox);aa.numVerticesPerSide=G.numVerticesPerSide;aa.vertexAttributes=Q;t.set(aa.uvRange,H,V,L,O);C(I);y(I,R);B(I);u(aa,G.numVerticesPerSide,[],[0,S-1],[0,S-1],G.wireframe);I.intersectionData=null};a.createSphericalGlobePatch=function(I,G){const H=I.tile,{extent:L,extentInRadians:O,
surface:S}=H,R=I.localOrigin,Q=I.geometryState;var V=S.isWebMercator;const aa=S.shading||!0,X=Q.numVerticesPerSide,W=X-1,T=(X-2)**2,U=V&&(G===d.PatchType.HAS_SOUTH_POLE||G===d.PatchType.HAS_BOTH_POLES),Y=V&&(G===d.PatchType.HAS_NORTH_POLE||G===d.PatchType.HAS_BOTH_POLES);V=6*((U?1:0)+(Y?1:0))*(W+1);G=Q.neighborData;const ba=G.edgeResolutions.reduce((ia,Z)=>ia+Z+1,0),da=f.acquireTerrainAttributes(T+V+ba);V=I.geometryInfo;V.numVerticesPerSide=Q.numVerticesPerSide;V.vertexAttributes=da;const ea=V.boundingBox;
n.empty(ea);const ca=z(I);M.update(W,O,ca);q(I);y(I,T);k(I);const ja=[];(()=>{let ia=T+ba;const Z=R[0],ha=R[1],fa=R[2],ka=H.ellipsoid.radius,la=L[1],na=L[3],pa=(va,wa)=>{wa*=X;f.minMaxBoundingBox(-Z,-ha,-fa+va*ka,ea);ja.push({connectedRowOffset:wa,connectedOuterEdgeOffset:1===va?0:2,rowOffset:ia,latitudeResolution:6});wa=Math.PI/2-2*Math.atan(Math.exp(-(-1===va?la:na)/ka));const za=va*Math.PI/2-wa;va=.99*(1===va?1:-1);const sa=ka+0,ua=da.position,oa=da.uv0,xa=da.normalCompressed;for(let Ia=1;6>=Ia;++Ia){var Ea=
wa+Ia/6*za;const Na=Math.cos(Ea);Ea=Math.sin(Ea);for(let Oa=0;Oa<=W;Oa++){const Ja=Oa/W,Sa=M.cosLonLUT[Oa]*Na,Ua=M.sinLonLUT[Oa]*Na,Za=Ea,ma=Sa*sa-Z,Ya=Ua*sa-ha,bb=Za*sa-fa;f.minMaxBoundingBox(ma,Ya,bb,ea);ua.setValues(ia,ma,Ya,bb);f.encodeUVInBuffer(oa,ia,Ja,va);aa&&f.encodeNormalToBufferFromValues(xa,ia,Sa,Ua,Za);++ia}}};U&&pa(-1,0);Y&&pa(1,W)})();u(V,Q.numVerticesPerSide,ja,[0,X-1],[0,X-1],Q.wireframe);I.intersectionData=null;if(h.ENABLE_TERRAIN_INTERNAL_CHECKS)for(I=0;4>I;++I)h.internalAssert(V.outerEdges[I].count===
G.edgeResolutions[I]+1)};a.updateCornerSpherical=function(I){I.tile.intersectsClippingArea&&(D(I),p(I,!0),E(I))};a.updateCornersPlanar=function(I,G){I.tile.intersectsClippingArea&&(D(I),A(I,!0),E(I))};a.updateEdgesAndCornersPlanar=function(I,G){I.tile.intersectsClippingArea&&(B(I),E(I))};a.updateEdgesAndCornersSpherical=function(I){I.tile.intersectsClippingArea&&(k(I),E(I))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../core/mathUtils ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferPool ../support/buffer/InterleavedLayout ./terrainUtils ../webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f){function e(z,C,B,A,x){var u=1/(Math.abs(B)+Math.abs(A)+Math.abs(x));B*=u;A*=u;u=0>=x?(0<=A?1:-1)*(1-Math.abs(B)):A;z.setValues(C,l(0>=x?(0<=B?1:-1)*(1-Math.abs(A)):B),l(u))}function g(z,C){const B=v(C[0]);C=v(C[1]);const A=1-Math.abs(B)-Math.abs(C);z[2]=A;0>A?(z[0]=(0<=B?1:-1)*(1-Math.abs(C)),z[1]=(0<=C?1:-1)*(1-Math.abs(B))):(z[0]=B,z[1]=C);t.normalize(z,z)}function h(z,C,B,A){z.setValues(C,16384*B,16384*A)}function l(z){return c.clamp(Math.round(32767*z),-32767,32767)}
function v(z){return c.clamp(z/32767,-1,1)}let q=function(){function z(B,A,x,u,y){this.attributes=B;this.localOrigin=A;this.index0=x;this.stride=u;this.count=y}var C=z.prototype;C.getVertexIndex=function(B){return this.getAttributeIndex(B)};C.getAttributeIndex=function(B){d.internalAssert(0<=B&&B<this.count);return this.index0+this.stride*B};C._getVertexRaw=function(B,A){this.attributes.position.getVec(B,A)};C._getNormalRaw=function(B,A){this.attributes.normalCompressed.getVec(B,A)};C.getVertexPos=
function(B,A){this._getVertexRaw(this.getAttributeIndex(A),B);t.add(B,B,this.localOrigin)};C.getNormal=function(B,A){const x=b.create();this._getNormalRaw(this.getAttributeIndex(A),x);g(B,x)};C._setNormal=function(B,A,x,u){e(this.attributes.normalCompressed,B,A,x,u)};C._setUV=function(B,A,x){h(this.attributes.uv0,B,A,x)};C.setNormalFromValues=function(B,A,x,u){this._setNormal(this.getAttributeIndex(B),A,x,u)};C.setVertexFromValuesRawPositionUV=function(B,A,x,u,y,w){B=this.getAttributeIndex(B);this.attributes.position.setValues(B,
A,x,u);this._setUV(B,y,w)};C.setVertexFromValuesRawPositionUVNormal=function(B,A,x,u,y,w,D,F,E){B=this.getAttributeIndex(B);this.attributes.position.setValues(B,A,x,u);this._setUV(B,y,w);this._setNormal(B,D,F,E)};return z}();const k=m.newLayout().vec3f(f.VertexAttribute.POSITION).vec2i16(f.VertexAttribute.UV0).vec2i16(f.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0}),p=new r.BufferPool(z=>k.createBuffer(z),z=>z.count);a.EdgeDescriptor=q;a.PatchGeometry=function(){this.vertexAttributes=this.indices=
null;this.boundingBox=n.empty();this.numVerticesPerSide=this.indexCount=0;this.uvRange=[0,0,1,1];this.outerEdges=[null,null,null,null];this.innerEdges=[null,null,null,null]};a.acquireTerrainAttributes=function(z){return p.acquire(z)};a.clearCaches=function(){p.clear()};a.decodeInt16=v;a.decodeNormal=g;a.encodeInt16=l;a.encodeNormalToBufferFromValues=e;a.encodeUVInBuffer=h;a.minMaxBoundingBox=function(z,C,B,A){z<A[0]?A[0]=z:z>A[3]&&(A[3]=z);C<A[1]?A[1]=C:C>A[4]&&(A[4]=C);B<A[2]?A[2]=B:B>A[5]&&(A[5]=
B)};a.releaseGeometry=function(z){p.release(z.vertexAttributes);z.vertexAttributes=null;z.indices=null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/buffer/BufferPool":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,c,b){let t=function(){function n(m,d){this._factoryCallback=m;this._lengthCallback=d;this._pool=new Map}var r=n.prototype;r.acquire=function(m){if(!n.test.disabled){var d=this._pool.get(m);
if(d&&0!==d.length)return d.pop()}try{return this._factoryCallback(m)}catch(f){d=window.performance&&window.performance.memory;let e="";d&&(e=`\n  totalJSHeapSize: ${d.totalJSHeapSize}, usedJSHeapSize: ${d.usedJSHeapSize}, jsHeapSizeLimit: ${d.jsHeapSizeLimit}`);console.log("Array allocation of size "+m+" failed: "+f+e);throw f;}};r.release=function(m){if(!n.test.disabled){var d=this._lengthCallback(m),f=this._pool.get(d);f||(f=new b({shrink:!0}),this._pool.set(d,f));f.push(m)}};r.clear=function(){this._pool.clear()};
c._createClass(n,[{key:"test",get:function(){return{size:this._pool.size}}}]);return n}();t.test={disabled:!1};a.BufferPool=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports","./TerrainConst"],function(a,c){let b=function(){function t(){this.sinLonLUT=Array(c.MAX_PATCH_TESSELATION+1);this.cosLonLUT=Array(c.MAX_PATCH_TESSELATION+1);this.sinLatLUT=Array(c.MAX_PATCH_TESSELATION+1);this.cosLatLUT=Array(c.MAX_PATCH_TESSELATION+
1)}t.prototype.update=function(n,r,m){const d=r[0];r=r[2];for(let e=0;e<=n;e++){var f=e/n;const g=d*(1-f)+r*f;this.sinLonLUT[e]=Math.sin(g);this.cosLonLUT[e]=Math.cos(g);f=m(f);this.sinLatLUT[e]=Math.sin(f);this.cosLatLUT[e]=Math.cos(f)}};return t}();a.PatchGeometryLUT=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./GeometryState ./interfaces ./LayerClass ./PatchGeometry ./terrainUtils ./TextureFader ./Tile ./TileOverlayData ./tileUtils ../webgl-engine/lib/VertexArrayObject ../webgl-engine/shaders/TerrainTechnique ../../webgl/BufferObject".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){function y(P,I){return I?.isLoaded||I===P?I:null}let w=function(){function P(){this.geometryInfo=new q.PatchGeometry;this.geometryState=this.intersectionData=null;this._textureRef=new p.TextureFader(()=>this.tile.surface.textureFadeDuration);this.overlay=new C;this._geometryStateChangedSinceLastUpdate=!0;this._shadingChanged=this._wireframeChanged=this._clippingAreaChanged=this._samplerDataChanged=this._numVerticesPerSideChanged=this._hasGeometry=
!1;this._dirtyCorners=this._dirtyEdges=this._dirtyEdgeResolutions=15}var I=P.prototype;I.init=function(G){this.clear();this._tile=G;G=this.geometryInfo;G.indices=null;G.vertexAttributes=null;d.empty(G.boundingBox);G.indexCount=0;G.numVerticesPerSide=0;this.intersectionData=null;this.geometryState=new h.GeometryState;this.localOrigin=null;this.overlay.clear()};I.clear=function(){this.releaseGeometry();this.releaseTexture();this._textureRef.clear();this.geometryState=this.intersectionData=this._tile=
null};I.updateGeometryIfNeeded=function(G){if(!this._vao||this._geometryStateChangedSinceLastUpdate||this._wireframeChanged||this._shadingChanged||this._clippingAreaChanged||this._samplerDataChanged||this._numVerticesPerSideChanged||this._dirtyCorners||this._dirtyEdgeResolutions||this._dirtyEdges)this._updateGeometry(G),this._geometryStateChangedSinceLastUpdate=!1;if(k.ENABLE_TERRAIN_INTERNAL_CHECKS&&this.tile.intersectsClippingArea)for(G=0;4>G;++G)k.internalAssert(this.geometryInfo.outerEdges[G].count===
this.geometryState.neighborData.edgeResolutions[G]+1)};I._calculateEdgeResolution=function(G,H){const L=this.tile,O=this.geometryState.numVerticesPerSide-1;if(!L.surface.isGlobal){var S=L.surface.extent;if(n.isSome(S)&&(0===G&&L.extent[3]>S[3]||1===G&&L.extent[2]>S[2]||2===G&&L.extent[1]<S[1]||3===G&&L.extent[0]<S[0]))return O}const R=L.level;S=k.neighborEdgeIndices[G];if(!H)return k.internalAssert(n.isNone(L.surface?.rootTiles)||L.surface.updatingRootTiles||!L.shouldHaveNeighbor(S)),O;if(H.isLoaded)return S=
H.renderData.geometryState,H=R-H.level,k.internalAssert(0<=H),0===H?Math.max(S.numVerticesPerSide-1,O):Math.max(1,S.neighborData.edgeResolutions[(G+2)%4]/2**H);k.internalAssert(!H.isLeaf);let Q=O;H.forAllSubtreeOnSide(k.oppositeEdge(S),V=>{if(V===L)return!0;if(V.isLoaded)return Q=Math.max(Q,2**(V.level-R)),!0;k.internalAssert(!V.isLeaf);return!1});return Q};I.updateNeighborData=function(){const G=this.tile;if(G.intersectsClippingArea){var H=G.renderData.geometryState.neighborData,L=W=>(W.isLoaded||
W.level===G.level)&&W?.intersectsClippingArea,O=H.edgePeerNeighbors,S=H.edgePeerNeighborSamplerVersions;for(var R=0;4>R;++R){var Q=G.findNeighborTile(k.neighborEdgeIndices[R],L),V=y(G,Q),aa=V?.renderData?.geometryState.samplerDataVersion??-1,X=y(G,O[R]);V=V!==X;X=S[R]!==aa;O[R]=Q;if(V||X)S[R]=aa,this._markEdgeDirty(R);aa=H.edgeResolutions[R];Q=this._calculateEdgeResolution(R,Q);k.internalAssert(t.isPowerOfTwo(Q));k.internalAssert(1<=Q);H.edgeResolutions[R]=Q;aa!==Q&&this._markEdgeResolutionDirty(R)}S=
H.cornerPeerNeighbors;for(R=0;4>R;++R){V=G.findNeighborTile(k.neighborCornerIndices[R],L);S[R]=V;Q=y(G,O[R]);aa=y(G,O[(R+1)%4]);V=y(G,V);N[R]=V;N[(R+1)%4]=aa;N[(R+2)%4]=G;N[(R+3)%4]=Q;k.internalAssert(N.some(T=>T?.isLoaded||T===G));const W=N.reduce((T,U)=>Math.min(T,U?.level??Infinity),Infinity);N.forEach((T,U)=>{T&&T?.level>W&&(N[U]=null)});k.internalAssert(N.some(T=>T?.isLoaded||T===G));Q=H.cornerNeighborData[R].cornerTiles;aa=H.cornerNeighborData[R].cornerTileSamplerVersions;for(V=0;4>V;++V){X=
N[V];const T=X?.renderData.geometryState.samplerDataVersion??-1,U=Q[V]!==X,Y=!U&&aa[V]!==T;if(U||Y)Q[V]=X,aa[V]=T,this._markCornerDirty(R)}k.internalAssert(Q.some(T=>T?.isLoaded||T===G))}k.ENABLE_TERRAIN_INTERNAL_CHECKS&&k.internalAssert(this.geometryState.neighborData.edgeResolutions.every(W=>0<W));for(H=0;4>H;++H)N[H]=null}};I._updateGeometry=function(G){if(this.tile.intersectsClippingArea){k.ENABLE_TERRAIN_INTERNAL_CHECKS&&k.internalAssert(!this.tile.intersectsClippingArea||this.geometryState.neighborData.edgeResolutions.every(R=>
0<R));this.intersectionData=null;var H=this.tile,L=this.geometryInfo.vertexAttributes;L=!this._vao||!L||this._wireframeChanged||this._shadingChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||this._dirtyEdgeResolutions;var O=!L&&(0!==this._dirtyEdges||0!==this._dirtyEdgeResolutions),S=!O&&0!==this._dirtyCorners;L?(this.releaseGeometry(),this._createGeometry(G)):O||S?H.updateEdgeElevations():S?H.updateCornerElevations():console.warn("Update for no reason?");
this._samplerDataChanged=this._numVerticesPerSideChanged=!1;this._dirtyCorners=this._dirtyEdges=this._dirtyEdgeResolutions=0;this._shadingChanged=this._wireframeChanged=this._clippingAreaChanged=!1}};I.releaseGeometry=function(){this._hasGeometry=!1;this.intersectionData=null;if(!this._vao)return!1;this._vao.dispose();this._vao=null;q.releaseGeometry(this.geometryInfo);return!0};I.ensureTexture=function(G,H){n.isSome(this._texture)&&this._texture.descriptor.width!==G&&this.releaseTexture();n.isNone(this._texture)&&
(this._texture=H(),this.tile.setMemoryDirty());return this._texture};I.releaseTexture=function(){n.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};I._markCornerDirty=function(G){this._dirtyCorners|=1<<G};I._markEdgeDirty=function(G){this._dirtyEdges|=1<<G};I._markEdgeResolutionDirty=function(G){G=1<<G;this._dirtyEdgeResolutions|=G;this._dirtyEdges|=G};I._markAllEdgesAndCornersDirty=function(){this._dirtyEdgeResolutions=this._dirtyEdges=this._dirtyCorners=
15};I.updateGeometryState=function(){var G=this._getElevationInfo(),H=this.tile,L=G.samplerData?H.getElevationVerticesPerSide(G.maxTileLevel):H.getDefaultVerticesPerSide();const O=Math.max(L,5);let S=H.clippingArea;if(!H.intersectsClippingArea||H.isWithinClippingArea)S=null;L=this.geometryState;let R=!1;L.numVerticesPerSide!==O&&(this._numVerticesPerSideChanged=!0,L.numVerticesPerSide=O,L.samplerDataVersion++,R=!0);G.changed&&(this._samplerDataChanged=!0,L.samplerData=G.samplerData,L.samplerDataVersion++,
R=!0);b.equals(L.clippingArea,S)||(this._clippingAreaChanged=!0,L.clippingArea=S,R=!0);G=H.surface;H=G.wireframe;L.wireframe!==H&&(this._wireframeChanged=!0,L.wireframe=H,R=!0);G=G.shading;L.shading!==G&&(this._shadingChanged=G,R=L.shading=G);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=R);R&&this._markAllEdgesAndCornersDirty();this._hasGeometry=!0;return this._geometryStateChangedSinceLastUpdate};I._createGeometry=function(G){this.tile.createGeometry();const H=
this.geometryInfo.vertexAttributes,L=this.geometryInfo.indices,O=G.gl;this._vao=new A.VertexArrayObject(G,x.terrainVertexAttributeLocations,{geometry:g.glLayout(H.layout)},{geometry:u.BufferObject.createVertex(G,O.STATIC_DRAW,H.buffer)},u.BufferObject.createIndex(G,O.STATIC_DRAW,L));this._hasGeometry=!0};I.setTextureReference=function(G,H=p.ActivationTime.Immediate){n.isSome(G)&&G.texture!==this._texture&&this.releaseTexture();this._textureRef.push(G,H)};I._getElevationInfo=function(){var G=this.geometryState.samplerData;
const H=this.tile.layerInfo[v.LayerClass.ELEVATION],L=H.length,O=Array(L);let S=0;var R=0;let Q=!1;for(let X=0;X<L;X++){var V=H[X];if(n.isSome(V.upsampleInfo)){V=V.upsampleInfo.tile;var aa=V.layerInfo[v.LayerClass.ELEVATION][X].data;aa=aa&&aa.samplerData;G&&G[S]===aa||(Q=!0);O[S++]=aa;R=Math.max(R,V.lij[0])}else V.data&&(aa=this.tile.surface.layerViewByIndex(X,v.LayerClass.ELEVATION),B.fallsWithinLayer(this.tile,aa.layer,!1)&&(R=V.data,G&&G[S]===R.samplerData||(Q=!0),O[S++]=R.samplerData,R=this.tile.level))}n.isSome(G)&&
G.length!==S&&(Q=!0);if(G=0<S)O.length=S;return{changed:Q,samplerData:G?O:null,maxTileLevel:R}};I.checkGeometryWaterproofness=function(){if(k.ENABLE_TERRAIN_INTERNAL_CHECKS){var G=this.tile;k.internalAssert(G?.isLoaded);if(G.isLoaded&&G.intersectsClippingArea){var H=G.renderData;if(0!==G.level){var L=G.surface.extent;if(!n.isSome(L)||G.intersectsExtent(L)){var O=k.neighborEdgeIndices.map((V,aa)=>n.isSome(L)?0>(2>aa?-1:1)*(G.extent[3-aa]-L[3-aa]):!1),S=G.level;k.internalAssert(0===this._dirtyCorners);
k.internalAssert(0===this._dirtyEdges);k.internalAssert(0===this._dirtyEdgeResolutions);k.internalAssert(!this._numVerticesPerSideChanged);k.internalAssert(!this._samplerDataChanged);k.internalAssert(!this._clippingAreaChanged);k.internalAssert(!this._wireframeChanged);var R=k.neighborCornerIndices.map(V=>G.findNeighborCornerTileExact(V,aa=>!aa.intersectsClippingArea||aa.isLoaded||aa.level===G.level)??null).map(V=>V?.intersectsClippingArea?V:null),Q=this.geometryState.neighborData;for(let V=0;4>V;++V){const aa=
Q.cornerPeerNeighbors[V],X=R[V];k.internalAssert(X===aa,`Tile[${G.lij}].corner[${V}] out of date: cur=[${aa?.lij}] exp=[${X?.lij}]`)}k.neighborEdgeIndices.forEach((V,aa)=>{if(!O[aa]){var X=G.findNeighborTile(V,na=>(na.level===S||na?.isLoaded)&&na?.intersectsClippingArea);if(X){k.internalAssert(X.isLoaded||X.level===G.level);k.internalAssert(X===this.geometryState.neighborData.edgePeerNeighbors[aa]);var W=S-X.level;if(X.isLoaded){var T=X.renderData;k.internalAssert(z.isEdgeNeighbor(G,X,V));k.internalAssert(0<=
W);var U=2**W;if(0>W)k.internalAssert(!1);else{var Y=H.geometryInfo,ba=Y.outerEdges[aa],da=Y.numVerticesPerSide-1,ea=T.geometryInfo;if(ea){Y=this.geometryState.neighborData.edgePeerNeighbors[aa];if(Y?.isLoaded){var ca=Y.renderData;k.internalAssert(Y===Y);k.internalAssert(H.geometryState.neighborData.edgePeerNeighborSamplerVersions[aa]===ca.geometryState.samplerDataVersion);k.internalAssert(this.geometryState.neighborData.edgePeerNeighborSamplerVersions[aa]===ca.geometryState.samplerDataVersion)}var ja=
(aa+2)%4,ia=ea.outerEdges[ja];Y=ba.count-1;ca=ia.count-1;k.internalAssert(Y*U===ca,`Tile[${G.lij}]:e${aa},res=${Y} edgeRes mismatch with`+` Neighbor[${X.lij}]:e${ja},res=${ca} (expected:${Y*U})`);Y=G.extent;ca=V===l.NeighborIndex.NORTH||V===l.NeighborIndex.SOUTH;var Z=ia.count-1,ha=Z/2**W,fa=ba.count-1;if(1>ha)k.internalAssert(1===fa);else{k.internalAssert(ha===fa);k.internalAssert(t.isPowerOfTwo(ha));ea=ea.numVerticesPerSide-1;k.internalAssert(0<W||ha===Math.max(ea,da));W=G.getNeighborEdgeStartVertexIndex(aa,
X);k.internalAssert(0<=W&&W<U);U=W*ha;k.internalAssert(0<=U&&U<=Z-ha);var ka=0,la=U;ba.getVertexPos(D,0);ba.getVertexPos(F,ba.count-1);U=r.distance(D,F);U=Math.max(1,1E-4*U);for(W=0;W<=ha;++W){ba.getVertexPos(D,ka);ia.getVertexPos(F,la);ea=W/ha;da=ca?Y[0]+ea*(Y[2]-Y[0]):V===l.NeighborIndex.WEST?Y[0]:Y[2];const na=ca?V===l.NeighborIndex.SOUTH?Y[1]:Y[3]:Y[1]+ea*(Y[3]-Y[1]),pa=G.surface.extent;if(n.isNone(pa)||f.containsXY(pa,da,na)){ea=r.dist(D,F);Z=r.len(D)-e.earth.radius;fa=r.len(F)-e.earth.radius;
const va=ea<U;va||(console.warn("Tile edge vertex position mismatch: between"+` [${G.lij}].edge${aa}[${ka}/${ba.count}] and`+` [${X.lij}].edge${ja}[${la}/${ia.count}]`),n.isSome(pa)&&console.warn("  surface extent\x3d ",pa," x,y\x3d",da,",",na),da=m.create(),r.subtract(da,H.localOrigin,T.localOrigin),0<r.len(da)&&console.warn(`   localOrigins: ${H.localOrigin} vs ${T.localOrigin}`+` d=${r.len(da)} [${da}]`),(()=>{const wa=m.clone(D),za=m.clone(F);G.updateEdgeElevations();X.updateEdgeElevations();
ba.getVertexPos(D,ka);ia.getVertexPos(F,la);const sa=m.create();r.sub(sa,D,wa);0<r.len(sa)&&console.warn(`  XXX Tile[${G.lij}] edge out of date: ${wa} vs ${D} d=${r.len(sa)} [${sa}]`);r.sub(sa,F,za);0<r.len(sa)&&console.warn(`  XXX Neighbor[${X.lij}] edge out of date: ${za} vs ${F} d=${r.len(sa)} [${sa}]`)})(),k.internalAssert(va,"Mismatch in tile"+` [${G.lij}].edge[${aa}][${ka}/${ba.count}] vs neighbor`+` [${X.lij}].edge[${ja}][${la}/${ia.count}]`+` ${k.v32s(D)} vs ${k.v32s(F)}  dist=${ea} h(t|n|d)=${Z}|${fa}|${fa-
Z}`));if(G.surface.shading){ba.getNormal(E,ka);ia.getNormal(K,la);r.normalize(J,E);r.normalize(M,K);const wa=r.dot(J,M);da=.01>1-wa||G===X;if(!da){const za=m.create();r.sub(za,E,K);ea=()=>`Mismatch in tile edge normal ${k.lij2s(G.lij)} (${ka}/${ba.count-1}) edge ${aa} vs neighbor ${k.lij2s(X.lij)}  (${la}/${ia.count-1}) nedge ${ja} :`+`${k.v32s(E)} vs ${k.v32s(K)}  dot = ${wa} : ${k.v32s(za)}`;console.warn("Mismatch in tile edge normal: ",ea());G.updateEdgeElevations();X.updateEdgeElevations();Z=
m.create();fa=m.create();ba.getNormal(Z,ka);ia.getNormal(fa,la);r.equals(E,Z)||console.warn("Missing update in tile normal: ",k.v32s(E)," \x3d\x3e ",k.v32s(Z));r.equals(K,fa)||console.warn("Missing update in neighbor normal: ",k.v32s(K)," \x3d\x3e ",k.v32s(fa));k.internalAssert(da,ea())}}}ka+=1;la+=1}}}else k.internalAssert(!1)}}else k.internalAssert(!X.isLeaf),k.internalAssert(0===W)}else V=!G.surface.updatingRootTiles&&n.isSome(G.surface.rootTiles)&&0<G.surface.rootTiles.length&&G.shouldHaveNeighbor(V),
k.internalAssert(!V)}})}}}}};c._createClass(P,[{key:"tile",get:function(){return this._tile}},{key:"hasGeometry",get:function(){return this._hasGeometry}},{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",
get:function(){const G=n.mapOr(this.intersectionData,0,H=>H.estimatedMemoryUsage);return(this.geometryInfo.indices?.byteLength??0)+(this.geometryInfo.vertexAttributes?.byteLength??0)+G}},{key:"textureDescriptor",get:function(){return n.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return P}();const D=m.create(),F=m.create(),E=m.create(),K=m.create(),J=m.create(),M=m.create(),N=[null,null,null,null];Object.defineProperty(a,
"ActivationTime",{enumerable:!0,get:()=>p.ActivationTime});a.PatchRenderData=w;a.neighborTileIfLoadedOrSelf=y;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(a){let c=function(){this.cornerTiles=[null,null,null,null];this.cornerTileSamplerVersions=[-1,-1,-1,-1]},b=function(){this.cornerNeighborData=[new c,new c,new c,new c];this.edgeResolutions=[-1,-1,-1,-1];this.edgePeerNeighbors=[null,null,null,null];this.edgePeerNeighborSamplerVersions=
[-1,-1,-1,-1];this.cornerPeerNeighbors=[null,null,null,null]};a.CornerNeighborData=c;a.GeometryState=function(){this.numVerticesPerSide=0;this.clippingArea=this.samplerData=null;this.shading=this.wireframe=!1;this.samplerDataVersion=0;this.neighborData=new b};a.NeighborhoodData=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./interfaces"],function(a,
c,b,t){let n=function(){function r(d){this._getFadeDuration=d;this._delayedTime=this._fadeStart=0}var m=r.prototype;m.clear=function(){this._current=b.destroyMaybe(this._current);this._next=b.destroyMaybe(this._next);this._waiting=b.destroyMaybe(this._waiting);this._delayed=b.destroyMaybe(this._delayed)};m.push=function(d,f=a.ActivationTime.Immediate){this._delayed=b.destroyMaybe(this._delayed);this._push(d,f)};m._push=function(d,f){this._isFadingEnabled||this.clear();if(b.isNone(this._current))this._current=
d;else{var e=r.test.fadeMoment||performance.now();f!==a.ActivationTime.Immediate?(this._delayed=d,this._delayedTime=e+f):b.isNone(this._next)?(this._next=d,this._fadeStart=this._alignFadeStart(e)):b.isNone(d)||(b.destroyMaybe(this._waiting),this._waiting=d)}};m._alignFadeStart=function(d){const f=this._getFadeDuration();return d+f-d%f};c._createClass(r,[{key:"current",get:function(){if(b.isNone(this._current))return null;if(!this._isFadingEnabled){var d=this._delayed||this._waiting||this._next||this._current;
d!==this._current&&(this._current=null,this.clear(),this._current=d)}d=r.test.fadeMoment;b.isSome(this._delayed)&&(d=d||performance.now(),d>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(b.isSome(this._next)){d=d||performance.now();var f=this._fadeDuration;const e=b.isSome(this._current)&&this._next.texture===this._current.texture,g=this._next.type!==t.TextureUpdate.FADING;f=d-this._fadeStart>=f;if(e||g||f)b.destroyMaybe(this._current),this._current=
this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(d)}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(b.isNone(this._next))return 1;var d=r.test.fadeMoment||performance.now();d=Math.max(0,d-this._fadeStart);const f=this._fadeDuration;return d>f?0:1-d/f}},{key:"isFading",get:function(){return b.isSome(this._next)||b.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return b.isNone(this._waiting)?
this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFadingEnabled",get:function(){return 0<this._getFadeDuration()}}]);return r}();n.test={fadeMoment:0};a.ActivationTime=void 0;(function(r){r[r.Immediate=0]="Immediate";r[r.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.TextureFader=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/common ../../../geometry/ellipsoidUtils ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../../layers/support/layerUtils ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils ../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J){function M(V){V.dispose();V instanceof z.ElevationTileAgent?R.release(V):V instanceof A.MapTileAgent&&S.release(V)}function N(V,aa,X){return t.isNone(V)||t.isNone(aa)||aa===V?!1:V.level>=aa.level?P(V,aa,X):P(aa,V,y.oppositeCorner(X))}function P(V,aa,X){y.internalAssert(V.level>=aa.level);var W=y.isWestCorner(X),T=y.isNorthCorner(X);X=V.extent;const U=aa.extent;var Y=[W?X[0]:X[2],T?X[3]:X[1]];const ba=[W?U[2]:U[0],T?U[1]:U[3]];W=
1E-5*(X[2]-X[0]);T=y.almostEquals(Y[0],ba[0],W)||V.surface.isGlobal&&y.almostEquals(Y[0],-ba[0],W);Y=y.almostEquals(Y[1],ba[1],W);if(T&&Y)return!0;if(V.level===aa.level||!T&&!Y)return y.internalAssert(!1),!1;V=T?I(U[1],U[3],X[1],X[3],W):I(U[0],U[2],X[0],X[2],W);y.internalAssert(V);return V}function I(V,aa,X,W,T=e.getEpsilon()){return V-T<=X&&X<=W&&W<=aa+T}const G=f.create(),H=f.create(),L=f.create();let O=function(){function V(){this.lij=[0,0,0];this._children=[null,null,null,null];this._pendingUpdates=
0;this.renderData=null;this._dirty=!0;this._previouslyRendered=!1;this.extent=h.create();this._elevationBounds=m.create();this.layerInfo=[[],[]];this.extentInRadians=h.create();this.centerAtSeaLevel=f.create();this._center=[f.create(),l.create(),f.create()];this.up=f.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=null;this.extentMidY=this.extentMidX=this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this.screenDepth=this._mapDataRefCount=
this._mapTileMemoryInternal=0;this.distanceToPOI=-1;this._lastPOI=f.create()}V.prune=function(){S.prune(0);R.prune(0);D.TilePerLayerInfo.prune()};var aa=V.prototype;aa.computeVisibility=function(){this._dirty=!1;var X=this.parent?.frustumVisibility??C.TileFrustumVisibility.INTERSECTS;this._frustumVisibility=X===C.TileFrustumVisibility.INSIDE?C.TileFrustumVisibility.INSIDE:X===C.TileFrustumVisibility.OUTSIDE?C.TileFrustumVisibility.OUTSIDE:this._calculateFrustumVisibilityStatus(this.surface.frustum);
X=this._frustumVisibility!==C.TileFrustumVisibility.OUTSIDE&&this._intersectsClippingArea;X!==this._visible&&(this._visible=X,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setDirty(),this.updateAgentSuspension())};aa.init=function(X,W,T){this.lij[0]=X[0];this.lij[1]=X[1];this.lij[2]=X[2];this.ellipsoid=g.getReferenceEllipsoid(T.tilingScheme.spatialReference);T.tilingScheme.getExtent(X[0],X[1],X[2],this.extent);T.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);
this.extentMidX=.5*(this.extent[0]+this.extent[2]);this.extentMidY=.5*(this.extent[1]+this.extent[3]);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;T.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=0;this.vlevel=X?X[0]:0;W&&W.elevationBounds?r.copy(this._elevationBounds,W.elevationBounds):r.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this.screenDepth=0;
this._previouslyRendered=this._visible=!1;this._parent=W;this.unsetChildren();this._surface=T;this.updateVisibility();for(const U of B.LayerClasses){X=T.numLayers(U);W=this.layerInfo[U];for(const Y of W)Y.release();W.length=X;for(let Y=0;Y<X;Y++)W[Y]=D.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),U===B.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(Y,-1)}this.computeElevationBounds();this._maxTesselation=Math.min(T.tilingScheme.pixelSize,u.MAX_PATCH_TESSELATION)};aa.release=function(){y.weakAssert(!this.renderData,
"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);for(var X of B.LayerClasses){for(const W of this.layerInfo[X])W.release();this.layerInfo[X].length=0}this._parent=null;for(X=0;4>X;++X)this._children[X]=null;this._surface=null;this.setMemoryDirty()};aa.refMapData=function(){++this._mapDataRefCount;this._isCached||this._surface.upsampleMapCache.pop(this.key)};aa.unrefMapData=function(){--this._mapDataRefCount;if(this._isCached){this.setMemoryDirty();const X=this._cachedMemory;
0<X&&this._surface.upsampleMapCache.put(this.key,this,X)}};aa.setMemoryDirty=function(){this._usedMemory=null};aa._ensureUsedMemory=function(){if(t.isSome(this._usedMemory))return this._usedMemory;let X=this._mapTileMemoryInternal=this._usedMemory=0;for(var {data:W}of this.layerInfo[B.LayerClass.MAP])W instanceof q.VectorTile?X+=this._getTerrainDataMemory(W):this._mapTileMemoryInternal+=this._getTerrainDataMemory(W);W=this._cpuImageMemorySize;for(const T of this.layerInfo[B.LayerClass.ELEVATION])this._usedMemory+=
T.data?W:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemoryInternal+=J.getGpuMemoryUsage(this.renderData.textureDescriptor));this._isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemoryInternal+X);return this._usedMemory};aa.getUsedMemoryForLayer=function(X,W){W=this.layerInfo[X][W];return W?.data?X===B.LayerClass.MAP?this._isCached?0:this._getTerrainDataMemory(W.data):X===B.LayerClass.ELEVATION?this._cpuImageMemorySize:
0:0};aa._getTerrainDataMemory=function(X){return X instanceof F?J.getGpuMemoryUsage(X.texture):X instanceof HTMLImageElement||X instanceof k.ImageWithType?this._cpuImageMemorySize:X instanceof q.VectorTile||X instanceof x.RasterTile?X.memoryUsage:0};aa.updateScreenDepth=function(X){var W=this._center[a.CenterPosition.MIDDLE];const T=W[0],U=W[1];W=W[2];const Y=X[2]*T+X[6]*U+X[10]*W+X[14];this.screenDepth=0>Y?0:Y/(X[3]*T+X[7]*U+X[11]*W+X[15])};aa.shouldSplit=function(X,W,T){if(!this.visible||t.isSome(X.frustum)&&
(!this._intersectsClippingArea||this._calculateFrustumVisibilityStatus(X.frustum)===C.TileFrustumVisibility.OUTSIDE))return E.TileUpdate.NONE;const U=this.level;d.subtract(G,this._center[a.CenterPosition.MIDDLE],W);var Y=d.squaredLength(G);let ba=a.CenterPosition.MIDDLE;d.subtract(H,this._center[a.CenterPosition.TOP],W);var da=d.squaredLength(H);da<Y&&(Y=da,ba=a.CenterPosition.TOP);d.subtract(H,this._center[a.CenterPosition.BOTTOM],W);da=d.squaredLength(H);da<Y&&(Y=da,ba=a.CenterPosition.BOTTOM);
if(this._edgeLen2>Y&&U<X.maxLod)return E.TileUpdate.SPLIT;Y=Math.sqrt(Y);const ea=this._edgeLen/(X.fovX*Y*2);da=()=>{const ia=U+Math.ceil(-Math.log2(X.relativeWidthLimit/ea));return ia!==this.vlevel?(this.vlevel=ia,E.TileUpdate.VSPLITMERGE):E.TileUpdate.NONE_HIT_MAXLOD};if(t.isSome(T)&&1===T-U)return U>=X.maxLod?da():E.TileUpdate.SPLIT;const ca=d.dot(this.up,G);T=this._elevationBounds[1]-this._elevationBounds[0];const ja=T/this.edgeLen;return X.aboveGround&&0<ca&&.001>ja&&0<ca/Y-Math.sin(this._curvatureHeight/
(this.edgeLen*Math.SQRT1_2)*Math.PI)-ja?E.TileUpdate.NONE:ea<X.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,E.TileUpdate.VSPLITMERGE):E.TileUpdate.NONE:U>=X.maxLod?da():6<U&&(d.subtract(H,this._center[ba],W),d.scale(L,this.up,ca),d.subtract(L,L,H),da=d.squaredLength(L),da>this.radius*this.radius&&(d.scale(L,L,this.radius/Math.sqrt(da)),d.add(L,L,this._center[ba]),d.subtract(L,W,L),Math.min(1,(Math.abs(d.dot(L,this.up))+.5*T+this._curvatureHeight)/d.length(L))*(this._edgeLen/
(X.fovY*Y*2))<.1/X.angledSplitBias*X.relativeHeightLimit))?E.TileUpdate.NONE:E.TileUpdate.SPLIT};aa.setChildren=function(X,W,T,U){y.weakAssert(!!(X&&W&&T&&U),"Null child passed");this._children[0]=X;this._children[1]=W;this._children[2]=T;this._children[3]=U};aa.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};aa.load=function(){this.refMapData();for(const X of B.LayerClasses)this._createOrUpdateAgents(0,X);this.surface.renderer.loadTile(this)};
aa.unload=function(X){X.unloadTile(this);for(const W of B.LayerClasses){X=this.layerInfo[W];for(const T of X)T.loadingAgent&&T.loadingAgent!==w.TILE_AGENT_DONE&&(M(T.loadingAgent),T.loadingAgent=null),T.pendingUpdates=0}this.resetPendingUpdate(E.TileUpdate.GEOMETRY);this.resetPendingUpdate(E.TileUpdate.TEXTURE_NOFADING);this.resetPendingUpdate(E.TileUpdate.TEXTURE_FADING);this.unrefMapData()};aa.unloadMapData=function(){const X=this.layerInfo[B.LayerClass.MAP];for(const W of X)W.loadingAgent&&W.loadingAgent!==
w.TILE_AGENT_DONE&&(M(W.loadingAgent),W.loadingAgent=null),W.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};aa.updateClippingStatus=function(X){if(h.equals(X,this._clippingArea))return!1;var W=this._intersectsClippingArea;const T=this._isWithinClippingArea;t.isSome(X)?(this._intersectsClippingArea=this.intersectsExtent(X),this._isWithinClippingArea=this._isWithinExtent(X)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=X;this.updateVisibility();
X=T&&this._isWithinClippingArea;W=!T&&!W&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||X||W||this.setPendingUpdate(E.TileUpdate.GEOMETRY);return!0};aa.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};aa.getLayerInfo=function(X,W){return this.layerInfo[W][X]};aa.hasLayerData=function(X,W){X=this.layerInfo[W][X];return!(!X||!X.data||X.dataInvalidated)};aa._isSuspended=function(X){return this.hasPendingUpdate(E.TileUpdate.SPLIT)?!0:X===B.LayerClass.ELEVATION?
!1:!this.loadable};aa.hasPendingUpdate=function(X){return(this._pendingUpdates&X)===X};aa.setPendingUpdate=function(X){this._pendingUpdates|=X;X===E.TileUpdate.SPLIT||X===E.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()};aa.resetPendingUpdate=function(X){return this.hasPendingUpdate(X)?(this._pendingUpdates&=~X,!0):!1};aa.requestLayerData=function(X,W,T){const U=this.layerInfo[W][X];if(U.waitingAgents.has(T))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",
this.lij.toString(),T.tile.lij.toString(),W,X),!0;U.waitingAgents.push(T);if(U.data&&!U.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),T.tile.lij.toString(),W,X),T.dataArrived(this),!0;if(U.requestPromise)return!0;t.abortMaybe(U.requestAbort);U.requestAbort=new AbortController;const Y=this._surface.requestTileData(this,X,W,U.requestAbort);if(!Y)return U.requestAbort=null,!1;X=()=>{U.requestPromise===Y&&(U.requestPromise=
null,U.requestAbort=null)};U.requestPromise=Y;Y.then(X,X);return!0};aa.hasLij=function(X){return this.lij[0]===X[0]&&this.lij[1]===X[1]&&this.lij[2]===X[2]};aa.findByLij=function(X){if(this.hasLij(X))return this;const W=this._children;return W[0]?W[0].findByLij(X)||W[1].findByLij(X)||W[2].findByLij(X)||W[3].findByLij(X):null};aa.distanceToSquared=function(X){return d.squaredLength(d.subtract(L,this._center[a.CenterPosition.MIDDLE],X))};aa.containsPoint=function(X){const W=this.extent;return X[0]>=
W[0]&&X[1]>=W[1]&&X[0]<=W[2]&&X[1]<=W[3]};aa.containsPointXY=function(X,W){const T=this.extent;return X>=T[0]&&W>=T[1]&&X<=T[2]&&W<=T[3]};aa.unrequestLayerData=function(X,W,T){X=this.layerInfo[W][X];W=X.waitingAgents;T=null!=W.removeUnordered(T);y.weakAssert(T,"agent has not requested this piece of map data");1>W.length&&(X.abortRequest(),this.setMemoryDirty())};aa.dataArrived=function(X,W,T){X=this.layerInfo[W][X];X.data=T;X.dataInvalidated=!1;X.waitingAgents.forAll(U=>U.dataArrived(this));X.waitingAgents.clear();
this.setMemoryDirty()};aa.dataMissing=function(X,W,T){T.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${W}/${X} error ${T}`);X=this.layerInfo[W][X];X.dataMissing=!0;X.waitingAgents.forAll(U=>U.dataMissing());X.waitingAgents.clear();this.setMemoryDirty()};aa.updateRenderData=function(X,W){switch(X){case B.LayerClass.MAP:return this._updateTexture(W);case B.LayerClass.ELEVATION:return this._updateGeometry()}};aa._updateTexture=function(X){this.renderData&&(this.resetPendingUpdate(X===
C.TextureUpdate.FADING?E.TileUpdate.TEXTURE_NOFADING:E.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(X===C.TextureUpdate.FADING?E.TileUpdate.TEXTURE_FADING:E.TileUpdate.TEXTURE_NOFADING))};aa._updateGeometry=function(){this.setPendingUpdate(E.TileUpdate.GEOMETRY);for(const X of this.layerInfo[B.LayerClass.ELEVATION])X.pendingUpdates|=E.TileUpdate.GEOMETRY};aa.invalidateLayerData=function(X,W){this.layerInfo[W][X].invalidateSourceData();this.restartAgents(W)};aa.computeElevationBounds=function(){const X=
this._elevationBounds,W=X[0],T=X[1];r.set(X,Infinity,-Infinity);const U=this.layerInfo[B.LayerClass.ELEVATION];let Y=!0;for(const ba of U)t.isSome(ba.elevationBounds)&&(X[0]=Math.min(X[0],ba.elevationBounds.min),X[1]=Math.max(X[1],ba.elevationBounds.max),ba.elevationBounds.hasNoDataValues||(Y=!1));Y&&(X[0]=Math.min(X[0],0),X[1]=Math.max(X[1],0));if(W!==X[0]||T!==X[1])this.updateRadiusAndCenter(),this._surface.setTileTreeDirty()};aa._updateCenter=function(){const X=this._elevationBounds,W=this._center;
d.scale(L,this.up,.5*(X[0]+X[1]));d.add(W[a.CenterPosition.MIDDLE],this.centerAtSeaLevel,L);d.scale(L,this.up,X[0]);d.add(W[a.CenterPosition.TOP],this.centerAtSeaLevel,L);d.scale(L,this.up,X[1]);d.add(W[a.CenterPosition.BOTTOM],this.centerAtSeaLevel,L)};aa.findElevationBoundsForLayer=function(X,W){const T=this.layerInfo[B.LayerClass.ELEVATION][X],U=u.getElevationDesiredResolutionLevel(this.level),Y=Math.max(this.vlevel-U,0);var ba=T.elevationBounds;if(!(t.isSome(ba)&&ba.level>=W&&ba.level<=Y)&&(W=
this._surface.layerViewByIndex(X,B.LayerClass.ELEVATION),W=y.getLayerWithExtentRange(W),K.fallsWithinLayer(this,W,!1))){W=Q;ba=!1;var da=T.data;if(da&&da.level<=Y)X=T.data,W.min=X.samplerData.data.minValue,W.max=X.samplerData.data.maxValue,W.hasNoDataValues=X.samplerData.data.hasNoDataValues,W.level=this.level,ba=!0;else{da=0;let ea,ca;for(let ja=this._parent;ja&&(!ca||da<U)&&!(da=this.vlevel-ja.level,ea=ca||ea,ca=ja.layerInfo[B.LayerClass.ELEVATION][X].data,!ca&&ea&&ja.level<=Y);ja=ja.parent);if(ca=
ca||ea)ca.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],W),Infinity!==W.min&&(W.level=ca.level,ba=!0)}ba&&(t.isNone(T.elevationBounds)&&(T.elevationBounds=new p.ElevationBounds),T.elevationBounds.copyFrom(W))}};aa.modifyLayers=function(X,W,T){T=this.layerInfo[T];for(var U of T)U.loadingAgent&&U.loadingAgent!==w.TILE_AGENT_DONE&&(M(U.loadingAgent),U.loadingAgent=null),U.waitingAgents.clear();for(U=0;U<T.length;++U)void 0===X[U]&&T[U].release();X=Array(...T);U=W.length;T.length=U;for(let Y=
0;Y<U;Y++){const ba=W[Y];T[Y]=-1<ba?X[ba]:D.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()};aa.restartAgents=function(X){this.renderData&&(this._createOrUpdateAgents(0,X),this.updateRenderData(X,C.TextureUpdate.FADING))};aa.updateAgents=function(X){if(this.renderData){const W=this.layerInfo[X];for(const T of W)T.loadingAgent===w.TILE_AGENT_DONE&&(T.loadingAgent=null);this._createOrUpdateAgents(0,X)}};aa.updateAgentSuspension=function(){for(const X of B.LayerClasses){const W=
this._isSuspended(X);for(const T of this.layerInfo[X])T.loadingAgent&&T.loadingAgent!==w.TILE_AGENT_DONE&&(T.loadingAgent.setSuspension(W),T.loadingAgent===w.TILE_AGENT_DONE&&this.updateRenderData(X,C.TextureUpdate.FADING))}};aa.removeLayerAgent=function(X,W){X=this.layerInfo[W][X];X.loadingAgent&&X.loadingAgent!==w.TILE_AGENT_DONE&&X.loadingAgent.dispose();X.loadingAgent=null};aa.agentDone=function(X,W){const T=this.layerInfo[W][X];T.loadingAgent=w.TILE_AGENT_DONE;!T.data&&t.isNone(T.upsampleInfo)&&
this._createOrUpdateAgents(X+1,W)};aa._hasBlendableAncestor=function(X){return"normal"!==X.blendMode||v.isGroupLayer(X.parent)&&this._hasBlendableAncestor(X.parent)};aa._hasBlendModes=function(X,W,T){for(;X<W;++X){const U=this._surface.layerViewByIndex(X,T);if(y.isBlendableLayerView(U)&&"normal"!==U?.layer?.blendMode||v.isGroupLayer(U?.layer?.parent)&&this._hasBlendableAncestor(U?.layer?.parent))return!0}return!1};aa._createOrUpdateAgents=function(X,W){const T=this.layerInfo[W];if(0!==T.length){var U=
this._isSuspended(W);for(let ea=X;ea<T.length;++ea){const ca=T[ea];var Y=!1;const ja=this._surface.layerViewByIndex(ea,W);var ba=y.getLayerWithExtentRange(ja);if(ca.loadingAgent)K.fallsWithinLayer(this,ba,!1)?(ca.loadingAgent!==w.TILE_AGENT_DONE&&ca.loadingAgent.setSuspension(U),ca.loadingAgent!==w.TILE_AGENT_DONE&&(Y=ca.loadingAgent.update())):ca.dispose();else if(K.fallsWithinLayer(this,ba,!1)){Y=ea;ba=W;var da=U;const ia=ba===B.LayerClass.ELEVATION?R.acquire():S.acquire();ia.init(this,Y,ba,da);
ca.loadingAgent=ia;(Y=ca.loadingAgent.startLoading())?ca.loadingAgent===w.TILE_AGENT_DONE&&this.setPendingUpdate(E.TileUpdate.GEOMETRY):(M(ca.loadingAgent),ca.loadingAgent=w.TILE_AGENT_DONE)}ca.loadingAgent===w.TILE_AGENT_DONE&&this.updateRenderData(W,C.TextureUpdate.FADING);if(!this._hasBlendModes(X,T.length,W)&&Y&&ja.isOpaque)break}}};aa._isWithinExtent=function(X){const W=this.extent;return W[0]>=X[0]&&X[2]>=W[2]&&W[1]>=X[1]&&X[3]>=W[3]};aa.intersectsExtent=function(X){const W=this.extent;return W[2]>=
X[0]&&X[2]>=W[0]&&W[3]>=X[1]&&X[3]>=W[1]};aa.getElevationVerticesPerSide=function(X){var W=this.vlevel-this.level;X=Math.max(this.level-X,u.getElevationDesiredResolutionLevel(this.level)-W);X=b.clamp((this.maxTesselation>>X)+1,2,this.maxTesselation+1);W=this.getDefaultVerticesPerSide();return Math.max(X,W)};aa._findLIJ=function(X,W){if(!X)return null;var T=this.surface.rootTiles;if(t.isSome(T))for(var U of T){T=U.level;var Y=X[0];T>Y?T=!1:(T=Y-T,Y=Math.floor(X[2]/2**T),T=Math.floor(X[1]/2**T)===U.lij[1]&&
Y===U.lij[2]);if(T){for(T=X[0]-U.level-1;0<=T&&!U.isLeaf&&!W(U);)U=U.children[2*(X[1]>>T&1)+(X[2]>>T&1)],T--;return W(U)?U:null}}return null};aa.findNeighborTile=function(X,W){const T=this.lij;return(X=this.getNeighborLIJ(T,X))?T[0]===X[0]&&T[1]===X[1]&&T[2]===X[2]?W(this)?this:null:this._findLIJ(X,W):null};aa.findCorner=function(X,W){X=X===C.NeighborIndex.NORTH_EAST?1:X===C.NeighborIndex.NORTH_WEST?0:X===C.NeighborIndex.SOUTH_WEST?2:3;let T=this;for(;T.children[0]&&(!W||!W(T));)T=T.children[X];return T};
aa.findNeighborCornerTileExact=function(X,W){return this.findNeighborTile(X,T=>W(T)||T.level===this.level)?.findCorner(y.oppositeCorner(X),W)||null};aa.forAllSubtreeOnSide=function(X,W){const T=X===C.NeighborIndex.NORTH?[0,1]:X===C.NeighborIndex.NORTH_EAST?[1]:X===C.NeighborIndex.EAST?[1,3]:X===C.NeighborIndex.SOUTH_EAST?[3]:X===C.NeighborIndex.SOUTH?[2,3]:X===C.NeighborIndex.SOUTH_WEST?[2]:X===C.NeighborIndex.WEST?[0,2]:[0],U=Y=>{const ba=Y.children;!W(Y)&&ba[0]&&T.forEach(da=>U(ba[da]))};U(this)};
aa.forallNeighbors=function(X){y.neighborCornerIndices.forEach(W=>this.findNeighborCornerTileExact(W,X));y.neighborEdgeIndices.forEach(W=>this.findNeighborTile(W,T=>T.level===this.level||X(T))?.forAllSubtreeOnSide(y.oppositeEdge(W),X))};aa.getNeighborEdgeStartVertexIndex=function(X,W){if(!W)return 0;var T=this.level-W.level;y.internalAssert(!y.ENABLE_TERRAIN_INTERNAL_CHECKS||0<=T);if(0===T)return 0;T=2**T;var U=(X=1===(X&1))?0:1;W=W.lij[U+1]*T;U=this.lij[U+1];const Y=U-W;X=X?T-1-Y:Y;y.ENABLE_TERRAIN_INTERNAL_CHECKS&&
(y.internalAssert(W<=U&&U<W+T),y.internalAssert(0<=X&&X<T));return X};aa.forEachLoadedNeighbor=function(X){const W=this.level,T=U=>U.level===W||U.isLoaded;y.neighborEdgeIndices.forEach(U=>{const Y=this.findNeighborTile(U,T);null!=Y&&Y!==this&&Y.forAllSubtreeOnSide(y.oppositeEdge(U),ba=>ba.isLoaded?(X(ba,U),!0):!1)});y.neighborCornerIndices.forEach(U=>{const Y=this.findNeighborTile(U,T)?.findCorner(y.oppositeCorner(U),ba=>ba.isLoaded);y.internalAssert(!Y||N(this,Y,U));Y?.isLoaded&&X(Y,U)})};aa.getNeighborLIJ=
function(X,W){const T=y.isNorth(W)?-1:y.isSouth(W)?1:0;W=y.isWest(W)?-1:y.isEast(W)?1:0;X=[X[0],X[1]+T,X[2]+W];return 0>X[1]?null:this.surface.isGlobal?this.wrapLIJ(X):0>X[2]?null:X};aa.wrapLIJ=function(X){return!X||0>X[1]||X[1]>=2**X[0]?null:this.surface.wrapEastWest(X)};aa.checkGeometryWaterproofness=function(){y.ENABLE_WATERPROOFNESS_TESTS&&(y.internalAssert(this.isLoaded),this.renderData?.checkGeometryWaterproofness())};aa.shouldHaveNeighbor=function(X){const W=this.extent,T=this.surface.rootTilesExtent,
U=.25*(W[2]-W[0]);if(y.isNorth(X)&&W[3]+U>=T[3]||y.isSouth(X)&&W[1]-U<=T[1])return!1;const Y=this.surface.isGlobal;return!Y&&y.isWest(X)&&W[0]-U<=T[0]||!Y&&y.isEast(X)&&W[2]+U>=T[2]?!1:!0};aa.updateDistanceToPOI=function(X){var W=this._lastPOI;if(!(0<=this.distanceToPOI&&W[0]===X[0]&&W[1]===X[1]&&W[2]===X[2])){d.copy(this._lastPOI,X);var T=this._center[a.CenterPosition.MIDDLE];W=X[0]-T[0];var U=X[1]-T[1];X=X[2]-T[2];this.distanceToPOI=W*W+U*U+X*X}};c._createClass(V,[{key:"_isCached",get:function(){return!this.shouldLoad&&
0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},{key:"elevationBounds",
get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},{key:"key",get:function(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._center[a.CenterPosition.MIDDLE][3]}},{key:"visible",get:function(){this._dirty&&this.computeVisibility();return this._visible}},{key:"frustumVisibility",get:function(){this._dirty&&this.computeVisibility();return this._frustumVisibility}},
{key:"loadable",get:function(){return this.visible||this._surface.view.state.fixedContentCamera}},{key:"rendered",get:function(){const X=!!this.renderData;X!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=X,this._surface.renderer.setDirty());return X}},{key:"shouldLoad",get:function(){var X=this._surface.snapLevel;if(t.isSome(X)){X=this.level-X;if(0===X)return!0;if(1===X)return!1}return this.isLeaf}},{key:"usedMemory",get:function(){return this._ensureUsedMemory()+
(this._isCached?0:this._mapTileMemoryInternal)}},{key:"_cachedMemory",get:function(){return this._isCached?this._mapTileMemory:0}},{key:"_mapTileMemory",get:function(){this._ensureUsedMemory();return this.layerInfo[B.LayerClass.MAP].reduce((X,W)=>X+(W instanceof q.VectorTile?W.memoryUsage:0),this._mapTileMemoryInternal)}},{key:"_cpuImageMemorySize",get:function(){const X=this._surface.tilingScheme.pixelSize;return X*X*4}},{key:"isLoaded",get:function(){return this.renderData?.hasGeometry??!1}},{key:"updating",
get:function(){if(this.hasPendingUpdates)return!0;for(const X of B.LayerClasses){const W=this.layerInfo[X];for(const T of W)if(T.loadingAgent&&T.loadingAgent!==w.TILE_AGENT_DONE&&T.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this._cachedMemory}}},{key:"westNeighborWestExtent",get:function(){return this.extent[0]*(this.isWestEnd?
-1:1)}},{key:"eastNeighborEastExtent",get:function(){return this.extent[2]*(this.isEastEnd?-1:1)}},{key:"isEastEnd",get:function(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}},{key:"isWestEnd",get:function(){return 0===this.lij[2]}},{key:"isNorthEnd",get:function(){return 0===this.lij[1]}},{key:"isSouthEnd",get:function(){return this.extent[1]+e.getEpsilon()>=this.surface.extent[1]}}]);return V}();const S=new n(A.MapTileAgent),R=new n(z.ElevationTileAgent),Q=new p.ElevationBounds;
a.CenterPosition=void 0;(function(V){V[V.TOP=0]="TOP";V[V.MIDDLE=1]="MIDDLE";V[V.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.Tile=O;a.isCornerNeighbor=N;a.isEdgeNeighbor=function(V,aa,X){if(t.isNone(V)||t.isNone(aa))return!1;if(0===V.level&&0===aa.level&&(V.isEastEnd&&aa.isWestEnd&&X===C.NeighborIndex.EAST||V.isWestEnd&&aa.isEastEnd&&X===C.NeighborIndex.WEST))return!0;const W=Math.max(1E-6*(V.extent[2]-V.extent[0]),1);switch(X){case C.NeighborIndex.NORTH:return y.almostEquals(V.extent[3],
aa.extent[1],W);case C.NeighborIndex.SOUTH:return y.almostEquals(V.extent[1],aa.extent[3],W);case C.NeighborIndex.EAST:return y.almostEquals(V.extent[2],aa.extent[0],W)||y.almostEquals(V.extent[2],-aa.extent[0],W);case C.NeighborIndex.WEST:return y.almostEquals(V.extent[0],aa.extent[2],W)||y.almostEquals(V.extent[0],-aa.extent[2],W)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"./TerrainConst","./TileAgent"],function(a,c,b,t){t=function(n){function r(){var m=n.apply(this,arguments)||this;m._scaleRangeEnabled=!1;return m}c._inheritsLoose(r,n);c._createClass(r,[{key:"_desiredMinLevelDelta",get:function(){return b.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.vlevel-this.tile.level)}},{key:"_progressiveLevelModulo",get:function(){return 0}}]);return r}(t.TileAgent);a.ElevationTileAgent=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./interfaces ./TerrainConst ./terrainUtils ./tileUtils".split(" "),
function(a,c,b,t,n,r,m){let d=function(){function g(){}var h=g.prototype;h.init=function(l,v,q,k){this.tile=l;this._layerIdx=v;this._layerClass=q;this._suspended=k;this._tileLayerInfo=l.getLayerInfo(v,q);this._tileRequested=null;l=this._findAncestorWithData();this._setUpsampleTile(l)};h.startLoading=function(){return this._requestNext()};h.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=
this.tile=null};h.setSuspension=function(l){l!==this._suspended&&((this._suspended=l)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};h.update=function(){const l=this._findAncestorWithData();this._setUpsampleTile(l);return this._requestNext()};h.dataArrived=function(l){this._setUpsampleTile(l);this._tileRequested=null;l===this.tile?this.tile.updateRenderData(this._layerClass,t.TextureUpdate.FADING):
this._requestNext()};h.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};h._agentDone=function(){this.tile.agentDone(this._layerIdx,this._layerClass);this.dispose()};h._requestNext=function(){if(this._suspended)return!0;const l=this._findNextDownload();if(this._tileRequested){if(l===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}b.isSome(l)?l.requestLayerData(this._layerIdx,
this._layerClass,this)&&(this._tileRequested=l):this._agentDone();return!!this._tileRequested};h._findNextDownload=function(){const l=this._layerIdx,v=this._layerClass;var q=this.tile.surface.layerViewByIndex(l,v);const k=r.getLayerWithExtentRange(q),{minLevel:p,maxLevel:z}=q.dataLevelRange;q=this._desiredMinLevelDelta;const C=this._progressiveLevelModulo+q,B=this._scaleRangeEnabled?m.fallsWithinLayer:()=>!0;let A=this.tile;const x=A.level;let u;var y=this._tileLayerInfo.upsampleInfo;const w=b.isSome(y)?
y.tile.level:-1;y=b.isSome(y)?w-x>=q:!1;const D=b.get(k,"tilemapCache");for(;A&&B(A,k,!1)&&A.level>=p;){const F=A.level,E=x-F,K=A.layerInfo[v][l];if(K.data&&E>=q){(!y||F>w)&&this._setUpsampleTile(A);K.dataInvalidated&&(u=A);break}if((b.isNone(D)||"unavailable"!==D.getAvailability(A.lij[0],A.lij[1],A.lij[2]))&&F<=z&&!K.data&&!K.dataMissing){if(b.isNone(u)||A.level===p||0===F%n.PROGRESSIVE_LOADING_MODULO||x-u.level<q)u=A;if(E>=C)break}A=A.parent}b.isSome(u)&&x-u.level<q&&this._tileLayerInfo.upsampleInfo&&
(u=null);return u};h._findAncestorWithData=function(){const l=this.tile.vlevel,v=this._desiredMinLevelDelta;let q;for(let k=this.tile;k;k=k.parent)if(k.hasLayerData(this._layerIdx,this._layerClass)){if(l-k.level>=v)return k;q=k}return q};h._setUpsampleTile=function(l){this._tileLayerInfo.setUpsampleInfo(this.tile,l);this.tile.updateRenderData(this._layerClass,t.TextureUpdate.FADING)};c._createClass(g,[{key:"updating",get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>
this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}]);return g}();var f=function(g){function h(){return g.apply(this,arguments)||this}c._inheritsLoose(h,g);h.prototype.dispose=function(){};c._createClass(h,[{key:"_desiredMinLevelDelta",get:function(){throw e;}},{key:"_progressiveLevelModulo",get:function(){throw e;}}]);return h}(d);const e=Error("Abstract method called on TileAgent");f=new f;a.TILE_AGENT_DONE=f;a.TileAgent=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray","./RenderOrder"],function(a,c,b,t,n){function r(k,p){p(k);if(!k.isLeaf)for(const z of k.children)r(z,p)}function m(k,p){k=k.lij;p=p.lij;return k[0]-p[0]||k[1]-p[1]||k[2]-p[2]}function d(k,p){const z=p.screenDepth-k.screenDepth;if(0!==z)return z;k=k.lij;p=p.lij;return k[0]-p[0]||k[1]-p[1]||k[2]-p[2]}function f(k,p){const z=k.screenDepth-p.screenDepth;
if(0!==z)return z;k=k.lij;p=p.lij;return k[0]-p[0]||k[1]-p[1]||k[2]-p[2]}function e(k,p,z){const C=k.screenDepth,B=p.screenDepth;return C<B?-z:C>B?z:m(k,p)}function g(k,p,z,C){const B=h(k,C);C=h(p,C);return B===C?e(k,p,z):k?z:-z}function h(k,p){for(const z of p)if(k.intersectsExtent(z))return!0;return!1}function l(k,p){const z=k.distanceToPOI-p.distanceToPOI;if(0!==z)return z;k=k.lij;p=p.lij;return k[0]-p[0]||k[1]-p[1]||k[2]-p[2]}let v=function(){function k(){this._queue=new t;this.remove=()=>{}}
var p=k.prototype;p.resetOne=function(z){this._queue.clear();this._queue.push(z);this._last=void 0};p.reset=function(z=null){this._queue.clear();b.isSome(z)&&this._queue.pushArray(z);this._last=void 0};p.skipSubtree=function(){this._last=void 0};p.next=function(){const z=this._last?.children;z&&z[0]&&this._queue.pushArray(z);return this._last=this._queue.pop()};c._createClass(k,[{key:"done",get:function(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}}]);return k}(),q=function(){function k(){this._q=
new t}var p=k.prototype;p.reset=function(z){this._q.clear();if(!b.isNone(z))for(this._q.pushArray(z),z=0;z<this._q.length;++z){const C=this._q.data[z];C.isLeaf||this._q.pushArray(C.children)}};p.next=function(){return this._q.pop()};c._createClass(k,[{key:"done",get:function(){return 0===this._q.length}}]);return k}();a.IteratorPostorder=q;a.IteratorPreorder=v;a.compareTiles=e;a.compareTilesByLij=m;a.compareTilesWithStencil=g;a.computeUpsampleInfo=function(k,p,z){let C=1,B=0,A=0;for(;k!==p;)if(C*=
.5,B*=.5,A*=.5,k.lij[2]&1&&(B+=.5),0===(k.lij[1]&1)&&(A+=.5),k=k.parent,null==k)throw Error("tile was not a descendant of upsampleTile");z.init(p,B,A,C)};a.fallsWithinLayer=function(k,p,z){if(b.isNone(p)||b.isNone(p.fullExtent))return!1;const C=p.fullExtent,B=k.extent;if(z){if(B[0]<C.xmin||B[1]<C.ymin||B[2]>C.xmax||B[3]>C.ymax)return!1}else if(C.xmin>B[2]||C.ymin>B[3]||C.xmax<B[0]||C.ymax<B[1])return!1;k=k.surface.tilingScheme.levels[k.level].scale;z=p.minScale;if(0<z&&k>1.00000001*z)return!1;p=p.maxScale;
return 0<p&&k<.99999999*p?!1:!0};a.hasLoadableSiblings=function(k){for(let p=0;p<k.length;p++){const z=k[p],C=z.parent;if(C)for(let B=0;4>B;B++){const A=C.children[B];if(A&&A!==z)return!0}}return!1};a.sortTiles=function(k,p,z=null){b.isNone(z)||0===z.length?k===n.RenderOrder.BACK_TO_FRONT?p.sort(d):p.sort(f):p.sort((C,B)=>g(C,B,k,z))};a.sortTilesByPOI=function(k,p){const z=k.length;for(let C=0;C<z;++C)k.getItemAt(C).updateDistanceToPOI(p);k.sort(l)};a.tilesAreRelated=function(k,p){if(!k||!p||k[0]===
p[0])return!1;const z=k[0]<p[0],C=z?k:p;k=z?p:k;p=1<<k[0]-C[0];return Math.floor(k[1]/p)===C[1]&&Math.floor(k[2]/p)===C[2]};a.traverseTilesPreorder=function(k,p){if(Array.isArray(k))for(let z=0;z<k.length;z++)r(k[z],p);else r(k,p)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(a){a.RenderOrder=void 0;var c=a.RenderOrder||(a.RenderOrder={});c[c.BACK_TO_FRONT=-1]="BACK_TO_FRONT";c[c.NONE=0]="NONE";c[c.FRONT_TO_BACK=
1]="FRONT_TO_BACK";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,c,b,t){t=function(n){function r(){var m=n.call(this)||this;m._scaleRangeEnabled=!0;return m}c._inheritsLoose(r,n);c._createClass(r,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_progressiveLevelModulo",get:function(){return b.PROGRESSIVE_LOADING_MODULO}}]);
return r}(t.TileAgent);a.MapTileAgent=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterTile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/RasterColorizer.glsl ../../webgl/enums ../../webgl/rasterUtils".split(" "),function(a,c,b,t,n,r){const m={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,
colormapOffset:null,stretchType:"none",type:"stretch"};let d=function(){function f(g,h,l=null,v=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.opacity=1;this.lij=g;this.source=h;this.width=l||h.width;this.height=v||h.height}var e=f.prototype;e.bind=function(g){if(!(this.source&&this.source.pixels&&
0<this.source.pixels.length))return!1;(b.isNone(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(g,this.bandIds);b.isSome(this._rasterTexture)&&(this._updateColormapTexture(g),this.transformGrid&&b.isNone(this._transformGridTexture)&&(this._transformGridTexture=r.createTransformTexture(g,this.transformGrid)));return!0};e.getUniforms=function(){const {symbolizerParameters:g,transformGrid:h,width:l,height:v,opacity:q}=this,k=r.getCommonUniforms(h,[l,v],[this.source.width,this.source.height],
q),p=r.getColormapUniforms(g.colormap,g.colormapOffset),z="stretch"===this.symbolizerParameters.type?r.getStretchUniforms(this.symbolizerParameters):null,C="hillshade"===this.symbolizerParameters.type?r.getShadedReliefUniforms(this.symbolizerParameters):null;return new t.ColorizerUniforms(k,p,z||C,this._rasterTexture,this._transformGridTexture,this._colormapTexture)};e.release=function(){this._rasterTexture=b.disposeMaybe(this._rasterTexture);this._transformGridTexture=b.disposeMaybe(this._transformGridTexture);
this._colormapTexture=b.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0};e._updateRasterTexture=function(g,h){const l=this.source?this.source.extractBands(h):null;l&&l.pixels&&0<l.pixels.length?(h=b.isNone(h)&&b.isNone(this.bandIds)||b.isSome(h)&&b.isSome(this.bandIds)&&h.join("")===this.bandIds.join(""),b.isSome(this._rasterTexture)&&h||(this._rasterTexture=b.disposeMaybe(this._rasterTexture),h=this._getRasterTextureInterpolation(this.interpolation),
this._rasterTexture=r.createRasterTexture(g,l,h,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=b.disposeMaybe(this._rasterTexture)};e.hasStretchTypeNone=function(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType};e._getRasterTextureInterpolation=function(g){return"lut"===this.symbolizerParameters.type||"nearest"===g||"majority"===g?"nearest":"bilinear"};e._updateColormapTexture=
function(g){const h=this._colormap,l=this.symbolizerParameters.colormap;if(!l)this._colormapTexture=b.disposeMaybe(this._colormapTexture),this._colormap=null;else if(!h)this._colormapTexture=r.createColormapTexture(g,l),this._colormap=l;else if(l.length!==h.length||l.some((v,q)=>v!==h[q]))this._colormapTexture=b.disposeMaybe(this._colormapTexture),this._colormapTexture=r.createColormapTexture(g,l),this._colormap=l};c._createClass(f,[{key:"source",get:function(){return this._source},set:function(g){this._source=
g;this._rasterTexture=b.disposeMaybe(this._rasterTexture);this._memoryUsed=null}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?{...m,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||m},set:function(g){this._symbolizerParameters=g}},{key:"bandIds",get:function(){return this._bandIds},set:function(g){b.isSome(g)&&0<g.length?this._bandIds&&g.every((h,l)=>this._bandIds?.[l]?h===this._bandIds[l]:!1)||(this._bandIds=g,this._dirty=!0):this._bandIds=null}},{key:"interpolation",
get:function(){return this._interpolation||"nearest"},set:function(g){this._interpolation=g;b.isSome(this._rasterTexture)&&(g=this._getRasterTextureInterpolation(g),this._rasterTexture.setSamplingMode("bilinear"===g?n.TextureSamplingMode.LINEAR:n.TextureSamplingMode.NEAREST))}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(g){this._transformGrid=g;this._transformGridTexture=b.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}},{key:"memoryUsage",get:function(){b.isNone(this._memoryUsed)&&
(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(g=>b.isSome(g)?g.descriptor.width*g.descriptor.height*4:0).reduce((g,h)=>g+h,0));return this._memoryUsed}}]);return f}();a.RasterTile=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){function z(w){const D=new k.ShaderBuilder;D.include(d.TileComposite);D.include(r.Common,w);D.include(n.Colormap,w);D.include(m.TileBackground,w);D.fragment.code.add(q.glsl`vec4 applyBackgroundBlend(vec4 layerColor) {
vec4 bgColor = getBackground(vuv);
return blendLayers(bgColor, layerColor, u_opacity);
}`);w.colorizerType===t.RasterColorizerType.Stretch?C(D,w):w.colorizerType===t.RasterColorizerType.Lut?D.fragment.code.add(q.glsl`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):w.colorizerType===t.RasterColorizerType.Hillshade&&B(D,w);return D}function C(w,D){w.fragment.uniforms.add([new v.IntegerPassUniform("u_bandCount",E=>E.symbolizer.u_bandCount),new l.FloatsPassUniform("u_minCutOff",E=>E.symbolizer.u_minCutOff,3),new l.FloatsPassUniform("u_maxCutOff",E=>E.symbolizer.u_maxCutOff,3),new l.FloatsPassUniform("u_factor",E=>E.symbolizer.u_factor,3),new h.FloatPassUniform("u_minOutput",E=>E.symbolizer.u_minOutput),new h.FloatPassUniform("u_maxOutput",E=>E.symbolizer.u_maxOutput),
new e.BooleanPassUniform("u_useGamma",E=>E.symbolizer.u_useGamma),new l.FloatsPassUniform("u_gamma",E=>E.symbolizer.u_gamma,3),new l.FloatsPassUniform("u_gammaCorrection",E=>E.symbolizer.u_gammaCorrection,3),new h.FloatPassUniform("u_opacity",E=>E.common.u_opacity)]);w.fragment.code.add(q.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const F=D.applyColormap?q.glsl`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:q.glsl`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;w.fragment.code.add(q.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${D.stretchType===t.RasterColorizerStretchType.Noop?q.glsl`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:q.glsl`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${F}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function B(w,D){w=w.fragment;w.uniforms.add([new p.Texture2DPassUniform("u_image",F=>F.u_image),new v.IntegerPassUniform("u_hillshadeType",F=>F.symbolizer.u_hillshadeType),new l.FloatsPassUniform("u_sinZcosAs",F=>F.symbolizer.u_sinZcosAs,6),new l.FloatsPassUniform("u_sinZsinAs",F=>F.symbolizer.u_sinZsinAs,6),new l.FloatsPassUniform("u_cosZs",F=>F.symbolizer.u_cosZs,6),new l.FloatsPassUniform("u_weights",F=>F.symbolizer.u_weights,6),new g.Float2PassUniform("u_factor",F=>F.symbolizer.u_factor),
new h.FloatPassUniform("u_minValue",F=>F.symbolizer.u_minValue),new h.FloatPassUniform("u_maxValue",F=>F.symbolizer.u_maxValue),new g.Float2PassUniform("u_srcImageSize",F=>F.common.u_srcImageSize)]);w.include(f.ColorConversion);w.code.add(q.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec4 color = colormap(vec4(val, val, val, 1.0), false);
vec3 hsv = rgb2hsv(color.rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv), 1.0) * alpha * color.a;
}`);w.code.add(q.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);D=D.applyColormap?q.glsl`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:q.glsl`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;w.code.add(q.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${D}
    }
  `)}let A=function(w){function D(F,E,K,J,M,N){F=w.call(this,F,J,M)||this;F.colormap=E;F.symbolizer=K;F.u_colormap=N;F.backgroundColor=b.ZEROS;F.fboTexture=null;F.baseOpacity=1;return F}c._inheritsLoose(D,w);return D}(r.CommonPassParameters),x=function(w){function D(){return w.apply(this,arguments)||this}c._inheritsLoose(D,w);return D}(A),u=function(w){function D(){return w.apply(this,arguments)||this}c._inheritsLoose(D,w);return D}(A);const y=Object.freeze(Object.defineProperty({__proto__:null,ColorizerHillshadeUniforms:u,
ColorizerStretchUniforms:x,ColorizerUniforms:A,build:z},Symbol.toStringTag,{value:"Module"}));a.ColorizerHillshadeUniforms=u;a.ColorizerStretchUniforms=x;a.ColorizerUniforms=A;a.RasterColorizer=y;a.build=z})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(c){c[c.Stretch=0]="Stretch";c[c.Lut=1]="Lut";c[c.Hillshade=2]="Hillshade";c[c.COUNT=3]="COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));a.RasterColorizerStretchType=
void 0;(function(c){c[c.Noop=0]="Noop";c[c.PerBand=1]="PerBand";c[c.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../util/WebGL2Utils","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,c,b,t,n){a.Colormap=function(r,m){r.fragment.uniforms.add([new n.Texture2DPassUniform("u_colormap",
d=>d.u_colormap),new b.FloatPassUniform("u_colormapOffset",d=>d.colormap.u_colormapOffset),new b.FloatPassUniform("u_colormapMaxIndex",d=>d.colormap.u_colormapMaxIndex),new b.FloatPassUniform("u_opacity",d=>d.common.u_opacity)]);r.fragment.code.add(t.glsl`
    vec4 colormap(vec4 currentPixel, bool isFloat) {
      float colorIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
      vec4 result;
      // handle no data and out of range pixels
      if (currentPixel.a == 0.0 || colorIndex > u_colormapMaxIndex) {
        result = vec4(0.0, 0.0, 0.0, 0.0);
      } else {
        // colormap lookup
        vec2 texelCoordinates = vec2((colorIndex + 0.5), 0.5);
        result = ${c.texelFetch(m,"u_colormap","texelCoordinates","(1.0 / vec2(u_colormapMaxIndex + 1.0, 1.0))")};
      }
      return result;
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,c,b,t,n,r,m){t=function(d){function f(e,g,h){var l=d.call(this)||this;l.common=e;l.u_image=g;l.u_transformGrid=
h;return l}c._inheritsLoose(f,d);return f}(t.TileCompositePassParameters);a.Common=function(d,f){d.include(b.Projection,f);d.fragment.uniforms.add([new m.Texture2DPassUniform("u_image",e=>e.u_image),new n.BooleanPassUniform("u_flipY",e=>e.common.u_flipY),new n.BooleanPassUniform("u_applyTransform",e=>e.common.u_applyTransform)]);d.fragment.code.add(r.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)};a.CommonPassParameters=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define("exports ../util/WebGL2Utils ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType".split(" "),function(a,c,b,t,n,r){a.Projection=function(m,d){m.fragment.uniforms.add(n.createTexture2DPassSizeUniforms("u_transformGrid",
f=>f.u_transformGrid,d.hasWebGL2Context?r.TextureSizeUniformType.None:r.TextureSizeUniformType.InvSize));m.fragment.uniforms.add(new b.Float2PassUniform("u_transformSpacing",f=>f.common.u_transformSpacing));m.fragment.uniforms.add(new b.Float2PassUniform("u_targetImageSize",f=>f.common.u_targetImageSize));m.fragment.code.add(t.glsl`
    vec2 projectPixelLocation(vec2 coords) {
      // Pixel index in row/column, corresponds to upperleft corner, e.g. [100, 20]
      vec2 index_image = floor(coords * u_targetImageSize);

      // Pixel's corresponding cell index in transform grid
      // Each transform cell corresponds to 4 pixels: 6 coefficients from lowerleft triangle followed by 6 coefficients from upperright triangle
      vec2 oneTransformPixel = vec2(4.0, 1.0);
      vec2 index_transform = floor(index_image / u_transformSpacing) * oneTransformPixel;

      // Correspoding position in transform grid cell, cell center coordinates
      vec2 pos = fract((index_image + 0.5) / u_transformSpacing);

      // Pixel's corresponding transform cell location, cell center coordinates
      vec2 transform_location = index_transform + 0.5;

      vec2 srcLocation;

      // Use lower triangle or upper triangle
      if (pos.s <= pos.t) {
        vec3 ll_abc = ${c.texelFetch(d,"u_transformGrid","transform_location")}.rgb;
        vec3 ll_def = ${c.texelFetch(d,"u_transformGrid","vec2(transform_location.s + 1.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ll_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ll_def, vec3(pos, 1.0));
      } else {
        vec3 ur_abc = ${c.texelFetch(d,"u_transformGrid","vec2(transform_location.s + 2.0, transform_location.t)")}.rgb;
        vec3 ur_def = ${c.texelFetch(d,"u_transformGrid","vec2(transform_location.s + 3.0, transform_location.t)")}.rgb;
        srcLocation.s = dot(ur_abc, vec3(pos, 1.0));
        srcLocation.t = dot(ur_def, vec3(pos, 1.0));
      }

      return srcLocation;
    }
  `)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,c,b,t,n,r,m){let d=function(f){function e(){var g=f.apply(this,arguments)||this;g.scale=
1;g.offset=b.ZEROS;return g}c._inheritsLoose(e,f);return e}(r.NoParameters);a.TileComposite=function(f){f.attributes.add(m.VertexAttribute.POSITION,"vec2");f.attributes.add(m.VertexAttribute.UV0,"vec2");f.vertex.uniforms.add(new n.FloatPassUniform("scale",e=>e.scale));f.vertex.uniforms.add(new t.Float2PassUniform("offset",e=>e.offset));f.varyings.add("uv","vec2");f.varyings.add("vuv","vec2");f.vertex.code.add(r.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)};a.TileCompositePassParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f64 ../output/BlendOptions ./BackgroundGrid.glsl ../util/BlendModes.glsl ../util/WebGL2Utils ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/TextureSizeUniformType".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){a.BlendLayersOutput=void 0;(function(v){v[v.Composite=0]="Composite";v[v.ColorComposite=1]="ColorComposite";v[v.GridComposite=2]="GridComposite";v[v.GroupBackgroundComposite=3]="GroupBackgroundComposite";v[v.COUNT=4]="COUNT"})(a.BlendLayersOutput||(a.BlendLayersOutput={}));a.BaseOpacityMode=void 0;(function(v){v[v.NotRequired=0]="NotRequired";v[v.Required=1]="Required";v[v.COUNT=2]="COUNT"})(a.BaseOpacityMode||(a.BaseOpacityMode={}));a.PremultipliedAlphaSource=void 0;
(function(v){v[v.Off=0]="Off";v[v.On=1]="On";v[v.COUNT=2]="COUNT"})(a.PremultipliedAlphaSource||(a.PremultipliedAlphaSource={}));let l=function(v){function q(){var k=v.apply(this,arguments)||this;k.baseOpacity=1;k.backgroundColor=b.ZEROS;k.fboTexture=null;return k}c._inheritsLoose(q,v);return q}(e.NoParameters);a.TileBackground=function(v,q){const k=q.output===a.BlendLayersOutput.GridComposite,p=q.output===a.BlendLayersOutput.ColorComposite,z=q.output===a.BlendLayersOutput.GroupBackgroundComposite,
C=q.output===a.BlendLayersOutput.Composite;k&&(v.extensions.add("GL_OES_standard_derivatives"),v.fragment.include(n.BackgroundGrid));p&&v.fragment.uniforms.add(new d.Float3PassUniform("backgroundColor",u=>u.backgroundColor));const B=q.baseOpacityMode===a.BaseOpacityMode.Required;B&&v.fragment.uniforms.add(new f.FloatPassUniform("baseOpacity",u=>u.baseOpacity));C&&v.fragment.uniforms.add(g.createTexture2DPassSizeUniforms("fboColor",u=>u.fboTexture,q.hasWebGL2Context?h.TextureSizeUniformType.None:h.TextureSizeUniformType.InvSize));
const A=q.blendMode!==t.LayerBlendMode.Normal,x=q.premultipliedSource===a.PremultipliedAlphaSource.On;v.fragment.include(r.BlendModes,q);v.fragment.code.add(e.glsl`
    vec4 getBackground(vec2 uv) {
      return ${B?e.glsl`baseOpacity *`:""} ${z?e.glsl`vec4(0.0, 0.0, 0.0, 0.0)`:p?e.glsl`vec4(backgroundColor, 1.0)`:k?e.glsl`vec4(gridColor(uv), 1.0)`:e.glsl`${m.texelFetch(q,"fboColor","gl_FragCoord.xy")}`};
    }

    vec4 blendLayers(vec4 bgColor, vec4 colorLayer, float opacity) {
      ${A?e.glsl`
          vec3 cl = colorLayer.a == 0.0 ? colorLayer.rgb : colorLayer.rgb / colorLayer.a;
          vec3 cb = bgColor.a == 0.0 ? bgColor.rgb : bgColor.rgb / bgColor.a;
          return applyBlendMode(clamp(cl, vec3(0.0), vec3(1.0)), colorLayer.a * opacity, cb, bgColor.a);`:e.glsl`
          float composeAlpha = colorLayer.a * opacity;
          return ${!x&&(C&&!B||z)?e.glsl`colorLayer * opacity;`:e.glsl`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`}`}
    }`)};a.TileBackgroundPassParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.LayerBlendMode=void 0;(function(c){c[c.Normal=0]="Normal";c[c.Average=1]="Average";c[c.Lighten=2]="Lighten";c[c.Lighter=3]="Lighter";c[c.Plus=4]="Plus";c[c.Screen=5]="Screen";c[c.ColorDodge=6]="ColorDodge";c[c.Darken=7]="Darken";c[c.Multiply=8]="Multiply";c[c.ColorBurn=9]="ColorBurn";
c[c.Overlay=10]="Overlay";c[c.SoftLight=11]="SoftLight";c[c.HardLight=12]="HardLight";c[c.VividLight=13]="VividLight";c[c.Hue=14]="Hue";c[c.Saturation=15]="Saturation";c[c.Luminosity=16]="Luminosity";c[c.Color=17]="Color";c[c.DestinationOver=18]="DestinationOver";c[c.DestinationAtop=19]="DestinationAtop";c[c.DestinationIn=20]="DestinationIn";c[c.DestinationOut=21]="DestinationOut";c[c.SourceAtop=22]="SourceAtop";c[c.SourceIn=23]="SourceIn";c[c.SourceOut=24]="SourceOut";c[c.Xor=25]="Xor";c[c.Difference=
26]="Difference";c[c.Exclusion=27]="Exclusion";c[c.Minus=28]="Minus";c[c.Invert=29]="Invert";c[c.Reflect=30]="Reflect";c[c.COUNT=31]="COUNT"})(a.LayerBlendMode||(a.LayerBlendMode={}));a.blendModeFromString={normal:a.LayerBlendMode.Normal,average:a.LayerBlendMode.Average,lighten:a.LayerBlendMode.Lighten,lighter:a.LayerBlendMode.Lighter,screen:a.LayerBlendMode.Screen,plus:a.LayerBlendMode.Plus,"color-dodge":a.LayerBlendMode.ColorDodge,darken:a.LayerBlendMode.Darken,multiply:a.LayerBlendMode.Multiply,
"color-burn":a.LayerBlendMode.ColorBurn,overlay:a.LayerBlendMode.Overlay,"soft-light":a.LayerBlendMode.SoftLight,"hard-light":a.LayerBlendMode.HardLight,"vivid-light":a.LayerBlendMode.VividLight,hue:a.LayerBlendMode.Hue,saturation:a.LayerBlendMode.Saturation,luminosity:a.LayerBlendMode.Luminosity,color:a.LayerBlendMode.Color,difference:a.LayerBlendMode.Difference,exclusion:a.LayerBlendMode.Exclusion,minus:a.LayerBlendMode.Minus,invert:a.LayerBlendMode.Invert,reflect:a.LayerBlendMode.Reflect,"destination-over":a.LayerBlendMode.DestinationOver,
"destination-atop":a.LayerBlendMode.DestinationAtop,"destination-in":a.LayerBlendMode.DestinationIn,"destination-out":a.LayerBlendMode.DestinationOut,"source-atop":a.LayerBlendMode.SourceAtop,"source-in":a.LayerBlendMode.SourceIn,"source-out":a.LayerBlendMode.SourceOut,xor:a.LayerBlendMode.Xor};a.isCompositeBlendMode=function(c){return c===a.LayerBlendMode.DestinationOver||c===a.LayerBlendMode.DestinationAtop||c===a.LayerBlendMode.DestinationIn||c===a.LayerBlendMode.DestinationOut||c===a.LayerBlendMode.SourceAtop||
c===a.LayerBlendMode.SourceIn||c===a.LayerBlendMode.SourceOut||c===a.LayerBlendMode.Xor};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.BackgroundGrid=function(b){b.code.add(c.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${c.glsl.float(257)};
      if(pos < 0.5 || pos > ${c.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec3 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec3(1.0, 0.972, 0.918) * line;
    }`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(a,c,b){a.BlendModes=function(t,n){n=n.blendMode;if(n!==c.LayerBlendMode.Normal){n===c.LayerBlendMode.Reflect&&t.code.add(b.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);n!==c.LayerBlendMode.ColorDodge&&n!==c.LayerBlendMode.VividLight||t.code.add(b.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);n!==c.LayerBlendMode.ColorBurn&&n!==c.LayerBlendMode.VividLight||t.code.add(b.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);n===c.LayerBlendMode.Overlay&&t.code.add(b.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);n===c.LayerBlendMode.HardLight&&t.code.add(b.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);n===c.LayerBlendMode.SoftLight&&t.code.add(b.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);n===c.LayerBlendMode.VividLight&&t.code.add(b.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(n===c.LayerBlendMode.Hue||n===c.LayerBlendMode.Saturation||n===c.LayerBlendMode.Color||n===c.LayerBlendMode.Luminosity)t.code.add(b.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),n!==c.LayerBlendMode.Hue&&n!==c.LayerBlendMode.Saturation||t.code.add(b.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);t.code.add(b.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${n===c.LayerBlendMode.Multiply?b.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.Average?b.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.Lighten?b.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.Darken?b.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
n===c.LayerBlendMode.Lighter?b.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:n===c.LayerBlendMode.Plus?b.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:n===c.LayerBlendMode.Minus?b.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:n===c.LayerBlendMode.Screen?b.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.Difference?b.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
n===c.LayerBlendMode.Invert?b.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:n===c.LayerBlendMode.DestinationOver?b.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:n===c.LayerBlendMode.DestinationAtop?b.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:n===c.LayerBlendMode.DestinationOut?b.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:n===c.LayerBlendMode.SourceAtop?b.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:n===c.LayerBlendMode.SourceOut?
b.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:n===c.LayerBlendMode.Xor?b.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:n===c.LayerBlendMode.DestinationIn?b.glsl`return vec4(cb * ob * ol, ol * ob);`:n===c.LayerBlendMode.SourceIn?b.glsl`return vec4(cl * ol * ob, ol * ob);`:n===c.LayerBlendMode.Hue?b.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.Saturation?b.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.Color?b.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.Luminosity?b.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.Exclusion?b.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.Reflect?b.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.ColorDodge?b.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.ColorBurn?b.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.Overlay?b.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.SoftLight?b.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.HardLight?b.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:n===c.LayerBlendMode.VividLight?b.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:b.glsl``}
    }
  `)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define("exports ../../core/maybe ../../chunks/vec2f64 ./context-util ./enums ./Texture".split(" "),function(a,c,b,t,n,r){a.createColormapTexture=function(m,d){return new r.Texture(m,{width:d.length/4,height:1,target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,
flipped:!1},d)};a.createRasterTexture=function(m,d,f="nearest",e=!1){const g=(e=!(e&&"u8"===d.pixelType))?n.PixelType.FLOAT:n.PixelType.UNSIGNED_BYTE,h=null==d.pixels||0===d.pixels.length?null:e?d.getAsRGBAFloat():d.getAsRGBA();return new r.Texture(m,{width:d.width,height:d.height,target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:m.type===t.ContextType.WEBGL2&&e?n.SizedPixelFormat.RGBA32F:n.PixelFormat.RGBA,samplingMode:!m.capabilities.textureFloat?.textureFloatLinear||
"bilinear"!==f&&"cubic"!==f?n.TextureSamplingMode.NEAREST:n.TextureSamplingMode.LINEAR,dataType:g,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},h)};a.createTransformTexture=function(m,d){const {spacing:f,offsets:e,coefficients:g,size:[h,l]}=d;var v=1<f[0];d={width:v?4*h:h,height:l,target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:m.type===t.ContextType.WEBGL2?n.SizedPixelFormat.RGBA32F:n.PixelFormat.RGBA,dataType:n.PixelType.FLOAT,samplingMode:n.TextureSamplingMode.NEAREST,
wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1};const q=new Float32Array(v?h*l*16:2*e.length);if(v&&null!=g)for(let k=0,p=0;k<g.length;k++)q[p++]=g[k],2===k%3&&(q[p++]=1);else for(v=0;v<l;v++)for(let k=0;k<h;k++){const p=4*(v*h+k),z=2*(k*l+v);q[p]=e[z];q[p+1]=e[z+1];q[p+3]=-1===e[z]?0:1}return new r.Texture(m,d,q)};a.getBasicGridUniforms=function(m,d){return{u_scale:m,u_offset:d}};a.getColormapUniforms=function(m,d){return{u_colormapOffset:d||0,u_colormapMaxIndex:m?m.length/4-1:0}};a.getCommonUniforms=
function(m,d,f,e=1,g=!0){return{u_flipY:g,u_applyTransform:m?!0:!1,u_opacity:e,u_transformSpacing:m?m.spacing:b.ZEROS,u_transformGridSize:m?m.size:b.ZEROS,u_targetImageSize:d,u_srcImageSize:f}};a.getShadedReliefUniforms=function(m){return{u_hillshadeType:m.hillshadeType,u_sinZcosAs:m.sinZcosAs,u_sinZsinAs:m.sinZsinAs,u_cosZs:m.cosZs,u_weights:m.weights,u_factor:m.factor,u_minValue:m.minValue,u_maxValue:m.maxValue}};a.getStretchUniforms=function(m){return{u_bandCount:m.bandCount,u_minOutput:m.outMin,
u_maxOutput:m.outMax,u_minCutOff:m.minCutOff,u_maxCutOff:m.maxCutOff,u_factor:m.factor,u_useGamma:m.useGamma,u_gamma:m.gamma,u_gammaCorrection:m.gammaCorrection}};a.getUniformLocationInfos=function(m,d){m=m.gl;d=d.glName;const f=new Map;if(c.isNone(d))return f;const e=m.getProgramParameter(d,m.ACTIVE_UNIFORMS);let g;for(let h=0;h<e;h++)(g=m.getActiveUniform(d,h))&&f.set(g.name,{location:m.getUniformLocation(d,g.name),info:g});return f};a.setTextures=function(m,d,f,e){f.length===e.length&&(e.some(g=>
null==g)||f.some(g=>null==g)||f.forEach((g,h)=>{d.setUniform1i(g,h);m.bindTexture(e[h],h)}))};a.setUniforms=function(m,d,f){Object.keys(f).forEach(e=>{var g=d.get(e)||d.get(e+"[0]");if(g){var h=f[e];if(null!==g&&null!=h)switch({info:g}=g,g.type){case n.UniformType.FLOAT:1<g.size?m.setUniform1fv(e,h):m.setUniform1f(e,h);break;case n.UniformType.FLOAT_VEC2:m.setUniform2fv(e,h);break;case n.UniformType.FLOAT_VEC3:m.setUniform3fv(e,h);break;case n.UniformType.FLOAT_VEC4:m.setUniform4fv(e,h);break;case n.UniformType.FLOAT_MAT3:m.setUniformMatrix3fv(e,
h);break;case n.UniformType.FLOAT_MAT4:m.setUniformMatrix4fv(e,h);break;case n.UniformType.INT:1<g.size?m.setUniform1iv(e,h):m.setUniform1i(e,h);break;case n.UniformType.BOOL:m.setUniform1i(e,h?1:0);break;case n.UniformType.INT_VEC2:case n.UniformType.BOOL_VEC2:m.setUniform2iv(e,h);break;case n.UniformType.INT_VEC3:case n.UniformType.BOOL_VEC3:m.setUniform3iv(e,h);break;case n.UniformType.INT_VEC4:case n.UniformType.BOOL_VEC4:m.setUniform4iv(e,h)}}})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),function(a,c,b,t,n,r,m){let d=function(){function g(){this.waitingAgents=new n;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}g.acquire=function(l){const v=f.acquire();v._init(l);return v};var h=g.prototype;h.release=function(){this.dispose();
e.delete(this);f.release(this)};h.dispose=function(){this.loadingAgent=b.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=r.releaseTileData(this._data)};g.prune=function(){f.prune(0)};h._init=function(l){this.waitingAgents.clear();this._data=r.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=0;this._pool=l;this.elevationBounds=null};
h.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};h.abortRequest=function(){this.requestAbort=b.abortMaybe(this.requestAbort);this.requestPromise=null};h._unsetUpsampleInfo=function(){b.isSome(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};h.setUpsampleInfo=function(l,v){if(l===v||b.isNone(v))this._unsetUpsampleInfo();else{if(b.isNone(this._upsampleInfo))this._upsampleInfo=
this._pool.acquire();else{if(this._upsampleInfo.tile===v)return;this._upsampleInfo.tile.unrefMapData()}v.refMapData();m.computeUpsampleInfo(l,v,this._upsampleInfo)}};c._createClass(g,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},{key:"data",get:function(){return this._data},set:function(l){r.releaseTileData(this._data);this._data=l}}]);return g}();const f=new t(d,null,()=>{}),e=new Map;a.TilePerLayerInfo=d;a.printAllocations=function(){0<e.size&&(console.log(`${e.size} live TilePerLayerInfo allocations:`),
e.forEach(g=>console.log(g,"\n")))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function c(t){this._texture=t;this.type="tile-texture";this._refCount=1}var b=c.prototype;b.retain=function(){++this._refCount};b.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};b.generateMipmap=function(){this._texture.generateMipmap()};
a._createClass(c,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return c}()})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(a){a.TileUpdate=void 0;var c=a.TileUpdate||(a.TileUpdate={});c[c.NONE=0]="NONE";c[c.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD";c[c.SPLIT=2]="SPLIT";c[c.VSPLITMERGE=4]="VSPLITMERGE";c[c.MERGE=8]="MERGE";c[c.RENDERDATA=16]="RENDERDATA";c[c.GEOMETRY=32]="GEOMETRY";c[c.TEXTURE_NOFADING=
64]="TEXTURE_NOFADING";c[c.TEXTURE_FADING=128]="TEXTURE_FADING";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../chunks/vec4f64"],function(a,c){return function(){function b(){this._scales=c.fromValues(-1,-1,-1,-1);this._offsets=c.fromValues(-1,-1,-1,-1)}var t=b.prototype;t.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=
this._offsets[1]=this._offsets[2]=this._offsets[3]=-1};t.setScale=function(n,r,m){this._scales[2*n]=r;this._scales[2*n+1]=m};t.setOffset=function(n,r,m){this._offsets[2*n]=r;this._offsets[2*n+1]=m};a._createClass(b,[{key:"scales",get:function(){return this._scales}},{key:"offsets",get:function(){return this._offsets}}]);return b}()})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){m=function(k){function p(){var C=k.apply(this,arguments)||this;C.useStencil=!1;return C}b._inheritsLoose(p,k);var z=p.prototype;z.initializeConfiguration=function(C,B){B.hasWebGL2Context=C.rctx.type===h.ContextType.WEBGL2;B.spherical=C.viewingMode===t.ViewingMode.Global};z.initializeProgram=function(C){return new f.Program(C.rctx,p.shader.get().build(this.configuration),q)};z.initializePipeline=function(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)};
z._createPipeline=function(C){const B=this.configuration,A=B.backfaceCullingEnabled&&!B.renderOccluded;return v.makePipelineState({blending:B.renderOccluded?v.simpleBlendingParams(l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:A?v.backFaceCullingParams:null,depthTest:B.renderOccluded?null:{func:l.CompareFunction.LESS},depthWrite:B.renderOccluded?null:v.defaultDepthWriteParams,colorWrite:v.defaultColorWriteParams,stencilTest:C?e.renderWhenBitIsNotSet(d.StencilBits.IntegratedMeshMaskExcluded):
null})};z.getPipelineState=function(C,B){return this.useStencil?this._stencilPipelineState:k.prototype.getPipelineState.call(this,C,B)};return p}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(n.Terrain,()=>new Promise((k,p)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],k,p)));const q=new Map([[g.VertexAttribute.POSITION,0],[g.VertexAttribute.UV0,1],[g.VertexAttribute.NORMALCOMPRESSED,2]]);c.TerrainTechnique=m;c.terrainVertexAttributeLocations=q;Object.defineProperty(c,Symbol.toStringTag,
{value:"Module"})})},"esri/chunks/Terrain.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M){function N(H){const L=new J.ShaderBuilder,{vertex:O,fragment:S,varyings:R}=L;L.include(l.PositionAttribute);L.include(h.NormalAttribute,H);L.include(v.TextureCoordinateAttribute,H);var Q=()=>{L.include(A.NormalUtils,H);O.code.add(E.glsl`
      vec3 decodeNormalTerrain(vec2 e) {
        float z = 1.0 - abs(e.x) - abs(e.y);
        vec3 n = vec3(e + vec2(e.x >= 0.0 ? 1.0 : -1.0, e.y >= 0.0 ? 1.0 : -1.0) * min(z,0.0),z);
        return normalize(n);
      }

      vec3 getNormal() {
        return  ${H.shading?E.glsl`decodeNormalTerrain(normalCompressed)`:E.glsl`getLocalUp(position, localOrigin)`};
      }
  `)};D.addProjViewLocalOrigin(O,H);L.include(g.Transform,H);const V=H.overlayMode!==y.OverlayMode.Disabled;switch(H.output){case f.ShaderOutput.Color:L.include(w.TerrainTexture,H);L.include(C.EvaluateSceneLighting,H);V&&L.include(w.OverlayTerrain,{...H,pbrMode:H.pbrMode===x.PBRMode.Terrain?x.PBRMode.TerrainWithWater:x.PBRMode.Water});const aa=H.overlayMode===y.OverlayMode.EnabledWithWater;aa&&L.include(q.VertexTangent,H);R.add("vnormal","vec3");R.add("vpos","vec3");R.add("vup","vec3");Q();(H.atmosphere||
H.screenSizePerspective)&&D.addViewNormal(O);(Q=H.receiveShadows&&!H.renderOccluded)&&L.include(d.ForwardLinearDepth,H);H.atmosphere&&R.add("wnormal","vec3");H.screenSizePerspective&&(R.add("screenSizeDistanceToCamera","float"),R.add("screenSizeCosAngle","float"));O.code.add(E.glsl`
        void main(void) {
          //Position
          vpos = position;
          vec3 positionWorld = position + localOrigin;
          gl_Position = transformPosition(proj, view, vpos);

          //Normal
          vnormal = getNormal();

          //Up
          vup = getLocalUp(position, localOrigin);

          ${aa?E.glsl`forwardVertexTangent(vnormal);`:E.glsl``}

          ${H.atmosphere?E.glsl`wnormal = normalize((viewNormal * vec4(normalize(positionWorld), 1.0)).xyz);`:""}

          //Texture UV
          vec2 uv = getUV0();
          forwardTextureCoordinatesWithTransform(uv);
          ${V?E.glsl`setOverlayVTC(uv);`:""}
          ${H.tileBorders?E.glsl`forwardTextureCoordinates();`:""}

          ${H.screenSizePerspective?E.glsl`
          vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
          screenSizeDistanceToCamera = length(viewPos);
          vec3 viewSpaceNormal = (viewNormal * vec4(normalize(positionWorld), 1.0)).xyz;
          screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}

          ${Q?E.glsl`forwardLinearDepth();`:""}

        }
      `);L.extensions.add("GL_OES_standard_derivatives");L.extensions.add("GL_EXT_shader_texture_lod");L.include(e.SliceDraw,H);L.include(C.EvaluateSceneLighting,H);L.include(z.EvaluateAmbientOcclusion,H);L.include(u.ReadShadowMapDraw,H);D.addCameraPosition(S,H);C.addAmbientBoostFactor(S);C.addLightingGlobalFactor(S);S.uniforms.add([O.uniforms.get("localOrigin"),new F.Float3PassUniform("viewDirection",(X,W)=>n.normalize(G,n.set(G,W.camera.viewMatrix[12],W.camera.viewMatrix[13],W.camera.viewMatrix[14])))]);
aa&&S.uniforms.add([new M.Texture2DPassUniform("ovWaterTex",(X,W)=>0===W.overlays.length?null:W.overlays[m.OverlayIndex.INNER].getNormalTexture(X.overlaySource)),new K.Matrix4DrawUniform("view",(X,W)=>b.translate(I,W.camera.viewMatrix,X.origin))]);S.code.add(E.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);B.addMainLightDirection(S);B.addMainLightIntensity(S);S.code.add(E.glsl`
        void main() {
          vec3 normal = normalize(vnormal);
          float vndl = dot(normal, mainLightDirection);

          float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));
          float shadow = ${H.receiveShadows&&!H.renderOccluded?"readShadowMap(vpos, linearDepth)":H.spherical&&H.shading?"lightingGlobalFactor * (1.0 - additionalAmbientScale)":"0.0"};

          float ssao = evaluateAmbientOcclusionInverse();
          vec4 tileColor = getTileColor();

          ${V?E.glsl`
              vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
              vec4 overlayColor = overlayOpacity * overlayColorOpaque;
              ${H.invisible?E.glsl`if (overlayColor.a == 0.0) { discard; }`:""}
              vec4 groundColor = tileColor;
              tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}

          // If combined alpha is 0 we can discard pixel. The performance impact by having a discard here
          // is neglectable because terrain typically renders first into the framebuffer.
          if(tileColor.a <= 0.0) {
            discard;
          }

          bool sliced = rejectBySlice(vpos);
          if (sliced) {
            tileColor *= sliceOpacity;
          }
          ${H.atmosphere?E.glsl`
              float ndotl = clamp(vndl, 0.0, 1.0);
              vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
              atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); // avoid atmosphere on bright base maps
              atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
              atm *= tileColor.a; // premultiply with tile alpha`:""}

          vec3 albedo = ${H.atmosphere?E.glsl`atm + tileColor.rgb;`:E.glsl`tileColor.rgb;`}

          // heuristic shading function used in the old terrain, now used to add ambient lighting

          vec3 additionalLight = ssao * mainLightIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

          ${H.pbrMode===x.PBRMode.Terrain||H.pbrMode===x.PBRMode.TerrainWithWater?E.glsl`gl_FragColor = vec4(evaluateTerrainLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight, normalize(vpos - cameraPosition), vup), tileColor.a);`:E.glsl`gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);`}
          ${aa?E.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
                vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
                vec4 viewPosition = view*vec4(vpos, 1.0);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + localOrigin);
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                float opacity = sliced ? sliceOpacity : 1.0;
                // un-gamma the ground color to mix in linear space
                gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w) * opacity;
              }`:""}
          ${H.screenSizePerspective?E.glsl`
            float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
            if (perspectiveScale <= 0.25) {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
            }
            else if (perspectiveScale <= 0.5) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
            }
            else if (perspectiveScale >= 0.99) {
              gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
            }
            else {
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
            }`:""}
          ${H.visualizeNormals?H.spherical?E.glsl`
                  vec3 localUp = normalize(vpos + localOrigin);
                  vec3 right = normalize(cross(vec3(0.0, 0.0, 1.0), localUp));
                  vec3 forward = normalize(cross(localUp, right));
                  mat3 tbn = mat3(right, forward, localUp);
                  vec3 tNormal = normalize(normal * tbn);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:E.glsl`
                  vec3 tNormal = normalize(normal);
                  gl_FragColor = vec4(vec3(0.5) + 0.5 * tNormal, 0.0);
              `:""}
          ${H.tileBorders?E.glsl`
              vec2 dVuv = fwidth(vuv0);
              vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv0, 1.0 - vuv0));
              float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
              gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
          gl_FragColor = highlightSlice(gl_FragColor, vpos);
        }
      `);break;case f.ShaderOutput.Depth:V&&L.include(w.OverlayTerrain,H);L.include(k.OutputDepth,H);d.addLinearDepth(L);d.addNearFar(L);O.code.add(E.glsl`
              void main(void) {
                ${V?E.glsl`setOverlayVTC(getUV0());`:""}
                gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
              }
          `);S.code.add(E.glsl`
              void main() {
                ${V&&H.invisible?E.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
                outputDepth(linearDepth);
              }
          `);break;case f.ShaderOutput.Shadow:case f.ShaderOutput.ShadowHighlight:case f.ShaderOutput.ShadowExcludeHighlight:L.include(k.OutputDepth,H);d.addLinearDepth(L);d.addNearFar(L);O.code.add(E.glsl`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`);S.code.add(E.glsl`void main() {
outputDepth(linearDepth);
}`);break;case f.ShaderOutput.Normal:V&&L.include(w.OverlayTerrain,H);R.add("vnormal","vec3");D.addViewNormal(O);Q();O.code.add(E.glsl`
            void main(void) {
              ${V?E.glsl`setOverlayVTC(getUV0());`:""}
              gl_Position = transformPosition(proj, view, position);
              vnormal = normalize((viewNormal * vec4(getNormal(), 1.0)).xyz);
            }
        `);S.code.add(E.glsl`
            void main() {
              ${V&&H.invisible?E.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
              vec3 normal = normalize(vnormal);
              if (gl_FrontFacing == false) {
                normal = -normal;
              }
              gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
            }
        `);break;case f.ShaderOutput.Highlight:V&&L.include(w.OverlayTerrain,H),O.code.add(E.glsl`
          void main() {
            ${V?E.glsl`setOverlayVTC(getUV0());`:""}
            gl_Position = transformPosition(proj, view, position);
          }
        `),L.include(p.OutputHighlight,H),S.code.add(E.glsl`
          void main() {
            ${V?E.glsl`if (getCombinedOverlayColor().a == 0.0) { discard; }`:""}
            outputHighlight();
          }
        `)}H.output===f.ShaderOutput.ObjectAndLayerIdColor&&(L.include(w.OverlayTerrain,{...H,pbrMode:x.PBRMode.Disabled}),O.code.add(E.glsl`void main(void) {
gl_Position = transformPosition(proj, view, position);
setOverlayVTC(getUV0());
}`),S.code.add(E.glsl`void main() {
gl_FragColor = getOverlayColorTexel(vtcOverlay);
}`));return L}let P=function(H){function L(){return H.apply(this,arguments)||this}c._inheritsLoose(L,H);return L}(w.OverlayTerrainPassParameters);const I=t.create(),G=r.create();t=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:P,build:N},Symbol.toStringTag,{value:"Module"}));a.Terrain=t;a.TerrainPassParameters=P;a.build=N})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,
c){a.VertexTangent=function(b,t){b.varyings.add("tbnTangent","vec3");b.varyings.add("tbnBiTangent","vec3");t.spherical?b.vertex.code.add(c.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):b.vertex.code.add(c.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);b.fragment.code.add(c.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../chunks/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../../../terrain/Overlay ../../renderPasses/AllRenderPasses ../ShaderOutput ../shading/MainLighting.glsl ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../util/WebGL2Utils ../../shaderModules/Float4DrawUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(z,C){z.extensions.add("GL_OES_standard_derivatives");C.pbrMode!==f.PBRMode.Water&&C.pbrMode!==f.PBRMode.WaterOnIntegratedMesh&&C.pbrMode!==f.PBRMode.TerrainWithWater||z.include(e.Water,C);const {vertex:B,fragment:A}=z;z.varyings.add("vtcOverlay","vec4");B.code.add(l.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);A.code.add(l.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);A.code.add(l.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);A.code.add(l.glsl`
    vec4 getOverlayColorTexel(vec4 texCoords) {
          vec2 texDim =  ${g.textureSize(C,"ovColorTex")};

          vec4 color0 = ${g.texelFetch(C,"ovColorTex","vec2(texCoords.x * 0.5, texCoords.y)*texDim")};
          vec4 color1 = ${g.texelFetch(C,"ovColorTex","vec2(texCoords.z * 0.5 + 0.5, texCoords.w)*texDim")};

          bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
          bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));

          return mix(color1 * float(isValid1), color0, float(isValid0));
    }
  `);if(C.pbrMode===f.PBRMode.Water||C.pbrMode===f.PBRMode.WaterOnIntegratedMesh||C.pbrMode===f.PBRMode.TerrainWithWater)d.addMainLightDirection(A),d.addMainLightIntensity(A),A.code.add(l.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, mainLightDirection, colorInput.rgb, mainLightIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)}function k(z,C){return 0===C.overlays.length?null:z.identifier===r.RenderPassIdentifier.Material&&z.output===m.ShaderOutput.Color?C.overlays[t.OverlayIndex.INNER].getColorTextureNoRasterImage():z.identifier===r.RenderPassIdentifier.Material&&z.output===m.ShaderOutput.ObjectAndLayerIdColor?C.overlays[t.OverlayIndex.INNER].getColorTexture(n.OverlaySource.ObjectAndLayerIdColor):z.identifier===r.RenderPassIdentifier.Highlight?C.overlays[t.OverlayIndex.INNER].getValidTexture(t.RenderTargetType.Highlight):
null}a.OverlayMode=void 0;(function(z){z[z.Disabled=0]="Disabled";z[z.Enabled=1]="Enabled";z[z.EnabledWithWater=2]="EnabledWithWater";z[z.COUNT=3]="COUNT"})(a.OverlayMode||(a.OverlayMode={}));const p=c.create();a.OverlayIM=function(z,C){const {vertex:B,fragment:A}=z;B.uniforms.add([new h.Float4DrawUniform("overlayTexOffset",(x,u)=>{for(const y of u.overlays){const {index:w,extent:D}=y;0<b.area(D)&&(p[2*w]=x.toMapSpace[0]/b.width(D)-D[0]/b.width(D),p[2*w+1]=x.toMapSpace[1]/b.height(D)-D[1]/b.height(D))}return p}),
new h.Float4DrawUniform("overlayTexScale",(x,u)=>{for(const y of u.overlays){const {index:w,extent:D}=y;0<b.area(D)&&(p[2*w]=x.toMapSpace[2]/b.width(D),p[2*w+1]=x.toMapSpace[3]/b.height(D))}return p})]);A.constants.add("overlayOpacity","float",1);A.uniforms.add(new v.Texture2DPassUniform("ovColorTex",(x,u)=>k(x,u)));q(z,C)};a.getColorTexture=k;a.overlay=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3f64","../shaderLibrary/ShaderOutput","../shaderLibrary/attributes/VertexNormal.glsl"],function(a,c,b,t,n){let r=function(e){function g(){var h=e.apply(this,arguments)||this;h.slicePlaneLocalOrigin=b.create();h.origin=h.slicePlaneLocalOrigin;return h}c._inheritsLoose(g,e);return g}(n.VertexNormalPassParameters);n=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);return g}(n.VertexNormalDrawParameters);
a.RenderPassIdentifier=void 0;(function(e){e[e.Material=0]="Material";e[e.ShadowMap=1]="ShadowMap";e[e.Highlight=2]="Highlight"})(a.RenderPassIdentifier||(a.RenderPassIdentifier={}));let m=function(e){function g(){var h=e.apply(this,arguments)||this;h.identifier=a.RenderPassIdentifier.Material;h.output=t.ShaderOutput.Color;h.transparent=!1;h.integratedMesh=!1;return h}c._inheritsLoose(g,e);return g}(r),d=function(e){function g(){var h=e.apply(this,arguments)||this;h.identifier=a.RenderPassIdentifier.ShadowMap;
return h}c._inheritsLoose(g,e);return g}(r),f=function(e){function g(){var h=e.apply(this,arguments)||this;h.identifier=a.RenderPassIdentifier.Highlight;return h}c._inheritsLoose(g,e);return g}(r);a.DrawParameters=n;a.HighlightPassParameters=f;a.MaterialPassParameters=m;a.PassParameters=r;a.ShadowMapPassParameters=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"vec4",t.BindType.Draw,(f,e,g)=>f.setUniform4fv(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.Float4DrawUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../terrain/interfaces ./BackgroundGrid.glsl ./Overlay.glsl ./TileBlendInput ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform ../../shaderModules/Uniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e){let g=function(k){function p(){var z=k.apply(this,arguments)||this;z.overlayOpacity=1;return z}c._inheritsLoose(p,k);return p}(d.NoParameters),h=function(k){function p(z){return k.call(this,z,"float")||this}c._inheritsLoose(p,k);return p}(e.Uniform),l=function(k){function p(z){return k.call(this,z,"vec3")||this}c._inheritsLoose(p,k);return p}(e.Uniform),v=function(k){function p(z){return k.call(this,z,"vec4")||this}c._inheritsLoose(p,k);return p}(e.Uniform),q=function(k){function p(z){return k.call(this,
z,"sampler2D")||this}c._inheritsLoose(p,k);return p}(e.Uniform);a.Float3Uniform=l;a.OverlayTerrain=function(k,p){k.vertex.uniforms.add([new v("overlayTexOffset"),new v("overlayTexScale")]);k.fragment.uniforms.add([new m.FloatPassUniform("overlayOpacity",z=>z.overlayOpacity),new f.Texture2DPassUniform("ovColorTex",(z,C)=>0===C.overlays.length?null:C.overlays[b.OverlayIndex.INNER].getColorTexture(z.overlaySource))]);n.overlay(k,p)};a.OverlayTerrainPassParameters=g;a.TerrainTexture=function(k,p){const {vertex:z,
fragment:C,varyings:B}=k;B.add("vtc","vec2");z.uniforms.add(new v("texOffsetAndScale"));C.uniforms.add(new q("tex"));C.uniforms.add(new l("textureOpacities"));if(k=p.textureFadingEnabled&&!p.renderOccluded)z.uniforms.add(new v("nextTexOffsetAndScale")),B.add("nvtc","vec2"),C.uniforms.add(new q("texNext")),C.uniforms.add(new l("nextTexOpacities")),C.uniforms.add(new h("fadeFactor"));const A=p.tileBlendInput===r.TileBlendInput.ColorComposite;(p=p.tileBlendInput===r.TileBlendInput.GridComposite)&&C.include(t.BackgroundGrid);
A&&C.uniforms.add(new l("backgroundColor"));z.code.add(d.glsl`
  void forwardTextureCoordinatesWithTransform(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${k?d.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:d.glsl``}
  }`);C.code.add(d.glsl`
    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${p||A?d.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = vec4(${A?d.glsl`backgroundColor`:d.glsl`gridColor(uv)`} * opacities.y, opacities.y);
              vec4 layer = color * opacities.z;
              return (bg * (1.0 - layer.a) + layer) * opacities.x;`:d.glsl`return color;`}
    }`);k?C.code.add(d.glsl`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):C.code.add(d.glsl`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)};a.Texture2DUniform=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(a){a.TileBlendInput=void 0;var c=a.TileBlendInput||(a.TileBlendInput={});c[c.LayerOnly=0]="LayerOnly";c[c.ColorComposite=1]="ColorComposite";c[c.GridComposite=2]="GridComposite";c[c.COUNT=3]="COUNT";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/ObjectPool ../../../core/PooledArray ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4 ../../../chunks/vec4f64".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){let l=function(){this.extent=h.create();this.maxLevel=this.minLevel=0;this.callback=null};a.ScaleRangeQueries=function(v){function q(){var p=v.apply(this,arguments)||this;p._queries=new r({initialSize:10});p._queriesInvPtr=0;p._queryQueue=new r({initialSize:30});p._queryPool=new n(l);return p}c._inheritsLoose(q,v);var k=q.prototype;k.queryVisibleLevelRange=function(p,z,C,B){const A=this._queryPool.acquire();g.copy(A.extent,p);A.minLevel=null==z?-Number.MAX_VALUE:
z;A.maxLevel=null==C?Number.MAX_VALUE:C;A.callback=B;this._queryQueue.push(A);this.notifyChange("updating")};k.prepare=function(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const p=this._queryQueue.pop();this._queries.push(p)}this._queriesInvPtr=this._queries.length};k.process=function(){for(let p=0;p<this._queries.length;p++){const z=this._queries.data[p];this._queryPool.release(z);z.callback(p>=this._queriesInvPtr);z.callback=null}this._queries.clear();this.notifyChange("updating")};
k.queriesForTile=function(p){const z=p.level;let C=0;for(;C<this._queriesInvPtr;){const B=this._queries.data[C],A=B.extent;z>=B.minLevel&&z<=B.maxLevel&&A[0]<=p.extent[2]&&A[2]>=p.extent[0]&&A[1]<=p.extent[3]&&A[3]>=p.extent[1]?(this._queries.swapElements(C,this._queriesInvPtr-1),this._queriesInvPtr--):C++}};c._createClass(q,[{key:"updating",get:function(){return 0!==this._queryQueue.length}}]);return q}(t);b.__decorate([m.property()],a.ScaleRangeQueries.prototype,"updating",null);a.ScaleRangeQueries=
b.__decorate([e.subclass("esri.views.3d.terrain.ScaleRangeQueries")],a.ScaleRangeQueries);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/frustum ../../../chunks/sphere ./interfaces ./PatchGeometryFactory ./terrainUtils ./Tile ./tileUtils ../webgl-engine/lib/DoubleArray".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(x,u,y,w,D,F){x=w-x;u=D-u;y=F-y;return x*x+u*u+y*y}let k=function(x){function u(w,D,F){var E=x.call(this)||this;E._convexHull=Array(24);E._boundingSphere=d.create();void 0!==w&&E.init(w,D,F);return E}c._inheritsLoose(u,x);var y=u.prototype;y.init=function(w,D,F){x.prototype.init.call(this,w,D,F);D=this.ellipsoid.radius;F=this.extentInRadians[0];const E=this.extentInRadians[1],K=this.extentInRadians[2],J=this.extentInRadians[3];w=w[0];const M=b.lerp(E,
J,.5),N=b.lerp(F,K,.5);this._edgeLen=(K-F)*Math.cos(0===w?0:Math.min(Math.abs(E),Math.abs(J)))*D;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=D-Math.sqrt(D*D-this._edgeLen2/4);r.lonLatToSphericalPCPF(this.centerAtSeaLevel,N,M,this.ellipsoid.radius);D=n.fromArray(this.centerAtSeaLevel);t.normalize(D,D);this.up=D;this.updateRadiusAndCenter()};y.updateRadiusAndCenter=function(){this._updateBoundingVolumes();const w=this._center;if(0===this.lij[0])t.set(w[h.CenterPosition.MIDDLE],
0,0,0),t.set(w[h.CenterPosition.TOP],0,0,0),t.set(w[h.CenterPosition.BOTTOM],0,0,0),w[h.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const J=w[h.CenterPosition.MIDDLE],M=this.convexHull;var D=0;for(let N=0;8>N;++N){var F=Math,E=F.max;var K=3*N;K=q(J[0],J[1],J[2],M[K+0],M[K+1],M[K+2]);D=E.call(F,D,K)}w[h.CenterPosition.MIDDLE][3]=Math.sqrt(D)}};y._calculateFrustumVisibilityStatus=function(w){if(!m.intersectsSphere(w,this._boundingSphere))return f.TileFrustumVisibility.OUTSIDE;
if(10>this.lij[0])return f.TileFrustumVisibility.INTERSECTS;const D=this.convexHull,F=this.surface.view.state.camera.near;let E=!0;for(let J=0;J<m.NumPlanes.NUM;J++){var K=w[J];const M=K[0],N=K[1],P=K[2];K=K[3]-(J===m.PlaneIndex.NEAR?F:0);let I=!1;for(let G=0;8>G;++G){const H=3*G;if(0>M*D[H+0]+N*D[H+1]+P*D[H+2]+K){if(I=!0,!E)break}else E=!1}if(!I)return f.TileFrustumVisibility.OUTSIDE}return E?f.TileFrustumVisibility.INSIDE:f.TileFrustumVisibility.INTERSECTS};y.computeElevationBounds=function(){x.prototype.computeElevationBounds.call(this);
this._updateBoundingVolumes()};y.createGeometry=function(){e.createSphericalGlobePatch(this.renderData,this._getPatchType());this._updateBoundingVolumes();this.setMemoryDirty()};y._updateBoundingVolumes=function(){this._updateConvexHull();this._updateBoundingSphere();g.ENABLE_TERRAIN_INTERNAL_CHECKS&&this._checkBVs()};y._updateBoundingSphere=function(){const w=this._boundingSphere;var D=this.elevationBounds,F=this.ellipsoid.radius,E=D[1];if(0===this.level)t.set(w,0,0,0),w[3]=F+E;else{E=this.extentInRadians;
var K=.5*(E[0]+E[2]),J=E[3];z(B,K,E[1],F);z(A,K,J,F);t.add(w,B,A);t.scale(w,w,(F+.5*(D[0]+D[1]))/t.len(w));D=this.convexHull;F=0;for(E=0;8>E;++E){K=w[0]-D[3*E];J=w[1]-D[3*E+1];const M=w[2]-D[3*E+2];F=Math.max(F,Math.sqrt(K*K+J*J+M*M))}w[3]=F+2}};y._updateConvexHull=function(){var w=this.extentInRadians,D=this.ellipsoid.radius;if(0!==this.level){var F=this.elevationBounds,E=this._getPatchType(),K=this.surface.isWebMercator,J=K&&E===f.PatchType.HAS_NORTH_POLE,M=(E=K&&E===f.PatchType.HAS_SOUTH_POLE)||
J;K=Math.PI/2;var N=w[0],P=w[2];E=E?-K:w[1];var I=J?K:w[3],G=.5*(N+P);w=F[0];var H=D+(M?Math.min(0,w-1):w);w=n.create();J=n.create();K=n.create();var L=n.create();z(w,N,E,H);z(J,N,I,H);z(K,P,I,H);z(L,P,E,H);N=(V,aa)=>{for(let X=0;3>X;++X)this._convexHull[3*aa+X]=V[X]};N(w,0);N(J,1);N(K,2);N(L,3);F=F[1];var O=D+(M?Math.max(0,F+1):F),S=n.create();D=n.create();F=n.create();z(D,G,I,H);z(F,G,E,H);t.add(S,D,F);t.normalize(S,S);var R=n.create(),Q=n.create();E=(V,aa)=>{t.sub(Q,V,aa);t.normalize(Q,Q);aa=-t.dot(V,
R)/t.dot(Q,R);g.internalAssert(0<=aa);t.scale(Q,Q,aa);t.add(V,V,Q)};2**this.lij[0]>2*this.lij[1]?(D=n.create(),t.cross(D,C,F),t.normalize(D,D),t.cross(R,F,D),t.normalize(R,R),g.internalAssert(g.almostEquals(t.dot(R,F)/t.len(F),0)),E(w,J),E(L,K),N(w,0),N(L,3)):2**this.lij[0]!==2*this.lij[1]&&(F=n.create(),t.cross(F,C,D),t.normalize(F,F),t.cross(R,F,D),t.normalize(R,R),E(J,w),E(K,L),N(J,1),N(K,2));D=(V,aa)=>{const X=O/t.dot(aa,S);for(let W=0;3>W;++W)this._convexHull[3*V+W]=aa[W]*X};D(4,w);D(5,J);D(6,
K);D(7,L)}};y._getPatchType=function(){const w=this.lij[1],D=w===(1<<this.level)-1;return 0===w?D?f.PatchType.HAS_BOTH_POLES:f.PatchType.HAS_NORTH_POLE:D?f.PatchType.HAS_SOUTH_POLE:f.PatchType.REGULAR};y.intersectsRay=function(w,D,F,E){var K=this._boundingSphere;F=K[3]+F;var J=K[0]-w[0];E=K[1]-w[1];w=K[2]-w[2];K=(J*D[0]+E*D[1]+w*D[2])/(D[0]*D[0]+D[1]*D[1]+D[2]*D[2]);J=D[0]*K-J;E=D[1]*K-E;D=D[2]*K-w;return J*J+E*E+D*D<F*F};y.getDefaultVerticesPerSide=function(){return this.level<p.length?p[this.level]+
1:2};y.updateCornerElevations=function(){e.updateCornerSpherical(this.renderData);this._updateBoundingVolumes()};y.updateEdgeElevations=function(){e.updateEdgesAndCornersSpherical(this.renderData);this._updateBoundingVolumes()};y._checkBVs=function(){if(g.ENABLE_TERRAIN_INTERNAL_CHECKS&&!(2>=this.level)){var w=this._boundingSphere,D=w[3],F=n.create(),E=this.ellipsoid.radius,K=this.elevationBounds;K[1]-K[0];var J=E+K[0],M=this._center[h.CenterPosition.MIDDLE][3],N=this.convexHull,P=(wa,za)=>{for(let sa=
0;3>sa;++sa)wa[sa]=N[3*za+sa]},I=n.create(),G=n.create(),H=n.create(),L=n.create(),O=n.create(),S=(wa,za,sa,ua)=>{P(G,wa);P(H,za);P(L,sa);t.sub(G,G,H);t.sub(L,L,H);t.cross(I,G,L);t.normalize(I,I);var oa=t.dot(I,H);P(O,ua);const xa=t.dot(I,O);oa=Math.abs(xa-oa);g.internalAssert(g.almostEquals(oa,0),`Non coplanar ${wa},${za},${sa},${ua} diff = ${oa}`)};S(0,1,2,3);S(4,5,6,7);S(0,1,4,5);S(1,2,5,6);S(2,3,6,7);S(3,0,7,4);var R=v.newDoubleArray(24),Q=n.create(),V=n.create(),aa=n.create(),X=n.create();S=
(wa,za,sa,ua)=>{P(Q,za);P(V,sa);P(aa,ua);t.sub(Q,Q,V);t.normalize(Q,Q);t.sub(aa,aa,V);t.normalize(aa,aa);t.cross(X,Q,aa);t.normalize(X,X);za=t.dot(X,V);wa*=4;for(sa=0;3>sa;++sa)R[wa+sa]=X[sa];R[wa+3]=za};S(0,0,1,2);S(1,1,0,4);S(2,1,5,2);S(3,3,2,6);S(4,4,0,3);S(5,4,6,5);var W=(wa,za,sa,ua)=>{wa*=4;return R[wa+0]*za+R[wa+1]*sa+R[wa+2]*ua-R[wa+3]},T=(wa,za,sa,ua)=>-1<=W(wa,za,sa,ua),U=2**this.lij[0]>2*this.lij[1];S=(wa,za,sa)=>Math.sqrt(q(wa,za,sa,w[0],w[1],w[2]))<D;var Y=this.extentInRadians,ba=.5*
(Y[0]+Y[2]),da=Y[1],ea=Y[3];Y=n.create();var ca=n.create();z(Y,ba,ea,J);z(ca,ba,da,J);J=U?"Upper":"Lower";U=!0;for(ba=0;6>ba;++ba){for(da=0;8>da;++da)ea=3*da,ea=-1<=W(ba,N[ea+0],N[ea+1],N[ea+2]),U&&(U=ea),g.internalAssert(ea,`Tile[${this.lij}] Convex hull point ${da} outside of plane ${ba}`);g.internalAssert(T(ba,ca[0],ca[1],ca[2]),`Tile[${this.lij}] (${J}) bottom mid outside of plane ${ba}`);g.internalAssert(T(ba,Y[0],Y[1],Y[2]),`Tile[${this.lij}] (${J}) top mid outside of plane ${ba}`)}g.internalAssert(U,
"Not all convex hull points are inside  convex hull polyhedron");g.internalAssert(S(ca[0],ca[1],ca[2]),`Tile[${this.lij}] (${J}) bottom mid outside of bounding sphere`);g.internalAssert(S(Y[0],Y[1],Y[2]),`Tile[${this.lij}] (${J}) top mid outside of bounding sphere`);for(T=0;8>T;++T)Y=3*T,Y=S(N[Y+0],N[Y+1],N[Y+2]),g.internalAssert(Y,`Tile[${this.lij}] Convex hull point ${T} outside of bounding sphere`);for(S=0;6>S;++S)for(T=0;8>T;++T)Y=3*T,-1<=W(S,N[Y+0],N[Y+1],N[Y+2])||console.error(`Tile[${this.lij}] Convex hull point ${T} outside of plane ${S}`);
S=this.extentInRadians;S=Math.round(Math.max(S[2]-S[0],S[3]-S[1])*E);if(da=this.renderData)if(U=da.geometryInfo,ca=da.localOrigin,J=U.vertexAttributes?.position){T=J.count;Y=n.create();U=U.numVerticesPerSide-2;ba=U*U;da=da.geometryState.neighborData;ea=da.edgeResolutions.reduce((wa,za)=>wa+za+1,0);for(let wa=0;wa<T;++wa){var ja=wa<ba,ia=!ja&&wa<ba+ea,Z=!1,ha=-1;if(ia){var fa=ba;for(var ka=0;4>ka;++ka){var la=da.edgeResolutions[ka];if(wa===fa||wa===fa+la-1){Z=!0;break}fa+=la;if(wa<fa){ha=ka;break}}}fa=
ha;ha=ia&&!Z;fa=ia?da.edgePeerNeighbors[fa]:null;ka=ia&&fa&&0<l.compareTilesByLij(this,fa);var na=ja?"internal":ha?"edge":Z?"corner":"pole";J.getVec(wa,F);t.add(Y,F,ca);ja=t.len(Y)-E;ia=0;Z=!1;ha=K[0]-ja;fa=ja-K[1];var pa=1<ha,va=1<fa;la=pa||va;ka=`Tile[${this.lij}].vertex[${wa}]:${na}`+(pa?"(below)":va?"(above)":"")+(ka?"(Neighbor)":"");na=t.dist(Y,w);na>=D+0&&(na-=D,la||(console.error(`${ka} is out of the bounding sphere by ${na.toFixed(0)} / ${D.toFixed(0)}`+"[tol\x3d0]"+` h=${ja.toFixed(0)} / [${K[0].toFixed(0)}..${K[1].toFixed(0)}] (${(na/
D).toFixed(0)})`),Z=!0));for(la=0;6>la;++la)-1<=W(la,Y[0],Y[1],Y[2])||(na=W(la,Y[0],Y[1],Y[2]),pa=wa%U,va=(wa-pa)/U,0===la&&ha||5===la&&fa||(console.error(`${ka} (${pa},${va})|${U}] is out of the bounding trapezoid plane ${la}`+` h=${Math.round(ja)} / [${Math.round(K[0])}..${Math.round(K[1])}] dist=${Math.round(na)}`+` radii = ${Math.round(D)}/${Math.round(M)}} : maxL = ${S}`),++ia));if(Z||0<ia)break}}}};c._createClass(u,[{key:"convexHull",get:function(){return this._convexHull}}]);return u}(h.Tile);
const p=[128,64,64,32,16,8,8,4],z=(x,u,y,w)=>{const D=Math.sin(u),F=Math.cos(y);y=Math.sin(y);x[0]=w*F*Math.cos(u);x[1]=w*F*D;x[2]=w*y},C=[0,0,1],B=n.create(),A=n.create();a.SphericalPatch=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/SplitLimits":function(){define(["exports"],function(a){a.SplitLimits=function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./Overlay ./OverlayRenderer ./PatchGeometry ./PatchRenderData ./RenderOrder ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutput ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/Terrain.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/lib/Attribute ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V,aa,X,W,T,U,Y,ba){const da=k.create();a.TransparencyMode=void 0;(function(Z){Z[Z.Opaque=0]="Opaque";Z[Z.Semitransparent=1]="Semitransparent";Z[Z.TransparentWithDraped=2]="TransparentWithDraped";Z[Z.Empty=3]="Empty"})(a.TransparencyMode||(a.TransparencyMode={}));a.TerrainRenderer=function(Z){function ha(ka){ka=Z.call(this,ka)||this;ka.type=S.IntersectorType.TERRAIN;ka.isGround=!0;ka._tileSize=256;ka._techniqueConfiguration=
new Y.TerrainTechniqueConfiguration;ka._passParameters=new P.TerrainPassParameters;ka._rctx=null;ka._renderDataPool=new m(y.PatchRenderData);ka._patchGroups=new Map;ka._patchGroupsDirty=!0;ka._patchSortingDirty=!0;ka._tileIterator=new K.IteratorPreorder;ka._highestVisibleLODTile=null;ka._visible=!0;ka._transparencyState=a.TransparencyMode.Opaque;ka._velvetOverground=!0;ka._castShadows=!0;ka._emptyTex=null;ka._tileRenderer=null;ka._stencilEnabledLayerExtents=[];ka._numTilesRendered=0;ka._numTilesCulled=
0;ka._numOriginsRendered=0;ka.needsHighlight=!1;ka.renderOccludedFlags=R.RenderOccludedFlag.Occlude;return ka}c._inheritsLoose(ha,Z);var fa=ha.prototype;fa.initialize=function(){this._stage.addRenderPlugin([Q.RenderSlot.OPAQUE_TERRAIN,Q.RenderSlot.TRANSPARENT_TERRAIN,Q.RenderSlot.OCCLUDED_TERRAIN],this)};fa.destroy=function(){this._stage.removeRenderPlugin(this);u.clearCaches()};fa.setDebugScreenSizePerspective=function(ka){this._techniqueConfiguration.screenSizePerspective!==ka&&(this._techniqueConfiguration.screenSizePerspective=
ka,this.setNeedsRender())};fa.setRootTiles=function(ka){this._rootTiles=ka;this.setDirty()};fa.setNeedsHighlight=function(ka){this.needsHighlight=ka;this.setNeedsRender()};fa.setRenderOccludedOverlay=function(ka){this.renderOccludedFlags=ka?x.overlayRenderOccludedFlag:R.RenderOccludedFlag.Occlude;this.setNeedsRender()};fa.setStencilEnabledLayerExtents=function(ka){this._stencilEnabledLayerExtents=ka;this._setSortingDirty()};fa.setTileSize=function(ka){this._tileSize=ka;r.isSome(this._tileRenderer)&&
(this._tileRenderer.tileSize=ka);this.setDirty()};fa._prepareTileForLoading=function(ka){ka.renderData||(ka.renderData=this._renderDataPool.acquire(),ka.renderData.init(ka),ka.renderData.localOrigin=this._getLocalOriginOfTile(ka))};fa.loadTile=function(ka){this._prepareTileForLoading(ka);this.updateTileGeometryState(ka);this.updateTileTexture(ka,E.TileUpdate.TEXTURE_FADING)};fa.updateTileTexture=function(ka,la){r.isSome(this._tileRenderer)&&(this._tileRenderer.updateTileTexture(ka,la===E.TileUpdate.TEXTURE_FADING?
C.TextureUpdate.FADING:C.TextureUpdate.UNFADED),this.setNeedsRender(),ka.resetPendingUpdate(la))};fa.updateTileGeometryState=function(ka){for(const la of ka.layerInfo[B.LayerClass.ELEVATION])la.pendingUpdates&=~E.TileUpdate.GEOMETRY;ka.resetPendingUpdate(E.TileUpdate.GEOMETRY);(ka=ka.renderData.updateGeometryState())&&this.setDirty();return ka};fa.updateGeometryIfNeeded=function(ka){ka.isLoaded&&ka.renderData.updateGeometryIfNeeded(this._rctx)};fa.unloadTile=function(ka){const la=ka.renderData;la&&
(la.releaseGeometry(),this._renderDataPool.release(la),la.clear(),ka.renderData=null,ka.setMemoryDirty(),this.setDirty())};fa._getLocalOriginOfTile=function(ka){const la=Math.max(0,7*Math.floor((ka.level-3)/7));if(this._isGlobal&&0===la)return v.ZEROS;for(;ka.parent&&ka.level>la;)ka=ka.parent;return ka.centerAtSeaLevel};fa.setVisibility=function(ka){this._visible=ka;this.setDirty()};fa.getStats=function(){return{numTilesRendered:this._numTilesRendered,numTilesCulled:this._numTilesCulled,numOriginsRendered:this._numOriginsRendered}};
fa.setDirty=function(ka=H.RenderRequestType.UPDATE){this._patchGroupsDirty=!0;this._context.requestRender(ka)};fa._setSortingDirty=function(ka=H.RenderRequestType.UPDATE){this._patchSortingDirty=!0;this._context.requestRender(ka)};fa.setNeedsRender=function(ka=H.RenderRequestType.UPDATE){this._context.requestRender(ka)};fa.initializeRenderContext=function(ka){this._context=ka;this._rctx=ka.renderContext.rctx;this._techniqueRepository=ka.techniqueRepository;this._tileRenderer=new F.TileRenderer(this._rctx,
this._tileSize,this._techniqueRepository);this.updateTileBackground();this._emptyTex=L.createEmptyTexture(this._rctx)};fa.uninitializeRenderContext=function(){this._emptyTex=r.disposeMaybe(this._emptyTex);this._tileRenderer=r.disposeMaybe(this._tileRenderer)};fa.intersect=function(ka,la,na,pa){if(!(!this._rootTiles||ka.options.selectOpaqueTerrainOnly&&ka.options.selectionMode&&this.transparency!==a.TransparencyMode.Opaque)){var va=ea,wa=ca;l.subtract(va,pa,na);l.set(wa,1/va[0],1/va[1],1/va[2]);var za=
ka.results.min,sa=ka.results.max,ua=ka.results.ground,oa=ka.options.store===S.StoreResults.MIN,xa=!!ka.results.ground.target,Ea=X.getVerticalOffsetTerrain(ka.verticalOffset),Ia=ka.tolerance,Na,Oa=oa&&r.isSome(za.dist)?za.dist:Infinity,Ja=Ua=>{var Za=Ua.renderData;if(Za?.vao){var ma=Za.geometryInfo;k.set(da,ma.boundingBox);var Ya=Za.localOrigin;r.isSome(Ea)&&(Ea.localOrigin=Ya,Ea.applyToAabb(da));ja[0]=na[0]-Ya[0];ja[1]=na[1]-Ya[1];ja[2]=na[2]-Ya[2];if(T.intersectAabbInvDirBefore(da,ja,wa,Ia,Oa)){var bb=
(qa,ya,Da)=>{qa.set(this.type,Ua,ya,Da,h.IDENTITY);Oa=oa&&r.isSome(za.dist)?za.dist:Infinity};Za=(qa,ya)=>{r.isSome(ya)&&0<=qa&&(ka.options.backfacesTerrain||0>l.dot(ya,va))&&(ka.options.invisibleTerrain||!ka.options.selectionMode||null==la||la(na,pa,qa))&&((null==ua.dist||qa<ua.dist)&&bb(ua,qa,ya),ka.options.isFiltered||(ka.options.store===S.StoreResults.ALL&&(r.isNone(Na)?(Na=O.newIntersectorResult(ka.ray),bb(Na,qa,ya),ka.results.all.push(Na)):qa<Na.dist&&bb(Na,qa,ya)),(null==za.dist||qa<za.dist)&&
bb(za,qa,ya),ka.options.store!==S.StoreResults.MIN&&(null==sa.dist||qa>sa.dist)&&bb(sa,qa,ya)))};var Qa=ia;l.subtract(Qa,pa,Ya);Ya=ma.indices;var Aa=ma.vertexAttributes,Ca=Aa.getField(aa.VertexAttribute.POSITION,p.BufferViewVec3f);Aa=new G.Attribute(Ca.typedBuffer,3,!1,Aa.stride/4);ma=ma.indexCount/3;r.isNone(Ea)&&ma>J.componentMinimalSizeForIntersectionData?(Ca=Ua.renderData,r.isNone(Ca.intersectionData)&&(Ca.intersectionData=new J.ComponentIntersectionData(Ya,0,ma,Aa)),Ca.intersectionData.intersectRay({r0:ja,
r1:Qa},Za)):T.intersectTriangles(ja,Qa,0,ma,Ya,Aa,null,Ea,Za)}}},Sa=this._rootTiles;r.isSome(Sa)&&(()=>{const Ua=this._tileIterator;Ua.reset(Sa);const Za=ka.options.invisibleTerrain;for(let ma=Ua.next();ma;ma=Ua.next())!(ma.visible||Za&&ma.intersectsClippingArea)||!r.isSome(Ea)&&!ma.intersectsRay(na,va,Ia,Oa)||xa&&this._useStencilForTile(ma)?Ua.skipSubtree():Ja(ma)})()}};fa.processScaleRangeQueries=function(ka,la){if(!la.done)for(this._updatePatchGroups();ka.updating&&!la.done;){ka.prepare();for(const na of this._patchGroups.values())for(const pa of na)r.isSome(pa.renderData?.textureReference)&&
ka.queriesForTile(pa);ka.process();la.madeProgress()}};fa.prepareTechnique=function(ka){if(ka.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN){if(0===(ka.renderOccludedMask&x.overlayRenderOccludedFlag))return null}else if(ka.bindParameters.slot!==(this.transparency===a.TransparencyMode.Opaque?Q.RenderSlot.OPAQUE_TERRAIN:Q.RenderSlot.TRANSPARENT_TERRAIN))return null;switch(ka.output){case M.ShaderOutput.Color:if(this.transparency===a.TransparencyMode.Empty)break;this._techniqueConfiguration.hasScreenSpaceReflections=
ka.bindParameters.ssr.enabled;this._techniqueConfiguration.hasCloudsReflections=r.isSome(ka.bindParameters.cloudsFade.data);this._techniqueConfiguration.receiveShadows=ka.bindParameters.shadowMap.ready;this._techniqueConfiguration.receiveAmbientOcclusion=ka.bindParameters.ssaoHelper.active;this._techniqueConfiguration.overlayMode=this._overlayRenderer.isEmpty?N.OverlayMode.Disabled:this._overlayRenderer.hasWater?N.OverlayMode.EnabledWithWater:N.OverlayMode.Enabled;return this._updateTechnique(M.ShaderOutput.Color,
ka.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN);case M.ShaderOutput.Shadow:case M.ShaderOutput.ShadowExcludeHighlight:if(this._castShadows&&1===ka.bindParameters.lighting.globalFactor)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(M.ShaderOutput.Shadow,!1);break;case M.ShaderOutput.Depth:if(this.transparency===a.TransparencyMode.Empty)break;this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=
!1;return this._updateTechnique(M.ShaderOutput.Depth,!1);case M.ShaderOutput.Normal:if(this.transparency===a.TransparencyMode.Empty)break;this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1;return this._updateTechnique(M.ShaderOutput.Normal,!1);case M.ShaderOutput.ObjectAndLayerIdColor:return this.transparency===a.TransparencyMode.Empty?null:this._updateTechnique(M.ShaderOutput.ObjectAndLayerIdColor,!1);case M.ShaderOutput.Highlight:if(this.transparency!==
a.TransparencyMode.Empty&&this.needsHighlight)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(M.ShaderOutput.Highlight,!1)}return null};fa.render=function(ka,la){const na=1===ka.bindParameters.lighting.globalFactor;this._updatePatchGroups();la.useStencil=!1;switch(ka.output){case M.ShaderOutput.Color:const pa=ka.bindParameters.slot===Q.RenderSlot.OCCLUDED_TERRAIN?A.OverlaySource.Occluded:A.OverlaySource.ColorAndWater;
this.transparency===a.TransparencyMode.Opaque?this._renderMaterialPass(ka,la,pa):ka.offscreenRenderingHelper.renderToTargets(()=>this._renderMaterialPass(ka,la,pa),ka.offscreenRenderingHelper.tmpColor,ka.offscreenRenderingHelper.mainDepth,[0,0,0,0]);break;case M.ShaderOutput.Depth:case M.ShaderOutput.Normal:this._renderAuxiliaryPass(ka,la,A.OverlaySource.None);break;case M.ShaderOutput.Highlight:this.needsHighlight&&this._renderAuxiliaryPass(ka,la,A.OverlaySource.Highlight);break;case M.ShaderOutput.Shadow:case M.ShaderOutput.ShadowExcludeHighlight:this._castShadows&&
na&&this._renderAuxiliaryPass(ka,la,A.OverlaySource.None);break;case M.ShaderOutput.ObjectAndLayerIdColor:this._renderAuxiliaryPass(ka,la,A.OverlaySource.ObjectAndLayerIdColor)}};fa._renderMaterialPass=function(ka,la,na){const {rctx:pa}=ka;this._passParameters.overlaySource=na;pa.bindTechnique(la,this._passParameters,ka.bindParameters);this._numOriginsRendered=this._numTilesCulled=this._numTilesRendered=0;this._renderPatchGroups(ka,la,na)};fa._renderAuxiliaryPass=function(ka,la,na){const pa=ka.rctx;
this._passParameters.overlaySource=na;pa.bindTechnique(la,this._passParameters,ka.bindParameters);this._renderPatchGroupsAuxiliary(ka,la,na)};fa.updateTileBackground=function(ka=null){if(!r.isNone(this._tileRenderer)){var la=this._tileRenderer,na=null;r.isSome(ka)&&(ka=t.toUnitRGBA(ka),na=v.fromValues(ka[0]||0,ka[1]||0,ka[2]||0));la.setBackground(na);this._allTiles.forAll(pa=>la.updateTileTexture(pa,C.TextureUpdate.FADING));this._techniqueConfiguration.tileBlendInput=la.backgroundIsGrid?I.TileBlendInput.GridComposite:
r.isSome(la.backgroundColor)?I.TileBlendInput.ColorComposite:I.TileBlendInput.LayerOnly;this.setNeedsRender()}};fa._updatePatchGroups=function(){this._patchGroupsDirty&&(this._highestVisibleLODTile=null,this._rebuildPatchGroups(),this._patchGroupsDirty=!1,this._patchSortingDirty=!0);if(this._patchSortingDirty&&this.renderOrder!==w.RenderOrder.NONE){const ka=Array.from(this._patchGroups.values()),la=this._stencilEnabledLayerExtents;for(const na of ka)K.sortTiles(this.renderOrder,na,la);ka.sort((na,
pa)=>K.compareTiles(na[0],pa[0],this.renderOrder));this._patchGroups=new Map(ka.map(na=>[na[0].renderData.localOrigin,na]));this._patchSortingDirty=!1}};fa._rebuildPatchGroups=function(){const ka=this._rootTiles;if(!r.isNone(ka)){ka[0]?.surface.checkAllTilesWaterproofness();this._patchGroups.clear();for(const la of ka)this._rebuildPatchGroupsForRootTile(la)}};fa._rebuildPatchGroupsForRootTile=function(ka){const la=this._tileIterator;for(la.resetOne(ka);!la.done;){ka=la.next();var na=ka.renderData;
if(!na){this._numTilesCulled++;continue}if(!ka.visible){this._numTilesCulled++;la.skipSubtree();continue}na=na.localOrigin;let pa=this._patchGroups.get(na);pa||(pa=[],this._patchGroups.set(na,pa));pa.push(ka);if(!this._highestVisibleLODTile||ka.vlevel>this._highestVisibleLODTile.vlevel)this._highestVisibleLODTile=ka;la.skipSubtree()}};fa._useStencilForTile=function(ka){for(const la of this._stencilEnabledLayerExtents)if(ka.intersectsExtent(la))return!0;return!1};fa._renderPatchGroupsAuxiliary=function(ka,
la,na){const pa=0<this._stencilEnabledLayerExtents.length;this._patchGroups.forEach(va=>{la.program.bindDraw(new W.DrawParameters(va[0].renderData.localOrigin),ka.bindParameters,this._passParameters);for(let wa=0;wa<va.length;wa++)this._renderPatch(ka,la,va[wa],ba.PrimitiveType.TRIANGLES,pa,na)});ka.rctx.bindVAO(null)};fa._renderPatchGroups=function(ka,la,na){var pa=ka.bindParameters.camera;const va=la.program;this._techniqueConfiguration.screenSizePerspective&&this.pointsOfInterest&&V.getSettings(this._stage.viewingMode,
this._ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:pa.fovY});pa=0<this._stencilEnabledLayerExtents.length;const wa=na===A.OverlaySource.Occluded;wa&&(va.bindTexture("tex",this._emptyTex),va.setUniform3fv("textureOpacities",v.ZEROS),va.setUniform4fv("texOffsetAndScale",q.ZEROS));var za=r.isSome(this._tileRenderer)&&r.isSome(this._tileRenderer.backgroundColor)?this._tileRenderer.backgroundColor:v.ZEROS;this._techniqueConfiguration.tileBlendInput===I.TileBlendInput.ColorComposite&&
va.setUniform3fv("backgroundColor",za);za=this.wireframe?ba.PrimitiveType.LINES:ba.PrimitiveType.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&va.bindTexture("texNext",this._emptyTex);var sa=this._patchGroups;for(const ua of sa.values()){la.program.bindDraw(new W.DrawParameters(ua[0].renderData.localOrigin),ka.bindParameters,this._passParameters);this._numOriginsRendered++;for(const oa of ua){sa=oa.renderData;const xa=sa.textureReference;if(!r.isNone(xa)){if(!wa){va.setUniform4fv("texOffsetAndScale",
xa.offsetAndScale);va.bindTexture("tex",xa.texture.texture);const Ea=sa.textureFadeFactor,Ia=1>Ea?sa.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&r.isSome(Ia)&&1>Ea?(va.setUniform1f("fadeFactor",Ea),va.setUniform4fv("nextTexOffsetAndScale",Ia.offsetAndScale),va.setUniform3fv("nextTexOpacities",Ia.opacities),va.bindTexture("texNext",Ia.texture.texture)):va.setUniform1f("fadeFactor",1);sa.textureIsFading&&this.setNeedsRender();va.setUniform3fv("textureOpacities",xa.opacities)}this._renderPatch(ka,
la,oa,za,pa,na);oa.renderOrder=this._numTilesRendered;this._numTilesRendered++}}}ka.rctx.bindVAO(null)};fa._renderPatch=function(ka,la,na,pa,va,wa){const za=na.renderData,sa=za.vao,ua=sa.indexBuffer;if(r.isNone(ua))D.ENABLE_TERRAIN_INTERNAL_CHECKS&&console.error("Rendered tile with no indices: ",na.lij," : ",za);else{var oa=la.program;wa===A.OverlaySource.None||this._overlayRenderer.isEmpty||this._bindOverlayPatchData(oa,za.overlay);va&&(la.useStencil=this._useStencilForTile(na),la.bindPipelineState(ka.rctx,
ka.bindParameters.slot));la=za.geometryInfo.indexCount;ka.rctx.bindVAO(sa);oa.assertCompatibleVertexAttributeLocations(sa);ka.rctx.drawElements(pa,la,ua.indexType,0)}};fa._bindOverlayPatchData=function(ka,la){ka.setUniform4fv("overlayTexOffset",la.offsets);ka.setUniform4fv("overlayTexScale",la.scales)};fa._updateTechnique=function(ka,la){this._techniqueConfiguration.output=ka;ka===M.ShaderOutput.Color&&(this._techniqueConfiguration.atmosphere=this._isGlobal&&this._velvetOverground);this._techniqueConfiguration.renderOccluded=
la;this._techniqueConfiguration.stencilEnabled=!1;return this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(U.TerrainTechnique,this._techniqueConfiguration,this._shaderTechnique)};c._createClass(ha,[{key:"_isGlobal",get:function(){return this._stage.viewingMode===z.ViewingMode.Global}},{key:"shading",get:function(){return this._techniqueConfiguration.shading},set:function(ka){this._techniqueConfiguration.shading=ka}},{key:"canRender",get:function(){return this._visible&&!!this._rootTiles&&
!this.renderingDisabled}},{key:"renderingDisabled",set:function(ka){this._set("renderingDisabled",!!ka);this.setDirty()}},{key:"transparency",get:function(){return this._transparencyState},set:function(ka){this._transparencyState!==ka&&(this._techniqueConfiguration.invisible=ka===a.TransparencyMode.TransparentWithDraped||ka===a.TransparencyMode.Empty,this._transparencyState=ka,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this._overlayRenderer.hasWater}},{key:"renderPatchBorders",
get:function(){return!!this._techniqueConfiguration.tileBorders},set:function(ka){this._techniqueConfiguration.tileBorders!==ka&&(this._techniqueConfiguration.tileBorders=ka,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"visualizeNormals",get:function(){return!!this._techniqueConfiguration.visualizeNormals},set:function(ka){this._techniqueConfiguration.visualizeNormals!==ka&&(this._techniqueConfiguration.visualizeNormals=ka,this.setNeedsRender(),this.notifyChange("visualizeNormals"))}},
{key:"cullBackFaces",get:function(){return this._techniqueConfiguration.backfaceCullingEnabled},set:function(ka){this._techniqueConfiguration.backfaceCullingEnabled!==ka&&(this._techniqueConfiguration.backfaceCullingEnabled=ka,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(ka){this._set("renderOrder",ka);this._setSortingDirty()}},{key:"velvetOverground",set:function(ka){this._velvetOverground!==ka&&(this._velvetOverground=ka,this.setNeedsRender())}},{key:"layerUid",
get:function(){return X.TERRAIN_ID}},{key:"slicePlaneEnabled",get:function(){return this._techniqueConfiguration.hasSlicePlane},set:function(ka){this._techniqueConfiguration.hasSlicePlane!==ka&&(this._techniqueConfiguration.hasSlicePlane=ka,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(ka){this._techniqueConfiguration.textureFadingEnabled!==ka&&(this._techniqueConfiguration.textureFadingEnabled=ka,this.setNeedsRender())}},{key:"pbrMode",set:function(ka){this._techniqueConfiguration.pbrMode!==
ka&&(this._techniqueConfiguration.pbrMode=ka,this.setNeedsRender())}},{key:"wireframe",set:function(ka){this._get("wireframe")!==ka&&(this._set("wireframe",ka),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this._tileRenderer}}}]);return ha}(n);b.__decorate([d.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_overlayRenderer",void 0);b.__decorate([d.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_stage",void 0);b.__decorate([d.property({readOnly:!0})],
a.TerrainRenderer.prototype,"_isGlobal",null);b.__decorate([d.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_allTiles",void 0);b.__decorate([d.property({constructOnly:!0})],a.TerrainRenderer.prototype,"_ellipsoidRadius",void 0);b.__decorate([d.property({value:!1})],a.TerrainRenderer.prototype,"renderingDisabled",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"renderPatchBorders",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"visualizeNormals",null);b.__decorate([d.property()],
a.TerrainRenderer.prototype,"cullBackFaces",null);b.__decorate([d.property({value:w.RenderOrder.FRONT_TO_BACK})],a.TerrainRenderer.prototype,"renderOrder",null);b.__decorate([d.property()],a.TerrainRenderer.prototype,"wireframe",null);a.TerrainRenderer=b.__decorate([g.subclass("esri.views.3d.terrain.TerrainRenderer")],a.TerrainRenderer);const ea=v.create(),ca=v.create(),ja=v.create(),ia=v.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../layers/support/layerUtils ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./LayerClass ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileTexture ./TileUpdate ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/lib/glUtil3D ../../webgl/context-util ../../webgl/enums ../../webgl/Texture".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){function y(H,L){I.layerIndex=L;const O=H.layerInfo[g.LayerClass.MAP][L];if(t.isSome(O.data))return n.set(I.offset,0,0),I.tile=H,I.scale=1,I.sourceLod=H.lij,I.sourceLayerInfo=O,I;H=O.upsampleInfo;return t.isSome(H)?(L=H.tile.layerInfo[g.LayerClass.MAP][L],I.tile=H.tile,n.copy(I.offset,H.offset),I.scale=H.scale,I.sourceLod=H.tile.lij,I.sourceLayerInfo=L,I):null}function w(H){let L="normal"!==H.blendMode;m.isGroupLayer(H.parent)&&(L=w(H.parent)||
L);return L}function D(H,L){m.isGroupLayer(H.parent)&&D(H.parent,L);const O=H.get("uid");if(t.isSome(O)&&""!==O){const S=N.get(O);S?S.start=L:N.set(O,new F(L,L,H.blendMode,H.opacity))}}let F=function(H,L,O,S){this.start=H;this.end=L;this.blendMode=O;this.opacity=S},E=function(){function H(O,S,R){this._rctx=O;this.tileSize=S;this._techniqueRepository=R;this._passParameters=new f.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._blackTex=null;
this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._composition=new q.TileCompositor(this._rctx,this._techniqueRepository);this._blackTex=new k(B.createColorTexture(this._rctx,[0,0,0,1]));this._ensureBackgroundTexture(this.tileSize)}var L=H.prototype;L.dispose=function(){this._composition=t.disposeMaybe(this._composition);this._backgroundTexture=t.releaseMaybe(this._backgroundTexture);this._blackTex=t.releaseMaybe(this._blackTex)};L.updateTileTexture=function(O,S){if(O.renderData){var R=
O.surface,Q=R.baseOpacity,V=0,aa=0,X=this.tileSize,W=!1,T=R.view.state.contentPixelRatio,U=!1;N.clear();P.length=0;for(var Y=O.layerInfo[g.LayerClass.MAP],ba=Y.length,da=0;da<Y.length;da++){const ja=R.layerViewByIndex(da,g.LayerClass.MAP);var ea=ja.layer.opacity;K[da]=ea;const ia=ja.fullOpacity;J[da]=ia;m.isBaseLayer(ja.layer)&&ba>=Y.length&&(ba=da);if(h.isBlendableLayerView(ja)){M[da]=ja.layer.blendMode;var ca="normal"!==ja.layer.blendMode;if(m.isGroupLayer(ja.layer.parent)){const Z=ja.layer.parent.get("uid");
t.isSome(Z)&&""!==Z&&(ca=w(ja.layer.parent)||ca)}ca&&(U=ca,W=!1)}if(0!==ea||U){if(++aa,ea=y(O,da))Y[da].pendingUpdates&=~(p.TileUpdate.TEXTURE_NOFADING&p.TileUpdate.TEXTURE_FADING),m.isGroupLayer(ja.layer.parent)&&(ca=ja.layer.parent.get("uid"),t.isSome(ca)&&""!==ca&&D(ja.layer.parent,da)),h.isVectorTileLayerView(ja)?X=Math.max(X,this.tileSize*T):1===Q&&1===ia&&(ja.isOpaque||this._dataToTexture(ea)&&ea.sourceLayerInfo.data.descriptor.isOpaque)&&(W=!0),++V}else Y[da].pendingUpdates&=~(p.TileUpdate.TEXTURE_NOFADING&
p.TileUpdate.TEXTURE_FADING)}this._rctx.type===A.ContextType.WEBGL1&&(T=X,X=b.nextHighestPowerOfTwo(T),R=X*X,Q=T*T,R===Q?X=T:(T=X/2,X=R-Q<Q-T*T?X:T));R=X/this.tileSize;--da;this._ensureBackgroundTexture(this.tileSize);0===V?this._useBackgroundTexture(O,aa):(1!==V||U||!this._useLayerTexture(O,da,ba,J[da]))&&this._composeMapLayers(O,S,da,ba,K,M,X,R,!W||U,N,U)}};L._ensureBackgroundTexture=function(O){t.isNone(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(O),this._backgroundDirty=
!0);this._backgroundDirty&&(this._composition.bind(O),this._passParameters.offset=r.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,t.isSome(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,t.isSome(this.backgroundColor)),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.unbind(),this._backgroundDirty=!1)};L._useBackgroundTexture=function(O,S){let R=l.ActivationTime.Immediate;
if(O.surface.view.layerViewManager.updating||0<S)R=l.ActivationTime.Delayed;S=O.renderData;this._backgroundTexture&&t.isNone(S.textureReference)&&(R=l.ActivationTime.Immediate);S.setTextureReference(t.isSome(this._backgroundTexture)?new v.TextureReference(this._backgroundTexture,e.TextureUpdate.FADING,G,O.surface.baseOpacity,0,1):null,R)};L._useLayerTexture=function(O,S,R,Q){var V=S<R;R=V?1:O.surface.baseOpacity;V=V?O.surface.baseOpacity:1;S=y(O,S);return this._dataToTexture(S)?(O.renderData.setTextureReference(new v.TextureReference(S.sourceLayerInfo.data,
e.TextureUpdate.FADING,S,R,V,Q)),!0):!1};L._composeMapLayers=function(O,S,R,Q,V,aa,X,W,T,U,Y){this._composition.ensureBuffer(X);const ba=O.surface.baseOpacity;let da=!1,ea=x.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,ca=!1,ja=0;for(let ha=R;0<=ha;ha--){var ia=y(O,ha);if(!ia)continue;if(0===V[ha]&&!Y)continue;var Z=ha<Q&&1>ba&&!da;this._passParameters.baseOpacity=Z?ba:1;R=1>this._passParameters.baseOpacity?C.BaseOpacityMode.Required:C.BaseOpacityMode.NotRequired;Z&&(da=!0);let fa=!1;U.forEach(na=>{na.start===
ha&&(P.push(na),this._composition.openGroup(X),fa=!0)});Z=0===ja;const ka=fa?C.BlendLayersOutput.GroupBackgroundComposite:T&&Z?this.backgroundIsGrid?C.BlendLayersOutput.GridComposite:C.BlendLayersOutput.ColorComposite:C.BlendLayersOutput.Composite,la=z.blendModeFromString[aa[ha]];h.isVectorTileRenderInfo(ia)?(this._passParameters.opacity=V[ha],ca=this._composition.drawVectorData(this._passParameters,ka,X,la,R,ia,W,this.tileSize,ca)):h.isImageryTileRenderInfo(ia)?(this._passParameters.opacity=V[ha],
this._composition.drawImageryTileData(this._passParameters,ka,X,la,R,ia),this._hasNearestInterpolation(ia)&&(ea=x.TextureSamplingMode.NEAREST)):this._dataToTexture(ia)&&(this._passParameters.texture=ia.sourceLayerInfo.data.texture,this._passParameters.offset=ia.offset,this._passParameters.scale=ia.scale,this._passParameters.opacity=V[ha],this._composition.drawRasterData(this._passParameters,ka,X,la,R));for(;0<P.length&&P[P.length-1].end===ha;)ia=P.pop(),this._passParameters.opacity=ia.opacity,this._passParameters.offset=
r.ZEROS,this._passParameters.scale=1,this._composition.drawGroup(this._passParameters,T&&Z?this.backgroundIsGrid?C.BlendLayersOutput.GridComposite:C.BlendLayersOutput.ColorComposite:C.BlendLayersOutput.Composite,X,z.blendModeFromString[ia.blendMode],R);ja++}O=O.renderData;Q=O.ensureTexture(X,()=>this._buildTexture(X,ea));this._composition.copyFBOToTexture(Q);this._composition.unbind();O.setTextureReference(new v.TextureReference(Q,S,G,da?1:ba,0,1))};L._hasNearestInterpolation=function(O){O=O.sourceLayerInfo.data;
return O.source?"nearest"===O.interpolation:!1};L._dataToTexture=function(O){if(h.isRasterTileRenderInfo(O)){const S=O.sourceLayerInfo;S.data=this._buildTexture(S.data);O.tile.setMemoryDirty()}return h.isTextureTileRenderInfo(O)};L.setBackground=function(O){this._backgroundColor!==O&&(this._backgroundColor=O,this._backgroundDirty=!0)};L._buildTexture=function(O,S=x.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(t.isNone(O))return null;const R={target:x.TextureType.TEXTURE_2D,pixelFormat:x.PixelFormat.RGBA,
dataType:x.PixelType.UNSIGNED_BYTE,wrapMode:x.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:S,maxAnisotropy:this._maxAnisotropy,preMultiplyAlpha:!0,flipped:!0,hasMipmap:!0};S=this._rctx;let Q;if("number"===typeof O)R.width=R.height=O,Q=new k(new u.Texture(S,R));else if(O instanceof d.ImageWithType)R.isOpaque=O.isOpaque,Q=new k(new u.Texture(S,R,O.image)),O.release();else try{R.width=O.width,R.height=O.height,Q=new k(new u.Texture(S,R,O))}catch(V){Q=new k(B.createEmptyTexture(S)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}O=
S.bindTexture(Q.texture,u.Texture.TEXTURE_UNIT_FOR_UPDATES);Q.generateMipmap();S.bindTexture(O,u.Texture.TEXTURE_UNIT_FOR_UPDATES);return Q};c._createClass(H,[{key:"backgroundIsGrid",get:function(){return t.isNone(this._backgroundColor)}},{key:"backgroundColor",get:function(){return this._backgroundColor}},{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);return H}();const K=[],J=[],M=[],N=new Map,P=[],I={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,
layerIndex:0},G={offset:[0,0],scale:1};a.GroupInfo=F;a.TileRenderer=E;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/vec3f64 ./TileBlendTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/context-util ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){m=function(p){function z(){var C=p.apply(this,arguments)||this;C.opacity=1;C.baseOpacity=1;C.texture=null;C.fboTexture=null;C.backgroundColor=n.ZEROS;return C}b._inheritsLoose(z,p);return z}(m.TileCompositePassParameters);e=function(p){function z(){return p.apply(this,arguments)||this}b._inheritsLoose(z,p);var C=z.prototype;C.initializeConfiguration=function(B,A){A.hasWebGL2Context=B.rctx.type===v.ContextType.WEBGL2};C.initializeProgram=function(B){return new l.Program(B.rctx,
z.shader.get().build(this.configuration),h.Default3D)};C.initializePipeline=function(){return k.makePipelineState({blending:k.simpleBlendingParams(q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:k.defaultColorWriteParams})};return z}(e.ShaderTechnique);e.shader=new f.ReloadableShaderModule(d.BlendLayers,()=>new Promise((p,z)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],p,z)));r=function(p){function z(){var C=p.apply(this,arguments)||this;C.background=d.BackgroundMode.BelowLayer;
return C}b._inheritsLoose(z,p);return z}(r.TileBlendTechniqueConfiguration);t.__decorate([g.parameter()],r.prototype,"background",void 0);c.BlendLayersPassParameters=m;c.BlendLayersTechnique=e;c.BlendLayersTechniqueConfiguration=r;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileBlendTechniqueConfiguration":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ./BlendModeTechniqueConfiguration ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r){t=function(m){function d(){var f=m.apply(this,arguments)||this;f.output=n.BlendLayersOutput.Composite;f.baseOpacityMode=n.BaseOpacityMode.NotRequired;f.premultipliedSource=n.PremultipliedAlphaSource.Off;f.hasWebGL2Context=!1;return f}c._inheritsLoose(d,m);return d}(t.BlendModeTechniqueConfiguration);b.__decorate([r.parameter({count:n.BlendLayersOutput.COUNT})],t.prototype,"output",void 0);b.__decorate([r.parameter({count:n.BaseOpacityMode.COUNT})],t.prototype,"baseOpacityMode",
void 0);b.__decorate([r.parameter()],t.prototype,"premultipliedSource",void 0);b.__decorate([r.parameter()],t.prototype,"hasWebGL2Context",void 0);a.TileBlendTechniqueConfiguration=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,c,b,t,n){let r=function(m){function d(){var f=m.apply(this,arguments)||this;f.blendMode=t.LayerBlendMode.Normal;return f}c._inheritsLoose(d,m);return d}(n.ShaderTechniqueConfiguration);b.__decorate([n.parameter({count:t.LayerBlendMode.COUNT})],r.prototype,"blendMode",void 0);a.BlendModeTechniqueConfiguration=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendLayers.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f){function e(h){const l=new d.ShaderBuilder;l.include(t.TileComposite);if(h.background===a.BackgroundMode.Only)return(h=h.output===b.BlendLayersOutput.ColorComposite)?l.fragment.uniforms.add(new n.Float3PassUniform("backgroundColor",v=>v.backgroundColor)):(l.extensions.add("GL_OES_standard_derivatives"),l.fragment.include(c.BackgroundGrid)),l.fragment.code.add(m.glsl`
    void main() {
      gl_FragColor = vec4(${h?m.glsl`backgroundColor`:m.glsl`gridColor(uv)`}, 1.0);
    }
  `),l;l.include(b.TileBackground,h);l.fragment.uniforms.add(new f.Texture2DPassUniform("tex",v=>v.texture));l.fragment.uniforms.add(new r.FloatPassUniform("opacity",v=>v.opacity));l.fragment.code.add(m.glsl`void main() {
vec4 bgColor = getBackground(uv);
gl_FragColor = blendLayers(bgColor, texture2D(tex, uv), opacity);
}`);return l}a.BackgroundMode=void 0;(function(h){h[h.BelowLayer=0]="BelowLayer";h[h.Only=1]="Only";h[h.COUNT=2]="COUNT"})(a.BackgroundMode||(a.BackgroundMode={}));const g=Object.freeze(Object.defineProperty({__proto__:null,get BackgroundMode(){return a.BackgroundMode},build:e},Symbol.toStringTag,{value:"Module"}));a.BlendLayers=g;a.build=e})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec4f64"],function(a,c,b){let t=function(){function n(r,
m,d,f,e,g){this.texture=r;this.type=m;r.retain();this.offsetAndScale=b.fromValues(d.offset[0],d.offset[1],d.scale,d.scale);this.opacities=c.fromValues(f,e,g)}n.prototype.destroy=function(){this.texture.release()};return n}();a.TextureReference=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./LayerClass ./RasterColorizerTechnique ./support/MultiSizeFramebuffer ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBackground.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){const B=c.getLogger("esri.views.3d.terrain");c=function(){function A(u,y){this._rctx=u;this._techniqueRepository=y;this._fbos=[];this._vectorTileHelper=new r.VectorTileRendererHelper3D;this._bindParameters=new v.BindParameters(null,null,null);this._blendLayersTechniqueConfig=new m.BlendLayersTechniqueConfiguration;this._current=0;this._lastUsedIds=[];this._lastCreatedBufferId=0;this._onHoldIds=[];this._vaoQuad=k.createQuadVAO(this._rctx,q.Pos2Tex)}var x=
A.prototype;x.dispose=function(){this._fbos.forEach(b.disposeMaybe);this._fbos=null;this._vtFBO=b.disposeMaybe(this._vtFBO);this._vaoQuad=b.disposeMaybe(this._vaoQuad);this._vectorTileHelper=b.disposeMaybe(this._vectorTileHelper);this._backgroundTechnique=b.releaseMaybe(this._backgroundTechnique);this._applyOpacityTechnique=b.releaseMaybe(this._applyOpacityTechnique);this._blendLayersTechnique=b.releaseMaybe(this._blendLayersTechnique)};x._getBlendLayersTechnique=function(u,y,w,D=h.PremultipliedAlphaSource.Off,
F=l.BackgroundMode.BelowLayer){this._blendLayersTechniqueConfig.output=y;this._blendLayersTechniqueConfig.blendMode=u;this._blendLayersTechniqueConfig.baseOpacityMode=w;this._blendLayersTechniqueConfig.premultipliedSource=D;this._blendLayersTechniqueConfig.background=F;return this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(m.BlendLayersTechnique,this._blendLayersTechniqueConfig,this._blendLayersTechnique)};x.drawBackground=function(u,y){y=this._getBlendLayersTechnique(g.LayerBlendMode.Normal,
y?h.BlendLayersOutput.ColorComposite:h.BlendLayersOutput.GridComposite,h.BaseOpacityMode.NotRequired,h.PremultipliedAlphaSource.Off,l.BackgroundMode.Only);u=this._rctx.bindTechnique(y,u,this._bindParameters);this._render(u)};x._render=function(u){this._rctx.bindVAO(this._vaoQuad);u.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(p.PrimitiveType.TRIANGLE_STRIP,0,C.vertexCount(this._vaoQuad,"geometry"))};x.drawGroup=function(u,y,w,D,F,E=h.PremultipliedAlphaSource.On){y===
h.BlendLayersOutput.Composite&&(u.fboTexture=this._fbos[this.getLastOnHoldId()].get(w).colorTexture);u.texture=this.currentFBO(w).colorTexture;this.closeGroup(w);y=this._getBlendLayersTechnique(D,y,F,E);u=this._rctx.bindTechnique(y,u,this._bindParameters);this._render(u)};x.drawRasterData=function(u,y,w,D,F,E=h.PremultipliedAlphaSource.Off){b.isNone(u.texture)||(u.fboTexture=y===h.BlendLayersOutput.GroupBackgroundComposite||D===g.LayerBlendMode.Normal&&F===h.BaseOpacityMode.NotRequired&&E===h.PremultipliedAlphaSource.Off?
null:this.switch(w).colorTexture,y=this._getBlendLayersTechnique(D,y,F,E),u=this._rctx.bindTechnique(y,u,this._bindParameters),this._render(u))};x.drawImageryTileData=function(u,y,w,D,F,E){var K=E.sourceLayerInfo.data;K.source&&(E.tile.surface.layerViewByIndex(E.layerIndex,d.LayerClass.MAP).ensureSymbolizerParameters(K),K.bind(this._rctx)&&(u.fboTexture=D===g.LayerBlendMode.Normal&&F===h.BaseOpacityMode.NotRequired?null:this.switch(w).colorTexture,y=this._getRasterColorizerTechnique(K,y,D,F),K.opacity=
u.opacity,K=K.getUniforms(),K.scale=E.scale,K.offset=E.offset,K.backgroundColor=u.backgroundColor,K.fboTexture=u.fboTexture,K.baseOpacity=u.baseOpacity,u=this._rctx.bindTechnique(y,K,null),this._render(u)))};x._getRasterColorizerTechnique=function(u,y,w,D){const F=u.symbolizerParameters,E=["stretch","lut","hillshade"].indexOf(F.type);b.isNone(this._rasterColorizerConfig)&&(this._rasterColorizerConfig=new f.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),
this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.output=y;this._rasterColorizerConfig.blendMode=w;this._rasterColorizerConfig.baseOpacityMode=D;this._rasterColorizerConfig.colorizerType=E;this._rasterColorizerConfig.applyColormap=!!F.colormap;this._rasterColorizerConfig.stretchType=u.hasStretchTypeNone()?n.RasterColorizerStretchType.Noop:n.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(f.RasterColorizerTechnique,
this._rasterColorizerConfig,this._rasterColorizerTechnique)};x.drawVectorData=function(u,y,w,D,F,E,K,J,M){const N=this._rctx,P=E.sourceLayerInfo.data,I=E.tile.surface.layerViewByIndex(E.layerIndex,d.LayerClass.MAP),G=F===h.BaseOpacityMode.Required||1>u.opacity||D!==g.LayerBlendMode.Normal||y!==h.BlendLayersOutput.Composite,H=G?h.PremultipliedAlphaSource.On:h.PremultipliedAlphaSource.Off;this._getBlendLayersTechnique(D,y,F,H).bindPipelineState(N);let L=null,O=null;G?(O=this.currentFBO(w),b.isNone(this._vtFBO)&&
(this._vtFBO=new e.MultiSizeFramebuffer(this._rctx)),L=this._vtFBO.get(w),N.bindFramebuffer(L),this._clearCurrentFBO()):M&&N.clearSafe(p.ClearBufferBit.DEPTH_BUFFER_BIT);try{this._vectorTileHelper.render(N,E.sourceLod,P,I.painter,I.layer.styleRepository,I.schemaHelper,Math.round(1/E.scale),E.offset,J,K)}catch(S){B.warnOnce("A render call containing vector tiles did not resolve correctly.",S)}return b.isSome(L)?(N.bindFramebuffer(O),u.texture=L.colorTexture,u.offset=t.ZEROS,u.scale=1,this.drawRasterData(u,
y,w,D,F,H),M):!0};x.copyFBOToTexture=function(u){const y=this._rctx,w=y.bindTexture(u.texture,z.Texture.TEXTURE_UNIT_FOR_UPDATES),D=u.descriptor;y.gl.copyTexImage2D(p.TextureType.TEXTURE_2D,0,D.pixelFormat,0,0,D.width,D.height,0);u.generateMipmap();y.bindTexture(w,z.Texture.TEXTURE_UNIT_FOR_UPDATES)};x._clearCurrentFBO=function(){this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);this._rctx.clearSafe(p.ClearBufferBit.COLOR_BUFFER_BIT|p.ClearBufferBit.DEPTH_BUFFER_BIT)};x._initFBO=function(u,
y,w){this._rctx.bindFramebuffer(u);w&&(this._rctx.setViewport(0,0,y,y),this._clearCurrentFBO())};x.ensureBuffer=function(u){this._lastUsedIds.length=0;this._lastUsedIds.push(1);this._lastCreatedBufferId=1;this._onHoldIds.length=0;this.bind(u)};x.bind=function(u,y=0,w=!0){this._current=y;if(y>=this._fbos.length)for(let D=this._fbos.length;D<=y;D++)this._fbos.push(new e.MultiSizeFramebuffer(this._rctx));this._initFBO(this._fbos[y].get(u),u,w)};x._bindNextFreeBuffer=function(u){0<this._lastUsedIds.length?
this.bind(u,this._lastUsedIds.pop()):(this._lastCreatedBufferId++,this.bind(u,this._lastCreatedBufferId))};x.openGroup=function(u){this._onHoldIds.push(this._current);this._bindNextFreeBuffer(u)};x.switch=function(u){const y=this.currentFBO(u),w=this._current;this._bindNextFreeBuffer(u);this._lastUsedIds.push(w);return y};x.getLastOnHoldId=function(){return this._onHoldIds[this._onHoldIds.length-1]};x.closeGroup=function(u){const y=this._current;this._bindNextFreeBuffer(u);this._lastUsedIds.push(y);
this._lastUsedIds.push(this._onHoldIds.pop())};x.unbind=function(){this._rctx.bindFramebuffer(null)};x.currentFBO=function(u){return this._fbos[this._current].get(u)};return A}();a.TileCompositor=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define(["exports","../../../../geometry","../../../../Viewpoint","../../ViewState","../../../../geometry/Point"],function(a,c,b,t,n){c=function(){function r(){this._renderParams=
{context:null,drawPhase:1,state:new t({viewpoint:new b({targetGeometry:new n(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,allowDelayedRender:!1,deltaTime:-1,timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1,
highlightGradient:null}}var m=r.prototype;m.dispose=function(){this._renderParams=null};m.render=function(d,f,e,g,h,l,v,q,k,p){const z=l.adjustLevel(f[0]),C=this._renderParams;C.context=d;C.painter=g;C.glyphMosaic=g.glyphMosaic;C.spriteMosaic=g.spriteMosaic;C.pixelRatio=p;C.displayLevel=z;C.requiredLevel=z;p=l.getScale(f[0]);const [B,A]=l.getShift(f,v*p);f=.125*v*p/k;l=e.transforms.dvs;l[0]=f;l[4]=-f;l[6]=-1-B-q[0]*v*2;l[7]=1+A+(1-q[1])*v*2-2;C.state.size[0]=k;C.state.size[1]=k;e.stage||e.attachWithContext(d);
e.triangleCount=0;g.drawTile(C,e,h)};return r}();a.VectorTileRendererHelper3D=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x){var u;const y=[0,0];b=u=function(w){function D(E){E=w.call(this,E)||this;E._viewpoint2D={center:z.create(),rotation:0,scale:0,spatialReference:void 0};E.center=[0,0];E.extent=new A;E.id=0;E.inverseTransform=l.create();E.resolution=0;E.rotation=0;E.scale=0;E.transform=l.create();E.transformNoRotation=l.create();E.displayMat3=q.create();E.displayViewMat3=q.create();E.viewMat3=q.create();E.viewMat2d=h.create();E.worldScreenWidth=0;E.size=[0,0];return E}
a._inheritsLoose(D,w);var F=D.prototype;F.copy=function(E){const K=this.size,J=this.viewpoint;J&&K?(this.viewpoint=B.copy(J,E.viewpoint),this._set("size",k.copy(K,E.size))):(this.viewpoint=E.viewpoint.clone(),this._set("size",[E.size[0],E.size[1]]));this._set("pixelRatio",E.pixelRatio);return this};F.clone=function(){return new u({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};F.toMap=function(E,K,J){if(C.isVec2(K))return k.transformMat2d(E,K,this.inverseTransform);
y[0]=K;y[1]=J;return k.transformMat2d(E,y,this.inverseTransform)};F.toScreen=function(E,K,J){if(C.isVec2(K))return k.transformMat2d(E,K,this.transform);y[0]=K;y[1]=J;return k.transformMat2d(E,y,this.transform)};F.toScreenNoRotation=function(E,K,J){if(C.isVec2(K))return k.transformMat2d(E,K,this.transformNoRotation);y[0]=K;y[1]=J;return k.transformMat2d(E,y,this.transformNoRotation)};F.getScreenTransform=function(E,K){const {center:J}=this._viewpoint2D,M=this._get("pixelRatio")||1,N=this._get("size");
B.getMatrix(E,J,N,K,0,M);return E};F._update=function(){const {center:E,spatialReference:K,scale:J,rotation:M}=this._viewpoint2D,N=this._get("pixelRatio")||1,P=this._get("size"),I=new t({targetGeometry:new x(E[0],E[1],K),scale:J,rotation:M});this._set("viewpoint",I);if(P&&K&&J){this.resolution=B.getResolution(I);this.rotation=M;this.scale=J;this.spatialReference=K;k.copy(this.center,E);v.set(this.displayMat3,0!==P[0]?2/P[0]:0,0,0,0,0!==P[1]?-2/P[1]:0,0,-1,1,1);var G=v.identity(this.viewMat3),H=p.fromValues(P[0]/
2,P[1]/2),L=p.fromValues(-P[0]/2,-P[1]/2),O=e.toRadian(M);v.translate(G,G,H);v.rotate(G,G,O);v.translate(G,G,L);v.multiply(this.displayViewMat3,this.displayMat3,G);G=g.fromTranslation(this.viewMat2d,H);g.rotate(G,G,O);g.translate(G,G,L);B.getExtent(this.extent,I,P);B.getTransform(this.transform,I,P,N);g.invert(this.inverseTransform,this.transform);B.getTransformNoRotation(this.transformNoRotation,I,P,N);this.worldScreenWidth=B.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};a._createClass(D,[{key:"pixelRatio",set:function(E){this._set("pixelRatio",E);this._update()}},{key:"size",set:function(E){this._set("size",E);this._update()}},{key:"viewpoint",set:function(E){if(E){const K=this._viewpoint2D,J=E.targetGeometry;K.center[0]=J.x;K.center[1]=J.y;K.rotation=E.rotation;K.scale=E.scale;K.spatialReference=J.spatialReference}this._update()}}]);return D}(n.JSONSupport);c.__decorate([r.property({readOnly:!0})],b.prototype,"id",void 0);c.__decorate([r.property({value:1,
json:{write:!0}})],b.prototype,"pixelRatio",null);c.__decorate([r.property({json:{write:!0}})],b.prototype,"size",null);c.__decorate([r.property()],b.prototype,"spatialReference",void 0);c.__decorate([r.property({type:t,json:{write:!0}})],b.prototype,"viewpoint",null);return b=u=c.__decorate([f.subclass("esri.views.2d.ViewState")],b)})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function c(){return[1,0,0,1,0,0]}function b(m){return[m[0],m[1],m[2],m[3],m[4],m[5]]}function t(m,
d,f,e,g,h){return[m,d,f,e,g,h]}function n(m,d){return new Float64Array(m,d,6)}const r=Object.freeze(Object.defineProperty({__proto__:null,clone:b,create:c,createView:n,fromValues:t},Symbol.toStringTag,{value:"Module"}));a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.mat2df64=r})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function c(t){return t instanceof Float32Array&&2<=t.length}function b(t){return Array.isArray(t)&&2<=t.length}a.isVec2=function(t){return c(t)||
b(t)};a.isVec2f32=c;a.isVec2f64=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){function z(U,Y){return Y.type?e.set(U,Y.x,Y.y):e.copy(U,Y)}function C(U,Y){return Math.max(U.width/Math.max(1,Y[0]),U.height/Math.max(1,Y[1]))*E(U.spatialReference)}function B(U,Y,ba,da){return A.apply(this,arguments)}function A(){A=c._asyncToGenerator(function*(U,Y,ba,da){if(!U||Array.isArray(U)&&!U.length)return null;t.isCollection(U)&&(U=U.toArray());if(Array.isArray(U)&&U.length&&"object"===typeof U[0]){var ea=U.every(fa=>"attributes"in fa);var ca=U.some(fa=>
!fa.geometry),ja=U;if(ea&&ca&&Y&&Y.allLayerViews){ea=new Map;for(var ia of U)U=ia.layer,ca=ea.get(U)||[],ja=ia.attributes[U.objectIdField],null!=ja&&ca.push(ja),ea.set(U,ca);const fa=[];ea.forEach((ka,la)=>{const na=Y.allLayerViews.find(pa=>pa.layer.id===la.id);if(na&&"queryFeatures"in na){const pa=la.createQuery();pa.objectIds=ka;pa.returnGeometry=!0;fa.push(na.queryFeatures(pa))}});ia=yield Promise.all(fa);U=[];for(var Z of ia)if(Z&&Z.features&&Z.features.length)for(var ha of Z.features)n.isSome(ha.geometry)&&
U.push(ha.geometry);ja=U}for(const fa of ja)da=yield B(fa,Y,ba,da);return da}if(Array.isArray(U)&&2===U.length&&"number"===typeof U[0]&&"number"===typeof U[1])ea=new v(U);else if(U instanceof l)ea=U;else if("geometry"in U)if(U.geometry)ea=U.geometry;else if(U.layer){const fa=U.layer;(Z=Y.allLayerViews.find(ka=>ka.layer.id===fa.id))&&"queryFeatures"in Z&&(ha=fa.createQuery(),ha.objectIds=[U.attributes[fa.objectIdField]],ha.returnGeometry=!0,Z=yield Z.queryFeatures(ha),ea=n.get(Z,"features",0,"geometry"))}if(n.isNone(ea))return null;
Z="point"===ea.type?new h({xmin:ea.x,ymin:ea.y,xmax:ea.x,ymax:ea.y,spatialReference:ea.spatialReference}):ea.extent;if(!Z)return null;q.isLoaded()||q.canProjectWithoutEngine(Z.spatialReference,ba)||(yield q.load());ba=q.project(Z,ba);return ba?da=da?da.union(ba):ba:null});return A.apply(this,arguments)}function x(U){if(U&&(!Array.isArray(U)||"number"!==typeof U[0])&&("object"===typeof U||Array.isArray(U)&&"object"===typeof U[0])){if("layer"in U&&U.layer&&U.layer.minScale&&U.layer.maxScale){var Y=
U.layer;return{min:Y.minScale,max:Y.maxScale}}if(Array.isArray(U)&&U.length&&U.every(ba=>"layer"in ba)){let ba=Y=0;for(const da of U)(U=da.layer)&&U.minScale&&U.maxScale&&(Y=U.minScale<Y?U.minScale:Y,ba=U.maxScale>ba?U.maxScale:ba);return Y&&ba?{min:Y,max:ba}:null}}}function u(U,Y){return p.equals(U.wkid?U:U.spatialReference||k.WGS84,Y)?U:q.project(U,Y)}function y(){y=c._asyncToGenerator(function*(U,Y){if(!U||!Y)return new b({targetGeometry:new v,scale:0,rotation:0});let ba=Y.spatialReference;const {constraints:da,
padding:ea,viewpoint:ca,size:ja}=Y,ia=[ea?ja[0]-ea.left-ea.right:ja[0],ea?ja[1]-ea.top-ea.bottom:ja[1]];let Z=null;U instanceof b?Z=U:U.viewpoint?Z=U.viewpoint:U.target&&"esri.Viewpoint"===U.target.declaredClass&&(Z=U.target);let ha=null;if(Z&&Z.targetGeometry)ha=Z.targetGeometry;else if(U instanceof h)ha=U;else if(U||U&&("center"in U||"extent"in U||"target"in U))ha=(yield B(U.center,Y,ba))||(yield B(U.extent,Y,ba))||(yield B(U.target,Y,ba))||(yield B(U,Y,ba));!ha&&ca&&ca.targetGeometry?ha=ca.targetGeometry:
!ha&&Y.extent&&(ha=Y.extent);if(!ba){var fa=Y.spatialReference||Y.extent||ha;ba=fa.wkid?fa:fa.spatialReference||k.WGS84}q.isLoaded()||p.equals(ha.spatialReference,ba)||q.canProjectWithoutEngine(ha,ba)||(yield q.load());fa=u(ha.center?ha.center:ha,ba);var ka=0;Z&&n.isSome(Z.targetGeometry)&&"point"===Z.targetGeometry.type?ka=Z.scale:"scale"in U&&U.scale?ka=U.scale:"zoom"in U&&-1!==U.zoom&&da&&da.effectiveLODs?ka=da.zoomToScale(U.zoom):Array.isArray(ha)||"point"===ha.type||"extent"===ha.type&&0===ha.width&&
0===ha.height?(ka=u(Y.extent,ba),ka=n.isSome(ka)?C(ka,ia):Y.extent?C(Y.extent,ia):ca.scale):ka=C(u(ha.extent,ba),ia);if(Y=x(U))Y.min&&Y.min>ka?ka=Y.min:Y.max&&Y.max<ka&&(ka=Y.max);Y=0;Z?Y=Z.rotation:U.hasOwnProperty("rotation")?Y=U.rotation:ca&&(Y=ca.rotation);U=new b({targetGeometry:fa,scale:ka,rotation:Y});da&&(U=da.fit(U),da.constrainByGeometry(U),da.rotationEnabled||(U.rotation=Y));return U});return y.apply(this,arguments)}function w(U,Y){const ba=U.targetGeometry,da=Y.targetGeometry;ba.x=da.x;
ba.y=da.y;ba.spatialReference=da.spatialReference;U.scale=Y.scale;U.rotation=Y.rotation;return U}function D(U,Y,ba){return ba?e.set(U,.5*(Y[0]-ba.right+ba.left),.5*(Y[1]-ba.bottom+ba.top)):e.scale(U,Y,.5)}function F(U){var Y=U.scale;U=U.targetGeometry;U=n.isSome(U)&&p.isValid(U.spatialReference)?1/(39.37*r.getMetersPerUnitForSR(U.spatialReference)*96):1;return Y*U}function E(U){return p.isValid(U)?39.37*r.getMetersPerUnitForSR(U)*96:1}function K(U){return(U=p.getInfo(U))?U.valid[1]-U.valid[0]:0}const J=
180/Math.PI,M=function(){const U=g.create();return function(Y,ba,da){const ea=ba.targetGeometry;z(U,ea);ba=.5*F(ba);Y.xmin=U[0]-ba*da[0];Y.ymin=U[1]-ba*da[1];Y.xmax=U[0]+ba*da[0];Y.ymax=U[1]+ba*da[1];Y.spatialReference=ea.spatialReference;return Y}}(),N=function(){const U=g.create();return function(Y,ba,da){return e.sub(Y,e.scale(Y,ba,.5),D(U,ba,da))}}(),P=function(){const U=f.create(),Y=g.create();return function(ba,da,ea,ca){const ja=F(da);da=m.toRadian(da.rotation)||0;e.set(Y,ja,ja);d.fromScaling(U,
Y);d.rotate(U,U,da);d.translate(U,U,N(Y,ea,ca));d.translate(U,U,[0,ca.top-ca.bottom]);return e.set(ba,U[4],U[5])}}(),I=function(){const U=g.create(),Y=g.create(),ba=g.create();return function(da,ea,ca,ja,ia,Z){e.negate(U,ea);e.scale(Y,ca,.5*Z);e.set(ba,1/ja*Z,-1/ja*Z);d.fromTranslation(da,Y);ia&&d.rotate(da,da,ia);d.scale(da,da,ba);d.translate(da,da,U);return da}}(),G=function(){const U=g.create();return function(Y,ba,da,ea){const ca=F(ba),ja=m.toRadian(ba.rotation)||0;z(U,ba.targetGeometry);return I(Y,
U,da,ca,ja,ea)}}(),H=function(){const U=g.create();return function(Y,ba,da,ea){const ca=F(ba);z(U,ba.targetGeometry);return I(Y,U,da,ca,0,ea)}}(),L=function(){const U=g.create(),Y=g.create(),ba=[0,0,0];return function(da,ea,ca){e.subtract(U,da,ea);e.normalize(U,U);e.subtract(Y,da,ca);e.normalize(Y,Y);e.cross(ba,U,Y);da=Math.acos(e.dot(U,Y)/(e.length(U)*e.length(Y)))*J;0>ba[2]&&(da=-da);isNaN(da)&&(da=0);return da}}(),O=function(){const U=g.create();return function(Y,ba,da,ea){const ca=Y.targetGeometry;
w(Y,ba);P(U,ba,da,ea);ca.x+=U[0];ca.y+=U[1];return Y}}(),S=function(){return function(U,Y,ba){w(U,Y);Y=U.targetGeometry;Y.x=ba.x;Y.y=ba.y;Y.spatialReference=ba.spatialReference;return U}}(),R=function(){const U=g.create();return function(Y,ba,da,ea,ca){ca||(ca="center");e.sub(U,da,ea);e.scale(U,U,.5);da=U[0];ea=U[1];switch(ca){case "center":e.set(U,0,0);break;case "left":e.set(U,-da,0);break;case "top":e.set(U,0,ea);break;case "right":e.set(U,da,0);break;case "bottom":e.set(U,0,-ea);break;case "top-left":e.set(U,
-da,ea);break;case "bottom-left":e.set(U,-da,-ea);break;case "top-right":e.set(U,da,ea);break;case "bottom-right":e.set(U,da,-ea)}T(Y,ba,U);return Y}}(),Q=function(){const U=g.create();return function(Y,ba,da,ea,ca){w(Y,ba);isNaN(da)||0===da||(X(U,ea,ba,ca),Y.scale=ba.scale*da,W(U,U,Y,ca),T(Y,Y,e.set(U,U[0]-ea[0],ea[1]-U[1])));return Y}}(),V=function(){const U=g.create();return function(Y,ba,da,ea,ca,ja){w(Y,ba);isNaN(da)||0===da||(X(U,ca,ba,ja),Y.scale=ba.scale*da,Y.rotation+=ea,W(U,U,Y,ja),T(Y,
Y,e.set(U,U[0]-ca[0],ca[1]-U[1])));return Y}}(),aa=function(){const U=g.create(),Y=g.create();return function(ba,da,ea,ca,ja,ia,Z){N(Y,ia,Z);e.add(U,ja,Y);return ca?V(ba,da,ea,ca,U,ia):Q(ba,da,ea,U,ia)}}(),X=function(){const U=f.create();return function(Y,ba,da,ea){var ca=e.transformMat2d;G(U,da,ea,1);da=d.invert(U,U);return ca.call(e,Y,ba,da)}}(),W=function(){const U=f.create();return function(Y,ba,da,ea){return e.transformMat2d(Y,ba,G(U,da,ea,1))}}(),T=function(){const U=g.create(),Y=f.create();
return function(ba,da,ea){w(ba,da);const ca=F(da),ja=ba.targetGeometry;d.fromRotation(Y,m.toRadian(da.rotation)||0);d.scale(Y,Y,g.fromValues(ca,ca));e.transformMat2d(U,ea,Y);ja.x+=U[0];ja.y+=U[1];return ba}}();a.addPadding=O;a.angleBetween=L;a.centerAt=S;a.copy=w;a.create=function(U,Y){return y.apply(this,arguments)};a.extentToScale=C;a.getAnchor=D;a.getExtent=M;a.getMatrix=I;a.getPaddingMapTranslation=P;a.getPaddingScreenTranslation=N;a.getResolution=F;a.getResolutionToScaleFactor=E;a.getTransform=
G;a.getTransformNoRotation=H;a.getWorldScreenWidth=function(U,Y){return Math.round(K(U)/Y)};a.getWorldWidth=K;a.padAndScaleAndRotateBy=aa;a.resize=R;a.rotateBy=function(U,Y,ba){w(U,Y);U.rotation+=ba;return U};a.rotateTo=function(U,Y,ba){w(U,Y);U.rotation=ba;return U};a.scaleAndRotateBy=V;a.scaleTo=function(U,Y,ba){w(U,Y);U.scale=ba;return U};a.setExtent=function(U,Y,ba,da,ea){S(U,Y,ba.center);U.scale=C(ba,da);ea&&ea.constraints&&ea.constraints.constrain(U);return U};a.toMap=X;a.toScreen=W;a.translateBy=
T;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../2d/engine/imagery/enums ./TileBlendTechniqueConfiguration ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/context-util ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){f=function(k){function p(){return k.apply(this,arguments)||this}b._inheritsLoose(p,k);var z=p.prototype;z.initializeConfiguration=function(C,B){B.hasWebGL2Context=C.rctx.type===l.ContextType.WEBGL2};z.initializeProgram=function(C){return new h.Program(C.rctx,p.shader.get().build(this.configuration),g.Default3D)};z.initializePipeline=function(){return q.makePipelineState({blending:q.simpleBlendingParams(v.BlendFactor.ONE,v.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:q.defaultColorWriteParams})};
return p}(f.ShaderTechnique);f.shader=new d.ReloadableShaderModule(m.RasterColorizer,()=>new Promise((k,p)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],k,p)));r=function(k){function p(){var z=k.apply(this,arguments)||this;z.colorizerType=n.RasterColorizerType.Stretch;z.stretchType=n.RasterColorizerStretchType.Noop;z.applyColormap=!0;return z}b._inheritsLoose(p,k);return p}(r.TileBlendTechniqueConfiguration);t.__decorate([e.parameter({count:n.RasterColorizerType.COUNT})],r.prototype,
"colorizerType",void 0);t.__decorate([e.parameter({count:n.RasterColorizerStretchType.COUNT})],r.prototype,"stretchType",void 0);t.__decorate([e.parameter()],r.prototype,"applyColormap",void 0);c.RasterColorizerTechnique=f;c.RasterColorizerTechniqueConfiguration=r;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/support/MultiSizeFramebuffer":function(){define(["exports","../../../webgl/enums","../../../webgl/FramebufferObject"],function(a,c,b){let t=function(){function n(m){this._rctx=
m;this._fbos=new Map}var r=n.prototype;r.get=function(m){return this._getPool(m)};r.dispose=function(){this._fbos.forEach(m=>m.dispose());this._fbos.clear()};r._getPool=function(m){var d=this._fbos.get(m);if(d)return d;d=new b.FramebufferObject(this._rctx,{colorTarget:c.TargetType.TEXTURE,depthStencilTarget:c.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:m,height:m});this._fbos.set(m,d);return d};return n}();a.MultiSizeFramebuffer=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../materials/internal/MaterialUtil".split(" "),function(a,c,b,t,n,r){function m(z,C,B){let A=0,x=Infinity;for(let y=0;3>y;++y){var u=z[y];if(C[y]<u){if(1E-6>=B[y])return!1;A=Math.max(A,(u-C[y])/B[y])}else-1E-6>=B[y]&&(x=Math.min(x,(u-C[y])/
B[y]));if(A>x)return!1;u=z[y+3];if(C[y]>u){if(-1E-6<=B[y])return!1;A=Math.max(A,(u-C[y])/B[y])}else 1E-6<=B[y]&&(x=Math.min(x,(u-C[y])/B[y]));if(A>x)return!1}return!0}function d(z,C,B,A,x,u){let y=A;for(;B<y;){var w=z[B];C[6*w+x+3]<=u?++B:(--y,z[B]=z[y],z[y]=w)}w=B;for(y=A;w<y;)A=z[y-1],C[6*A+x]>=u?--y:(z[y-1]=z[w],z[w]=A,++w);return{next:B,mid:w}}function f(z,C,B,A){if(A<=B)return n.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var x=6*z[B];for(var u=0;3>u;++u)k[u]=C[x+0+u],p[u]=C[x+3+u];for(B+=1;B<A;++B)for(x=
6*z[B],u=0;3>u;++u)k[u]=Math.min(k[u],C[x+0+u]),p[u]=Math.max(p[u],C[x+3+u]);return n.fromValues(k[0],k[1],k[2],p[0],p[1],p[2])}function e(z){var C=z[3]-z[0];const B=z[4]-z[1],A=z[5]-z[2];C=C>B?C>A?0:B>A?1:2:B>A?1:A>C?2:0;return{axis:C,midValue:(z[C]+z[C+3])/2}}function g(z,C,B,A,x){B-=C;const u=new Float32Array(6*B);for(let w=0;w<B;++w){var y=3*(w+C);const D=z[y+0]*x,F=z[y+1]*x;y=z[y+2]*x;for(let E=0;3>E;++E){const K=A[D+E],J=A[F+E],M=A[y+E];u[6*w+E]=Math.min(K,J,M);u[6*w+3+E]=Math.max(K,J,M)}}return u}
function h(z,C,B,A){const x=A-B;var u=0;for(var y=B;y<A;++y)for(var w=0;3>w;++w)u=Math.max(C[3*y+w],u);A=65535>=u?new Uint16Array(3*x):new Uint32Array(3*x);for(u=0;u<x;++u)for(y=3*(z[u]+B),w=0;3>w;++w)A[3*u+w]=C[y+w];return A}let l=function(z,C,B,A,x){this.aabb=z;this.axis=C;this.d=B;this.midStartIndex=A;this.rightStartIndex=x},v=function(){function z(B,A,x,u){this.globalTriangleVertexIndices=B;this.firstTriangleIndex=A;this.positionAttribute=u;this._rayDirection=t.create();this.bspNodeTree=[];const y=
x-A,w=65535>=y?new Uint16Array(y):new Uint32Array(y);this.indices=w;for(let K=0;K<y;++K)w[K]=K;const D=g(B,A,x,u.data,u.stride),F=b.clamp(Math.log2(y/40),2,10),E=(K,J,M)=>{var N=f(w,D,K,J);const P=J-K;if(40>=P)return K=new l(N,void 0,0,K,J),this.bspNodeTree.push(K),K;const {axis:I,midValue:G}=e(N),H=d(w,D,K,J,I,G),L=(O,S)=>{if(!(M>F)){var R=S-O;if(!(40>R||R>=.8*P))return E(O,S,M+1)}};N=new l(N,I,G,H.next,H.mid);this.bspNodeTree.push(N);N.leftNode=L(K,H.next);N.rightNode=L(H.mid,J);return N};E(0,y,
0);this.triangleVertexIndices=h(w,B,A,x)}var C=z.prototype;C.intersectRayTriangleRange=function(B,A){if(!(B>=A)){var x=this.triangleVertexIndices,u=this.positionAttribute.data,y=this.positionAttribute.stride,w=this._rayOrigin,D=w[0],F=w[1];w=w[2];var E=this._rayDirection,K=E[0],J=E[1];E=E[2];for(let aa=B,X=3*B;aa<A;++aa){var M=x[X++]*y,N=u[M++],P=u[M++],I=u[M];M=x[X++]*y;var G=u[M++],H=u[M++],L=u[M];M=x[X++]*y;var O=u[M++],S=u[M++];G-=N;H-=P;L-=I;O-=N;S-=P;M=u[M]-I;var R=J*M-S*E,Q=E*O-M*K;const W=
K*S-O*J;var V=G*R+H*Q+L*W;if(!(Math.abs(V)<=Number.EPSILON)){N=D-N;P=F-P;I=w-I;R=N*R+P*Q+I*W;if(0<V){if(0>R||R>V)continue}else if(0<R||R<V)continue;Q=P*L-H*I;I=I*G-L*N;P=N*H-G*P;N=K*Q+J*I+E*P;if(0<V){if(0>N||R+N>V)continue}else if(0<N||R+N<V)continue;I=(O*Q+S*I+M*P)/V;0<=I&&(V=this.indices[aa]+this.firstTriangleIndex,G=r.computeNormal(G,H,L,O,S,M,q),this._callback(I,G,V,!1))}}z.numFacesTested+=A-B}};C.intersectRay=function(B,A){z.numFacesTested=0;var x=t.fromValues(B.r0[0],B.r0[1],B.r0[2]),u=t.fromValues(B.r1[0],
B.r1[1],B.r1[2]);B=u[0]-x[0];const y=u[1]-x[1];u=u[2]-x[2];1E-6>B*B+y*y+u*u||(this._rayOrigin=x,x=this._rayDirection,x[0]=B,x[1]=y,x[2]=u,x=this.triangleVertexIndices.length/3,this._callback=A,this.intersectRayBSP(this.bspNodeTree[0],0,x))};C.intersectRayBSP=function(B,A,x){const u=this._rayOrigin,y=this._rayDirection;if(m(B.aabb,u,y)){var w=B.axis,D=B.d;if(u[w]<D||0>y[w]){const F=B.midStartIndex;if(A<F){const E=B.leftNode;void 0!==E?this.intersectRayBSP(E,A,F):this.intersectRayTriangleRange(A,F)}}this.intersectRayTriangleRange(B.midStartIndex,
B.rightStartIndex);if(u[w]>D||0<y[w])A=B.rightStartIndex,A<x&&(B=B.rightNode,void 0!==B?this.intersectRayBSP(B,A,x):this.intersectRayTriangleRange(A,x))}};c._createClass(z,[{key:"estimatedMemoryUsage",get:function(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}]);return z}();v.numFacesTested=0;const q=t.create(),k=[Infinity,Infinity,Infinity],p=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=v;a.componentMinimalSizeForIntersectionData=200;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../support/debugFlags ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){h=function(l){function v(){var q=l.apply(this,arguments)||this;q.output=n.ShaderOutput.Color;q.overlayMode=f.OverlayMode.Disabled;q.tileBlendInput=e.TileBlendInput.LayerOnly;q.spherical=!1;q.doublePrecisionRequiresObfuscation=!1;q.atmosphere=!1;q.receiveShadows=!1;q.hasSlicePlane=!1;q.backfaceCullingEnabled=!1;q.stencilEnabled=!1;q.textureFadingEnabled=!1;q.renderOccluded=!1;q.hasScreenSpaceReflections=!1;q.hasCloudsReflections=!1;q.shading=!t.TERRAIN_USE_LEGACY_SHADING;
q.useLegacyTerrainShading=t.TERRAIN_USE_LEGACY_SHADING;q.invisible=!1;q.tileBorders=!1;q.visualizeNormals=!1;q.screenSizePerspective=!1;q.receiveAmbientOcclusion=!1;q.pbrMode=d.PBRMode.Terrain;return q}c._inheritsLoose(v,l);return v}(h.DefaultTechniqueConfiguration);b.__decorate([g.parameter({count:n.ShaderOutput.COUNT})],h.prototype,"output",void 0);b.__decorate([g.parameter({count:f.OverlayMode.COUNT})],h.prototype,"overlayMode",void 0);b.__decorate([g.parameter({count:e.TileBlendInput.COUNT})],
h.prototype,"tileBlendInput",void 0);b.__decorate([g.parameter()],h.prototype,"spherical",void 0);b.__decorate([g.parameter()],h.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([g.parameter()],h.prototype,"atmosphere",void 0);b.__decorate([g.parameter()],h.prototype,"receiveShadows",void 0);b.__decorate([g.parameter()],h.prototype,"hasSlicePlane",void 0);b.__decorate([g.parameter()],h.prototype,"backfaceCullingEnabled",void 0);b.__decorate([g.parameter()],h.prototype,"stencilEnabled",
void 0);b.__decorate([g.parameter()],h.prototype,"textureFadingEnabled",void 0);b.__decorate([g.parameter()],h.prototype,"renderOccluded",void 0);b.__decorate([g.parameter()],h.prototype,"hasScreenSpaceReflections",void 0);b.__decorate([g.parameter()],h.prototype,"hasCloudsReflections",void 0);b.__decorate([g.parameter()],h.prototype,"shading",void 0);b.__decorate([g.parameter()],h.prototype,"useLegacyTerrainShading",void 0);b.__decorate([g.parameter()],h.prototype,"invisible",void 0);b.__decorate([g.parameter()],
h.prototype,"tileBorders",void 0);b.__decorate([g.parameter()],h.prototype,"visualizeNormals",void 0);b.__decorate([g.parameter()],h.prototype,"screenSizePerspective",void 0);b.__decorate([g.parameter()],h.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([g.parameter({count:d.PBRMode.COUNT})],h.prototype,"pbrMode",void 0);b.__decorate([g.parameter({constValue:r.NormalAttributeType.CompressedAttribute})],h.prototype,"normalType",void 0);b.__decorate([g.parameter({constValue:m.TextureCoordinateAttributeType.Compressed})],
h.prototype,"textureCoordinateType",void 0);b.__decorate([g.parameter({constValue:!1})],h.prototype,"highStepCount",void 0);b.__decorate([g.parameter({constValue:!1})],h.prototype,"useCustomDTRExponentForWater",void 0);b.__decorate([g.parameter({constValue:!1})],h.prototype,"useFillLights",void 0);a.TerrainTechniqueConfiguration=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){return function(){this.numMerged=
this.numSplit=this.numRendered=this.numVisible=this.numLeaves=this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){a.TilingSchemeLogic=function(C){function B(x){x=C.call(this,x)||this;x._handles=new n;return x}c._inheritsLoose(B,C);var A=B.prototype;A.initialize=function(){this._handles.add(this.layers.on("change",()=>this._update()));this._handles.add(m.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};A.destroy=function(){this._handles=r.destroyMaybe(this._handles);
this._waitTask=null};A._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){var x;this.layers.some(y=>!q.isTiledLayer(y)||y.isRejected()?!1:!y.isFulfilled()||r.isSome(p.getTiledLayerInfo(y,this.viewSpatialReference,this.viewingMode))?(x=y,"vector-tile"!==y?.type&&!p.isProjectableRasterLayer(y)):!1);if(x)if(x.isResolved()){var u=p.getTiledLayerInfo(x,this.viewSpatialReference,this.viewingMode);r.isSome(u)&&(u=new z.TilingScheme(u.tileInfo),this._lockTilingScheme(u))}else this._updateWhen(x)}};
A._updateWhen=function(x){const u=x.when().catch(()=>{}).then(()=>{u!==this._waitTask||this.destroyed||this._update()});this._waitTask=u};A._lockTilingScheme=function(x){if(this.viewingMode===k.ViewingMode.Global){const u=x.levels.length-1;x.spatialReference.isWebMercator?x=z.TilingScheme.makeWebMercatorAuxiliarySphere(u):h.canProjectToWGS84ComparableLonLat(x.spatialReference)&&(x=z.TilingScheme.makeGCSWithTileSize(x.spatialReference,x.pixelSize,u))}this.tilingSchemeLocked=!0;this.tilingScheme=x;
this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._handles.removeAll();this._handles.add(m.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))};A._updateTiledLayerExtent=function(){this._set("extent",this.extentHelper.tiledLayersExtent)};A._setAdHocTilingScheme=function(){if(this.viewingMode===k.ViewingMode.Global){var x=this.extentHelper.viewSpatialReference;const u=h.canProjectToWGS84ComparableLonLat(x)||v.isMars(x)||v.isMoon(x);
x.isWebMercator?this.tilingScheme=z.TilingScheme.WebMercatorAuxiliarySphere:u&&(this.tilingScheme=z.TilingScheme.makeGCSWithTileSize(x,256));this._set("extent",this.extentHelper.layerViewsExtent)}else x=this.extentHelper.layerViewsExtent,r.isSome(x)&&!l.equals(x,this.extent)&&(this.tilingScheme=z.TilingScheme.fromExtent(x,this.extentHelper.viewSpatialReference),this._set("extent",x))};c._createClass(B,[{key:"test",get:function(){return{lockTilingScheme:x=>this._lockTilingScheme(x),done:!this._waitTask}}}]);
return B}(t);b.__decorate([d.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);b.__decorate([d.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);b.__decorate([d.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);b.__decorate([d.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewSpatialReference",void 0);b.__decorate([d.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);b.__decorate([d.property({constructOnly:!0})],
a.TilingSchemeLogic.prototype,"extentHelper",void 0);b.__decorate([d.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=b.__decorate([g.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/vec2f64"],function(a,c){let b=function(){function t(){this.offset=c.create();this.scale=0;this.tile=
null}var n=t.prototype;n.init=function(r,m,d,f){this.tile=r;this.offset[0]=m;this.offset[1]=d;this.scale=f};n.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return t}();a.UpsampleInfo=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/ChangeSet ./lib/UpdatePolicy ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){a.Stage=function(B){function A(u){u=B.call(this,u)||this;u._handles=new n;u._model=new p.Model;u._layers=new m;u._asyncChangeSet=new v.ChangeSet;u._syncChangeSet=new v.ChangeSet;u._layerSyncSet=new Set;return u}c._inheritsLoose(A,B);var x=A.prototype;x.initialize=function(){this._set("renderView",new z.RenderView(this));this._frameTask=this.view.resourceController.scheduler.registerTask(C.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};
x.destroy=function(){this._handles.destroy()};x.add=function(u){this._model.add(u);k.isWebGLLayer(u)&&(u.attachStage(this),this._addLayer(u));this.renderView.requestRender()};x.remove=function(u){r.isNone(u)||(this.renderView.requestRender(),this._model.remove(u),k.isWebGLLayer(u)&&(this._removeLayer(u),u.detachStage()))};x.addMany=function(u){r.isSome(u)&&(this._model.addMany(u),this.renderView.requestRender())};x.removeMany=function(u){r.isSome(u)&&(this._model.removeMany(u),this.renderView.requestRender())};
x.load=function(){var u=c._asyncToGenerator(function*(y,w){r.isNone(y)||(Array.isArray(y)||(y=[y]),yield Promise.all(y.filter(D=>r.isNone(D.glTexture)).map(D=>this.schedule(()=>this._model.has(D)?D.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null),w)))});return function(y,w){return u.apply(this,arguments)}}();x.loadImmediate=function(u){return u.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)};x.forEachOfType=
function(u,y){this._model.forEachOfType(u,y)};x.handleEvent=function(u,y){this.destroyed||(this._model.dirtySet[u](y),this.renderView.requestRender())};x.runTask=function(u){this._frameTask.processQueue(u);this._commit(u)};x._commit=function(u){const y=this._model.dirtySet;this._asyncChangeSet.empty||u.done||(this.renderer.modify(this._asyncChangeSet,u),this.renderView.requestRender(),u.madeProgress());this._layers.forAll(w=>{if(!u.done){var D=this._layerSyncSet.has(w.id)||w.updatePolicy===q.UpdatePolicy.SYNC,
F=D?this._syncChangeSet:this._asyncChangeSet;y.commitLayer(w.id,F);this._layerSyncSet.delete(w.id);F.empty||(this.renderer.modify(F,D?C.noBudget:u),this.renderView.requestRender(),u.madeProgress())}});this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,C.noBudget),this.renderView.requestRender(),u.madeProgress());this._layers.forAll(w=>{u.done||this._layerSyncSet.has(w.id)||w.updatePolicy!==q.UpdatePolicy.ASYNC||(y.commitLayer(w.id,this._asyncChangeSet),this._asyncChangeSet.empty||
(this.renderer.modify(this._asyncChangeSet,u),this.renderView.requestRender(),u.madeProgress()))});this._layerSyncSet.clear();this.notifyChange("running")};x.commitSyncLayers=function(){const u=this._model.dirtySet;this._layers.forAll(y=>{if(this._layerSyncSet.has(y.id)||y.updatePolicy===q.UpdatePolicy.SYNC)u.commitLayer(y.id,this._syncChangeSet),this._layerSyncSet.delete(y.id)});for(const y of this._layerSyncSet)u.commitLayer(y,this._syncChangeSet);this._layerSyncSet.clear();this._syncChangeSet.empty||
(this.renderer.modify(this._syncChangeSet,C.noBudget),this.renderView.requestRender())};x._commitLayer=function(u){this._model.dirtySet.commitLayer(u.id,this._syncChangeSet);this._layerSyncSet.delete(u.id);this._syncChangeSet.empty||(this.renderer.modify(this._syncChangeSet,C.noBudget),this.renderView.requestRender())};x.schedule=function(u,y){return this._frameTask.schedule(u,y)};x.reschedule=function(u,y){return this._frameTask.reschedule(u,y)};x.syncLayer=function(u){this._layerSyncSet.add(u);
this.renderView.requestRender()};x.getObject=function(u){return this._model.getObject(u)};x._addLayer=function(u){this._layers.includes(u)||this._layers.push(u)};x._removeLayer=function(u){this._commitLayer(u);null!=this._layers.removeUnordered(u)&&(this._model.dirtySet.getResidentRenderGeometries(u.id,this._syncChangeSet.removes),this.renderer.modify(this._syncChangeSet,C.noBudget))};x.addRenderPlugin=function(u,y,w){u=this.renderer.renderPlugins.add(u,y,w);w=()=>{l.isIntersectionHandler(y)&&this.view.sceneIntersectionHelper.addIntersectionHandler(y)};
if(d.isPromiseLike(u))return u.then(w);w()};x.removeRenderPlugin=function(u){l.isIntersectionHandler(u)&&this.view.sceneIntersectionHelper.removeIntersectionHandler(u);this.renderer.renderPlugins.remove(u)};c._createClass(A,[{key:"viewingMode",get:function(){return this.view.state.viewingMode}},{key:"updating",get:function(){return this.running||this.renderView.updating||this._frameTask.updating}},{key:"renderer",get:function(){return this.renderView?.renderer}},{key:"running",get:function(){return this._model.dirtySet.dirty||
!this._asyncChangeSet.empty}},{key:"layers",get:function(){return this._layers}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const u=this;return{getCount(y){return u._model.test.content.filter(w=>w.type===y).length},model:u._model}}}]);return A}(t);a.Stage.DebugSettings={endFrameContentValidation:!1};b.__decorate([f.property({constructOnly:!0})],a.Stage.prototype,"view",void 0);b.__decorate([f.property({constructOnly:!0})],
a.Stage.prototype,"options",void 0);b.__decorate([f.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);b.__decorate([f.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);b.__decorate([f.property({constructOnly:!0})],a.Stage.prototype,"_handles",void 0);b.__decorate([f.property({readOnly:!0})],a.Stage.prototype,"updating",null);b.__decorate([f.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);b.__decorate([f.property({autoDestroy:!0})],a.Stage.prototype,
"renderView",void 0);b.__decorate([f.property({readOnly:!0})],a.Stage.prototype,"renderer",null);b.__decorate([f.property({readOnly:!0})],a.Stage.prototype,"running",null);a.Stage=b.__decorate([h.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){a.Model=function(k){function p(){var C=k.apply(this,arguments)||this;C.dirtySet=new h({model:c._assertThisInitialized(C)});C._content=new Map;C._originFactory=new g.GridLocalOriginFactory(null);return C}c._inheritsLoose(p,k);var z=p.prototype;z.getObject=function(C){return this._content.get(C)};z.add=function(C){const B=C.id;v.assert(!this._content.has(B),"Model/Stage already contains object to be added");this._content.set(B,C);q.isWebGLLayer(C)&&this.dirtySet.layerAdded(C)};
z.remove=function(C){v.assert(this._content.has(C.id),"Model/Stage doesn't contain object to be removed");this._content.delete(C.id);C.unload();q.isWebGLLayer(C)&&this.dirtySet.layerRemoved(C)};z.addMany=function(C){for(const B of C)n.isSome(B)&&(v.assert(!this._content.has(B.id),"Model/Stage already contains object to be added"),this._content.set(B.id,B))};z.removeMany=function(C){for(const B of C)v.assert(this._content.has(B.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(B.id),
B.unload()};z.has=function(C){return this._content.has(C.id)};z.forEachOfType=function(C,B){this._content.forEach(A=>{A.type===C&&B(A)})};z.getRenderGeometry=function(C,B){const {shaderTransformer:A,localOrigin:x}=B,u=new l.RenderGeometry(B,{boundingInfo:B.boundingInfo,shaderTransformer:A,castShadow:C.castShadow});u.updateTransformation(y=>C.getCombinedStaticTransformation(B,y));u.localOrigin=n.isSome(x)?x:this._originFactory.getOrigin(u.boundingSphere);return u};z.updateRenderGeometryTransformation=
function(C,B,A){if(n.isNone(C))return!1;A.updateTransformation(u=>C.getCombinedStaticTransformation(B,u));const x=this._originFactory.getOrigin(A.boundingSphere);return A.localOrigin!==x};z.getStats=function(){const C={},B=Array.from(this._content.values());for(let A=0;A<e.ContentObjectType.COUNT;++A)C[A]=B.filter(x=>x.type===A).length;return{contentTypes:C,dirtySet:this.dirtySet.formatDebugInfo()}};c._createClass(p,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);
return p}(t);b.__decorate([r.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=b.__decorate([f.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ./ModelDirtyTypes ./Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){let l=function(v,q,k){this.operation=v;this.geometry=q;this.states=k};b=function(v){function q(p){p=v.call(this,p)||this;p._residentGeomRecords=new Map;p._dirtyGeomRecords=new Map;p.dirty=!1;return p}a._inheritsLoose(q,v);var k=q.prototype;k.commitLayer=function(p,z){const C=this._dirtyGeomRecords.get(p);C&&(C.forEach((B,A)=>{const x=this._ensureGeomRecord(p,A);B.forEach(({geometry:u,operation:y,states:w},D)=>{let F=!1;if(y===g.DirtyOperation.UPDATE){const E=x.get(D);
if(E){if(w&g.DirtyState.TRANSFORMATION){const K=this.model.getObject(A);this.model.updateRenderGeometryTransformation(K,u,E)&&(F=!0)}F||z.updates.push({renderGeometry:E,updateType:w})}else h.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(y===g.DirtyOperation.REMOVE||F)(w=x.get(D))?(z.removes.push(w),x.delete(D)):y===g.DirtyOperation.REMOVE&&h.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");if(y===g.DirtyOperation.ADD||F)y=this.model.getObject(A),
n.isSome(y)&&(u=this.model.getRenderGeometry(y,u),z.adds.push(u),x.set(D,u))});0===x.size&&this._residentGeomRecords.get(p).delete(A)}),0===this._residentGeomRecords.get(p).size&&this._residentGeomRecords.delete(p),this._dirtyGeomRecords.delete(p),this.dirty=this._hasDirtyGeometryRecords)};k.getResidentRenderGeometries=function(p,z){(p=this._residentGeomRecords.get(p))&&p.forEach(C=>C.forEach(B=>z.push(B)))};k._objectStateChanged=function(p,z){for(const C of z.geometries)this._updateOrCreateDirtyRecord(z,
C,null,g.DirtyOperation.UPDATE,p)};k.visibilityChanged=function(p){this._objectStateChanged(g.DirtyState.VISIBILITY,p)};k.highlightChanged=function(p){this._objectStateChanged(g.DirtyState.HIGHLIGHT,p)};k.occlusionChanged=function(p){this._objectStateChanged(g.DirtyState.OCCLUDEE,p)};k.objectGeometryUpdated=function(p){this._updateOrCreateDirtyRecord(p.object,p.geometry,null,g.DirtyOperation.UPDATE,g.DirtyState.GEOMETRY)};k.layerAdded=function(p){p.objects.forAll(z=>this._layerObjectAdded(p,z))};
k.layerRemoved=function(p){p.objects.forAll(z=>this._layerObjectRemoved(p,z))};k.layerObjectAdded=function(p){this._layerObjectAdded(p.layer,p.object)};k._layerObjectAdded=function(p,z){p=p.id;for(const C of z.geometries)this._objectGeometryAdded(z,C,p)};k.layerObjectRemoved=function(p){this._layerObjectRemoved(p.layer,p.object)};k.layerObjectsAdded=function(p){for(const z of p.objects)this._layerObjectAdded(p.layer,z)};k.layerObjectsRemoved=function(p){for(const z of p.objects)this._layerObjectRemoved(p.layer,
z)};k._layerObjectRemoved=function(p,z){p=p.id;for(const C of z.geometries)this._objectGeometryRemoved(z,C,p)};k.shaderTransformationChanged=function(p){(p=this._residentGeomRecords.get(p.id))&&p.forEach((z,C)=>{(C=this.model.getObject(C))&&C.hasVolativeTransformation()&&z.forEach(B=>B.shaderTransformationChanged())})};k.objectTransformation=function(p){const z=this._getParentLayerId(p);this._ensureGeomRecord(z,p.id).forEach(C=>{this._updateOrCreateDirtyRecord(p,C.geometry,z,g.DirtyOperation.UPDATE,
g.DirtyState.TRANSFORMATION)})};k.objectGeometryAdded=function(p){this._objectGeometryAdded(p.object,p.geometry)};k._objectGeometryAdded=function(p,z,C=null){this._updateOrCreateDirtyRecord(p,z,C,g.DirtyOperation.ADD)};k.objectGeometryRemoved=function(p){this._objectGeometryRemoved(p.object,p.geometry)};k._objectGeometryRemoved=function(p,z,C=null){this._updateOrCreateDirtyRecord(p,z,C,g.DirtyOperation.REMOVE)};k._updateOrCreateDirtyRecord=function(p,z,C,B,A=g.DirtyState.NONE){C=n.unwrapOr(C,this._getParentLayerId(p));
const x=z.id;p=this._ensureDirtyRecord(C,p.id);(C=p.get(x))?(z=C.operation,z===g.DirtyOperation.REMOVE&&B===g.DirtyOperation.ADD&&C.states!==g.DirtyState.NONE?C.operation=g.DirtyOperation.UPDATE:z===g.DirtyOperation.REMOVE&&B===g.DirtyOperation.ADD||z===g.DirtyOperation.ADD&&B===g.DirtyOperation.REMOVE?p.delete(x):(z!==g.DirtyOperation.UPDATE||B!==g.DirtyOperation.REMOVE&&B!==g.DirtyOperation.UPDATE?h.assert((z===g.DirtyOperation.REMOVE||z===g.DirtyOperation.ADD)&&B===g.DirtyOperation.UPDATE,"ModelDirtySet.objectGeometryAdded: inconsistent state"):
C.operation=B,C.states|=A)):p.set(x,new l(B,z,A));this.dirty=this._hasDirtyGeometryRecords};k._ensureGeomRecord=function(p,z){let C=this._residentGeomRecords.get(p);C||(C=new Map,this._residentGeomRecords.set(p,C));p=C.get(z);p||(p=new Map,C.set(z,p));return p};k._ensureDirtyRecord=function(p,z){let C=this._dirtyGeomRecords.get(p);C||(C=new Map,this._dirtyGeomRecords.set(p,C));p=C.get(z);p||(p=new Map,C.set(z,p));return p};k._getParentLayerId=function(p){return n.isSome(p.parentLayer)?p.parentLayer.id:
r.NullUID};k.formatDebugInfo=function(){const p=["ADD","UPD",void 0,"REM"];let z="";this._dirtyGeomRecords.forEach((C,B)=>{C.forEach((A,x)=>{0<z.length&&(z+="\n");z+=B+"."+x;const u=[];A.forEach(y=>{const w=y.operation;u[w]||(u[w]=[]);u[w].push(y.geometry.id)});for(A=0;A<u.length;A++)if(u[A])for(z+=" "+p[A-1]+": ",x=0;x<u[A].length;x++)z+=u[A][x]+", "})});return z};a._createClass(q,[{key:"_hasDirtyGeometryRecords",get:function(){return t.someMap(this._dirtyGeomRecords,p=>t.someMap(p,z=>z&&0<z.size))}},
{key:"test",get:function(){const p=this;return{get residentLayerCount(){return p._residentGeomRecords.size},get residentObjectCount(){return Array.from(p._residentGeomRecords.values()).reduce((z,C)=>z+C.size,0)},commit:z=>p._dirtyGeomRecords.forEach((C,B)=>p.commitLayer(B,z))}}}]);return q}(b);c.__decorate([m.property({constructOnly:!0})],b.prototype,"model",void 0);c.__decorate([m.property()],b.prototype,"dirty",void 0);return b=c.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],
b)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Material ../lib/ObjectAndLayerIdRenderHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/StippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./requireUtils ./ScreenshotManager ./testUtils ../../../support/RenderState ../../../webgl/context-util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G){a.RenderView=function(L){function O(R){var Q=L.call(this,{})||this;Q.events=new n;Q.waterTextureRepository=new K.WaterTextureRepository;Q._magnifierHelper=new x.MagnifierHelper;Q.objectAndLayerIdRenderHelper=r("enable-feature:objectAndLayerId-rendering")?new y.ObjectAndLayerIdRenderHelper:null;Q._needsUpdate=!0;Q._needsRender=!0;Q._idleSuspend=!0;Q._needsWaterReflectionUpdate=!1;Q._lastAnimationUpdate=0;Q._container=R.container;
Q._viewingMode=R.viewingMode;Q._initializeContext(R);f.watch(()=>Q.waterTextureRepository?.updating,()=>Q.requestRender(),f.initial);Q._magnifierHelper.events.on("request-render",()=>Q.requestRender());Q._stippleTextureRepository=new E.StippleTextureRepository(Q._rctx);Q._shaderTechniqueRepository=new p.ShaderTechniqueRepository({rctx:Q._rctx,viewingMode:R.viewingMode,stippleTextureRepository:Q._stippleTextureRepository,waterTextureRepository:Q.waterTextureRepository});Q._textureRepository=new F.TextureRepository(R,
Q._shaderTechniqueRepository,Q._rctx);Q._textureRepository.events.on("changed",V=>Q.requestRender(V));Q._materialRepository=new A.GLMaterialRepository(Q._textureRepository,Q._shaderTechniqueRepository,()=>Q.requestRender(),()=>Q.requestRender());Q._compositingHelper=new C(Q._rctx,Q._shaderTechniqueRepository);Q.renderer=new w.Renderer(R,Q._materialRepository,Q._textureRepository,Q._shaderTechniqueRepository,Q._rctx,Q._compositingHelper,Q._magnifierHelper,V=>Q.requestRender(V));Q._screenshotManager=
new N.ScreenshotManager(Q._rctx,{renderScene:(V,aa,X,W,T)=>Q.renderer.render(V,aa,{camera:X,contentCamera:X,mode:I.RenderState.IDLE},W,T),requestRenderScene:V=>Q.requestRender(V),prepareOverlay:()=>R.options.screenshot.prepareOverlay(),renderOverlay:(V,aa)=>R.options.screenshot.renderOverlay(V,aa)},V=>Q.events.emit("force-camera-for-screenshot",V),()=>Q.renderer.disposeOffscreenBuffers());Q._registerFrameTask(R);return Q}c._inheritsLoose(O,L);var S=O.prototype;S.normalizeCtorArgs=function(){return{}};
S.destroy=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=d.removeMaybe(this._frameTask);this._shaderTechniqueRepository=d.destroyMaybe(this._shaderTechniqueRepository)};S.requestRender=function(R=z.RenderRequestType.UPDATE){this._needsRender=!0;R===z.RenderRequestType.UPDATE&&(this._needsUpdate=!0)};S.setIdleSuspend=function(R){this._idleSuspend!==R&&(this._idleSuspend=R,this.requestRender())};S.takeScreenshot=function(R){return this._screenshotManager.takeScreenshot(R).then(Q=>
Q[0])};S.takeScreenshotWithOID=function(R){R.objectAndLayerIdColor=!0;return this._screenshotManager.takeScreenshot(R)};S.getAlpha=function(){return!!this._rctx.contextAttributes.alpha};S.getMinimalDepthForArea=function(R,Q,V,aa,X,W=X){W=aa.constrainWindowSize(Q,V,X*aa.pixelRatio,W*aa.pixelRatio);const T=this._ensureDepthBuffer(W);this.renderer.readDepthPixels(aa,W,T);X=Number.MAX_VALUE;for(let U=0;U<W[2]*W[3];U++){const Y=B.textureToDepth(4*U,T,aa.nearFar);X>Y&&Y!==aa.nearFar[0]&&Y!==aa.nearFar[1]&&
(X=Y)}d.isSome(R)&&(R=R.pickDepth(Q*aa.pixelRatio,V*aa.pixelRatio,aa),d.isSome(R)&&X>R&&R!==aa.nearFar[0]&&R!==aa.nearFar[1]&&(X=R));return X===Number.MAX_VALUE?void 0:X};S._ensureDepthBuffer=function(R){R=4*R[2]*R[3];if(d.isNone(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<R)this._tmpDepthBuffer=new Uint8Array(R);return this._tmpDepthBuffer};S.reloadShaders=function(){var R=c._asyncToGenerator(function*(){M.removeLoadedShaderModules();yield this._shaderTechniqueRepository.reloadAll();this.requestRender()});
return function(){return R.apply(this,arguments)}}();S._registerFrameTask=function(R){const Q=R.view.state;let V=!1,aa=z.RenderRequestType.BACKGROUND,X=!1;this._frameTask=e.addFrameTask({preRender:({time:W})=>{V=this.updating;aa=this._needsUpdate?z.RenderRequestType.UPDATE:z.RenderRequestType.BACKGROUND;R.commitSyncLayers();var T=g.Milliseconds(W-this._lastAnimationUpdate);if(T>this.renderer.animationTimestep||d.isSome(Q.forcedAnimationTime)||V||this._needsRender)T=g.Milliseconds(T/this.renderer.animationTimeDilation),
T=new u.UpdateParameters(Q.camera,T,Q.forcedAnimationTime),this.renderer.updateAnimation(T)&&this.requestRender(z.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=W},render:({time:W})=>{if((this._needsRender||!this._idleSuspend||!this.renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<Q.camera.fullWidth&&0<Q.camera.fullHeight){const T=this._needsUpdate&&this._idleSuspend&&this.renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this.renderer.render(null,
null,Q,z.Decorations.ON,W);X=!0;T&&this.renderer.hasWaterReflection&&(this.requestRender(z.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},update:({time:W})=>{const T=new N.ScreenshotContext(Q.camera,this.renderer.hasSlicePlane||this._magnifierHelper.enabled);this._textureRepository.update();this._screenshotManager.update(T,W)},finish:()=>{X&&(this.renderer.finish(Q.mode===I.RenderState.IDLE?aa:z.RenderRequestType.UPDATE),X=!1)}})};S._initializeContext=function(R){const Q=R.options;
this._canvas=Q.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const V=G.createContextOrErrorHTML("3d",this._canvas,{alpha:Q.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==Q.stencil?!0:Q.stencil,powerPreference:"high-performance",preserveDrawingBuffer:Q.preserveDrawingBuffer??!1});d.isNone(V)?(R=r("esri-force-webgl"),m.getLogger(this.declaredClass).error("A WebGL context with the requested version ("+
R?R:"automatic) could not be created.")):(this._rctx=this._newRenderingContext(V,R),this._loadShaderOnlyExtensions(),!Q.alpha&&this._rctx.contextAttributes.alpha&&m.getLogger(this.declaredClass).error("WebGL context has alpha channel even though no alpha channel was requested"),!this._rctx.contextAttributes.alpha&&11<=r("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))};S._newRenderingContext=function(R,Q){const V={disabledExtensions:Q.options.deactivatedWebGLExtensions||
{},debugWebGLExtensions:Q.options.debugWebGLExtensions||{},maxAnisotropy:8},aa=(X,W)=>Q.view.resourceController.memoryController.newCache(X,W);if(P.contextCache.enabled){let X=H.get(R);if(X)return X.configure(V),X.newCache=aa,X.ref(),X;X=new D.RenderingContext(R,V,aa);H.set(R,X);X.ref();return X}return new D.RenderingContext(R,V,aa)};S._loadShaderOnlyExtensions=function(){this._rctx.capabilities.enable("standardDerivatives");this._rctx.capabilities.enable("shaderTextureLOD");this._rctx.capabilities.enable("textureFloat")};
S.getObjectAndLayerIdColor=function(R){return d.isSome(this.objectAndLayerIdRenderHelper)?this.objectAndLayerIdRenderHelper.getObjectAndLayerIdColor(R):null};c._createClass(O,[{key:"performanceInfo",get:function(){const R=this._rctx.gl;return{renderer:this.renderer.performanceInfo,textureMemory:void 0!==R.getUsedTextureMemory?R.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==R.getUsedRenderbufferMemory?R.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==R.getUsedVBOMemory?R.getUsedVBOMemory():
void 0}}},{key:"updating",get:function(){return this._needsUpdate||this._needsWaterReflectionUpdate||this.renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},{key:"magnifier",set:function(R){this._magnifierHelper.magnifier=R}},{key:"renderingContext",get:function(){return this._rctx}},
{key:"capabilities",get:function(){return this._rctx.capabilities}},{key:"canvas",get:function(){return this._canvas}},{key:"componentObjectCollection",get:function(){d.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new k.ComponentObjectCollection(this.renderer.renderPassManager,this._viewingMode));return this._componentObjectCollection},set:function(R){this._componentObjectCollection=R}}]);return O}(t);b.__decorate([h.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,
"updating",null);b.__decorate([h.property({autoDestroy:!0})],a.RenderView.prototype,"_rctx",void 0);b.__decorate([h.property({autoDestroy:!0})],a.RenderView.prototype,"_container",void 0);b.__decorate([h.property({autoDestroy:!0})],a.RenderView.prototype,"_canvas",void 0);b.__decorate([h.property({autoDestroy:!0})],a.RenderView.prototype,"_stippleTextureRepository",void 0);b.__decorate([h.property({autoDestroy:!0})],a.RenderView.prototype,"waterTextureRepository",void 0);b.__decorate([h.property({autoDestroy:!0})],
a.RenderView.prototype,"_magnifierHelper",void 0);b.__decorate([h.property({readOnly:!0})],a.RenderView.prototype,"objectAndLayerIdRenderHelper",void 0);b.__decorate([h.property({autoDestroy:!0})],a.RenderView.prototype,"_textureRepository",void 0);b.__decorate([h.property({autoDestroy:!0})],a.RenderView.prototype,"_compositingHelper",void 0);b.__decorate([h.property({autoDestroy:!0,readOnly:!0})],a.RenderView.prototype,"renderer",void 0);b.__decorate([h.property({autoDestroy:!0})],a.RenderView.prototype,
"_screenshotManager",void 0);b.__decorate([h.property()],a.RenderView.prototype,"componentObjectCollection",null);b.__decorate([h.property({autoDestroy:!0})],a.RenderView.prototype,"_componentObjectCollection",void 0);b.__decorate([h.property()],a.RenderView.prototype,"_needsUpdate",void 0);b.__decorate([h.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=b.__decorate([q.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const H=J.getContextCache();
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/has ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec32 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./UniformComponentParameters ./Material/ComponentMaterial ./Material/ComponentTechnique ./Material/shader/ComponentData.glsl ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/edgeRendering/bufferLayouts ../../lib/edgeRendering/edgeProcessing ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O){function S(W,T){return W===T?D.ComponentParameterSummary.All:0===W?D.ComponentParameterSummary.None:D.ComponentParameterSummary.Some}const R=t.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");t=function(){function W(U,Y){this._renderManager=U;this._viewingMode=Y;this._objects=[new r,new r];this._renderSubmit=new u.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);
this._hasObjectAndLayerId=b("enable-feature:objectAndLayerId-rendering");this._componentBufferManager=new G.BufferManager(U.rctx,2+(this._hasObjectAndLayerId?1:0))}var T=W.prototype;T.destroy=function(){J.assert(0===this._objects[C.State.Hidden].length&&0===this._objects[C.State.Visible].length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy()};T.createObject=function(U){const Y=new C.ComponentObject;Y.toMapSpace=U.toMapSpace;Y.transform=U.transform;Y.obb=q.clone(U.obb);
Y.components=new z(this._componentBufferManager,U.geometry.componentOffsets);Y.renderable=this._createRenderable(U,Y.components);Y.intersectionGeometry=new B(U.geometry.positionData,Y.components);this._objects[Y.visible].push(Y);return Y};T.destroyObject=function(U){this._objects[U.visible].removeUnordered(U);U.destroy();this._notifyDirty()};T.setObjectVisibility=function(U,Y){Y!==U.visible&&(this._objects[U.visible].removeUnordered(U),this._objects[Y].push(U),U.visible=Y,this._notifyDirty())};T.preSubmit=
function(U){const Y=U.camera.eye;this.visibleObjects.forAll(ba=>ba.renderable.meta.cameraDepthSquared=f.squaredDistance(Y,ba.obb.center))};T.getMaterial=function(U){return U.renderable.material};T.updateMaterial=function(U,Y){U=U.renderable.material;Y(U);U.dirty&&this._notifyDirty()};T.setAllComponentVisibilities=function(U,Y){U.components.visibility.reset(Y);U.components.visibilityDirty();this._notifyDirty()};T.forEachVisibleComponent=function(U,Y){return U.components.visibility.forEachComponent(Y)};
T.getComponentCount=function(U){const Y=U.components.visibility.componentCount();return{visible:Y,invisible:U.components.count-Y}};T.setComponentData=function(U,Y){const ba=U.renderable.material,da=U.components;var ea=da.materialDataBuffer;const ca=da.materialDataIndices,ja=new w.UniformComponentParameters;ea=ea.textureBuffer;const ia=new Uint8Array(4),Z=new Uint32Array(ia.buffer);let ha=0,fa=0,ka=0,la=da.verticalOffsets,na=Infinity,pa=-Infinity,va=!1,wa=!1,za=0;for(let sa=0;sa<da.count;sa++){Y(sa,
ja);ha+=+(1>ja.externalColor[3]);fa+=+(ja.externalColorMixMode===v.ColorMixModeEnum.Replace&&1===ja.externalColor[3]);ka+=+ja.castShadows;v.encodeSymbolColor(ja.externalColor,ja.externalColorMixMode,ia);ia[2]=ia[2]&254|+ja.castShadows;ea.setData(ca[sa],0,ia[0],ia[1],ia[2],ia[3]);va||(va=0<sa&&za!==Z[0]);za=Z[0];wa||(wa=0!==ja.elevationOffset);wa&&n.isNone(la)&&(la=Array(sa).fill(0));n.isSome(la)&&(la[sa]=ja.elevationOffset);na=Math.min(na,ja.elevationOffset);pa=Math.max(pa,ja.elevationOffset);E.encodeElevationOffset(ja.elevationOffset,
ia);ea.setData(ca[sa],1,ia[0],ia[1],ia[2],ia[3]);const ua=ja.objectAndLayerIdColor;n.isSome(ua)&&ea.setData(ca[sa],2,ua[0],ua[1],ua[2],ua[3]);ja.pickable!==K.getVisibility(da.pickability,sa)&&(da.pickability=K.updateVisibilityWithCount(da.pickability,da.count,sa,ja.pickable))}da.verticalOffsets=wa?la:null;U.offsetObb=wa?q.computeOffsetObb(U.obb,na,pa,this._viewingMode,n.isSome(U.offsetObb)?U.offsetObb:q.clone(U.obb)):null;va||wa||this._hasObjectAndLayerId?(ba.componentParameters=new D.ComponentParametersVarying,
ba.componentParameters.castShadows=S(ka,da.count),ba.componentParameters.transparent=S(ha,da.count),ba.componentParameters.opaqueOverride=S(fa,da.count),ba.componentParameters.texture=ea,ea.updateTexture()):(ba.componentParameters=new D.ComponentParametersUniform,ba.componentParameters.castShadows=ja.castShadows?D.ComponentParameterSummary.All:D.ComponentParameterSummary.None,ba.componentParameters.externalColor=ja.externalColor,ba.componentParameters.externalColorMixMode=ja.externalColorMixMode);
this._notifyDirty()};T.getComponentAabb=function(U,Y,ba,da=!1){U.intersectionGeometry.getComponentAabb(Y,ba);const ea=U.components.verticalOffsets;if(da||n.isNone(ea))return ba;Y=ea[Y];if(this._viewingMode===l.ViewingMode.Local||0===Y)return ba[2]+=Y,ba[5]+=Y,ba;Y=n.unwrap(N.getVerticalOffsetI3S(Y));Y.localOrigin=U.transform.position;return Y.applyToAabb(ba)};T.getComponentObb=function(U){return U.obb};T.getObjectTransform=function(U){return U.transform};T.getComponentPositions=function(U,Y,ba){return U.intersectionGeometry.getComponentPositions(Y,
ba)};T.intersect=function(U,Y,ba,da,ea,ca){n.isSome(ea)&&(ea.localOrigin=U.transform.position);const ja=m.invert(V,U.transform.rotationScale);f.sub(aa,Y,U.transform.position);f.sub(X,ba,U.transform.position);f.transformMat3(aa,aa,ja);f.transformMat3(X,X,ja);Y=m.transpose(V,ja);return U.intersectionGeometry.intersect(aa,X,da,Y,ea,U.components.verticalOffsets,ca)};T.addEdges=function(U,Y,ba,da){const {indices:ea,positions:ca}=U.intersectionGeometry,ja=U.components.offsets;return Y.addComponentObject(U,
U.transform,{center:U.obb.center,radius:q.radius(U.obb)},ca,ea,ja,ba,da)};T.extractEdgeInformation=function(){var U=c._asyncToGenerator(function*(Y,ba,da){var ea=Y.components.visibility;if(ea.allInvisible())return{buffer:I.extractComponentsEdgeLocationsLayout.createBuffer(0),origin:[0,0,0]};const {indices:ca,positions:ja}=Y.intersectionGeometry,ia=Y.components.offsets,Z=P.EdgeInputBufferLayout.createBuffer(ja.count);h.copy(Z.position,ja);g.transformMat3(Z.position,Z.position,Y.transform.rotationScale);
this._setComponentIndices(Z.componentIndex,ca,ia);ea=this._computeVisibilityIndices(ca,ea,ia,Z.count);Y=e.clone(Y.transform.position);ba=yield ba.extractComponentsEdgeLocations({indices:ea,indicesLength:ea.length,skipDeduplicate:!0,data:Z,writerSettings:{reducedPrecision:!1,variants:0}},da);return{origin:Y,buffer:ba}});return function(Y,ba,da){return U.apply(this,arguments)}}();T._setComponentIndices=function(U,Y,ba){let da=0;for(let ca=0;ca<ba.length-1;ca++){var ea=ba[ca];const ja=ba[ca+1];for(;ea<
ja;ea++)U.set(Y?Y[ea]:ea,da);da++}};T._computeVisibilityIndices=function(U,Y,ba,da){if(U&&Y.allVisible())return U;let ea=0;Y.forEachComponentRange((ia,Z)=>{ea+=ba[Z]-ba[ia];return!0});const ca=Array.isArray(U)?Array(ea):2===U?.BYTES_PER_ELEMENT||65536>=da?new Uint16Array(ea):new Uint32Array(ea);let ja=0;Y.forEachComponentRange((ia,Z)=>{ia=ba[ia];for(Z=ba[Z];ia<Z;ia++)ca[ja++]=U?U[ia]:ia;return!0});return ca};T.addComponentHighlight=function(U,Y){U=U.components;n.isNone(U.highlightCounts)&&(U.highlightCounts=
new Uint32Array(U.count+1));0===U.highlightCounts[Y]++&&(U.highlightsDirty(),this._notifyDirty());U.highlightCounts[U.count]++};T.removeComponentHighlight=function(U,Y){U=U.components;if(n.isNone(U.highlightCounts))R.warn("Removing non-existing highlight.");else{var ba=U.highlightCounts[Y],da=U.highlightCounts[U.count];0===ba?R.warn("Removing non-existing highlight."):1<ba?(U.highlightCounts[Y]=ba-1,U.highlightCounts[U.count]=da-1):(U.highlightCounts[Y]=0,U.highlightsDirty(),this._notifyDirty(),1===
da?U.highlightCounts=null:U.highlightCounts[U.count]=da-1)}};T.clearHighlights=function(U){U=U.components;n.isSome(U.highlightCounts)&&(U.highlightCounts=null,U.highlightsDirty(),this._notifyDirty())};T.getObjectGPUMemoryUsage=function(U){return U.renderable.meta.gpuMemoryEstimate};T._createRenderable=function(U,Y){const ba=this._renderManager.rctx,da=U.geometry;var ea=da.vertices.layoutParameters,ca=H.BufferObject.createVertex(ba,L.Usage.STATIC_DRAW,da.vertices.data);const ja=n.applySome(da.indices,
fa=>H.BufferObject.createIndex(ba,L.Usage.STATIC_DRAW,fa));var ia=k.glLayout(y.createVertexBufferLayout(ea));const Z=new Uint16Array(da.vertices.count);for(let fa=0;fa<Y.count;fa++){var ha=Y.offsets[fa];const ka=Y.offsets[fa+1],la=Y.materialDataIndices[fa];if(n.isSome(da.indices))for(;ha<ka;ha++)Z[da.indices[ha]]=la;else for(;ha<ka;ha++)Z[ha]=la}Y=H.BufferObject.createVertex(ba,L.Usage.STATIC_DRAW,Z.buffer);U=new D.ComponentMaterial(U.transform,U.toMapSpace);ia=new O.VertexArrayObject(ba,F.attributeLocations,
{data:ia,componentIndices:Q},{data:ca,componentIndices:Y},n.unwrap(ja));ea=new x.RenderGeometry(ia,L.PrimitiveType.TRIANGLES,ea,n.isSome(ja));ca={cameraDepthSquared:.5,gpuMemoryEstimate:ca.byteSize+Y.byteSize+(n.isSome(ja)?ja.byteSize:0)};return new A.Renderable(U,ea,ca)};T._notifyDirty=function(){this._renderManager.notifyDirty()};c._createClass(W,[{key:"visibleObjects",get:function(){return this._objects[C.State.Visible]}}]);return W}();const Q=k.glLayout(p.newLayout().u16(M.VertexAttribute.COMPONENTINDEX)),
V=d.create(),aa=e.create(),X=e.create();a.ComponentObjectCollection=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf32 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ../../ViewingMode ./dito".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){function k(J=[0,0,0],M=[-1,-1,-1],N=r.create()){return{center:f.clone(J),halfSize:d.clone(M),quaternion:n.clone(N)}}function p(J,M){const N=l.signedDistance(M,J.center);J=z(J,l.normal(M));return N>J?1:N<-J?-1:0}function z(J,M){t.conjugate(C,J.quaternion);m.transformQuat(B,M,C);J=J.halfSize;return Math.abs(B[0]*J[0])+Math.abs(B[1]*J[1])+Math.abs(B[2]*J[2])}const C=r.create(),B=f.create(),A=f.create(),x=g.create(),u=b.create(),y=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,
1.1,1.2],w=(()=>{const J=new Int8Array(162);let M=0;const N=P=>{for(let I=0;I<P.length;I++)J[M+I]=P[I];M+=6};N([6,2,3,1,5,4]);N([0,2,3,1,5,4]);N([0,2,3,7,5,4]);N([0,1,3,2,6,4]);N([0,1,3,2,0,0]);N([0,1,5,7,3,2]);N([0,1,3,7,6,4]);N([0,1,3,7,6,2]);N([0,1,5,7,6,2]);N([0,1,5,4,6,2]);N([0,1,5,4,0,0]);N([0,1,3,7,5,4]);N([0,2,6,4,0,0]);N([0,0,0,0,0,0]);N([1,3,7,5,0,0]);N([2,3,7,6,4,0]);N([2,3,7,6,0,0]);N([2,3,1,5,7,6]);N([0,1,5,7,6,2]);N([0,1,5,7,6,4]);N([0,1,3,7,6,4]);N([4,5,7,6,2,0]);N([4,5,7,6,0,0]);N([4,
5,1,3,7,6]);N([0,2,3,7,5,4]);N([6,2,3,7,5,4]);N([6,2,3,1,5,4]);return J})(),D=f.create(),F=f.create(),E=f.create(),K=r.create();a.ObbArray=function(J){this.buffer=new ArrayBuffer(56*J);this.obbs=Array(J);for(let M=0;M<J;M++)this.obbs[M]={center:f.createView(this.buffer,56*M),halfSize:d.createView(this.buffer,56*M+24),quaternion:n.createView(this.buffer,56*M+36)}};a.clone=function(J){return k(J.center,J.halfSize,J.quaternion)};a.compute=function(J,M){M=M||k();q.computeOBB(J,M);return M};a.computeOffsetObb=
function(J,M,N,P,I){t.copy(I.quaternion,J.quaternion);if(P===v.ViewingMode.Global){t.conjugate(K,J.quaternion);m.transformQuat(D,J.center,K);m.abs(F,D);m.min(E,F,J.halfSize);m.sub(E,F,E);P=m.length(E);m.add(E,F,J.halfSize);const G=m.length(E);P<N?(m.copy(I.center,J.center),m.set(D,N,N,N),m.add(I.halfSize,J.halfSize,D)):(M=0<G?1+M/G:1,P=0<P?1+N/P:1,N=(P+M)/2,M=(P-M)/2,m.scale(I.halfSize,F,M),m.scaleAndAdd(I.halfSize,I.halfSize,J.halfSize,N),m.scale(I.center,F,N),m.scaleAndAdd(I.center,I.center,J.halfSize,
M),m.sign(D,D),m.multiply(I.center,I.center,D),m.transformQuat(I.center,I.center,I.quaternion))}else P=m.set(D,0,0,1),m.scaleAndAdd(I.center,J.center,P,(N+M)/2),t.conjugate(K,J.quaternion),m.transformQuat(P,P,K),m.abs(P,P),m.scaleAndAdd(I.halfSize,J.halfSize,P,(N-M)/2);return I};a.corners=function(J,M){for(let N=0;8>N;++N){const P=M[N];P[0]=N&1?-J.halfSize[0]:J.halfSize[0];P[1]=N&2?-J.halfSize[1]:J.halfSize[1];P[2]=N&4?-J.halfSize[2]:J.halfSize[2];m.transformQuat(P,P,J.quaternion);m.add(P,P,J.center)}};
a.create=k;a.intersectLine=function(J,M,N,P=0){t.conjugate(C,J.quaternion);m.subtract(B,M,J.center);M=m.transformQuat(B,B,C);N=m.transformQuat(A,N,C);let I=-Infinity,G=Infinity;for(let H=0;3>H;H++)if(1E-6<Math.abs(N[H])){const L=(P+J.halfSize[H]-M[H])/N[H],O=(-P-J.halfSize[H]-M[H])/N[H];I=Math.max(I,Math.min(L,O));G=Math.min(G,Math.max(L,O))}else if(M[H]>J.halfSize[H]+P||M[H]<-J.halfSize[H]-P)return!1;return I<=G};a.intersectPlane=p;a.isVisible=function(J,M){return 0>=p(J,M[0])&&0>=p(J,M[1])&&0>=
p(J,M[2])&&0>=p(J,M[3])&&0>=p(J,M[4])&&0>=p(J,M[5])};a.maximumDistancePlane=function(J,M){const N=l.signedDistance(M,J.center);J=z(J,l.normal(M));return N+J};a.minimumDistancePlane=function(J,M){const N=l.signedDistance(M,J.center);J=z(J,l.normal(M));return N-J};a.projectedArea=function(J,M,N,P,I){t.conjugate(C,J.quaternion);m.sub(B,M,J.center);m.transformQuat(B,B,C);var G=B[0]<-J.halfSize[0]?-1:B[0]>J.halfSize[0]?1:0,H=B[1]<-J.halfSize[1]?-1:B[1]>J.halfSize[1]?1:0,L=B[2]<-J.halfSize[2]?-1:B[2]>J.halfSize[2]?
1:0;M=Math.abs(G)+Math.abs(H)+Math.abs(L);if(0===M)return Infinity;M=1===M?4:6;G=6*(G+3*H+9*L+13);c.fromQuat(u,J.quaternion);c.scale(u,u,J.halfSize);for(H=0;H<M;H++)L=w[G+H],m.set(B,((L&1)<<1)-1,(L&2)-1,((L&4)>>1)-1),m.transformMat3(B,B,u),m.add(x,J.center,B),x[3]=1,e.transformMat4(x,x,N),L=1/Math.max(1E-6,x[3]),y[2*H]=x[0]*L,y[2*H+1]=x[1]*L;J=2*M-2;N=y[0]*(y[3]-y[J+1])+y[J]*(y[1]-y[J-1]);for(M=2;M<J;M+=2)N+=y[M]*(y[M+3]-y[M-1]);return Math.abs(N)*P*I*.125};a.projectedRadius=z;a.radius=function(J){return m.len(J.halfSize)};
a.set=function(J,M){m.copy(M.center,J.center);m.copy(M.halfSize,J.halfSize);t.copy(M.quaternion,J.quaternion)};a.toAaBoundingBox=function(J,M){M||(M=h.create());var N=c.fromQuat(u,J.quaternion);const P=J.halfSize[0]*Math.abs(N[0])+J.halfSize[1]*Math.abs(N[3])+J.halfSize[2]*Math.abs(N[6]),I=J.halfSize[0]*Math.abs(N[1])+J.halfSize[1]*Math.abs(N[4])+J.halfSize[2]*Math.abs(N[7]);N=J.halfSize[0]*Math.abs(N[2])+J.halfSize[1]*Math.abs(N[5])+J.halfSize[2]*Math.abs(N[8]);M[0]=J.center[0]-P;M[1]=J.center[1]-
I;M[2]=J.center[2]-N;M[3]=J.center[0]+P;M[4]=J.center[1]+I;M[5]=J.center[2]+N;return M};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function c(){const m=new Float32Array(4);m[3]=1;return m}function b(m){const d=new Float32Array(4);d[0]=m[0];d[1]=m[1];d[2]=m[2];d[3]=m[3];return d}function t(m,d,f,e){const g=new Float32Array(4);g[0]=m;g[1]=d;g[2]=f;g[3]=e;return g}function n(m,d){return new Float32Array(m,d,4)}const r=
Object.freeze(Object.defineProperty({__proto__:null,clone:b,create:c,createView:n,fromValues:t},Symbol.toStringTag,{value:"Module"}));a.clone=b;a.create=c;a.createView=n;a.fromValues=t;a.quatf32=r})},"esri/views/3d/support/dito":function(){define(["exports","../webgl-engine/lib/Attribute"],function(a,c){function b(T,U,Y,ba,da,ea){if(!(1E-6>U[0]*U[0]+U[1]*U[1]+U[2]*U[2]))for(l(E,Y,U),l(K,ba,U),l(J,da,U),t(T,U,F),N[1]=F[0],M[1]=F[1],P[1]=M[1]-N[1],Y=[Y,ba,da],ba=[E,K,J],da=0;3>da;++da){t(T,Y[da],F);
N[0]=F[0];M[0]=F[1];t(T,ba[da],F);N[2]=F[0];M[2]=F[1];P[0]=M[0]-N[0];P[2]=M[2]-N[2];const ca=d(P);ca<ea.quality&&(h(ea.b0,Y[da]),h(ea.b1,U),h(ea.b2,ba[da]),ea.quality=ca)}}function t(T,U,Y){const {data:ba,size:da}=T;Y[0]=Number.POSITIVE_INFINITY;Y[1]=Number.NEGATIVE_INFINITY;for(T=0;T<ba.length;T+=da){const ea=ba[T]*U[0]+ba[T+1]*U[1]+ba[T+2]*U[2];Y[0]=Math.min(Y[0],ea);Y[1]=Math.max(Y[1],ea)}}function n(T,U,Y){h(Y.center,T);g(Y.halfSize,U,.5);Y.quaternion[0]=0;Y.quaternion[1]=0;Y.quaternion[2]=0;
Y.quaternion[3]=1}function r(T,U,Y,ba,da,ea){t(T,U,F);da[0]=F[0];ea[0]=F[1];t(T,Y,F);da[1]=F[0];ea[1]=F[1];t(T,ba,F);da[2]=F[0];ea[2]=F[1]}function m(T,U,Y,ba,da,ea,ca){V[0]=T[0];V[1]=T[1];V[2]=T[2];V[3]=U[0];V[4]=U[1];V[5]=U[2];V[6]=Y[0];V[7]=Y[1];V[8]=Y[2];var ja=ca.quaternion,ia=V,Z=ia[0]+ia[4]+ia[8];if(0<Z)Z=Math.sqrt(Z+1),ja[3]=.5*Z,Z=.5/Z,ja[0]=(ia[5]-ia[7])*Z,ja[1]=(ia[6]-ia[2])*Z,ja[2]=(ia[1]-ia[3])*Z;else{Z=0;ia[4]>ia[0]&&(Z=1);ia[8]>ia[3*Z+Z]&&(Z=2);const ha=(Z+1)%3,fa=(Z+2)%3;let ka=Math.sqrt(ia[3*
Z+Z]-ia[3*ha+ha]-ia[3*fa+fa]+1);ja[Z]=.5*ka;ka=.5/ka;ja[3]=(ia[3*ha+fa]-ia[3*fa+ha])*ka;ja[ha]=(ia[3*ha+Z]+ia[3*Z+ha])*ka;ja[fa]=(ia[3*fa+Z]+ia[3*Z+fa])*ka}f(aa,ba,da);g(aa,aa,.5);g(ca.center,T,aa[0]);g(Q,U,aa[1]);f(ca.center,ca.center,Q);g(Q,Y,aa[2]);f(ca.center,ca.center,Q);g(ca.halfSize,ea,.5)}function d(T){return T[0]*T[1]+T[0]*T[2]+T[1]*T[2]}function f(T,U,Y){T[0]=U[0]+Y[0];T[1]=U[1]+Y[1];T[2]=U[2]+Y[2]}function e(T,U,Y){T[0]=U[0]-Y[0];T[1]=U[1]-Y[1];T[2]=U[2]-Y[2]}function g(T,U,Y){T[0]=U[0]*
Y;T[1]=U[1]*Y;T[2]=U[2]*Y}function h(T,U,Y=0){T[0]=U[Y+0];T[1]=U[Y+1];T[2]=U[Y+2]}function l(T,U,Y){const ba=U[0],da=U[1];U=U[2];const ea=Y[0],ca=Y[1];Y=Y[2];T[0]=da*Y-U*ca;T[1]=U*ea-ba*Y;T[2]=ba*ca-da*ea}function v(T,U){var Y=U[0]*U[0]+U[1]*U[1]+U[2]*U[2];0<Y&&(Y=1/Math.sqrt(Y),T[0]=U[0]*Y,T[1]=U[1]*Y,T[2]=U[2]*Y)}function q(T,U){const Y=U[0]-T[0],ba=U[1]-T[1];T=U[2]-T[2];return Y*Y+ba*ba+T*T}const k=[0,0,0],p=[0,0,0],z=[0,0,0],C=[0,0,0],B=[0,0,0],A=[0,0,0],x=[0,0,0],u=[0,0,0],y=[0,0,0],w=[0,0,0],
D=[0,0,0],F=[0,0],E=[0,0,0],K=[0,0,0],J=[0,0,0],M=[0,0,0],N=[0,0,0],P=[0,0,0],I=[0,0,0],G=[0,0,0],H=[0,0,0],L=[0,0,0],O=[0,0,0],S=[0,0,0],R=[0,0,0],Q=[0,0,0],V=[1,0,0,0,1,0,0,0,1],aa=[0,0,0];let X=function(T){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var U=0;this.minProj=new Float64Array(this.buffer,U,7);U+=56;this.maxProj=new Float64Array(this.buffer,U,7);U+=56;for(var Y=0;7>Y;++Y)this.minVert[Y]=new Float64Array(this.buffer,U,3),U+=24;for(Y=0;7>Y;++Y)this.maxVert[Y]=
new Float64Array(this.buffer,U,3),U+=24;for(U=0;7>U;++U)this.minProj[U]=Number.POSITIVE_INFINITY,this.maxProj[U]=Number.NEGATIVE_INFINITY;U=Array(7);Y=Array(7);const {data:ba,size:da}=T;for(T=0;T<ba.length;T+=da){var ea=ba[T];ea<this.minProj[0]&&(this.minProj[0]=ea,U[0]=T);ea>this.maxProj[0]&&(this.maxProj[0]=ea,Y[0]=T);ea=ba[T+1];ea<this.minProj[1]&&(this.minProj[1]=ea,U[1]=T);ea>this.maxProj[1]&&(this.maxProj[1]=ea,Y[1]=T);ea=ba[T+2];ea<this.minProj[2]&&(this.minProj[2]=ea,U[2]=T);ea>this.maxProj[2]&&
(this.maxProj[2]=ea,Y[2]=T);ea=ba[T]+ba[T+1]+ba[T+2];ea<this.minProj[3]&&(this.minProj[3]=ea,U[3]=T);ea>this.maxProj[3]&&(this.maxProj[3]=ea,Y[3]=T);ea=ba[T]+ba[T+1]-ba[T+2];ea<this.minProj[4]&&(this.minProj[4]=ea,U[4]=T);ea>this.maxProj[4]&&(this.maxProj[4]=ea,Y[4]=T);ea=ba[T]-ba[T+1]+ba[T+2];ea<this.minProj[5]&&(this.minProj[5]=ea,U[5]=T);ea>this.maxProj[5]&&(this.maxProj[5]=ea,Y[5]=T);ea=ba[T]-ba[T+1]-ba[T+2];ea<this.minProj[6]&&(this.minProj[6]=ea,U[6]=T);ea>this.maxProj[6]&&(this.maxProj[6]=
ea,Y[6]=T)}for(T=0;7>T;++T)ea=U[T],h(this.minVert[T],ba,ea),ea=Y[T],h(this.maxVert[T],ba,ea)},W=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};a.computeOBB=function(T,U){const {data:Y,size:ba}=T;var da=Y.length/ba;if(!(0>=da)){var ea=new X(T);f(k,ea.minProj,ea.maxProj);g(k,k,.5);e(p,ea.maxProj,ea.minProj);var ca=d(p),ja=new W;ja.quality=ca;14>da&&(T=new c.Attribute(new Float64Array(ea.buffer,112,42),3));var ia=[0,0,0],Z=[0,0,0],ha=[0,0,0];da=[0,0,0];var fa=[0,0,0],ka=[0,
0,0],la=[0,0,0];var na=T;var pa=q(ea.maxVert[0],ea.minVert[0]),va=0;for(var wa=1;7>wa;++wa){const ua=q(ea.maxVert[wa],ea.minVert[wa]);ua>pa&&(pa=ua,va=wa)}h(ia,ea.minVert[va]);h(Z,ea.maxVert[va]);if(1E-6>q(ia,Z))na=1;else{e(da,ia,Z);v(da,da);const {data:ua,size:oa}=na;ea=Number.NEGATIVE_INFINITY;pa=0;for(va=0;va<ua.length;va+=oa)D[0]=ua[va]-ia[0],D[1]=ua[va+1]-ia[1],D[2]=ua[va+2]-ia[2],wa=da[0]*D[0]+da[1]*D[1]+da[2]*D[2],wa=D[0]*D[0]+D[1]*D[1]+D[2]*D[2]-wa*wa/(da[0]*da[0]+da[1]*da[1]+da[2]*da[2]),
wa>ea&&(ea=wa,pa=va);h(ha,ua,pa);1E-6>ea?na=2:(e(fa,Z,ha),v(fa,fa),e(ka,ha,ia),v(ka,ka),l(la,fa,da),v(la,la),b(na,la,da,fa,ka,ja),na=0)}switch(na){case 1:n(k,p,U);return;case 2:ca=T;h(G,da);Math.abs(da[0])>Math.abs(da[1])&&Math.abs(da[0])>Math.abs(da[2])?G[0]=0:Math.abs(da[1])>Math.abs(da[2])?G[1]=0:G[2]=0;1E-6>G[0]*G[0]+G[1]*G[1]+G[2]*G[2]&&(G[0]=G[1]=G[2]=1);l(H,da,G);v(H,H);l(L,da,H);v(L,L);r(ca,da,H,L,O,S);e(R,S,O);m(da,H,L,O,S,R,U);return}na=T;ea=F;const {data:za,size:sa}=na;h(C,za);h(z,C);ea[0]=
I[0]*la[0]+I[1]*la[1]+I[2]*la[2];ea[1]=ea[0];for(pa=sa;pa<za.length;pa+=sa)va=za[pa]*la[0]+za[pa+1]*la[1]+za[pa+2]*la[2],va<ea[0]&&(ea[0]=va,h(C,za,pa)),va>ea[1]&&(ea[1]=va,h(z,za,pa));la=ia[0]*la[0]+ia[1]*la[1]+ia[2]*la[2];F[1]-1E-6<=la&&(z[0]=void 0);F[0]+1E-6>=la&&(C[0]=void 0);void 0!==z[0]&&(e(B,z,ia),v(B,B),e(A,z,Z),v(A,A),e(x,z,ha),v(x,x),l(u,A,da),v(u,u),l(y,x,fa),v(y,y),l(w,B,ka),v(w,w),b(na,u,da,A,B,ja),b(na,y,fa,x,A,ja),b(na,w,ka,B,x,ja));void 0!==C[0]&&(e(B,C,ia),v(B,B),e(A,C,Z),v(A,A),
e(x,C,ha),v(x,x),l(u,A,da),v(u,u),l(y,x,fa),v(y,y),l(w,B,ka),v(w,w),b(na,u,da,A,B,ja),b(na,y,fa,x,A,ja),b(na,w,ka,B,x,ja));r(T,ja.b0,ja.b1,ja.b2,O,S);T=[0,0,0];e(T,S,O);ja.quality=d(T);ja.quality<ca?m(ja.b0,ja.b1,ja.b2,O,S,T,U):n(k,p,U)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","./IndexRange/ComponentRangeRunLengthEncoded"],
function(a,c,b){function t(n,r,m){const d=[],f=[];let e=m.length,g=m.length;r.forEachComponent(h=>{0<n[h]?(e!==h-1&&(d.length&&d.push(m[e+1]-d[d.length-1]),d.push(m[h])),e=h):(g!==h-1&&(f.length&&f.push(m[g+1]-f[f.length-1]),f.push(m[h])),g=h);return!0});d.length&&d.push(m[e+1]-d[d.length-1]);f.length&&f.push(m[g+1]-f[f.length-1]);return{highlightRanges:d,defaultRanges:f}}return function(){function n(m,d){this.cachedDefaultRanges=this.cachedHighlightRanges=this.cachedGeometryRanges=this.verticalOffsets=
this.highlightCounts=this.pickability=null;this.offsets=d.slice();d=this.count;this.visibility=new b.ComponentRangeRunLengthEncoded(d);this.materialDataBuffer=m.getBuffer(d);this.materialDataIndices=new Uint16Array(d);for(m=0;m<d;m++)this.materialDataIndices[m]=this.materialDataBuffer.acquireIndex()}var r=n.prototype;r.destroy=function(){for(let m=0;m<this.count;m++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[m])};r.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=
null};r.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};r._updateCachedHighlightRanges=function(){if((c.isNone(this.cachedHighlightRanges)||c.isNone(this.cachedDefaultRanges))&&c.isSome(this.highlightCounts)){const {highlightRanges:m,defaultRanges:d}=t(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=m;this.cachedDefaultRanges=d}};a._createClass(n,[{key:"count",get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){c.isNone(this.cachedGeometryRanges)&&
(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",get:function(){if(c.isNone(this.highlightCounts))return null;this._updateCachedHighlightRanges();return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",get:function(){if(c.isNone(this.highlightCounts))return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}}]);return n}()})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],
function(a){let c=function(){function b(n){this._totalCount=n;this._indexRanges=[0,n]}var t=b.prototype;t.allVisible=function(){return this.componentCount()===this._totalCount};t.allInvisible=function(){return 0===this._indexRanges.length};t.componentCount=function(){const n=this._indexRanges;let r=0;for(let m=0;m<n.length;m+=2)r+=n[m+1];return r};t.reset=function(n){if("all"===n||n.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{{const d=[];if(0!==n.length){var r=n[0],m=1;for(let f=
1;f<n.length;f++){const e=n[f];r+m===e?m+=1:(d.push(r),d.push(m),r=e,m=1)}d.push(r);d.push(m)}n=d}this._indexRanges=n}};t.forEachComponent=function(n){const r=this._indexRanges;for(let d=0;d<r.length;d+=2){var m=r[d];const f=m+r[d+1];for(;m<f;m++)if(!n(m))return!1}return!0};t.forEachComponentRange=function(n){const r=this._indexRanges;for(let m=0;m<r.length;m+=2){const d=r[m];if(!n(d,d+r[m+1]))return!1}return!0};t.computeOffsetRanges=function(n){const r=Array(this._indexRanges.length),m=this._indexRanges;
for(let f=0;f<m.length;f+=2){var d=m[f];const e=n[d];d=n[d+m[f+1]];r[f]=e;r[f+1]=d-e}return r};return b}();a.ComponentRangeRunLengthEncoded=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d){a.ComponentObject=function(f){function e(){var g=f.apply(this,arguments)||this;g.visible=a.State.Hidden;return g}c._inheritsLoose(e,f);return e}(t);b.__decorate([n.property({autoDestroy:!0})],a.ComponentObject.prototype,"renderable",void 0);b.__decorate([n.property({autoDestroy:!0})],a.ComponentObject.prototype,"components",void 0);a.ComponentObject=b.__decorate([d.subclass("esri.views.3d.webgl-engine.collections.Component.ComponentObject")],a.ComponentObject);a.State=void 0;
(function(f){f[f.Hidden=0]="Hidden";f[f.Visible=1]="Visible"})(a.State||(a.State={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/buffer/BufferView ./ComponentIntersectionData ../../lib/Attribute ../../lib/ComponentUtils ../../lib/Indices ../../materials/internal/MaterialUtil".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){let h=function(){function q(p,z){this._indices=c.isSome(p.indices)?p.indices:e.generateDefaultIndexArray(p.positions.length/3);this._positions=new r.BufferViewVec3f(p.positions);this._components=z;this._componentIntersectionData=Array(z.count)}var k=q.prototype;k.getComponentAabb=function(p,z){if(c.isSome(this._perComponentAabbs)){for(let C=0;6>C;C++)z[C]=this._perComponentAabbs[6*p+C];return z}this._computePerComponentAabbs();return this.getComponentAabb(p,z)};k.getComponentPositions=
function(p,z){z.indices=this._indices;z.data=this._positions.typedBuffer;z.stride=this._positions.typedBufferStride;z.startIndex=this._components.offsets[p];z.endIndex=this._components.offsets[p+1]};k.intersect=function(p,z,C,B,A,x,u){const y=new d.Attribute(this._positions.typedBuffer,3,!1,this._positions.typedBufferStride),w=this._indices,D=this._components.offsets,F=g.computeInvDir(p,z,l),E=p[2],K=z[2];this._components.visibility.forEachComponent(J=>{if(!f.getVisibility(this._components.pickability,
J))return!0;var M=this.getComponentAabb(J,v);if(c.isSome(x)){var N=x[J];c.isSome(A)?A.componentOffset=N:(p[2]=E-N,z[2]=K-N)}c.isSome(A)&&A.applyToAabb(M);if(!g.intersectAabbInvDir(M,p,F,C))return!0;M=D[J]/3;N=D[J+1]/3;const P=N-M,I=(G,H,L)=>u(J,G,b.transformMat3(H,H,B),L);c.isNone(A)&&P>m.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[J]&&(this._componentIntersectionData[J]=new m.ComponentIntersectionData(this._indices,M,N,y)),this._componentIntersectionData[J].intersectRay({r0:p,
r1:z},I)):g.intersectTriangles(p,z,M,N,w,y,void 0,A,I);return!0})};k._computePerComponentAabbs=function(){const p=this._components.count;this._perComponentAabbs=new Float32Array(6*p);const z=this._indices,C=this._positions.typedBuffer,B=this._positions.typedBufferStride,A=this._components.offsets;let x=0;for(let w=0;w<p;w++){var u=A[w];const D=A[w+1];let F=Infinity,E=Infinity,K=Infinity,J=-Infinity,M=-Infinity,N=-Infinity;for(;u<D;u++){var y=z[u]*B;const P=C[y],I=C[y+1];y=C[y+2];F=Math.min(F,P);E=
Math.min(E,I);K=Math.min(K,y);J=Math.max(J,P);M=Math.max(M,I);N=Math.max(N,y)}this._perComponentAabbs[x++]=F;this._perComponentAabbs[x++]=E;this._perComponentAabbs[x++]=K;this._perComponentAabbs[x++]=J;this._perComponentAabbs[x++]=M;this._perComponentAabbs[x++]=N}};a._createClass(q,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return q}();const l=t.create(),v=n.create();return h})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],
function(a){function c(b=!0){return{isVisibleBit:!b,data:new Uint32Array(0)}}a.defaultVisibilities=c;a.getVisibility=function(b,t){if(null==b)return!0;const {isVisibleBit:n,data:r}=b,m=8*r.BYTES_PER_ELEMENT;return t<r.length*m?(b=t/m|0,0!==(r[b]&1<<t-b*m)===n):!b.isVisibleBit};a.updateVisibilityWithCount=function(b,t,n,r){if(n>=t)return b;null==b&&(b=c());let m=b.data;const d=8*m.BYTES_PER_ELEMENT,f=n/d|0,e=n-d*f,g=m;r=r===b.isVisibleBit;n<g.length*d||!r||(n=Math.max(f+1,Math.ceil(1.5*g.length)),
n=Math.min(n,((t-1)/d|0)+1),m=new Uint32Array(n),m.set(g));f<m.length&&(m[f]=m[f]&~(1<<e)|(r?1:0)<<e);b.data=m;return b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(a){let c=function(){function b(t,n,r){this.material=t;this.geometry=n;this.meta=r}b.prototype.destroy=function(){this.material.dispose();this.geometry.dispose()};return b}();a.Renderable=c;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports"],function(a){let c=function(){function b(t,n,r,m){this.vao=t;this.primitiveType=n;this.parameters=r;this.indexed=m}b.prototype.dispose=function(){this.vao.dispose()};return b}();a.RenderGeometry=c;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,
c){let b=function(){function t(r){this._objects=r}var n=t.prototype;n.submit=function(r,m){this._objects.preSubmit(m);this._objects.visibleObjects.forAll(d=>d.renderable.material.submit(r,m,d))};n.queryShadowCasterDepthRange=function(r){return this._objects.visibleObjects.length?c.computeDepthRange(r,this._objects.visibleObjects):null};return t}();a.RenderSubmitSystem=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(J,M,N){return d.set(J,M.data[N+0],M.data[N+1],M.data[N+2])}function v(J,M){J.push(M[0]);J.push(M[1]);J.push(M[2])}function q(J,M,N,P){r.conjugate(y,J.quaternion);d.sub(w,M,J.center);d.transformQuat(w,w,y);const I=8*((w[0]<-J.halfSize[0]?-1:w[0]>J.halfSize[0]?1:0)+3*(w[1]<-J.halfSize[1]?-1:w[1]>J.halfSize[1]?1:0)+9*(w[2]<-J.halfSize[2]?-1:w[2]>J.halfSize[2]?1:0)+13);M=x[I];if(0===M)return M;t.fromQuat(u,J.quaternion);t.scale(u,u,J.halfSize);const G=(H,L)=>
{L=x[I+L+1];d.set(H,((L&1)<<1)-1,(L&2)-1,((L&4)>>1)-1);d.transformMat3(H,H,u);return d.add(H,J.center,H)};N.length=0;v(N,G(D,0));v(N,G(F,1));v(N,G(w,2));v(N,G(E,3));P(N);if(1===M)return M;N.length=0;v(N,D);v(N,E);v(N,G(w,4));v(N,G(K,5));P(N);if(2===M)return M;N.length=0;v(N,D);v(N,K);v(N,G(w,6));v(N,F);P(N);return M}const k=new b({allocator:J=>J||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:J=>{J.object=c.nullifyNonNullableForDispose(J.object);return J}}),p=h.empty(),z=f.create(),
C=f.create(),B=new b({deallocator:null}),A=new b({deallocator:null}),x=(()=>{const J=new Int8Array(216);let M=0;const N=P=>{for(let I=0;I<P.length;I++)J[M+I]=P[I];M+=8};N([3,0,6,2,3,1,5,4]);N([2,0,2,3,1,5,4,0]);N([3,1,0,2,3,7,5,4]);N([2,0,1,3,2,6,4,0]);N([1,0,1,3,2,0,0,0]);N([2,1,5,7,3,2,0,0]);N([3,2,0,1,3,7,6,4]);N([2,2,0,1,3,7,6,0]);N([3,3,0,1,5,7,6,2]);N([2,0,1,5,4,6,2,0]);N([1,0,1,5,4,0,0,0]);N([2,1,3,7,5,4,0,0]);N([1,0,2,6,4,0,0,0]);N([0,0,0,0,0,0,0,0]);N([1,1,3,7,5,0,0,0]);N([2,2,3,7,6,4,0,
0]);N([1,2,3,7,6,0,0,0]);N([2,3,1,5,7,6,2,0]);N([3,4,0,1,5,7,6,2]);N([2,5,7,6,4,0,1,0]);N([3,5,0,1,3,7,6,4]);N([2,4,5,7,6,2,0,0]);N([1,4,5,7,6,0,0,0]);N([2,5,1,3,7,6,4,0]);N([3,6,0,2,3,7,5,4]);N([2,6,2,3,7,5,4,0]);N([3,7,6,2,3,1,5,4]);return J})(),u=n.create(),y=m.create(),w=f.create(),D=f.create(),F=f.create(),E=f.create(),K=f.create();a.computeDepthRange=function(J,M){const N=h.empty(),{eye:P,frustum:I,viewForward:G}=J;M.forAll(H=>{var L=c.isSome(H.offsetObb)?H.offsetObb:H.obb;const O=d.dot(d.sub(w,
L.center,P),G),S=g.projectedRadius(L,G);if(!h.within(N,O-S)||!h.within(N,O+S)){a:{var R=0;for(let Q=0;4>Q;Q++){const V=g.intersectPlane(L,I[Q]);if(0<V){L=-1;break a}0===V&&(R|=1<<Q)}L=R}-1!==L&&(0===L?(p.far=O+S,p.near=O-S,h.union(N,p)):(R=k.pushNew(),R.near=O-S,R.far=O+S,R.mask=L,R.object=H))}});for(J=0;J<k.length;J++){const H=k.data[J];h.within(N,H.near)&&h.within(N,H.far)||(p.far=H.far,p.near=Infinity,M=c.isSome(H.object.offsetObb)?H.object.offsetObb:H.object.obb,0===q(M,P,B,L=>{var O=A;for(var S=
0;4>S&&0<L.length;S++){if(0===(H.mask&1<<S))continue;var R=I[S],Q=L,V=O;V.length=0;const aa=Q.length-3;l(z,Q,aa);const X=e.signedDistance(R,z);0>=X&&(V.push(z[0]),V.push(z[1]),V.push(z[2]));let W=0,T=X;for(W;W<aa;W+=3){l(C,Q,W);const U=e.signedDistance(R,C);0>T*U&&(d.lerp(z,C,z,U/(U-T)),v(V,z));0>=U&&v(V,C);T=U;d.copy(z,C)}0>T*X&&(l(C,Q,aa),d.lerp(z,C,z,X/(X-T)),v(V,z));R=L;L=O;O=R}for(O=0;O<L.length;O+=3)d.set(z,L.data[O+0],L.data[O+1],L.data[O+2]),S=d.dot(d.sub(z,z,P),G),p.near=Math.min(p.near,
S)})&&(p.near=0),h.union(N,p))}k.length=0;return N};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(a){function c(t,n){return{near:t,far:n}}function b(t,n,r){t.near=n;t.far=r;return t}a.DepthRange=function(){this.near=Number.MAX_VALUE;this.far=-Number.MAX_VALUE};a.ZERO={near:0,far:0};a.create=c;a.empty=function(t){return t?b(t,Infinity,-Infinity):c(Infinity,-Infinity)};a.set=b;a.union=function(t,n,r=
t){null!=n&&(r.near=Math.min(t.near,n.near),r.far=Math.max(t.far,n.far));return r};a.within=function(t,n){return t.near<=n&&n<=t.far};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,c,b,t){a.createVertexBufferLayout=function(n){const r=
c.newLayout().vec3f(t.VertexAttribute.POSITION);n.normals&&r.vec2i16(t.VertexAttribute.NORMALCOMPRESSED,{glNormalized:!0});n.textureCoordinates===b.TextureCoordinateAttributeType.Default?r.vec2f(t.VertexAttribute.UV0):n.textureCoordinates===b.TextureCoordinateAttributeType.Atlas&&(r.vec2f(t.VertexAttribute.UV0),r.vec4u16(t.VertexAttribute.UVREGION,{glNormalized:!0}));n.colors&&r.vec4u8(t.VertexAttribute.COLOR,{glNormalized:!0});return r.alignTo(4)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/collections/Component/UniformComponentParameters":function(){define(["exports","../../../../../chunks/vec4f64","../../../layers/support/symbolColorUtils"],function(a,c,b){a.UniformComponentParameters=function(){this.externalColor=c.create();this.externalColorMixMode=b.ColorMixModeEnum.Multiply;this.pickable=this.castShadows=!0;this.elevationOffset=0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f32 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../../../chunks/vec4f64 ../../../../layers/support/symbolColorUtils ../../../../support/debugFlags ../../../../terrain/interfaces ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J){let M=function(G){function H(O,S){var R=G.call(this)||this;R.toMapSpace=S;R.baseColor=e.fromValues(1,1,1,1);R.usePBR=!1;R.hasParametersFromSource=!1;R.mrrFactors=d.fromValues(1,1,.5);R.emissiveFactor=d.fromValues(0,0,0);R.baseColorTexture=null;R.metallicRoughnessTexture=null;R.emissionTexture=null;R.occlusionTexture=null;R.normalTexture=null;R.objectOpacity=1;R.commonMaterialParameters=new P;R.componentParameters=new I;R.textureAlphaCutoff=
D.defaultMaskAlphaCutoff;R.alphaDiscardMode=K.AlphaDiscardMode.Opaque;R.isIntegratedMesh=!1;R.polygonOffsetEnabled=!1;R.ellipsoidMode=F.EllipsoidMode.Earth;R.hasOccludees=!1;R._techniqueConfiguration=new k.ComponentTechniqueConfiguration;S=new E.TwoVectorPosition(O.position);const Q=r.clone(O.rotationScale);n.invert(Q,Q);R.transformNormalGlobalFromModel=n.transpose(Q,Q);R.transformWorldFromModelTL=S.low;R.transformWorldFromModelTH=S.high;R.transformWorldFromModelRS=O.rotationScale;return R}c._inheritsLoose(H,
G);var L=H.prototype;L.dispose=function(){this._technique=t.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};L.prepareTechnique=function(O,S,R,Q){const V=this._techniqueConfiguration;V.hasVertexColors=Q.colors;V.hasNormals=Q.normals;V.textureCoordinateType=Q.textureCoordinates;V.hasMetallicRoughnessTexture=t.isSome(this.metallicRoughnessTexture);V.hasEmissionTexture=t.isSome(this.emissionTexture);
V.hasOcclusionTexture=t.isSome(this.occlusionTexture);V.hasNormalTexture=t.isSome(this.normalTexture);V.transparencyPassType=S.identifier===A.RenderPassIdentifier.Material&&null!=R.transparencyPassType?R.transparencyPassType:J.TransparencyPassType.NONE;V.hasMultipassTerrain=S.identifier===A.RenderPassIdentifier.Material&&null!=R.multipassTerrain?R.multipassTerrain.enabled:!1;V.cullAboveGround=S.identifier===A.RenderPassIdentifier.Material&&null!=R.multipassTerrain?R.multipassTerrain.cullAboveGround:
!1;V.ellipsoidMode=this.ellipsoidMode;V.componentData=this.componentParameters.type;V.cullFace=this.commonMaterialParameters.cullFace;V.doubleSidedMode=this.commonMaterialParameters.doubleSided?y.NormalsDoubleSidedMode.View:y.NormalsDoubleSidedMode.None;V.hasBaseColorTexture=t.isSome(this.baseColorTexture);Q=this._computeWhichMaterialPass();V.blendingEnabled=Q===N.Transparent||Q===N.OpaqueAndTransparent;V.alphaDiscardMode=this.alphaDiscardMode;V.integratedMeshMode=this.isIntegratedMesh?(0===R.overlays.length?
0:t.isSome(R.overlays[v.OverlayIndex.INNER].getColorTextureNoRasterImage()))?z.getOverlayNormalTexture(R)?k.IntegratedMeshMode.ColorOverlayWithWater:k.IntegratedMeshMode.ColorOverlay:k.IntegratedMeshMode.NoOverlay:k.IntegratedMeshMode.None;V.useLegacyTerrainShading=this.isIntegratedMesh&&l.TERRAIN_USE_LEGACY_SHADING;V.hasPolygonOffset=this.polygonOffsetEnabled;Q=this.hasParametersFromSource&&t.isNone(this.baseColorTexture);V.pbrMode=V.integratedMeshMode===k.IntegratedMeshMode.ColorOverlayWithWater?
w.PBRMode.WaterOnIntegratedMesh:this.usePBR?Q?w.PBRMode.Schematic:w.PBRMode.Normal:w.PBRMode.Disabled;V.normalType=V.integratedMeshMode===k.IntegratedMeshMode.None?V.hasNormals?u.NormalAttributeType.CompressedAttribute:u.NormalAttributeType.ScreenDerivative:u.NormalAttributeType.Ground;V.hasSlicePlane=t.isSome(R.slicePlane)&&this.commonMaterialParameters.hasSlicePlane;if(S.identifier===A.RenderPassIdentifier.ShadowMap)V.output=x.ShaderOutput.Shadow,V.vertexDiscardMode=C.VertexDiscardMode.None;else if(S.identifier===
A.RenderPassIdentifier.Highlight)V.output=x.ShaderOutput.Highlight,V.vertexDiscardMode=C.VertexDiscardMode.None;else{this._computeWhichMaterialPass()===N.OpaqueAndTransparent?V.vertexDiscardMode=S.transparent?C.VertexDiscardMode.Opaque:C.VertexDiscardMode.Transparent:V.vertexDiscardMode=C.VertexDiscardMode.None;V.output=S.output;V.receiveAmbientOcclusion=!1;V.receiveShadows=!1;switch(S.output){case x.ShaderOutput.Color:V.receiveAmbientOcclusion=R.ssaoHelper.active;V.hasOccludees=R.hasOccludees;V.receiveShadows=
R.shadowMap.ready;V.hasScreenSpaceReflections=R.ssr.enabled;V.hasCloudsReflections=t.isSome(R.cloudsFade.data);break;case x.ShaderOutput.Alpha:V.hasOccludees=R.hasOccludees;break;case x.ShaderOutput.ObjectAndLayerIdColor:V.objectAndLayerIdColor=!0}V.snowCover=this.hasSnowCover(R)}this._technique=O.releaseAndAcquire(q.ComponentTechnique,V,this._technique);this._setClean();return this._technique};L.hasSnowCover=function(O){return t.isSome(O.weather)&&O.weatherVisible&&"snowy"===O.weather.type&&"enabled"===
O.weather.snowCover};L.submit=function(O,S,R){if(0!==this.objectOpacity){var Q=R.renderable.geometry,V=R.components;R=R.renderable.meta.cameraDepthSquared;var aa=V.geometryRanges,X=V.highlightRanges;V=V.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case N.Opaque:O.materialOpaque.submitDraw(this,Q,aa,R);break;case N.Transparent:O.materialTransparent.submitDraw(this,Q,aa,R);break;case N.OpaqueAndTransparent:O.materialOpaque.submitDraw(this,Q,aa,R);O.materialTransparent.submitDraw(this,
Q,aa,R);break;case N.IntegratedMesh:O.materialIntegratedMesh.submitDraw(this,Q,aa,R),(0===S.overlays.length?0:t.isSome(S.overlays[v.OverlayIndex.INNER].getValidTexture(v.RenderTargetType.Highlight)))&&O.highlightIntegratedMesh.submitDraw(this,Q,aa,R)}(S=this.componentParameters.castShadows!==a.ComponentParameterSummary.None)&&O.shadowMap.submitDraw(this,Q,aa,R);t.isSome(X)&&(O.highlight.submitDraw(this,Q,X,R),S&&O.highlightShadowMap.submitDraw(this,Q,X,R));S&&t.isSome(V)&&O.defaultShadowMap.submitDraw(this,
Q,V,R)}};L._computeWhichMaterialPass=function(){return this.isIntegratedMesh?N.IntegratedMesh:1>this.objectOpacity?N.Transparent:this.componentParameters.opaqueOverride===a.ComponentParameterSummary.All?N.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===K.AlphaDiscardMode.Blend||this.alphaDiscardMode===K.AlphaDiscardMode.MaskBlend?N.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?N.Opaque:this.componentParameters.transparent===a.ComponentParameterSummary.All?
N.Transparent:N.OpaqueAndTransparent};c._createClass(H,[{key:"texture",get:function(){return t.isSome(this.baseColorTexture)?this.baseColorTexture.glTexture:null}},{key:"textureMetallicRoughness",get:function(){return t.isSome(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}},{key:"textureEmissive",get:function(){return t.isSome(this.emissionTexture)?this.emissionTexture.glTexture:null}},{key:"textureOcclusion",get:function(){return t.isSome(this.occlusionTexture)?this.occlusionTexture.glTexture:
null}},{key:"textureNormal",get:function(){return t.isSome(this.normalTexture)?this.normalTexture.glTexture:null}}]);return H}(B.MaterialBase);b.__decorate([B.parameter({vectorOps:f.vec4})],M.prototype,"baseColor",void 0);b.__decorate([B.parameter()],M.prototype,"usePBR",void 0);b.__decorate([B.parameter()],M.prototype,"hasParametersFromSource",void 0);b.__decorate([B.parameter({vectorOps:m.vec3})],M.prototype,"mrrFactors",void 0);b.__decorate([B.parameter({vectorOps:m.vec3})],M.prototype,"emissiveFactor",
void 0);b.__decorate([B.parameter({dispose:!0})],M.prototype,"baseColorTexture",void 0);b.__decorate([B.parameter({dispose:!0})],M.prototype,"metallicRoughnessTexture",void 0);b.__decorate([B.parameter({dispose:!0})],M.prototype,"emissionTexture",void 0);b.__decorate([B.parameter({dispose:!0})],M.prototype,"occlusionTexture",void 0);b.__decorate([B.parameter({dispose:!0})],M.prototype,"normalTexture",void 0);b.__decorate([B.parameter()],M.prototype,"objectOpacity",void 0);b.__decorate([B.parameterBlock()],
M.prototype,"commonMaterialParameters",void 0);b.__decorate([B.parameterBlock()],M.prototype,"componentParameters",void 0);b.__decorate([B.parameter()],M.prototype,"textureAlphaCutoff",void 0);b.__decorate([B.parameter()],M.prototype,"alphaDiscardMode",void 0);b.__decorate([B.parameter()],M.prototype,"isIntegratedMesh",void 0);b.__decorate([B.parameter()],M.prototype,"polygonOffsetEnabled",void 0);b.__decorate([B.parameter()],M.prototype,"ellipsoidMode",void 0);b.__decorate([B.parameter()],M.prototype,
"hasOccludees",void 0);var N;(function(G){G[G.Opaque=0]="Opaque";G[G.Transparent=1]="Transparent";G[G.OpaqueAndTransparent=2]="OpaqueAndTransparent";G[G.IntegratedMesh=3]="IntegratedMesh"})(N||(N={}));let P=function(G){function H(){var L=G.apply(this,arguments)||this;L.doubleSided=!1;L.cullFace=K.CullFaceOptions.Back;L.hasSlicePlane=!0;return L}c._inheritsLoose(H,G);return H}(B.MaterialParameterBlock);b.__decorate([B.parameter()],P.prototype,"doubleSided",void 0);b.__decorate([B.parameter()],P.prototype,
"cullFace",void 0);b.__decorate([B.parameter()],P.prototype,"hasSlicePlane",void 0);let I=function(G){function H(){var L=G.apply(this,arguments)||this;L.externalColor=g.fromValues(1,1,1,1);L.externalColorMixMode=h.ColorMixModeEnum.Multiply;L.castShadows=a.ComponentParameterSummary.All;return L}c._inheritsLoose(H,G);c._createClass(H,[{key:"transparent",get:function(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"opaqueOverride",get:function(){return this.externalColorMixMode===
h.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"visible",get:function(){return 0<this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"type",get:function(){return p.ComponentDataType.Uniform}}]);return H}(B.MaterialParameterBlock);b.__decorate([B.parameter({vectorOps:f.vec4})],I.prototype,"externalColor",void 0);b.__decorate([B.parameter()],I.prototype,"externalColorMixMode",void 0);
b.__decorate([B.parameter()],I.prototype,"castShadows",void 0);a.ComponentParameterSummary=void 0;(function(G){G[G.All=0]="All";G[G.Some=1]="Some";G[G.None=2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));m=function(G){function H(){var L=G.apply(this,arguments)||this;L.texture=null;L.transparent=a.ComponentParameterSummary.None;L.opaqueOverride=a.ComponentParameterSummary.None;L.castShadows=a.ComponentParameterSummary.None;return L}c._inheritsLoose(H,G);c._createClass(H,
[{key:"type",get:function(){return p.ComponentDataType.Varying}}]);return H}(B.MaterialParameterBlock);b.__decorate([B.parameter()],m.prototype,"texture",void 0);b.__decorate([B.parameter()],m.prototype,"transparent",void 0);b.__decorate([B.parameter()],m.prototype,"opaqueOverride",void 0);b.__decorate([B.parameter()],m.prototype,"castShadows",void 0);a.CommonMaterialParameters=P;a.ComponentMaterial=M;a.ComponentParametersUniform=I;a.ComponentParametersVarying=m;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../ViewingMode ./ComponentTechniqueConfiguration ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../lib/TransparencyPassType ../../../lib/VertexAttribute ../../../../../webgl/context-util ../../../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){f=function(C){function B(){return C.apply(this,arguments)||this}b._inheritsLoose(B,C);var A=B.prototype;A.initializeConfiguration=function(x,u){u.hasWebGL2Context=x.rctx.type===k.ContextType.WEBGL2;u.spherical=x.viewingMode===t.ViewingMode.Global;u.doublePrecisionRequiresObfuscation=x.rctx.driverTest.doublePrecisionRequiresObfuscation.result};A.initializeProgram=function(x){return new h.Program(x.rctx,B.shader.get().build(this.configuration),z)};A._setPipelineState=
function(x){const u=this.configuration,y=u.integratedMeshMode!==n.IntegratedMeshMode.None,w=x===v.TransparencyPassType.NONE,D=x===v.TransparencyPassType.FrontFace;return p.makePipelineState({blending:u.output!==m.ShaderOutput.Color&&u.output!==m.ShaderOutput.Alpha||!u.blendingEnabled?null:w?g.blendingDefault:g.oitBlending(x),culling:p.cullingParams(u.cullFace),depthTest:{func:g.oitDepthTest(x)},depthWrite:w||D?p.defaultDepthWriteParams:null,colorWrite:p.defaultColorWriteParams,stencilWrite:y||u.hasOccludees?
l.stencilWriteMaskOn:null,stencilTest:y?l.replaceBitWhenDepthTestPasses(e.StencilBits.IntegratedMeshMaskExcluded):u.hasOccludees?l.stencilBaseAllZerosParams:null,polygonOffset:w||D?u.hasPolygonOffset?{factor:2,units:2}:null:g.OITPolygonOffset})};A.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return B}(f.ShaderTechnique);f.shader=new d.ReloadableShaderModule(r.ComponentShader,()=>new Promise((C,B)=>a(["./shader/ComponentShader.glsl"],C,B)));
const z=new Map([[q.VertexAttribute.POSITION,0],[q.VertexAttribute.NORMAL,1],[q.VertexAttribute.NORMALCOMPRESSED,1],[q.VertexAttribute.COLOR,2],[q.VertexAttribute.UV0,3],[q.VertexAttribute.UVREGION,4],[q.VertexAttribute.COMPONENTINDEX,5]]);c.ComponentTechnique=f;c.attributeLocations=z;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutput ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces ../../../lib/TransparencyPassType".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){a.IntegratedMeshMode=void 0;(function(p){p[p.None=0]="None";p[p.NoOverlay=1]="NoOverlay";p[p.ColorOverlay=2]="ColorOverlay";p[p.ColorOverlayWithWater=3]="ColorOverlayWithWater";p[p.COUNT=4]="COUNT"})(a.IntegratedMeshMode||(a.IntegratedMeshMode={}));let k=function(p){function z(){var C=p.apply(this,arguments)||this;C.output=r.ShaderOutput.Color;C.textureCoordinateType=d.TextureCoordinateAttributeType.None;C.componentData=t.ComponentDataType.Uniform;C.cullFace=
v.CullFaceOptions.Back;C.vertexDiscardMode=n.VertexDiscardMode.None;C.doubleSidedMode=f.NormalsDoubleSidedMode.WindingOrder;C.alphaDiscardMode=v.AlphaDiscardMode.Opaque;C.integratedMeshMode=a.IntegratedMeshMode.None;C.transparencyPassType=q.TransparencyPassType.NONE;C.ellipsoidMode=g.EllipsoidMode.Earth;C.pbrMode=e.PBRMode.Disabled;C.normalType=m.NormalAttributeType.Attribute;C.spherical=!1;C.doublePrecisionRequiresObfuscation=!1;C.hasVertexColors=!1;C.hasNormals=!1;C.hasSlicePlane=!1;C.hasBaseColorTexture=
!1;C.receiveAmbientOcclusion=!0;C.receiveShadows=!0;C.blendingEnabled=!0;C.hasScreenSpaceReflections=!1;C.hasPolygonOffset=!1;C.hasMetallicRoughnessTexture=!1;C.hasEmissionTexture=!1;C.hasOcclusionTexture=!1;C.hasNormalTexture=!1;C.hasOccludees=!1;C.hasMultipassTerrain=!1;C.cullAboveGround=!1;C.useLegacyTerrainShading=!1;C.hasCloudsReflections=!0;C.snowCover=!1;C.objectAndLayerIdColor=!1;C.hasWebGL2Context=!1;return C}c._inheritsLoose(z,p);return z}(l.ShaderTechniqueConfiguration);b.__decorate([l.parameter({count:r.ShaderOutput.COUNT})],
k.prototype,"output",void 0);b.__decorate([l.parameter({count:d.TextureCoordinateAttributeType.COUNT})],k.prototype,"textureCoordinateType",void 0);b.__decorate([l.parameter({count:t.ComponentDataType.COUNT})],k.prototype,"componentData",void 0);b.__decorate([l.parameter({count:v.CullFaceOptions.COUNT})],k.prototype,"cullFace",void 0);b.__decorate([l.parameter({count:n.VertexDiscardMode.COUNT})],k.prototype,"vertexDiscardMode",void 0);b.__decorate([l.parameter({count:f.NormalsDoubleSidedMode.COUNT})],
k.prototype,"doubleSidedMode",void 0);b.__decorate([l.parameter({count:v.AlphaDiscardMode.COUNT})],k.prototype,"alphaDiscardMode",void 0);b.__decorate([l.parameter({count:a.IntegratedMeshMode.COUNT})],k.prototype,"integratedMeshMode",void 0);b.__decorate([l.parameter({count:q.TransparencyPassType.COUNT})],k.prototype,"transparencyPassType",void 0);b.__decorate([l.parameter({count:g.EllipsoidMode.COUNT})],k.prototype,"ellipsoidMode",void 0);b.__decorate([l.parameter({count:e.PBRMode.COUNT})],k.prototype,
"pbrMode",void 0);b.__decorate([l.parameter({count:m.NormalAttributeType.COUNT})],k.prototype,"normalType",void 0);b.__decorate([l.parameter()],k.prototype,"spherical",void 0);b.__decorate([l.parameter()],k.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([l.parameter()],k.prototype,"hasVertexColors",void 0);b.__decorate([l.parameter()],k.prototype,"hasNormals",void 0);b.__decorate([l.parameter()],k.prototype,"hasSlicePlane",void 0);b.__decorate([l.parameter()],k.prototype,"hasBaseColorTexture",
void 0);b.__decorate([l.parameter()],k.prototype,"receiveAmbientOcclusion",void 0);b.__decorate([l.parameter()],k.prototype,"receiveShadows",void 0);b.__decorate([l.parameter()],k.prototype,"blendingEnabled",void 0);b.__decorate([l.parameter()],k.prototype,"hasScreenSpaceReflections",void 0);b.__decorate([l.parameter()],k.prototype,"hasPolygonOffset",void 0);b.__decorate([l.parameter()],k.prototype,"hasMetallicRoughnessTexture",void 0);b.__decorate([l.parameter()],k.prototype,"hasEmissionTexture",
void 0);b.__decorate([l.parameter()],k.prototype,"hasOcclusionTexture",void 0);b.__decorate([l.parameter()],k.prototype,"hasNormalTexture",void 0);b.__decorate([l.parameter()],k.prototype,"hasOccludees",void 0);b.__decorate([l.parameter()],k.prototype,"hasMultipassTerrain",void 0);b.__decorate([l.parameter()],k.prototype,"cullAboveGround",void 0);b.__decorate([l.parameter()],k.prototype,"useLegacyTerrainShading",void 0);b.__decorate([l.parameter()],k.prototype,"hasCloudsReflections",void 0);b.__decorate([l.parameter()],
k.prototype,"snowCover",void 0);b.__decorate([l.parameter()],k.prototype,"objectAndLayerIdColor",void 0);b.__decorate([l.parameter()],k.prototype,"hasWebGL2Context",void 0);b.__decorate([l.parameter({constValue:h.BindType.Draw})],k.prototype,"pbrTextureBindType",void 0);b.__decorate([l.parameter({constValue:!0})],k.prototype,"hasSliceHighlight",void 0);b.__decorate([l.parameter({constValue:!1})],k.prototype,"hasSliceInVertexProgram",void 0);b.__decorate([l.parameter({constValue:!1})],k.prototype,
"useCustomDTRExponentForWater",void 0);b.__decorate([l.parameter({constValue:!1})],k.prototype,"hasVertexTangents",void 0);b.__decorate([l.parameter({constValue:!0})],k.prototype,"supportsTextureAtlas",void 0);b.__decorate([l.parameter({constValue:!1})],k.prototype,"highStepCount",void 0);b.__decorate([l.parameter({constValue:!1})],k.prototype,"instancedDoublePrecision",void 0);b.__decorate([l.parameter({constValue:!0})],k.prototype,"useFillLights",void 0);b.__decorate([l.parameter({constValue:!1})],
k.prototype,"objectAndLayerIdColorInstanced",void 0);a.ComponentTechniqueConfiguration=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ../../../../../../../core/has ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/ShaderOutput ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderLibrary/util/WebGL2Utils ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DDrawUniform ../../../../core/shaderModules/TextureSizeUniformType ../../../../lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(z,C){const {vertex:B,fragment:A}=z;B.include(m.RgbaFloatEncoding);B.uniforms.add(h.createTexture2DDrawSizeUniforms("componentColorTex",u=>u.componentParameters.texture.texture,C.hasWebGL2Context?l.TextureSizeUniformType.None:l.TextureSizeUniformType.Size));z.attributes.add(v.VertexAttribute.COMPONENTINDEX,"float");z.varyings.add("vExternalColorMixMode","mediump float");z.varyings.add("vExternalColor","vec4");const x=C.output===r.ShaderOutput.ObjectAndLayerIdColor;
x&&z.varyings.add("vObjectAndLayerIdColor","vec4");z.include(n.DecodeSymbolColor);B.constants.add("elevationScale","float",2*p);B.constants.add("stride","float",t("enable-feature:objectAndLayerId-rendering")?3:2);B.code.add(g.glsl`
  vec2 getComponentTextureCoordinates(float componentIndex, float typeOffset) {
    vec2 textureSize = ${d.textureSize(C,"componentColorTex")};

    float index = componentIndex * stride + typeOffset;
    float coordX = mod(index, textureSize.x);
    float coordY = floor(index / textureSize.x);

    return vec2(coordX, coordY) + 0.5;
  }
  `);B.code.add(g.glsl`
  vec4 _readComponentColor() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 0.0);

    return ${d.texelFetch(C,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
   }

   float readElevationOffset() {
    vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 1.0);

    vec4 encodedElevation = ${d.texelFetch(C,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
    return (rgba2float(encodedElevation) - 0.5) * elevationScale;
  }

  ${x?g.glsl`
          void forwardObjectAndLayerIdColor() {
            vec2 textureCoordinates = getComponentTextureCoordinates(componentIndex, 2.0);

            vObjectAndLayerIdColor = ${d.texelFetch(C,"componentColorTex","textureCoordinates","1.0 / componentColorTexSize")};
          }`:g.glsl`void forwardObjectAndLayerIdColor() {}`}

  vec4 forwardExternalColor(out bool castShadows) {
    vec4 componentColor = _readComponentColor() * 255.0;

    float shadowFlag = mod(componentColor.b * 255.0, 2.0);
    componentColor.b -= shadowFlag;
    castShadows = shadowFlag >= 1.0;

    int decodedColorMixMode;
    vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451; // = 1/255;
    vExternalColorMixMode = float(decodedColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts

    return vExternalColor;
  }
`);A.code.add(g.glsl`
  void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
    externalColor = vExternalColor;
    externalColorMixMode = int(vExternalColorMixMode);
  }

  void outputObjectAndLayerIdColor() {
     ${x?g.glsl`gl_FragColor = vObjectAndLayerIdColor;`:""}
  }
`)}function k(z){const {vertex:C,fragment:B}=z;C.uniforms.add(new f.Float4DrawUniform("externalColor",A=>A.componentParameters.externalColor));B.uniforms.add(new e.IntegerDrawUniform("externalColorMixMode",A=>A.componentParameters.externalColorMixMode));z.varyings.add("vExternalColor","vec4");C.code.add(g.glsl`float readElevationOffset() {
return 0.0;
}
void forwardObjectAndLayerIdColor() {
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);B.code.add(g.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}
void outputObjectAndLayerIdColor() {
gl_FragColor = vec4(1.0,0.0,0.0,0.0);
}`)}a.ComponentDataType=void 0;(function(z){z[z.Uniform=0]="Uniform";z[z.Varying=1]="Varying";z[z.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));const p=2**32/1E4;a.ComponentData=function(z,C){switch(C.componentData){case a.ComponentDataType.Varying:return q(z,C);case a.ComponentDataType.Uniform:return k(z);case a.ComponentDataType.COUNT:break;default:c.neverReached(C.componentData)}};a.MAX_ELEVATION_OFFSET=p;a.encodeElevationOffset=function(z,C){b.packFloatRGBA(z/p*.5+.5,C)};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,c,b,t){b=function(n){function r(m,d){return n.call(this,m,"int",t.BindType.Draw,(f,e,g)=>f.setUniform1i(m,d(e,g)))||this}c._inheritsLoose(r,n);return r}(b.Uniform);a.IntegerDrawUniform=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports",
"../../../../core/shaderModules/interfaces"],function(a,c){a.VertexDiscardMode=void 0;(function(b){b[b.None=0]="None";b[b.Transparent=1]="Transparent";b[b.Opaque=2]="Opaque";b[b.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(b,t){b=b.vertex;b.code.add(c.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(t.vertexDiscardMode){case a.VertexDiscardMode.None:b.code.add(c.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);break;case a.VertexDiscardMode.Opaque:b.code.add(c.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);
break;case a.VertexDiscardMode.Transparent:b.code.add(c.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,c){a.EllipsoidMode=void 0;(function(b){b[b.Earth=1]="Earth";b[b.Mars=
2]="Mars";b[b.Moon=3]="Moon";b[b.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(b){return b&&c.isMars(b)?a.EllipsoidMode.Mars:b&&c.isMoon(b)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/interfaces ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/TransparencyPassType".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I){function G(O){const S=new N.ShaderBuilder;S.include(v.VertexPosition,O);S.include(l.VertexNormal,O);S.include(h.VertexColor,O);S.include(g.TextureCoordinateAttribute,O);S.include(m.ForwardLinearDepth,O);S.include(n.ComponentData,O);S.include(K.DiscardOrAdjustAlphaDraw,O);S.include(f.SlicePass,O);S.include(w.ReadBaseColorTexture,O);S.include(r.VertexDiscardByOpacity,O);const {vertex:R,fragment:Q}=S;if(O.pbrMode===y.PBRMode.Normal||
O.pbrMode===y.PBRMode.Schematic)S.include(y.PhysicallyBasedRenderingParameters,O),O.hasNormalTexture&&S.include(C.ComputeNormalTexture,O);const V=O.output===d.ShaderOutput.Shadow||O.output===d.ShaderOutput.ShadowHighlight||O.output===d.ShaderOutput.ShadowExcludeHighlight;V&&O.componentData===n.ComponentDataType.Varying?R.code.add(M.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):R.code.add(M.glsl`#define discardShadows(castShadows) {}`);
const aa=O.integratedMeshMode===t.IntegratedMeshMode.ColorOverlay||O.integratedMeshMode===t.IntegratedMeshMode.ColorOverlayWithWater,X=aa&&O.output===d.ShaderOutput.Color&&O.pbrMode===y.PBRMode.WaterOnIntegratedMesh;aa&&(S.include(A.EvaluateSceneLighting,O),S.include(F.OverlayIM,O),O.spherical?R.code.add(M.glsl`
      const float invEllipsoidRadius = ${M.glsl.float(1/(O.ellipsoidMode===J.EllipsoidMode.Earth?c.earth.radius:O.ellipsoidMode===J.EllipsoidMode.Mars?c.mars.radius:c.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):R.code.add(M.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));X&&(S.varyings.add("tbnTangent","vec3"),S.varyings.add("tbnBiTangent","vec3"),S.varyings.add("groundNormal","vec3"));R.code.add(M.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      ${O.output===d.ShaderOutput.ObjectAndLayerIdColor?M.glsl`externalColor.a = 1.0;`:""}

      if (externalColor.a < ${M.glsl.float(E.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${O.output===d.ShaderOutput.ObjectAndLayerIdColor?M.glsl`forwardObjectAndLayerIdColor();`:""}
      ${X?O.spherical?M.glsl`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:M.glsl`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${aa?M.glsl`setOverlayVTC(projectOverlay(position));`:""}
    }
  `);O.output===d.ShaderOutput.Alpha&&(Q.include(p.ReadLinearDepth),S.include(u.multipassTerrainTest,O),S.include(z.ComputeMaterialColor,O),aa&&Q.uniforms.add(new P.Texture2DPassUniform("ovColorTex",(W,T)=>F.getColorTexture(W,T))),Q.code.add(M.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${O.hasMultipassTerrain?M.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${aa?M.glsl`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `));O.output===d.ShaderOutput.Color&&(Q.include(p.ReadLinearDepth),S.include(u.multipassTerrainTest,O),S.include(z.ComputeMaterialColor,O),S.include(B.ComputeShadingNormal,O),S.include(A.EvaluateSceneLighting,O),O.receiveShadows?(S.include(D.ReadShadowMapPass,O),Q.code.add(M.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):Q.code.add(M.glsl`float evaluateShadow() { return 0.0; }`),aa&&Q.uniforms.add(new P.Texture2DPassUniform("ovColorTex",(W,T)=>F.getColorTexture(W,T))),Q.code.add(M.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${O.hasMultipassTerrain?M.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${aa?M.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),O.pbrMode===y.PBRMode.Normal||O.pbrMode===y.PBRMode.Schematic?(x.addMainLightIntensity(Q),Q.code.add(M.glsl`
        ${O.pbrMode===y.PBRMode.Normal?M.glsl`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * mainLightIntensity[2];
      `),O.hasNormalTexture?Q.code.add(M.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):Q.code.add(M.glsl`vec3 shadingNormal = normalVertex;`),Q.code.add(M.glsl`${O.spherical?M.glsl`vec3 normalGround = normalize(positionWorld());`:M.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),Q.code.add(M.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${O.snowCover?M.glsl`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${aa?M.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(O.receiveShadows?Q.code.add(M.glsl`float shadow = evaluateShadow();`):O.spherical?(A.addLightingGlobalFactor(Q),Q.code.add(M.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):Q.code.add(M.glsl`float shadow = 0.0;`),X&&Q.uniforms.add(new P.Texture2DPassUniform("ovNormalTex",(W,T)=>H(T))),O.snowCover&&(S.extensions.add("GL_OES_standard_derivatives"),Q.code.add(M.glsl`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),Q.code.add(M.glsl`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${aa?M.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${X?M.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),Q.code.add(M.glsl`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${O.transparencyPassType===I.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(O.output===d.ShaderOutput.Depth||V)S.include(q.OutputDepth,O),Q.code.add(M.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);O.output===d.ShaderOutput.Normal&&(S.include(B.ComputeShadingNormal,O),Q.code.add(M.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${O.normalType===e.NormalAttributeType.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));O.output===d.ShaderOutput.ObjectAndLayerIdColor&&S.fragment.code.add(M.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${aa?M.glsl`gl_FragColor = getOverlayColorTexel(vtcOverlay);`:"outputObjectAndLayerIdColor();"}
      }
    `);O.output===d.ShaderOutput.Highlight&&(S.include(k.OutputHighlight,O),Q.code.add(M.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${aa?M.glsl`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `));return S}function H(O){return 0===O.overlays.length?null:O.overlays[b.OverlayIndex.INNER].getValidTexture(b.RenderTargetType.Water)}const L=Object.freeze(Object.defineProperty({__proto__:null,build:G,getOverlayNormalTexture:H},Symbol.toStringTag,{value:"Module"}));a.ComponentShader=L;a.build=G;a.getOverlayNormalTexture=H})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),
function(a,c,b,t,n,r){a.ComputeMaterialColor=function(m,d){m.include(c.VertexColor,d);m.fragment.include(b.MixExternalColor);m=m.fragment;m.uniforms.add(new t.Float4DrawUniform("baseColor",f=>f.baseColor));m.uniforms.add(new n.FloatDrawUniform("objectOpacity",f=>f.objectOpacity));d.hasVertexColors?m.code.add(r.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):m.code.add(r.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);m.code.add(r.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,c,b,t,n,r,m){a.ComputeShadingNormal=function(d,f){const e=d.fragment;switch(f.doubleSidedMode){case r.NormalsDoubleSidedMode.None:e.code.add(m.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case r.NormalsDoubleSidedMode.View:d.include(n.VertexPosition,f);e.code.add(m.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case r.NormalsDoubleSidedMode.WindingOrder:e.code.add(m.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:c.neverReached(f.doubleSidedMode);case r.NormalsDoubleSidedMode.COUNT:}switch(f.normalType){case b.NormalAttributeType.Attribute:case b.NormalAttributeType.CompressedAttribute:d.include(t.VertexNormal,f);e.code.add(m.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case b.NormalAttributeType.ScreenDerivative:d.extensions.add("GL_OES_standard_derivatives");d.include(n.VertexPosition,f);e.code.add(m.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case b.NormalAttributeType.Ground:f.spherical?(d.include(n.VertexPosition,f),e.code.add(m.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):e.code.add(m.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);d.extensions.add("GL_OES_standard_derivatives");e.code.add(m.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:c.neverReached(f.normalType);case b.NormalAttributeType.COUNT:}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../ShaderOutput ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../util/WebGL2Utils ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/TextureSizeUniformType ../../../lib/basicInterfaces".split(" "),
function(a,c,b,t,n,r,m,d,f,e){a.ReadBaseColorTexture=function(g,h){const l=g.fragment;if(!h.hasBaseColorTexture||h.output!==c.ShaderOutput.Color&&h.alphaDiscardMode===e.AlphaDiscardMode.Opaque)l.code.add(m.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`);else{g.include(t.VertexTextureCoordinates,h);const v=h.textureCoordinateType===b.TextureCoordinateAttributeType.Atlas;l.uniforms.add(d.createTexture2DDrawSizeUniforms("baseColorTexture",q=>q.texture,v?h.hasWebGL2Context?f.TextureSizeUniformType.None:
f.TextureSizeUniformType.Size:f.TextureSizeUniformType.None));v?(g.include(n.TextureAtlasLookup),l.code.add(m.glsl`
        vec4 readBaseColorTexture() {
          vec2 textureSize = ${r.textureSize(h,"baseColorTexture")};
          return textureAtlasLookup(baseColorTexture, textureSize, vuv0, vuvRegion);
        }
      `)):l.code.add(m.glsl`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../shaderModules/interfaces"],function(a,c,b){b=function(n){function r(){var d=n.apply(this,arguments)||this;d._dirty=!0;return d}c._inheritsLoose(r,n);var m=r.prototype;m._setDirty=function(){this._dirty=!0};m._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const d of this._parameterBlocks)this[d]._setClean()};
m._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const d of this._parameterBlocks)if(this[d].dirty)return!0;return!1};c._createClass(r,[{key:"dirty",get:function(){return this._dirty||this._checkParameterBlocksDirty()}}]);return r}(b.NoParameters);let t=function(){function n(){this._dirty=!0}var r=n.prototype;r._setDirty=function(){this._dirty=!0};r._setClean=function(){this._dirty=!1};c._createClass(n,[{key:"dirty",get:function(){return this._dirty}}]);return n}();
a.MaterialBase=b;a.MaterialParameterBlock=t;a.parameter=function(n={}){return(r,m)=>{const d=r._parameterCount??0;r._parameterCount=d+1;if(n.vectorOps){const f=n.vectorOps;Object.defineProperty(r,m,{get(){return this[d]},set(e){const g=this[d];if(null==g)this[d]=e;else{if(f.equals(g,e))return;f.copy(g,e)}this._setDirty()}})}else Object.defineProperty(r,m,{get(){return this[d]},set(f){this[d]!==f&&(n.dispose&&this[d]&&this[d].dispose(),this[d]=f,this._setDirty())}})}};a.parameterBlock=function(){return(n,
r)=>{const m=n._parameterCount??0;n._parameterCount=m+1;n._parameterBlocks=n._parameterBlocks||[];n._parameterBlocks.push(m);Object.defineProperty(n,r,{get(){return this[m]},set(d){this[m]!==d&&(this[m]=d,this._setDirty())}})}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],
function(a,c,b,t,n){let r=function(){function d(e){this._low=t.create();this._high=t.create();e&&this.set(e)}var f=d.prototype;f.set=function(e){const g=this._low,h=this._high;b.copy(g,e);b.sub(h,e,g)};f.setElements=function(e,g,h){b.set(m,e,g,h);this.set(m)};f.get=function(e){return b.add(e,this._low,this._high)};f.getLowScaled=function(e){return b.scale(e,this._low,1)};c._createClass(d,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return d}();const m=
n.create();a.TwoVectorPosition=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,c,b,t){const n=b.newLayout().vec3f(t.VertexAttribute.POSITION).u16(t.VertexAttribute.COMPONENTINDEX).u16(t.VertexAttribute.U16PADDING),r=b.newLayout().vec2u8(t.VertexAttribute.SIDENESS);c=c.glLayout(r);b=
b.newLayout().vec3f(t.VertexAttribute.POSITION0).vec3f(t.VertexAttribute.POSITION1).u16(t.VertexAttribute.COMPONENTINDEX).u8(t.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(t.VertexAttribute.VARIANTSTROKE).u8(t.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0}).u8(t.VertexAttribute.U8PADDING,{glPadding:!0}).u16(t.VertexAttribute.U16PADDING,{glPadding:!0});const m=b.clone().vec3f(t.VertexAttribute.NORMAL),d=b.clone().vec3f(t.VertexAttribute.NORMALA).vec3f(t.VertexAttribute.NORMALB);t=new Map([[t.VertexAttribute.POSITION0,
0],[t.VertexAttribute.POSITION1,1],[t.VertexAttribute.COMPONENTINDEX,2],[t.VertexAttribute.VARIANTOFFSET,3],[t.VertexAttribute.VARIANTSTROKE,4],[t.VertexAttribute.VARIANTEXTENSION,5],[t.VertexAttribute.NORMAL,6],[t.VertexAttribute.NORMALA,6],[t.VertexAttribute.NORMALB,7],[t.VertexAttribute.SIDENESS,8]]);a.CommonInstancesLayout=b;a.EdgeInputBufferLayout=n;a.EdgeShaderAttributeLocations=t;a.RegularEdgeInstancesLayout=m;a.SilhouetteEdgeInstancesLayout=d;a.VertexLayout=r;a.glVertexLayout=c;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeProcessing":function(){define("exports ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/InterleavedLayout ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),function(a,c,b,t,n,r,m,d){function f(l,v,q,k){if(v)return v=b.computeNeighbors(q,k,l.count),new e(q,k,v,l);l=c.deduplicate(l.buffer,l.stride/4,{originalIndices:q,
originalIndicesLength:k});k=b.computeNeighbors(l.indices,k,l.uniqueCount);return{faces:l.indices,facesLength:l.indices.length,neighbors:k,vertices:r.EdgeInputBufferLayout.createView(l.buffer)}}let e=function(l,v,q,k){this.faces=l;this.facesLength=v;this.neighbors=q;this.vertices=k};const g=new m.RegularEdgeBufferWriter,h=new m.SilhouetteEdgeBufferWriter;m=t.newLayout().vec3f(n.VertexAttribute.POSITION0).vec3f(n.VertexAttribute.POSITION1);t=t.newLayout().vec3f(n.VertexAttribute.POSITION0).vec3f(n.VertexAttribute.POSITION1).u16(n.VertexAttribute.COMPONENTINDEX).u16(n.VertexAttribute.U16PADDING,
{glPadding:!0});a.extract=function(l){const v=f(l.data,l.skipDeduplicate,l.indices,l.indicesLength);g.updateSettings(l.writerSettings);h.updateSettings(l.writerSettings);return d.extractEdges(v,g,h)};a.extractComponentsEdgeLocationsLayout=t;a.extractEdgeInformation=f;a.extractEdgeLocationsLayout=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(a){a.computeNeighbors=function(c,b,t){b/=3;const n=new Uint32Array(t+
1),r=new Uint32Array(t+1);var m=(k,p)=>{k<p?n[k+1]++:r[p+1]++};for(var d=0;d<b;d++){var f=c[3*d],e=c[3*d+1],g=c[3*d+2];m(f,e);m(e,g);m(g,f)}d=m=0;for(f=0;f<t;f++)e=n[f+1],g=r[f+1],n[f+1]=m,r[f+1]=d,m+=e,d+=g;const h=new Uint32Array(6*b),l=n[t];m=(k,p,z)=>{k<p?(k=n[k+1]++,h[2*k]=p,h[2*k+1]=z):(p=r[p+1]++,h[2*l+2*p]=k,h[2*l+2*p+1]=z)};for(d=0;d<b;d++)f=c[3*d],e=c[3*d+1],g=c[3*d+2],m(f,e,d),m(e,g,d),m(g,f,d);m=(k,p)=>{const z=2*k;k=p-k;for(p=1;p<k;p++){const C=h[z+2*p],B=h[z+2*p+1];let A=p-1;for(A;0<=
A&&h[z+2*A]>C;A--)h[z+2*A+2]=h[z+2*A],h[z+2*A+3]=h[z+2*A+1];h[z+2*A+2]=C;h[z+2*A+3]=B}};for(d=0;d<t;d++)m(n[d],n[d+1]),m(l+r[d],l+r[d+1]);const v=new Int32Array(3*b),q=(k,p)=>k===c[3*p]?0:k===c[3*p+1]?1:k===c[3*p+2]?2:-1;b=(k,p)=>{k=q(k,p);v[3*p+k]=-1};m=(k,p,z,C)=>{k=q(k,p);v[3*p+k]=C;z=q(z,C);v[3*C+z]=p};for(d=0;d<t;d++){f=n[d];e=n[d+1];g=r[d];const k=r[d+1];for(;f<e&&g<k;){const p=h[2*f],z=h[2*l+2*g];p===z?(m(d,h[2*f+1],z,h[2*l+2*g+1]),f++,g++):p<z?(b(d,h[2*f+1]),f++):(b(z,h[2*l+2*g+1]),g++)}for(;f<
e;)b(d,h[2*f+1]),f++;for(;g<k;)b(h[2*l+2*g],h[2*l+2*g+1]),g++}return v};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(a,c,b,t,n,r){function m(z){const C=g;C[0]=z.position0[0];C[1]=z.position0[1];C[2]=z.position0[2];C[3]=z.position1[0];C[4]=
z.position1[1];C[5]=z.position1[2];l[0]=5381;for(z=0;z<h.length;z++)l[0]=31*l[0]+h[z];return l[0]}function d(z){const C=g;C[0]=f(z.position0[0]);C[1]=f(z.position0[1]);C[2]=f(z.position0[2]);C[3]=f(z.position1[0]);C[4]=f(z.position1[1]);C[5]=f(z.position1[2]);l[0]=5381;for(z=0;z<h.length;z++)l[0]=31*l[0]+h[z];return l[0]}function f(z){return Math.round(1E4*z)/1E4}let e=function(){function z(){}var C=z.prototype;C.updateSettings=function(B){this.settings=B;this._edgeHashFunction=B.reducedPrecision?
d:m};C.write=function(B,A,x){var u=this._edgeHashFunction(x);p.seed=u;u=p.getIntRange(0,255);const y=p.getIntRange(0,this.settings.variants-1);var w=p.getFloat();w=-(1-Math.min(w/.7,1))+Math.max(0,w-.7)/(1-.7);w=255*(Math.abs(w)**1.2*(0>w?-1:1)*.5+.5);B.position0.setVec(A,x.position0);B.position1.setVec(A,x.position1);B.componentIndex.set(A,x.componentIndex);B.variantOffset.set(A,u);B.variantStroke.set(A,y);B.variantExtension.set(A,w)};C.trim=function(B,A){return B.slice(0,A)};return z}();const g=
new Float32Array(6),h=new Uint32Array(g.buffer),l=new Uint32Array(1);let v=function(){function z(){this._commonWriter=new e}var C=z.prototype;C.updateSettings=function(B){this._commonWriter.updateSettings(B)};C.allocate=function(B){return r.RegularEdgeInstancesLayout.createBuffer(B)};C.write=function(B,A,x){this._commonWriter.write(B,A,x);b.add(k,x.faceNormal0,x.faceNormal1);b.normalize(k,k);B.normal.setVec(A,k)};C.trim=function(B,A){return this._commonWriter.trim(B,A)};return z}();v.Layout=r.RegularEdgeInstancesLayout;
v.glLayout=n.glLayout(r.RegularEdgeInstancesLayout,1);let q=function(){function z(){this._commonWriter=new e}var C=z.prototype;C.updateSettings=function(B){this._commonWriter.updateSettings(B)};C.allocate=function(B){return r.SilhouetteEdgeInstancesLayout.createBuffer(B)};C.write=function(B,A,x){this._commonWriter.write(B,A,x);B.normalA.setVec(A,x.faceNormal0);B.normalB.setVec(A,x.faceNormal1)};C.trim=function(B,A){return this._commonWriter.trim(B,A)};return z}();q.Layout=r.SilhouetteEdgeInstancesLayout;
q.glLayout=n.glLayout(r.SilhouetteEdgeInstancesLayout,1);const k=t.create(),p=new c;a.CommonBufferWriter=e;a.RegularEdgeBufferWriter=v;a.SilhouetteEdgeBufferWriter=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/mathUtils","../../../../../chunks/vec3","../../../../../chunks/vec3f64"],function(a,c,b,t,n){function r(h,l){const v=b.acosClamped(h.cosAngle),
q=f.fwd,k=f.ortho;t.direction(q,h.position1,h.position0);h=0<t.dot(t.cross(k,h.faceNormal0,h.faceNormal1),q)?-1:1;return v*h>l}function m(h){const l=h.faces.length/3,v=h.faces;h=h.neighbors;var q=0;for(var k=0;k<l;k++){var p=h[3*k+1],z=h[3*k+2],C=v[3*k],B=v[3*k+1],A=v[3*k+2];q+=-1===h[3*k]||C<B?1:0;q+=-1===p||B<A?1:0;q+=-1===z||A<C?1:0}q=new Int32Array(4*q);k=0;for(p=0;p<l;p++){z=h[3*p];C=h[3*p+1];B=h[3*p+2];A=v[3*p];const x=v[3*p+1],u=v[3*p+2];if(-1===z||A<x)q[k++]=A,q[k++]=x,q[k++]=p,q[k++]=z;if(-1===
C||x<u)q[k++]=x,q[k++]=u,q[k++]=p,q[k++]=C;if(-1===B||u<A)q[k++]=u,q[k++]=A,q[k++]=p,q[k++]=B}return q}function d(h){const l=h.faces.length/3,v=h.vertices.position;h=h.faces;const q=e.v0,k=e.v1,p=e.v2,z=new Float32Array(3*l);for(let C=0;C<l;C++){const B=h[3*C+1],A=h[3*C+2];v.getVec(h[3*C],q);v.getVec(B,k);v.getVec(A,p);t.subtract(k,k,q);t.subtract(p,p,q);t.cross(q,k,p);t.normalize(q,q);z[3*C]=q[0];z[3*C+1]=q[1];z[3*C+2]=q[2]}return z}a.EdgeType=void 0;(function(h){h[h.SOLID=0]="SOLID";h[h.SKETCH=
1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const f={edge:{position0:n.create(),position1:n.create(),faceNormal0:n.create(),faceNormal1:n.create(),componentIndex:0,cosAngle:0},ortho:n.create(),fwd:n.create()},e={v0:n.create(),v1:n.create(),v2:n.create()},g={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(h,l,v,q=g){const k=h.vertices.position;var p=h.vertices.componentIndex,z=b.deg2rad(q.anglePlanar);q=b.deg2rad(q.angleSignificantEdge);const C=Math.cos(q),B=Math.cos(z),A=f.edge,x=A.position0,
u=A.position1,y=A.faceNormal0,w=A.faceNormal1,D=d(h),F=m(h),E=F.length/4;h=l.allocate(E);q=0;const K=v.allocate(E);let J=0,M=0,N=0;const P=c.range(0,E),I=new Float32Array(E);I.forEach((O,S,R)=>{k.getVec(F[4*S],x);k.getVec(F[4*S+1],u);R[S]=t.distance(x,u)});P.sort((O,S)=>I[S]-I[O]);const G=[],H=[];for(let O=0;O<E;O++){var L=P[O];const S=I[L],R=F[4*L],Q=F[4*L+1],V=F[4*L+2];L=F[4*L+3];const aa=-1===L;k.getVec(R,x);k.getVec(Q,u);if(aa)t.set(y,D[3*V],D[3*V+1],D[3*V+2]),t.copy(w,y),A.componentIndex=p.get(R),
A.cosAngle=t.dot(y,w);else{t.set(y,D[3*V],D[3*V+1],D[3*V+2]);t.set(w,D[3*L],D[3*L+1],D[3*L+2]);A.componentIndex=p.get(R);A.cosAngle=t.dot(y,w);if(A.cosAngle>B)continue;-.9999>A.cosAngle&&t.copy(w,y)}M+=S;N++;aa||A.cosAngle<C?(l.write(h,q++,A),G.push(S)):r(A,z)&&(v.write(K,J++,A),H.push(S))}p=new Float32Array(G.reverse());z=new Float32Array(H.reverse());return{regular:{instancesData:l.trim(h,q),lodInfo:{lengths:p}},silhouette:{instancesData:v.trim(K,J),lodInfo:{lengths:z}},averageEdgeLength:M/N}};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],function(a,c){let b=function(){function t(r,m=1){this._rctx=r;this._fieldCount=m;this._buffers=[]}var n=t.prototype;n.garbageCollect=function(){this._buffers=this._buffers.filter(r=>0===r.activeCount?(r.dispose(),!1):!0)};n.destroy=function(){this._buffers.forEach(r=>r.dispose());this._buffers=[]};n.getBuffer=
function(r){for(const m of this._buffers)if(m.availableCount>=r)return m;if(r>c.MAX_INDEX_COUNT)return null;r=new c.ManagedTextureBackedBuffer(this._rctx,this._fieldCount);this._buffers.push(r);return r};n.updateTextures=function(){for(const r of this._buffers)r.textureBuffer.updateTexture()};return t}();a.BufferManager=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./SimpleIndexManager","./TextureBackedBuffer"],function(a,c,b,t){let n=function(){function r(d,f=1){this.textureBuffer=new t.TextureBackedBuffer(d,f);this._indexManager=new b.SimpleIndexManager(65536)}var m=r.prototype;m.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};m.acquireIndex=function(){const d=this._indexManager.acquire();this.textureBuffer.resizeToFit(d);return d};m.releaseIndex=function(d){this._indexManager.release(d)};c._createClass(r,[{key:"availableCount",
get:function(){return this._indexManager.availableCount}},{key:"activeCount",get:function(){return this._indexManager.activeCount}}]);return r}();a.MAX_INDEX_COUNT=65536;a.ManagedTextureBackedBuffer=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(r){this._maxCount=r;this._nextIndex=0;this._recycledIndices=
[]}var n=t.prototype;n.acquire=function(){if(0<this._recycledIndices.length)return this._recycledIndices.pop();if(this.availableCount)return this._nextIndex++};n.release=function(r){this._recycledIndices.push(r)};c._createClass(t,[{key:"activeCount",get:function(){return this._nextIndex-this._recycledIndices.length}},{key:"availableCount",get:function(){return this._recycledIndices.length+this._maxCount-this._nextIndex}}]);return t}();a.SimpleIndexManager=b;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture"],function(a,c,b,t,n){let r=function(){function m(f,e=1){this._rctx=f;this._fieldCount=e;this.textureWidth=4096;this._dirty=!0;this._texture=new n.Texture(this._rctx,{target:t.TextureType.TEXTURE_2D,pixelFormat:t.PixelFormat.RGBA,
dataType:t.PixelType.UNSIGNED_BYTE,samplingMode:t.TextureSamplingMode.NEAREST,wrapMode:t.TextureWrapMode.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1});this._data=new b.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var d=m.prototype;d.dispose=function(){this._texture.dispose();this._data=this._texture=void 0};d.setData=function(f,e,g,h,l,v){f=f*this._fieldCount+e;this._dirty=!0;this._data.set(f,0,g);this._data.set(f,1,h);this._data.set(f,2,l);this._data.set(f,3,v)};d.setDataElement=
function(f,e,g,h){f=f*this._fieldCount+e;this._dirty=!0;this._data.set(f,g,h)};d.resizeToFit=function(f){f*=this._fieldCount;f>=this._data.count&&(f=new b.BufferViewVec4u8(new ArrayBuffer(Math.ceil((f+1)/this.textureWidth)*this.textureWidth*4)),f.typedBuffer.set(this._data.typedBuffer),this._data=f)};d.updateTexture=function(){if(this._dirty){var f=this._texture.descriptor.width;this._data.count>f*this._texture.descriptor.height&&this._texture.resize(f,this._data.count/f);this._texture.setData(this._data.typedBuffer);
this._dirty=!1}};c._createClass(m,[{key:"texture",get:function(){return this._texture}}]);return m}();a.TextureBackedBuffer=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../core/maybe ./glUtil3D ../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../shaders/CompositingTechniqueConfiguration ../../../../chunks/HUDCompositing.glsl ../shaders/HUDCompositingTechnique ../../../../chunks/OITCompositing.glsl ../shaders/OITCompositingTechnique ../../../../chunks/OverlayCompositing.glsl ../shaders/OverlayCompositingTechnique ../../../webgl/enums ../../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){return function(){function v(k,p){this._rctx=k;this._techniqueRepository=p;this._configuration=new n.CompositingTechniqueConfiguration;this._passParameters=new b.CompositingPassParameters;this._oitParameters=new d.OITCompositingPassParameters;this._hudParameters=new r.HUDCompositingPassParameters;this._overlayParameters=new e.OverlayCompositingPassParameters}var q=v.prototype;q.destroy=function(){this._vao=a.disposeMaybe(this._vao)};q.compositeOIT=function(k,p,
z,C){this._oitParameters.colorTexture=p;this._oitParameters.alphaTexture=z;this._oitParameters.frontFaceTexture=C;p=this._rctx;z=this._techniqueRepository.acquire(f.OITCompositingTechnique);p.bindTechnique(z,this._oitParameters,k);k=this._ensureVAO();p.bindVAO(k);p.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,l.vertexCount(k,"geometry"));z.release()};q.compositeHUD=function(k,p){this._hudParameters.texture=p;p=this._rctx;const z=this._techniqueRepository.acquire(m.HUDCompositingTechnique);p.bindTechnique(z,
this._hudParameters,k);k=this._ensureVAO();p.bindVAO(k);p.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,l.vertexCount(k,"geometry"));z.release()};q.compositeOverlay=function(k,p,z,C){this._overlayParameters.texture=p;this._overlayParameters.opacity=z;this._overlayParameters.overlayIndex=C;p=this._rctx;z=this._techniqueRepository.acquire(g.OverlayCompositingTechnique);p.bindTechnique(z,this._overlayParameters,k);k=this._ensureVAO();p.bindVAO(k);p.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,l.vertexCount(k,
"geometry"));z.release()};q.composite=function(k,p,z=n.AlphaMode.None,C=1){const B=this._rctx;this._configuration.alphaMode=z;this._configuration.hasOpacityFactor=1!==C;this._passParameters.texture=p;this._passParameters.opacity=C;p=this._techniqueRepository.acquire(t.CompositingTechnique,this._configuration);B.bindTechnique(p,this._passParameters,k);k=this._ensureVAO();B.bindVAO(k);B.drawArrays(h.PrimitiveType.TRIANGLE_STRIP,0,l.vertexCount(k,"geometry"));p.release()};q._ensureVAO=function(){a.isNone(this._vao)&&
(this._vao=c.createQuadVAO(this._rctx));return this._vao};return v}()})},"esri/chunks/Compositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,c,b,t,n,r,m){function d(g){const h=
new r.ShaderBuilder;h.include(b.ScreenSpacePass);h.fragment.uniforms.add(new m.Texture2DPassUniform("tex",l=>l.texture));g.hasOpacityFactor&&h.fragment.uniforms.add(new t.FloatPassUniform("opacity",l=>l.opacity));h.fragment.code.add(n.glsl`
    void main() {
      gl_FragColor = texture2D(tex, uv) ${g.hasOpacityFactor?"* opacity":""};
    }`);return h}let f=function(g){function h(){var l=g.apply(this,arguments)||this;l.opacity=1;return l}c._inheritsLoose(h,g);return h}(n.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:f,build:d},Symbol.toStringTag,{value:"Module"}));a.Compositing=e;a.CompositingPassParameters=f;a.build=d})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){n=function(h){function l(){return h.apply(this,arguments)||this}b._inheritsLoose(l,h);var v=l.prototype;v.initializeProgram=function(q){return new m.Program(q.rctx,l.shader.get().build(this.configuration),r.Default3D)};v.initializePipeline=function(){switch(this.configuration.alphaMode){case f.AlphaMode.None:return g.makePipelineState({colorWrite:g.defaultColorWriteParams});case f.AlphaMode.Alpha:return g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.SRC_ALPHA,
e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:g.defaultColorWriteParams});case f.AlphaMode.PremultipliedAlpha:case f.AlphaMode.COUNT:return g.makePipelineState({blending:g.simpleBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:g.defaultColorWriteParams})}};return l}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.Compositing,()=>new Promise((h,l)=>a(["./Compositing.glsl"],h,l)));c.CompositingTechnique=n;Object.defineProperty(c,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,c,b,t){a.AlphaMode=void 0;(function(r){r[r.None=0]="None";r[r.Alpha=1]="Alpha";r[r.PremultipliedAlpha=2]="PremultipliedAlpha";r[r.COUNT=3]="COUNT"})(a.AlphaMode||(a.AlphaMode={}));let n=function(r){function m(){var d=
r.apply(this,arguments)||this;d.alphaMode=a.AlphaMode.None;d.hasOpacityFactor=!1;return d}c._inheritsLoose(m,r);return m}(t.ShaderTechniqueConfiguration);b.__decorate([t.parameter({count:a.AlphaMode.COUNT})],n.prototype,"alphaMode",void 0);b.__decorate([t.parameter()],n.prototype,"hasOpacityFactor",void 0);a.CompositingTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HUDCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r){function m(){const e=new n.ShaderBuilder;e.include(b.ScreenSpacePass);e.fragment.uniforms.add(new r.Texture2DPassUniform("tex",g=>g.texture));e.fragment.code.add(t.glsl`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);return e}let d=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);return g}(t.NoParameters);const f=Object.freeze(Object.defineProperty({__proto__:null,HUDCompositingPassParameters:d,build:m},Symbol.toStringTag,{value:"Module"}));a.HUDCompositing=f;a.HUDCompositingPassParameters=d;a.build=m})},"esri/views/3d/webgl-engine/shaders/HUDCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HUDCompositing.glsl ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f){n=function(e){function g(){return e.apply(this,arguments)||this}b._inheritsLoose(g,e);var h=g.prototype;h.initializeProgram=function(l){return new m.Program(l.rctx,g.shader.get().build(),r.Default3D)};h.initializePipeline=function(){return f.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}})};return g}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.HUDCompositing,()=>new Promise((e,g)=>a(["./HUDCompositing.glsl"],e,g)));c.HUDCompositingTechnique=n;Object.defineProperty(c,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OITCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),function(a,c,b,t,n,r){function m(){const e=new n.ShaderBuilder;e.include(b.ScreenSpacePass);e.fragment.uniforms.add([new r.Texture2DPassUniform("colorTexture",
g=>g.colorTexture),new r.Texture2DPassUniform("alphaTexture",g=>g.alphaTexture),new r.Texture2DPassUniform("frontFaceTexture",g=>g.frontFaceTexture)]);e.fragment.code.add(t.glsl`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);return e}let d=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);return g}(t.NoParameters);const f=Object.freeze(Object.defineProperty({__proto__:null,OITCompositingPassParameters:d,build:m},Symbol.toStringTag,{value:"Module"}));a.OITCompositing=f;a.OITCompositingPassParameters=d;a.build=m})},"esri/views/3d/webgl-engine/shaders/OITCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OITCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e){n=function(g){function h(){return g.apply(this,arguments)||this}b._inheritsLoose(h,g);var l=h.prototype;l.initializeProgram=function(v){return new m.Program(v.rctx,h.shader.get().build(),r.Default3D)};l.initializePipeline=function(){return e.makePipelineState({blending:e.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:e.defaultColorWriteParams})};return h}(n.ShaderTechnique);
n.shader=new t.ReloadableShaderModule(d.OITCompositing,()=>new Promise((g,h)=>a(["./OITCompositing.glsl"],g,h)));c.OITCompositingTechnique=n;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/OverlayCompositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f){function e(){const l=new d.ShaderBuilder;l.include(t.ScreenSpacePass);l.fragment.uniforms.add(new f.Texture2DPassUniform("tex",v=>v.texture));l.fragment.uniforms.add(new r.IntegerPassUniform("overlayIdx",v=>v.overlayIndex));l.fragment.uniforms.add(new n.FloatPassUniform("opacity",v=>v.opacity));l.fragment.code.add(m.glsl`void main() {
vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
gl_FragColor = texture2D(tex, overlayUV) * opacity;
}`);return l}let g=function(l){function v(){var q=l.apply(this,arguments)||this;q.overlayIndex=b.OverlayIndex.INNER;q.opacity=1;return q}c._inheritsLoose(v,l);return v}(m.NoParameters);const h=Object.freeze(Object.defineProperty({__proto__:null,OverlayCompositingPassParameters:g,build:e},Symbol.toStringTag,{value:"Module"}));a.OverlayCompositing=h;a.OverlayCompositingPassParameters=g;a.build=e})},"esri/views/3d/webgl-engine/shaders/OverlayCompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/OverlayCompositing.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e){n=function(g){function h(){return g.apply(this,arguments)||this}b._inheritsLoose(h,g);var l=h.prototype;l.initializeProgram=function(v){return new m.Program(v.rctx,h.shader.get().build(),r.Default3D)};l.initializePipeline=function(){return e.makePipelineState({blending:e.simpleBlendingParams(f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:e.defaultColorWriteParams})};return h}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.OverlayCompositing,
()=>new Promise((g,h)=>a(["./OverlayCompositing.glsl"],g,h)));c.OverlayCompositingTechnique=n;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){function p(P,I){if(I.visible){var G=v.empty(),H=I.getSpatialQueryAccelerator();t.isSome(H)?z(G,P,H):C(G,P,I.objects);return G}}function z(P,I,G){var H=I.eye;const L=I.viewForward,O=I.frustum,S=Q=>Q.visible;var R=G.objectCount;500>R?(v.set(K,I.near,Math.min(P.near,I.far)),G.forEachInDepthRange(H,L,q.DepthOrder.FRONT_TO_BACK,K,(Q,V)=>{B(P,I,Q);K.far=P.near;V.setRange(K)},O,S),v.set(K,Math.max(P.far,I.near),I.far),G.forEachInDepthRange(H,L,q.DepthOrder.BACK_TO_FRONT,
K,(Q,V)=>{B(P,I,Q);K.near=P.far;V.setRange(K)},O,S)):(R=Math.max(Math.min(R,500),Math.ceil(.1*R)),H=G.findClosest(L,q.DepthOrder.FRONT_TO_BACK,O,S,R),G=G.findClosest(L,q.DepthOrder.BACK_TO_FRONT,O,S,R),H&&G&&(x(P,I,H.boundingVolumeWorldSpace.bounds),x(P,I,G.boundingVolumeWorldSpace.bounds)))}function C(P,I,G){J.clear();G.forAll(H=>{H.visible&&0!==H.geometries.length&&J.add(H)});J.empty||(J.sort(I),v.set(K,I.near,Math.min(P.near,I.far)),J.forEachInDepthRange(K,q.DepthOrder.FRONT_TO_BACK,(H,L)=>{L<
P.near&&B(P,I,H)}),v.set(K,Math.max(P.far,I.near),I.far),J.forEachInDepthRange(K,q.DepthOrder.BACK_TO_FRONT,(H,L,O)=>{P.far=Math.max(P.far,O)}))}function B(P,I,G){if(G.visible&&g.intersectsSphere(I.frustum,G.boundingVolumeWorldSpace.bounds)){var H=G.transformation,L=E;G.geometries.forEach(O=>{r.multiply(L,H,O.shaderTransformation);const S=l.maxScale(L);A(P,I,O.boundingInfo,L,S)})}}function A(P,I,G,H,L){if(!t.isNone(G)){d.transformMat4(F,G.center,H);var {eye:O,viewForward:S}=I,R=S[0]*(F[0]-O[0])+S[1]*
(F[1]-O[1])+S[2]*(F[2]-O[2]);F[3]=G.radius*L;if(!(R-F[3]>P.near&&R+F[3]<P.far)&&g.intersectsSphere(I.frustum,F))if(100<G.radius&&G.getChildren())for(const Q of G.getChildren())A(P,I,Q,H,L);else N.unionDepthRangeWithAABB(P,I.viewProjectionMatrix,H,G.bbMin,G.bbMax)}}function x(P,I,G){var H=I.eye;I=I.viewForward;H=(G[0]-H[0])*I[0]+(G[1]-H[1])*I[1]+(G[2]-H[2])*I[2];P.near=Math.min(P.near,H-G[3]);P.far=Math.max(P.far,H+G[3])}let u=function(){function P(){this._items=new n({allocator:G=>G||{obj:null,distance:0,
near:0,far:0},deallocator:G=>{G.obj=null;G.distance=0;G.near=0;G.far=0;return G}})}var I=P.prototype;I.clear=function(){this._items.clear()};I.add=function(G){this._items.pushNew().obj=G};I.sort=function(G){const H=G.eye,L=G.viewForward;this._items.forAll(O=>{const S=O.obj.boundingVolumeWorldSpace.bounds,R=(S[0]-H[0])*L[0]+(S[1]-H[1])*L[1]+(S[2]-H[2])*L[2];O.distance=R;O.near=R-S[3];O.far=R+S[3]});this._items.sort((O,S)=>O.distance-S.distance)};I.forEachInDepthRange=function(G,H,L){if(H===q.DepthOrder.FRONT_TO_BACK)for(H=
0;H<this._items.length;++H){var O=this._items.data[H];O.far<G.near||O.near>G.far||L(O.obj,O.near,O.far)}else for(H=this._items.length-1;0<=H;--H)O=this._items.data[H],O.far<G.near||O.near>G.far||L(O.obj,O.near,O.far)};c._createClass(P,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return P}(),y=function(){function P(){this._view=m.create();this._viewProj=m.create();this._frustum=g.create();this._geometries=[];this._near=[];this._far=
[];this._nearCandidates=[];this._farCandidates=[];this._looseRange={near:0,far:0}}var I=P.prototype;I.compute=function(G,H){this._reset();r.copy(this._view,G.viewMatrix);r.multiply(this._viewProj,G.projectionMatrix,this._view);g.copy(this._frustum,G.frustum);G=this._view;const L=G[2],O=G[6],S=G[10],R=G[14];H.forAll(aa=>aa.forEachGeometry(X=>{if(X.visible&&X.castShadow){if(X.hasShaderTransformation){X.computeBoundingSphere(X.shaderTransformation,F,1);var W=F}else W=X.boundingSphere;var T=L*W[0]+O*
W[1]+S*W[2]+R,U=T-W[3];W=T+W[3];this._geometries.push(X);this._near.push(-W);this._far.push(-U)}}));H=new v.DepthRange;if(0===this._geometries.length)return H;for(G=0;G<this._geometries.length;++G)this._near[G]>H.far&&(H.far=this._near[G]),2<this._near[G]&&this._far[G]<H.near&&(H.near=this._far[G]);G=this._looseRange;G.near=Math.max(.5*H.near,2);G.far=2*H.far;var Q=0;let V=0;for(let aa=0;aa<this._geometries.length;++aa)this._near[aa]<H.near&&(this._near[aa]>=G.near?H.near=this._near[aa]:this._nearCandidates[Q++]=
aa),this._far[aa]>H.far&&(this._far[aa]<=G.far?H.far=this._far[aa]:this._farCandidates[V++]=aa);if(0===this._nearCandidates.length&&0===this._farCandidates.length)return H;this._nearCandidates.sort((aa,X)=>this._near[aa]<this._near[X]?-1:this._near[aa]>this._near[X]?1:0);this._farCandidates.sort((aa,X)=>this._far[aa]<this._far[X]?1:this._far[aa]>this._far[X]?-1:0);for(G=0;G<this._nearCandidates.length;++G)Q=this._nearCandidates[G],this._near[Q]<H.near&&(Q=this._geometries[Q],this._includeNearBoundingInfoRec(Q.boundingInfo,
Q.shaderTransformation,H));for(G=0;G<this._farCandidates.length;++G)Q=this._farCandidates[G],this._far[Q]>H.far&&(Q=this._geometries[Q],this._includeFarBoundingInfoRec(Q.boundingInfo,Q.shaderTransformation,H));this._reset();return H};I._reset=function(){this._geometries.length=0;this._near.length=0;this._far.length=0;this._nearCandidates.length=0;this._farCandidates.length=0};I._includeNearBoundingInfoRec=function(G,H,L){if(!t.isNone(G)){d.transformMat4(F,G.center,H);var O=l.maxScale(H),S=F[0],R=
F[1],Q=F[2];O*=G.radius;var V=this._frustum;if(!(V[0][0]*S+V[0][1]*R+V[0][2]*Q+V[0][3]>O||V[1][0]*S+V[1][1]*R+V[1][2]*Q+V[1][3]>O||V[2][0]*S+V[2][1]*R+V[2][2]*Q+V[2][3]>O||V[3][0]*S+V[3][1]*R+V[3][2]*Q+V[3][3]>O||(S=this._view[2]*S+this._view[6]*R+this._view[10]*Q+this._view[14],R=S+O,2>-(S-O)||-R>=L.near)))if(-R>this._looseRange.near)L.near=-R;else{if(100<O&&(O=G.getChildren(),void 0!==O)){for(const aa of O)this._includeNearBoundingInfoRec(aa,H,L);return}N.unionDepthRangeWithAABB(L,this._viewProj,
H,G.bbMin,G.bbMax)}}};I._includeFarBoundingInfoRec=function(G,H,L){if(!t.isNone(G)){var O=G.radius;d.transformMat4(F,G.center,H);var S=l.maxScale(H),R=F[0],Q=F[1],V=F[2];O*=S;S=this._frustum;if(!(S[0][0]*R+S[0][1]*Q+S[0][2]*V+S[0][3]>O||S[1][0]*R+S[1][1]*Q+S[1][2]*V+S[1][3]>O||S[2][0]*R+S[2][1]*Q+S[2][2]*V+S[2][3]>O||S[3][0]*R+S[3][1]*Q+S[3][2]*V+S[3][3]>O||(R=this._view[2]*R+this._view[6]*Q+this._view[10]*V+this._view[14]-O,-R<=L.far)))if(-R<this._looseRange.far)L.far=-R;else{if(100<O&&(O=G.getChildren(),
void 0!==O)){for(const aa of O)this._includeFarBoundingInfoRec(aa,H,L);return}N.unionDepthRangeWithAABB(L,this._viewProj,H,G.bbMin,G.bbMax)}}};return P}(),w=function(){function P(){this._modelViewProj=m.create();this._clipPosition=[e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create(),e.create()]}var I=P.prototype;I.unionDepthRangeWithAABB=function(G,H,L,O,S){var R=this._modelViewProj;r.multiply(R,H,L);H=!1;for(L=0;8>L;++L){const Q=this._clipPosition[L],V=0===L||3===L||4===
L||7===L?O[0]:S[0],aa=0===L||1===L||4===L||5===L?O[1]:S[1],X=4>L?O[2]:S[2];Q[0]=R[0]*V+R[4]*aa+R[8]*X+R[12];Q[1]=R[1]*V+R[5]*aa+R[9]*X+R[13];Q[2]=R[2]*V+R[6]*aa+R[10]*X+R[14];Q[3]=R[3]*V+R[7]*aa+R[11]*X+R[15]}for(O=0;12>O;++O){S=this._clipTriangle(this._clipPosition[D[O][0]],this._clipPosition[D[O][1]],this._clipPosition[D[O][2]]);R=!0;for(L=0;L<S.length;++L)if(2<=S[L][3]){R=!1;break}if(!R)for(H=!0,R=0;R<S.length;++R)L=S[R][3],Number.isFinite(L)&&(G.near=Math.min(L,G.near),G.far=Math.max(L,G.far))}return H};
I._inside=function(G,H){if(0===H)return G[0]>=-G[3];if(1===H)return G[1]>=-G[3];if(2===H)return G[0]<=G[3];if(3===H)return G[1]<=G[3];k.assert(!1)};I._intersect=function(G,H,L){let O=0;0===L?O=(-G[3]-G[0])/(H[0]-G[0]+H[3]-G[3]):1===L?O=(-G[3]-G[1])/(H[1]-G[1]+H[3]-G[3]):2===L?O=(G[3]-G[0])/(H[0]-G[0]-H[3]+G[3]):3===L&&(O=(G[3]-G[1])/(H[1]-G[1]-H[3]+G[3]));return f.lerp(e.create(),G,H,O)};I._clipTriangle=function(G,H,L){G=[G,H,L];for(H=0;4>H;++H){L=G;G=[];for(let O=0;O<L.length;++O){const S=L[O],R=
L[(O+1)%L.length];this._inside(R,H)?(this._inside(S,H)||G.push(this._intersect(S,R,H)),G.push(R)):this._inside(S,H)&&G.push(this._intersect(S,R,H))}}return G};return P}();const D=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],F=h.create(),E=m.create(),K=v.empty(),J=new u,M=new y,N=new w;a.DepthRangeFromRenderGeometries=y;a.depthRangeFromLayer=p;a.depthRangeFromScene=function(P,I,G){let H=0;if(!I.some(O=>{H+=O.numGeometries;return 1E4<=H}))return M.compute(P,
I);const L=v.empty();G.forAll(O=>{O.visible&&v.union(L,p(P,O))});return L};a.textureToDepth=function(P,I,G){return b.unpackFloatRGBA(I,P)*(G[1]-G[0])+G[0]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Evented ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D){a.MagnifierHelper=function(F){function E(){var J=F.apply(this,arguments)||this;J._handles=new m;J._magnifier=null;J._imageSources=null;J._imageLoadTask=null;J._resources=null;J._passParameters=new x.MagnifierPassParameters;J.events=new r;J.attributeLocations=new Map([[A.VertexAttribute.POSITION,0]]);J._tmpScreenPoint=g.createScreenPointArray();J._tmpRenderPoint=g.createRenderScreenPointArray();return J}c._inheritsLoose(E,F);var K=E.prototype;
K.destroy=function(){this._magnifier=null;this._handles.destroy();f.isSome(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()};K.render=function(J,M){const N=this._validMagnifier;if(!f.isNone(N)){var P=Math.ceil(M.camera.pixelRatio*N.size);this._updateResources(J,P);if(!f.isNone(this._resources)){var I=this._passParameters.textures;P=Math.ceil(1/this._factor*P);I.input.resize(P,P);g.screenPointObjectToArray(N.position,this._tmpScreenPoint);var G=
M.camera.screenToRender(this._tmpScreenPoint,this._tmpRenderPoint),H=M.camera.fullHeight,L=.5*P,O=.5*P;G[0]=d.clamp(G[0],L,M.camera.fullWidth-L-1);G[1]=d.clamp(G[1],O,H-O-1);H=Math.floor(G[0]-L);G=Math.floor(G[1]-O);O=this._resources.program;O.bindTexture("textureInput",I.input);J.gl.copyTexImage2D(I.input.descriptor.target,0,I.input.descriptor.pixelFormat,H,G,P,P,0);this._passParameters.magnifier=N;J.useProgram(O);O.bindPass(this._passParameters,M);J.bindVAO(this._resources.vao);J.setPipelineState(this._resources.pipelineState);
J.drawArrays(y.PrimitiveType.TRIANGLE_STRIP,0,4)}}};K._updateResourceLoading=function(){var J=this;const M=this._validMagnifier;if(!f.isNone(M)){var N=M.maskUrl,P=M.overlayUrl;!f.isSome(this._imageLoadTask)||this._imageLoadTask.maskUrl===N&&this._imageLoadTask.overlayUrl===P||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=null);f.isSome(this._imageSources)||f.isSome(this._imageLoadTask)||(this._imageLoadTask={maskUrl:N,overlayUrl:P,task:n.createTask(function(){var I=c._asyncToGenerator(function*(G){const H=
f.isNone(N)||f.isNone(P)?u.loadMagnifierResources(G):null,L=f.isSome(N)?p.requestImage(N,{signal:G}):H.then(O=>O.mask);G=f.isSome(P)?p.requestImage(P,{signal:G}):H.then(O=>O.overlay);J._imageSources={mask:yield L,overlay:yield G};J._disposeResources();J.events.emit("request-render")});return function(G){return I.apply(this,arguments)}}())},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}};K._updateResources=function(J,M){this.enabled?f.isSome(this._resources)?
this._passParameters.textures.size!==M&&(J=this._createTextureResources(J,M),f.isNone(J)?this._disposeResources():(this._disposeTextureResources(this._passParameters.textures),this._passParameters.textures=J)):(M=this._createTextureResources(J,M),f.isNone(M)||(this._resources={program:this._createProgram(J),vao:C.createQuadVAO(J,z.Pos2,this.attributeLocations,0,1),pipelineState:w.makePipelineState({blending:w.simpleBlendingParams(y.BlendFactor.ONE,y.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,
depthWrite:null,colorWrite:w.defaultColorWriteParams})},this._passParameters.textures=M)):this._disposeResources()};K._disposeResources=function(){f.isNone(this._resources)||(this._disposeTextureResources(this._passParameters.textures),this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};K._disposeTextureResources=function(J){J.mask.dispose();J.overlay.dispose();J.input.dispose()};K._createTextureResources=function(J,M){if(f.isNone(this._imageSources))return null;
this._imageSources.overlay.width=M;this._imageSources.overlay.height=M;this._imageSources.mask.width=M;this._imageSources.mask.height=M;const N=new D.Texture(J,{target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.RGBA,internalFormat:y.PixelFormat.RGBA,dataType:y.PixelType.UNSIGNED_BYTE,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:y.TextureSamplingMode.LINEAR,flipped:!0,preMultiplyAlpha:h.isSVG(this._imageSources.overlay.src)&&J.driverTest.svgPremultipliesAlpha.result?!1:!0},this._imageSources.overlay),
P=new D.Texture(J,{target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.ALPHA,internalFormat:y.PixelFormat.ALPHA,dataType:y.PixelType.UNSIGNED_BYTE,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:y.TextureSamplingMode.LINEAR,flipped:!0},this._imageSources.mask);return{input:new D.Texture(J,{target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.RGBA,internalFormat:y.PixelFormat.RGBA,dataType:y.PixelType.UNSIGNED_BYTE,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:y.TextureSamplingMode.LINEAR,
flipped:!1}),mask:P,overlay:N,size:M}};K._createProgram=function(J){return new B.Program(J,x.build(),this.attributeLocations)};c._createClass(E,[{key:"updating",get:function(){return f.isNone(this._imageSources)&&f.isSome(this._imageLoadTask)&&!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(J){J!==this._magnifier&&(this._handles.removeAll(),this._magnifier=J,J=()=>{this._updateResourceLoading();this.events.emit("request-render")},f.isSome(this._magnifier)&&
this._handles.add(e.watch(()=>f.applySome(this._magnifier,M=>M.version),J)),J())}},{key:"enabled",get:function(){return f.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return f.isSome(this._magnifier)&&this._magnifier.visible&&f.isSome(this._magnifier.position)&&0<this._magnifier.size?this._magnifier:null}},{key:"_factor",get:function(){return f.isSome(this._magnifier)?this._magnifier.factor||1:1}}]);return E}(t);b.__decorate([l.property()],a.MagnifierHelper.prototype,"_imageSources",
void 0);b.__decorate([l.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);b.__decorate([l.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=b.__decorate([k.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],a.MagnifierHelper);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderModules/BooleanPassUniform ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ../core/shaderModules/Texture2DPassUniform ../lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){let h=function(){},l=function(p){function z(){var C=p.apply(this,arguments)||this;C.textures=new h;return C}c._inheritsLoose(z,p);return z}(d.NoParameters);const v=b.createScreenPointArray(),q=b.createRenderScreenPointArray(),k=n.create();a.MagnifierPassParameters=l;a.TextureResources=h;a.build=function(){const p=new f.ShaderBuilder;p.attributes.add(g.VertexAttribute.POSITION,"vec2");p.vertex.uniforms.add(new m.Float4PassUniform("drawPosition",(z,C)=>{var B=C.camera.pixelRatio;
const A=z.magnifier.offset.x*B,x=z.magnifier.offset.y*B;b.screenPointObjectToArray(z.magnifier.position,v);const u=C.camera.screenToRender(v,q);z=Math.ceil(B*z.magnifier.size);B=C.camera.fullWidth;C=C.camera.fullHeight;return t.set(k,-1+(u[0]+A)/B*2,-1+(u[1]-x)/C*2,z/B*2,z/C*2)}));p.varyings.add("vUV","vec2");p.vertex.code.add(d.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);p.fragment.uniforms.add(new e.Texture2DPassUniform("textureInput",z=>z.textures.input));p.fragment.uniforms.add(new e.Texture2DPassUniform("textureMask",z=>z.textures.mask));p.fragment.uniforms.add(new e.Texture2DPassUniform("textureOverlay",z=>z.textures.overlay));p.fragment.uniforms.add(new r.BooleanPassUniform("maskEnabled",z=>z.magnifier.maskEnabled));p.fragment.uniforms.add(new r.BooleanPassUniform("overlayEnabled",z=>z.magnifier.overlayEnabled));p.fragment.code.add(d.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return p};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils","../../support/requestImageUtils"],function(a,c,b,t,n){function r(){r=b._asyncToGenerator(function*(d){var f=new Promise((g,h)=>a(["./mask-svg"],l=>g(m(l)),h)),e=new Promise((g,h)=>a(["./overlay-svg"],l=>g(m(l)),h));f=n.requestImage((yield f).default,{signal:d});e=n.requestImage((yield e).default,
{signal:d});e={mask:yield f,overlay:yield e};t.throwIfAborted(d);return e});return r.apply(this,arguments)}const m=d=>Object.freeze(Object.defineProperty({__proto__:null,default:d},Symbol.toStringTag,{value:"Module"}));c.loadMagnifierResources=function(d){return r.apply(this,arguments)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ObjectAndLayerIdRenderHelper":function(){define(["exports","../../../../core/Logger","../../../../chunks/vec4f64","../../../../geometry/support/buffer/BufferView"],
function(a,c,b,t){let n=function(){function r(){this.declaredClass="esri.views.3d.webgl-engine.lib.ObjectAndLayerIdRenderHelper";this.colorZero=new t.BufferViewVec4u8(new ArrayBuffer(4));this._uidToRenderColor=new Map;this._colorToUID=new Map;this._layerUidToGraphicsUidToObjectId=new Map;this._layerUidToId=new Map;this._layerUidToPopupEnabled=new Map}var m=r.prototype;m.setUidToObjectAndLayerId=function(d,f,e,g,h,l=null,v=null,q=null){d&&f&&e&&g&&(this._layerUidToId.set(g,e),this._layerUidToPopupEnabled.set(g,
h),h&&(e=this._layerUidToGraphicsUidToObjectId.get(g),e||(e=new Map,this._layerUidToGraphicsUidToObjectId.set(g,e)),e.set(f,{objectId:d,attributeNodeId:l,attributeIndex:v,subLayerId:q})))};m.getObjectAndLayerIdColor=function(d){d=this.getObjectAndLayerIdColorArray(d);return b.fromValues(d.get(0,1),d.get(0,2),d.get(0,3),255)};m.getObjectAndLayerIdColorArray=function(d){if(!d.layerUid||!d.graphicUid)return this.colorZero;var f=this._layerUidToPopupEnabled.get(d.layerUid);if(void 0===f)return c.getLogger(this.declaredClass).warn("popupEnabled is undefined for layerUid "+
d.layerUid),this.colorZero;if(!1===f)return this.colorZero;let e=this._uidToRenderColor.get(d.layerUid);e||(e=new Map,this._uidToRenderColor.set(d.layerUid,e));f=e.get(d.graphicUid);if(!f){for(;!f;){const g=Math.floor(16777214*Math.random())+1;this._colorToUID.has(g)||(f=g)}if(16777215<f)throw Error("Object ID Overflow");e.set(d.graphicUid,f);this._colorToUID.set(f,d)}d=new ArrayBuffer(4);(new DataView(d)).setUint32(0,f,!1);return new t.BufferViewVec4u8(d)};m.getColorToObjectAndLayerIdMapping=function(){const d=
new Map;for(const [e,g]of this._colorToUID.entries()){var f=this._layerUidToGraphicsUidToObjectId.get(g.layerUid);let h=null;f?(h=f.get(g.graphicUid))||c.getLogger(this.declaredClass).warn("getColorMapping: no entry found for graphicsId "+g.graphicUid):c.getLogger(this.declaredClass).warn("getColorMapping: no entry found for layerUid "+g.layerUid);(f=this._layerUidToId.get(g.layerUid))||c.getLogger(this.declaredClass).warn("no layerId found for uid "+g.layerUid);h&&f&&d.set(e,h.attributeNodeId?{type:"object-and-layer-and-i3s-id",
oid:h.objectId,lid:f,attrId:h.attributeNodeId,attrIdx:h.attributeIndex,subLayerId:h.subLayerId}:{type:"object-and-layer-id",oid:h.objectId,lid:f})}return d};return r}();a.ObjectAndLayerIdRenderHelper=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/has ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/boundedPlane ../../support/debugFlags ../../terrain/TerrainRenderer ../core/renderPasses/RenderPassManager ../core/shaderLibrary/ShaderOutput ../core/shaderLibrary/hud/HUDUniforms ./AnimationTimeStep ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./glUtil3D ./Highlight ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderFeature ./RenderPluginManager ./RenderSlot ./ShadowAccumulator ./ShadowHighlight ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./TransparencyPassType ./edgeRendering/EdgeView ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../shaders/CompositingTechniqueConfiguration ../statistics/RendererPerformanceInfo ../../../support/RenderState ../../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V,aa,X,W,T,U,Y,ba){a.Renderer=function(ia){function Z(fa,ka,la,na,pa,va,wa,za){var sa=ia.call(this,{})||this;sa._stage=fa;sa._materialRepository=ka;sa._shaderTechniqueRepository=na;sa._rctx=pa;sa._compositingHelper=va;sa._magnifierHelper=wa;sa._requestRender=za;sa._materialRenderers=new f;sa._needsTransparentPass=!1;sa._hasHUDElements=!1;sa._hasHighlights=!1;sa._hasWater=!1;sa._hasOverlayWater=!1;sa._renderOverlay=
ua=>{};sa._isRendering=!1;sa._fallbackDepthStencilTexture=null;sa._sliceHelper=new S;sa._state=Y.RenderState.IDLE;sa._renderStateFeatures=P.setupFeatureDefaults();sa._antialiasingEnabled=!0;sa._highQualityTransparencyEnabled=!0;sa._terrainRenderingEnabled=!0;sa._terrainTransparency=z.TransparencyMode.Opaque;sa._waterReflectionEnabled=!1;sa._ssaoEnabled=!1;sa._hasAnimations=!1;sa._animationTimestep=new x.AnimationTimeStep;sa._handles=new r;sa._renderHiddenTransparentEdges=()=>{};sa._oitUsed=!1;sa._smaaPass=
new R.SmaaRenderPass(sa._rctx,na);za();sa._offscreen=new J.OffscreenRendering(sa._rctx,sa._compositingHelper);sa.performanceInfo=new U.RendererPerformanceInfo(sa._rctx);sa._shadowMap=new O.ShadowMap(sa._rctx,fa.viewingMode);sa._ssaoHelper=new Q.SSAOHelper(fa.view,na,sa._rctx,za);sa._highlight=new E.Highlight(na,sa._rctx);sa._shadowHighlight=new L.ShadowHighlight(sa._rctx,fa.viewingMode);sa._shadowAccumulator=new H.ShadowAccumulator(sa._rctx,na,fa,ua=>{const oa=sa.shadowsEnabled;sa._shadowMap.enabled=
!0;sa._prepare(ua.camera,ua.contentCamera);sa._renderPlugins.prepareRender();sa._shadowMap.enabled=oa},(ua,oa,xa)=>{ua.shadowMap.start(ua.camera,oa,xa);sa._renderShadowCascades(B.ShaderOutput.Shadow,ua.shadowMap);ua.camera.setGLViewport(sa._rctx);sa._prepare(ua.camera,ua.contentCamera)},za);sa._renderContext=new M.RenderContext(sa._rctx,sa._offscreen,sa._shadowMap,sa._ssaoHelper,sa._sliceHelper);sa._renderPlugins=new I.RenderPluginManager({renderContext:sa._renderContext,techniqueRepository:na,textureRepository:la,
materialRepository:sa._materialRepository,requestRender:za,controller:fa});sa.renderPassManager=new C.RenderPassManager(sa._rctx,sa._shaderTechniqueRepository);sa._renderPlugins.add(sa.renderPassManager.slots(),sa.renderPassManager);sa._handles.add([e.watch(()=>sa._stage.view.state.camera,()=>za(),e.syncAndInitial),e.watch(()=>p.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,ua=>{sa._renderHiddenTransparentEdges=ua?()=>sa._renderEdges(X.Transparency.TRANSPARENT):()=>{};za()},e.initial),e.watch(()=>sa._ssaoEnabled||
sa.isFeatureEnabled(P.RenderFeature.SSAO),ua=>sa._ssaoHelper.enabled=ua,e.syncAndInitial)]);return sa}c._inheritsLoose(Z,ia);var ha=Z.prototype;ha.isFeatureEnabled=function(fa,ka=this._state){return d.unwrapOr(this._renderStateFeatures.get(ka,fa),!1)};ha.setFeatureEnabled=function(fa,ka,la){this._renderStateFeatures.set(ka,fa,la);this.notifyChange("_renderStateFeatures");this._requestRender()};ha.normalizeCtorArgs=function(){return{}};ha.destroy=function(){this._handles.destroy();this._smaaPass.dispose();
this._gpuTimerHandle=d.removeMaybe(this._gpuTimerHandle);this._materialRenderers.forAll(fa=>fa.dispose());this._materialRenderers.clear();this._offscreen.dispose();this._fallbackDepthStencilTexture=d.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap.dispose();this._ssaoHelper.dispose();this._highlight.dispose();this._shadowHighlight.dispose();this._shadowAccumulator.dispose();y.BoundingInfo.prune()};ha.disposeOffscreenBuffers=function(){this._offscreen.dispose();this._shadowMap.disposeOffscreenBuffers();
this._smaaPass.disable();this._ssaoHelper.disposeOffscreenBuffers()};ha.ensureEdgeView=function(){d.isNone(this._edgeView)&&(this._edgeView=new aa.EdgeView({rctx:this._rctx,renderSR:this._stage.view.renderSpatialReference,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,setNeedsRender:()=>this._requestRender(),schedule:fa=>this._stage.view.resourceController.immediate.schedule(fa)}),this._handles.add(e.watch(()=>d.applySome(this._edgeView,fa=>fa.updating),()=>
this._requestRender(),e.sync)),this._requestRender());return this._edgeView};ha.setParameters=function(fa){const {_shadowMap:ka,_bindParameters:la}=this;void 0!==fa.screenSpaceReflectionsEnabled&&la.ssr.enabled!==fa.screenSpaceReflectionsEnabled&&(la.ssr.enabled=fa.screenSpaceReflectionsEnabled,this._requestRender());void 0!==fa.shadowMap&&this._shadowMap.enabled!==fa.shadowMap&&(this._shadowMap.enabled=fa.shadowMap,this._requestRender());void 0!==fa.shadowMapMaxCascades&&ka.maxCascades!==fa.shadowMapMaxCascades&&
(ka.maxCascades=fa.shadowMapMaxCascades,this._requestRender());if(d.isSome(fa.environment)){d.isSome(fa.environment.weather)&&(this._bindParameters.weather=fa.environment.weather,this._bindParameters.weatherVisible=!!fa.weatherVisible);void 0!==fa.environment.lighting.ambientOcclusionEnabled&&this._ssaoEnabled!==fa.environment.lighting.ambientOcclusionEnabled&&(this._ssaoEnabled=fa.environment.lighting.ambientOcclusionEnabled,this._requestRender());void 0!==fa.environment.lighting.waterReflectionEnabled&&
this._waterReflectionEnabled!==fa.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=fa.environment.lighting.waterReflectionEnabled,this._requestRender());const na="virtual"!==fa.environment.lighting.type;la.enableFillLights!==na&&(la.enableFillLights=na,this._requestRender())}fa.background&&this._offscreen.background!==fa.background&&(this._offscreen.background=fa.background,this._requestRender());void 0!==fa.antialiasingEnabled&&this._antialiasingEnabled!==fa.antialiasingEnabled&&
(this._antialiasingEnabled=fa.antialiasingEnabled,this._requestRender());void 0!==fa.highQualityTransparency&&this._highQualityTransparencyEnabled!==fa.highQualityTransparency&&(this._highQualityTransparencyEnabled=fa.highQualityTransparency,this._requestRender());void 0!==fa.defaultHighlightOptions&&(this._highlight.setDefaultOptions(fa.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(fa.defaultHighlightOptions),this._requestRender());void 0!==fa.overlays&&this._bindParameters.overlays!==
fa.overlays&&(this._bindParameters.overlays=fa.overlays,this._requestRender());void 0!==fa.hasOverlayWater&&this._hasOverlayWater!==fa.hasOverlayWater&&(this._hasOverlayWater=fa.hasOverlayWater,this._requestRender());void 0!==fa.renderOverlay&&this._renderOverlay!==fa.renderOverlay&&(this._renderOverlay=fa.renderOverlay,this._requestRender());void 0!==fa.slicePlane&&this._sliceHelper.plane!==fa.slicePlane&&(this._sliceHelper.plane=d.unwrap(fa.slicePlane),this._requestRender());void 0!==fa.terrainRenderingEnabled&&
this._terrainRenderingEnabled!==fa.terrainRenderingEnabled&&(this._terrainRenderingEnabled=fa.terrainRenderingEnabled,this._requestRender());void 0!==fa.terrainTransparency&&this._terrainTransparency!==fa.terrainTransparency&&(this._terrainTransparency=fa.terrainTransparency,this._requestRender());void 0!==fa.shadowCastOptions&&this._shadowAccumulator.setOptions(fa.shadowCastOptions)};ha.modify=function(fa,ka){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:la,
removes:na,updates:pa}=fa;if(0!==la.length||0!==na.length||0!==pa.length){var va=!1;N.splitRenderGeometryChangeSetByMaterial(fa).forEach((wa,za)=>{if(!ka.done){var sa=this._materialRenderers.find(ua=>ua.material===za);d.isNone(sa)&&0<wa.adds.length&&(sa=new W.MergedRenderer(this._rctx,this._materialRepository,za),this._materialRenderers.push(sa));sa&&(sa.modify(wa),sa.isEmpty&&(va=!0));wa.removes.forEach(ua=>fa.removes.removeUnordered(ua));wa.adds.forEach(ua=>fa.adds.removeUnordered(ua));wa.updates.forEach(ua=>
fa.updates.removeUnordered(ua));ka.madeProgress()}});va&&this._materialRenderers.filterInPlace(wa=>wa.isEmpty?(wa.dispose(),!1):!0);this._hasHighlights=this._materialRenderers.some(wa=>wa.hasHighlights);this._bindParameters.hasOccludees=this._materialRenderers.some(wa=>wa.hasOccludees);this._hasWater=this._materialRenderers.some(wa=>wa.hasWater);this._hasHUDElements=this._materialRenderers.some(wa=>wa.requiresSlot(G.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,B.ShaderOutput.Color)||wa.requiresSlot(G.RenderSlot.HUD_MATERIAL,
B.ShaderOutput.Color)||wa.requiresSlot(G.RenderSlot.LABEL_MATERIAL,B.ShaderOutput.Color));this._requestRender()}};ha.updateAnimation=function(fa){const ka=this._hasAnimations;this._hasAnimations=!1;this._materialRenderers.forAll(la=>this._hasAnimations=la.updateAnimation(fa)||this._hasAnimations);this._hasAnimations=this._renderPlugins.updateAnimation(fa)||this._hasAnimations;this._hasAnimations!==ka&&(this._gpuTimerHandle=ka?d.removeMaybe(this._gpuTimerHandle):this.performanceInfo.enableGPUPerformanceInfo());
return this._hasAnimations};ha.resetAnimation=function(){this._animationTimestep.clear()};ha.render=function(fa,ka,la,na,pa){this._isRendering=!0;this.performanceInfo.startFrame();const {camera:va,contentCamera:wa,mode:za}=la;this._state=za;this._renderOverlay(pa);this.performanceInfo.advance(U.PerformanceCategory.OVERLAY);this._renderContext.time=pa;this._bindParameters.transparencyPassType=V.TransparencyPassType.NONE;var sa=this._offscreen;sa.setupRenderTarget(this.hasWaterReflection);la=k.create(this._sliceHelper.plane);
na===u.Decorations.OFF&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(fa);va.setGLViewport(this._rctx);this._prepare(va,wa);this._renderPlugins.prepareRender();this.performanceInfo.advance(U.PerformanceCategory.PREPARE);var ua=this._computeDepthRange(va);this._renderShadowMap(fa,va,this._bindParameters.lighting.mainLight.direction,ua);this.performanceInfo.advance(U.PerformanceCategory.SHADOW_MAP);sa.initializeFrame(va);this._ensureBindParameters(va,wa);this._renderLinearDepth();this.performanceInfo.advance(U.PerformanceCategory.LINEAR_DEPTH);
this._accumulateShadows(ua,va,wa);this.performanceInfo.advance(U.PerformanceCategory.ACCUMULATED_SHADOWS);this._renderNormal();this.performanceInfo.advance(U.PerformanceCategory.NORMALS);this._ensureBindParametersSSR(pa);this._renderSSAO(pa);this.performanceInfo.advance(U.PerformanceCategory.SSAO);this._renderContext.output=B.ShaderOutput.Color;sa.bindFramebuffer();this._renderOpaqueGeometry();this.performanceInfo.advance(U.PerformanceCategory.OPAQUE);pa=this._terrainRenderingEnabled&&(this._terrainTransparency===
z.TransparencyMode.Semitransparent||this._terrainTransparency===z.TransparencyMode.TransparentWithDraped);ua=this._highQualityTransparency&&pa;this._renderTerrainLinearDepth(ua);this._setMultipassEnabled(ua);this._setTerrainCulling(ua);this._renderEdges(X.Transparency.OPAQUE);this.performanceInfo.advance(U.PerformanceCategory.OPAQUE_EDGES);this._offscreen.bindTarget(this._offscreen.currentColorTarget,this._offscreen.mainDepth);this._renderSlot(G.RenderSlot.VOXEL);this.performanceInfo.advance(U.PerformanceCategory.VOXEL);
this._renderHiddenTransparentEdges();const oa=this._needsTransparentPass||this._renderPlugins.needsTransparentPass;oa&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry());this.performanceInfo.advance(U.PerformanceCategory.TRANSPARENT);this._renderGeometryLinearDepth(ua);const xa=this._renderHUDVisibility(ua);ua||this._renderInternalSlot(G.RenderSlot.LINE_CALLOUTS);this.performanceInfo.advance(U.PerformanceCategory.HUD_VISIBILITY);
this._renderObjectAndLayerIdColor(ka);this.performanceInfo.advance(U.PerformanceCategory.OBJECT_AND_LAYER_ID_COLOR);this._renderEdges(X.Transparency.TRANSPARENT,ua);this.performanceInfo.advance(U.PerformanceCategory.TRANSPARENT_EDGES);this._renderTransparentTerrain();pa&&xa&&(ua?this._renderLineCallouts(A.HUDTransparentRenderStyle.Occluded):sa.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(A.HUDTransparentRenderStyle.Occluded,sa.framebuffer),this.performanceInfo.advance(U.PerformanceCategory.HUD_OCCLUDED));
this.performanceInfo.advance(U.PerformanceCategory.TRANSPARENT_TERRAIN);this._setTerrainCulling(!1);pa&&(sa.compositeTransparentTerrainOntoMain(this._bindParameters),ua&&(this._renderEdges(X.Transparency.OPAQUE),this.performanceInfo.advance(U.PerformanceCategory.OPAQUE_EDGES),oa&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(U.PerformanceCategory.TRANSPARENT),this._renderEdges(X.Transparency.TRANSPARENT),
this.performanceInfo.advance(U.PerformanceCategory.TRANSPARENT_EDGES)));ua&&this._renderLineCallouts(A.HUDTransparentRenderStyle.NotOccluded);this._setMultipassEnabled(!1);this._shadowAccumulator.render(this._bindParameters);sa.renderToTargets(()=>{this._renderInternalSlot(G.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._renderSlot(G.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT);this._renderSlot(G.RenderSlot.LASERLINES)},sa.currentColorTarget,sa.mainDepth);this.performanceInfo.advance(U.PerformanceCategory.ENVIRONMENT);
this._renderPlugins.needsLaserlineWithContrastControl&&sa.renderTmpAndCompositeToMain(()=>this._renderSlot(G.RenderSlot.LASERLINES_CONTRAST_CONTROL),this._bindParameters,T.AlphaMode.PremultipliedAlpha);this.performanceInfo.advance(U.PerformanceCategory.LASER_LINE);this._renderOccluded();this.performanceInfo.advance(U.PerformanceCategory.OCCLUDED);na=(ka=na===u.Decorations.ON&&this._magnifierHelper.enabled)&&d.isNone(fa)?this._offscreen.getFramebuffer(this._offscreen.tmpColor,this._offscreen.tmpDepth):
fa;this._rctx.bindFramebuffer(na);sa=this._offscreen.colorTexture;!this._renderAntiAliasing(sa)&&d.isSome(sa)&&this._compositingHelper.composite(this._bindParameters,sa,T.AlphaMode.None);this.performanceInfo.advance(U.PerformanceCategory.ANTIALIASING);this._renderHUD(A.HUDTransparentRenderStyle.NotOccluded,na);this.performanceInfo.advance(U.PerformanceCategory.HUD);this._renderHighlights(na,this._bindParameters);this.performanceInfo.advance(U.PerformanceCategory.HIGHLIGHTS);ka&&this._magnifierHelper.render(this._rctx,
this._bindParameters);na!==fa&&(this._rctx.bindFramebuffer(fa),this._compositingHelper.composite(this._bindParameters,this._offscreen.tmpColorTexture,T.AlphaMode.None));this._disposeOITBuffers();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);this._sliceHelper.plane=la;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.finishFrame()};ha._renderObjectAndLayerIdColor=function(fa){if(d.isSome(fa)&&m("enable-feature:objectAndLayerId-rendering")){const ka=
this._renderContext.output;this._rctx.bindFramebuffer(fa);this._offscreen.renderToFBO(()=>this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.ObjectAndLayerIdColor),[0,0,0,0],!0,!0);this._rctx.bindFramebuffer(fa);this._offscreen.renderToFBO(()=>{this._bindParameters.renderTransparentlyOccludedHUD=A.HUDTransparentRenderStyle.NotOccluded;this._renderInternalSlot(G.RenderSlot.HUD_MATERIAL)},void 0,!0,!0);this._renderContext.output=ka}};ha.finish=function(fa){this._hasAnimations||this._animationTimestep.clear();
var ka=this.performanceInfo.gpuSamplingEnabled;if((fa=fa===u.RenderRequestType.BACKGROUND)||ka){const la=fa?this.performanceInfo.elapsedTime:0;ka=ka?this.performanceInfo.totalGPUTimeSampler.last:this._rctx.gl.getError();this._animationTimestep.frame(Math.max(la,ka),fa)}};ha.readDepthPixels=function(fa,ka,la){const na=this._offscreen.bindTarget(this._offscreen.linearDepth,this._offscreen.tmpDepth);this._needsLinearDepth||(this._ensureBindParameters(fa,fa),this._bindParameters.camera.setGLViewport(this._rctx),
this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(ba.ClearBufferBit.COLOR_BUFFER_BIT|ba.ClearBufferBit.DEPTH_BUFFER_BIT|ba.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.Depth));na.readPixels(ka[0],ka[1],ka[2],ka[3],ba.PixelFormat.RGBA,ba.PixelType.UNSIGNED_BYTE,la)};ha.readHUDVisibility=function(fa,ka,la,na,pa){this._offscreen.bindTarget(this._offscreen.hudVisibility).readPixels(fa,ka,la,na,ba.PixelFormat.RGBA,ba.PixelType.UNSIGNED_BYTE,pa)};
ha.readAccumulatedShadow=function(fa){return this._shadowAccumulator.readAccumulatedShadow(fa[0],fa[1])};ha._setMultipassEnabled=function(fa){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=fa};ha._setTerrainCulling=function(fa){this._bindParameters.multipassTerrain.cullAboveGround=fa};ha._renderSlot=function(fa){this._bindParameters.slot=fa;this._renderPlugins.render()};ha._renderEdges=function(fa,ka=!1){const la=this._edgeView;d.isSome(la)&&la.shouldRender()&&
this._offscreen.renderTmpAndCompositeToMain(()=>la.render(this._bindParameters,fa),this._bindParameters,T.AlphaMode.Alpha,ka)};ha._renderShadowMap=function(fa,ka,la,na){const pa=this._shadowMap;pa.enabled&&this.isFeatureEnabled(P.RenderFeature.ShadowMapUpdate)&&(pa.start(ka,la,na),this._shadowHighlight.updateParameters(ka,la),this._needsShadowHighlight?(this._renderShadowCascades(B.ShaderOutput.ShadowHighlight,this._shadowMap,va=>pa.takeCascadeSnapshotTo(va,O.SnapshotSlot.Highlight)),pa.clear(),this._renderShadowCascades(B.ShaderOutput.ShadowExcludeHighlight,
this._shadowMap,va=>{pa.takeCascadeSnapshotTo(va,O.SnapshotSlot.Default);this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.ShadowHighlight)})):this._renderShadowCascades(B.ShaderOutput.Shadow),pa.finish(fa),ka.setGLViewport(this._rctx))};ha._renderShadowCascades=function(fa,ka=this._shadowMap,la=na=>{}){for(const na of ka.cascades)na.camera.setGLViewport(this._rctx),this._prepare(na.camera,na.camera),this._renderGeometryAndTransparentTerrainPass(fa),la(na)};ha._renderLinearDepth=function(){this._needsLinearDepth?
this._offscreen.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.Depth),this._offscreen.linearDepth,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.linearDepth);this._bindParameters.linearDepthTexture=this._offscreen.linearDepthTexture};ha._renderTerrainLinearDepth=function(fa){fa?(fa=this._renderContext.output,this._renderContext.output=B.ShaderOutput.Depth,this._offscreen.renderToTargets(()=>this._renderTransparentTerrain(),
this._offscreen.terrainLinearDepth,this._offscreen.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),this._renderContext.output=fa):this._offscreen.disposeTarget(this._offscreen.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreen.terrainLinearDepthTexture};ha._renderGeometryLinearDepth=function(fa){fa?(fa=this._renderContext.output,this._offscreen.renderToTargets(()=>this._renderGeometryPass(B.ShaderOutput.Depth),this._offscreen.geometryLinearDepth,this._offscreen.tmpDepth,
[1,1,1,1],!0,!0),this._renderContext.output=fa):this._offscreen.disposeTarget(this._offscreen.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreen.geometryLinearDepthTexture};ha._renderNormal=function(){this._needsNormal?this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.Normal)},this._offscreen.normal,this._offscreen.tmpDepth,[0,0,0,0],!0,!0):this._offscreen.disposeTarget(this._offscreen.normal)};ha._computeDepthRange=
function(fa){if(!this._needsDepthRange)return w.ZERO;const ka=D.depthRangeFromScene(fa,this._materialRenderers,this._stage.layers);w.union(ka,this.renderPlugins.queryDepthRange(fa));ka.near=Math.max(fa.near,ka.near);ka.far=Math.min(fa.far,ka.far);return ka};ha._renderGeometryAndTransparentTerrainPass=function(fa){this._renderContext.output=fa;this._renderGeometryPass(fa);this._renderTransparentTerrain()};ha._renderGeometryPass=function(fa){this._renderContext.output=fa;this._renderOpaqueGeometry();
this._renderTransparentGeometry()};ha._renderSSAO=function(fa){this._ssaoHelper.render(this._bindParameters,fa,this._offscreen.linearDepthTexture,this._offscreen.normalTexture)};ha._renderOpaqueGeometry=function(){this._renderSlot(G.RenderSlot.INTEGRATED_MESH);this._renderSlot(G.RenderSlot.OPAQUE_TERRAIN);this._renderInternalSlot(G.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(G.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(G.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE)};ha._renderTransparentGeometry=
function(){this._renderInternalSlot(G.RenderSlot.TRANSPARENT_MATERIAL);this._renderSlot(G.RenderSlot.TRANSPARENT_MATERIAL)};ha._renderTransparentTerrain=function(){this._renderSlot(G.RenderSlot.TRANSPARENT_TERRAIN)};ha._renderHUDVisibility=function(fa){let ka=!1;this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture;ka=this._renderInternalSlot(G.RenderSlot.OCCLUSION_PIXELS)},
fa);return ka};ha._renderLineCallouts=function(fa){this._bindParameters.renderTransparentlyOccludedHUD=fa;fa===A.HUDTransparentRenderStyle.Occluded?this._offscreen.renderToTargets(()=>this._renderInternalSlot(G.RenderSlot.LINE_CALLOUTS),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderInternalSlot(G.RenderSlot.LINE_CALLOUTS)};ha._renderHUD=function(fa,ka){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(fa),
!0),this._rctx.bindFramebuffer(ka),this._compositingHelper.composite(this._bindParameters,this._offscreen.hudColorTexture,T.AlphaMode.PremultipliedAlpha)):fa===A.HUDTransparentRenderStyle.Occluded?this._offscreen.renderToTargets(()=>this._renderHUDElements(A.HUDTransparentRenderStyle.Occluded),this._offscreen.currentColorTarget,this._offscreen.tmpDepth,void 0,!0,!0):this._renderHUDElements(fa))};ha._renderHUDElements=function(fa){this._bindParameters.renderTransparentlyOccludedHUD=fa;this._renderInternalSlot(G.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);
this._renderInternalSlot(G.RenderSlot.HUD_MATERIAL);this._renderInternalSlot(G.RenderSlot.LABEL_MATERIAL)};ha._renderHighlights=function(fa,ka){if(this._needsHighlight){var la=this._highlight,na=this._offscreen.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(B.ShaderOutput.Highlight);this._rctx.clearSafe(ba.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(A.HUDTransparentRenderStyle.Both)},this._offscreen.highlight,this._offscreen.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=
na.colorTexture;this._needsShadowHighlight&&this._shadowHighlight.render(ka,fa);la.render(this._bindParameters,na,fa)}else this._offscreen.disposeTarget(this._offscreen.highlight)};ha._accumulateShadows=function(fa,ka,la){this._needsShadowCast&&d.isSome(this._offscreen.linearDepthTexture)&&this._shadowAccumulator.renderAccumulation(this._offscreen.linearDepthTexture,fa,ka,la)};ha._renderOrderIndependentTransparency=function(fa,ka){const la=pa=>{this._bindParameters.transparencyPassType=pa;this._offscreen.renderOITPass(()=>
fa(),pa,ka)},na=this._renderContext.output;this._renderContext.output=B.ShaderOutput.Alpha;la(V.TransparencyPassType.Alpha);this._renderContext.output=B.ShaderOutput.Color;la(V.TransparencyPassType.Color);la(V.TransparencyPassType.FrontFace);this._offscreen.compositeTransparentOntoOpaque(this._bindParameters,ka);this._bindParameters.transparencyPassType=V.TransparencyPassType.NONE;this._renderContext.output=na;this._oitUsed=!0};ha._disposeOITBuffers=function(){this._oitUsed||(this._offscreen.disposeTarget(this._offscreen.alphaFloatTarget),
this._offscreen.disposeTarget(this._offscreen.colorFloatTarget),this._offscreen.disposeTarget(this._offscreen.frontFaceTarget));this._oitUsed=!1};ha._renderOccluded=function(){let fa=0;da.clear();this._materialRenderers.forAll(va=>{va.material&&va.material.isVisible()&&va.material.renderOccluded===K.RenderOccludedFlag.OccludeAndTransparentStencil&&(fa|=va.material.renderOccluded,da.push(va))});const ka=this._offscreen,la=(va,wa,za,sa,ua)=>{0!==(fa&wa)&&(ka.renderToTargets(za,ka.tmpColor,ka.mainDepth,
[0,0,0,0],sa,ua),ka.compositeOccludedOntoMain(this._bindParameters,va))};0!==da.length&&(this._renderInternalSlot(G.RenderSlot.OCCLUDER_MATERIAL,da),la(.5,K.RenderOccludedFlag.OccludeAndTransparentStencil,()=>this._renderInternalSlot(G.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,da),!1,!1));da.clear();this._materialRenderers.forAll(va=>{va.material&&va.material.isVisible()&&(va.material.renderOccluded===K.RenderOccludedFlag.OccludeAndTransparent||va.material.renderOccluded===K.RenderOccludedFlag.Transparent||
va.material.renderOccluded===K.RenderOccludedFlag.Opaque)&&(fa|=va.material.renderOccluded,da.push(va))});const na=this._renderPlugins.renderOccludedFlags;if(fa|=na){var pa=va=>{this._renderContext.renderOccludedMask=va;na>K.RenderOccludedFlag.Occlude&&this._renderSlot(G.RenderSlot.OCCLUDED_TERRAIN);this._renderInternalSlot(G.RenderSlot.OPAQUE_MATERIAL,da);this._renderInternalSlot(G.RenderSlot.TRANSPARENT_MATERIAL,da);this._renderInternalSlot(G.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,
da);this._renderContext.resetRenderOccludedMask()};this._renderContext.output=B.ShaderOutput.Color;la(.5,K.RenderOccludedFlag.OccludeAndTransparent,()=>pa(K.RenderOccludedFlag.OccludeAndTransparent),!0,u.StencilBits.OutlineVisualElementMask);la(.5,K.RenderOccludedFlag.Transparent,()=>pa(K.RenderOccludedFlag.Transparent),!0,u.StencilBits.OutlineVisualElementMask);la(1,K.RenderOccludedFlag.Opaque,()=>pa(K.RenderOccludedFlag.Opaque),!0,u.StencilBits.OutlineVisualElementMask);da.clear()}};ha._renderAntiAliasing=
function(fa){if(this._antialiasing){if(this._smaaPass.enable(()=>this._requestRender())&&d.isSome(fa))return this._smaaPass.render(fa),!0}else this._smaaPass.disable();return!1};ha._prepare=function(fa,ka){this._needsTransparentPass=this._materialRenderers.some(la=>la.requiresSlot(G.RenderSlot.TRANSPARENT_MATERIAL,B.ShaderOutput.Color));this._bindParameters.camera=fa;this._bindParameters.contentCamera=ka};ha._ensureBindParameters=function(fa,ka){this._bindParameters.camera=fa;this._bindParameters.contentCamera=
ka;fa=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=fa.hudVisibilityTexture;this._bindParameters.mainColorTexture=fa.mainColorTexture;this._bindParameters.highlightDepthTexture=fa.depthTexture??this._getFallbackDepthTexture()};ha._ensureBindParametersSSR=function(fa){this._bindParameters.ssr.enabled=this.hasWaterReflection;if(this._bindParameters.ssr.enabled){d.isNone(this._waterReflectionEnableTime)&&(this._waterReflectionEnableTime=fa);this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?
this._reprojectionMatrix=q.IDENTITY:(v.invert(ca,this._bindParameters.camera.viewMatrix),v.invert(ea,this._bindParameters.camera.projectionMatrix),v.multiply(ja,ca,ea),v.multiply(ja,this._renderContext.lastFrameCamera.viewMatrix,ja),v.multiply(ja,this._renderContext.lastFrameCamera.projectionMatrix,ja),this._reprojectionMatrix=ja);this._bindParameters.ssr.lastFrameColorTexture=this._offscreen.lastFrameColorTexture;const ka=this._stage.view.qualitySettings.fadeDuration;this._bindParameters.ssr.fadeFactor=
0<ka?Math.min(ka,fa-this._waterReflectionEnableTime)/ka:1;1>this._bindParameters.ssr.fadeFactor&&this._requestRender()}else this._waterReflectionEnableTime=this._bindParameters.ssr.lastFrameColorTexture=null};ha._renderInternalSlot=function(fa,ka=this._materialRenderers){let la=!1;this._bindParameters.slot=fa;ka.forAll(na=>{na.material.shouldRender(this._renderContext)&&na.render(this._renderContext.output,this._bindParameters)&&(la=!0)});return la};ha._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||
(this._fallbackDepthStencilTexture=F.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};c._createClass(Z,[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},{key:"_antialiasing",get:function(){return this._antialiasingEnabled||this.isFeatureEnabled(P.RenderFeature.Antialiasing)}},{key:"_highQualityTransparency",get:function(){return this._highQualityTransparencyEnabled||this.isFeatureEnabled(P.RenderFeature.HighQualityTransparency)}},{key:"hasWaterReflection",
get:function(){return this.hasWater&&(this._waterReflectionEnabled||this.isFeatureEnabled(P.RenderFeature.WaterReflection))}},{key:"hasWater",get:function(){return this._hasWater||this._hasOverlayWater}},{key:"updating",get:function(){return this._antialiasing&&this._smaaPass.updating||d.isSome(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}},{key:"edgeView",get:function(){return this._edgeView}},{key:"isCameraFinal",get:function(){return v.equals(this._bindParameters.ssr.reprojectionMatrix,
q.IDENTITY)}},{key:"_reprojectionMatrix",set:function(fa){n.update(this._bindParameters.ssr.reprojectionMatrix,fa)&&this.notifyChange("isCameraFinal")}},{key:"shadowsEnabled",get:function(){return!!this._shadowMap?.enabled}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"_hasOITSupport",get:function(){return this._rctx.driverTest.floatBufferBlend.result}},{key:"_oitEnabled",get:function(){return this._highQualityTransparency&&
this._hasOITSupport}},{key:"animationTimestep",get:function(){return this._animationTimestep.value}},{key:"animationTimeDilation",get:function(){return this._animationTimestep.timeDilation}},{key:"_needsLinearDepth",get:function(){return this._ssaoHelper.active||this._renderPlugins.needsLinearDepth||this.hasWaterReflection||this._needsShadowHighlight||this._needsShadowCast}},{key:"_needsNormal",get:function(){return this._ssaoHelper.active}},{key:"_needsDepthRange",get:function(){return this._shadowMap.enabled||
this._needsShadowCast}},{key:"_needsHighlight",get:function(){return this._hasHighlights||this._renderPlugins.needsHighlight}},{key:"_needsShadowHighlight",get:function(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this._needsHighlight}},{key:"_needsShadowCast",get:function(){return this._shadowAccumulator.isAccumulating}},{key:"gpuMemoryUsage",get:function(){return{offscreen:this._offscreen?.gpuMemoryUsage??0,highlights:(this._highlight?.gpuMemoryUsage??0)+(this._shadowHighlight?.gpuMemoryUsage??
0),shadows:this._shadowMap?.gpuMemoryUsage??0,ssao:this._ssaoHelper?.gpuMemoryUsage??0}}},{key:"test",get:function(){const fa=this;return{offscreen:this._offscreen,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,weatherIsFading:this._bindParameters.cloudsFade.isFading,resetRenderStateFeatures:()=>{fa._renderStateFeatures=P.setupFeatureDefaults()},getFramebufferTexture:ka=>
{switch(ka){case a.FramebufferId.Color:return fa._offscreen.colorTexture;case a.FramebufferId.LinearDepth:return fa._offscreen.linearDepthTexture;case a.FramebufferId.Normals:return fa._offscreen.normalTexture;case a.FramebufferId.ShadowMap:return fa._shadowMap.depthTexture;case a.FramebufferId.HudVisibility:return fa._offscreen.hudVisibilityTexture;case a.FramebufferId.Highlight:return fa._offscreen.highlightTexture}}}}}]);return Z}(t);b.__decorate([g.property()],a.Renderer.prototype,"_shadowAccumulator",
void 0);b.__decorate([g.property()],a.Renderer.prototype,"_state",void 0);b.__decorate([g.property()],a.Renderer.prototype,"_renderStateFeatures",void 0);b.__decorate([g.property()],a.Renderer.prototype,"_antialiasingEnabled",void 0);b.__decorate([g.property({readOnly:!0})],a.Renderer.prototype,"_antialiasing",null);b.__decorate([g.property()],a.Renderer.prototype,"_ssaoEnabled",void 0);b.__decorate([g.property()],a.Renderer.prototype,"_smaaPass",void 0);b.__decorate([g.property({autoDestroy:!0})],
a.Renderer.prototype,"_edgeView",void 0);b.__decorate([g.property()],a.Renderer.prototype,"updating",null);b.__decorate([g.property()],a.Renderer.prototype,"isCameraFinal",null);a.Renderer=b.__decorate([l.subclass("esri.views.3d.webgl-engine.lib.Renderer")],a.Renderer);a.FramebufferId=void 0;(function(ia){ia[ia.Color=0]="Color";ia[ia.LinearDepth=1]="LinearDepth";ia[ia.Normals=2]="Normals";ia[ia.ShadowMap=3]="ShadowMap";ia[ia.HudVisibility=4]="HudVisibility";ia[ia.Highlight=5]="Highlight"})(a.FramebufferId||
(a.FramebufferId={}));const da=new f,ea=q.create(),ca=q.create(),ja=q.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./AllRenderPasses ./RenderPass ../shaderLibrary/ShaderOutput ../util/TwoVectorPosition ../../lib/depthRange ../../lib/RenderSlot".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){let q=function(){function C(A,x){this.rctx=A;this.shaderTechniqueRepository=x;this.canRender=!0;this._materialPassParameters=new f.MaterialPassParameters;this._shadowPassParameters=new f.ShadowMapPassParameters;this._highlightPassParameters=new f.HighlightPassParameters;this._systems=new Set;this._passes={materialOpaque:new e.RenderPass(A,x),materialTransparent:new e.RenderPass(A,x,e.RenderPassSorting.BackToFront),materialIntegratedMesh:new e.RenderPass(A,x),
shadowMap:new e.RenderPass(A,x),highlight:new e.RenderPass(A,x),highlightIntegratedMesh:new e.RenderPass(A,x),highlightShadowMap:new e.RenderPass(A,x),defaultShadowMap:new e.RenderPass(A,x)}}var B=C.prototype;B.register=function(A){this._systems.add(A)};B.prepareRender=function(A){if(0!==this._systems.size){for(const x of Object.values(this._passes))x.prepareSubmit();this._systems.forEach(x=>x.submit(this._passes,A.bindParameters));for(const x of Object.values(this._passes))x.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}};
B.render=function(A){if(0!==this._systems.size)switch(this._configure(A),this._materialPassParameters.output=A.output,A.bindParameters.slot){case v.RenderSlot.OPAQUE_MATERIAL:switch(A.output){case g.ShaderOutput.Color:return this._passes.materialOpaque.dispatch(this._materialPassParameters,A.bindParameters);case g.ShaderOutput.Depth:return this._passes.materialOpaque.dispatch(this._materialPassParameters,A.bindParameters);case g.ShaderOutput.Normal:return this._passes.materialOpaque.dispatch(this._materialPassParameters,
A.bindParameters);case g.ShaderOutput.Highlight:return this._passes.highlight.dispatch(this._highlightPassParameters,A.bindParameters);case g.ShaderOutput.Shadow:return this._passes.shadowMap.dispatch(this._shadowPassParameters,A.bindParameters);case g.ShaderOutput.ShadowHighlight:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,A.bindParameters);case g.ShaderOutput.ShadowExcludeHighlight:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,A.bindParameters);
case g.ShaderOutput.ObjectAndLayerIdColor:return this._passes.materialOpaque.dispatch(this._materialPassParameters,A.bindParameters)}break;case v.RenderSlot.TRANSPARENT_MATERIAL:switch(A.output){case g.ShaderOutput.Color:return this._passes.materialTransparent.dispatch(this._materialPassParameters,A.bindParameters);case g.ShaderOutput.Alpha:return this._passes.materialTransparent.dispatch(this._materialPassParameters,A.bindParameters);case g.ShaderOutput.Depth:return this._passes.materialTransparent.dispatch(this._materialPassParameters,
A.bindParameters);case g.ShaderOutput.Normal:return this._passes.materialTransparent.dispatch(this._materialPassParameters,A.bindParameters);case g.ShaderOutput.ObjectAndLayerIdColor:return this._passes.materialTransparent.dispatch(this._materialPassParameters,A.bindParameters)}break;case v.RenderSlot.INTEGRATED_MESH:switch(A.output){case g.ShaderOutput.Color:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,A.bindParameters);case g.ShaderOutput.Depth:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,
A.bindParameters);case g.ShaderOutput.Normal:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,A.bindParameters);case g.ShaderOutput.Highlight:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,A.bindParameters);case g.ShaderOutput.ObjectAndLayerIdColor:return this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,A.bindParameters)}}};B.notifyDirty=function(){this._context.requestRender()};B.slots=function(){return[v.RenderSlot.OPAQUE_MATERIAL,
v.RenderSlot.TRANSPARENT_MATERIAL,v.RenderSlot.INTEGRATED_MESH]};B.initializeRenderContext=function(A){this._context=A};B.uninitializeRenderContext=function(){};B.queryDepthRange=function(A){const x={near:Infinity,far:-Infinity};this._systems.forEach(u=>{u=u.queryShadowCasterDepthRange(A);b.isSome(u)&&l.union(x,u,x)});return x};B._configure=function(A){this._updateParameters(A,A.output===g.ShaderOutput.Shadow||A.output===g.ShaderOutput.ShadowHighlight||A.output===g.ShaderOutput.ShadowExcludeHighlight?
this._shadowPassParameters:A.output===g.ShaderOutput.Highlight?this._highlightPassParameters:this._materialPassParameters)};B._updateParameters=function(A,x){const u=A.bindParameters.camera,y=u.viewInverseTransposeMatrix;m.set(k,y[3],y[7],y[11]);z.set(k);m.copy(x.transformWorldFromViewTH,z.high);m.copy(x.transformWorldFromViewTL,z.low);m.copy(x.slicePlaneLocalOrigin,k);t.fromMat4(x.transformViewFromCameraRelativeRS,u.viewMatrix);r.copy(x.transformProjFromView,u.projectionMatrix);x.identifier===f.RenderPassIdentifier.Material&&
(this._materialPassParameters.transparent=A.bindParameters.slot===v.RenderSlot.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=A.bindParameters.slot===v.RenderSlot.INTEGRATED_MESH,t.transpose(p,x.transformViewFromCameraRelativeRS),t.invert(x.transformNormalViewFromGlobal,p))};c._createClass(C,[{key:"needsHighlight",get:function(){return 0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count}},{key:"needsTransparentPass",get:function(){return 0<this._passes.materialTransparent.count}}]);
return C}();const k=d.create(),p=n.create(),z=new h.TwoVectorPosition;a.RenderPassManager=q;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../lib/TransparencyPassType ../../../../webgl/enums".split(" "),function(a,c,b,t,n,r){a.RenderPassSorting=void 0;(function(f){f[f.FrontToBack=0]="FrontToBack";
f[f.BackToFront=1]="BackToFront"})(a.RenderPassSorting||(a.RenderPassSorting={}));let m=function(){function f(g,h,l=a.RenderPassSorting.FrontToBack){this._rctx=g;this._techniqueRepository=h;this._sorting=l;this._draws=new t({initialSize:32,allocator:v=>v||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}var e=f.prototype;e.submitDraw=function(g,h,l,v){const q=this._draws.pushNew();q.geometry=h;q.geometryRanges=
l;q.material=g;q.depthSquaredHint=v;q.indexType=(h.indexed?b.unwrap(h.vao.indexBuffer).indexType:null)??0};e.dispatch=function(g,h){const l=this._rctx;this._previouslyBoundDraw.clear();let v=null;const q=this._draws.map(C=>C.material.prepareTechnique(this._techniqueRepository,g,h,C.geometry.parameters)),k=this._draws.length;for(let C=0;C<k;C++){var p=q[C];if(p!==v||p.configuration.transparencyPassType!==n.TransparencyPassType.NONE)l.bindTechnique(p,g,h),v=p;var z=this._draws.data[C];const B=z.geometry;
l.bindVAO(B.vao);this._previouslyBoundDraw.get(p)!==z.material&&(p.program.bindDraw(z.material,h,g),this._previouslyBoundDraw.set(p,z.material));p=z.geometryRanges;const A=p.length;if(0!==z.indexType){const x=d.get(z.indexType);for(let u=0;u<A;u+=2)l.drawElements(B.primitiveType,p[u+1],z.indexType,p[u]*x)}else for(z=0;z<A;z+=2)l.drawArrays(B.primitiveType,p[z],p[z+1])}};e.prepareSubmit=function(){this._draws.clear()};e.finishSubmit=function(){const g=this._sorting===a.RenderPassSorting.FrontToBack?
1:-1;this._draws.sort((h,l)=>{const v=g*(h.depthSquaredHint-l.depthSquaredHint);return 0!==v?v:h.geometry.vao.size-l.geometry.vao.size})};c._createClass(f,[{key:"count",get:function(){return this._draws.length}}]);return f}();const d=new Map;d.set(r.DataType.UNSIGNED_BYTE,1);d.set(r.DataType.UNSIGNED_SHORT,2);d.set(r.DataType.UNSIGNED_INT,4);a.RenderPass=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/AnimationTimeStep":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/has","../../../../core/mathUtils","../../../../core/time"],function(a,c,b,t,n){let r=function(){function g(){this._step=f;this._dilation=1;this._firstIdleTime=n.Milliseconds(0)}var h=g.prototype;h.frame=function(l,v){v?0===this._firstIdleTime&&(this._firstIdleTime=n.Milliseconds(performance.now())):this._firstIdleTime=n.Milliseconds(0);if(b("enable-feature:high-quality-idle")){v=v?performance.now()-this._firstIdleTime:0;if(v>=m+d){this._step=
n.Milliseconds(Infinity);this._dilation=1;return}this._dilation=v>=m?10:1}else this._dilation=1;l=t.clamp(l/.5,f,e);this._step=Infinity===this._step?n.Milliseconds(l):n.Milliseconds(.9*this._step+l*(1-.9))};h.clear=function(){this._step=this._firstIdleTime=n.Milliseconds(0)};c._createClass(g,[{key:"value",get:function(){return this._step}},{key:"timeDilation",get:function(){return this._dilation}}]);return g}();const m=n.Milliseconds(6E4),d=n.Milliseconds(5E3),f=n.Milliseconds(1E3),e=n.Milliseconds(1E3/
30);a.AnimationTimeStep=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Highlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./VertexArrayObject ../shaders/HighlightApplyTechnique ../../../../chunks/HighlightBlur.glsl ../shaders/HighlightBlurTechnique ../../../../chunks/HighlightDownsample.glsl ../shaders/HighlightDownsampleTechnique ../shaders/HighlightPassParameters ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B){let A=function(){function x(y,w){this._techniqueRep=y;this._rctx=w;this._viewportToRestore=r.create();this._passParameters=new k.HighlightPassParameters;this._downsampleDrawParameters=new v.HighlightDownsampleDrawParameters;this._blurDrawParameters=new h.HighlightBlurDrawParameters;this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}var u=x.prototype;u._assertResources=
function(){if(!this._quadVAO){this._quadVAO=f.createQuadVAO(this._rctx);var y={colorTarget:z.TargetType.TEXTURE,depthStencilTarget:z.DepthStencilTargetType.NONE,width:0,height:0},w={target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,samplingMode:z.TextureSamplingMode.LINEAR,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0};this._blur0Fbo=new C.FramebufferObject(this._rctx,y,w);this._blur1Fbo=new C.FramebufferObject(this._rctx,y,w);this._blurTechnique=
this._techniqueRep.acquire(l.HighlightBlurTechnique);this._downsampleTechnique=this._techniqueRep.acquire(q.HighlightDownsampleTechnique);this._applyTechnique=this._techniqueRep.acquire(g.HighlightApplyTechnique)}};u.dispose=function(){this._blurTechnique=b.releaseMaybe(this._blurTechnique);this._downsampleTechnique=b.releaseMaybe(this._downsampleTechnique);this._applyTechnique=b.releaseMaybe(this._applyTechnique);if(this._grid.coverageMipmap)for(let y=1;y<this._grid.coverageMipmap.length;y++)this._grid.coverageMipmap[y].dispose();
this._grid.vao&&this._grid.vao.dispose(!0);this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null);this._blur0Fbo=b.disposeMaybe(this._blur0Fbo);this._blur1Fbo=b.disposeMaybe(this._blur1Fbo)};u.setDefaultOptions=function(y){this._passParameters={...(new k.HighlightPassParameters),...y}};u.render=function(y,w,D){this._passParameters.highlightColorTexture=w.colorTexture;this._assertResources();var F=y.camera;n.copy(this._viewportToRestore,F.fullViewport);var E=F.pixelRatio;const K=Math.ceil(F.fullWidth/
E);F=Math.ceil(F.fullHeight/E);this._blur0Fbo.resize(K,F);this._blur1Fbo.resize(K,F);E=this._rctx;E.bindVAO(this._quadVAO);let J=null;this._gridUpdateResources(w,32);this._gridComputeMipmap(y);this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;J=this._grid.vao;const M=E.bindTechnique(this._blurTechnique,this._passParameters,y);E.bindVAO(J);E.bindFramebuffer(this._blur0Fbo);E.setViewport(0,0,K,F);E.setClearColor(0,0,0,0);E.clear(z.ClearBufferBit.COLOR_BUFFER_BIT);
this._blurDrawParameters.blurInputTexture=w.colorTexture;t.set(this._blurDrawParameters.blurSize,1/K,0);M.bindDraw(this._blurDrawParameters,y,this._passParameters);E.drawArrays(this._blurTechnique.primitiveType,0,B.vertexCount(J,"geometry"));E.bindFramebuffer(this._blur1Fbo);E.clear(z.ClearBufferBit.COLOR_BUFFER_BIT);this._blurDrawParameters.blurInputTexture=this._blur0Fbo.colorTexture;t.set(this._blurDrawParameters.blurSize,0,1/F);M.bindDraw(this._blurDrawParameters,y,this._passParameters);E.drawArrays(this._blurTechnique.primitiveType,
0,B.vertexCount(J,"geometry"));E.bindFramebuffer(D);E.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3]);this._passParameters.blurColorTexture=this._blur1Fbo.colorTexture;E.bindTechnique(this._applyTechnique,this._passParameters,y);E.drawArrays(this._applyTechnique.primitiveType,0,B.vertexCount(J,"geometry"));E.bindVAO(null)};u._gridUpdateResources=function(y,w){const D=this._rctx,F=this._grid;var E=!1;null===F.coverageMipmap&&
(F.coverageMipmap=[y],E=!0);if(F.viewportWidth!==y.width||F.viewportHeight!==y.height)E=!0,F.viewportWidth=y.width,F.viewportHeight=y.height;F.coverageMipmap[0]=y;F.cellPixelSize!==w&&(F.cellPixelSize=w,E=!0);if(E){for(w=1;w<F.coverageMipmap.length;w++)F.coverageMipmap[w].dispose();F.mipmapLevels=Math.ceil(Math.log(F.cellPixelSize)*Math.LOG2E);F.coverageMipmap.length=F.mipmapLevels+1;for(w=0;w<F.mipmapLevels;w++)E=F.coverageMipmap[w],F.coverageMipmap[w+1]=new C.FramebufferObject(D,{colorTarget:z.TargetType.TEXTURE,
depthStencilTarget:z.DepthStencilTargetType.NONE,width:Math.ceil(E.width/2),height:Math.ceil(E.height/2)},{target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGB,dataType:z.PixelType.UNSIGNED_SHORT_5_6_5,samplingMode:z.TextureSamplingMode.LINEAR,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,width:Math.ceil(E.width/2),height:Math.ceil(E.height/2)})}E=Math.ceil(y.height/F.cellPixelSize);var K=Math.ceil(y.width/F.cellPixelSize);if(!F.vao||F.verticalCellCount!==E||F.horizontalCellCount!==K){F.verticalCellCount=
E;F.horizontalCellCount=K;y=E+1;w=K+1;E=1/E;K=1/K;const J=new Float32Array(24*y*w);let M=0;for(let N=0;N<y;N++)for(let P=0;P<w;P++)J[M+0]=(P-.5)*K*2-1,J[M+1]=(N-.5)*E*2-1,J[M+2]=P*K,J[M+3]=N*E,J[M+4]=(P+.5)*K*2-1,J[M+5]=(N-.5)*E*2-1,J[M+6]=P*K,J[M+7]=N*E,J[M+8]=(P-.5)*K*2-1,J[M+9]=(N+.5)*E*2-1,J[M+10]=P*K,J[M+11]=N*E,J[M+12]=(P-.5)*K*2-1,J[M+13]=(N+.5)*E*2-1,J[M+14]=P*K,J[M+15]=N*E,J[M+16]=(P+.5)*K*2-1,J[M+17]=(N-.5)*E*2-1,J[M+18]=P*K,J[M+19]=N*E,J[M+20]=(P+.5)*K*2-1,J[M+21]=(N+.5)*E*2-1,J[M+22]=
P*K,J[M+23]=N*E,M+=24;F.vao&&F.vao.dispose(!0);F.vao=new e.VertexArrayObject(D,m.Default3D,{geometry:d.Pos2Tex},{geometry:p.BufferObject.createVertex(D,z.Usage.STATIC_DRAW,J)})}};u._gridComputeMipmap=function(y){const w=this._rctx,D=this._grid,F=w.bindTechnique(this._downsampleTechnique,this._passParameters,y);w.bindVAO(this._quadVAO);for(let E=0;E<D.mipmapLevels;E++){w.bindFramebuffer(D.coverageMipmap[E+1]);const K=D.coverageMipmap[E+1].width,J=D.coverageMipmap[E+1].height;this._downsampleDrawParameters.inputTexture=
D.coverageMipmap[E].colorTexture;t.set(this._downsampleDrawParameters.invFramebufferDim,1/K,1/J);F.bindDraw(this._downsampleDrawParameters,y,this._passParameters);w.setViewport(0,0,K,J);w.drawArrays(z.PrimitiveType.TRIANGLE_STRIP,0,B.vertexCount(this._quadVAO,"geometry"))}};c._createClass(x,[{key:"gpuMemoryUsage",get:function(){let y=(b.isSome(this._blur0Fbo)?this._blur0Fbo.gpuMemoryUsage:0)+(b.isSome(this._blur1Fbo)?this._blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const w of this._grid.coverageMipmap)y+=
w.gpuMemoryUsage;return y}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this._blur0Fbo,this._blur1Fbo]}}}]);return x}();a.Highlight=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HighlightApplyTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightApply.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e){n=function(g){function h(){return g.apply(this,arguments)||this}b._inheritsLoose(h,g);var l=h.prototype;l.initializeProgram=function(v){return new m.Program(v.rctx,h.shader.get().build(),r.Default3D)};l.initializePipeline=function(){return e.makePipelineState({blending:e.separateBlendingParams(f.BlendFactor.SRC_ALPHA,f.BlendFactor.ONE,f.BlendFactor.ONE_MINUS_SRC_ALPHA,f.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:e.defaultColorWriteParams})};return h}(n.ShaderTechnique);
n.shader=new t.ReloadableShaderModule(d.HighlightApply,()=>new Promise((g,h)=>a(["./HighlightApply.glsl"],g,h)));c.HighlightApplyTechnique=n;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ./vec4 ./vec4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d){function f(){const g=new r.ShaderBuilder,{vertex:h,fragment:l}=g,v=h.code,q=l.code;g.attributes.add(d.VertexAttribute.POSITION,"vec2");g.varyings.add("uv","vec2");g.attributes.add(d.VertexAttribute.UV0,"vec2");h.uniforms.add(new m.Texture2DPassUniform("coverageTex",k=>k.coverageTexture));v.add(n.glsl`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`);l.uniforms.add(new m.Texture2DPassUniform("tex",k=>k.blurColorTexture));l.uniforms.add(new m.Texture2DPassUniform("origin",k=>k.highlightColorTexture));l.uniforms.add(new t.Float4PassUniform("uColor",k=>k.color));l.uniforms.add(new t.Float4PassUniform("haloColor",k=>k.haloColor));l.uniforms.add(new t.Float4PassUniform("opacities",k=>c.set(e,k.haloOpacity,k.haloOpacityOccluded,k.fillOpacity,k.fillOpacityOccluded)));l.constants.add("outlineSize","float",8.6);l.constants.add("blurSize","float",.4);
q.add(n.glsl`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`);return g}const e=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,build:f},Symbol.toStringTag,{value:"Module"}));a.HighlightApply=b;a.build=f})},"esri/chunks/HighlightBlur.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f){function e(){const l=new r.ShaderBuilder,{vertex:v,fragment:q}=l,k=v.code,p=q.code;l.attributes.add(f.VertexAttribute.POSITION,"vec2");l.attributes.add(f.VertexAttribute.UV0,"vec2");l.varyings.add("blurCoordinate","vec3");v.uniforms.add(new d.Texture2DPassUniform("coverageTex",z=>z.coverageTexture));q.uniforms.add(new t.Float2DrawUniform("blurSize",z=>z.blurSize));k.add(n.glsl`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`);q.uniforms.add(new m.Texture2DDrawUniform("tex",z=>z.blurInputTexture));p.add(n.glsl`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`);return l}let g=function(l){function v(){var q=l.apply(this,arguments)||this;q.blurSize=b.create();return q}c._inheritsLoose(v,l);return v}(n.NoParameters);const h=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:g,build:e},Symbol.toStringTag,{value:"Module"}));a.HighlightBlur=h;a.HighlightBlurDrawParameters=g;a.build=e})},"esri/views/3d/webgl-engine/shaders/HighlightBlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightBlur.glsl ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f){n=function(e){function g(){return e.apply(this,arguments)||this}b._inheritsLoose(g,e);var h=g.prototype;h.initializeProgram=function(l){return new m.Program(l.rctx,g.shader.get().build(),r.Default3D)};h.initializePipeline=function(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})};return g}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.HighlightBlur,()=>new Promise((e,g)=>a(["./HighlightBlur.glsl"],e,g)));c.HighlightBlurTechnique=n;Object.defineProperty(c,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HighlightDownsample.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,c,b,t,n,r,m,d){function f(){const h=new r.ShaderBuilder,
{vertex:l,fragment:v}=h,q=l.code,k=v.code;h.attributes.add(d.VertexAttribute.POSITION,"vec2");q.add(n.glsl`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`);v.uniforms.add(new m.Texture2DDrawUniform("tex",p=>p.inputTexture));v.uniforms.add(new t.Float2DrawUniform("invFramebufferDim",p=>p.invFramebufferDim));k.add(n.glsl`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`);return h}let e=function(h){function l(){var v=h.apply(this,arguments)||this;v.invFramebufferDim=b.create();return v}c._inheritsLoose(l,h);return l}(n.NoParameters);const g=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:e,build:f},Symbol.toStringTag,{value:"Module"}));a.HighlightDownsample=g;a.HighlightDownsampleDrawParameters=e;a.build=f})},"esri/views/3d/webgl-engine/shaders/HighlightDownsampleTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightDownsample.glsl ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f){n=function(e){function g(){return e.apply(this,arguments)||this}b._inheritsLoose(g,e);var h=g.prototype;h.initializeProgram=function(l){return new m.Program(l.rctx,g.shader.get().build(),r.Default3D)};h.initializePipeline=function(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})};return g}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.HighlightDownsample,()=>new Promise((e,g)=>a(["./HighlightDownsample.glsl"],e,g)));c.HighlightDownsampleTechnique=
n;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HighlightPassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f32","../../../../chunks/vec4f64","../core/shaderModules/interfaces"],function(a,c,b,t,n){n=function(r){function m(){var d=r.apply(this,arguments)||this;d.color=b.fromValues(1,0,1,1);d.haloColor=b.fromValues(1,0,1,1);d.haloOpacity=1;d.haloOpacityOccluded=.25;d.fillOpacity=.2;
d.fillOpacityOccluded=.05;d.shadowColor=t.fromValues(1,0,1,1);d.shadowOpacity=.15;d.occludedShadowOpacity=.075;return d}c._inheritsLoose(m,r);return m}(n.NoParameters);a.HighlightPassParameters=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./RenderTargetHelper ./TransparencyPassType ../shaders/CompositingTechniqueConfiguration ../../../webgl/context-util ../../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d){let f=function(){function h(v,q){this._rctx=v;this._compositingHelper=q;this._mainColorTarget=0;this._dimensions={width:4,height:4};this._background={type:"color",color:[0,0,0,1]};const k=v.type===m.ContextType.WEBGL2,p=this._renderTargetHelper=new t.RenderTargetHelper(v);this._mainColorTargets=[p.registerColorTarget({name:"mainColorTarget0"}),p.registerColorTarget({name:"mainColorTarget1"})];this.frontFaceTarget=p.registerColorTarget({name:"frontFaceTarget"});v=z=>p.registerColorTarget({name:z,
dataType:d.PixelType.FLOAT,internalFormat:k?d.SizedPixelFormat.RGBA32F:d.PixelFormat.RGBA,samplingMode:d.TextureSamplingMode.NEAREST});this.colorFloatTarget=v("colorFloatTarget");this.alphaFloatTarget=v("alphaFloatTarget");this.mainDepth=p.registerDepthTarget({name:"mainDepth"});this.linearDepth=p.registerColorTarget({name:"linearDepth",samplingMode:d.TextureSamplingMode.NEAREST});this.terrainLinearDepth=p.registerColorTarget({name:"terrainLinearDepth"});this.geometryLinearDepth=p.registerColorTarget({name:"geometryLinearDepth"});
this.normal=p.registerColorTarget({name:"normal"});this.highlight=p.registerColorTarget({name:"highlight",internalFormat:k?d.SizedPixelFormat.RGBA4:d.PixelFormat.RGBA,dataType:d.PixelType.UNSIGNED_SHORT_4_4_4_4});this.hudVisibility=p.registerColorTarget({name:"hudVisibility",internalFormat:k?d.SizedPixelFormat.RGBA4:d.PixelFormat.RGBA,dataType:d.PixelType.UNSIGNED_SHORT_4_4_4_4});this.tmpColor=p.registerColorTarget({name:"tmpColor"});this.tmpDepth=p.registerDepthTarget({name:"tmpDepth"});this.hudColor=
p.registerColorTarget({name:"hudColor"})}var l=h.prototype;l.dispose=function(){this._renderTargetHelper.dispose()};l.getFramebuffer=function(v,q){return this._renderTargetHelper.getFramebuffer(this._dimensions,v,q)};l.setupRenderTarget=function(v){v||(this._mainColorTarget=0,this.disposeTarget(this._mainColorTargets[1]));this._mainColorTarget=0===this._mainColorTarget&&v?1:0};l.initializeFrame=function(v){const q=this._rctx;this._dimensions.width=v.fullWidth;this._dimensions.height=v.fullHeight;
this.bindTarget(this.currentColorTarget,this.mainDepth);q.setClearStencil(0);v=this._background.color;q.setClearColor(v[0]*v[3],v[1]*v[3],v[2]*v[3],v[3]);q.clearSafe(d.ClearBufferBit.COLOR_BUFFER_BIT|d.ClearBufferBit.DEPTH_BUFFER_BIT|d.ClearBufferBit.STENCIL_BUFFER_BIT)};l.composite=function(v){b.isSome(this.colorTexture)&&this._compositingHelper.composite(v,this.colorTexture,r.AlphaMode.None)};l.renderTmpAndCompositeToMain=function(v,q,k,p=!1){this.renderToTargets(v,this.tmpColor,p?this.tmpDepth:
this.mainDepth,e);this._compositingHelper.composite(q,this._getColorTexture(this.tmpColor),k)};l.renderHUDVisibility=function(v,q=!1){this.renderToTargets(v,this.hudVisibility,q?this.tmpDepth:this.mainDepth,g)};l.compositeTransparentTerrainOntoHUDVisibility=function(v){this.renderToTargets(()=>this._compositingHelper.compositeHUD(v,this._getColorTexture(this.tmpColor)),this.hudVisibility,this.tmpDepth)};l.renderOITPass=function(v,q,k){let p,z;switch(q){case n.TransparencyPassType.Color:p=this.colorFloatTarget;
z=[0,0,0,0];break;case n.TransparencyPassType.Alpha:p=this.alphaFloatTarget;z=[1,1,1,1];break;case n.TransparencyPassType.FrontFace:p=this.frontFaceTarget,z=[0,0,0,0]}k?this.renderToTargets(v,p,this.tmpDepth,z,!0,!0):this.renderToTargets(v,p,this.mainDepth,z,!1)};l.compositeTransparentTerrainOntoMain=function(v){this.bindFramebuffer();this._compositingHelper.composite(v,this._getColorTexture(this.tmpColor),r.AlphaMode.PremultipliedAlpha)};l.compositeOccludedOntoMain=function(v,q){this.bindFramebuffer();
this._compositingHelper.composite(v,this._getColorTexture(this.tmpColor),r.AlphaMode.PremultipliedAlpha,q)};l.compositeTransparentOntoOpaque=function(v,q){q?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(d.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFramebuffer();this._compositingHelper.compositeOIT(v,this._getColorTexture(this.colorFloatTarget),this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))};l.bindFramebuffer=
function(){this._rctx.bindFramebuffer(this.framebuffer)};l.renderDepthDetached=function(v){this.bindTarget(this.currentColorTarget);v();this.bindTarget(this.currentColorTarget,this.mainDepth)};l.disposeTarget=function(v){this._renderTargetHelper.disposeTargetResource(v)};l.renderToFBO=function(v,q,k=!1,p=!1){const z=this._rctx;let C=0;q&&(z.setClearColor(q[0],q[1],q[2],Math.max(1E-13,q[3])),C|=d.ClearBufferBit.COLOR_BUFFER_BIT);k&&(C|=d.ClearBufferBit.DEPTH_BUFFER_BIT);!1===p?p=0:(!0===p&&(p=255),
C|=d.ClearBufferBit.STENCIL_BUFFER_BIT);C&&z.clearSafe(C,p);v();z.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth)};l.renderToTargets=function(v,q,k,p,z=!1,C=!1){q=this.bindTarget(q,k);this.renderToFBO(v,p,z,C);return q};l.bindTarget=function(v,q){v=this._renderTargetHelper.getFramebuffer(this._dimensions,v,q);this._rctx.bindFramebuffer(v);return v};l._getColorTexture=function(v){return this._renderTargetHelper.getColorTexture(v,this._dimensions)};c._createClass(h,[{key:"width",
get:function(){return this._dimensions.width}},{key:"height",get:function(){return this._dimensions.height}},{key:"background",get:function(){return this._background},set:function(v){this._background=v}},{key:"currentColorTarget",get:function(){return this._mainColorTargets[this._mainColorTarget]}},{key:"previousColorTarget",get:function(){return this._mainColorTargets[1-this._mainColorTarget]}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,this.mainDepth)}},
{key:"colorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",get:function(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},{key:"linearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"terrainLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",
get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},{key:"normalTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this._getColorTexture(this.hudVisibility)}},
{key:"tmpColorTexture",get:function(){return this._getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this._getColorTexture(this.hudColor)}},{key:"mainColorTexture",get:function(){return this._getColorTexture(this.currentColorTarget)}},{key:"gpuMemoryUsage",get:function(){let v=0;this._renderTargetHelper&&(v+=this._renderTargetHelper.gpuMemoryUsage);return v}}]);return h}();const e=[0,0,0,0],g=[0,1,0,1];a.OffscreenRendering=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,c,b,t,n,r,m,d,f){const e={dataType:n.PixelType.UNSIGNED_BYTE,internalFormat:n.PixelFormat.RGBA},g={};let h=function(){function l(q){this._rctx=q;this._activeTargets=new Set;this._depthTextures=
new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this.depthTextureSupported=q.capabilities.depthTexture}var v=l.prototype;v.dispose=function(){this._depthBuffers.forEach(q=>q.dispose());this._depthBuffers.clear();this._depthTextures.forEach(q=>q.dispose());this._depthTextures.clear();this._colorTextures.forEach(q=>q.dispose());this._colorTextures.clear();this._framebuffers.forEach(q=>q.dispose());this._framebuffers.clear();this._activeTargets.clear()};v.disposeTargetResource=
function(q){q=q.id;this._activeTargets.has(q)&&(this._activeTargets.delete(q),this._disposeWithFramebuffers(this._depthTextures,q),this._disposeWithFramebuffers(this._depthBuffers,q),this._disposeWithFramebuffers(this._colorTextures,q))};v._disposeWithFramebuffers=function(q,k){const p=q.get(k);p&&(this._framebuffers.forEach((z,C)=>{if(z.colorAttachment===p||z.depthStencilAttachment===p)z.detachAll(),z.dispose(),this._framebuffers.delete(C)}),p.dispose(),q.delete(k))};v.getDepthTexture=function(q,
k){if(!this.depthTextureSupported)return null;let p=this._depthTextures.get(q.id);!p||p.descriptor.width===k.width&&p.descriptor.height===k.height||(p.dispose(),p=b.nullifyNonNullableForDispose());p||(p=new d.Texture(this._rctx,{target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.DEPTH_STENCIL,dataType:n.PixelType.UNSIGNED_INT_24_8,samplingMode:n.TextureSamplingMode.NEAREST,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,width:k.width,height:k.height}),this._depthTextures.set(q.id,p),this._activeTargets.add(q.id));
return p};v.getAllocatedDepthTexture=function(q){return this._depthTextures.get(q.id)};v.getDepthBuffer=function(q,k){if(this.depthTextureSupported)return null;let p=this._depthBuffers.get(q.id);p?p.descriptor.width===k.width&&p.descriptor.height===k.height||p.resize(k.width,k.height):(p=new m.Renderbuffer(this._rctx,{internalFormat:n.RenderbufferFormat.DEPTH_STENCIL,...k}),this._depthBuffers.set(q.id,p),this._activeTargets.add(q.id));return p};v.getColorTexture=function(q,k){let p=this._colorTextures.get(q.id);
!p||p.descriptor.width===k.width&&p.descriptor.height===k.height||(p.dispose(),p=b.nullifyNonNullableForDispose());p||(p=new d.Texture(this._rctx,{target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:q.internalFormat,dataType:q.dataType,samplingMode:null!=q.samplingMode?q.samplingMode:n.TextureSamplingMode.LINEAR,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,width:k.width,height:k.height}),this._colorTextures.set(q.id,p),this._activeTargets.add(q.id));return p};v.getAllocatedColorTexture=
function(q){return this._colorTextures.get(q.id)};v.registerDepthTarget=function(q={}){return{id:t.generateUID(),...g,...q}};v.registerColorTarget=function(q={}){return{id:t.generateUID(),...e,...q}};v.getFramebuffer=function(q,k,p){const z=this._getKey(k,p);let C=this._framebuffers.get(z);k=this.getColorTexture(k,q);if(this.depthTextureSupported){var B=p?this.getDepthTexture(p,q):void 0;if(!C)return C=b.isSome(p)?new r.FramebufferObject(this._rctx,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE},
k,B):new r.FramebufferObject(this._rctx,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.NONE},k),this._framebuffers.set(z,C),C;if(C.width!==q.width||C.height!==q.height||C.colorTexture!==k||C.depthStencilTexture!==B)C.detachAll(),C.resize(q.width,q.height),C.attachColorTexture(k),C.attachDepthStencilTexture(B);return C}B=p?this.getDepthBuffer(p,q):void 0;if(!C)return C=new r.FramebufferObject(this._rctx,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:p?n.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:
n.DepthStencilTargetType.NONE},k,B),this._framebuffers.set(z,C),C;if(C.width!==q.width||C.height!==q.height||C.colorTexture!==k)C.detachAll(),C.resize(q.width,q.height),C.attachColorTexture(k),C.attachDepthStencilBuffer(B);return C};v._getKey=function(q,k){return`${q.id}_${k?k.id:"X"}_${q.name}${k?"_"+k.name:""}`};c._createClass(l,[{key:"gpuMemoryUsage",get:function(){let q=0;const k=new Set,p=z=>{k.has(z)||(k.add(z),q+=f.getGpuMemoryUsage(z))};this._depthTextures.forEach(p);this._colorTextures.forEach(p);
this._depthBuffers.forEach(p);return q}}]);return l}();a.RenderTargetHelper=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/PooledArray ../../../../core/promiseUtils ./depthRange ./RenderSlot".split(" "),function(a,c,b,t,n,r){let m=function(){function f(g){this._context=g;this._renderPlugins=new b;this._slots=[];for(g=0;g<r.RenderSlot.MAX_SLOTS;++g)this._slots[g]=
[]}var e=f.prototype;e.add=function(g,h,l){const v=()=>{if(l?.aborted)throw h.uninitializeRenderContext(),t.createAbortError();this._renderPlugins.push(h);for(const k of g)this._slots[k].push(h);this._context.requestRender()},q=h.initializeRenderContext(this._context,l);if(t.isPromiseLike(q))return q.then(v);v()};e.remove=function(g){if(null!=this._renderPlugins.removeUnordered(g)){for(let h=0;h<this._slots.length;++h)this._slots[h]=this._slots[h].filter(l=>l!==g);g.uninitializeRenderContext();this._context.requestRender()}};
e.prepareRender=function(){this._renderPlugins.forAll(g=>{g.prepareRender&&g.prepareRender(this._context.renderContext)})};e.updateAnimation=function(g){let h=!1;this._renderPlugins.forAll(l=>{l.updateAnimation&&(h=l.updateAnimation(g)||h)});return h};e.render=function(){const g=[];this._slots[this._context.renderContext.bindParameters.slot].filter(h=>{if(!h.canRender)return!1;if("prepareTechnique"in h)return(h=h.prepareTechnique(this._context.renderContext))?(g.push(h),!0):!1;g.push(null);return!0}).forEach((h,
l)=>h.render(this._context.renderContext,g[l]))};e.queryDepthRange=function(g){const h=d;h.near=Infinity;h.far=-Infinity;this._renderPlugins.forAll(l=>{l.queryDepthRange&&(l=l.queryDepthRange(g))&&n.union(h,l,h)});return h};c._createClass(f,[{key:"needsTransparentPass",get:function(){return this._renderPlugins.some(g=>!!g.needsTransparentPass)}},{key:"needsHighlight",get:function(){return this._renderPlugins.some(g=>!!g.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this._renderPlugins.some(g=>
!!g.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const g=this._slots[r.RenderSlot.LASERLINES_CONTRAST_CONTROL];return!!g&&0<g.length}},{key:"renderOccludedFlags",get:function(){return this._renderPlugins.reduce((g,h)=>g|h.renderOccludedFlags,0)}}]);return f}();const d={near:0,far:0};a.RenderPluginManager=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./BindParameters ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w){a.ShadowAccumulator=function(F){function E(J,M,N,P,I,G){var H=F.call(this,{})||this;H._rctx=J;H._stage=N;H._prepareForShadowMapPass=P;H._renderToShadowMap=I;H._requestRender=G;H._progress=0;H._sampleCount=0;H._passParameters=new B.ShadowCastAccumulatePassParameters;H._enabledInternal=!1;H._cachedLightDirections=[];H._depthRange=k.ZERO;H._previewing=!1;H._handles=new r;H._cameraForcedForScreenshot=!1;H._bindParameters=new q.BindParameters(new C.ShadowMap(J,
N.viewingMode),null,null);H._bindParameters.shadowMap.enabled=!0;H._vao=p.createQuadVAO(J);H._fbo=new y.FramebufferObject(J,{colorTarget:u.TargetType.TEXTURE,depthStencilTarget:u.DepthStencilTargetType.NONE,width:0,height:0},{target:u.TextureType.TEXTURE_2D,pixelFormat:u.PixelFormat.RGBA,dataType:u.PixelType.UNSIGNED_BYTE,samplingMode:u.TextureSamplingMode.LINEAR,wrapMode:u.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});H._accumulationRenderer=new z.ShadowCastRenderer(M,J,c._assertThisInitialized(H),
G);H._handles.add([H._stage.view.resourceController.scheduler.registerTask(x.TaskPriority.SHADOW_ACCUMULATOR,c._assertThisInitialized(H)),f.watch(()=>N.renderView,L=>{H._handles.remove("renderView");d.isSome(L)&&H._handles.add(L.events.on("force-camera-for-screenshot",()=>H._cameraForcedForScreenshot=!0),"renderView")},f.syncAndInitial),f.watch(()=>H._previewing,()=>H._requestRenderIfEnabled(),f.sync)]);return H}c._inheritsLoose(E,F);var K=E.prototype;K.normalizeCtorArgs=function(){return{}};K.runTask=
function(J){for(this._prepareForShadowMapPass(this._bindParameters);!J.done&&!this._isDoneAccumulating;)this._accumulateShadow(),J.madeProgress();this._requestRender()};K.renderAccumulation=function(J,M,N,P){this._depthRange=M;this._updateCamera(N);this._bindParameters.contentCamera=P;this._passParameters.linearDepthTexture=J;this._passParameters.origin=this._bindParameters.camera.center;this.notifyChange("canAccumulate");if(this.isAccumulating&&this.canAccumulate){(this._previewing||0===this._progress||
this._cameraForcedForScreenshot)&&this._clear();J=this._cameraForcedForScreenshot?this._sampleCount:Math.min(6,this._sampleCount-this._progress);for(M=0;M<J;++M)this._accumulateShadow();this._cameraForcedForScreenshot=!1;this._requestRender()}};K.render=function(J){this._accumulationRenderer.render(J)};K.dispose=function(){this._stop();this._handles.destroy();this._accumulationRenderer=d.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=d.disposeMaybe(this._fbo);
this._vao=d.disposeMaybe(this._vao);this._accumulationTechniqueCached=d.releaseMaybe(this._accumulationTechniqueCached);this._sampleCount=this._cachedLightDirections.length=0};K.setOptions=function(J){void 0!==J.enabled&&(this._enabled=J.enabled);void 0!==J.previewing&&(this._previewing=J.previewing);void 0!==J.lightDirections&&(this._lightDirections=J.lightDirections);this._accumulationRenderer.setOptions(J)};K.readAccumulatedShadow=function(J,M){if(!this._isActive||1>this._progress||0>J||J>this._fbo.width||
0>M||M>this._fbo.height)return 0;this._fbo.readPixels(J,M,1,1,u.PixelFormat.RGBA,u.PixelType.UNSIGNED_BYTE,D);return D[0]/this._progress};K._start=function(){this._progress=0;this._enabledInternal=!0};K._stop=function(){this._enabledInternal=!1};K._invalidate=function(){this._progress=0;this._requestRenderIfEnabled()};K._clear=function(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(u.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0};K._accumulateShadow=
function(){this._renderToShadowMap(this._bindParameters,this._sampleLightDirection(),this._depthRange);const J=this._accumulationTechnique;this._rctx.bindFramebuffer(this._fbo);this._rctx.bindTechnique(J,this._passParameters,this._bindParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(J.primitiveType,0,w.vertexCount(this._vao,"geometry"))};K._sampleLightDirection=function(){this._progress++;return this._lightDirections[104729*this._progress%this._lightDirections.length]};K._updateCamera=
function(J){J.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(J),this._fbo.resize(J.fullWidth,J.fullHeight),this._opacityFromElevation=1-m.smoothstep(z.shadowCastDisableElevationMin,z.shadowCastDisableElevationMax,J.relativeElevation))};K._requestRenderIfEnabled=function(){this._enabledInternal&&this._requestRender()};c._createClass(E,[{key:"computedSamples",get:function(){return this._progress}},{key:"shadowCastTexture",get:function(){return this._fbo.colorTexture}},{key:"isAccumulating",
get:function(){return this._isPreviewing||this._isRefining}},{key:"_accumulationTechnique",get:function(){d.isNone(this._accumulationTechniqueCached)&&(this._accumulationTechniqueCached=new A.ShadowCastAccumulateTechnique({rctx:this._rctx,viewingMode:this._stage.viewingMode}));return this._accumulationTechniqueCached}},{key:"_isRefining",get:function(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}},{key:"_isPreviewing",get:function(){return this._isActive&&this._previewing}},
{key:"_isActive",get:function(){return this._enabledInternal&&0<this._sampleCount}},{key:"canAccumulate",get:function(){return null!==this._passParameters.linearDepthTexture&&this._depthRange!==k.ZERO&&this._opacityFromElevation>z.shadowCastDisabledElevationThreshold}},{key:"_isDoneAccumulating",get:function(){return this._progress>=this._sampleCount}},{key:"_lightDirections",get:function(){return this._cachedLightDirections},set:function(J){const M=this._cachedLightDirections;if(!n.equals(M,J,l.equals)){var N=
Math.min(B.ShadowCastMaxSamples,J.length);this._sampleCount=M.length=N;for(let P=0;P<N;++P)M[P]=l.copy(M[P]??v.create(),J[P]);this._invalidate()}}},{key:"_opacityFromElevation",get:function(){return this._accumulationRenderer.opacityFromElevation},set:function(J){this._accumulationRenderer.opacityFromElevation=J}},{key:"running",get:function(){return this._isRefining&&this.canAccumulate&&0<this._progress}},{key:"_enabled",set:function(J){J!==this._enabledInternal&&(J?this._start():this._stop())}},
{key:"test",get:function(){const J=this;return{lightDirections:this._lightDirections,get isDone(){return J._isDoneAccumulating},get isActive(){return J._isActive}}}}]);return E}(t);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_progress",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_enabledInternal",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_depthRange",void 0);
b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_previewing",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_isRefining",null);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_isActive",null);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"canAccumulate",null);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",null);b.__decorate([e.property()],
a.ShadowAccumulator.prototype,"_opacityFromElevation",null);b.__decorate([e.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=b.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],a.ShadowAccumulator);const D=new Uint8Array(4);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ./glUtil3D ../../../../chunks/ShadowCastVisualize.glsl ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){const k=1/512;a.ShadowCastRenderer=function(p){function z(B,A,x,u){var y=p.call(this,{})||this;y._techniqueRepository=B;y._rctx=A;y._data=x;y._requestRender=u;y._passParameters=new h.ShadowCastVisualizePassParameters(y._data.shadowCastTexture);y._techniqueConfig=new v.ShadowCastVisualizeTechniqueConfiguration;y._enabled=!1;y._vao=g.createQuadVAO(A);y._techniqueConfig.visualization=v.ShadowCastVisualization.Gradient;return y}c._inheritsLoose(z,p);var C=z.prototype;
C.normalizeCtorArgs=function(){return{}};C.dispose=function(){this._stop();this._vao=n.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);this._technique=null};C.render=function(B){if(this._showVisualization){this._passParameters.sampleScale=1/this._data.computedSamples;var A=this._visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao);this._rctx.bindTechnique(A,this._passParameters,B);this._rctx.drawArrays(A.primitiveType,0,q.vertexCount(this._vao,"geometry"))}};C.setOptions=
function(B){void 0!==B.enabled&&this._setEnabled(B.enabled);void 0!==B.color&&this._setColor(B.color);void 0!==B.threshold&&(this._threshold=B.threshold);void 0!==B.visualization&&(this._visualization=B.visualization);void 0!==B.bandSize&&(this._bandSize=B.bandSize);void 0!==B.bandsEnabled&&(this._bandsEnabled=B.bandsEnabled)};C._setColor=function(B){e.exactEquals(B,this._passParameters.color)||(e.copy(this._passParameters.color,B),this._requestRenderIfRunning())};C._setEnabled=function(B){B!==this._enabled&&
(B?this._start():this._stop())};C._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};C._start=function(){this._enabled=!0;this._requestRender()};C._stop=function(){this._enabled=!1;this._requestRender()};c._createClass(z,[{key:"_visualizeShadowCastTechnique",get:function(){return this._technique=this._techniqueRepository.releaseAndAcquire(l.ShadowCastVisualizeTechnique,this._techniqueConfig,this._technique)}},{key:"opacityFromElevation",get:function(){return this._passParameters.opacityFromElevation},
set:function(B){this._passParameters.opacityFromElevation!==B&&(this._passParameters.opacityFromElevation=B,this.notifyChange("opacityFromElevation"))}},{key:"_showVisualization",get:function(){return this._enabled&&0<this._data.computedSamples&&this.opacityFromElevation>k}},{key:"_threshold",get:function(){return this._passParameters.threshold},set:function(B){this._threshold!==B&&(this._passParameters.threshold=B,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._techniqueConfig.visualization},
set:function(B){B!==this._visualization&&(this._techniqueConfig.visualization=B,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}},{key:"_bandSize",get:function(){return this._passParameters.bandSize},set:function(B){B!==this._bandSize&&(this._passParameters.bandSize=B,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._techniqueConfig.bandsEnabled},set:function(B){B!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=
B,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}}]);return z}(t);b.__decorate([r.property()],a.ShadowCastRenderer.prototype,"opacityFromElevation",null);a.ShadowCastRenderer=b.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=k;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(C){const B=new g.ShaderBuilder,A=B.fragment;A.include(m.RgbaFloatEncoding);A.include(n.ReadLinearDepth);B.include(r.CameraSpace);B.include(t.ScreenSpacePass);const {visualization:x,bandsEnabled:u}=C;A.constants.add("inverseSampleValue","float",l.ShadowCastMaxSamples);A.uniforms.add([new h.Texture2DPassUniform("shadowCastMap",w=>w.shadowCastMap),new f.FloatPassUniform("sampleScale",w=>w.sampleScale),new f.FloatPassUniform("opacityFromElevation",w=>w.opacityFromElevation),
new d.Float4PassUniform("uColor",w=>w.color)]);C=x===v.ShadowCastVisualization.Gradient;const y=x===v.ShadowCastVisualization.Threshold;C&&u?A.uniforms.add(new f.FloatPassUniform("bandSize",w=>w.bandSize)):y&&A.uniforms.add(new f.FloatPassUniform("threshold",w=>w.threshold));A.code.add(e.glsl`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${y?e.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${C&&u?e.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${C?e.glsl`* strength`:""});
      }
    `);return B}let k=function(C){function B(A){var x=C.call(this)||this;x.shadowCastMap=A;x.sampleScale=0;x.opacityFromElevation=1;x.color=b.clone(p);x.bandSize=.1;x.threshold=.5;return x}c._inheritsLoose(B,C);return B}(e.NoParameters);const p=b.fromValues(.01,0,.25,1),z=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastVisualizePassParameters:k,build:q},Symbol.toStringTag,{value:"Module"}));a.ShadowCastVisualize=z;a.ShadowCastVisualizePassParameters=k;a.build=q})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(C){const B=new l.ShaderBuilder,A=B.fragment;A.include(f.RgbaFloatEncoding);A.include(r.ReadLinearDepth);B.include(d.CameraSpace);B.include(n.ScreenSpacePass);B.include(m.ReadShadowMapPass,C);A.uniforms.add([new v.Texture2DPassUniform("depthMap",x=>x.linearDepthTexture),new h.Matrix4PassUniform("inverseViewMatrix",(x,u)=>b.invert(z,b.translate(z,u.camera.viewMatrix,u.camera.center))),new e.Float2PassUniform("nearFar",(x,u)=>u.camera.nearFar)]);A.constants.add("sampleValue",
"float",p);A.code.add(g.glsl`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`);return B}let k=function(C){function B(){return C.apply(this,arguments)||this}c._inheritsLoose(B,C);return B}(m.ReadShadowMapBindParameters);const p=1/255,z=t.create();t=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:k,ShadowCastMaxSamples:255,build:q},Symbol.toStringTag,{value:"Module"}));a.ShadowCastAccumulate=t;a.ShadowCastAccumulatePassParameters=k;a.ShadowCastMaxSamples=255;a.build=q})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,c,b,t){a.ShadowCastVisualization=void 0;(function(r){r[r.Gradient=0]="Gradient";r[r.Threshold=1]="Threshold";r[r.COUNT=2]="COUNT"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));let n=function(r){function m(){var d=r.apply(this,arguments)||this;d.visualization=a.ShadowCastVisualization.Gradient;d.bandsEnabled=!1;return d}c._inheritsLoose(m,r);
return m}(t.ShaderTechniqueConfiguration);b.__decorate([t.parameter({count:a.ShadowCastVisualization.COUNT})],n.prototype,"visualization",void 0);b.__decorate([t.parameter()],n.prototype,"bandsEnabled",void 0);a.ShadowCastVisualizeTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){n=function(h){function l(q,k){var p;return p=h.call(this,q,k,()=>p.destroy())||this}b._inheritsLoose(l,h);var v=l.prototype;v.initializeProgram=function(q){return new d.Program(q.rctx,l.shader.get().build(this.configuration),r.Default3D)};v.initializePipeline=function(){return g.makePipelineState({blending:m.blendingDefault,colorWrite:g.defaultColorWriteParams,depthTest:null,depthWrite:null})};b._createClass(l,[{key:"primitiveType",get:function(){return e.PrimitiveType.TRIANGLE_STRIP}}]);
return l}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(f.ShadowCastVisualize,()=>new Promise((h,l)=>a(["./ShadowCastVisualize.glsl"],h,l)));c.ShadowCastVisualizeTechnique=n;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowCastAccumulate.glsl ./ShadowConfiguration ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){n=function(l){function v(k){var p;return p=l.call(this,k,new f.ShadowConfiguration,()=>p.destroy())||this}b._inheritsLoose(v,l);var q=v.prototype;q.initializeConfiguration=function(k,p){p.hasWebGL2Context=k.rctx.type===e.ContextType.WEBGL2};q.initializeProgram=function(k){return new m.Program(k.rctx,v.shader.get().build(this.configuration),r.Default3D)};q.initializePipeline=function(){return h.makePipelineState({blending:h.separateBlendingParams(g.BlendFactor.ONE,
g.BlendFactor.ONE,g.BlendFactor.ONE,g.BlendFactor.ONE),colorWrite:h.defaultColorWriteParams,depthTest:null,depthWrite:null})};b._createClass(v,[{key:"primitiveType",get:function(){return g.PrimitiveType.TRIANGLE_STRIP}}]);return v}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.ShadowCastAccumulate,()=>new Promise((l,v)=>a(["./ShadowCastAccumulate.glsl"],l,v)));c.ShadowCastAccumulateTechnique=n;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowConfiguration":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,c,b,t){let n=function(r){function m(){var d=r.apply(this,arguments)||this;d.receiveShadows=!0;d.hasWebGL2Context=!1;return d}c._inheritsLoose(m,r);return m}(t.ShaderTechniqueConfiguration);b.__decorate([t.parameter()],n.prototype,"receiveShadows",void 0);b.__decorate([t.parameter()],n.prototype,"hasWebGL2Context",void 0);a.ShadowConfiguration=n;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/ShadowHighlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/shading/ReadShadowMap.glsl ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){let h=function(){function v(k,p){this._rctx=k;this._viewingMode=
p;this._maxOpacity=1;this._passParameters=new e.ShadowHighlightPassParameters;this._drawParameters=new d.ReadShadowMapBindParameters;this._vao=f.createQuadVAO(this._rctx)}var q=v.prototype;q.render=function(k,p){if(k.shadowMap.enabled&&k.linearDepthTexture&&this.isVisible){var z=this._technique;this._drawParameters.origin=k.camera.center;this._rctx.bindFramebuffer(p);this._rctx.bindTechnique(z,this._passParameters,k).bindDraw(this._drawParameters,k,this._passParameters);this._rctx.bindVAO(this._vao);
this._rctx.drawArrays(z.primitiveType,0,g.vertexCount(this._vao,"geometry"))}};q.setDefaultOptions=function(k){this._passParameters={...this._passParameters,...k};this._updateMaxOpacity()};q.updateParameters=function(k,p){this._passParameters.opacityElevation=1-b.smoothstep(4E4,5E4,k.relativeElevation);k=this._viewingMode===m.ViewingMode.Global?n.normalize(l,k.center):n.set(l,0,0,1);p=n.dot(k,p);this._passParameters.dayNightTerminator=b.smoothstep(0,1,b.clamp(30*p,0,1))};q.dispose=function(){this._vao=
t.disposeMaybe(this._vao);this._techniqueCached=t.releaseMaybe(this._techniqueCached)};q._updateMaxOpacity=function(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]};c._createClass(v,[{key:"_technique",get:function(){t.isNone(this._techniqueCached)&&(this._techniqueCached=new e.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode}));return this._techniqueCached}},{key:"gpuMemoryUsage",
get:function(){return this._vao?.size??0}},{key:"isVisible",get:function(){const {opacityElevation:k,dayNightTerminator:p}=this._passParameters;return.001953125<=this._maxOpacity*k*p}}]);return v}();const l=r.create();a.ShadowHighlight=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ./ShadowConfiguration ../../../../chunks/ShadowHighlight.glsl ../../../webgl/context-util ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){n=function(q){function k(){var p=q.apply(this,arguments)||this;p.shadowColor=t.fromValues(1,0,1,1);p.shadowOpacity=.2;p.occludedShadowOpacity=.1;p.opacityElevation=1;p.dayNightTerminator=1;return p}b._inheritsLoose(k,q);return k}(n.NoParameters);m=function(q){function k(z){var C;return C=q.call(this,z,new e.ShadowConfiguration,()=>C.destroy())||this}b._inheritsLoose(k,q);var p=k.prototype;p.initializeConfiguration=function(z,C){C.hasWebGL2Context=z.rctx.type===
h.ContextType.WEBGL2};p.initializeProgram=function(z){return new f.Program(z.rctx,k.shader.get().build(this.configuration),d.Default3D)};p.initializePipeline=function(){return v.makePipelineState({blending:v.separateBlendingParams(l.BlendFactor.SRC_ALPHA,l.BlendFactor.ONE,l.BlendFactor.ONE_MINUS_SRC_ALPHA,l.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:v.defaultColorWriteParams,depthTest:null,depthWrite:null})};b._createClass(k,[{key:"primitiveType",get:function(){return l.PrimitiveType.TRIANGLE_STRIP}}]);
return k}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(g.ShadowHighlight,()=>new Promise((q,k)=>a(["./ShadowHighlight.glsl"],q,k)));c.ShadowHighlightPassParameters=n;c.ShadowHighlightTechnique=m;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../core/maybe ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){function y(K){const J=new A.ShaderBuilder;J.include(h.ReadShadowMapDraw,K);K=J.fragment;K.include(v.RgbaFloatEncoding);K.include(g.ReadLinearDepth);J.include(l.CameraSpace);J.include(f.ScreenSpacePass);K.uniforms.add([new x.Texture2DPassUniform("defaultDepthTex",(M,N)=>N.shadowMap.getSnapshot(u.SnapshotSlot.Default)),new x.Texture2DPassUniform("highlightDepthTex",(M,N)=>N.shadowMap.getSnapshot(u.SnapshotSlot.Highlight)),new x.Texture2DPassUniform("depthMap",
(M,N)=>N.linearDepthTexture),new x.Texture2DPassUniform("highlightMap",(M,N)=>N.highlightColorTexture),new p.Float4PassUniform("uColor",M=>M.shadowColor),new q.Float2PassUniform("nearFar",(M,N)=>N.camera.nearFar),new z.FloatPassUniform("opacity",M=>M.shadowOpacity),new z.FloatPassUniform("occludedOpacity",M=>M.occludedShadowOpacity),new z.FloatPassUniform("terminationFactor",M=>M.opacityElevation*M.dayNightTerminator),new k.Float3PassUniform("lightingMainDirectionView",(M,N)=>m.normalize(F,m.transformMat4(F,
N.lighting.mainLight.direction,N.camera.viewInverseTransposeMatrix))),new q.Float2PassUniform("texelSize",(M,N)=>c.isSome(N.linearDepthTexture)?n.set(E,1/N.linearDepthTexture.descriptor.width,1/N.linearDepthTexture.descriptor.height):r.ZEROS),new B.Matrix4PassUniform("inverseViewMatrix",(M,N)=>b.invert(D,b.translate(D,N.camera.viewMatrix,N.camera.center)))]);K.constants.add("unoccludedHighlightFlag","vec4",e.unoccludedHighlightFlag).add("highlightedThreshold","float",w.highlightedThreshold).add("selfShadowThreshold",
"float",w.selfShadowThreshold);K.code.add(C.glsl`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`);K.code.add(C.glsl`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`);return J}const w={highlightedThreshold:.99999,selfShadowThreshold:.025},D=t.create(),F=d.create(),E=r.create();t=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.ShadowHighlight=t;a.build=y})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/boundedPlane"],function(a,c){const b=c.create();return function(){function t(){this._plane=c.create()}a._createClass(t,[{key:"isEnabled",
get:function(){return!c.equals(this.plane,b)}},{key:"plane",get:function(){return this._plane},set:function(n){c.copy(n||b,this._plane)}}]);return t}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ../core/shaderTechnique/ShaderTechniqueConfiguration ./BlendWeightsTechnique ./BlurTechnique ./EdgeDetectTechnique ./glUtil3D ../shaders/SMAAPassParameters ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A){c.SmaaRenderPass=function(x){function u(w,D){var F=x.call(this,{})||this;F._rctx=w;F._techniqueRep=D;F._passParameters=new z.SMAAPassParameters;F._isEnabled=!1;return F}b._inheritsLoose(u,x);var y=u.prototype;y.normalizeCtorArgs=function(){return{}};y.dispose=function(){this._abortController=r.abortMaybe(this._abortController);this.disable()};y._loadResources=function(w){if(r.isSome(this._abortController))return!1;if(r.isSome(this._passParameters.searchTexture))return!0;
this._abortController=new AbortController;const D=this._abortController.signal;(new Promise((F,E)=>a(["./SmaaRenderPassData"],F,E))).then(F=>this._loadTextures(F,D)).then(()=>w()).finally(()=>this._abortController=null);return!1};y._loadTextures=function(w,D){m.throwIfAborted(D);return Promise.all([this._loadTextureFromBase64(w.areaTexture,C.TextureSamplingMode.LINEAR,C.PixelFormat.RGB),this._loadTextureFromBase64(w.searchTexure,C.TextureSamplingMode.NEAREST,C.PixelFormat.LUMINANCE)]).then(([F,E])=>
{m.isAborted(D)?(F.dispose(),E.dispose(),m.throwIfAborted(D)):(this._passParameters.areaTexture=F,this._passParameters.searchTexture=E)})};y.enable=function(w){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const D=new l.ShaderTechniqueConfiguration;this._edgeDetectTechnique=this._techniqueRep.releaseAndAcquire(k.EdgeDetectTechnique,D,this._edgeDetectTechnique);this._blendWeightsTechnique=this._techniqueRep.releaseAndAcquire(v.BlendWeightsTechnique,
D,this._blendWeightsTechnique);this._blurTechnique=this._techniqueRep.releaseAndAcquire(q.BlurTechnique,D,this._blurTechnique)}if(!this._loadResources(w))return!1;this._vao=p.createScreenSizeTriangleVAO(this._rctx);this._passParameters.edges=new B.FramebufferObject(this._rctx,{colorTarget:C.TargetType.TEXTURE,depthStencilTarget:C.DepthStencilTargetType.NONE},{target:C.TextureType.TEXTURE_2D,pixelFormat:C.PixelFormat.RGB,dataType:C.PixelType.UNSIGNED_BYTE,samplingMode:C.TextureSamplingMode.LINEAR,
wrapMode:C.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});this._passParameters.blend=new B.FramebufferObject(this._rctx,{colorTarget:C.TargetType.TEXTURE,depthStencilTarget:C.DepthStencilTargetType.NONE},{target:C.TextureType.TEXTURE_2D,pixelFormat:C.PixelFormat.RGBA,dataType:C.PixelType.UNSIGNED_BYTE,samplingMode:C.TextureSamplingMode.LINEAR,wrapMode:C.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});return this._isEnabled=!0};y.disable=function(){this._isEnabled&&(this._vao=r.disposeMaybe(this._vao),
this._passParameters.areaTexture=r.disposeMaybe(this._passParameters.areaTexture),this._passParameters.searchTexture=r.disposeMaybe(this._passParameters.searchTexture),this._passParameters.blend=r.disposeMaybe(this._passParameters.blend),this._passParameters.edges=r.disposeMaybe(this._passParameters.edges),this._isEnabled=!1)};y.render=function(w){const D=this._validPassParameters;if(!r.isNone(D)){D.colorTexture=w;var F=this._rctx,E=F.getBoundFramebufferObject(),K=w.descriptor.width;w=w.descriptor.height;
F.bindVAO(this._vao);F.setViewport(0,0,K,w);D.edges.resize(K,w);F.bindFramebuffer(D.edges);F.setClearColor(0,0,0,1);F.clear(C.ClearBufferBit.COLOR_BUFFER_BIT);F.bindTechnique(this._edgeDetectTechnique,D,null);F.drawArrays(C.PrimitiveType.TRIANGLES,0,3);D.blend.resize(K,w);F.bindFramebuffer(D.blend);F.setClearColor(0,0,1,1);F.clear(C.ClearBufferBit.COLOR_BUFFER_BIT);F.bindTechnique(this._blendWeightsTechnique,D,null);F.drawArrays(C.PrimitiveType.TRIANGLES,0,3);F.bindFramebuffer(E);F.setClearColor(0,
1,0,1);F.clear(C.ClearBufferBit.COLOR_BUFFER_BIT);F.bindTechnique(this._blurTechnique,D,null);F.drawArrays(C.PrimitiveType.TRIANGLES,0,3)}};y._loadTextureFromBase64=function(w,D,F){return h.requestImage(w).then(E=>new A.Texture(this._rctx,{pixelFormat:F,dataType:C.PixelType.UNSIGNED_BYTE,wrapMode:C.TextureWrapMode.CLAMP_TO_EDGE,width:E.width,height:E.height,samplingMode:D},E))};b._createClass(u,[{key:"updating",get:function(){return r.isSome(this._abortController)}},{key:"_validPassParameters",get:function(){return this._isEnabled?
this._passParameters:null}}]);return u}(n);t.__decorate([d.property()],c.SmaaRenderPass.prototype,"_abortController",void 0);t.__decorate([d.property({readOnly:!0})],c.SmaaRenderPass.prototype,"updating",null);c.SmaaRenderPass=t.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],c.SmaaRenderPass);Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BlendWeightsTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/BlendWeights.glsl ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f){n=function(e){function g(){return e.apply(this,arguments)||this}b._inheritsLoose(g,e);var h=g.prototype;h.initializeProgram=function(l){return new m.Program(l.rctx,g.shader.get().build(),r.Default3D)};h.initializePipeline=function(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})};return g}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.BlendWeights,()=>new Promise((e,g)=>a(["../shaders/BlendWeights.glsl"],e,g)));c.BlendWeightsTechnique=n;
Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/BlendWeights.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),function(a,c,b,t,n,r){function m(){const e=new b.ShaderBuilder,{attributes:g,varyings:h,vertex:l,
fragment:v}=e;g.add(n.VertexAttribute.POSITION,"vec2");h.add("uv","vec2");h.add("offsets[2]","vec4");h.add("maxOffset","vec4");h.add("pixelCoord","vec2");r.addResolutionUniform(l);l.code.add(c.glsl`
      void main() {
        uv = position * 0.5 + vec2(0.5);
        gl_Position = vec4(position, 0, 1);

        pixelCoord = uv * resolution.zw;
        offsets[0] = uv.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        offsets[1] = uv.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        maxOffset = vec4( offsets[0].xz, offsets[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${c.glsl.int(d.maxSearchSteps)} );
      }
    `);v.uniforms.add(new t.Texture2DPassUniform("edgesTexture",q=>q.edges.colorTexture));v.uniforms.add(new t.Texture2DPassUniform("areaTexture",q=>q.areaTexture));v.uniforms.add(new t.Texture2DPassUniform("searchTexture",q=>q.searchTexture));r.addResolutionUniform(v);v.code.add(c.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 sampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign(x) * floor(abs(x) + 0.5);
      }

      float searchLength(sampler2D searchTex, vec2 e, float bias, float scale) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float searchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${c.glsl.int(d.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * searchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float searchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${c.glsl.int(d.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * searchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float searchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${c.glsl.int(d.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * searchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float searchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${c.glsl.int(d.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * searchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 getArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${c.glsl.int(d.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      void main() {
        ivec4 subsampleIndices = ivec4(0.0);
        vec4 weights = vec4(0.0);
        vec2 e = texture2D( edgesTexture, uv ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = searchXLeft( edgesTexture, searchTexture, offsets[0].xy, maxOffset.x );
          coords.y = offsets[1].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).r;
          coords.x = searchXRight( edgesTexture, searchTexture, offsets[0].zw, maxOffset.y );
          d.y = coords.x;
          d = d * resolution.z - pixelCoord.x;
          vec2 sqrt_d = sqrt( abs(d) );
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = searchYUp( edgesTexture, searchTexture, offsets[1].xy, maxOffset.z );
          coords.x = offsets[0].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTexture, coords, 0.0 ).g;
          coords.y = searchYDown( edgesTexture, searchTexture, offsets[1].zw, maxOffset.w );
          d.y = coords.y;
          d = d * resolution.w - pixelCoord.y;
          vec2 sqrt_d = sqrt(abs(d));
          coords.y -= 1.0 * resolution.y;
          float e2 = sampleLevelZeroOffset( edgesTexture, coords, vec2(0.0, 1.0)).g;
          weights.ba = getArea( areaTexture, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offsets[0] + offsets[1] + maxOffset + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0, 1, 0, 1), dbg);
        }
        gl_FragColor = weights;
      }
    `);return e}const d={maxSearchSteps:8,maxDistanceAreaTex:16},f=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.BlendWeights=f;a.build=m})},"esri/views/3d/webgl-engine/shaders/SMAAPassParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderModules/Float4PassUniform ../core/shaderModules/interfaces".split(" "),function(a,c,b,t,n,r){r=function(f){function e(){return f.apply(this,
arguments)||this}c._inheritsLoose(e,f);return e}(r.NoParameters);let m=function(f){function e(){return f.apply(this,arguments)||this}c._inheritsLoose(e,f);return e}(r);const d=t.create();a.SMAAPassParameters=r;a.ValidSMAAPassParameters=m;a.addResolutionUniform=function(f){f.uniforms.add(new n.Float4PassUniform("resolution",e=>{var {descriptor:g}=e.colorTexture;e=g.width;g=g.height;return b.set(d,1/e,1/g,e,g)}))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/BlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/Blur.glsl ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f){n=function(e){function g(){return e.apply(this,arguments)||this}b._inheritsLoose(g,e);var h=g.prototype;h.initializeProgram=function(l){return new m.Program(l.rctx,g.shader.get().build(),r.Default3D)};h.initializePipeline=function(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})};return g}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.Blur,()=>new Promise((e,g)=>a(["../shaders/Blur.glsl"],e,g)));c.BlurTechnique=n;Object.defineProperty(c,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Blur.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),function(a,c,b,t,n,r){function m(){const f=new b.ShaderBuilder,{attributes:e,varyings:g,vertex:h,fragment:l}=f;e.add(n.VertexAttribute.POSITION,
"vec2");g.add("uv","vec2");g.add("offsets[2]","vec4");r.addResolutionUniform(h);h.code.add(c.glsl`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}`);l.uniforms.add(new t.Texture2DPassUniform("blendWeightsTexture",v=>v.blend.colorTexture));l.uniforms.add(new t.Texture2DPassUniform("colorTexture",v=>v.colorTexture));r.addResolutionUniform(l);l.code.add(c.glsl`void main() {
vec4 a;
a.rb = texture2D(blendWeightsTexture, uv).rb;
a.g = texture2D(blendWeightsTexture, offsets[1].zw).g;
a.a = texture2D(blendWeightsTexture, offsets[1].xy).a;
if ( dot(a, vec4(1.0)) < 1e-5 ) {
gl_FragColor = texture2D( colorTexture, uv, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTexture, uv, 0.0 );
vec4 Cop = texture2D( colorTexture, uv + sign( offset ) * resolution.xy, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
gl_FragColor = mix(C, Cop, s);
}
}`);return f}const d=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.Blur=d;a.build=m})},"esri/views/3d/webgl-engine/lib/EdgeDetectTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/EdgeDetect.glsl ../../../webgl/renderState".split(" "),function(a,c,b,t,n,r,
m,d,f){n=function(e){function g(){return e.apply(this,arguments)||this}b._inheritsLoose(g,e);var h=g.prototype;h.initializeProgram=function(l){return new m.Program(l.rctx,g.shader.get().build(),r.Default3D)};h.initializePipeline=function(){return f.makePipelineState({colorWrite:f.defaultColorWriteParams})};return g}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.EdgeDetect,()=>new Promise((e,g)=>a(["../shaders/EdgeDetect.glsl"],e,g)));c.EdgeDetectTechnique=n;Object.defineProperty(c,Symbol.toStringTag,
{value:"Module"})})},"esri/chunks/EdgeDetect.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/SMAAPassParameters".split(" "),function(a,c,b,t,n,r){function m(){const e=new b.ShaderBuilder,{attributes:g,varyings:h,vertex:l,fragment:v}=e;g.add(n.VertexAttribute.POSITION,
"vec2");r.addResolutionUniform(l);h.add("uv","vec2");h.add("offsets[3]","vec4");l.code.add(c.glsl`void main() {
uv = position * 0.5 + vec2(0.5);
gl_Position = vec4(position, 0, 1);
offsets[0] = uv.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
offsets[1] = uv.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
offsets[2] = uv.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}`);v.uniforms.add(new t.Texture2DPassUniform("colorTexture",q=>q.colorTexture));v.code.add(c.glsl`
    float absMax3(vec3 v) {
      vec3 t = abs(v);
      return max(max(t.r, t.g), t.b);
    }

    void main() {
      // Calculate color deltas:
      vec4 delta;
      vec3 C = texture2D(colorTexture, uv).rgb;

      vec3 Cleft = texture2D(colorTexture, offsets[0].xy).rgb;
      delta.x = absMax3(C - Cleft);

      vec3 Ctop = texture2D(colorTexture, offsets[0].zw).rgb;
      delta.y = absMax3(C - Ctop);

      vec2 edges = step(vec2(${c.glsl.float(d.threshold)}), delta.xy);

      // discard if there is no edge:
      if (dot(edges, vec2(1.0)) == 0.0) {
        discard;
      }

      // Calculate right and bottom deltas:
      vec3 Cright = texture2D(colorTexture, offsets[1].xy).rgb;
      delta.z = absMax3(C - Cright);

      vec3 Cbottom  = texture2D(colorTexture, offsets[1].zw).rgb;
      delta.w = absMax3(C - Cbottom);

      // Calculate the maximum delta in the direct neighborhood:
      float maxDelta = max(max(max(delta.x, delta.y), delta.z), delta.w);

      // Calculate left-left and top-top deltas:
      vec3 Cleftleft  = texture2D(colorTexture, offsets[2].xy).rgb;
      delta.z = absMax3(C - Cleftleft);

      vec3 Ctoptop = texture2D(colorTexture, offsets[2].zw).rgb;
      delta.w = absMax3(C - Ctoptop);

      // Calculate the final maximum delta:
      maxDelta = max(max(maxDelta, delta.z), delta.w);

      // Local contrast adaptation in action:
      edges.xy *= step(maxDelta, float(${c.glsl.float(d.localConstrastAdaption)}) * delta.xy);

      gl_FragColor = vec4(edges, 0.0, 0.0);
    }
  `);return e}const d={threshold:.05,localConstrastAdaption:2},f=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.EdgeDetect=f;a.build=m})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../core/support/WatchUpdatingTracking ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../../../ViewingMode ../../collections/Component/Material/shader/ComponentData.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexArrayObject ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeShaderParameters ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/BufferObject ../../../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q){function V(ca){d.isSome(ca)&&(ca.vao.vertexBuffers.instances.dispose(),ca.vao.dispose(!1),ca.vao=null)}function aa(ca){let ja=null,ia=null;for(let Z=0;Z<ca.geometries.length;Z++){const ha=ca.geometries[Z];if(ha.material.supportsEdges){if(!ja)ja=ha.transformation;else if(!n.equals(ja,ha.transformation))return!1;if(!ia&&d.isSome(ha.localOrigin))ia=ha;else if(ia&&d.isSome(ia.localOrigin)&&d.isSome(ha.localOrigin)&&
ia.localOrigin.id!==ha.localOrigin.id)return!1}}return!0}function X(ca,ja,ia){ja*=ia;ia=n.binaryIndexOf(ca,ja,!0);return-1===ia?ja<ca[0]?ca.length:0:ca.length-ia}a.EdgeView=function(ca){function ja(Z){var ha=ca.call(this,Z)||this;ha._updatingHandles=new p.WatchUpdatingTracking;ha._perObjectData=new Map;ha._perObjectDataEvictionCache=new Set;ha._renderers=new Map;ha._gpuMemoryUsage=0;ha._workerAbort=new AbortController;ha._tmpModelPosition=k.create();ha._localOrigins=new w.LocalOriginManager(new u.GridLocalOriginFactory(Z.renderSR));
return ha}c._inheritsLoose(ja,ca);var ia=ja.prototype;ia.initialize=function(){this._worker=new I.EdgeWorkerHandle(this.schedule);this._componentColorManager=new O.BufferManager(this.rctx,3);const Z=K.VertexLayout.createBuffer(4);for(let ha=0;4>ha;ha++)Z.sideness.set(ha,0,0===ha||3===ha?0:1),Z.sideness.set(ha,1,0===ha||1===ha?0:1);this._verticesBufferObject=R.BufferObject.createVertex(this.rctx,Q.Usage.STATIC_DRAW,Z.buffer)};ia.destroy=function(){this.destroyed||(this._perObjectData.forEach(Z=>this._discardObjectEntry(Z)),
this._perObjectData.clear(),this._strokesTexture=d.disposeMaybe(this._strokesTexture),this._componentColorManager=d.destroyMaybe(this._componentColorManager),this._workerAbort.abort(),this._worker.destroy(),this._verticesBufferObject=d.disposeMaybe(this._verticesBufferObject),this._renderers.clear(),this._updatingHandles.destroy())};ia.shouldRender=function(){return 0<this._renderers.size};ia.addComponentObject=function(){var Z=c._asyncToGenerator(function*(ha,fa,ka,la,na,pa,va,wa){if(this.hasObject(ha))return this.getObjectMemoryUsage(ha);
let za;ka=new W(new Promise(sa=>za=sa),ka.center,ka.radius);this._perObjectData.set(ha,ka);ha=yield this._updatingHandles.addPromise(this._addComponentGeometry(fa,ka,la,na,pa,va,wa));this.setNeedsRender();za();return ha});return function(ha,fa,ka,la,na,pa,va,wa){return Z.apply(this,arguments)}}();ia.addOrUpdateObject3D=function(){var Z=c._asyncToGenerator(function*(ha,fa,ka,la){if(this.destroyed)r.getLogger(this.declaredClass).warn("Attempt to add an object to a destroyed instance");else{var na=this._perObjectData.get(ha);
0<na?.renderables.length&&this._perObjectDataEvictionCache.add(na);var pa,va=ha.boundingVolumeWorldSpace.bounds;va=new W(new Promise(za=>pa=za),z.getCenter(va),z.getRadius(va));this._perObjectData.set(ha,va);var wa=[];if(ka.mergeGeometries&&1<ha.geometries.length&&aa(ha))wa.push(this._addObjectMergedGeometries(ha,va,fa,ka,la));else for(let za=0;za<ha.geometries.length;za++){const sa=ha.geometries[za];sa.material.supportsEdges&&wa.push(this._addGeometry(ha,va,sa,fa[0],ka,la))}yield this._updatingHandles.addPromise(Promise.all(wa));
this._perObjectDataEvictionCache.delete(va);this._discardObjectEntry(na);this.setNeedsRender();pa()}});return function(ha,fa,ka,la){return Z.apply(this,arguments)}}();ia._discardObjectEntry=function(Z){Z&&(Z.renderables.length&&(Z.renderables.forEach(ha=>this._removeRenderable(ha)),this.setNeedsRender()),Z.loaded=null)};ia.hasObject=function(Z){return this._perObjectData.has(Z)};ia.updateAllComponentOpacities=function(){var Z=c._asyncToGenerator(function*(ha,fa){ha=yield this._updatingHandles.addPromise(this._getObjectEntry(ha));
if(!d.isNone(ha)){var ka=fa instanceof Array?la=>fa[la]:()=>fa;ha.renderables.forEach(la=>{const na=la.components.meta.length;for(let pa=0;pa<na;pa++){const va=ka(pa),wa=la.components.meta[pa],za=wa.index;wa.material.opacity=va;la.components.buffer.textureBuffer.setDataElement(za,1,3,255*va)}this._updateTransparency(la)});this.setNeedsRender()}});return function(ha,fa){return Z.apply(this,arguments)}}();ia.getObjectMemoryUsage=function(){var Z=c._asyncToGenerator(function*(ha){ha=yield this._getObjectEntry(ha);
return d.isSome(ha)?ha.renderables.reduce((fa,ka)=>fa+ka.statistics.gpuMemoryUsage,0):0});return function(ha){return Z.apply(this,arguments)}}();ia.updateAllComponentMaterials=function(){var Z=c._asyncToGenerator(function*(ha,fa,ka,la){const na=ha instanceof D.Object3D,pa=!!ka.hasSlicePlane,va=L.determineRendererType(fa),wa=N.EdgeRenderer.getKey(va,pa,na);ha=yield this._updatingHandles.addPromise(this._getObjectEntry(ha));d.isNone(ha)||(ha.renderables.forEach(za=>{if(wa!==za.rendererKey){var sa=this._renderers.get(za.rendererKey);
const ua=this._acquireRenderer(va,pa,na);sa.removeRenderable(za);--sa.refCount;za.rendererKey=wa;ua.addRenderable(za)}for(sa=0;sa<fa.length;sa++)za.components.meta[sa].material=fa[sa];la&&this._updateComponentBuffer(za.components);this._updateTransparency(za)}),this.setNeedsRender())});return function(ha,fa,ka,la){return Z.apply(this,arguments)}}();ia.updateAllVerticalOffsets=function(){var Z=c._asyncToGenerator(function*(ha,fa){ha=yield this._updatingHandles.addPromise(this._getObjectEntry(ha));
d.isNone(ha)||(ha.renderables.forEach(ka=>{const la=ka.components.meta;for(let na=0;na<la.length;na++)ka.components.meta[na].verticalOffset=fa?.[na]??0;this._updateComponentBuffer(ka.components)}),this.setNeedsRender())});return function(ha,fa){return Z.apply(this,arguments)}}();ia.updateObjectVisibility=function(){var Z=c._asyncToGenerator(function*(ha,fa){ha=yield this._updatingHandles.addPromise(this._getObjectEntry(ha));d.isSome(ha)&&(ha.renderables.forEach(ka=>ka.visible=fa),this.setNeedsRender())});
return function(ha,fa){return Z.apply(this,arguments)}}();ia.removeObject=function(Z){const ha=this._perObjectData.get(Z);ha&&(this._perObjectData.delete(Z),this._discardObjectEntry(ha))};ia._getObjectEntry=function(){var Z=c._asyncToGenerator(function*(ha){ha=this._perObjectData.get(ha);if(!ha)throw Error("no object");yield ha.loaded;return null==ha.loaded?null:ha});return function(ha){return Z.apply(this,arguments)}}();ia.render=function(Z,ha){if(!d.isNone(this._componentColorManager)){this._localOrigins.updateViewMatrices(Z.camera.viewMatrix);
var fa=Z.camera.viewInverseTransposeMatrix,ka=k.create(),la=new x.TwoVectorPosition,na=0,pa=0;this._renderers.forEach(wa=>{if(0===wa.refCount)this._renderers.delete(wa.key),wa.dispose();else{let za=!0,sa=!0;wa.forEachRenderable(ua=>{ua.visible&&(na+=ua.statistics.averageEdgeLength,pa++,za&&ua.regular&&(wa.updateTechnique(Z,!1),za=!1),sa&&ua.silhouette&&(wa.updateTechnique(Z,!0),sa=!1))},ha)}});this._componentColorManager.garbageCollect();this._componentColorManager.updateTextures();if(0!==pa){var va=
new P.EdgePassParameters(40*na/pa,ha);q.set(ka,fa[3],fa[7],fa[11]);la.set(ka);q.copy(va.transformWorldFromViewTH,la.high);q.copy(va.transformWorldFromViewTL,la.low);h.fromMat4(va.transformViewFromCameraRelativeRS,Z.camera.viewMatrix);h.transpose(ea,va.transformViewFromCameraRelativeRS);h.invert(va.transformNormalViewFromGlobal,ea);va.transformProjFromView=Z.camera.projectionMatrix;this._updateObjectCameraDistances(Z);this._renderers.forEach(wa=>{this._renderRegularEdges(wa,Z,va);this._renderSilhouetteEdges(wa,
Z,va)})}}};ia._updateTransparency=function(Z){const ha=L.determineEdgeTransparency(Z.components.meta),fa=L.determineObjectTransparency(Z.components.meta);if(ha!==Z.edgeTransparency||fa!==Z.objectTransparency)Z.edgeTransparency=ha,Z.objectTransparency=fa,this._renderers.get(Z.rendererKey).setRenderablesDirty()};ia._computeModelTransformWithLocalOrigin=function(Z,ha,fa){Z.getCombinedStaticTransformation(ha,fa);Z=d.isSome(ha.localOrigin)?this._localOrigins.register(ha.localOrigin):this._localOrigins.acquire(q.set(this._tmpModelPosition,
fa[12],fa[13],fa[14]));ha.localOrigin=Z.origin;y.applyToModelMatrix(Z.origin.vec3,fa);return Z};ia._updateComponentBuffer=function(Z){const {meta:ha,buffer:fa}=Z;Z=new Uint8Array(4);for(let la=0;la<ha.length;la++){var ka=ha[la].material;const na=ha[la].index,pa=m.clamp(Math.round(ka.size*N.LINE_WIDTH_FRACTION_FACTOR),0,255),va=m.clamp(ka.extensionLength,-N.EXTENSION_LENGTH_OFFSET,255-N.EXTENSION_LENGTH_OFFSET)+N.EXTENSION_LENGTH_OFFSET,wa="solid"===ka.type?M.EdgeType.SOLID:M.EdgeType.SKETCH,za=255*
ka.opacity;ka=ka.color;fa.textureBuffer.setData(na,0,255*ka[0],255*ka[1],255*ka[2],255*ka[3]);fa.textureBuffer.setData(na,1,pa,va,wa,za);A.encodeElevationOffset(ha[la].verticalOffset,Z);fa.textureBuffer.setData(na,2,Z[0],Z[1],Z[2],Z[3])}};ia._createComponentBuffers=function(Z){if(d.isNone(this._componentColorManager))return null;const ha=[],fa=this._componentColorManager.getBuffer(Z.length);for(let ka=0;ka<Z.length;ka++){const la=Z[ka],na=fa.acquireIndex();ha.push({index:na,verticalOffset:0,material:la})}Z=
new T(fa,ha);this._updateComponentBuffer(Z);return Z};ia._extractEdges=function(Z,ha,fa,ka,la,na=la.length){return this._worker.process({data:ha,indices:la,indicesLength:na,writerSettings:Z,skipDeduplicate:fa},this._workerAbort.signal,ka)};ia._createRenderable=function(Z,ha,fa,ka,la){var na=wa=>d.isSome(this._verticesBufferObject)?new U(new F.VertexArrayObject(this.rctx,K.EdgeShaderAttributeLocations,{vertices:K.glVertexLayout,instances:wa===S.EdgeSilhouette.REGULAR?J.RegularEdgeBufferWriter.glLayout:
J.SilhouetteEdgeBufferWriter.glLayout},{vertices:this._verticesBufferObject,instances:R.BufferObject.createVertex(this.rctx,Q.Usage.STATIC_DRAW,wa===S.EdgeSilhouette.REGULAR?Z.regular.instancesData.buffer:Z.silhouette.instancesData.buffer)}),wa===S.EdgeSilhouette.REGULAR?Z.regular.lodInfo:Z.silhouette.lodInfo):null;const pa=0<Z.regular.lodInfo.lengths.length?na(S.EdgeSilhouette.REGULAR):null;na=0<Z.silhouette.lodInfo.lengths.length?na(S.EdgeSilhouette.SILHOUETTE):null;const va=(d.isSome(pa)?pa.vao.size:
0)+(d.isSome(na)?na.vao.size:0);return new ba(pa,na,{gpuMemoryUsage:va,externalMemoryUsage:la,averageEdgeLength:Z.averageEdgeLength},fa,L.determineEdgeTransparency(ha.meta),L.determineObjectTransparency(ha.meta),ha,ka)};ia._addGeometry=function(){var Z=c._asyncToGenerator(function*(ha,fa,ka,la,na,pa){var va=ka.vertexAttributes.get(E.VertexAttribute.POSITION);const wa=ka.indices.get(E.VertexAttribute.POSITION),za=v.create();ha=this._computeModelTransformWithLocalOrigin(ha,ka,za);va=new da(va,wa,za,
ha);return this._addPositionData(fa,va,ka.edgeIndicesLength,la,na,pa)});return function(ha,fa,ka,la,na,pa){return Z.apply(this,arguments)}}();ia._addPositionData=function(){var Z=c._asyncToGenerator(function*(ha,fa,ka,la,na,pa=!1){if(null!=ha.loaded){var va=this._createComponentBuffers([la]);if(!(d.isNone(va)||0>=ka)){la=this._acquireRenderer(la.type,!!na.hasSlicePlane,!0);var {modelTransform:wa,origin:za}=fa;na=fa.indices;fa=fa.position;var sa=fa.data.length/fa.size,ua=K.EdgeInputBufferLayout.createBuffer(sa);
for(let oa=0;oa<sa;oa++)ua.position.set(oa,0,fa.data[oa*fa.size]),ua.position.set(oa,1,fa.data[oa*fa.size+1]),ua.position.set(oa,2,fa.data[oa*fa.size+2]);L.fillComponenBufferIndices(va.meta,[0,ua.componentIndex.count],ua.componentIndex);ka=yield this._updatingHandles.addPromise(this._extractEdges(la.writerSettings,ua,!1,pa,na,ka));null!=ha.loaded&&(va=this._createRenderable(ka,va,new Y(wa,za),la.key,!1),ha.renderables.push(va),la.addRenderable(va),this._gpuMemoryUsage+=va.statistics.gpuMemoryUsage)}}});
return function(ha,fa,ka,la,na){return Z.apply(this,arguments)}}();ia._addComponentGeometry=function(){var Z=c._asyncToGenerator(function*(ha,fa,ka,la,na,pa,va){if(null==fa.loaded)return 0;const wa=this._createComponentBuffers(pa);if(d.isNone(wa))return 0;pa=L.determineRendererType(pa);va=this._acquireRenderer(pa,va.hasSlicePlane||!1,!1);pa=K.EdgeInputBufferLayout.createBuffer(ka.count);C.copy(pa.position,ka);L.fillComponenBufferIndices(wa.meta,na,pa.componentIndex,la);ka=yield this._updatingHandles.addPromise(this._extractEdges(va.writerSettings,
pa,!0,!1,la));if(null==fa.loaded)return 0;ha=this._createRenderable(ka,wa,ha,va.key,!0);fa.renderables.push(ha);va.addRenderable(ha);return ha.statistics.gpuMemoryUsage});return function(ha,fa,ka,la,na,pa,va){return Z.apply(this,arguments)}}();ia._addObjectMergedGeometries=function(){var Z=c._asyncToGenerator(function*(ha,fa,ka,la,na){var pa=new Map,va=0,wa=null,za=0;for(var sa=0;sa<ha.geometries.length;sa++){var ua=ha.geometries[sa];if(ua.material.supportsEdges){!wa&&ua.localOrigin&&(wa=ua);var oa=
ua.vertexAttributes.get(E.VertexAttribute.POSITION);za+=oa.data.length/oa.size;va+=ua.edgeIndicesLength}}za=65536<=za?Uint32Array:Uint16Array;va=va?new za(va):null;za=[];sa=0;for(ua=0;ua<ha.geometries.length;ua++){oa=ha.geometries[ua];if(!oa.material.supportsEdges)continue;var xa=oa.vertexAttributes.get(E.VertexAttribute.POSITION);const Ea=oa.indices.get(E.VertexAttribute.POSITION);let Ia=pa.get(xa.data);if(null==Ia){Ia=za.length/3;for(let Na=0;Na<xa.data.length;Na+=xa.size)za.push(xa.data[Na+0]),
za.push(xa.data[Na+1]),za.push(xa.data[Na+2]);pa.set(xa.data,Ia)}if(Ea)for(xa=0;xa<oa.edgeIndicesLength;xa++)va[sa++]=Ia+Ea[xa]}wa=wa||ha.geometries[0];pa=v.create();wa=this._computeModelTransformWithLocalOrigin(ha,wa,pa);for(sa=0;sa<ha.geometries.length;sa++)ha.geometries[sa].localOrigin=wa.origin;ha=new da({data:za,size:3},va,pa,wa);yield this._updatingHandles.addPromise(this._addPositionData(fa,ha,va.length,ka[0],la,na))});return function(ha,fa,ka,la,na){return Z.apply(this,arguments)}}();ia._acquireRenderer=
function(Z,ha,fa){const ka=N.EdgeRenderer.getKey(Z,ha,fa);let la=this._renderers.get(ka);d.isNone(this._strokesTexture)&&(this._strokesTexture=H.generateStrokesTexture(this.rctx));la||(la=new N.EdgeRenderer(this.rctx,this.techniqueRepository,{type:Z,hasSlicePlane:ha,strokesTexture:this._strokesTexture,legacy:fa,spherical:this.viewingMode===B.ViewingMode.Global}),this._renderers.set(ka,la));++la.refCount;return la};ia._removeRenderable=function(Z){V(Z.regular);V(Z.silhouette);const ha=this._renderers.get(Z.rendererKey);
if(ha){ha.removeRenderable(Z);--ha.refCount;"origin"in Z.transform&&this._localOrigins.release(Z.transform.origin);this._gpuMemoryUsage-=Z.statistics.externalMemoryUsage?0:Z.statistics.gpuMemoryUsage;for(const fa of Z.components.meta)Z.components.buffer.releaseIndex(fa.index)}};ia._updateObjectCameraDistances=function(Z){const ha=Z.camera.eye,fa=Z.camera.viewForward,ka=k.create();Z=la=>{q.sub(ka,la.center,ha);const na=q.dot(ka,fa),pa=la.radius,va=na<-pa?Infinity:na<pa?0:na-pa;la.renderables.forEach(wa=>
wa.distanceToCamera=va)};this._perObjectData.forEach(Z);this._perObjectDataEvictionCache.forEach(Z)};ia._renderRegularEdges=function(Z,ha,fa){const ka=Z.bindRegularEdges(fa,ha),la=ha.camera.perScreenPixelRatio;Z.forEachRenderable(na=>{if(d.isSome(na.regular)&&na.visible){var pa=X(na.regular.lod.lengths,na.distanceToCamera,la);Z.renderRegularEdges(ka,na,fa,ha,pa)}},fa.transparency)};ia._renderSilhouetteEdges=function(Z,ha,fa){const ka=Z.bindSilhouetteEdges(fa,ha),la=ha.camera.perScreenPixelRatio;Z.forEachRenderable(na=>
{if(d.isSome(na.silhouette)&&na.visible){var pa=X(na.silhouette.lod.lengths,na.distanceToCamera,la);Z.renderSilhouetteEdges(ka,na,fa,ha,pa)}},fa.transparency)};c._createClass(ja,[{key:"updating",get:function(){return this._updatingHandles.updating}},{key:"usedMemory",get:function(){return this._gpuMemoryUsage}},{key:"test",get:function(){return{hasRenderedPrimitives:Z=>{let ha=!1;const fa=Z.perScreenPixelRatio,ka=(la,na)=>la.forEachRenderable(pa=>{pa.visible&&!ha&&(d.isSome(pa.regular)&&(ha=0<X(pa.regular.lod.lengths,
pa.distanceToCamera,fa)),!ha&&d.isSome(pa.silhouette)&&(ha=0<X(pa.silhouette.lod.lengths,pa.distanceToCamera,fa)))},na);this._renderers.forEach(la=>{ha||(ka(la,G.Transparency.OPAQUE),ka(la,G.Transparency.TRANSPARENT))});return ha}}}}]);return ja}(t);b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"renderSR",void 0);b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"viewingMode",void 0);
b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",void 0);b.__decorate([f.property({constructOnly:!0})],a.EdgeView.prototype,"schedule",void 0);b.__decorate([f.property({readOnly:!0})],a.EdgeView.prototype,"_updatingHandles",void 0);b.__decorate([f.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=b.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],
a.EdgeView);let W=function(ca,ja,ia){this.center=ja;this.radius=ia;this.renderables=[];this.loaded=ca;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=!0)})},T=function(ca,ja){this.buffer=ca;this.meta=ja},U=function(ca,ja){this.vao=ca;this.lod=ja},Y=function(ca,ja){this.modelMatrix=ca;this.origin=ja},ba=function(ca,ja,ia,Z,ha,fa,ka,la){this.regular=ca;this.silhouette=ja;this.statistics=ia;this.transform=Z;this.edgeTransparency=ha;this.objectTransparency=fa;this.components=ka;this.rendererKey=
la;this.distanceToCamera=0;this.visible=!0};b=function(ca){function ja(){return ca.apply(this,arguments)||this}c._inheritsLoose(ja,ca);return ja}(ba);t=function(ca){function ja(){return ca.apply(this,arguments)||this}c._inheritsLoose(ja,ca);return ja}(ba);let da=function(ca,ja,ia,Z){this.position=ca;this.indices=ja;this.modelTransform=ia;this.origin=Z};const ea=l.create();a.LegacyTransform=Y;a.RegularRenderable=b;a.Renderable=ba;a.SilhouetteRenderable=t;Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(c,b){const t=-c[0],n=-c[1];c=-c[2];const r=b[3],m=b[7],d=b[11],f=b[15];b[0]+=r*t;b[1]+=r*n;b[2]+=r*c;b[4]+=m*t;b[5]+=m*n;b[6]+=m*c;b[8]+=d*t;b[9]+=d*n;b[10]+=d*c;b[12]+=f*t;b[13]+=f*n;b[14]+=f*c};a.applyToViewMatrix=function(c,b){const t=c[0],n=c[1];c=c[2];b[12]+=t*b[0]+n*b[4]+c*b[8];b[13]+=t*b[1]+n*b[5]+c*b[9];b[14]+=t*b[2]+n*b[6]+c*b[10];b[14]+=t*b[3]+n*
b[7]+c*b[11]};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(a,c,b,t){let n=function(){function m(f){this._factory=f;this._originData=new Map}var d=m.prototype;d.acquire=function(f){return this.register(this._factory.getOrigin(f))};d.register=function(f){f=this._originData.get(f.id)||new r(f);f.refCount++;this._originData.has(f.origin.id)||
this._originData.set(f.origin.id,f);return f};d.release=function(f){f.refCount--;0===f.refCount&&this._originData.delete(f.origin.id)};d.updateViewMatrices=function(f){this._originData.forEach(e=>{c.copy(e.viewMatrix,f);t.applyToViewMatrix(e.origin.vec3,e.viewMatrix)})};return m}(),r=function(m){this.origin=m;this.refCount=0;this.viewMatrix=b.create()};a.LocalOriginManager=n;a.OriginData=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../support/debugFlags ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){const q={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0},k={solid:l.EdgeUtilMode.SOLID,sketch:l.EdgeUtilMode.SKETCH,uber:l.EdgeUtilMode.MIXED};l=function(){function z(B,A,x){this._rctx=B;this._shaderTechniqueRepository=A;this._configuration=new g.EdgeShaderTechniqueConfiguration;this.refCount=0;this._renderables=new Set;this._sortedRenderables={[h.Transparency.TRANSPARENT]:{[h.Transparency.TRANSPARENT]:new b,[h.Transparency.OPAQUE]:new b},
[h.Transparency.OPAQUE]:{[h.Transparency.TRANSPARENT]:new b,[h.Transparency.OPAQUE]:new b}};this._renderablesDirty=!1;this._drawParameters=new f.EdgeDrawParameters;this._settings={...q,...x};this.key=z.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:m.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=k[this._settings.type];this._configuration.silhouette=
!1;this._configuration.antialiasing=!!this._rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=B.driverTest.doublePrecisionRequiresObfuscation.result;this._configuration.spherical=x.spherical}var C=z.prototype;C.dispose=function(){this._technique=c.releaseMaybe(this._technique)};C.addRenderable=function(B){this._renderables.add(B);this._renderablesDirty=!0};C.removeRenderable=function(B){this._renderables.delete(B);
this._renderablesDirty=!0};C.setRenderablesDirty=function(){this._renderablesDirty=!0};C.forEachRenderable=function(B,A){this._renderablesDirty&&this._sortRenderables();this._sortedRenderables[A][h.Transparency.TRANSPARENT].forAll(B);this._sortedRenderables[A][h.Transparency.OPAQUE].forAll(B)};C.updateTechnique=function(B,A){this._configuration.hasMultipassTerrain=!!B.multipassTerrain.enabled;this._configuration.cullAboveGround=!!B.multipassTerrain.cullAboveGround;this._configuration.silhouette=A;
return this._technique=this._shaderTechniqueRepository.releaseAndAcquire(e.EdgeShaderTechnique,this._configuration,this._technique)};C.bindRegularEdges=function(B,A){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(A,!1),B,A)};C.bindSilhouetteEdges=function(B,A){this._lastOriginId=null;return this._rctx.bindTechnique(this.updateTechnique(A,!0),B,A)};C.renderRegularEdges=function(B,A,x,u,y){this._render(B,A,A.regular.vao,x,u,y)};C.renderSilhouetteEdges=function(B,A,x,u,
y){this._render(B,A,A.silhouette.vao,x,u,y)};C._render=function(B,A,x,u,y,w){0<w&&(this._bindDraw(B,A,u,y),this._rctx.bindVAO(x),this._rctx.capabilities.instancing.drawArraysInstanced(v.PrimitiveType.TRIANGLE_FAN,0,4,w))};C._bindDraw=function(B,A,x,u){this._drawParameters.componentDataTexture=A.components.buffer.textureBuffer.texture;this._drawParameters.strokesTexture=this._settings.strokesTexture;if("origin"in A.transform)this._lastOriginId!==A.transform.origin.origin.id&&(B.setUniformMatrix4fv("localView",
A.transform.origin.viewMatrix),this._lastOriginId=A.transform.origin.origin.id),B.setUniformMatrix4fv("model",A.transform.modelMatrix),this._drawParameters.slicePlaneLocalOrigin=A.transform.origin.origin.vec3;else{const y=new d.TwoVectorPosition(A.transform.position),w=t.transpose(p,t.invert(p,A.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=y.low;this._drawParameters.transformWorldFromModelTH=y.high;this._drawParameters.transformWorldFromModelRS=A.transform.rotationScale;
this._drawParameters.transformNormalGlobalFromModel=w;A=u.camera.viewInverseTransposeMatrix;r.set(this._drawParameters.slicePlaneLocalOrigin,A[3],A[7],A[11])}B.bindDraw(this._drawParameters,u,x)};C._sortRenderables=function(){this._renderablesDirty=!1;this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.TRANSPARENT].clear();this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.OPAQUE].clear();this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.TRANSPARENT].clear();
this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.OPAQUE].clear();this._renderables.forEach(A=>{A.objectTransparency!==h.Transparency.INVISIBLE&&A.edgeTransparency!==h.Transparency.INVISIBLE&&this._sortedRenderables[A.objectTransparency][A.edgeTransparency].push(A)});const B=(A,x)=>"origin"in A.transform?"origin"in x.transform?A.transform.origin.origin.id<x.transform.origin.origin.id?-1:A.transform.origin.origin.id>x.transform.origin.origin.id?1:0:1:0;this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.TRANSPARENT].sort(B);
this._sortedRenderables[h.Transparency.TRANSPARENT][h.Transparency.OPAQUE].sort(B);this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.TRANSPARENT].sort(B);this._sortedRenderables[h.Transparency.OPAQUE][h.Transparency.OPAQUE].sort(B)};z.getKey=function(B,A,x){return`edges-t:${B}:${A}:${x}`};return z}();const p=n.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=l;a.LINE_WIDTH_FRACTION_FACTOR=8;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/mat3f64","../../../../../chunks/vec3f64","../../core/shaderLibrary/attributes/VertexPosition.glsl"],function(a,c,b,t,n){let r=function(m){function d(f,e){var g=m.call(this)||this;g.distanceFalloffFactor=f;g.transparency=e;g.transformNormalViewFromGlobal=b.create();return g}c._inheritsLoose(d,m);return d}(n.VertexPositionPassParameters);n=function(m){function d(){var f=m.apply(this,arguments)||this;f.transformNormalViewFromGlobal=
b.create();f.slicePlaneLocalOrigin=t.create();f.transformNormalGlobalFromModel=b.create();return f}c._inheritsLoose(d,m);return d}(n.VertexPositionDrawParameters);a.EdgeDrawParameters=n;a.EdgePassParameters=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../Program ./bufferLayouts ../../../../../chunks/EdgeShader.glsl ../../../../webgl/context-util ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){n=function(h){function l(){return h.apply(this,arguments)||this}b._inheritsLoose(l,h);var v=l.prototype;v.initializeConfiguration=function(q,k){k.hasWebGL2Context=q.rctx.type===f.ContextType.WEBGL2};v.initializeProgram=function(q){return new r.Program(q.rctx,l.shader.get().build(this.configuration),m.EdgeShaderAttributeLocations)};v.initializePipeline=function(q){return q.blendMinMax?g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ONE,
e.BlendFactor.ZERO,e.BlendFactor.ONE,e.BlendOperation.ADD,q.blendMinMax.MAX),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams}):g.makePipelineState({depthTest:{func:e.CompareFunction.LEQUAL},depthWrite:g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams})};return l}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(d.EdgeShader,()=>new Promise((h,l)=>a(["../../shaders/sources/edgeRenderer/EdgeShader.glsl"],h,l)));c.EdgeShaderTechnique=n;Object.defineProperty(c,
Symbol.toStringTag,{value:"Module"})})},"esri/chunks/EdgeShader.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Uniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B){function A(y){const w=new g.ShaderBuilder,{vertex:D,fragment:F}=w;y.legacy&&D.uniforms.add([new u("model"),new u("localView")]);w.include(v.AdjustProjectedPosition,y);w.include(p.EdgeUtil,y);w.include(z.LineAmplitude,y);w.include(B.UnpackAttributes,y);w.include(C.LineOffset,y);w.include(n.SliceDraw,y);w.include(k.DiscardNonSilhouetteEdges,y);w.include(q.DiscardByCoverage,y);w.include(r.multipassTerrainTest,y);w.varyings.add("vColor","vec4");w.varyings.add("vRadius",
"float");w.varyings.add("vPosition","vec3");w.varyings.add("vWorldPosition","vec3");w.varyings.add("vViewPos","vec3");w.varyings.add("vLineLengthPixels","float");w.varyings.add("vSizeFalloffFactor","float");D.uniforms.add([new m.Float2PassUniform("pixelToNDC",(E,K)=>b.set(x,2/K.camera.fullViewport[2],2/K.camera.fullViewport[3])),new d.Float4PassUniform("viewport",(E,K)=>K.camera.fullViewport),new f.FloatPassUniform("pixelRatio",(E,K)=>K.camera.pixelRatio)]);w.attributes.add(l.VertexAttribute.POSITION0,
"vec3");w.attributes.add(l.VertexAttribute.POSITION1,"vec3");w.attributes.add(l.VertexAttribute.VARIANTOFFSET,"float");w.attributes.add(l.VertexAttribute.VARIANTSTROKE,"float");w.attributes.add(l.VertexAttribute.VARIANTEXTENSION,"float");D.code.add(e.glsl`
    const float opaqueCutoff = 1.0 / 255.0;

    void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
      vec2 sideness = unpackedAttributes.sideness;
      vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

      vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;

      vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
      vViewPos = viewPos;

      vec4 projPosV0 = projFromViewPosition(viewPosV0);
      vec4 projPosV1 = projFromViewPosition(viewPosV1);
      vec4 projPos = projFromViewPosition(viewPos);

      vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
      vec2 ndcToPixel = viewport.zw * 0.5;
      vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
      float lineLengthPixels = length(screenSpaceLinePixels);

      float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
      vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;

      float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
      float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;

      float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
      float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;

      vSizeFalloffFactor = falloffFactor;

      float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
      float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;

      ${y.antialiasing?e.glsl`
        const float aaPaddingPixels = 1.0;

        // Line size with padding
        float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
        float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;`:e.glsl`
        float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
        float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;`}

      // Half line width in NDC including padding for anti aliasing
      vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
      vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
      vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;

      // Compute screen space position of vertex, offsetting for line size and end caps
      vec2 ndcOffset = (
          screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
        + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
      );

      projPos.xy += ndcOffset * projPos.w;
      projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;

      projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));

      // Line length with end caps
      float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;

      float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;

      // Position in pixels with origin at first vertex of line segment
      vPosition = vec3(
        halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
        pixelPositionAlongLine,
        pixelPositionAlongLine / extendedLineLengthPixels
      );

      // The line width radius in pixels
      vRadius = lineWidthPixels * 0.5;
      vLineLengthPixels = extendedLineLengthPixels;

      // discard short edges below a certain length threshold
      ${y.mode===p.EdgeUtilMode.SKETCH?e.glsl`
        if (lineLengthPixels <= 3.0) {
          gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
          return;
        }`:y.mode===p.EdgeUtilMode.MIXED?e.glsl`
        if (lineLengthPixels <= 3.0 && unpackedAttributes.type <= 0.0) {
           gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
           return;
        }`:""}
      gl_Position = projPos;
    }

    void main() {
      ComponentData component = readComponentData();
      UnpackedAttributes unpackedAttributes = unpackAttributes(component);

      vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
      worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
      worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);

      // Component color
      vColor = component.color;

      // Discard fully transparent edges
      if (vColor.a < opaqueCutoff) {
        gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
        return;
      }

      if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
        return;
      }

      // General geometric computation for all types of edges
      calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);

      // Specific computation for different edge styles
      calculateStyleOutputs(unpackedAttributes);
    }
  `);F.code.add(e.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float positionX = position.x - calculateLineOffset();

      if (radius < 1.0) {
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);
        return vec2(0.5 - min(coverageX, coverageY), 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${y.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      gl_FragColor = vec4(vColor.rgb, vColor.a * coverage);
    }
  `);return w}const x=t.create();let u=function(y){function w(D){return y.call(this,D,"mat4")||this}c._inheritsLoose(w,y);return w}(h.Uniform);t=Object.freeze(Object.defineProperty({__proto__:null,build:A},Symbol.toStringTag,{value:"Module"}));a.EdgeShader=t;a.build=A})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/Float2PassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform".split(" "),
function(a,c,b,t,n,r,m){const d=c.fromValues(.5,-4E-4);a.AdjustProjectedPosition=function(f,e){f=f.vertex;f.include(b.IsNaN);f.constants.add("depthBias","vec2",d);f.uniforms.add(new t.Float2PassUniform("inverseViewport",(g,h)=>h.inverseViewport));e.legacy?(f.uniforms.add(new m.Matrix4PassUniform("proj",(g,h)=>h.camera.projectionMatrix)),f.code.add(n.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(f.uniforms.add(new r.Matrix3PassUniform("transformNormalViewFromGlobal",g=>g.transformNormalViewFromGlobal)),f.uniforms.add(new m.Matrix4PassUniform("transformProjFromView",g=>g.transformProjFromView)),f.code.add(n.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`));f.code.add(n.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,c){a.IsNaN=function(b){const t=c.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;b.code.add(t)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,c){a.DiscardByCoverage=function(b,t){b=b.fragment;b.constants.add("coverageTestThreshold","float",.01);t.antialiasing?b.code.add(c.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):b.code.add(c.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,c){a.DiscardNonSilhouetteEdges=function(b,t){b=b.vertex;t.silhouette?(b.code.add(c.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),t.legacy?b.code.add(c.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):b.code.add(c.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):b.code.add(c.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderLibrary/util/WebGL2Utils ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DDrawUniform ../../../core/shaderModules/TextureSizeUniformType ../../../lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){a.EdgeUtilMode=void 0;(function(k){k[k.SOLID=0]="SOLID";k[k.SKETCH=1]="SKETCH";k[k.MIXED=2]="MIXED";k[k.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeSilhouette=void 0;(function(k){k[k.REGULAR=0]="REGULAR";k[k.SILHOUETTE=1]="SILHOUETTE"})(a.EdgeSilhouette||(a.EdgeSilhouette={}));a.EdgeUtil=function(k,p){const z=k.vertex;z.include(t.RgbaFloatEncoding);z.uniforms.add(new d.FloatPassUniform("distanceFalloffFactor",C=>C.distanceFalloffFactor));z.code.add(f.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);z.uniforms.add(l.createTexture2DDrawSizeUniforms("componentDataTex",C=>C.componentDataTexture,p.hasWebGL2Context?v.TextureSizeUniformType.None:v.TextureSizeUniformType.InvSize));k.attributes.add(q.VertexAttribute.COMPONENTINDEX,"float");z.constants.add("componentColorFieldOffset","float",0);z.constants.add("componentOtherFieldOffset","float",1);z.constants.add("componentVerticalOffsetFieldOffset","float",2);z.constants.add("componentFieldCount","float",3);z.constants.add("lineWidthFractionFactor",
"float",8);z.constants.add("extensionLengthOffset","float",128);z.constants.add("verticalOffsetScale","float",2*c.MAX_ELEVATION_OFFSET);z.code.add(f.glsl`
    vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
      float fieldIndex = componentFieldCount * componentIndex + fieldOffset;

      vec2 textureSizeInverse = ${n.textureSize(p,"componentDataTex",!0)};

      float colIndex = mod(fieldIndex, 1.0 / textureSizeInverse.x);
      float rowIndex = floor(fieldIndex * textureSizeInverse.x);

      return vec2(colIndex, rowIndex) + 0.5;
    }

    struct ComponentData {
      vec4 color;
      float lineWidth;
      float extensionLength;
      float type;
      float verticalOffset;
    };

    ComponentData readComponentData() {
      vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
      vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
      vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);

      vec4 colorValue = ${n.texelFetch(p,"componentDataTex","colorIndex")};
      vec4 otherValue = ${n.texelFetch(p,"componentDataTex","otherIndex")};
      float verticalOffset = (rgba2float(${n.texelFetch(p,"componentDataTex","verticalOffsetIndex")}) - 0.5) * verticalOffsetScale;

      return ComponentData(
        vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity
        otherValue.x * (255.0 / lineWidthFractionFactor),
        otherValue.y * 255.0 - extensionLengthOffset,
        -(otherValue.z * 255.0) + 0.5, // SOLID (=0/255) needs to be > 0.0, SKETCHY (=1/255) needs to be <= 0;
        verticalOffset
      );
    }
  `);p.legacy?z.code.add(f.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(z.uniforms.add(new e.Matrix3DrawUniform("transformNormalGlobalFromModel",C=>C.transformNormalGlobalFromModel)),z.code.add(f.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));p.silhouette?(k.attributes.add(q.VertexAttribute.NORMALA,"vec3"),k.attributes.add(q.VertexAttribute.NORMALB,"vec3"),z.code.add(f.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(k.attributes.add(q.VertexAttribute.NORMAL,"vec3"),z.code.add(f.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));p.legacy?z.code.add(f.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(z.include(b.DoublePrecision,p),z.include(b.DoublePrecision,p),z.uniforms.add([new g.Matrix3PassUniform("transformViewFromCameraRelativeRS",C=>C.transformViewFromCameraRelativeRS),new e.Matrix3DrawUniform("transformWorldFromModelRS",C=>C.transformWorldFromModelRS),new r.Float3DrawUniform("transformWorldFromModelTL",C=>C.transformWorldFromModelTL),new r.Float3DrawUniform("transformWorldFromModelTH",C=>C.transformWorldFromModelTH),new m.Float3PassUniform("transformWorldFromViewTL",C=>C.transformWorldFromViewTL),
new m.Float3PassUniform("transformWorldFromViewTH",C=>C.transformWorldFromViewTH)]),z.code.add(f.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${p.spherical?f.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:f.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));z.uniforms.add(new h.Matrix4PassUniform("transformProjFromView",(C,B)=>B.camera.projectionMatrix));z.code.add(f.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);z.code.add(f.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(k){return k.mode===a.EdgeUtilMode.SKETCH||k.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(k){return k.mode===a.EdgeUtilMode.SOLID||k.mode===a.EdgeUtilMode.MIXED};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/FloatDrawUniform","../../../core/shaderModules/interfaces","./EdgeUtil.glsl","./UnpackAttributes.glsl"],
function(a,c,b,t,n){a.LineAmplitude=function(r,m){const d=r.vertex;r.include(n.UnpackAttributes,m);switch(m.mode){case t.EdgeUtilMode.SOLID:d.code.add(b.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case t.EdgeUtilMode.SKETCH:d.uniforms.add(new c.FloatDrawUniform("strokesAmplitude",f=>f.strokesTexture.amplitude));d.code.add(b.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case t.EdgeUtilMode.MIXED:d.uniforms.add(new c.FloatDrawUniform("strokesAmplitude",f=>f.strokesTexture.amplitude)),d.code.add(b.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,c,b,t,n){a.UnpackAttributes=function(r,m){const d=r.vertex;r.attributes.add(t.VertexAttribute.SIDENESS,"vec2");m.mode===n.EdgeUtilMode.MIXED?d.code.add(b.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):d.code.add(b.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(m.mode){case n.EdgeUtilMode.MIXED:d.code.add(b.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case n.EdgeUtilMode.SKETCH:d.code.add(b.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case n.EdgeUtilMode.SOLID:d.code.add(b.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case n.EdgeUtilMode.COUNT:break;default:c.neverReached(m.mode)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderLibrary/util/WebGL2Utils ../../../core/shaderModules/FloatDrawUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Texture2DDrawUniform ../../../core/shaderModules/TextureSizeUniformType ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),
function(a,c,b,t,n,r,m,d,f,e){let g=function(h){function l(){return h.apply(this,arguments)||this}c._inheritsLoose(l,h);return l}(r.NoParameters);a.LineOffset=function(h,l){h.include(e.UnpackAttributes,l);const {vertex:v,fragment:q}=h;f.usesSketchLogic(l)&&(v.uniforms.add(m.createTexture2DDrawSizeUniforms("strokesTexture",k=>k.strokesTexture.texture,l.hasWebGL2Context?d.TextureSizeUniformType.None:d.TextureSizeUniformType.InvSize)),v.uniforms.add([new n.FloatDrawUniform("strokesLog2Resolution",k=>
Math.log2(k.strokesTexture.resolution)),new n.FloatDrawUniform("strokeVariants",k=>k.strokesTexture.variants)]),h.varyings.add("vStrokeUV","vec2"),q.uniforms.add([new m.Texture2DDrawUniform("strokesTexture",k=>k.strokesTexture.texture),new n.FloatDrawUniform("strokesNormalizationScale",k=>k.strokesTexture.normalizationScale)]),v.code.add(r.glsl`
      void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
        vec2 sidenessNorm = unpackedAttributes.sidenessNorm;

        float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);

        vec2 textureSizeInverse = ${t.textureSize(l,"strokesTexture",!0)};
        vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * textureSizeInverse;
        vStrokeUV.x += variantOffset;
      }
    `),h.fragment.include(b.RgbaFloatEncoding),q.code.add(r.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(l.mode){case f.EdgeUtilMode.SOLID:v.code.add(r.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);q.code.add(r.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case f.EdgeUtilMode.SKETCH:v.code.add(r.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);q.code.add(r.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case f.EdgeUtilMode.MIXED:h.varyings.add("vType","float"),v.code.add(r.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),q.code.add(r.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};a.LineOffsetDrawParameters=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../materials/DefaultTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeUtil.glsl".split(" "),function(a,c,b,t,n,r){n=function(m){function d(){var f=
m.apply(this,arguments)||this;f.mode=r.EdgeUtilMode.SOLID;f.hasSlicePlane=!1;f.silhouette=!1;f.legacy=!1;f.antialiasing=!1;f.doublePrecisionRequiresObfuscation=!1;f.hasMultipassTerrain=!1;f.cullAboveGround=!1;f.spherical=!1;return f}c._inheritsLoose(d,m);return d}(n.DefaultTechniqueConfiguration);b.__decorate([t.parameter({count:r.EdgeUtilMode.COUNT})],n.prototype,"mode",void 0);b.__decorate([t.parameter()],n.prototype,"hasSlicePlane",void 0);b.__decorate([t.parameter()],n.prototype,"silhouette",
void 0);b.__decorate([t.parameter()],n.prototype,"legacy",void 0);b.__decorate([t.parameter()],n.prototype,"antialiasing",void 0);b.__decorate([t.parameter()],n.prototype,"doublePrecisionRequiresObfuscation",void 0);b.__decorate([t.parameter()],n.prototype,"hasMultipassTerrain",void 0);b.__decorate([t.parameter()],n.prototype,"cullAboveGround",void 0);b.__decorate([t.parameter()],n.prototype,"spherical",void 0);a.EdgeShaderTechniqueConfiguration=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/typedArrayUtil ../../../../../core/workers/WorkerHandle ../../../support/buffer/workerHelper ./edgeProcessing".split(" "),function(a,c,b,t,n,r){t=function(d){function f(g){return d.call(this,"EdgeProcessingWorker","extract",{extract:h=>[h.dataBuffer],extractComponentsEdgeLocations:h=>[h.dataBuffer],extractEdgeLocations:h=>[h.dataBuffer]},g)||
this}c._inheritsLoose(f,d);var e=f.prototype;e.process=function(){var g=c._asyncToGenerator(function*(h,l,v){if(v)return r.extract(h);h=yield this.invoke(new m(h),l);return this._unpackOutput(h)});return function(h,l,v){return g.apply(this,arguments)}}();e.extractEdgeLocations=function(){var g=c._asyncToGenerator(function*(h,l){h=yield this.invokeMethod("extractEdgeLocations",new m(h),l);return n.unpackInterleavedBuffer(h)});return function(h,l){return g.apply(this,arguments)}}();e.extractComponentsEdgeLocations=
function(){var g=c._asyncToGenerator(function*(h,l){h=yield this.invokeMethod("extractComponentsEdgeLocations",new m(h),l);return n.unpackInterleavedBuffer(h)});return function(h,l){return g.apply(this,arguments)}}();e._unpackOutput=function(g){return{regular:{instancesData:n.unpackInterleavedBuffer(g.regular.instancesData),lodInfo:{lengths:new Float32Array(g.regular.lodInfo.lengths)}},silhouette:{instancesData:n.unpackInterleavedBuffer(g.silhouette.instancesData),lodInfo:{lengths:new Float32Array(g.silhouette.lodInfo.lengths)}},
averageEdgeLength:g.averageEdgeLength}};return f}(t.WorkerHandle);let m=function(d){this.dataBuffer=d.data.buffer;this.writerSettings=d.writerSettings;this.skipDeduplicate=d.skipDeduplicate;this.indices=Array.isArray(d.indices)?d.indices:d.indices.buffer;this.indicesType=Array.isArray(d.indices)?"Array":b.isUint32Array(d.indices)?"Uint32Array":"Uint16Array";this.indicesLength=d.indicesLength};a.EdgeWorkerHandle=t;a.PackedInput=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports",
"../../../../geometry/support/buffer/BufferView","./InterleavedLayout"],function(a,c,b){function t(m){const d=[];m.fields.forEach((f,e)=>{var g=f.constructor;d.push([e,{...f,constructor:`${g.ElementType}_${g.ElementCount}`}])});return{stride:m.stride,fields:d,fieldNames:m.fieldNames}}function n(m){const d=b.newLayout();d.stride=m.stride;d.fieldNames=m.fieldNames;m.fields.forEach(f=>d.fields.set(f[0],{...f[1],constructor:r.get(f[1].constructor)}));return d}c=[c.BufferViewFloat,c.BufferViewVec2f,c.BufferViewVec3f,
c.BufferViewVec4f,c.BufferViewMat3f,c.BufferViewMat4f,c.BufferViewFloat64,c.BufferViewVec2f64,c.BufferViewVec3f64,c.BufferViewVec4f64,c.BufferViewMat3f64,c.BufferViewMat4f64,c.BufferViewUint8,c.BufferViewVec2u8,c.BufferViewVec3u8,c.BufferViewVec4u8,c.BufferViewUint16,c.BufferViewVec2u16,c.BufferViewVec3u16,c.BufferViewVec4u16,c.BufferViewUint32,c.BufferViewVec2u32,c.BufferViewVec3u32,c.BufferViewVec4u32,c.BufferViewInt8,c.BufferViewVec2i8,c.BufferViewVec3i8,c.BufferViewVec4i8,c.BufferViewInt16,c.BufferViewVec2i16,
c.BufferViewVec3i16,c.BufferViewVec4i16,c.BufferViewInt32,c.BufferViewVec2i32,c.BufferViewVec3i32,c.BufferViewVec4i32];const r=new Map;c.forEach(m=>r.set(`${m.ElementType}_${m.ElementCount}`,m));a.packInterleavedBuffer=function(m,d){d.push(m.buffer);return{buffer:m.buffer,layout:t(m.layout)}};a.packLayout=t;a.unpackInterleavedBuffer=function(m){return n(m.layout).createView(m.buffer)};a.unpackLayout=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define(["exports",
"../../../../../core/floatRGBA","../../../../../core/maybe","../../../../webgl/enums","../../../../webgl/Texture"],function(a,c,b,t,n){function r(e,g){if(!e)return null;var h=e.length/2;const l=.1*h;h=Array(h);let v=0;g=g===m.PRESSURE;for(let q=0;q<e.length;q+=2){const k=(e[q]+e[q+1])/2;g?h[v++]=Math.min(l,1-.5*(1-k)):h[v++]=Math.min(l,.5*k)}return h}var m;(function(e){e[e.DISTANCE=0]="DISTANCE";e[e.PRESSURE=1]="PRESSURE"})(m||(m={}));let d=function(){function e(g,h,l,v,q){this.resolution=g;this.normalizationScale=
h;this.amplitude=l;this.variants=v;this.texture=q}e.prototype.dispose=function(){this.texture=b.disposeMaybe(this.texture)};return e}();const f={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,
-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,
.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,
.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,
-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,
.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,
.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,
.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,
-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,
.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,
1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,
-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,
.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,
.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,
.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,
.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,
2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,
4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,
2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,
.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,
.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,
.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,
.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,
2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,
.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,
.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,
1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,
.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,
.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,
.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,
.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,
-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,
1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,
-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,
-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,
.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,
.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,
.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,
6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,
2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,
-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,
1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,
.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,
.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,
.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,
.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=d;a.generateStrokesTexture=function(e){const g=f.resolution;var h=g/2;const l=new Uint8Array(4*g*g),v=4*g*h;h=f.amplitude;const q=2*h,k=4*g,p=Math.log2(g)+1,z=f.strokes.length;let C=(p-1)*z*k;for(const {distance:B,pressure:A}of f.strokes){let x=B,u=A,y=C;for(let w=0;w<p;w++){0!==w&&(x=r(x,m.DISTANCE),u=r(u,m.PRESSURE));for(let D=0;D<f.resolution;D++){const F=u?u[D%u.length]:1;c.packFloatRGBA((x?x[D%x.length]/q:0)+.5,
l,y);c.packFloatRGBA(F,l,y+v);y+=4}y-=k*(z+1)}C+=k}e=new n.Texture(e,{pixelFormat:t.PixelFormat.RGBA,dataType:t.PixelType.UNSIGNED_BYTE,hasMipmap:!1,samplingMode:t.TextureSamplingMode.LINEAR,width:g,height:g,wrapMode:t.TextureWrapMode.REPEAT},l);return new d(g,q,h,z,e)};a.strokesDefinition=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/maybe","./interfaces"],function(a,c,b){a.determineEdgeTransparency=
function(t){let n=b.Transparency.INVISIBLE;for(const {material:r}of t)if(0<r.size*r.color[3]*r.opacity){if(1>r.color[3]*r.opacity)return b.Transparency.TRANSPARENT;n=b.Transparency.OPAQUE}return n};a.determineObjectTransparency=function(t){let n=b.Transparency.INVISIBLE;for(const {material:r}of t)if(0<r.size*r.color[3]*r.opacity){switch(r.objectTransparency){case b.Transparency.TRANSPARENT:case b.Transparency.INVISIBLE:return b.Transparency.TRANSPARENT;case b.Transparency.OPAQUE:if(1>r.opacity)return b.Transparency.TRANSPARENT}n=
b.Transparency.OPAQUE}return n};a.determineRendererType=function(t){let n=null;for(const r of t)if(t=r.type,0<r.size*r.color[3])if(c.isNone(n))n=t;else if(n!==t)return"uber";return c.isSome(n)?n:"uber"};a.fillComponenBufferIndices=function(t,n,r,m){for(let f=0;f<t.length;f++){const e=t[f].index;var d=n[f];const g=n[f+1];if(m)for(;d<g;d++)r.set(m[d],e);else for(;d<g;d++)r.set(d,e)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/time ../../../../core/accessorSupport/utils ../../../webgl/TimerPool".split(" "),
function(a,c,b,t,n,r,m){a.PerformanceCategory=void 0;(function(f){f.OVERLAY="overlay";f.PREPARE="prepare";f.SHADOW_MAP="shadow map";f.LINEAR_DEPTH="linear depth";f.ACCUMULATED_SHADOWS="accumulated shadows";f.NORMALS="normals";f.OBJECT_AND_LAYER_ID_COLOR="object/layer id color";f.SSAO="SSAO";f.OPAQUE="opaque";f.OPAQUE_EDGES="opaque edges";f.VOXEL="voxel";f.TRANSPARENT="transparent";f.TRANSPARENT_EDGES="transparent edges";f.HUD_VISIBILITY="HUD visibility";f.TRANSPARENT_TERRAIN="transparent terrain";
f.ENVIRONMENT="environment";f.LASER_LINE="laser line";f.OCCLUDED="occluded";f.ANTIALIASING="antialiasing";f.HIGHLIGHTS="highlights";f.HUD="HUD";f.HUD_OCCLUDED="HUD occluded";f.FINISH="finish"})(a.PerformanceCategory||(a.PerformanceCategory={}));let d=function(){function f(g){this._rctx=g;this._startTimeStampCPU=n.Milliseconds(0);this._lastTimeStampCPU=n.Milliseconds(0);this._totalCPUTime=new t("Total");this._cpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(h=>[h,new t(h)]));this._enableGPUTimer=
0;this._totalGPUTime=new t("GPU");this._gpuTimeSamplers=new Map(Object.values(a.PerformanceCategory).map(h=>[h,new t(h)]));this._totalTime=n.Milliseconds(0);this._totalFrameCount=0}var e=f.prototype;e.enableGPUPerformanceInfo=function(){if(b.isNone(this._gpuTimerPool)){const g=[...Object.values(a.PerformanceCategory),"Total"];this._gpuTimerPool=m.createElapsedTimerPool(this._rctx,g)}if(b.isNone(this._gpuTimerPool))return{hasGPUTimerSupport:!1,remove:()=>{}};++this._enableGPUTimer;return{hasGPUTimerSupport:!0,
remove:r.once(()=>{--this._enableGPUTimer;0===this._enableGPUTimer&&(this._gpuTimerPool=b.disposeMaybe(this._gpuTimerPool))})}};e.startFrame=function(){this._startTimeStampCPU=this._lastTimeStampCPU=n.Milliseconds(performance.now());b.isSome(this._gpuTimerPool)&&this._gpuTimerPool.start()};e.advance=function(g){var h=n.Milliseconds(performance.now());this._cpuTimeSamplers.get(g).record(h-this._lastTimeStampCPU);this._lastTimeStampCPU=h;b.isSome(this._gpuTimerPool)&&(h=this._gpuTimerPool.stop(g),this._gpuTimeSamplers.get(g).record(h),
this._gpuTimerPool.start())};e.finishFrame=function(){if(b.isSome(this._gpuTimerPool)){var g=this._gpuTimerPool.stop(a.PerformanceCategory.FINISH);this._gpuTimeSamplers.get(a.PerformanceCategory.FINISH).record(g)}g=n.Milliseconds(performance.now()-this._startTimeStampCPU);this._totalTime=n.Milliseconds(this._totalTime+g);this._totalCPUTime.record(g);b.isSome(this._gpuTimerPool)&&this._totalGPUTime.record(this.gpuTimeSamplers.reduce((h,l)=>h+(l.last||0),0));++this._totalFrameCount};c._createClass(f,
[{key:"totalCPUTimeSampler",get:function(){return this._totalCPUTime}},{key:"cpuTimeSamplers",get:function(){return Array.from(this._cpuTimeSamplers.values())}},{key:"totalGPUTimeSampler",get:function(){return this._totalGPUTime}},{key:"gpuTimeSamplers",get:function(){return Array.from(this._gpuTimeSamplers.values())}},{key:"gpuSamplingEnabled",get:function(){return b.isSome(this._gpuTimerPool)}},{key:"totalTime",get:function(){return this._totalTime}},{key:"totalFrameCount",get:function(){return this._totalFrameCount}},
{key:"elapsedTime",get:function(){return n.Milliseconds(performance.now()-this._startTimeStampCPU)}}]);return f}();a.RendererPerformanceInfo=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/TimerPool":function(){define(["exports","../../core/maybe","./capabilities/DisjointTimerQuery"],function(a,c,b){let t=function(){function n(m,d){this._timer=m;this._queryPool=[];this._queryResults=new Map;this._currentQuery=null;d.forEach(f=>{const e=this._timer.createQuery(),
g=this._timer.createQuery();this._queryPool.push(e,g);this._queryResults.set(f,null)})}var r=n.prototype;r.start=function(){b.hasRunningElapsedTimer||(this._currentQuery=this._queryPool.pop(),c.isNone(this._currentQuery)||(this._timer.disjoint(),this._timer.beginTimeElapsed(this._currentQuery)))};r.stop=function(m){if(this._timer.disjoint()||c.isNone(this._currentQuery)||!this._queryResults.has(m))return this.abort(),null;this._timer.endTimeElapsed();const d=this._queryResults.get(m);if(c.isNone(d))return this._queryResults.set(m,
this._currentQuery),this._currentQuery=null;if(!this._timer.resultAvailable(d))return this._queryPool.unshift(this._currentQuery),this._currentQuery=null;const f=this._timer.getResult(d)/1E6;this._queryPool.unshift(d);this._queryResults.set(m,this._currentQuery);this._currentQuery=null;return f};r.abort=function(){c.isSome(this._currentQuery)&&(this._timer.deleteQuery(this._currentQuery),this._queryPool.unshift(this._timer.createQuery()),this._currentQuery=null)};r.dispose=function(){c.isSome(this._currentQuery)&&
this._timer.deleteQuery(this._currentQuery);this._queryPool.forEach(m=>{this._timer.deleteQuery(m)});this._queryResults.forEach(m=>{c.isNone(m)||this._timer.deleteQuery(m)})};return n}();a.createElapsedTimerPool=function(n,r){n=n.capabilities.disjointTimerQuery;return c.isNone(n)?null:new t(n,r)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(a,c){let b=function(t,n,r,m,d,
f,e,g,h){this.createQuery=t;this.deleteQuery=n;this.resultAvailable=r;this.getResult=m;this.disjoint=d;this.beginTimeElapsed=f;this.endTimeElapsed=e;this.createTimestamp=g;this.timestampBits=h};a.hasRunningElapsedTimer=!1;a.DisjointTimerQuery=b;a.createDisjointTimerQuery=function(t,n){if(n.disjointTimerQuery)return null;let r=t.getExtension("EXT_disjoint_timer_query_webgl2");return r&&c(t)?new b(()=>t.createQuery(),m=>{t.deleteQuery(m);a.hasRunningElapsedTimer=!1},m=>t.getQueryParameter(m,t.QUERY_RESULT_AVAILABLE),
m=>t.getQueryParameter(m,t.QUERY_RESULT),()=>t.getParameter(r.GPU_DISJOINT_EXT),m=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,t.beginQuery(r.TIME_ELAPSED_EXT,m))},()=>{t.endQuery(r.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},m=>r.queryCounterEXT(m,r.TIMESTAMP_EXT),()=>t.getQuery(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):(r=t.getExtension("EXT_disjoint_timer_query"))?new b(()=>r.createQueryEXT(),m=>{r.deleteQueryEXT(m);a.hasRunningElapsedTimer=!1},m=>r.getQueryObjectEXT(m,r.QUERY_RESULT_AVAILABLE_EXT),
m=>r.getQueryObjectEXT(m,r.QUERY_RESULT_EXT),()=>t.getParameter(r.GPU_DISJOINT_EXT),m=>{a.hasRunningElapsedTimer||(a.hasRunningElapsedTimer=!0,r.beginQueryEXT(r.TIME_ELAPSED_EXT,m))},()=>{r.endQueryEXT(r.TIME_ELAPSED_EXT);a.hasRunningElapsedTimer=!1},m=>r.queryCounterEXT(m,r.TIMESTAMP_EXT),()=>r.getQueryEXT(r.TIMESTAMP_EXT,r.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&
a instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/RenderingContext"],function(a,c,b){b=function(t){function n(m,d,f){m=t.call(this,m,d)||this;m.newCache=f;m._refCount=1;return m}c._inheritsLoose(n,t);var r=n.prototype;r.destroy=function(){0<--this._refCount||this.dispose()};r.ref=function(){++this._refCount};r.bindTechnique=function(m,d,f,e){this.useProgram(m.program);
m.bindPipelineState(this,f?.slot,!!e);m.program.bindPass(d,f);return m.program};c._createClass(n,[{key:"test",get:function(){return this.programCache.test}}]);return n}(b.RenderingContext);a.RenderingContext=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./context-util ./ContextState ./enums ./InstanceCounter ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){function z(A,x,u,y){x?y!==x&&A.bindBuffer(u,x.glName):A.bindBuffer(u,null);return x}function C(A,x){switch(A){case f.PrimitiveType.POINTS:return 2*x;case f.PrimitiveType.TRIANGLES:return x/3;case f.PrimitiveType.TRIANGLE_STRIP:return x-2;case f.PrimitiveType.TRIANGLE_FAN:return x-2;default:return 0}}let B=function(){function A(u,y){this.gl=u;this.instanceCounter=new e.InstanceCounter;this.programCache=new g.ProgramCache(this);this._state=new d.ContextState;
this._numOfTriangles=this._numOfDrawCalls=0;this.type=p(u)?m.ContextType.WEBGL2:m.ContextType.WEBGL1;this._loadExtensions();this.configure(y)}var x=A.prototype;x.configure=function(u){this._capabilities=new k.Capabilities(this.gl,u);this._parameters=this._loadParameters(u);u=this.gl.getParameter(this.gl.VIEWPORT);this._state=new d.ContextState;this._state.viewport={x:u[0],y:u[1],width:u[2],height:u[3]};this._stateTracker=new h.StateTracker({setBlending:y=>{y?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(y.opRgb,
y.opAlpha),this.setBlendFunctionSeparate(y.srcRgb,y.dstRgb,y.srcAlpha,y.dstAlpha),y=y.color,this.setBlendColor(y.r,y.g,y.b,y.a)):this.setBlendingEnabled(!1)},setCulling:y=>{y?(this.setFaceCullingEnabled(!0),this.setCullFace(y.face),this.setFrontFace(y.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:y=>{y?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(y.factor,y.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:y=>{y?(this.setDepthTestEnabled(!0),this.setDepthFunction(y.func)):
this.setDepthTestEnabled(!1)},setStencilTest:y=>{if(y){this.setStencilTestEnabled(!0);const w=y.function;this.setStencilFunction(w.func,w.ref,w.mask);y=y.operation;this.setStencilOp(y.fail,y.zFail,y.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:y=>{y?(this.setDepthWriteEnabled(!0),this.setDepthRange(y.zNear,y.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:y=>{y?this.setColorMask(y.r,y.g,y.b,y.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:y=>{y?this.setStencilWriteMask(y.mask):
this.setStencilWriteMask(0)}});this.enforceState();b.disposeMaybe(this._driverTest);this._driverTest=new q.WebGLDriverTest(this)};x.dispose=function(){b.disposeMaybe(this._driverTest);this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(f.BufferType.ARRAY_BUFFER);this.unbindBuffer(f.BufferType.ELEMENT_ARRAY_BUFFER);this.type===m.ContextType.WEBGL2&&(this.unbindBuffer(f.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(f.BufferType.PIXEL_PACK_BUFFER),
this.unbindBuffer(f.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(f.BufferType.COPY_READ_BUFFER),this.unbindBuffer(f.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;r.webglDebugEnabled()&&console.log(this.instanceCounter.resourceInformation)};x.setPipelineState=function(u){this._stateTracker.setPipeline(u)};x.setBlendingEnabled=function(u){this._state.blend!==u&&(!0===u?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=u,this._stateTracker.invalidateBlending())};
x.externalProgramUpdate=function(){this._state.program?.stop();this._state.program=null};x.externalTextureUnitUpdate=function(u,y){for(let w=0;w<u.length;++w)this._state.textureUnitMap[u[w]]=null;0<=y&&(this._state.activeTexture=y)};x.externalVertexArrayObjectUpdate=function(){const u=this.capabilities.vao;u&&(u.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=null};x.externalVertexBufferUpdate=function(){this._state.vertexBuffer=null};
x.externalIndexBufferUpdate=function(){this._state.indexBuffer=null};x.setBlendColor=function(u,y,w,D){if(u!==this._state.blendColor.r||y!==this._state.blendColor.g||w!==this._state.blendColor.b||D!==this._state.blendColor.a)this.gl.blendColor(u,y,w,D),this._state.blendColor.r=u,this._state.blendColor.g=y,this._state.blendColor.b=w,this._state.blendColor.a=D,this._stateTracker.invalidateBlending()};x.setBlendFunction=function(u,y){if(u!==this._state.blendFunction.srcRGB||y!==this._state.blendFunction.dstRGB)this.gl.blendFunc(u,
y),this._state.blendFunction.srcRGB=u,this._state.blendFunction.srcAlpha=u,this._state.blendFunction.dstRGB=y,this._state.blendFunction.dstAlpha=y,this._stateTracker.invalidateBlending()};x.setBlendFunctionSeparate=function(u,y,w,D){if(this._state.blendFunction.srcRGB!==u||this._state.blendFunction.srcAlpha!==w||this._state.blendFunction.dstRGB!==y||this._state.blendFunction.dstAlpha!==D)this.gl.blendFuncSeparate(u,y,w,D),this._state.blendFunction.srcRGB=u,this._state.blendFunction.srcAlpha=w,this._state.blendFunction.dstRGB=
y,this._state.blendFunction.dstAlpha=D,this._stateTracker.invalidateBlending()};x.setBlendEquation=function(u){this._state.blendEquation.mode!==u&&(this.gl.blendEquation(u),this._state.blendEquation.mode=u,this._state.blendEquation.modeAlpha=u,this._stateTracker.invalidateBlending())};x.setBlendEquationSeparate=function(u,y){if(this._state.blendEquation.mode!==u||this._state.blendEquation.modeAlpha!==y)this.gl.blendEquationSeparate(u,y),this._state.blendEquation.mode=u,this._state.blendEquation.modeAlpha=
y,this._stateTracker.invalidateBlending()};x.setColorMask=function(u,y,w,D){if(this._state.colorMask.r!==u||this._state.colorMask.g!==y||this._state.colorMask.b!==w||this._state.colorMask.a!==D)this.gl.colorMask(u,y,w,D),this._state.colorMask.r=u,this._state.colorMask.g=y,this._state.colorMask.b=w,this._state.colorMask.a=D,this._stateTracker.invalidateColorWrite()};x.setClearColor=function(u,y,w,D){if(this._state.clearColor.r!==u||this._state.clearColor.g!==y||this._state.clearColor.b!==w||this._state.clearColor.a!==
D)this.gl.clearColor(u,y,w,D),this._state.clearColor.r=u,this._state.clearColor.g=y,this._state.clearColor.b=w,this._state.clearColor.a=D};x.setFaceCullingEnabled=function(u){this._state.faceCulling!==u&&(!0===u?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=u,this._stateTracker.invalidateCulling())};x.setPolygonOffsetFillEnabled=function(u){this._state.polygonOffsetFill!==u&&(!0===u?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),
this._state.polygonOffsetFill=u,this._stateTracker.invalidatePolygonOffset())};x.setPolygonOffset=function(u,y){if(this._state.polygonOffset[0]!==u||this._state.polygonOffset[1]!==y)this._state.polygonOffset[0]=u,this._state.polygonOffset[1]=y,this.gl.polygonOffset(u,y),this._stateTracker.invalidatePolygonOffset()};x.setCullFace=function(u){this._state.cullFace!==u&&(this.gl.cullFace(u),this._state.cullFace=u,this._stateTracker.invalidateCulling())};x.setFrontFace=function(u){this._state.frontFace!==
u&&(this.gl.frontFace(u),this._state.frontFace=u,this._stateTracker.invalidateCulling())};x.setScissorTestEnabled=function(u){this._state.scissorTest!==u&&(!0===u?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=u)};x.setScissorRect=function(u,y,w,D){if(this._state.scissorRect.x!==u||this._state.scissorRect.y!==y||this._state.scissorRect.width!==w||this._state.scissorRect.height!==D)this.gl.scissor(u,y,w,D),this._state.scissorRect.x=u,this._state.scissorRect.y=
y,this._state.scissorRect.width=w,this._state.scissorRect.height=D};x.setDepthTestEnabled=function(u){this._state.depthTest!==u&&(!0===u?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=u,this._stateTracker.invalidateDepthTest())};x.setClearDepth=function(u){this._state.clearDepth!==u&&(this.gl.clearDepth(u),this._state.clearDepth=u)};x.setDepthFunction=function(u){this._state.depthFunction!==u&&(this.gl.depthFunc(u),this._state.depthFunction=u,this._stateTracker.invalidateDepthTest())};
x.setDepthWriteEnabled=function(u){this._state.depthWrite!==u&&(this.gl.depthMask(u),this._state.depthWrite=u,this._stateTracker.invalidateDepthWrite())};x.setDepthRange=function(u,y){if(this._state.depthRange.zNear!==u||this._state.depthRange.zFar!==y)this.gl.depthRange(u,y),this._state.depthRange.zNear=u,this._state.depthRange.zFar=y,this._stateTracker.invalidateDepthWrite()};x.setStencilTestEnabled=function(u){this._state.stencilTest!==u&&(!0===u?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),
this._state.stencilTest=u,this._stateTracker.invalidateStencilTest())};x.setClearStencil=function(u){u!==this._state.clearStencil&&(this.gl.clearStencil(u),this._state.clearStencil=u)};x.setStencilFunction=function(u,y,w){if(this._state.stencilFunction.func!==u||this._state.stencilFunction.ref!==y||this._state.stencilFunction.mask!==w)this.gl.stencilFunc(u,y,w),this._state.stencilFunction.face=f.Face.FRONT_AND_BACK,this._state.stencilFunction.func=u,this._state.stencilFunction.ref=y,this._state.stencilFunction.mask=
w,this._stateTracker.invalidateStencilTest()};x.setStencilFunctionSeparate=function(u,y,w,D){if(this._state.stencilFunction.face!==u||this._state.stencilFunction.func!==y||this._state.stencilFunction.ref!==w||this._state.stencilFunction.mask!==D)this.gl.stencilFuncSeparate(u,y,w,D),this._state.stencilFunction.face=u,this._state.stencilFunction.func=y,this._state.stencilFunction.ref=w,this._state.stencilFunction.mask=D,this._stateTracker.invalidateStencilTest()};x.setStencilWriteMask=function(u){this._state.stencilWriteMask!==
u&&(this.gl.stencilMask(u),this._state.stencilWriteMask=u,this._stateTracker.invalidateStencilWrite())};x.setStencilOp=function(u,y,w){if(this._state.stencilOperation.face!==f.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==u||this._state.stencilOperation.zFail!==y||this._state.stencilOperation.zPass!==w)this.gl.stencilOp(u,y,w),this._state.stencilOperation.face=f.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=u,this._state.stencilOperation.zFail=y,this._state.stencilOperation.zPass=
w,this._stateTracker.invalidateStencilTest()};x.setStencilOpSeparate=function(u,y,w,D){if(this._state.stencilOperation.face!==u||this._state.stencilOperation.fail!==y||this._state.stencilOperation.zFail!==w||this._state.stencilOperation.zPass!==D)this.gl.stencilOpSeparate(u,y,w,D),this._state.stencilOperation.face=u,this._state.stencilOperation.fail=y,this._state.stencilOperation.zFail=w,this._state.stencilOperation.zPass=D,this._stateTracker.invalidateStencilTest()};x.setActiveTexture=function(u,
y=!1){const w=this._state.activeTexture;0<=u&&(y||u!==this._state.activeTexture)&&(this.gl.activeTexture(f.BASE_TEXTURE_UNIT+u),this._state.activeTexture=u);return w};x.clear=function(u){u&&this.gl.clear(u)};x.clearSafe=function(u,y=255){u&&(u&f.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),u&f.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),u&f.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(y),this.gl.clear(u))};x.drawArrays=function(u,y,w){r.webglDebugEnabled()&&
(this._numOfDrawCalls++,this._numOfTriangles+=C(u,w));this.gl.drawArrays(u,y,w);r.webglDebugEnabled()&&(u=v.getErrorString(this))&&console.error("drawArrays:",u)};x.drawElements=function(u,y,w,D){r.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=C(u,y));this.gl.drawElements(u,y,w,D);if(r.webglDebugEnabled()){const K=v.getErrorString(this);if(K){var F=this.getBoundVAO(),E=F?.indexBuffer;F={indexBuffer:E,vertexBuffers:F?.vertexBuffers};u={mode:u,count:y,type:w,offset:D};E=b.applySome(E,
J=>J.size)??0;y=D+y;console.error(`drawElements: ${K}${E<y?`. Buffer is too small. Attempted to draw index ${y} of ${E}`:""}`,{args:u,vao:F})}}};x.logInfo=function(){r.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};x.resetInfo=function(){r.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)};x.setViewport=function(u,y,w,D){w=Math.max(Math.round(w),1);D=Math.max(Math.round(D),1);const F=this._state.viewport;if(F.x!==u||F.y!==
y||F.width!==w||F.height!==D)F.x=u,F.y=y,F.width=w,F.height=D,this.gl.viewport(u,y,w,D)};x.getViewport=function(){const u=this._state.viewport;return{x:u.x,y:u.y,width:u.width,height:u.height}};x.useProgram=function(u){this._state.program!==u&&(this._state.program?.stop(),this._state.program=u,this.gl.useProgram(u?.glName??null))};x.bindTexture=function(u,y,w=!1){(y>=this.parameters.maxTextureImageUnits||0>y)&&console.error("Input texture unit is out of range of available units!");const D=this._state.textureUnitMap[y];
if(b.isNone(u)||null==u.glName)return b.isSome(D)&&(this.setActiveTexture(y,w),this.gl.bindTexture(D.descriptor.target,null)),this._state.textureUnitMap[y]=null,D;if(!w&&D===u)return u.isDirty&&(this.setActiveTexture(y,w),u.applyChanges()),D;this.setActiveTexture(y,w);this.gl.bindTexture(u.descriptor.target,u.glName);u.applyChanges();this._state.textureUnitMap[y]=u;return D};x.unbindTexture=function(u){if(!b.isNone(u))for(let y=0;y<this.parameters.maxTextureImageUnits;y++)this._state.textureUnitMap[y]===
u&&(this.bindTexture(null,y),this._state.textureUnitMap[y]=null)};x.bindFramebuffer=function(u,y=!1){if(y||this._state.readFramebuffer!==u||this._state.drawFramebuffer!==u)b.isNone(u)?(this.gl.bindFramebuffer(f.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(u.initializeAndBind(f.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=u,this._state.drawFramebuffer=u)};x.bindFramebufferSeparate=function(u,y,w=!1){const D=y===f.FramebufferTarget.READ_FRAMEBUFFER,
F=D?this._state.readFramebuffer:this._state.drawFramebuffer;if(w||F!==u)b.isNone(u)?this.gl.bindFramebuffer(y,null):u.initializeAndBind(y),D?this._state.readFramebuffer=b.unwrapOr(u,null):this._state.drawFramebuffer=b.unwrapOr(u,null)};x.blitFramebuffer=function(u,y,w=0,D=0,F=u.width,E=u.height,K=0,J=0,M=y.width,N=y.height,P=f.ClearBufferBit.COLOR_BUFFER_BIT,I=f.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(u,f.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(y,f.FramebufferTarget.DRAW_FRAMEBUFFER);
this.gl.blitFramebuffer(w,D,F,E,K,J,M,N,P,I)};x.bindBuffer=function(u,y){if(u)switch(y??(y=u.bufferType),y){case f.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=z(this.gl,u,y,this._state.vertexBuffer);break;case f.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=z(this.gl,u,y,this._state.indexBuffer);break;case f.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=z(this.gl,u,y,this._state.uniformBuffer);break;case f.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=z(this.gl,u,y,
this._state.pixelPackBuffer);break;case f.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=z(this.gl,u,y,this._state.pixelUnpackBuffer);break;case f.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=z(this.gl,u,y,this._state.copyReadBuffer);break;case f.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=z(this.gl,u,y,this._state.copyWriteBuffer)}};x.bindRenderbuffer=function(u){const y=this.gl;u||(y.bindRenderbuffer(y.RENDERBUFFER,null),this._state.renderbuffer=null);this._state.renderbuffer!==
u&&(y.bindRenderbuffer(y.RENDERBUFFER,u.glName),this._state.renderbuffer=u)};x._getBufferBinding=function(u,y){if(y>=this.parameters.maxUniformBufferBindings||0>y)return console.error("Uniform buffer binding point is out of range!"),null;u=this._state.uniformBufferBindingPoints;let w=u[y];b.isNone(w)&&(w={buffer:null,offset:0,size:0},u[y]=w);return w};x.bindBufferBase=function(u,y,w){const D=this._getBufferBinding(u,y);b.isNone(D)||D.buffer===w&&0===D.offset&&0===D.size||(this.gl.bindBufferBase(u,
y,w?w.glName:null),D.buffer=w,D.offset=0,D.size=0)};x.bindBufferRange=function(u,y,w,D,F){const E=this._getBufferBinding(u,y);b.isNone(E)||E.buffer===w&&E.offset===D&&E.size===F||(0!==D%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(u,y,w.glName,D,F),E.buffer=w,E.offset=D,E.size=F))};x.bindUBO=function(u,y,w,D){b.isNone(y)?this.bindBufferBase(f.BufferType.UNIFORM_BUFFER,u,null):
(r.webglDebugEnabled()&&(D??y.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),y.initialize(),void 0!==w&&void 0!==D?this.bindBufferRange(f.BufferType.UNIFORM_BUFFER,u,y.buffer,w,D):this.bindBufferBase(f.BufferType.UNIFORM_BUFFER,u,y.buffer))};x.unbindUBO=function(u){for(let y=0,w=this._state.uniformBufferBindingPoints.length;y<w;y++){const D=this._state.uniformBufferBindingPoints[y];b.isSome(D)&&D.buffer===u.buffer&&
this.bindBufferBase(f.BufferType.UNIFORM_BUFFER,y,null)}};x.unbindBuffer=function(u){switch(u){case f.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=z(this.gl,null,u,this._state.vertexBuffer);break;case f.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=z(this.gl,null,u,this._state.indexBuffer);break;case f.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=z(this.gl,null,u,this._state.uniformBuffer);break;case f.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=z(this.gl,null,u,
this._state.pixelPackBuffer);break;case f.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=z(this.gl,null,u,this._state.pixelUnpackBuffer);break;case f.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=z(this.gl,null,u,this._state.copyReadBuffer);break;case f.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=z(this.gl,null,u,this._state.copyWriteBuffer)}};x.bindVAO=function(u=null){b.isNone(u)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=
null):this._state.vertexArrayObject!==u&&(u.bind(),this._state.vertexArrayObject=u)};x.clientWaitAsync=function(){var u=c._asyncToGenerator(function*(y=n.Milliseconds(10)){const w=this.gl,D=w.fenceSync(f.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);if(!D)throw Error("Client wait failed, could not create sync object");this.instanceCounter.increment(f.ResourceType.Sync,D);w.flush();let F;do yield t.after(y),F=w.clientWaitSync(D,0,0);while(F===f.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(f.ResourceType.Sync,
D);w.deleteSync(D);if(F===f.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");});return function(){return u.apply(this,arguments)}}();x.getBoundFramebufferObject=function(u=f.FramebufferTarget.FRAMEBUFFER){return u===f.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer};x.getBoundVAO=function(){return this._state.vertexArrayObject};x.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(f.BufferType.ARRAY_BUFFER);
this.unbindBuffer(f.BufferType.ELEMENT_ARRAY_BUFFER);this.type===m.ContextType.WEBGL2&&(this.unbindBuffer(f.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(f.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(f.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(f.BufferType.COPY_READ_BUFFER),this.unbindBuffer(f.BufferType.COPY_WRITE_BUFFER));for(let u=0;u<this.parameters.maxTextureImageUnits;++u)this.bindTexture(null,u);this.setBlendingEnabled(!1);this.setBlendFunction(f.BlendFactor.ONE,
f.BlendFactor.ZERO);this.setBlendEquation(f.BlendOperation.ADD);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(f.Face.BACK);this.setFrontFace(f.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(f.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(f.CompareFunction.ALWAYS,
0,0);this.setStencilOp(f.StencilOperation.KEEP,f.StencilOperation.KEEP,f.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};x.enforceState=function(){var u=this.capabilities.vao;u&&u.bindVertexArray(null);const {gl:y,gl2:w}=this;for(var D=0;D<this.parameters.maxVertexAttributes;D++)y.disableVertexAttribArray(D);
this._state.vertexBuffer?y.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):y.bindBuffer(f.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?y.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):y.bindBuffer(f.BufferType.ELEMENT_ARRAY_BUFFER,null);if(b.isSome(w)){this._state.uniformBuffer?w.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):w.bindBuffer(f.BufferType.UNIFORM_BUFFER,null);for(D=0;D<this._parameters.maxUniformBufferBindings;D++){const F=
this._state.uniformBufferBindingPoints[D];if(b.isSome(F)){const {buffer:E,offset:K,size:J}=F;null!==E?0===K&&0===J?w.bindBufferBase(f.BufferType.UNIFORM_BUFFER,D,E.glName):w.bindBufferRange(f.BufferType.UNIFORM_BUFFER,D,E.glName,K,J):w.bindBufferBase(f.BufferType.UNIFORM_BUFFER,D,null)}}this._state.pixelPackBuffer?w.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):w.bindBuffer(f.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?w.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):w.bindBuffer(f.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?w.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):w.bindBuffer(f.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?w.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):w.bindBuffer(f.BufferType.COPY_WRITE_BUFFER,null);w.bindFramebuffer(f.FramebufferTarget.READ_FRAMEBUFFER,null);w.readBuffer(w.BACK);this._state.readFramebuffer&&
(w.bindFramebuffer(f.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),w.readBuffer(f.ColorAttachment.COLOR_ATTACHMENT0));w.bindFramebuffer(f.FramebufferTarget.DRAW_FRAMEBUFFER,this._state.drawFramebuffer?.glName??null)}else this._state.readFramebuffer=this._state.drawFramebuffer,y.bindFramebuffer(f.FramebufferTarget.FRAMEBUFFER,this._state.drawFramebuffer?.glName??null);if(u&&this._state.vertexArrayObject){if(u=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null;this.bindVAO(u)}y.useProgram(this._state.program?.glName??null);y.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);y.bindRenderbuffer(y.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?y.enable(this.gl.BLEND):y.disable(this.gl.BLEND);y.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);y.blendFuncSeparate(this._state.blendFunction.srcRGB,
this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);y.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);y.clearDepth(this._state.clearDepth);y.clearStencil(this._state.clearStencil);y.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);y.cullFace(this._state.cullFace);y.depthFunc(this._state.depthFunction);y.depthRange(this._state.depthRange.zNear,
this._state.depthRange.zFar);!0===this._state.depthTest?y.enable(y.DEPTH_TEST):y.disable(y.DEPTH_TEST);y.depthMask(this._state.depthWrite);y.frontFace(this._state.frontFace);y.lineWidth(1);!0===this._state.faceCulling?y.enable(y.CULL_FACE):y.disable(y.CULL_FACE);y.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?y.enable(y.POLYGON_OFFSET_FILL):y.disable(y.POLYGON_OFFSET_FILL);y.scissor(this._state.scissorRect.x,this._state.scissorRect.y,this._state.scissorRect.width,
this._state.scissorRect.height);!0===this._state.scissorTest?y.enable(y.SCISSOR_TEST):y.disable(y.SCISSOR_TEST);y.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);y.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?y.enable(y.STENCIL_TEST):y.disable(y.STENCIL_TEST);y.stencilMask(this._state.stencilWriteMask);
for(u=0;u<this.parameters.maxTextureImageUnits;u++)y.activeTexture(f.BASE_TEXTURE_UNIT+u),y.bindTexture(f.TextureType.TEXTURE_2D,null),y.bindTexture(f.TextureType.TEXTURE_CUBE_MAP,null),this.type===m.ContextType.WEBGL2&&(y.bindTexture(f.TextureType.TEXTURE_3D,null),y.bindTexture(f.TextureType.TEXTURE_2D_ARRAY,null)),D=this._state.textureUnitMap[u],b.isSome(D)&&y.bindTexture(D.descriptor.target,D.glName);y.activeTexture(f.BASE_TEXTURE_UNIT+this._state.activeTexture);u=this._state.viewport;y.viewport(u.x,
u.y,u.width,u.height);this.resetInfo()};x._loadExtensions=function(){this.type===m.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")};x._loadParameters=function(u){var y=this.capabilities.textureFilterAnisotropic;u=u.maxAnisotropy??Infinity;const w=this.type===m.ContextType.WEBGL2,D=this.gl;y={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:y?Math.min(this.gl.getParameter(y.MAX_TEXTURE_MAX_ANISOTROPY),u):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:w?D.getParameter(D.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:w?D.getParameter(D.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:w?D.getParameter(D.MAX_FRAGMENT_UNIFORM_BLOCKS):
0,maxUniformBlockSize:w?D.getParameter(D.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:w?D.getParameter(D.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:w?D.getParameter(D.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:w?D.getParameter(D.MAX_SAMPLES):1};l.Texture.TEXTURE_UNIT_FOR_UPDATES=y.maxTextureImageUnits-1;return y};c._createClass(A,[{key:"gl2",get:function(){return this.type===m.ContextType.WEBGL1?null:this.gl}},{key:"driverTest",get:function(){return this._driverTest}},{key:"contextAttributes",
get:function(){return this.gl.getContextAttributes()}},{key:"parameters",get:function(){return this._parameters}},{key:"capabilities",get:function(){return this._capabilities}}]);return A}();a.RenderingContext=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(a,c){a.ContextState=function(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:c.BlendFactor.ONE,dstRGB:c.BlendFactor.ZERO,
srcAlpha:c.BlendFactor.ONE,dstAlpha:c.BlendFactor.ZERO};this.blendEquation={mode:c.BlendOperation.ADD,modeAlpha:c.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=c.Face.BACK;this.frontFace=c.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=c.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;
this.polygonOffset=[0,0];this.stencilFunction={face:c.Face.FRONT_AND_BACK,func:c.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:c.Face.FRONT_AND_BACK,fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=
[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=null;this.activeTexture=0;this.textureUnitMap=[];this.vertexArrayObject=null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../support/AllocationTracer","./enums"],function(a,c,b,t){const n={RECORD_ALLOCATIONS:!1};let r=function(){function m(){this._current=[];this._max=[];for(this._allocations=new b.AllocationTracer(n.RECORD_ALLOCATIONS);this._current.length<
t.ResourceType.COUNT;)this._current.push(0),this._max.push(0)}var d=m.prototype;d.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};d.increment=function(f,e){const g=++this._current[f];this._max[f]=Math.max(g,this._max[f]);this._allocations.add(e)};d.decrement=function(f,e){--this._current[f];this._allocations.remove(e)};c._createClass(m,[{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}},{key:"total",
get:function(){return this.current.reduce((f,e)=>f+e,0)}},{key:"resourceInformation",get:function(){let f="";if(0<this.total){f+="Live objects:\n";for(let e=0;e<t.ResourceType.COUNT;++e){const g=this._current[e];0<g&&(f+=`${t.ResourceType[e]}: ${g}\n`)}}return f+=this._allocations.information}}]);return m}();a.InstanceCounter=r;a.test=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/AllocationTracer":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],
function(a,c){let b=function(){function t(r){this._allocations=new Map;r?Error.stackTraceLimit=Infinity:(this.add=()=>{},this.remove=()=>{})}var n=t.prototype;n.add=function(r){this._allocations.set(r,Error().stack)};n.remove=function(r){this._allocations.delete(r)};c._createClass(t,[{key:"information",get:function(){let r="";if(0<this._allocations.size){r+=`${this._allocations.size} live object allocations:\n`;const m=new Map;this._allocations.forEach(d=>{m.set(d,(m.get(d)??0)+1)});m.forEach((d,
f)=>{f=f.split("\n");f.shift();f.shift();r+=`${d}: ${f.shift()}\n`;f.forEach(e=>r+=`   ${e}\n`)})}return r}}]);return t}();a.AllocationTracer=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/NestedMap","./Program"],function(a,c,b,t,n){let r=function(){function m(f){this._rctx=f;this._store=new t.NestedMap}var d=m.prototype;d.dispose=function(){this._store.forEach(f=>
f.forEach(e=>e.dispose()));this._store.clear()};d.acquire=function(f,e,g,h){const l=this._store.get(f,e);if(b.isSome(l))return l.ref(),l;g=new n.Program(this._rctx,f,e,g,h);g.ref();this._store.set(f,e,g);return g};c._createClass(m,[{key:"test",get:function(){let f=0;this._store.forEach(e=>e.forEach(g=>f+=g.hasGLName?2:1));return{cachedWebGLObjects:f}}}]);return m}();a.ProgramCache=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/Program":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/has ../../core/maybe ./checkWebGLError ./context-util ./enums ./ShaderTranspiler".split(" "),
function(a,c,b,t,n,r,m,d,f){function e(v,q,k){v=v.gl;const p=v.createShader(q);v.shaderSource(p,k);v.compileShader(p);r.webglValidateShadersEnabled()&&!v.getShaderParameter(p,v.COMPILE_STATUS)&&(console.error("Compile error in ".concat(q===d.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(v.getShaderInfoLog(p)),console.error(g(k)));l.enabled&&(l.compiledLOC+=k.match(/\n/g).length+1);return p}function g(v){let q=2;return v.replace(/\n/g,()=>{var k=q++;k=1E3<=k?k.toString():("  "+
k).slice(-3);return"\n"+k+":"})}function h(v,q,k){const p=v.get(q);return p?b.update(p,k):(v.set(q,Array.from(k)),!0)}t=function(){function v(k,p,z,C,B=new Map){this._context=k;this._locations=C;this._uniformBlockBindings=B;this._refCount=1;this._compiled=!1;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;
k||console.error("RenderingContext isn't initialized!");0===p.length&&console.error("Shaders source should not be empty!");this._context.type===m.ContextType.WEBGL2&&(p=f.transpileShader(p,d.ShaderType.VERTEX_SHADER),z=f.transpileShader(z,d.ShaderType.FRAGMENT_SHADER));this._vShader=e(this._context,d.ShaderType.VERTEX_SHADER,p);this._fShader=e(this._context,d.ShaderType.FRAGMENT_SHADER,z);this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(d.ResourceType.Shader,
this);r.webglValidateShadersEnabled()&&(this.vertexShader=p,this.fragmentShader=z);const A=this._context.gl,x=A.createProgram();A.attachShader(x,this._vShader);A.attachShader(x,this._fShader);this._locations.forEach((u,y)=>A.bindAttribLocation(x,u,y));A.linkProgram(x);r.webglValidateShadersEnabled()&&!A.getProgramParameter(x,A.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${A.getProgramParameter(x,A.VALIDATE_STATUS)}`+`, gl error ${A.getError()}`+`, vertex: ${A.getShaderParameter(this._vShader,
A.COMPILE_STATUS)}`+`, fragment: ${A.getShaderParameter(this._fShader,A.COMPILE_STATUS)}`+`, info log: ${A.getProgramInfoLog(x)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);if(this._context.type===m.ContextType.WEBGL2)for(const [u,y]of this._uniformBlockBindings)k=A.getUniformBlockIndex(x,u),4294967295>k&&A.uniformBlockBinding(x,k,y);this._glName=x;this._context.instanceCounter.increment(d.ResourceType.Program,this)}var q=v.prototype;q.dispose=function(){if(!(0<
--this._refCount)){var k=this._context.gl;this._vShader&&(k.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(d.ResourceType.Shader,this));this._fShader&&(k.deleteShader(this._fShader),this._fShader=null);this._glName&&(k.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(d.ResourceType.Program,this))}};q.ref=function(){++this._refCount};q._getUniformLocation=function(k){void 0===this._nameToUniformLocation[k]&&n.isSome(this.glName)&&
(++l.numUniforms,this._nameToUniformLocation[k]=this._context.gl.getUniformLocation(this.glName,k));return this._nameToUniformLocation[k]};q.hasUniform=function(k){return null!==this._getUniformLocation(k)};q.setUniform1i=function(k,p){const z=this._nameToUniform1[k];if(void 0===z||p!==z)this._context.gl.uniform1i(this._getUniformLocation(k),p),this._nameToUniform1[k]=p};q.setUniform1iv=function(k,p){h(this._nameToUniform1v,k,p)&&this._context.gl.uniform1iv(this._getUniformLocation(k),p)};q.setUniform2iv=
function(k,p){h(this._nameToUniform2,k,p)&&this._context.gl.uniform2iv(this._getUniformLocation(k),p)};q.setUniform3iv=function(k,p){h(this._nameToUniform3,k,p)&&this._context.gl.uniform3iv(this._getUniformLocation(k),p)};q.setUniform4iv=function(k,p){h(this._nameToUniform4,k,p)&&this._context.gl.uniform4iv(this._getUniformLocation(k),p)};q.setUniform1f=function(k,p){const z=this._nameToUniform1[k];if(void 0===z||p!==z)this._context.gl.uniform1f(this._getUniformLocation(k),p),this._nameToUniform1[k]=
p};q.setUniform1fv=function(k,p){h(this._nameToUniform1v,k,p)&&this._context.gl.uniform1fv(this._getUniformLocation(k),p)};q.setUniform2f=function(k,p,z){const C=this._nameToUniform2.get(k);if(void 0===C)this._context.gl.uniform2f(this._getUniformLocation(k),p,z),this._nameToUniform2.set(k,[p,z]);else if(p!==C[0]||z!==C[1])this._context.gl.uniform2f(this._getUniformLocation(k),p,z),C[0]=p,C[1]=z};q.setUniform2fv=function(k,p){h(this._nameToUniform2,k,p)&&this._context.gl.uniform2fv(this._getUniformLocation(k),
p)};q.setUniform3f=function(k,p,z,C){const B=this._nameToUniform3.get(k);if(void 0===B)this._context.gl.uniform3f(this._getUniformLocation(k),p,z,C),this._nameToUniform3[k]=[p,z,C];else if(p!==B[0]||z!==B[1]||C!==B[2])this._context.gl.uniform3f(this._getUniformLocation(k),p,z,C),B[0]=p,B[1]=z,B[2]=C};q.setUniform3fv=function(k,p){h(this._nameToUniform3,k,p)&&this._context.gl.uniform3fv(this._getUniformLocation(k),p)};q.setUniform4f=function(k,p,z,C,B){const A=this._nameToUniform4.get(k);if(void 0===
A)this._context.gl.uniform4f(this._getUniformLocation(k),p,z,C,B),this._nameToUniform4.set(k,[p,z,C,B]);else if(void 0===A||p!==A[0]||z!==A[1]||C!==A[2]||B!==A[3])this._context.gl.uniform4f(this._getUniformLocation(k),p,z,C,B),A[0]=p,A[1]=z,A[2]=C,A[3]=B};q.setUniform4fv=function(k,p){h(this._nameToUniform4,k,p)&&this._context.gl.uniform4fv(this._getUniformLocation(k),p)};q.setUniformMatrix3fv=function(k,p,z=!1){h(this._nameToUniformMatrix3,k,p)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(k),
z,p)};q.setUniformMatrix4fv=function(k,p,z=!1){h(this._nameToUniformMatrix4,k,p)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(k),z,p)};q.stop=function(){};c._createClass(v,[{key:"glName",get:function(){return this._glName}},{key:"hasGLName",get:function(){return n.isSome(this._glName)}},{key:"compiled",get:function(){if(this._compiled)return!0;const k=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==k||n.isNone(this.glName)?this._compiled=!0:this._compiled=
!!this._context.gl.getProgramParameter(this.glName,k.COMPLETION_STATUS_KHR)}}]);return v}();const l={compiledLOC:0,numUniforms:0,enabled:!1};a.Program=t;a.test=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ../../core/maybe ./enums ./reservedWordsGLSL3 ./testUtils ../../chunks/builtins".split(" "),function(a,c,b,t,n,r,m){function d(){function z(S){S.length&&M.push({type:q[F],data:S,position:I,line:N,column:P})}
function C(){J=J.length?[]:J;if("/"===K&&"*"===E)return I=D+w-1,F=0,K=E,w+1;if("/"===K&&"/"===E)return I=D+w-1,F=1,K=E,w+1;if("#"===E)return F=2,I=D+w,w;if(/\s/.test(E))return F=9,I=D+w,w;G=/\d/.test(E);H=/[^\w_]/.test(E);I=D+w;F=G?4:H?3:9999;return w}function B(){if(("\r"===E||"\n"===E)&&"\\"!==K)return z(J.join("")),F=999,w;J.push(E);K=E;return w+1}function A(){if("."===K&&/\d/.test(E))return F=5,w;if("/"===K&&"*"===E)return F=0,w;if("/"===K&&"/"===E)return F=1,w;if("."===E&&J.length){for(;x(J););
F=5;return w}if(";"===E||")"===E||"("===E){if(J.length)for(;x(J););z(E);F=999;return w+1}var S=2===J.length&&"\x3d"!==E;if(/[\w_\d\s]/.test(E)||S){for(;x(J););F=999;return w}J.push(E);K=E;return w+1}function x(S){var R=0;do{var Q=m.operators.indexOf(S.slice(0,S.length+R).join(""));var V=m.operators[Q];if(-1===Q){if(0<R--+S.length)continue;V=S.slice(0,1).join("")}z(V);I+=V.length;J=J.slice(V.length);return J.length}while(1)}function u(){if("."===E||/[eE]/.test(E))return J.push(E),F=5,K=E,w+1;if("x"===
E&&1===J.length&&"0"===J[0])return F=11,J.push(E),K=E,w+1;if(/[^\d]/.test(E))return z(J.join("")),F=999,w;J.push(E);K=E;return w+1}function y(){"f"===E&&(J.push(E),K=E,w+=1);if(/[eE]/.test(E)||"-"===E&&/[eE]/.test(K))return J.push(E),K=E,w+1;if(/[^\d]/.test(E))return z(J.join("")),F=999,w;J.push(E);K=E;return w+1}var w=0,D=0,F=999,E,K,J=[],M=[],N=1,P=0,I=0,G=!1,H=!1,L="",O;return function(S){M=[];if(null!==S){S=S.replace?S.replace(/\r\n/g,"\n"):S;w=0;L+=S;for(O=L.length;E=L[w],w<O;){S=w;switch(F){case 0:"/"===
E&&"*"===K?(J.push(E),z(J.join("")),F=999):(J.push(E),K=E);w+=1;break;case 1:w=B();break;case 2:w=B();break;case 3:w=A();break;case 4:w=u();break;case 11:/[^a-fA-F0-9]/.test(E)?(z(J.join("")),F=999):(J.push(E),K=E,w+=1);break;case 5:w=y();break;case 9999:if(/[^\d\w_]/.test(E)){var R=J.join("");F=-1<m.literals.indexOf(R)?8:-1<m.builtins.indexOf(R)?7:6;z(J.join(""));F=999}else J.push(E),K=E,w+=1;break;case 9:/[^\s]/g.test(E)?(z(J.join("")),F=999):(J.push(E),K=E,w+=1);break;case 999:w=C()}if(S!==w)switch(L[S]){case "\n":P=
0;++N;break;default:++P}}D+=w;L=L.slice(w);return M}J.length&&z(J.join(""));F=10;z("(eof)");return M}}function f(z){return z.map(C=>"eof"!==C.type?C.data:"").join("")}function e(z,C="100",B="300 es"){const A=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const x of z)if("preprocessor"===x.type){const u=A.exec(x.data);if(u){z=u[1].replace(/\s\s+/g," ");if(z===B)return z;if(z===C)return x.data="#version "+B,C;throw Error("unknown glsl version: "+z);}}z.splice(0,0,{type:"preprocessor",data:"#version "+
B},{type:"whitespace",data:"\n"});return null}function g(z,C,B,A){A=A||B;for(const x of z)if("ident"===x.type&&x.data===B)return A in C?C[A]++:C[A]=0,g(z,C,A+"_"+C[A],A);return B}function h(z,C,B="afterVersion"){const A={data:"\n",type:"whitespace"},x=y=>y<z.length?/[^\r\n]$/.test(z[y].data):!1;let u=function(y){let w=-1,D=0,F=-1;for(let K=0;K<y.length;K++){var E=y[K];"preprocessor"===E.type&&(E.data.match(/#(if|ifdef|ifndef)\s+.+/)?++D:E.data.match(/#endif\s*.*/)&&--D);("afterVersion"===B||"afterPrecision"===
B)&&"preprocessor"===E.type&&/^#version/.test(E.data)&&(F=Math.max(F,K));if("afterPrecision"===B&&"keyword"===E.type&&"precision"===E.data){a:{for(E=K;E<y.length;E++){const J=y[E];if("operator"===J.type&&";"===J.data)break a}E=null}if(null===E)throw Error("precision statement not followed by any semicolons!");F=Math.max(F,E)}w<F&&0===D&&(w=K)}return w+1}(z);x(u-1)&&z.splice(u++,0,A);for(const y of C)z.splice(u++,0,y);x(u-1)&&x(u)&&z.splice(u,0,A)}function l(z,C,B,A="lowp"){h(z,[{type:"keyword",data:"out"},
{type:"whitespace",data:" "},{type:"keyword",data:A},{type:"whitespace",data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"ident",data:C},{type:"operator",data:";"}],"afterPrecision")}function v(z,C,B,A,x="lowp"){h(z,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:A.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},
{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:x},{type:"whitespace",data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"ident",data:C},{type:"operator",data:";"}],"afterPrecision")}var q="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const k=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"],p=new Map;a.transpileShader=function(z,
C){var B=r.shaderTranspiler.enableCache?p.get(z):null;if(b.isSome(B))return B;B=d();var A=[];A=A.concat(B(z));B=A=A.concat(B(null));if("300 es"===e(B,"100","300 es"))return z;var x=A=null;const u={},y={};for(let E=0;E<B.length;++E){const K=B[E];switch(K.type){case "keyword":C===t.ShaderType.VERTEX_SHADER&&"attribute"===K.data?K.data="in":"varying"===K.data&&(K.data=C===t.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(K.data.trim())&&(K.data=
K.data.replace(/(2D|Cube|EXT)/g,""));C===t.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===K.data&&(A||(A=g(B,u,"fragColor"),l(B,A,"vec4")),K.data=A);if(C===t.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===K.data){var w=void 0;let J=void 0;var D=B,F=E+1;let M=-1;for(;F<D.length;F++){const N=D[F];if("operator"===N.type&&("["===N.data&&(J=F),"]"===N.data)){w=F;break}"integer"===N.type&&(M=parseInt(N.data,10))}J&&w&&D.splice(J,w-J+1);D=M;w=g(B,u,"fragData");v(B,w,"vec4",D,"mediump");K.data=w}else C===t.ShaderType.FRAGMENT_SHADER&&
"gl_FragDepthEXT"===K.data&&(x||(x=g(B,u,"gl_FragDepth")),K.data=x);break;case "ident":if(n.includes(K.data)){if(D=C===t.ShaderType.VERTEX_SHADER)a:{for(D=E-1;0<=D;D--)if(w=B[D],"whitespace"!==w.type&&"block-comment"!==w.type)if("keyword"===w.type){if("attribute"===w.data||"in"===w.data){D=!0;break a}}else break;D=!1}if(D)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");K.data in y||(y[K.data]=g(B,u,K.data));K.data=y[K.data]}}}for(C=B.length-1;0<=C;--C)A=
B[C],"preprocessor"===A.type&&((x=A.data.match(/#extension\s+(.*):/))&&x[1]&&k.includes(x[1].trim())&&(x=B[C+1],B.splice(C,x&&"whitespace"===x.type?2:1)),(x=A.data.match(/#ifdef\s+(.*)/))&&x[1]&&k.includes(x[1].trim())&&(A.data="#if 1"),(x=A.data.match(/#ifndef\s+(.*)/))&&x[1]&&k.includes(x[1].trim())&&(A.data="#if 0"));B=f(B);r.shaderTranspiler.enableCache&&p.set(z,B);return B};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/builtins":function(){define(["exports"],function(a){var c={};(function(m){(function(d){d=d();void 0!==d&&(m.exports=d)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})({get exports(){return c},
set exports(m){c=m}});const b=c;var t={};(function(m){(function(d){d=d();void 0!==d&&(m.exports=d)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})({get exports(){return t},set exports(m){t=m}});const n=t;var r={};(function(m){(function(d){d=d();void 0!==d&&(m.exports=d)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT textureSize texelFetch".split(" ")})})({get exports(){return r},
set exports(m){r=m}});a.builtins=r;a.literals=b;a.operators=n})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ./testAppleAmdDrawArrays ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(a,c,b,t,n,r){let m=function(){function d(f){this.rctx=f;this.floatBufferBlend=new t.FloatBufferBlend(f);this.svgPremultipliesAlpha=new r.SVGPremultipliedAlpha(f);this.doublePrecisionRequiresObfuscation=new b.DoublePrecisionRequiresObfuscation(f);
this.ignoresSamplerPrecision=new n.IgnoresSamplerPrecision(f);this.drawArraysRequiresIndicesTypeReset=new c.DrawArraysRequiresIndicesTypeReset(f)}d.prototype.dispose=function(){this.ignoresSamplerPrecision.dispose();this.doublePrecisionRequiresObfuscation.dispose();this.svgPremultipliesAlpha.dispose();this.floatBufferBlend.dispose();this.drawArraysRequiresIndicesTypeReset.dispose()};return d}();a.WebGLDriverTest=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testAppleAmdDrawArrays":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../3d/webgl-engine/core/shaderModules/interfaces ./BufferObject ./context-util ./enums ./FramebufferObject ./WebGLDriverTestModule".split(" "),
function(a,c,b,t,n,r,m,d,f){f=function(e){function g(l){var v=e.call(this)||this;v._rctx=l;v._dummyProgram=null;v._rctx.type===r.ContextType.WEBGL2&&b("mac")&&b("chrome")&&(v._program=v._prepareProgram(),v._dummyProgram=v._prepareDummyProgram());return v}c._inheritsLoose(g,e);var h=g.prototype;h.dispose=function(){e.prototype.dispose.call(this);this._dummyProgram?.dispose();this._dummyProgram=null};h._test=function(l){const v=this._rctx;v.resetState();const q=new d.FramebufferObject(v,{colorTarget:m.TargetType.TEXTURE,
depthStencilTarget:m.DepthStencilTargetType.NONE},{target:m.TextureType.TEXTURE_2D,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.NEAREST,width:1,height:1}),k=n.BufferObject.createIndex(this._rctx,m.Usage.STATIC_DRAW,new Uint8Array([0]));v.bindFramebuffer(q);v.setViewport(0,0,1,1);v.useProgram(this._dummyProgram);v.bindBuffer(k,m.BufferType.ELEMENT_ARRAY_BUFFER);v.drawElements(m.PrimitiveType.POINTS,1,m.DataType.UNSIGNED_BYTE,
0);v.useProgram(l);v.bindVAO(null);v.drawArrays(m.PrimitiveType.TRIANGLES,0,258);l=new Uint8Array(4);q.readPixels(0,0,1,1,m.PixelFormat.RGBA,m.PixelType.UNSIGNED_BYTE,l);q.dispose();k.dispose();return 255===l[0]};h._prepareProgram=function(){const l=`\n    precision highp float;\n\n    varying float triangleId;\n\n    const vec3 triangleVertices[3] = vec3[3](vec3(-0.5, -0.5, 0.0), vec3(0.5, -0.5, 0.0), vec3(0.0, 0.5, 0.0));\n\n    void main(void) {\n      triangleId = floor(float(gl_VertexID)/3.0);\n\n      vec3 position = triangleVertices[gl_VertexID % 3];\n      float offset = triangleId / ${t.glsl.float(85)};\n      position.z = 0.5 - offset;\n\n      gl_Position = vec4(position, 1.0);\n    }\n    `,
v=`\n    precision highp float;\n\n    varying float triangleId;\n\n    void main(void) {\n      gl_FragColor = triangleId == ${t.glsl.float(85)} ? vec4(0.0, 1.0, 0.0, 1.0) : vec4(1.0, 0.0, 0.0, 1.0);\n    }\n    `;return this._rctx.programCache.acquire(l,v,new Map([]))};h._prepareDummyProgram=function(){return this._rctx.programCache.acquire("\n    void main(void) {\n      gl_Position \x3d vec4(0.0, 0.0, float(gl_VertexID)-2.0, 1.0);\n    }","\n    void main(void) {\n      gl_FragColor \x3d vec4(0.0, 0.0, 0.0, 1.0);\n    }",
new Map([]))};return g}(f.WebGLDriverTestModule);a.DrawArraysRequiresIndicesTypeReset=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/WebGLDriverTestModule":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe"],function(a,c,b){let t=function(){function n(){this._result=!1}n.prototype.dispose=function(){this._program=b.disposeMaybe(this._program)};c._createClass(n,[{key:"result",get:function(){b.isSome(this._program)&&(this._result=
this._test(this._program),this.dispose());return this._result}}]);return n}();a.WebGLDriverTestModule=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/floatRGBA ../../core/has ../../core/maybe ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){function v(q,k){return q.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${k?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]))}l=function(q){function k(z){var C=q.call(this)||this;C._rctx=z;C._program=v(C._rctx,!1);C._obfuscated=v(C._rctx,!0);return C}c._inheritsLoose(k,q);var p=k.prototype;p.dispose=function(){q.prototype.dispose.call(this);this._obfuscated=n.disposeMaybe(this._obfuscated)};p._test=function(z){if(t("force-double-precision-obfuscation"))return!0;if(n.isNone(this._obfuscated))return!1;
z=this._runProgram(z);const C=this._runProgram(this._obfuscated);return 0!==z&&(0===C||5<z/C)};p._runProgram=function(z){const C=this._rctx;C.resetState();var B=new e.FramebufferObject(C,{colorTarget:f.TargetType.TEXTURE,depthStencilTarget:f.DepthStencilTargetType.NONE},{target:f.TextureType.TEXTURE_2D,wrapMode:f.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:f.PixelFormat.RGBA,dataType:f.PixelType.UNSIGNED_BYTE,samplingMode:f.TextureSamplingMode.NEAREST,width:1,height:1}),A=m.BufferObject.createVertex(C,
f.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));const x=new g.VertexArrayObject(C,new Map([["position",0]]),{geometry:[new h.VertexElementDescriptor("position",2,f.DataType.UNSIGNED_SHORT,0,4)]},{geometry:A}),u=r.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),y=r.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387),w=new Float32Array(6);d.encodeDoubleArray(u,w,3);const D=new Float32Array(6);d.encodeDoubleArray(y,D,3);C.useProgram(z);z.setUniform3f("u_highA",
w[0],w[2],w[4]);z.setUniform3f("u_lowA",w[1],w[3],w[5]);z.setUniform3f("u_highB",D[0],D[2],D[4]);z.setUniform3f("u_lowB",D[1],D[3],D[5]);C.bindFramebuffer(B);C.setViewport(0,0,1,1);C.bindVAO(x);C.drawArrays(f.PrimitiveType.TRIANGLE_STRIP,0,4);z=new Uint8Array(4);B.readPixels(0,0,1,1,f.PixelFormat.RGBA,f.PixelType.UNSIGNED_BYTE,z);x.dispose(!1);A.dispose();B.dispose();B=(u[2]-y[2])/25;A=b.unpackFloatRGBA(z);return Math.abs(B-A)};return k}(l.WebGLDriverTestModule);a.DoublePrecisionRequiresObfuscation=
l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../3d/webgl-engine/lib/OrderIndependentTransparency ../../chunks/webgl-debug ./BufferObject ./context-util ./enums ./FramebufferObject ./renderState ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(a,c,b,t,n,r,m,d,f,e,g,h){h=function(l){function v(q){var k=l.call(this)||this;k._rctx=q;if(!q.gl)return c._assertThisInitialized(k);
if(q.type===r.ContextType.WEBGL1)return k._result=!(!q.capabilities.textureFloat?.textureFloat||!q.capabilities.colorBufferFloat?.textureFloat),c._assertThisInitialized(k);if(!(q.capabilities.textureFloat?.textureFloat&&q.capabilities.colorBufferFloat?.textureFloat&&q.capabilities.colorBufferFloat?.floatBlend))return c._assertThisInitialized(k);k._program=q.programCache.acquire("\n    precision highp float;\n    attribute vec2 a_pos;\n\n    void main() {\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n     precision highp float;\n\n     void main() {\n      gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n     }\n    ",new Map([["a_pos",0]]));return k}c._inheritsLoose(v,l);v.prototype._test=function(q){const k=this._rctx,p=new d.FramebufferObject(k,{colorTarget:m.TargetType.TEXTURE,depthStencilTarget:m.DepthStencilTargetType.NONE},{target:m.TextureType.TEXTURE_2D,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.FLOAT,internalFormat:m.SizedPixelFormat.RGBA32F,
samplingMode:m.TextureSamplingMode.NEAREST,width:1,height:1}),z=n.BufferObject.createVertex(k,m.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),C=new e.VertexArrayObject(k,new Map([["a_pos",0]]),{geometry:[new g.VertexElementDescriptor("a_pos",2,m.DataType.UNSIGNED_SHORT,0,4)]},{geometry:z});k.useProgram(q);q=k.getBoundFramebufferObject();const {x:B,y:A,width:x,height:u}=k.getViewport();k.bindFramebuffer(p);k.setViewport(0,0,1,1);k.bindVAO(C);k.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4);
var y=f.makePipelineState({blending:b.blendingAlpha});k.setPipelineState(y);k.drawArrays(m.PrimitiveType.TRIANGLE_STRIP,0,4);t.webglDebugExports.init(k);y=k.gl.getError();k.setViewport(B,A,x,u);k.bindFramebuffer(q);C.dispose(!1);z.dispose();p.dispose();return 1282===y?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0};return v}(h.WebGLDriverTestModule);a.FloatBufferBlend=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/chunks/webgl-debug":function(){define(["exports"],function(a){a.webglDebugExports={};(function(c){(function(b){b=b();void 0!==b&&(c.exports=b)})(function(){function b(l){if(null==g){g={};h={};for(var v in l)"number"==typeof l[v]&&(g[l[v]]=v,h[v]=l[v])}}function t(){if(null==g)throw"WebGLDebugUtils.init(ctx) not called";}function n(l){t();var v=g[l];return void 0!==v?"gl."+v:"/*UNKNOWN WebGL ENUM*/ 0x"+l.toString(16)}function r(l,v,q,k){l=e[l];if(void 0!==l&&(l=l[v],void 0!==l&&l[q])){if("object"===
typeof l[q]&&void 0!==l[q].enumBitwiseOr){v=l[q].enumBitwiseOr;q=0;l=[];for(var p=0;p<v.length;++p){var z=h[v[p]];0!==(k&z)&&(q|=z,l.push(n(z)))}return q===k?l.join(" | "):n(k)}return n(k)}return null===k?"null":void 0===k?"undefined":k.toString()}function m(l,v,q){l.__defineGetter__(q,function(){return v[q]});l.__defineSetter__(q,function(k){v[q]=k})}function d(l,v,q,k){function p(x,u){return function(){q&&q(u,arguments);var y=x[u].apply(x,arguments),w=k.getError();0!=w&&(z[w]=!0,v(w,u,arguments));
return y}}k=k||l;b(l);v=v||function(x,u,y){for(var w="",D=y.length,F=0;F<D;++F)w+=(0==F?"":", ")+r(u,D,F,y[F]);x="WebGL error "+n(x)+" in "+u+"("+w+")";window.console&&window.console.error?window.console.error(x):window.console&&window.console.log&&window.console.log(x)};var z={},C={},B;for(B in l)if("function"==typeof l[B])if("getExtension"!=B)C[B]=p(l,B);else{var A=p(l,B);C[B]=function(){var x=A.apply(l,arguments);return d(x,v,q,k)}}else m(C,l,B);C.getError=function(){for(var x in z)if(z.hasOwnProperty(x)&&
z[x])return z[x]=!1,x;return l.NO_ERROR};return C}function f(l){var v=l.getParameter(l.MAX_VERTEX_ATTRIBS),q=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,q);for(var k=0;k<v;++k)l.disableVertexAttribArray(k),l.vertexAttribPointer(k,4,l.FLOAT,!1,0,0),l.vertexAttrib1f(k,0);l.deleteBuffer(q);v=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS);for(k=0;k<v;++k)l.activeTexture(l.TEXTURE0+k),l.bindTexture(l.TEXTURE_CUBE_MAP,null),l.bindTexture(l.TEXTURE_2D,null);l.activeTexture(l.TEXTURE0);l.useProgram(null);l.bindBuffer(l.ARRAY_BUFFER,
null);l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null);l.bindFramebuffer(l.FRAMEBUFFER,null);l.bindRenderbuffer(l.RENDERBUFFER,null);l.disable(l.BLEND);l.disable(l.CULL_FACE);l.disable(l.DEPTH_TEST);l.disable(l.DITHER);l.disable(l.SCISSOR_TEST);l.blendColor(0,0,0,0);l.blendEquation(l.FUNC_ADD);l.blendFunc(l.ONE,l.ZERO);l.clearColor(0,0,0,0);l.clearDepth(1);l.clearStencil(-1);l.colorMask(!0,!0,!0,!0);l.cullFace(l.BACK);l.depthFunc(l.LESS);l.depthMask(!0);l.depthRange(0,1);l.frontFace(l.CCW);l.hint(l.GENERATE_MIPMAP_HINT,
l.DONT_CARE);l.lineWidth(1);l.pixelStorei(l.PACK_ALIGNMENT,4);l.pixelStorei(l.UNPACK_ALIGNMENT,4);l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,!1);l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);l.UNPACK_COLORSPACE_CONVERSION_WEBGL&&l.pixelStorei(l.UNPACK_COLORSPACE_CONVERSION_WEBGL,l.BROWSER_DEFAULT_WEBGL);l.polygonOffset(0,0);l.sampleCoverage(1,!1);l.scissor(0,0,l.canvas.width,l.canvas.height);l.stencilFunc(l.ALWAYS,0,4294967295);l.stencilMask(4294967295);l.stencilOp(l.KEEP,l.KEEP,l.KEEP);l.viewport(0,
0,l.canvas.width,l.canvas.height);for(l.clear(l.COLOR_BUFFER_BIT|l.DEPTH_BUFFER_BIT|l.STENCIL_BUFFER_BIT);l.getError(););}var e={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},
texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},
bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},
blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},g=null,h=null;return{init:b,mightBeEnum:function(l){t();return void 0!==g[l]},glEnumToString:n,glFunctionArgToString:r,glFunctionArgsToString:function(l,
v){for(var q="",k=v.length,p=0;p<k;++p)q+=(0==p?"":", ")+r(l,k,p,v[p]);return q},makeDebugContext:d,makeLostContextSimulatingCanvas:function(l){function v(N){return"function"==typeof N?N:function(P){N.handleEvent(P)}}function q(){for(var N=Object.keys(M),P=0;P<N.length;++P)delete M[N]}function k(){++E;w||F==E&&l.loseContext()}function p(N,P){var I=N[P];return function(){k();if(!w)return I.apply(N,arguments)}}function z(N){return{statusMessage:N,preventDefault:function(){K=!0}}}function C(N){for(var P in N)"function"==
typeof N[P]?u[P]=p(N,P):m(u,N,P);u.getError=function(){k();if(!w)for(var H;H=B.getError();)M[H]=!0;for(H in M)if(M[H])return delete M[H],H;return u.NO_ERROR};var I="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(P=0;P<I.length;++P){var G=I[P];u[G]=function(H){return function(){k();if(w)return null;var L=H.apply(N,arguments);L.__webglDebugContextLostId__=y;D.push(L);return L}}(N[G])}I="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(P=0;P<I.length;++P)G=I[P],u[G]=function(H){return function(){k();return w?null:H.apply(N,arguments)}}(u[G]);I="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(P=0;P<I.length;++P)G=I[P],u[G]=function(H){return function(){k();return w?!1:H.apply(N,arguments)}}(u[G]);u.checkFramebufferStatus=function(H){return function(){k();return w?u.FRAMEBUFFER_UNSUPPORTED:H.apply(N,arguments)}}(u.checkFramebufferStatus);u.getAttribLocation=function(H){return function(){k();
return w?-1:H.apply(N,arguments)}}(u.getAttribLocation);u.getVertexAttribOffset=function(H){return function(){k();return w?0:H.apply(N,arguments)}}(u.getVertexAttribOffset);u.isContextLost=function(){return w};return u}var B,A=[],x=[];var u={};var y=1,w=!1,D=[],F=0,E=0,K=!1,J=0,M={};l.getContext=function(N){return function(){var P=N.apply(l,arguments);if(P instanceof WebGLRenderingContext){if(P!=B){if(B)throw"got different context";B=P;u=C(B)}return u}return P}}(l.getContext);(function(N){var P=N.addEventListener;
N.addEventListener=function(I,G,H){switch(I){case "webglcontextlost":A.push(v(G));break;case "webglcontextrestored":x.push(v(G));break;default:P.apply(N,arguments)}}})(l);l.loseContext=function(){if(!w){w=!0;F=0;for(++y;B.getError(););q();M[B.CONTEXT_LOST_WEBGL]=!0;var N=z("context lost"),P=A.slice();setTimeout(function(){for(var I=0;I<P.length;++I)P[I](N);0<=J&&setTimeout(function(){l.restoreContext()},J)},0)}};l.restoreContext=function(){w&&x.length&&setTimeout(function(){if(!K)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var N=0;N<D.length;++N){var P=D[N];P instanceof WebGLBuffer?B.deleteBuffer(P):P instanceof WebGLFramebuffer?B.deleteFramebuffer(P):P instanceof WebGLProgram?B.deleteProgram(P):P instanceof WebGLRenderbuffer?B.deleteRenderbuffer(P):P instanceof WebGLShader?B.deleteShader(P):P instanceof WebGLTexture&&B.deleteTexture(P)}f(B);w=!1;E=0;K=!1;N=x.slice();P=z("context restored");for(var I=0;I<N.length;++I)N[I](P)},0)};l.loseContextInNCalls=function(N){if(w)throw"You can not ask a lost contet to be lost";
F=E+N};l.getNumCalls=function(){return E};l.setRestoreTimeout=function(N){J=N};return l},resetToInitialState:f}})})({get exports(){return a.webglDebugExports},set exports(c){a.webglDebugExports=c}})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject ./VertexElementDescriptor ./WebGLDriverTestModule".split(" "),function(a,c,b,t,n,r,m,d,f,e){e=function(g){function h(l){var v=
g.call(this)||this;v._rctx=l;v._program=l.programCache.acquire("\n      precision highp float;\n      attribute vec2 a_pos;\n      uniform highp sampler2D u_texture;\n      varying vec4 v_color;\n\n      float getBit(in float bitset, in int bitIndex) {\n        float offset \x3d pow(2.0, float(bitIndex));\n        return mod(floor(bitset / offset), 2.0);\n      }\n\n      void main() {\n        vec4 value \x3d texture2D(u_texture, vec2(0.0));\n        float bit \x3d getBit(value.x * 255.0, 1);\n\n        v_color \x3d bit * vec4(1.0);\n        gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n      }\n      ",
"\n      precision highp float;\n      varying vec4 v_color;\n\n      void main() {\n        gl_FragColor \x3d v_color;\n      }\n      ",new Map([["a_pos",0]]));return v}c._inheritsLoose(h,g);h.prototype._test=function(l){const v=this._rctx,q=new r.FramebufferObject(v,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.NONE},{target:n.TextureType.TEXTURE_2D,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,
width:1,height:1}),k=new Uint8Array(4),p=t.BufferObject.createVertex(v,n.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),z=new d.VertexArrayObject(v,new Map([["a_position",0]]),{geometry:[new f.VertexElementDescriptor("a_position",2,n.DataType.SHORT,0,4)]},{geometry:p});v.useProgram(l);var C=new m.Texture(v,{target:n.TextureType.TEXTURE_2D,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,width:1,
height:1},new Uint8Array([2,255,0,0]));l.setUniform1i("u_texture",0);v.bindTexture(C,0);C=v.getBoundFramebufferObject();v.bindFramebuffer(q);v.useProgram(l);const {x:B,y:A,width:x,height:u}=v.getViewport();v.setViewport(0,0,1,1);v.bindVAO(z);v.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);v.setViewport(B,A,x,u);q.readPixels(0,0,1,1,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,k);z.dispose(!1);p.dispose();q.dispose();(l=255!==k[0]||255!==k[1]||255!==k[2]||255!==k[3])&&b.getLogger("esri.views.webgl.testSamplerPrecision").warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${k[0]}.${k[1]}.${k[2]}.${k[3]}]`);
v.bindFramebuffer(C);return l};return h}(e.WebGLDriverTestModule);a.IgnoresSamplerPrecision=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject ./WebGLDriverTestModule".split(" "),function(a,c,b,t,n,r,m,d,f){f=function(e){function g(l){var v=e.call(this)||
this;v._rctx=l;v._image=new Image;v._image.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";v._image.width=5;v._image.height=5;v._image.decode();v._program=l.programCache.acquire("\n    precision highp float;\n\n    attribute vec2 a_pos;\n    varying vec2 v_uv;\n\n    void main() {\n      v_uv \x3d a_pos;\n      gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n    }\n    ",
"\n    precision highp float;\n\n    varying vec2 v_uv;\n    uniform sampler2D u_texture;\n\n    void main() {\n      gl_FragColor \x3d texture2D(u_texture, v_uv);\n    }\n    ",new Map([["a_pos",0]]));return v}c._inheritsLoose(g,e);var h=g.prototype;h.dispose=function(){e.prototype.dispose.call(this);this._image.src=""};h._test=function(l){const v=this._rctx;if(!v.gl)return l.dispose(),!0;const q=new r.FramebufferObject(v,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.NONE},
{target:n.TextureType.TEXTURE_2D,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,width:1,height:1}),k=t.BufferObject.createVertex(v,n.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),p=new d.VertexArrayObject(v,new Map([["a_pos",0]]),b.Pos2us,{geometry:k}),z=new m.Texture(v,{dataType:n.PixelType.UNSIGNED_BYTE,pixelFormat:n.PixelFormat.RGBA,preMultiplyAlpha:!1,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,
samplingMode:n.TextureSamplingMode.LINEAR},this._image);v.useProgram(l);v.bindTexture(z,0);l.setUniform1i("u_texture",0);l=v.getBoundFramebufferObject();const {x:C,y:B,width:A,height:x}=v.getViewport();v.bindFramebuffer(q);v.setViewport(0,0,1,1);v.setClearColor(0,0,0,0);v.setBlendingEnabled(!1);v.clearSafe(n.ClearBufferBit.COLOR_BUFFER_BIT);v.bindVAO(p);v.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);const u=new Uint8Array(4);q.readPixels(0,0,1,1,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,u);p.dispose(!1);
k.dispose();q.dispose();z.dispose();v.setViewport(C,B,A,x);v.bindFramebuffer(l);return 255!==u[0]};return g}(f.WebGLDriverTestModule);a.SVGPremultipliedAlpha=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,c,b){const t={geometry:[new b.VertexElementDescriptor("a_pos",2,c.DataType.BYTE,0,2)]},n={geometry:[new b.VertexElementDescriptor("a_pos",
2,c.DataType.BYTE,0,4),new b.VertexElementDescriptor("a_tex",2,c.DataType.BYTE,2,4)]};c={geometry:[new b.VertexElementDescriptor("a_pos",2,c.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=t;a.Pos2us=c;a.PosTex2b=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./DisjointTimerQuery ./DrawBuffers ./Instancing ./load ./LoseContext ./VertexArrayObjects".split(" "),function(a,c,b,
t,n,r,m,d){let f=function(){function e(g,h){this._gl=g;this._textureFloatLinear=this._fragDepth=this._shaderTextureLOD=this._standardDerivatives=this._depthTexture=this._textureNorm16=this._drawBuffers=this._loseContext=this._minMaxBlending=this._colorBufferFloat=this._textureFloat=this._textureFilterAnisotropic=this._compressedTextureS3TC=this._compressedTextureETC=this._vertexArrayObject=this._instancing=null;this._disabledExtensions=h.disabledExtensions||{};this._debugWebGLExtensions=h.debugWebGLExtensions||
{}}e.prototype.enable=function(g){return this[g]};c._createClass(e,[{key:"drawBuffers",get:function(){this._drawBuffers||(this._drawBuffers=t.load(this._gl,this._disabledExtensions));return this._drawBuffers}},{key:"instancing",get:function(){this._instancing||(this._instancing=n.load(this._gl));return this._instancing}},{key:"vao",get:function(){this._vertexArrayObject||(this._vertexArrayObject=d.load(this._gl,this._disabledExtensions));return this._vertexArrayObject}},{key:"compressedTextureETC",
get:function(){this._compressedTextureETC||(this._compressedTextureETC=r.loadCompressedTextureETC(this._gl,this._disabledExtensions));return this._compressedTextureETC}},{key:"compressedTextureS3TC",get:function(){this._compressedTextureS3TC||(this._compressedTextureS3TC=r.loadCompressedTextureS3TC(this._gl,this._disabledExtensions));return this._compressedTextureS3TC}},{key:"textureFilterAnisotropic",get:function(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=r.loadTextureFilterAnisotropicCapability(this._gl,
this._disabledExtensions));return this._textureFilterAnisotropic}},{key:"disjointTimerQuery",get:function(){this._disjointTimerQuery||(this._disjointTimerQuery=b.createDisjointTimerQuery(this._gl,this._disabledExtensions));return this._disjointTimerQuery}},{key:"textureFloat",get:function(){this._textureFloat||(this._textureFloat=r.loadTextureFloat(this._gl,this._disabledExtensions));return this._textureFloat}},{key:"colorBufferFloat",get:function(){this._colorBufferFloat||(this._colorBufferFloat=
r.loadColorBufferFloat(this._gl,this._disabledExtensions));return this._colorBufferFloat}},{key:"blendMinMax",get:function(){this._minMaxBlending||(this._minMaxBlending=r.loadMinMaxBlending(this._gl,this._disabledExtensions));return this._minMaxBlending}},{key:"depthTexture",get:function(){null===this._depthTexture&&(this._depthTexture=r.loadBooleanExtension(this._gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}},
{key:"standardDerivatives",get:function(){null===this._standardDerivatives&&(this._standardDerivatives=r.loadBooleanExtension(this._gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"]));return this._standardDerivatives}},{key:"shaderTextureLOD",get:function(){null===this._shaderTextureLOD&&(this._shaderTextureLOD=r.loadBooleanExtension(this._gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return this._shaderTextureLOD}},{key:"fragDepth",
get:function(){null===this._fragDepth&&(this._fragDepth=r.loadBooleanExtension(this._gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"]));return this._fragDepth}},{key:"loseContext",get:function(){this._loseContext||(this._loseContext=m.load(this._gl,this._debugWebGLExtensions));return this._loseContext}},{key:"textureNorm16",get:function(){this._textureNorm16||(this._textureNorm16=r.loadTextureNorm16(this._gl,this._disabledExtensions));return this._textureNorm16}},{key:"textureFloatLinear",
get:function(){null===this._textureFloatLinear&&(this._textureFloatLinear=r.loadBooleanExtension(this._gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}}]);return e}();a.Capabilities=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,c){a.load=function(b,t){return t.disjointTimerQuery?null:c(b)?{drawBuffers:b.drawBuffers.bind(b),
MAX_DRAW_BUFFERS:b.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:b.MAX_COLOR_ATTACHMENTS}:t.drawBuffers?null:(b=b.getExtension("WEBGL_draw_buffers"))?{drawBuffers:b.drawBuffersWEBGL.bind(b),MAX_DRAW_BUFFERS:b.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:b.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports","./isWebGL2Context"],function(a,c){a.load=function(b){return c(b)?b:(b=b.getExtension("ANGLE_instanced_arrays"))?
{drawArraysInstanced:b.drawArraysInstancedANGLE.bind(b),drawElementsInstanced:b.drawElementsInstancedANGLE.bind(b),vertexAttribDivisor:b.vertexAttribDivisorANGLE.bind(b)}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/load":function(){define(["exports","./isWebGL2Context"],function(a,c){a.loadBooleanExtension=function(b,t,n,r,m){if(r&&c(b))return!0;if(t[n])return!1;for(const d of m)if(b.getExtension(d))return!0;return!1};a.loadColorBufferFloat=
function(b,t){if(c(b)){var n=!t.colorBufferHalfFloat&&b.getExtension("EXT_color_buffer_half_float")||!t.colorBufferFloat&&b.getExtension("EXT_color_buffer_float"),r=!t.colorBufferFloat&&b.getExtension("EXT_color_buffer_float");t=!t.floatBlend&&!t.colorBufferFloat&&b.getExtension("EXT_float_blend");return n||r||t?{textureFloat:!!r,textureHalfFloat:!!n,floatBlend:!!t,R16F:b.R16F,RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,RG32F:b.RG32F,RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,RGB16F:b.RGB16F}:
null}return b instanceof WebGLRenderingContext?(n=!t.colorBufferHalfFloat&&b.getExtension("EXT_color_buffer_half_float"),r=!t.colorBufferFloat&&b.getExtension("WEBGL_color_buffer_float"),b=!t.floatBlend&&!t.colorBufferFloat&&b.getExtension("EXT_float_blend"),n||r||b?{textureFloat:!!r,textureHalfFloat:!!n,floatBlend:!!b,RGBA16F:n?n.RGBA16F_EXT:void 0,RGB16F:n?n.RGB16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null):null};a.loadCompressedTextureETC=function(b,t){return t.compressedTextureETC?null:
(b=b.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:b.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:b.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:b.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:b.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:b.COMPRESSED_RGB8_ETC2,COMPRESSED_SRGB8_ETC2:b.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,
COMPRESSED_RGBA8_ETC2_EAC:b.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(b,t){return t.compressedTextureS3TC?null:(b=b.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:b.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:b.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:b.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:b.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadMinMaxBlending=
function(b,t){return c(b)?{MIN:b.MIN,MAX:b.MAX}:t.blendMinMax?null:(b=b.getExtension("EXT_blend_minmax"))?{MIN:b.MIN_EXT,MAX:b.MAX_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(b,t){return t.textureFilterAnisotropic?null:(b=b.getExtension("EXT_texture_filter_anisotropic")||b.getExtension("MOZ_EXT_texture_filter_anisotropic")||b.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:b.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:b.TEXTURE_MAX_ANISOTROPY_EXT}:
null};a.loadTextureFloat=function(b,t){if(c(b))return{textureFloat:!0,textureFloatLinear:!t.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:b.HALF_FLOAT,R16F:b.R16F,RG16F:b.RG16F,RGBA16F:b.RGBA16F,R32F:b.R32F,RG32F:b.RG32F,RGBA32F:b.RGBA32F,R11F_G11F_B10F:b.R11F_G11F_B10F,RGB16F:b.RGB16F};if(b instanceof WebGLRenderingContext){const n=!t.textureHalfFloat&&b.getExtension("OES_texture_half_float");return{textureFloat:!t.textureFloat&&
!!b.getExtension("OES_texture_float"),textureFloatLinear:!t.textureFloatLinear&&!!b.getExtension("OES_texture_float_linear"),textureHalfFloat:!!n,textureHalfFloatLinear:!t.textureHalfFloatLinear&&!!b.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:n?n.HALF_FLOAT_OES:void 0}}return null};a.loadTextureNorm16=function(b,t){return!c(b)||t.textureNorm16?null:(b=b.getExtension("EXT_texture_norm16"))?{R16:b.R16_EXT,RG16:b.RG16_EXT,RGB16:b.RGB16_EXT,RGBA16:b.RGBA16_EXT,R16_SNORM:b.R16_SNORM_EXT,
RG16_SNORM:b.RG16_SNORM_EXT,RGB16_SNORM:b.RGB16_SNORM_EXT,RGBA16_SNORM:b.RGBA16_SNORM_EXT}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(c,b){const t=b.loseContext&&c.getExtension("WEBGL_lose_context");return t?{loseRenderingContext:()=>t.loseContext()}:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports",
"./isWebGL2Context"],function(a,c){a.load=function(b,t){return c(b)?{createVertexArray:b.createVertexArray.bind(b),deleteVertexArray:b.deleteVertexArray.bind(b),bindVertexArray:b.bindVertexArray.bind(b)}:t.vao?null:(b=b.getExtension("OES_vertex_array_object")||b.getExtension("MOZ_OES_vertex_array_object")||b.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:b.createVertexArrayOES.bind(b),deleteVertexArray:b.deleteVertexArrayOES.bind(b),bindVertexArray:b.bindVertexArrayOES.bind(b)}:
null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z){a.TextureRepository=function(B){function A(u,y,w){var D=B.call(this,{})||this;D._stage=u;D._techniqueRepository=y;D._rctx=w;D._textures=new Map;D._loadingCount=0;D._frameUpdates=new Map;D.events=new n;D._frameTask=u.view.resourceController.scheduler.registerTask(z.TaskPriority.TEXTURE_UNLOAD);return D}c._inheritsLoose(A,B);var x=A.prototype;x.normalizeCtorArgs=function(){return{}};x.destroy=function(){this._frameTask.remove();this._stage.forEachOfType(v.ContentObjectType.Texture,
u=>u.unload())};x.acquire=function(u){const y=this._textures.get(u);return y?(y.ref(),m.unwrapOr(y.loadingPromise,y)):this._createNewRef(u)};x.update=function(){let u=!1;this._frameUpdates.forEach(y=>{const w=y.texture.frameUpdate(this._rctx,this.textureTechnique,y.previousToken);0<=w&&w!==y.previousToken&&(y.previousToken=w,u=!0)});u&&this.events.emit("changed",l.RenderRequestType.BACKGROUND)};x._createNewRef=function(u){const y=this._stage.getObject(u);if(m.isNone(y))return p.assert(void 0!==y),
null;const w=y.events.on("unloaded",()=>{w.remove();this._onTextureUnloaded(u)}),D=new C(u,()=>{this._frameTask.schedule(()=>{D.isUnreferenced&&y.unload()})});this._textures.set(u,D);D.ref();if(m.isSome(y.glTexture))return this._updateGLTexture(D,y.glTexture),y.requiresFrameUpdates&&this._frameUpdates.set(u,{texture:y,previousToken:-1}),D;this._loadingCount++;D.loadingPromise=this._stage.schedule(()=>{const F=y.load(this._rctx,()=>this.textureTechnique),E=J=>{this._loadingCount--;D.loadingPromise=
null;this._updateGLTexture(D,J);y.requiresFrameUpdates&&this._frameUpdates.set(u,{texture:y,previousToken:-1});return D},K=J=>{this._loadingCount--;D.loadingPromise=null;d.isAbortError(J)||r.getLogger(this.declaredClass).error(J);return null};return d.isPromiseLike(F)?F.then(E,K):E(F)});return D.loadingPromise};x._updateGLTexture=function(u,y){u.glTexture=y;this.events.emit("changed",l.RenderRequestType.UPDATE)};x._onTextureUnloaded=function(u){this._textures.delete(u);this._frameUpdates.delete(u)};
c._createClass(A,[{key:"updating",get:function(){return 0<this._loadingCount||this._frameTask.updating}},{key:"textureTechnique",get:function(){m.isNone(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(q.TextureTechnique,new k.TextureTechniqueConfiguration));return this._textureTechnique}}]);return A}(t);b.__decorate([f.property()],a.TextureRepository.prototype,"_loadingCount",void 0);b.__decorate([f.property()],a.TextureRepository.prototype,"_frameTask",void 0);
b.__decorate([f.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=b.__decorate([h.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);let C=function(){function B(x,u){this.id=x;this._release=u;this._refCount=0}var A=B.prototype;A.ref=function(){++this._refCount};A.release=function(){--this._refCount;0<this._refCount||(0===this._refCount?this._release():(r.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository.RefCountedTextureImpl").error("Cannot dereference texture that has no references!"),
this._refCount=0))};c._createClass(B,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return B}();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/accessorSupport/decorators/property ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../core/shaderModules/interfaces ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){a.WaterTextureRepository=function(z){function C(){var A=z.apply(this,arguments)||this;A._passParameters=new p;A._loading=0;return A}c._inheritsLoose(C,z);var B=C.prototype;B.destroy=function(){this._passParameters.waveNormal=m.disposeMaybe(this._passParameters.waveNormal);this._passParameters.wavePertubation=m.disposeMaybe(this._passParameters.wavePertubation)};B.ensureResources=function(A){if(0<this._loading)return v.ResourceState.LOADING;if(m.isSome(this._passParameters.waveNormal)&&
m.isSome(this._passParameters.wavePertubation))return v.ResourceState.LOADED;const x={target:q.TextureType.TEXTURE_2D,pixelFormat:q.PixelFormat.RGBA,dataType:q.PixelType.UNSIGNED_BYTE,wrapMode:q.TextureWrapMode.REPEAT,samplingMode:q.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8};++this._loading;h.requestImage(t.getAssetUrl("esri/images/materials/water/normals.jpg")).then(u=>this._passParameters.waveNormal=new k.Texture(A,{...x,width:u.width,height:u.height},u)).catch(u=>r.getLogger(this.declaredClass).error("Failed to load water material normal texture.",
u)).finally(()=>--this._loading);++this._loading;h.requestImage(t.getAssetUrl("esri/images/materials/water/perturbation.jpg")).then(u=>this._passParameters.wavePertubation=new k.Texture(A,{...x,width:u.width,height:u.height},u)).catch(u=>r.getLogger(this.declaredClass).error("Failed to load water material pertubation texture.",u)).finally(()=>--this._loading);return v.ResourceState.LOADING};c._createClass(C,[{key:"passParameters",get:function(){return this._passParameters}},{key:"updating",get:function(){return 0<
this._loading}}]);return C}(n);b.__decorate([d.property()],a.WaterTextureRepository.prototype,"_loading",void 0);b.__decorate([d.property({type:Boolean,readOnly:!0})],a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=b.__decorate([g.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);let p=function(z){function C(){return z.apply(this,arguments)||this}c._inheritsLoose(C,z);return C}(l.NoParameters);a.WaterTexturePassParameters=
p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(a){const c=new Map;a.getContextCache=function(){return c};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../lib/basicInterfaces ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject ../../../../core/imageUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e){let g=function(){function h(v,q,k,p){this._rctx=v;this._renderFunctions=q;this._forceCameraHook=k;this._disposeOffscreenBuffers=p;this.supersample=!0;this._screenshotQueue=[]}var l=h.prototype;l.destroy=function(){this._rctx=null};l.takeScreenshot=function(){var v=c._asyncToGenerator(function*(q){yield this._renderFunctions.prepareOverlay();this._renderFunctions.requestRenderScene(r.RenderRequestType.BACKGROUND);const k=t.createResolver();this._screenshotQueue.push({settings:q,
resolver:k});return k.promise});return function(q){return v.apply(this,arguments)}}();l.update=function(v,q){for(const k of this._screenshotQueue){if(null==this._rctx){k.resolver.reject();continue}const p=this._renderScreenshot(v,{...k.settings,pixelRatio:k.settings.pixelRatio*v.viewCamera.pixelRatio},q);k.resolver(p)}this._screenshotQueue.length=0};l._renderScreenshotOverlay=function(v,q,k){v.width=q.width;v.height=q.height;const p=v.getContext("2d"),z=k.pixelRatio;p.save();p.translate(0,q.height);
p.scale(1,-1);k.region&&p.translate(-k.region.x,-k.region.y);p.scale(z,z);q=this._renderFunctions.renderOverlay(v,q);p.restore();return q};l._readbackScreenshot=function(v,q){return v.resample?this._readbackScreenshotResampled({...v,resample:v.resample},q):this._readbackScreenshotImmediate(v,q)};l._readbackScreenshotResampled=function(v,q){const {framebufferWidth:k,framebufferHeight:p,region:z,resample:C}=v,B=this._ensureScreenshotEncodeCanvas();let A=e.createEmptyImageData(k,p,B);this._rctx.gl.readPixels(0,
0,k,p,d.PixelFormat.RGBA,d.DataType.UNSIGNED_BYTE,new Uint8Array(A.data.buffer));q();A=this._renderScreenshotOverlay(B,A,{...v,region:void 0});v=e.createEmptyImageData(z.width,z.height,B);return m.resampleHermite(A,v,!0,C.region.x,p-(C.region.y+C.region.height),C.region.width,C.region.height)};l._readbackScreenshotImmediate=function(v,q){const {framebufferHeight:k,region:p}=v,z=this._ensureScreenshotEncodeCanvas(),C=e.createEmptyImageData(p.width,p.height,z);this._rctx.gl.readPixels(p.x,k-(p.y+p.height),
p.width,p.height,d.PixelFormat.RGBA,d.DataType.UNSIGNED_BYTE,new Uint8Array(C.data.buffer));q();return this._renderScreenshotOverlay(z,C,v)};l._renderScreenshot=function(v,q,k){let p=null,z=null;const C=v.viewCamera,{framebufferWidth:B,framebufferHeight:A}=q;var x=!1;v=q.disableDecorations&&v.frameHasDecorations;var u=q.ignorePadding&&C.pixelRatio!==q.pixelRatio;v=B!==C.fullWidth||A!==C.fullHeight||v||u||q.objectAndLayerIdColor;q.objectAndLayerIdColor&&(z=new f.FramebufferObject(this._rctx,{width:B,
height:A,colorTarget:d.TargetType.TEXTURE,depthStencilTarget:d.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER}));if(v){u=C.clone();if(q.ignorePadding){x=n.clone(u.padding);for(var y=0;4>y;y++)x[y]=Math.round(x[y]/u.pixelRatio*q.pixelRatio);u.padding=x}u.fullWidth=B;u.fullHeight=A;u.pixelRatio=q.pixelRatio;x=C.fovX-u.fovX;y=C.fovY-u.fovY;0>x&&x<y?u.fovX=C.fovX:0>y&&y<x&&(u.fovY=C.fovY);this._forceCameraHook(u);x=!0;p=new f.FramebufferObject(this._rctx,{width:u.fullWidth,height:u.fullHeight,colorTarget:d.TargetType.TEXTURE,
depthStencilTarget:d.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER});this._renderFunctions.renderScene(p,z,u,q.disableDecorations?r.Decorations.OFF:r.Decorations.ON,k);this._disposeOffscreenBuffers()}u=()=>{this._rctx.bindFramebuffer(null);b.disposeMaybe(p)};k=this._readbackScreenshot(q,u);u();u=null;q.objectAndLayerIdColor&&(y=()=>{this._rctx.bindFramebuffer(null);b.disposeMaybe(z)},this._rctx.bindFramebuffer(z),u=this._readbackScreenshot(q,y),this._rctx.bindFramebuffer(null),y());if(v&&!this._rctx.contextAttributes.alpha)for(q=
3;q<k.data.length;q+=4)k.data[q]=255;if(u&&!this._rctx.contextAttributes.alpha)for(q=3;q<u.data.length;q+=4)u.data[q]=255;x&&this._forceCameraHook(C);return[k,u]};l._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return h}();a.ScreenshotContext=function(h,l){this.viewCamera=h;this.frameHasDecorations=l};a.ScreenshotManager=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils","../../core/maybe","../../core/imageUtils"],function(a,c,b,t,n){function r(p,z){const {format:C,quality:B,rotation:A,disableDecorations:x}=p||{};var u=g(p,z.padding);var y=z.width-u.left-u.right;z=z.height-u.top-u.bottom;u={x:0,y:0,width:y,height:z};if(p&&p.area){null!=p.area.x&&(u.x=Math.floor(p.area.x));null!=p.area.y&&(u.y=Math.floor(p.area.y));var w=null!=p.area.width?Math.floor(p.area.width):
null,D=null!=p.area.height?Math.floor(p.area.height):null;u.width=y-u.x;u.height=z-u.y;null!=w&&null!=D?(u.width=Math.min(u.width,w),u.height=Math.min(u.height,D)):null==w&&null!=D?(w=Math.min(u.width,w),u.height*=w/u.width,u.width=w):null!=w&&null==D&&(w=Math.min(u.height,D),u.width*=w/u.height,u.height=w)}u=e(u,p);w=Math.floor(Math.max(u.x,0));D=Math.floor(Math.max(u.y,0));y={x:w,y:D,width:Math.floor(Math.min(u.width,y-w)),height:Math.floor(Math.min(u.height,z-D))};z=y.width/y.height;u=u.width/
u.height;u!==z&&(u>z?(z=Math.floor(y.width/u),y={x:y.x,y:Math.floor(y.y+(y.height-z)/2),width:y.width,height:z}):(z=Math.floor(y.height*u),y={x:Math.floor(y.x+(y.width-z)/2),y:y.y,width:z,height:y.height}));const {width:F,height:E}=f(p,y);z=h(C);u=q[z];u=b.clamp(null!=B?B:u,0,100);return{format:z,quality:u,area:y,width:F,height:E,rotation:A,disableDecorations:!!x,ignoreBackground:!(!p||!p.ignoreBackground),ignorePadding:!(!p||!p.ignorePadding)}}function m(p,z){t.isNone(l)&&(l=document.createElement("canvas"));
var C=l;if(z.premultipliedAlpha){var B=p.data;const x=B.length;for(let u=0;u<x;u+=4){var A=B[u+3];255!==A&&0<A&&(A=255/A,B[u+0]*=A,B[u+1]*=A,B[u+2]*=A)}}C.width=p.width;C.height=p.height;B=C.getContext("2d",{willReadFrequently:!0});B.putImageData(p,0,0);z.flipY&&(B.save(),B.globalCompositeOperation="copy",B.scale(1,-1),B.translate(0,-B.canvas.height),B.drawImage(B.canvas,0,0),B.restore());return{ctx:B,canvas:C}}function d(p,z){return p.toDataURL(v[z.format],z.quality/100)}function f(p,z){if(!p)return z;
const C=p.width;p=p.height;if(null!=C&&null!=p)return{width:Math.floor(C),height:Math.floor(p)};if(null==C&&null==p)return z;z=z.width/z.height;return null==p?{width:Math.floor(C),height:Math.floor(C/z)}:{width:Math.floor(p*z),height:Math.floor(p)}}function e(p,z){if(!z||null==z.width||null==z.height)return p;z=z.width/z.height;const C=p.width/p.height;if(C===z)return p;if(C<z)return z=Math.floor(p.height*z),p.x-=(z-p.width)/2,p.width=z,p;z=Math.floor(p.width/z);p.y-=(z-p.height)/2;p.height=z;return p}
function g(p,z){return!z||p&&p.ignorePadding?k:z}function h(p){switch(p){case "png":case "jpg":case "jpeg":return p;case null:case void 0:return"png";default:return"png"}}let l=null;const v={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},q={png:100,jpg:98,jpeg:98},k={top:0,right:0,bottom:0,left:0};a.createEmptyImageData=n.createEmptyImageData;a.completeUserSettings=r;a.encode=function(p,z,C){const {ctx:B,canvas:A}=m(p,C);p=B.getImageData(0,0,p.width,p.height);z=d(A,z);A.width=0;A.height=0;return{dataUrl:z,
data:p}};a.encodeData=function(p,z){const {ctx:C,canvas:B}=m(p,z);p=C.getImageData(0,0,p.width,p.height);B.width=0;B.height=0;return p};a.getFormatAndQuality=function(p,z){p=h(p);const C=q[p];z=b.clamp(null!=z?z:C,0,100);return{format:p,quality:z}};a.getMaximumResolutionScale=function(p,z){return z/Math.max(p[0],p[1])};a.resampleHermite=function(p,z,C,B=0,A=0,x=p.width-B,u=p.height-A,y=!1){const {data:w}=p,{width:D,height:F,data:E}=z;x/=D;u/=F;const K=Math.ceil(x/2),J=Math.ceil(u/2);p=p.width;for(let P=
0;P<F;P++)for(let I=0;I<D;I++){const G=4*(I+(y?F-P-1:P)*D);let H=0,L=0,O=0,S=0,R=0,Q=0;const V=(P+.5)*u;for(let aa=Math.floor(P*u);aa<(P+1)*u;aa++){var M=Math.abs(V-(aa+.5))/J;const X=(I+.5)*x;M*=M;for(let W=Math.floor(I*x);W<(I+1)*x;W++){var N=Math.abs(X-(W+.5))/K;N=Math.sqrt(M+N*N);if(1<=N)continue;N=2*N*N*N-3*N*N+1;const T=4*(B+W+(A+aa)*p);Q+=N*w[T+3];L+=N;!C&&255>w[T+3]&&(N=N*w[T+3]/255);O+=N*w[T];S+=N*w[T+1];R+=N*w[T+2];H+=N}}E[G]=O/H;E[G+1]=S/H;E[G+2]=R/H;E[G+3]=Q/L}return z};a.screenshotSuperSampleSettings=
function(p,z,C){if(!z)return p;const {framebufferWidth:B,framebufferHeight:A,pixelRatio:x,region:u}=p;z=g(p,C);C=z.left+z.right;const y=z.top+z.bottom,w=B-C,D=A-y,F=Math.min(8,Math.min((2048-C)/w,(2048-y)/D));return 1.5>F?p:{...p,framebufferWidth:Math.round(w*F)+C,framebufferHeight:Math.round(D*F)+y,pixelRatio:x*F,resample:{region:{x:Math.round((u.x-z.left)*F)+z.left,y:Math.round((u.y-z.top)*F)+z.top,width:Math.round(u.width*F),height:Math.round(u.height*F)},width:B,height:A}}};a.toDataUrl=d;a.toRenderSettings=
function(p,z){const C=r(p,z),B=C.area,A=C.width/B.width,x=g(C,z.padding),u=x.left+x.right,y=x.top+x.bottom;return{framebufferWidth:Math.floor((z.width-u)*A+u),framebufferHeight:Math.floor((z.height-y)*A+y),region:{x:Math.floor(B.x*A)+x.left,y:Math.floor(B.y*A)+x.top,width:C.width,height:C.height},format:C.format,quality:C.quality,rotation:C.rotation,pixelRatio:A,layers:p&&p.layers?p.layers:[],disableDecorations:C.disableDecorations,ignoreBackground:C.ignoreBackground,ignorePadding:C.ignorePadding,
objectAndLayerIdColor:!1}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(a,c){a.contextCache={enabled:!1,disposeContextCache:()=>{const b=c.getContextCache();b.forEach(t=>t.dispose());b.clear()}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(z,C){return c.isNone(z)?null:f.isObjectIntersectorResult(z)||f.isHudIntersectorResult(z)?h(z.target?.object.metadata,C):m.isPclIntersectorResult(z)?(z=z.target.createGraphic(),{type:"graphic",graphic:z,layer:z.layer}):m.isVoxelIntersectorResult(z)?(z=z.target.createVoxelGraphic(),{type:"graphic",graphic:z,layer:z.layer}):d.isOverlayIntersectorResult(z)||e.isLodIntersectorResult(z)?h(z.target,C):m.isI3sIntersectorResult(z)?l(z.target,C):null}function h(z,C){if(c.isNone(z)||
c.isNone(z.graphicUid))return null;const B=k(z,C);if(c.isNone(B))return null;if(B===C.graphics)return c.isNone(C.graphicsView)||"number"!==typeof z.graphicUid?null:C.graphicsView.getHit(z.graphicUid);C=C.allLayerViews.find(A=>A.layer===B);return!C||C.suspended||c.isNone(z.graphicUid)?null:"getHit"in C?C.getHit(z.graphicUid):null}function l(z,C){const B=k(z,C);return c.isNone(B)?null:(C=C.allLayerViews.find(A=>A.layer===B))&&!C.suspended&&"getGraphicFromIntersectorTarget"in C?q(C.getGraphicFromIntersectorTarget(z)):
null}function v(z,C){const B=k(z,C);return c.isNone(B)?null:(C=C.allLayerViews.find(A=>A.layer===B))&&!C.suspended&&"getAABBFromIntersectorTarget"in C?C.getAABBFromIntersectorTarget(z):null}function q(z){return c.isSome(z)?{type:"graphic",graphic:z,layer:z.layer}:null}function k(z,C){return!z||c.isNone(z.layerUid)?null:c.isSome(C.graphicsView)&&z.layerUid===C.graphicsView.processor.layer.id?C.graphics:C.map.findLayerByUid(z.layerUid)}const p=t.create();a.getIntersectedFeatureBSRadius=function(z,C){return f.isObjectIntersectorResult(z)||
f.isHudIntersectorResult(z)?r.getRadius(z.target.object.boundingVolumeWorldSpace.bounds):e.isLodIntersectorResult(z)?(b.getScaling(p,z.transformation),z.target.baseBoundingSphere.radius*Math.max(p[0],p[1],p[2])):m.isI3sIntersectorResult(z)?c.applySome(v(z.target,C),B=>.5*n.diameter(B)):null};a.hasLod=function(z){return f.isObjectIntersectorResult(z)||f.isHudIntersectorResult(z)?!1:e.isLodIntersectorResult(z)?1<z.target.numLodLevels:m.isI3sIntersectorResult(z)?!0:!1};a.toGraphic=function(z,C){z=g(z,
C);return c.isSome(z)&&"graphic"===z.type?z.graphic:null};a.toHit=g;a.toOwner=function(z,C){return f.isObjectIntersectorResult(z)||f.isHudIntersectorResult(z)?k(z.target?.object.metadata,C):d.isTerrainIntersectorResult(z)?C.map?.ground:m.isPclIntersectorResult(z)||m.isI3sIntersectorResult(z)||d.isOverlayIntersectorResult(z)||m.isVoxelIntersectorResult(z)?k(z.target,C):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/IntersectorTarget","../../webgl-engine/lib/intersectorUtils"],function(a,c,b,t,n){let r=function(d){function f(e,g,h,l){g=d.call(this,g,h)||this;g.point=e;g.createGraphic=l;return g}c._inheritsLoose(f,d);return f}(t.Graphic3DTarget),m=function(d){function f(e,g,h,l,v){var q=d.call(this,e)||this;q.layerUid=e;q.sublayerUid=g;q.nodeIndex=h;q.componentIndex=l;q.triangleNr=v;return q}c._inheritsLoose(f,
d);return f}(t.LayerTarget);t=function(d){function f(e,g,h){g=d.call(this,g,null)||this;g.point=e;g.createVoxelGraphic=h;return g}c._inheritsLoose(f,d);return f}(t.Graphic3DTarget);a.I3sTarget=m;a.PclTarget=r;a.VoxelTarget=t;a.isI3sIntersectorResult=function(d){return n.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.I3S&&!!d.target};a.isPclIntersectorResult=function(d){return n.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.PCL&&!!d.target};a.isVoxelIntersectorResult=
function(d){return n.isValidIntersectorResult(d)&&d.intersector===b.IntersectorType.VOXEL&&!!d.target};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe"],function(a,c,b){function t(){t=c._asyncToGenerator(function*(r,m){if("2d"===r.type)return r.hitTest(m);r=yield r.hitTest(m);if(0===r.results.length)return r;const d=1.05*(b.unwrap(r.results[0].distance)??
0);m=r.results.findIndex(f=>(f.distance??0)>d);-1!==m&&(r.results=r.results.slice(0,m));return r});return t.apply(this,arguments)}function n(r){return b.isSome(r)&&"graphic"===r.type}a.filterGraphicHits=function(r){return r.filter(n)};a.findFirstGraphicHit=function(r){return r.find(n)??null};a.hitTestSelectSimilarDistance=function(r,m){return t.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/WebGLRequirements":function(){define(["exports",
"../../core/Error","../webgl/capabilities","../webgl/context-util"],function(a,c,b,t){a.check=function(n){const r=b.getWebGLCapabilities(n);if(!r.available)return new c("webgl:required","WebGL is required but not supported.");if("3d"===n&&r.majorPerformanceCaveat)return new c("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!r.supportsHighPrecisionFragment)return new c("webgl:high-precision-fragment-required",
"WebGL support for high precision fragment shaders is required but not supported.");if(!r.supportsVertexShaderSamplers)return new c("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(r.type===t.ContextType.WEBGL1){if(!r.supportsElementIndexUint)return new c("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!r.supportsStandardDerivatives)return new c("webgl:standard-derivatives-required",
"WebGL support for standard derivatives is required but not supported.");if(!r.supportsInstancedArrays)return new c("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/capabilities":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./context-util"],function(a,c,b,t){function n(v){switch(v){case t.ContextType.WEBGL1:return r();
case t.ContextType.WEBGL2:return m()}}function r(){if(!f){{const v=new h,q=d(t.ContextType.WEBGL1,v);b.isNone(q)||(v.supportsElementIndexUint=null!==q.getExtension("OES_element_index_uint"),v.supportsStandardDerivatives=null!==q.getExtension("OES_standard_derivatives"),v.supportsInstancedArrays=null!==q.getExtension("ANGLE_instanced_arrays"),v.supportsTextureFloat=null!==q.getExtension("OES_texture_float"),v.supportsTextureHalfFloat=null!==q.getExtension("OES_texture_half_float"),v.supportsColorBufferFloat=
null!==q.getExtension("WEBGL_color_buffer_float"),v.supportsColorBufferFloatBlend=null!==q.getExtension("EXT_float_blend"),v.supportsColorBufferHalfFloat=null!==q.getExtension("EXT_color_buffer_half_float"));f=v}}return f}function m(){if(!e){{const v=new l,q=d(t.ContextType.WEBGL2,v);b.isNone(q)||(v.supportsColorBufferFloat=null!==q.getExtension("EXT_color_buffer_float"),v.supportsColorBufferFloatBlend=null!==q.getExtension("EXT_float_blend"),v.supportsColorBufferHalfFloat=v.supportsColorBufferFloat||
null!==q.getExtension("EXT_color_buffer_half_float"));e=v}}return e}function d(v,q){if(v===t.ContextType.WEBGL1&&"undefined"===typeof WebGLRenderingContext||v===t.ContextType.WEBGL2&&"undefined"===typeof WebGL2RenderingContext)return null;const k=document.createElement("canvas");if(!k)return null;let p=t.createContext(k,v,{failIfMajorPerformanceCaveat:!0});b.isNone(p)&&(p=t.createContext(k,v),b.isSome(p)&&(q.majorPerformanceCaveat=!0));if(b.isNone(p))return p;if(v===t.ContextType.WEBGL1){if(v=p.getParameter(p.VERSION)?.match(/^WebGL\s+([\d.]*)/))v=
parseFloat(v[1]),q.available=.94<=v}else q.available=!0;q.maxTextureSize=p.getParameter(p.MAX_TEXTURE_SIZE);q.supportsVertexShaderSamplers=0<p.getParameter(p.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(v=p.getShaderPrecisionFormat(p.FRAGMENT_SHADER,p.HIGH_FLOAT))q.supportsHighPrecisionFragment=0<v.precision;return p}let f,e,g=function(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=0;this.supportsColorBufferHalfFloat=this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsTextureHalfFloat=
this.supportsTextureFloat=this.supportsInstancedArrays=this.supportsStandardDerivatives=this.supportsElementIndexUint=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1},h=function(v){function q(){var k=v.apply(this,arguments)||this;k.type=t.ContextType.WEBGL1;return k}c._inheritsLoose(q,v);return q}(g),l=function(v){function q(){var k=v.apply(this,arguments)||this;k.type=t.ContextType.WEBGL2;k.supportsElementIndexUint=!0;k.supportsStandardDerivatives=!0;k.supportsInstancedArrays=
!0;k.supportsTextureFloat=!0;k.supportsTextureHalfFloat=!0;return k}c._inheritsLoose(q,v);return q}(g);a.getWebGL1Capabilities=r;a.getWebGL2Capabilities=m;a.getWebGLCapabilities=function(v){for(v=t.getContextTypes(v);1<v.length;){const q=n(v.shift());if(q.available)return q}return n(v.shift())};a.getWebGLVersionCapabilities=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),
function(a,c,b,t,n,r,m){t=function(d){function f(e){e=d.call(this,e)||this;e.components=["attribution","zoom","navigation-toggle","compass"];return e}a._inheritsLoose(f,d);return f}(m);c.__decorate([b.property()],t.prototype,"components",void 0);return t=c.__decorate([r.subclass("esri.views.ui.3d.DefaultUI3D")],t)})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){b=function(k){function p(C){C=k.call(this,C)||this;C._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};C.components=[];return C}a._inheritsLoose(p,k);var z=p.prototype;z.initialize=function(){this.addHandles([n.watch(()=>this.components,this._componentsWatcher.bind(this),n.initial),n.watch(()=>this.view,this._updateViewAwareWidgets.bind(this),n.initial)])};z._add=function(C,B,A,x){let u=C;if("string"===
typeof C&&this._defaultPositionLookup[C]){if(this._find(C))return;u=this._createComponent(C)}k.prototype._add.call(this,u,B,A,x)};z._removeComponents=function(C){C.forEach(B=>{if(B=this._find(B))this.remove(B),B.destroy()})};z._updateViewAwareWidgets=function(C){this.components.forEach(B=>{(B=(B=this._find(B))&&B.widget)&&void 0!==B.view&&(B.view=C)})};z._componentsWatcher=function(C,B){this._removeComponents(B);this._addComponents(C);this._adjustPadding(C)};z._adjustPadding=function(C){C.includes("attribution")||
this._isOverridden("padding")||({top:C}=this.padding,this.padding=C)};z._addComponents=function(C){this.constructed&&C.forEach(B=>this.add(this._createComponent(B),this._defaultPositionLookup[B]))};z._createComponent=function(C){const B=this._createWidget(C);if(B)return new e({id:C,node:B})};z._createWidget=function(C){if("attribution"===C)return this._createAttribution();if("compass"===C)return this._createCompass();if("navigation-toggle"===C)return this._createNavigationToggle();if("zoom"===C)return this._createZoom()};
z._createAttribution=function(){return new h({view:this.view})};z._createCompass=function(){return new l({view:this.view})};z._createNavigationToggle=function(){return new v({view:this.view})};z._createZoom=function(){return new q({view:this.view})};return p}(g);c.__decorate([r.property()],b.prototype,"components",void 0);return b=c.__decorate([f.subclass("esri.views.ui.DefaultUI")],b)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d){b=function(f){function e(){var h=f.apply(this,arguments)||this;h.widget=null;return h}a._inheritsLoose(e,f);var g=e.prototype;g.destroy=function(){this.widget&&this.widget.destroy();this.node=null};g.castNode=function(h){if(!h)return this._set("widget",null),null;if("string"===typeof h||h&&"nodeType"in h)return this._set("widget",null),t.byId(h);h&&"function"===typeof h.render&&!h.domNode&&(h.domNode=document.createElement("div"));this._set("widget",h);return h.domNode};
a._createClass(e,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(h){const l=this._get("node");h!==l&&(h&&h.classList.add("esri-component"),l&&l.classList.remove("esri-component"),this._set("node",h))}}]);return e}(b);c.__decorate([n.property({dependsOn:[]})],b.prototype,"id",null);c.__decorate([n.property()],b.prototype,"node",null);c.__decorate([r.cast("node")],b.prototype,"castNode",null);c.__decorate([n.property({readOnly:!0})],b.prototype,
"widget",void 0);return b=c.__decorate([d.subclass("esri.views.ui.Component")],b)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../intl ../../core/domUtils ../../core/Evented ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils ../../intl/locale".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(C){const B="object"===typeof C&&null!==C&&Object.getPrototypeOf(C);return null!==B&&B!==Object.prototype||!("component"in C||"index"in C||"position"in C)?null:C}function k(C,{top:B,bottom:A,left:x,right:u}){C.style.top=B;C.style.bottom=A;C.style.left=x;C.style.right=u}const p={left:0,top:0,bottom:0,right:0},z={bottom:30,top:15,right:15,left:15};b=function(C){function B(x){var u=C.call(this,x)||this;u._cornerNameToContainerLookup={};u._positionNameToContainerLookup=
{};u._components=[];u._componentToKey=new Map;u._locale=v.getLocale();u.view=null;u._applyViewPadding=()=>{const y=u.container;y&&k(y,u._toPxPosition(u._getViewPadding()))};u._applyUIPadding=()=>{const y=u._innerContainer;y&&k(y,u._toPxPosition(u.padding))};u._initContainers();return u}a._inheritsLoose(B,C);var A=B.prototype;A.initialize=function(){this.addHandles([r.watch(()=>[this.view?.padding,this.container],this._applyViewPadding,r.initial),r.watch(()=>this.padding,this._applyUIPadding,r.initial),
r.watch(()=>[this.container,this._locale],([x,u])=>{x&&x.setAttribute("lang",u)},r.initial),v.onLocaleChange(x=>{this._locale=x})])};A.destroy=function(){this.container=null;for(const x of this._components)x.destroy();this._components.length=0;this._componentToKey.clear()};A.castPadding=function(x){return"number"===typeof x?{bottom:x,top:x,right:x,left:x}:{...z,...x}};A.add=function(x,u){let y,w;if(Array.isArray(x))x.forEach(F=>this.add(F,u));else{var D=q(x);D&&({index:y,position:u,component:x,key:w}=
D);u&&"object"===typeof u&&({index:y,key:w,position:u}=u);!x||u&&!this._isValidPosition(u)||this._add(x,u,y,w)}};A.remove=function(x,u){if(x){if(Array.isArray(x))return x.map(D=>this.remove(D,u));var y=this._find(x);if(y){var w=this._componentToKey;if(!w.has(x)||w.get(x)===u)return w=this._components.indexOf(y),y.node.parentNode&&y.node.parentNode.removeChild(y.node),this._componentToKey.delete(x),this._components.splice(w,1)[0]}}};A.empty=function(x){if(Array.isArray(x))return x.map(u=>this.empty(u)).reduce((u,
y)=>u.concat(y));x=x||"manual";return"manual"===x?Array.prototype.slice.call(this._manualContainer.children).filter(u=>!u.classList.contains("esri-ui-corner")).map(u=>this.remove(u)):this._isValidPosition(x)?Array.prototype.slice.call(this._cornerNameToContainerLookup[x].children).map(this.remove,this):null};A.move=function(x,u){Array.isArray(x)&&x.forEach(D=>this.move(D,u));if(x){var y=q(x)||q(u);if(y){var w=y.index;u=y.position;x=y.component||x}(!u||this._isValidPosition(u))&&(x=this.remove(x))&&
this.add(x,{position:u,index:w})}};A.find=function(x){return x?(x=this._findById(x))&&(x.widget||x.node):null};A.getPosition=function(x){for(const u in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[u].contains(x))return u;return null};A._add=function(x,u,y,w){x instanceof h||(x=new h({node:x}));this._place({component:x,position:u,index:y});this._components.push(x);w&&this._componentToKey.set(x,w)};A._find=function(x){return x?x instanceof h?this._findByComponent(x):"string"===
typeof x?this._findById(x):this._findByNode(x.domNode||x):null};A._getViewPadding=function(){return this.get("view.padding")||p};A._attachContainers=function(x){x.appendChild(this._innerContainer);x.appendChild(this._manualContainer)};A._initContainers=function(){var x=document.createElement("div");x.classList.add("esri-ui-inner-container");x.classList.add("esri-ui-corner-container");const u=document.createElement("div");u.classList.add("esri-ui-inner-container");u.classList.add("esri-ui-manual-container");
const y=document.createElement("div");y.classList.add("esri-ui-top-left");y.classList.add("esri-ui-corner");x.appendChild(y);const w=document.createElement("div");w.classList.add("esri-ui-top-right");w.classList.add("esri-ui-corner");x.appendChild(w);const D=document.createElement("div");D.classList.add("esri-ui-bottom-left");D.classList.add("esri-ui-corner");x.appendChild(D);const F=document.createElement("div");F.classList.add("esri-ui-bottom-right");F.classList.add("esri-ui-corner");x.appendChild(F);
this._innerContainer=x;this._manualContainer=u;x=l.isRTL();this._cornerNameToContainerLookup={"top-left":y,"top-right":w,"bottom-left":D,"bottom-right":F,"top-leading":x?w:y,"top-trailing":x?y:w,"bottom-leading":x?F:D,"bottom-trailing":x?D:F};this._positionNameToContainerLookup={manual:u,...this._cornerNameToContainerLookup}};A._isValidPosition=function(x){return!!this._positionNameToContainerLookup[x]};A._place=function(x){const u=x.component,y=x.index;x=this._positionNameToContainerLookup[x.position||
"manual"];var w=null!=y&&-1<y,D=u.widget;D&&!D._started&&"function"===typeof D.postMixInProperties&&"function"===typeof D.buildRendering&&"function"===typeof D.postCreate&&"function"===typeof D.startup&&u.widget.startup();w?(w=Array.prototype.slice.call(x.children),0===y?x.firstChild?t.insertBefore(u.node,x.firstChild):x.appendChild(u.node):y>=w.length?x.appendChild(u.node):t.insertBefore(u.node,w[y])):x.appendChild(u.node)};A._toPxPosition=function(x){return{top:this._toPxUnit(x.top),left:this._toPxUnit(x.left),
right:this._toPxUnit(x.right),bottom:this._toPxUnit(x.bottom)}};A._toPxUnit=function(x){return 0===x?"0":x+"px"};A._findByComponent=function(x){let u=null,y;this._components.some(w=>{(y=w===x)&&(u=w);return y});return u};A._findById=function(x){let u=null,y;this._components.some(w=>{(y=w.id===x)&&(u=w);return y});return u};A._findByNode=function(x){let u=null,y;this._components.some(w=>{(y=w.node===x)&&(u=w);return y});return u};a._createClass(B,[{key:"container",set:function(x){const u=this._get("container");
x!==u&&(x&&(x.classList.add("esri-ui"),g.setCalciteThemeClass(x),this._attachContainers(x)),u&&(u.classList.remove("esri-ui"),k(u,{top:"",bottom:"",left:"",right:""}),t.empty(u)),this._set("container",x))}},{key:"height",get:function(){const x=this.get("view.height")||0;if(0===x)return x;const u=this._getViewPadding();return Math.max(x-(u.top+u.bottom),0)}},{key:"padding",get:function(){return this._get("padding")},set:function(x){this._overrideIfSome("padding",x)}},{key:"width",get:function(){const x=
this.get("view.width")||0;if(0===x)return x;const u=this._getViewPadding();return Math.max(x-(u.left+u.right),0)}}]);return B}(n.EventedAccessor);c.__decorate([m.property()],b.prototype,"_locale",void 0);c.__decorate([m.property()],b.prototype,"container",null);c.__decorate([m.property()],b.prototype,"height",null);c.__decorate([m.property({value:z})],b.prototype,"padding",null);c.__decorate([d.cast("padding")],b.prototype,"castPadding",null);c.__decorate([m.property()],b.prototype,"view",void 0);
c.__decorate([m.property()],b.prototype,"width",null);return b=c.__decorate([e.subclass("esri.views.ui.UI")],b)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){n=function(v){function q(p,z){var C=v.call(this,p,z)||this;C._isOpen=!1;C._attributionTextOverflowed=!1;C._prevSourceNodeHeight=0;C._resizeObserver=new ResizeObserver(B=>B.forEach(({target:A})=>C._checkSourceTextOverflow(A)));C.iconClass="esri-icon-description";C.itemDelimiter=" | ";C.messages=null;C.viewModel=new f;return C}a._inheritsLoose(q,v);var k=q.prototype;k.initialize=function(){this.addHandles(b.on(()=>this.viewModel?.items,"change",()=>this.scheduleRender()))};
k.destroy=function(){this._resizeObserver?.disconnect()};k.render=function(){return h.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};k.renderPoweredBy=function(){return h.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",h.tsx("a",{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",
rel:"noreferrer"},"Esri"))};k.renderSourcesNode=function(){const p=this._isOpen,z=this._isInteractive,C=z?"0":"",{attributionText:B}=this;return h.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:p,["esri-interactive"]:z}),innerHTML:B,tabindex:C})};k._afterSourcesNodeCreate=function(p){this._prevSourceNodeHeight=p.clientWidth;this._resizeObserver.observe(p)};k._checkSourceTextOverflow=function(p){let z=
!1;const {clientHeight:C,clientWidth:B,scrollWidth:A}=p;p=A>B;const x=this._attributionTextOverflowed!==p;this._attributionTextOverflowed=p;x&&(z=!0);this._isOpen&&(p=C<this._prevSourceNodeHeight,this._prevSourceNodeHeight=C,p&&(this._isOpen=!1,z=!0));z&&this.scheduleRender()};k._toggleState=function(){this._isInteractive&&(this._isOpen=!this._isOpen)};a._createClass(q,[{key:"_isInteractive",get:function(){return this._isOpen||this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((p,
z)=>{p.includes(z.text)||p.push(z.text);return p},[]).join(this.itemDelimiter)}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(p){this._overrideIfSome("label",p)}},{key:"view",get:function(){return this.viewModel.view},set:function(p){this.viewModel.view=p}}]);return q}(d);c.__decorate([t.property()],n.prototype,"_isOpen",void 0);c.__decorate([t.property()],n.prototype,"_isInteractive",null);c.__decorate([t.property()],n.prototype,"_attributionTextOverflowed",void 0);
c.__decorate([t.property()],n.prototype,"_prevSourceNodeHeight",void 0);c.__decorate([t.property({readOnly:!0,dependsOn:["viewModel.items.length","itemDelimiter"]})],n.prototype,"attributionText",null);c.__decorate([t.property()],n.prototype,"iconClass",void 0);c.__decorate([t.property()],n.prototype,"itemDelimiter",void 0);c.__decorate([t.property()],n.prototype,"label",null);c.__decorate([t.property(),g.messageBundle("esri/widgets/Attribution/t9n/Attribution")],n.prototype,"messages",void 0);c.__decorate([t.property()],
n.prototype,"view",null);c.__decorate([t.property({type:f})],n.prototype,"viewModel",void 0);c.__decorate([e.accessibleHandler()],n.prototype,"_toggleState",null);return n=c.__decorate([m.subclass("esri.widgets.Attribution")],n)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/SpatialReference".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(C,B){return C&&"copyright"in C&&(!B||"function"===typeof C.originOf&&"user"===C.originOf("copyright"))}function k(C,B){return C.length!==B.length||C.some((A,x)=>A.text!==B[x].text)}function p(C,B,A){A&&B&&(C.find(x=>x.layerView===B&&x.text===A)||C.push({text:A,layerView:B}))}const z=[];b=function(C){function B(x){var u=C.call(this,x)||this;u._clear=()=>{u._fetchedAttributionData.clear();u._pendingAttributions.clear();u.handles.remove("suspension");
u.notifyChange("state")};u._pendingAttributions=new Set;u._fetchedAttributionData=new Map;u.items=new n;u.view=null;u._allLayerViewsChange=y=>{u.handles.remove("suspension");const w=u.get("view.allLayerViews");w&&u.handles.add(w.map(D=>m.watch(()=>[D.suspended,D.layer?.attributionVisible],()=>u._updateAttributionItems())),"suspension");y&&y.removed&&y.removed.forEach(D=>{u._pendingAttributions.delete(D);u._fetchedAttributionData.delete(D)});u._updateAttributionItems()};u.handles.add([m.on(()=>u.view?.allLayerViews,
"change",y=>u._allLayerViewsChange(y),{onListenerAdd:()=>u._allLayerViewsChange(),onListenerRemove:u._clear}),m.when(()=>!0===u.view?.stationary,()=>u._updateAttributionItems())]);return u}a._inheritsLoose(B,C);var A=B.prototype;A.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};A._updateAttributionItems=function(){const x=this.view,u=x?.allLayerViews;z.length=0;x&&u?(u.forEach(y=>{if(!y.suspended&&y.layer?.attributionVisible){var w=
y.layer;if(q(w,"user"))p(z,y,w.copyright);else if(w.hasAttributionData)if(this._fetchedAttributionData.has(y)){var D=this._fetchedAttributionData.get(y);D?p(z,y,this._getDynamicAttribution(D,x,w)):q(w)&&p(z,y,w.copyright)}else this._fetchAttributionData(y);else(D=w.get("portalItem.accessInformation"))?p(z,y,D):p(z,y,w.copyright)}}),k(this.items,z)&&(this.items.removeAll(),this.items.addMany(z)),z.length=0,this.notifyChange("state")):this._clear()};A._fetchAttributionData=function(){var x=a._asyncToGenerator(function*(u){if(!this._pendingAttributions.has(u)){this._pendingAttributions.add(u);
var y=yield t.result(u.layer.fetchAttributionData());this._pendingAttributions.has(u)&&(y=y.ok?this._createContributionIndex(y.value,"bing-maps"===u.layer.type):null,this._pendingAttributions.delete(u),this._fetchedAttributionData.set(u,y));this._updateAttributionItems()}});return function(u){return x.apply(this,arguments)}}();A._createContributionIndex=function(x,u){x=x.contributors;const y={};if(!x)return y;for(let E=0;E<x.length;E++){const K=x[E];var w=K.coverageAreas;if(!w)return;for(const J of w){var D=
J.bbox,F=J.zoomMin-(u&&J.zoomMin?1:0);w=J.zoomMax-(u&&J.zoomMax?1:0);for(D={extent:l.geographicToWebMercator({xmin:D[1],ymin:D[0],xmax:D[3],ymax:D[2],spatialReference:v.WGS84}),attribution:K.attribution||"",score:null!=J.score?J.score:100,id:E};F<=w;F++)y[F]=y[F]||[],y[F].push(D)}}y.maxKey=Math.max.apply(null,Object.keys(y));return y};A._getDynamicAttribution=function(x,u,y){const {extent:w,scale:D}=u;y=y.tileInfo?.scaleToZoom(D)??0;y=Math.min(x.maxKey??0,Math.round(y));if(!w||null==y||-1>=y)return"";
x=x[y];const F=l.project(w.center.clone().normalize(),u.spatialReference),E={};return x?x.filter(K=>{const J=K.id;(K=!E[J]&&F&&K.extent&&h.extentContainsPoint(K.extent,F))&&(E[J]=!0);return K}).sort((K,J)=>J.score-K.score||K.objectId-J.objectId).map(K=>K.attribution).join(", "):""};a._createClass(B,[{key:"state",get:function(){return this.get("view.ready")?0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return B}(r.HandleOwner);c.__decorate([d.property({readOnly:!0,type:n})],b.prototype,
"items",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"state",null);c.__decorate([d.property()],b.prototype,"view",void 0);return b=c.__decorate([g.subclass("esri.widgets.Attribution.AttributionViewModel")],b)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./Compass/css ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){t=function(v){function q(p,z){p=v.call(this,p,z)||this;p.iconClass=f.CSS.widgetIcon;p.messages=null;p.viewModel=new d;return p}a._inheritsLoose(q,v);var k=q.prototype;k.reset=function(){return this.viewModel.reset()};k.render=function(){const {orientation:p,state:z}=this.viewModel;var C="disabled"===z,B="compass"===("rotation"===z?"rotation":"compass");const A=C?-1:0;C={[f.CSS.disabled]:C,[f.CSS.interactive]:!C};B={[f.CSS.northIcon]:B,[f.CSS.rotationIcon]:!B};const {messages:x}=
this;return h.tsx("div",{bind:this,class:this.classes(f.CSS.base,C),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:A,"aria-label":x.reset,title:x.reset},h.tsx("span",{"aria-hidden":"true",class:this.classes(f.CSS.icon,B),styles:this._toRotationTransform(p)}),h.tsx("span",{class:f.CSS.text},x.reset))};k._reset=function(){this.viewModel.reset()};k._toRotationTransform=function(p){return{transform:`rotateZ(${p.z}deg)`}};a._createClass(q,[{key:"goToOverride",get:function(){return this.viewModel.goToOverride},
set:function(p){this.viewModel.goToOverride=p}},{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(p){this._overrideIfSome("label",p)}},{key:"view",get:function(){return this.viewModel.view},set:function(p){this.viewModel.view=p}}]);return q}(m);c.__decorate([b.property()],t.prototype,"goToOverride",null);c.__decorate([b.property()],t.prototype,"iconClass",void 0);c.__decorate([b.property()],t.prototype,"label",null);c.__decorate([b.property(),g.messageBundle("esri/widgets/Compass/t9n/Compass")],
t.prototype,"messages",void 0);c.__decorate([b.property()],t.prototype,"view",null);c.__decorate([b.property({type:d})],t.prototype,"viewModel",void 0);c.__decorate([e.accessibleHandler()],t.prototype,"_reset",null);return t=c.__decorate([r.subclass("esri.widgets.Compass")],t)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../support/GoTo".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){b=function(h){function l(q){q=h.call(this,q)||this;q._handles=new t;q.orientation={x:0,y:0,z:0};q.view=null;q._updateForCamera=q._updateForCamera.bind(a._assertThisInitialized(q));q._updateForRotation=q._updateForRotation.bind(a._assertThisInitialized(q));q._updateRotationWatcher=q._updateRotationWatcher.bind(a._assertThisInitialized(q));return q}a._inheritsLoose(l,h);var v=l.prototype;v.initialize=function(){this._handles.add(r.watch(()=>this.view,this._updateRotationWatcher,
r.initial))};v.destroy=function(){n.removeMaybe(this._handles);this.view=null};v.reset=function(){if(this.get("view.ready")){var q={};"2d"===this.view?.type?q.rotation=0:q.heading=0;this.callGoTo({target:q})}};v._updateForRotation=function(q){void 0!==q&&null!==q&&(this.orientation={z:q})};v._updateForCamera=function(q){q&&(this.orientation={x:0,y:0,z:-q.heading})};v._updateRotationWatcher=function(q){this._handles.removeAll();q&&this._handles.add("2d"===q.type?r.watch(()=>q?.rotation,this._updateForRotation,
r.initial):r.watch(()=>q?.camera,this._updateForCamera,r.initial))};a._createClass(l,[{key:"canShowNorth",get:function(){const q=this.get("view.spatialReference");return!(!q||!q.isWebMercator&&!q.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return l}(g.GoToMixin(b));c.__decorate([m.property({readOnly:!0})],b.prototype,"canShowNorth",null);c.__decorate([m.property()],b.prototype,"orientation",void 0);c.__decorate([m.property({readOnly:!0})],
b.prototype,"state",null);c.__decorate([m.property()],b.prototype,"view",void 0);return b=c.__decorate([e.subclass("esri.widgets.CompassViewModel")],b)})},"esri/widgets/Compass/css":function(){define(["exports"],function(a){a.CSS={base:"esri-compass esri-widget--button esri-widget",text:"esri-icon-font-fallback-text",icon:"esri-compass__icon",rotationIcon:"esri-icon-dial",northIcon:"esri-icon-compass",widgetIcon:"esri-icon-locate-circled",interactive:"esri-interactive",disabled:"esri-disabled"};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/css ./NavigationToggle/NavigationToggleViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),function(a,
c,b,t,n,r,m,d,f,e,g,h,l){t=function(v){function q(p,z){p=v.call(this,p,z)||this;p.iconClass=d.CSS.widgetIcon;p.messages=null;p.viewModel=new f;return p}a._inheritsLoose(q,v);var k=q.prototype;k.toggle=function(){return this.viewModel.toggle()};k.render=function(){const p="disabled"===this.get("viewModel.state");var z="pan"===this.get("viewModel.navigationMode");const C={[d.CSS.activeButton]:z};z={[d.CSS.activeButton]:!z};const B=p?-1:0,A=this.messages.toggle;return h.tsx("div",{bind:this,class:this.classes(d.CSS.base,
{[d.CSS.disabled]:p,[d.CSS.isLayoutHorizontal]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:B,"aria-label":A,title:A},h.tsx("div",{class:this.classes(d.CSS.button,d.CSS.panButton,C)},h.tsx("span",{class:d.CSS.panIcon})),h.tsx("div",{class:this.classes(d.CSS.button,d.CSS.rotateButton,z)},h.tsx("span",{class:d.CSS.rotationIcon})))};k._toggle=function(){this.toggle()};a._createClass(q,[{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(p){this._overrideIfSome("label",
p)}},{key:"layout",set:function(p){"horizontal"!==p&&(p="vertical");this._set("layout",p)}},{key:"view",get:function(){return this.viewModel.view},set:function(p){this.viewModel.view=p}}]);return q}(m);c.__decorate([b.property()],t.prototype,"iconClass",void 0);c.__decorate([b.property()],t.prototype,"label",null);c.__decorate([b.property({value:"vertical"})],t.prototype,"layout",null);c.__decorate([b.property(),g.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],t.prototype,"messages",
void 0);c.__decorate([b.property()],t.prototype,"view",null);c.__decorate([b.property({type:f})],t.prototype,"viewModel",void 0);c.__decorate([e.accessibleHandler()],t.prototype,"_toggle",null);return t=c.__decorate([r.subclass("esri.widgets.NavigationToggle")],t)})},"esri/widgets/NavigationToggle/css":function(){define(["exports"],function(a){a.CSS={base:"esri-navigation-toggle esri-widget",button:"esri-navigation-toggle__button esri-widget--button",activeButton:"esri-navigation-toggle__button--active",
panButton:"esri-navigation-toggle__button--pan",rotateButton:"esri-navigation-toggle__button--rotate",isLayoutHorizontal:"esri-navigation-toggle--horizontal",rotationIcon:"esri-icon-rotate",panIcon:"esri-icon-pan",widgetIcon:"esri-icon-pan2",disabled:"esri-disabled"};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d){b=function(f){function e(h){h=f.call(this,h)||this;h.navigationMode="pan";h.view=null;return h}a._inheritsLoose(e,f);var g=e.prototype;g.initialize=function(){this.own(t.when(()=>this.view?.inputManager,()=>this._setNavigationMode()))};g.destroy=function(){this.view=null};g.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};g._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction=
"pan"===this.navigationMode?"pan":"rotate"};a._createClass(e,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view?.type?"ready":"disabled"}}]);return e}(b);c.__decorate([n.property({readOnly:!0})],b.prototype,"state",null);c.__decorate([n.property()],b.prototype,"navigationMode",void 0);c.__decorate([n.property()],b.prototype,"view",void 0);return b=c.__decorate([d.subclass("esri.widgets.NavigationToggleViewModel")],b)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){n=function(v){function q(p,z){p=v.call(this,p,z)||this;p.iconClass="esri-icon-zoom-in-magnifying-glass";p.messages=null;p.viewModel=new l;return p}a._inheritsLoose(q,v);var k=q.prototype;k.initialize=function(){this._zoomInButton=new h({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new h({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};k.destroy=function(){this._zoomInButton=b.destroyMaybe(this._zoomInButton);this._zoomOutButton=
b.destroyMaybe(this._zoomOutButton)};k.render=function(){const p={["esri-zoom--horizontal"]:"horizontal"===this.layout},{canZoomIn:z,canZoomOut:C}=this.viewModel;this._zoomInButton.enabled=z;this._zoomOutButton.enabled=C;const {zoomIn:B,zoomOut:A}=this.messages;this._zoomInButton.title=B;this._zoomOutButton.title=A;return g.tsx("div",{class:this.classes("esri-zoom esri-widget",p)},this._zoomInButton.render(),this._zoomOutButton.render())};k.zoomIn=function(){return this.viewModel.zoomIn()};k.zoomOut=
function(){return this.viewModel.zoomOut()};a._createClass(q,[{key:"label",get:function(){return this.messages?.widgetLabel??""},set:function(p){this._overrideIfSome("label",p)}},{key:"layout",set:function(p){"horizontal"!==p&&(p="vertical");this._set("layout",p)}},{key:"view",get:function(){return this.viewModel.view},set:function(p){this.viewModel.view=p}}]);return q}(d);c.__decorate([t.property()],n.prototype,"iconClass",void 0);c.__decorate([t.property()],n.prototype,"label",null);c.__decorate([t.property({value:"vertical"})],
n.prototype,"layout",null);c.__decorate([t.property(),e.messageBundle("esri/widgets/Zoom/t9n/Zoom")],n.prototype,"messages",void 0);c.__decorate([t.property()],n.prototype,"view",null);c.__decorate([t.property({type:l})],n.prototype,"viewModel",void 0);return n=c.__decorate([m.subclass("esri.widgets.Zoom")],n)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../Widget ../support/decorators/accessibleHandler ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e){t=function(g){function h(){var v=g.apply(this,arguments)||this;v.enabled=!0;v.iconClass="";v.title="";return v}a._inheritsLoose(h,g);var l=h.prototype;l.render=function(){const v=this.enabled?0:-1,q={[this.iconClass]:!!this.iconClass};return f.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:v,title:this.title},
f.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",q)}),f.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};l._triggerAction=function(){this.action.call(this)};return h}(m);c.__decorate([b.property()],t.prototype,"action",void 0);c.__decorate([b.property()],t.prototype,"enabled",void 0);c.__decorate([b.property()],t.prototype,"iconClass",void 0);c.__decorate([b.property()],t.prototype,"title",void 0);c.__decorate([d.accessibleHandler()],t.prototype,
"_triggerAction",null);return t=c.__decorate([r.subclass("esri.widgets.IconButton")],t)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/maybe ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){b=
function(h){function l(q){return h.call(this,q)||this}a._inheritsLoose(l,h);var v=l.prototype;v.destroy=function(){this.view=null};v.zoomIn=function(){if(this.canZoomIn){var q=this.view;"2d"===q.type?q.mapViewNavigation.zoomIn():n.ignoreAbortErrors(q.goTo({zoomFactor:2}))}};v.zoomOut=function(){if(this.canZoomOut){var q=this.view;"2d"===q.type?q.mapViewNavigation.zoomOut():n.ignoreAbortErrors(q.goTo({zoomFactor:.5}))}};a._createClass(l,[{key:"canZoomIn",get:function(){return t.isSome(this._zoomConditions)&&
this._zoomConditions.canZoomIn}},{key:"canZoomOut",get:function(){return t.isSome(this._zoomConditions)&&this._zoomConditions?.canZoomOut}},{key:"state",get:function(){return this.view?.ready?"ready":"disabled"}},{key:"view",set:function(q){q?"2d"===q.type?this._zoomConditions=new e({view:q}):"3d"===q.type&&(this._zoomConditions=new g({view:q})):this._zoomConditions=null;this._set("view",q)}}]);return l}(b);c.__decorate([r.property()],b.prototype,"_zoomConditions",void 0);c.__decorate([r.property()],
b.prototype,"canZoomIn",null);c.__decorate([r.property()],b.prototype,"canZoomOut",null);c.__decorate([r.property({readOnly:!0})],b.prototype,"state",null);c.__decorate([r.property()],b.prototype,"view",null);return b=c.__decorate([f.subclass("esri.widgets.Zoom.ZoomViewModel")],b)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m){b=function(d){function f(){return d.apply(this,arguments)||this}a._inheritsLoose(f,d);a._createClass(f,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),g=this.get("view.constraints.effectiveMaxScale");return 0===g||e>g}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),g=this.get("view.constraints.effectiveMinScale");
return 0===g||e<g}}]);return f}(b);c.__decorate([t.property({readOnly:!0})],b.prototype,"canZoomIn",null);c.__decorate([t.property({readOnly:!0})],b.prototype,"canZoomOut",null);c.__decorate([t.property()],b.prototype,"view",void 0);return b=c.__decorate([m.subclass("esri.widgets.Zoom.ZoomConditions2D")],b)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m){b=function(d){function f(){return d.apply(this,arguments)||this}a._inheritsLoose(f,d);a._createClass(f,[{key:"canZoomIn",get:function(){return!!this.view.ready}},{key:"canZoomOut",get:function(){return!!this.view.ready}}]);return f}(b);c.__decorate([t.property({readOnly:!0})],b.prototype,"canZoomIn",null);c.__decorate([t.property({readOnly:!0})],b.prototype,"canZoomOut",null);c.__decorate([t.property()],b.prototype,"view",void 0);return b=c.__decorate([m.subclass("esri.widgets.Zoom.ZoomConditions3D")],
b)})},"esri/layers/SceneLayer":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Graphic ../PopupTemplate ../renderers/ClassBreaksRenderer ../renderers/DictionaryRenderer ../renderers/DotDensityRenderer ../renderers/HeatmapRenderer ../renderers/PieChartRenderer ../renderers/Renderer ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/support/jsonUtils ../renderers/support/types ../request ../core/Collection ../core/Error ../core/Logger ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/reactiveUtils ../core/urlUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/utils ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/PropertyOrigin ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISService ./mixins/EditBusLayer ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./mixins/SceneService ./support/capabilities ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/FetchAssociatedFeatureLayer ./support/fieldProperties ./support/FieldsIndex ./support/fieldUtils ./support/I3SLayerDefinitions ./support/LabelClass ./support/labelingInfo ./support/LayerFloorInfo ./support/RangeInfo ./support/SceneFilter ../renderers/support/styleUtils ../rest/support/Query ../support/featureFlags ../support/popupUtils ../views/3d/layers/i3s/I3SUtil ../views/layers/support/popupUtils ../webdoc/support/opacityUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V,aa,X,W,T,U,Y,ba,da,ea,ca,ja,ia,Z,ha,fa,ka,la,na){const pa=["3DObject","Point"];r=W.defineFieldProperties();A=function(za){function sa(...oa){oa=za.call(this,...oa)||this;oa.featureReduction=null;oa.rangeInfos=null;oa.operationalLayerType="ArcGISSceneServiceLayer";oa.type="scene";oa.fields=null;oa.floorInfo=null;oa.outFields=null;oa.nodePages=null;oa.materialDefinitions=null;oa.textureSetDefinitions=null;oa.geometryDefinitions=
null;oa.serviceUpdateTimeStamp=null;oa.excludeObjectIds=new p;oa.definitionExpression=null;oa.filter=null;oa.path=null;oa.labelsVisible=!0;oa.labelingInfo=null;oa.legendEnabled=!0;oa.priority=null;oa.semantic=null;oa.cachedDrawingInfo={color:!1};oa.popupEnabled=!0;oa.popupTemplate=null;oa.objectIdField=null;oa.globalIdField=null;oa._fieldUsageInfo={};oa.screenSizePerspectiveEnabled=!0;return oa}c._inheritsLoose(sa,za);var ua=sa.prototype;ua.normalizeCtorArgs=function(oa,xa){return"string"===typeof oa?
{url:oa,...xa}:oa};ua.getField=function(oa){return this.fieldsIndex.get(oa)};ua.getFieldDomain=function(oa,xa){return(xa=this.getFeatureType(xa?.feature)?.domains?.[oa])&&"inherited"!==xa.type?xa:this.getField(oa)?.domain??null};ua.getFeatureType=function(oa){return null!=oa&&B.isSome(this.associatedLayer)?this.associatedLayer.getFeatureType(oa):null};ua.readNodePages=function(oa,xa,Ea){"Point"===xa.layerType&&(oa=xa.pointNodePages);return null==oa||"object"!==typeof oa?null:Y.I3SNodePageDefinition.fromJSON(oa,
Ea)};ua.readCachedDrawingInfo=function(oa){if(null==oa||"object"!==typeof oa)oa={};null==oa.color&&(oa.color=!1);return oa};ua.readObjectIdField=function(oa,xa){!oa&&xa.fields&&xa.fields.some(Ea=>{"esriFieldTypeOID"===Ea.type&&(oa=Ea.name);return!!oa});return oa||void 0};ua.readGlobalIdField=function(oa,xa){!oa&&xa.fields&&xa.fields.some(Ea=>{"esriFieldTypeGlobalID"===Ea.type&&(oa=Ea.name);return!!oa});return oa||void 0};ua.readProfile=function(oa,xa){oa=xa.store.profile;if(null!=oa&&va[oa])return va[oa];
C.getLogger(this.declaredClass).error("Unknown or missing profile",{profile:oa,layer:this});return"mesh-pyramids"};ua.load=function(oa){const xa=B.isSome(oa)?oa.signal:null,Ea=this.loadFromPortal({supportedTypes:["Scene Service"]},oa).catch(x.throwIfAbortError).then(()=>this._fetchService(xa)).then(()=>Promise.all([this._fetchIndexAndUpdateExtent(this.nodePages,xa),this._setAssociatedFeatureLayer(xa),B.isSome(this.filter)?this.filter.loadGeometries(this.spatialReference):null])).then(()=>this._validateElevationInfo()).then(()=>
this._applyAssociatedLayerOverrides()).then(()=>this._populateFieldUsageInfo()).then(()=>ia.loadStyleRenderer(this,{origin:"service"},xa)).then(()=>U.fixRendererFields(this.renderer,this.fieldsIndex)).then(()=>this.finishLoadEditablePortalLayer(oa));this.addResolvingPromise(Ea);return Promise.resolve(this)};ua.beforeSave=function(){var oa=c._asyncToGenerator(function*(){B.isSome(this.filter)&&(yield this.load())});return function(){return oa.apply(this,arguments)}}();ua.createQuery=function(){const oa=
new Z;"mesh"!==this.geometryType&&(oa.returnGeometry=!0,oa.returnZ=!0);oa.where=this.definitionExpression||"1\x3d1";oa.sqlFormat="standard";oa.outFields=["*"];return oa};ua.queryExtent=function(oa,xa){return this._getAssociatedLayerForQuery().then(Ea=>Ea.queryExtent(oa||this.createQuery(),xa))};ua.queryFeatureCount=function(oa,xa){return this._getAssociatedLayerForQuery().then(Ea=>Ea.queryFeatureCount(oa||this.createQuery(),xa))};ua.queryFeatures=function(oa,xa){return this._getAssociatedLayerForQuery().then(Ea=>
Ea.queryFeatures(oa||this.createQuery(),xa)).then(Ea=>{if(Ea?.features)for(const Ia of Ea.features)Ia.layer=this,Ia.sourceLayer=this;return Ea})};ua.queryCachedAttributes=function(){var oa=c._asyncToGenerator(function*(xa,Ea){const Ia=U.unpackFieldNames(this.fieldsIndex,yield la.getRequiredFields(this,la.getFetchPopupTemplate(this)));return ka.queryAttributesFromCachedAttributesId(this.parsedUrl.path,this.attributeStorageInfo??[],xa,Ea,Ia)});return function(xa,Ea){return oa.apply(this,arguments)}}();
ua.queryCachedFeature=function(){var oa=c._asyncToGenerator(function*(xa,Ea){xa=yield this.queryCachedAttributes(xa,[Ea]);if(!xa||0===xa.length)throw new z("scenelayer:feature-not-in-cached-data","Feature not found in cached data");Ea=new t;Ea.attributes=xa[0];Ea.layer=this;Ea.sourceLayer=this;return Ea});return function(xa,Ea){return oa.apply(this,arguments)}}();ua.queryObjectIds=function(oa,xa){return this._getAssociatedLayerForQuery().then(Ea=>Ea.queryObjectIds(oa||this.createQuery(),xa))};ua.queryAttachments=
function(oa,xa){return this._getAssociatedLayerForQuery().then(Ea=>Ea.queryAttachments(oa,xa))};ua.getFieldUsageInfo=function(oa){const xa={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[oa]||xa:(C.getLogger(this.declaredClass).error("#getFieldUsageInfo()","Unavailable until layer is loaded"),xa)};ua.createPopupTemplate=function(oa){return fa.createPopupTemplate(this,oa)};ua._getAssociatedLayerForQuery=function(){const oa=
this.associatedLayer;return B.isSome(oa)&&oa.loaded?Promise.resolve(oa):this._loadAssociatedLayerForQuery()};ua._loadAssociatedLayerForQuery=function(){var oa=c._asyncToGenerator(function*(){yield this.load();if(B.isNone(this.associatedLayer))throw new z("scenelayer:query-not-available","SceneLayer queries are not available without an associated feature layer",{layer:this});try{yield this.associatedLayer.load()}catch(xa){throw new z("scenelayer:query-not-available","SceneLayer associated feature layer could not be loaded",
{layer:this,error:xa});}return this.associatedLayer});return function(){return oa.apply(this,arguments)}}();ua.hasCachedStatistics=function(oa){return null!=this.statisticsInfo&&this.statisticsInfo.some(xa=>xa.name===oa)};ua.queryCachedStatistics=function(){var oa=c._asyncToGenerator(function*(xa,Ea){yield this.load(Ea);if(!this.statisticsInfo)throw new z("scenelayer:no-cached-statistics","Cached statistics are not available for this layer");const Ia=this.fieldsIndex.get(xa);if(!Ia)throw new z("scenelayer:field-unexisting",
`Field '${xa}' does not exist on the layer`);for(const Na of this.statisticsInfo)if(Na.name===Ia.name)return xa=y.join(this.parsedUrl.path,Na.href),k(xa,{query:{f:"json",token:this.apiKey},responseType:"json",signal:Ea?Ea.signal:null}).then(Oa=>Oa.data);throw new z("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available");});return function(xa,Ea){return oa.apply(this,arguments)}}();ua.saveAs=function(){var oa=c._asyncToGenerator(function*(xa,Ea){return this._debouncedSaveOperations(S.SaveOperationType.SAVE_AS,
{...Ea,getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"},xa)});return function(xa,Ea){return oa.apply(this,arguments)}}();ua.save=function(){var oa=c._asyncToGenerator(function*(){return this._debouncedSaveOperations(S.SaveOperationType.SAVE,{getTypeKeywords:()=>this._getTypeKeywords(),portalItemLayerType:"scene"})});return function(){return oa.apply(this,arguments)}}();ua.applyEdits=function(){var oa=c._asyncToGenerator(function*(xa,Ea){const Ia=yield new Promise((Na,Oa)=>
a(["./graphics/editingSupport"],Na,Oa));yield this.load();if(B.isNone(this.associatedLayer))throw new z(`${this.type}-layer:not-editable`,"Service is not editable");yield this.associatedLayer.load();return Ia.applyEdits(this,this.associatedLayer.source,xa,Ea)});return function(xa,Ea){return oa.apply(this,arguments)}}();ua.on=function(oa,xa){return za.prototype.on.call(this,oa,xa)};ua.validateLayer=function(oa){if(oa.layerType&&!pa.includes(oa.layerType))throw new z("scenelayer:layer-type-not-supported",
"SceneLayer does not support this layer type",{layerType:oa.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new z("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});if(2<this.version.major)throw new z("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x, 2.x"});oa=this.normalReferenceFrame;var xa=this.spatialReference;
let Ea=!1,Ia=!1;if(null==oa)Ia=Ea=!0;else switch(xa=xa&&xa.isGeographic,oa){case "east-north-up":case "earth-centered":Ea=!0;Ia=xa;break;case "vertex-reference-frame":Ea=!0;Ia=!xa;break;default:Ea=!1}if(!Ea)throw new z("scenelayer:unsupported-normal-reference-frame","Normal reference frame is invalid.");if(!Ia)throw new z("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};ua._getTypeKeywords=function(){const oa=[];if("points"===
this.profile)oa.push("Point");else if("mesh-pyramids"===this.profile)oa.push("3DObject");else throw new z("scenelayer:unknown-profile","SceneLayer:save() encountered an unknown SceneLayer profile: "+this.profile);return oa};ua._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(const oa of this.fields){const xa=!(!this.attributeStorageInfo||!this.attributeStorageInfo.some(Ia=>Ia.name===oa.name)),Ea=!!(B.isSome(this.associatedLayer)&&this.associatedLayer.fields&&this.associatedLayer.fields.some(Ia=>
Ia&&oa.name===Ia.name));this._fieldUsageInfo[oa.name]={supportsLabelingInfo:xa,supportsRenderer:xa,supportsPopupTemplate:xa||Ea,supportsLayerQuery:Ea}}};ua._applyAssociatedLayerOverrides=function(){this._applyAssociatedLayerFieldsOverrides();this._applyAssociatedLayerPopupOverrides()};ua._applyAssociatedLayerFieldsOverrides=function(){if(!B.isNone(this.associatedLayer)&&this.associatedLayer.fields){var oa=null;for(const xa of this.associatedLayer.fields){const Ea=this.getField(xa.name);Ea?(!Ea.domain&&
xa.domain&&(Ea.domain=xa.domain.clone()),Ea.editable=xa.editable,Ea.nullable=xa.nullable,Ea.length=xa.length):(oa||(oa=this.fields?this.fields.slice():[]),oa.push(xa.clone()))}oa&&this._set("fields",oa)}};ua._applyAssociatedLayerPopupOverrides=function(){if(!B.isNone(this.associatedLayer)){var oa=["popupTemplate","popupEnabled"],xa=E.getProperties(this);for(let Ea=0;Ea<oa.length;Ea++){const Ia=oa[Ea],Na=this.originIdOf(Ia),Oa=this.associatedLayer.originIdOf(Ia);Na<Oa&&(Oa===M.OriginId.SERVICE||Oa===
M.OriginId.PORTAL_ITEM)&&xa.setAtOrigin(Ia,this.associatedLayer[Ia],Oa)}}};ua._setAssociatedFeatureLayer=function(){var oa=c._asyncToGenerator(function*(xa){if(["mesh-pyramids","points"].includes(this.profile)){xa=new X.FetchAssociatedFeatureLayer(this.parsedUrl,this.portalItem,this.apiKey,xa);try{this.associatedLayer=yield xa.fetch()}catch(Ea){x.isAbortError(Ea)||this._logWarningOnPopupEnabled()}}});return function(xa){return oa.apply(this,arguments)}}();ua._logWarningOnPopupEnabled=function(){var oa=
c._asyncToGenerator(function*(){yield u.whenOnce(()=>this.popupEnabled&&null!=this.popupTemplate);const xa=`this SceneLayer: ${this.title}`;null==this.attributeStorageInfo?C.getLogger(this.declaredClass).warn(`Associated FeatureLayer could not be loaded and no binary attributes found. Popups will not work on ${xa}`):C.getLogger(this.declaredClass).info(`Associated FeatureLayer could not be loaded. Falling back to binary attributes for Popups on ${xa}`)});return function(){return oa.apply(this,arguments)}}();
ua._validateElevationInfo=function(){const oa=this.elevationInfo;oa&&("mesh-pyramids"===this.profile&&"relative-to-scene"===oa.mode&&C.getLogger(this.declaredClass).warn(".elevationInfo\x3d","Mesh scene layers don't support relative-to-scene elevation mode"),oa.featureExpressionInfo&&"0"!==oa.featureExpressionInfo.expression&&C.getLogger(this.declaredClass).warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};c._createClass(sa,[{key:"types",get:function(){return B.isSome(this.associatedLayer)?
this.associatedLayer.types??[]:[]}},{key:"typeIdField",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.typeIdField:null}},{key:"formTemplate",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.formTemplate:null}},{key:"fieldsIndex",get:function(){return new T(this.fields)}},{key:"elevationInfo",set:function(oa){this._set("elevationInfo",oa);this.loaded&&this._validateElevationInfo()}},{key:"geometryType",get:function(){return wa[this.profile]||"mesh"}},
{key:"renderer",set:function(oa){U.fixRendererFields(oa,this.fieldsIndex);this._set("renderer",oa)}},{key:"capabilities",get:function(){var oa=B.isSome(this.associatedLayer)&&this.associatedLayer.capabilities?this.associatedLayer.capabilities:R.zeroCapabilities;const {query:xa,editing:{supportsGlobalId:Ea,supportsRollbackOnFailure:Ia,supportsUploadWithItemId:Na,supportsGeometryUpdate:Oa,supportsReturnServiceEditsInSourceSpatialReference:Ja},data:{supportsZ:Sa,supportsM:Ua,isVersioned:Za,supportsAttachment:ma},
operations:{supportsEditing:Ya,supportsAdd:bb,supportsUpdate:Qa,supportsDelete:Aa,supportsQuery:Ca,supportsQueryAttachments:qa}}=oa;oa=oa.operations.supportsChangeTracking;const ya=B.isSome(this.associatedLayer)&&B.isSome(this.associatedLayer.infoFor3D)&&ha.sceneLayerEditingEnabled();return{query:xa,editing:{supportsGlobalId:Ea,supportsReturnServiceEditsInSourceSpatialReference:Ja,supportsRollbackOnFailure:Ia,supportsGeometryUpdate:ya&&Oa,supportsUploadWithItemId:Na},data:{supportsAttachment:ma,supportsZ:Sa,
supportsM:Ua,isVersioned:Za},operations:{supportsQuery:Ca,supportsQueryAttachments:qa,supportsEditing:Ya&&oa,supportsAdd:ya&&bb&&oa,supportsDelete:ya&&Aa&&oa,supportsUpdate:Qa&&oa}}}},{key:"editingEnabled",get:function(){return this._isOverridden("editingEnabled")?this._get("editingEnabled"):this.userHasEditingPrivileges},set:function(oa){this._overrideIfSome("editingEnabled",oa)}},{key:"infoFor3D",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.infoFor3D:null}},{key:"defaultPopupTemplate",
get:function(){return B.isSome(this.associatedLayer)||this.attributeStorageInfo?this.createPopupTemplate():null}},{key:"displayField",get:function(){return B.isSome(this.associatedLayer)?this.associatedLayer.displayField:null}}]);return sa}(G.EditBusLayer(S.SceneService(I.ArcGISService(H.OperationalLayer(L.PortalLayer(O.ScaleRangeLayer(A.MultiOriginJSONMixin(P.APIKeyMixin(N)))))))));b.__decorate([w.property({types:{key:"type",base:V.FeatureReduction,typeMap:{selection:aa}},json:{origins:{"web-scene":{name:"layerDefinition.featureReduction",
write:!0},"portal-item":{name:"layerDefinition.featureReduction",write:!0}}}})],A.prototype,"featureReduction",void 0);b.__decorate([w.property({type:[ca.RangeInfo],json:{read:!1,origins:{"web-scene":{name:"layerDefinition.rangeInfos",write:!0},"portal-item":{name:"layerDefinition.rangeInfos",write:!0}}}})],A.prototype,"rangeInfos",void 0);b.__decorate([w.property({json:{read:!1}})],A.prototype,"associatedLayer",void 0);b.__decorate([w.property({type:["show","hide"]})],A.prototype,"listMode",void 0);
b.__decorate([w.property({type:["ArcGISSceneServiceLayer"]})],A.prototype,"operationalLayerType",void 0);b.__decorate([w.property({json:{read:!1},readOnly:!0})],A.prototype,"type",void 0);b.__decorate([w.property({...r.fields,readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],A.prototype,"fields",void 0);b.__decorate([w.property()],A.prototype,"types",null);b.__decorate([w.property()],A.prototype,"typeIdField",null);b.__decorate([w.property()],A.prototype,"formTemplate",null);b.__decorate([w.property({readOnly:!0})],
A.prototype,"fieldsIndex",null);b.__decorate([w.property({type:ea,json:{read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo"}}})],A.prototype,"floorInfo",void 0);b.__decorate([w.property(r.outFields)],A.prototype,"outFields",void 0);b.__decorate([w.property({type:Y.I3SNodePageDefinition,readOnly:!0,json:{read:!1}})],A.prototype,"nodePages",void 0);b.__decorate([K.reader("service","nodePages",["nodePages","pointNodePages"])],A.prototype,"readNodePages",null);b.__decorate([w.property({type:[Y.I3SMaterialDefinition],
readOnly:!0})],A.prototype,"materialDefinitions",void 0);b.__decorate([w.property({type:[Y.I3STextureSetDefinition],readOnly:!0})],A.prototype,"textureSetDefinitions",void 0);b.__decorate([w.property({type:[Y.I3SGeometryDefinition],readOnly:!0})],A.prototype,"geometryDefinitions",void 0);b.__decorate([w.property({readOnly:!0})],A.prototype,"serviceUpdateTimeStamp",void 0);b.__decorate([w.property({readOnly:!0})],A.prototype,"attributeStorageInfo",void 0);b.__decorate([w.property({readOnly:!0})],A.prototype,
"statisticsInfo",void 0);b.__decorate([w.property({type:p.ofType(Number),nonNullable:!0,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.excludeObjectIds",write:{enabled:!0}}})],A.prototype,"excludeObjectIds",void 0);b.__decorate([w.property({type:String,json:{origins:{service:{read:!1,write:!1}},name:"layerDefinition.definitionExpression",write:{enabled:!0,allowNull:!0}}})],A.prototype,"definitionExpression",void 0);b.__decorate([w.property({type:ja,json:{name:"layerDefinition.polygonFilter",
write:{enabled:!0,allowNull:!0},origins:{service:{read:!1,write:!1}}}})],A.prototype,"filter",void 0);b.__decorate([w.property({type:String,json:{origins:{"web-scene":{read:!0,write:!0}},read:!1}})],A.prototype,"path",void 0);b.__decorate([w.property(Q.elevationInfo)],A.prototype,"elevationInfo",null);b.__decorate([w.property({type:String})],A.prototype,"geometryType",null);b.__decorate([w.property(Q.labelsVisible)],A.prototype,"labelsVisible",void 0);b.__decorate([w.property({type:[ba],json:{origins:{service:{name:"drawingInfo.labelingInfo",
read:{reader:da.reader},write:!1}},name:"layerDefinition.drawingInfo.labelingInfo",read:{reader:da.reader},write:!0}})],A.prototype,"labelingInfo",void 0);b.__decorate([w.property(Q.legendEnabled)],A.prototype,"legendEnabled",void 0);b.__decorate([w.property({type:Number,json:{origins:{"web-document":{default:1,write:{enabled:!0,target:{opacity:{type:Number},"layerDefinition.drawingInfo.transparency":{type:Number}}},read:{source:["opacity","layerDefinition.drawingInfo.transparency"],reader(za,sa){if("number"===
typeof za&&0<=za&&1>=za)return za;za=sa.layerDefinition?.drawingInfo?.transparency;return void 0!==za?na.transparencyToOpacity(za):void 0}}},"portal-item":{write:!0},service:{read:!1}}}})],A.prototype,"opacity",void 0);b.__decorate([w.property({type:["Low","High"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],A.prototype,"priority",void 0);b.__decorate([w.property({type:["Labels"],readOnly:!0,json:{read:!1,origins:{service:{read:!0}}}})],A.prototype,"semantic",void 0);b.__decorate([w.property({types:q.webSceneRendererTypes,
json:{origins:{service:{read:{source:"drawingInfo.renderer"}}},name:"layerDefinition.drawingInfo.renderer",write:!0},value:null})],A.prototype,"renderer",null);b.__decorate([w.property({json:{read:!1}})],A.prototype,"cachedDrawingInfo",void 0);b.__decorate([K.reader("service","cachedDrawingInfo")],A.prototype,"readCachedDrawingInfo",null);b.__decorate([w.property({readOnly:!0,json:{read:!1}})],A.prototype,"capabilities",null);b.__decorate([w.property({type:Boolean,json:{read:!1}})],A.prototype,"editingEnabled",
null);b.__decorate([w.property({readOnly:!0,json:{write:!1,read:!1}})],A.prototype,"infoFor3D",null);b.__decorate([w.property(Q.popupEnabled)],A.prototype,"popupEnabled",void 0);b.__decorate([w.property({type:n,json:{name:"popupInfo",write:!0}})],A.prototype,"popupTemplate",void 0);b.__decorate([w.property({readOnly:!0,json:{read:!1}})],A.prototype,"defaultPopupTemplate",null);b.__decorate([w.property({type:String,json:{read:!1}})],A.prototype,"objectIdField",void 0);b.__decorate([K.reader("service",
"objectIdField",["objectIdField","fields"])],A.prototype,"readObjectIdField",null);b.__decorate([w.property({type:String,json:{read:!1}})],A.prototype,"globalIdField",void 0);b.__decorate([K.reader("service","globalIdField",["globalIdField","fields"])],A.prototype,"readGlobalIdField",null);b.__decorate([w.property({readOnly:!0,type:String,json:{read:!1}})],A.prototype,"displayField",null);b.__decorate([w.property({type:String,json:{read:!1}})],A.prototype,"profile",void 0);b.__decorate([K.reader("service",
"profile",["store.profile"])],A.prototype,"readProfile",null);b.__decorate([w.property({readOnly:!0,type:String,json:{origins:{service:{read:{source:"store.normalReferenceFrame"}}},read:!1}})],A.prototype,"normalReferenceFrame",void 0);b.__decorate([w.property(Q.screenSizePerspectiveEnabled)],A.prototype,"screenSizePerspectiveEnabled",void 0);A=b.__decorate([J.subclass("esri.layers.SceneLayer")],A);const va={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",
points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},wa={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return A})},"esri/layers/mixins/SceneService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/originUtils ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../support/arcgisLayerUrl ../support/commonProperties ../support/I3SIndexInfo ../support/schemaValidatorLoader ../../portal/Portal ../../portal/PortalItem ../../webdoc/support/saveUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D){const F=r.getLogger("esri.layers.mixins.SceneService");var E;(function(J){J[J.existingItem=0]="existingItem";J[J.newItem=1]="newItem"})(E||(E={}));const K={getTypeKeywords:()=>[],portalItemLayerType:"unknown",validationOptions:{enabled:!0,ignoreUnsupported:!1,failPolicy:"throw"}};a.SaveOperationType=void 0;(function(J){J[J.SAVE=0]="SAVE";J[J.SAVE_AS=1]="SAVE_AS"})(a.SaveOperationType||(a.SaveOperationType={}));a.SCENE_SERVICE_ITEM_TYPE=
"Scene Service";a.SceneService=J=>{J=function(M){function N(){var I=M.apply(this,arguments)||this;I.spatialReference=null;I.fullExtent=null;I.heightModelInfo=null;I.minScale=0;I.maxScale=0;I.version={major:Number.NaN,minor:Number.NaN,versionString:""};I.copyright=null;I.sublayerTitleMode="item-title";I.title=null;I.layerId=null;I.indexInfo=null;I._debouncedSaveOperations=d.debounce(function(){var G=c._asyncToGenerator(function*(H,L,O){switch(H){case a.SaveOperationType.SAVE:return I._save(L);case a.SaveOperationType.SAVE_AS:return I._saveAs(O,
L)}});return function(H,L,O){return G.apply(this,arguments)}}());return I}c._inheritsLoose(N,M);var P=N.prototype;P.readSpatialReference=function(I,G){return this._readSpatialReference(G)};P._readSpatialReference=function(I){if(null!=I.spatialReference)return C.fromJSON(I.spatialReference);I=I.store;I=(I=I.indexCRS||I.geographicCRS)&&parseInt(I.substring(I.lastIndexOf("/")+1,I.length),10);return null!=I?new C(I):null};P.readFullExtent=function(I,G,H){if(null!=I&&"object"===typeof I)return G=null==
I.spatialReference?{...I,spatialReference:this._readSpatialReference(G)}:I,p.fromJSON(G,H);H=G.store;G=this._readSpatialReference(G);return null==G||null==H||null==H.extent||!Array.isArray(H.extent)||H.extent.some(L=>-1E38>L)?null:new p({xmin:H.extent[0],ymin:H.extent[1],xmax:H.extent[2],ymax:H.extent[3],spatialReference:G})};P.parseVersionString=function(I){const G={major:Number.NaN,minor:Number.NaN,versionString:I};I=I.split(".");2<=I.length&&(G.major=parseInt(I[0],10),G.minor=parseInt(I[1],10));
return G};P.readVersion=function(I,G){I=G.store;return this.parseVersionString(null!=I.version?I.version.toString():"")};P.readTitlePortalItem=function(I){return"item-title"!==this.sublayerTitleMode?void 0:I};P.readTitleService=function(I,G){I=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return B.titleFromUrlAndName(this.url,G.name);G=G.name;if(!G&&this.url){const H=B.parse(this.url);m.isSome(H)&&(G=H.title)}"item-title-and-service-name"===this.sublayerTitleMode&&
I&&(G=I+" - "+G);return B.cleanTitle(G)};P.writeUrl=function(I,G,H,L){B.writeUrlWithLayerId(this,I,"layers",G,L)};P._fetchIndexAndUpdateExtent=function(){var I=c._asyncToGenerator(function*(G,H){this.indexInfo=x.fetchIndexInfo(this.parsedUrl.path,this.rootNode,G,this.apiKey,F,H);null==this.fullExtent||this.fullExtent.hasZ||this._updateExtent(yield this.indexInfo)});return function(G,H){return I.apply(this,arguments)}}();P._updateExtent=function(I){if("page"===I?.type){var G=I.rootIndex%I.pageSize;
G=I.rootPage?.nodes?.[G];if(null==G||null==G.obb||null==G.obb.center||null==G.obb.halfSize)throw new n("sceneservice:invalid-node-page","Invalid node page.");-1E38>G.obb.center[0]||null==this.fullExtent||this.fullExtent.hasZ||(I=G.obb.halfSize,G=G.obb.center[2],I=Math.sqrt(I[0]*I[0]+I[1]*I[1]+I[2]*I[2]),this.fullExtent.zmin=G-I,this.fullExtent.zmax=G+I)}else if("node"===I?.type&&(G=I.rootNode?.mbs,Array.isArray(G)&&4===G.length&&!(-1E38>G[0]))){I=G[2];G=G[3];var {fullExtent:H}=this;H&&(H.zmin=I-G,
H.zmax=I+G)}};P._fetchService=function(){var I=c._asyncToGenerator(function*(G){if(null==this.url)throw new n("sceneservice:url-not-set","Scene service can not be loaded without valid portal item or url");if(null==this.layerId&&/SceneServer\/*$/i.test(this.url)){const H=yield this._fetchFirstLayerId(G);null!=H&&(this.layerId=H)}return this._fetchServiceLayer(G)});return function(G){return I.apply(this,arguments)}}();P._fetchFirstLayerId=function(){var I=c._asyncToGenerator(function*(G){G=yield t(this.url,
{query:{f:"json",token:this.apiKey},responseType:"json",signal:G});if(G.data&&Array.isArray(G.data.layers)&&0<G.data.layers.length)return G.data.layers[0].id});return function(G){return I.apply(this,arguments)}}();P._fetchServiceLayer=function(){var I=c._asyncToGenerator(function*(G){G=yield t(this.parsedUrl?.path??"",{query:{f:"json",token:this.apiKey},responseType:"json",signal:G});G.ssl&&(this.url=this.url.replace(/^http:/i,"https:"));let H=!1;G.data.layerType&&"Voxel"===G.data.layerType&&(H=!0);
if(H)return this._fetchVoxelServiceLayer();G=G.data;this.read(G,this._getServiceContext());this.validateLayer(G)});return function(G){return I.apply(this,arguments)}}();P._fetchVoxelServiceLayer=function(){var I=c._asyncToGenerator(function*(G){G=(yield t(this.parsedUrl?.path+"/layer",{query:{f:"json",token:this.apiKey},responseType:"json",signal:G})).data;this.read(G,this._getServiceContext());this.validateLayer(G)});return function(G){return I.apply(this,arguments)}}();P._getServiceContext=function(){return{origin:"service",
portalItem:this.portalItem,portal:this.portalItem?.portal,url:this.parsedUrl}};P._ensureLoadBeforeSave=function(){var I=c._asyncToGenerator(function*(){yield this.load();"beforeSave"in this&&"function"===typeof this.beforeSave&&(yield this.beforeSave())});return function(){return I.apply(this,arguments)}}();P.validateLayer=function(I){};P._updateTypeKeywords=function(I,G,H){I.typeKeywords||(I.typeKeywords=[]);G=G.getTypeKeywords();for(const L of G)I.typeKeywords.push(L);I.typeKeywords&&(I.typeKeywords=
I.typeKeywords.filter((L,O,S)=>S.indexOf(L)===O),H===E.newItem&&(I.typeKeywords=I.typeKeywords.filter(L=>"Hosted Service"!==L)))};P._saveAs=function(){var I=c._asyncToGenerator(function*(G,H){H={...K,...H};G=w.from(G);G||(F.error("_saveAs(): requires a portal item parameter"),yield Promise.reject(new n("sceneservice:portal-item-required","_saveAs() requires a portal item to save to")));G.id&&(G=G.clone(),G.id=null);const L=G.portal||y.getDefault();yield this._ensureLoadBeforeSave();G.type="Scene Service";
G.portal=L;const O={origin:"portal-item",url:null,messages:[],portal:L,portalItem:G,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},S={layers:[this.write({},O)]};yield Promise.all(O.resources.pendingOperations??[]);yield this._validateAgainstJSONSchema(S,O,H);G.url=this.url;G.title||(G.title=this.title);this._updateTypeKeywords(G,H,E.newItem);yield L.signIn();yield L.user?.addItem({item:G,folder:H&&H.folder,data:S});yield D.saveResources(this.resourceReferences,
O,null);this.portalItem=G;k.updateOrigins(O);return O.portalItem=G});return function(G,H){return I.apply(this,arguments)}}();P._save=function(){var I=c._asyncToGenerator(function*(G){G={...K,...G};if(!this.portalItem)throw F.error("_save(): requires the .portalItem property to be set"),new n("sceneservice:portal-item-not-set","Portal item to save to has not been set on this SceneService");if("Scene Service"!==this.portalItem.type)throw F.error("_save(): Non-matching portal item type. Got "+this.portalItem.type+
", expected Scene Service"),new n("sceneservice:portal-item-wrong-type",'Portal item needs to have type "Scene Service"');yield this._ensureLoadBeforeSave();const H={origin:"portal-item",url:this.portalItem.itemUrl&&f.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||y.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}},L={layers:[this.write({},H)]};yield Promise.all(H.resources.pendingOperations??
[]);yield this._validateAgainstJSONSchema(L,H,G);this.portalItem.url=this.url;this.portalItem.title||(this.portalItem.title=this.title);this._updateTypeKeywords(this.portalItem,G,E.existingItem);yield this.portalItem.update({data:L});yield D.saveResources(this.resourceReferences,H,null);k.updateOrigins(H);return this.portalItem});return function(G){return I.apply(this,arguments)}}();P._validateAgainstJSONSchema=function(){var I=c._asyncToGenerator(function*(G,H,L){H=H.messages?.filter(Q=>"error"===
Q.type).map(Q=>new n(Q.name,Q.message,Q.details))??[];L?.validationOptions?.ignoreUnsupported&&(H=H.filter(Q=>"layer:unsupported"!==Q.name&&"symbol:unsupported"!==Q.name&&"symbol-layer:unsupported"!==Q.name&&"property:unsupported"!==Q.name&&"url:unsupported"!==Q.name&&"scenemodification:unsupported"!==Q.name));const O=L?.validationOptions,S=O?.enabled,R=u.getLoader();if(S&&R&&(G=(yield R()).validate(G,L.portalItemLayerType),0<G.length&&(L=`Layer item did not validate:\n${G.join("\n")}`,F.error(`_validateAgainstJSONSchema(): ${L}`),
"throw"===O.failPolicy)))throw H=G.map(Q=>new n("sceneservice:schema-validation",Q)).concat(H),new n("sceneservice-validate:error","Failed to save layer item due to schema validation, see `details.errors`.",{combined:H});if(0<H.length)throw new n("sceneservice:save","Failed to save SceneService due to unsupported or invalid content. See 'details.errors' for more detailed information",{errors:H});});return function(G,H,L){return I.apply(this,arguments)}}();c._createClass(N,[{key:"url",set:function(I){I=
B.sanitizeUrlWithLayerId({layer:this,url:I,nonStandardUrlAllowed:!1,logger:F});this._set("url",I.url);null!=I.layerId&&this._set("layerId",I.layerId)}},{key:"parsedUrl",get:function(){var I=this._get("url");I=f.urlToObject(I);null!=this.layerId&&(I.path=`${I.path}/layers/${this.layerId}`);return I}}]);return N}(J);b.__decorate([e.property(A.id)],J.prototype,"id",void 0);b.__decorate([e.property({type:C})],J.prototype,"spatialReference",void 0);b.__decorate([l.reader("spatialReference",["spatialReference",
"store.indexCRS","store.geographicCRS"])],J.prototype,"readSpatialReference",null);b.__decorate([e.property({type:p})],J.prototype,"fullExtent",void 0);b.__decorate([l.reader("fullExtent",["fullExtent","store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],J.prototype,"readFullExtent",null);b.__decorate([e.property({readOnly:!0,type:z})],J.prototype,"heightModelInfo",void 0);b.__decorate([e.property({type:Number,json:{name:"layerDefinition.minScale",write:!0,origins:{service:{read:{source:"minScale"},
write:!1}}}})],J.prototype,"minScale",void 0);b.__decorate([e.property({type:Number,json:{name:"layerDefinition.maxScale",write:!0,origins:{service:{read:{source:"maxScale"},write:!1}}}})],J.prototype,"maxScale",void 0);b.__decorate([e.property({readOnly:!0})],J.prototype,"version",void 0);b.__decorate([l.reader("version",["store.version"])],J.prototype,"readVersion",null);b.__decorate([e.property({type:String,json:{read:{source:"copyrightText"}}})],J.prototype,"copyright",void 0);b.__decorate([e.property({type:String,
json:{read:!1}})],J.prototype,"sublayerTitleMode",void 0);b.__decorate([e.property({type:String})],J.prototype,"title",void 0);b.__decorate([l.reader("portal-item","title")],J.prototype,"readTitlePortalItem",null);b.__decorate([l.reader("service","title",["name"])],J.prototype,"readTitleService",null);b.__decorate([e.property({type:Number,json:{origins:{service:{read:{source:"id"}},"portal-item":{write:{target:"id",isRequired:!0,ignoreOrigin:!0},read:!1}}}})],J.prototype,"layerId",void 0);b.__decorate([e.property(A.url)],
J.prototype,"url",null);b.__decorate([q.writer("url")],J.prototype,"writeUrl",null);b.__decorate([e.property()],J.prototype,"parsedUrl",null);b.__decorate([e.property({readOnly:!0})],J.prototype,"store",void 0);b.__decorate([e.property({type:String,readOnly:!0,json:{read:{source:"store.rootNode"}}})],J.prototype,"rootNode",void 0);return J=b.__decorate([v.subclass("esri.layers.mixins.SceneService")],J)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/accessorSupport/originUtils":function(){define(["exports",
"../multiOriginJSONSupportUtils"],function(a,c){a.updateOrigins=function(b){b&&b.writtenProperties&&b.writtenProperties.forEach(({target:t,propName:n,newOrigin:r})=>{c.isMultiOriginJSONMixin(t)&&r&&t.originOf(n)!==r&&t.updateOrigin(n,r)})};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],function(a){a.isMultiOriginJSONMixin=function(c){return c&&"getAtOrigin"in c&&"originOf"in c};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/layers/support/I3SIndexInfo":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../core/Error","../../core/maybe"],function(a,c,b,t,n){function r(){r=c._asyncToGenerator(function*(m,d,f,e,g,h){var l=null;if(n.isSome(f)){l=`${m}/nodepages/`;const v=l+Math.floor(f.rootIndex/f.nodesPerPage);try{return{type:"page",rootPage:(yield b(v,{query:{f:"json",token:e},responseType:"json",signal:h})).data,rootIndex:f.rootIndex,pageSize:f.nodesPerPage,
lodMetric:f.lodSelectionMetricType,urlPrefix:l}}catch(q){n.isSome(g)&&g.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",v,q),l=q}}if(!d)return null;d=d&&d.split("/").pop();m=`${m}/nodes/`;d=m+d;try{return{type:"node",rootNode:(yield b(d,{query:{f:"json",token:e},responseType:"json",signal:h})).data,urlPrefix:m}}catch(v){throw new t("sceneservice:root-node-missing","Root node missing.",{pageError:l,nodeError:v,url:d});}});return r.apply(this,arguments)}a.fetchIndexInfo=
function(m,d,f,e,g,h){return r.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/schemaValidatorLoader":function(){define(["exports"],function(a){let c=null;a.getLoader=function(){return c};a.registerLoader=function(b){c=b};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/asyncUtils ../../core/Error ../../core/maybe ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(a,c,b,t,n,r,m,d){function f(){f=c._asyncToGenerator(function*(v,q,k){if(q&&q.resources){var p=q.portalItem===v.portalItem?new Set(v.paths):new Set;v.paths.length=0;v.portalItem=q.portalItem;var z=new Set(q.resources.toKeep.map(A=>A.resource.path)),C=new Set,B=[];z.forEach(A=>{p.delete(A);v.paths.push(A)});for(const A of q.resources.toUpdate)if(p.delete(A.resource.path),z.has(A.resource.path)||C.has(A.resource.path)){const {resource:x,content:u,finish:y,error:w}=A,D=d.getSiblingOfSameTypeI(x,
m.generateUUID());v.paths.push(D.path);B.push(e({resource:D,content:u,compress:A.compress,finish:y,error:w},k))}else v.paths.push(A.resource.path),B.push(h(A,k)),C.add(A.resource.path);for(const A of q.resources.toAdd)B.push(e(A,k)),v.paths.push(A.resource.path);p.forEach(A=>{q.portalItem&&(A=q.portalItem.resourceFromPath(A),B.push(A.portalItem.removeResource(A).catch(()=>{})))});if(0!==B.length&&(z=yield r.eachAlways(B),r.throwIfAborted(k),k=z.filter(A=>"error"in A).map(A=>A.error),0<k.length))throw new t("save:resources",
"Failed to save one or more resources",{errors:k});}});return f.apply(this,arguments)}function e(v,q){return g.apply(this,arguments)}function g(){g=c._asyncToGenerator(function*(v,q){q={...(n.isSome(q)?q:{}),compress:v.compress};q=yield b.result(v.resource.portalItem.addResource(v.resource,v.content,q));if(!0===q.ok)v.finish?.(v.resource);else throw v.error?.(q.error),q.error;});return g.apply(this,arguments)}function h(v,q){return l.apply(this,arguments)}function l(){l=c._asyncToGenerator(function*(v,
q){q=yield b.result(v.resource.update(v.content,q));if(!0===q.ok)v.finish?.(v.resource);else throw v.error?.(q.error),q.error;});return l.apply(this,arguments)}a.saveResources=function(v,q,k){return f.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/Error ../../core/maybe ../../core/urlUtils".split(" "),function(a,c,b,t,n,r){function m(){m=
c._asyncToGenerator(function*(q,k={},p){yield q.load(p);var z=r.join(q.itemUrl,"resources");const {start:C=1,num:B=10,sortOrder:A="asc",sortField:x="created"}=k;k={query:{start:C,num:B,sortOrder:A,sortField:x,token:q.apiKey},signal:n.get(p,"signal")};z=yield q.portal.request(z,k);return{total:z.total,nextStart:z.nextStart,resources:z.resources.map(({created:u,size:y,resource:w})=>({created:new Date(u),size:y,resource:q.resourceFromPath(w)}))}});return m.apply(this,arguments)}function d(){d=c._asyncToGenerator(function*(q,
k,p,z){if(!q.hasPath())throw new t(`portal-item-resource-${k}:invalid-path`,"Resource does not have a valid path");const C=q.portalItem;yield C.load(z);k=r.join(C.userItemUrl,"add"===k?"addResources":"updateResources");const [B,A]=g(q.path);p=yield l(p);const x=new FormData;B&&"."!==B&&x.append("resourcesPrefix",B);n.isSome(z)&&z.compress&&x.append("compress","true");x.append("fileName",A);x.append("file",p,A);x.append("f","json");n.isSome(z)&&z.access&&x.append("access",z.access);yield C.portal.request(k,
{method:"post",body:x,signal:n.get(z,"signal")});return q});return d.apply(this,arguments)}function f(){f=c._asyncToGenerator(function*(q,k,p){if(!k.hasPath())throw new t("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield q.load(p);const z=r.join(q.userItemUrl,"removeResources");yield q.portal.request(z,{method:"post",query:{resource:k.path},signal:n.get(p,"signal")});k.portalItem=null});return f.apply(this,arguments)}function e(){e=c._asyncToGenerator(function*(q,
k){yield q.load(k);const p=r.join(q.userItemUrl,"removeResources");return q.portal.request(p,{method:"post",query:{deleteAll:!0},signal:n.get(k,"signal")})});return e.apply(this,arguments)}function g(q){const k=q.lastIndexOf("/");return-1===k?[".",q]:[q.slice(0,k),q.slice(k+1)]}function h(q){{const B=r.getPathExtension(q);q=n.isNone(B)?[q,""]:[q.slice(0,q.length-B.length-1),`.${B}`]}const [k,p]=q,[z,C]=g(k);return[z,C,p]}function l(q){return v.apply(this,arguments)}function v(){v=c._asyncToGenerator(function*(q){return q instanceof
Blob?q:(yield b(q.url,{responseType:"blob"})).data});return v.apply(this,arguments)}a.addOrUpdateResource=function(q,k,p,z){return d.apply(this,arguments)};a.contentToBlob=l;a.fetchResources=function(q){return m.apply(this,arguments)};a.getSiblingOfSameType=function(q,k){if(!q.hasPath())return null;const [p,,z]=h(q.path);return q.portalItem.resourceFromPath(r.join(p,k+z))};a.getSiblingOfSameTypeI=function(q,k){if(!q.hasPath())return null;const [p,,z]=h(q.path);return q.portalItem.resourceFromPath(r.join(p,
k+z))};a.removeAllResources=function(q,k){return e.apply(this,arguments)};a.removeResource=function(q,k,p){return f.apply(this,arguments)};a.splitPrefixFileNameAndExtension=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/capabilities":function(){define(["exports"],function(a){a.zeroCapabilities={analytics:{supportsCacheHint:!1},attachment:{supportsContentType:!1,supportsExifInfo:!1,supportsKeywords:!1,supportsName:!1,supportsSize:!1,supportsCacheHint:!1,supportsResize:!1},
data:{isVersioned:!1,supportsAttachment:!1,supportsM:!1,supportsZ:!1},editing:{supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsReturnServiceEditsInSourceSpatialReference:!1,supportsRollbackOnFailure:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1},metadata:{supportsAdvancedFieldProperties:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsAdd:!1,
supportsDelete:!1,supportsEditing:!1,supportsChangeTracking:!1,supportsQuery:!1,supportsQueryAnalytics:!1,supportsQueryAttachments:!1,supportsQueryTopFeatures:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsUpdate:!1,supportsExceedsLimitStatistics:!1},queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1,supportsCacheHint:!1},queryTopFeatures:{supportsCacheHint:!1},query:{maxRecordCount:0,maxRecordCountFactor:0,standardMaxRecordCount:0,supportsCacheHint:!1,supportsCentroid:!1,
supportsCompactGeometry:!1,supportsDefaultSpatialReference:!1,supportsFullTextSearch:!1,supportsDisjointSpatialRelationship:!1,supportsDistance:!1,supportsDistinct:!1,supportsExtent:!1,supportsFormatPBF:!1,supportsGeometryProperties:!1,supportsHavingClause:!1,supportsHistoricMoment:!1,supportsMaxRecordCountFactor:!1,supportsOrderBy:!1,supportsPagination:!1,supportsPercentileStatistics:!1,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryByOthers:!1,supportsQueryGeometry:!1,supportsResultType:!1,
supportsSqlExpression:!1,supportsStandardizedQueriesOnly:!1,supportsTopFeaturesQuery:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsStatistics:!1,tileMaxRecordCount:0}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/FetchAssociatedFeatureLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../kernel ../../request ../../core/maybe ../../core/promiseUtils ../FeatureLayer ../../portal/Portal ../../portal/PortalItem".split(" "),
function(a,c,b,t,n,r,m,d,f){let e=function(){function g(l,v,q,k){this._parsedUrl=l;this._portalItem=v;this._apiKey=q;this.signal=k;this._rootDocument=null;if(l=this._parsedUrl?.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i))this._urlParts={root:l[1],layerId:parseInt(l[2],10)}}var h=g.prototype;h.fetch=function(){var l=c._asyncToGenerator(function*(){if(!this._urlParts)return null;var v=this._portalItem??(yield this._portalItemFromServiceItemId());if(n.isNone(v))return this._loadFromUrl();
v=yield this._findAndLoadRelatedPortalItem(v);return n.isNone(v)?null:this._loadFeatureLayerFromPortalItem(v)});return function(){return l.apply(this,arguments)}}();h.fetchPortalItem=function(){var l=c._asyncToGenerator(function*(){if(!this._urlParts)return null;const v=this._portalItem??(yield this._portalItemFromServiceItemId());return n.isNone(v)?null:this._findAndLoadRelatedPortalItem(v)});return function(){return l.apply(this,arguments)}}();h._fetchRootDocument=function(){var l=c._asyncToGenerator(function*(){if(n.isSome(this._rootDocument))return this._rootDocument;
if(n.isNone(this._urlParts))return this._rootDocument={},{};const v={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},q=`${this._urlParts.root}/SceneServer`;try{this._rootDocument=(yield t(q,v)).data}catch{this._rootDocument={}}return this._rootDocument});return function(){return l.apply(this,arguments)}}();h._fetchServiceOwningPortalUrl=function(){var l=c._asyncToGenerator(function*(){var v=this._parsedUrl?.path;const q=v?b.id?.findServerInfo(v):null;if(q?.owningSystemUrl)return q.owningSystemUrl;
v=v?v.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null;try{const k=(yield t(v,{query:{f:"json"},responseType:"json",signal:this.signal})).data.owningSystemUrl;if(k)return k}catch(k){r.throwIfAbortError(k)}return null});return function(){return l.apply(this,arguments)}}();h._findAndLoadRelatedPortalItem=function(){var l=c._asyncToGenerator(function*(v){try{return(yield v.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal})).find(q=>"Feature Service"===q.type)||
null}catch(q){return r.throwIfAbortError(q),null}});return function(v){return l.apply(this,arguments)}}();h._loadFeatureLayerFromPortalItem=function(){var l=c._asyncToGenerator(function*(v){yield v.load({signal:this.signal});const q=yield this._findMatchingAssociatedSublayerUrl(v.url??"");return(new m({url:q,portalItem:v})).load({signal:this.signal})});return function(v){return l.apply(this,arguments)}}();h._loadFromUrl=function(){var l=c._asyncToGenerator(function*(){const v=yield this._findMatchingAssociatedSublayerUrl(`${this._urlParts?.root}/FeatureServer`);
return(new m({url:v})).load({signal:this.signal})});return function(){return l.apply(this,arguments)}}();h._findMatchingAssociatedSublayerUrl=function(){var l=c._asyncToGenerator(function*(v){v=v.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");var q={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal};const k=this._urlParts?.layerId;var p=this._fetchRootDocument();q=t(v,q);const [z,C]=yield Promise.all([q,p]);p=C&&C.layers;q=z.data&&z.data.layers;if(!Array.isArray(q))throw Error("expected layers array");
if(!Array.isArray(p)){if(null!=k&&k<q.length)return`${v}/${q[k].id}`}else for(let B=0;B<Math.min(p.length,q.length);B++)if(p[B].id===k)return`${v}/${q[B].id}`;throw Error("could not find matching associated sublayer");});return function(v){return l.apply(this,arguments)}}();h._portalItemFromServiceItemId=function(){var l=c._asyncToGenerator(function*(){var v=(yield this._fetchRootDocument()).serviceItemId;if(!v)return null;v=new f({id:v,apiKey:this._apiKey});const q=yield this._fetchServiceOwningPortalUrl();
n.isSome(q)&&(v.portal=new d({url:q}));try{return v.load({signal:this.signal})}catch(k){return r.throwIfAbortError(k),null}});return function(){return l.apply(this,arguments)}}();return g}();a.FetchAssociatedFeatureLayer=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/I3SLayerDefinitions":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d,f){a.I3SNodePageDefinition=function(e){function g(){var h=e.apply(this,arguments)||this;h.nodesPerPage=null;h.rootIndex=0;h.lodSelectionMetricType=null;return h}c._inheritsLoose(g,e);return g}(t.JSONSupport);b.__decorate([n.property({type:Number})],a.I3SNodePageDefinition.prototype,"nodesPerPage",void 0);b.__decorate([n.property({type:Number})],a.I3SNodePageDefinition.prototype,"rootIndex",void 0);b.__decorate([n.property({type:String})],a.I3SNodePageDefinition.prototype,
"lodSelectionMetricType",void 0);a.I3SNodePageDefinition=b.__decorate([f.subclass("esri.layer.support.I3SNodePageDefinition")],a.I3SNodePageDefinition);a.I3SMaterialTexture=function(e){function g(){var h=e.apply(this,arguments)||this;h.factor=1;return h}c._inheritsLoose(g,e);return g}(t.JSONSupport);b.__decorate([n.property({type:Number,json:{read:{source:"textureSetDefinitionId"}}})],a.I3SMaterialTexture.prototype,"id",void 0);b.__decorate([n.property({type:Number})],a.I3SMaterialTexture.prototype,
"factor",void 0);a.I3SMaterialTexture=b.__decorate([f.subclass("esri.layer.support.I3SMaterialTexture")],a.I3SMaterialTexture);a.I3SMaterialPBRMetallicRoughness=function(e){function g(){var h=e.apply(this,arguments)||this;h.baseColorFactor=[1,1,1,1];h.baseColorTexture=null;h.metallicRoughnessTexture=null;h.metallicFactor=1;h.roughnessFactor=1;return h}c._inheritsLoose(g,e);return g}(t.JSONSupport);b.__decorate([n.property({type:[Number]})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorFactor",
void 0);b.__decorate([n.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"baseColorTexture",void 0);b.__decorate([n.property({type:a.I3SMaterialTexture})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicRoughnessTexture",void 0);b.__decorate([n.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"metallicFactor",void 0);b.__decorate([n.property({type:Number})],a.I3SMaterialPBRMetallicRoughness.prototype,"roughnessFactor",void 0);a.I3SMaterialPBRMetallicRoughness=
b.__decorate([f.subclass("esri.layer.support.I3SMaterialPBRMetallicRoughness")],a.I3SMaterialPBRMetallicRoughness);a.I3SMaterialDefinition=function(e){function g(){var h=e.apply(this,arguments)||this;h.alphaMode="opaque";h.alphaCutoff=.25;h.doubleSided=!1;h.cullFace="none";h.normalTexture=null;h.occlusionTexture=null;h.emissiveTexture=null;h.emissiveFactor=null;h.pbrMetallicRoughness=null;return h}c._inheritsLoose(g,e);return g}(t.JSONSupport);b.__decorate([d.enumeration({opaque:"opaque",mask:"mask",
blend:"blend"})],a.I3SMaterialDefinition.prototype,"alphaMode",void 0);b.__decorate([n.property({type:Number})],a.I3SMaterialDefinition.prototype,"alphaCutoff",void 0);b.__decorate([n.property({type:Boolean})],a.I3SMaterialDefinition.prototype,"doubleSided",void 0);b.__decorate([d.enumeration({none:"none",back:"back",front:"front"})],a.I3SMaterialDefinition.prototype,"cullFace",void 0);b.__decorate([n.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"normalTexture",void 0);
b.__decorate([n.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"occlusionTexture",void 0);b.__decorate([n.property({type:a.I3SMaterialTexture})],a.I3SMaterialDefinition.prototype,"emissiveTexture",void 0);b.__decorate([n.property({type:[Number]})],a.I3SMaterialDefinition.prototype,"emissiveFactor",void 0);b.__decorate([n.property({type:a.I3SMaterialPBRMetallicRoughness})],a.I3SMaterialDefinition.prototype,"pbrMetallicRoughness",void 0);a.I3SMaterialDefinition=b.__decorate([f.subclass("esri.layer.support.I3SMaterialDefinition")],
a.I3SMaterialDefinition);a.I3STextureFormat=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);return g}(t.JSONSupport);b.__decorate([n.property({type:String,json:{read:{source:["name","index"],reader:(e,g)=>null!=e?e:`${g.index}`}}})],a.I3STextureFormat.prototype,"name",void 0);b.__decorate([d.enumeration({jpg:"jpg",png:"png",dds:"dds","ktx-etc2":"ktx-etc2",ktx2:"ktx2",basis:"basis"})],a.I3STextureFormat.prototype,"format",void 0);a.I3STextureFormat=b.__decorate([f.subclass("esri.layer.support.I3STextureFormat")],
a.I3STextureFormat);a.I3STextureSetDefinition=function(e){function g(){var h=e.apply(this,arguments)||this;h.atlas=!1;return h}c._inheritsLoose(g,e);return g}(t.JSONSupport);b.__decorate([n.property({type:[a.I3STextureFormat]})],a.I3STextureSetDefinition.prototype,"formats",void 0);b.__decorate([n.property({type:Boolean})],a.I3STextureSetDefinition.prototype,"atlas",void 0);a.I3STextureSetDefinition=b.__decorate([f.subclass("esri.layer.support.I3STextureSetDefinition")],a.I3STextureSetDefinition);
a.I3SGeometryAttribute=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);return g}(t.JSONSupport);b.__decorate([d.enumeration({Float32:"Float32",UInt64:"UInt64",UInt32:"UInt32",UInt16:"UInt16",UInt8:"UInt8"})],a.I3SGeometryAttribute.prototype,"type",void 0);b.__decorate([n.property({type:Number})],a.I3SGeometryAttribute.prototype,"component",void 0);a.I3SGeometryAttribute=b.__decorate([f.subclass("esri.layer.support.I3SGeometryAttribute")],a.I3SGeometryAttribute);
a.I3SGeometryCompressedAttributes=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);return g}(t.JSONSupport);b.__decorate([d.enumeration({draco:"draco"})],a.I3SGeometryCompressedAttributes.prototype,"encoding",void 0);b.__decorate([n.property({type:[String]})],a.I3SGeometryCompressedAttributes.prototype,"attributes",void 0);a.I3SGeometryCompressedAttributes=b.__decorate([f.subclass("esri.layer.support.I3SGeometryCompressedAttributes")],a.I3SGeometryCompressedAttributes);
a.I3SGeometryBuffer=function(e){function g(){var h=e.apply(this,arguments)||this;h.offset=0;return h}c._inheritsLoose(g,e);return g}(t.JSONSupport);b.__decorate([n.property({type:Number})],a.I3SGeometryBuffer.prototype,"offset",void 0);b.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"position",void 0);b.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"normal",void 0);b.__decorate([n.property({type:a.I3SGeometryAttribute})],
a.I3SGeometryBuffer.prototype,"uv0",void 0);b.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"color",void 0);b.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"uvRegion",void 0);b.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"featureId",void 0);b.__decorate([n.property({type:a.I3SGeometryAttribute})],a.I3SGeometryBuffer.prototype,"faceRange",void 0);b.__decorate([n.property({type:a.I3SGeometryCompressedAttributes})],
a.I3SGeometryBuffer.prototype,"compressedAttributes",void 0);a.I3SGeometryBuffer=b.__decorate([f.subclass("esri.layer.support.I3SGeometryBuffer")],a.I3SGeometryBuffer);a.I3SGeometryDefinition=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);return g}(t.JSONSupport);b.__decorate([d.enumeration({triangle:"triangle"})],a.I3SGeometryDefinition.prototype,"topology",void 0);b.__decorate([n.property()],a.I3SGeometryDefinition.prototype,"geometryBuffers",void 0);a.I3SGeometryDefinition=
b.__decorate([f.subclass("esri.layer.support.I3SGeometryDefinition")],a.I3SGeometryDefinition);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/RangeInfo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m,d){a.RangeInfo=
function(f){function e(){var g=f.apply(this,arguments)||this;g.name=null;g.field=null;g.currentRangeExtent=null;g.fullRangeExtent=null;g.type="rangeInfo";return g}c._inheritsLoose(e,f);return e}(t.JSONSupport);b.__decorate([n.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"name",void 0);b.__decorate([n.property({type:String,json:{read:!0,write:!0}})],a.RangeInfo.prototype,"field",void 0);b.__decorate([n.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,
"currentRangeExtent",void 0);b.__decorate([n.property({type:[Number],json:{read:!0,write:!0}})],a.RangeInfo.prototype,"fullRangeExtent",void 0);b.__decorate([n.property({type:["rangeInfo"],readOnly:!0,json:{read:!1,write:!0}})],a.RangeInfo.prototype,"type",void 0);a.RangeInfo=b.__decorate([d.subclass("esri.layers.support.RangeInfo")],a.RangeInfo);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/SceneFilter":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Handles ../../core/JSONSupport ../../core/lang ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/persistable ./PolygonCollection ../../chunks/persistableUrlUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){var k;n=k=function(p){function z(B){B=p.call(this,B)||this;B.spatialRelationship="disjoint";B.geometries=new v;B._geometriesSource=null;B._handles=new t;return B}a._inheritsLoose(z,p);var C=z.prototype;C.initialize=function(){this._handles.add(d.on(()=>this.geometries,"after-changes",()=>this.geometries=this.geometries,d.sync))};C.destroy=function(){this._handles.destroy()};C.readGeometries=function(B,A,x){this._geometriesSource={url:q.fromJSON(B,x),context:x}};
C.loadGeometries=function(){var B=a._asyncToGenerator(function*(A,x){if(!m.isNone(this._geometriesSource)){var {url:u,context:y}=this._geometriesSource;x=yield b(u,{responseType:"json",signal:m.get(x,"signal")});var w=A.toJSON();A=x.data.map(D=>({...D,spatialReference:w}));this.geometries=v.fromJSON(A,y);this._geometriesSource=null}});return function(A,x){return B.apply(this,arguments)}}();C.clone=function(){return new k({geometries:r.clone(this.geometries),spatialRelationship:this.spatialRelationship})};
return z}(n.JSONSupport);c.__decorate([f.property({type:["disjoint","contains"],nonNullable:!0,json:{write:!0}})],n.prototype,"spatialRelationship",void 0);c.__decorate([f.property({type:v,nonNullable:!0,json:{write:!0}}),l.persistable({origins:["web-scene","portal-item"],type:"resource",prefix:"geometries"})],n.prototype,"geometries",void 0);c.__decorate([g.reader(["web-scene","portal-item"],"geometries")],n.prototype,"readGeometries",null);return n=k=c.__decorate([h.subclass("esri.layers.support.SceneFilter")],
n)})},"esri/core/accessorSupport/decorators/persistable":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../multiOriginJSONSupportUtils ../../urlUtils ../../uuid ../metadata ../PropertyOrigin ./property ../../../portal/support/resourceExtension ../../../chunks/persistableUrlUtils".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){function h(C,B,A){const x=m.getPropertyMetadata(B,A);return{type:String,read:(u,y,w)=>{u=g.read(u,y,w);if(x.type===String)return u;if("function"===
typeof x.type)return new x.type({url:u})},write:{writer(u,y,w,D){if(D&&D.resources){var F=null==u?null:"string"===typeof u?u:u.url;F=g.toJSON(F,{...D,verifyItemRelativeUrls:D&&D.verifyItemRelativeUrls?{writtenUrls:D.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},g.MarkKeep.NO);var E=x.type!==String&&(!t.isMultiOriginJSONMixin(this)||D&&D.origin&&this.originIdOf(A)>d.nameToId(D.origin));u={object:this,propertyName:A,value:u,targetUrl:F,dest:y,targetPropertyName:w,context:D,params:C};if(D&&
D.portalItem&&F&&!n.isAbsolute(F))if(E){{const {context:K,targetUrl:J,params:M,value:N,dest:P,targetPropertyName:I}=u;K.portalItem&&(y=K.portalItem.resourceFromPath(J),w=k(N,J,K),D=e.getResourceContentExtension(w),F=n.getPathExtension(y.path),E=M?.compress??!1,D!==F?l(u):(K.resources&&q({...u,resource:y,content:w,compress:E,updates:K.resources.toUpdate}),P[I]=J))}}else v(u);else D&&D.portalItem&&(null==F||null!=g.itemIdFromResourceUrl(F)||n.isBlobProtocol(F)||E)?l(u):y[w]=F}else y[w]="string"===typeof u?
g.toJSON(u,D):u.write({},D)}}}}function l(C){const {targetUrl:B,params:A,value:x,context:u,dest:y,targetPropertyName:w}=C;if(u.portalItem){var D=g.prefixAndFilenameFromResourceUrl(B),F=D?.filename??r.generateUUID(),E=A?.prefix??D?.prefix;D=k(x,B,u);var K=n.join(E,F);F=`${K}.${e.getResourceContentExtension(D)}`;var J=u.portalItem.resourceFromPath(F);n.isBlobProtocol(B)&&u.resources&&u.resources.pendingOperations.push(p(B).then(M=>{J.path=`${K}.${e.getResourceContentExtension(M)}`;y[w]=J.itemRelativeUrl}).catch(()=>
{}));u.resources&&q({...C,resource:J,content:D,compress:A?.compress??!1,updates:u.resources.toAdd});y[w]=J.itemRelativeUrl}}function v({context:C,targetUrl:B,dest:A,targetPropertyName:x}){C.portalItem&&C.resources&&(C.resources.toKeep.push({resource:C.portalItem.resourceFromPath(B),compress:!1}),A[x]=B)}function q({object:C,propertyName:B,updates:A,resource:x,content:u,compress:y}){A.push({resource:x,content:u,compress:y,finish:w=>{"string"===typeof C[B]?C[B]=w.url:C[B].url=w.url}})}function k(C,
B,A){return"string"===typeof C?{url:B}:new Blob([JSON.stringify(C.toJSON(A))],{type:"application/json"})}function p(C){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(C){const B=(yield new Promise((A,x)=>a(["../../../request"],u=>A(Object.freeze(Object.defineProperty({__proto__:null,default:u},Symbol.toStringTag,{value:"Module"}))),x))).default;({data:C}=yield B(C,{responseType:"blob"}));return C});return z.apply(this,arguments)}c.persistable=function(C){const B=C?.origins??
[void 0];return(A,x)=>{a:if("resource"===C?.type)var u=h(C,A,x);else{switch(C?.type??"other"){case "other":u={read:!0,write:!0};break a;case "url":const {read:y,write:w}=g.persistableUrlUtils;u={read:y,write:w};break a}u=void 0}for(const y of B){const w=f.propertyJSONMeta(A,y,x);for(const D in u)w[D]=u[D]}}};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/portal/support/resourceExtension":function(){define(["exports","../../core/urlUtils"],function(a,c){const b={},t=b["text/plain"],
n={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(const r in n)b[n[r]]=r;a.getResourceContentExtension=function(r){r instanceof Blob?r=r.type:(r=c.getPathExtension(r.url),r=n[r]||"text/plain");return b[r]||t};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/PolygonCollection":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/Warning ../../core/Logger ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/Error ../../core/has ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection".split(" "),function(a,c,b,t,n,r,m,d,f,e,g,h,l){var v;b=v=function(q){function k(z){return q.call(this,z)||this}
a._inheritsLoose(k,q);var p=k.prototype;p.clone=function(){return new v(this.items.map(z=>z.clone()))};p.write=function(z,C){return this.toJSON(C)};p.toJSON=function(z){const C=z?.layer?.spatialReference;return C?this.toArray().map(B=>{if(!C.equals(B.spatialReference)){if(!l.canProjectWithoutEngine(B.spatialReference,C))return z&&z.messages&&z.messages.push(new n("scenefilter:unsupported","Scene filters with incompatible spatial references are not supported",{modification:this,spatialReference:z.layer.spatialReference,
context:z})),null;const A=new h;l.projectPolygon(B,A,C);B=A}B=B.toJSON(z);delete B.spatialReference;return B}).filter(B=>null!=B):(z?.messages&&z.messages.push(new n("scenefilter:unsupported","Writing Scene filters without context layer is not supported",{modification:this,spatialReference:z.layer.spatialReference,context:z})),this.toArray().map(B=>B.toJSON(z)))};k.fromJSON=function(z,C){const B=new v;z.forEach(A=>B.add(h.fromJSON(A,C)));return B};return k}(t.JSONSupportMixin(b.ofType(h)));return b=
v=c.__decorate([g.subclass("esri.layers.support.PolygonCollection")],b)})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf32 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/SpatialReference ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../rest/support/Query ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox ../../webgl-engine/lib/Attribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J){function M(ua){return ua?parseInt(ua.substring(ua.lastIndexOf("/")+1,ua.length),10):void 0}function N(ua,oa){var xa=oa[0],Ea=oa[1];oa=oa[3];const Ia=ua[0]-xa;xa-=ua[2];const Na=ua[1]-Ea;ua=Ea-ua[3];Ea=Math.max(Ia,xa,0);const Oa=Math.max(Na,ua,0);Ea=Ea*Ea+Oa*Oa;return Ea>oa*oa?a.MbsIntersectResult.OUTSIDE:0<Ea?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(Ia,xa,Na,ua)>oa?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}
function P(ua,oa,xa){const Ea=[],Ia=xa&&xa.missingFields;xa=xa&&xa.originalFields;for(const Na of ua){ua=Na.toLowerCase();let Oa=!1;for(const Ja of oa)if(ua===Ja.name.toLowerCase()){Ea.push(Ja.name);Oa=!0;xa&&xa.push(Na);break}!Oa&&Ia&&Ia.push(Na)}return Ea}function I(){I=c._asyncToGenerator(function*(ua,oa,xa,Ea,Ia){if(0===oa.length)return[];const Na=ua.attributeStorageInfo;if(m.isSome(ua.associatedLayer))try{return yield H(ua.associatedLayer,oa,xa,Ea)}catch(Oa){if(ua.associatedLayer.loaded)throw Oa;
}if(Na){oa=G(oa,xa,Ia);if(m.isNone(oa))throw new n("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const Oa=ua.parsedUrl.path;return(yield Promise.all(oa.map(Ja=>S(Oa,Na,Ja.node.resources.attributes,Ja.indices,Ea).then(Sa=>{for(let Ua=0;Ua<Ja.graphics.length;Ua++){const Za=Ja.graphics[Ua],ma=Sa[Ua];if(Za.attributes)for(const Ya in Za.attributes)Ya in ma||(ma[Ya]=Za.attributes[Ya]);Za.attributes=ma}return Ja.graphics})))).flat()}throw new n("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available");});return I.apply(this,arguments)}function G(ua,oa,xa){const Ea=new Map,Ia=[];xa=xa();for(const Ja of ua){var Na=Ja.attributes[oa];for(var Oa=0;Oa<xa.length;Oa++){ua=xa[Oa];const Sa=ua.featureIds.indexOf(Na);if(0<=Sa){Na=Ea.get(ua.node);Na||(Na={node:ua.node,indices:[],graphics:[]},Ia.push(Na),Ea.set(ua.node,Na));Na.indices.push(Sa);for(Na.graphics.push(Ja);0<Oa;Oa--)xa[Oa]=xa[Oa-1];xa[0]=ua;break}}}return Ia}function H(ua,oa,xa,
Ea){return L.apply(this,arguments)}function L(){L=c._asyncToGenerator(function*(ua,oa,xa,Ea){oa.sort((Oa,Ja)=>Oa.attributes[xa]-Ja.attributes[xa]);var Ia=oa.map(Oa=>Oa.attributes[xa]);const Na=[];Ea=P(Ea,ua.fields,{originalFields:Na});ua=yield O(ua,Ia,Ea);for(Ia=0;Ia<oa.length;Ia++){const Oa=oa[Ia],Ja=ua[Ia],Sa={};if(Oa.attributes)for(const Ua in Oa.attributes)Sa[Ua]=Oa.attributes[Ua];for(let Ua=0;Ua<Na.length;Ua++)Sa[Na[Ua]]=Ja[Ea[Ua]];Oa.attributes=Sa}return oa});return L.apply(this,arguments)}
function O(ua,oa,xa){var Ea=ua.capabilities.query.maxRecordCount;if(null!=Ea&&oa.length>Ea)return Ea=t.splitIntoChunks(oa,Ea),Promise.all(Ea.map(Ia=>O(ua,Ia,xa))).then(Ia=>Ia.flat());Ea=new y({objectIds:oa,outFields:xa,orderByFields:[ua.objectIdField]});return ua.queryFeatures(Ea).then(Ia=>{if(Ia&&Ia.features&&Ia.features.length===oa.length)return Ia.features.map(Na=>Na.attributes);throw new n("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function S(ua,
oa,xa,Ea,Ia){const Na=[];for(const Oa of oa)Oa&&Ia.includes(Oa.name)&&Na.push({url:`${ua}/nodes/${xa}/attributes/${Oa.key}/0`,storageInfo:Oa});return d.eachAlways(Na.map(Oa=>b(Oa.url,{responseType:"array-buffer"}).then(Ja=>w.readBinaryAttribute(Oa.storageInfo,Ja.data)))).then(Oa=>{const Ja=[];for(const Sa of Ea){const Ua={};for(let Za=0;Za<Oa.length;Za++){const ma=Oa[Za].value;null!=ma&&(Ua[Na[Za].storageInfo.name]=R(ma,Sa))}Ja.push(Ua)}return Ja})}function R(ua,oa){if(!ua)return null;oa=ua[oa];return f.isInt16Array(ua)?
-32768===oa?null:oa:f.isInt32Array(ua)?oa===ba?null:oa:oa!==oa?null:oa}function Q(ua){var oa=ua.store,xa=oa.indexCRS||oa.geographicCRS;if(oa=void 0===xa?oa.indexWKT:void 0)if(ua.spatialReference){if(oa!==ua.spatialReference.wkt)throw new n("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new n("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference","Found indeWKT in the scene layer store but no layer spatial reference",
{});xa=xa?new B(M(xa)):ua.spatialReference;return xa.equals(ua.spatialReference)?ua.spatialReference:xa}function V(ua){var oa=ua.store,xa=oa.vertexCRS||oa.projectedCRS;if(oa=void 0===xa?oa.vertexWKT:void 0)if(ua.spatialReference){if(oa!==ua.spatialReference.wkt)throw new n("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new n("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference",
"Found vertexWKT in the scene layer store but no layer spatial reference",{});xa=xa?new B(M(xa)):ua.spatialReference;return xa.equals(ua.spatialReference)?ua.spatialReference:xa}function aa(ua,oa,xa){if(!C.canProjectWithoutEngine(ua,oa))throw new n("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===xa&&!X(ua,oa))throw new n("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",
{});}function X(ua,oa){return ua.equals(oa)||ua.isWGS84&&oa.isWebMercator||ua.isWebMercator&&oa.isWGS84}function W(ua,oa,xa){const Ea=Q(ua);ua=V(ua);aa(Ea,oa,xa);aa(ua,oa,xa)}function T(ua,oa,xa,Ea,Ia=0){if(Ea===A.getSphericalPCPF(Ea))if(oa.isGeographic){var Na=z.getReferenceEllipsoid(oa);Ea=1+Math.max(0,Ia)/(Na.radius+ua.center[2]);k.set(xa.center,ua.center[0],ua.center[1],ua.center[2]+Ia);C.projectBuffer(xa.center,oa,0,xa.center,A.getSphericalPCPF(oa),0,1);v.copy(xa.quaternion,ua.quaternion);v.conjugate(ka,
ua.quaternion);k.set(wa,0,0,1);k.transformQuat(wa,wa,ka);k.set(wa,ua.halfSize[0]*Math.abs(wa[0]),ua.halfSize[1]*Math.abs(wa[1]),ua.halfSize[2]*Math.abs(wa[2]));k.scale(wa,wa,Na.inverseFlattening);k.add(xa.halfSize,ua.halfSize,wa);k.scale(xa.halfSize,xa.halfSize,Ea)}else{K.corners(ua,la);k.set(xa.center,ua.center[0],ua.center[1],ua.center[2]+Ia);C.computeTranslationToOriginAndRotation(oa,xa.center,fa,A.getSphericalPCPF(oa));k.set(xa.center,fa[12],fa[13],fa[14]);Ea=2*Math.sqrt(1+fa[0]+fa[5]+fa[10]);
ka[0]=(fa[6]-fa[9])/Ea;ka[1]=(fa[8]-fa[2])/Ea;ka[2]=(fa[1]-fa[4])/Ea;ka[3]=.25*Ea;v.multiply(xa.quaternion,ka,ua.quaternion);v.conjugate(ka,xa.quaternion);let Oa=Ea=ua=0;for(Na of la)Na[2]+=Ia,C.projectBuffer(Na,oa,0,Na,A.getSphericalPCPF(oa),0,1),k.sub(wa,Na,xa.center),k.transformQuat(wa,wa,ka),ua=Math.max(ua,Math.abs(wa[0])),Ea=Math.max(Ea,Math.abs(wa[1])),Oa=Math.max(Oa,Math.abs(wa[2]));k.set(xa.halfSize,ua,Ea,Oa)}else oa.isWGS84&&(Ea.isWebMercator||u.isPlateCarree(Ea))?(k.copy(Z,ua.center),Z[2]+=
Ia,Ia=A.getSphericalPCPF(Ea),C.projectBuffer(Z,oa,0,Z,Ia,0,1),U(Ia,ua,Z,Ea,xa)):oa.isWebMercator&&u.isPlateCarree(Ea)?(k.copy(Z,ua.center),Z[2]+=Ia,U(oa,ua,Z,Ea,xa)):ua===xa?(xa.center[2]+=Ia,C.projectBuffer(xa.center,oa,0,xa.center,Ea,0,1)):(k.set(xa.center,ua.center[0],ua.center[1],ua.center[2]+Ia),C.projectBuffer(xa.center,oa,0,xa.center,Ea,0,1),v.copy(xa.quaternion,ua.quaternion),k.copy(xa.halfSize,ua.halfSize))}function U(ua,oa,xa,Ea,Ia){const Na=e.fromQuat(ha,oa.quaternion);for(let Ja=0;8>Ja;++Ja){for(var Oa=
0;3>Oa;++Oa)ia[Oa]=oa.halfSize[Oa]*(0!==(Ja&1<<Oa)?-1:1);for(Oa=0;3>Oa;++Oa){let Sa=xa[Oa];for(let Ua=0;3>Ua;++Ua)Sa+=ia[Ua]*Na[3*Ua+Oa];ca[3*Ja+Oa]=Sa}}C.projectBuffer(ca,ua,0,ca,Ea,0,8);K.compute(ja,Ia)}const Y=x.create();a.MbsIntersectResult=void 0;(function(ua){ua[ua.OUTSIDE=0]="OUTSIDE";ua[ua.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE";ua[ua.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";ua[ua.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const ba=
-(2**31),da=F.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let ea=function(){this.material=this.edgeMaterial=null;this.castShadows=!0};const ca=Array(24),ja=new J.Attribute(ca,3,!0),ia=p.create(),Z=p.create(),ha=g.create(),fa=l.create(),ka=q.create(),la=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],na=x.create(),pa=x.create(),va=K.create(),wa=p.create(),za={data:Array(72),size:3,exclusive:!0,stride:3},sa=l.create();a.SymbolInfo=ea;a.addWraparound=function(ua,oa){return(ua|
0)+(oa|0)|0};a.checkPointCloudLayerCompatibleWithView=function(ua,oa){aa(ua.spatialReference,oa.spatialReference,oa.viewingMode)};a.checkPointCloudLayerValid=function(ua){var oa;(oa=null==ua.store||null==ua.store.defaultGeometrySchema)||(ua=ua.store.defaultGeometrySchema,oa=!!(null==ua.geometryType||"points"!==ua.geometryType||null!=ua.topology&&"PerAttributeArray"!==ua.topology||null!=ua.encoding&&""!==ua.encoding&&"lepcc-xyz"!==ua.encoding||null==ua.vertexAttributes||null==ua.vertexAttributes.position));
if(oa)throw new n("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkRecyclable=function(ua,oa,xa){if(ua.serviceUpdateTimeStamp?.lastUpdate!==oa.serviceUpdateTimeStamp?.lastUpdate||!xa.isEmpty||m.applySome(ua.associatedLayer,Ea=>Ea.url)!==m.applySome(oa.associatedLayer,Ea=>Ea.url))throw new n("layerview:recycle-failed");};a.checkSceneLayerCompatibleWithView=function(ua,oa){W(ua,oa.spatialReference,oa.viewingMode)};a.checkSceneLayerValid=
function(ua){var oa;(oa=null==ua.store||null==ua.store.defaultGeometrySchema)||(oa=ua.store.defaultGeometrySchema,oa=!!(null!=oa.geometryType&&"triangles"!==oa.geometryType||null!=oa.topology&&"PerAttributeArray"!==oa.topology||null==oa.vertexAttributes||null==oa.vertexAttributes.position));if(oa)throw new n("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:ua.parsedUrl.path});};a.checkSpatialReference=aa;a.checkSpatialReferences=W;a.computeVisibilityObb=
function(ua,oa,xa,Ea,Ia,Na){if(!Na||0===Na.length||m.isNone(oa)||!ua.mbs)return null;const Oa=D.computeGlobalTransformation(ua.mbs,Ia,xa,oa);h.invert(sa,Oa);let Ja=null;const Sa=()=>{if(!Ja)if(Ja=la,x.empty(pa),m.isSome(ua.serviceObb)){T(ua.serviceObb,xa,va,oa,Ia);K.corners(va,Ja);for(var Ya of Ja)k.transformMat4(Ya,Ya,sa),x.expandPointInPlace(pa,Ya)}else{var bb=ua.mbs;if(bb)for(Ya=bb[3],C.projectVectorToVector(bb,xa,wa,oa),k.transformMat4(wa,wa,sa),wa[2]+=Ia,bb=0;8>bb;++bb){const Qa=Ja[bb];k.copy(Qa,
[wa[0]+(bb&1?Ya:-Ya),wa[1]+(bb&2?Ya:-Ya),wa[2]+(bb&4?Ya:-Ya)]);x.expandPointInPlace(pa,Qa)}}};let Ua=Infinity,Za=-Infinity;const ma=Ya=>{if("replace"===Ya.type&&(Ya=Ya.geometry,Ya?.hasZ)){x.empty(na);var bb=Ya.spatialReference||Ea;Ya=Ya.rings.reduce((Qa,Aa)=>Aa.reduce((Ca,qa)=>{C.projectVectorToVector(qa,bb,wa,oa);k.transformMat4(wa,wa,sa);x.expandPointInPlace(na,wa);return Math.min(wa[2],Ca)},Qa),Infinity);Sa();x.intersects(pa,na)&&(Ua=Math.min(Ua,Ya),Za=Math.max(Za,Ya))}};Na.forEach(Ya=>ma(Ya));
if(Infinity===Ua)return null;Na=(Ya,bb,Qa)=>{k.transformMat4(wa,Qa,Oa);Ya[bb+0]=wa[0];Ya[bb+1]=wa[1];Ya[bb+2]=wa[2];bb+=24;Qa[2]=Ua;k.transformMat4(wa,Qa,Oa);Ya[bb+0]=wa[0];Ya[bb+1]=wa[1];Ya[bb+2]=wa[2];bb+=24;Qa[2]=Za;k.transformMat4(wa,Qa,Oa);Ya[bb+0]=wa[0];Ya[bb+1]=wa[1];Ya[bb+2]=wa[2]};for(let Ya=0;8>Ya;++Ya)Na(za.data,3*Ya,Ja[Ya]);return K.compute(za)};a.containsDraco=function(ua){if(r("disable-feature:i3s-draco")||!ua)return!1;for(const oa of ua)for(const xa of oa.geometryBuffers)if("draco"===
xa.compressedAttributes?.encoding)return!0;return!1};a.extractWkid=M;a.filterInPlace=function(ua,oa,xa){let Ea=0,Ia=0;for(let Na=0;Na<oa.length&&Ea<ua.length;Na++)ua[Ea]===oa[Na]&&(xa(Na)&&(ua[Ia]=ua[Ea],Ia++),Ea++);ua.length=Ia};a.findFieldsCaseInsensitive=P;a.findIntersectingNodes=function(ua,oa,xa,Ea){xa.traverse(oa,Ia=>{const Na=Ia.mbs;if((null!=Na&&N(ua,Na))===a.MbsIntersectResult.OUTSIDE)return!1;Ea(Ia);return!0})};a.getCacheKeySuffix=function(ua,oa){return m.isNone(oa)?"@null":oa===A.getSphericalPCPF(oa)?
"@ECEF":ua.equals(oa)?"":null!=oa.wkid?"@"+oa.wkid:null};a.getCachedAttributeValue=R;a.getClipRect=function(ua,oa){if(0===oa.rotationScale[1]&&0===oa.rotationScale[2]&&0===oa.rotationScale[3]&&0===oa.rotationScale[5]&&0===oa.rotationScale[6]&&0===oa.rotationScale[7])return Y[0]=(ua[0]-oa.position[0])/oa.rotationScale[0],Y[1]=(ua[1]-oa.position[1])/oa.rotationScale[4],Y[2]=(ua[2]-oa.position[0])/oa.rotationScale[0],Y[3]=(ua[3]-oa.position[1])/oa.rotationScale[4],Y};a.getIndexCrs=Q;a.getSymbolInfo=
function(ua){const oa=new ea;var xa=!1;let Ea=!1;for(const Na of ua.symbolLayers.items)if("fill"===Na.type&&Na.enabled){var Ia=Na.material;ua=Na.edges;m.isSome(Ia)&&!xa&&(xa=Ia.color,Ia=E.parseColorMixMode(Ia.colorMixMode),m.isSome(xa)?oa.material={color:[xa.r/255,xa.g/255,xa.b/255],alpha:xa.a,colorMixMode:Ia}:oa.material={color:[1,1,1],alpha:1,colorMixMode:E.ColorMixModeEnum.Multiply},oa.castShadows=Na.castShadows,xa=!0);m.isSome(ua)&&!Ea&&(oa.edgeMaterial=F.createMaterialFromEdges(ua,{}),Ea=!0)}oa.material||
(oa.material={color:[1,1,1],alpha:1,colorMixMode:E.ColorMixModeEnum.Multiply});return oa};a.getVertexCrs=V;a.intersectBoundingRectWithMbs=N;a.invalidateMbs=function(ua){m.isSome(ua)&&(ua[3]=-1)};a.invalidateObb=function(ua){m.isSome(ua)&&(ua.halfSize[0]=-1)};a.isSupportedLocalModeProjection=X;a.isValidMbs=function(ua){return 0<=ua[3]};a.isValidObb=function(ua){return m.isSome(ua)&&0<=ua.halfSize[0]};a.objectIdFilter=function(ua,oa,xa){let Ea=0,Ia=0;for(;Ea<xa.length;)0<=t.binaryIndexOf(ua,xa[Ea])===
oa&&(xa[Ia]=xa[Ea],Ia++),Ea++;xa.length=Ia};a.queryAttributesFromCachedAttributesId=S;a.rendererNeedsTextures=function(ua){if(null==ua||"simple"!==ua.type&&"class-breaks"!==ua.type&&"unique-value"!==ua.type||("unique-value"===ua.type||"class-breaks"===ua.type)&&null==ua.defaultSymbol)return!0;ua=ua.getSymbols();if(0===ua.length)return!0;for(const oa of ua){if("mesh-3d"!==oa.type||0===oa.symbolLayers.length)return!0;for(const xa of oa.symbolLayers.items)if("fill"!==xa.type||m.isNone(xa.material)||
m.isNone(xa.material.color)||"replace"!==xa.material.colorMixMode)return!0}return!1};a.transformObb=T;a.transparentEdgeMaterial=da;a.whenGraphicAttributes=function(ua,oa,xa,Ea,Ia){return I.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),function(a,c,b,t,n,r){function m(u,
y){const w={byteOffset:0,byteCount:0,fields:Object.create(null)};let D=0;for(let F=0;F<y.length;F++){const E=y[F],K=E.valueType||E.type;w.fields[E.property]=(0,x[K])(u,D);D+=A[K].BYTES_PER_ELEMENT}w.byteCount=D;return w}function d(u,y,w){return f(u,y,w).map(D=>(D=D?Date.parse(D):null)&&!Number.isNaN(D)?D:null)}function f(u,y,w){const D=[];let F,E=0,K;for(K=0;K<u;K+=1){F=y[K];if(0<F){var J=D,M=J.push,N=w,P=E,I=F-1;let H="",L=0;for(;L<I;){var G=N[P+L];if(128>G)H+=String.fromCharCode(G),L++;else if(192<=
G&&224>G){if(L+1>=I)throw new c("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");H+=String.fromCharCode((G&31)<<6|N[P+L+1]&63);L+=2}else if(224<=G&&240>G){if(L+2>=I)throw new c("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");H+=String.fromCharCode((G&15)<<12|(N[P+L+1]&63)<<6|N[P+L+2]&63);L+=3}else if(240<=G&&248>G){if(L+3>=I)throw new c("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");G=(G&7)<<18|(N[P+L+1]&
63)<<12|(N[P+L+2]&63)<<6|N[P+L+3]&63;H=65536<=G?H+String.fromCharCode((G-65536>>10)+55296,(G&1023)+56320):H+String.fromCharCode(G);L+=4}else throw new c("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}M.call(J,H);if(0!==w[E+F-1])throw new c("string-array-error","Invalid string array: missing null termination.");}else D.push(null);E+=F}return D}function e(u,y){return new A[y.valueType](u,y.byteOffset,y.count*y.valuesPerElement)}function g(u,y){return new Uint8Array(u,y.byteOffset,
y.byteCount)}function h(u,y,w){u=null!=y.header?m(u,y.header):{byteOffset:0,byteCount:0,fields:{count:w}};w={header:u,byteOffset:u.byteCount,byteCount:0,entries:Object.create(null)};let D=u.byteCount;for(let F=0;F<y.ordering.length;F++){const E=y.ordering[F],K=b.clone(y[E]);K.count=u.fields.count??0;if("String"===K.valueType){K.byteOffset=D;K.byteCount=u.fields[E+"ByteCount"];if("UTF-8"!==K.encoding)throw new c("unsupported-encoding","Unsupported String encoding.",{encoding:K.encoding});if(K.timeEncoding&&
"ECMA_ISO8601"!==K.timeEncoding)throw new c("unsupported-time-encoding","Unsupported time encoding.",{timeEncoding:K.timeEncoding});}else if(p(K.valueType)){const J=z(K.valueType);D+=0!==D%J?J-D%J:0;K.byteOffset=D;K.byteCount=J*K.valuesPerElement*K.count}else throw new c("unsupported-value-type","Unsupported binary valueType",{valueType:K.valueType});D+=K.byteCount??0;w.entries[E]=K}w.byteCount=D-w.byteOffset;return w}function l(u,y,w){y!==u&&C.error(`Invalid ${w} buffer size\n expected: ${u}, actual: ${y})`);
if(y<u)throw new c("buffer-too-small","Binary buffer is too small",{expectedSize:u,actualSize:y});}function v(u){return{isDraco:!1,isLegacy:!1,color:null!=u.color,normal:null!=u.normal,uv0:null!=u.uv0,uvRegion:null!=u.uvRegion,featureIndex:null!=u.faceRange&&null!=u.featureId}}function q(u){const y={isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const w of u.ordering)if(u.vertexAttributes[w])switch(w){case "normal":y.normal=!0;break;case "color":y.color=!0;break;
case "uv0":y.uv0=!0;break;case "region":y.uvRegion=!0}u.featureAttributes&&u.featureAttributeOrder&&(y.featureIndex=!0);return y}function k(u){const y={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const w of u)switch(w){case "normal":y.normal=!0;break;case "uv0":y.uv0=!0;break;case "color":y.color=!0;break;case "uv-region":y.uvRegion=!0;break;case "feature-index":y.featureIndex=!0}return y}function p(u){return A.hasOwnProperty(u)}function z(u){return p(u)?A[u].BYTES_PER_ELEMENT:
0}const C=t.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),B={position:r.VertexAttribute.POSITION,normal:r.VertexAttribute.NORMAL,color:r.VertexAttribute.COLOR,uv0:r.VertexAttribute.UV0,region:r.VertexAttribute.UVREGION},A={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},x={Float32:(u,y)=>(new DataView(u,0)).getFloat32(y,!0),Float64:(u,y)=>(new DataView(u,0)).getFloat64(y,!0),UInt8:(u,y)=>(new DataView(u,
0)).getUint8(y),Int8:(u,y)=>(new DataView(u,0)).getInt8(y),UInt16:(u,y)=>(new DataView(u,0)).getUint16(y,!0),Int16:(u,y)=>(new DataView(u,0)).getInt16(y,!0),UInt32:(u,y)=>(new DataView(u,0)).getUint32(y,!0),Int32:(u,y)=>(new DataView(u,0)).getInt32(y,!0)};a.createAttributeDataIndex=h;a.createGeometryDescriptor=function(u,y){return u&&u.compressedAttributes&&"draco"===u.compressedAttributes.encoding?k(u.compressedAttributes.attributes):u?v(u):q(y)};a.createGeometryDescriptorForDraco=k;a.createGeometryDescriptorFromDefinition=
v;a.createGeometryDescriptorFromSchema=q;a.createGeometryIndexFromSchema=function(u,y){var w=m(u,y&&y.header);let D=w.byteCount;const F={isDraco:!1,header:w,byteOffset:w.byteCount,byteCount:0,vertexAttributes:{}};w=w.fields;var E=null!=w.vertexCount?w.vertexCount:w.count;for(var K of y.ordering){if(!y.vertexAttributes[K])continue;const M={...y.vertexAttributes[K],byteOffset:D,count:E};F.vertexAttributes[B[K]?B[K]:"_"+K]=M;D+=z(M.valueType)*M.valuesPerElement*E}K=w.faceCount;if(y.faces&&K){F.faces=
{};for(var J of y.ordering)y.faces[J]&&(E={...y.faces[J],byteOffset:D,count:K},F.faces[J]=E,D+=z(E.valueType)*E.valuesPerElement*K)}J=w.featureCount;if(y.featureAttributes&&y.featureAttributeOrder&&J){F.featureAttributes={};for(const M of y.featureAttributeOrder)y.featureAttributes[M]&&(w={...y.featureAttributes[M],byteOffset:D,count:J},F.featureAttributes[M]=w,K="UInt64"===w.valueType?8:z(w.valueType),D+=K*w.valuesPerElement*J)}l(D,u.byteLength,"geometry");F.byteCount=D-F.byteOffset;return F};a.createRawView=
g;a.createTypedView=e;a.getBytesPerValue=z;a.isValueType=p;a.readBinaryAttribute=function(u,y,w){if("lepcc-rgb"===u.encoding)return n.decodeRGB(y);if("lepcc-intensity"===u.encoding)return n.decodeIntensity(y);if(null!=u.encoding&&""!==u.encoding)throw new c("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");u["attributeByteCounts "]&&!u.attributeByteCounts&&(C.warn("Warning: Trailing space in 'attributeByteCounts '."),u.attributeByteCounts=u["attributeByteCounts "]);
"ObjectIds"===u.ordering[0]&&u.hasOwnProperty("objectIds")&&(C.warn("Warning: Case error in objectIds"),u.ordering[0]="objectIds");w=h(y,u,w);l(w.byteOffset+w.byteCount,y.byteLength,"attribute");if(u=w.entries.attributeValues||w.entries.objectIds){if("String"===u.valueType){w=w.entries.attributeByteCounts;const D=e(y,w);y=g(y,u);return u.timeEncoding?d(w.count,D,y):f(w.count,D,y)}return e(y,u)}throw new c("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readDateStringArray=
d;a.readHeader=m;a.readStringArray=f;a.valueType2ArrayBufferReader=x;a.valueType2TypedArrayClassMap=A;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,c){function b(m,d,f){return{identifier:String.fromCharCode.apply(null,new Uint8Array(m,f+r.identifierOffset,r.identifierLength)),version:d.getUint16(f+r.versionOffset,!0),checksum:d.getUint32(f+r.checksumOffset,!0)}}function t(m,d,f){const e=
[];d=n(m,d,e);const g=[];for(let h=0;h<e.length;h++){g.length=0;d=n(m,d,g);for(let l=0;l<g.length;l++)f.push(g[l]+e[h])}return d}function n(m,d,f){var e=new DataView(m,d),g=e.getUint8(0);const h=g&31;var l=!!(g&32),v=(g&192)>>6;g=0;if(0===v)g=e.getUint32(1,!0),d+=5;else if(1===v)g=e.getUint16(1,!0),d+=3;else if(2===v)g=e.getUint8(1),d+=2;else throw new c("lepcc-decode-error","Bad count type");if(l)throw new c("lepcc-decode-error","LUT not implemented");m=new Uint8Array(m,d,Math.ceil(g*h/8));v=l=e=
0;const q=-1>>>32-h;for(let k=0;k<g;k++){for(;l<h;)e|=m[v]<<l,l+=8,v+=1;f[k]=e&q;e>>>=h;l-=h;32<l+h&&(e|=m[v-1]>>8-l)}return d+v}const r={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(m){const d=new DataView(m,0);var f=0;const {identifier:e,version:g}=b(m,d,f);f+=r.byteCount;if("Intensity "!==e)throw new c("lepcc-decode-error","Bad identifier");if(1<g)throw new c("lepcc-decode-error","Unknown version");var h=f;var l=d.getUint32(h+
0,!0);var v=d.getUint32(h+4,!0);var q=d.getUint32(h+8,!0);var k=d.getUint16(h+12,!0);var p=d.getUint8(h+14);d.getUint8(h+15);f+=16;if(v*2**32+l!==m.byteLength)throw new c("lepcc-decode-error","Bad size");l=new Uint16Array(q);if(8===p){if(q+f!==m.byteLength)throw new c("lepcc-decode-error","Bad size");m=new Uint8Array(m,f,q);for(f=0;f<q;f++)l[f]=m[f]*k}else if(16===p){if(2*q+f!==m.byteLength)throw new c("lepcc-decode-error","Bad size");m=new Uint16Array(m,f,q);for(f=0;f<q;f++)l[f]=m[f]*k}else{p=[];
if(n(m,f,p)!==m.byteLength)throw new c("lepcc-decode-error","Bad size");for(m=0;m<q;m++)l[m]=p[m]*k}return l};a.decodeRGB=function(m){var d=new DataView(m,0),f=0;const {identifier:e,version:g}=b(m,d,f);f+=r.byteCount;if("ClusterRGB"!==e)throw new c("lepcc-decode-error","Bad identifier");if(1<g)throw new c("lepcc-decode-error","Unknown version");var h=f;var l=d.getUint32(h+0,!0);var v=d.getUint32(h+4,!0);var q=d.getUint32(h+8,!0);var k=d.getUint16(h+12,!0);var p=d.getUint8(h+14);h=d.getUint8(h+15);
f+=16;if(v*2**32+l!==m.byteLength)throw new c("lepcc-decode-error","Bad size");if((2===p||1===p)&&0===h){if(3*k+q+f!==m.byteLength||256<k)throw new c("lepcc-decode-error","Bad count");d=new Uint8Array(m,f,3*k);f=new Uint8Array(m,f+3*k,q);m=new Uint8Array(3*q);for(k=0;k<q;k++)l=f[k],m[3*k]=d[3*l],m[3*k+1]=d[3*l+1],m[3*k+2]=d[3*l+2];return m}if(0===p&&0===h){if(3*q+f!==m.byteLength||0!==k)throw new c("lepcc-decode-error","Bad count");return(new Uint8Array(m,f)).slice()}if(2>=p&&1===h){if(f+3!==m.byteLength||
1!==k)throw new c("lepcc-decode-error","Bad count");m=d.getUint8(f);k=d.getUint8(f+1);f=d.getUint8(f+2);d=new Uint8Array(3*q);for(l=0;l<q;l++)d[3*l]=m,d[3*l+1]=k,d[3*l+2]=f;return d}throw new c("lepcc-decode-error","Bad method "+p+","+h);};a.decodeXYZ=function(m){var d=new DataView(m,0),f=0;const {identifier:e,version:g}=b(m,d,f);f+=r.byteCount;if("LEPCC     "!==e)throw new c("lepcc-decode-error","Bad identifier");if(1<g)throw new c("lepcc-decode-error","Unknown version");var h=f;var l=d.getUint32(h+
0,!0);var v=d.getUint32(h+4,!0);var q=d.getFloat64(h+8,!0);var k=d.getFloat64(h+16,!0);var p=d.getFloat64(h+24,!0);var z=d.getFloat64(h+32,!0);var C=d.getFloat64(h+40,!0);var B=d.getFloat64(h+48,!0);var A=d.getFloat64(h+56,!0);var x=d.getFloat64(h+64,!0);var u=d.getFloat64(h+72,!0);var y=d.getUint32(h+80,!0);d.getUint32(h+84,!0);f+=88;if(v*2**32+l!==m.byteLength)throw new c("lepcc-decode-error","Bad size");l=new Float64Array(3*y);v=[];y=[];d=[];h=[];f=t(m,f,v);f=t(m,f,y);f=t(m,f,d);f=t(m,f,h);if(f!==
m.byteLength)throw new c("lepcc-decode-error","Bad length");f=m=0;for(let w=0;w<v.length;w++){f+=v[w];let D=0;for(let F=0;F<y[w];F++){D+=d[m];const E=h[m];l[3*m]=Math.min(z,q+2*A*D);l[3*m+1]=Math.min(C,k+2*x*f);l[3*m+2]=Math.min(B,p+2*u*E);m++}}return{errorX:A,errorY:x,errorZ:u,result:l}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec3f64","../../../../geometry/ellipsoidUtils",
"../../../../geometry/projection"],function(a,c,b,t,n){function r(m,d,f){const e=b.create(),g=2**(4*Math.ceil(Math.log(m[3])*Math.LOG2E/4)+1);if(f.isGeographic){var h=g/t.getReferenceEllipsoid(f).radius*180/Math.PI;f=Math.max(-90,Math.min(90,Math.round(m[1]/h)*h));h/=Math.cos((Math.abs(f)-h/2)/180*Math.PI);e[0]=Math.round(m[0]/h)*h;e[1]=f}else f=Math.round(m[1]/g),e[0]=Math.round(m[0]/g)*g,e[1]=f*g;e[2]=Math.round((m[2]+d)/g)*g;return e}a.computeGlobalTransformation=function(m,d,f,e){m=r(m,d,f);d=
c.create();n.computeTranslationToOriginAndRotation(f,m,d,e);return d};a.getLocalOrigin=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(a,c,b,t){function n(){n=c._asyncToGenerator(function*(r,m=r.popupTemplate){if(b.isNone(m))return[];const d=yield m.getRequiredFields(r.fieldsIndex);({lastEditInfoEnabled:m}=
m);const {objectIdField:f,typeIdField:e,globalIdField:g,relationships:h}=r;if(d.includes("*"))return["*"];m=m?yield t.getFeatureEditFields(r):[];const l=t.fixFields(r.fieldsIndex,[...d,...m]);e&&l.push(e);l&&f&&r.fieldsIndex?.has(f)&&!l.includes(f)&&l.push(f);l&&g&&r.fieldsIndex?.has(g)&&!l.includes(g)&&l.push(g);h&&h.forEach(v=>{({keyField:v}=v);l&&v&&r.fieldsIndex?.has(v)&&!l.includes(v)&&l.push(v)});return l});return n.apply(this,arguments)}a.getFetchPopupTemplate=function(r,m){return r.popupTemplate?
r.popupTemplate:b.isSome(m)&&m.defaultPopupTemplateEnabled&&b.isSome(r.defaultPopupTemplate)?r.defaultPopupTemplate:null};a.getRequiredFields=function(r){return n.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./LayerView3D ./TiledLayerView3D ../../layers/LayerView".split(" "),
function(a,c,b,t,n,r,m,d,f,e){n=function(g){function h(){var l=g.apply(this,arguments)||this;l.type="elevation-3d";return l}a._inheritsLoose(h,g);h.prototype.initialize=function(){var l=this.view?.map?.allLayers;l=l&&l.includes(this.layer);var v=this.view?.map?.ground?.layers;v=v&&v.includes(this.layer);l&&!v&&(l=new b("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added to layers in map.ground"),this.addResolvingPromise(Promise.reject(l)));this._addTilingSchemeMatchPromise()};
a._createClass(h,[{key:"tileInfo",get:function(){return this.layer.tileInfo}}]);return h}(f.TiledLayerView3D(d.LayerView3D(e)));c.__decorate([t.property()],n.prototype,"layer",void 0);c.__decorate([t.property()],n.prototype,"tileInfo",null);return n=c.__decorate([m.subclass("esri.views.3d.layers.ElevationLayerView3D")],n)})},"esri/views/3d/layers/LayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/handleUtils ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/heightModelInfoUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){a.LayerView3D=h=>{h=function(l){function v(){var k=l.apply(this,arguments)||this;k.slicePlaneEnabled=!1;k.supportsHeightUnitConversion=!1;return k}c._inheritsLoose(v,l);var q=v.prototype;q.postscript=function(k){l.prototype.postscript.call(this,k);g.supportsHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};q._validateHeightModelInfo=function(){var k=c._asyncToGenerator(function*(){const p=new AbortController;var z=p.signal;this.handles.add(t.makeHandle(()=>
p.abort()));yield r.whenOnce(()=>this.view.defaultsFromMap?.heightModelInfoReady,z);n.throwIfAborted(z);if(z=g.rejectLayerError(this.layer,this.view.heightModelInfo,this.supportsHeightUnitConversion))throw z;});return function(){return k.apply(this,arguments)}}();q.canResume=function(){const k=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;return l.prototype.canResume.call(this)&&(!k||!k.minScale||!k.maxScale||k.minScale>=k.maxScale)};q.getSuspendInfo=function(){const k=
l.prototype.getSuspendInfo.call(this),p=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;p&&p.minScale&&p.maxScale&&p.minScale<p.maxScale&&(k.outsideScaleRange=!0);return k};return v}(h);b.__decorate([m.property()],h.prototype,"view",void 0);b.__decorate([m.property()],h.prototype,"slicePlaneEnabled",void 0);return h=b.__decorate([e.subclass("esri.views.3d.layers.LayerView3D")],h)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/TiledLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../support/updatingProperties ../terrain/terrainUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){a.TiledLayerView3D=l=>{l=function(v){function q(){return v.apply(this,arguments)||this}c._inheritsLoose(q,v);var k=q.prototype;k.getTileUrl=function(p,z,C){return this.layer.getTileUrl(p,z,C)};k._addTilingSchemeMatchPromise=function(){if(n.isNone(this.fullExtent))return this.addResolvingPromise(Promise.reject(new t("tilingscheme:extent-not-defined","This layer doesn't define a fullExtent.")));var p=this._getTileInfoSupportError(this.tileInfo,this.fullExtent);if(n.isSome(p))return this.addResolvingPromise(Promise.reject(p));
p=r.whenOnce(()=>this.view?.basemapTerrain?.tilingSchemeLocked).then(()=>{const z=this._getTileInfoCompatibilityError(this.tileInfo,this.view.basemapTerrain.tilingScheme);if(z)throw z;});this.addResolvingPromise(p)};k._getTileInfoSupportError=function(p,z){if(p=h.checkIfTileInfoSupportedForView(p,z,this.view.spatialReference,this.view.state.viewingMode)){z={layer:this.layer,error:p};switch(p.name){case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":case "tilingscheme:local-unsupported-spatial-reference":p=
new t("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",z);break;default:p=new t("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",z)}return p}return null};k._getTileInfoCompatibilityError=function(p,z){return n.isNone(p)||!z.compatibleWith(p)?new t("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface"):
null};k.levelRangeFromScaleRange=function(p,z){const C={minLevel:0,maxLevel:Infinity};var B=this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.tilingScheme;if(!B)return C;const A=B.levels[0];B=x=>{x=Math.log(A.scale/x)/Math.LN2;return 1E-9>.5-Math.abs(.5-x%1)?Math.round(x):Math.ceil(x)};null!=p&&0<p&&(C.minLevel=Math.max(0,B(p)));null!=z&&0<z&&(C.maxLevel=Math.max(0,B(z)));return C};k.isUpdating=function(){return!!(this.view&&this.view.basemapTerrain&&this.view.basemapTerrain.updating)};
c._createClass(q,[{key:"imageFormatIsOpaque",get:function(){return!1}},{key:"fullExtent",get:function(){return this.layer.fullExtent}},{key:"isOpaque",get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque}},{key:"dataLevelRange",get:function(){const p=this.tileInfo.lods;return this.levelRangeFromScaleRange(p[0].scale,p[p.length-1].scale)}},{key:"displayLevelRange",get:function(){var p=this.tileInfo.lods;p=this.levelRangeFromScaleRange(this.layer.minScale||p[0].scale,this.layer.maxScale||
p[p.length-1].scale);this.layer.maxScale&&p.maxLevel++;return p}}]);return q}(l);b.__decorate([m.property({readOnly:!0})],l.prototype,"imageFormatIsOpaque",null);b.__decorate([m.property({readOnly:!0})],l.prototype,"updating",void 0);b.__decorate([m.property(g.updatingProgress)],l.prototype,"updatingProgress",void 0);b.__decorate([m.property(g.updatingProgressValue)],l.prototype,"updatingProgressValue",void 0);b.__decorate([m.property()],l.prototype,"fullExtent",null);b.__decorate([m.property({readOnly:!0})],
l.prototype,"isOpaque",null);b.__decorate([m.property({readOnly:!0})],l.prototype,"dataLevelRange",null);b.__decorate([m.property({readOnly:!0})],l.prototype,"displayLevelRange",null);b.__decorate([m.property()],l.prototype,"layer",void 0);b.__decorate([m.property()],l.prototype,"tileInfo",void 0);return l=b.__decorate([e.subclass("esri.views.3d.layers.TiledLayerView3D")],l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../layers/support/layerUtils ../../../support/featureFlags ./FeatureLayerViewBase3D".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){r=function(l){function v(){var q=l.apply(this,arguments)||this;q.type="feature-3d";q.direct3DObjectFeatureLayerDisplayEnabled=g.enableDirect3DObjectFeatureLayerDisplay();return q}a._inheritsLoose(v,l);v.prototype.initialize=function(){const {layer:q,view:k}=this;e.getEffectiveLayerCapabilities(q)?.operations.supportsQuery||this.addResolvingPromise(Promise.reject(new b("featurelayerview:query-not-supported","layer view requires a layer with query capability",{layer:q})));
t.isSome(q.infoFor3D)&&(this.direct3DObjectFeatureLayerDisplayEnabled?this._set("suspendResumeExtentMode","computed"):this.addResolvingPromise(Promise.reject(new b("featurelayerview3d:unsupported-geometry-type",`Unsupported geometry type ${q.geometryType}`))));"mesh"!==q.geometryType||f.canProjectWithoutEngine(q.spatialReference,k.spatialReference)||this.addResolvingPromise(Promise.reject(new b("layerview:spatial-reference-incompatible","The spatial references of the feature layer is incompatible with the spatial reference of the view")))};
a._createClass(v,[{key:"featureSpatialReference",get:function(){return this.view.featureTiles?.tilingScheme?.spatialReference}}]);return v}(h);c.__decorate([n.property({constructOnly:!0})],r.prototype,"direct3DObjectFeatureLayerDisplayEnabled",void 0);c.__decorate([n.property()],r.prototype,"layer",void 0);return r=c.__decorate([d.subclass("esri.views.3d.layers.FeatureLayerView3D")],r)})},"esri/views/3d/layers/FeatureLayerViewBase3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ./FeatureLikeLayerView3D ./LayerView3D ./support/FeatureTileFetcher3DLayerViewContext ../support/EventedSet ../support/updatingProperties ../webgl-engine/lib/UpdatePolicy ../../layers/FeatureLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B){m=function(x){function u(w){w=x.call(this,w)||this;w._controllerTotal=0;w._processorTotal=0;w.suspendResumeExtentMode="data";return w}a._inheritsLoose(u,x);var y=u.prototype;y.initialize=function(){this.handles.add(n.watch(()=>this._updatingRequiredFieldsPromise,w=>this.updatingHandles.addPromise(w),n.syncAndInitial))};y.destroy=function(){this.updatingHandles.removeAll();this.handles.removeAll();this._fetcherContext=t.destroyMaybe(this._fetcherContext)};
y.setVisibility=function(w,D){this.processor?.setObjectIdVisibility(w,D)};y.createQuery=function(){return x.prototype.createQuery.call(this)};y.queryFeatures=function(w,D){const F=()=>x.prototype.queryFeatures.call(this,w,D);return"mesh"===this.layer.geometryType?this._queryFeaturesMesh(this._ensureQuery(w),F):F()};y.beforeSetController=function(w){w.maximumNumberOfFeatures=this.maximumNumberOfFeatures};y.createController=function(){this._fetcherContext=new v.FeatureTileFetcher3DLayerViewContext({layerView:this,
returnZ:this.hasZ,returnM:this.hasM});const w=new g.FeatureTileController3D({layerView:this,context:this._fetcherContext,graphics:new q.EventedSet,extent:this.clippingExtent});this.updatingHandles.add(()=>w.serviceDataExtent,D=>{this.processor&&(this.processor.dataExtent=D)},n.initial);this.handles.add(n.watch(()=>this.suspended,D=>{D?w.suspend():w.resume()},n.syncAndInitial));this.updatingHandles.add(()=>this.processor?.displayFeatureLimit,D=>w.displayFeatureLimit=D,n.initial);this.handles.add(n.when(()=>
!this.updating,()=>{this._processorTotal=this._controllerTotal=0}));return w};y.doRefresh=function(){var w=a._asyncToGenerator(function*(D){D&&!this.suspended&&this.controller&&this.controller.refetch();this.processor.refreshFilter()});return function(D){return w.apply(this,arguments)}}();y.getUsedMemory=function(){return(this.processor?.usedMemory??0)+(this.controller?.memoryForUnusedFeatures??0)};y.getUnloadedMemory=function(){const w=this.controller?.expectedFeatureDiff??0,D=this.processor?.loadedFeatures??
0;return(this.processor?.unprocessedMemoryEstimate??0)+D/(D+w)*(this.processor?.usedMemoryPerFeature??0)*w};y.ignoresMemoryFactor=function(){return this.controller?.hasMaximumNumberOfFeaturesOverride};y._queryFeaturesMesh=function(){var w=a._asyncToGenerator(function*(D,F){yield this._validateQueryFeaturesMesh(D);F=yield F();if(D&&D.outStatistics||t.isNone(this.graphics3DProcessor))return F;D=this.layer.objectIdField;const E=this.graphics3DProcessor.graphics3DGraphicsByObjectID,K=[];for(const J of F.features)if(J.geometry){const M=
E.get(J.attributes[D]);M&&(J.geometry=e.hydrateGeometry(M.graphic.geometry),K.push(J))}else K.push(J);F.features=K;return F});return function(D,F){return w.apply(this,arguments)}}();y._validateQueryFeaturesMesh=function(){var w=a._asyncToGenerator(function*(D){if(D){var F=K=>{throw new b("feature-layer-view:unsupported-query",`Queries on Mesh feature collection layers do not support '${K}'`);},E=["quantizationParameters","geometryPrecision","maxAllowableOffset"];for(const K of E)null!=D[K]&&F(K);
"returnM"in D&&D.returnM&&F("returnM");"returnCentroid"in D&&D.returnCentroid&&F("returnCentroid");t.isSome(D.outSpatialReference)&&!D.outSpatialReference.equals(this.view.spatialReference)&&F("outSpatialReference")}});return function(D){return w.apply(this,arguments)}}();a._createClass(u,[{key:"maximumNumberOfFeatures",get:function(){return this.controller?.maximumNumberOfFeatures??this._get("maximumNumberOfFeatures")},set:function(w){this._set("maximumNumberOfFeatures",w);this.controller&&(this.controller.maximumNumberOfFeatures=
w)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.controller?!(this.suspended||!this.controller.maximumNumberOfFeaturesExceeded):!1}},{key:"updatingProgressValue",get:function(){let w=0;if(this.controller?.updating){var D=this.controller.updatingRemaining,F=Math.max(this.controller.updatingTotal,this._controllerTotal);0<F&&(w=(F-D)/F,this._controllerTotal=F)}D=0;if(this.processor?.updating){F=this.processor.updatingRemaining;const E=Math.max(F,this._processorTotal);0<E&&(D=(E-
F)/E,this._processorTotal=E)}return.5*(w+D)}},{key:"updatePolicy",get:function(){if(!this.controller)return p.UpdatePolicy.ASYNC;switch(this.controller.mode){case "snapshot":const w=A[this.layer.geometryType];return null==w||this.controller.serviceDataCount>w?p.UpdatePolicy.ASYNC:p.UpdatePolicy.SYNC;case "tiles":return p.UpdatePolicy.ASYNC}}},{key:"hasZ",get:function(){const w=this.layer,D=w.capabilities&&w.capabilities.data;return D&&D.supportsZ?"returnZ"in w&&null!=w.returnZ?w.returnZ:D.supportsZ:
!1}},{key:"hasM",get:function(){const w=this.layer,D=w.capabilities&&w.capabilities.data;return D&&D.supportsM?"returnM"in w&&null!=w.returnM?w.returnM:!1:!1}},{key:"performanceInfo",get:function(){var w=this.controller?.displayFeatureLimit;w=t.isSome(w)?w.averageSymbolComplexity:void 0;w=t.isSome(w)?`f:${w.primitivesPerFeature},v:${w.primitivesPerCoordinate}`:"n/a";return{...this._getResourceInfo(),partial:this.maximumNumberOfFeaturesExceeded,mode:this.controller?.mode??"n/a",symbolComplexity:w,
nodes:this.controller?.tileDescriptors.length??0,...(this.controller?.debug??{storedFeatures:0,totalVertices:0})}}},{key:"test",get:function(){return{updatePolicy:this.updatePolicy,controller:this.controller,loadedGraphics:this.controller?.graphics}}}]);return u}(B(h.FeatureLikeLayerView3D(z(l.LayerView3D(C)))));c.__decorate([r.property()],m.prototype,"layer",void 0);c.__decorate([r.property()],m.prototype,"controller",void 0);c.__decorate([r.property()],m.prototype,"_controllerTotal",void 0);c.__decorate([r.property()],
m.prototype,"_processorTotal",void 0);c.__decorate([r.property()],m.prototype,"maximumNumberOfFeatures",null);c.__decorate([r.property()],m.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([r.property(k.updatingProgress)],m.prototype,"updatingProgress",void 0);c.__decorate([r.property({readOnly:!0})],m.prototype,"updatingProgressValue",null);c.__decorate([r.property({readOnly:!0})],m.prototype,"updatePolicy",null);c.__decorate([r.property({readOnly:!0})],m.prototype,"hasZ",null);c.__decorate([r.property({readOnly:!0})],
m.prototype,"hasM",null);c.__decorate([r.property()],m.prototype,"suspendResumeExtentMode",void 0);m=c.__decorate([f.subclass("esri.views.3d.layers.FeatureLayerViewBase3D")],m);const A={point:5E3,polygon:500,polyline:1E3};return m})},"esri/layers/graphics/controllers/FeatureTileController3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/asyncUtils ../../../core/Collection ../../../core/has ../../../core/Error ../../../core/Handles ../../../core/lang ../../../core/Logger ../../../core/maybe ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/support/WatchUpdatingTracking ../../support/arcgisLayerUrl ../../support/layerUtils ../../../portal/support/geometryServiceUtils ../../../rest/support/StatisticDefinition ../../../views/3d/layers/support/FeatureTileFetcher3D ../../../views/3d/layers/support/FeatureTileFetcher3DDebugger ../../../views/3d/support/debugFlags".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D){function F(E,K){if(!K)return!1;for(const J of K)if(!E.has(J))return!0;return!1}a.FeatureTileController3D=function(E){function K(M){M=E.call(this,M)||this;M.type="feature-tile-3d";M._watchUpdatingTracking=new C.WatchUpdatingTracking;M.serviceDataExtent=null;M.serviceDataCount=a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;M.vertexLimitExceeded=!1;M.displayFeatureLimit=null;M._suspended=!1;M._tileFetcher=null;M._handles=new f;M._fetchDataInfoPromise=
null;M._fetchDataInfoAbortController=null;M._lifeCycleAbortController=new AbortController;return M}c._inheritsLoose(K,E);var J=K.prototype;J._approximateExtentSizeAtScale=function(M,N){const P=this.layerView.view,I=N.levels[0];return(I.tileSize[0]/(I.scale/M)+I.tileSize[1]/(I.scale/M))/2*Math.ceil((P.width/N.pixelSize+P.height/N.pixelSize)/2)};J.initialize=function(){this._watchUpdatingTracking.add(()=>this.vertexLimitInfo,()=>this._watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,
this._lifeCycleAbortController.signal)));this._watchUpdatingTracking.add(()=>this.mode,()=>this._modeChanged(),q.initial);this.addResolvingPromise(Promise.resolve().then(()=>this._verifyCapabilities()).then(()=>this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo())).then(()=>this._initializeTileFetcher()))};J._verifyCapabilities=function(){const M=this.layerView.layer;if("ogc-feature"!==M.type&&!A.getEffectiveLayerCapabilities(M)?.operations.supportsQuery)throw new d("graphicscontroller:query-capability-required",
"Service requires query capabilities to be used as a feature layer",{layer:M});};J.destroy=function(){this._cancelFetchServiceDataInfo();this._tileFetcher=h.destroyMaybe(this._tileFetcher);this._handles=h.destroyMaybe(this._handles);this._tilesHandle=h.removeMaybe(this._tilesHandle);this._lifeCycleAbortController=h.abortMaybe(this._lifeCycleAbortController);this._watchUpdatingTracking.destroy();this._set("watchUpdatingTracking",null)};J.suspend=function(){this._suspended||(this._suspended=!0,h.isSome(this._tileFetcher)&&
this._tileFetcher.suspend())};J.resume=function(){this._suspended&&(this._suspended=!1,h.isSome(this._tileFetcher)&&this._tileFetcher.resume())};J.restart=function(){const M=()=>{h.isSome(this._tileFetcher)&&this._tileFetcher.restart()};this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(M,M))};J.refetch=function(){const M=()=>{h.isSome(this._tileFetcher)&&this._tileFetcher.refetch()};this._watchUpdatingTracking.addPromise(this._fetchServiceDataInfo().then(M,M))};J._initializeTileFetcher=
function(){const M=this.layerView.view;if(M){var N=q.whenOnce(()=>M.featureTiles?.tilingScheme,this._lifeCycleAbortController.signal);this._watchUpdatingTracking.addPromise(N);N.then(()=>{const {layerView:P,tileDescriptors:I}=this,G=P.layer,H=new y.FeatureTileFetcher3D({context:this.context,filterExtent:this.extent,tileDescriptors:I,features:this.graphics});this._tileFetcher=H;this._suspended?this._tileFetcher.suspend():this._tileFetcher.resume();const L=this.layerView.view.resourceController;L&&
this._handles.add(q.watch(()=>L.memoryController.memoryFactor,S=>H.memoryFactor=S,q.syncAndInitial));const O="polygon"===this.context.geometryType?"polygonLodFactor":"polyline"===this.context.geometryType?"polylineLodFactor":null;O&&this._handles.add(q.watch(()=>this.layerView.view?.qualitySettings?.graphics3D?.[O],S=>H.lodFactor=S||1,q.initial));"ogc-feature"!==G.type&&this._watchUpdatingTracking.add(()=>G.createQueryVersion,()=>this._dataFilterChanged());this._watchUpdatingTracking.add(()=>P.availableFields,
(S,R)=>this._availableFieldsChanged(R,S));this._watchUpdatingTracking.add(()=>P.requiredFields,(S,R)=>this._requiredFieldsChanged(R,S));this._handles.add([G.on("apply-edits",S=>this._applyEdits(S)),q.watch(()=>this.extent,S=>H.filterExtent=S,q.sync),q.watch(()=>this.tileDescriptors,S=>H.tileDescriptors=S,q.sync),q.watch(()=>this.maximumNumberOfFeatures,S=>{H.maximumNumberOfFeatures=S;H.useTileCount=this.serviceDataCount>S},q.syncAndInitial),q.watch(()=>this.serviceDataCount,S=>H.useTileCount=S>this.maximumNumberOfFeatures,
q.syncAndInitial),q.watch(()=>D.FEATURE_TILE_FETCH_SHOW_TILES,S=>{S&&H&&!H.debugger?(H.debugger=new w.FeatureTileFetcher3DDebugger(H,M.featureTiles.tilingScheme.toTileInfo(),M),H.debugger.update()):!S&&this._tileFetcher&&H.debugger&&(H.debugger.destroy(),H.debugger=null)},q.syncAndInitial)]);this._supportsExceedsLimitQuery||this._watchUpdatingTracking.add(()=>this.maxTotalSnapshotVertices,()=>this._watchUpdatingTracking.addPromise(this._updateVertexLimitExceeded(null,this._lifeCycleAbortController.signal)))}).catch(()=>
{})}};J._modeChanged=function(){switch(this.mode){case "tiles":this._tilesHandle||(this._tilesHandle=this.layerView.view.featureTiles.addClient());break;default:g.getLogger(this.declaredClass).warn("Unhandled feature layer mode "+this.mode);case "snapshot":h.isSome(this._tilesHandle)&&(this._tilesHandle.remove(),this._tilesHandle=null)}};J._dataFilterChanged=function(){this._set("maxTotalSnapshotVertices",0);this.notifyChange("maxTotalSnapshotVertices");this.refetch()};J._applyEdits=function(M){h.isNone(this._tileFetcher)||
this._tileFetcher.applyEdits(M).then(N=>{if(N){if(!this._lifeCycleAbortController)throw v.createAbortError();(N.deletedFeatures.length||N.updatedFeatures.length||N.addedFeatures.length)&&this._watchUpdatingTracking.addPromise(this._updateServiceDataExtent(this._lifeCycleAbortController.signal))}}).catch(N=>{if(!v.isAbortError(N))throw N;})};J._availableFieldsChanged=function(M,N){h.isSome(this._tileFetcher)&&F(this._tileFetcher.availableFields,N)&&this.refetch()};J._requiredFieldsChanged=function(M,
N){h.isSome(this._tileFetcher)&&F(this._tileFetcher.availableFields,N)&&this.restart()};J._createVertexLimitExceededQuery=function(M){const N=this.layerView.layer,P=N.createQuery();P.outStatistics=[new u({statisticType:"exceedslimit",maxVertexCount:M,outStatisticFieldName:"exceedslimit",maxPointCount:1E8,maxRecordCount:1E8})];N.capabilities?.query.supportsCacheHint&&(P.cacheHint=!0);return P};J._createDataInfoQuery=function(){const M=this.layerView.layer,N=M.createQuery();N.outSpatialReference=this.layerView.view.spatialReference;
M.capabilities?.query.supportsCacheHint&&(N.cacheHint=!0);return N};J._fullExtentIsAccurate=function(){const M=this.layerView.layer;if(M.definitionExpression)return!1;switch(M.type){case "feature":case "oriented-imagery":return B.isHostedAgolService(M.url);case "csv":case "geojson":case "ogc-feature":case "wfs":return!0}};J._updateServiceDataExtent=function(){var M=c._asyncToGenerator(function*(N){try{yield this._tryUpdateServiceDataExtent(N)}catch(P){v.isAbortError(P)||this._set("serviceDataExtent",
e.clone(this.layerView.fullExtentInLocalViewSpatialReference))}});return function(N){return M.apply(this,arguments)}}();J._tryUpdateServiceDataExtent=function(){var M=c._asyncToGenerator(function*(N){var P=this.layerView;const I=P.layer,G=I.capabilities?.query.supportsExtent??!1,H=e.clone(P.fullExtentInLocalViewSpatialReference),L=I.fullExtent,O=this._fullExtentIsAccurate(),S=this.serviceDataCount;G&&S<=a.FeatureTileController3DConstants.MAX_FEATURE_COUNT_FOR_EXTENT&&(!H||!O)&&"queryExtent"in I?(P=
this._createDataInfoQuery(),N=yield I.queryExtent(P,{timeout:a.FeatureTileController3DConstants.QUERY_EXTENT_TIMEOUT,signal:N}),this._set("serviceDataExtent",N.extent)):H?this._set("serviceDataExtent",H):h.isSome(L)?(N=yield x.projectGeometry(L,P.view.spatialReference,"portalItem"in I?I.portalItem:null,N),this._set("serviceDataExtent",N)):this._set("serviceDataExtent",null)});return function(N){return M.apply(this,arguments)}}();J._updateServiceDataCount=function(){var M=c._asyncToGenerator(function*(N){const P=
this.layerView.layer;if("queryFeatureCount"in P)if(N=yield n.result(P.queryFeatureCount(this._createDataInfoQuery(),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:N})),!0===N.ok)this._set("serviceDataCount",N.value);else{if(v.isAbortError(N.error))throw N.error;this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)}else this._set("serviceDataCount",a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT)});return function(N){return M.apply(this,
arguments)}}();J._updateVertexLimitExceeded=function(){var M=c._asyncToGenerator(function*(N,P){var I=this.vertexLimitInfo;if(h.isNone(I))this._set("vertexLimitExceeded",!1);else{var G=1<this._minimumNumberOfVerticesForGeometry;if(0>=I.primitivesPerFeature||G){var {primitivesPerFeature:H,primitivesPerCoordinate:L,maximumTotalNumberOfPrimitives:O}=I;0!==H&&h.isSome(N)&&(yield N);I=this.serviceDataCount;var S=I!==a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT;N=S?Math.ceil((O-I*H)/(L||1)):
Math.ceil(O/(L||1));G&&(N=Math.min(N,5E6));if(S&&this._minimumNumberOfVerticesForGeometry*I>N)this._set("vertexLimitExceeded",!0);else if(this._supportsExceedsLimitQuery)if(P=yield n.result(this.layerView.layer.queryFeatures(this._createVertexLimitExceededQuery(N),{timeout:a.FeatureTileController3DConstants.QUERY_STATISTICS_TIMEOUT,signal:P})),!1===P.ok){if(v.isAbortError(P.error))throw P.error;this._set("vertexLimitExceeded",!1)}else(P=P.value.features[0])&&P.attributes?this._set("vertexLimitExceeded",
!!P.attributes.exceedslimit):this._set("vertexLimitExceeded",!1);else this._set("vertexLimitExceeded",this.maxTotalSnapshotVertices>N)}else this._set("vertexLimitExceeded",!1)}});return function(N,P){return M.apply(this,arguments)}}();J._fetchServiceDataInfo=function(){var M=c._asyncToGenerator(function*(){this._cancelFetchServiceDataInfo();let N=new AbortController;const P=N.signal;var I=this._updateServiceDataCount(P);I=v.eachAlways([I,this._updateVertexLimitExceeded(I,P)]);const G=I.then(()=>this._updateServiceDataExtent(P)).catch(H=>
{v.isAbortError(H)||g.getLogger(this.declaredClass).error("#fetchServiceDataInfo()",H)}).then(()=>{G===this._fetchDataInfoPromise&&(this._fetchDataInfoAbortController=this._fetchDataInfoPromise=null);N=null});N&&(this._fetchDataInfoPromise=G);this._fetchDataInfoAbortController=N;return I.then(()=>{},()=>{})});return function(){return M.apply(this,arguments)}}();J._cancelFetchServiceDataInfo=function(){const M=this._fetchDataInfoAbortController;M&&(this._fetchDataInfoPromise=this._fetchDataInfoAbortController=
null,M.abort())};c._createClass(K,[{key:"extent",set:function(M){if(h.isSome(M)&&!M.spatialReference.equals(this.layerView.view.spatialReference))g.getLogger(this.declaredClass).error("#extent\x3d","extent needs to be in the same spatial reference as the view");else{var N=this._get("extent");N===M||h.isSome(N)&&M&&N.equals(M)||(M=h.isSome(M)?M.clone():null,this._set("extent",M))}}},{key:"updating",get:function(){return!!(h.isSome(this._tileFetcher)&&this._tileFetcher.updating||null!=this._fetchDataInfoPromise||
"tiles"===this.mode&&this.layerView.view.featureTiles&&this.layerView.view.featureTiles.updating||this._watchUpdatingTracking&&this._watchUpdatingTracking.updating)}},{key:"updatingTotal",get:function(){return this.updating&&h.isSome(this._tileFetcher)?this._tileFetcher.updatingTotal:0}},{key:"updatingRemaining",get:function(){return this.updating&&h.isSome(this._tileFetcher)?this._tileFetcher.updatingRemaining:0}},{key:"expectedFeatureDiff",get:function(){return this.updating&&h.isSome(this._tileFetcher)?
this._tileFetcher.expectedFeatureDiff:0}},{key:"memoryForUnusedFeatures",get:function(){return h.isSome(this._tileFetcher)?this._tileFetcher.memoryForUnusedFeatures:0}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!(!h.isSome(this._tileFetcher)||!this._tileFetcher.maximumNumberOfFeaturesExceeded)}},{key:"maximumNumberOfFeatures",get:function(){return h.isSome(this.displayFeatureLimit)?this.displayFeatureLimit.maximumNumberOfFeatures:0},set:function(M){M!==this.maximumNumberOfFeatures&&
this._overrideIfSome("maximumNumberOfFeatures",M)}},{key:"hasMaximumNumberOfFeaturesOverride",get:function(){return this._isOverridden("maximumNumberOfFeatures")}},{key:"mode",get:function(){var M=this.layerView.layer;if("feature"===M.type&&h.isSome(M.infoFor3D))return"snapshot";if(!1===this.layerView.view.qualitySettings?.graphics3D?.snapshotAvailable||this.serviceDataCount===a.FeatureTileController3DConstants.NO_SERVICE_DATA_COUNT||this.vertexLimitExceeded)return"tiles";var N=this.layerView.view;
N=(N=N&&N.featureTiles)&&N.tilingScheme;return M&&M.minScale&&this.serviceDataExtent&&N&&(M=this._approximateExtentSizeAtScale(M.minScale,N),(this.serviceDataExtent.width/M+this.serviceDataExtent.height/M)/2>a.FeatureTileController3DConstants.MAX_SNAPSHOT_MIN_SCALE_FACTOR)?"tiles":!this.maximumNumberOfFeatures||this.serviceDataCount<=this.maximumNumberOfFeatures?"snapshot":"tiles"}},{key:"maxTotalSnapshotVertices",get:function(){const M=this._get("maxTotalSnapshotVertices")||0,N="snapshot"===this.mode&&
h.isSome(this._tileFetcher)&&this._tileFetcher.totalVertices||0;return Math.max(M,N)}},{key:"tileDescriptors",get:function(){return"snapshot"===this.mode?new r([{id:"dummy-tile-full-extent",lij:[0,0,0]}]):this.layerView.view.featureTiles?this.layerView.view.featureTiles.tiles:new r}},{key:"test",get:function(){return{fetchDataInfoPromise:this._fetchDataInfoPromise,tileFetcher:this._tileFetcher}}},{key:"vertexLimitInfo",get:function(){if(h.isNone(this.displayFeatureLimit)||h.isNone(this.displayFeatureLimit.averageSymbolComplexity))return null;
const {averageSymbolComplexity:M,maximumTotalNumberOfPrimitives:N}=this.displayFeatureLimit,{primitivesPerCoordinate:P,primitivesPerFeature:I}=M,G=this._get("vertexLimitInfo");return h.isNone(G)||G.maximumTotalNumberOfPrimitives!==N||G.primitivesPerCoordinate!==P||G.primitivesPerFeature!==I?{primitivesPerCoordinate:P,primitivesPerFeature:I,maximumTotalNumberOfPrimitives:N}:G}},{key:"_supportsExceedsLimitQuery",get:function(){const M=this.layerView.layer;return null!=M.capabilities&&M.capabilities.operations&&
M.capabilities.operations.supportsExceedsLimitStatistics}},{key:"_minimumNumberOfVerticesForGeometry",get:function(){switch(this.layerView.layer.geometryType){case "point":return 1;case "multipoint":return 1;case "polygon":return 4;case "polyline":return 2;case "multipatch":case "mesh":return 3;case null:return 0;default:return 0}}},{key:"debug",get:function(){return{storedFeatures:h.isSome(this._tileFetcher)?this._tileFetcher.storedFeatures:0,totalFeatures:h.isSome(this._tileFetcher)?this._tileFetcher.totalFeatures:
0,totalVertices:h.isSome(this._tileFetcher)?this._tileFetcher.totalVertices:0,missingTiles:h.isSome(this._tileFetcher)?this._tileFetcher.missingTiles:0}}}]);return K}(l.EsriPromiseMixin(t));b.__decorate([k.property({readOnly:!0})],a.FeatureTileController3D.prototype,"type",void 0);b.__decorate([k.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"graphics",void 0);b.__decorate([k.property({constructOnly:!0})],a.FeatureTileController3D.prototype,"layerView",void 0);b.__decorate([k.property({constructOnly:!0})],
a.FeatureTileController3D.prototype,"context",void 0);b.__decorate([k.property()],a.FeatureTileController3D.prototype,"extent",null);b.__decorate([k.property()],a.FeatureTileController3D.prototype,"updating",null);b.__decorate([k.property({readOnly:!0})],a.FeatureTileController3D.prototype,"_watchUpdatingTracking",void 0);b.__decorate([k.property()],a.FeatureTileController3D.prototype,"updatingTotal",null);b.__decorate([k.property()],a.FeatureTileController3D.prototype,"updatingRemaining",null);b.__decorate([k.property()],
a.FeatureTileController3D.prototype,"expectedFeatureDiff",null);b.__decorate([k.property()],a.FeatureTileController3D.prototype,"memoryForUnusedFeatures",null);b.__decorate([k.property()],a.FeatureTileController3D.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([k.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataExtent",void 0);b.__decorate([k.property({readOnly:!0})],a.FeatureTileController3D.prototype,"serviceDataCount",void 0);b.__decorate([k.property({readOnly:!0})],
a.FeatureTileController3D.prototype,"vertexLimitExceeded",void 0);b.__decorate([k.property()],a.FeatureTileController3D.prototype,"displayFeatureLimit",void 0);b.__decorate([k.property({type:Number})],a.FeatureTileController3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([k.property({readOnly:!0})],a.FeatureTileController3D.prototype,"mode",null);b.__decorate([k.property({readOnly:!0})],a.FeatureTileController3D.prototype,"maxTotalSnapshotVertices",null);b.__decorate([k.property({readOnly:!0,
dependsOn:["mode"]})],a.FeatureTileController3D.prototype,"tileDescriptors",null);b.__decorate([k.property()],a.FeatureTileController3D.prototype,"_tileFetcher",void 0);b.__decorate([k.property()],a.FeatureTileController3D.prototype,"_fetchDataInfoPromise",void 0);b.__decorate([k.property({readOnly:!0})],a.FeatureTileController3D.prototype,"vertexLimitInfo",null);a.FeatureTileController3D=b.__decorate([z.subclass("esri.layers.graphics.controllers.FeatureTileController3D")],a.FeatureTileController3D);
a.FeatureTileController3DConstants=void 0;(function(E){E.NO_SERVICE_DATA_COUNT=Infinity;E.MAX_SNAPSHOT_MIN_SCALE_FACTOR=5;E.reset=function(){E.MAX_FEATURE_COUNT_FOR_EXTENT=1E4;E.QUERY_STATISTICS_TIMEOUT=12E3;E.QUERY_EXTENT_TIMEOUT=1E4}})(a.FeatureTileController3DConstants||(a.FeatureTileController3DConstants={}));a.FeatureTileController3DConstants.reset();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../rest/support/QuantizationParameters ../../../../rest/support/Query ../../../ViewingMode ./featureReference ./FeatureTile ../../terrain/tileUtils ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y){function w(P){return"dummy-tile-full-extent"===P.id}function D(P){let I=0;for(const G of P)G.features&&0<G.features.length&&G.alive&&(I=Math.max(I,G.descriptor.lij[0]));return I}function F(P){P.setFeatures([],0,null);P.featuresMissing=!1;return x.FetchStatus.DONE}function E(P){return d.isNone(P)?new Set:new Set(P.map(I=>I.name))}function K(P,I){if(d.isNone(P)||d.isNone(I))return E(I);const G=new Set;for(const {name:H}of I)P.has(H)&&G.add(H);
return G}const J=r.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");a.FeatureTileFetcher3D=function(P){function I(H){H=P.call(this,H)||this;H._useTileCount=!1;H.updating=!1;H.running=!1;H.updatingTotal=0;H.updatingRemaining=0;H.expectedFeatureDiff=0;H.maximumNumberOfFeaturesExceeded=!1;H.maximumNumberOfFeaturesExceededThrottle=1E3;H._fullRatio=1;H._farRatio=1;H._changes={updates:{adds:[],removes:[]},adds:[],removes:[]};H._handles=new n;H._frameTask=y.ImmediateTask;H._dirty=!1;H._featureTiles=
new Map;H._displayingFeatureReferences=new Map;H._numDisplayingFeatureReferences=0;H._suspended=!0;H._pendingEdits=null;return H}c._inheritsLoose(I,P);var G=I.prototype;G.initialize=function(){this._handles.add(e.on(()=>this.tileDescriptors,"change",()=>this._setDirty(),{onListenerAdd:()=>this._setDirty()}));this._objectIdField=this.context.objectIdField;this.FeatureReferenceClass=this.context.capabilities.supportsMultipleResolutions?A.MultiFeatureReference:A.SingleFeatureReference;const H=this.context.scheduler;
d.isSome(H)&&(this._frameTask=H.registerTask(y.TaskPriority.FEATURE_TILE_FETCHER,this));this._setDirty()};G.destroy=function(){this._frameTask.remove();this._handles=d.destroyMaybe(this._handles);this._featureTiles.forEach(H=>{this._cancelFetchTile(H);this._removeTile(H)});this._featureTiles.clear();this._displayingFeatureReferences.clear();this._pendingEdits?.controller.abort();this._pendingEdits=null};G.restart=function(){this._featureTiles.forEach(H=>{this._cancelFetchTile(H);this._clearTile(H);
this._resetFetchTile(H)});d.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this._setDirty()};G.refetch=function(){this._featureTiles.forEach(H=>{this._cancelFetchTile(H);this._resetFetchTile(H)});d.isSome(this.context.memoryCache)&&this.context.memoryCache.clear();this._setDirty()};G.suspend=function(){this._suspended||(this._suspended=!0,this._pause(),this._setDirty())};G.resume=function(){this._suspended&&(this._suspended=!1,this._unpause())};G._pause=function(){this._paused&&
(this._featureTiles.forEach(H=>this._cancelFetchTile(H)),this._updated())};G._unpause=function(){this._paused||(this._setDirty(),this._updated())};G.applyEdits=function(H){this._pendingEdits||(this._pendingEdits={edits:Promise.resolve(),count:0,controller:new AbortController},this._pause());const L=this._pendingEdits;L.count++;const O=L.edits.then(()=>H.result.catch(S=>{if(f.isAbortError(S))throw S;return null}).then(S=>{if(!S)return S;this._applyEditsDeleteFeatures(S.deletedFeatures);return this._applyEditsAddUpdateFeatures(S.addedFeatures,
S.updatedFeatures,L.controller.signal).then(()=>S)}).then(S=>{0===--L.count&&(this._pendingEdits===L&&(this._pendingEdits=null),d.isSome(this.context.memoryCache)&&this.context.memoryCache.clear(),this._unpause(),this._updated());return S}));L.edits=O;this._updated();return O};G._applyEditsDeleteFeatures=function(H){if(0!==H.length){var L=this.context.globalIdField,O=L&&this.availableFields.has(L),S=new Set,R=this._objectIdField;H.forEach(({objectId:Q,globalId:V})=>{(!Q||0>Q)&&L?(O||J.errorOncePerTick(`Editing the specified service requires the layer's globalIdField, ${L} to be included the layer's outFields for updates to be reflected in the view`),
(Q=this.features.find(aa=>aa.attributes&&aa.attributes[L]===V))&&S.add(p.getObjectId(Q,R))):S.add(Q)});this._featureTiles.forEach(Q=>{if(Q.features){var V=Q.features.filter(aa=>!S.has(p.getObjectId(aa,this._objectIdField)));V.length!==Q.features.length&&(Q.setFeatures(V,0,Q.availableFields),this._invalidateCounts())}})}};G._applyEditsAddUpdateFeatures=function(){var H=c._asyncToGenerator(function*(L,O,S){const R=[],Q=new Set;L.forEach(aa=>R.push(aa.objectId));O.forEach(aa=>{R.push(aa.objectId);Q.add(aa.objectId)});
if(0!==R.length){var V=[];this._featureTiles.forEach(aa=>{(aa=this._applyEditsAddUpdateTile(aa,R,Q,S))&&V.push(aa)});yield f.eachAlways(V)}});return function(L,O,S){return H.apply(this,arguments)}}();G._applyEditsAddUpdateTile=function(){var H=c._asyncToGenerator(function*(L,O,S,R){if(L.features){var Q=this._createQuery(L);Q.resultType=void 0;Q.cacheHint=!1;Q.objectIds=O;O=yield this._queryFeatures(Q,R);R=null;0<S.size&&(Q=L.features.filter(V=>!S.has(p.getObjectId(V,this._objectIdField))),Q.length!==
L.features.length&&(R=Q));if(0<O.features.length){R||(R=L.features.slice());for(const V of O.features)R.push(V)}R&&(L.hasPreciseFeatureCount&&(L.numFeatures=Math.max(L.numFeatures,R.length)),L.setFeatures(R,0,K(L.availableFields,O.fields)),this._invalidateCounts())}});return function(L,O,S,R){return H.apply(this,arguments)}}();G._queryFeatures=function(H,L){return this.context.query.queryFeaturesDehydrated(H,{signal:L,timeout:6E5})};G._setDirty=function(){this._dirty=!0;this._updated()};G.runTask=
function(H){this._frameTask.processQueue(H);if(this._dirty&&this.initialized){this._dirty=!1;var L=this._getListOfTiles();this._markTilesNotAlive(L);if(H.run(()=>this._addTiles(L,H))&&H.run(()=>this._filterExtentTiles(L,H))&&H.run(()=>this._removeTiles(L,H))&&!H.done){var O=this._sortTiles(L);H.run(()=>this._showTiles(O,H))&&H.run(()=>this._fetchTiles(O,H))&&H.run(()=>this._updateMemoryEstimates(O,H))||this._setDirty();this._updated();this.updating||this._updateMaximumNumberOfFeaturesExceeded()}else this._setDirty()}};
G._markTilesNotAlive=function(H){for(const L of H)L.alive=!1};G._addTiles=function(H,L){if(this._suspended)return!1;this.tileDescriptors.forEach(O=>{const S=this._featureTiles.get(O.id);S?S.alive=!0:L.done||(H.push(this._addTile(O)),L.madeProgress())});return L.hasProgressed};G._filterExtentTiles=function(H,L){for(const O of H){if(L.done)break;O.alive&&(O.filtered=!O.intersects(this.filterExtent),O.filtered&&(this._clearTile(O),L.madeProgress()))}return L.hasProgressed};G._removeTiles=function(H,
L){for(let O=H.length-1;0<=O&&!L.done;O--){const S=H[O];S.alive||(this._removeTile(S),O!==H.length-1&&(H[O]=H[H.length-1]),H.pop(),L.madeProgress())}return L.hasProgressed};G._sortTiles=function(H){H.sort((L,O)=>(L.descriptor.loadPriority??0)-(O.descriptor.loadPriority??0));return H};G._showTiles=function(H,L){const O=this._updateRatio(H),S=R=>{const Q=1>this._fullRatio?O(R)*this._farRatio:1;R.reduceFeatures(Q,this.memoryFactor,this._objectIdField)&&this._setDirty();return this._showTile(R)};for(const R of H)if(!L.run(()=>
S(R))){this._setDirty();break}return L.hasProgressed};G._fetchTiles=function(H,L){if(this._paused)return!1;var O=!1;for(const R of H)if(R.needsFetching){var S=d.isSome(this.context.memoryCache)?this.context.memoryCache.pop(R.id):null;if(d.isSome(S))R.cache=S,this._setDirty(),this._scheduleUpdated(),L.madeProgress();else if(this._needsNumFeatures(R)&&(O=new AbortController,S=this._fetchTileCount(R,O.signal),this._handleRequest(R,S,O,()=>R.numFeatures=x.FAILED_FEATURE_COUNT),O=!0,L.madeProgress()),
L.done)return!0}if(O)return L.hasProgressed;for(const R of H)if(R.needsFetching&&(H=new AbortController,O=this._fetchTile(R,H.signal),this._handleRequest(R,O,H,Q=>{R.setFeatures([],0,null);this._invalidateCounts();R.featuresMissing=!1;this.context.logFetchError(J,Q)}),L.madeProgress()))return!0;return L.hasProgressed};G._updateMemoryEstimates=function(H,L){H.some(O=>L.run(()=>O.updateMemoryEstimates())?!1:(this._setDirty(),!0));return L.hasProgressed};G._reclip=function(H,L){if(this.initialized){var O=
[];this._featureTiles.forEach(S=>{d.isNone(S.displayingFeatures)||0===S.displayingFeatures.length||(S.intersectionIncludingBorrowed(L,M),S.intersectionIncludingBorrowed(H,N),k.equals(M,N)||O.push(S))});this._refreshDisplayingFeatures(O);this._updated()}};G._refreshDisplayingFeatures=function(H){const L=new Set,O=this._changes.updates;for(const S of H)if(!d.isNone(S.displayingFeatures))for(const R of S.displayingFeatures)H=p.getObjectId(R,this._objectIdField),L.has(H)||(L.add(H),H=this._displayingFeatureReferences.get(H).feature,
O.removes.push(H),O.adds.push(H));this._applyChanges()};G._updated=function(){let H=0;this._paused||this._featureTiles.forEach(O=>O.isFetching?++H:0);var L=this._dirty||!!this._pendingEdits||0<H;this._set("running",this._dirty);this._set("updating",L);if(L){let O=0,S=0,R=0,Q=0,V=0;const aa=this._displayingFeatureReferences.size/this._numDisplayingFeatureReferences;this._featureTiles.forEach(W=>{++S;if(W.isFetching&&W.hasPreciseFeatureCount){const T=this._maximumFeaturesForTile(W)*(1-W.emptyFeatureRatio),
U=d.isSome(W.displayingFeatures)?W.displayingFeatures.length*aa:0;V+=T-U}W.needsFetching?++Q:0<W.numFeatures&&(++R,O+=W.numFeatures)});Q+=H;let X=L=0;O?(X=O,L=Math.min(Q*O/R,O)):(X=S,L=Q);V=Math.min(this.maximumNumberOfFeatures-this.features.length,V);this._set("updatingTotal",X);this._set("updatingRemaining",L);this._set("expectedFeatureDiff",V)}else this._set("updatingTotal",0),this._set("updatingRemaining",0),this._set("expectedFeatureDiff",0);this.debugger&&this.debugger.update()};G._updateMaximumNumberOfFeaturesExceeded=
function(){const H=m.someMap(this._featureTiles,L=>L.perTileMaximumNumberOfFeaturesExceeded);this._set("maximumNumberOfFeaturesExceeded",H)};G._updateRatio=function(H){const L=D(H),O=Q=>1/(1<<Math.max(0,L-Q.descriptor.lij[0]));let S=0,R=0;for(const Q of H)H=Q.numFeatures,S+=H,R+=H*O(Q);this._fullRatio=Math.min(1,this.maximumNumberOfFeatures/S);this._farRatio=this.maximumNumberOfFeatures/R;this._scheduleUpdated();return O};G._maximumFeaturesUpdated=function(H,L){H!==L&&(L>H&&this._featureTiles.forEach(O=>
{if(O.featuresMissing){var S=this._maximumFeaturesForTile(O);O.features&&(O.features.length>=S||O.fetchStatus===x.FetchStatus.FULL)||(this._cancelFetchTile(O),this._resetFetchTile(O))}}),this._setDirty())};G._addTile=function(H){H=new x.FeatureTile(H);this._featureTiles.set(H.id,H);this._resetFetchTile(H);this._referenceDisplayingFeaturesFromRelatedTiles(H);return H};G._referenceDisplayingFeaturesFromRelatedTiles=function(H){const L=H.descriptor.resolution;this._featureTiles.forEach(O=>{if(!(d.isNone(O.displayingFeatures)||
H===O||H.descriptor.lij&&O.descriptor.lij&&!u.tilesAreRelated(H.descriptor.lij,O.descriptor.lij))){d.isNone(H.displayingFeatures)&&(H.displayingFeatures=[]);H.descriptor.extent&&O.descriptor.extent&&(d.isNone(H.extentIncludingBorrowedFeatures)&&(H.extentIncludingBorrowedFeatures=k.clone(H.descriptor.extent)),k.expand(H.extentIncludingBorrowedFeatures,O.descriptor.extent,H.extentIncludingBorrowedFeatures));for(const S of O.displayingFeatures)H.displayingFeatures.push(S),O=this._displayingFeatureReferences.get(p.getObjectId(S,
this._objectIdField)),O.ref(O.feature,L),this._numDisplayingFeatureReferences++}});H.featureLimit=d.isSome(H.displayingFeatures)?H.displayingFeatures.length:0};G._removeTile=function(H){this._clearTile(H);this._featureTiles.delete(H.id)};G._resetFetchTile=function(H){H.filtered=!H.intersects(this.filterExtent);H.filtered?H.needsFetching&&(H.fetchStatus=x.FetchStatus.DONE):H.fetchStatus=x.FetchStatus.FETCH_NEEDED};G._cancelFetchTile=function(H){const L=H.requestController;d.isSome(L)&&(H.requestController=
null,H.resetFetching(),L.abort())};G._fetchTileCount=function(){var H=c._asyncToGenerator(function*(L,O){L.numFeatures=yield this._fetchCount(L,O);this._updateRatio(this._getListOfTiles());return L.fetchStatus===x.FetchStatus.REFETCHING?x.FetchStatus.REFETCH_NEEDED:x.FetchStatus.FETCH_NEEDED});return function(L,O){return H.apply(this,arguments)}}();G._fetchTile=function(){var H=c._asyncToGenerator(function*(L,O){var S=this._maximumFeaturesForTile(L);if(0>=S)return F(L);const R=this._getMaxRecordCount(L);
var Q=Math.ceil(S/R);if(w(L)||!this.context.capabilities.supportsMaxRecordCountFactor||L.numFeatures<=S&&Q>C.MAX_MAX_RECORD_COUNT_FACTOR)return this._fetchPagedTile(L,O);Q=this._createQuery(L);Q.maxRecordCountFactor=Math.ceil(S/R);L.isRefetching&&L.features&&0<L.features.length&&(Q.maxRecordCountFactor=Math.max(Math.ceil(L.features.length/(1-L.emptyFeatureRatio)/R)+1,Q.maxRecordCountFactor));const {features:V,exceededTransferLimit:aa,fields:X}=yield this._queryFeatures(Q,O);S=aa?Q.maxRecordCountFactor>=
C.MAX_MAX_RECORD_COUNT_FACTOR?x.FetchStatus.FULL:x.FetchStatus.DONE:x.FetchStatus.FULL;yield this._frameTask.schedule(()=>{L.featuresMissing=V.length<L.numFeatures||!!aa;const W=this._removeEmptyFeatures(V);L.setFeatures(V,W,E(X))},O);f.throwIfAborted(O);this._invalidateCounts();return S});return function(L,O){return H.apply(this,arguments)}}();G._fetchCount=function(){var H=c._asyncToGenerator(function*(L,O){return this.context.query.queryFeatureCount(this._createFeatureCountQuery(L),{signal:O})});
return function(L,O){return H.apply(this,arguments)}}();G._fetchPagedTile=function(){var H=c._asyncToGenerator(function*(L,O){let S=0,R=0,Q,V=0,aa=this._maximumFeaturesForTile(L)-V;const X=this._getMaxRecordCount(L);let W=null;for(;;){const T=this._createQuery(L),U=this._setPagingParameters(T,S,aa,X),{features:Y,exceededTransferLimit:ba,fields:da}=yield this._queryFeatures(T,O);yield this._frameTask.schedule(()=>{U&&(S+=d.unwrap(T.num));V+=Y.length;R+=this._removeEmptyFeatures(Y);L.featuresMissing=
S<L.numFeatures||!!ba;Q=Q?Q.concat(Y):Y;W=K(W,da);L.setFeatures(Q,R,W)},O);f.throwIfAborted(O);this._invalidateCounts();this._setDirty();aa=this._maximumFeaturesForTile(L)-V;if(!U||!ba||0>=aa)return ba?x.FetchStatus.DONE:x.FetchStatus.FULL}});return function(L,O){return H.apply(this,arguments)}}();G._createFeatureCountQuery=function(H){H=this._createQuery(H);this.context.capabilities.supportsCacheHint&&(H.resultType=void 0,H.cacheHint=!0);return H};G._createQuery=function(H){const L=this.context.createQuery(),
O=H.descriptor.extent;O&&(L.geometry=k.toExtent(O,this.context.tilingScheme.spatialReference));this._setResolutionParams(L,H);this._useTileQuery(H)?L.resultType="tile":this.context.capabilities.supportsCacheHint&&(L.cacheHint=!0);return L};G._setPagingParameters=function(H,L,O,S){if(!this.context.capabilities.supportsPagination)return!1;H.start=L;0<O&&this.context.capabilities.supportsMaxRecordCountFactor?(H.maxRecordCountFactor=Math.ceil(O/S),H.num=Math.min(H.maxRecordCountFactor*S,O)):H.num=Math.min(S);
return!0};G._getEffectiveTileResolution=function(H){if(null==H.descriptor.resolution)return null;const L=this.context.viewingMode===B.ViewingMode.Global?this.context.tilingScheme.resolutionAtLevel(3):Infinity;return Math.min(H.descriptor.resolution,L)/this.lodFactor};G._setResolutionParams=function(H,L){this._supportsResolution&&(L=this._getEffectiveTileResolution(L),null!=L&&(this.context.capabilities.supportsQuantization?H.quantizationParameters=new z({mode:"view",originPosition:"upper-left",tolerance:L,
extent:this.context.fullExtent}):"polyline"===this.context.geometryType&&(H.maxAllowableOffset=L)))};G._removeEmptyFeatures=function(H){const L=H.length;for(let O=0;O<H.length;)p.hasVertices(H[O].geometry)?++O:(H[O]=H[H.length-1],--H.length);return L-H.length};G._needsNumFeatures=function(H){return this.useTileCount&&H.needsFeatureCount&&!w(H)};G._getMaxRecordCount=function(H){const {tileMaxRecordCount:L,maxRecordCount:O}=this.context;return this._useTileQuery(H)&&d.isSome(L)&&0<L&&this.context.capabilities.supportsResultType?
L:d.isSome(O)&&0<O?O:2E3};G._useTileQuery=function(H){return w(H)&&this.context.capabilities.supportsCacheHint?!1:this.context.capabilities.supportsResultType};G._handleRequest=function(H,L,O,S){H.fetchStatus=H.needsRefetching?x.FetchStatus.REFETCHING:x.FetchStatus.FETCHING;H.requestController=O;let R=!1;L.then(Q=>{H.requestController=null;H.fetchStatus=Q}).catch(Q=>{H.requestController===O&&(H.requestController=null,H.fetchStatus=x.FetchStatus.DONE);f.isAbortError(Q)?R=!0:S(Q)}).then(()=>{R||this._setDirty();
this._scheduleUpdated()})};G._scheduleUpdated=function(){this._handles&&!this._handles.has("scheduleUpdated")&&this._handles.add(g.schedule(()=>{this._handles.remove("scheduleUpdated");this._updated()}),"scheduleUpdated")};G._showTile=function(H){if(d.isSome(H.displayingFeatures)&&!H.needsDisplayUpdate)return!1;var L=H.features;if(0===H.featureLimit||!L)return L=d.isSome(H.displayingFeatures)&&0<H.displayingFeatures.length,this._hideTileFeatures(H),H.displayingFeatures=[],L;const O=H.descriptor.resolution,
S=this._changes.updates,R=this._changes.adds,Q=Math.min(H.featureLimit,L.length);H.featureLimit=Q;for(let aa=0;aa<Q;++aa){var V=L[aa];const X=p.getObjectId(V,this._objectIdField),W=this._displayingFeatureReferences.get(X);W?(V=W.ref(V,O),V.oldVersion!==V.newVersion&&(V.oldVersion&&S.removes.push(V.oldVersion),V.newVersion&&S.adds.push(V.newVersion))):(this._displayingFeatureReferences.set(X,new this.FeatureReferenceClass(V,O)),R.push(V));this._numDisplayingFeatureReferences++}this._hideTileFeatures(H);
this._applyChanges();H.displayingFeatures=L.slice(0,Q);return!0};G._hideTile=function(H){this._cancelFetchTile(H);this._hideTileFeatures(H)};G._hideTileFeatures=function(H){if(!d.isNone(H.displayingFeatures)){var L=this._changes.updates,O=this._changes.removes;for(const R of H.displayingFeatures){const Q=p.getObjectId(R,this._objectIdField);var S=this._displayingFeatureReferences.get(Q);S&&((S=S.unref(H.descriptor.resolution),this._numDisplayingFeatureReferences--,S)?S.oldVersion!==S.newVersion&&
(null==S.newVersion?(this._displayingFeatureReferences.delete(Q),S.oldVersion&&O.push(S.oldVersion)):(L.adds.push(S.newVersion),S.oldVersion&&L.removes.push(S.oldVersion))):console.error("Hiding unreferenced feature"))}this._applyChanges();H.displayingFeatures=null}};G._applyChanges=function(){var H=this._changes.updates;0<H.removes.length&&(this.features.removeMany(H.removes),H.removes.length=0);0<H.adds.length&&(this.features.addMany(H.adds),H.adds.length=0);H=this._changes.adds;const L=this._changes.removes,
O=Math.min(H.length,L.length);let S=0;for(;S<O;){const R=Math.min(S+200,O);this.features.addMany(H.slice(S,R));this.features.removeMany(L.slice(S,R));S=R}H.length>O&&this.features.addMany(0===S?H:H.slice(S));L.length>O&&this.features.removeMany(0===S?L:L.slice(S));H.length=0;L.length=0};G._clearTile=function(H){this._hideTile(H);H.features&&d.isSome(this.context.memoryCache)&&this.context.memoryCache.put(H.id,H.cache,16+H.estimatedSize);H.setFeatures(null,0,null);this._invalidateCounts()};G._invalidateCounts=
function(){this.notifyChange("totalVertices");this.notifyChange("totalFeatures");this.notifyChange("memoryForUnusedFeatures")};G._getListOfTiles=function(){return Array.from(this._featureTiles.values())};G._maximumFeaturesForTile=function(H){const L=H.hasPreciseFeatureCount?H.numFeatures:Infinity;return Math.min(Math.ceil((H.hasPreciseFeatureCount?L:this.maximumNumberOfFeatures)*(1>this._fullRatio?this._farRatio:1)/(1-H.emptyFeatureRatio)),L)};c._createClass(I,[{key:"maximumNumberOfFeatures",set:function(H){H=
H||Infinity;const L=this._get("maximumNumberOfFeatures");H===L||1>H||(this._set("maximumNumberOfFeatures",H),this._maximumFeaturesUpdated(L,H))}},{key:"memoryFactor",set:function(H){this.memoryFactor!==H&&(this._set("memoryFactor",H),this._setDirty())}},{key:"lodFactor",set:function(H){this.lodFactor!==H&&(this._set("lodFactor",H),this._supportsResolution&&this.refetch())}},{key:"useTileCount",get:function(){return this._useTileCount&&d.isSome(this.context.query.queryFeatureCount)},set:function(H){this._useTileCount=
H;this.notifyChange("useTileCount")}},{key:"memoryForUnusedFeatures",get:function(){let H=0;this._featureTiles.forEach(L=>H+=L.estimatedUnusedSize);return H}},{key:"totalVertices",get:function(){let H=0;this._featureTiles.forEach(L=>H+=L.numVertices);return H}},{key:"totalFeatures",get:function(){let H=0;this._featureTiles.forEach(L=>H+=L.numFeatures);return H}},{key:"filterExtent",set:function(H){if(d.isSome(H)&&this.context.tilingScheme&&!H.spatialReference.equals(this.context.tilingScheme.spatialReference))J.error("#filterExtent\x3d",
"extent needs to be in the same spatial reference as the tiling scheme");else{var L=this._get("filterExtent");L===H||d.isSome(L)&&H&&L.equals(H)||(H=d.isSome(H)?H.clone():null,this._set("filterExtent",H),this._reclip(H,L))}}},{key:"_paused",get:function(){return this._suspended||!!this._pendingEdits}},{key:"availableFields",get:function(){let H=null;this._featureTiles.forEach(L=>{d.isNone(L.displayingFeatures)||0===L.displayingFeatures.length||(d.isNone(H)?H=new Set(L.availableFields):H.forEach(O=>
{L.availableFields.has(O)||d.unwrap(H).delete(O)}))});return d.isSome(H)?H:new Set}},{key:"_supportsResolution",get:function(){return this.context.capabilities.supportsMultipleResolutions&&"point"!==this.context.geometryType}},{key:"storedFeatures",get:function(){return this._getListOfTiles().reduce((H,L)=>H+(L.features?L.features.length:0),0)}},{key:"missingTiles",get:function(){return Array.from(this._featureTiles.values()).reduce((H,L)=>H+(L.needsFetching||L.isFetching?1:0),0)}},{key:"test",get:function(){return{process:H=>
this.runTask(H),getFeatureTileById:H=>this._featureTiles.get(H),forEachFeatureTile:H=>this._featureTiles.forEach(H)}}}]);return I}(t);b.__decorate([h.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"features",void 0);b.__decorate([h.property()],a.FeatureTileFetcher3D.prototype,"tileDescriptors",void 0);b.__decorate([h.property({value:Infinity})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeatures",null);b.__decorate([h.property({value:1})],a.FeatureTileFetcher3D.prototype,"memoryFactor",
null);b.__decorate([h.property({value:1})],a.FeatureTileFetcher3D.prototype,"lodFactor",null);b.__decorate([h.property()],a.FeatureTileFetcher3D.prototype,"useTileCount",null);b.__decorate([h.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updating",void 0);b.__decorate([h.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"running",void 0);b.__decorate([h.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"updatingTotal",void 0);b.__decorate([h.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,
"updatingRemaining",void 0);b.__decorate([h.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"expectedFeatureDiff",void 0);b.__decorate([h.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"memoryForUnusedFeatures",null);b.__decorate([h.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceeded",void 0);b.__decorate([h.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"maximumNumberOfFeaturesExceededThrottle",void 0);b.__decorate([h.property({readOnly:!0})],
a.FeatureTileFetcher3D.prototype,"totalVertices",null);b.__decorate([h.property({readOnly:!0})],a.FeatureTileFetcher3D.prototype,"totalFeatures",null);b.__decorate([h.property()],a.FeatureTileFetcher3D.prototype,"filterExtent",null);b.__decorate([h.property({constructOnly:!0})],a.FeatureTileFetcher3D.prototype,"context",void 0);a.FeatureTileFetcher3D=b.__decorate([q.subclass("esri.views.3d.layers.support.FeatureTileFetcher3D")],a.FeatureTileFetcher3D);const M=k.create(),N=k.create();a.contextCapabilitiesFromLayer=
function(P){const I=P.capabilities.query;a:switch(P.geometryType){case "polyline":P=!0;break a;case "polygon":P=P.capabilities&&P.capabilities.query&&P.capabilities.query.supportsQuantization;break a;default:P=!1}return{supportsMultipleResolutions:P,supportsPagination:!(!I||!I.supportsPagination),supportsResultType:!(!I||!I.supportsResultType),supportsCacheHint:!(!I||!I.supportsCacheHint),supportsQuantization:!(!I||!I.supportsQuantization),supportsQuantizationEditMode:!(!I||!I.supportsQuantizationEditMode),
supportsMaxRecordCountFactor:!(!I||!I.supportsMaxRecordCountFactor),supportsFormatPBF:!(!I||!I.supportsFormatPBF)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureReference":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/byteSizeEstimations ../../../../core/has ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingBox ../../../../core/mathUtils ../../../../geometry/Extent ../../../../geometry/Geometry ../../../../geometry/Multipoint ../../../../geometry/Point ../../../../geometry/Polygon ../../../../geometry/Polyline ../../../../geometry/support/typeUtils ../../../../layers/support/Field ../../../../layers/graphics/dehydratedFeatureComparison".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){b=function(){function z(B,A){this._highestResolutionVersion=null;this.versions=[];this.ref(B,A)}var C=z.prototype;C.ref=function(B,A){const x=this.feature;p.oldVersion=x;this.feature&&Object.defineProperty(B,"uid",{value:this.feature.uid,configurable:!0});for(var u of this.versions)if(u.resolution===A){u.refCount++;if((A=this._highestResolutionVersion===u&&!k.equals(B,u.feature))||this._highestResolutionVersion!==u)u.feature=B;p.newVersion=A?B:x;return p}u=
{feature:B,resolution:A,refCount:1};this.versions.push(u);!this._highestResolutionVersion||A<this._highestResolutionVersion.resolution?(p.newVersion=B,this._highestResolutionVersion=u):p.newVersion=x;return p};C.unref=function(B){for(let A=0;A<this.versions.length;A++){const x=this.versions[A];if(x.resolution===B)return x.refCount--,p.oldVersion=this.feature,0===x.refCount&&(this.versions[A]=this.versions[this.versions.length-1],this.versions.length--,this._highestResolutionVersion===x&&(this._recalculateHighestResolutionVersion(),
p.oldVersion=x.feature)),p.newVersion=this.feature,p}return null};C._recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this._highestResolutionVersion=null;else{var B=this.versions[0];for(let A=1;A<this.versions.length;A++){const x=this.versions[A];x.resolution<B.resolution&&(B=x)}this._highestResolutionVersion=B}};c._createClass(z,[{key:"isReferenced",get:function(){return 0!==this.versions.length}},{key:"isSingle",get:function(){return 1===this.versions.length&&1===this.versions[0].refCount}},
{key:"feature",get:function(){return this._highestResolutionVersion?this._highestResolutionVersion.feature:null}}]);return z}();t=function(){function z(B){this._feature=B;this._refCount=1}var C=z.prototype;C.ref=function(B){++this._refCount;p.oldVersion=this._feature;this.feature&&Object.defineProperty(B,"uid",{value:this.feature.uid,configurable:!0});k.equals(this._feature,B)||(this._feature=B);p.newVersion=this._feature;return p};C.unref=function(){p.oldVersion=this._feature;if(0<this._refCount&&
(this._refCount--,!this.isReferenced))return p.newVersion=null,p;p.newVersion=this._feature;return p};c._createClass(z,[{key:"isReferenced",get:function(){return 0!==this._refCount}},{key:"isSingle",get:function(){return 1===this._refCount}},{key:"feature",get:function(){return this._feature}}]);return z}();const p={oldVersion:null,newVersion:null};a.MultiFeatureReference=b;a.SingleFeatureReference=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/arrayUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,c,b,t,n,r){const m=new Set;let d=function(){function e(h){this.descriptor=h;this.fetchStatus=a.FetchStatus.FETCH_NEEDED;this._features=null;this._featureLimit=this._numVertices=0;this.featuresMissing=!0;this._shuffled=!1;this._numFeatures=-1;this._emptyFeatureRatio=0;this._estimatedSize=-1;this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;this._availableFields=m;this._displayingFeatures=null;this.alive=!0;this.filtered=!1}var g=e.prototype;g.setFeatures=function(h,l,v){this._availableFields=
t.unwrapOr(v,m);this._features=h;this._shuffled=!1;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0;h&&0<h.length?(this._emptyFeatureRatio=l/(h.length+l),this._numVertices=h.reduce((q,k)=>q+r.numVertices(k.geometry),0)):this._numVertices=this._emptyFeatureRatio=0};g.updateMemoryEstimates=function(){if(0>this._estimatedSize){this._estimatedUnusedSize=this._estimatedSize=0;if(this._features)for(var h=0;h<this._features.length;++h){const l=r.estimateSize(this._features[h]);this._estimatedSize+=
l;h>=this.featureLimit&&(this._estimatedUnusedSize+=l)}return!0}if(this._estimatedUnusedSizeDirty){this._estimatedUnusedSize=0;this._estimatedUnusedSizeDirty=!1;if(this._features)for(h=this.featureLimit;h<this._features.length;++h)this._estimatedUnusedSize+=r.estimateSize(this._features[h]);return!0}return!1};g.resetFetching=function(){this.fetchStatus=this.fetchStatus===a.FetchStatus.REFETCHING?a.FetchStatus.REFETCH_NEEDED:a.FetchStatus.FETCH_NEEDED};g.intersects=function(h){if(t.isNone(h)||!this.descriptor.extent)return!0;
n.fromExtent(h,f);return n.intersects(this.descriptor.extent,f)};g.intersectionIncludingBorrowed=function(h,l){const v=t.isSome(this.extentIncludingBorrowedFeatures)?this.extentIncludingBorrowedFeatures:this.descriptor.extent;if(!h&&!v)return n.copy(l,n.POSITIVE_INFINITY),l;t.isSome(h)?(n.fromExtent(h,l),n.intersection(l,v,l)):n.copy(l,v);return l};g._shuffle=function(h){this._features.sort((l,v)=>r.getObjectId(l,h)-r.getObjectId(v,h));b.shuffle(this._features,16438);this._estimatedUnusedSizeDirty=
this._shuffled=!0};g.reduceFeatures=function(h,l,v){if(0>=h)return!1;if(!this._features)return this.featureLimit=0,!1;let q=!1;this.featureLimit=Math.ceil(this.numFeatures*h);this.featureLimit>this._features.length&&(this.featureLimit=this._features.length,this.fetchStatus===a.FetchStatus.DONE&&0<this._features.length&&(this.fetchStatus=a.FetchStatus.REFETCH_NEEDED,q=!0));!this._shuffled&&1>h&&this._shuffle(v);h=Math.max(this.featureLimit,Math.ceil(l*this.numFeatures));this._features.length>h&&(this._features.length=
h,this.featuresMissing=!0,this.fetchStatus===a.FetchStatus.FULL&&(this.fetchStatus=a.FetchStatus.DONE));return q};c._createClass(e,[{key:"displayingFeatures",get:function(){return this._displayingFeatures},set:function(h){this._displayingFeatures=h;this.extentIncludingBorrowedFeatures=null}},{key:"perTileMaximumNumberOfFeaturesExceeded",get:function(){return!this.filtered&&(this.featuresMissing||this.features&&this.featureLimit!==this.features.length)}},{key:"features",get:function(){return this._features}},
{key:"featureLimit",get:function(){return this._featureLimit},set:function(h){this._featureLimit!==h&&(this._featureLimit=h,this._estimatedUnusedSizeDirty=!0)}},{key:"availableFields",get:function(){return this._availableFields}},{key:"emptyFeatureRatio",get:function(){return this._emptyFeatureRatio}},{key:"numFeatures",get:function(){return this.hasPreciseFeatureCount?this._numFeatures:this._features?this._features.length:0},set:function(h){this._numFeatures=h}},{key:"hasPreciseFeatureCount",get:function(){return-1<
this._numFeatures}},{key:"needsFeatureCount",get:function(){return-1===this._numFeatures}},{key:"numVertices",get:function(){return this._numVertices}},{key:"id",get:function(){return this.descriptor.id}},{key:"estimatedSize",get:function(){this.updateMemoryEstimates();return this._estimatedSize}},{key:"estimatedUnusedSize",get:function(){return this._estimatedUnusedSize}},{key:"isFetching",get:function(){return this.fetchStatus===a.FetchStatus.FETCHING||this.fetchStatus===a.FetchStatus.REFETCHING}},
{key:"isRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCHING}},{key:"needsFetching",get:function(){return this.fetchStatus===a.FetchStatus.FETCH_NEEDED||this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"needsRefetching",get:function(){return this.fetchStatus===a.FetchStatus.REFETCH_NEEDED}},{key:"isFetched",get:function(){return this.fetchStatus===a.FetchStatus.DONE||this.fetchStatus===a.FetchStatus.FULL}},{key:"needsDisplayUpdate",get:function(){var h;if(h=!!this._features){a:{h=
this._features;var l=this.displayingFeatures,v=this.featureLimit;if(t.isNone(l)||t.isNone(h)||v!==l.length||v>h.length)h=!1;else{for(let q=0;q<v;++q)if(h[q]!==l[q]){h=!1;break a}h=!0}}h=!h}return h}},{key:"cache",get:function(){return{availableFields:this._availableFields,features:this._features,numFeatures:this._numFeatures,emptyFeatureRatio:this._emptyFeatureRatio,fetchStatus:this.fetchStatus,featuresMissing:this.featuresMissing}},set:function(h){this.requestController=null;this._availableFields=
h.availableFields;this._features=h.features;this._numFeatures=h.numFeatures;this._emptyFeatureRatio=h.emptyFeatureRatio;this.fetchStatus=h.fetchStatus;this.featuresMissing=h.featuresMissing;this._estimatedSize=-1;this._estimatedUnusedSizeDirty=!0}}]);return e}();a.FetchStatus=void 0;(function(e){e[e.FETCH_NEEDED=0]="FETCH_NEEDED";e[e.REFETCH_NEEDED=1]="REFETCH_NEEDED";e[e.FETCHING=2]="FETCHING";e[e.REFETCHING=3]="REFETCHING";e[e.DONE=4]="DONE";e[e.FULL=5]="FULL"})(a.FetchStatus||(a.FetchStatus={}));
const f=n.create();a.FAILED_FEATURE_COUNT=-2;a.FeatureTile=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DDebugger":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Graphic ../../../../core/maybe ../../../../geometry/Polygon ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../terrain/TilingScheme".split(" "),
function(a,c,b,t,n,r,m,d,f,e){const g=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];let h=function(){function l(q,k,p){this._loadingGraphics=new Map;this._loadedGraphics=new Map;this._pendingGraphics=new Map;this._dataExtentGraphic=null;this._enabled=!0;this._tileFetcher=q;this._view=p;this._tilingScheme=new e.TilingScheme(k);
this._loadedSymbols=g.map(z=>new d(new r({material:{color:[z[0],z[1],z[2],.6]},outline:{color:"black",size:1}})));this._loadingSymbols=[new d(new r({material:{color:[200,200,200,.4]},outline:{color:[30,30,30],size:1}}))];this._pendingSymbols=[new d(new r({material:{color:[100,100,100,.4]},outline:{color:[30,30,30],size:1}}))];this._dataExtentSymbol=new d(new r({material:{color:[0,0,0,0]},outline:{color:"green",size:4}}))}var v=l.prototype;v.destroy=function(){this.enabled=!1};v.update=function(){this._enabled?
(this._synchronizeMaps(this._loadingGraphics,{filter:q=>q.isFetching,symbols:this._loadingSymbols}),this._synchronizeMaps(this._loadedGraphics,{filter:q=>!q.isFetching,symbols:this._loadedSymbols}),this._synchronizeMaps(this._pendingGraphics,{filter:q=>!q.isFetching,symbols:this._pendingSymbols}),this.showDataExtent(this._tileFetcher.filterExtent)):(this._loadingGraphics.forEach(q=>{this._view.graphics.removeMany(q)}),this._loadingGraphics.clear(),this._loadedGraphics.forEach(q=>{this._view.graphics.removeMany(q)}),
this._loadedGraphics.clear(),this._pendingGraphics.forEach(q=>{this._view.graphics.removeMany(q)}),this._pendingGraphics.clear(),this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null))};v.showDataExtent=function(q){this._dataExtentGraphic&&(this._view.graphics.remove(this._dataExtentGraphic),this._dataExtentGraphic=null);t.isNone(q)||(q=n.fromExtent(q),this._dataExtentGraphic=new b({geometry:q,symbol:this._dataExtentSymbol}),this._view.graphics.add(this._dataExtentGraphic))};
v._synchronizeMaps=function(q,k){const p=[];q.forEach((z,C)=>{const B=this._tileFetcher.test.getFeatureTileById(C);B&&k.filter(B)||(this._view.graphics.removeMany(z),p.push(C))});p.forEach(z=>q.delete(z));this._tileFetcher.test.forEachFeatureTile(z=>{if(k.filter(z)&&!q.has(z.id)){const [A,x,u]=z.descriptor.lij;this._tilingScheme.ensureMaxLod(A);var C=this._tilingScheme.getExtentGeometry(A,x,u),B=new b({geometry:C,symbol:k.symbols[A%k.symbols.length]});C=new b({geometry:C.center,symbol:new m({verticalOffset:{screenLength:40/
.75},callout:{type:"line",color:"white",border:{color:"black"}},symbolLayers:[new f({text:`${A}/${x}/${u}`,halo:{color:"white",size:1/.75},material:{color:"black"},size:16})]})});B=[B,C];q.set(z.id,B);this._view.graphics.addMany(B)}})};c._createClass(l,[{key:"enabled",get:function(){return this._enabled},set:function(q){this._enabled=q;this.update()}}]);return l}();a.FeatureTileFetcher3DDebugger=h;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/FeatureTileController3D ../../../rest/support/Query ../../../symbols/support/utils ./graphics/elevationAlignPointsInFeatures ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./graphics/queryForSymbologySnapping ./support/HeatmapFeatureProcessor ./support/projectExtentUtils ../webgl-engine/lib/UpdatePolicy ../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x){a.FeatureLikeLayerView3D=u=>{u=function(y){function w(){var F=y.apply(this,arguments)||this;F.controller=null;F.updatePolicy=A.UpdatePolicy.SYNC;F.suspendResumeExtentMode="computed";F.slicePlaneEnabled=!1;F.fullExtentInLocalViewSpatialReference=null;F.suspendResumeExtent=null;F._controllerCreated=!1;F.supportsHeightUnitConversion=!0;F._pendingController=null;F.queryEngine=null;return F}c._inheritsLoose(w,y);var D=w.prototype;D.initialize=function(){var F=
this;const E=this.layer;if("isTable"in E&&E.isTable)this.addResolvingPromise(Promise.reject(new t("featurelayerview:table-not-supported","table feature layer can't be displayed",{layer:E})));else{this.addResolvingPromise(this._validateGeometryType());this.updatingHandles.add(()=>this.layer.renderer,J=>this._recreateProcessor(J),r.initial);this.addResolvingPromise(c._asyncToGenerator(function*(){const J=yield B.toViewIfLocal(F);F.fullExtentInLocalViewSpatialReference=J;yield F._initializeController()})());
this.updatingHandles.add(()=>this.updatePolicy,J=>this.processor.preferredUpdatePolicy=J);var K=()=>this.processor.featureStore;this.queryEngine=new p.QueryEngine({context:{spatialReference:this.view.spatialReference,layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return K()},hasZ:this.hasZ,hasM:this.hasM},priority:x.TaskPriority.FEATURE_QUERY_ENGINE});this.notifyChange("updating")}};D.destroy=function(){this._destroyPendingController();this.controller=n.destroyMaybe(this.controller);
this._set("processor",n.destroyMaybe(this.processor));this.queryEngine=n.destroyMaybe(this.queryEngine);this.loadedGraphics=null};D._destroyPendingController=function(){this._pendingController=n.destroyMaybe(this._pendingController)};D.getHit=function(F){let E;this.loadedGraphics?.forEach(K=>{K.uid===F&&(E=g.hydrateGraphic(K,this.layer))});return E?{type:"graphic",graphic:E,layer:E.layer}:null};D.whenGraphicBounds=function(F,E){return this.processor?.whenGraphicBounds(F,E)};D.computeAttachmentOrigin=
function(F,E){return this.processor?.computeAttachmentOrigin(F,E)};D.elevationAlignPointsInFeatures=function(){var F=c._asyncToGenerator(function*(E,K){const J=this.graphics3DProcessor;if(n.isNone(J))throw new t("featurelayerview3d:missing-processor","A Graphics3D processor is needed to resolve graphics elevation.");return q.elevationAlignPointsInFeatures(this.view,this.layer,M=>J.getGraphics3DGraphicByObjectId(M),E,K)});return function(E,K){return F.apply(this,arguments)}}();D.queryForSymbologySnapping=
function(){var F=c._asyncToGenerator(function*(E,K){return this.symbologySnappingSupported?z.queryForSymbologySnapping(this.graphics3DProcessor,E,K):{candidates:[],sourceCandidateIndices:[]}});return function(E,K){return F.apply(this,arguments)}}();D.queryFeatures=function(F,E){return this.queryEngine.executeQuery(this._ensureQuery(F),n.get(E,"signal"))};D.queryObjectIds=function(F,E){return this.queryEngine.executeQueryForIds(this._ensureQuery(F),n.get(E,"signal"))};D.queryFeatureCount=function(F,
E){return this.queryEngine.executeQueryForCount(this._ensureQuery(F),n.get(E,"signal"))};D.queryExtent=function(F,E){return this.queryEngine.executeQueryForExtent(this._ensureQuery(F),n.get(E,"signal"))};D._ensureQuery=function(F){return n.isNone(F)?this.createQuery():l.from(F)};D.highlight=function(F){return this.processor.highlight(F,this.layer.objectIdField)};D.maskOccludee=function(F){return this.processor.maskOccludee(F)};D.canResume=function(){return y.prototype.canResume.call(this)&&!this.processor?.scaleVisibilitySuspended};
D.getSuspendInfo=function(){const F=y.prototype.getSuspendInfo.call(this);return this.processor?{...F,...this.processor.suspendInfo}:F};D.isUpdating=function(){return!this.processor||this.processor.destroyed?!1:!(this._controllerCreated&&!this.controller?.updating&&this.view?.basemapTerrain?.ready&&!this.processor.updating)};D._initializeController=function(){var F=c._asyncToGenerator(function*(){const E=this.createController();this._pendingController=E;yield E.when();this._setControllerWhenInitialized(E)});
return function(){return F.apply(this,arguments)}}();D._setControllerWhenInitialized=function(){var F=c._asyncToGenerator(function*(E){try{yield this.when()}catch(K){}this._controllerCreated=!0;this.notifyChange("updating");!this.isResolved()||this.destroyed?this._destroyPendingController():(yield r.whenOnce(()=>this.view?.basemapTerrain?.ready),this.beforeSetController(E),this._pendingController=null,this.controller=E,this.loadedGraphics=E.graphics,this.notifyChange("updating"))});return function(E){return F.apply(this,
arguments)}}();D._updateClippingExtent=function(F){this.clippingExtent=F;if(!this.controller)return!1;switch(this.controller.type){case "stream":return!1;case "feature-tile-3d":return this.controller.extent=F,!0}};D._validateGeometryType=function(){var F=c._asyncToGenerator(function*(){switch(this.layer.geometryType){case "multipatch":case "multipoint":throw new t("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:this.layer.geometryType});}});
return function(){return F.apply(this,arguments)}}();D._recreateProcessor=function(F){var E="heatmap"===F?.type;const K="heatmap"===this.processor?.type;F=this.processor;F&&E===K||(E=E?new C.HeatmapFeatureProcessor({owner:this}):new k({owner:this,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,preferredUpdatePolicy:this.updatePolicy,updateClippingExtent:J=>this._updateClippingExtent(J)}),
this._set("processor",E),F?.destroy(),this.queryEngine?.clear(),this.addResolvingPromise(E.initializePromise))};D._getResourceInfo=function(){const F=this.controller instanceof h.FeatureTileController3D?this.controller:null;return{displayedNumberOfFeatures:this.loadedGraphics.length,maximumNumberOfFeatures:F?.maximumNumberOfFeatures??-1,totalNumberOfFeatures:F?.serviceDataCount??-1,nodes:0,...this.processor.performanceInfo}};c._createClass(w,[{key:"legendEnabled",get:function(){return this.canResume()&&
this.processor?.legendEnabled}},{key:"graphics3DProcessor",get:function(){return"graphics-3d"===this.processor?.type?this.processor:null}},{key:"heatmapProcessor",get:function(){return"heatmap"===this.processor?.type?this.processor:null}},{key:"symbologySnappingSupported",get:function(){return this.layer?.renderer?.getSymbols()?.some(v.symbolHasExtrudeSymbolLayer)??!1}},{key:"performanceInfo",get:function(){return this._getResourceInfo()}}]);return w}(u);b.__decorate([m.property()],u.prototype,"loadedGraphics",
void 0);b.__decorate([m.property()],u.prototype,"suspended",void 0);b.__decorate([m.property({readOnly:!0})],u.prototype,"legendEnabled",null);b.__decorate([m.property()],u.prototype,"updating",void 0);b.__decorate([m.property()],u.prototype,"controller",void 0);b.__decorate([m.property()],u.prototype,"processor",void 0);b.__decorate([m.property({readOnly:!0})],u.prototype,"updatePolicy",void 0);b.__decorate([m.property({readOnly:!0})],u.prototype,"suspendResumeExtentMode",void 0);b.__decorate([m.property({type:Boolean})],
u.prototype,"slicePlaneEnabled",void 0);b.__decorate([m.property({readOnly:!0})],u.prototype,"suspendInfo",void 0);b.__decorate([m.property()],u.prototype,"graphics3DProcessor",null);b.__decorate([m.property()],u.prototype,"heatmapProcessor",null);b.__decorate([m.property()],u.prototype,"symbologySnappingSupported",null);return u=b.__decorate([e.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],u)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/elevationAlignPointsInFeatures":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/maybe ../../../../core/promiseUtils ../../../../layers/graphics/dehydratedFeatures ../../../../support/elevationInfoUtils ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ../../../../geometry/SpatialReference".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){function h(){h=c._asyncToGenerator(function*(k,p,z,C,B){const {elevationProvider:A,renderCoordsHelper:x,spatialReference:u}=k,{elevationInfo:y}=p;var w=e.extractExpressionInfo(y,!0);w=yield e.createContext(w,u,B);n.throwIfAborted(B);B=[];const D=new Set,F=new Set;for(const {objectId:E,points:K}of C)if(C=z(E),t.isNone(C)){for(const J of K)B.push(J[2]);D.add(E)}else{C.isDraped&&F.add(E);l.setFromElevationInfo(m.getGeometryEffectiveElevationInfo(C.graphic.geometry,y));
l.updateFeatureExpressionInfoContext(w,C.graphic,p);v.spatialReference=k.spatialReference;for(const {x:J,y:M,z:N}of K)v.x=J,v.y=M,v.z=N??0,d.evaluateElevationInfoAtPoint(v,A,l,x,q),B.push(q.z)}return{elevations:B,drapedObjectIds:F,failedObjectIds:D}});return h.apply(this,arguments)}const l=new f.ElevationContext,v=r.makeDehydratedPoint(0,0,0,g.WGS84),q=new d.SampleElevationInfo;a.elevationAlignPointsInFeatures=function(k,p,z,C,B){return h.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/support/elevationInfoUtils":function(){define(["exports","../core/maybe","../symbols/support/unitConversionUtils"],function(a,c,b){function t(l,v){return c.isNone(v)||!v.mode?(l?g:h).mode:v.mode}function n(l,v){return c.isSome(v)?v:l?g:h}function r(l,v){return t(c.isSome(l)?l.hasZ:!1,v)}function m(l){const v=d(l);return r(l.geometry,v)}function d(l){return l.layer&&"elevationInfo"in l.layer?l.layer.elevationInfo:null}function f(l,v,q,k,p,z,C=null){if(!c.isNone(z)){var B=
c.isSome(C)?C.mode:"absolute-height";if("on-the-ground"===B)return 0;({absoluteZ:z}=e(v,q,k,p,l,z));a:{C=c.isSome(C)&&c.isSome(C.offset)?C.offset:0;switch(B){case "absolute-height":l=z-C;break a;case "relative-to-ground":l=z-(c.unwrapOr(l.elevationProvider.getElevation(v,q,k,p,"ground"),0)+C);break a;case "relative-to-scene":l=z-(c.unwrapOr(l.elevationProvider.getElevation(v,q,k,p,"scene"),0)+C);break a}l=void 0}return l}}function e(l,v,q,k,p,z){const C=c.isSome(z.offset)?z.offset:0;switch(z.mode){case "absolute-height":return{absoluteZ:q+
C,elevation:0};case "on-the-ground":return q=c.unwrapOr(p.elevationProvider.getElevation(l,v,0,k,"ground"),0),{absoluteZ:q,elevation:q};case "relative-to-ground":return l=c.unwrapOr(p.elevationProvider.getElevation(l,v,q,k,"ground"),0),{absoluteZ:q+l+C,elevation:l};case "relative-to-scene":return l=c.unwrapOr(p.elevationProvider.getElevation(l,v,q,k,"scene"),0),{absoluteZ:q+l+C,elevation:l}}}const g={mode:"absolute-height",offset:0},h={mode:"on-the-ground",offset:null};a.absoluteHeightElevationInfo=
g;a.elevationContextAffectsAlignment=function(l,v){if(c.isNone(v))return!1;({mode:v}=v);return c.isSome(v)&&("scene"===l&&"relative-to-scene"===v||"ground"===l&&"absolute-height"!==v)};a.elevationInfoLikeEquals=function(l,v){return l===v||c.isSome(l)&&c.isSome(v)&&l.mode===v.mode&&l.offset===v.offset};a.getConvertedElevation=function(l,v,q,k=null){return f(l,v.x,v.y,v.hasZ?v.z:0,v.spatialReference,q,k)};a.getConvertedElevationFromVector=function(l,v,q,k,p=null){return f(l,v[0],v[1],2<v.length?v[2]:
0,q,k,p)};a.getEffectiveElevationInfo=n;a.getEffectiveElevationMode=t;a.getGeometryEffectiveElevationInfo=function(l,v){return n(c.isSome(l)?!!l.hasZ:!1,v)};a.getGeometryEffectiveElevationMode=r;a.getGraphicEffectiveElevationInfo=function(l){var v=d(l);l=r(l.geometry,v);v=c.isSome(v)&&"on-the-ground"!==l?c.unwrapOr(v.offset,0)*b.getMetersPerUnit(c.unwrapOr(v.unit,"meters")):0;return{mode:l,offset:v}};a.getGraphicEffectiveElevationMode=m;a.getZForElevationMode=function(l,v,q){if(!c.isNone(q)&&q.mode){var k=
l.hasZ?l.z:0,p=c.isSome(q.offset)?q.offset:0;switch(q.mode){case "absolute-height":return k-p;case "on-the-ground":return 0;case "relative-to-ground":return l=c.unwrapOr(v.elevationProvider.getElevation(l.x,l.y,k,l.spatialReference,"ground"),0)+p,k-l;case "relative-to-scene":return l=c.unwrapOr(v.elevationProvider.getElevation(l.x,l.y,k,l.spatialReference,"scene"),0)+p,k-l}}};a.hasGraphicFeatureExpressionInfo=function(l){if("on-the-ground"===m(l))return!1;l=d(l);l=c.isSome(l)&&l.featureExpressionInfo?
l.featureExpressionInfo.expression:null;return!(!l||"0"===l)};a.onTheGroundElevationInfo=h;a.zValueInAbsoluteHeightMode=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureProcessor":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../arcade/functions/hash ../../../../core/compilerUtils ../../../../core/HandleOwner ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../geometry/support/webMercatorUtils ../../../../renderers/support/randomRotationExpression ../../../../renderers/support/renderingInfoUtils ../../../../rest/support/Query ../interfaces ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DObjectStates ./Graphics3DScaleVisibility ./graphicUtils ../support/attributeUtils ../support/FeatureVisibilityFilter ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/UpdatePolicy".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J){r=function(N){function P(G){G=N.call(this,G)||this;G.type="graphics-3d";G._randomRotationRenderers=null;G.elevationFeatureExpressionEnabled=!1;G.scaleVisibilityEnabled=!1;G.filterVisibilityEnabled=!1;G.frustumVisibilityEnabled=!1;G.elevationAlignmentEnabled=!1;G.timeExtentEnabled=!1;G.setUidToIdOnAdd=!0;G.dataExtent=null;G.drapeSourceType=C.DrapeSourceType.Features;G.preferredUpdatePolicy=J.UpdatePolicy.ASYNC;G._suspendResumeExtent=
null;return G}a._inheritsLoose(P,N);var I=P.prototype;I.initialize=function(){const G=this.owner,H=new A.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:this.preferredUpdatePolicy,elevationFeatureExpressionEnabled:this.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1,hasZ:G.hasZ,hasM:G.hasM,setUidToIdOnAdd:this.setUidToIdOnAdd,componentFactories:{deconflictor:L=>G.view.deconflictor.addGraphicsOwner(L),labeler:(L,O)=>G.view.labeler.addGraphicsOwner(L,O),elevationAlignment:this.elevationAlignmentEnabled?
(L,O)=>new x({graphicsCoreOwner:this,graphicsCore:L,queryGraphicUIDsInExtent:O,elevationProvider:G.view.elevationProvider}):null,scaleVisibility:this.scaleVisibilityEnabled?(L,O)=>new w({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:O,graphicsCore:L,basemapTerrain:G.view.basemapTerrain}):null,filterVisibility:(this.filterVisibilityEnabled||this.timeExtentEnabled)&&"multipatch"!==G.layer.geometryType?L=>new E.FeatureVisibilityFilter({context:{layerView:G,...L}}):null,objectStates:L=>
new y.Graphics3DObjectStates(L)}});this._set("graphicsCore",H);this.frustumVisibilityEnabled&&this._set("frustumVisibility",new u({graphicsCoreOwner:this}));this.elevationAlignment&&this.updatingHandles.add(()=>this.layer.elevationInfo,(L,O)=>{v.diff(L,O)&&this.updatingHandles.addPromise(this.graphicsCore.elevationInfoChange())});this.updatingHandles.add(()=>this.layer.labelsVisible,()=>this.graphicsCore.updateVisibilityInfo());this.updatingHandles.add(()=>this.layer.labelingInfo,(L,O)=>{v.diff(L,
O)&&this.graphicsCore.updateLabelingInfo()});this.updatingHandles.add(()=>this.preferredUpdatePolicy,L=>this.graphicsCore.preferredUpdatePolicy=L);this._set("initializePromise",this._initializeAsync());this.updatingHandles.addPromise(this.initializePromise)};I._initializeAsync=function(){var G=a._asyncToGenerator(function*(){yield d.logOnError(this.graphicsCore.initializePromise);const H=this.owner;this.updatingHandles.add(()=>this.renderer,L=>this.updatingHandles.addPromise(this.graphicsCore.rendererChange(L)));
this.updatingHandles.add(()=>H.fullOpacity,()=>this.graphicsCore.opacityChange());this._setupSuspendResumeExtent();this.updateClippingExtent&&(this.updatingHandles.add(()=>H.view.clippingArea,()=>this._updateClippingExtent()),this._updateClippingExtent());this.graphicsCore.startCreateGraphics();this.graphicsCore.labelsEnabled&&(yield d.logOnError(this.graphicsCore.updateLabelingInfo()))});return function(){return G.apply(this,arguments)}}();I.destroy=function(){this.handles.removeAll();this.updatingHandles.removeAll();
this._set("frustumVisibility",m.destroyMaybe(this.frustumVisibility));this._set("graphicsCore",m.destroyMaybe(this.graphicsCore));this._set("owner",null)};I.maskOccludee=function(G){const {set:H,handle:L}=this.objectStates.acquireSet(K.Object3DState.MaskOccludee,null);this.objectStates.setUid(H,G.uid);return L};I.highlight=function(G,H){if(G instanceof z){const {set:L,handle:O}=this.objectStates.acquireSet(K.Object3DState.Highlight,H);this.owner.queryObjectIds(G).then(S=>this.objectStates.setObjectIds(L,
S));return O}if("number"===typeof G||"string"===typeof G||G instanceof b)return this.highlight([G],H);"toArray"in G&&(G=G.toArray());if(Array.isArray(G)&&0<G.length){if(G[0]instanceof b)if(null!=F.attributeLookup(this.layer.fieldsIndex,G[0].attributes,H))G=G.map(L=>F.attributeLookup(this.layer.fieldsIndex,L.attributes,H));else{G=G.map(S=>S.uid);const {set:L,handle:O}=this.objectStates.acquireSet(K.Object3DState.Highlight,null);this.objectStates.setUids(L,G);return O}if("number"===typeof G[0]||"string"===
typeof G[0]){const {set:L,handle:O}=this.objectStates.acquireSet(K.Object3DState.Highlight,H);this.objectStates.setObjectIds(L,G);return O}}return M};I.resetObjectStates=function(){this.objectStates.reset()};I.whenGraphicBounds=function(G,H){return this.graphicsCore?.whenGraphicBounds(G,H)};I.computeAttachmentOrigin=function(G,H){return this.graphicsCore?.computeAttachmentOrigin(G,H)};I.notifyGraphicGeometryChanged=function(G){this.graphicsCore.notifyGraphicGeometryChanged(G)};I.notifyGraphicVisibilityChanged=
function(G){this.graphicsCore.notifyGraphicVisibilityChanged(G)};I.getRenderingInfo=function(G,H,L){L=p.getRenderingInfo(G,{renderer:H,arcade:L});if(m.isSome(L)&&L.color){const O=L.color;O[0]/=255;O[1]/=255;O[2]/=255}m.isSome(L)&&m.isSome(H)&&this._randomRotationRenderers?.has(H)&&(H=this._randomRotationRenderers.get(H),G=G.attributes[H],H=new t.XXH(0),H.updateFloatArray([G]),H.updateUint8Array([173]),L.heading=8.381E-8*H.digest());return L};I.getRenderingInfoAsync=function(G,H,L,O){return p.getRenderingInfoAsync(G,
{renderer:H,arcade:L,...O})};I.getSymbolLayerSize=function(G,H){return this.graphicsCore?.getSymbolLayerSize(G,H)};I.setObjectIdVisibility=function(G,H){this.graphicsCore?.setObjectIdVisibility(G,H)};I.refreshFilter=function(){m.isSome(this.filterVisibility)&&this.filterVisibility.reapply()};I.getGraphics3DGraphicByObjectId=function(G){return this.graphicsCore?.getGraphics3DGraphicByObjectId(G)};I._updateClippingExtent=function(){const G=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(G,
this.owner.view.spatialReference)&&(this.updateClippingExtent(G)||this.graphicsCore.recreateAllGraphics())};I._setupSuspendResumeExtent=function(){(this.frustumVisibility||this.scaleVisibility)&&this.handles.add(f.watch(()=>this.suspendResumeExtentMode,()=>{this.handles.remove("suspendResumeExtentMode");switch(this.suspendResumeExtentMode){case "computed":this.handles.add([f.watch(()=>this.graphicsCore.computedExtent,G=>this._updateSuspendResumeExtent(G),f.initial),f.watch(()=>this.graphicsCore.extentPadding,
()=>this._updateSuspendResumeExtent(this.graphicsCore.computedExtent))],"suspendResumeExtentMode");break;case "data":this.handles.add([f.when(()=>this.dataExtent,G=>this._updateSuspendResumeExtent(G),f.initial),f.watch(()=>this.graphicsCore.extentPadding,()=>this._updateSuspendResumeExtent(m.unwrap(this.dataExtent)))],"suspendResumeExtentMode");break;default:n.neverReached(this.suspendResumeExtentMode)}},f.initial))};I._updateSuspendResumeExtent=function(G){G?this._suspendResumeExtentChanged(this._extentToSuspendResumeRect(G,
this._suspendResumeExtent)):this._suspendResumeExtentChanged(null)};I._extentToSuspendResumeRect=function(G,H){const L=this.owner.view.spatialReference;if(!G.spatialReference.equals(L)){if(!q.canProject(G,L))return;G=q.project(G,L)}return D.enlargeExtent(G,H,B.SUSPEND_RESUME_EXTENT_OPTIMISM,this.graphicsCore.extentPadding)};I._suspendResumeExtentChanged=function(G){m.isSome(this.frustumVisibility)&&this.frustumVisibility.setExtent(G);m.isSome(this.scaleVisibility)&&this.scaleVisibility.setExtent(G)};
a._createClass(P,[{key:"layer",get:function(){return this.owner.layer}},{key:"renderer",get:function(){const {renderer:G,objectIdField:H}=this.layer;if(!G||!H||"heatmap"===G.type||!G.visualVariables)return G;const L=G.visualVariables.findIndex(S=>"rotation"===S.type&&null!=S.valueExpression&&k.matchRandomRotationExpression(S.valueExpression)===H&&(null==S.axis||"heading"===S.axis)&&"geographic"===S.rotationType);if(0>L)return G;const O=G.clone();O.visualVariables.splice(L,1);this._randomRotationRenderers||
(this._randomRotationRenderers=new WeakMap);this._randomRotationRenderers.set(O,H);return O}},{key:"scaleVisibility",get:function(){return this.graphicsCore?.scaleVisibility}},{key:"filterVisibility",get:function(){return this.graphicsCore?.filterVisibility}},{key:"elevationAlignment",get:function(){return this.graphicsCore?.elevationAlignment}},{key:"objectStates",get:function(){return this.graphicsCore?.objectStates}},{key:"suspendResumeExtentMode",get:function(){return"suspendResumeExtentMode"in
this.owner?this.owner.suspendResumeExtentMode:"computed"}},{key:"scaleVisibilitySuspended",get:function(){return m.isSome(this.scaleVisibility)&&this.scaleVisibility.suspended}},{key:"suspended",get:function(){return this.owner.suspended}},{key:"legendEnabled",get:function(){return m.isNone(this.frustumVisibility)||!this.frustumVisibility.suspended}},{key:"suspendInfo",get:function(){const G={};this.scaleVisibilitySuspended&&(G.outsideScaleRange=!0);m.isSome(this.frustumVisibility)&&this.frustumVisibility.suspended&&
(G.outsideOfView=!0);return G}},{key:"updating",get:function(){return!!(this.graphicsCore?.updating||m.isSome(this.frustumVisibility)&&this.frustumVisibility.updating||this.updatingHandles?.updating)}},{key:"updatingRemaining",get:function(){return this.graphicsCore?.updatingRemaining??0}},{key:"featureStore",get:function(){return this.graphicsCore?.featureStore}},{key:"view",get:function(){return this.owner.view}},{key:"loadedGraphics",get:function(){return this.owner.loadedGraphics}},{key:"fullOpacity",
get:function(){return this.owner?.fullOpacity}},{key:"filter",get:function(){return"filter"in this.owner?this.owner.filter:null}},{key:"slicePlaneEnabled",get:function(){return this.owner.slicePlaneEnabled}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"featureSpatialReference",get:function(){return"featureSpatialReference"in this.owner?this.owner.featureSpatialReference:this.owner.view.spatialReference}},{key:"graphics3DGraphics",get:function(){return this.graphicsCore?.graphics3DGraphics}},
{key:"graphics3DGraphicsByObjectID",get:function(){return this.graphicsCore?.graphics3DGraphicsByObjectID}},{key:"symbolUpdateType",get:function(){return this.graphicsCore?.symbolUpdateType}},{key:"displayFeatureLimit",get:function(){const G=this.view.resourceController.memoryController.memoryFactor,H=this.graphicsCore?.displayFeatureLimit;return 1===G?H:{...H,maximumNumberOfFeatures:Math.ceil(H.maximumNumberOfFeatures*G),maximumTotalNumberOfFeatures:Math.ceil(H.maximumTotalNumberOfFeatures*G),minimumTotalNumberOfFeatures:Math.ceil(H.minimumTotalNumberOfFeatures*
G)}}},{key:"usedMemory",get:function(){return this.graphicsCore?.usedMemory??0}},{key:"loadedFeatures",get:function(){return this.graphicsCore?.numberOfGraphics??0}},{key:"usedMemoryPerFeature",get:function(){return this.graphicsCore?.usedMemoryPerGraphic??0}},{key:"unprocessedMemoryEstimate",get:function(){return this.graphicsCore?.unprocessedMemoryEstimate??0}},{key:"performanceInfo",get:function(){return{core:this.graphicsCore.performanceInfo,elevationUpdating:this.elevationAlignment.updating,
visibilityFrustum:m.isNone(this.frustumVisibility)||!this.frustumVisibility.suspended,visibilityScale:!this.scaleVisibilitySuspended}}}]);return P}(r.HandleOwner);c.__decorate([e.property()],r.prototype,"type",void 0);c.__decorate([e.property({constructOnly:!0})],r.prototype,"owner",void 0);c.__decorate([e.property()],r.prototype,"layer",null);c.__decorate([e.property()],r.prototype,"renderer",null);c.__decorate([e.property({constructOnly:!0})],r.prototype,"updateClippingExtent",void 0);c.__decorate([e.property({constructOnly:!0})],
r.prototype,"elevationFeatureExpressionEnabled",void 0);c.__decorate([e.property({constructOnly:!0})],r.prototype,"graphicsCore",void 0);c.__decorate([e.property({constructOnly:!0})],r.prototype,"scaleVisibilityEnabled",void 0);c.__decorate([e.property({constructOnly:!0})],r.prototype,"filterVisibilityEnabled",void 0);c.__decorate([e.property({constructOnly:!0})],r.prototype,"frustumVisibilityEnabled",void 0);c.__decorate([e.property({constructOnly:!0})],r.prototype,"elevationAlignmentEnabled",void 0);
c.__decorate([e.property({constructOnly:!0})],r.prototype,"timeExtentEnabled",void 0);c.__decorate([e.property({constructOnly:!0})],r.prototype,"setUidToIdOnAdd",void 0);c.__decorate([e.property()],r.prototype,"scaleVisibility",null);c.__decorate([e.property()],r.prototype,"filterVisibility",null);c.__decorate([e.property()],r.prototype,"elevationAlignment",null);c.__decorate([e.property({constructOnly:!0})],r.prototype,"frustumVisibility",void 0);c.__decorate([e.property()],r.prototype,"objectStates",
null);c.__decorate([e.property()],r.prototype,"initializePromise",void 0);c.__decorate([e.property()],r.prototype,"suspendResumeExtentMode",null);c.__decorate([e.property()],r.prototype,"dataExtent",void 0);c.__decorate([e.property()],r.prototype,"scaleVisibilitySuspended",null);c.__decorate([e.property()],r.prototype,"suspended",null);c.__decorate([e.property()],r.prototype,"legendEnabled",null);c.__decorate([e.property()],r.prototype,"suspendInfo",null);c.__decorate([e.property()],r.prototype,"updating",
null);c.__decorate([e.property()],r.prototype,"updatingRemaining",null);c.__decorate([e.property()],r.prototype,"featureStore",null);c.__decorate([e.property()],r.prototype,"view",null);c.__decorate([e.property()],r.prototype,"loadedGraphics",null);c.__decorate([e.property()],r.prototype,"fullOpacity",null);c.__decorate([e.property()],r.prototype,"filter",null);c.__decorate([e.property()],r.prototype,"slicePlaneEnabled",null);c.__decorate([e.property()],r.prototype,"drapeSourceType",void 0);c.__decorate([e.property()],
r.prototype,"updatePolicy",null);c.__decorate([e.property()],r.prototype,"preferredUpdatePolicy",void 0);c.__decorate([e.property()],r.prototype,"displayFeatureLimit",null);r=c.__decorate([l.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureProcessor")],r);const M={remove(){},pause(){},resume(){}};return r})},"esri/arcade/functions/hash":function(){define(["exports"],function(a){function c(t){const n=[];for(let r=0,m=t.length;r<m;r++){let d=t.charCodeAt(r);128>d?n.push(d):2048>d?n.push(192|
d>>6,128|d&63):55296>d||57344<=d?n.push(224|d>>12,128|d>>6&63,128|d&63):(r++,d=65536+((d&1023)<<10|t.charCodeAt(r)&1023),n.push(240|d>>18,128|d>>12&63,128|d>>6&63,128|d&63))}return new Uint8Array(n)}let b=function(){function t(r){this._seed=r;this._totallen=0;this._bufs=[];this.init()}var n=t.prototype;n.init=function(){this._bufs=[];this._totallen=0;return this};n.updateFloatArray=function(r){const m=[];for(const d of r)isNaN(d)?m.push("NaN"):Infinity===d?m.push("Infinity"):-Infinity===d?m.push("-Infinity"):
0===d?m.push("0"):m.push(d.toString(16));this.update(c(m.join("")))};n.updateIntArray=function(r){r=Int32Array.from(r);this.update(new Uint8Array(r.buffer))};n.updateUint8Array=function(r){this.update(Uint8Array.from(r))};n.updateWithString=function(r){return this.update(c(r))};n.update=function(r){this._bufs.push(r);this._totallen+=r.length;return this};n.digest=function(){const r=new Uint8Array(this._totallen);let m=0;for(const d of this._bufs)r.set(d,m),m+=d.length;this.init();return this._xxHash32(r,
this._seed)};n._xxHash32=function(r,m=0){var d=m+374761393&4294967295;let f=0;if(16<=r.length){d=[m+2654435761+2246822519&4294967295,m+2246822519&4294967295,m+0&4294967295,m-2654435761&4294967295];m=r.length-16;var e=0;for(f=0;(f&4294967280)<=m;f+=4){var g=f;g=d[e]+(2246822519*(r[g+0]+(r[g+1]<<8))+(2246822519*(r[g+2]+(r[g+3]<<8))<<16))&4294967295;g=g<<13|g>>>19;d[e]=2654435761*(g&65535)+(2654435761*(g>>>16)<<16)&4294967295;e=e+1&3}d=(d[0]<<1|d[0]>>>31)+(d[1]<<7|d[1]>>>25)+(d[2]<<12|d[2]>>>20)+(d[3]<<
18|d[3]>>>14)&4294967295}d=d+r.length&4294967295;for(m=r.length-4;f<=m;f+=4)e=f,d=d+(3266489917*(r[e+0]+(r[e+1]<<8))+(3266489917*(r[e+2]+(r[e+3]<<8))<<16))&4294967295,d=d<<17|d>>>15,d=668265263*(d&65535)+(668265263*(d>>>16)<<16)&4294967295;for(;f<r.length;++f)d+=374761393*r[f],d=d<<11|d>>>21,d=2654435761*(d&65535)+(2654435761*(d>>>16)<<16)&4294967295;d^=d>>>15;d=(2246822519*(d&65535)&4294967295)+(2246822519*(d>>>16)<<16);d^=d>>>13;d=(3266489917*(d&65535)&4294967295)+(3266489917*(d>>>16)<<16);d^=d>>>
16;return 0>d?d+4294967296:d};return t}();a.XXH=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../renderers/ClassBreaksRenderer ../../../../renderers/DictionaryRenderer ../../../../renderers/DotDensityRenderer ../../../../renderers/HeatmapRenderer ../../../../renderers/PieChartRenderer ../../../../renderers/Renderer ../../../../renderers/SimpleRenderer ../../../../renderers/UniqueValueRenderer ../../../../renderers/support/jsonUtils ../../../../symbols ../../../../core/Accessor ../../../../core/has ../../../../core/Error ../../../../core/Handles ../../../../core/handleUtils ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/accessorSupport/diffUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../../../renderers/support/rendererConversion ../../../../support/arcadeOnDemand ../../../../symbols/support/defaults3D ../../../../symbols/support/symbolConversion ./ElevationQuery ./enums ./featureExpressionInfoUtils ./Graphics3DFeatureStore ./Graphics3DGraphicCreationContext ./Graphics3DSymbolCreationContext ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./GraphicStateTracking ./graphicUtils ./interfaces ./Loadable ./SpatialIndex2D ./symbolComplexity ../support/StageLayerElevationProvider ../../support/extentUtils ../../support/PropertiesPool ../../webgl-engine/lib/GridLocalOriginFactory ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler ../../../../geometry/Extent ../../../../geometry/Point ../../../../symbols/LabelSymbol3D ../../../../symbols/TextSymbol ../../../../symbols/WebStyleSymbol".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V,aa,X,W,T,U,Y,ba,da,ea,ca,ja,ia,Z,ha,fa,ka,la,na,pa,va,wa,za,sa,ua,oa,xa,Ea,Ia){var Na;const Oa=P.create(),Ja=G.create(),Sa=B.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");a.Graphics3DCore=Na=function(Qa){function Aa(qa){var ya=Qa.call(this,qa)||this;ya._propertiesPool=new pa.PropertiesPool({computedExtent:ua},c._assertThisInitialized(ya));ya.computedExtent=null;ya.currentRenderer=null;ya.rendererHasGeometryOperations=
!1;ya._graphicStateTracking=null;ya.graphics3DGraphics=new Map;ya.stageLayer=null;ya.stage=null;ya._graphicsDrapedUids=new Set;ya._graphicsBySymbol=new Map;ya._symbolConversionCache=new Map;ya._symbols=new Map;ya._graphicsWithoutSymbol=new Map;ya._graphicsWaitingForSymbol=new Map;ya._graphicsUpdateId=0;ya._handles=new z;ya._frameTask=sa.ImmediateTask;ya._suspendSymbolCleanup=!1;ya._arcadeOnDemand=null;ya._rendererChangeAbortController=null;ya._elevationInfoChangeAbortController=null;ya._initializeAbortController=
null;ya._scaleVisibility=null;ya._filterVisibility=null;ya._spatialIndex=null;ya.extentPadding=0;ya._updatingPendingLoadedGraphicsChange=null;ya._featureStore=null;ya._deconflictor=null;ya._labeler=null;ya._objectStates=null;ya._viewElevationProvider=null;ya._stageLayerElevationProvider=null;ya._sharedSymbolResourcesOwnerHandle=null;ya._whenGraphics3DGraphicRequests={};ya._pendingUpdates=new Map;ya._numberOfGraphics=0;ya._numberOfGraphicsProvidingElevation=0;ya._pendingAdds=0;ya._pendingRemoves=0;
ya._applyPendingRemovesFirst=!1;ya._loadingSymbols=0;ya._pendingUpdatesPool=new u({allocator:Da=>Da||new Za,deallocator:Da=>{Da.clear();return Da}});ya._symbolWarningLogged=!1;ya._geometryWarningLogged=!1;ya._objectIdInvisibleSet=new Set;ya._whenSymbolRemoved=new u;ya.preferredUpdatePolicy=wa.UpdatePolicy.SYNC;ya._forcedUpdatePolicy=null;ya.elevationFeatureExpressionEnabled=!0;ya.owner=null;ya.layer=null;ya.graphicSymbolSupported=!0;ya.getRenderingInfoWithoutRenderer=!1;ya.setUidToIdOnAdd=!0;ya.hasZ=
null;ya.hasM=null;ya._usedMemory=0;ya._visible=!1;ya._startCreateGraphics=!1;ya.symbolCreationContext=new da.Graphics3DSymbolCreationContext(qa.owner.view.resourceController.scheduler,(Da,La)=>ya._frameTask.schedule(Da,La));return ya}c._inheritsLoose(Aa,Qa);var Ca=Aa.prototype;Ca._getConvertedSymbol=function(qa){if("web-style"===qa.type)return qa.clone();var ya=this._symbolConversionCache.get(qa.id);if(x.isSome(ya))return ya;ya=X.to3D(qa,{geometryType:this.layer?.geometryType??void 0,retainId:!0,
hasLabelingContext:this._hasLabelingContext(qa)});const Da=ya.symbol||null;x.isNone(Da)&&ya.error&&Sa.error(ya.error.message);this._symbolConversionCache.set(qa.id,Da);return Da};Ca._getSymbolComplexitiesUsedOrRenderer=function(qa){if(x.isNone(qa))return[];var ya=qa.getSymbols(),Da="backgroundFillSymbol"in qa?qa.backgroundFillSymbol:null;if(!(Da||ya&&ya.length))return[];qa=[];Da=this._getSymbolComplexityUsedOrRenderer(Da);x.isSome(Da)&&qa.push(Da);for(const La of ya)ya=this._getSymbolComplexityUsedOrRenderer(La),
x.isSome(ya)&&qa.push(ya);return qa};Ca._getSymbolComplexityUsedOrRenderer=function(qa){if(x.isNone(qa))return null;const ya=this._symbols.get(qa.id);if(x.isSome(ya))return ya.complexity;qa=this._getConvertedSymbol(qa);return x.isSome(qa)?ka.defaultSymbolComplexity(qa):null};Ca._getSymbolComplexitiesUsed=function(){const qa=[];this._symbols.forEach(ya=>{x.isSome(ya)&&qa.push(ya.complexity)});return qa};Ca.initialize=function(){this._featureStore=new Y.Graphics3DFeatureStore({objectIdField:this.owner.layer&&
this.owner.layer.objectIdField,hasZ:!!this.hasZ,hasM:!!this.hasM,viewSpatialReference:this._viewSpatialReference,featureSpatialReference:this.owner.featureSpatialReference,getSpatialIndex:()=>this.spatialIndex,forEach:Da=>this.graphics3DGraphics.forEach(Da)});const qa=(Da,La,Ta)=>this.spatialIndex.queryGraphicUIDsInExtent(Da,La,Ta),{componentFactories:ya}=this;x.isSome(ya.elevationAlignment)&&(this._elevationAlignment=ya.elevationAlignment(this,qa));x.isSome(ya.scaleVisibility)&&(this._scaleVisibility=
ya.scaleVisibility(this,qa));x.isSome(ya.filterVisibility)&&(this._filterVisibility=ya.filterVisibility({featureStore:this._featureStore,getFeatureCount:()=>this.graphics3DGraphics.size,updateFeatureVisibilities:Da=>this.modifyGraphics3DGraphicVisibilities(La=>La.setVisibilityFlag(T.VisibilityFlag.FILTER,Da(S.getObjectId(La.graphic,this._objectIdField)),T.VisibilityGroup.GRAPHIC)),setAllFeaturesVisibility:Da=>this.modifyGraphics3DGraphicVisibilities(La=>La.setVisibilityFlag(T.VisibilityFlag.FILTER,
Da,T.VisibilityGroup.GRAPHIC)),clearFeaturesVisibility:()=>this.modifyGraphics3DGraphicVisibilities(Da=>Da.clearVisibilityFlag(T.VisibilityFlag.FILTER))}));x.isSome(ya.deconflictor)&&(this._deconflictor=ya.deconflictor(this));x.isSome(ya.labeler)&&x.isSome(this._scaleVisibility)&&(this._labeler=ya.labeler(this,this._scaleVisibility));x.isSome(ya.objectStates)&&(this._objectStates=ya.objectStates(this));this._initializeAbortController=new AbortController;this._initializePromise=this._initializeAsync()};
Ca._initializeAsync=function(){var qa=c._asyncToGenerator(function*(){const ya=this._initializeAbortController?.signal,Da=this.owner.view;this._viewElevationProvider=new W.ViewElevationProvider(this._viewSpatialReference,Da);this._initializeStage(Da,this.layer.uid);var La=Da.sharedSymbolResources;this.symbolCreationContext.sharedResources=La;this._sharedSymbolResourcesOwnerHandle=La.addGraphicsOwner(this.owner);x.isSome(this.currentRenderer)&&(this.symbolCreationContext.renderer=this.currentRenderer);
this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataRequester=La.streamDataRequester;this.symbolCreationContext.renderCoordsHelper=Da.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.graphicsCoreOwner=this.owner;this.symbolCreationContext.localOriginFactory=new va.GridLocalOriginFactory(Da.renderSpatialReference);this.symbolCreationContext.elevationProvider=Da.elevationProvider;this.symbolCreationContext.notifyGraphicGeometryChanged=
Ta=>this.notifyGraphicGeometryChanged(Ta);this.symbolCreationContext.notifyGraphicVisibilityChanged=Ta=>this.notifyGraphicVisibilityChanged(Ta);La=U.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=yield U.createContext(La,this._viewSpatialReference,ya,Sa);y.throwIfAborted(ya);this.symbolCreationContext.screenSizePerspectiveEnabled=Da.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;
this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.symbolCreationContext.physicalBasedRenderingEnabled=!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled;this.symbolCreationContext.skipHighSymbolLods=!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods;if("drapeSourceType"in this.owner){const {owner:Ta}=this;this.symbolCreationContext.drapeSourceRenderer=Da.basemapTerrain.overlayManager.registerGeometryDrapeSource(Ta);this._handles.add(C.makeHandle(()=>
Da.basemapTerrain.overlayManager.unregisterDrapeSource(Ta)))}this._handles.add([w.watch(()=>this.suspendedOrOutsideOfView,()=>this._frameTask.reschedule(()=>this._updateLayerVisibility())),w.watch(()=>[this.layer?.screenSizePerspectiveEnabled,this.owner.view.screenSizePerspectiveEnabled],()=>{const Ta=Da.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;Ta!==this.symbolCreationContext.screenSizePerspectiveEnabled&&(this.symbolCreationContext.screenSizePerspectiveEnabled=Ta,this._labeler?.reset(),
this.recreateAllGraphicsAndSymbols())}),w.watch(()=>this.owner.slicePlaneEnabled,Ta=>this._slicePlaneEnabledChange(!!Ta)),w.watch(()=>this.owner.view.state?.rasterPixelRatio,()=>this._pixelRatioChange()),w.watch(()=>!!this.owner.view.qualitySettings?.physicallyBasedRenderingEnabled,Ta=>this._physicalBasedRenderingChange(Ta)),w.watch(()=>!!this.owner.view.qualitySettings?.graphics3D?.skipHighSymbolLods,Ta=>this._skipHighSymbolLoDsChange(Ta)),w.when(()=>Da.basemapTerrain?.tilingScheme,Ta=>{!Ta.spatialReference.equals(this.symbolCreationContext.overlaySR)&&
x.isSome(Da.basemapTerrain.spatialReference)&&(this.symbolCreationContext.overlaySR=Da.basemapTerrain.spatialReference);this._handles.has("loaded-graphics")?this.recreateAllGraphics():this._handles.add([w.on(()=>this.owner?.loadedGraphics,"change",Xa=>{this._graphicsCollectionChanged(Xa);this._signalUpdatingDuringAsyncLoadedGraphicsChange()},{onListenerAdd:()=>{this.recreateAllGraphics();this._signalUpdatingDuringAsyncLoadedGraphicsChange()}})],"loaded-graphics")},{initial:!0}),w.watch(()=>this.effectiveUpdatePolicy,
Ta=>{x.isSome(this.stageLayer)&&(this.stageLayer.updatePolicy=Ta);this.symbolCreationContext.isAsync=this.effectiveUpdatePolicy===wa.UpdatePolicy.ASYNC;Ta===wa.UpdatePolicy.SYNC&&this.runTask(sa.noBudget)},w.syncAndInitial)]);this._frameTask=Da.resourceController.scheduler.registerTask(sa.TaskPriority.GRAPHICS_CORE,this);this.layer&&"featureReduction"in this.layer&&this._handles.add(w.watch(()=>this.layer.featureReduction,()=>this._deconflictor.featureReductionChange()));this.notifyChange("averageSymbolComplexity");
this.rendererChange(this.owner.renderer).catch(()=>{});this._initializeAbortController=null});return function(){return qa.apply(this,arguments)}}();Ca._abortInitialize=function(){this._initializeAbortController&&(this._initializeAbortController.abort(),this._initializeAbortController=null)};Ca.destroy=function(){this._abortInitialize();this._abortRendererChange();this._abortElevationInfoChange();this._frameTask.remove();this._frameTask=sa.ImmediateTask;this.owner.view.deconflictor.removeGraphicsOwner(this);
this.owner.view.labeler.removeGraphicsOwner(this);this._elevationAlignment=x.destroyMaybe(this._elevationAlignment);this._scaleVisibility=x.destroyMaybe(this._scaleVisibility);this._filterVisibility=x.destroyMaybe(this._filterVisibility);this._labeler=this._deconflictor=null;this._objectStates=x.destroyMaybe(this._objectStates);this.clear();this._featureStore=x.destroyMaybe(this._featureStore);this._updatingPendingLoadedGraphicsChange=x.removeMaybe(this._updatingPendingLoadedGraphicsChange);this._graphicStateTracking=
x.destroyMaybe(this._graphicStateTracking);this.stage&&(this.stage.remove(this.stageLayer),this.stage=this.stageLayer=null);this._handles=x.destroyMaybe(this._handles);this._set("owner",null);for(const qa in this._whenGraphics3DGraphicRequests)this._whenGraphics3DGraphicRequests[qa].reject(new p("graphic:layer-destroyed","Layer has been destroyed"));this._whenGraphics3DGraphicRequests=null;this._sharedSymbolResourcesOwnerHandle=x.removeMaybe(this._sharedSymbolResourcesOwnerHandle);this._propertiesPool=
x.destroyMaybe(this._propertiesPool);this._pendingUpdatesPool=null;this._symbolConversionCache.clear();this._objectIdInvisibleSet.clear();this._spatialIndex=x.destroyMaybe(this._spatialIndex)};Ca.clear=function(){this._objectStates?.allGraphicsDeleted();x.isSome(this._graphicStateTracking)&&this._graphicStateTracking.allGraphicsDeleted();this.graphics3DGraphics.forEach(qa=>qa.destroy());this._spatialIndex?.clear();this.graphics3DGraphics.clear();this._usedMemory=this._numberOfGraphics=0;this._updateLayerVisibility();
this._symbols.forEach(x.destroyMaybe);this._symbols.clear();this._graphicsBySymbol.clear();this._graphicsWithoutSymbol.clear();this._graphicsWaitingForSymbol.clear();this._pendingUpdates.clear();this._pendingUpdatesPool.clear();this._pendingRemoves=this._pendingAdds=0;this._applyPendingRemovesFirst=!1;this.notifyChange("updating");this.notifyChange("running");this.notifyChange("updatingRemaining");this._featureStore.events.emit("changed")};Ca._initializeStage=function(qa,ya){this.stage=qa._stage;
this.stageLayer=new za.WebGLLayer({pickable:!this.suspendedOrOutsideOfView,updatePolicy:this.effectiveUpdatePolicy},ya);this.stage.add(this.stageLayer);qa=this.stageLayer.events;qa.on("objectTransformation",Da=>this.notifyGraphicGeometryChanged(Da.metadata.graphicUid));qa.on("visibilityChanged",Da=>this.notifyGraphicVisibilityChanged(Da.metadata.graphicUid));qa.on("objectGeometryAdded",Da=>this.notifyGraphicGeometryChanged(Da.object.metadata.graphicUid));qa.on("objectGeometryRemoved",Da=>this.notifyGraphicGeometryChanged(Da.object.metadata.graphicUid));
qa.on("objectGeometryUpdated",Da=>this.notifyGraphicGeometryChanged(Da.object.metadata.graphicUid))};Ca.notifyGraphicGeometryChanged=function(qa){x.isNone(this._graphicStateTracking)||x.isNone(qa)||(qa=this.graphics3DGraphics.get(qa))&&this._graphicStateTracking.updateGraphicGeometry(qa)};Ca.notifyGraphicVisibilityChanged=function(qa){x.isNone(this._graphicStateTracking)||x.isNone(qa)||(qa=this.graphics3DGraphics.get(qa))&&this._graphicStateTracking.updateGraphicVisibility(qa)};Ca._updateLayerVisibility=
function(){var qa=this._numberOfGraphics>10*this.displayFeatureLimit.maximumNumberOfFeatures;qa=!this.suspendedOrOutsideOfView&&!qa;qa!==this._visible&&((this._visible=qa)?(this.stageLayer.pickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.pickable=!1,this._hideAllGraphics()),this._updateStageLayerVisibility())};Ca._updateStageLayerVisibility=function(){this.stageLayer.visible=this._visible&&(null==this.layer.opacity||0<this.layer.opacity)};Ca.getGraphics3DGraphicById=function(qa){return null!=
qa?this.graphics3DGraphics.get(qa):void 0};Ca.getGraphics3DGraphicByObjectId=function(qa){return this.owner.layer?.objectIdField?this._findGraphics3DGraphicByObjectId(qa):null};Ca._getGraphicObjectID=function(qa,ya=this.owner.layer&&this.owner.layer.objectIdField){return S.getObjectId(qa,ya)};Ca.updateLabelingInfo=function(){var qa=c._asyncToGenerator(function*(ya){const Da=this._deconflictor&&this._deconflictor.labelingInfoChange(ya);ya=this._labeler&&this._labeler.labelingInfoChange(ya);yield y.eachAlways([Da,
ya])});return function(ya){return qa.apply(this,arguments)}}();Ca.updateVisibilityInfo=function(){this._deconflictor&&this._deconflictor.labelingInfoChange();this._labeler&&this._labeler.visibilityInfoChange()};Ca.runTask=function(qa){this._frameTask.processQueue(qa);this._applyPendingUpdates(qa);this.notifyChange("running");this.running||this.notifyChange("updating");this.notifyChange("updatingRemaining");if(!qa.hasProgressed)return sa.Task.YIELD};Ca.setObjectIdVisibility=function(qa,ya){ya?this._objectIdInvisibleSet.delete(qa):
this._objectIdInvisibleSet.add(qa);qa=this._findGraphics3DGraphicByObjectId(qa);x.isSome(qa)&&this._updateUserVisibility(qa)};Ca._findGraphics3DGraphicByObjectId=function(qa){return A.findInMap(this.graphics3DGraphics,ya=>this._getGraphicObjectID(ya.graphic)===qa)};Ca._updateUserVisibility=function(qa){if(x.isNone(qa))return!1;var ya=qa.graphic;const Da=this._getGraphicObjectID(ya);ya=ya.visible&&!this.owner.suspended&&(x.isNone(Da)||!this._objectIdInvisibleSet.has(Da));return qa.setVisibilityFlag(T.VisibilityFlag.USER_SETTING,
ya,T.VisibilityGroup.GRAPHIC)};Ca._whenGraphics3DGraphic=function(qa){var ya=this.graphics3DGraphics.get(qa.uid);if(ya)return Promise.resolve(ya);if(ya=this._whenGraphics3DGraphicRequests[qa.uid])return ya.promise;ya=y.createDeferred();this._whenGraphics3DGraphicRequests[qa.uid]=ya;return ya.promise};Ca._boundsForGraphics3DGraphic=function(){var qa=c._asyncToGenerator(function*(ya,Da){const La=this._viewSpatialReference,Ta=this.owner.view.renderSpatialReference,Xa=this.owner.view.basemapTerrain.spatialReference;
var db=this._viewElevationProvider?{service:this._viewElevationProvider,useViewElevation:x.isSome(Da)?!!Da.useViewElevation:!1,minDemResolution:x.isSome(Da)?Da.minDemResolution:null,minDemResolutionForPoints:this.owner.view.resolution}:null;ya=yield ya.getProjectedBoundingBox((fb,jb,lb)=>I.projectBuffer(fb,Ta,jb,fb,La,jb,lb),(fb,jb,lb)=>I.projectBuffer(fb,Xa,jb,fb,La,jb,lb),db,x.get(Da,"signal"));if(!ya)return null;Da=ya.boundingBox;ya.requiresDrapedElevation&&(db=this.symbolCreationContext.elevationProvider)&&
(G.center(Da,Oa),db=x.unwrapOr(db.getElevation(Oa[0],Oa[1],0,La,"ground"),0),Da[2]=Math.min(Da[2],db),Da[5]=Math.max(Da[5],db));return{boundingBox:Da,screenSpaceObjects:ya.screenSpaceObjects}});return function(ya,Da){return qa.apply(this,arguments)}}();Ca.whenGraphicBounds=function(){var qa=c._asyncToGenerator(function*(ya,Da){yield w.whenOnce(()=>this.owner?.loadedGraphics);const La=this.owner.layer&&this.owner.layer.objectIdField;var Ta=this.owner.loadedGraphics.find(Xa=>Xa===ya?!0:null!=La&&null!=
Xa.attributes&&ya.attributes&&Xa.attributes[La]===ya.attributes[La]);if(!Ta)throw new p("internal:graphic-not-part-of-view","Graphic is not part of this view");Ta=yield this._whenGraphics3DGraphic(Ta);return this._boundsForGraphics3DGraphic(Ta,Da)});return function(ya,Da){return qa.apply(this,arguments)}}();Ca.computeAttachmentOrigin=function(qa,ya){qa=this.graphics3DGraphics.get(qa.uid);if(!qa)return null;var Da=qa.computeAttachmentOrigin();if(0===Da.render.num&&0===Da.draped.num)return null;N.set(ma,
0,0,0);qa=0;if(0<Da.render.num){if(!I.projectVectorToVector(Da.render.origin,this.symbolCreationContext.renderCoordsHelper.spatialReference,Ya,ya))return null;N.add(ma,ma,Ya);qa++}if(0<Da.draped.num){const [La,Ta]=Da.draped.origin;Da=x.unwrapOr(this._viewElevationProvider.getElevation(La,Ta,"ground"),0);N.set(Ya,La,Ta,Da);if(!I.projectVectorToVector(Ya,this._viewElevationProvider.spatialReference,Ya,ya))return null;N.add(ma,ma,Ya);qa++}1<qa&&N.scale(ma,ma,1/qa);return new oa({x:ma[0],y:ma[1],z:ma[2],
spatialReference:ya})};Ca.getSymbolLayerSize=function(qa,ya){var Da=this._symbols.get(qa.id);if(x.isNone(Da))throw new p("internal:symbol-not-part-of-view","Symbol is not part of this view");qa=qa.symbolLayers.indexOf(ya);if(-1===qa)throw new p("internal:missing-symbol-layer","Symbol layer is not in symbol");Da=Da.getSymbolLayerSize(qa);if(x.isNone(Da))throw new p("internal:missing-size","Symbol layer has no valid size");return Da};Ca._graphicsCollectionChanged=function(qa){this._startCreateGraphics&&
(this.add(qa.added),this.remove(qa.removed))};Ca.graphicUpdateHandler=function(qa){const ya=qa.graphic.uid,Da=this.graphics3DGraphics.get(ya);if(!x.isNone(Da)||!x.isNone(this._graphicsWithoutSymbol.get(ya)))switch(qa.property){case "visible":this._graphicUpdateVisibleHandler(Da);break;case "geometry":this._graphicUpdateGeometryHandler(Da,qa);break;case "symbol":this._graphicUpdateSymbolHandler(Da,qa);break;case "transform":this._graphicUpdateTransformHandler(Da,qa)}};Ca._graphicUpdateGeometryHandler=
function(qa,ya){const Da=ya.graphic.geometry;if(x.isNone(Da))this._recreateGraphic(ya.graphic);else if(x.isNone(qa)){if(qa=ya.graphic.symbol&&ya.graphic.symbol.id)if(qa=this._symbols.get(qa),x.isSome(qa)&&qa.loadStatus===ha.LoadStatus.LOADING)return;this._recreateGraphic(ya.graphic)}else{var La=qa.graphics3DSymbol;!x.isNone(ya.newValue)&&La.updateGeometry(qa,ya.newValue)||this._recreateGraphic(qa.graphic);this._expandComputedExtent(Da)}};Ca._graphicUpdateSymbolHandler=function(qa,ya){var Da=ya.graphic;
const La=x.isSome(qa)?qa.graphics3DSymbol:x.isSome(ya.oldValue)?this._symbols.get(ya.oldValue.id):null;if(x.isNone(La)||x.isNone(ya.newValue))this._recreateGraphic(Da);else{var Ta=La.symbol;ya=this._getConvertedSymbol(ya.newValue);if(x.isSome(ya)&&(ya.type!==Ta.type||"web-style"===ya.type)||"web-style"===Ta.type)this._recreateGraphic(Da);else{var Xa=this._graphicsBySymbol.get(Ta.id);if(Xa&&1!==Xa.size)this._recreateGraphic(Da);else if(Xa=M.diff(Ta,ya),x.isNone(Xa))this._updateSymbolMapping(Ta.id,
ya);else if(Xa={diff:Xa,graphics3DGraphicPatches:[],symbolStatePatches:[]},La.prepareSymbolPatch(Xa),M.isEmpty(Xa.diff)){var db=this._getRenderingInfo(Da);if(x.isNone(db))this._recreateGraphic(Da);else{Da=La.extentPadding;for(const fb of Xa.symbolStatePatches)fb();Da!==La.extentPadding&&this._recomputeExtentPadding();if(x.isSome(qa))for(const fb of Xa.graphics3DGraphicPatches)fb(qa,db);this._updateSymbolMapping(Ta.id,ya)}}else this._recreateGraphic(Da)}}};Ca._graphicUpdateVisibleHandler=function(qa){this._updateUserVisibility(qa)&&
(this._labeler&&this.owner.view.labeler.setDirty(),this.owner.view.deconflictor.setDirty())};Ca._graphicUpdateTransformHandler=function(qa,ya){};Ca.recreateGraphics=function(qa){this._suspendSymbolCleanup=!0;this.remove(qa);this.add(qa);this._suspendSymbolCleanup=!1;this.effectiveUpdatePolicy===wa.UpdatePolicy.SYNC&&this._cleanupSymbols()};Ca._recreateGraphic=function(qa){this.recreateGraphics([qa])};Ca._beginGraphicUpdate=function(qa){const ya=this._graphicsUpdateId;this._graphicsUpdateId++;this._graphicsWaitingForSymbol.set(qa.uid,
ya);1===this._graphicsWaitingForSymbol.size&&this.notifyChange("updating");return ya};Ca._endGraphicUpdate=function(qa){qa&&(this._graphicsWaitingForSymbol.delete(qa.uid),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating")))};Ca._recomputeExtentPadding=function(){let qa=0;this._symbols.forEach(ya=>{x.isSome(ya)&&(qa=Math.max(qa,ya.extentPadding))});this._set("extentPadding",qa)};Ca._expandComputedExtent=function(qa){var ya=qa.spatialReference;S.computeAABB(qa,
Ja);qa=this._viewSpatialReference;var Da=Na.tmpVec;!L.equals(ya,qa)&&I.projectXYZToVector(Ja[0],Ja[1],0,ya,Da,qa)&&(Ja[0]=Da[0],Ja[1]=Da[1],I.projectXYZToVector(Ja[3],Ja[4],0,ya,Da,qa),Ja[3]=Da[0],Ja[4]=Da[1]);if(isFinite(Ja[0])&&isFinite(Ja[3])&&isFinite(Ja[1])&&isFinite(Ja[4])){ya=this.computedExtent;Da=null;var La=isFinite(Ja[2])&&isFinite(Ja[5]),Ta=La&&(!ya||null==ya.zmin||Ja[2]<ya.zmin);La=La&&(!ya||null==ya.zmax||Ja[5]>ya.zmax);if(ya){if(Ja[0]<ya.xmin||Ja[1]<ya.ymin||Ja[3]>ya.xmax||Ja[4]>ya.ymax||
Ta||La)Da=this._propertiesPool.get("computedExtent"),Da.xmin=Math.min(Ja[0],ya.xmin),Da.ymin=Math.min(Ja[1],ya.ymin),Da.xmax=Math.max(Ja[3],ya.xmax),Da.ymax=Math.max(Ja[4],ya.ymax),Da.spatialReference=qa}else Da=this._propertiesPool.get("computedExtent"),Da.xmin=Ja[0],Da.ymin=Ja[1],Da.xmax=Ja[3],Da.ymax=Ja[4],Da.spatialReference=qa;Da&&(Ta&&(Da.zmin=Ja[2]),La&&(Da.zmax=Ja[5]),this._set("computedExtent",Da))}};Ca._abortElevationInfoChange=function(){this._elevationInfoChangeAbortController&&(this._elevationInfoChangeAbortController.abort(),
this._elevationInfoChangeAbortController=null)};Ca.elevationInfoChange=function(){var qa=c._asyncToGenerator(function*(){this._abortElevationInfoChange();const ya=new AbortController;this._elevationInfoChangeAbortController=ya;const Da=U.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=yield U.createContext(Da,this._viewSpatialReference,ya.signal,Sa);y.throwIfAborted(ya.signal);this._elevationInfoChangeAbortController=
null;this._labeler?.elevationInfoChange();this.forEachGraphics3DSymbol((La,Ta,Xa)=>{La.globalPropertyChanged("elevationInfo",Ta)?Ta.forEach(db=>{const fb=db.graphic;db=db.labelLayers;for(const jb of db)jb.graphics3DSymbolLayer.updateGraphicElevationContext(fb,jb)}):this._recreateSymbol(Xa)});this.updateStageLayerElevationProvider();this._elevationAlignment?.elevationInfoChange()});return function(){return qa.apply(this,arguments)}}();Ca.updateStageLayerElevationProvider=function(){if(this._stageLayerElevationProvider){if(this.layer.elevationInfo&&
"relative-to-scene"===this.layer.elevationInfo.mode||0===this._numberOfGraphicsProvidingElevation)this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),this._stageLayerElevationProvider=x.disposeMaybe(this._stageLayerElevationProvider)}else(!this.layer.elevationInfo||this.layer.elevationInfo&&"relative-to-scene"!==this.layer.elevationInfo.mode)&&0<this._numberOfGraphicsProvidingElevation&&(this._stageLayerElevationProvider=new la.StageLayerElevationProvider({layer:this.layer,
stageLayer:this.stageLayer,view:this.owner.view}),this.owner.view.elevationProvider.register("scene",this._stageLayerElevationProvider))};Ca._clearSymbolsAndGraphics=function(){this.clear();x.isSome(this._filterVisibility)&&this._filterVisibility.clear();this._labeler?.reset();this._deconflictor?.clear();this._elevationAlignment?.clear();this.stageLayer?.invalidateSpatialQueryAccelerator();this._stageLayerElevationProvider&&(this.owner.view.elevationProvider.unregister(this._stageLayerElevationProvider),
this._stageLayerElevationProvider=x.disposeMaybe(this._stageLayerElevationProvider))};Ca.startCreateGraphics=function(){this._startCreateGraphics=!0;this.recreateAllGraphics()};Ca.recreateAllGraphics=function(){this._recreateAllGraphics(!1)};Ca.recreateAllGraphicsAndSymbols=function(){this._recreateAllGraphics(!0)};Ca._recreateAllGraphics=function(qa=!1){if(this._startCreateGraphics){var {loadedGraphics:ya,view:Da}=this.owner,La=Da.basemapTerrain.tilingScheme&&ya&&ya.length?ya.toArray():null;!qa&&
La||this._clearSymbolsAndGraphics();this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&!!this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this._set("computedExtent",null);La&&(qa?this.add(La):this.recreateGraphics(La))}};Ca._recreateSymbol=function(qa){var ya=this._graphicsBySymbol.get(qa);const Da=[];ya&&(ya.forEach((La,Ta)=>{const Xa=La.usedMemory;this._conditionalRemove(La,Ta);
this._spatialIndex?.remove(La);Da.push(La.graphic);La.destroy();this._removeGraphics3DGraphic(Ta,Xa);this._updateLayerVisibility();this._featureStore.events.emit("changed")}),this._graphicsBySymbol.set(qa,new Map));ya=this._symbols.get(qa);x.destroyMaybe(ya);this._symbols.delete(qa);this.add(Da)};Ca._recreateGraphicsForSymbol=function(qa){if(qa=this._graphicsBySymbol.get(qa)){const ya=[];qa.forEach(Da=>ya.push(Da.graphic));this.recreateGraphics(ya)}};Ca._conditionalRemove=function(qa,ya){this._graphicsDrapedUids.delete(ya);
this._objectStates?.removeGraphic(qa);this._labeler?.removeGraphic(qa);this._deconflictor?.removeGraphic(qa);x.isSome(this._graphicStateTracking)&&this._graphicStateTracking.removeGraphic(qa)};Ca.add=function(qa){qa&&0!==qa.length&&(this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?(this._updatePolicyForGraphics(qa)===wa.UpdatePolicy.ASYNC?this._addDelayed(qa):this._addImmediate(qa),this.notifyChange("updating")):Sa.error("#add()","Cannot add graphics before terrain surface has been initialized"))};
Ca._updatePolicyForGraphics=function(qa){if(this.effectiveUpdatePolicy===wa.UpdatePolicy.SYNC&&("mesh"===this.layer.geometryType||null==this.layer.geometryType))for(const ya of qa)if(x.isSome(ya.geometry)&&"mesh"===ya.geometry.type&&!ya.geometry.loaded)return wa.UpdatePolicy.ASYNC;return this.effectiveUpdatePolicy};Ca._addImmediate=function(qa){this._symbolWarningLogged=this._geometryWarningLogged=!1;for(const ya of qa)this._addGraphic(ya,this._getRenderingInfo(ya,Sa),wa.UpdatePolicy.SYNC);this._cleanupSymbols();
this._labeler&&(this.owner.view.labeler.setDirty(),this._cleanupSymbols());this.owner.view.deconflictor.setDirty()};Ca._addDelayed=function(qa){for(const ya of qa){qa=ya.uid;let Da=this._pendingUpdates.get(qa);Da?Da.add?Da.state!==Ua.NEW&&Da.abortController?.abort():this._pendingAdds++:(Da=this._pendingUpdatesPool.pushNew(),this._pendingAdds++,this._pendingUpdates.set(qa,Da));Da.add=ya}this.notifyChange("running");this.notifyChange("updatingRemaining")};Ca.remove=function(qa){this.effectiveUpdatePolicy===
wa.UpdatePolicy.ASYNC?this._removeDelayed(qa):this._removeImmediate(qa);this.notifyChange("updating")};Ca._removeImmediate=function(qa){for(const ya of qa)this._removeGraphic(ya);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};Ca._removeDelayed=function(qa){for(const Da of qa){qa=Da.uid;var ya=this._pendingUpdates.get(qa);ya?ya.add&&(ya.remove?ya.add=null:this._pendingUpdates.delete(qa),ya.state===Ua.LOADING&&ya.abortController?.abort(),
this._pendingAdds--):(ya=this._pendingUpdatesPool.pushNew(),ya.remove=Da,this._pendingUpdates.set(qa,ya),this._pendingRemoves++,this._applyPendingRemovesFirst=!0)}0===this._pendingUpdates.size&&this._finishPendingUpdates();this.notifyChange("running");this.notifyChange("updatingRemaining")};Ca._finishPendingUpdates=function(){this._pendingUpdatesPool.clear();this._cleanupSymbols();(this._pendingAdds||this._pendingRemoves)&&Sa.warn("pendingAdds/Removes in inconsistent state!");this._pendingRemoves=
this._pendingAdds=0;this._applyPendingRemovesFirst=!1};Ca._applyPendingUpdates=function(qa){this._symbolWarningLogged=this._geometryWarningLogged=!1;if(0===this._pendingUpdates.size&&this._spatialIndex?.updating)this._spatialIndex.update(),qa.madeProgress();else{if(this._applyPendingRemovesFirst){this._applyPendingRemovesFirst=!1;for(const [ya,Da]of this._pendingUpdates){if(qa.done){this._applyPendingRemovesFirst=!0;break}if(Da.remove&&!Da.add&&(this._pendingRemoves--,qa.madeProgress(),this._removeGraphic(Da.remove),
Da.remove=null,this._pendingUpdates.delete(ya),0===this._pendingRemoves))break}}for(const [ya,Da]of this._pendingUpdates){if(qa.done)break;Da.add&&Da.state===Ua.NEW&&this._processPendingUpdateNew(Da);let La=this.effectiveUpdatePolicy;!Da.remove||Da.add&&Da.state!==Ua.READY||(this._pendingRemoves--,qa.madeProgress(),this._removeGraphic(Da.remove),Da.remove=null,La=wa.UpdatePolicy.SYNC);if(Da.add)switch(Da.state){case Ua.READY:this._addGraphic(Da.add,Da.renderingInfo,La);Da.add=null;this._pendingAdds--;
qa.madeProgress();break;case Ua.REJECTED:Da.add=null,this._pendingAdds--}null==Da.remove&&null==Da.add&&this._pendingUpdates.delete(ya)}0===this._pendingUpdates.size&&(this._finishPendingUpdates(),this.notifyChange("running"))}};Ca._processPendingUpdateNew=function(qa){if(qa.add){var ya=qa.add.geometry;x.isSome(ya)&&"mesh"===ya.type&&!ya.loaded?this._processPendingUpdateNewMesh(qa,ya):this._processPendingUpdateNewRenderingInfo(qa)}else qa.state=Ua.READY};Ca._processPendingUpdateNewMesh=function(){var qa=
c._asyncToGenerator(function*(ya,Da){ya.state=Ua.LOADING;ya.abortController=new AbortController;const La=ya.abortController.signal;try{yield Da.load({signal:La})}catch(Ta){return this._processPendingUpdateNewError(ya,Ta)}ya.abortController=null;this._processPendingUpdateNewRenderingInfo(ya)});return function(ya,Da){return qa.apply(this,arguments)}}();Ca._processPendingUpdateNewError=function(qa,ya){qa.abortController=null;y.isAbortError(ya)?qa.state=Ua.NEW:qa.state=Ua.REJECTED};Ca._processPendingUpdateNewRenderingInfo=
function(){var qa=c._asyncToGenerator(function*(ya){if(x.isNone(this.layer.renderer)||"dictionary"!==this.layer.renderer.type)ya.renderingInfo=this._getRenderingInfo(ya.add,Sa);else{ya.state=Ua.LOADING;ya.abortController=new AbortController;var Da=null;try{Da=yield this._getRenderingInfoAsync(ya.add,{signal:ya.abortController.signal})}catch(La){ya.abortController=null;y.isAbortError(La)?ya.state=Ua.NEW:ya.state=Ua.REJECTED;return}x.isNone(Da)||x.isNone(Da.symbol)?(Sa&&!this._symbolWarningLogged&&
(this._symbolWarningLogged=!0,Sa.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),ya.renderingInfo=null):ya.renderingInfo=Da}ya.state=Ua.READY});return function(ya){return qa.apply(this,arguments)}}();Ca._addGraphic=function(qa,ya,Da){this._graphicsWithoutSymbol.set(qa.uid,qa);if(!x.isNone(ya)&&!x.isNone(ya.symbol)&&S.hasGeometry(qa)){x.isSome(this.stage.renderView.objectAndLayerIdRenderHelper)&&this.setUidToIdOnAdd&&this.stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(qa.objectId,
qa.uid,this.layer.id,this.layer.uid,!!this.layer.popupEnabled);var La=this.getOrCreateGraphics3DSymbol(ya.symbol,ya.renderer);if(!x.isNone(La)){this._expandComputedExtent(qa.geometry);var Ta=this._beginGraphicUpdate(qa),Xa=new ba(qa,ya,this.layer),db=!1,fb=ob=>{ob===La.symbol.id&&(db=!0)};this._whenSymbolRemoved.push(fb);var jb=()=>{--this._loadingSymbols;if(!this.destroyed){this._whenSymbolRemoved.removeUnordered(fb);if(this._graphicsWaitingForSymbol.get(qa.uid)!==Ta||db||La.destroyed||this.graphicSymbolSupported&&
qa.symbol&&qa.symbol.id!==La.symbol.id)--La.referenced,this._cleanupSymbols();else{const ob=this._createGraphics3DGraphic(La,Xa);this._spatialIndex&&x.isSome(ob)&&this._spatialIndex.add(ob);--La.referenced;this._endGraphicUpdate(qa)}this._featureStore.events.emit("changed");this._labeler&&this.owner.view.labeler.setDirty()}},lb=ob=>{--this._loadingSymbols;this.destroyed||(this._whenSymbolRemoved.removeUnordered(fb),db||(y.isAbortError(ob)?this.add([qa]):La.destroyed||this._endGraphicUpdate(qa)))};
++this._loadingSymbols;Da===wa.UpdatePolicy.ASYNC?La.load(()=>this._frameTask.schedule(jb),ob=>this._frameTask.schedule(()=>lb(ob))):La.load(jb,lb)}}};Ca._removeGraphic=function(qa){qa=qa.uid;const ya=this.graphics3DGraphics.get(qa);if(ya){ya.graphics3DSymbol.onRemoveGraphic(ya);const Da=ya.usedMemory,La=ya.isElevationSource;this._conditionalRemove(ya,qa);this._spatialIndex?.remove(ya);this._graphicsBySymbol.get(ya.graphics3DSymbol.symbol.id)?.delete(qa);this._graphicsWithoutSymbol.delete(qa);this._removeGraphics3DGraphic(qa,
Da,La);ya.destroy();this._featureStore.events.emit("changed")}else this._graphicsWithoutSymbol.delete(qa),this._graphicsWaitingForSymbol.delete(qa),0===this._graphicsWaitingForSymbol.size&&(this._cleanupSymbols(),this.notifyChange("updating"))};Ca._hasLabelingContext=function(qa){if(qa instanceof xa||qa instanceof Ea){const ya=this.symbolCreationContext.layer;return ya.labelingInfo?ya.labelingInfo.some(Da=>Da.symbol===qa):!1}return!1};Ca._hasValidSymbolCreationContext=function(qa){return qa instanceof
xa&&!this._hasLabelingContext(qa)?(Sa.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};Ca._getRenderingInfo=function(qa,ya){const Da=qa.geometry;if(x.isNone(Da))return ya&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),null;if(!I.canProjectWithoutEngine(Da.spatialReference,this._viewSpatialReference))return ya&&!this._geometryWarningLogged&&
(this._geometryWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has incompatible spatial reference and will not render`)),null;if(!this.graphicSymbolSupported&&x.isSome(qa.symbol))return ya&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;qa=this.rendererHasGeometryOperations?R.hydrateGraphic(qa,this.layer):qa;qa=this.owner.getRenderingInfo&&(this.getRenderingInfoWithoutRenderer||
x.isSome(this.currentRenderer))?this.owner.getRenderingInfo(qa,this.currentRenderer,this._arcadeOnDemand):{symbol:qa.symbol||aa.getDefaultSymbol3D(qa.geometry)};return x.isNone(qa)||x.isNone(qa.symbol)?(ya&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,ya.warn(`Graphic in layer ${this.layer.id} has no symbol and will not render`)),null):qa};Ca._getRenderingInfoAsync=function(qa,ya){if(x.isNone(qa.geometry))return Sa&&!this._geometryWarningLogged&&(this._geometryWarningLogged=!0,Sa.warn(`Graphic in layer ${this.layer.id} has no geometry and will not render`)),
null;if(!this.graphicSymbolSupported&&x.isSome(qa.symbol))return Sa&&!this._symbolWarningLogged&&(this._symbolWarningLogged=!0,Sa.warn(`Graphic in layer ${this.layer.id} is not allowed to have a symbol, use a renderer instead`)),null;qa=this.rendererHasGeometryOperations?R.hydrateGraphic(qa,this.layer):qa;return this.owner.getRenderingInfoAsync(qa,this.currentRenderer,this._arcadeOnDemand,ya)};Ca._createGraphics3DSymbol=function(qa,ya){if(!this._hasValidSymbolCreationContext(qa))return null;qa=this._getConvertedSymbol(qa);
if(!qa)return null;let Da;x.isSome(ya)&&"backgroundFillSymbol"in ya&&ya.backgroundFillSymbol&&(ya=X.to3D(ya.backgroundFillSymbol,{ignoreDrivers:!0}),x.isSome(ya.symbol)&&"web-style"!==ya.symbol.type&&"cim"!==ya.symbol.type&&(Da=ya.symbol.symbolLayers));const La=ea.make(qa,this.symbolCreationContext,Da);La.load(()=>{const Ta=La.extentPadding;Ta>this.extentPadding&&this._set("extentPadding",Ta);this.notifyChange("averageSymbolComplexity")},()=>{});return La};Ca.getOrCreateGraphics3DSymbol=function(qa,
ya){let Da=this._symbols.get(qa.id);void 0===Da&&(Da=qa instanceof Ia?new ca(qa,La=>this._frameTask.schedule(La),La=>this._createGraphics3DSymbol(La,ya)):this._createGraphics3DSymbol(qa,ya),this._symbols.set(qa.id,Da));x.isSome(Da)&&++Da.referenced;return Da};Ca.trackGraphicState=function(qa){x.isNone(this._graphicStateTracking)&&(this._graphicStateTracking=new ja.GraphicStateTracking(this));return this._graphicStateTracking.add(qa)};Ca._addGraphics3DGraphic=function(qa){this._usedMemory+=qa.usedMemory;
this.graphics3DGraphics.set(qa.graphic.uid,qa);this._numberOfGraphics++;qa.isElevationSource&&(this._numberOfGraphicsProvidingElevation++,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};Ca._removeGraphics3DGraphic=function(qa,ya,Da=!1){this._usedMemory-=ya;this.graphics3DGraphics.delete(qa);this._numberOfGraphics--;Da&&(this._numberOfGraphicsProvidingElevation--,this.updateStageLayerElevationProvider());this._updateLayerVisibility()};Ca._createGraphics3DGraphic=function(qa,
ya){const Da=ya.graphic;this._graphicsWithoutSymbol.delete(Da.uid);if(!this._symbols.has(qa.symbol.id))return this.add([Da]),null;if(this.graphics3DGraphics.has(Da.uid))return null;ya=qa.createGraphics3DGraphic(ya);if(x.isNone(ya))return null;this._addGraphics3DGraphic(ya);qa=qa.symbol.id;this._graphicsBySymbol.has(qa)||this._graphicsBySymbol.set(qa,new Map);this._graphicsBySymbol.get(qa).set(Da.uid,ya);ya.isDraped&&this._graphicsDrapedUids.add(Da.uid);ya.centroid=null;x.isSome(Da.geometry)&&"point"!==
Da.geometry.type&&(ya.centroid=ia.computeCentroid(Da.geometry,this._viewSpatialReference));this._updateUserVisibility(ya);x.isSome(this._scaleVisibility)&&this._scaleVisibility.updateVisibility(ya);x.isSome(this._filterVisibility)&&({defaultVisibility:qa}=this._filterVisibility,ya.setVisibilityFlag(T.VisibilityFlag.FILTER,qa,T.VisibilityGroup.GRAPHIC),qa||this._filterVisibility.reapply());this._deconflictor?.addGraphic(ya);this._labeler?.addGraphic(ya);this._objectStates?.addGraphic(ya);this._deconflictor&&
this.owner.view.deconflictor.setInitialIconVisibilityFlag(this,ya);ya.initialize(this.stage,this.stageLayer,this.owner);x.isSome(this._graphicStateTracking)&&this._graphicStateTracking.addGraphic(ya);if(qa=this._whenGraphics3DGraphicRequests[Da.uid])delete this._whenGraphics3DGraphicRequests[Da.uid],qa.resolve(ya);return ya};Ca._abortRendererChange=function(){this._rendererChangeAbortController&&(this._rendererChangeAbortController.abort(),this._rendererChangeAbortController=null)};Ca.rendererChange=
function(){var qa=c._asyncToGenerator(function*(ya){this._abortRendererChange();if(ya!==this.currentRenderer)if(this._validateRenderer(ya),x.isNone(ya)&&this._currentRendererChange(null,!1),Q.isSupportedRenderer3D(ya))if(x.isSome(ya)&&ya.arcadeRequired){var Da=new AbortController;this._rendererChangeAbortController=Da;const {arcadeUtils:La}=yield this._ensureArcade();y.throwIfAborted(Da);const Ta=La.hasGeometryOperations(ya);Ta&&(yield La.enableGeometryOperations(),y.throwIfAborted(Da));this.effectiveUpdatePolicy===
wa.UpdatePolicy.ASYNC?yield this._frameTask.schedule(()=>this._currentRendererChange(ya,Ta),Da.signal):this._currentRendererChange(ya,Ta);this._rendererChangeAbortController=null}else this.effectiveUpdatePolicy===wa.UpdatePolicy.ASYNC?(this._rendererChangeAbortController=Da=new AbortController,yield this._frameTask.schedule(()=>this._currentRendererChange(ya,!1),Da.signal),this._rendererChangeAbortController=null):this._currentRendererChange(ya,!1);else this._currentRendererChange(ya,!1)});return function(ya){return qa.apply(this,
arguments)}}();Ca._ensureArcade=function(){var qa=c._asyncToGenerator(function*(){x.isNone(this._arcadeOnDemand)&&(this._arcadeOnDemand=yield V.loadArcade());return this._arcadeOnDemand});return function(){return qa.apply(this,arguments)}}();Ca._currentRendererChange=function(qa,ya){this.currentRenderer=qa;this.rendererHasGeometryOperations=ya;this.symbolCreationContext.arcade=x.unwrap(this._arcadeOnDemand);ya=this.symbolCreationContext.renderer;if(qa!==ya)if(this._symbolConversionCache.clear(),x.isNone(qa))this.symbolCreationContext.renderer=
null,this.recreateAllGraphicsAndSymbols();else{var Da=M.diff(ya,qa);this._updateUnchangedSymbolMappings(Da,qa,ya);this.symbolCreationContext.renderer=qa;x.isNone(Da)||("complete"===Da.type?this.recreateAllGraphicsAndSymbols():"partial"===Da.type&&(this._applyRendererDiff(Da,qa,ya)?this._volatileGraphicsUpdated():this.recreateAllGraphicsAndSymbols()),this.notifyChange("averageSymbolComplexity"))}};Ca._diffHasSymbolChange=function(qa){for(const ya in qa.diff)switch(ya){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;
case "uniqueValueGroups":case "authoringInfo":case "fieldDelimiter":delete qa.diff[ya];break;default:return!0}return!1};Ca._applySymbolSetDiff=function(qa,ya,Da){qa=qa||[];ya=ya||[];const La=[];for(const Ta of ya){const Xa=this._graphicsBySymbol.get(Ta.id);Xa&&Xa.forEach((db,fb)=>{var jb=db.graphic,lb=this.layer instanceof O?this.layer:null;const ob=x.unwrap(this._arcadeOnDemand);if(Ta!==Da.defaultSymbol||Da.getSymbol(R.hydrateGraphic(jb,lb),{arcade:ob})!==Da.defaultSymbol)lb=db.usedMemory,qa.length||
Da.defaultSymbol?La.push(jb):this._graphicsWithoutSymbol.set(fb,jb),jb=this.graphics3DGraphics.get(fb),this._conditionalRemove(jb,fb),db.destroy(),Xa.delete(fb),this._removeGraphics3DGraphic(fb,lb),this._updateLayerVisibility()});this._whenSymbolRemoved.forAll(db=>db(Ta.id))}if(qa.length||La.length)this._graphicsWithoutSymbol.forEach(Ta=>La.push(Ta)),this._graphicsWithoutSymbol.clear(),this.add(La);this._cleanupSymbols();this._labeler&&this.owner.view.labeler.setDirty();this.owner.view.deconflictor.setDirty()};
Ca._applyUniqueValueRendererDiff=function(qa,ya,Da){const La=qa.diff.defaultSymbol,Ta=qa.diff.uniqueValueInfos;if(La||Ta){const Xa=Ta?Ta.added.map(fb=>fb.symbol).filter(x.isSome):[],db=Ta?Ta.removed.map(fb=>fb.symbol).filter(x.isSome):[];if(Ta)for(let fb=0;fb<Ta.changed.length;fb++)Xa.push(Ta.changed[fb].newValue.symbol),db.push(Ta.changed[fb].oldValue.symbol);La?(Da.defaultSymbol&&db.push(Da.defaultSymbol),ya.defaultSymbol&&Xa.push(ya.defaultSymbol)):Da.defaultSymbol&&Xa.length&&db.push(ya.defaultSymbol);
this._applySymbolSetDiff(Xa,db,ya);delete qa.diff.defaultSymbol;delete qa.diff.uniqueValueInfos;return!0}return!1};Ca._calculateUnchangedSymbolMapping=function(qa,ya,Da){if("unique-value"!==ya?.type||"unique-value"!==Da?.type||x.isSome(qa)&&"partial"!==qa.type)return[];const La=Xa=>x.isSome(Xa)?Xa.id:null;var Ta=qa&&qa.diff;qa=Ta&&Ta.defaultSymbol;if(Ta=Ta&&Ta.uniqueValueInfos)Ta=Ta.unchanged.map(Xa=>({oldId:La(Xa.oldValue.symbol),newId:La(Xa.newValue.symbol)}));else{Ta=[];for(const Xa of Da.uniqueValueInfos??
[]){const db=La(Xa.symbol),fb=ya.uniqueValueInfos?.find(jb=>jb.value===Xa.value);fb&&db!==La(fb.symbol)&&Ta.push({oldId:db,newId:La(fb.symbol)})}}!qa&&Da.defaultSymbol&&Ta.push({oldId:La(Da.defaultSymbol),newId:La(ya.defaultSymbol)});return Ta};Ca._updateSymbolMapping=function(qa,ya){const Da=x.isSome(ya)&&ya?"string"===typeof ya?ya:ya.id:null;if(!x.isNone(qa)&&qa!==Da){var La=this._graphicsBySymbol.get(qa);this._graphicsBySymbol.delete(qa);void 0!==La&&this._graphicsBySymbol.set(Da,La);La=this._symbols.get(qa);
void 0!==La&&(this._symbols.delete(qa),this._symbols.set(Da,La),x.isSome(La)&&(qa="string"===typeof ya?null:ya,x.isSome(qa)?La.symbol=qa:La.symbol.id=Da))}};Ca._updateUnchangedSymbolMappings=function(qa,ya,Da){qa=this._calculateUnchangedSymbolMapping(qa,ya,Da);for(const {oldId:La,newId:Ta}of qa)this._updateSymbolMapping(La,Ta)};Ca._applyRendererDiff=function(qa,ya,Da){if(this._diffHasSymbolChange(qa))return!1;if(ya instanceof h&&Da instanceof h&&this._applyUniqueValueRendererDiff(qa,ya,Da)&&0===Object.keys(qa.diff).length)return!0;
for(const [La]of this._graphicsBySymbol)if(Da=this._symbols.get(La),x.isSome(Da))switch(Da.applyRendererDiff(qa,ya)){case Z.ApplyRendererDiffResult.Recreate_Symbol:this._recreateSymbol(La);break;case Z.ApplyRendererDiffResult.Recreate_Graphics:this._recreateGraphicsForSymbol(La)}return!0};Ca.opacityChange=function(){this.forEachGraphics3DSymbol((qa,ya)=>qa.globalPropertyChanged("opacity",ya));this._updateStageLayerVisibility()};Ca._slicePlaneEnabledChange=function(qa){qa!==this.symbolCreationContext.slicePlaneEnabled&&
(this.symbolCreationContext.slicePlaneEnabled=qa,this.stageLayer.sliceable=qa,this.forEachGraphics3DSymbol((ya,Da)=>ya.globalPropertyChanged("slicePlaneEnabled",Da)),this._deconflictor&&this._deconflictor.slicePlaneEnabledChange(),this._labeler&&this._labeler.slicePlaneEnabledChange())};Ca._physicalBasedRenderingChange=function(qa){this.symbolCreationContext.physicalBasedRenderingEnabled=qa;this.forEachGraphics3DSymbol((ya,Da,La)=>{ya.globalPropertyChanged("physicalBasedRenderingEnabled",Da)||this._recreateSymbol(La)})};
Ca._skipHighSymbolLoDsChange=function(qa){this.symbolCreationContext.skipHighSymbolLods=qa;this.forEachGraphics3DSymbol((ya,Da,La)=>{ya.globalPropertyChanged("skipHighSymbolLods",Da)||this._recreateSymbol(La)})};Ca._pixelRatioChange=function(){this.forEachGraphics3DSymbol((qa,ya,Da)=>{qa.globalPropertyChanged("pixelRatio",ya)||this._recreateSymbol(Da)})};Ca._signalUpdatingDuringAsyncLoadedGraphicsChange=function(){this._updatingPendingLoadedGraphicsChange&&this._updatingPendingLoadedGraphicsChange.remove();
this._updatingPendingLoadedGraphicsChange=D.schedule(()=>{this._updatingPendingLoadedGraphicsChange=null})};Ca.setClippingExtent=function(qa,ya){const Da=this.symbolCreationContext.clippingExtent,La=H.create();na.toBoundingRect(qa,La,ya)?this.symbolCreationContext.clippingExtent=G.fromRect(G.create(),La):this.symbolCreationContext.clippingExtent=null;return!G.equals(this.symbolCreationContext.clippingExtent,Da)};Ca.modifyGraphics3DGraphicVisibilities=function(qa){let ya=!1;this.graphics3DGraphics.forEach(Da=>
{qa(Da)&&(ya=!0)});ya&&(this.owner.view.labeler?.setDirty(),this.owner.view.deconflictor.setDirty())};Ca.forEachGraphics3DSymbol=function(qa){for(const [ya,Da]of this._symbols){if(x.isNone(Da))break;const La=this._graphicsBySymbol.get(ya);qa(Da,La||bb,ya)}};Ca.updateAllGraphicsVisibility=function(){x.isSome(this._filterVisibility)&&this._filterVisibility.reapply();this.modifyGraphics3DGraphicVisibilities(qa=>{const ya=this._updateUserVisibility(qa);qa=x.isSome(this._scaleVisibility)&&this._scaleVisibility.updateVisibility(qa);
return ya||qa})};Ca._hideAllGraphics=function(){this.modifyGraphics3DGraphicVisibilities(qa=>qa.setVisibilityFlag(T.VisibilityFlag.USER_SETTING,!1,T.VisibilityGroup.GRAPHIC))};Ca._validateRenderer=function(qa){(qa=Q.validateTo3D(qa,{geometryType:this.layer?.geometryType}))&&Sa.warn(`Renderer for layer '${this.layer.title?`${this.layer.title}, `:""}, id:${this.layer.id}' is not supported in a SceneView`,qa.message)};Ca._volatileGraphicsUpdated=function(){this._labeler?.reset();this.stageLayer.shaderTransformationChanged();
this.notifyChange("updating")};Ca._cleanupSymbols=function(){if(!(0<this._graphicsWaitingForSymbol.size||this._suspendSymbolCleanup)){var qa=!1;this._symbols.forEach((ya,Da)=>{if(!(x.isNone(ya)||0<ya.referenced)){var La=this._graphicsBySymbol.get(Da);La&&0!==La.size||(this._graphicsBySymbol.delete(Da),this._symbols.delete(Da),x.destroyMaybe(ya),qa=!0)}});qa&&(this._recomputeExtentPadding(),this.notifyChange("averageSymbolComplexity"))}};c._createClass(Aa,[{key:"_viewSpatialReference",get:function(){return this.owner.view.spatialReference}},
{key:"spatialIndex",get:function(){this._spatialIndex||(this._spatialIndex=new fa.SpatialIndex2D({objectIdField:this.owner.layer?.objectIdField,spatialReference:this._viewSpatialReference,hasZ:!!this.hasZ,hasM:!!this.hasM}),this._spatialIndex.setup(Array.from(this.graphics3DGraphics.values())));this._spatialIndex.update();return this._spatialIndex}},{key:"numberOfGraphics",get:function(){return this._numberOfGraphics}},{key:"effectiveUpdatePolicy",get:function(){return x.isSome(this.currentRenderer)&&
"dictionary"===this.currentRenderer.type?wa.UpdatePolicy.ASYNC:x.unwrapOr(this._forcedUpdatePolicy,this.preferredUpdatePolicy)}},{key:"featureStore",get:function(){return this._featureStore}},{key:"initializePromise",get:function(){return this._initializePromise}},{key:"scaleVisibility",get:function(){return this._scaleVisibility}},{key:"elevationAlignment",get:function(){return this._elevationAlignment}},{key:"objectStates",get:function(){return this._objectStates}},{key:"filterVisibility",get:function(){return this._filterVisibility}},
{key:"updating",get:function(){return!!(0<this._graphicsWaitingForSymbol.size||this.running||this._elevationAlignment?.updating||x.isSome(this._scaleVisibility)&&this._scaleVisibility.updating||x.isSome(this._filterVisibility)&&this._filterVisibility.updating||this._rendererChangeAbortController||this._elevationInfoChangeAbortController||this._updatingPendingLoadedGraphicsChange||this._frameTask.updating||0<this._loadingSymbols)}},{key:"running",get:function(){return 0<this._pendingUpdates.size||
!!this._spatialIndex?.updating}},{key:"suspendedOrOutsideOfView",get:function(){return this.owner.suspended||!!this.owner.suspendInfo?.outsideOfView}},{key:"updatingRemaining",get:function(){return this.updating?this._pendingUpdates.size+.1*(this._spatialIndex?.updatingRemaining||0)+.1*(this._elevationAlignment?.updatingRemaining||0):0}},{key:"displayFeatureLimit",get:function(){var qa=this.owner&&this.owner.view&&this.owner.view.qualitySettings;const ya=qa?qa.graphics3D.minTotalNumberOfFeatures:
0,Da=qa?qa.graphics3D.maxTotalNumberOfFeatures:0;qa=qa?qa.graphics3D.maxTotalNumberOfPrimitives:0;const La=this.averageSymbolComplexity;var Ta=Math.max(1,x.isSome(La)?La.primitivesPerFeature:1),Xa=x.isSome(La)&&0<La.drawCallsPerFeature?Da/La.drawCallsPerFeature*.3:Da;Ta=Math.max(ya,Math.min(Da,Math.ceil(qa/Ta),Xa));return(Xa=this._get("displayFeatureLimit"))&&Xa.minimumTotalNumberOfFeatures===ya&&Xa.maximumTotalNumberOfFeatures===Da&&Xa.maximumTotalNumberOfPrimitives===qa&&Xa.averageSymbolComplexity===
La&&Xa.maximumNumberOfFeatures===Ta?Xa:{minimumTotalNumberOfFeatures:ya,maximumTotalNumberOfFeatures:Da,maximumTotalNumberOfPrimitives:qa,averageSymbolComplexity:La,maximumNumberOfFeatures:Ta}}},{key:"averageSymbolComplexity",get:function(){const qa=ka.averageSymbolComplexities(this._symbolComplexities),ya=this._get("averageSymbolComplexity");return 0===qa.numComplexities||x.isSome(ya)&&(qa.estimated&&(ya.primitivesPerFeature>=qa.primitivesPerFeature||ya.primitivesPerCoordinate>=qa.primitivesPerCoordinate||
ya.drawCallsPerFeature>=qa.drawCallsPerFeature)||ya.primitivesPerFeature===qa.primitivesPerFeature&&ya.primitivesPerCoordinate===qa.primitivesPerCoordinate&&ya.drawCallsPerFeature===qa.drawCallsPerFeature)?ya:qa}},{key:"usedMemory",get:function(){const qa=x.isSome(this.averageSymbolComplexity)&&this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel*this._numberOfGraphics:0,ya=this._getSymbolComplexitiesUsed().reduce((Da,La)=>Da+La.memory.resourceBytes,0);return this._usedMemory+
qa+ya}},{key:"usedMemoryPerGraphic",get:function(){return this._usedMemory&&this._numberOfGraphics?this._usedMemory/this._numberOfGraphics*(this._numberOfGraphics/(this._numberOfGraphics+Math.max(this._pendingAdds,this._pendingRemoves))):x.isSome(this.averageSymbolComplexity)?this.averageSymbolComplexity.memory.bytesPerFeature+(this.labelsEnabled?this.averageSymbolComplexity.memory.bytesPerFeatureLabel:0):0}},{key:"unprocessedMemoryEstimate",get:function(){return(this._pendingAdds-this._pendingRemoves)*
this.usedMemoryPerGraphic}},{key:"_symbolComplexities",get:function(){return this.currentRenderer?this._getSymbolComplexitiesUsedOrRenderer(this.currentRenderer):this._getSymbolComplexitiesUsed()}},{key:"visible",get:function(){return this._visible}},{key:"_objectIdField",get:function(){return this.layer.objectIdField}},{key:"graphics3DGraphicsByObjectID",get:function(){const qa=this.owner.layer&&this.owner.layer.objectIdField;if(qa){var ya=new Map;this.graphics3DGraphics.forEach(Da=>{if(Da){var La=
this._getGraphicObjectID(Da.graphic,qa);x.isSome(La)&&ya.set(La,Da)}});return ya}}},{key:"labelsEnabled",get:function(){return!(!this._labeler||!this._labeler.layerLabelsEnabled())}},{key:"symbolUpdateType",get:function(){if(0<this._pendingUpdates.size)return"unknown";let qa=0,ya=0;return A.someMap(this._symbols,(Da,La)=>{if(x.isSome(Da)){Da=Da.getFastUpdateStatus();if(0<Da.loading)return!0;this._graphicsBySymbol.has(La)&&(ya+=Da.fast,qa+=Da.slow)}return!1})?"unknown":0<=ya&&0===qa?"fast":0<=qa&&
0===ya?"slow":"mixed"}},{key:"test",get:function(){return{snapshotInternals:()=>({graphics:[...this.graphics3DGraphics.keys()].sort(),symbols:[...this._symbols.keys()].sort(),graphicsBySymbol:[...this._graphicsBySymbol.keys()].sort().map(qa=>({symbolId:qa,graphics:[...this._graphicsBySymbol.get(qa).keys()].sort()})),graphicsWithoutSymbol:[...this._graphicsWithoutSymbol.keys()].sort(),graphicsDrapedUids:[...this._graphicsDrapedUids].sort(),pendingUpdates:this._pendingUpdates}),symbols:this._symbols,
filterVisibility:this._filterVisibility,numPending:this._pendingUpdates.size,forceUpdatePolicy:qa=>{this._forcedUpdatePolicy=qa}}}},{key:"performanceInfo",get:function(){return{visible:this.graphics3DGraphics.size,missing:this._graphicsWithoutSymbol.size,pending:this._pendingUpdates.size}}}]);return Aa}(q);a.Graphics3DCore.tmpVec=P.create();b.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"computedExtent",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"currentRenderer",
void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"rendererHasGeometryOperations",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_frameTask",void 0);b.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"_viewSpatialReference",null);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_rendererChangeAbortController",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_elevationInfoChangeAbortController",void 0);b.__decorate([F.property()],
a.Graphics3DCore.prototype,"_initializeAbortController",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_elevationAlignment",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_scaleVisibility",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_filterVisibility",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_initializePromise",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_spatialIndex",void 0);b.__decorate([F.property({readOnly:!0})],
a.Graphics3DCore.prototype,"extentPadding",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_updatingPendingLoadedGraphicsChange",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_featureStore",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_deconflictor",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_labeler",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_objectStates",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,
"_loadingSymbols",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"preferredUpdatePolicy",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_forcedUpdatePolicy",void 0);b.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"effectiveUpdatePolicy",null);b.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"elevationFeatureExpressionEnabled",void 0);b.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"owner",void 0);
b.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"layer",void 0);b.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"graphicSymbolSupported",void 0);b.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"getRenderingInfoWithoutRenderer",void 0);b.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"componentFactories",void 0);b.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"setUidToIdOnAdd",
void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"featureStore",null);b.__decorate([F.property()],a.Graphics3DCore.prototype,"initializePromise",null);b.__decorate([F.property()],a.Graphics3DCore.prototype,"scaleVisibility",null);b.__decorate([F.property()],a.Graphics3DCore.prototype,"elevationAlignment",null);b.__decorate([F.property()],a.Graphics3DCore.prototype,"objectStates",null);b.__decorate([F.property()],a.Graphics3DCore.prototype,"filterVisibility",null);b.__decorate([F.property({readOnly:!0})],
a.Graphics3DCore.prototype,"updating",null);b.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"running",null);b.__decorate([F.property({readOnly:!0})],a.Graphics3DCore.prototype,"suspendedOrOutsideOfView",null);b.__decorate([F.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"updatingRemaining",null);b.__decorate([F.property({readOnly:!0,dependsOn:["owner.view.qualitySettings.graphics3D.maxTotalNumberOfPrimitives","owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures",
"averageSymbolComplexity"]})],a.Graphics3DCore.prototype,"displayFeatureLimit",null);b.__decorate([F.property({readOnly:!0,dependsOn:[]})],a.Graphics3DCore.prototype,"averageSymbolComplexity",null);b.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasZ",void 0);b.__decorate([F.property({constructOnly:!0})],a.Graphics3DCore.prototype,"hasM",void 0);b.__decorate([F.property()],a.Graphics3DCore.prototype,"_objectIdField",null);a.Graphics3DCore=Na=b.__decorate([J.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],
a.Graphics3DCore);var Ua;(function(Qa){Qa[Qa.NEW=0]="NEW";Qa[Qa.LOADING=1]="LOADING";Qa[Qa.READY=2]="READY";Qa[Qa.REJECTED=3]="REJECTED"})(Ua||(Ua={}));let Za=function(){function Qa(){this.renderingInfo=this.add=null;this.state=Ua.NEW;this.remove=this.abortController=null}Qa.prototype.clear=function(){this.renderingInfo=this.add=null;this.state=Ua.NEW;this.remove=this.abortController=null};return Qa}();const ma=P.create(),Ya=P.create(),bb=new Map;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/renderers/support/rendererConversion":function(){define(["exports","../../core/has","../../core/Error","../../core/maybe","../../symbols/support/symbolConversion"],function(a,c,b,t,n){function r(e){return t.isNone(e)||"simple"===e.type||"unique-value"===e.type||"class-breaks"===e.type||"dictionary"===e.type||"heatmap"===e.type}function m(e,g){if(!g)return null;g=Array.isArray(g)?g:[g];if(0<g.length){const h=g.map(v=>v.details.symbol.type||v.details.symbol.declaredClass).filter(v=>!!v);h.sort();
const l=[];h.forEach((v,q)=>{0!==q&&v===h[q-1]||l.push(v)});return new b("renderer-conversion-3d:unsupported-symbols",`Renderer contains symbols (${l.join(", ")}) which are not supported in 3D`,{renderer:e,symbolErrors:g})}return null}function d(e,g){const h={...n.defaultTo3DOptions,...g};g=e.uniqueValueInfos?.map(v=>n.to3D(v.symbol,h).error).filter(t.isSome);const l=n.to3D(e.defaultSymbol,h);l.error&&g?.unshift(l.error);return m(e,g)}function f(e){const g=e.classBreakInfos.map(l=>n.to3D(l.symbol).error).filter(t.isSome),
h=n.to3D(e.defaultSymbol);h.error&&g.unshift(h.error);return m(e,g)}a.isSupportedRenderer3D=r;a.validateTo3D=function(e,g){if(t.isNone(e))return null;if(!r(e))return new b("renderer-conversion-3d:unsupported-renderer",`Unsupported renderer of type '${e.type||e.declaredClass}'`,{renderer:e});switch(e.type){case "simple":return m(e,n.to3D(e.symbol).error);case "unique-value":return d(e,g);case "class-breaks":return f(e)}return null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/symbols/support/defaults3D":function(){define("exports ../../core/has ../../core/maybe ../FillSymbol3DLayer ../LineSymbol3D ../MeshSymbol3D ../PointSymbol3D ../PolygonSymbol3D ../edges/SolidEdges3D ./defaults ./defaultsJSON".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){const h=m.fromSimpleMarkerSymbol(e.defaultPointSymbol2D),l=n.fromSimpleLineSymbol(e.defaultPolylineSymbol2D),v=d.fromSimpleFillSymbol(e.defaultPolygonSymbol2D),q=new r({symbolLayers:[new t({material:{color:g.defaultColor},edges:new f({size:"1px",color:g.defaultOutlineColor})})]});a.getDefaultSymbol3D=function(k){if(b.isNone(k))return null;switch(k.type){case "mesh":return q;case "point":case "multipoint":return h;case "polyline":return l;case "polygon":case "extent":return v}return null};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/optimizedFeatureQueryEngineAdapter".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){const p=h.create();a.Graphics3DFeatureStore=function(C){function B(x){var u=C.call(this,x)||this;u.events=new n;u.hasZ=null;u.hasM=null;u.objectIdField=null;u.featureAdapter={getAttribute(y,w){return"graphic"in y?y.graphic.attributes[w]:k.optimizedFeatureQueryEngineAdapter.getAttribute(y,w)},getAttributes(y){return"graphic"in y?y.graphic.attributes:k.optimizedFeatureQueryEngineAdapter.getAttributes(y)},getObjectId:y=>"graphic"in y?l.getObjectId(y.graphic,
u.objectIdField)??void 0:k.optimizedFeatureQueryEngineAdapter.getObjectId(y),getGeometry:y=>"graphic"in y?y.getAsOptimizedGeometry(u.hasZ,u.hasM):k.optimizedFeatureQueryEngineAdapter.getGeometry(y),getCentroid:(y,w)=>{if("graphic"in y){let D=null;r.isSome(y.centroid)?D=y.centroid:"point"===y.graphic.geometry.type&&g.projectPoint(y.graphic.geometry,z,u.viewSpatialReference)&&(D=z);y=Array(2+(w.hasZ?1:0)+(w.hasM?1:0));r.isNone(D)?(y[0]=0,y[1]=0,y[2]=0,y[3]=0):(y[0]=D.x,y[1]=D.y,w.hasZ&&(y[2]=D.hasZ?
D.z:0),w.hasM&&(y[w.hasZ?3:2]=D.hasM?D.m:0));return new q([],y)}return k.optimizedFeatureQueryEngineAdapter.getCentroid(y,w)},cloneWithGeometry:(y,w)=>"graphic"in y?new v.OptimizedFeature(w,u.featureAdapter.getAttributes(y),null,u.featureAdapter.getObjectId(y)):k.optimizedFeatureQueryEngineAdapter.cloneWithGeometry(y,w)};return u}c._inheritsLoose(B,C);var A=B.prototype;A.forEachInBounds=function(x,u){this.getSpatialIndex().forEachInBounds(x,u)};A.forEachBounds=function(x,u){const y=this.getSpatialIndex();
for(const w of x)x=this.featureAdapter.getObjectId(w),r.isSome(y.getBounds(x,p))&&u(p)};return B}(t);b.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"getSpatialIndex",void 0);b.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"forEach",void 0);b.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasZ",void 0);b.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"hasM",void 0);b.__decorate([m.property({constructOnly:!0})],
a.Graphics3DFeatureStore.prototype,"objectIdField",void 0);b.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"viewSpatialReference",void 0);b.__decorate([m.property({constructOnly:!0})],a.Graphics3DFeatureStore.prototype,"featureSpatialReference",void 0);a.Graphics3DFeatureStore=b.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureStore")],a.Graphics3DFeatureStore);const z={type:"point",x:0,y:0,hasZ:!1,hasM:!1,spatialReference:null};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/optimizedFeatureQueryEngineAdapter":function(){define(["exports","../../../core/maybe","../centroid","../OptimizedFeature","../OptimizedGeometry"],function(a,c,b,t,n){a.optimizedFeatureQueryEngineAdapter={getObjectId(r){return r.objectId},getAttributes(r){return r.attributes},getAttribute(r,m){return r.attributes[m]},cloneWithGeometry(r,m){return new t.OptimizedFeature(m,r.attributes,null,r.objectId)},getGeometry(r){return r.geometry},
getCentroid(r,m){c.isNone(r.centroid)&&(r.centroid=b.getCentroidOptimizedGeometry(new n,r.geometry,m.hasZ,m.hasM));return r.centroid}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/centroid":function(){define(["exports","../../core/maybe"],function(a,c){function b(n,r,m,d,f,e,g=1){e=f?e?4:3:e?3:2;let h=m,l=m+e,v=0,q=0,k=m=0,p=0;for(let z=0,C=d-1;z<C;z++,h+=e,l+=e){d=r[h];const B=r[h+1],A=r[h+2],x=r[l],u=r[l+1],y=r[l+2];let w=d*u-x*B;k+=w;v+=(d+x)*w;q+=(B+u)*
w;f&&(w=d*y-x*A,m+=(A+y)*w,p+=w);d<n[0]&&(n[0]=d);d>n[1]&&(n[1]=d);B<n[2]&&(n[2]=B);B>n[3]&&(n[3]=B);f&&(A<n[4]&&(n[4]=A),A>n[5]&&(n[5]=A))}0<k*g&&(k*=-1);0<p*g&&(p*=-1);if(!k)return null;n=[v,q,.5*k];f&&(n[3]=m,n[4]=.5*p);return n}function t(n,r,m,d,f){f=d?f?4:3:f?3:2;let e=r,g=r+f,h=0,l=0,v=0,q=0;for(let C=0,B=m-1;C<B;C++,e+=f,g+=f){var k=n[e];const A=n[e+1],x=n[e+2],u=n[g],y=n[g+1],w=n[g+2];if(d){var p=u-k;var z=y-A;const D=w-x;p=Math.sqrt(p*p+z*z+D*D)}else p=u-k,z=y-A,p=Math.sqrt(p*p+z*z);p&&
(h+=p,d?(k=[k+.5*(u-k),A+.5*(y-A),x+.5*(w-x)],l+=p*k[0],v+=p*k[1],q+=p*k[2]):(k=[k+.5*(u-k),A+.5*(y-A)],l+=p*k[0],v+=p*k[1]))}return 0<h?d?[l/h,v/h,q/h]:[l/h,v/h]:0<m?d?[n[r],n[r+1],n[r+2]]:[n[r],n[r+1]]:null}a.getCentroidOptimizedGeometry=function(n,r,m,d,f){if(c.isNone(r)||!r.lengths.length)return null;const e="upperLeft"===f?.originPosition?-1:1;n.lengths.length&&(n.lengths.length=0);n.coords.length&&(n.coords.length=0);f=n.coords;const g=[],h=m?[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,
Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY]:[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY],{lengths:l,coords:v}=r,q=m?d?4:3:d?3:2;let k=0;for(var p of l){const z=b(h,v,k,p,m,d,e);z&&g.push(z);k+=p*q}g.sort((z,C)=>{let B=e*z[2]-e*C[2];0===B&&m&&(B=z[4]-C[4]);return B});g.length&&(p=6*g[0][2],f[0]=g[0][0]/p,f[1]=g[0][1]/p,m&&(p=6*g[0][4],f[2]=0!==p?g[0][3]/p:0),f[0]<h[0]||f[0]>h[1]||f[1]<
h[2]||f[1]>h[3]||m&&(f[2]<h[4]||f[2]>h[5]))&&(f.length=0);if(!f.length)if(r=r.lengths[0]?t(v,0,l[0],m,d):null)f[0]=r[0],f[1]=r[1],m&&2<r.length&&(f[2]=r[2]);else return null;return n};a.lineCentroid=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolCreationContext":function(){define(["exports"],function(a){a.Graphics3DSymbolCreationContext=function(c,b){this.scheduler=c;this.schedule=b;this.featureExpressionInfoContext=this.localOriginFactory=
this.graphicsCoreOwner=this.drapeSourceRenderer=this.layer=this.overlaySR=this.renderCoordsHelper=this.clippingExtent=this.stage=this.renderer=this.elevationProvider=this.streamDataRequester=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.isAsync=this.skipHighSymbolLods=this.physicalBasedRenderingEnabled=this.slicePlaneEnabled=!1};a.Graphics3DSymbolLayerCreationContext=function(){};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["exports",
"./Graphics3DPointSymbol","./Graphics3DSymbol"],function(a,c,b){a.make=function(t,n,r){switch(t.type){case "point-3d":return new c(t,n,r);default:return new b(t,n,r)}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DLineCalloutSymbolLayer ./Graphics3DSymbol".split(" "),
function(a,c,b,t,n,r,m){return function(d){function f(g,h,l){g=d.call(this,g,h,l)||this;g._calloutSymbolLayer=null;g.symbol.hasVisibleCallout()&&(g._calloutSymbolLayer=n.make(g.symbol,h));return g}a._inheritsLoose(f,d);var e=f.prototype;e.doLoad=function(){var g=a._asyncToGenerator(function*(h){const l=this._calloutSymbolLayer?c.result(this._calloutSymbolLayer.load()):null;try{yield d.prototype.doLoad.call(this,h),t.throwIfAborted(h)}catch(v){throw this._calloutSymbolLayer?.abortLoad(),v;}l&&(yield l)});
return function(h){return g.apply(this,arguments)}}();e.destroy=function(){d.prototype.destroy.call(this);this._calloutSymbolLayer=b.destroyMaybe(this._calloutSymbolLayer)};e.createGraphics3DGraphic=function(g,h){h=d.prototype.createGraphics3DGraphic.call(this,g,h);b.isSome(this._calloutSymbolLayer)&&b.isSome(h)&&(g=this._createCalloutGraphic(g),b.isSome(g)&&h.addAuxiliaryGraphic(g));return h};e.globalPropertyChanged=function(g,h){return d.prototype.globalPropertyChanged.call(this,g,h)?this._calloutSymbolLayer?
this._calloutSymbolLayer.globalPropertyChanged(g,h,l=>this._getCalloutGraphicLayer(l)):!0:!1};e.updateGeometry=function(g,h){const l=d.prototype.updateGeometry.call(this,g,h);return l&&this._calloutSymbolLayer&&(g=this._getCalloutGraphicLayer(g))?this._calloutSymbolLayer.updateGeometry(g,h):l};e._createCalloutGraphic=function(g){const h=g.renderingInfo;g.renderingInfo=new r.LineCalloutSymbolLayerRenderingInfo(h.renderer,h.symbol);return this._calloutSymbolLayer.createGraphics3DGraphic(g)};e._getCalloutGraphicLayer=
function(g){for(const h of g._auxiliaryLayers)if(h.graphics3DSymbolLayer===this._calloutSymbolLayer)return h};return f}(m)})},"esri/views/3d/layers/graphics/GraphicStateTracking":function(){define(["exports","../../../../core/arrayUtils","../../../../core/maybe","../../../../layers/graphics/dehydratedFeatures"],function(a,c,b,t){let n=function(){function r(d){this._graphicsCore=d;this._idToState=new Map;this._states=new Set;const f=d.owner.layer&&d.owner.layer.objectIdField;f?(this._getGraphicId=
e=>t.getObjectId(e,f),this._getGraphics3DGraphicById=e=>this._graphicsCore.getGraphics3DGraphicByObjectId(e)):(this._getGraphicId=e=>e.uid,this._getGraphics3DGraphicById=e=>this._graphicsCore.getGraphics3DGraphicById(e))}var m=r.prototype;m.destroy=function(){this._idToState.clear();this._states.forEach((d,f)=>this.remove(f))};m.add=function(d){const f={remove:()=>this.remove(d)};if(this._states.has(d))return f;const e=this._getGraphicId(d.graphic),g=this._getGraphics3DGraphicById(e);this._states.has(d)||
this._states.add(d);this._ensureStateList(e).push(d);d.displaying=b.isSome(g)?g.isVisible():!1;d.isDraped=b.isSome(g)?g.isDraped:!1;d.tracking=!0;b.isSome(g)&&d.emit("changed");return f};m.remove=function(d){if(this._states.has(d)){if(this._idToState.size){const f=this._getGraphicId(d.graphic),e=this._idToState.get(f);e&&(c.remove(e,d),0===e.length&&this._idToState.delete(f))}this._states.delete(d);d.tracking=!1;d.displaying=!1}};m.addGraphic=function(d){this._forEachState(d,f=>{f.displaying=d.isVisible();
f.isDraped=d.isDraped;f.emit("changed")})};m.removeGraphic=function(d){this._forEachState(d,f=>{f.displaying=!1;f.isDraped=!1})};m.updateGraphicGeometry=function(d){this._forEachState(d,f=>f.emit("changed"))};m.updateGraphicVisibility=function(d){this._forEachState(d,f=>f.displaying=d.isVisible())};m.allGraphicsDeleted=function(){this._states.forEach(d=>{d.displaying=!1})};m._ensureStateList=function(d){var f=this._idToState.get(d);if(f)return f;f=[];this._idToState.set(d,f);return f};m._forEachState=
function(d,f){0!==this._states.size&&0!==this._idToState.size&&(d=this._getGraphicId(d.graphic),d=this._idToState.get(d),null!=d&&d.forEach(f))};return r}();a.GraphicStateTracking=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/SpatialIndex2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/libs/rbush/PooledRBush ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){a.SpatialIndex2D=function(q){function k(z){z=q.call(this,z)||this;z._index=new g.PooledRBush(9,n("esri-csp-restrictions")?C=>({minX:C.extent[0],minY:C.extent[1],maxX:C.extent[2],maxY:C.extent[3]}):[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);z._missing=new Set;z._boundsByFeature=new Map;z.spatialReference=null;z.hasZ=null;z.hasM=null;z.objectIdField=null;z.updating=!1;return z}c._inheritsLoose(k,q);var p=k.prototype;p.setup=function(z){this._addMany(z)};
p.destroy=function(){this._missing.clear();this._index=r.destroyMaybe(this._index);this._boundsByFeature.clear();this._boundsByFeature=null};p.update=function(){0<this._missing.size&&(this._addMany(Array.from(this._missing.values())),this.updating=!1,this._missing.clear())};p.queryGraphicUIDsInExtent=function(z,C,B){!r.isNone(C)&&C.equals(this.spatialReference)&&(v.minX=z[0],v.minY=z[1],v.maxX=z[2],v.maxY=z[3],this.update(),this._index.search(v,A=>B(A.graphic.uid)))};p.add=function(z){this._missing.add(z);
this.updating=!0};p.remove=function(z){this._missing.delete(z)?this.updating=0<this._missing.size:(this._index.remove(z),z=l.getObjectId(z.graphic,this._get("objectIdField")),null!=z&&this._boundsByFeature.delete(z))};p._addMany=function(z){if(0!==z.length){var C=this._get("objectIdField");for(const B of z){B.computeExtent(this.spatialReference);const A=l.getObjectId(B.graphic,C);null!=A&&this._boundsByFeature.set(A,B.extent)}this._index.load(z)}};p.clear=function(){this._index.clear();this._missing.clear();
this._boundsByFeature.clear();this.updating=!1};p.forEachInBounds=function(z,C){v.minX=z[0];v.minY=z[1];v.maxX=z[2];v.maxY=z[3];this.update();this._index.search(v,B=>{C(B)})};p.getBounds=function(z,C){this.update();return(z=this._boundsByFeature.get(z))?h.fromRect(C,z):null};c._createClass(k,[{key:"updatingRemaining",get:function(){return this._missing.size}}]);return k}(t);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"spatialReference",void 0);b.__decorate([m.property({constructOnly:!0})],
a.SpatialIndex2D.prototype,"hasZ",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"hasM",void 0);b.__decorate([m.property({constructOnly:!0})],a.SpatialIndex2D.prototype,"objectIdField",void 0);b.__decorate([m.property()],a.SpatialIndex2D.prototype,"updating",void 0);b.__decorate([m.property({readOnly:!0})],a.SpatialIndex2D.prototype,"updatingRemaining",null);a.SpatialIndex2D=b.__decorate([e.subclass("esri.views.3d.layers.graphics.SpatialIndex2D")],a.SpatialIndex2D);
const v={minX:0,minY:0,maxX:0,maxY:0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/libs/rbush/PooledRBush":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../arrayUtils ../../maybe ../../PooledArray ../../../chunks/quickselect".split(" "),function(a,c,b,t,n,r){function m(w,D){d(w,0,w.children.length,D,w)}function d(w,D,F,E,K){K||(K=new u([]));K.minX=Infinity;K.minY=Infinity;K.maxX=-Infinity;K.maxY=-Infinity;for(let J=D,M;J<F;J++)M=w.children[J],
f(K,w.leaf?E(M):M);return K}function f(w,D){w.minX=Math.min(w.minX,D.minX);w.minY=Math.min(w.minY,D.minY);w.maxX=Math.max(w.maxX,D.maxX);w.maxY=Math.max(w.maxY,D.maxY)}function e(w,D){return w.minX-D.minX}function g(w,D){return w.minY-D.minY}function h(w){return(w.maxX-w.minX)*(w.maxY-w.minY)}function l(w){return w.maxX-w.minX+(w.maxY-w.minY)}function v(w,D){return w.minX<=D.minX&&w.minY<=D.minY&&D.maxX<=w.maxX&&D.maxY<=w.maxY}function q(w,D){return D.minX<=w.maxX&&D.minY<=w.maxY&&D.maxX>=w.minX&&
D.maxY>=w.minY}function k(w,D,F,E,K){for(D=[D,F];D.length;){F=t.assumeNonNull(D.pop());const J=t.assumeNonNull(D.pop());if(F-J<=E)continue;const M=J+Math.ceil((F-J)/E/2)*E;r.quickselect(w,M,J,F,K);D.push(J,M,M,F)}}let p=function(){function w(F=9,E){this._compareMinX=e;this._compareMinY=g;this._toBBox=K=>K;this._maxEntries=Math.max(4,F||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));E&&("function"===typeof E?this._toBBox=E:this._initFormat(E));this.clear()}var D=w.prototype;D.destroy=
function(){this.clear();z.prune();C.prune();B.prune();A.prune()};D.all=function(F){this._all(this._data,F)};D.search=function(F,E){let K=this._data;const J=this._toBBox;if(q(F,K))for(z.clear();K;){for(let M=0,N=K.children.length;M<N;M++){const P=K.children[M],I=K.leaf?J(P):P;q(F,I)&&(K.leaf?E(P):v(F,I)?this._all(P,E):z.push(P))}K=z.pop()}};D.collides=function(F){let E=this._data;const K=this._toBBox;if(!q(F,E))return!1;for(z.clear();E;){for(let J=0,M=E.children.length;J<M;J++){const N=E.children[J],
P=E.leaf?K(N):N;if(q(F,P)){if(E.leaf||v(F,P))return!0;z.push(N)}}E=z.pop()}return!1};D.load=function(F){if(!F.length)return this;if(F.length<this._minEntries){for(let E=0,K=F.length;E<K;E++)this.insert(F[E]);return this}F=this._build(F.slice(0,F.length),0,F.length-1,0);if(this._data.children.length)if(this._data.height===F.height)this._splitRoot(this._data,F);else{if(this._data.height<F.height){const E=this._data;this._data=F;F=E}this._insert(F,this._data.height-F.height-1,!0)}else this._data=F;return this};
D.insert=function(F){F&&this._insert(F,this._data.height-1);return this};D.clear=function(){this._data=new u([]);return this};D.remove=function(F){if(!F)return this;let E=this._data,K=null,J=0,M=!1,N;const P=this._toBBox(F);B.clear();for(A.clear();E||0<B.length;){E||(E=t.assumeNonNull(B.pop()),K=B.data[B.length-1],J=A.pop()??0,M=!0);if(E.leaf&&(N=b.indexOf(E.children,F,E.children.length,E.indexHint),-1!==N)){E.children.splice(N,1);B.push(E);this._condense(B);break}M||E.leaf||!v(E,P)?K?(J++,E=K.children[J],
M=!1):E=null:(B.push(E),A.push(J),J=0,K=E,E=E.children[0])}return this};D.toJSON=function(){return this._data};D.fromJSON=function(F){this._data=F;return this};D._all=function(F,E){for(C.clear();F;){if(!0===F.leaf)for(const K of F.children)E(K);else C.pushArray(F.children);F=C.pop()??null}};D._build=function(F,E,K,J){var M=K-E+1,N=this._maxEntries;if(M<=N)return F=new u(F.slice(E,K+1)),m(F,this._toBBox),F;J||(J=Math.ceil(Math.log(M)/Math.log(N)),N=Math.ceil(M/N**(J-1)));const P=new y([]);P.height=
J;M=Math.ceil(M/N);N=M*Math.ceil(Math.sqrt(N));for(k(F,E,K,N,this._compareMinX);E<=K;E+=N){const I=Math.min(E+N-1,K);k(F,E,I,M,this._compareMinY);for(let G=E;G<=I;G+=M)P.children.push(this._build(F,G,Math.min(G+M-1,I),J-1))}m(P,this._toBBox);return P};D._chooseSubtree=function(F,E,K,J){for(;;){J.push(E);if(!0===E.leaf||J.length-1===K)break;let M=Infinity,N=Infinity,P=void 0;for(let I=0,G=E.children.length;I<G;I++){const H=E.children[I],L=h(H),O=(Math.max(H.maxX,F.maxX)-Math.min(H.minX,F.minX))*(Math.max(H.maxY,
F.maxY)-Math.min(H.minY,F.minY))-L;O<N?(N=O,M=L<M?L:M,P=H):O===N&&L<M&&(M=L,P=H)}E=P||E.children[0]}return E};D._insert=function(F,E,K){var J=this._toBBox;K=K?F:J(F);B.clear();J=this._chooseSubtree(K,this._data,E,B);J.children.push(F);for(f(J,K);0<=E;)if(B.data[E].children.length>this._maxEntries)this._split(B,E),E--;else break;this._adjustParentBBoxes(K,B,E)};D._split=function(F,E){const K=F.data[E];var J=K.children.length;const M=this._minEntries;this._chooseSplitAxis(K,M,J);(J=this._chooseSplitIndex(K,
M,J))?(J=K.children.splice(J,K.children.length-J),J=K.leaf?new u(J):new y(J),J.height=K.height,m(K,this._toBBox),m(J,this._toBBox),E?F.data[E-1].children.push(J):this._splitRoot(K,J)):console.log("  Error: assertion failed at PooledRBush._split: no valid split index")};D._splitRoot=function(F,E){this._data=new y([F,E]);this._data.height=F.height+1;m(this._data,this._toBBox)};D._chooseSplitIndex=function(F,E,K){let J,M,N=void 0;J=M=Infinity;for(let I=E;I<=K-E;I++){var P=d(F,0,I,this._toBBox);const G=
d(F,I,K,this._toBBox),H=Math.max(0,Math.min(P.maxX,G.maxX)-Math.max(P.minX,G.minX))*Math.max(0,Math.min(P.maxY,G.maxY)-Math.max(P.minY,G.minY));P=h(P)+h(G);H<J?(J=H,N=I,M=P<M?P:M):H===J&&P<M&&(M=P,N=I)}return N};D._chooseSplitAxis=function(F,E,K){const J=F.leaf?this._compareMinX:e,M=F.leaf?this._compareMinY:g,N=this._allDistMargin(F,E,K,J);E=this._allDistMargin(F,E,K,M);N<E&&F.children.sort(J)};D._allDistMargin=function(F,E,K,J){F.children.sort(J);J=this._toBBox;var M=d(F,0,E,J);const N=d(F,K-E,K,
J);let P=l(M)+l(N);for(let I=E;I<K-E;I++){const G=F.children[I];f(M,F.leaf?J(G):G);P+=l(M)}for(K=K-E-1;K>=E;K--)M=F.children[K],f(N,F.leaf?J(M):M),P+=l(N);return P};D._adjustParentBBoxes=function(F,E,K){for(;0<=K;K--)f(E.data[K],F)};D._condense=function(F){for(let E=F.length-1;0<=E;E--){const K=F.data[E];if(0===K.children.length)if(0<E){const J=F.data[E-1],M=J.children;M.splice(b.indexOf(M,K,M.length,J.indexHint),1)}else this.clear();else m(K,this._toBBox)}};D._initFormat=function(F){const E=["return a",
" - b",";"];this._compareMinX=new Function("a","b",E.join(F[0]));this._compareMinY=new Function("a","b",E.join(F[1]));this._toBBox=new Function("a","return {minX: a"+F[0]+", minY: a"+F[1]+", maxX: a"+F[2]+", maxY: a"+F[3]+"};")};return w}();const z=new n,C=new n,B=new n,A=new n({deallocator:void 0});n=function(){this.minY=this.minX=Infinity;this.maxY=this.maxX=-Infinity};let x=function(w){function D(){var F=w.apply(this,arguments)||this;F.height=1;F.indexHint=new b.PositionHint;return F}c._inheritsLoose(D,
w);return D}(n),u=function(w){function D(F){var E=w.call(this)||this;E.children=F;E.leaf=!0;return E}c._inheritsLoose(D,w);return D}(x),y=function(w){function D(F){var E=w.call(this)||this;E.children=F;E.leaf=!1;return E}c._inheritsLoose(D,w);return D}(x);a.BBox=n;a.PooledRBush=p;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/quickselect":function(){define(["exports"],function(a){var c={};(function(b){(function(t){t=t();void 0!==t&&(b.exports=t)})(function(){function t(m,
d,f,e,g){for(;e>f;){if(600<e-f){var h=e-f+1,l=d-f+1,v=Math.log(h),q=.5*Math.exp(2*v/3);v=.5*Math.sqrt(v*q*(h-q)/h)*(0>l-h/2?-1:1);t(m,d,Math.max(f,Math.floor(d-l*q/h+v)),Math.min(e,Math.floor(d+(h-l)*q/h+v)),g)}h=m[d];l=f;q=e;n(m,f,d);for(0<g(m[e],h)&&n(m,f,e);l<q;){n(m,l,q);l++;for(q--;0>g(m[l],h);)l++;for(;0<g(m[q],h);)q--}0===g(m[f],h)?n(m,f,q):(q++,n(m,q,e));q<=d&&(f=q+1);d<=q&&(e=q-1)}}function n(m,d,f){var e=m[d];m[d]=m[f];m[f]=e}function r(m,d){return m<d?-1:m>d?1:0}return function(m,d,f,e,
g){t(m,d,f||0,e||m.length-1,g||r)}})})({get exports(){return c},set exports(b){c=b}});a.quickselect=c})},"esri/views/3d/layers/support/StageLayerElevationProvider":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../symbols/support/unitConversionUtils ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B){a.StageLayerElevationProvider=function(F){function E(J){J=F.call(this,J)||this;J._elevationOffset=0;J._layerHandes=new r;return J}c._inheritsLoose(E,F);var K=E.prototype;K.initialize=function(){this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersectLayers=[this.stageLayer];this._intersector=C.newIntersector(this.view.state.viewingMode);this._intersector.options.store=B.StoreResults.MIN;var J=this._computeLayerExtent(this.spatialReference,
this.stageLayer);this._zmin=J[2];this._zmax=J[5];J=this.stageLayer.events;this._layerHandes.add([J.on("layerObjectAdded",M=>this._objectChanged(M.object)),J.on("layerObjectRemoved",M=>this._objectChanged(M.object)),J.on("objectGeometryAdded",M=>this._objectChanged(M.object)),J.on("objectGeometryRemoved",M=>this._objectChanged(M.object)),J.on("objectGeometryUpdated",M=>this._objectChanged(M.object)),J.on("objectTransformation",M=>this._objectChanged(M))])};K.dispose=function(){this._layerHandes.destroy()};
K.elevationInfoChanged=function(){const J=null!=this.layer?this.layer.elevationInfo:null;if(null!=J&&"on-the-ground"!==J.mode){const M=f.getMetersPerVerticalUnitForSR(this.layer.spatialReference),N=z.getMetersPerUnit(J.unit??"meters");this._elevationOffset=d.unwrapOr(J.offset,0)*N/M}else this._elevationOffset=0};K.getElevation=function(J,M,N,P){y[0]=J;y[1]=M;y[2]=N;if(!this._renderCoordsHelper.toRenderCoords(y,P,y))return m.getLogger(this.declaredClass).error("could not project point for elevation alignment"),
null;J=this._elevationOffset;M=this._zmin+J;this._renderCoordsHelper.setAltitude(w,this._zmax+J,y);this._renderCoordsHelper.setAltitude(D,M,y);this._intersector.reset(w,D,null);this._intersector.intersect(this._intersectLayers,null,1,null,I=>!!I.metadata?.isElevationSource);return this._intersector.results.min.getIntersectionPoint(y)?this._renderCoordsHelper.getAltitude(y):null};K._objectChanged=function(J){const M=this.spatialReference;if(J.metadata?.isElevationSource&&!d.isNone(M)){k.empty(A);var N=
J.metadata.lastValidElevationBB;N.isEmpty()||this._expandExtent(M,N.min,N.max,A);var {min:P,max:I}=J.boundingVolumeWorldSpace;this._expandExtent(M,P,I,A);k.toRect(A,x);this._zmin=Math.min(this._zmin,A[2]);this._zmax=Math.max(this._zmax,A[5]);u.extent=x;u.spatialReference=M;this.emit("elevation-change",u);v.copy(N.min,P);v.copy(N.max,I)}};K._computeLayerExtent=function(J,M){k.empty(A);d.isSome(J)&&M.objects.forAll(N=>this._expandExtent(J,N.boundingVolumeWorldSpace.min,N.boundingVolumeWorldSpace.max,
A));return A};K._expandExtent=function(J,M,N,P){for(let I=0;8>I;++I)y[0]=I&1?M[0]:N[0],y[1]=I&2?M[1]:N[1],y[2]=I&4?M[2]:N[2],this._renderCoordsHelper.fromRenderCoords(y,y,J),k.expandWithVec3(P,y);return P};c._createClass(E,[{key:"spatialReference",get:function(){return this.view?.spatialReference}}]);return E}(n.EventedMixin(t));b.__decorate([e.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"layer",void 0);b.__decorate([e.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,
"stageLayer",void 0);b.__decorate([e.property({constructOnly:!0})],a.StageLayerElevationProvider.prototype,"view",void 0);b.__decorate([e.property()],a.StageLayerElevationProvider.prototype,"spatialReference",null);a.StageLayerElevationProvider=b.__decorate([l.subclass("esri.views.3d.layers.support.StageLayerElevationProvider")],a.StageLayerElevationProvider);const A=k.empty(),x=p.empty(),u={spatialReference:null,extent:x,context:"scene"},y=q.create(),w=q.create(),D=q.create();Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ./ExtentSet ../../webgl-engine/lib/UpdatePolicy ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){b=function(q){function k(z){z=q.call(this,z)||this;z._dirtyExtents=new h.ExtentSet;z._globalDirty=!1;z._averageExtentUpdateSize=0;z._dirtyGraphicsSet=new Set;z._handles=new n;z._updateElevation=!1;z.graphicsCoreOwner=null;z.graphicsCore=null;z.events=new t;return z}a._inheritsLoose(k,q);var p=k.prototype;p.initialize=function(){const z=this.graphicsCoreOwner.view.resourceController.scheduler;this._handles.add([this.elevationProvider.on("elevation-change",C=>this._elevationChanged(C)),
m.watch(()=>this.graphicsCoreOwner.suspended,()=>this._suspendedChange()),z.registerTask(v.TaskPriority.ELEVATION_ALIGNMENT,this)])};p.destroy=function(){this._dirtyGraphicsSet.clear();this._handles=r.destroyMaybe(this._handles);this.elevationProvider=this.queryGraphicUIDsInExtent=this.graphicsCore=this.graphicsCoreOwner=null};p.clear=function(){this._dirtyGraphicsSet.clear();this.notifyChange("updating")};p._suspendedChange=function(){!0===this.graphicsCoreOwner.suspended?this._updateElevation=!1:
!1===this.graphicsCoreOwner.suspended&&this._updateElevation&&(this._globalDirty=!0,this.notifyChange("updating"))};p.elevationInfoChange=function(){this._globalDirty=!0;this.notifyChange("updating")};p.runTask=function(z){this._globalDirty&&(this._markAllGraphicsElevationDirty(),this._globalDirty=!1,z.madeProgress());for(z.run(()=>this._dirtyExtents.merge(z));this.running&&!z.done;)this._updateDirtyGraphics(z),this._updateDirtyExtents(z);this.notifyChange("updating")};p._updateDirtyGraphics=function(z){const C=
this.graphicsCoreOwner.view.renderCoordsHelper,B=this.graphicsCore.effectiveUpdatePolicy===l.UpdatePolicy.ASYNC;for(const A of this._dirtyGraphicsSet.keys()){const x=this.graphicsCore.getGraphics3DGraphicById(A);this._dirtyGraphicsSet.delete(A);r.isSome(x)&&(x.alignWithElevation(this.elevationProvider,C,B),this.graphicsCoreOwner.view.deconflictor.setDirty(),z.madeProgress());if(z.done)break}};p._updateDirtyExtents=function(z){for(;!this._dirtyExtents.empty&&!z.done;){const C=this._dirtyExtents.pop(),
B=this.elevationProvider.spatialReference;this.events.emit("invalidate-elevation",{extent:C,spatialReference:B});const A=this._dirtyGraphicsSet.size;this.queryGraphicUIDsInExtent(C,B,x=>{const u=this.graphicsCore.getGraphics3DGraphicById(x);r.isSome(u)&&u.needsElevationUpdates()&&this._dirtyGraphicsSet.add(x)});this._averageExtentUpdateSize=.1*(this._dirtyGraphicsSet.size-A)+.9*this._averageExtentUpdateSize;z.madeProgress()}};p._markAllGraphicsElevationDirty=function(){this._dirtyExtents.clear();
this._dirtyGraphicsSet.clear();this.graphicsCore.graphics3DGraphics.forEach((z,C)=>this._dirtyGraphicsSet.add(C))};p._elevationChanged=function(z){if("scene"!==z.context||this.graphicsCore.layer.elevationInfo&&"relative-to-scene"===this.graphicsCore.layer.elevationInfo.mode){var {extent:C,spatialReference:B}=z;this.graphicsCoreOwner.suspended?(this._updateElevation||(z=this.graphicsCore.computedExtent)&&C[2]>z.xmin&&C[0]<z.xmax&&C[3]>z.ymin&&C[1]<z.ymax&&(this._updateElevation=!0),this.events.emit("invalidate-elevation",
{extent:C,spatialReference:B})):(-Infinity===C[0]?this._globalDirty=!0:this._dirtyExtents.add(C),this.notifyChange("updating"))}};a._createClass(k,[{key:"updating",get:function(){return this.running}},{key:"running",get:function(){return 0<this._dirtyGraphicsSet.size||this._dirtyExtents&&!this._dirtyExtents.empty||this._globalDirty}},{key:"updatingRemaining",get:function(){return this._dirtyGraphicsSet.size+this._dirtyExtents.size*this._averageExtentUpdateSize}}]);return k}(b);c.__decorate([d.property()],
b.prototype,"graphicsCoreOwner",void 0);c.__decorate([d.property()],b.prototype,"graphicsCore",void 0);c.__decorate([d.property()],b.prototype,"queryGraphicUIDsInExtent",void 0);c.__decorate([d.property()],b.prototype,"elevationProvider",void 0);c.__decorate([d.property({readOnly:!0})],b.prototype,"updating",null);c.__decorate([d.property({readOnly:!0})],b.prototype,"updatingRemaining",null);return b=c.__decorate([g.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],b)})},"esri/views/3d/layers/graphics/ExtentSet":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/PooledArray","../../../../geometry/support/aaBoundingRect","../../../support/Scheduler"],function(a,c,b,t,n){let r=function(){function m(){this._extents=new b({allocator:f=>f||t.create()});this._tmpExtent=t.create();this._dirty=!1}var d=m.prototype;d.clear=function(){this._extents.clear()};d.add=function(f){this._contains(f)||(this._removeContained(f),t.copy(this._extents.pushNew(),f),this._dirty=!0)};d.pop=function(){this._dirty&&this._mergeTight();
return this._extents.pop()};d.merge=function(f){this._mergeTight(f);return f.hasProgressed};d._mergeTight=function(f=n.noBudget){const e=this._extents,g=new Set;let h=0;for(;h!==e.length;){e.sort((l,v)=>l[0]-v[0]);h=e.length;g.clear();for(let l=0;l<e.length;++l){if(f.done)return;const v=e.getItemAt(l);if(v){for(let q=l+1;q<e.length;++q){const k=e.getItemAt(q);if(null==k||k[0]>=v[2])break;g.add(k)}g.forEach(q=>{if(v!==q)if(q[2]<=v[0])g.delete(q);else{var k=t.area(v),p=t.area(q),z=this._tmpExtent;t.expand(v,
q,z);k+=p;.05>(t.area(z)-k)/k&&(t.copy(v,z),g.delete(q),e.remove(q),f.madeProgress())}});g.add(v)}}}this._dirty=!1};d._contains=function(f){return this._extents.some(e=>t.contains(e,f))};d._removeContained=function(f){this._extents.filterInPlace(e=>!t.contains(f,e))};c._createClass(m,[{key:"empty",get:function(){return 0===this._extents.length}},{key:"size",get:function(){return this._extents.length}},{key:"test",get:function(){const f=this;return{containsPoint:e=>f._extents.some(g=>t.containsPoint(g,
e))}}}]);return m}();a.ExtentSet=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/ellipsoidUtils ../../support/FrustumExtentIntersection ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){b=function(v){function q(p){p=v.call(this,p)||this;p.suspended=!1;p._extent=null;p._extentIntersectionDirty=!0;p._isVisibleBelowSurfaceInternal=!1;p._handles=new t;p.graphicsCoreOwner=null;p.updating=!0;return p}a._inheritsLoose(q,v);var k=q.prototype;k.initialize=function(){var {graphicsCoreOwner:p}=this;this._extentIntersection=new h.FrustumExtentIntersection({renderCoordsHelper:p.view.renderCoordsHelper});const z=p.view,C=z.basemapTerrain;p=z.resourceController.scheduler;
this._handles.add([z.on("resize",()=>this._viewChange()),r.watch(()=>z.state.camera,()=>this._viewChange(),r.sync),p.registerTask(l.TaskPriority.FRUSTUM_VISIBILITY,this),r.watch(()=>C.visibleElevationBounds,()=>this._elevationBoundsChange())]);"local"===z.viewingMode?this._isVisibleBelowSurface=!0:this._handles.add([r.watch(()=>[C.baseOpacity,C.wireframe,z.map?.ground?.navigationConstraint?.type],()=>this._updateIsVisibleBelowSurface(),r.initial)])};k.destroy=function(){this._set("graphicsCoreOwner",
null);this._extentIntersection=this._extent=null;this._handles=n.destroyMaybe(this._handles)};k._setDirty=function(){this.updating||this._set("updating",!0)};k.setExtent=function(p){this._extent=p;this._extentIntersectionDirty=!0;this._setDirty()};k._viewChange=function(){this._setDirty()};k._elevationBoundsChange=function(){this._setDirty();this._extentIntersectionDirty=!0};k._updateIsVisibleBelowSurface=function(){const p=this.graphicsCoreOwner.view,z=p.basemapTerrain,C="none"===p.map.ground?.navigationConstraint?.type;
this._isVisibleBelowSurface="local"===p.viewingMode||!z.opaque||C};k._updateExtentIntersection=function(){if(this._extentIntersectionDirty){this._extentIntersectionDirty=!1;var p=this.graphicsCoreOwner.view;if(this._isVisibleBelowSurfaceInternal)var z=-.3*g.getReferenceEllipsoid(p.spatialReference).radius;else{const {min:C,max:B}=p.basemapTerrain.visibleElevationBounds;z=C-Math.max(1,(B-C)*(1.2-1))}this._extentIntersection.update(this._extent,p.spatialReference,z)}};k.runTask=function(p){this._set("updating",
!1);if(!this._extent)return this._set("suspended",!1),l.Task.YIELD;this._updateExtentIntersection();const z=this.graphicsCoreOwner.view.frustum,C=g.getReferenceEllipsoid(this.graphicsCoreOwner.view.spatialReference).radius;this._set("suspended",!this._extentIntersection.isVisibleInFrustum(z,C));p.madeProgress()};a._createClass(q,[{key:"_isVisibleBelowSurface",set:function(p){this._isVisibleBelowSurfaceInternal=p;this._setDirty();this._extentIntersectionDirty=!0}},{key:"running",get:function(){return this.updating}}]);
return q}(b);c.__decorate([m.property({readOnly:!0})],b.prototype,"suspended",void 0);c.__decorate([m.property({constructOnly:!0})],b.prototype,"graphicsCoreOwner",void 0);c.__decorate([m.property({readOnly:!0})],b.prototype,"updating",void 0);return b=c.__decorate([e.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],b)})},"esri/views/3d/layers/graphics/Graphics3DObjectStates":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/handleUtils",
"./Graphics3DObjectStateSet"],function(a,c,b,t){let n=function(){function r(d){this._graphicsCore=d;this._stateSets=[]}var m=r.prototype;m.destroy=function(){this.reset();this._stateSets=null};m.reset=function(){this._stateSets&&(this._stateSets.forEach(d=>d.objectStateSet.removeAll()),this._stateSets.length=0)};m.acquireSet=function(d,f){const e=new t.Graphics3DObjectStateSet(d,f);this._stateSets.push(e);d=b.makeHandle(()=>this.releaseSet(e));return{set:e,handle:d}};m.releaseSet=function(d){d.objectStateSet.removeAll();
d=this._stateSets?this._stateSets.indexOf(d):-1;-1!==d&&this._stateSets.splice(d,1)};m._addObjectStateSet=function(d,f){d.addObjectStateSet(f.stateType,f.objectStateSet)};m._removeObjectStateSet=function(d,f){d.removeObjectState(f.objectStateSet)};m.setUid=function(d,f){d.ids.add(f);(f=this._graphicsCore.graphics3DGraphics.get(f))&&this._addObjectStateSet(f,d)};m.setUids=function(d,f){f.forEach(e=>this.setUid(d,e))};m.setObjectIds=function(d,f){f.forEach(e=>d.ids.add(e));this._initializeSet(d)};m.addGraphic=
function(d){this._stateSets.forEach(f=>{!f.paused&&f.hasGraphic(d)&&this._addObjectStateSet(d,f)})};m.removeGraphic=function(d){this._stateSets.forEach(f=>{f.hasGraphic(d)&&this._removeObjectStateSet(d,f)})};m.allGraphicsDeleted=function(){this._stateSets&&this._stateSets.forEach(d=>d.objectStateSet.removeAll())};m._initializeSet=function(d){const f=this._graphicsCore.graphics3DGraphics;d.objectIdField?f.forEach(e=>{e&&d.hasGraphic(e)&&this._addObjectStateSet(e,d)}):d.ids.forEach(e=>{(e=f.get(e))&&
this._addObjectStateSet(e,d)})};c._createClass(r,[{key:"test",get:function(){return{states:this._stateSets}}}]);return r}();a.Graphics3DObjectStates=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/graphics/Graphics3DObjectStateSet":function(){define(["exports","../../webgl-engine/lib/Object3DStateSet"],function(a,c){let b=function(){function t(n,r){this.stateType=n;this.objectIdField=r;this.objectStateSet=new c.Object3DStateSet;this.ids=new Set;this.paused=
!1}t.prototype.hasGraphic=function(n){return this.objectIdField?this.ids.has(n.graphic.attributes[this.objectIdField]):this.ids.has(n.graphic.uid)};return t}();a.Graphics3DObjectStateSet=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/Object3DStateSet":function(){define(["exports","./basicInterfaces"],function(a,c){var b;(function(n){n[n.Object=0]="Object";n[n.RenderGeometry=1]="RenderGeometry";n[n.External=2]="External";n[n.COUNT=3]="COUNT"})(b||
(b={}));let t=function(){function n(){this._items=[]}var r=n.prototype;r.addObject=function(m,d){this._items.push({type:b.Object,objectStateId:d,object:m})};r.addRenderGeometry=function(m,d,f){this._items.push({type:b.RenderGeometry,objectStateId:d,renderGeometry:m,owner:f})};r.addExternal=function(m,d){this._items.push({type:b.External,objectStateId:d,remove:m})};r.remove=function(m){for(let d=this._items.length-1;0<=d;--d){const f=this._items[d];f.objectStateId===m&&(this._removeObjectStateItem(f),
this._items.splice(d,1))}};r.removeObject=function(m){for(let d=this._items.length-1;0<=d;--d){const f=this._items[d];f.type===b.Object&&f.object===m&&(this._removeObjectStateItem(f),this._items.splice(d,1))}};r.removeRenderGeometry=function(m){for(let d=this._items.length-1;0<=d;--d){const f=this._items[d];f.type===b.RenderGeometry&&f.renderGeometry===m&&(this._removeObjectStateItem(f),this._items.splice(d,1))}};r.removeAll=function(){this._items.forEach(m=>{this._removeObjectStateItem(m)});this._items=
[]};r._removeObjectStateItem=function(m){switch(m.type){case b.Object:m.objectStateId.channel===c.Object3DState.Highlight?m.object.removeHighlight(m.objectStateId):m.objectStateId.channel===c.Object3DState.MaskOccludee&&m.object.removeOcclude(m.objectStateId);break;case b.RenderGeometry:m.owner.removeRenderGeometryObjectState(m.renderGeometry,m.objectStateId);break;case b.External:m.remove(m.objectStateId)}};return n}();a.Object3DStateSet=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/projection ../../../../geometry/support/aaBoundingRect ./enums ../../../support/layerViewUtils ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){const q=t.getLogger("esri.views.3d.layers.graphics.Graphics3DScaleVisibility");b=function(p){function z(B){B=p.call(this,B)||this;B._scaleRangeActive=!1;B._layerScaleRangeVisibilityQuery=!1;B._extent=null;B.graphicsCoreOwner=null;B.layer=null;B.queryGraphicUIDsInExtent=null;B.graphicsCore=null;B.basemapTerrain=null;B.layerScaleEnabled=!0;B.suspended=!1;B._dirty=!0;return B}a._inheritsLoose(z,p);var C=z.prototype;C.initialize=function(){this.updateScaleRangeActive();
this.handles.add(this.graphicsCoreOwner.view.resourceController.scheduler.registerTask(v.TaskPriority.SCALE_VISIBILITY,this));this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this.layerMinMaxScaleChangeHandler())};C.destroy=function(){this.updatingHandles.removeAll();this.handles.removeAll();this._dirty=!1;this.basemapTerrain=this.graphicsCore=this.queryGraphicUIDsInExtent=this.layer=this.graphicsCoreOwner=this._extent=null};C._setDirty=function(){this._dirty=!0};C.setExtent=function(B){const A=
this.graphicsCoreOwner.view.spatialReference,x=this.graphicsCoreOwner.view.basemapTerrain.spatialReference;if(A===x)this._extent=B??null;else{const u=g.create();e.projectBoundingRect(B,A,u,x)?this._extent=u:this._extent=null}this._setDirty()};C.scaleRangeActive=function(){return this._scaleRangeActive};C.updateScaleRangeActive=function(){var B=this.layer,A=B.effectiveScaleRange;A=this.layerScaleEnabled&&null!=A&&(0<A.minScale||0<A.maxScale);B.labelingInfo&&!A&&(A=B.labelingInfo.some(x=>x&&(0<(x.minScale??
0)||0<(x.maxScale??0))));B=this._scaleRangeActive!==A;(this._scaleRangeActive=A)&&!this.handles.has("terrain-events")&&this.basemapTerrain?(this.handles.add(this.basemapTerrain.on("scale-change",x=>this._scaleUpdateHandler(x)),"terrain-events"),this.layerScaleEnabled&&this.handles.add(this.basemapTerrain.on("tiles-visibility-changed",()=>this._setDirty()),"terrain-events")):!A&&this.handles.has("terrain-events")&&this.handles.remove("terrain-events");return B};C.runTask=function(B){const A=this.graphicsCoreOwner.view.basemapTerrain;
if(this._extent&&A&&A.ready&&this._scaleRangeActive&&this.layerScaleEnabled){if(this._layerScaleRangeVisibilityQuery)return v.Task.YIELD;this._layerScaleRangeVisibilityQuery=!0;const {minScale:x,maxScale:u}=this.layer.effectiveScaleRange;A.queryVisibleScaleRange(this._extent,x,u,y=>this._finishUpdate(y))}else this._finishUpdate(!0);B.madeProgress()};C._finishUpdate=function(B){this._layerScaleRangeVisibilityQuery=!1;this._set("suspended",!B);this._dirty=!1};C._visibleAtLayerScale=function(B){const A=
this.layer.effectiveScaleRange;return!this.layerScaleEnabled||l.scaleBoundsPredicate(B,A.minScale||0,A.maxScale||0)};C._visibleAtLabelScale=function(B,A){return l.scaleBoundsPredicate(B,A.minScale||0,A.maxScale||0)};C._graphicScale=function(B){let A;n.isSome(B.centroid)?A=B.centroid:n.isSome(B.graphic.geometry)&&"point"===B.graphic.geometry.type&&(A=B.graphic.geometry);return A?this.graphicsCoreOwner.view.basemapTerrain?this.graphicsCoreOwner.view.basemapTerrain.getScale(A):1:null};C._graphicVisible=
function(B){if(!this.layerScaleEnabled)return!0;B=this._graphicScale(B);return this._visibleAtLayerScale(B)};C.updateVisibility=function(B){if(this._scaleRangeActive){const A=this._graphicVisible(B);return B.setVisibilityFlag(h.VisibilityFlag.SCALE_RANGE,A,h.VisibilityGroup.GRAPHIC)}return!1};C.updateGraphicLabelScaleVisibility=function(B){if(!this._scaleRangeActive||!B.labelLayers||0===B.labelLayers.length)return!1;const A=this._graphicScale(B);if(B=this._updateLabelScaleVisibility(B,A))this.graphicsCoreOwner.view.deconflictor.setDirty(),
this.graphicsCoreOwner.view.labeler.setDirty();return B};C._updateLabelScaleVisibility=function(B,A){if(!B.labelLayers||0===B.labelLayers.length)return!1;const x=B.labelLayers[0]._labelClass;return x&&null!=x.minScale&&null!=x.maxScale&&(A=this._visibleAtLabelScale(A,x),B.setVisibilityFlag(h.VisibilityFlag.SCALE_RANGE,A,h.VisibilityGroup.LABEL))?!0:!1};C._scaleUpdateHandler=function(B){this._setDirty();if(this.graphicsCore.visible){var A=B.extent,x=B.scale,u=this._visibleAtLayerScale(x),y=!1,w=this.graphicsCoreOwner.view.spatialReference;
B=B.spatialReference;if(n.isNone(B))q.error("scaleUpdate: Internal error, no SpatialReference given for tiles");else{var D=!B.equals(w);D&&!e.projectBoundingRect(A,B,k,w)?q.error("scaleUpdate: Internal error, cannot project AABR from "+B+" to wkid "+w):(this.queryGraphicUIDsInExtent(D?k:A,w,F=>{F=this.graphicsCore.getGraphics3DGraphicById(F);if(!n.isNone(F)){var E=F.centroid;n.isSome(E)&&(A[0]>E.x||A[1]>E.y||A[2]<E.x||A[3]<E.y)||(F.setVisibilityFlag(h.VisibilityFlag.SCALE_RANGE,u,h.VisibilityGroup.GRAPHIC)&&
(y=!0),this._updateLabelScaleVisibility(F,x)&&(y=!0))}}),y&&(this.graphicsCoreOwner.view.deconflictor.setDirty(),this.graphicsCoreOwner.view.labeler.setDirty()))}}};C.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&!this._scaleRangeActive?this.graphicsCore.modifyGraphics3DGraphicVisibilities(B=>B.clearVisibilityFlag(h.VisibilityFlag.SCALE_RANGE)):this._scaleRangeActive&&this.graphicsCore.updateAllGraphicsVisibility();this._setDirty()};a._createClass(z,[{key:"updating",get:function(){return this._dirty||
this.updatingHandles.updating}},{key:"running",get:function(){return!(!this.graphicsCoreOwner.view.basemapTerrain||!this.updating)}}]);return z}(b.HandleOwner);c.__decorate([r.property()],b.prototype,"graphicsCoreOwner",void 0);c.__decorate([r.property()],b.prototype,"layer",void 0);c.__decorate([r.property()],b.prototype,"queryGraphicUIDsInExtent",void 0);c.__decorate([r.property()],b.prototype,"graphicsCore",void 0);c.__decorate([r.property()],b.prototype,"basemapTerrain",void 0);c.__decorate([r.property({constructOnly:!0})],
b.prototype,"layerScaleEnabled",void 0);c.__decorate([r.property({readOnly:!0})],b.prototype,"suspended",void 0);c.__decorate([r.property({readOnly:!0})],b.prototype,"updating",null);c.__decorate([r.property()],b.prototype,"_dirty",void 0);b=c.__decorate([f.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],b);const k=g.create();return b})},"esri/views/3d/layers/support/attributeUtils":function(){define(["exports"],function(a){a.attributeLookup=function(c,b,t){if(!t||null==b)return null;
if(!c){a:{c=t.toLowerCase();for(var n in b)if(n.toLowerCase()===c){b=b[n];break a}b=null}return b}return(n=c.get(t))?b[n.name]:null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureVisibilityFilter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/asyncUtils ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/FeatureFilter ../../../../layers/support/floorFilterUtils ../graphics/QueryEngine ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){a.FeatureVisibilityFilter=function(z){function C(A){var x=z.call(this,A)||this;x._updateTask=null;x._frameTask=null;x._queryEngine=null;x._updateRequested=!0;x._updateVisibility=function(){var u=c._asyncToGenerator(function*(y){if(m.isNone(x._compositedFeatureFilter)&&m.isNone(x._sceneFilter)||0===x.context.getFeatureCount())return x._frameTask.schedule(()=>x.clear(),y);try{const w=yield x._queryEngine.executeQueryForIdSet(x._compositedFeatureFilter,x._sceneFilter,
y);return x._frameTask.schedule(()=>{x.context.updateFeatureVisibilities(D=>w.has(D))},y)}catch(w){return d.throwIfAbortError(w),r.getLogger(x.declaredClass).warn(`FeatureFilter query failed: ${w}`,{error:w}),x._frameTask.schedule(()=>{x.context.setAllFeaturesVisibility(!0)},y)}});return function(y){return u.apply(this,arguments)}}();return x}c._inheritsLoose(C,z);var B=C.prototype;B.initialize=function(){const A=p.TaskPriority.FILTER_VISIBILITY,{layer:x,view:u}=this._layerView,{featureStore:y}=this.context;
this._queryEngine=new k.QueryEngine({context:{spatialReference:u.spatialReference,layer:x,scheduler:u.resourceController.scheduler,featureStore:y,hasM:"hasM"in this._layerView?this._layerView.hasM:!1,hasZ:"hasZ"in this._layerView?this._layerView.hasZ:!1},priority:A});this._frameTask=this._layerView.view.resourceController.scheduler.registerTask(A,this);this.updatingHandles.add(()=>[this._compositedFeatureFilter,this._sceneFilter],()=>this.reapply(),f.initial)};B.destroy=function(){this._updateRequested=
!1;this.handles.removeAll();this.updatingHandles.removeAll();this.clear();this._updateTask=m.abortMaybe(this._updateTask);this._frameTask=m.removeMaybe(this._frameTask);this._queryEngine=m.destroyMaybe(this._queryEngine);this._set("context",null)};B.reapply=function(){this._updateRequested=!0};B.clear=function(){this._queryEngine.clear();this.context.clearFeaturesVisibility()};B.runTask=function(A){this._updateRequested&&(this._updateTask=m.abortMaybe(this._updateTask),this._updateTask=t.createTask(this._updateVisibility),
this._updateRequested=!1,A.madeProgress());this._frameTask.processQueue(A)};c._createClass(C,[{key:"updating",get:function(){return this.running||this.updatingHandles.updating||m.isSome(this._updateTask)&&!this._updateTask.finished}},{key:"running",get:function(){return this._updateRequested||this._frameTask.updating}},{key:"defaultVisibility",get:function(){return m.isNone(this._compositedFeatureFilter)&&m.isNone(this._sceneFilter)}},{key:"_featureFilter",get:function(){return"filter"in this._layerView?
this._layerView.filter:null}},{key:"_sceneFilter",get:function(){return"layerFilter"in this._layerView?this._layerView.layerFilter:null}},{key:"_floorFilter",get:function(){return q.getFloorFilterClause(this._layerView)}},{key:"_timeExtent",get:function(){return"timeExtent"in this._layerView?this._layerView.timeExtent:null}},{key:"_compositedFeatureFilter",get:function(){const {_featureFilter:A,_timeExtent:x,_floorFilter:u}=this;if(m.isNone(x)&&m.isNone(u))return A;const y=m.isSome(A)?A.clone():new v;
m.isSome(x)&&(y.timeExtent=m.isSome(y.timeExtent)?y.timeExtent.intersection(x):x);if(m.isSome(u)){const w=m.isNone(y.where)||""===y.where;y.where=w?u:`(${y.where}) AND (${u})`}return y}},{key:"_layerView",get:function(){return this.context.layerView}}]);return C}(n.HandleOwner);b.__decorate([e.property({constructOnly:!0})],a.FeatureVisibilityFilter.prototype,"context",void 0);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,"updating",null);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,
"running",null);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,"defaultVisibility",null);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,"_featureFilter",null);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,"_sceneFilter",null);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,"_floorFilter",null);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,"_timeExtent",null);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,
"_compositedFeatureFilter",null);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,"_layerView",null);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,"_updateTask",void 0);b.__decorate([e.property()],a.FeatureVisibilityFilter.prototype,"_updateRequested",void 0);a.FeatureVisibilityFilter=b.__decorate([l.subclass("esri.views.3d.layers.support.FeatureVisibilityFilter")],a.FeatureVisibilityFilter);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],
function(a){function c(b,t){if(!b?.length)return null;b=b.filter(n=>""!==n).map(n=>`'${n}'`);b.push("''");return`${t} IN (${b.join(",")}) OR ${t} IS NULL`}a.getFloorFilterClause=function(b){const t=b.layer;return"floorInfo"in t&&t.floorInfo?.floorField&&"floors"in b.view?c(b.view.floors,t.floorInfo.floorField):null};a.getLayerFloorFilterClause=function(b,t){return"floorInfo"in t&&t.floorInfo?.floorField?c(b,t.floorInfo.floorField):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/views/3d/layers/graphics/QueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query ../../../../geometry/support/typeUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){const k=h.QueryEngine;a.QueryEngine=function(p){function z(B){B=p.call(this,B)||this;B._dataQueryEngineInstance=null;return B}c._inheritsLoose(z,p);var C=z.prototype;C.destroy=function(){this.clear()};C.clear=function(){return this._dataQueryEngineInstance?(this._dataQueryEngineInstance.destroy(),this._dataQueryEngineInstance=null,!0):!1};C.executeQueryForIdSet=function(){var B=c._asyncToGenerator(function*(A,x,u){return this._dataQueryEngine.executeQueryForIdSet(this._ensureQueryJSON(A,
x),u)});return function(A,x,u){return B.apply(this,arguments)}}();C.executeQueryForCount=function(){var B=c._asyncToGenerator(function*(A,x){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(A),x)});return function(A,x){return B.apply(this,arguments)}}();C.executeQueryForExtent=function(){var B=c._asyncToGenerator(function*(A,x){const {count:u,extent:y}=yield this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(A),x);A=g.fromJSON(y);return{count:u,extent:A}});return function(A,
x){return B.apply(this,arguments)}}();C.executeQueryForIds=function(){var B=c._asyncToGenerator(function*(A,x){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(A),x)});return function(A,x){return B.apply(this,arguments)}}();C.executeQueryForLatestObservations=function(){var B=c._asyncToGenerator(function*(A,x){A=yield this._dataQueryEngine.executeQueryForLatestObservations(this._ensureQueryJSON(A),x);A=l.fromJSON(A);A.features.forEach(u=>{u.layer=this.layer;u.sourceLayer=this.layer});
return A});return function(A,x){return B.apply(this,arguments)}}();C.executeQuery=function(){var B=c._asyncToGenerator(function*(A,x){A=yield this._dataQueryEngine.executeQuery(this._ensureQueryJSON(A),x);A=l.fromJSON(A);A.features.forEach(u=>{u.layer=this.layer;u.sourceLayer=this.layer});return A});return function(A,x){return B.apply(this,arguments)}}();C._ensureQueryJSON=function(B,A){let x=this.defaultQueryJSON;r.isSome(B)&&("outSpatialReference"in B&&!B.outSpatialReference&&(B.outSpatialReference=
this.spatialReference),x=B.toJSON());r.isSome(A)&&(B=A.geometries.map(u=>u.toJSON()).reduce((u,y)=>{u.rings=u.rings.concat(y.rings);return u}),x={...x,sceneFilter:{...A,geometry:B}});return x};C._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const B="timeInfo"in this.layer&&this.layer.timeInfo&&this.layer.timeInfo.toJSON()||null,A=this.layer.objectIdField,x=q.featureGeometryTypeKebabDictionary.toJSON(this._queryGeometryType),u=this.layer.fields?.map(J=>
J.toJSON())??[],y=this.priority,w=this.spatialReference.toJSON(),{hasZ:D,hasM:F,featureStore:E,scheduler:K}=this.context;return this._dataQueryEngineInstance=new k({hasZ:D,hasM:F,geometryType:x,fields:u,timeInfo:B,spatialReference:w,objectIdField:A,featureStore:E,scheduler:K,priority:y})};c._createClass(z,[{key:"layer",get:function(){return this.context.layer}},{key:"spatialReference",get:function(){return this.context.spatialReference}},{key:"_queryGeometryType",get:function(){switch(this.layer.geometryType){case "multipoint":case "point":case "polygon":case "polyline":return this.layer.geometryType;
case "mesh":return"polygon"}}},{key:"defaultQueryJSON",get:function(){return(new v({outSpatialReference:this.spatialReference})).toJSON()}},{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return z}(n);b.__decorate([m.property({constructOnly:!0})],a.QueryEngine.prototype,"context",void 0);b.__decorate([m.property({constructOnly:!0})],a.QueryEngine.prototype,"priority",void 0);b.__decorate([m.property()],a.QueryEngine.prototype,"layer",null);b.__decorate([m.property()],
a.QueryEngine.prototype,"spatialReference",null);b.__decorate([m.property()],a.QueryEngine.prototype,"_queryGeometryType",null);b.__decorate([m.property()],a.QueryEngine.prototype,"defaultQueryJSON",null);a.QueryEngine=b.__decorate([e.subclass("esri.views.3d.layers.graphics.QueryEngine")],a.QueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngine":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/MemCache ../../../core/promiseUtils ../../../core/unitUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/boundsUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ./attributeSupport ./projectionSupport ./QueryEngineCapabilities ./QueryEngineResult ./spatialQuerySupport ./timeSupport ./utils ../../support/FieldsIndex ../../../support/arcadeOnDemand ../../../views/support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D){function F(M){return null!=M&&M.every(N=>"exceedslimit"!==N.statisticType)}const E=new m.MemCacheStorage(2E6);let K=0,J=function(){function M(P){this._changeHandle=this._geometryQueryCache=null;this.capabilities={query:C.queryCapabilities};this.geometryType=P.geometryType;this.hasM=!!P.hasM;this.hasZ=!!P.hasZ;this.objectIdField=P.objectIdField;this.spatialReference=P.spatialReference;this.definitionExpression=P.definitionExpression;this.featureStore=
P.featureStore;this.aggregateAdapter=P.aggregateAdapter;this._changeHandle=this.featureStore.events.on("changed",()=>this.clearCache());this.timeInfo=P.timeInfo;P.cacheSpatialQueries&&(this._geometryQueryCache=new m.MemCache(K++ +"$$",E));this.fieldsIndex=new y(P.fields);P.scheduler&&P.priority&&(this._frameTask=P.scheduler.registerTask(P.priority))}var N=M.prototype;N.destroy=function(){this._frameTask=r.removeMaybe(this._frameTask);this.clearCache();r.destroyMaybe(this._geometryQueryCache);this._changeHandle=
r.removeMaybe(this._changeHandle);r.destroyMaybe(this.fieldsIndex)};N.clearCache=function(){this._geometryQueryCache?.clear();this._timeExtentPromise=this._allFeaturesPromise=null};N.executeQuery=function(){var P=c._asyncToGenerator(function*(I,G){try{return(yield this._executeQuery(I,{},G)).createQueryResponse()}catch(H){if(H!==u.QUERY_ENGINE_EMPTY_RESULT)throw H;return(new B.QueryEngineResult([],I,this)).createQueryResponse()}});return function(I,G){return P.apply(this,arguments)}}();N.executeQueryForCount=
function(){var P=c._asyncToGenerator(function*(I={},G){try{return(yield this._executeQuery(I,{returnGeometry:!1,returnCentroid:!1,outSR:null},G)).createQueryResponseForCount()}catch(H){if(H!==u.QUERY_ENGINE_EMPTY_RESULT)throw H;return 0}});return function(){return P.apply(this,arguments)}}();N.executeQueryForExtent=function(){var P=c._asyncToGenerator(function*(I,G){const H=I.outSR;try{const L=yield this._executeQuery(I,{returnGeometry:!0,returnCentroid:!1,outSR:null},G),O=L.size;if(!O)return{count:0,
extent:null};const S=yield this._getBounds(L.items,L.spatialReference,H||this.spatialReference);return{count:O,extent:S}}catch(L){if(L===u.QUERY_ENGINE_EMPTY_RESULT)return{count:0,extent:null};throw L;}});return function(I,G){return P.apply(this,arguments)}}();N.executeQueryForIds=function(){var P=c._asyncToGenerator(function*(I,G){return this.executeQueryForIdSet(I,G).then(H=>Array.from(H))});return function(I,G){return P.apply(this,arguments)}}();N.executeQueryForIdSet=function(){var P=c._asyncToGenerator(function*(I,
G){try{const H=yield this._executeQuery(I,{returnGeometry:!0,returnCentroid:!1,outSR:null},G),L=H.items,O=new Set;yield this._reschedule(()=>{for(const S of L)O.add(H.featureAdapter.getObjectId(S))},G);return O}catch(H){if(H===u.QUERY_ENGINE_EMPTY_RESULT)return new Set;throw H;}});return function(I,G){return P.apply(this,arguments)}}();N.executeQueryForSnapping=function(){var P=c._asyncToGenerator(function*(I,G){const {point:H,distance:L,types:O}=I;if(O===B.SnappingTypes.NONE)return{candidates:[]};
const S=yield this._reschedule(()=>this._checkQuerySupport(I.query),G),R=!q.equals(H.spatialReference,this.spatialReference);R&&(yield z.checkProjectionSupport(H.spatialReference,this.spatialReference));var Q="number"===typeof L?L:L.x,V="number"===typeof L?L:L.y;Q={xmin:H.x-Q,xmax:H.x+Q,ymin:H.y-V,ymax:H.y+V,spatialReference:H.spatialReference};Q=R?z.project(Q,this.spatialReference):Q;if(!Q)return{candidates:[]};V=(yield v.normalizeCentralMeridian(l.fromJSON(H),null,{signal:G}))[0];const aa=(yield v.normalizeCentralMeridian(l.fromJSON(Q),
null,{signal:G}))[0];if(r.isNone(V)||r.isNone(aa))return{candidates:[]};const X=new B.QueryEngineResult(yield this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(aa.toJSON())),G),S,this);yield this._reschedule(()=>this._executeObjectIdsQuery(X),G);yield this._reschedule(()=>this._executeTimeQuery(X),G);yield this._reschedule(()=>this._executeAttributesQuery(X),G);G=V.toJSON();G=R?z.project(G,this.spatialReference):G;return X.createSnappingResponse({...I,point:G,distance:R?Math.max(Q.xmax-
Q.xmin,Q.ymax-Q.ymin)/2:L},H.spatialReference)});return function(I,G){return P.apply(this,arguments)}}();N.executeQueryForLatestObservations=function(){var P=c._asyncToGenerator(function*(I,G){if(!this.timeInfo||!this.timeInfo.trackIdField)throw new t("feature-store:unsupported-query","Missing timeInfo or timeInfo.trackIdField",{query:I,timeInfo:this.timeInfo});try{const H=yield this._executeQuery(I,{},G);yield this._reschedule(()=>this._filterLatest(H),G);return H.createQueryResponse()}catch(H){if(H!==
u.QUERY_ENGINE_EMPTY_RESULT)throw H;return(new B.QueryEngineResult([],I,this)).createQueryResponse()}});return function(I,G){return P.apply(this,arguments)}}();N.executeQueryForSummaryStatistics=function(){var P=c._asyncToGenerator(function*(I={},G,H){const {field:L,normalizationField:O,valueExpression:S}=G;return(yield this._getQueryEngineResultForStats(I,{field:L,normalizationField:O,valueExpression:S},H)).createSummaryStatisticsResponse(G)});return function(){return P.apply(this,arguments)}}();
N.executeQueryForUniqueValues=function(){var P=c._asyncToGenerator(function*(I={},G,H){const {field:L,field2:O,field3:S,valueExpression:R}=G;return(yield this._getQueryEngineResultForStats(I,{field:L,field2:O,field3:S,valueExpression:R},H)).createUniqueValuesResponse(G)});return function(){return P.apply(this,arguments)}}();N.executeQueryForClassBreaks=function(){var P=c._asyncToGenerator(function*(I={},G,H){const {field:L,normalizationField:O,valueExpression:S}=G;return(yield this._getQueryEngineResultForStats(I,
{field:L,normalizationField:O,valueExpression:S},H)).createClassBreaksResponse(G)});return function(){return P.apply(this,arguments)}}();N.executeQueryForHistogram=function(){var P=c._asyncToGenerator(function*(I={},G,H){const {field:L,normalizationField:O,valueExpression:S}=G;return(yield this._getQueryEngineResultForStats(I,{field:L,normalizationField:O,valueExpression:S},H)).createHistogramResponse(G)});return function(){return P.apply(this,arguments)}}();N.fetchRecomputedExtents=function(){var P=
c._asyncToGenerator(function*(I){const [G,H]=yield Promise.all(["getFullExtent"in this.featureStore&&this.featureStore.getFullExtent?Promise.resolve(this.featureStore.getFullExtent(this.spatialReference)):this._getBounds(yield this._getAllFeatures(),this.spatialReference,this.spatialReference),r.isSome(this._timeExtentPromise)?this._timeExtentPromise:this._timeExtentPromise=x.getTimeExtent(this.timeInfo,this.featureStore)]);d.throwIfAborted(I);return{fullExtent:G,timeExtent:H}});return function(I){return P.apply(this,
arguments)}}();N._getBounds=function(){var P=c._asyncToGenerator(function*(I,G,H){const L=e.set(e.create(),e.NEGATIVE_INFINITY);yield this.featureStore.forEachBounds(I,O=>e.expandWithAABB(L,O));I={xmin:L[0],ymin:L[1],xmax:L[3],ymax:L[4],spatialReference:u.cleanFromGeometryEngine(this.spatialReference)};this.hasZ&&isFinite(L[2])&&isFinite(L[5])&&(I.zmin=L[2],I.zmax=L[5]);G=z.project(I,G,H);G.spatialReference=u.cleanFromGeometryEngine(H);0===G.xmax-G.xmin&&(H=f.getMetersPerUnitForSR(G.spatialReference),
G.xmin-=H,G.xmax+=H);0===G.ymax-G.ymin&&(H=f.getMetersPerUnitForSR(G.spatialReference),G.ymin-=H,G.ymax+=H);this.hasZ&&null!=G.zmin&&null!=G.zmax&&0===G.zmax-G.zmin&&(H=f.getMetersPerUnitForSR(G.spatialReference),G.zmin-=H,G.zmax+=H);return G});return function(I,G,H){return P.apply(this,arguments)}}();N._schedule=function(){var P=c._asyncToGenerator(function*(I,G){return r.isSome(this._frameTask)?this._frameTask.schedule(I,G):I(D.noBudget)});return function(I,G){return P.apply(this,arguments)}}();
N._reschedule=function(){var P=c._asyncToGenerator(function*(I,G){return r.isSome(this._frameTask)?this._frameTask.reschedule(I,G):I(D.noBudget)});return function(I,G){return P.apply(this,arguments)}}();N._getAllFeaturesQueryEngineResult=function(){var P=c._asyncToGenerator(function*(I){return new B.QueryEngineResult(yield this._getAllFeatures(),I,this)});return function(I){return P.apply(this,arguments)}}();N._getAllFeatures=function(){var P=c._asyncToGenerator(function*(){var I=this;if(r.isNone(this._allFeaturesPromise)){const L=
[];this._allFeaturesPromise=c._asyncToGenerator(function*(){yield I.featureStore.forEach(O=>L.push(O))})().then(()=>L)}const G=this._allFeaturesPromise,H=yield G;return G===this._allFeaturesPromise?H.slice():this._getAllFeatures()});return function(){return P.apply(this,arguments)}}();N._executeQuery=function(){var P=c._asyncToGenerator(function*(I,G,H){I=n.clone(I);I=yield this._schedule(()=>u.normalizeQuery(I,this.definitionExpression,this.spatialReference),H);I=yield this._reschedule(()=>this._checkQuerySupport(I),
H);I={...I,...G};const L=yield this._reschedule(()=>this._executeSceneFilterQuery(I,H),H),O=yield this._reschedule(()=>this._executeGeometryQuery(I,L,H),H);yield this._reschedule(()=>this._executeAggregateIdsQuery(O),H);yield this._reschedule(()=>this._executeObjectIdsQuery(O),H);yield this._reschedule(()=>this._executeTimeQuery(O),H);yield this._reschedule(()=>this._executeAttributesQuery(O),H);return O});return function(I,G,H){return P.apply(this,arguments)}}();N._executeSceneFilterQuery=function(){var P=
c._asyncToGenerator(function*(I,G){var H=this;if(r.isNone(I.sceneFilter))return null;const {outSR:L,returnGeometry:O,returnCentroid:S}=I;var R=this.featureStore.featureSpatialReference,Q=I.sceneFilter.geometry;const V=r.isNone(R)||q.equals(R,Q.spatialReference)?Q:z.project(Q,R);if(!V)return null;R=O||S;R=q.isValid(L)&&!q.equals(this.spatialReference,L)&&R?function(){var T=c._asyncToGenerator(function*(U){return H._project(U,L)});return function(U){return T.apply(this,arguments)}}():T=>T;const aa=
this.featureAdapter;Q=yield this._reschedule(()=>this._searchFeatures(this._getQueryBBoxes(V)),G);if("disjoint"===I.sceneFilter.spatialRelationship){if(!Q.length)return null;const T=new Set;for(var X of Q)T.add(aa.getObjectId(X));const U=yield this._reschedule(()=>this._getAllFeatures(),G);X=yield this._reschedule(c._asyncToGenerator(function*(){const Y=yield A.getSpatialQueryOperator("esriSpatialRelDisjoint",V,H.geometryType,H.hasZ,H.hasM),ba=yield H._runSpatialFilter(U,da=>!T.has(aa.getObjectId(da))||
Y(aa.getGeometry(da)),G);return new B.QueryEngineResult(ba,I,H)}),G);return R(X)}if(!Q.length)return new B.QueryEngineResult([],I,this);if(this._canExecuteSinglePass(V,I))return R(new B.QueryEngineResult(Q,I,this));const W=yield A.getSpatialQueryOperator("esriSpatialRelContains",V,this.geometryType,this.hasZ,this.hasM);X=yield this._runSpatialFilter(Q,T=>W(aa.getGeometry(T)),G);return R(new B.QueryEngineResult(X,I,this))});return function(I,G){return P.apply(this,arguments)}}();N._executeGeometryQuery=
function(){var P=c._asyncToGenerator(function*(I,G,H){var L=this;if(r.isSome(G)&&0===G.items.length)return G;I=r.isSome(G)?G.query:I;const {geometry:O,outSR:S,spatialRel:R,returnGeometry:Q,returnCentroid:V}=I;var aa=this.featureStore.featureSpatialReference;const X=!O||r.isNone(aa)||q.equals(aa,O.spatialReference)?O:z.project(O,aa),W=Q||V,T=q.isValid(S)&&!q.equals(this.spatialReference,S),U=this._geometryQueryCache&&r.isNone(G)?T&&W?JSON.stringify({originalFilterGeometry:O,spatialRelationship:R,outSpatialReference:S}):
JSON.stringify({originalFilterGeometry:O,spatialRelationship:R}):null;aa=U?this._geometryQueryCache.get(U):null;if(r.isSome(aa))return new B.QueryEngineResult(aa,I,this);aa=function(){var ca=c._asyncToGenerator(function*(ja){T&&W&&(yield L._project(ja,S));U&&L._geometryQueryCache.put(U,ja.items,ja.items.length+1);return ja});return function(ja){return ca.apply(this,arguments)}}();if(!X)return aa(r.isSome(G)?G:yield this._getAllFeaturesQueryEngineResult(I));const Y=this.featureAdapter;let ba=yield this._reschedule(()=>
this._searchFeatures(this._getQueryBBoxes(O)),H);if("esriSpatialRelDisjoint"===R){if(!ba.length)return aa(r.isSome(G)?G:yield this._getAllFeaturesQueryEngineResult(I));const ca=new Set;for(var da of ba)ca.add(Y.getObjectId(da));const ja=r.isSome(G)?G.items:yield this._reschedule(()=>this._getAllFeatures(),H);da=yield this._reschedule(c._asyncToGenerator(function*(){const ia=yield A.getSpatialQueryOperator(R,X,L.geometryType,L.hasZ,L.hasM),Z=yield L._runSpatialFilter(ja,ha=>!ca.has(Y.getObjectId(ha))||
ia(Y.getGeometry(ha)),H);return new B.QueryEngineResult(Z,I,L)}),H);return aa(da)}if(r.isSome(G)){const ca=new b.PositionHint;ba=ba.filter(ja=>0<=b.indexOf(G.items,ja,G.items.length,ca))}if(!ba.length)return aa=new B.QueryEngineResult([],I,this),U&&this._geometryQueryCache.put(U,aa.items,1),aa;if(this._canExecuteSinglePass(X,I))return aa(new B.QueryEngineResult(ba,I,this));const ea=yield A.getSpatialQueryOperator(R,X,this.geometryType,this.hasZ,this.hasM);da=yield this._runSpatialFilter(ba,ca=>ea(Y.getGeometry(ca)),
H);return aa(new B.QueryEngineResult(da,I,this))});return function(I,G,H){return P.apply(this,arguments)}}();N._executeAggregateIdsQuery=function(P){if(0!==P.items.length&&P.query.aggregateIds&&P.query.aggregateIds.length&&!r.isNone(this.aggregateAdapter)){var I=new Set;for(const H of P.query.aggregateIds)this.aggregateAdapter.getFeatureObjectIds(H).forEach(L=>I.add(L));var G=this.featureAdapter.getObjectId;P.items=P.items.filter(H=>I.has(G(H)))}};N._executeObjectIdsQuery=function(P){if(0!==P.items.length&&
P.query.objectIds&&P.query.objectIds.length){var I=new Set(P.query.objectIds),G=this.featureAdapter.getObjectId;P.items=P.items.filter(H=>I.has(G(H)))}};N._executeTimeQuery=function(P){if(0!==P.items.length){var I=x.getTimeOperator(this.timeInfo,P.query.timeExtent,this.featureAdapter);r.isNone(I)||(P.items=P.items.filter(I))}};N._executeAttributesQuery=function(P){if(0!==P.items.length){var I=p.getWhereClause(P.query.where,this.fieldsIndex);if(I){if(!I.isStandardized)throw new TypeError("Where clause is not standardized");
P.items=P.items.filter(G=>I.testFeature(G,this.featureAdapter))}}};N._runSpatialFilter=function(){var P=c._asyncToGenerator(function*(I,G,H){var L=this;if(!G)return I;if(r.isNone(this._frameTask))return I.filter(Q=>G(Q));let O=0;const S=[],R=function(){var Q=c._asyncToGenerator(function*(V){for(;O<I.length;){const aa=I[O++];G(aa)&&(S.push(aa),V.madeProgress());V.done&&(yield L._reschedule(X=>R(X),H))}});return function(V){return Q.apply(this,arguments)}}();return this._reschedule(Q=>R(Q),H).then(()=>
S)});return function(I,G,H){return P.apply(this,arguments)}}();N._filterLatest=function(P){const {trackIdField:I,startTimeField:G,endTimeField:H}=this.timeInfo,L=H||G,O=new Map,S=this.featureAdapter.getAttribute;for(const R of P.items){const Q=S(R,I),V=S(R,L),aa=O.get(Q);(!aa||V>S(aa,L))&&O.set(Q,R)}P.items=Array.from(O.values())};N._canExecuteSinglePass=function(P,I){({spatialRel:I}=I);return A.canQueryWithRBush(P)&&("esriSpatialRelEnvelopeIntersects"===I||"esriGeometryPoint"===this.geometryType&&
("esriSpatialRelIntersects"===I||"esriSpatialRelContains"===I||"esriSpatialRelWithin"===I))};N._project=function(){var P=c._asyncToGenerator(function*(I,G){if(!G||q.equals(this.spatialReference,G))return I;const H=this.featureAdapter;G=yield z.projectMany(I.items.map(L=>u.getGeometry(this.geometryType,this.hasZ,this.hasM,H.getGeometry(L))),this.spatialReference,G);I.items=G.map((L,O)=>H.cloneWithGeometry(I.items[O],k.convertFromGeometry(L,this.hasZ,this.hasM)));return I});return function(I,G){return P.apply(this,
arguments)}}();N._getQueryBBoxes=function(P){if(A.canQueryWithRBush(P)){if(l.isExtent(P))return[g.fromValues(P.xmin,P.ymin,P.xmax,P.ymax)];if(l.isPolygon(P))return P.rings.map(I=>g.fromValues(Math.min(I[0][0],I[2][0]),Math.min(I[0][1],I[2][1]),Math.max(I[0][0],I[2][0]),Math.max(I[0][1],I[2][1])))}return[h.getBoundsXY(g.create(),P)]};N._searchFeatures=function(){var P=c._asyncToGenerator(function*(I){const G=new Set;yield Promise.all(I.map(H=>this.featureStore.forEachInBounds(H,L=>G.add(L))));I=Array.from(G.values());
G.clear();return I});return function(I){return P.apply(this,arguments)}}();N._checkStatisticsSupport=function(){var P=c._asyncToGenerator(function*(I,G){if(0>(I.distance??0)||null!=I.geometryPrecision||I.multipatchOption||I.pixelSize||I.relationParam||I.text||I.outStatistics||I.groupByFieldsForStatistics||I.having||I.orderByFields)throw new t("feature-store:unsupported-query","Unsupported query options",{query:I});this._checkAttributesQuerySupport(I);return Promise.all([this._checkStatisticsParamsSupport(G),
A.checkSpatialQuerySupport(I,this.geometryType,this.spatialReference),z.checkProjectionSupport(this.spatialReference,I.outSR)]).then(()=>I)});return function(I,G){return P.apply(this,arguments)}}();N._checkStatisticsParamsSupport=function(){var P=c._asyncToGenerator(function*(I){var G=[];I.valueExpression&&({arcadeUtils:G}=yield w.loadArcade(),G=G.extractFieldNames(I.valueExpression));I.field&&G.push(I.field);I.field2&&G.push(I.field2);I.field3&&G.push(I.field3);I.normalizationField&&G.push(I.normalizationField);
if(!G.length)throw new t("feature-store:unsupported-query","params should have at least a field or valueExpression",{params:I});p.validateFields(this.fieldsIndex,G,"params contains missing fields")});return function(I){return P.apply(this,arguments)}}();N._checkQuerySupport=function(){var P=c._asyncToGenerator(function*(I){if(0>(I.distance??0)||null!=I.geometryPrecision||I.multipatchOption||I.pixelSize||I.relationParam||I.text)throw new t("feature-store:unsupported-query","Unsupported query options",
{query:I});this._checkAttributesQuerySupport(I);this._checkStatisticsQuerySupport(I);return Promise.all([A.checkSpatialQuerySupport(I,this.geometryType,this.spatialReference),z.checkProjectionSupport(this.spatialReference,I.outSR)]).then(()=>I)});return function(I){return P.apply(this,arguments)}}();N._checkAttributesQuerySupport=function(P){const {outFields:I,orderByFields:G,returnDistinctValues:H,outStatistics:L}=P,O=L?L.map(S=>S.outStatisticFieldName&&S.outStatisticFieldName.toLowerCase()).filter(Boolean):
[];if(G&&0<G.length){const S=G.map(R=>{const Q=R.toLowerCase();return Q.includes(" asc")?Q.split(" asc")[0]:Q.includes(" desc")?Q.split(" desc")[0]:R}).filter(R=>!O.includes(R));p.validateFields(this.fieldsIndex,S,"orderByFields contains missing fields")}if(I&&0<I.length)p.validateFields(this.fieldsIndex,I,"outFields contains missing fields");else if(H)throw new t("feature-store:unsupported-query","outFields should be specified for returnDistinctValues",{query:P});p.validateWhere(this.fieldsIndex,
P.where)};N._checkStatisticsQuerySupport=function(P){const {outStatistics:I,groupByFieldsForStatistics:G,having:H}=P;var L=G&&G.length,O=I&&I.length;if(H){if(!L||!O)throw new t("feature-store:unsupported-query","outStatistics and groupByFieldsForStatistics should be specified with having",{query:P});p.validateHaving(this.fieldsIndex,H,I)}if(O&&F(I)){O=I.map(S=>S.onStatisticField).filter(Boolean);p.validateFields(this.fieldsIndex,O,"onStatisticFields contains missing fields");L&&p.validateFields(this.fieldsIndex,
G,"groupByFieldsForStatistics contains missing fields");for(const S of I){const {onStatisticField:R,statisticType:Q}=S;if(("percentile_disc"===Q||"percentile_cont"===Q)&&"statisticParameters"in S){if({statisticParameters:L}=S,!L)throw new t("feature-store:unsupported-query","statisticParamters should be set for percentile type",{definition:S,query:P});}else if("count"!==Q&&R&&p.hasInvalidFieldType(R,this.fieldsIndex))throw new t("feature-store:unsupported-query","outStatistics contains non-numeric fields",
{definition:S,query:P});}}};N._getQueryEngineResultForStats=function(){var P=c._asyncToGenerator(function*(I,G,H){I=n.clone(I);try{I=yield this._schedule(()=>u.normalizeQuery(I,this.definitionExpression,this.spatialReference),H);I=yield this._reschedule(()=>this._checkStatisticsSupport(I,G),H);const L=yield this._reschedule(()=>this._executeSceneFilterQuery(I,H),H),O=yield this._reschedule(()=>this._executeGeometryQuery(I,L,H),H);yield this._reschedule(()=>this._executeAggregateIdsQuery(O),H);yield this._reschedule(()=>
this._executeObjectIdsQuery(O),H);yield this._reschedule(()=>this._executeTimeQuery(O),H);yield this._reschedule(()=>this._executeAttributesQuery(O),H);return O}catch(L){if(L!==u.QUERY_ENGINE_EMPTY_RESULT)throw L;return new B.QueryEngineResult([],I,this)}});return function(I,G,H){return P.apply(this,arguments)}}();c._createClass(M,[{key:"featureAdapter",get:function(){return this.featureStore.featureAdapter}}]);return M}();a.Feature=function(M,N=null,P,I,G){this.attributes=M;this.geometry=P;this.centroid=
I;this.filterFlags=G;this.groupId=-1;this.displayId=N};a.QueryEngine=J;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/attributeSupport":function(){define(["exports","../../../core/Error","../../../core/sql/WhereClauseCache"],function(a,c,b){function t(f,e){return f?m.get(f,e):null}function n(f,e,g,h=!0){const l=[];for(const v of e)if("*"!==v&&!f.has(v))if(h){e=r(v);try{const q=t(e,f);if(!q)throw new c("feature-store:unsupported-query","invalid SQL expression",
{where:e});if(!q.isStandardized)throw new c("feature-store:unsupported-query","expression is not standard",{clause:q});n(f,q.fieldNames,"expression contains missing fields")}catch(q){if((e=q&&q.details)&&(e.clause||e.where))throw q;e&&e.missingFields?l.push(...e.missingFields):l.push(v)}}else l.push(v);if(l.length)throw new c("feature-store:unsupported-query",g,{missingFields:l});}function r(f){return f.split(" as ")[0]}const m=new b.WhereClauseCache(50,500),d=new Set("esriFieldTypeOID esriFieldTypeSmallInteger esriFieldTypeInteger esriFieldTypeSingle esriFieldTypeDouble esriFieldTypeLong esriFieldTypeDate".split(" "));
a.getAliasFromFieldName=function(f){return f.split(" as ")[1]};a.getExpressionFromFieldName=r;a.getWhereClause=t;a.hasInvalidFieldType=function(f,e){return(f=e.get(f))?!d.has(f.type):!1};a.validateFields=n;a.validateHaving=function(f,e,g){if(!e)return!0;const h=m.get(e,f);if(!h)throw new c("feature-store:unsupported-query","invalid SQL expression",{having:e});if(!h.isAggregate)throw new c("feature-store:unsupported-query","having does not contain a valid aggregate function",{having:e});n(f,h.fieldNames,
"having contains missing fields");if(!h.getExpressions().every(l=>{const {aggregateType:v,field:q}=l,k=f.get(q)?.name;return g.some(p=>{const {onStatisticField:z,statisticType:C}=p;return f.get(z)?.name===k&&C.toLowerCase().trim()===v})}))throw new c("feature-store:unsupported-query","expressions in having should also exist in outStatistics",{having:e});return!0};a.validateWhere=function(f,e){if(!e)return!0;const g=m.get(e,f);if(!g)throw new c("feature-store:unsupported-query","invalid SQL expression",
{where:e});if(!g.isStandardized)throw new c("feature-store:unsupported-query","where clause is not standard",{where:e});n(f,g.fieldNames,"where clause contains missing fields");return!0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClauseCache":function(){define(["exports","../ItemCache","./WhereClause"],function(a,c,b){let t=function(){function n(r,m){this._cache=new c(r);this._invalidCache=new c(m)}n.prototype.get=function(r,m){const d=`${m.uid}:${r}`,f=this._cache.get(d);
if(f)return f;if(void 0!==this._invalidCache.get(d))return null;try{const e=b.WhereClause.create(r,m);this._cache.put(d,e);return e}catch{return this._invalidCache.put(d,null),null}};return n}();a.WhereClauseCache=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereClause":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../has ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(a,c,b,t,n,r){function m(M,N){M+="";return M.length>=
N?M:Array(N-M.length+1).join("0")+M}function d(M,N,P="0",I="0",G="0",H="0",L="",O="0",S="0"){return"+"===L||"-"===L?(M=`${m(parseInt(M,10),4)}-${m(parseInt(N,10),2)}-${m(parseInt(P,10),2)}`,N="",10>parseFloat(H)&&(N="0"),I=`${m(parseInt(I,10),2)}:${m(parseInt(G,10),2)}:${N+parseFloat(H).toString()}`,L=`${L}${m(parseInt(O,10),2)}:${m(parseInt(S,10),2)}`,new Date(M+"T"+I+L)):new Date(parseInt(M,10),parseInt(N,10)-1,parseInt(P,10),parseInt(I,10),parseInt(G,10),parseFloat(H))}function f(M){let N=x.exec(M);
if(null!==N){const [,P,I,G,H,L,O]=N;return d(P,I,G,H,L,O)}N=u.exec(M);if(null!==N){const [,P,I,G,H,L,O,S,R,Q]=N;return d(P,I,G,H,L,O,S,R,Q)}N=y.exec(M);if(null!==N){const [,P,I,G,H,L,O,S,R]=N;return d(P,I,G,H,L,"0",O,S,R)}N=w.exec(M);if(null!==N){const [,P,I,G,H,L]=N;return d(P,I,G,H,L)}N=A.exec(M);if(null!==N){const [,P,I,G]=N;return d(P,I,G)}throw Error("SQL Invalid Timestamp");}function e(M){const N=A.exec(M);if(null===N)try{return f(M)}catch{throw Error("SQL Invalid Date");}const [,P,I,G]=N;return new Date(parseInt(P,
10),parseInt(I,10)-1,parseInt(G,10))}function g(M){return Array.isArray(M)?M:[M]}function h(M){return null!==M?!0!==M:null}function l(M,N){return null!=M&&null!=N?!0===M&&!0===N:!1===M||!1===N?!1:null}function v(M,N){return null!=M&&null!=N?!0===M||!0===N:!0===M||!0===N?!0:null}function q(M,N){if(null==M)return null;let P=!1;for(const I of N)if(null==I)P=null;else if(M===I){P=!0;break}return P}function k(M,N,P){if(null==M)return null;let I="",G=K.Normal;for(let H=0;H<N.length;H++){const L=N.charAt(H);
switch(G){case K.Normal:L===P?G=K.Escaped:I="-[]/{}()*+?.\\^$|".includes(L)?I+("\\"+L):"%"===L?I+".*":"_"===L?I+".":I+L;break;case K.Escaped:I="-[]/{}()*+?.\\^$|".includes(L)?I+("\\"+L):I+L,G=K.Normal}}return(new RegExp("^"+I+"$","m")).test(M)}function p(M){return M instanceof Date?M.valueOf():M}function z(M,N,P){if(null==N||null==P)return null;N=p(N);P=p(P);switch(M){case "\x3c\x3e":return N!==P;case "\x3d":return N===P;case "\x3e":return N>P;case "\x3c":return N<P;case "\x3e\x3d":return N>=P;case "\x3c\x3d":return N<=
P}}function C(M,N,P){if("||"===M)return n.evaluateFunction("concat",[N,P]);if(N instanceof n.SqlInterval)if(P instanceof Date)switch(M){case "+":return new Date(N.valueInMilliseconds()+P.getTime());case "-":return N.valueInMilliseconds()-P.getTime();case "*":return N.valueInMilliseconds()*P.getTime();case "/":return N.valueInMilliseconds()/P.getTime()}else if(P instanceof n.SqlInterval)switch(M){case "+":return n.SqlInterval.createFromMilliseconds(N.valueInMilliseconds()+P.valueInMilliseconds());
case "-":return n.SqlInterval.createFromMilliseconds(N.valueInMilliseconds()-P.valueInMilliseconds());case "*":return N.valueInMilliseconds()*P.valueInMilliseconds();case "/":return N.valueInMilliseconds()/P.valueInMilliseconds()}else N=N.valueInMilliseconds();else if(P instanceof n.SqlInterval)if(N instanceof Date)switch(M){case "+":return new Date(P.valueInMilliseconds()+N.getTime());case "-":return new Date(N.getTime()-P.valueInMilliseconds());case "*":return N.getTime()*P.valueInMilliseconds();
case "/":return N.getTime()/P.valueInMilliseconds()}else P=P.valueInMilliseconds();else if(N instanceof Date&&"number"===typeof P)switch(P*=864E5,N=N.getTime(),M){case "+":return new Date(N+P);case "-":return new Date(N-P);case "*":return new Date(N*P);case "/":return new Date(N/P)}else if(P instanceof Date&&"number"===typeof N)switch(N*=864E5,P=P.getTime(),M){case "+":return new Date(N+P);case "-":return new Date(N-P);case "*":return new Date(N*P);case "/":return new Date(N/P)}switch(M){case "+":return N+
P;case "-":return N-P;case "*":return N*P;case "/":return N/P}}function B(M,N,P,I){M=I.getAttribute(M,N);return null!=M&&1===P[N]?new Date(M):M}const A=/^(\d{4})-(\d{1,2})-(\d{1,2})$/,x=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)$/,u=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2}):(\d{1,2}(\.[0-9]+)?)(\+|\-)(\d{1,2}):(\d{1,2})$/,y=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})(\+|\-)(\d{1,2}):(\d{1,2})$/,w=/^(\d{4})-(\d{1,2})-(\d{1,2}) (\d{1,2}):(\d{1,2})$/,D=new Set(["current_timestamp",
"current_date","current_time"]);let F=function(){function M(){}M.makeBool=function(N){return!0===N};M.featureValue=function(N,P,I,G){return B(N,P,I,G)};M.equalsNull=function(N){return null===N};M.applyLike=function(N,P,I){return k(N,P,I)};M.ensureArray=function(N){return g(N)};M.applyIn=function(N,P){return q(N,P)};M.currentDate=function(){const N=new Date;N.setHours(0,0,0,0);return N};M.makeSqlInterval=function(N,P,I){return n.SqlInterval.createFromValueAndQualifer(N,P,I)};M.convertInterval=function(N){return N instanceof
n.SqlInterval?N.valueInMilliseconds():N};M.currentTimestamp=function(){return new Date};M.compare=function(N,P,I){return z(N,P,I)};M.calculate=function(N,P,I){return C(N,P,I)};M.makeComparable=function(N){return p(N)};M.evaluateFunction=function(N,P){return n.evaluateFunction(N,P)};M.lookup=function(N,P){N=P[N];return void 0===N?null:N};M.between=function(N,P){return null==N||null==P[0]||null==P[1]?null:N>=P[0]&&N<=P[1]};M.notbetween=function(N,P){return null==N||null==P[0]||null==P[1]?null:N<P[0]||
N>P[1]};M.ternaryNot=function(N){return h(N)};M.ternaryAnd=function(N,P){return l(N,P)};M.ternaryOr=function(N,P){return v(N,P)};return M}(),E=function(){function M(P,I){this.fieldsIndex=I;this._datefields={};this.parameters={};this._hasDateFunctions=void 0;this.parseTree=r.WhereGrammar.parse(P);const {isStandardized:G,isAggregate:H,referencedFieldNames:L}=this._extractExpressionInfo(I);this._referencedFieldNames=L;this.isStandardized=G;this.isAggregate=H}M.create=function(P,I){return new M(P,I)};
var N=M.prototype;N.testSet=function(P,I=J){const G={};for(const H of this.fieldNames)G[H]=P.map(L=>I.getAttribute(L,H));return!!this._evaluateNode(this.parseTree,{attributes:G},J)};N.calculateValue=function(P,I=J){P=this._evaluateNode(this.parseTree,P,I);return P instanceof n.SqlInterval?P.valueInMilliseconds()/864E5:P};N.calculateValueCompiled=function(P,I=J){if(null!=this.parseTree._compiledVersion)return this.parseTree._compiledVersion(P,this.parameters,I,this._datefields);if(b("esri-csp-restrictions"))return this.calculateValue(P,
I);this._compileMe();return this.parseTree._compiledVersion(P,this.parameters,I,this._datefields)};N.testFeature=function(P,I=J){return!!this._evaluateNode(this.parseTree,P,I)};N.testFeatureCompiled=function(P,I=J){if(null!=this.parseTree._compiledVersion)return!!this.parseTree._compiledVersion(P,this.parameters,I,this._datefields);if(b("esri-csp-restrictions"))return this.testFeature(P,I);this._compileMe();return!!this.parseTree._compiledVersion(P,this.parameters,I,this._datefields)};N.getFunctions=
function(){const P=new Set;this._visitAll(this.parseTree,I=>{"function"===I.type&&P.add(I.name.toLowerCase())});return Array.from(P)};N.getExpressions=function(){const P=new Map;this._visitAll(this.parseTree,I=>{if("function"===I.type){const G=I.name.toLowerCase();I=I.args.value[0];if("column-reference"===I.type){I=I.column;const H=`${G}-${I}`;P.has(H)||P.set(H,{aggregateType:G,field:I})}}});return[...P.values()]};N.getVariables=function(){const P=new Set;this._visitAll(this.parseTree,I=>{"parameter"===
I.type&&P.add(I.value.toLowerCase())});return Array.from(P)};N._compileMe=function(){const P="return this.convertInterval("+this.evaluateNodeToJavaScript(this.parseTree)+")";this.parseTree._compiledVersion=(new Function("feature","lookups","attributeAdapter","datefields",P)).bind(F)};N._extractExpressionInfo=function(P){const I=[],G=new Set;let H=!0,L=!0;this._visitAll(this.parseTree,O=>{switch(O.type){case "column-reference":const S=P?.get(O.column);let R,Q;S?R=Q=S.name??"":(Q=O.column,R=Q.toLowerCase());
S&&S.name&&("date"===S.type||"esriFieldTypeDate"===S.type)&&(this._datefields[S.name]=1);G.has(R)||(G.add(R),I.push(Q));O.column=Q;break;case "function":const {name:V,args:aa}=O;O=aa.value.length;H&&(H=n.isStandardized(V,O));L&&(L=t.isAggregate(V,O))}});return{referencedFieldNames:Array.from(I),isStandardized:H,isAggregate:L}};N._visitAll=function(P,I){if(null!=P)switch(I(P),P.type){case "when-clause":this._visitAll(P.operand,I);this._visitAll(P.value,I);break;case "case-expression":for(const G of P.clauses)this._visitAll(G,
I);"simple"===P.format&&this._visitAll(P.operand,I);null!==P.else&&this._visitAll(P.else,I);break;case "expression-list":for(const G of P.value)this._visitAll(G,I);break;case "unary-expression":this._visitAll(P.expr,I);break;case "binary-expression":this._visitAll(P.left,I);this._visitAll(P.right,I);break;case "function":this._visitAll(P.args,I)}};N.evaluateNodeToJavaScript=function(P){switch(P.type){case "interval":return"this.makeSqlInterval("+this.evaluateNodeToJavaScript(P.value)+", "+JSON.stringify(P.qualifier)+
","+JSON.stringify(P.op)+")";case "case-expression":var I="";if("simple"===P.format){var G="this.makeComparable("+this.evaluateNodeToJavaScript(P.operand)+")";I="( ";for(let H=0;H<P.clauses.length;H++)I+=" ("+G+" \x3d\x3d\x3d this.makeComparable("+this.evaluateNodeToJavaScript(P.clauses[H].operand)+")) ? ("+this.evaluateNodeToJavaScript(P.clauses[H].value)+") : "}else for(I="( ",G=0;G<P.clauses.length;G++)I+=" this.makeBool("+this.evaluateNodeToJavaScript(P.clauses[G].operand)+")\x3d\x3d\x3dtrue ? ("+
this.evaluateNodeToJavaScript(P.clauses[G].value)+") : ";I=null!==P.else?I+this.evaluateNodeToJavaScript(P.else):I+"null";return I+" )";case "parameter":return"this.lookup("+JSON.stringify(P.value.toLowerCase())+",lookups)";case "expression-list":I="[";for(G of P.value)"["!==I&&(I+=","),I+=this.evaluateNodeToJavaScript(G);return I+"]";case "unary-expression":return"this.ternaryNot("+this.evaluateNodeToJavaScript(P.expr)+")";case "binary-expression":switch(P.operator){case "AND":return"this.ternaryAnd("+
this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+" )";case "OR":return"this.ternaryOr("+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+" )";case "IS":if("null"!==P.right.type)throw Error("Unsupported RHS for IS");return"this.equalsNull("+this.evaluateNodeToJavaScript(P.left)+")";case "ISNOT":if("null"!==P.right.type)throw Error("Unsupported RHS for IS");return"(!(this.equalsNull("+this.evaluateNodeToJavaScript(P.left)+")))";case "IN":return"this.applyIn("+
this.evaluateNodeToJavaScript(P.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(P.right)+"))";case "NOT IN":return"this.ternaryNot(this.applyIn("+this.evaluateNodeToJavaScript(P.left)+",this.ensureArray("+this.evaluateNodeToJavaScript(P.right)+")))";case "BETWEEN":return"this.between("+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+")";case "NOTBETWEEN":return"this.notbetween("+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+
")";case "LIKE":return"this.applyLike("+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+","+JSON.stringify(P.escape)+")";case "NOT LIKE":return"this.ternaryNot(this.applyLike("+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+","+JSON.stringify(P.escape)+"))";case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return"this.compare("+JSON.stringify(P.operator)+","+this.evaluateNodeToJavaScript(P.left)+","+
this.evaluateNodeToJavaScript(P.right)+")";case "*":case "-":case "+":case "/":case "||":return"this.calculate("+JSON.stringify(P.operator)+","+this.evaluateNodeToJavaScript(P.left)+","+this.evaluateNodeToJavaScript(P.right)+")"}throw Error("Not Supported Operator "+P.operator);case "null":case "boolean":case "string":case "number":return JSON.stringify(P.value);case "date":return"(new Date("+e(P.value).getTime().toString()+"))";case "timestamp":return"(new Date("+f(P.value).getTime().toString()+
"))";case "current-time":return"date"===P.mode?"this.currentDate()":"this.currentTimestamp()";case "column-reference":return"this.featureValue(feature,"+JSON.stringify(P.column)+",datefields,attributeAdapter)";case "function":return"this.evaluateFunction("+JSON.stringify(P.name)+","+this.evaluateNodeToJavaScript(P.args)+")"}throw Error("Unsupported sql syntax "+P.type);};N._evaluateNode=function(P,I,G){switch(P.type){case "interval":return I=this._evaluateNode(P.value,I,G),n.SqlInterval.createFromValueAndQualifer(I,
P.qualifier,P.op);case "case-expression":if("simple"===P.format){var H=p(this._evaluateNode(P.operand,I,G));for(var L=0;L<P.clauses.length;L++)if(H===p(this._evaluateNode(P.clauses[L].operand,I,G)))return this._evaluateNode(P.clauses[L].value,I,G)}else for(H=0;H<P.clauses.length;H++)if(!0===this._evaluateNode(P.clauses[H].operand,I,G))return this._evaluateNode(P.clauses[H].value,I,G);return null!==P.else?this._evaluateNode(P.else,I,G):null;case "parameter":return this.parameters[P.value.toLowerCase()];
case "expression-list":H=[];for(L of P.value)H.push(this._evaluateNode(L,I,G));return H;case "unary-expression":return h(this._evaluateNode(P.expr,I,G));case "binary-expression":switch(P.operator){case "AND":return l(this._evaluateNode(P.left,I,G),this._evaluateNode(P.right,I,G));case "OR":return v(this._evaluateNode(P.left,I,G),this._evaluateNode(P.right,I,G));case "IS":if("null"!==P.right.type)throw Error("Unsupported RHS for IS");return null===this._evaluateNode(P.left,I,G);case "ISNOT":if("null"!==
P.right.type)throw Error("Unsupported RHS for IS");return null!==this._evaluateNode(P.left,I,G);case "IN":return H=g(this._evaluateNode(P.right,I,G)),q(this._evaluateNode(P.left,I,G),H);case "NOT IN":return H=g(this._evaluateNode(P.right,I,G)),h(q(this._evaluateNode(P.left,I,G),H));case "BETWEEN":return H=this._evaluateNode(P.left,I,G),P=this._evaluateNode(P.right,I,G),null==H||null==P[0]||null==P[1]?null:H>=p(P[0])&&H<=p(P[1]);case "NOTBETWEEN":return H=this._evaluateNode(P.left,I,G),P=this._evaluateNode(P.right,
I,G),null==H||null==P[0]||null==P[1]?null:H<p(P[0])||H>p(P[1]);case "LIKE":return k(this._evaluateNode(P.left,I,G),this._evaluateNode(P.right,I,G),P.escape);case "NOT LIKE":return h(k(this._evaluateNode(P.left,I,G),this._evaluateNode(P.right,I,G),P.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return z(P.operator,this._evaluateNode(P.left,I,G),this._evaluateNode(P.right,I,G));case "-":case "+":case "*":case "/":case "||":return C(P.operator,this._evaluateNode(P.left,
I,G),this._evaluateNode(P.right,I,G))}case "null":case "boolean":case "string":case "number":return P.value;case "date":return e(P.value);case "timestamp":return f(P.value);case "current-time":return I=new Date,"date"===P.mode&&I.setHours(0,0,0,0),I;case "column-reference":return B(I,P.column,this._datefields,G);case "data-type":return P.value;case "function":return I=this._evaluateNode(P.args,I,G),this.isAggregate?t.aggregateFunction(P.name,I):n.evaluateFunction(P.name,I)}throw Error("Unsupported sql syntax "+
P.type);};c._createClass(M,[{key:"fieldNames",get:function(){return this._referencedFieldNames}},{key:"hasDateFunctions",get:function(){if(null!=this._hasDateFunctions)return this._hasDateFunctions;this._hasDateFunctions=!1;this._visitAll(this.parseTree,P=>{"current-time"===P.type?this._hasDateFunctions=!0:"function"===P.type&&(this._hasDateFunctions=this._hasDateFunctions||D.has(P.name.toLowerCase()))});return this._hasDateFunctions}}]);return M}();var K;(function(M){M[M.Normal=0]="Normal";M[M.Escaped=
1]="Escaped"})(K||(K={}));const J={getAttribute(M,N){return(M&&"object"===typeof M.attributes?M.attributes:M)[N]}};a.WhereClause=E;a.defaultAttributeAdapter=J;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/AggregateFunctions":function(){define(["exports"],function(a){function c(n){let r=0;for(let m=0;m<n.length;m++)r+=n[m];return r/n.length}function b(n){const r=c(n),m=n.length;let d=0;for(const f of n)d+=(f-r)**2;return 1<m?d/(m-1):0}const t={min:{minParams:1,maxParams:1,
evaluate:n=>null==n[0]?null:Math.min.apply(Math,n[0])},max:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.max.apply(Math,n[0])},avg:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:c(n[0])},sum:{minParams:1,maxParams:1,evaluate:n=>{if(null==n[0])n=null;else{n=n[0];let r=0;for(let m=0;m<n.length;m++)r+=n[m];n=r}return n}},stddev:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:Math.sqrt(b(n[0]))},count:{minParams:1,maxParams:1,evaluate:n=>null==n[0]?null:n[0].length},var:{minParams:1,
maxParams:1,evaluate:n=>null==n[0]?null:b(n[0])}};a.aggregateFunction=function(n,r){const m=t[n.toLowerCase()];if(null==m)throw Error("Function Not Recognised");if(r.length<m.minParams||r.length>m.maxParams)throw Error(`Invalid Parameter count for call to ${n.toUpperCase()}`);return m.evaluate(r)};a.isAggregate=function(n,r){n=t[n.toLowerCase()];return null!=n&&r>=n.minParams&&r<=n.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/StandardizedFunctions":function(){define(["exports",
"../../arcade/featureset/support/errorsupport","../string","../../chunks/datetime"],function(a,c,b,t){function n(f){f=new Date(f.getTime());f.setHours(0,0,0,0);return f}function r(f,e){if(f instanceof Date)return e?n(f):f;if("string"===typeof f||f instanceof String)if(f=t.DateTime.fromSQL(f),f.isValid)return e?n(f.toJSDate()):f.toJSDate();throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);}let m=function(){function f(){this.op="+";this.millis=this.minute=this.year=this.month=this.hour=this.second=
this.day=0}f._fixDefaults=function(e){if(null!==e.precision||null!==e.secondary)throw Error("Primary and Secondary SqlInterval qualifiers not supported");};f._parseSecondsComponent=function(e,g){g.includes(".")?(g=g.split("."),e.second=parseFloat(g[0]),e.millis=parseInt(g[1],10)):e.second=parseFloat(g)};f.createFromMilliseconds=function(e){const g=new f;g.second=e/1E3;return g};f.createFromValueAndQualifer=function(e,g,h){let l=null;const v=new f;v.op="-"===h?"-":"+";if("interval-period"===g.type){f._fixDefaults(g);
h=RegExp("^[0-9]{1,}$");if("year"===g.period||"month"===g.period)throw Error("Year-Month Intervals not supported");if("second"===g.period)if(/^[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$/.test(e))f._parseSecondsComponent(v,e);else throw Error("Illegal Interval");else if(h.test(e))v[g.period]=parseFloat(e);else throw Error("Illegal Interval");}else{f._fixDefaults(g.start);f._fixDefaults(g.end);if("year"===g.start.period||"month"===g.start.period)throw Error("Year-Month Intervals not supported");if("year"===g.end.period||
"month"===g.end.period)throw Error("Year-Month Intervals not supported");switch(g.start.period){case "day":switch(g.end.period){case "hour":l=RegExp("^[0-9]{1,} [0-9]{1,}$");if(l.test(e))v[g.start.period]=parseFloat(e.split(" ")[0]),v[g.end.period]=parseFloat(e.split(" ")[1]);else throw Error("Illegal Interval");break;case "minute":l=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,}$");if(l.test(e))v[g.start.period]=parseFloat(e.split(" ")[0]),e=e.split(" ")[1].split(":"),v.hour=parseFloat(e[0]),v.minute=parseFloat(e[1]);
else throw Error("Illegal Interval");break;case "second":l=RegExp("^[0-9]{1,} [0-9]{1,2}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(l.test(e))v[g.start.period]=parseFloat(e.split(" ")[0]),e=e.split(" ")[1].split(":"),v.hour=parseFloat(e[0]),v.minute=parseFloat(e[1]),f._parseSecondsComponent(v,e[2]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;case "hour":switch(g.end.period){case "minute":l=RegExp("^[0-9]{1,}:[0-9]{1,}$");if(l.test(e))v.hour=parseFloat(e.split(":")[0]),
v.minute=parseFloat(e.split(":")[1]);else throw Error("Illegal Interval");break;case "second":l=RegExp("^[0-9]{1,}:[0-9]{1,2}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(l.test(e))e=e.split(":"),v.hour=parseFloat(e[0]),v.minute=parseFloat(e[1]),f._parseSecondsComponent(v,e[2]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;case "minute":switch(g.end.period){case "second":l=RegExp("^[0-9]{1,}:[0-9]{1,}([.]{1}[0-9]{1,}){0,1}$");if(l.test(e))e=e.split(":"),v.minute=
parseFloat(e[0]),f._parseSecondsComponent(v,e[1]);else throw Error("Illegal Interval");break;default:throw Error("Invalid Interval.");}break;default:throw Error("Invalid Interval.");}}return v};f.prototype.valueInMilliseconds=function(){return("-"===this.op?-1:1)*(this.millis+1E3*this.second+6E4*this.minute+36E5*this.hour+864E5*this.day+365/12*this.month*864E5+31536E6*this.year)};return f}();const d={extract:{minParams:2,maxParams:2,evaluate:([f,e])=>{if(null==e)return null;if(e instanceof Date)switch(f.toUpperCase()){case "SECOND":return e.getSeconds();
case "MINUTE":return e.getMinutes();case "HOUR":return e.getHours();case "DAY":return e.getDate();case "MONTH":return e.getMonth()+1;case "YEAR":return e.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:f=>{if(2===f.length){const [e,g]=f;return null==e||null==g?null:e.toString().substring(g-1)}if(3===f.length){const [e,g,h]=f;return null==e||null==g||null==h?null:0>=h?"":e.toString().substring(g-1,g+h-1)}}},position:{minParams:2,maxParams:2,
evaluate:([f,e])=>null==f||null==e?null:e.indexOf(f)+1},trim:{minParams:2,maxParams:3,evaluate:f=>{var e=3===f.length,g=e?f[1]:" ";e=e?f[2]:f[1];if(null==g||null==e)return null;g=`(${b.escapeRegExpString(g)})`;switch(f[0]){case "BOTH":return e.replace(new RegExp(`^${g}*|${g}*$`,"g"),"");case "LEADING":return e.replace(new RegExp(`^${g}*`,"g"),"");case "TRAILING":return e.replace(new RegExp(`${g}*$`,"g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:f=>
null==f[0]?null:Math.abs(f[0])},ceiling:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.ceil(f[0])},floor:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.floor(f[0])},log:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.log(f[0])},log10:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.log(f[0])*Math.LOG10E},sin:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.sin(f[0])},cos:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.cos(f[0])},tan:{minParams:1,
maxParams:1,evaluate:f=>null==f[0]?null:Math.tan(f[0])},asin:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.asin(f[0])},acos:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.acos(f[0])},atan:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.atan(f[0])},sign:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:0<f[0]?1:0>f[1]?-1:0},power:{minParams:2,maxParams:2,evaluate:f=>null==f[0]||null==f[1]?null:f[0]**f[1]},mod:{minParams:2,maxParams:2,evaluate:f=>null==f[0]||null==
f[1]?null:f[0]%f[1]},round:{minParams:1,maxParams:2,evaluate:f=>{const e=f[0];f=2===f.length?10**f[1]:1;return null==e?null:Math.round(e*f)/f}},truncate:{minParams:1,maxParams:2,evaluate:f=>null==f[0]?null:1===f.length?parseInt(f[0].toFixed(0),10):parseFloat(f[0].toFixed(f[1]))},char_length:{minParams:1,maxParams:1,evaluate:f=>"string"===typeof f[0]||f[0]instanceof String?f[0].length:0},concat:{minParams:1,maxParams:Infinity,evaluate:f=>{let e="";for(let g=0;g<f.length;g++){if(null==f[g])return null;
e+=f[g].toString()}return e}},lower:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:f[0].toString().toLowerCase()},upper:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:f[0].toString().toUpperCase()},coalesce:{minParams:1,maxParams:Infinity,evaluate:f=>{for(const e of f)if(null!==e)return e;return null}},cosh:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.cosh(f[0])},sinh:{minParams:1,maxParams:1,evaluate:f=>null==f[0]?null:Math.sinh(f[0])},tanh:{minParams:1,maxParams:1,evaluate:f=>
null==f[0]?null:Math.tanh(f[0])},nullif:{minParams:2,maxParams:2,evaluate:f=>{const e=f[0];f=f[1];return(e instanceof Date?e.valueOf():e)===(f instanceof Date?f.valueOf():f)?null:e}},cast:{minParams:2,maxParams:2,evaluate:f=>{var e=f[0];f=f[1];if(null===e)return null;switch(f.type){case "integer":e=parseInt(e,10);if(isNaN(e))throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return e;case "smallint":e=parseInt(e,10);if(isNaN(e))throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);if(32767<e||
-32767>e)throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return e;case "float":case "real":e=parseFloat(e);if(isNaN(e))throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return e;case "date":return r(e,!0);case "timestamp":return r(e,!1);case "varchar":e=e.toString();if(e.length>f.size)throw new c.SqlError(c.SqlErrorCodes.CannotCastValue);return e;default:throw new c.SqlError(c.SqlErrorCodes.InvalidDataType);}}}};a.SqlInterval=m;a.evaluateFunction=function(f,e){const g=d[f.toLowerCase()];
if(null==g)throw Error("Function Not Recognised");if(e.length<g.minParams||e.length>g.maxParams)throw Error(`Invalid Parameter count for call to ${f.toUpperCase()}`);return g.evaluate(e)};a.isStandardized=function(f,e){f=d[f.toLowerCase()];return null!=f&&e>=f.minParams&&e<=f.maxParams};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/featureset/support/errorsupport":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../executionError"],function(a,
c,b){a.SqlErrorCodes=void 0;(function(d){d.InvalidFunctionParameters="InvalidFunctionParameters";d.UnsupportedSqlFunction="UnsupportedSqlFunction";d.UnsupportedOperator="UnsupportedOperator";d.UnsupportedSyntax="UnsupportedSyntax";d.UnsupportedIsRhs="UnsupportedIsRhs";d.UnsupportedIsLhs="UnsupportedIsLhs";d.InvalidDataType="InvalidDataType";d.CannotCastValue="CannotCastValue";d.MissingStatisticParameters="MissingStatisticParameters"})(a.SqlErrorCodes||(a.SqlErrorCodes={}));const t={[a.SqlErrorCodes.MissingStatisticParameters]:"Statistic does not have 1 or 0 Parameters",
[a.SqlErrorCodes.InvalidFunctionParameters]:"Invalid parameters for call to {function}",[a.SqlErrorCodes.UnsupportedIsLhs]:"Unsupported left hand expression in is statement",[a.SqlErrorCodes.UnsupportedIsRhs]:"Unsupported right hand expression in is statement",[a.SqlErrorCodes.UnsupportedOperator]:"Unsupported operator - {operator}",[a.SqlErrorCodes.UnsupportedSyntax]:"Unsupported syntax - {node}",[a.SqlErrorCodes.UnsupportedSqlFunction]:"Sql function not found \x3d {function}",[a.SqlErrorCodes.InvalidDataType]:"Invalid sql data type",
[a.SqlErrorCodes.CannotCastValue]:"Cannot cast value to the required data type"};let n=function(d){function f(e,g){e=d.call(this,b.doSubstitutions(t[e],g))||this;e.declaredRootClass="esri.arcade.featureset.support.sqlerror";Error.captureStackTrace&&Error.captureStackTrace(c._assertThisInitialized(e),f);return e}c._inheritsLoose(f,d);return f}(c._wrapNativeSuper(Error));a.FeatureSetErrorCodes=void 0;(function(d){d.NeverReach="NeverReach";d.NotImplemented="NotImplemented";d.Cancelled="Cancelled";d.InvalidStatResponse=
"InvalidStatResponse";d.InvalidRequest="InvalidRequest";d.RequestFailed="RequestFailed";d.MissingFeatures="MissingFeatures";d.AggregationFieldNotFound="AggregationFieldNotFound";d.DataElementsNotFound="DataElementsNotFound"})(a.FeatureSetErrorCodes||(a.FeatureSetErrorCodes={}));const r={[a.FeatureSetErrorCodes.Cancelled]:"Cancelled",[a.FeatureSetErrorCodes.InvalidStatResponse]:"Invalid statistics response from service",[a.FeatureSetErrorCodes.InvalidRequest]:"Invalid request",[a.FeatureSetErrorCodes.RequestFailed]:"Request failed - {reason}",
[a.FeatureSetErrorCodes.MissingFeatures]:"Missing features",[a.FeatureSetErrorCodes.AggregationFieldNotFound]:"Aggregation field not found",[a.FeatureSetErrorCodes.DataElementsNotFound]:"Data elements not found on service",[a.FeatureSetErrorCodes.NeverReach]:"Encountered unreachable logic",[a.FeatureSetErrorCodes.NotImplemented]:"Not implemented"};let m=function(d){function f(e,g){e=d.call(this,b.doSubstitutions(r[e],g))||this;e.declaredRootClass="esri.arcade.featureset.support.featureseterror";Error.captureStackTrace&&
Error.captureStackTrace(c._assertThisInitialized(e),f);return e}c._inheritsLoose(f,d);return f}(c._wrapNativeSuper(Error));a.FeatureSetError=m;a.FeatureSetErrorMessages=r;a.SqlError=n;a.SqlErrorMessages=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/arcade/executionError":function(){define(["exports","../chunks/_rollupPluginBabelHelpers"],function(a,c){function b(l){return l&&l.loc?`Line : ${l.loc.start?.line}, ${l.loc.start?.column}: `:""}function t(l,v){try{if(!v)return l;
for(const q in v){let k=v[q];k||(k="");l=l.replace("{"+q+"}",v[q])}}catch(q){}return l}a.ExecutionErrorCodes=void 0;(function(l){l.AsyncNotEnabled="AsyncNotEnabled";l.ModulesNotSupported="ModulesNotSupported";l.CircularModules="CircularModules";l.NeverReach="NeverReach";l.UnsupportedHashType="UnsupportedHashType";l.InvalidParameter="InvalidParameter";l.UnexpectedToken="UnexpectedToken";l.Unrecognised="Unrecognised";l.UnrecognisedType="UnrecognisedType";l.MaximumCallDepth="MaximumCallDepth";l.BooleanConditionRequired=
"BooleanConditionRequired";l.TypeNotAllowedInFeature="TypeNotAllowedInFeature";l.KeyMustBeString="KeyMustBeString";l.WrongNumberOfParameters="WrongNumberOfParameters";l.CallNonFunction="CallNonFunction";l.NoFunctionInTemplateLiteral="NoFunctionInTemplateLiteral";l.NoFunctionInDictionary="NoFunctionInDictionary";l.NoFunctionInArray="NoFunctionInArray";l.AssignModuleFunction="AssignModuleFunction";l.LogicExpressionOrAnd="LogicExpressionOrAnd";l.LogicalExpressionOnlyBoolean="LogicalExpressionOnlyBoolean";
l.FuncionNotFound="FunctionNotFound";l.InvalidMemberAccessKey="InvalidMemberAccessKey";l.UnsupportedUnaryOperator="UnsupportUnaryOperator";l.InvalidIdentifier="InvalidIdentifier";l.MemberOfNull="MemberOfNull";l.UnsupportedOperator="UnsupportedOperator";l.Cancelled="Cancelled";l.ModuleAccessorMustBeString="ModuleAccessorMustBeString";l.ModuleExportNotFound="ModuleExportNotFound";l.Immutable="Immutable";l.OutOfBounds="OutOfBounds";l.IllegalResult="IllegalResult";l.FieldNotFound="FieldNotFound";l.PortalRequired=
"PortalRequired";l.LogicError="LogicError";l.ArrayAccessorMustBeNumber="ArrayAccessMustBeNumber";l.KeyAccessorMustBeString="KeyAccessorMustBeString";l.WrongSpatialReference="WrongSpatialReference"})(a.ExecutionErrorCodes||(a.ExecutionErrorCodes={}));const n={[a.ExecutionErrorCodes.TypeNotAllowedInFeature]:"Feature attributes only support dates, numbers, strings, guids.",[a.ExecutionErrorCodes.LogicError]:"Logic error - {reason}",[a.ExecutionErrorCodes.NeverReach]:"Encountered unreachable logic",[a.ExecutionErrorCodes.AsyncNotEnabled]:"Async Arcade must be enabled for this script",
[a.ExecutionErrorCodes.ModuleAccessorMustBeString]:"Module accessor must be a string",[a.ExecutionErrorCodes.ModuleExportNotFound]:"Module has no export with provided identifier",[a.ExecutionErrorCodes.ModulesNotSupported]:"Current profile does not support modules",[a.ExecutionErrorCodes.ArrayAccessorMustBeNumber]:"Array accessor must be a number",[a.ExecutionErrorCodes.FuncionNotFound]:"Function not found",[a.ExecutionErrorCodes.FieldNotFound]:"Key not found - {key}",[a.ExecutionErrorCodes.CircularModules]:"Circular module dependencies are not allowed",
[a.ExecutionErrorCodes.Cancelled]:"Execution cancelled",[a.ExecutionErrorCodes.UnsupportedHashType]:"Type not supported in hash function",[a.ExecutionErrorCodes.IllegalResult]:"Value is not a supported return type",[a.ExecutionErrorCodes.PortalRequired]:"Portal is required",[a.ExecutionErrorCodes.InvalidParameter]:"Invalid parameter",[a.ExecutionErrorCodes.WrongNumberOfParameters]:"Call with wrong number of parameters",[a.ExecutionErrorCodes.Unrecognised]:"Unrecognised code structure",[a.ExecutionErrorCodes.UnrecognisedType]:"Unrecognised type",
[a.ExecutionErrorCodes.WrongSpatialReference]:"Cannot work with geometry in this spatial reference. It is different to the execution spatial reference",[a.ExecutionErrorCodes.BooleanConditionRequired]:"Conditions must use booleans",[a.ExecutionErrorCodes.NoFunctionInDictionary]:"Dictionaries cannot contain functions.",[a.ExecutionErrorCodes.NoFunctionInArray]:"Arrays cannot contain functions.",[a.ExecutionErrorCodes.NoFunctionInTemplateLiteral]:"Template Literals do not expect functions by value.",
[a.ExecutionErrorCodes.KeyAccessorMustBeString]:"Accessor must be a string",[a.ExecutionErrorCodes.KeyMustBeString]:"Object keys must be a string",[a.ExecutionErrorCodes.Immutable]:"Object is immutable",[a.ExecutionErrorCodes.InvalidParameter]:"Invalid parameter",[a.ExecutionErrorCodes.UnexpectedToken]:"Unexpected token",[a.ExecutionErrorCodes.MemberOfNull]:"Cannot access property of null object",[a.ExecutionErrorCodes.MaximumCallDepth]:"Exceeded maximum function depth",[a.ExecutionErrorCodes.OutOfBounds]:"Out of bounds",
[a.ExecutionErrorCodes.InvalidIdentifier]:"Identifier not recognised",[a.ExecutionErrorCodes.FuncionNotFound]:"Function not found",[a.ExecutionErrorCodes.CallNonFunction]:"Expression is not a function",[a.ExecutionErrorCodes.InvalidMemberAccessKey]:"Cannot access value using a key of this type",[a.ExecutionErrorCodes.AssignModuleFunction]:"Cannot assign function to module variable",[a.ExecutionErrorCodes.UnsupportedUnaryOperator]:"Unsupported unary operator",[a.ExecutionErrorCodes.UnsupportedOperator]:"Unsupported operator",
[a.ExecutionErrorCodes.LogicalExpressionOnlyBoolean]:"Logical expressions must be boolean",[a.ExecutionErrorCodes.LogicExpressionOrAnd]:"Logical expression can only be combined with || or \x26\x26"};let r=function(l){function v(...q){return l.call(this,...q)||this}c._inheritsLoose(v,l);return v}(c._wrapNativeSuper(Error)),m=function(l){function v(q,k){q=l.call(this,b(k)+q.message,{cause:q})||this;q.loc=null;Error.captureStackTrace&&Error.captureStackTrace(c._assertThisInitialized(q),v);k&&k.loc&&
(q.loc=k.loc);return q}c._inheritsLoose(v,l);return v}(r),d=function(l){function v(q,k,p,z){q=l.call(this,"Execution error - "+b(p)+t(n[k],z))||this;q.loc=null;q.declaredRootClass="esri.arcade.arcadeexecutionerror";Error.captureStackTrace&&Error.captureStackTrace(c._assertThisInitialized(q),v);p&&p.loc&&(q.loc=p.loc);return q}c._inheritsLoose(v,l);return v}(c._wrapNativeSuper(Error)),f=function(l){function v(q,k,p,z){q=l.call(this,"Compilation error - "+b(p)+t(n[k],z))||this;q.loc=null;q.declaredRootClass=
"esri.arcade.arcadecompilationerror";Error.captureStackTrace&&Error.captureStackTrace(c._assertThisInitialized(q),v);p&&p.loc&&(q.loc=p.loc);return q}c._inheritsLoose(v,l);return v}(c._wrapNativeSuper(Error)),e=function(l){function v(){var q=l.call(this,"Uncompilable code structures")||this;q.declaredRootClass="esri.arcade.arcadeuncompilableerror";Error.captureStackTrace&&Error.captureStackTrace(c._assertThisInitialized(q),v);return q}c._inheritsLoose(v,l);return v}(c._wrapNativeSuper(Error));a.ModuleErrorCodes=
void 0;(function(l){l.UnrecognisedUri="UnrecognisedUri";l.UnsupportedUriProtocol="UnsupportedUriProtocol"})(a.ModuleErrorCodes||(a.ModuleErrorCodes={}));const g={[a.ModuleErrorCodes.UnrecognisedUri]:"Unrecognised uri - {uri}",[a.ModuleErrorCodes.UnsupportedUriProtocol]:"Unrecognised uri protocol"};let h=function(l){function v(q,k){q=l.call(this,t(g[q],k))||this;q.declaredRootClass="esri.arcade.arcademoduleerror";Error.captureStackTrace&&Error.captureStackTrace(c._assertThisInitialized(q),v);return q}
c._inheritsLoose(v,l);return v}(c._wrapNativeSuper(Error));a.ArcadeCompilationError=f;a.ArcadeExecutionError=d;a.ArcadeUncompilableError=e;a.ErrorWithCause=r;a.ExecutionErrorMessages=n;a.LocatableArcadeExecutionError=m;a.ModuleError=h;a.ModuleErrorMessages=g;a.doSubstitutions=t;a.ensureArcadeExecutionError=function(l,v,q){return"esri.arcade.arcadeexecutionerror"===q.declaredRootClass||"esri.arcade.arcadecompilationerror"===q.declaredRootClass?null===q.loc&&v&&v.loc?new m(q,{cause:q}):q:v&&v.loc?new m(q,
{cause:q}):q};a.parsingValidationMessage=function(l,v,q){return"Parsing error - "+b(l)+t(n[v],q)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/core/sql/WhereGrammar":function(){define(["exports","../../chunks/_commonjsHelpers"],function(a,c){var b={};(function(n){(function(r,m){n.exports&&(n.exports=m())})(c.commonjsGlobal,function(){function r(d,f,e,g){d=Error.call(this,d);Object.setPrototypeOf&&Object.setPrototypeOf(d,r.prototype);d.expected=f;d.found=e;d.location=g;d.name=
"SyntaxError";return d}function m(d,f,e){e=e||" ";if(d.length>f)return d;f-=d.length;e+=e.repeat(f);return d+e.slice(0,f)}(function(d,f){function e(){this.constructor=d}e.prototype=f.prototype;d.prototype=new e})(r,Error);r.prototype.format=function(d){var f="Error: "+this.message;if(this.location){var e=null,g;for(g=0;g<d.length;g++)if(d[g].source===this.location.source){e=d[g].text.split(/\r\n|\n|\r/g);break}d=this.location.start;g=this.location.source+":"+d.line+":"+d.column;if(e){var h=this.location.end,
l=m("",d.line.toString().length," ");e=e[d.line-1];h=(d.line===h.line?h.column:e.length+1)-d.column||1;f+="\n --\x3e "+g+"\n"+l+" |\n"+d.line+" | "+e+"\n"+l+" | "+m("",d.column-1," ")+m("",h,"^")}else f+="\n at "+g}return f};r.buildMessage=function(d,f){function e(q){return q.charCodeAt(0).toString(16).toUpperCase()}function g(q){return q.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(k){return"\\x0"+
e(k)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(k){return"\\x"+e(k)})}function h(q){return q.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(k){return"\\x0"+e(k)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(k){return"\\x"+e(k)})}function l(q){return v[q.type](q)}var v={literal:function(q){return'"'+g(q.text)+'"'},class:function(q){var k=q.parts.map(function(p){return Array.isArray(p)?
h(p[0])+"-"+h(p[1]):h(p)});return"["+(q.inverted?"^":"")+k.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(q){return q.description}};return"Expected "+function(q){q=q.map(l);var k,p;q.sort();if(0<q.length){for(p=k=1;k<q.length;k++)q[k-1]!==q[k]&&(q[p]=q[k],p++);q.length=p}switch(q.length){case 1:return q[0];case 2:return q[0]+" or "+q[1];default:return q.slice(0,-1).join(", ")+", or "+q[q.length-1]}}(d)+" but "+(f?'"'+g(f)+'"':"end of input")+
" found."};return{SyntaxError:r,parse:function(d,f){function e(Ba,Fa){return{type:"literal",text:Ba,ignoreCase:Fa}}function g(Ba,Fa,Ma){return{type:"class",parts:Ba,inverted:Fa,ignoreCase:Ma}}function h(Ba){var Fa=Wd[Ba],Ma;if(!Fa){for(Ma=Ba-1;!Wd[Ma];)Ma--;Fa=Wd[Ma];for(Fa={line:Fa.line,column:Fa.column};Ma<Ba;)10===d.charCodeAt(Ma)?(Fa.line++,Fa.column=1):Fa.column++,Ma++;Wd[Ba]=Fa}return Fa}function l(Ba,Fa){var Ma=h(Ba),$a=h(Fa);return{source:Ya,start:{offset:Ba,line:Ma.line,column:Ma.column},
end:{offset:Fa,line:$a.line,column:$a.column}}}function v(Ba){ta<jc||(ta>jc&&(jc=ta,ze=[]),ze.push(Ba))}function q(){var Ba=ta;Ja();var Fa=p();Fa!==ma?(Ja(),Ba=Fa):(ta=Ba,Ba=ma);return Ba}function k(){var Ba=ta;var Fa=p();if(Fa!==ma){Ba=[];var Ma=ta;var $a=Ja();var gb=Ia();if(gb!==ma){var qb=Ja();var sb=p();sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)}else ta=Ma,Ma=ma;for(;Ma!==ma;)Ba.push(Ma),Ma=ta,$a=Ja(),gb=Ia(),gb!==ma?(qb=Ja(),sb=p(),sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)):(ta=Ma,Ma=ma);Ma={type:"expression-list"};
Fa=[Fa];for($a=0;$a<Ba.length;$a++)Fa.push(Ba[$a][3]);Ma.value=Fa;Ba=Ma}else ta=Ba,Ba=ma;return Ba}function p(){var Ba=ta;var Fa=z();if(Fa!==ma){Ba=[];var Ma=ta;var $a=Ja();var gb=ja();if(gb!==ma){var qb=Ja();var sb=z();sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)}else ta=Ma,Ma=ma;for(;Ma!==ma;)Ba.push(Ma),Ma=ta,$a=Ja(),gb=ja(),gb!==ma?(qb=Ja(),sb=z(),sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)):(ta=Ma,Ma=ma);Ba=Za(Fa,Ba)}else ta=Ba,Ba=ma;return Ba}function z(){var Ba=ta;var Fa=C();if(Fa!==ma){Ba=[];var Ma=
ta;var $a=Ja();var gb=ca();if(gb!==ma){var qb=Ja();var sb=C();sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)}else ta=Ma,Ma=ma;for(;Ma!==ma;)Ba.push(Ma),Ma=ta,$a=Ja(),gb=ca(),gb!==ma?(qb=Ja(),sb=C(),sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)):(ta=Ma,Ma=ma);Ba=Za(Fa,Ba)}else ta=Ba,Ba=ma;return Ba}function C(){var Ba=ta;var Fa=ea();if(Fa===ma){Fa=ta;if(33===d.charCodeAt(ta)){var Ma=Aa;ta++}else Ma=ma,0===Wa&&v($c);if(Ma!==ma){var $a=ta;Wa++;if(61===d.charCodeAt(ta)){var gb=Ca;ta++}else gb=ma,0===Wa&&v(Ec);
Wa--;gb===ma?$a=void 0:(ta=$a,$a=ma);$a!==ma?Fa=Ma=[Ma,$a]:(ta=Fa,Fa=ma)}else ta=Fa,Fa=ma}Fa!==ma?(Ma=Ja(),$a=C(),$a!==ma?Ba={type:"unary-expression",operator:"NOT",expr:$a}:(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma);if(Ba===ma){Fa=ta;Ba=u();if(Ba!==ma){Ja();Fa=[];Ma=ta;$a=Ja();gb=B();if(gb!==ma){var qb=Ja();var sb=u();sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)}else ta=Ma,Ma=ma;if(Ma!==ma)for(;Ma!==ma;)Fa.push(Ma),Ma=ta,$a=Ja(),gb=B(),gb!==ma?(qb=Ja(),sb=u(),sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)):(ta=Ma,Ma=
ma);else Fa=ma;Fa!==ma&&(Fa={type:"arithmetic",tail:Fa});Fa===ma&&(Fa=ta,Ma=x(),Ma!==ma?(Ja(),$a=Na(),$a!==ma?(Ja(),$a=k(),$a!==ma?(Ja(),gb=Oa(),gb!==ma?Fa={op:Ma,right:$a}:(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma),Fa===ma&&(Fa=ta,Ma=x(),Ma!==ma?(Ja(),$a=Na(),$a!==ma?(Ja(),$a=Oa(),$a!==ma?Fa={op:Ma,right:{type:"expression-list",value:[]}}:(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma),Fa===ma&&(Fa=ta,Ma=x(),Ma!==ma?(Ja(),$a=N(),$a!==ma?Fa={op:Ma,right:$a}:(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma))),
Fa===ma&&(Fa=ta,gb=ea(),gb!==ma?(Ja(),Ma=ia(),Ma!==ma?(Ja(),$a=u(),$a!==ma?(Ja(),qb=ca(),qb!==ma?(Ja(),gb=u(),gb!==ma?Fa={op:"NOT"+Ma,right:{type:"expression-list",value:[$a,gb]}}:(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma),Fa===ma&&(Fa=ta,gb=ia(),gb!==ma?(Ja(),Ma=u(),Ma!==ma?(Ja(),$a=ca(),$a!==ma?(Ja(),qb=u(),qb!==ma?Fa={op:gb,right:{type:"expression-list",value:[Ma,qb]}}:(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)),Fa===ma&&(Fa=ta,Ma=ba(),Ma!==ma?(Ja(),
$a=ea(),$a!==ma?(Ja(),$a=u(),$a!==ma?Fa={op:Ma+"NOT",right:$a}:(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma),Fa===ma&&(Fa=ta,Ma=ba(),Ma!==ma?(Ja(),$a=u(),$a!==ma?Fa={op:Ma,right:$a}:(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)),Fa===ma&&(Fa=ta,Ma=A(),Ma!==ma?(Ja(),$a=O(),$a!==ma?(Ja(),gb=ta,d.substr(ta,6).toLowerCase()===Pa?(qb=d.substr(ta,6),ta+=6):(qb=ma,0===Wa&&v(Md)),qb!==ma?(qb=ta,Wa++,sb=J(),Wa--,sb===ma?qb=void 0:(ta=qb,qb=ma),qb!==ma?gb="ESCAPE":(ta=gb,gb=ma)):(ta=gb,gb=ma),gb!==ma?(Ja(),gb=S(),gb!==ma?Fa=
{op:Ma,right:$a,escape:gb.value}:(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma),Fa===ma&&(Fa=ta,Ma=A(),Ma!==ma?(Ja(),$a=O(),$a!==ma?Fa={op:Ma,right:$a,escape:""}:(ta=Fa,Fa=ma)):(ta=Fa,Fa=ma))))));Fa===ma&&(Fa=null);""==Fa||void 0==Fa||null==Fa?Fa=Ba:(Ma=null,Fa=Ma="arithmetic"==Fa.type?Za(Ba,Fa.tail):Ua(Fa.op,Ba,Fa.right,Fa.escape))}else ta=Fa,Fa=ma;Ba=Fa}return Ba}function B(){if(d.substr(ta,2)===qa){var Ba=qa;ta+=2}else Ba=ma,0===Wa&&v(Ad);Ba===ma&&(62===d.charCodeAt(ta)?(Ba=ya,ta++):
(Ba=ma,0===Wa&&v(ad)),Ba===ma&&(d.substr(ta,2)===Da?(Ba=Da,ta+=2):(Ba=ma,0===Wa&&v(Bd)),Ba===ma&&(d.substr(ta,2)===La?(Ba=La,ta+=2):(Ba=ma,0===Wa&&v(Cd)),Ba===ma&&(60===d.charCodeAt(ta)?(Ba=Ta,ta++):(Ba=ma,0===Wa&&v(Dd)),Ba===ma&&(61===d.charCodeAt(ta)?(Ba=Ca,ta++):(Ba=ma,0===Wa&&v(Ec)),Ba===ma&&(d.substr(ta,2)===Xa?(Ba=Xa,ta+=2):(Ba=ma,0===Wa&&v(Ed))))))));return Ba}function A(){var Ba=Ba=ta;var Fa=ea();if(Fa!==ma){var Ma=Ja();var $a=da();$a!==ma?Ba=Fa=[Fa,Ma,$a]:(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;Ba!==
ma&&(Ba=Ba[0]+" "+Ba[2]);Ba===ma&&(Ba=da());return Ba}function x(){var Ba=Ba=ta;var Fa=ea();if(Fa!==ma){var Ma=Ja();var $a=Y();$a!==ma?Ba=Fa=[Fa,Ma,$a]:(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;Ba!==ma&&(Ba=Ba[0]+" "+Ba[2]);Ba===ma&&(Ba=Y());return Ba}function u(){var Ba=ta;var Fa=w();if(Fa!==ma){Ba=[];var Ma=ta;var $a=Ja();var gb=y();if(gb!==ma){var qb=Ja();var sb=w();sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)}else ta=Ma,Ma=ma;for(;Ma!==ma;)Ba.push(Ma),Ma=ta,$a=Ja(),gb=y(),gb!==ma?(qb=Ja(),sb=w(),sb!==ma?Ma=
$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)):(ta=Ma,Ma=ma);Ba=Za(Fa,Ba)}else ta=Ba,Ba=ma;return Ba}function y(){if(43===d.charCodeAt(ta)){var Ba=db;ta++}else Ba=ma,0===Wa&&v(bd);Ba===ma&&(45===d.charCodeAt(ta)?(Ba=fb,ta++):(Ba=ma,0===Wa&&v(cd)),Ba===ma&&(d.substr(ta,2)===jb?(Ba=jb,ta+=2):(Ba=ma,0===Wa&&v(ve))));return Ba}function w(){var Ba=ta;var Fa=F();if(Fa!==ma){Ba=[];var Ma=ta;var $a=Ja();var gb=D();if(gb!==ma){var qb=Ja();var sb=F();sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)}else ta=Ma,Ma=ma;for(;Ma!==ma;)Ba.push(Ma),
Ma=ta,$a=Ja(),gb=D(),gb!==ma?(qb=Ja(),sb=F(),sb!==ma?Ma=$a=[$a,gb,qb,sb]:(ta=Ma,Ma=ma)):(ta=Ma,Ma=ma);Ba=Za(Fa,Ba)}else ta=Ba,Ba=ma;return Ba}function D(){if(42===d.charCodeAt(ta)){var Ba=lb;ta++}else Ba=ma,0===Wa&&v(Ac);Ba===ma&&(47===d.charCodeAt(ta)?(Ba=ob,ta++):(Ba=ma,0===Wa&&v(Bc)));return Ba}function F(){var Ba=S();if(Ba===ma){var Fa=ta;var Ma=ta;var $a=aa();if($a!==ma){var gb=X();if(gb!==ma){var qb=W();qb!==ma?Ma=parseFloat($a+gb+qb):(ta=Ma,Ma=ma)}else ta=Ma,Ma=ma}else ta=Ma,Ma=ma;Ma===ma&&
(Ma=ta,$a=aa(),$a!==ma?(gb=X(),gb!==ma?Ma=parseFloat($a+gb):(ta=Ma,Ma=ma)):(ta=Ma,Ma=ma),Ma===ma&&(Ma=ta,$a=aa(),$a!==ma?(gb=W(),gb!==ma?Ma=parseFloat($a+gb):(ta=Ma,Ma=ma)):(ta=Ma,Ma=ma),Ma===ma&&(Ma=ta,$a=aa(),$a!==ma&&($a=parseFloat($a)),Ma=$a)));var sb=Ma;if(sb!==ma){var Xd=ta;Wa++;var pf=K();Wa--;pf===ma?Xd=void 0:(ta=Xd,Xd=ma);Xd!==ma?Fa={type:"number",value:sb}:(ta=Fa,Fa=ma)}else ta=Fa,Fa=ma;Ba=Fa;if(Ba===ma){var md=ta;var Ic=ta;if(d.substr(ta,4).toLowerCase()===cb){var Yd=d.substr(ta,4);ta+=
4}else Yd=ma,0===Wa&&v(Hd);if(Yd!==ma){var nd=ta;Wa++;var qf=J();Wa--;qf===ma?nd=void 0:(ta=nd,nd=ma);nd!==ma?Ic=Yd=[Yd,nd]:(ta=Ic,Ic=ma)}else ta=Ic,Ic=ma;var Cc=Ic;Cc!==ma&&(Cc={type:"boolean",value:!0});md=Cc;if(md===ma){md=ta;var Jc=ta;if(d.substr(ta,5).toLowerCase()===Ka){var Zd=d.substr(ta,5);ta+=5}else Zd=ma,0===Wa&&v(Id);if(Zd!==ma){var od=ta;Wa++;var rf=J();Wa--;rf===ma?od=void 0:(ta=od,od=ma);od!==ma?Jc=Zd=[Zd,od]:(ta=Jc,Jc=ma)}else ta=Jc,Jc=ma;Cc=Jc;Cc!==ma&&(Cc={type:"boolean",value:!1});
md=Cc}Ba=md;if(Ba===ma){var Kc=ta;if(d.substr(ta,4).toLowerCase()===eb){var $d=d.substr(ta,4);ta+=4}else $d=ma,0===Wa&&v(we);if($d!==ma){var pd=ta;Wa++;var sf=J();Wa--;sf===ma?pd=void 0:(ta=pd,pd=ma);pd!==ma?Kc=$d=[$d,pd]:(ta=Kc,Kc=ma)}else ta=Kc,Kc=ma;var Ae=Kc;Ae!==ma&&(Ae={type:"null",value:null});Ba=Ae;if(Ba===ma){var Lc=ta;if(ka()!==ma){Ja();var Ne=O();Ne!==ma?Lc={type:"date",value:Ne.value}:(ta=Lc,Lc=ma)}else ta=Lc,Lc=ma;Ba=Lc;if(Ba===ma){var Mc=ta;if(fa()!==ma){Ja();var Oe=O();Oe!==ma?Mc={type:"timestamp",
value:Oe.value}:(ta=Mc,Mc=ma)}else ta=Mc,Mc=ma;Ba=Mc;if(Ba===ma){var Ub=ta;var Be=la();if(Be!==ma){Ja();if(45===d.charCodeAt(ta)){var pc=fb;ta++}else pc=ma,0===Wa&&v(cd);pc===ma&&(43===d.charCodeAt(ta)?(pc=db,ta++):(pc=ma,0===Wa&&v(bd)));if(pc!==ma){Ja();var qd=O();if(qd!==ma){Ja();var Pe=I();Pe!==ma?Ub={type:"interval",value:qd,qualifier:Pe,op:pc}:(ta=Ub,Ub=ma)}else ta=Ub,Ub=ma}else ta=Ub,Ub=ma}else ta=Ub,Ub=ma;Ub===ma&&(Ub=ta,Be=la(),Be!==ma?(Ja(),pc=O(),pc!==ma?(Ja(),qd=I(),qd!==ma?Ub={type:"interval",
value:pc,qualifier:qd,op:""}:(ta=Ub,Ub=ma)):(ta=Ub,Ub=ma)):(ta=Ub,Ub=ma));Ba=Ub}}}}}}var Cb=Ba;if(Cb===ma){var $b=ta;var Nc=ta;if(d.substr(ta,7).toLowerCase()===ub){var Qe=d.substr(ta,7);ta+=7}else Qe=ma,0===Wa&&v(Rd);if(Qe!==ma){var ae=ta;Wa++;var tf=J();Wa--;tf===ma?ae=void 0:(ta=ae,ae=ma);ae!==ma?Nc="EXTRACT":(ta=Nc,Nc=ma)}else ta=Nc,Nc=ma;if(Nc!==ma){Ja();var uf=Na();if(uf!==ma){Ja();var hc=na();hc===ma&&(hc=pa(),hc===ma&&(hc=va(),hc===ma&&(hc=wa(),hc===ma&&(hc=za(),hc===ma&&(hc=sa())))));var Re=
hc;if(Re!==ma){Ja();var vf=Z();if(vf!==ma){Ja();var Se=p();if(Se!==ma){Ja();var wf=Oa();wf!==ma?$b={type:"function",name:"extract",args:{type:"expression-list",value:[{type:"string",value:Re},Se]}}:(ta=$b,$b=ma)}else ta=$b,$b=ma}else ta=$b,$b=ma}else ta=$b,$b=ma}else ta=$b,$b=ma}else ta=$b,$b=ma;Cb=$b;if(Cb===ma){var ac=ta;var Oc=ta;if(d.substr(ta,9).toLowerCase()===pb){var Te=d.substr(ta,9);ta+=9}else Te=ma,0===Wa&&v(Qd);if(Te!==ma){var be=ta;Wa++;var xf=J();Wa--;xf===ma?be=void 0:(ta=be,be=ma);
be!==ma?Oc="SUBSTRING":(ta=Oc,Oc=ma)}else ta=Oc,Oc=ma;if(Oc!==ma){Ja();var yf=Na();if(yf!==ma){Ja();var Ce=p();if(Ce!==ma){Ja();var zf=Z();if(zf!==ma){Ja();var De=p();if(De!==ma){Ja();var qc=ta;var Pc=ta;if(d.substr(ta,3).toLowerCase()===kb){var Ue=d.substr(ta,3);ta+=3}else Ue=ma,0===Wa&&v(Pd);if(Ue!==ma){var ce=ta;Wa++;var Af=J();Wa--;Af===ma?ce=void 0:(ta=ce,ce=ma);ce!==ma?Pc="FOR":(ta=Pc,Pc=ma)}else ta=Pc,Pc=ma;var rd=Pc;if(rd!==ma){var Bf=Ja();var Ve=p();if(Ve!==ma){var Cf=Ja();qc=rd=[rd,Bf,Ve,
Cf]}else ta=qc,qc=ma}else ta=qc,qc=ma;qc===ma&&(qc=null);rd=Oa();rd!==ma?ac={type:"function",name:"substring",args:{type:"expression-list",value:qc?[Ce,De,qc[2]]:[Ce,De]}}:(ta=ac,ac=ma)}else ta=ac,ac=ma}else ta=ac,ac=ma}else ta=ac,ac=ma}else ta=ac,ac=ma}else ta=ac,ac=ma;Cb=ac;if(Cb===ma){var Lb=ta;var Ee=ha();if(Ee!==ma){Ja();var Fe=Na();if(Fe!==ma){Ja();var rc=P();rc===ma&&(rc=null);Ja();var sd=p();if(sd!==ma){Ja();var Ge=Z();if(Ge!==ma){Ja();var We=p();if(We!==ma){Ja();var Df=Oa();Df!==ma?Lb={type:"function",
name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==rc?"BOTH":rc},sd,We]}}:(ta=Lb,Lb=ma)}else ta=Lb,Lb=ma}else ta=Lb,Lb=ma}else ta=Lb,Lb=ma}else ta=Lb,Lb=ma}else ta=Lb,Lb=ma;Lb===ma&&(Lb=ta,Ee=ha(),Ee!==ma?(Ja(),Fe=Na(),Fe!==ma?(Ja(),rc=P(),rc===ma&&(rc=null),Ja(),sd=p(),sd!==ma?(Ja(),Ge=Oa(),Ge!==ma?Lb={type:"function",name:"trim",args:{type:"expression-list",value:[{type:"string",value:null==rc?"BOTH":rc},sd]}}:(ta=Lb,Lb=ma)):(ta=Lb,Lb=ma)):(ta=Lb,Lb=ma)):(ta=Lb,Lb=ma));Cb=
Lb;if(Cb===ma){var bc=ta;var Qc=ta;if(d.substr(ta,8).toLowerCase()===Ib){var Xe=d.substr(ta,8);ta+=8}else Xe=ma,0===Wa&&v(kd);if(Xe!==ma){var de=ta;Wa++;var Ef=J();Wa--;Ef===ma?de=void 0:(ta=de,de=ma);de!==ma?Qc="POSITION":(ta=Qc,Qc=ma)}else ta=Qc,Qc=ma;if(Qc!==ma){Ja();var Ff=Na();if(Ff!==ma){Ja();var Ye=p();if(Ye!==ma){Ja();var Gf=Y();if(Gf!==ma){Ja();var Ze=p();if(Ze!==ma){Ja();var Hf=Oa();Hf!==ma?bc={type:"function",name:"position",args:{type:"expression-list",value:[Ye,Ze]}}:(ta=bc,bc=ma)}else ta=
bc,bc=ma}else ta=bc,bc=ma}else ta=bc,bc=ma}else ta=bc,bc=ma}else ta=bc,bc=ma;Cb=bc;if(Cb===ma){var cc=ta;var Rc=ta;if(d.substr(ta,4).toLowerCase()===Pb){var $e=d.substr(ta,4);ta+=4}else $e=ma,0===Wa&&v(xe);if($e!==ma){var ee=ta;Wa++;var If=J();Wa--;If===ma?ee=void 0:(ta=ee,ee=ma);ee!==ma?Rc="CAST":(ta=Rc,Rc=ma)}else ta=Rc,Rc=ma;if(Rc!==ma){Ja();var Jf=Na();if(Jf!==ma){Ja();var af=p();if(af!==ma){Ja();var Sc=ta;if(d.substr(ta,2).toLowerCase()===Gb){var bf=d.substr(ta,2);ta+=2}else bf=ma,0===Wa&&v(ye);
if(bf!==ma){var fe=ta;Wa++;var Kf=J();Wa--;Kf===ma?fe=void 0:(ta=fe,fe=ma);fe!==ma?Sc="AS":(ta=Sc,Sc=ma)}else ta=Sc,Sc=ma;var Lf=Sc;if(Lf!==ma){Ja();var Db=ta;var Tc=ta;if(d.substr(ta,7).toLowerCase()===Tb){var cf=d.substr(ta,7);ta+=7}else cf=ma,0===Wa&&v(Od);if(cf!==ma){var ge=ta;Wa++;var Mf=J();Wa--;Mf===ma?ge=void 0:(ta=ge,ge=ma);ge!==ma?Tc="INTEGER":(ta=Tc,Tc=ma)}else ta=Tc,Tc=ma;var Mb=Tc;Mb!==ma&&(Mb={type:"data-type",value:{type:"integer"}});Db=Mb;if(Db===ma){Db=ta;var Uc=ta;if(d.substr(ta,
8).toLowerCase()===zb){var df=d.substr(ta,8);ta+=8}else df=ma,0===Wa&&v(Nf);if(df!==ma){var he=ta;Wa++;var Of=J();Wa--;Of===ma?he=void 0:(ta=he,he=ma);he!==ma?Uc="SMALLINT":(ta=Uc,Uc=ma)}else ta=Uc,Uc=ma;Mb=Uc;Mb!==ma&&(Mb={type:"data-type",value:{type:"smallint"}});Db=Mb;if(Db===ma){Db=ta;var Vc=ta;if(d.substr(ta,5).toLowerCase()===Rb){var ef=d.substr(ta,5);ta+=5}else ef=ma,0===Wa&&v(Pf);if(ef!==ma){var ie=ta;Wa++;var Qf=J();Wa--;Qf===ma?ie=void 0:(ta=ie,ie=ma);ie!==ma?Vc="FLOAT":(ta=Vc,Vc=ma)}else ta=
Vc,Vc=ma;Mb=Vc;Mb!==ma&&(Mb={type:"data-type",value:{type:"float"}});Db=Mb;if(Db===ma){Db=ta;var Wc=ta;if(d.substr(ta,4).toLowerCase()===Qb){var ff=d.substr(ta,4);ta+=4}else ff=ma,0===Wa&&v(Rf);if(ff!==ma){var je=ta;Wa++;var Sf=J();Wa--;Sf===ma?je=void 0:(ta=je,je=ma);je!==ma?Wc="REAL":(ta=Wc,Wc=ma)}else ta=Wc,Wc=ma;Mb=Wc;Mb!==ma&&(Mb={type:"data-type",value:{type:"real"}});Db=Mb;if(Db===ma&&(Db=ta,Mb=ka(),Mb!==ma&&(Mb={type:"data-type",value:{type:"date"}}),Db=Mb,Db===ma&&(Db=ta,Mb=fa(),Mb!==ma&&
(Mb={type:"data-type",value:{type:"timestamp"}}),Db=Mb,Db===ma))){Db=ta;var Xc=ta;if(d.substr(ta,7).toLowerCase()===Ob){var gf=d.substr(ta,7);ta+=7}else gf=ma,0===Wa&&v(Tf);if(gf!==ma){var ke=ta;Wa++;var Uf=J();Wa--;Uf===ma?ke=void 0:(ta=ke,ke=ma);ke!==ma?Xc="VARCHAR":(ta=Xc,Xc=ma)}else ta=Xc,Xc=ma;Mb=Xc;if(Mb!==ma){Ja();var Vf=Na();if(Vf!==ma){Ja();var hf=T();if(hf!==ma){Ja();var Wf=Oa();Wf!==ma?Db={type:"data-type",value:{type:"varchar",size:parseInt(hf)}}:(ta=Db,Db=ma)}else ta=Db,Db=ma}else ta=
Db,Db=ma}else ta=Db,Db=ma}}}}var jf=Db;if(jf!==ma){Ja();var Xf=Oa();Xf!==ma?cc={type:"function",name:"cast",args:{type:"expression-list",value:[af,jf]}}:(ta=cc,cc=ma)}else ta=cc,cc=ma}else ta=cc,cc=ma}else ta=cc,cc=ma}else ta=cc,cc=ma}else ta=cc,cc=ma;Cb=cc;if(Cb===ma){var xc=ta;var le;var ic=ta;ic=le=E();if(ic===ma)if(ic=ta,96===d.charCodeAt(ta)?(le=zc,ta++):(le=ma,0===Wa&&v(kf)),le!==ma){var me=[];if(Dc.test(d.charAt(ta))){var sc=d.charAt(ta);ta++}else sc=ma,0===Wa&&v(lf);if(sc!==ma)for(;sc!==ma;)me.push(sc),
Dc.test(d.charAt(ta))?(sc=d.charAt(ta),ta++):(sc=ma,0===Wa&&v(lf));else me=ma;me!==ma?(96===d.charCodeAt(ta)?(sc=zc,ta++):(sc=ma,0===Wa&&v(kf)),sc!==ma?ic=me.join(""):(ta=ic,ic=ma)):(ta=ic,ic=ma)}else ta=ic,ic=ma;var mf=ic;if(mf!==ma){Ja();var Yf=Na();if(Yf!==ma){Ja();var ne=k();ne===ma&&(ne=null);Ja();var Zf=Oa();Zf!==ma?xc={type:"function",name:mf,args:ne?ne:{type:"expression-list",value:[]}}:(ta=xc,xc=ma)}else ta=xc,xc=ma}else ta=xc,xc=ma;Cb=xc;if(Cb===ma){var kc;var Vb=ta;var He=ua();if(He!==
ma){Ja();var td=p();if(td!==ma){Ja();var ud=[];for(kc=Q();kc!==ma;)ud.push(kc),kc=Q();kc=Ja();var oe=oa();oe!==ma?Vb={type:"case-expression",format:"simple",operand:td,clauses:ud,else:null}:(ta=Vb,Vb=ma)}else ta=Vb,Vb=ma}else ta=Vb,Vb=ma;if(Vb===ma)if(Vb=ta,He=ua(),He!==ma)if(Ja(),td=p(),td!==ma){Ja();ud=[];for(kc=Q();kc!==ma;)ud.push(kc),kc=Q();kc=Ja();oe=V();if(oe!==ma){Ja();var $f=oa();$f!==ma?Vb={type:"case-expression",format:"simple",operand:td,clauses:ud,else:oe.value}:(ta=Vb,Vb=ma)}else ta=
Vb,Vb=ma}else ta=Vb,Vb=ma;else ta=Vb,Vb=ma;var Ie=Vb;if(Ie===ma){var lc;var Zb=ta;var Je=ua();if(Je!==ma){Ja();var vd=[];for(lc=R();lc!==ma;)vd.push(lc),lc=R();lc=Ja();var pe=oa();pe!==ma?Zb={type:"case-expression",format:"searched",clauses:vd,else:null}:(ta=Zb,Zb=ma)}else ta=Zb,Zb=ma;if(Zb===ma)if(Zb=ta,Je=ua(),Je!==ma){Ja();vd=[];for(lc=R();lc!==ma;)vd.push(lc),lc=R();lc=Ja();pe=V();if(pe!==ma){Ja();var ag=oa();ag!==ma?Zb={type:"case-expression",format:"searched",clauses:vd,else:pe.value}:(ta=Zb,
Zb=ma)}else ta=Zb,Zb=ma}else ta=Zb,Zb=ma;Ie=Zb}Cb=Ie;if(Cb===ma){var qe;var re=ta;var nf=K();if(nf!==ma){var of=[];for(qe=M();qe!==ma;)of.push(qe),qe=M();re=nf+of.join("")}else ta=re,re=ma;var se=re;if(se!==ma){var Ke=se;se=/^CURRENT_DATE$/i.test(Ke)?{type:"current-time",mode:"date"}:/^CURRENT_TIMESTAMP$/i.test(Ke)?{type:"current-time",mode:"timestamp"}:{type:"column-reference",table:"",column:Ke}}Cb=se;if(Cb===ma&&(Cb=N(),Cb===ma)){Cb=ta;var bg=Na();if(bg!==ma){Ja();var Le=p();if(Le!==ma){Ja();var cg=
Oa();cg!==ma?(Le.paren=!0,Cb=Le):(ta=Cb,Cb=ma)}else ta=Cb,Cb=ma}else ta=Cb,Cb=ma}}}}}}}}}return Cb}function E(){var Ba;var Fa=ta;var Ma=K();if(Ma!==ma){Fa=[];for(Ba=J();Ba!==ma;)Fa.push(Ba),Ba=J();Fa=Ma+Fa.join("")}else ta=Fa,Fa=ma;return Fa}function K(){if(te.test(d.charAt(ta))){var Ba=d.charAt(ta);ta++}else Ba=ma,0===Wa&&v(uc);return Ba}function J(){if(wd.test(d.charAt(ta))){var Ba=d.charAt(ta);ta++}else Ba=ma,0===Wa&&v(Fc);return Ba}function M(){if(ue.test(d.charAt(ta))){var Ba=d.charAt(ta);ta++}else Ba=
ma,0===Wa&&v(Fd);return Ba}function N(){var Ba=ta;if(64===d.charCodeAt(ta)){var Fa=xb;ta++}else Fa=ma,0===Wa&&v(vc);if(Fa!==ma){var Ma=E();Ma!==ma?Ba=Fa=[Fa,Ma]:(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;Ba!==ma&&(Ba={type:"parameter",value:Ba[1]});return Ba}function P(){var Ba=ta;if(d.substr(ta,7).toLowerCase()===yb){var Fa=d.substr(ta,7);ta+=7}else Fa=ma,0===Wa&&v(Vd);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="LEADING":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;Ba===ma&&(Ba=ta,d.substr(ta,
8).toLowerCase()===Fb?(Fa=d.substr(ta,8),ta+=8):(Fa=ma,0===Wa&&v(ld)),Fa!==ma?(Fa=ta,Wa++,Ma=J(),Wa--,Ma===ma?Fa=void 0:(ta=Fa,Fa=ma),Fa!==ma?Ba="TRAILING":(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma),Ba===ma&&(Ba=ta,d.substr(ta,4).toLowerCase()===Jb?(Fa=d.substr(ta,4),ta+=4):(Fa=ma,0===Wa&&v(id)),Fa!==ma?(Fa=ta,Wa++,Ma=J(),Wa--,Ma===ma?Fa=void 0:(ta=Fa,Fa=ma),Fa!==ma?Ba="BOTH":(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)));return Ba}function I(){var Ba=ta;var Fa=ta;var Ma=G();if(Ma!==ma){Ja();var $a=Na();if($a!==ma)if(Ja(),$a=
L(),$a!==ma){Ja();var gb=Oa();gb!==ma?Fa={type:"interval-period",period:Ma.value,precision:$a,secondary:null}:(ta=Fa,Fa=ma)}else ta=Fa,Fa=ma;else ta=Fa,Fa=ma}else ta=Fa,Fa=ma;Fa===ma&&(Fa=ta,Ma=G(),Ma!==ma&&(Ma={type:"interval-period",period:Ma.value,precision:null,secondary:null}),Fa=Ma);if(Fa!==ma)if(Ja(),Ma=ta,d.substr(ta,2).toLowerCase()===Kb?($a=d.substr(ta,2),ta+=2):($a=ma,0===Wa&&v(dg)),$a!==ma?($a=ta,Wa++,gb=J(),Wa--,gb===ma?$a=void 0:(ta=$a,$a=ma),$a!==ma?Ma="TO":(ta=Ma,Ma=ma)):(ta=Ma,Ma=
ma),Ma!==ma){Ja();Ma=ta;$a=G();$a!==ma&&($a={type:"interval-period",period:$a.value,precision:null,secondary:null});Ma=$a;if(Ma===ma){Ma=ta;$a=sa();if($a!==ma)if(Ja(),$a=Na(),$a!==ma)if(Ja(),$a=L(),$a!==ma)if(Ja(),gb=Ia(),gb!==ma)if(Ja(),gb=H(),gb!==ma){Ja();var qb=Oa();qb!==ma?Ma={type:"interval-period",period:"second",precision:$a,secondary:gb}:(ta=Ma,Ma=ma)}else ta=Ma,Ma=ma;else ta=Ma,Ma=ma;else ta=Ma,Ma=ma;else ta=Ma,Ma=ma;else ta=Ma,Ma=ma;Ma===ma&&(Ma=ta,$a=sa(),$a!==ma?(Ja(),$a=Na(),$a!==ma?
(Ja(),$a=L(),$a!==ma?(Ja(),gb=Oa(),gb!==ma?Ma={type:"interval-period",period:"second",precision:$a,secondary:null}:(ta=Ma,Ma=ma)):(ta=Ma,Ma=ma)):(ta=Ma,Ma=ma)):(ta=Ma,Ma=ma),Ma===ma&&(Ma=ta,$a=sa(),$a!==ma&&($a={type:"interval-period",period:"second",precision:null,secondary:null}),Ma=$a))}Ma!==ma?Ba={type:"interval-qualifier",start:Fa,end:Ma}:(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;else ta=Ba,Ba=ma;Ba===ma&&(Ba=ta,Ma=G(),Ma!==ma?(Ja(),Fa=Na(),Fa!==ma?(Ja(),Fa=H(),Fa!==ma?(Ja(),$a=Oa(),$a!==ma?Ba={type:"interval-period",
period:Ma.value,precision:Fa,secondary:null}:(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma),Ba===ma&&(Ba=ta,Ma=G(),Ma!==ma&&(Ma={type:"interval-period",period:Ma.value,precision:null,secondary:null}),Ba=Ma,Ba===ma&&(Ba=ta,Ma=sa(),Ma!==ma?(Ja(),Fa=Na(),Fa!==ma?(Ja(),Fa=L(),Fa!==ma?(Ja(),$a=Ia(),$a!==ma?(Ja(),Ma=H(),Ma!==ma?(Ja(),$a=Oa(),$a!==ma?Ba={type:"interval-period",period:"second",precision:Fa,secondary:Ma}:(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)):
(ta=Ba,Ba=ma),Ba===ma&&(Ba=ta,Ma=sa(),Ma!==ma?(Ja(),Fa=Na(),Fa!==ma?(Ja(),Fa=H(),Fa!==ma?(Ja(),$a=Oa(),$a!==ma?Ba={type:"interval-period",period:"second",precision:Fa,secondary:null}:(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma),Ba===ma&&(Ba=ta,Ma=sa(),Ma!==ma&&(Ma={type:"interval-period",period:"second",precision:null,secondary:null}),Ba=Ma)))));return Ba}function G(){var Ba=ta;Ba=va();Ba!==ma&&(Ba={type:"string",value:"day"});Ba===ma&&(Ba=ta,Ba=wa(),Ba!==ma&&(Ba={type:"string",value:"hour"}),
Ba===ma&&(Ba=ta,Ba=za(),Ba!==ma&&(Ba={type:"string",value:"minute"}),Ba===ma&&(Ba=ta,Ba=pa(),Ba!==ma&&(Ba={type:"string",value:"month"}),Ba===ma&&(Ba=ta,Ba=na(),Ba!==ma&&(Ba={type:"string",value:"year"})))));return Ba}function H(){var Ba=T();Ba!==ma&&(Ba=parseFloat(Ba));return Ba}function L(){var Ba=T();Ba!==ma&&(Ba=parseFloat(Ba));return Ba}function O(){var Ba=S();Ba===ma&&(Ba=N());return Ba}function S(){var Ba=ta;if(39===d.charCodeAt(ta)){var Fa=Nb;ta++}else Fa=ma,0===Wa&&v(nc);Fa===ma&&(d.substr(ta,
2)===Bb?(Fa=Bb,ta+=2):(Fa=ma,0===Wa&&v(wc)));if(Fa!==ma){Fa=[];var Ma=ta;d.substr(ta,2)===rb?(Ma=rb,ta+=2):(Ma=ma,0===Wa&&v(Gc));Ma!==ma&&(Ma="'");Ma===ma&&(Yc.test(d.charAt(ta))?(Ma=d.charAt(ta),ta++):(Ma=ma,0===Wa&&v(Hc)));for(;Ma!==ma;)Fa.push(Ma),Ma=ta,d.substr(ta,2)===rb?(Ma=rb,ta+=2):(Ma=ma,0===Wa&&v(Gc)),Ma!==ma&&(Ma="'"),Ma===ma&&(Yc.test(d.charAt(ta))?(Ma=d.charAt(ta),ta++):(Ma=ma,0===Wa&&v(Hc)));39===d.charCodeAt(ta)?(Ma=Nb,ta++):(Ma=ma,0===Wa&&v(nc));Ma!==ma?Ba={type:"string",value:Fa.join("")}:
(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function R(){var Ba=ta;if(xa()!==ma){Ja();var Fa=p();if(Fa!==ma){Ja();var Ma=Ea();Ma!==ma?(Ja(),Ma=p(),Ma!==ma?Ba={type:"when-clause",operand:Fa,value:Ma}:(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma}else ta=Ba,Ba=ma;return Ba}function Q(){var Ba=ta;if(xa()!==ma){Ja();var Fa=p();if(Fa!==ma){Ja();var Ma=Ea();Ma!==ma?(Ja(),Ma=p(),Ma!==ma?Ba={type:"when-clause",operand:Fa,value:Ma}:(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma}else ta=Ba,Ba=ma;return Ba}function V(){var Ba=
ta;var Fa=ta;if(d.substr(ta,4).toLowerCase()===gc){var Ma=d.substr(ta,4);ta+=4}else Ma=ma,0===Wa&&v(eg);if(Ma!==ma){Ma=ta;Wa++;var $a=J();Wa--;$a===ma?Ma=void 0:(ta=Ma,Ma=ma);Ma!==ma?Fa="ELSE":(ta=Fa,Fa=ma)}else ta=Fa,Fa=ma;Fa!==ma?(Ja(),Fa=p(),Fa!==ma?Ba={type:"else-clause",value:Fa}:(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma);return Ba}function aa(){var Ba=T();if(Ba===ma){Ba=ta;if(45===d.charCodeAt(ta)){var Fa=fb;ta++}else Fa=ma,0===Wa&&v(cd);Fa===ma&&(43===d.charCodeAt(ta)?(Fa=db,ta++):(Fa=ma,0===Wa&&v(bd)));
if(Fa!==ma){var Ma=T();Ma!==ma?Ba=Fa[0]+Ma:(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma}return Ba}function X(){var Ba=ta;if(46===d.charCodeAt(ta)){var Fa=mb;ta++}else Fa=ma,0===Wa&&v(dd);Fa!==ma?(Ba=T(),Ba===ma&&(Ba=null),Ba="."+(null!=Ba?Ba:"")):(ta=Ba,Ba=ma);return Ba}function W(){var Ba;var Fa=Ba=ta;if(xd.test(d.charAt(ta))){var Ma=d.charAt(ta);ta++}else Ma=ma,0===Wa&&v(oc);Ma!==ma?(yd.test(d.charAt(ta))?(Fa=d.charAt(ta),ta++):(Fa=ma,0===Wa&&v(Gd)),Fa===ma&&(Fa=null),Fa="e"+(null===Fa?"":Fa)):(ta=Fa,Fa=ma);
Fa!==ma?(Ma=T(),Ma!==ma?Ba=Fa+Ma:(ta=Ba,Ba=ma)):(ta=Ba,Ba=ma);return Ba}function T(){var Ba=[];var Fa=U();if(Fa!==ma)for(;Fa!==ma;)Ba.push(Fa),Fa=U();else Ba=ma;Ba!==ma&&(Ba=Ba.join(""));return Ba}function U(){if(Zc.test(d.charAt(ta))){var Ba=d.charAt(ta);ta++}else Ba=ma,0===Wa&&v(ed);return Ba}function Y(){var Ba=ta;if(d.substr(ta,2).toLowerCase()===Ha){var Fa=d.substr(ta,2);ta+=2}else Fa=ma,0===Wa&&v(Jd);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="IN":(ta=
Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function ba(){var Ba=ta;if(d.substr(ta,2).toLowerCase()===ra){var Fa=d.substr(ta,2);ta+=2}else Fa=ma,0===Wa&&v(Kd);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="IS":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function da(){var Ba=ta;if(d.substr(ta,4).toLowerCase()===Ga){var Fa=d.substr(ta,4);ta+=4}else Fa=ma,0===Wa&&v(Ld);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="LIKE":(ta=Ba,Ba=ma)}else ta=
Ba,Ba=ma;return Ba}function ea(){var Ba=ta;if(d.substr(ta,3).toLowerCase()===Ra){var Fa=d.substr(ta,3);ta+=3}else Fa=ma,0===Wa&&v(Nd);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="NOT":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function ca(){var Ba=ta;if(d.substr(ta,3).toLowerCase()===Va){var Fa=d.substr(ta,3);ta+=3}else Fa=ma,0===Wa&&v(fd);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="AND":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}
function ja(){var Ba=ta;if(d.substr(ta,2).toLowerCase()===ab){var Fa=d.substr(ta,2);ta+=2}else Fa=ma,0===Wa&&v(gd);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="OR":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function ia(){var Ba=ta;if(d.substr(ta,7).toLowerCase()===hb){var Fa=d.substr(ta,7);ta+=7}else Fa=ma,0===Wa&&v(hd);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="BETWEEN":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function Z(){var Ba=
ta;if(d.substr(ta,4).toLowerCase()===ib){var Fa=d.substr(ta,4);ta+=4}else Fa=ma,0===Wa&&v(jd);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="FROM":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function ha(){var Ba=ta;if(d.substr(ta,4).toLowerCase()===Eb){var Fa=d.substr(ta,4);ta+=4}else Fa=ma,0===Wa&&v(Sd);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="TRIM":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function fa(){var Ba=ta;if(d.substr(ta,
9).toLowerCase()===tb){var Fa=d.substr(ta,9);ta+=9}else Fa=ma,0===Wa&&v(Td);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="TIMESTAMP":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function ka(){var Ba=ta;if(d.substr(ta,4).toLowerCase()===nb){var Fa=d.substr(ta,4);ta+=4}else Fa=ma,0===Wa&&v(Ud);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="DATE":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function la(){var Ba=ta;if(d.substr(ta,8).toLowerCase()===
Sb){var Fa=d.substr(ta,8);ta+=8}else Fa=ma,0===Wa&&v(fg);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="INTERVAL":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function na(){var Ba=ta;if(d.substr(ta,4).toLowerCase()===vb){var Fa=d.substr(ta,4);ta+=4}else Fa=ma,0===Wa&&v(gg);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="YEAR":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function pa(){var Ba=ta;if(d.substr(ta,5).toLowerCase()===Wb){var Fa=
d.substr(ta,5);ta+=5}else Fa=ma,0===Wa&&v(hg);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="MONTH":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function va(){var Ba=ta;if(d.substr(ta,3).toLowerCase()===wb){var Fa=d.substr(ta,3);ta+=3}else Fa=ma,0===Wa&&v(ig);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="DAY":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function wa(){var Ba=ta;if(d.substr(ta,4).toLowerCase()===ec){var Fa=d.substr(ta,
4);ta+=4}else Fa=ma,0===Wa&&v(jg);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="HOUR":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function za(){var Ba=ta;if(d.substr(ta,6).toLowerCase()===Ab){var Fa=d.substr(ta,6);ta+=6}else Fa=ma,0===Wa&&v(kg);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="MINUTE":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function sa(){var Ba=ta;if(d.substr(ta,6).toLowerCase()===Hb){var Fa=d.substr(ta,6);ta+=6}else Fa=
ma,0===Wa&&v(lg);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="SECOND":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function ua(){var Ba=ta;if(d.substr(ta,4).toLowerCase()===fc){var Fa=d.substr(ta,4);ta+=4}else Fa=ma,0===Wa&&v(mg);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="CASE":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function oa(){var Ba=ta;if(d.substr(ta,3).toLowerCase()===dc){var Fa=d.substr(ta,3);ta+=3}else Fa=ma,0===Wa&&
v(ng);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="END":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function xa(){var Ba=ta;if(d.substr(ta,4).toLowerCase()===Yb){var Fa=d.substr(ta,4);ta+=4}else Fa=ma,0===Wa&&v(og);if(Fa!==ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="WHEN":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function Ea(){var Ba=ta;if(d.substr(ta,4).toLowerCase()===Xb){var Fa=d.substr(ta,4);ta+=4}else Fa=ma,0===Wa&&v(pg);if(Fa!==
ma){Fa=ta;Wa++;var Ma=J();Wa--;Ma===ma?Fa=void 0:(ta=Fa,Fa=ma);Fa!==ma?Ba="THEN":(ta=Ba,Ba=ma)}else ta=Ba,Ba=ma;return Ba}function Ia(){if(44===d.charCodeAt(ta)){var Ba=tc;ta++}else Ba=ma,0===Wa&&v(qg);return Ba}function Na(){if(40===d.charCodeAt(ta)){var Ba=yc;ta++}else Ba=ma,0===Wa&&v(rg);return Ba}function Oa(){if(41===d.charCodeAt(ta)){var Ba=mc;ta++}else Ba=ma,0===Wa&&v(sg);return Ba}function Ja(){var Ba;var Fa=[];for(Ba=Sa();Ba!==ma;)Fa.push(Ba),Ba=Sa();return Fa}function Sa(){if(zd.test(d.charAt(ta))){var Ba=
d.charAt(ta);ta++}else Ba=ma,0===Wa&&v(tg);return Ba}function Ua(Ba,Fa,Ma,$a){Ba={type:"binary-expression",operator:Ba,left:Fa,right:Ma};void 0!==$a&&(Ba.escape=$a);return Ba}function Za(Ba,Fa){for(var Ma=0;Ma<Fa.length;Ma++)Ba=Ua(Fa[Ma][1],Ba,Fa[Ma][3]);return Ba}f=void 0!==f?f:{};var ma={},Ya=f.grammarSource,bb={start:q},Qa=q,Aa="!",Ca="\x3d",qa="\x3e\x3d",ya="\x3e",Da="\x3c\x3d",La="\x3c\x3e",Ta="\x3c",Xa="!\x3d",db="+",fb="-",jb="||",lb="*",ob="/",xb="@",Nb="'",Bb="N'",rb="''",mb=".",eb="null",
cb="true",Ka="false",Ha="in",ra="is",Ga="like",Pa="escape",Ra="not",Va="and",ab="or",hb="between",ib="from",kb="for",pb="substring",ub="extract",Eb="trim",Ib="position",tb="timestamp",nb="date",yb="leading",Fb="trailing",Jb="both",Pb="cast",Gb="as",Tb="integer",zb="smallint",Rb="float",Qb="real",Ob="varchar",Kb="to",Sb="interval",vb="year",Wb="month",wb="day",ec="hour",Ab="minute",Hb="second",fc="case",dc="end",Yb="when",Xb="then",gc="else",tc=",",yc="(",mc=")",zc="`",te=/^[A-Za-z_\x80-\uFFFF]/,wd=
/^[A-Za-z0-9_]/,ue=/^[A-Za-z0-9_.\x80-\uFFFF]/,Yc=/^[^']/,Zc=/^[0-9]/,xd=/^[eE]/,yd=/^[+\-]/,zd=/^[ \t\n\r]/,Dc=/^[^`]/,$c=e("!",!1),Ec=e("\x3d",!1),Ad=e("\x3e\x3d",!1),ad=e("\x3e",!1),Bd=e("\x3c\x3d",!1),Cd=e("\x3c\x3e",!1),Dd=e("\x3c",!1),Ed=e("!\x3d",!1),bd=e("+",!1),cd=e("-",!1),ve=e("||",!1),Ac=e("*",!1),Bc=e("/",!1),uc=g([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),Fc=g([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),Fd=g([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),
vc=e("@",!1),nc=e("'",!1),wc=e("N'",!1),Gc=e("''",!1),Hc=g(["'"],!0,!1),dd=e(".",!1),ed=g([["0","9"]],!1,!1),oc=g(["e","E"],!1,!1),Gd=g(["+","-"],!1,!1),we=e("NULL",!0),Hd=e("TRUE",!0),Id=e("FALSE",!0),Jd=e("IN",!0),Kd=e("IS",!0),Ld=e("LIKE",!0),Md=e("ESCAPE",!0),Nd=e("NOT",!0),fd=e("AND",!0),gd=e("OR",!0),hd=e("BETWEEN",!0),jd=e("FROM",!0),Pd=e("FOR",!0),Qd=e("SUBSTRING",!0),Rd=e("EXTRACT",!0),Sd=e("TRIM",!0),kd=e("POSITION",!0),Td=e("TIMESTAMP",!0),Ud=e("DATE",!0),Vd=e("LEADING",!0),ld=e("TRAILING",
!0),id=e("BOTH",!0),xe=e("CAST",!0),ye=e("AS",!0),Od=e("INTEGER",!0),Nf=e("SMALLINT",!0),Pf=e("FLOAT",!0),Rf=e("REAL",!0),Tf=e("VARCHAR",!0),dg=e("TO",!0),fg=e("INTERVAL",!0),gg=e("YEAR",!0),hg=e("MONTH",!0),ig=e("DAY",!0),jg=e("HOUR",!0),kg=e("MINUTE",!0),lg=e("SECOND",!0),mg=e("CASE",!0),ng=e("END",!0),og=e("WHEN",!0),pg=e("THEN",!0),eg=e("ELSE",!0),qg=e(",",!1),rg=e("(",!1),sg=e(")",!1),tg=g([" ","\t","\n","\r"],!1,!1),kf=e("`",!1),lf=g(["`"],!0,!1),ta=0,Wd=[{line:1,column:1}],jc=0,ze=[],Wa=0;
if("startRule"in f){if(!(f.startRule in bb))throw Error("Can't start parsing from rule \""+f.startRule+'".');Qa=bb[f.startRule]}var Me=Qa();if(Me!==ma&&ta===d.length)return Me;Me!==ma&&ta<d.length&&v({type:"end"});throw function(Ba,Fa,Ma){return new r(r.buildMessage(Ba,Fa),Ba,Fa,Ma)}(ze,jc<d.length?d.charAt(jc):null,jc<d.length?l(jc,jc+1):l(jc,jc));}}})})({get exports(){return b},set exports(n){b=n}});let t=function(){function n(){}n.parse=function(r){return b.parse(r)};return n}();a.WhereGrammar=
t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/projectionSupport":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/projection ../../../geometry/geometryAdapters/json ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils".split(" "),function(a,c,b,t,n,r,m){function d(k,p){if(!p)return null;if("x"in p){var z={x:0,y:0};[z.x,z.y]=k(p.x,p.y,h);null!=p.z&&(z.z=p.z);
null!=p.m&&(z.m=p.m);return z}return"xmin"in p?(z={xmin:0,ymin:0,xmax:0,ymax:0},[z.xmin,z.ymin]=k(p.xmin,p.ymin,h),[z.xmax,z.ymax]=k(p.xmax,p.ymax,h),p.hasZ&&(z.zmin=p.zmin,z.zmax=p.zmax,z.hasZ=!0),p.hasM&&(z.mmin=p.mmin,z.mmax=p.mmax,z.hasM=!0),z):"rings"in p?{rings:f(p.rings,k),hasM:p.hasM,hasZ:p.hasZ}:"paths"in p?{paths:f(p.paths,k),hasM:p.hasM,hasZ:p.hasZ}:"points"in p?{points:e(p.points,k),hasM:p.hasM,hasZ:p.hasZ}:null}function f(k,p){const z=[];for(const C of k)z.push(e(C,p));return z}function e(k,
p){const z=[];for(const C of k)k=p(C[0],C[1],[0,0]),z.push(k),2<C.length&&k.push(C[2]),3<C.length&&k.push(C[3]);return z}function g(){g=c._asyncToGenerator(function*(k,p){k&&p&&(k=Array.isArray(k)?k.map(z=>b.isSome(z.geometry)?z.geometry.spatialReference:null).filter(b.isSome):[k],yield t.initializeProjection(k.map(z=>({source:z,dest:p}))))});return g.apply(this,arguments)}const h=[0,0],l=d.bind(null,m.lngLatToXY),v=d.bind(null,m.xyToLngLat),q=new (function(){function k(){this._jobs=[];this._timer=
null;this._process=this._process.bind(this)}var p=k.prototype;p.push=function(){var z=c._asyncToGenerator(function*(C,B,A){if(!(C&&C.length&&B&&A)||r.equals(B,A))return C;const x={geometries:C,inSpatialReference:B,outSpatialReference:A,resolve:null};this._jobs.push(x);return new Promise(u=>{x.resolve=u;null===this._timer&&(this._timer=setTimeout(this._process,10))})});return function(C,B,A){return z.apply(this,arguments)}}();p._process=function(){this._timer=null;const z=this._jobs.shift();if(z){var {geometries:C,
inSpatialReference:B,outSpatialReference:A,resolve:x}=z;m.canProject(B,A)?r.isWebMercator(A)?x(C.map(l)):x(C.map(v)):x(t.projectMany(n.jsonAdapter,C,B,A,null,null));0<this._jobs.length&&(this._timer=setTimeout(this._process,10))}};return k}());a.checkProjectionSupport=function(k,p){return g.apply(this,arguments)};a.project=function(k,p,z,C){if(!k)return k;z||(z=p,p=k.spatialReference);return r.isValid(p)&&r.isValid(z)&&!r.equals(p,z)?m.canProject(p,z)?(k=r.isWebMercator(z)?l(k):v(k),k.spatialReference=
z,k):t.projectMany(n.jsonAdapter,[k],p,z,null,C)[0]:k};a.projectMany=function(k,p,z){return q.push(k,p,z)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/geometryAdapters/json":function(){define(["exports"],function(a){let c=function(m,d,f){this.x=m;this.y=d;this.spatialReference=f;this.m=this.z=void 0},b=function(m,d,f,e){this.rings=m;this.spatialReference=d;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);e&&(this.hasM=e)},t=function(m,d,f,e){this.paths=m;this.spatialReference=
d;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);e&&(this.hasM=e)},n=function(m,d,f,e){this.points=m;this.spatialReference=d;this.hasM=this.hasZ=void 0;f&&(this.hasZ=f);e&&(this.hasM=e)},r=function(m,d,f,e,g){this.xmin=m;this.ymin=d;this.xmax=f;this.ymax=e;this.spatialReference=g;this.mmax=this.mmin=this.zmax=this.zmin=void 0};a.jsonAdapter={convertToGEGeometry:function(m,d){return null==d?null:m.convertJSONToGeometry(d)},exportPoint:function(m,d,f){f=new c(m.getPointX(d),m.getPointY(d),f);const e=m.hasZ(d),
g=m.hasM(d);e&&(f.z=m.getPointZ(d));g&&(f.m=m.getPointM(d));return f},exportPolygon:function(m,d,f){return new b(m.exportPaths(d),f,m.hasZ(d),m.hasM(d))},exportPolyline:function(m,d,f){return new t(m.exportPaths(d),f,m.hasZ(d),m.hasM(d))},exportMultipoint:function(m,d,f){return new n(m.exportPoints(d),f,m.hasZ(d),m.hasM(d))},exportExtent:function(m,d,f){var e=m.hasZ(d);const g=m.hasM(d);f=new r(m.getXMin(d),m.getYMin(d),m.getXMax(d),m.getYMax(d),f);e&&(e=m.getZExtent(d),f.zmin=e.vmin,f.zmax=e.vmax);
g&&(m=m.getMExtent(d),f.mmin=m.vmin,f.mmax=m.vmax);return f}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/QueryEngineResult":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../geometry/support/centroid ../../../geometry/support/extentUtils ../../../geometry/support/quantizationUtils ../../../geometry/support/spatialReferenceUtils ./AttributesBuilder ./projectionSupport ./SnappingCandidate ./utils ../../support/fieldUtils ../../../statistics/utils ../../../support/arcadeOnDemand".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){function k(B,A,x,u){const y=u.x-x.x;u=u.y-x.y;A=Math.min(1,Math.max(0,((A.x-x.x)*y+(A.y-x.y)*u)/(y*y+u*u)));B.x=x.x+y*A;B.y=x.y+u*A}function p(B,A){return B?A?4:3:A?3:2}let z=function(){function B(x,u,y){this.items=x;this.query=u;this.geometryType=y.geometryType;this.hasM=y.hasM;this.hasZ=y.hasZ;this.fieldsIndex=y.fieldsIndex;this.objectIdField=y.objectIdField;this.spatialReference=y.spatialReference;this.featureAdapter=y.featureAdapter}var A=B.prototype;A.createQueryResponseForCount=
function(){const x=new f(this.query,this.featureAdapter,this.fieldsIndex);if(!this.query.outStatistics)return x.countDistinctValues(this.items);const {groupByFieldsForStatistics:u,having:y,outStatistics:w}=this.query;if(!u?.length)return 1;const D=new Map,F=new Map,E=new Set;for(const M of w){var {statisticType:K}=M;K="exceedslimit"!==K?M.onStatisticField:void 0;if(!F.has(K)){var J=[];for(const N of u){const P=this._getAttributeValues(x,N,D);J.push(P)}F.set(K,this._calculateUniqueValues(J,x.returnDistinctValues))}K=
F.get(K);for(const N in K){const {data:P,items:I}=K[N];J=P.join(",");y&&!x.validateItems(I,y)||E.add(J)}}return E.size};A.createQueryResponse=function(){var x=b._asyncToGenerator(function*(){let u;u=this.query.outStatistics?this.query.outStatistics.some(y=>"exceedslimit"===y.statisticType)?this._createExceedsLimitQueryResponse(this.query):yield this._createStatisticsQueryResponse(this.query):this._createFeatureQueryResponse(this.query);if(this.query.returnQueryGeometry){const y=this.query.geometry;
d.isValid(this.query.outSR)&&!d.equals(y.spatialReference,this.query.outSR)?u.queryGeometry=h.cleanFromGeometryEngine({spatialReference:this.query.outSR,...e.project(y,y.spatialReference,this.query.outSR)}):u.queryGeometry=h.cleanFromGeometryEngine({spatialReference:this.query.outSR,...y})}return u});return function(){return x.apply(this,arguments)}}();A.createSnappingResponse=function(x,u){const y=this.featureAdapter,w=p(this.hasZ,this.hasM),{point:D,mode:F}=x,E="number"===typeof x.distance?x.distance:
x.distance.x,K="number"===typeof x.distance?x.distance:x.distance.y,J={candidates:[]},M="esriGeometryPolygon"===this.geometryType;u=this._getPointCreator(F,this.spatialReference,u);const N=new C(null,0),P=new C(null,0),I={x:0,y:0,z:0};for(const Q of this.items){var G=y.getGeometry(Q);if(t.isNone(G))continue;const {coords:V,lengths:aa}=G;N.coords=V;P.coords=V;if(x.types&c.SnappingTypes.EDGE){G=0;for(var H=0;H<aa.length;H++){var L=aa[H];for(var O=0;O<L;O++,G+=w){var S=N;S.coordsIndex=G;if(O!==L-1){const X=
P;X.coordsIndex=G+w;const W=I;k(I,D,S,X);var R=(D.x-W.x)/E;const T=(D.y-W.y)/K;R=R*R+T*T;1>=R&&J.candidates.push(g.makeEdgeCandidate(y.getObjectId(Q),u(W),Math.sqrt(R),u(S),u(X)))}}}}if(x.types&c.SnappingTypes.VERTEX)for(G=M?V.length-w:V.length,H=0;H<G;H+=w)L=N,L.coordsIndex=H,O=(D.x-L.x)/E,S=(D.y-L.y)/K,O=O*O+S*S,1>=O&&J.candidates.push(g.makeVertexCandidate(y.getObjectId(Q),u(L),Math.sqrt(O)))}J.candidates.sort((Q,V)=>Q.distance-V.distance);return J};A._getPointCreator=function(x,u,y){const w=t.isSome(y)&&
!d.equals(u,y)?F=>e.project(F,u,y):F=>F,{hasZ:D}=this;return"3d"===x?D?({x:F,y:E,z:K})=>w({x:F,y:E,z:K}):({x:F,y:E})=>w({x:F,y:E,z:0}):({x:F,y:E})=>w({x:F,y:E})};A.createSummaryStatisticsResponse=function(){var x=b._asyncToGenerator(function*(u){const {field:y,valueExpression:w,normalizationField:D,normalizationType:F,normalizationTotal:E,minValue:K,maxValue:J,scale:M}=u;u=this.fieldsIndex.isDateField(y);var N=yield this._getDataValues({field:y,valueExpression:w,normalizationField:D,normalizationType:F,
normalizationTotal:E,scale:M});const P=v.isNullCountSupported({normalizationType:F,normalizationField:D,minValue:K,maxValue:J}),I=this.fieldsIndex.get(y),G={value:.5,fieldType:I?.type};N=l.isStringField(I)?v.calculateStringStatistics({values:N,supportsNullCount:P,percentileParams:G}):v.calculateStatistics({values:N,minValue:K,maxValue:J,useSampleStdDev:!F,supportsNullCount:P,percentileParams:G});return v.processSummaryStatisticsResult(N,u)});return function(u){return x.apply(this,arguments)}}();A.createUniqueValuesResponse=
function(){var x=b._asyncToGenerator(function*(u){const {field:y,valueExpression:w,domains:D,returnAllCodedValues:F,scale:E}=u;var K=yield this._getDataValues({field:y,field2:u.field2,field3:u.field3,fieldDelimiter:u.fieldDelimiter,valueExpression:w,scale:E});K=v.calculateUniqueValuesCount(K);return v.createUVResult(K,D,F,u.fieldDelimiter)});return function(u){return x.apply(this,arguments)}}();A.createClassBreaksResponse=function(){var x=b._asyncToGenerator(function*(u){const {field:y,valueExpression:w,
normalizationField:D,normalizationType:F,normalizationTotal:E,classificationMethod:K,standardDeviationInterval:J,minValue:M,maxValue:N,numClasses:P,scale:I}=u;u=yield this._getDataValues({field:y,valueExpression:w,normalizationField:D,normalizationType:F,normalizationTotal:E,scale:I});u=v.calculateClassBreaks(u,{field:y,normalizationField:D,normalizationType:F,normalizationTotal:E,classificationMethod:K,standardDeviationInterval:J,minValue:M,maxValue:N,numClasses:P});return v.resolveCBResult(u,K)});
return function(u){return x.apply(this,arguments)}}();A.createHistogramResponse=function(){var x=b._asyncToGenerator(function*(u){const {field:y,valueExpression:w,normalizationField:D,normalizationType:F,normalizationTotal:E,classificationMethod:K,standardDeviationInterval:J,minValue:M,maxValue:N,numBins:P,scale:I}=u;u=yield this._getDataValues({field:y,valueExpression:w,normalizationField:D,normalizationType:F,normalizationTotal:E,scale:I});return v.calculateHistogram(u,{field:y,normalizationField:D,
normalizationType:F,normalizationTotal:E,classificationMethod:K,standardDeviationInterval:J,minValue:M,maxValue:N,numBins:P})});return function(u){return x.apply(this,arguments)}}();A._sortFeatures=function(x,u,y){if(1<x.length&&u&&u.length)for(const w of u.reverse()){u=w.split(" ");const D=u[0],F=this.fieldsIndex.get(D);u=u[1]?"desc"===u[1].toLowerCase():!1;const E=v.getAttributeComparator(F?.type,u);x.sort((K,J)=>{K=y(K,D,F);J=y(J,D,F);return E(K,J)})}};A._createFeatureQueryResponse=function(x){const u=
this.items,{geometryType:y,hasM:w,hasZ:D,objectIdField:F,spatialReference:E}=this,{outFields:K,outSR:J,quantizationParameters:M,resultRecordCount:N,resultOffset:P,returnZ:I,returnM:G}=x,H=null!=N?u.length>(P||0)+N:!1,L=K&&(K.includes("*")?[...this.fieldsIndex.fields]:K.map(O=>this.fieldsIndex.get(O)));return{exceededTransferLimit:H,features:this._createFeatures(x,u),fields:L,geometryType:y,hasM:w&&G,hasZ:D&&I,objectIdFieldName:F,spatialReference:h.cleanFromGeometryEngine(J?J:E),transform:M&&m.toQuantizationTransform(M)||
null}};A._createFeatures=function(x,u){const y=new f(x,this.featureAdapter,this.fieldsIndex),{hasM:w,hasZ:D}=this,{orderByFields:F,quantizationParameters:E,returnGeometry:K,returnCentroid:J,maxAllowableOffset:M,resultOffset:N,resultRecordCount:P,returnZ:I=!1,returnM:G=!1}=x,H=D&&I,L=w&&G;x=[];var O=0;u=[...u];this._sortFeatures(u,F,(Q,V,aa)=>y.getFieldValue(Q,V,aa));if(K||J){var S=m.toQuantizationTransform(E)??void 0;if(K&&!J)for(var R of u)x[O++]={attributes:y.getAttributes(R),geometry:h.getGeometry(this.geometryType,
this.hasZ,this.hasM,this.featureAdapter.getGeometry(R),M,S,H,L)};else if(!K&&J)for(const Q of u)x[O++]={attributes:y.getAttributes(Q),centroid:h.transformCentroid(this,this.featureAdapter.getCentroid(Q,this),S)};else for(const Q of u)x[O++]={attributes:y.getAttributes(Q),centroid:h.transformCentroid(this,this.featureAdapter.getCentroid(Q,this),S),geometry:h.getGeometry(this.geometryType,this.hasZ,this.hasM,this.featureAdapter.getGeometry(Q),M,S,H,L)}}else for(S of u)(R=y.getAttributes(S))&&(x[O++]=
{attributes:R});O=N||0;null!=P&&(x=x.slice(O,Math.min(x.length,O+P)));return x};A._createExceedsLimitQueryResponse=function(x){var u=!1;let y=Number.POSITIVE_INFINITY,w=Number.POSITIVE_INFINITY;u=Number.POSITIVE_INFINITY;for(const D of x.outStatistics??[])if("exceedslimit"===D.statisticType){y=null!=D.maxPointCount?D.maxPointCount:Number.POSITIVE_INFINITY;w=null!=D.maxRecordCount?D.maxRecordCount:Number.POSITIVE_INFINITY;u=null!=D.maxVertexCount?D.maxVertexCount:Number.POSITIVE_INFINITY;break}if("esriGeometryPoint"===
this.geometryType)u=this.items.length>y;else if(this.items.length>w)u=!0;else{x=p(this.hasZ,this.hasM);const D=this.featureAdapter;u=this.items.reduce((F,E)=>{E=D.getGeometry(E);return F+(t.isSome(E)&&E.coords.length||0)},0)/x>u}return{fields:[{name:"exceedslimit",type:"esriFieldTypeInteger",alias:"exceedslimit",sqlType:"sqlTypeInteger",domain:null,defaultValue:null}],features:[{attributes:{exceedslimit:Number(u)}}]}};A._createStatisticsQueryResponse=function(){var x=b._asyncToGenerator(function*(u){var y=
{attributes:{}};const w=[],D=new Map,F=new Map,E=new Map,K=new Map,J=new f(u,this.featureAdapter,this.fieldsIndex);var M=u.outStatistics;const {groupByFieldsForStatistics:N,having:P,orderByFields:I}=u;u=N&&N.length;const G=!!u,H=G?N[0]:null,L=G&&!this.fieldsIndex.get(H);for(const V of M??[]){const {outStatisticFieldName:aa,statisticType:X}=V;M=V;var O="exceedslimit"!==X?V.onStatisticField:void 0;const W="percentile_disc"===X||"percentile_cont"===X,T="EnvelopeAggregate"===X||"CentroidAggregate"===
X||"ConvexHullAggregate"===X,U=G&&1===u&&(O===H||L)&&"count"===X;if(G){if(!E.has(O)){var S=[];for(const Y of N){var R=this._getAttributeValues(J,Y,D);S.push(R)}E.set(O,this._calculateUniqueValues(S,T?!1:J.returnDistinctValues))}S=E.get(O);for(const Y in S){const {count:ba,data:da,items:ea,itemPositions:ca}=S[Y];R=da.join(",");if(!P||J.validateItems(ea,P)){const ja=K.get(R)||{attributes:{}};if(T){ja.aggregateGeometries||(ja.aggregateGeometries={});const {aggregateGeometries:Z,outStatisticFieldName:ha}=
yield this._getAggregateGeometry(M,ea);ja.aggregateGeometries[ha]=Z}else{var Q=null;if(U)Q=ba;else{const Z=this._getAttributeValues(J,O,D);Q=ca.map(ha=>Z[ha]);Q=W&&"statisticParameters"in M?this._getPercentileValue(M,Q):this._getStatisticValue(M,Q,null,J.returnDistinctValues)}ja.attributes[aa]=Q}let ia=0;N.forEach((Z,ha)=>ja.attributes[this.fieldsIndex.get(Z)?Z:`EXPR_${++ia}`]=da[ha]);K.set(R,ja)}}}else if(T){y.aggregateGeometries||(y.aggregateGeometries={});const {aggregateGeometries:Y,outStatisticFieldName:ba}=
yield this._getAggregateGeometry(M,this.items);y.aggregateGeometries[ba]=Y}else O=this._getAttributeValues(J,O,D),y.attributes[aa]=W&&"statisticParameters"in M?this._getPercentileValue(M,O):this._getStatisticValue(M,O,F,J.returnDistinctValues);w.push({name:aa,alias:aa,type:"esriFieldTypeDouble"})}y=G?Array.from(K.values()):[y];this._sortFeatures(y,I,(V,aa)=>V.attributes[aa]);return{fields:w,features:y}});return function(u){return x.apply(this,arguments)}}();A._getAggregateGeometry=function(){var x=
b._asyncToGenerator(function*(u,y){var w=yield new Promise((I,G)=>a(["../../../geometry/geometryEngineJSON"],I,G));const {statisticType:D,outStatisticFieldName:F}=u,{featureAdapter:E,spatialReference:K,geometryType:J,hasZ:M,hasM:N}=this;y=y.map(I=>h.getGeometry(J,M,N,E.getGeometry(I)));const P=w.convexHull(K,y,!0)[0];u={aggregateGeometries:null,outStatisticFieldName:null};"EnvelopeAggregate"===D?(w=P?r.getPolygonExtent(P):r.getGeometryExtent(w.union(K,y)),u.aggregateGeometries={...w,spatialReference:K},
u.outStatisticFieldName=F||"extent"):"CentroidAggregate"===D?(w=P?n.polygonCentroid(P):n.extentCentroid(r.getGeometryExtent(w.union(K,y))),u.aggregateGeometries={x:w[0],y:w[1],spatialReference:K},u.outStatisticFieldName=F||"centroid"):"ConvexHullAggregate"===D&&(u.aggregateGeometries=P,u.outStatisticFieldName=F||"convexHull");return u});return function(u,y){return x.apply(this,arguments)}}();A._getStatisticValue=function(x,u,y,w){const {onStatisticField:D,statisticType:F}=x;x=null;x=y?.has(D)?y.get(D):
l.isStringField(this.fieldsIndex.get(D))?v.calculateStringStatistics({values:u,returnDistinct:w}):v.calculateStatistics({values:w?[...(new Set(u))]:u,minValue:null,maxValue:null,useSampleStdDev:!0});y&&y.set(D,x);return x["var"===F?"variance":F]};A._getPercentileValue=function(x,u){const {onStatisticField:y,statisticParameters:w,statisticType:D}=x,{value:F,orderBy:E}=w;x=this.fieldsIndex.get(y);return v.calculatePercentile(u,{value:F,orderBy:E,fieldType:x?.type,isDiscrete:"percentile_disc"===D})};
A._getAttributeValues=function(x,u,y){if(y.has(u))return y.get(u);const w=this.fieldsIndex.get(u),D=this.items.map(F=>x.getFieldValue(F,u,w));y.set(u,D);return D};A._getAttributeDataValues=function(x,u){return this.items.map(y=>x.getDataValue(y,{field:u.field,field2:u.field2,field3:u.field3,fieldDelimiter:u.fieldDelimiter,normalizationField:u.normalizationField,normalizationType:u.normalizationType,normalizationTotal:u.normalizationTotal}))};A._getAttributeExpressionValues=function(){var x=b._asyncToGenerator(function*(u,
y,w){const {arcadeUtils:D}=yield q.loadArcade();y=D.createFunction(y);w=w&&D.getViewInfo(w);return u.getExpressionValues(this.items,y,w,D)});return function(u,y,w){return x.apply(this,arguments)}}();A._calculateUniqueValues=function(x,u){const y={},w=this.items,D=w.length;for(let F=0;F<D;F++){const E=w[F],K=[];for(const M of x)K.push(M[F]);const J=K.join(",");null==y[J]?y[J]={count:1,data:K,items:[E],itemPositions:[F]}:(u||y[J].count++,y[J].items.push(E),y[J].itemPositions.push(F))}return y};A._getDataValues=
function(){var x=b._asyncToGenerator(function*(u){const y=new f(this.query,this.featureAdapter,this.fieldsIndex),{valueExpression:w,field:D,normalizationField:F,normalizationType:E,normalizationTotal:K,scale:J}=u,M=w?{viewingMode:"map",scale:J,spatialReference:this.query.outSR||this.spatialReference}:null;return w?this._getAttributeExpressionValues(y,w,M):this._getAttributeDataValues(y,{field:D,field2:u.field2,field3:u.field3,fieldDelimiter:u.fieldDelimiter,normalizationField:F,normalizationType:E,
normalizationTotal:K})});return function(u){return x.apply(this,arguments)}}();b._createClass(B,[{key:"size",get:function(){return this.items.length}}]);return B}();c.SnappingTypes=void 0;(function(B){B[B.NONE=0]="NONE";B[B.EDGE=1]="EDGE";B[B.VERTEX=2]="VERTEX"})(c.SnappingTypes||(c.SnappingTypes={}));let C=function(){function B(A,x){this.coords=A;this.coordsIndex=x}b._createClass(B,[{key:"x",get:function(){return this.coords[this.coordsIndex]}},{key:"y",get:function(){return this.coords[this.coordsIndex+
1]}},{key:"z",get:function(){return this.coords[this.coordsIndex+2]}}]);return B}();c.QueryEngineResult=z;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/AttributesBuilder":function(){define(["../../../core/maybe","./attributeSupport","../../../statistics/utils"],function(a,c,b){return function(){function t(r,m,d){this._fieldDataCache=new Map;this._returnDistinctMap=new Map;this.returnDistinctValues=r.returnDistinctValues??!1;this.fieldsIndex=d;this.featureAdapter=
m;if((m=r.outFields)&&!m.includes("*")){this.outFields=m;r=0;for(const e of m){var f=c.getExpressionFromFieldName(e);f=(m=this.fieldsIndex.get(f))?null:c.getWhereClause(f,d);m=m?m.name:c.getAliasFromFieldName(e)||`FIELD_EXP_${r++}`;this._fieldDataCache.set(e,{alias:m,clause:f})}}}var n=t.prototype;n.countDistinctValues=function(r){if(!this.returnDistinctValues)return r.length;r.forEach(m=>this.getAttributes(m));return this._returnDistinctMap.size};n.getAttributes=function(r){r=this._processAttributesForOutFields(r);
return this._processAttributesForDistinctValues(r)};n.getFieldValue=function(r,m,d){const f=d?d.name:m;let e=null;this._fieldDataCache.has(f)?e=this._fieldDataCache.get(f)?.clause:d||(e=c.getWhereClause(m,this.fieldsIndex),this._fieldDataCache.set(f,{alias:f,clause:e}));return d?this.featureAdapter.getAttribute(r,f):e?.calculateValue(r,this.featureAdapter)};n.getDataValue=function(r,m){const d=m.normalizationType,f=m.normalizationTotal;let e=m.field&&this.getFieldValue(r,m.field,this.fieldsIndex.get(m.field));
m.field2&&(e=`${b.processNullValue(e)}${m.fieldDelimiter}${b.processNullValue(this.getFieldValue(r,m.field2,this.fieldsIndex.get(m.field2)))}`,m.field3&&(e=`${e}${m.fieldDelimiter}${b.processNullValue(this.getFieldValue(r,m.field3,this.fieldsIndex.get(m.field3)))}`));d&&Number.isFinite(e)&&(r="field"===d&&m.normalizationField?this.getFieldValue(r,m.normalizationField,this.fieldsIndex.get(m.normalizationField)):null,e=b.getNormalizedValue(e,d,r,f));return e};n.getExpressionValue=function(r,m,d,f){r=
{attributes:this.featureAdapter.getAttributes(r),layer:{fields:this.fieldsIndex.fields}};d=f.createExecContext(r,d);return f.executeFunction(m,d)};n.getExpressionValues=function(r,m,d,f){const e={fields:this.fieldsIndex.fields};return r.map(g=>{g={attributes:this.featureAdapter.getAttributes(g),layer:e};g=f.createExecContext(g,d);return f.executeFunction(m,g)})};n.validateItem=function(r,m){this._fieldDataCache.has(m)||this._fieldDataCache.set(m,{alias:m,clause:c.getWhereClause(m,this.fieldsIndex)});
return this._fieldDataCache.get(m)?.clause?.testFeature(r,this.featureAdapter)??!1};n.validateItems=function(r,m){this._fieldDataCache.has(m)||this._fieldDataCache.set(m,{alias:m,clause:c.getWhereClause(m,this.fieldsIndex)});return this._fieldDataCache.get(m)?.clause?.testSet(r,this.featureAdapter)??!1};n._processAttributesForOutFields=function(r){const m=this.outFields;if(!m||!m.length)return this.featureAdapter.getAttributes(r);const d={};for(const f of m){const {alias:e,clause:g}=this._fieldDataCache.get(f);
d[e]=g?g.calculateValue(r,this.featureAdapter):this.featureAdapter.getAttribute(r,e)}return d};n._processAttributesForDistinctValues=function(r){if(a.isNone(r)||!this.returnDistinctValues)return r;var m=this.outFields,d=[];if(m)for(const e of m){var {alias:f}=this._fieldDataCache.get(e);d.push(r[f])}else for(f in r)d.push(r[f]);m=`${(m||["*"]).join(",")}=${d.join(",")}`;d=this._returnDistinctMap.get(m)||0;this._returnDistinctMap.set(m,++d);return 1<d?null:r};return t}()})},"esri/statistics/utils":function(){define(["exports",
"../rest/support/ClassBreaksDefinition","../rest/support/generateRendererUtils"],function(a,c,b){function t(u){return null==u||"string"===typeof u&&!u?"\x3cNull\x3e":u}function n(u){const y=null!=u.minValue||null!=u.maxValue,w=!!u.sqlExpression&&u.supportsSQLExpression;return!(null!=u.normalizationField||null!=u.normalizationType)&&!y&&!w}function r(u){const {values:y,useSampleStdDev:w,supportsNullCount:D}=u;var F=Number.POSITIVE_INFINITY;let E=Number.NEGATIVE_INFINITY,K=null,J=null;var M=null;let N=
null,P=0;const I=null==u.minValue?-Infinity:u.minValue,G=null==u.maxValue?Infinity:u.maxValue;for(const H of y)Number.isFinite(H)?H>=I&&H<=G&&(K=null===K?H:K+H,F=Math.min(F,H),E=Math.max(E,H),P++):"string"===typeof H&&P++;if(P&&null!=K){J=K/P;M=0;for(const H of y)Number.isFinite(H)&&H>=I&&H<=G&&(M+=(H-J)**2);N=w?1<P?M/(P-1):0:0<P?M/P:0;M=Math.sqrt(N)}else E=F=null;F={avg:J,count:P,max:E,min:F,stddev:M,sum:K,variance:N};D&&(F.nullcount=y.length-P);u.percentileParams&&(F.median=m(y,u.percentileParams));
return F}function m(u,y){const {fieldType:w,value:D,orderBy:F,isDiscrete:E}=y,K=d(w,"desc"===F);u=[...u].filter(P=>null!=P).sort((P,I)=>K(P,I));if(0===u.length)return null;if(0>=D)return u[0];if(1<=D)return u[u.length-1];var J=(u.length-1)*D,M=Math.floor(J);y=M+1;J%=1;M=u[M];const N=u[y];return y>=u.length||E||"string"===typeof M||"string"===typeof N?M:M*(1-J)+N*J}function d(u,y){const w=y?1:-1,D=g(y),F=e(y);if(!u||!["esriFieldTypeDate","esriFieldTypeString","esriFieldTypeGUID","esriFieldTypeGlobalID",
...A].includes(u))return(E,K)=>"number"===typeof E&&"number"===typeof K?D(E,K):"string"===typeof E&&"string"===typeof K?F(E,K):w;if("esriFieldTypeDate"===u)return(E,K)=>{E=(new Date(E)).getTime();K=(new Date(K)).getTime();return isNaN(E)||isNaN(K)?w:D(E,K)};if(A.has(u))return(E,K)=>D(E,K);if("esriFieldTypeString"===u)return(E,K)=>F(E,K);if("esriFieldTypeGUID"===u||"esriFieldTypeGlobalID"===u){const E=e(y);return(K,J)=>E(h(K),h(J))}return y?(E,K)=>1:(E,K)=>-1}function f(u,y,w){if(w){if(null==u)return null==
y?0:1;if(null==y)return-1}else{if(null==u)return null==y?0:-1;if(null==y)return 1}return null}function e(u){return u?(y,w)=>{const D=f(y,w,!0);if(null!=D)return D;y=y.toUpperCase();w=w.toUpperCase();return y>w?-1:y<w?1:0}:(y,w)=>{const D=f(y,w,!1);if(null!=D)return D;y=y.toUpperCase();w=w.toUpperCase();return y<w?-1:y>w?1:0}}function g(u){return u?(y,w)=>{const D=f(y,w,!0);return null!=D?D:w-y}:(y,w)=>{const D=f(y,w,!1);return null!=D?D:y-w}}function h(u){return u.substr(24,12)+u.substr(19,4)+u.substr(16,
2)+u.substr(14,2)+u.substr(11,2)+u.substr(9,2)+u.substr(6,2)+u.substr(4,2)+u.substr(2,2)+u.substr(0,2)}function l(u){return"coded-value"!==u?.type?[]:u.codedValues.map(y=>y.code)}function v(u,y){const w=k({field:y.field,normalizationType:y.normalizationType,normalizationField:y.normalizationField,classificationMethod:y.classificationMethod,standardDeviationInterval:y.standardDeviationInterval,breakCount:y.numClasses||5});u=q(u,y.minValue,y.maxValue);return b.createGenerateRendererClassBreaks({definition:w,
values:u,normalizationTotal:y.normalizationTotal})}function q(u,y,w){const D=null==y?-Infinity:y,F=null==w?Infinity:w;return u.filter(E=>Number.isFinite(E)&&E>=D&&E<=F)}function k(u){const {breakCount:y,field:w,normalizationField:D,normalizationType:F}=u,E=u.classificationMethod||"equal-interval";return new c({breakCount:y,classificationField:w,classificationMethod:E,normalizationField:"field"===F?D:void 0,normalizationType:F,standardDeviationInterval:"standard-deviation"===E?u.standardDeviationInterval||
1:void 0})}function p(u,y){const {field:w,classificationMethod:D,standardDeviationInterval:F,normalizationType:E,normalizationField:K,normalizationTotal:J,minValue:M,maxValue:N}=y,P=y.numBins||10;let I=y=null,G=null;D&&"equal-interval"!==D||E?({classBreaks:u}=v(u,{field:w,normalizationType:E,normalizationField:K,normalizationTotal:J,classificationMethod:D,standardDeviationInterval:F,minValue:M,maxValue:N,numClasses:P}),y=u[0].minValue,I=u[u.length-1].maxValue,G=u.map(H=>[H.minValue,H.maxValue])):
(null!=M&&null!=N?(y=M,I=N):(u=r({values:u,minValue:M,maxValue:N,useSampleStdDev:!E,supportsNullCount:n({normalizationType:E,normalizationField:K,minValue:M,maxValue:N})}),y=u.min??null,I=u.max??null),G=C(y??0,I??0,P));return{min:y,max:I,intervals:G}}function z(u,y){let w=-1;for(let D=u.length-1;0<=D;D--)if(y>=u[D][0]){w=D;break}return w}function C(u,y,w){const D=(y-u)/w,F=[];let E;for(let K=1;K<=w;K++)E=u+D,E=Number(E.toFixed(16)),F.push([u,K===w?y:E]),u=E;return F}const B=/\s*(\+|-)?((\d+(\.\d+)?)|(\.\d+))\s*/gi,
A=new Set(["esriFieldTypeInteger","esriFieldTypeSmallInteger","esriFieldTypeSingle","esriFieldTypeDouble"]),x="min max avg stddev count sum variance nullcount median".split(" ");a.calculateClassBreaks=v;a.calculateHistogram=function(u,y){var w=p(u,y);const D=w.intervals,F=w.min??0;w=w.max??0;const E=D.map((K,J)=>({minValue:D[J][0],maxValue:D[J][1],count:0}));for(const K of u)null!=K&&K>=F&&K<=w&&(u=z(D,K),-1<u&&E[u].count++);return{bins:E,minValue:F,maxValue:w,normalizationTotal:y.normalizationTotal}};
a.calculatePercentile=m;a.calculateStatistics=r;a.calculateStringStatistics=function(u){const y=u.returnDistinct?[...(new Set(u.values))]:u.values,w=y.filter(F=>null!=F).length,D={count:w};u.supportsNullCount&&(D.nullcount=y.length-w);u.percentileParams&&(D.median=m(y,u.percentileParams));return D};a.calculateUniqueValuesCount=function(u){const y={};for(let w of u){if(null==w||"string"===typeof w&&""===w.trim())w=null;null==y[w]?y[w]={count:1,data:w}:y[w].count++}return{count:y}};a.createClassBreaksDefinition=
k;a.createUVResult=function(u,y,w,D){u=u.count;const F=[];if(w&&y){w=[];var E=l(y[0]);for(const K of E)if(y[1]){E=l(y[1]);for(const J of E)if(y[2]){E=l(y[2]);for(const M of E)w.push(`${t(K)}${D}${t(J)}${D}${t(M)}`)}else w.push(`${t(K)}${D}${t(J)}`)}else w.push(K);for(const K of w)u.hasOwnProperty(K)||(u[K]={data:K,count:0})}for(const K in u)y=u[K],F.push({value:y.data,count:y.count,label:y.label});return{uniqueValueInfos:F}};a.getAttributeComparator=d;a.getEqualIntervalBins=C;a.getNormalizedValue=
function(u,y,w,D){let F=null;switch(y){case "log":0!==u&&(F=Math.log(u)*Math.LOG10E);break;case "percent-of-total":Number.isFinite(D)&&0!==D&&(F=u/D*100);break;case "field":Number.isFinite(w)&&0!==w&&(F=u/w);break;case "natural-log":0<u&&(F=Math.log(u));break;case "square-root":0<u&&(F=u**.5)}return F};a.isNullCountSupported=n;a.processNullValue=t;a.processSummaryStatisticsResult=function(u,y){let w;for(w in u)x.includes(w)&&(Number.isFinite(u[w])||(u[w]=null));if(!y)return u;["avg","stddev","variance"].forEach(D=>
{null!=u[D]&&(u[D]=Math.ceil(u[D]))});return u};a.resolveCBResult=function(u,y){let w=u.classBreaks;const D=w[0].minValue,F=w[w.length-1].maxValue,E="standard-deviation"===y;w=w.map(K=>{const J=K.label;K={minValue:K.minValue,maxValue:K.maxValue,label:J};if(E&&J){const M=J.match(B)?.map(N=>+N.trim())??[];2===M.length?(K.minStdDev=M[0],K.maxStdDev=M[1],0>M[0]&&0<M[1]&&(K.hasAvg=!0)):1===M.length&&(J.includes("\x3c")?(K.minStdDev=null,K.maxStdDev=M[0]):J.includes("\x3e")&&(K.minStdDev=M[0],K.maxStdDev=
null))}return K});return{minValue:D,maxValue:F,classBreakInfos:w,normalizationTotal:u.normalizationTotal}};a.statisticTypes=x;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/ClassBreaksDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/jsonMap ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d,f){r=new b.JSONMap({esriClassifyEqualInterval:"equal-interval",esriClassifyManual:"manual",esriClassifyNaturalBreaks:"natural-breaks",esriClassifyQuantile:"quantile",esriClassifyStandardDeviation:"standard-deviation",esriClassifyDefinedInterval:"defined-interval"});b=new b.JSONMap({esriNormalizeByLog:"log",esriNormalizeByPercentOfTotal:"percent-of-total",esriNormalizeByField:"field"});t=function(e){function g(h){h=e.call(this,h)||this;h.type="class-breaks-definition";h.breakCount=
null;h.classificationField=null;h.classificationMethod=null;h.normalizationField=null;h.normalizationType=null;return h}a._inheritsLoose(g,e);a._createClass(g,[{key:"standardDeviationInterval",set:function(h){"standard-deviation"===this.classificationMethod&&this._set("standardDeviationInterval",h)}},{key:"definedInterval",set:function(h){"defined-interval"===this.classificationMethod&&this._set("definedInterval",h)}}]);return g}(t.JSONSupport);c.__decorate([d.enumeration({classBreaksDef:"class-breaks-definition"})],
t.prototype,"type",void 0);c.__decorate([n.property({json:{write:!0}})],t.prototype,"breakCount",void 0);c.__decorate([n.property({json:{write:!0}})],t.prototype,"classificationField",void 0);c.__decorate([n.property({type:String,json:{read:r.read,write:r.write}})],t.prototype,"classificationMethod",void 0);c.__decorate([n.property({json:{write:!0}})],t.prototype,"normalizationField",void 0);c.__decorate([n.property({json:{read:b.read,write:b.write}})],t.prototype,"normalizationType",void 0);c.__decorate([n.property({value:null,
json:{write:!0}})],t.prototype,"standardDeviationInterval",null);c.__decorate([n.property({value:null,json:{write:!0}})],t.prototype,"definedInterval",null);return t=c.__decorate([f.subclass("esri.rest.support.ClassBreaksDefinition")],t)})},"esri/rest/support/generateRendererUtils":function(){define(["exports","../../core/Logger"],function(a,c){function b(l){var v=l.definition;const {classificationMethod:q,normalizationType:k,definedInterval:p}=v;v=v.breakCount??1;const z=[];var C=l.values;if(0===
C.length)return[];C=C.sort((w,D)=>w-D);var B=C[0],A=C[C.length-1];if("equal-interval"===q)if(C.length>=v){C=(A-B)/v;l=B;for(var x=1;x<v;x++){var u=Number((B+x*C).toFixed(6));z.push({minValue:l,maxValue:u,label:t(l,u,k)});l=u}z.push({minValue:l,maxValue:A,label:t(l,A,k)})}else C.forEach(w=>{z.push({minValue:w,maxValue:w,label:t(w,w,k)})});else if("natural-breaks"===q){C=n(C);l=r(C.uniqueValues,l.valueFrequency||C.valueFrequency,v);for(x=1;x<v;x++)C.uniqueValues.length>x&&(u=Number(C.uniqueValues[l[x]].toFixed(6)),
z.push({minValue:B,maxValue:u,label:t(B,u,k)}),B=u);z.push({minValue:B,maxValue:A,label:t(B,A,k)})}else if("quantile"===q)if(C.length>=v&&B!==A){l=Math.ceil(C.length/v);x=0;for(u=1;u<v;u++){var y=l+x-1;y>C.length&&(y=C.length-1);0>y&&(y=0);z.push({minValue:B,maxValue:C[y],label:t(B,C[y],k)});B=C[y];x+=l;l=Math.ceil((C.length-x)/(v-u))}z.push({minValue:B,maxValue:A,label:t(B,A,k)})}else for(v=-1,A=0;A<C.length;A++)B=C[A],B!==v&&(v=B,z.push({minValue:v,maxValue:B,label:t(v,B,k)}),v=B);else if("standard-deviation"===
q)if(l=f(C),x=e(C,l),0===x)z.push({minValue:C[0],maxValue:C[0],label:t(C[0],C[0],k)});else{C=d(B,A,v,l,x)*x;x=0;for(u=v;1<=u;u--)y=Number((l-(u-.5)*C).toFixed(6)),z.push({minValue:B,maxValue:y,label:t(B,y,k)}),B=y,x++;u=Number((l+.5*C).toFixed(6));z.push({minValue:B,maxValue:u,label:t(B,u,k)});B=u;x++;for(y=1;y<=v;y++)u=x===2*v?A:Number((l+(y+.5)*C).toFixed(6)),z.push({minValue:B,maxValue:u,label:t(B,u,k)}),B=u,x++}else if("defined-interval"===q){if(!p)return z;v=C[0];A=C[C.length-1];C=Math.ceil((A-
v)/p);B=v;for(l=1;l<C;l++)x=Number((v+l*p).toFixed(6)),z.push({minValue:B,maxValue:x,label:t(B,x,k)}),B=x;z.push({minValue:B,maxValue:A,label:t(B,A,k)})}return z}function t(l,v,q){let k=null;return k=l===v?q&&"percent-of-total"===q?l+"%":l.toString():q&&"percent-of-total"===q?l+"% - "+v+"%":l+" - "+v}function n(l){const v=[],q=[];let k=Number.MIN_VALUE,p=1,z=-1;for(let C=0;C<l.length;C++){const B=l[C];B===k?(p++,q[z]=p):null!==B&&(v.push(B),k=B,p=1,q.push(p),z++)}return{uniqueValues:v,valueFrequency:q}}
function r(l,v,q){var k=l.length;const p=[];q>k&&(q=k);for(var z=0;z<q;z++)p.push(Math.round(z*k/q-1));p.push(k-1);z=m(p,l,v,q);k=z.mean;z=z.sdcm;var C=q,B=0,A=0;let x=0,u=0,y=!0;for(let D=0;2>D&&y;D++){0===D&&(y=!1);for(var w=0;w<C-1;w++)for(;p[w+1]+1!==p[w+2];)if(p[w+1]+=1,B=g(w,p,l,v),x=B.sbMean,B=B.sbSdcm,A=g(w+1,p,l,v),u=A.sbMean,A=A.sbSdcm,B+A<z[w]+z[w+1])z[w]=B,z[w+1]=A,k[w]=x,k[w+1]=u,y=!0;else{--p[w+1];break}for(w=C-1;0<w;w--)for(;p[w]!==p[w-1]+1;)if(--p[w],B=g(w-1,p,l,v),x=B.sbMean,B=B.sbSdcm,
A=g(w,p,l,v),u=A.sbMean,A=A.sbSdcm,B+A<z[w-1]+z[w])z[w-1]=B,z[w]=A,k[w-1]=x,k[w]=u,y=!0;else{p[w]+=1;break}}y&&(z=m(p,l,v,q));return p}function m(l,v,q,k){let p=[];var z=[],C=[];let B=0;const A=[],x=[];for(var u=0;u<k;u++){var y=g(u,l,v,q);A.push(y.sbMean);x.push(y.sbSdcm);B+=x[u]}y=B;for(u=!0;u||B<y;){u=!1;p=[];for(z=0;z<k;z++)p.push(l[z]);for(C=0;C<k;C++)for(y=l[C]+1;y<=l[C+1];y++)if(z=v[y],0<C&&y!==l[C+1]&&Math.abs(z-A[C])>Math.abs(z-A[C-1]))l[C]=y;else if(C<k-1&&l[C]!==y-1&&Math.abs(z-A[C])>Math.abs(z-
A[C+1])){l[C+1]=y-1;break}y=B;B=0;z=[];C=[];for(let w=0;w<k;w++){z.push(A[w]);C.push(x[w]);const D=g(w,l,v,q);A[w]=D.sbMean;x[w]=D.sbSdcm;B+=x[w]}}if(B>y){for(v=0;v<k;v++)l[v]=p[v],A[v]=z[v],x[v]=C[v];B=y}return{mean:A,sdcm:x}}function d(l,v,q,k,p){l=Math.max(k-l,v-k)/p/q;return 1<=l?1:.5<=l?.5:.25}function f(l){let v=0;for(let q=0;q<l.length;q++)v+=l[q];return v/=l.length}function e(l,v){let q=0;for(let k=0;k<l.length;k++){const p=l[k];q+=(p-v)*(p-v)}q/=l.length;return Math.sqrt(q)}function g(l,
v,q,k){var p=0,z=0;for(var C=v[l]+1;C<=v[l+1];C++){const B=k[C];p+=q[C]*B;z+=B}0>=z&&h.warn("Exception in Natural Breaks calculation");p/=z;z=0;for(C=v[l]+1;C<=v[l+1];C++)z+=k[C]*(q[C]-p)**2;return{sbMean:p,sbSdcm:z}}const h=c.getLogger("esri.rest.support.generateRendererUtils");a.createGenerateRendererClassBreaks=function(l){const {normalizationTotal:v}=l;return{classBreaks:b(l),normalizationTotal:v}};a.createGenerateRendererUniqueValues=function(l){l=n(l);const v=[],q=l.uniqueValues.length;for(let k=
0;k<q;k++){const p=l.uniqueValues[k];v.push({value:p,count:l.valueFrequency[k],label:p.toString()})}return{uniqueValues:v}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/utils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/jsonMap ../../../core/maybe ../../../core/unitUtils ../../../geometry/projection ../../../geometry/support/extentUtils ../../../geometry/support/jsonUtils ../../../geometry/support/normalizeUtils ../../../geometry/support/spatialReferenceUtils ../featureConversionUtils ../OptimizedGeometry ./projectionSupport".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){function q(){q=b._asyncToGenerator(function*(J,M,N){const {outFields:P,orderByFields:I,groupByFieldsForStatistics:G,outStatistics:H}=J;if(P)for(var L=0;L<P.length;L++)P[L]=P[L].trim();if(I)for(L=0;L<I.length;L++)I[L]=I[L].trim();if(G)for(L=0;L<G.length;L++)G[L]=G[L].trim();if(H)for(L=0;L<H.length;L++)H[L].onStatisticField&&(H[L].onStatisticField=H[L].onStatisticField.trim());J.geometry&&!J.outSR&&(J.outSR=J.geometry.spatialReference);return k(J,M,N)});return q.apply(this,
arguments)}function k(J,M,N){return p.apply(this,arguments)}function p(){p=b._asyncToGenerator(function*(J,M,N){if(!J)return null;var {where:P}=J;J.where=P=P&&P.trim();if(!P||/^1 *= *1$/.test(P)||M&&M===P)J.where=null;if(!J.geometry)return J;M=yield C(J);J.distance=0;J.units=null;"esriSpatialRelEnvelopeIntersects"===J.spatialRel&&({spatialReference:P}=J.geometry,M=d.getGeometryExtent(M),M.spatialReference=P);if(M){yield v.checkProjectionSupport(M.spatialReference,N);P=M.spatialReference;M=z(M,N)&&
f.isExtent(M)?{spatialReference:P,rings:[[[M.xmin,M.ymin],[M.xmin,M.ymax],[M.xmax,M.ymax],[M.xmax,M.ymin],[M.xmin,M.ymin]]]}:M;P=(yield e.normalizeCentralMeridian(f.fromJSON(M)))[0];if(n.isNone(P))throw y;const I="quantizationParameters"in J&&J.quantizationParameters?.tolerance||"maxAllowableOffset"in J&&J.maxAllowableOffset||0;M=I&&z(M,N)?{densificationStep:8*I}:void 0;P=P.toJSON();M=yield v.project(P,P.spatialReference,N,M);if(!M)throw y;M.spatialReference=N;J.geometry=M}return J});return p.apply(this,
arguments)}function z(J,M){if(!J)return!1;const N=J.spatialReference;return(f.isExtent(J)||f.isPolygon(J)||f.isPolyline(J))&&!g.equals(N,M)&&!m.canProjectWithoutEngine(N,M)}function C(J){return B.apply(this,arguments)}function B(){B=b._asyncToGenerator(function*(J){const {distance:M,units:N}=J,P=J.geometry;if(null==M||"vertexAttributes"in P)return P;var I=P.spatialReference;J=N?u.fromJSON(N):r.getUnitString(I);I=I&&(g.isGeographic(I)||g.isWebMercator(I))?P:yield v.checkProjectionSupport(I,g.WGS84).then(()=>
v.project(P,g.WGS84));return(yield A())(I.spatialReference,I,M,J)});return B.apply(this,arguments)}function A(){return x.apply(this,arguments)}function x(){x=b._asyncToGenerator(function*(){return(yield new Promise((J,M)=>a(["../../../geometry/geometryEngineJSON"],J,M))).geodesicBuffer});return x.apply(this,arguments)}const u=new t.JSONMap({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),
y=Object.freeze({}),w=new l,D=new l,F=new l,E={esriGeometryPoint:h.convertToPoint,esriGeometryPolyline:h.convertToPolyline,esriGeometryPolygon:h.convertToPolygon,esriGeometryMultipoint:h.convertToMultipoint},K=(J,M)=>"_geVersion"!==J?M:void 0;c.QUERY_ENGINE_EMPTY_RESULT=y;c.cleanFromGeometryEngine=function(J){return J&&"_geVersion"in J?JSON.parse(JSON.stringify(J,K)):J};c.getGeometry=function(J,M,N,P,I,G,H=M,L=N){const O=M&&H,S=N&&L;P=n.isSome(P)?"coords"in P?P:P.geometry:null;if(n.isNone(P))return null;
if(I)return M=h.generalizeOptimizedGeometry(D,P,M,N,J,I,H,L),G&&(M=h.quantizeOptimizedGeometry(F,M,O,S,J,G)),E[J]?.(M,O,S)??null;if(G)return G=h.quantizeOptimizedGeometry(F,P,M,N,J,G,H,L),E[J]?.(G,O,S)??null;h.removeZMValues(w,P,M,N,H,L);return E[J]?.(w,O,S)??null};c.normalizeQuery=function(J,M,N){return q.apply(this,arguments)};c.normalizeQueryLike=k;c.transformCentroid=function(J,M,N,P=J.hasZ,I=J.hasM){if(n.isNone(M))return null;const G=J.hasZ&&P,H=J.hasM&&I;return N?(J=h.quantizeOptimizedGeometry(F,
M,J.hasZ,J.hasM,"esriGeometryPoint",N,P,I),h.convertToPoint(J,G,H)):h.convertToPoint(M,G,H)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/spatialQuerySupport":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../geometry/support/contains ../../../geometry/support/intersects ../../../geometry/support/jsonUtils ../../../geometry/support/spatialReferenceUtils ../contains ../featureConversionUtils ../OptimizedGeometry ./projectionSupport ./utils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){function v(){return new Promise((z,C)=>a(["../../../geometry/geometryEngineJSON"],z,C))}function q(){q=b._asyncToGenerator(function*(z,C,B){const {spatialRel:A,geometry:x}=z;if(x){if(null==A||!0!==p.spatialRelationship[A])throw new t("feature-store:unsupported-query","Unsupported query spatial relationship",{query:z});if(d.isValid(x.spatialReference)&&d.isValid(B)){if(null==x||!0!==p.queryGeometry[m.getJsonType(x)])throw new t("feature-store:unsupported-query",
"Unsupported query geometry type",{query:z});if(null==C||!0!==p.layerGeometry[C])throw new t("feature-store:unsupported-query","Unsupported layer geometry type",{query:z});if(z.outSR)return h.checkProjectionSupport(z.geometry&&z.geometry.spatialReference,z.outSR)}}});return q.apply(this,arguments)}const k={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,
esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},p={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,
esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}};c.canQueryWithRBush=function(z){if(m.isExtent(z))return!0;if(m.isPolygon(z)){for(const C of z.rings)if(5!==C.length||C[0][0]!==C[1][0]||C[0][0]!==C[4][0]||C[2][0]!==C[3][0]||C[0][1]!==C[3][1]||C[0][1]!==C[4][1]||C[1][1]!==C[2][1])return!1;return!0}return!1};c.checkSpatialQuerySupport=function(z,C,B){return q.apply(this,
arguments)};c.getSpatialQueryOperator=function(z,C,B,A,x){if(m.isPolygon(C)&&"esriGeometryPoint"===B&&("esriSpatialRelIntersects"===z||"esriSpatialRelContains"===z)){const u=e.convertFromPolygon(new g,C,!1,!1);return Promise.resolve(y=>f.polygonContainsPoint(u,!1,!1,y))}if(m.isPolygon(C)&&"esriGeometryMultipoint"===B){const u=e.convertFromPolygon(new g,C,!1,!1);if("esriSpatialRelContains"===z)return Promise.resolve(y=>f.polygonContainsMultipoint(u,!1,!1,y,A,x))}if(m.isExtent(C)&&"esriGeometryPoint"===
B&&("esriSpatialRelIntersects"===z||"esriSpatialRelContains"===z))return Promise.resolve(u=>n.extentContainsPoint(C,l.getGeometry(B,A,x,u)));if(m.isExtent(C)&&"esriGeometryMultipoint"===B&&"esriSpatialRelContains"===z)return Promise.resolve(u=>n.extentContainsMultipoint(C,l.getGeometry(B,A,x,u)));if(m.isExtent(C)&&"esriSpatialRelIntersects"===z){const u=r.getExtentIntersector(B);return Promise.resolve(y=>u(C,l.getGeometry(B,A,x,y)))}return v().then(u=>{const y=u[k[z]].bind(null,C.spatialReference,
C);return w=>y(l.getGeometry(B,A,x,w))})};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/intersects":function(){define(["exports","./intersectsBase"],function(a,c){a.extentIntersectsExtent=c.extentIntersectsExtent;a.extentIntersectsMultipoint=c.extentIntersectsMultipoint;a.extentIntersectsPoint=c.extentIntersectsPoint;a.extentIntersectsPolygon=c.extentIntersectsPolygon;a.extentIntersectsPolyline=c.extentIntersectsPolyline;a.extentIntersectsRings=c.extentIntersectsRings;
a.getFeatureExtentIntersector=c.getFeatureExtentIntersector;a.isSelfIntersecting=c.isSelfIntersecting;a.segmentIntersects=c.segmentIntersects;a.getExtentIntersector=function(b){return"mesh"===b?c.extentIntersectsExtent:c.getFeatureExtentIntersector(b)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/contains":function(){define(["exports"],function(a){function c(b,t,n,r,m){if(!b)return!1;t=t?n?4:3:n?3:2;const {coords:d,lengths:f}=b;n=!1;b=0;for(const g of f){var e=
b;for(let h=b,l=b+g*t;h<l;h+=t){e=h+t;e===l&&(e=b);const v=d[h],q=d[h+1],k=d[e];e=d[e+1];(q<m&&e>=m||e<m&&q>=m)&&v+(m-q)/(e-q)*(k-v)<r&&(n=!n)}b+=g*t}return n}a.polygonContainsCoords=c;a.polygonContainsMultipoint=function(b,t,n,r,m,d){m=m?d?4:3:d?3:2;const {coords:f,lengths:e}=r;if(!e)return!1;for(let g=0,h=0;g<e.length;g++,h+=m)if(!c(b,t,n,f[h],f[h+1]))return!1;return!0};a.polygonContainsPoint=function(b,t,n,r){return c(b,t,n,r.coords[0],r.coords[1])};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/graphics/data/timeSupport":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,c){function b(){b=c._asyncToGenerator(function*(m,d){if(!m)return null;const f=d.featureAdapter,{startTimeField:e,endTimeField:g}=m;let h=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(e&&g)yield d.forEach(v=>{const q=f.getAttribute(v,e);v=f.getAttribute(v,g);null==q||isNaN(q)||(h=Math.min(h,q));null==v||isNaN(v)||(l=Math.max(l,v))});else{const v=e||g;yield d.forEach(q=>
{q=f.getAttribute(q,v);null==q||isNaN(q)||(h=Math.min(h,q),l=Math.max(l,q))})}return{start:h,end:l}});return b.apply(this,arguments)}function t(m,d,f,e,g){if(null!=e&&null!=g)return h=>{const l=m.getAttribute(h,d);h=m.getAttribute(h,f);return(null==l||l<=g)&&(null==h||h>=e)};if(null!=e)return h=>{h=m.getAttribute(h,f);return null==h||h>=e};if(null!=g)return h=>{h=m.getAttribute(h,d);return null==h||h<=g}}function n(m,d,f,e){if(null!=f&&null!=e&&f===e)return g=>m.getAttribute(g,d)===f;if(null!=f&&
null!=e)return g=>{g=m.getAttribute(g,d);return g>=f&&g<=e};if(null!=f)return g=>m.getAttribute(g,d)>=f;if(null!=e)return g=>m.getAttribute(g,d)<=e}function r(){return()=>!1}a.getTimeExtent=function(m,d){return b.apply(this,arguments)};a.getTimeOperator=function(m,d,f){if(!d||!m)return null;const {startTimeField:e,endTimeField:g}=m;if(!e&&!g)return null;const {start:h,end:l}=d;return null===h&&null===l?null:void 0===h&&void 0===l?r():e&&g?t(f,e,g,h,l):n(f,e||g,h,l)};Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/graphics/queryForSymbologySnapping":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils","../../../../support/arcadeOnDemand"],function(a,c,b,t,n){function r(){r=c._asyncToGenerator(function*(d,f,e){if(b.isNone(d)||0===f.candidates.length)return m;var g=d.graphics3DGraphicsByObjectID??d.graphics3DGraphics,h=[];const l=[],{renderer:v}=d,q=b.isSome(v)&&"arcadeRequired"in v&&v.arcadeRequired?
n.loadArcade():null;var k=function(){var A=c._asyncToGenerator(function*(x,{graphic:u,graphics3DSymbol:y}){const w=yield q;u=yield d.getRenderingInfoAsync(u,v,w,{signal:e});return b.isNone(u)?[]:y.queryForSnapping(x,z,u,e)});return function(x,u){return A.apply(this,arguments)}}();const {candidates:p,spatialReference:z}=f;for(f=0;f<p.length;++f){var C=p[f],{objectId:B}=C;B="number"===typeof B?g?.get(B):void 0;if(b.isNone(B))continue;const {graphics3DSymbol:A}=B;A.symbologySnappingSupported&&(h.push(k(C,
B)),l.push(f))}if(0===h.length)return m;g=yield Promise.all(h);t.throwIfAborted(e);h=[];k=[];for(f=0;f<g.length;++f){C=g[f];B=l[f];for(const A of C)h.push(A),k.push(B)}return{candidates:h,sourceCandidateIndices:k}});return r.apply(this,arguments)}const m={candidates:[],sourceCandidateIndices:[]};a.queryForSymbologySnapping=function(d,f,e){return r.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/HeatmapFeatureProcessor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/byteSizeEstimations ../../../../core/HandleOwner ../../../../core/handleUtils ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/scaleUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ../../../../layers/graphics/OptimizedFeature ../../../../layers/graphics/OptimizedGeometry ../../../../layers/graphics/data/FeatureStore ../../../../layers/support/fieldUtils ../../../../renderers/support/heatmapUtils ../interfaces ./FeatureVisibilityFilter ../../terrain/OverlayRenderer ../../webgl-engine/lib/Attribute ../../webgl-engine/lib/ContentObjectType ../../webgl-engine/lib/DrapedHeatmapRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/ModelDirtyTypes ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/UpdatePolicy ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HeatmapDensityMaterial ../../../support/layerViewUtils ../../../webgl/enums ../../../webgl/heatmapTextureUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R){const Q=m.getLogger("esri.views.3d.layers.support.HeatmapFeatureProcessor");a.HeatmapFeatureProcessor=function(aa){function X(T){T=aa.call(this,T)||this;T.type="heatmap";T.preferredUpdatePolicy=G.UpdatePolicy.ASYNC;T.dataExtent=null;T.drapeSourceType=D.DrapeSourceType.Features;T._renderGeometries=new Map;T._fieldTotal=0;T._drapeSourceRenderer=null;T._dataType=S.PixelType.HALF_FLOAT;T._pixelFormat=S.PixelFormat.RGBA;
T.initializePromise=Promise.resolve();return T}c._inheritsLoose(X,aa);var W=X.prototype;W.initialize=function(){this._featureStore=new u({geometryType:"esriGeometryPoint",hasZ:this.hasZ,hasM:this.hasM});const {dataType:T,samplingMode:U,pixelFormat:Y,internalFormat:ba}=R.loadHeatmapTextureConfiguration(this._renderView.renderingContext,Q);this._dataType=T;this._pixelFormat=Y;const da=T!==S.PixelType.FLOAT;this._drapeSourceRenderer=this.view.basemapTerrain.overlayManager.registerDrapeSource(this,M.DrapedHeatmapRenderer,
{...this._rendererParameters,dataType:T,samplingMode:U,pixelFormat:Y,internalFormat:ba});this._material=new L.HeatmapDensityMaterial({usesHalfFloats:da});this._materialWithField=new L.HeatmapDensityMaterial({usesHalfFloats:da,isAttributeDriven:!0});this._filterVisibility=new F.FeatureVisibilityFilter({context:{layerView:this.owner,featureStore:this.featureStore,getFeatureCount:()=>this._loadedPointGraphics.length,setAllFeaturesVisibility:ea=>this._setAllFeaturesVisibility(ea),clearFeaturesVisibility:()=>
this._setAllFeaturesVisibility(!0),updateFeatureVisibilities:ea=>this._updateFeatureVisibilities(ea)}});this.updatingHandles.addOnCollectionChange(()=>this._loadedPointGraphics,ea=>this._onLoadedFeaturesChange(ea),f.initial);this.updatingHandles.addWhen(()=>this._materialParameters,ea=>this._forEachMaterial(ca=>ca.setParameters(ea)),f.initial);this.updatingHandles.add(()=>this._rendererParameters,ea=>this._drapeSourceRenderer.set(ea));this.updatingHandles.add(()=>this._heatmapRendererField,()=>{this._recreate()},
f.sync);this.updatingHandles.add(()=>({fieldName:this._heatmapRendererFieldName,numeric:this._heatmapRendererFieldIsNumeric}),({fieldName:ea,numeric:ca})=>{if(d.isSome(ea)&&ca){let ja=0;this._featureStore.forEach(ia=>ja+=ia.attributes[ea]??0);this._fieldTotal=ja}else this._fieldTotal=this._featureStore.numFeatures},f.initial);this.handles.add([f.watch(()=>({fieldName:this._heatmapRendererFieldName,field:this._heatmapRendererField}),({fieldName:ea,field:ca})=>{ea&&!ca&&Q.warn(`Heatmap renderer field '${ea}' for layer '${this.layer.title??
this.layer.id}' not found`)}),f.watch(()=>({field:this._heatmapRendererField,numeric:this._heatmapRendererFieldIsNumeric}),({field:ea,numeric:ca})=>{d.isSome(ea)&&!ca&&Q.warn(`Heatmap renderer field '${ea.name}' for layer '${this.layer.title??this.layer.id}' does not contain numeric values and cannot be used to drive the heatmap density`)}),r.makeHandle(()=>this.view.basemapTerrain.overlayManager.unregisterDrapeSource(this))])};W.destroy=function(){this._renderGeometries.clear();this._material=d.disposeMaybe(this._material);
this._materialWithField=d.disposeMaybe(this._materialWithField);this._featureStore.clear();this._featureStore=null};W.whenGraphicBounds=function(){var T=c._asyncToGenerator(function*(){return null});return function(){return T.apply(this,arguments)}}();W.computeAttachmentOrigin=function(){return null};W.highlight=function(){return V};W.maskOccludee=function(){return V};W.setObjectIdVisibility=function(){};W.refreshFilter=function(){this.filterVisibility.reapply()};W._onLoadedFeaturesChange=function(T){if(this._featuresArePoints){var {objectIdField:U}=
this.layer;this._featureStore.removeManyById(T.removed.map(ba=>C.getObjectId(ba,U)));this._featureStore.addMany(T.added.map(ba=>{const da=new A.OptimizedFeature(B.convertFromPoint(new x,ba.geometry),ba.attributes,d.applySome(ba.centroid,ea=>B.convertFromPoint(new x,ea)),C.getObjectId(ba,U));da.displayId=ba.uid;return da}));var Y=T.added;T=T.removed;this._fieldTotal+=this._computeFieldTotalChange(Y,T);T=d.mapSome(T,({uid:ba})=>{const da=this._renderGeometries.get(ba);this._renderGeometries.delete(ba);
return da});Y=Y.map(ba=>{const da=this._pointGraphicToRenderGeometry(ba);this._renderGeometries.set(ba.uid,da);return da});0<T.length&&this._drapeSourceRenderer.removeGeometries(T,P.DirtyOperation.REMOVE);0<Y.length&&this._drapeSourceRenderer.addGeometries(Y,P.DirtyOperation.ADD);if(0<Y.length||0<T.length)this.filterVisibility.reapply(),this._renderView.requestRender()}};W._recreate=function(){if(this._loadedPointGraphics){var T=this._loadedPointGraphics.toArray();this._onLoadedFeaturesChange({added:T,
removed:T})}};W._pointGraphicToRenderGeometry=function(T){const U=this._heatmapRendererFieldName,Y=d.isSome(U)?this._materialWithField:this._material,ba=k.create();p.projectPointToVector(T.geometry,ba,this._overlaySpatialReference);ba[2]=E.DRAPED_Z;const da=[[H.VertexAttribute.POSITION,new K.Attribute(ba,ba.length)]],ea=this._heatmapRendererFieldIsNumeric;d.isSome(U)&&da.push([H.VertexAttribute.FEATUREATTRIBUTE,new K.Attribute([ea?T.attributes[U]??0:0],1)]);T=new I.RenderGeometry(new N.Geometry(Y,
da,null,null,J.ContentObjectType.Point),{layerUid:this.layer.uid,graphicUid:T.uid});q.copy(T.boundingSphere,ba);T.visible=this.filterVisibility.defaultVisibility;return T};W._forEachMaterial=function(T){T(this._material);T(this._materialWithField)};W._computeFieldTotalChange=function(T,U){if(d.isNone(this._heatmapRendererFieldName)||!this._heatmapRendererFieldIsNumeric)return T.length-U.length;const Y=this._heatmapRendererFieldName,ba=(da,ea)=>da+(ea.attributes[Y]??0);return T.reduce(ba,0)-U.reduce(ba,
0)};W._clampSearchRadius=function(T){112<T&&Q.warnOnce("SceneView supports a maximum radius of 112 pt for HeatmapRenderer.");return Math.min(T,112)};W._updateFeatureVisibilities=function(T){const U=[];this._featureStore.forEach(({objectId:Y,displayId:ba})=>{Y=T(Y);(ba=this._renderGeometries.get(ba))&&ba.visible!==Y&&(U.push(ba),ba.visible=Y)});this._drapeSourceRenderer.modifyGeometries(U,P.DirtyState.VISIBILITY)};W._setAllFeaturesVisibility=function(T){const U=[];for(const Y of this._renderGeometries.values())Y.visible!==
T&&(U.push(Y),Y.visible=T);this._drapeSourceRenderer.modifyGeometries(U,P.DirtyState.VISIBILITY)};c._createClass(X,[{key:"layer",get:function(){return this.owner.layer}},{key:"featureStore",get:function(){return this._featureStore}},{key:"updating",get:function(){return this.updatingHandles.updating||this.filterVisibility.updating}},{key:"updatingRemaining",get:function(){return 0}},{key:"suspendInfo",get:function(){return{}}},{key:"legendEnabled",get:function(){return!0}},{key:"filterVisibility",
get:function(){return this._filterVisibility}},{key:"displayFeatureLimit",get:function(){var T=this.owner?.view?.resourceController?.memoryController?.memoryFactor??1;const U=this.owner?.view?.qualitySettings;T=U?Math.ceil(U.heatmap.maxTotalNumberOfFeatures*T):0;return{minimumTotalNumberOfFeatures:0,maximumTotalNumberOfFeatures:T,maximumTotalNumberOfPrimitives:2*T,maximumNumberOfFeatures:T}}},{key:"hasZ",get:function(){return"hasZ"in this.layer&&this.layer.hasZ}},{key:"hasM",get:function(){return"hasM"in
this.layer&&this.layer.hasM}},{key:"view",get:function(){return this.owner.view}},{key:"fullOpacity",get:function(){return this.owner.fullOpacity}},{key:"updatePolicy",get:function(){return this.owner.updatePolicy}},{key:"scaleVisibilitySuspended",get:function(){if(!this._isScaleRangeActive)return!1;const {minScale:T,maxScale:U}=this.layer.effectiveScaleRange,{scale:Y}=this.view;return!O.scaleBoundsPredicate(Y,T??0,U??0)}},{key:"usedMemory",get:function(){const T=Math.ceil((this._overlayRenderer?.overlays[0]?.resolution??
0)*this._densityMapPixelRatio)??0;return T*T*(this._pixelFormat===S.PixelFormat.RED?1:4)*(this._dataType===S.PixelType.FLOAT?4:2)+this.usedMemoryPerFeature*this._featureStore.numFeatures}},{key:"usedMemoryPerFeature",get:function(){var T=this._loadedPointGraphics.find(()=>!0);if(d.isNone(T))return 0;T=t.estimateAttributesObjectSize(T);const U=t.estimateNumberByteSize(),Y=6*t.estimateFixedArraySize([0,0,0],U),ba=6*t.estimateFixedArraySize([0,0],U);return Y+ba+(this._heatmapRendererFieldIsNumeric?6*
U:0)+T}},{key:"loadedFeatures",get:function(){return this._featureStore.numFeatures}},{key:"unprocessedMemoryEstimate",get:function(){return 0}},{key:"performanceInfo",get:function(){return{core:{visible:this._visibleFeatures,missing:0,pending:0},elevationUpdating:!1,visibilityFrustum:!0,visibilityScale:!0}}},{key:"renderer",get:function(){return this._heatmapRenderer}},{key:"_overlayRenderer",get:function(){return this.view.basemapTerrain.overlayManager.renderer}},{key:"_overlaySpatialReference",
get:function(){return d.unwrap(this._overlayRenderer.spatialReference)}},{key:"_rendererParameters",get:function(){return{...this._radiusParameter,...this._densityParameters,...this._colorRampParameter,...this._pixelRatioParameter}}},{key:"_materialParameters",get:function(){return{...this._radiusParameter,...this._resolutionForScaleParameter}}},{key:"_densityParameters",get:function(){const T=this._heatmapRenderer;if(d.isNone(T))return null;const {minDensity:U,maxDensity:Y}=T;return{minDensity:U,
maxDensity:Y,fieldTotal:this._fieldTotal}}},{key:"_radiusParameter",get:function(){return d.applySome(this._heatmapRenderer,({radius:T})=>({searchRadius:e.pt2px(this._clampSearchRadius(T))}))}},{key:"_resolutionForScaleParameter",get:function(){return d.applySome(this._heatmapRenderer,({referenceScale:T})=>({resolutionForScale:0===T?0:z.getResolutionForScale(T,this.view.spatialReference)}))}},{key:"_colorRampParameter",get:function(){return d.applySome(this._heatmapRenderer,T=>({colorRampData:w.generateGradient(T.colorStops)}))}},
{key:"_pixelRatioParameter",get:function(){return{pixelRatio:this._densityMapPixelRatio}}},{key:"_densityMapPixelRatio",get:function(){return(this.owner?.view?.qualitySettings.heatmap.pixelRatio??1)*Math.sqrt(this.owner?.view?.resourceController?.memoryController?.memoryFactor??1)}},{key:"_renderView",get:function(){return this.view._stage.renderView}},{key:"_featuresArePoints",get:function(){return"point"===this.layer.geometryType}},{key:"_loadedPointGraphics",get:function(){return this.owner.loadedGraphics}},
{key:"_heatmapRenderer",get:function(){const T=this.layer.renderer;return"heatmap"===T?.type?T:null}},{key:"_heatmapRendererFieldName",get:function(){return d.applySome(this._heatmapRenderer,T=>T.field)}},{key:"_heatmapRendererField",get:function(){return d.applySome(this._heatmapRendererFieldName,T=>this.layer.fieldsIndex.get(T))}},{key:"_heatmapRendererFieldIsNumeric",get:function(){const T=this._heatmapRendererField;return d.isNone(T)?!1:y.isNumericField(T)}},{key:"_isScaleRangeActive",get:function(){const {layer:T}=
this;if(!("effectiveScaleRange"in T))return!1;const {minScale:U,maxScale:Y}=T.effectiveScaleRange;return O.isScaleRangeActive(U,Y)}},{key:"_visibleFeatures",get:function(){let T=0;this._renderGeometries.forEach(U=>{U.visible&&++T});return T}},{key:"test",get:function(){return{visibleFeatureCount:this._visibleFeatures}}}]);return X}(n.HandleOwner);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"type",void 0);b.__decorate([g.property({constructOnly:!0})],a.HeatmapFeatureProcessor.prototype,
"owner",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"layer",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"featureStore",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"updating",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"updatingRemaining",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"suspendInfo",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"legendEnabled",
null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"filterVisibility",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"displayFeatureLimit",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"preferredUpdatePolicy",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"hasZ",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"hasM",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,
"dataExtent",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"view",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"fullOpacity",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"updatePolicy",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"drapeSourceType",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"scaleVisibilitySuspended",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,
"renderer",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_featureStore",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_filterVisibility",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_overlayRenderer",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_overlaySpatialReference",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_rendererParameters",null);b.__decorate([g.property()],
a.HeatmapFeatureProcessor.prototype,"_materialParameters",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_densityParameters",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_radiusParameter",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_resolutionForScaleParameter",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_colorRampParameter",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,
"_pixelRatioParameter",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_densityMapPixelRatio",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_renderGeometries",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_material",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_materialWithField",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_renderView",null);b.__decorate([g.property()],
a.HeatmapFeatureProcessor.prototype,"_featuresArePoints",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_loadedPointGraphics",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRenderer",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererFieldName",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_heatmapRendererField",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,
"_heatmapRendererFieldIsNumeric",null);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_fieldTotal",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_drapeSourceRenderer",void 0);b.__decorate([g.property()],a.HeatmapFeatureProcessor.prototype,"_isScaleRangeActive",null);a.HeatmapFeatureProcessor=b.__decorate([v.subclass("esri.views.3d.layers.support.HeatmapFeatureProcessor")],a.HeatmapFeatureProcessor);const V=r.makeHandle();a.MAX_RADIUS_PT=112;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/data/FeatureStore":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./optimizedFeatureQueryEngineAdapter ./utils".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){const h=r.create();return function(){function l(q){this.geometryInfo=
q;this._boundsStore=new f.BoundsStore;this._featuresById=new Map;this._markedIds=new Set;this.events=new b;this.featureAdapter=e.optimizedFeatureQueryEngineAdapter}var v=l.prototype;v.getFullExtent=function(q){if(n.isNone(this.fullBounds))return null;const [k,p,z,C]=this.fullBounds;return{xmin:k,ymin:p,xmax:z,ymax:C,spatialReference:g.cleanFromGeometryEngine(q)}};v.add=function(q){this._add(q);this._emitChanged()};v.addMany=function(q){for(const k of q)this._add(k);this._emitChanged()};v.clear=function(){this._featuresById.clear();
this._boundsStore.clear();this._emitChanged()};v.removeById=function(q){q=this._featuresById.get(q);if(!q)return null;this._remove(q);this._emitChanged();return q};v.removeManyById=function(q){this._boundsStore.invalidateIndex();for(const k of q)(q=this._featuresById.get(k))&&this._remove(q);this._emitChanged()};v.forEachBounds=function(q,k){for(const p of q)(q=this._boundsStore.get(p.objectId))&&k(r.fromRect(h,q))};v.getFeature=function(q){return this._featuresById.get(q)};v.has=function(q){return this._featuresById.has(q)};
v.forEach=function(q){this._featuresById.forEach(k=>q(k))};v.forEachInBounds=function(q,k){this._boundsStore.forEachInBounds(q,p=>{k(this._featuresById.get(p))})};v.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex();this._markedIds.clear()};v.sweep=function(){let q=!1;this._featuresById.forEach((k,p)=>{this._markedIds.has(p)||(q=!0,this._remove(k))});this._markedIds.clear();q&&this._emitChanged()};v._emitChanged=function(){this.events.emit("changed",void 0)};v._add=function(q){if(q){var k=
q.objectId;if(null==k)t.getLogger("esri.layers.graphics.data.FeatureStore").error(new c("featurestore:invalid-feature","feature id is missing",{feature:q}));else{var p=this._featuresById.get(k);this._markedIds.add(k);if(p){q.displayId=p.displayId;var z=this._boundsStore.get(k);this._boundsStore.delete(k)}else if(n.isSome(this.onFeatureAdd))this.onFeatureAdd(q);!n.isNone(q.geometry)&&q.geometry.coords&&q.geometry.coords.length?(z=d.getBoundsOptimizedGeometry(n.isSome(z)?z:m.create(),q.geometry,this.geometryInfo.hasZ,
this.geometryInfo.hasM),n.isSome(z)&&this._boundsStore.set(k,z)):this._boundsStore.set(k,null);this._featuresById.set(k,q)}}};v._remove=function(q){if(n.isSome(this.onFeatureRemove))this.onFeatureRemove(q);const k=q.objectId;this._markedIds.delete(k);this._boundsStore.delete(k);this._featuresById.delete(k);return q};a._createClass(l,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},
{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){return this._boundsStore.fullBounds}},{key:"storeStatistics",get:function(){let q=0;this._featuresById.forEach(k=>{n.isSome(k.geometry)&&k.geometry.coords&&(q+=k.geometry.coords.length)});return{featureCount:this._featuresById.size,vertexCount:q/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}}]);return l}()})},"esri/layers/graphics/data/BoundsStore":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../core/has","../../../core/libs/rbush/PooledRBush","../../../geometry/support/aaBoundingRect"],function(a,c,b,t,n){function r(f,e,g){m.minX=e[0];m.minY=e[1];m.maxX=e[2];m.maxY=e[3];f.search(m,g)}const m={minX:0,minY:0,maxX:0,maxY:0};let d=function(){function f(){this._indexInvalid=!1;this._boundsToLoad=[];this._boundsById=new Map;this._idByBounds=new Map;this._index=new t.PooledRBush(9,b("esri-csp-restrictions")?g=>({minX:g[0],minY:g[1],maxX:g[2],maxY:g[3]}):["[0]","[1]","[2]","[3]"]);this._loadIndex=
()=>{if(this._indexInvalid){const g=Array(this._idByBounds.size);let h=0;this._idByBounds.forEach((l,v)=>{g[h++]=v});this._indexInvalid=!1;this._index.clear();this._index.load(g)}else this._boundsToLoad.length&&(this._index.load(Array.from(new Set(this._boundsToLoad.filter(g=>this._idByBounds.has(g))))),this._boundsToLoad.length=0)}}var e=f.prototype;e.clear=function(){this._indexInvalid=!1;this._boundsToLoad.length=0;this._boundsById.clear();this._idByBounds.clear();this._index.clear()};e.delete=
function(g){const h=this._boundsById.get(g);this._boundsById.delete(g);h&&(this._idByBounds.delete(h),this._indexInvalid||this._index.remove(h))};e.forEachInBounds=function(g,h){this._loadIndex();r(this._index,g,l=>h(this._idByBounds.get(l)))};e.get=function(g){return this._boundsById.get(g)};e.has=function(g){return this._boundsById.has(g)};e.invalidateIndex=function(){this._indexInvalid||(this._indexInvalid=!0,this._boundsToLoad.length=0)};e.set=function(g,h){if(!this._indexInvalid){const l=this._boundsById.get(g);
l&&(this._index.remove(l),this._idByBounds.delete(l))}this._boundsById.set(g,h);h&&(this._idByBounds.set(h,g),this._indexInvalid||(this._boundsToLoad.push(h),5E4<this._boundsToLoad.length&&this._loadIndex()))};c._createClass(f,[{key:"fullBounds",get:function(){if(!this._boundsById.size)return null;const g=n.empty();for(const h of this._boundsById.values())h&&(g[0]=Math.min(h[0],g[0]),g[1]=Math.min(h[1],g[1]),g[2]=Math.max(h[2],g[2]),g[3]=Math.max(h[3],g[3]));return g}},{key:"valid",get:function(){return!this._indexInvalid}}]);
return f}();a.BoundsStore=d;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/lib/DrapedHeatmapRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../ViewingMode ./glUtil3D ./SortedRenderGeometryRenderer ../shaders/HeatmapTechnique ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){a.DrapedHeatmapRenderer=function(z){function C(A){A=z.call(this,A)||this;A.pixelRatio=1;A._colorRampData=new Uint8ClampedArray(4);A.type="draped-heatmap";A._heatmapParameters=new l.HeatmapPassParameters;return A}c._inheritsLoose(C,z);var B=C.prototype;B.initialize=function(){this._densityMap=new q.FramebufferObject(this.rctx,{colorTarget:v.TargetType.TEXTURE,depthStencilTarget:v.DepthStencilTargetType.NONE,width:0,height:0},{target:v.TextureType.TEXTURE_2D,
pixelFormat:this.pixelFormat,internalFormat:this.internalFormat,dataType:this.dataType,samplingMode:this.samplingMode,wrapMode:v.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});this._quad=g.createQuadVAO(this.rctx);var A=this._colorRampData;this._colorRamp=new k.Texture(this.rctx,{target:v.TextureType.TEXTURE_2D,pixelFormat:v.PixelFormat.RGBA,dataType:v.PixelType.UNSIGNED_BYTE,samplingMode:v.TextureSamplingMode.LINEAR,wrapMode:v.TextureWrapMode.CLAMP_TO_EDGE,width:A.length/4,height:1},A);A=new l.HeatmapTechniqueConfiguration;
A.usesHalfFloat=this.dataType!==v.PixelType.FLOAT;this._technique=new l.HeatmapTechnique({rctx:this.rctx,viewingMode:e.ViewingMode.Local},A);this._heatmapParameters.densityMap=this._densityMap.colorTexture;this.addHandles(n.watch(()=>[this.colorRampData,this.minDensity,this.maxDensity,this.fieldTotal,this.pixelRatio,this.searchRadius],()=>this.rendererContext.notifyContentChanged()))};B.destroy=function(){this._technique=t.releaseMaybe(this._technique);this._densityMap=t.disposeMaybe(this._densityMap);
this._quad=t.disposeMaybe(this._quad);this._colorRamp=t.disposeMaybe(this._colorRamp)};B.render=function(A){const x=this._sortedMaterialRenderers;if(!(1>x.length)){var u=this.rctx.getBoundFramebufferObject(),y=this.rctx.getViewport(),w=A.bindParameters,{pixelRatio:D}=this,F=Math.ceil(y.width*D);D=Math.ceil(y.height*D);this._densityMap.resize(F,D);this.rctx.bindFramebuffer(this._densityMap);this.rctx.setViewport(0,0,F,D);this.rctx.clear(v.ClearBufferBit.COLOR_BUFFER_BIT);var E=!1;x.forAll(K=>{K.material.shouldRender(A)&&
(E=K.render(A.output,w)||E)});this.rctx.bindFramebuffer(u);this.rctx.setViewport(y.x,y.y,y.width,y.height);E&&(this.rctx.bindVAO(this._quad),this.rctx.bindTechnique(this._technique,this._heatmapParameters,A.bindParameters),this.rctx.drawArrays(this._technique.primitiveType,0,p.vertexCount(this._quad,"geometry")))}};c._createClass(C,[{key:"searchRadius",get:function(){return this._heatmapParameters.searchRadius},set:function(A){A!==this._heatmapParameters.searchRadius&&(this._heatmapParameters.searchRadius=
A,this.notifyChange("searchRadius"))}},{key:"minDensity",get:function(){return this._heatmapParameters.minDensity},set:function(A){A!==this._heatmapParameters.minDensity&&(this._heatmapParameters.minDensity=A,this.notifyChange("minDensity"))}},{key:"maxDensity",get:function(){return this._heatmapParameters.maxDensity},set:function(A){A!==this._heatmapParameters.maxDensity&&(this._heatmapParameters.maxDensity=A,this.notifyChange("maxDensity"))}},{key:"fieldTotal",get:function(){return this._heatmapParameters.fieldTotal},
set:function(A){this._heatmapParameters.fieldTotal=A;this.notifyChange("fieldTotal")}},{key:"colorRampData",get:function(){return this._colorRampData},set:function(A){const {colorRamp:x}=this._heatmapParameters;if(t.isSome(x)&&A!==this._colorRampData){const u=A.length/4;u!==x.descriptor.width&&x.resize(u,1);x.setData(A)}this._colorRampData=A}},{key:"_colorRamp",get:function(){return this._heatmapParameters.colorRamp},set:function(A){this._heatmapParameters.colorRamp=A}},{key:"hasHighlights",get:function(){return!1}},
{key:"hasWater",get:function(){return!1}},{key:"rendersOccluded",get:function(){return!1}}]);return C}(h.SortedRenderGeometryRenderer);b.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"searchRadius",null);b.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"minDensity",null);b.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"maxDensity",null);b.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"fieldTotal",null);b.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,
"pixelRatio",void 0);b.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"colorRampData",null);b.__decorate([r.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"dataType",void 0);b.__decorate([r.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"samplingMode",void 0);b.__decorate([r.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"pixelFormat",void 0);b.__decorate([r.property({constructOnly:!0})],a.DrapedHeatmapRenderer.prototype,"internalFormat",
void 0);b.__decorate([r.property()],a.DrapedHeatmapRenderer.prototype,"_colorRampData",void 0);a.DrapedHeatmapRenderer=b.__decorate([f.subclass("esri.views.3d.webgl-engine.lib.DrapedHeatmapRenderer")],a.DrapedHeatmapRenderer);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/Heatmap.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q){n=function(k){function p(){var z=k.apply(this,arguments)||this;z.colorRamp=null;z.densityMap=null;z.searchRadius=1;z.fieldTotal=0;z.minDensity=0;z.maxDensity=100;return z}b._inheritsLoose(p,k);return p}(n.NoParameters);m=function(k){function p(C,B){var A;return A=k.call(this,C,B,()=>A.destroy())||this}b._inheritsLoose(p,k);var z=p.prototype;z.initializeProgram=function(C){return new g.Program(C.rctx,p.shader.get().build(this.configuration),f.Default3D)};z.initializePipeline=
function(){return q.makePipelineState({blending:e.blendingDefault,colorWrite:q.defaultColorWriteParams,depthTest:null,depthWrite:null})};b._createClass(p,[{key:"primitiveType",get:function(){return v.PrimitiveType.TRIANGLE_STRIP}}]);return p}(m.ShaderTechnique);m.shader=new r.ReloadableShaderModule(l.HeatmapShader,()=>new Promise((k,p)=>a(["./Heatmap.glsl"],k,p)));r=function(k){function p(){var z=k.apply(this,arguments)||this;z.usesHalfFloat=!1;return z}b._inheritsLoose(p,k);return p}(h.DefaultTechniqueConfiguration);
t.__decorate([d.parameter()],r.prototype,"usesHalfFloat",void 0);c.HeatmapPassParameters=n;c.HeatmapTechnique=m;c.HeatmapTechniqueConfiguration=r;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/Heatmap.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,c,b,t,n,r,m){function d(e){const g=new r.ShaderBuilder;g.include(c.ScreenSpacePass);g.include(b.DiscardOrAdjustAlphaBlend);({usesHalfFloat:e}=e);g.fragment.uniforms.add([new m.Texture2DPassUniform("densityMap",h=>h.densityMap),new m.Texture2DPassUniform("tex",h=>h.colorRamp),new t.FloatPassUniform("densityNormalizer",h=>1/(h.maxDensity-h.minDensity)),new t.FloatPassUniform("minDensity",h=>h.minDensity)]);g.fragment.uniforms.add(new t.FloatPassUniform("densityMultiplier",h=>3/(h.searchRadius*
h.searchRadius*Math.PI)));e&&g.constants.add("compressionFactor","float",4);g.fragment.code.add(n.glsl`
    void main() {
      float density = texture2D(densityMap, uv).r * densityMultiplier${e?n.glsl` * compressionFactor`:""};
      float densityRatio = (density - minDensity) * densityNormalizer;

      vec4 color = texture2D(tex, vec2(clamp(densityRatio, 0.0, 1.0), 0.5));

      discardOrAdjustAlpha(color);
      gl_FragColor = color;
    }
  `);return g}const f=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}));a.HeatmapShader=f;a.build=d})},"esri/views/3d/webgl-engine/materials/HeatmapDensityMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutput ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/HeatmapDensityTechnique".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){let l=function(C){function B(){var A=C.apply(this,arguments)||this;A.isAttributeDriven=!1;A.usesHalfFloats=!1;return A}c._inheritsLoose(B,C);return B}(h.HeatmapDensityPassParameters);d=function(C){function B(x){x=C.call(this,x,new l)||this;x._configuration=new h.HeatmapDensityTechniqueConfiguration;return x}c._inheritsLoose(B,C);var A=B.prototype;A.requiresSlot=function(x,u){return x===f.RenderSlot.DRAPED_MATERIAL&&u===r.ShaderOutput.Color};A.getConfiguration=function(){this._configuration.isAttributeDriven=
this.parameters.isAttributeDriven;this._configuration.usesHalfFloat=this.parameters.usesHalfFloats;return this._configuration};A.createGLMaterial=function(x){return new v(x)};A.intersect=function(){};A.intersectDraped=function(x,u,y,w,D,F){u=x.vertexAttributes.get(e.VertexAttribute.POSITION);({parameters:y}=this);({searchRadius:y}=y);({screenToWorldRatio:x}=x);x=y*x+2*x;x*=x;y=u.data.length/u.size;for(let K=0;K<y;K++){var E=K*u.size;E=b.set(z,u.data[E],u.data[E+1]);b.squaredDistance(E,w)<x&&D(F.dist,
F.normal,-1,!1)}};A.createBufferWriter=function(){return new q(this.parameters.isAttributeDriven?p:k)};return B}(d.Material);let v=function(C){function B(){return C.apply(this,arguments)||this}c._inheritsLoose(B,C);B.prototype.beginSlot=function(A){return this.ensureTechnique(h.HeatmapDensityTechnique,A)};return B}(m),q=function(){function C(A){this.vertexBufferLayout=A}var B=C.prototype;B.allocate=function(A){return this.vertexBufferLayout.createBuffer(A)};B.elementCount=function(A){return 6*A.indices.get(e.VertexAttribute.POSITION).length};
B.write=function(A,x,u,y,w){g.writePosition(u.indices.get(e.VertexAttribute.POSITION),u.vertexAttributes.get(e.VertexAttribute.POSITION).data,A,y.position,w,6);A=u.indices.get(e.VertexAttribute.POSITION).length;x=y.uv0;let D=w;for(let F=0;F<A;++F)x.setValues(D++,-1,-1),x.setValues(D++,1,-1),x.setValues(D++,1,1),x.setValues(D++,1,1),x.setValues(D++,-1,1),x.setValues(D++,-1,-1);(y=e.VertexAttribute.FEATUREATTRIBUTE in y?y.featureAttribute:null)&&g.writeBufferFloat(u.indices.get(e.VertexAttribute.FEATUREATTRIBUTE),
u.vertexAttributes.get(e.VertexAttribute.FEATUREATTRIBUTE).data,y,w,6)};return C}();const k=n.newLayout().vec3f(e.VertexAttribute.POSITION).vec2f(e.VertexAttribute.UV0),p=k.clone().f32(e.VertexAttribute.FEATUREATTRIBUTE),z=t.create();a.HeatmapDensityMaterial=d;a.HeatmapDensityMaterialParameters=l;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/HeatmapDensityTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/Program ../materials/DefaultTechniqueConfiguration ../../../../chunks/HeatmapDensity.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){f=function(q){function k(){var p=q.apply(this,arguments)||this;p.searchRadius=128;p.resolutionForScale=0;return p}b._inheritsLoose(k,q);return k}(f.MaterialParameters);r=function(q){function k(){return q.apply(this,arguments)||this}b._inheritsLoose(k,q);var p=k.prototype;p.initializeProgram=function(z){return new e.Program(z.rctx,k.shader.get().build(this.configuration),d.Default3D)};p.initializePipeline=function(){return v.makePipelineState({blending:v.simpleBlendingParams(l.BlendFactor.ONE,
l.BlendFactor.ONE,l.BlendOperation.ADD),colorWrite:v.defaultColorWriteParams,depthTest:null,depthWrite:null})};p.destroy=function(){q.prototype.destroy.call(this)};return k}(r.ShaderTechnique);r.shader=new n.ReloadableShaderModule(h.HeatmapDensity,()=>new Promise((q,k)=>a(["./HeatmapDensity.glsl"],q,k)));n=function(q){function k(){var p=q.apply(this,arguments)||this;p.isAttributeDriven=!1;p.usesHalfFloat=!1;return p}b._inheritsLoose(k,q);return k}(g.DefaultTechniqueConfiguration);t.__decorate([m.parameter()],
n.prototype,"isAttributeDriven",void 0);t.__decorate([m.parameter()],n.prototype,"usesHalfFloat",void 0);c.HeatmapDensityPassParameters=f;c.HeatmapDensityTechnique=r;c.HeatmapDensityTechniqueConfiguration=n;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/HeatmapDensity.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r){function m(f){const e=new n.ShaderBuilder,{vertex:g,fragment:h}=e;c.addProjViewLocalOrigin(g,f);const {isAttributeDriven:l,usesHalfFloat:v}=f;e.attributes.add(r.VertexAttribute.POSITION,"vec3");e.attributes.add(r.VertexAttribute.UV0,"vec2");l&&(e.attributes.add(r.VertexAttribute.FEATUREATTRIBUTE,"float"),e.varyings.add("attributeValue","float"));v&&e.constants.add("compressionFactor","float",.25);e.varyings.add("unitCirclePos","vec2");g.uniforms.add(new b.FloatPassUniform("radius",
({resolutionForScale:q,searchRadius:k},{camera:p,screenToWorldRatio:z})=>2*k*(0===q?1:q/z)*p.pixelRatio/p.fullViewport[2]));g.code.add(t.glsl`
    void main() {
      unitCirclePos = uv0;

      vec4 posProj = proj * (view * vec4(${r.VertexAttribute.POSITION}, 1.0));
      vec4 quadOffset = vec4(unitCirclePos * radius, 0.0, 0.0);

      ${l?t.glsl`attributeValue = ${r.VertexAttribute.FEATUREATTRIBUTE};`:""}
      gl_Position = posProj + quadOffset;
    }
  `);h.code.add(t.glsl`
    void main() {
      float radiusRatioSquared = dot(unitCirclePos, unitCirclePos);
      if (radiusRatioSquared > 1.0) {
        discard;
      }

      float oneMinusRadiusRatioSquared = 1.0 - radiusRatioSquared;
      float density = oneMinusRadiusRatioSquared * oneMinusRadiusRatioSquared ${l?t.glsl` * attributeValue`:""} ${v?t.glsl` * compressionFactor`:""};
      gl_FragColor = vec4(density);
    }
  `);return e}const d=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.HeatmapDensity=d;a.build=m})},"esri/views/webgl/heatmapTextureUtils":function(){define(["exports","../../core/Error","../../core/maybe","./enums"],function(a,c,b,t){a.loadHeatmapTextureConfiguration=function(n,r){const {textureFloat:m,colorBufferFloat:d}=n.capabilities,f=m?.textureFloat,e=m?.textureFloatLinear;var g=m?.textureHalfFloat;const h=m?.textureHalfFloatLinear,l=m?.HALF_FLOAT,
v=d?.textureFloat;var q=d?.textureHalfFloat;const k=d?.floatBlend;n=b.unwrapOrThrow(n.driverTest).floatBufferBlend.result;if(!f&&!g)throw new c("heatmap:missing-texture-float","HeatmapRenderer requires WebGL2 or the WebGL1 extension OES_texture_float or OES_texture_half_float.");if(!v&&!q)throw new c("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(k&&n||q))throw new c("heatmap:missing-float-blend",
`HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float.${n?"":" This device claims support for EXT_float_blend, but does not actually support it."}`);g=g&&q;q=!!d?.R32F;const p=!!d?.R16F;if(f&&v&&k&&n&&(e||!h))return e||r.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),{dataType:t.PixelType.FLOAT,samplingMode:e?t.TextureSamplingMode.LINEAR:t.TextureSamplingMode.NEAREST,pixelFormat:q?t.PixelFormat.RED:t.PixelFormat.RGBA,
internalFormat:q?t.SizedPixelFormat.R32F:t.PixelFormat.RGBA};if(g)return h||r.warnOnce("Missing WebGL extension OES_texture_half_float_linear. Heatmap quality may be reduced."),{dataType:l,samplingMode:h?t.TextureSamplingMode.LINEAR:t.TextureSamplingMode.NEAREST,pixelFormat:p?t.PixelFormat.RED:t.PixelFormat.RGBA,internalFormat:p?t.SizedPixelFormat.R16F:t.PixelFormat.RGBA};throw new c("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.");
};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["exports","../../../../core/maybe","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(a,c,b,t){a.toViewIfLocal=function(n){const r=n.view.spatialReference,m=n.layer.fullExtent;var d=c.isSome(m)&&m.spatialReference;if(c.isNone(m)||!d)return Promise.resolve(null);if(d.equals(r))return Promise.resolve(m.clone());
d=b.project(m,r);return c.isSome(d)?Promise.resolve(d):n.view.state.isLocal?t.projectGeometry(m,r,n.layer.portalItem).then(f=>!n.destroyed&&f?f:null).catch(()=>null):Promise.resolve(null)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/FeatureTileFetcher3DLayerViewContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","./FeatureTileFetcher3D","./featureTileQuery3D"],function(a,c,b,t,n){let r=function(){function m(f){this._capabilities=
this._memoryCache=null;const e=f.layerView.layer;this._layerView=f.layerView;this.objectIdField=e.objectIdField;this.globalIdField="globalIdField"in e?e.globalIdField:null;this._returnZ=f.returnZ;this._returnM=f.returnM;f=this._layerView.view.resourceController;this.query=n.createFeatureTileQuery3D(e,f.normal);f&&this._memoryCacheEnabled&&(this._memoryCache=f.memoryController.newCache(e.uid))}var d=m.prototype;d.destroy=function(){this._memoryCache=b.destroyMaybe(this._memoryCache);this.query.destroy()};
d.createQuery=function(){const f=this._layerView.layer.createQuery();f.outFields=this._layerView.availableFields;f.returnZ=this._returnZ;f.returnM=this._returnM;f.outSpatialReference=this.tilingScheme.spatialReference;return f};d.logFetchError=function(f,e){f.error("#fetchTile()",this._layerView.layer,e&&e.message?e.message:e)};c._createClass(m,[{key:"_memoryCacheEnabled",get:function(){switch(this._layerView.layer.source.type){case "feature-layer":case "ogc-feature":case "oriented-imagery":return!0;
case "csv":case "geojson":case "memory":case "wfs":return!1}}},{key:"memoryCache",get:function(){return this._memoryCache}},{key:"viewingMode",get:function(){return this._layerView.view.state.viewingMode}},{key:"tilingScheme",get:function(){return this._layerView.view.featureTiles.tilingScheme}},{key:"scheduler",get:function(){const f=this._layerView.view.resourceController;return f?f.scheduler:null}},{key:"geometryType",get:function(){return this._layerView.layer.geometryType}},{key:"fullExtent",
get:function(){return this._layerView.layer.fullExtent}},{key:"tileMaxRecordCount",get:function(){return this._layerView.layer.capabilities.query.tileMaxRecordCount}},{key:"maxRecordCount",get:function(){return this._layerView.layer.capabilities.query.maxRecordCount}},{key:"capabilities",get:function(){return b.isSome(this._capabilities)?this._capabilities:this._capabilities=t.contextCapabilitiesFromLayer(this._layerView.layer)}}]);return m}();a.FeatureTileFetcher3DLayerViewContext=r;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/featureTileQuery3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/dehydratedFeatures ../../../../rest/query/operations/query ../../support/PBFDecoder".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){let v=function(z){function C(A){return z.call(this,A)||this}c._inheritsLoose(C,z);var B=C.prototype;B.queryFeatureCount=function(A,x){return this.layer.queryFeatureCount(A,x)};B.destroy=function(){this._decoder=n.destroyMaybe(this._decoder)};B._createRequestOptions=function(A){return{...A,query:{...this.layer.customParameters,token:this.layer.apiKey,...A?.query}}};c._createClass(C,[{key:"queryFeaturesDehydrated",get:function(){var A=this.layer.capabilities;A=A&&
A.query;const x=this.layer.parsedUrl;if(A&&A.supportsFormatPBF){n.isNone(this._decoder)&&(this._decoder=new l.PBFDecoder(this.controller));const u={sourceSpatialReference:this.layer.spatialReference?.toJSON()??null,applyTransform:!0,maxStringAttributeLength:1024};return(y,w)=>h.runQuery(x,y,"pbf",this._createRequestOptions(w)).then(D=>{r.throwIfAborted(w);return n.isSome(this._decoder)?this._decoder.invoke({buffer:D.data,options:u},w.signal):Promise.reject(r.createAbortError())})}return(u,y)=>h.executeQuery(x,
u,this.layer.spatialReference,this._createRequestOptions(y)).then(w=>g.fromFeatureSetJSON(w.data))}}]);return C}(t);b.__decorate([m.property({constructOnly:!0})],v.prototype,"layer",void 0);b.__decorate([m.property({constructOnly:!0})],v.prototype,"controller",void 0);b.__decorate([m.property({readOnly:!0})],v.prototype,"queryFeaturesDehydrated",null);v=b.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],v);let q=function(z){function C(A){return z.call(this,
A)||this}c._inheritsLoose(C,z);var B=C.prototype;B.queryFeaturesDehydrated=function(A,x){return this.layer.queryFeatures(A,x)};B.queryFeatureCount=function(A,x){return this.layer.queryFeatureCount(A,x)};return C}(t);b.__decorate([m.property({constructOnly:!0})],q.prototype,"layer",void 0);b.__decorate([m.property({readOnly:!0})],q.prototype,"queryFeaturesDehydrated",null);q=b.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceMeshQuery3D")],q);let k=function(z){function C(B){return z.call(this,
B)||this}c._inheritsLoose(C,z);C.prototype.queryFeaturesDehydrated=function(B,A){return this.layer.queryFeatures(B,A)};return C}(t);b.__decorate([m.property({constructOnly:!0})],k.prototype,"layer",void 0);k=b.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileServiceQuery3D")],k);let p=function(z){function C(A){return z.call(this,A)||this}c._inheritsLoose(C,z);var B=C.prototype;B.queryFeaturesDehydrated=function(A,x){return this.source.queryFeaturesJSON(A,x).then(g.fromFeatureSetJSON,
u=>{if(u&&"query-features-json:unsupported"===u.name)return this.layer.queryFeatures(A,x);throw u;})};B.queryFeatureCount=function(A,x){return this.layer.queryFeatureCount(A,x)};return C}(t);b.__decorate([m.property({constructOnly:!0})],p.prototype,"layer",void 0);b.__decorate([m.property({constructOnly:!0})],p.prototype,"source",void 0);p=b.__decorate([e.subclass("esri.views.3d.layers.support.featureTileQuery3D.FeatureTileClientQuery3D")],p);a.createFeatureTileQuery3D=function(z,C){return"feature"===
z.type&&"feature-layer"===z.source.type?n.isSome(z.infoFor3D)?new q({layer:z}):new v({layer:z,controller:C}):"feature"===z.type&&"memory"===z.source.type||"csv"===z.type||"geojson"===z.type||"oriented-imagery"===z.type||"wfs"===z.type?new p({layer:z,source:z.source}):"ogc-feature"===z.type?new k({layer:z}):null};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/PBFDecoder":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Graphic ../../../core/maybe ../../../core/typedArrayUtil ../../../core/workers/WorkerHandle ../../../geometry/SpatialReference ../../../layers/support/Field".split(" "),
function(a,c,b,t,n,r,m,d){function f(h){switch(h.type){case "polyline":h.paths.reduce((l,v)=>l+v.length,0)<n.NATIVE_ARRAY_MAX_SIZE&&(h.paths=h.hasZ||h.hasM?h.paths.map(l=>l.map(v=>[v[0],v[1],v[2]])):h.paths.map(l=>l.map(v=>[v[0],v[1]])));break;case "polygon":h.rings.reduce((l,v)=>l+v.length,0)<n.NATIVE_ARRAY_MAX_SIZE&&(h.rings=h.hasZ||h.hasM?h.rings.map(l=>l.map(v=>[v[0],v[1],v[2]])):h.rings.map(l=>l.map(v=>[v[0],v[1]])))}}let e=function(){function h(v){this._controller=v;this._handle=new g(q=>v.schedule(q))}
var l=h.prototype;l.destroy=function(){this._handle.destroy()};l.invoke=function(v,q){var k=this;if(!v.buffer||0===v.buffer.byteLength)return Promise.resolve(null);v.options.sourceSpatialReference&&v.options.sourceSpatialReference instanceof m&&(v.options={...v.options,sourceSpatialReference:v.options.sourceSpatialReference.toJSON()});return this._handle.invoke(v,q).then(p=>{let z=0,C=0;const B=function(){var A=c._asyncToGenerator(function*(x){p.spatialReference=m.fromJSON(p.spatialReference);if(p.fields)for(;z<
p.fields.length;)if(p.fields[z]=d.fromJSON(p.fields[z]),z++,x.madeProgress())return k._controller.reschedule(y=>B(y));const u=p.spatialReference;for(;C<p.features.length;){const y=p.features[C];++C;y.uid=b.generateUID();if(t.isSome(y.geometry)&&(y.geometry.spatialReference=u,f(y.geometry),x.madeProgress()))return k._controller.reschedule(w=>B(w))}return p});return function(x){return A.apply(this,arguments)}}();return this._controller.schedule(A=>B(A))})};return h}(),g=function(h){function l(v){return h.call(this,
"PBFDecoderWorker","_parseFeatureQuery",{_parseFeatureQuery:q=>[q.buffer]},v)||this}c._inheritsLoose(l,h);return l}(r.WorkerHandle);a.PBFDecoder=e;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/EventedSet":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/ObservableChangesType","../../../core/SetUtils"],function(a,c,b,t,n){b=function(r){function m(){var f=r.apply(this,arguments)||this;f._set=new Set;
return f}c._inheritsLoose(m,r);var d=m.prototype;d.clear=function(){if(0<this._set.size){const f=this.toArray();this._set.clear();this.emit("after-changes",{type:t.ObservableChangesType.REMOVE});this.emit("change",{added:[],removed:f})}};d.addMany=function(f){if(0!==f.length){for(const e of f)this._set.add(e);this.emit("after-changes",{type:t.ObservableChangesType.ADD});this.emit("change",{added:f,removed:[]})}};d.remove=function(f){this._set.delete(f)&&(this.emit("after-changes",{type:t.ObservableChangesType.REMOVE}),
this.emit("change",{added:[],removed:[f]}))};d.removeMany=function(f){const e=[];for(const g of f)this._set.delete(g)&&e.push(g);0<e.length&&(this.emit("after-changes",{type:t.ObservableChangesType.REMOVE}),this.emit("change",{added:[],removed:e}))};d.toArray=function(){return[...this._set]};d.find=function(f){let e;n.someSet(this._set,g=>f(g)?(e=g,!0):!1);return e};d.forEach=function(f){this._set.forEach(e=>f(e))};c._createClass(m,[{key:"length",get:function(){return this._set.size}}]);return m}(b);
a.EventedSet=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/FeatureLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/FeatureEffect ../../layers/support/FeatureFilter ../../layers/support/fieldUtils ../../layers/support/floorFilterUtils ../../rest/support/Query ../../support/arcadeOnDemand ./support/popupUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){const B=t.getLogger("esri.views.layers.FeatureLayerView");return A=>{A=function(x){function u(...w){w=x.call(this,...w)||this;w._updatingRequiredFieldsPromise=null;w.filter=null;w.timeExtent=null;w.layer=null;w.requiredFields=[];w.view=null;return w}a._inheritsLoose(u,x);var y=u.prototype;y.initialize=function(){this.handles.add([m.watch(()=>{const w=this.layer;return[w?.elevationInfo?.featureExpressionInfo,w&&"displayField"in w?w.displayField:null,
w&&"timeInfo"in w&&w.timeInfo,w&&"renderer"in w&&w.renderer,w&&"labelingInfo"in w&&w.labelingInfo,w&&"floorInfo"in w&&w.floorInfo,this.filter,this.featureEffect,this.timeExtent]},()=>this._handleRequiredFieldsChange(),m.syncAndInitial),m.on(()=>this.view?.floors,"change",()=>this._handleRequiredFieldsChange()),m.on(()=>{const w=this.layer;return w&&"sublayers"in w?w.sublayers:null},"change",()=>this._handleRequiredFieldsChange())])};y.highlight=function(w){throw Error("missing implementation");};
y.createQuery=function(){var w={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};w=n.isSome(this.filter)?this.filter.createQuery(w):new p(w);if("feature"===this.layer.type){const D=k.getFloorFilterClause(this);n.isSome(D)&&(w.where=w.where?`(${w.where}) AND (${D})`:D)}n.isSome(this.timeExtent)&&(w.timeExtent=n.isSome(w.timeExtent)?w.timeExtent.intersection(this.timeExtent):this.timeExtent.clone());return w};y.createAggregateQuery=function(){return new p({outFields:["*"],
returnGeometry:!0,outSpatialReference:this.view.spatialReference})};y.queryFeatures=function(w,D){throw Error("missing implementation");};y.queryObjectIds=function(w,D){throw Error("missing implementation");};y.queryFeatureCount=function(w,D){throw Error("missing implementation");};y.queryExtent=function(w,D){throw Error("missing implementation");};y.fetchPopupFeatures=function(){var w=a._asyncToGenerator(function*(D,F){if(D=this.validateFetchPopupFeatures(F))throw D;return this.fetchClientPopupFeatures(F)});
return function(D,F){return w.apply(this,arguments)}}();y._loadArcadeModules=function(w){return w.get("expressionInfos.length")||Array.isArray(w.content)&&w.content.some(D=>"expression"===D.type)?z.loadArcade():Promise.resolve()};y._handleRequiredFieldsChange=function(){const w=this._updateRequiredFields();this._set("_updatingRequiredFieldsPromise",w);w.then(()=>{this._updatingRequiredFieldsPromise===w&&this._set("_updatingRequiredFieldsPromise",null)})};y._updateRequiredFields=function(){var w=a._asyncToGenerator(function*(){if(this.layer&&
this.view){var D="3d"===this.view.type,{layer:F,layer:{fieldsIndex:E,objectIdField:K}}=this,J="renderer"in F&&F.renderer,M="orderBy"in F&&F.orderBy,N="featureReduction"in F?F.featureReduction:null,P=new Set;J=yield r.eachAlways([J?J.collectRequiredFields(P,E):null,q.collectLabelingFields(P,F),D?q.collectElevationFields(P,F):null,n.isSome(this.filter)?q.collectFilterFields(P,F,this.filter):null,n.isSome(this.featureEffect)?q.collectFilterFields(P,F,this.featureEffect.filter):null,N?q.collectFeatureReductionFields(P,
F,N):null,M?q.collectOrderByInfos(P,F,M):null]);"timeInfo"in F&&F.timeInfo&&this.timeExtent&&q.collectFields(P,F.fieldsIndex,[F.timeInfo.startField,F.timeInfo.endField]);"feature"===F.type&&(F.floorInfo&&q.collectFields(P,F.fieldsIndex,[F.floorInfo.floorField]),D&&n.isSome(F.infoFor3D)&&(null==F.globalIdField&&B.error("globalIdField missing on 3DObjectFeatureLayer"),q.collectFields(P,F.fieldsIndex,[F.globalIdField])));"subtype-group"===F.type&&(q.collectField(P,E,F.subtypeField),M=F.sublayers.map(I=>
Promise.all([I.renderer?.collectRequiredFields(P,E),q.collectLabelingFields(P,I)])),yield r.eachAlways(M));for(const I of J)I.error&&B.error(I.error);q.collectField(P,E,K);D&&"displayField"in F&&F.displayField&&q.collectField(P,E,F.displayField);D=Array.from(P).sort();this._set("requiredFields",D)}});return function(){return w.apply(this,arguments)}}();y.validateFetchPopupFeatures=function(w){if(n.isNone(w))return null;for(const D of w.clientGraphics??[]){const F=D.layer;if("popupEnabled"in F&&!F.popupEnabled)return new b("featurelayerview:fetchPopupFeatures",
"Popups are disabled",{layer:F});if(D.isAggregate){const E="featureReduction"in F?F.featureReduction:null;if(!(E&&"popupTemplate"in E&&E.popupEnabled&&E.popupTemplate))return new b("featurelayerview:fetchPopupFeatures","Popups are disabled",{layer:F})}else if("popupTemplate"in F&&!C.getFetchPopupTemplate(F,w))return new b("featurelayerview:fetchPopupFeatures","Layer does not define a popup template",{layer:F})}};y.fetchClientPopupFeatures=function(){var w=a._asyncToGenerator(function*(D){const F=
n.isSome(D)?D.clientGraphics:null;if(!F||0===F.length)return[];const E=Array(F.length),K=new Map,J=yield this.createPopupQuery(D);for(let N=0;N<F.length;N++){const P=F[N];if(P.isAggregate){E[N]=P;continue}var M=P.layer;if(!("popupEnabled"in M))continue;const I=q.unpackFieldNames(this.layer.fieldsIndex,J.outFields);M=C.getFetchPopupTemplate(M,D);if(n.isNone(M))continue;const G=yield this._loadArcadeModules(M);G&&G.arcadeUtils.hasGeometryOperations(M)||!q.featureHasFields(I,P)?K.set(P.getObjectId(),
{graphic:P,index:N}):E[N]=P}if("stream"===this.layer.type||0===K.size)return E.filter(Boolean);J.objectIds=Array.from(K.keys());try{const N=yield this.layer.queryFeatures(J);for(const P of N.features){const {graphic:{geometry:I},index:G}=K.get(P.getObjectId());P.geometry||(P.geometry=I);E[G]=P}}catch{}return E.filter(Boolean)});return function(D){return w.apply(this,arguments)}}();y.createPopupQuery=function(){var w=a._asyncToGenerator(function*(D){const F=this.layer.createQuery(),E=new Set;var K=
!1,J=n.isSome(D)&&D.clientGraphics?D.clientGraphics.map(M=>M.layer):[this.layer];for(const M of J)if("popupEnabled"in M&&(J=C.getFetchPopupTemplate(M,D),!n.isNone(J))){K=(K=yield this._loadArcadeModules(J))&&K.arcadeUtils.hasGeometryOperations(J);K=!("point"!==this.layer.geometryType&&!K);J=yield C.getRequiredFields(this.layer,J);for(const N of J)E.add(N)}F.returnGeometry=K;F.returnZ=K;F.returnM=K;F.outFields=Array.from(E);F.outSpatialReference=this.view.spatialReference;"feature"===this.layer.type&&
(D=k.getFloorFilterClause(this),n.isSome(D)&&(F.where=F.where?`(${F.where}) AND (${D})`:D));return F});return function(D){return w.apply(this,arguments)}}();y.canResume=function(){return!x.prototype.canResume.call(this)||n.isSome(this.timeExtent)&&this.timeExtent.isEmpty?!1:!0};a._createClass(u,[{key:"availableFields",get:function(){const {layer:w,layer:{fieldsIndex:D},requiredFields:F}=this;return"outFields"in w&&w.outFields?q.fixFields(D,[...q.unpackFieldNames(D,w.outFields),...F]):q.fixFields(D,
F)}},{key:"featureEffect",get:function(){return this.layer&&"featureEffect"in this.layer?this.layer.featureEffect:null},set:function(w){this._override("featureEffect",w)}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(w){B.error("#maximumNumberOfFeatures\x3d","Setting maximum number of features is not supported")}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}}]);return u}(A);c.__decorate([d.property()],A.prototype,"_updatingRequiredFieldsPromise",void 0);
c.__decorate([d.property({readOnly:!0})],A.prototype,"availableFields",null);c.__decorate([d.property({type:l})],A.prototype,"featureEffect",null);c.__decorate([d.property({type:v})],A.prototype,"filter",void 0);c.__decorate([d.property(h.combinedViewLayerTimeExtentProperty)],A.prototype,"timeExtent",void 0);c.__decorate([d.property()],A.prototype,"layer",void 0);c.__decorate([d.property({type:Number})],A.prototype,"maximumNumberOfFeatures",null);c.__decorate([d.property({readOnly:!0,type:Boolean})],
A.prototype,"maximumNumberOfFeaturesExceeded",null);c.__decorate([d.property({readOnly:!0})],A.prototype,"requiredFields",void 0);c.__decorate([d.property()],A.prototype,"suspended",void 0);c.__decorate([d.property()],A.prototype,"view",void 0);return A=c.__decorate([g.subclass("esri.views.layers.FeatureLayerView")],A)}})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d,f){return e=>{e=function(g){function h(){return g.apply(this,arguments)||this}a._inheritsLoose(h,g);h.prototype.initialize=function(){this.handles.add(n.on(()=>this.layer,"refresh",l=>{this.doRefresh(l.dataChanged).catch(v=>{t.isAbortError(v)||b.getLogger(this.declaredClass).error(v)})}),"RefreshableLayerView")};return h}(e);c.__decorate([r.property()],e.prototype,"layer",void 0);return e=c.__decorate([f.subclass("esri.layers.mixins.RefreshableLayerView")],e)}})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/asyncUtils ../../../core/Collection ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/screenUtils ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/plane ../../../layers/graphics/dehydratedFeatures ../../../layers/support/CodedValue ../../../core/has ../../../layers/support/CodedValueDomain ../../../layers/support/Domain ../../../layers/support/InheritedDomain ../../../layers/support/RangeDomain ../../../layers/support/fieldUtils ../../../layers/support/PromiseQueue ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorkerHandle ./i3s/I3SUtil ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointCloudWorkerUtil ./i3s/PointGraphic ./i3s/PointRenderer ./support/PopupSceneLayerView ../support/extentUtils ../support/index ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/RenderSlot ../../layers/LayerView ../../support/layerViewUtils ../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V,aa,X,W,T,U,Y,ba){const da=A.create();l=function(ca){function ja(){var Z=ca.apply(this,arguments)||this;Z.type="point-cloud-3d";Z.maximumPointCount=4E6;Z.slicePlaneEnabled=!1;Z._renderer=null;Z._rendererAdded=!1;Z._renderedNodes=new Set;Z._nodeScales=new Map;Z._updateViewNeeded=!0;Z._lodFactor=1;Z._maxLoggedBoxWarnings=5;Z._pageMultiplier=1;Z._nodeLoadEpoch=0;Z._indexQueue=[];Z._workQueue=[];Z._idleQueue=new J.PromiseQueue;
Z._indexPagesLoading=new Map;Z._loadingNodes=new Map;Z._recalcWork=!0;Z._layerIsVisible=!1;Z._codedDomainPopulationPromise=null;Z._codedDomainPopulationAbortController=null;Z._totalWork=0;Z._index=null;Z._loadingInitNodePage=!1;Z._nodeIdArray=[];return Z}a._inheritsLoose(ja,ca);var ia=ja.prototype;ia.initialize=function(){const Z=this.view.resourceController;this._worker=new P.PointCloudWorkerHandle(ka=>Z.immediate.schedule(ka));this.addResolvingPromise(this._worker.promise);this._tmpPoint=x.makeDehydratedPoint(0,
0,0,this.layer.spatialReference);I.checkPointCloudLayerValid(this.layer);I.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._indexRequester=Z.createStreamDataRequester(aa.ClientType.I3S_INDEX);this._dataRequester=Z.createStreamDataRequester(aa.ClientType.I3S_DATA);this._initRenderer();const ha=this._initNodePages(),fa=this.view.resourceController.memoryController;this._memCache=fa.newCache(this.layer.uid);this.updatingHandles.add(()=>this._clippingBox,()=>this._setUpdateViewNeeded(),
d.initial);this.updatingHandles.add(()=>this._elevationOffset,()=>this._elevationOffsetChanged(),d.initial);this.updatingHandles.add(()=>this.layer.renderer,()=>this._rendererChanged(),d.initial);this.updatingHandles.add(()=>this.layer.filters,()=>this._reload(),d.initial);this.updatingHandles.add(()=>this.layer.outFields,()=>this._reload(),d.initial);this.updatingHandles.add(()=>this.layer.effectiveScaleRange,()=>this._setUpdateViewNeeded());this.updatingHandles.add(()=>this.view.state.contentCamera,
()=>this._setUpdateViewNeeded());this.handles.add([this.view.basemapTerrain.on("scale-change",ka=>this._scaleUpdateHandler(ka)),d.watch(()=>fa.memoryFactor,()=>this._setUpdateViewNeeded(),d.sync)]);this.addResolvingPromise(ha);this.when(()=>{this.handles.add([Z.scheduler.registerTask(ba.TaskPriority.POINT_CLOUD_LAYER,this),Z.scheduler.registerIdleStateCallbacks(()=>this._idleBegin(),()=>this._idleEnd()),this.updatingHandles.add(()=>this.suspended,ka=>{ka?this._clearNodeState():this._setUpdateViewNeeded()},
d.initial)])},()=>{this.updatingHandles.removeAll();this.handles.removeAll()})};ia._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};ia.destroy=function(){this.cancelLoading();this._worker=r.destroyMaybe(this._worker);this._destroyRenderer();this._memCache=r.destroyMaybe(this._memCache);this._codedDomainPopulationAbortController=r.abortMaybe(this._codedDomainPopulationAbortController);this._codedDomainPopulationPromise=null};ia._initRenderer=function(){this._renderer=
new R.PointRenderer({createGraphic:(Z,ha,fa)=>this._createGraphic(Z,ha,fa)});this._renderer.layerUid=this.layer.uid;this.updatingHandles.add(()=>this._clippingBox,Z=>this._renderer.clippingBox=Z,d.initial);this.updatingHandles.add(()=>this.suspended,Z=>this._setPointsVisible(!Z),d.initial);this.updatingHandles.add(()=>this.pointScale,Z=>this._renderer.scaleFactor=Z,d.initial);this._renderer.minSizePx=Math.sqrt(2);this.updatingHandles.add(()=>this.useRealWorldSymbolSizes,Z=>this._renderer.useRealWorldSymbolSizes=
Z,d.initial);this.updatingHandles.add(()=>this.pointSize,Z=>{const ha=f.pt2px(Z);this._renderer.size=Z;this._renderer.sizePx=ha},d.initial);this.updatingHandles.add(()=>this.slicePlaneEnabled,Z=>this._renderer.slicePlaneEnabled=Z,d.initial);this.updatingHandles.add(()=>this.inverseDensity,()=>this._setUpdateViewNeeded(),d.initial);this.updatingHandles.add(()=>this.maximumPointCount,()=>this._setUpdateViewNeeded(),d.initial);this.updatingHandles.add(()=>this.view.qualitySettings.sceneService.pointCloud.lodFactor,
Z=>{this._lodFactor=Z;this._setUpdateViewNeeded()},d.initial)};ia._destroyRenderer=function(){this._renderer.removeAll();this._setPointsVisible(!1)};ia._createGraphic=function(Z,ha,fa){const ka=r.isSome(Z.pointIdFilterMap)?Z.pointIdFilterMap[ha]:ha;fa=this.view.computeMapPointFromVec3d(fa);const la=this._createGraphicAttributes(Z,ka);return new S.PointGraphic({pointCloudMetadata:{nodeId:Z.id,pointIndexInNode:ha,attributePointIndexInNode:ka,epoch:this._nodeLoadEpoch},geometry:fa,attributes:la,layer:this.layer,
sourceLayer:this.layer})};ia._createGraphicAttributes=function(Z,ha){const fa={};for(const ka of Z.attributes)this._encodeGraphicAttribute(ka.attributeInfo,ka.values,ha,fa);return fa};ia._encodeGraphicAttribute=function(Z,ha,fa,ka){var la=Z.storageInfo?.attributeValues;const na=la?.valuesPerElement??1;if(1===na)ka[Z.name]=ha[fa];else if("UInt8"===la?.valueType&&4>=na){la=0;fa*=na;for(let pa=fa;pa<fa+na;pa++)la=(la<<8)+ha[pa];ka[Z.name]=la}else ka[Z.name]=void 0};ia._setPointsVisible=function(Z){Z&&
!this._rendererAdded?(this.view._stage.addRenderPlugin([T.RenderSlot.OPAQUE_MATERIAL],this._renderer),this._rendererAdded=!0):!Z&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};ia._rendererChanged=function(){this._renderer.useFixedSizes=L.rendererUsesFixedSizes(this.layer.renderer);this._reload()};ia._reload=function(){this._clearNodeState();this._memCache.clear();this._setUpdateViewNeeded()};ia._elevationOffsetChanged=function(){this._clearNodeState();
this._memCache.clear();this._initNodePages()};ia._scaleUpdateHandler=function(Z){const ha=this.layer.effectiveScaleRange;Y.isScaleRangeActive(ha.minScale,ha.maxScale)?z.projectBoundingRect(Z.extent,Z.spatialReference,ea,this.layer.spatialReference)&&(this._nodeScales.forEach((fa,ka)=>{this._renderedNodes.has(ka)?(fa=this._index.getNode(ka),B.containsPoint(ea,fa.obb.center)&&this._nodeScales.set(ka,Z.scale)):this._nodeScales.delete(ka)}),this._setUpdateViewNeeded()):this._nodeScales.clear()};ia._displayNodes=
function(Z){this._workQueue=G.nodeDiff([...this._renderedNodes],Z,this._index);G.sortFrontToBack(this._workQueue,this.view.state.contentCamera.viewForward,this._index);G.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<Z.length||this._loadingInitNodePage;this.notifyChange("suspended")};ia.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};ia._cancelNodeLoading=function(){const Z=
[];this._loadingNodes.forEach(({abortController:ha})=>Z.push(ha));this._loadingNodes.clear();for(const ha of Z)ha.abort();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};ia._updateQueues=function(){const Z=new Set;this._workQueue.forEach(ka=>ka.load.forEach(la=>Z.add(la)));const ha=[],fa=new Map;this._loadingNodes.forEach((ka,la)=>{Z.has(la)?fa.set(la,ka):ha.push(ka)});this._loadingNodes=fa;for(const {abortController:ka}of ha)ka.abort();this._workQueue=
this._workQueue.filter(ka=>{for(const la of ka.load)if(this._loadingNodes.has(la))return this._recalcWork=!0,!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};ia._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(({abortController:Z})=>Z.abort());this._indexPagesLoading.clear();this._totalWork=this._computeWork();this._updateLoading()};ia._clearNodeState=function(){this._nodeLoadEpoch++;this._renderedNodes.forEach(Z=>this._removeFromRenderer(Z));
this._cancelNodeLoading()};ia._idleBegin=function(){this._setUpdateViewNeeded()};ia._idleEnd=function(){this._setUpdateViewNeeded()};ia.runTask=function(Z){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,Z=this._isRootNodeVisible(),Z!==this._layerIsVisible&&(this._layerIsVisible=Z,this.notifyChange("suspended")),this._updateLoading());else{for(Z.run(()=>this._updateWorkQueues());0<this._indexQueue.length&&Z.run(()=>this._processIndexQueue()););this._processWorkQueue(Z);this._idleQueue.runTask(Z)}};
ia._processIndexQueue=function(){const Z=this._indexQueue.shift(),ha=this._loadNodePage(Z);this._indexPagesLoading.set(Z,ha);ha.promise.then(fa=>{this._index.addPage(Z,fa,this._elevationOffset);this._setUpdateViewNeeded()}).then(()=>{this._indexPagesLoading.delete(Z)},()=>{this._indexPagesLoading.delete(Z)});return!0};ia._processWorkQueue=function(Z){for(;!Z.done;){const ha=this._scheduleWorkEntry();if(r.isNone(ha))break;this._processWorkEntry(ha);Z.madeProgress()}};ia._scheduleWorkEntry=function(){let Z=
this._workQueue.length;for(;Z--;){const ha=this._workQueue.shift();if(ha.remove.find(fa=>!this._renderedNodes.has(fa)))this._workQueue.push(ha);else return ha}return null};ia._processWorkEntry=function(Z){if(0===Z.load.length)for(const ha of Z.remove)this._removeFromRenderer(ha);else Promise.all(Z.load.map(ha=>{const fa=new AbortController,ka=this._memCache.pop(ha.toString());r.isSome(ka)?this._loadingNodes.set(ha,{abortController:fa,promise:Promise.resolve(ka)}):this._loadingNodes.has(ha)||this._loadingNodes.set(ha,
{abortController:fa,promise:this._loadNode(ha,fa.signal)});return this._loadingNodes.get(ha).promise})).then(ha=>{for(let fa=0;fa<Z.load.length;fa++)if(ha[fa]){const ka=this._setupRendererData(Z.load[fa],ha[fa]);this._addToRenderer(ka)}for(const fa of Z.remove)this._removeFromRenderer(fa)}).catch(()=>{}).then(()=>{for(const ha of Z.load)this._loadingNodes.delete(ha);this._updateLoading();this._recalcWork&&!this._idleQueue.running&&0===this._indexQueue.length&&0===this._loadingNodes.size&&(this._recalcWork=
!1,this._setUpdateViewNeeded())}),this._updateLoading()};ia._populateClassCodeCodedDomain=function(){var Z=a._asyncToGenerator(function*(ha,fa){const ka=this.layer.fieldsIndex.get("CLASS_CODE");ka&&!ka.domain&&ha.includes(ka.name)&&(ha=yield b.result(this.layer.queryCachedStatistics("CLASS_CODE",{signal:fa})),!1!==ha.ok&&(ha=(ha=ha.value)&&ha.labels&&ha.labels.labels)&&Array.isArray(ha)&&(ka.domain=new w({name:"CLASS_CODE",codedValues:ha.map(la=>new u.CodedValue({code:la.value,name:la.label}))})))});
return function(ha,fa){return Z.apply(this,arguments)}}();ia.prepareFetchPopupFeatures=function(){var Z=a._asyncToGenerator(function*(ha){this._codedDomainPopulationPromise||(this._codedDomainPopulationAbortController=new AbortController,this._codedDomainPopulationPromise=this._populateClassCodeCodedDomain(ha,this._codedDomainPopulationAbortController.signal).then(()=>{this._codedDomainPopulationAbortController=null}));return this._codedDomainPopulationPromise});return function(ha){return Z.apply(this,
arguments)}}();ia.whenGraphicAttributes=function(){var Z=a._asyncToGenerator(function*(ha,fa){var ka=this;const la=this._splitGraphicsPerNode(ha),na=this.layer.attributeStorageInfo,pa=fa.map(za=>L.getAttributeInfo(na,za)).filter(r.isSome),va=function(){var za=a._asyncToGenerator(function*(sa,ua){const oa=ka._index.getNode(ua);yield b.forEach(pa,function(){var xa=a._asyncToGenerator(function*(Ea){const Ia=Ea.useElevation?yield ka._loadElevationAttributeFromGeometry(oa.resourceId):yield ka._loadAndParseAttribute(oa,
Ea);if(Ia)for(const Na of sa)ka._isValidPointGraphic(Na)&&ka._encodeGraphicAttribute(Ea,Ia,Na.pointCloudMetadata.attributePointIndexInNode,Na.attributes)});return function(Ea){return xa.apply(this,arguments)}}())});return function(sa,ua){return za.apply(this,arguments)}}(),wa=[];la.forEach((za,sa)=>{wa.push(va(za,sa))});yield m.eachAlways(wa);return ha});return function(ha,fa){return Z.apply(this,arguments)}}();ia._isValidPointGraphic=function(Z){return Z instanceof S.PointGraphic&&Z.pointCloudMetadata&&
Z.pointCloudMetadata.epoch===this._nodeLoadEpoch};ia._splitGraphicsPerNode=function(Z){const ha=new Map;for(const fa of Z){if(!this._isValidPointGraphic(fa))continue;Z=fa.pointCloudMetadata;const ka=ha.get(Z.nodeId);ka?ka.push(fa):ha.set(Z.nodeId,[fa])}return ha};ia._loadAndParseAttribute=function(){var Z=a._asyncToGenerator(function*(ha,fa){const ka=yield this._loadAttribute(ha.resourceId,fa,null);return r.isSome(ka)?O.getAttributeValues({attributeInfo:fa,buffer:ka},null,ha.vertexCount):null});return function(ha,
fa){return Z.apply(this,arguments)}}();ia._loadElevationAttributeFromGeometry=function(){var Z=a._asyncToGenerator(function*(ha){ha=O.readGeometry(this.layer.store.defaultGeometrySchema,yield this._loadGeometry(ha,null));return O.elevationFromPositions(ha,ha.length/3)});return function(ha){return Z.apply(this,arguments)}}();ia.highlight=function(Z){if(!Z)return{remove(){}};Z=t.isCollection(Z)?Z.toArray():Array.isArray(Z)?Z:[Z];return this._renderer.highlight(Z.map(ha=>this._graphicToPointDefinition(ha)))};
ia._graphicToPointDefinition=function(Z){if(!this._isValidPointGraphic(Z))return null;const {nodeId:ha,pointIndexInNode:fa}=Z.pointCloudMetadata;return null!=ha&&null!=fa?{nodeId:ha,pointId:fa}:null};ia._computeWork=function(){let Z=0;for(const ha of this._workQueue)Z+=ha.load.length+ha.remove.length;Z+=this._loadingNodes.size;Z+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;Z+=this._loadingInitNodePage?100:0;return Z+=this._updateViewNeeded?100:0};ia._updateLoading=
function(){this.notifyChange("updating");this.notifyChange("updatingProgressValue")};ia.canResume=function(){return ca.prototype.canResume.call(this)&&this._layerIsVisible};ia.isUpdating=function(){return this.suspended?this._updateViewNeeded:0<this._computeWork()};ia._initNodePages=function(){const Z=this.layer.store.index;this._index=new H(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,Z.nodesPerPage||Z.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=
this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=Z.nodesPerPage?1:Z.nodePerIndexBlock;return this._loadNodePage(0).promise.then(ha=>{this._index.addPage(0,ha,this._elevationOffset);this._loadingInitNodePage=!1;this._setUpdateViewNeeded()})};ia._loadNodePage=function(Z){const ha=new AbortController;return{promise:this._requestNodePage(`${this.baseUrl}/nodepages/${Z*this._pageMultiplier}`,
ha.signal).then(fa=>fa.nodes.map((ka,la)=>({resourceId:null!=ka.resourceId?ka.resourceId:Z*this._index.pageSize+la,obb:ka.obb,firstChild:ka.firstChild,childCount:ka.childCount,vertexCount:ka.vertexCount??ka.pointCount,lodThreshold:ka.lodThreshold??ka.effectiveArea}))),abortController:ha}};ia._updateWorkQueues=function(){if(!this._updateViewNeeded)return!1;let Z=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor();const ha=this.maximumPointCount*this._lodFactor*this._getLodMemoryFactor();
let fa=this._computeNodesForMinimumDensity(Z),ka=this._computePointCount(fa),la=Math.sqrt(ka/(.75*ha));for(;ka>ha;)Z*=la,fa=this._computeNodesForMinimumDensity(Z),ka=this._computePointCount(fa),la=Math.sqrt(2);this._displayNodes(fa);this._updateViewNeeded=!1;this._updateLoading();return!0};ia._computePointCount=function(Z){let ha=0;for(let fa=0;fa<Z.length;fa++){const ka=this._index.getNode(Z[fa]);ka&&(ha+=ka.vertexCount)}return ha};ia._getLodMemoryFactor=function(){return this.view.resourceController.memoryController.memoryFactor};
ia._isRootNodeVisible=function(){let Z=!1;this._traverseVisible({frustum:this.view.state.contentCamera.frustum,clippingBox:this._clippingBox},{predicate:(ha,fa,ka)=>{Z=ka;return!1},pageMiss:()=>{}});return Z};ia._computeNodesForMinimumDensity=function(Z){const ha=this.view.state.contentCamera,fa=ha.frustum,ka=this._clippingBox,la=ha.viewForward,na=k.dot(la,ha.eye),pa=A.fromNormalAndOffset(la,-na,da),va=ha.perScreenPixelRatio/2,wa=Z*Z,za=this._nodeIdArray;za.length=0;const {minScale:sa,maxScale:ua}=
Y.extractSafeScaleBounds(this.layer),oa=0===sa&&0===ua?xa=>za.push(xa):xa=>{const Ea=this._getScale(xa);Y.scaleBoundsPredicate(Ea,sa,ua)&&za.push(xa)};this._traverseVisible({frustum:fa,clippingBox:ka},{predicate:(xa,Ea,Ia)=>{if(!Ia)return!1;if(0===Ea.childCount)return oa(xa),!1;Ia=this._index.getRenderObb(xa);return this._computeAveragePixelArea(Ia,Ea.lodThreshold,Ea.vertexCount,pa,va)<=wa?(oa(xa),!1):!0},pageMiss:(xa,Ea)=>{oa(xa);this._indexQueue.includes(Ea)||this._indexQueue.push(Ea)}});return za};
ia._getScale=function(Z){var ha=this._nodeScales.get(Z);null==ha&&(ha=this._index.getNode(Z).obb.center,this._tmpPoint.x=ha[0],this._tmpPoint.y=ha[1],this._tmpPoint.z=ha[2],ha=this.view.basemapTerrain.getScale(this._tmpPoint),this._nodeScales.set(Z,ha));return ha};ia._computeAveragePixelArea=function(Z,ha,fa,ka,la){Z=Math.max(1E-7,X.minimumDistancePlane(Z,ka));return ha/(Z*Z)/(4*la*la)/fa};ia._loadNode=function(Z,ha){try{return this._loadNodeAsync(Z,ha)}catch(fa){throw m.isAbortError(fa)||n.getLogger(this.declaredClass).error(fa),
fa;}};ia._loadAdditionalUserAttributes=function(){var Z=a._asyncToGenerator(function*(ha,fa,ka){var la=this.layer.outFields;if(!la)return[];la=K.unpackFieldNames(this.layer.fieldsIndex,la);ha=new Set(ha.map(va=>r.isSome(va)?va.name:null));const na=this.layer.attributeStorageInfo,pa=[];for(const va of la)ha.has(va)||(la=L.getAttributeInfo(na,va))&&pa.push(fa(la));fa=yield m.eachAlwaysValues(pa);m.throwIfAborted(ka);return r.mapSome(fa,va=>va)});return function(ha,fa,ka){return Z.apply(this,arguments)}}();
ia._loadNodeAsync=function(){var Z=a._asyncToGenerator(function*(ha,fa){var ka=this;const la=this._index.getNode(ha),na=L.getRendererInfo(this.layer),pa=L.getFilterInfo(this.layer),va=la.resourceId,wa=function(){var za=a._asyncToGenerator(function*(sa){if(r.isNone(sa))return null;if(sa.useElevation)return{attributeInfo:sa,buffer:null};const ua=yield ka._loadAttribute(va,sa,fa);return r.isSome(ua)?{attributeInfo:sa,buffer:ua}:null});return function(sa){return za.apply(this,arguments)}}();return this._idleQueue.push(a._asyncToGenerator(function*(){var za=
ka._loadGeometry(va,fa);const {primaryAttribute:sa,modulationAttribute:ua}=na,oa=wa(sa),xa=wa(ua);var Ea=pa.map(Za=>Za.attributeInfo);const Ia=Ea.map(Za=>wa(Za));Ea=ka._loadAdditionalUserAttributes([sa,ua,...Ea],wa,fa);const [Na,Oa,Ja,Sa,Ua]=yield Promise.all([za,oa,xa,Promise.all(Ia),Ea]);m.throwIfAborted(fa);za={geometryBuffer:Na,primaryAttributeData:Oa,modulationAttributeData:Ja,filterAttributesData:Sa,userAttributesData:Ua,schema:ka.layer.store.defaultGeometrySchema,rendererInfo:na,filterInfo:pa,
obb:ka._index.getRenderObb(ha),elevationOffset:ka._elevationOffset,inSR:ka.layer.spatialReference.toJSON(),outSR:ka.view.renderCoordsHelper.spatialReference.toJSON()};return ka._worker.invoke(za,fa)}),fa)});return function(ha,fa){return Z.apply(this,arguments)}}();ia._loadGeometry=function(){var Z=a._asyncToGenerator(function*(ha,fa){return this._requestData(`${this.baseUrl}/nodes/${ha}/geometries/0`,fa)});return function(ha,fa){return Z.apply(this,arguments)}}();ia._loadAttribute=function(){var Z=
a._asyncToGenerator(function*(ha,fa,ka){return r.isNone(fa)||!fa.storageInfo?null:this._requestData(`${this.baseUrl}/nodes/${ha}/attributes/${fa.storageInfo.key}`,ka)});return function(ha,fa,ka){return Z.apply(this,arguments)}}();ia._requestNodePage=function(Z,ha){return this._indexRequester.request(Z,"json",{query:{f:"json",token:this.layer.apiKey},signal:ha})};ia._requestData=function(Z,ha){return this._dataRequester.request(Z,"binary",{query:{token:this.layer.apiKey},signal:ha})};ia._removeFromRenderer=
function(Z){if(this._renderedNodes.has(Z)){const ha=this._renderer.removeNode(Z);this._renderedNodes.delete(Z);this._nodeScales.delete(Z);this._memCache.put(ha.id.toString(),ha,5*ha.coordinates.length+128)}};ia._addToRenderer=function(Z){this._renderedNodes.has(Z.id)||(this._renderedNodes.add(Z.id),this._renderer.addNode(Z))};ia._setupRendererData=function(Z,ha){const fa=this._index.getNode(Z),ka=Math.sqrt(fa.lodThreshold/fa.vertexCount),la=this._index.getRenderObb(Z);if(R.isInstanceOfNode(ha))return ha.splatSize=
ka,ha.obb=la,k.copy(ha.origin,ha.obb.center),ha;var na=.01*Math.max(la.halfSize[0],la.halfSize[1],la.halfSize[2]);if(ha.obb.halfSize[0]>la.halfSize[0]+na||ha.obb.halfSize[1]>la.halfSize[1]+na||ha.obb.halfSize[2]>la.halfSize[2]+na)0<this._maxLoggedBoxWarnings&&(na=pa=>`[${pa.halfSize[0]}, ${pa.halfSize[1]}, ${pa.halfSize[2]}]`,n.getLogger(this.declaredClass).warn(`Node ${Z} reported bounding box too small. got ${na(la)} but points cover ${na(ha.obb)}`),0===--this._maxLoggedBoxWarnings&&n.getLogger(this.declaredClass).warn("  Too many bounding box errors, stopping reporting for this layer.")),
this._index.setRenderObb(Z,ha.obb);return new R.PointRendererNode(Z,ka,p.clone(la.center),la,0===fa.childCount,ha.points,ha.rgb,ha.attributes,ha.pointIdFilterMap)};ia.getUsedMemory=function(){let Z=0;this._renderer.forEachNode(ha=>{Z+=160;Z+=e.estimateSize(ha.coordinates);for(const fa of ha.attributes)ha=fa.values,e.isArrayBuffer(ha.buffer)&&(Z+=e.estimateSize(ha))});return Z};ia.getUnloadedMemory=function(){var Z=this._renderedNodes.size;if(4>Z)return 0;const ha=[...this._renderedNodes].reduce((la,
na)=>la+this._index.getNode(na).vertexCount);let fa=this._loadingNodes.size;for(var ka=0;ka<this._workQueue.length;ka++)fa+=this._workQueue[ka].load.length,fa-=this._workQueue[ka].remove.length;if(0>fa)return 0;ka=fa*ha/Z;Z=(this.getUsedMemory()-160*Z)/ha;return ka*Z+160*fa};ia.ignoresMemoryFactor=function(){return!1};a._createClass(ja,[{key:"baseUrl",get:function(){return this.layer.parsedUrl.path}},{key:"pointScale",get:function(){const Z=L.getSplatSizeAlgorithm(this.layer&&this.layer.renderer);
return Z&&null!=Z.scaleFactor?Z.scaleFactor:1}},{key:"useRealWorldSymbolSizes",get:function(){const Z=L.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.useRealWorldSymbolSizes?Z.useRealWorldSymbolSizes:!1}},{key:"pointSize",get:function(){const Z=L.getFixedSizeAlgorithm(this.layer&&this.layer.renderer);return Z&&null!=Z.size?Z.size:0}},{key:"inverseDensity",get:function(){return this.layer&&this.layer.renderer?96/this.layer.renderer.pointsPerInch:5}},{key:"availableFields",
get:function(){var Z=L.getRendererInfo(this.layer);const ha=new Set;Z.primaryAttribute&&ha.add(Z.primaryAttribute.name);Z.modulationAttribute&&ha.add(Z.modulationAttribute.name);if(Z=L.getFilterInfo(this.layer))for(const fa of Z)fa.attributeInfo&&ha.add(fa.attributeInfo.name);if(this.layer.outFields)for(const fa of K.unpackFieldNames(this.layer.fieldsIndex,this.layer.outFields))ha.add(fa);return Array.from(ha)}},{key:"_clippingBox",get:function(){if(!this.view||!this.view.clippingArea)return null;
const Z=C.create();return V.projectToBoundingBox(this.view.clippingArea,Z,this.view.renderSpatialReference)?Z:null}},{key:"_elevationOffset",get:function(){const Z=this.layer&&this.layer.elevationInfo;if(Z&&"absolute-height"===Z.mode){const ha=g.getMetersPerVerticalUnitForSR(this.layer.spatialReference),fa=M.getMetersPerUnit(Z.unit);return r.unwrapOr(Z.offset,0)*fa/ha}return 0}},{key:"running",get:function(){return this.suspended?this._updateViewNeeded:this._updateViewNeeded||0<this._indexQueue.length||
0<this._workQueue.length||this._idleQueue.running}},{key:"updatingProgressValue",get:function(){if(this.suspended)return this._updateViewNeeded?0:1;const Z=this._computeWork();return 1-Math.min(this._totalWork,Z)/this._totalWork}},{key:"performanceInfo",get:function(){return{nodes:this._renderedNodes.size,displayedNumberOfFeatures:[...this._renderedNodes].reduce((Z,ha)=>Z+this._index.getNode(ha).vertexCount,0),maximumNumberOfFeatures:this.maximumPointCount,totalNumberOfFeatures:-1,core:null,"Loading Nodes":this._loadingNodes.size,
"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length}}},{key:"test",get:function(){return{index:this._index,visibleNodes:this._renderedNodes}}}]);return ja}(Q.PopupSceneLayerView(N.LayerView3D(U)));c.__decorate([h.property()],l.prototype,"layer",void 0);c.__decorate([h.property()],l.prototype,"baseUrl",null);c.__decorate([h.property()],l.prototype,"pointScale",null);c.__decorate([h.property()],l.prototype,"useRealWorldSymbolSizes",null);c.__decorate([h.property()],
l.prototype,"pointSize",null);c.__decorate([h.property()],l.prototype,"inverseDensity",null);c.__decorate([h.property()],l.prototype,"maximumPointCount",void 0);c.__decorate([h.property({readOnly:!0})],l.prototype,"availableFields",null);c.__decorate([h.property({readOnly:!0})],l.prototype,"_clippingBox",null);c.__decorate([h.property({readOnly:!0})],l.prototype,"_elevationOffset",null);c.__decorate([h.property({type:Boolean})],l.prototype,"slicePlaneEnabled",void 0);c.__decorate([h.property()],l.prototype,
"updating",void 0);c.__decorate([h.property(W.updatingProgress)],l.prototype,"updatingProgress",void 0);c.__decorate([h.property({readOnly:!0})],l.prototype,"updatingProgressValue",null);c=l=c.__decorate([q.subclass("esri.views.3d.layers.PointCloudLayerView3D")],l);const ea=B.create();return c})},"esri/views/3d/layers/PointCloudWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/workers/WorkerHandle"],function(a,c,b,t){t=function(n){function r(m){var d;
return d=n.call(this,"PointCloudWorker","transform",{transform:f=>d._getTransferList(f)},m)||this}c._inheritsLoose(r,n);r.prototype._getTransferList=function(m){const d=[m.geometryBuffer];b.isSome(m.primaryAttributeData)&&m.primaryAttributeData.buffer&&d.push(m.primaryAttributeData.buffer);b.isSome(m.modulationAttributeData)&&m.modulationAttributeData.buffer&&d.push(m.modulationAttributeData.buffer);if(b.isSome(m.filterAttributesData))for(const f of m.filterAttributesData)b.isSome(f)&&f.buffer&&d.push(f.buffer);
for(const f of m.userAttributesData)f.buffer&&d.push(f.buffer);return d};return r}(t.WorkerHandle);a.PointCloudWorkerHandle=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["exports","../../../../chunks/vec3"],function(a,c){function b(f,e,g){for(;0<f;){const h=e.indexOf(f);if(0<=h)return h;f=g.getParentId(f)}return e.indexOf(f)}function t(f,e,g){const h=[e.remove[0]],l=[];for(;1===h.length;){const q=h.pop();l.length=0;for(let k=
0;k<e.load.length;k++){let p=e.load[k];for(var v=g.getParentId(p);v!==q;)p=v,v=g.getParentId(p);v=h.indexOf(p);0>v&&(v=h.length,h.push(p),l.push([]));l[v].push(e.load[k])}}e.load=h;for(e=0;e<h.length;e++)1<l[e].length?f.push({remove:[h[e]],load:l[e]}):h[e]=l[e][0]}const n=[!1],r=[null],m=[!1],d=[null];a.nodeDiff=function(f,e,g){for(var h=0;h<e.length;h++)m[h]=!1,d[h]=null;for(h=0;h<f.length;h++)n[h]=!1,r[h]=null;for(h=0;h<e.length;h++){var l=b(e[h],f,g);0<=l&&(m[h]=!0,null!=r[l]?r[l].push(e[h]):r[l]=
[e[h]])}for(h=0;h<f.length;h++)l=b(f[h],e,g),0<=l&&(n[h]=!0,null!=d[l]?d[l].push(f[h]):d[l]=[f[h]]);g=[];for(h=0;h<f.length;h++)null!=r[h]||n[h]||g.push({load:[],remove:[f[h]]});for(h=0;h<e.length;h++)null!=d[h]||m[h]||g.push({load:[e[h]],remove:[]});for(h=0;h<e.length;h++)null!=d[h]&&(1<d[h].length||d[h][0]!==e[h])&&g.push({load:[e[h]],remove:d[h]});for(e=0;e<f.length;e++)null!=r[e]&&(1<r[e].length||r[e][0]!==f[e])&&g.push({load:r[e],remove:[f[e]]});return g};a.sortFrontToBack=function(f,e,g){return f.sort((h,
l)=>{if(0===h.load.length&&0===l.load.length)return 0;if(0===h.load.length)return-1;if(0===l.load.length)return 1;if(0===h.remove.length&&0===l.remove.length)return h=g.getRenderCenter(h.load[0]),l=g.getRenderCenter(l.load[0]),c.dot(h,e)-c.dot(l,e);if(0===h.remove.length)return-1;if(0===l.remove.length)return 1;if(1===h.load.length&&1===l.load.length)return h=g.getRenderCenter(h.load[0]),l=g.getRenderCenter(l.load[0]),c.dot(h,e)-c.dot(l,e);if(1===h.load.length)return-1;if(1===l.load.length)return 1;
h=g.getRenderCenter(h.remove[0]);l=g.getRenderCenter(l.remove[0]);return c.dot(h,e)-c.dot(l,e)})};a.splitWorkEntries=function(f,e,g){for(let h=0;h<f.length;++h){const l=f[h];l.load.length>e&&1===l.remove.length&&t(f,l,g)}};a.splitWorkEntry=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define(["../../../../geometry/support/aaBoundingBox","./I3SUtil","../../support/orientedBoundingBox"],function(a,c,b){return function(){function t(r,
m,d){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=r;this._renderSR=m;this.pageSize=d}var n=t.prototype;n.addPage=function(r,m,d=0){for(;this._pages.length<r;)this._pages.push(null);var f=this._nodeSR,e=this._renderSR,g=new b.ObbArray(m.length);for(var h=0;h<m.length;h++)c.transformObb(m[h].obb,f,g.obbs[h],e,d);this._pages[r]={nodes:m,renderObbs:g.obbs,parents:new Uint32Array(this.pageSize)};r=this._pages;m=this.pageSize;for(d=[0];d.length;)for(f=d.pop(),e=r[f/m|0].nodes[f%
m],g=0;g<e.childCount;g++)h=e.firstChild+g,null!=r[h/m|0]&&(r[h/m|0].parents[h%m]=f,d.push(h))};n.hasPage=function(r){return!!this._pages[r]};n.getNode=function(r){const m=this.pageSize;return this._pages[r/m|0].nodes[r%m]};n.getRenderObb=function(r){const m=this.pageSize;return this._pages[r/m|0].renderObbs[r%m]};n.getRenderCenter=function(r){return this.getRenderObb(r).center};n.setRenderObb=function(r,m){const d=this.pageSize;b.set(m,this._pages[r/d|0].renderObbs[r%d])};n.getParentId=function(r){const m=
this.pageSize;return this._pages[r/m|0].parents[r%m]};n.hasNodes=function(r,m){var d=r/this.pageSize|0;for(r=(r+m-1)/this.pageSize|0;d<=r;d++)if(null==this._pages[d])return!1;return!0};n.forEachNodeId=function(r){for(let m=0;m<this._pages.length;m++){const d=this._pages[m];if(d)for(let f=0;f<d.nodes.length;f++)r(m*this.pageSize+f)}};n.createVisibilityTraverse=function(){var r=this,m=[],d=[],f=a.create();return(e,g)=>{if(r.hasNodes(0,1))for(m.length=0,m.push(0),d.length=0,d.push(0);0<m.length;){var h=
m.pop();let z=d.pop();var l=r.getNode(h),v=r.getRenderObb(h),q=!0;if(null!=e.clippingBox){var k=1<<e.frustum.length;if(0===(z&k)){var p=b.toAaBoundingBox(v,f);a.contains(e.clippingBox,p)?z|=k:a.intersects(e.clippingBox,p)||(q=!1)}}for(k=0;k<e.frustum.length&&q;k++)if(p=1<<k,0===(z&p)){const C=b.intersectPlane(v,e.frustum[k]);0<C?q=!1:0>C&&(z|=p)}if(g.predicate(h,l,q)){v=l.firstChild;l=l.childCount;q=!1;p=v/r.pageSize|0;for(k=(v+l-1)/r.pageSize|0;p<=k;p++)if(!r.hasPage(p)){g.pageMiss(h,p);q=!0;break}if(!q)for(h=
0;h<l;h++)m.push(v+h),d.push(z)}}}};return t}()})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define(["exports"],function(a){function c(t,n){for(const r of t??[])if(r.name===n&&null!=r.attributeValues&&"UInt8"===r.attributeValues.valueType&&3===r.attributeValues.valuesPerElement)return{name:n,storageInfo:r,useElevation:!1};return null}function b(t,n){for(const r of t??[])if(r.name===n)return t="embedded-elevation"===r.encoding,{name:n,storageInfo:t?null:r,useElevation:t};return"elevation"===
n?.toLowerCase()?{name:n,storageInfo:null,useElevation:!0}:null}a.getAttributeInfo=b;a.getFilterInfo=function(t){const n=t.filters;return n?n.map(r=>({filterJSON:r.toJSON(),attributeInfo:b(t.attributeStorageInfo,r.field)})):[]};a.getFixedSizeAlgorithm=function(t){return(t=t?.pointSizeAlgorithm)&&"fixed-size"===t.type?t:null};a.getRendererInfo=function(t){const n=t.renderer;var r=n?.type;const m=n?.toJSON()??null;let d=null,f=!1;t=t.attributeStorageInfo;"point-cloud-unique-value"===r?d=b(t,n.field):
"point-cloud-stretch"===r?d=b(t,n.field):"point-cloud-class-breaks"===r?d=b(t,n.field):(d="point-cloud-rgb"===r?c(t,n.field):c(t,"RGB"),f=null!=d);r=null;n?.colorModulation&&(r=b(t,n.colorModulation.field));return{rendererJSON:m,isRGBRenderer:f,primaryAttribute:d,modulationAttribute:r}};a.getSplatSizeAlgorithm=function(t){return(t=t?.pointSizeAlgorithm)&&"splat"===t.type?t:null};a.rendererUsesFixedSizes=function(t){return(t=t?.pointSizeAlgorithm)&&t.type?"fixed-size"===t.type:!1};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointCloudWorkerUtil":function(){define("exports ../../../../core/maybe ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader ./LEPCC".split(" "),function(a,c,b,t,n,r,m){function d(g,h){const l=new Float64Array(h);for(let v=0;v<h;v++)l[v]=g[3*v+2];return l}function f(g){return null==g||"none"===g?null:"low-four-bit"===
g?h=>h&15:"high-four-bit"===g?h=>(h&240)>>4:"absolute-value"===g?h=>Math.abs(h):"modulo-ten"===g?h=>h%10:null}function e(g){let h=0;for(const l of g?g:[])h|=1<<l;return h}a.elevationFromPositions=d;a.evaluateRenderer=function(g,h,l,v){const {rendererJSON:q,isRGBRenderer:k}=g;var p=g=null;if(h&&k)g=h;else if(h&&"pointCloudUniqueValueRenderer"===q?.type){p=n.fromJSON(q);var z=p.colorUniqueValueInfos;g=new Uint8Array(3*v);var C=f(p.fieldTransformType);for(var B=0;B<v;B++){var A=(C?C(h[B]):h[B])+"";for(var x=
0;x<z.length;x++)if(z[x].values.includes(A)){g[3*B]=z[x].color.r;g[3*B+1]=z[x].color.g;g[3*B+2]=z[x].color.b;break}}}else if(h&&"pointCloudStretchRenderer"===q?.type)for(p=t.fromJSON(q),z=p.stops,g=new Uint8Array(3*v),C=f(p.fieldTransformType),B=0;B<v;B++)if(A=C?C(h[B]):h[B],x=z.length-1,A<z[0].value)g[3*B]=z[0].color.r,g[3*B+1]=z[0].color.g,g[3*B+2]=z[0].color.b;else if(A>=z[x].value)g[3*B]=z[x].color.r,g[3*B+1]=z[x].color.g,g[3*B+2]=z[x].color.b;else for(x=1;x<z.length;x++){if(A<z[x].value){A=(A-
z[x-1].value)/(z[x].value-z[x-1].value);g[3*B]=z[x].color.r*A+z[x-1].color.r*(1-A);g[3*B+1]=z[x].color.g*A+z[x-1].color.g*(1-A);g[3*B+2]=z[x].color.b*A+z[x-1].color.b*(1-A);break}}else if(h&&"pointCloudClassBreaksRenderer"===q?.type)for(p=b.fromJSON(q),z=p.colorClassBreakInfos,g=new Uint8Array(3*v),C=f(p.fieldTransformType),B=0;B<v;B++)for(A=C?C(h[B]):h[B],x=0;x<z.length;x++){if(A>=z[x].minValue&&A<=z[x].maxValue){g[3*B]=z[x].color.r;g[3*B+1]=z[x].color.g;g[3*B+2]=z[x].color.b;break}}else for(g=new Uint8Array(3*
v),h=0;h<g.length;h++)g[h]=255;if(l&&p&&p.colorModulation)for(h=p.colorModulation.minValue,p=p.colorModulation.maxValue,z=0;z<v;z++)C=l[z],C=C>=p?1:C<=h?.3:.3+.7*(C-h)/(p-h),g[3*z]*=C,g[3*z+1]*=C,g[3*z+2]*=C;return g};a.filterInPlace=function(g,h,l,v,q){const k=g.length/3;let p=0;for(let u=0;u<k;u++){let y=!0;for(let w=0;w<v.length&&y;w++){var {filterJSON:z}=v[w],C=q[w].values[u];switch(z.type){case "pointCloudValueFilter":var B="exclude"===z.mode;z.values.includes(C)===B&&(y=!1);break;case "pointCloudBitfieldFilter":B=
e(z.requiredSetBits);z=e(z.requiredClearBits);if((C&B)!==B||0!==(C&z))y=!1;break;case "pointCloudReturnFilter":var A=C&15,x=C>>>4&15;C=1<x;B=1===A;A=A===x;x=!1;for(const D of z.includedReturns)if("last"===D&&A||"firstOfMany"===D&&B&&C||"lastOfMany"===D&&A&&C||"single"===D&&!C){x=!0;break}x||(y=!1)}}y&&(l[p]=u,g[3*p]=g[3*u],g[3*p+1]=g[3*u+1],g[3*p+2]=g[3*u+2],h[3*p]=h[3*u],h[3*p+1]=h[3*u+1],h[3*p+2]=h[3*u+2],p++)}return p};a.getAttributeValues=function(g,h,l){return c.isSome(g)&&g.attributeInfo.useElevation?
h?d(h,l):null:c.isSome(g)&&g.attributeInfo.storageInfo?r.readBinaryAttribute(g.attributeInfo.storageInfo,g.buffer,l):null};a.readGeometry=function(g,h){if(null==g.encoding||""===g.encoding){g=r.createGeometryIndexFromSchema(h,g);if(c.isNone(g.vertexAttributes.position))return;h=r.createTypedView(h,g.vertexAttributes.position);var l=g.header.fields;g=[l.offsetX,l.offsetY,l.offsetZ];l=[l.scaleX,l.scaleY,l.scaleZ];const v=h.length/3,q=new Float64Array(3*v);for(let k=0;k<v;k++)q[3*k]=h[3*k]*l[0]+g[0],
q[3*k+1]=h[3*k+1]*l[1]+g[1],q[3*k+2]=h[3*k+2]*l[2]+g[2];return q}if("lepcc-xyz"===g.encoding)return m.decodeXYZ(h).result};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(a,c,b,t,n,r,m,d,f,e){var g;n=g=function(h){function l(v){v=h.call(this,v)||this;v.type="point-cloud-class-breaks";v.field=null;v.legendOptions=null;v.fieldTransformType=null;v.colorClassBreakInfos=null;return v}a._inheritsLoose(l,h);l.prototype.clone=function(){return new g({...this.cloneProperties(),field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:b.clone(this.colorClassBreakInfos),legendOptions:b.clone(this.legendOptions)})};return l}(d);c.__decorate([r.enumeration({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
n.prototype,"type",void 0);c.__decorate([t.property({json:{write:!0},type:String})],n.prototype,"field",void 0);c.__decorate([t.property({type:f.LegendOptions,json:{write:!0}})],n.prototype,"legendOptions",void 0);c.__decorate([t.property({type:d.fieldTransformTypeKebabDict.apiValues,json:{type:d.fieldTransformTypeKebabDict.jsonValues,read:d.fieldTransformTypeKebabDict.read,write:d.fieldTransformTypeKebabDict.write}})],n.prototype,"fieldTransformType",void 0);c.__decorate([t.property({type:[e],json:{write:!0}})],
n.prototype,"colorClassBreakInfos",void 0);return n=g=c.__decorate([m.subclass("esri.renderers.PointCloudClassBreaksRenderer")],n)})},"esri/renderers/PointCloudRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/jsonMap ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e){m=b.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});t=function(g){function h(v){v=g.call(this,v)||this;v.type=void 0;v.pointSizeAlgorithm=null;v.colorModulation=null;v.pointsPerInch=10;return v}a._inheritsLoose(h,g);var l=h.prototype;l.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);
return null};l.cloneProperties=function(){return{pointSizeAlgorithm:n.clone(this.pointSizeAlgorithm),colorModulation:n.clone(this.colorModulation),pointsPerInch:n.clone(this.pointsPerInch)}};return h}(t.JSONSupport);c.__decorate([r.property({type:m.apiValues,readOnly:!0,nonNullable:!0,json:{type:m.jsonValues,read:!1,write:m.write}})],t.prototype,"type",void 0);c.__decorate([r.property({types:e.pointSizeAlgorithmTypes,json:{write:!0}})],t.prototype,"pointSizeAlgorithm",void 0);c.__decorate([r.property({type:f,
json:{write:!0}})],t.prototype,"colorModulation",void 0);c.__decorate([r.property({json:{write:!0},nonNullable:!0,type:Number})],t.prototype,"pointsPerInch",void 0);t=c.__decorate([d.subclass("esri.renderers.PointCloudRenderer")],t);(t||(t={})).fieldTransformTypeKebabDict=new b.JSONMap({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return t})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m){var d;b=d=function(f){function e(){var g=f.apply(this,arguments)||this;g.field=null;g.minValue=0;g.maxValue=255;return g}a._inheritsLoose(e,f);e.prototype.clone=function(){return new d({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};return e}(b.JSONSupport);c.__decorate([t.property({type:String,json:{write:!0}})],b.prototype,"field",void 0);c.__decorate([t.property({type:Number,nonNullable:!0,json:{write:!0}})],b.prototype,"minValue",void 0);c.__decorate([t.property({type:Number,
nonNullable:!0,json:{write:!0}})],b.prototype,"maxValue",void 0);return b=d=c.__decorate([m.subclass("esri.renderers.support.pointCloud.ColorModulation")],b)})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(a,c,b,t){a.pointSizeAlgorithmTypes={key:"type",base:c,typeMap:{"fixed-size":b,splat:t}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/jsonMap ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d){b=new b.JSONMap({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});t=function(f){function e(){return f.apply(this,arguments)||this}a._inheritsLoose(e,f);return e}(t.JSONSupport);c.__decorate([n.property({type:b.apiValues,readOnly:!0,nonNullable:!0,json:{type:b.jsonValues,read:!1,write:b.write}})],t.prototype,"type",void 0);return t=c.__decorate([d.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],t)})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,c,b,t,n,r,m,d){var f;t=f=function(e){function g(){var h=e.apply(this,arguments)||this;h.type="fixed-size";h.size=0;h.useRealWorldSymbolSizes=null;return h}a._inheritsLoose(g,e);g.prototype.clone=function(){return new f({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};return g}(d);c.__decorate([r.enumeration({pointCloudFixedSizeAlgorithm:"fixed-size"})],t.prototype,"type",void 0);c.__decorate([b.property({type:Number,nonNullable:!0,json:{write:!0}})],t.prototype,"size",
void 0);c.__decorate([b.property({type:Boolean,json:{write:!0}})],t.prototype,"useRealWorldSymbolSizes",void 0);return t=f=c.__decorate([m.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],t)})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass ./PointSizeAlgorithm".split(" "),
function(a,c,b,t,n,r,m,d){var f;t=f=function(e){function g(){var h=e.apply(this,arguments)||this;h.type="splat";h.scaleFactor=1;return h}a._inheritsLoose(g,e);g.prototype.clone=function(){return new f({scaleFactor:this.scaleFactor})};return g}(d);c.__decorate([r.enumeration({pointCloudSplatAlgorithm:"splat"})],t.prototype,"type",void 0);c.__decorate([b.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],t.prototype,"scaleFactor",void 0);return t=f=c.__decorate([m.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],
t)})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,c,b,t,n,r,m,d){var f;t=f=function(e){function g(){var h=e.apply(this,arguments)||this;h.description=null;h.label=null;h.minValue=
0;h.maxValue=0;h.color=null;return h}a._inheritsLoose(g,e);g.prototype.clone=function(){return new f({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:n.clone(this.color)})};return g}(t.JSONSupport);c.__decorate([r.property({type:String,json:{write:!0}})],t.prototype,"description",void 0);c.__decorate([r.property({type:String,json:{write:!0}})],t.prototype,"label",void 0);c.__decorate([r.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],
t.prototype,"minValue",void 0);c.__decorate([r.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],t.prototype,"maxValue",void 0);c.__decorate([r.property({type:b,json:{type:[m.Integer],write:!0}})],t.prototype,"color",void 0);return t=f=c.__decorate([d.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],t)})},"esri/renderers/PointCloudStretchRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./visualVariables/support/ColorStop".split(" "),
function(a,c,b,t,n,r,m,d,f,e){var g;n=g=function(h){function l(v){v=h.call(this,v)||this;v.type="point-cloud-stretch";v.field=null;v.legendOptions=null;v.fieldTransformType=null;v.stops=null;return v}a._inheritsLoose(l,h);l.prototype.clone=function(){return new g({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),stops:b.clone(this.stops),legendOptions:b.clone(this.legendOptions)})};return l}(d);c.__decorate([r.enumeration({pointCloudStretchRenderer:"point-cloud-stretch"})],
n.prototype,"type",void 0);c.__decorate([t.property({json:{write:!0},type:String})],n.prototype,"field",void 0);c.__decorate([t.property({type:f.LegendOptions,json:{write:!0}})],n.prototype,"legendOptions",void 0);c.__decorate([t.property({type:d.fieldTransformTypeKebabDict.apiValues,json:{type:d.fieldTransformTypeKebabDict.jsonValues,read:d.fieldTransformTypeKebabDict.read,write:d.fieldTransformTypeKebabDict.write}})],n.prototype,"fieldTransformType",void 0);c.__decorate([t.property({type:[e],json:{write:!0}})],
n.prototype,"stops",void 0);return n=g=c.__decorate([m.subclass("esri.renderers.PointCloudStretchRenderer")],n)})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/lang ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/enumeration ../core/accessorSupport/decorators/subclass ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(a,c,b,t,n,r,m,d,f,e){var g;n=g=function(h){function l(v){v=h.call(this,v)||this;v.type="point-cloud-unique-value";v.field=null;v.fieldTransformType=null;v.colorUniqueValueInfos=null;v.legendOptions=null;return v}a._inheritsLoose(l,h);l.prototype.clone=function(){return new g({...this.cloneProperties(),field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),colorUniqueValueInfos:b.clone(this.colorUniqueValueInfos),legendOptions:b.clone(this.legendOptions)})};return l}(d);
c.__decorate([r.enumeration({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],n.prototype,"type",void 0);c.__decorate([t.property({json:{write:!0},type:String})],n.prototype,"field",void 0);c.__decorate([t.property({type:d.fieldTransformTypeKebabDict.apiValues,json:{type:d.fieldTransformTypeKebabDict.jsonValues,read:d.fieldTransformTypeKebabDict.read,write:d.fieldTransformTypeKebabDict.write}})],n.prototype,"fieldTransformType",void 0);c.__decorate([t.property({type:[e],json:{write:!0}})],
n.prototype,"colorUniqueValueInfos",void 0);c.__decorate([t.property({type:f.LegendOptions,json:{write:!0}})],n.prototype,"legendOptions",void 0);return n=g=c.__decorate([m.subclass("esri.renderers.PointCloudUniqueValueRenderer")],n)})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d){var f;t=f=function(e){function g(){var h=e.apply(this,arguments)||this;h.description=null;h.label=null;h.values=null;h.color=null;return h}a._inheritsLoose(g,e);g.prototype.clone=function(){return new f({description:this.description,label:this.label,values:n.clone(this.values),color:n.clone(this.color)})};return g}(t.JSONSupport);c.__decorate([r.property({type:String,json:{write:!0}})],t.prototype,"description",void 0);c.__decorate([r.property({type:String,json:{write:!0}})],
t.prototype,"label",void 0);c.__decorate([r.property({type:[String],json:{write:!0}})],t.prototype,"values",void 0);c.__decorate([r.property({type:b,json:{type:[m.Integer],write:!0}})],t.prototype,"color",void 0);return t=f=c.__decorate([d.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],t)})},"esri/views/3d/layers/i3s/PointGraphic":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,c,b,t,n,r,m,d){a.PointGraphic=function(f){function e(g){return f.call(this,g)||this}c._inheritsLoose(e,f);return e}(t);b.__decorate([n.property({constructOnly:!0,clonable:"reference"})],a.PointGraphic.prototype,"pointCloudMetadata",void 0);a.PointGraphic=b.__decorate([d.subclass("esri.views.3d.layers.i3s.PointGraphic")],a.PointGraphic);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/plane ../../../../geometry/support/ray ./Intersector ./PointHighlights ../../support/orientedBoundingBox ../../webgl-engine/core/shaderLibrary/ShaderOutput ../../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/VertexArrayObject ../../webgl-engine/lib/VertexAttribute ../../../../chunks/PointRenderer.glsl ../../webgl-engine/shaders/PointRendererTechnique ../../webgl-engine/shaders/PointRendererTechniqueConfiguration ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexElementDescriptor".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w){function D(P,I,G,H,L){if(G.drawScreenSpace)return G.fixedSize*I*H;L=B.getMaxPointSizeScreenspace(L)*I*H;return G.useFixedSizes?Math.min(G.fixedSize/2,L):0<G.screenMinSize?Math.min(Math.max(G.screenMinSize*I*H,P/2),L):Math.min(P/2,L)}function F(P,I,G,H,L){return G.drawScreenSpace?0:D(P,I,G,H,L)}function E(P){return b.isSome(P.component)?P.component:-1}function K(P,I){if(b.isNone(P))return P;P=P.filter(G=>G.id!==I);return 0===P.length?null:
P}function J(P){return b.isSome(P.dist)&&b.isSome(P.point)&&b.isSome(P.pointId)&&b.isSome(P.node)}const M={positions:[new w.VertexElementDescriptor(C.VertexAttribute.POSITION,3,y.DataType.FLOAT,0,12)],colors:[new w.VertexElementDescriptor(C.VertexAttribute.COLOR,3,y.DataType.UNSIGNED_BYTE,0,3,!0)]};C=function(){function P(G){this._params=G;this.type=p.IntersectorType.PCL;this.isGround=!1;this._passParameters=new B.PointRendererPassParameters;this._highlights=new h.PointHighlights({forEachNode:H=>
this.forEachNode(H),addHighlight:(H,L,O)=>this._addHighlight(H,L,O),removeHighlight:(H,L)=>this._removeHighlight(H,L)});this.canRender=!0;this.layerUid="";this._slicePlaneEnabled=!1;this._techniqueConfig=new x.PointRendererTechniqueConfiguration;this._nodes=new t}var I=P.prototype;I.initializeRenderContext=function(G){this._context=G;this._techniqueRepository=this._context.techniqueRepository;G.requestRender()};I.uninitializeRenderContext=function(){};I.intersect=function(G,H,L,O){const S=r.create(),
R=r.create(),Q=r.create(),V=r.create(),aa=f.create(),X=G.camera.perScreenPixelRatio/2,W=G.camera.near;n.subtract(R,O,L);const T=1/n.length(R);n.scale(R,R,T);n.negate(Q,R);m.set(aa,R[0],R[1],R[2],-n.dot(R,L));const U=new N,Y=new N,ba=[],da=d.create(),ea=d.create(this._passParameters.clipBox);d.offset(ea,-L[0],-L[1],-L[2],ea);this._nodes.forAll(Z=>{const ha=Z.splatSize*this._passParameters.scaleFactor;var fa=l.minimumDistancePlane(Z.obb,aa),ka=l.maximumDistancePlane(Z.obb,aa);fa-=F(ha,fa+W,this._passParameters,
X,Z.isLeaf);ka-=F(ha,ka+W,this._passParameters,X,Z.isLeaf);fa=null!=U.dist&&null!=Y.dist&&U.dist<fa*T&&Y.dist>ka*T;if(!(0>ka||fa)&&(ka=D(ha,ka+W,this._passParameters,X,Z.isLeaf),l.intersectLine(Z.obb,L,R,ka))){ka*=ka;l.toAaBoundingBox(Z.obb,da);d.offset(da,-L[0],-L[1],-L[2],da);fa=!d.contains(ea,da);n.subtract(V,Z.origin,L);var la=Z.coordinates.length/3;for(let wa=0;wa<la;wa++){S[0]=V[0]+Z.coordinates[3*wa];S[1]=V[1]+Z.coordinates[3*wa+1];S[2]=V[2]+Z.coordinates[3*wa+2];if(fa&&!d.containsPoint(ea,
S))continue;var na=n.dot(S,R),pa=n.squaredLength(S)-na*na;if(pa>ka)continue;var va=na+W;const za=F(ha,va,this._passParameters,X,Z.isLeaf);if(0>na-za)continue;va-=za;va=D(ha,va,this._passParameters,X,Z.isLeaf);if(pa>va*va)continue;const sa=(na-za)*T;na=ua=>{var oa=wa,xa=ua.point;b.isNone(xa)&&(xa=r.create());xa[0]=Z.origin[0]+Z.coordinates[3*oa];xa[1]=Z.origin[1]+Z.coordinates[3*oa+1];xa[2]=Z.origin[2]+Z.coordinates[3*oa+2];ua.point=xa;ua.dist=sa;ua.normal=Q;ua.node=Z;ua.pointId=wa;ua.layerUid=this.layerUid;
return ua};(null==U.dist||sa<U.dist)&&(null==H||H(L,O,sa))&&na(U);G.options.store!==p.StoreResults.MIN&&(null==Y.dist||sa>Y.dist)&&(null==H||H(L,O,sa))&&na(Y);G.options.store!==p.StoreResults.ALL||null!=H&&!H(L,O,sa)||(pa=new N,ba.push(na(pa)))}}});const ca=Z=>{const {layerUid:ha,node:fa,pointId:ka}=Z;return new g.PclTarget(Z.point,ha,ka,()=>this._params.createGraphic(fa,ka,Z.point))},ja=(Z,ha)=>{const fa=ca(ha);Z.set(this.type,fa,ha.dist,ha.normal)};if(J(U)){var ia=G.results.min;(null==ia.dist||
U.dist<ia.dist)&&ja(ia,U)}J(Y)&&G.options.store!==p.StoreResults.MIN&&(ia=G.results.max,(null==ia.dist||Y.dist>ia.dist)&&ja(ia,Y));if(G.options.store===p.StoreResults.ALL){ia=e.fromPoints(L,O);for(const Z of ba){const ha=k.newIntersectorResult(ia);ja(ha,Z);G.results.all.push(ha)}}};I.prepareTechnique=function(G){if(0===this._nodes.length||G.output!==v.ShaderOutput.Color&&G.output!==v.ShaderOutput.Depth&&G.output!==v.ShaderOutput.Highlight)return null;this._nodes.forAll(H=>{null==H.vao&&this._initNode(G,
H)});this._techniqueConfig.drawScreenSize=this._passParameters.drawScreenSpace;this._techniqueConfig.useFixedSizes=this._passParameters.useFixedSizes;this._techniqueConfig.hasSlicePlane=this._slicePlaneEnabled;this._techniqueConfig.hasOccludees=G.bindParameters.hasOccludees;this._techniqueConfig.clippingEnabled=this._clippingEnabled;this._techniqueConfig.output=G.output===v.ShaderOutput.Depth?v.ShaderOutput.Depth:G.output===v.ShaderOutput.Highlight?v.ShaderOutput.Highlight:v.ShaderOutput.Color;return this._techniqueRepository.releaseAndAcquire(A.PointRendererTechnique,
this._techniqueConfig,this._technique)};I.render=function(G,H){const L=G.rctx,O=L.bindTechnique(H,this._passParameters,G.bindParameters),S=G.output===v.ShaderOutput.Highlight;this._nodes.forAll(R=>{0===R.coordinates.length||S&&!R.highlights||(O.bindDraw(R,G.bindParameters,this._passParameters),L.bindVAO(R.vao),S?this._renderHighlightFragments(L,R):L.drawArrays(y.PrimitiveType.POINTS,0,R.coordinates.length/3))})};I._renderHighlightFragments=function(G,H){var L=H.highlights;if(!b.isNone(L)){H=b.unwrap(L[0].component);
var O=H+1;for(let S=1;S<L.length;S++){const R=b.unwrap(L[S].component);R!==O&&(O-=H,0<O&&G.drawArrays(y.PrimitiveType.POINTS,H,O),H=R);O=R+1}L=O-H;0<L&&G.drawArrays(y.PrimitiveType.POINTS,H,L)}};I.addNode=function(G){this._nodes.push(G);this._highlights.nodeAdded(G);this._requestRender()};I.removeNode=function(G){let H=null;this._nodes.filterInPlace(L=>L.id===G?(H=L,L.vao=b.disposeMaybe(L.vao),this._highlights.nodeRemoved(L),!1):!0);this._requestRender();return H};I.forEachNode=function(G){this._nodes.forAll(G)};
I.removeAll=function(){this._nodes.forAll(G=>G.vao=b.disposeMaybe(G.vao));this._highlights.removeAll();this._nodes.clear();this._requestRender()};I.highlight=function(G){return this._highlights.add(G)};I._addHighlight=function(G,H,L){var O=G.highlights;b.isNone(O)&&(O=[]);H={component:H,id:L};O.push(H);H=E(H);for(L=O.length-1;0<L&&H<E(O[L-1]);)[O[L-1],O[L]]=[O[L],O[L-1]],--L;G.highlights=O;this._requestRender()};I._removeHighlight=function(G,H){G.highlights=K(G.highlights,H);this._requestRender()};
I._initNode=function(G,H){G=G.rctx;H.vao=new z.VertexArrayObject(G,q.Default3D,M,{positions:u.BufferObject.createVertex(G,y.Usage.STATIC_DRAW,H.coordinates),colors:u.BufferObject.createVertex(G,y.Usage.STATIC_DRAW,H.rgb)})};I._requestRender=function(){this._context&&this._context.requestRender()};c._createClass(P,[{key:"needsHighlight",get:function(){return this._highlights.hasHighlights}},{key:"useFixedSizes",get:function(){return this._passParameters.useFixedSizes},set:function(G){this._passParameters.useFixedSizes!==
G&&(this._passParameters.useFixedSizes=G,this._requestRender())}},{key:"scaleFactor",get:function(){return this._passParameters.scaleFactor},set:function(G){this._passParameters.scaleFactor!==G&&(this._passParameters.scaleFactor=G,this._requestRender())}},{key:"minSizePx",get:function(){return this._passParameters.minSizePx},set:function(G){this._passParameters.minSizePx!==G&&(this._passParameters.minSizePx=G,this._requestRender())}},{key:"useRealWorldSymbolSizes",get:function(){return this._passParameters.useRealWorldSymbolSizes},
set:function(G){this._passParameters.useRealWorldSymbolSizes!==G&&(this._passParameters.useRealWorldSymbolSizes=G,this._requestRender())}},{key:"size",get:function(){return this._passParameters.size},set:function(G){this._passParameters.size!==G&&(this._passParameters.size=G,this._requestRender())}},{key:"sizePx",get:function(){return this._passParameters.sizePx},set:function(G){this._passParameters.sizePx!==G&&(this._passParameters.sizePx=G,this._requestRender())}},{key:"clippingBox",set:function(G){d.set(this._passParameters.clipBox,
G||d.POSITIVE_INFINITY)}},{key:"_clippingEnabled",get:function(){return!d.equals(this._passParameters.clipBox,d.POSITIVE_INFINITY,(G,H)=>G===H)}},{key:"slicePlaneEnabled",get:function(){return this._slicePlaneEnabled},set:function(G){this._slicePlaneEnabled!==G&&(this._slicePlaneEnabled=G,this._requestRender())}}]);return P}();w=function(P){function I(G,H,L,O,S,R,Q,V,aa=null,X=null){H=P.call(this,L,S,H)||this;H.id=G;H.obb=O;H.coordinates=R;H.rgb=Q;H.attributes=V;H.pointIdFilterMap=aa;H.highlights=
X;return H}c._inheritsLoose(I,P);return I}(B.PointRendererDrawParameters);let N=function(){this.normal=this.dist=this.point=this.pointId=this.node=null;this.layerUid=""};a.PointRenderer=C;a.PointRendererNode=w;a.isInstanceOfNode=function(P){return P.hasOwnProperty("splatSize")};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/PointHighlights":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/handleUtils ../../../../core/maybe ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,c,b,t,n,r){let m=function(){function f(g){this._context=g;this._highlights=new Set}var e=f.prototype;e.destroy=function(){this._highlights=null};e.add=function(g){const h=new d(g);this._highlights.add(h);this._enableSet(h);return b.makeHandle(()=>this._removeSet(h))};e._removeSet=function(g){this._disableSet(g);this._highlights.delete(g)};e._enableSet=function(g){g.enabled||(g.enabled=!0,this._context.forEachNode(h=>this._enableSetForNode(g,h)))};e._enableSetForNode=function(g,h){if(g.enabled){var l=
g.ids.get(h.id);l&&l.forEach(v=>this._context.addHighlight(h,v,g.id))}};e._disableSet=function(g){g.enabled&&(g.enabled=!1,this._context.forEachNode(h=>this._disableSetForNode(g,h)))};e._disableSetForNode=function(g,h){g.enabled||this._context.removeHighlight(h,g.id)};e.nodeAdded=function(g){this._highlights.forEach(h=>this._enableSetForNode(h,g))};e.nodeRemoved=function(g){this._highlights.forEach(h=>this._disableSetForNode(h,g))};e.removeAll=function(){this._highlights.forEach(g=>this._disableSet(g))};
c._createClass(f,[{key:"hasHighlights",get:function(){return 0<this._highlights.size}}]);return f}(),d=function(){function f(e){this.id=new r.Object3DStateID(n.Object3DState.Highlight);this.ids=new Map;this.enabled=!1;for(const g of e)t.isSome(g)&&this._add(g.nodeId,g.pointId)}f.prototype._add=function(e,g){const h=this.ids.get(e);h?h.add(g):this.ids.set(e,new Set([g]))};return f}();a.PointHighlights=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/PointRenderer.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/mathUtils ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../geometry/support/aaBoundingBox ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutput ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u){function y(M){const N=new x.ShaderBuilder,P=M.output===h.ShaderOutput.Color,I=M.output===h.ShaderOutput.Depth,G=M.output===h.ShaderOutput.Highlight,{vertex:H,fragment:L}=N;N.extensions.add("GL_OES_standard_derivatives");N.include(l.SliceDraw,M);N.attributes.add(u.VertexAttribute.POSITION,"vec3");N.attributes.add(u.VertexAttribute.COLOR,"vec3");H.uniforms.add([new B.Matrix4DrawUniform("modelView",(O,S)=>t.multiply(E,S.camera.viewMatrix,t.fromTranslation(E,
O.origin))),new A.Matrix4PassUniform("proj",(O,S)=>S.camera.projectionMatrix),new k.Float2DrawUniform("screenMinMaxSize",(O,S,R)=>r.set(J,R.useFixedSizes?0:R.minSizePx*S.camera.pixelRatio,(O.isLeaf?256:64)*S.camera.pixelRatio))]);H.uniforms.add(M.useFixedSizes?new p.Float2PassUniform("pointScale",(O,S)=>r.set(J,O.fixedSize*S.camera.pixelRatio,S.camera.fullHeight)):new k.Float2DrawUniform("pointScale",(O,S,R)=>r.set(J,O.splatSize*R.scaleFactor*S.camera.pixelRatio,S.camera.fullHeight/S.camera.pixelRatio)));
M.clippingEnabled?H.uniforms.add([new z.Float3DrawUniform("clipMin",(O,S,R)=>d.set(K,R.clipBox[0]-O.origin[0],R.clipBox[1]-O.origin[1],R.clipBox[2]-O.origin[2])),new z.Float3DrawUniform("clipMax",(O,S,R)=>d.set(K,R.clipBox[3]-O.origin[0],R.clipBox[4]-O.origin[1],R.clipBox[5]-O.origin[2]))]):(H.constants.add("clipMin","vec3",[-b.NUMBER_MAX_FLOAT32,-b.NUMBER_MAX_FLOAT32,-b.NUMBER_MAX_FLOAT32]),H.constants.add("clipMax","vec3",[b.NUMBER_MAX_FLOAT32,b.NUMBER_MAX_FLOAT32,b.NUMBER_MAX_FLOAT32]));I?(g.addNearFar(N),
g.addCalculateLinearDepth(N),N.varyings.add("depth","float")):M.output!==h.ShaderOutput.Highlight&&N.varyings.add("vColor","vec3");H.code.add(C.glsl`
    void main(void) {
      // Move clipped points outside of clipspace
      if (position.x < clipMin.x || position.y < clipMin.y || position.z < clipMin.z ||
        position.x > clipMax.x || position.y > clipMax.y || position.z > clipMax.z) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      if (rejectBySlice(position)) {
        gl_Position = vec4(0.0,0.0,0.0,2.0);
        gl_PointSize = 0.0;
        return;
      }

      // Position in camera space
      vec4 camera = modelView * vec4(position, 1.0);

      float pointSize = pointScale.x;
      vec4 position = proj * camera;
     ${M.drawScreenSize?C.glsl`
      float clampedScreenSize = pointSize;`:C.glsl`
      float pointRadius = 0.5 * pointSize;
      vec4 cameraOffset = camera + vec4(0.0, pointRadius, 0.0, 0.0);
      vec4 positionOffset = proj * cameraOffset;
      float radius = abs(positionOffset.y - position.y);
      float viewHeight = pointScale.y;
      // screen diameter = (2 * r / w) * (h / 2)
      float screenPointSize = (radius / position.w) * viewHeight;
      float clampedScreenSize = clamp(screenPointSize, screenMinMaxSize.x, screenMinMaxSize.y);
      // Shift towards camera, to move rendered point out of terrain i.e. to
      // the camera-facing end of the virtual point when considering it as a
      // 3D sphere.
      camera.xyz -= normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;
      position = proj * camera;`}

     gl_PointSize = clampedScreenSize;
     gl_Position = position;

     ${I?C.glsl`depth = calculateLinearDepth(nearFar, camera.z);`:""}
     ${P?C.glsl`vColor = color;`:""}
    }
  `);L.include(q.RgbaFloatEncoding,M);G&&N.include(v.OutputHighlight,M);L.code.add(C.glsl`
    void main(void) {
      vec2 vOffset = gl_PointCoord - vec2(0.5, 0.5);
      float r2 = dot(vOffset, vOffset);

      if (r2 > 0.25) {
        discard;
      }
      ${I?C.glsl`gl_FragColor = float2rgba(depth);`:""}
      ${G?C.glsl`outputHighlight();`:""}
      ${P?C.glsl`gl_FragColor = vec4(vColor, 1.0);`:""}
    }
  `);return N}function w(M){return M?256:64}let D=function(M){function N(){var P=M.apply(this,arguments)||this;P.clipBox=e.create(e.POSITIVE_INFINITY);P.useFixedSizes=!1;P.useRealWorldSymbolSizes=!1;P.scaleFactor=1;P.minSizePx=0;P.size=0;P.sizePx=0;return P}c._inheritsLoose(N,M);c._createClass(N,[{key:"fixedSize",get:function(){return this.drawScreenSpace?this.sizePx:this.size}},{key:"screenMinSize",get:function(){return this.useFixedSizes?0:this.minSizePx}},{key:"drawScreenSpace",get:function(){return this.useFixedSizes&&
!this.useRealWorldSymbolSizes}}]);return N}(C.NoParameters),F=function(M){function N(P,I,G){var H=M.call(this,P)||this;H.origin=P;H.isLeaf=I;H.splatSize=G;return H}c._inheritsLoose(N,M);return N}(l.SlicePlaneParameters);const E=n.create(),K=f.create(),J=m.create();n=Object.freeze(Object.defineProperty({__proto__:null,PointRendererDrawParameters:F,PointRendererPassParameters:D,build:y,getMaxPointSizeScreenspace:w},Symbol.toStringTag,{value:"Module"}));a.PointRendererDrawParameters=F;a.PointRendererPassParameters=
D;a.PointRendererShader=n;a.build=y;a.getMaxPointSizeScreenspace=w})},"esri/views/3d/webgl-engine/shaders/PointRendererTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/PointRenderer.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),function(a,c,b,t,n,r,m,d,f,e,g){n=
function(h){function l(q,k,p){return h.call(this,q,k,p)||this}b._inheritsLoose(l,h);var v=l.prototype;v.initializeProgram=function(q){return new m.Program(q.rctx,l.shader.get().build(this.configuration),r.Default3D)};v.initializePipeline=function(){return g.makePipelineState({depthTest:{func:e.CompareFunction.LESS},depthWrite:g.defaultDepthWriteParams,colorWrite:g.defaultColorWriteParams,stencilWrite:this.configuration.hasOccludees?d.stencilWriteMaskOn:null,stencilTest:this.configuration.hasOccludees?
d.stencilBaseAllZerosParams:null})};return l}(n.ShaderTechnique);n.shader=new t.ReloadableShaderModule(f.PointRendererShader,()=>new Promise((h,l)=>a(["./PointRenderer.glsl"],h,l)));c.PointRendererTechnique=n;Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/shaders/PointRendererTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,c,b,t,n,r){r=function(m){function d(){var f=m.apply(this,arguments)||this;f.output=t.ShaderOutput.Color;f.hasSlicePlane=!1;f.drawScreenSize=!1;f.useFixedSizes=!1;f.hasOccludees=!1;f.clippingEnabled=!1;return f}c._inheritsLoose(d,m);return d}(r.DefaultTechniqueConfiguration);b.__decorate([n.parameter({count:t.ShaderOutput.COUNT})],r.prototype,"output",void 0);b.__decorate([n.parameter()],r.prototype,"hasSlicePlane",void 0);b.__decorate([n.parameter()],r.prototype,"drawScreenSize",void 0);
b.__decorate([n.parameter()],r.prototype,"useFixedSizes",void 0);b.__decorate([n.parameter()],r.prototype,"hasOccludees",void 0);b.__decorate([n.parameter()],r.prototype,"clippingEnabled",void 0);b.__decorate([n.parameter({constValue:!0})],r.prototype,"hasSliceInVertexProgram",void 0);a.PointRendererTechniqueConfiguration=r;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/PopupSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Error ../../../../core/maybe ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils ../../../layers/support/popupUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){a.PopupSceneLayerView=l=>{l=function(v){function q(){return v.apply(this,arguments)||this}c._inheritsLoose(q,v);var k=q.prototype;k._validateFetchPopupFeatures=function(p){const {layer:z}=this,{popupEnabled:C}=z;if(!C)throw new t("scenelayerview3d:fetchPopupFeatures","Popups are disabled",{layer:z});if(!h.getFetchPopupTemplate(z,p))throw new t("scenelayerview3d:fetchPopupFeatures","Layer does not define a popup template",{layer:z});};k.prepareFetchPopupFeatures=function(){var p=
c._asyncToGenerator(function*(z){});return function(z){return p.apply(this,arguments)}}();k.fetchPopupFeatures=function(){var p=c._asyncToGenerator(function*(z,C){this._validateFetchPopupFeatures(C);z=n.isSome(C)?C.clientGraphics:null;if(!z||0===z.length)return[];const B="scene"===this.layer.type&&n.isSome(this.layer.associatedLayer)?this.layer.associatedLayer:this.layer;let A=[];"fieldsIndex"in this.layer&&(A=g.unpackFieldNames(this.layer.fieldsIndex,yield h.getRequiredFields(B,h.getFetchPopupTemplate(this.layer,
C))));yield this.prepareFetchPopupFeatures(A);C=new Set;const x=[],u=[];for(const y of z)g.populateMissingFields(A,y,C)?u.push(y):x.push(y);return 0===u.length?x:this.whenGraphicAttributes(u,[...C]).catch(()=>u).then(y=>x.concat(y))});return function(z,C){return p.apply(this,arguments)}}();return q}(l);return l=b.__decorate([e.subclass("esri.views.3d.layers.support.PopupSceneLayerView")],l)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerView3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../core/sql/WhereClause ../../../layers/support/FeatureFilter ../../../layers/support/floorFilterUtils ../../../rest/support/Query ../../../support/featureFlags ./I3SMeshView3D ./II3SMeshView3D ./LayerView3D ./i3s/attributeEditing ./i3s/I3SGeometryUtil ./i3s/I3SMeshViewFilter ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SQueryEngine ./i3s/I3SQueryFeatureAdapter ./i3s/I3SQueryFeatureStore ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/updatingProperties ../../layers/SceneLayerView ../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I){d=K.defineFieldProperties();k=function(G){function H(){var O=G.apply(this,arguments)||this;O.type="scene-layer-3d";O.progressiveLoadFactor=1;O._elevationContext="scene";O._isIntegratedMesh=!1;O._supportsLabeling=!0;O._interactiveEditingSessions=new Map;O._queryEngine=null;return O}a._inheritsLoose(H,G);var L=H.prototype;L.tryRecycleWith=function(O,S){return O.url===this.layer.url&&this.i3sOverrides.isEmpty?O.load(S).then(()=>
{F.checkRecyclable(this.layer,O,this.i3sOverrides);this.layer=O;this.i3sOverrides.destroy();this.i3sOverrides=new u.I3SOverrides({view:this.view,layer:O,memoryController:this.view.resourceController?.memoryController});this.resetHighlights()}):null};L.initialize=function(){this._fieldsHelper=new M.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>this.layer.rangeInfos,S=>this._rangeInfosChanged(S),r.initial);this.updatingHandles.add(()=>this.layer.renderer,S=>this.updatingHandles.addPromise(this._rendererChange(S)),
r.initial);const O=()=>this._filterChange();this.updatingHandles.add(()=>this.parsedDefinitionExpression,O);this.updatingHandles.add(()=>this.filter,O);this.updatingHandles.add(()=>this._floorFilterClause,O);this.updatingHandles.add(()=>this._excludeObjectIdsSorted,O);this.updatingHandles.add(()=>n.isSome(this.viewFilter)?this.viewFilter.sortedObjectIds:null,O);this.updatingHandles.add(()=>n.isSome(this.viewFilter)?this.viewFilter.parsedWhereClause:null,O);this.updatingHandles.add(()=>[n.isSome(this.viewFilter)?
this.viewFilter.parsedGeometry:null,n.isSome(this.filter)?this.filter.spatialRelationship:null,n.isSome(this.layer.filter)?this.layer.filter.spatialRelationship:null],()=>this._geometryFilterChange());this.handles.add(this.layer.on("apply-edits",S=>this.updatingHandles.addPromise(S.result)));this.handles.add(this.layer.on("edits",S=>this._handleEdits(S)))};L.destroy=function(){this._fieldsHelper=n.destroyMaybe(this._fieldsHelper)};L._rangeInfosChanged=function(O){null!=O&&0<O.length&&t.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
L.createQuery=function(){const O={outFields:["*"],returnGeometry:!1,outSpatialReference:this.view.spatialReference};return n.isSome(this.filter)?this.filter.createQuery(O):new v(O)};L.queryExtent=function(O,S){return this._ensureQueryEngine().executeQueryForExtent(this._ensureQuery(O),S?.signal)};L.queryFeatureCount=function(O,S){return this._ensureQueryEngine().executeQueryForCount(this._ensureQuery(O),S?.signal)};L.queryFeatures=function(O,S){return this._ensureQueryEngine().executeQuery(this._ensureQuery(O),
S?.signal).then(R=>{if(!R?.features)return R;const Q=this.layer;for(const V of R.features)V.layer=Q,V.sourceLayer=Q;return R})};L.queryObjectIds=function(O,S){return this._ensureQueryEngine().executeQueryForIds(this._ensureQuery(O),S?.signal)};L._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};L._createQueryEngine=function(){const O=B.createGetFeatureExtent(this.view.spatialReference,this.view.renderSpatialReference,this._collection);
return new y.I3SQueryEngine({layerView:this,priority:I.TaskPriority.FEATURE_QUERY_ENGINE,spatialIndex:new D.I3SQueryFeatureStore({featureAdapter:new w.I3SQueryFeatureAdapter({objectIdField:this.layer.objectIdField,attributeStorageInfo:this.layer.attributeStorageInfo??[],getFeatureExtent:O}),forAllFeatures:(S,R)=>this._forAllFeatures((Q,V,aa)=>S({id:Q,index:V,meta:aa}),R,p.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA),getFeatureExtent:O,sourceSpatialReference:F.getIndexCrs(this.layer),viewSpatialReference:this.view.spatialReference})})};
L.highlight=function(O){const S=this._highlights;if(O instanceof v){const {set:R,handle:Q}=S.acquireSet();this.queryObjectIds(O).then(V=>S.setFeatureIds(R,V));return Q}return G.prototype.highlight.call(this,O)};L.createInteractiveEditSession=function(O){return C.createInteractiveEditSession(this._attributeEditingContext,O)};L._createLayerGraphic=function(O){O=new b(null,null,O);O.layer=this.layer;O.sourceLayer=this.layer;return O};L.canResume=function(){return G.prototype.canResume.call(this)&&(!this._controller||
this._controller.rootNodeVisible)};L.getFilters=function(){const O=G.prototype.getFilters.call(this),S=this._excludeObjectIdsSorted;n.isSome(S)&&O.push(R=>F.objectIdFilter(S,!1,R));this._floorFilterClause&&this.addSqlFilter(O,this._floorFilterClause,this.logError);this.addSqlFilter(O,this.parsedDefinitionExpression,this.logError);n.isSome(this.viewFilter)&&this.viewFilter.addFilters(O,this.view,this._controller.crsIndex,this._collection);return O};L.isUpdating=function(){return G.prototype.isUpdating.call(this)||
this.layerFilterUpdating||n.isSome(this.viewFilter)&&this.viewFilter.updating||n.isSome(this.i3sOverrides)&&this.i3sOverrides.updating};L._ensureQuery=function(O){return this._addDefinitionExpressionToQuery(n.isNone(O)?this.createQuery():v.from(O))};L._handleEdits=function(O){q.sceneLayerEditingEnabled()&&C.processGeometryEdits(this._attributeEditingContext,O);C.processAttributeEdits(this._attributeEditingContext,O)};L.computeNodeFiltering=function(O){const S=this.viewFilter;return n.isNone(S)||!this.view.spatialReference||
S.isMBSGeometryVisible(O,this.view.spatialReference,this._controller.crsIndex)?x.NodeFilterImpact.Unmodified:x.NodeFilterImpact.Culled};a._createClass(H,[{key:"i3slayer",get:function(){return this.layer}},{key:"layerPopupEnabled",get:function(){return this.layer.popupEnabled}},{key:"filter",get:function(){return this._get("filter")},set:function(O){this._set("filter",A.I3SMeshViewFilter.checkSupport(O)?O:null)}},{key:"viewFilter",get:function(){const O=this.filter,S=this.layerFilter;if(n.isNone(O)&&
n.isNone(S))return null;const R=this._get("viewFilter");if(n.isNone(R))return new A.I3SMeshViewFilter({layerFilter:S,viewFilter:O,layerFieldsIndex:this.layer.fieldsIndex,loadAsyncModule:Q=>this._loadAsyncModule(Q),addSqlFilter:(Q,V)=>this.addSqlFilter(Q,V,this.logError)});R.viewFilter=O;R.layerFilter=S;return R}},{key:"requiredFields",get:function(){return this._fieldsHelper?.requiredFields??[]}},{key:"_floorFilterClause",get:function(){const O=l.getFloorFilterClause(this);return n.isSome(O)?g.WhereClause.create(O,
this.layer.fieldsIndex):null}},{key:"_excludeObjectIdsSorted",get:function(){let O=this.layer.excludeObjectIds.toArray();q.sceneLayerEditingEnabled()&&this.i3sOverrides.is3DOFL&&0<this.i3sOverrides.geometryChangedObjectIds.length&&(O=O.concat(this.i3sOverrides.geometryChangedObjectIds));return O.length?O.sort((S,R)=>S-R):null}},{key:"_objectQualitySettings",get:function(){return this.view?.qualitySettings?.sceneService?.object}},{key:"lodFactor",get:function(){return this._objectQualitySettings?.lodFactor??
1}},{key:"lodCrossfadeinDuration",get:function(){return this._objectQualitySettings.lodCrossfadeinDuration??0}},{key:"lodCrossfadeoutDuration",get:function(){return this._objectQualitySettings.lodCrossfadeoutDuration??0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return this._objectQualitySettings.lodCrossfadeUncoveredDuration??0}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??0}},{key:"_attributeEditingContext",get:function(){return{sessions:this._interactiveEditingSessions,
fieldsIndex:this.layer.fieldsIndex,objectIdField:this._getObjectIdField(),forEachNode:O=>this._forAllNodes(S=>n.isSome(S)?O(S.node,S.featureIds):null),attributeStorageInfo:this.i3slayer.attributeStorageInfo??[],i3sOverrides:this.i3sOverrides,getAttributeData:O=>this.getAttributeData(O),setAttributeData:(O,S)=>this.setAttributeData(O,S),clearMemCache:()=>this.clearMemCache()}}},{key:"hasGeometryFilter",get:function(){const O=this.viewFilter;return n.isSome(O)&&n.isSome(O.parsedGeometry)}}]);return H}(k.I3SMeshView3D(E.DefinitionExpressionSceneLayerView(J.PopupSceneLayerView(z.LayerView3D(P)))));
c.__decorate([m.property()],k.prototype,"i3slayer",null);c.__decorate([m.property(N.updatingProgress)],k.prototype,"updatingProgress",void 0);c.__decorate([m.property({type:h})],k.prototype,"filter",null);c.__decorate([m.property({readOnly:!0})],k.prototype,"viewFilter",null);c.__decorate([m.property(d.requiredFields)],k.prototype,"requiredFields",null);c.__decorate([m.property(d.availableFields)],k.prototype,"availableFields",void 0);c.__decorate([m.property()],k.prototype,"_fieldsHelper",void 0);
c.__decorate([m.property()],k.prototype,"_floorFilterClause",null);c.__decorate([m.property()],k.prototype,"_excludeObjectIdsSorted",null);c.__decorate([m.property()],k.prototype,"_objectQualitySettings",null);c.__decorate([m.property()],k.prototype,"lodFactor",null);c.__decorate([m.property()],k.prototype,"updatingProgressValue",null);return k=c.__decorate([e.subclass("esri.views.3d.layers.SceneLayerView3D")],k)})},"esri/views/3d/layers/I3SMeshView3D":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/byteSizeEstimations ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/scheduling ../../../core/typedArrayUtil ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat3f32 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../layers/LayerConstants ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/fieldUtils ../../../layers/support/SceneModification ../../../renderers/visualVariables/support/visualVariableUtils ../../../support/arcadeOnDemand ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ./I3SMeshViewLabeler ./I3SMeshWorkerHandle ./II3SMeshView3D ./SceneLayerWorker ./graphics/graphicUtils ./graphics/Labeler ./i3s/enums ./i3s/Highlights ./i3s/I3SAsyncElevationUpdater ./i3s/I3SCrossfadeHelper ./i3s/I3SElevationProvider ./i3s/I3SGeometryUtil ./i3s/I3SIntersectionHandler ./i3s/I3SMaterialUtil ./i3s/I3SNode ./i3s/I3SOverrides ./i3s/I3SProjectionUtil ./i3s/I3SUtil ./i3s/IDBCache ./i3s/IDBMockCache ./support/attributeUtils ./support/symbolColorUtils ../support/debugFlags ../support/extentUtils ../support/orientedBoundingBox ../support/updatingProperties ../support/buffer/glUtil ../webgl-engine/collections/Component/ComponentObject ../webgl-engine/collections/Component/SourceGeometry ../webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../webgl-engine/lib/BasisUtil ../webgl-engine/lib/DoubleArray ../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V,aa,X,W,T,U,Y,ba,da,ea,ca,ja,ia,Z,ha,fa,ka,la,na,pa,va,wa,za,sa,ua,oa,xa,Ea,Ia,Na,Oa,Ja,Sa,Ua){function Za(eb,cb){q.isAbortError(eb)||qa.warn("Error while processing edges. Edges on this layer might not display correctly",cb,eb)}function ma(eb){if(l.isNone(eb))return!1;const cb=eb.metallicRoughness;return cb&&0<=cb.baseColorTextureId||cb&&0<=cb.metallicRoughnessTextureId||0<=eb.normalTextureId||0<=eb.emissiveTextureId||
0<=eb.occlusionTextureId}function Ya(eb){return l.isSome(eb)&&z.isArrayBuffer(eb.data)}function bb(eb,cb){eb=1024+eb.interleavedVertexData.byteLength+(eb.indices?eb.indices.byteLength:0)+eb.positionData.data.byteLength+eb.positionData.indices.byteLength;if(l.isSome(cb))for(const Ka of cb)l.isSome(Ka)&&z.isArrayBuffer(Ka.data)&&(eb+=Ka.data.byteLength);return eb}function Qa(eb,cb){return cb.byteSize>Ta?(qa.warn(`Node is too big to store in IndexedDB cache: ${eb.id} (${cb.byteSize} bytes)`),!1):0<cb.byteSize}
function Aa(eb){if(0===eb.length)return null;const cb=new Float64Array(10*eb.length);eb.forAll((Ka,Ha)=>{let ra=Ka.serviceObb;l.isNone(ra)&&(ra=lb,E.copy(ra.center,Ka.mbs),ra.halfSize[0]=ra.halfSize[1]=ra.halfSize[2]=Ka.mbs[3]);Ka=10*Ha;cb[Ka+0]=ra.center[0];cb[Ka+1]=ra.center[1];cb[Ka+2]=ra.center[2];cb[Ka+3]=ra.halfSize[0];cb[Ka+4]=ra.halfSize[1];cb[Ka+5]=ra.halfSize[2];cb[Ka+6]=ra.quaternion[0];cb[Ka+7]=ra.quaternion[1];cb[Ka+8]=ra.quaternion[2];cb[Ka+9]=ra.quaternion[3]});return cb}function Ca(eb,
cb){eb.forEach(Ka=>Ka.opacity=cb)}const qa=g.getLogger("esri.views.3d.layers.I3SMeshView3D"),ya=[1,1,1,1];let Da=function(eb){function cb(Ka,Ha,ra,Ga,Pa,Ra,Va){var ab=eb.call(this)||this;ab.node=Ka;ab.featureIds=Ha;ab.objectHandle=ra;ab.cachedRendererVersion=Ga;ab.attributeInfo=Pa;ab.material=Ra;ab.textures=Va;ab.cachedMidsTerrainSR=null;ab.cachedEdgeMaterials=[];ab.edgeMemoryUsage=0;ab.cachedSymbology=null;return ab}b._inheritsLoose(cb,eb);return cb}(ca.NodeCrossfadeMetaData);var La;(function(eb){eb[eb.CastShadows=
4]="CastShadows";eb[eb.Pickable=5]="Pickable"})(La||(La={}));const Ta=100*d.ByteSizeUnit.MEGABYTES;var Xa;(function(eb){eb[eb.ADD=0]="ADD";eb[eb.REMOVE=1]="REMOVE";eb[eb.UPDATE=2]="UPDATE"})(Xa||(Xa={}));const db=P.create(),fb=I.create(),jb=I.create(),lb=oa.create(),ob=[0,0,0,0],xb=new n([0,0,0,0]),Nb=[0,0,0,0],Bb={remove(){},pause(){},resume(){}};c.ElevationMode=void 0;(function(eb){eb[eb.Absolute=0]="Absolute";eb[eb.RelativeToGround=1]="RelativeToGround";eb[eb.OnTheGround=2]="OnTheGround"})(c.ElevationMode||
(c.ElevationMode={}));const rb=K.create(),mb=P.create();c.I3SMeshView3D=eb=>{eb=function(cb){function Ka(...ra){ra=cb.call(this,ra)||this;ra._nodeId2Meta=new Map;ra._nodeId2MetaReloading=new Map;ra._i3sWasmLoaded=!1;ra._snappingSourcesTrackers=[];ra._hasLoadedPBRTextures=!1;ra._asyncModuleLoading=0;ra._addTasks=new Map;ra._currentRenderer=null;ra._rendererVersion=0;ra._colorVariable=null;ra._opacityVariable=null;ra._rendererFields=null;ra._symbologyFields=null;ra._symbologyOverride=null;ra._symbologyOverrideFields=
null;ra._symbolInfos=new Map;ra._visibleGeometryChangedSchedulerHandle=null;ra._idbCache=e("enable-feature:idb-mock-cache")?new va.IDBMockCache:new pa.IDBCache("esri-scenelayer-cache","geometries");ra._hasComponentData=!1;ra._hasVertexColors=!1;ra.holeFilling="auto";ra._hasColors=!1;ra._hasTextures=!1;ra._hasData=!1;ra.slicePlaneEnabled=!1;ra._modifications=[];ra._layerUrl="";ra._cacheKeySuffix=null;ra._elevationTask=null;ra._filters=[];ra._arcade=null;ra._tmpAttributeOnlyGraphic=new r(null,null,
{});ra._crossfadeHelper=new ca.I3SCrossfadeHelper(b._assertThisInitialized(ra));return ra}b._inheritsLoose(Ka,cb);var Ha=Ka.prototype;Ha.initialize=function(){this._preLoadBasis();this.addResolvingPromise(this.i3slayer.indexInfo);const ra=this.view.resourceController;this.i3sOverrides=new ka.I3SOverrides({view:this.view,layer:this.i3slayer,memoryController:ra.memoryController});this._worker=new X.I3SMeshWorkerHandle(Pa=>ra.immediate.schedule(Pa));this.addResolvingPromise(this._worker.promise);var Ga=
this.i3slayer.store;this._worker.setLegacySchema(this.uid,Ga.defaultGeometrySchema);na.checkSceneLayerValid(this.i3slayer);na.checkSceneLayerCompatibleWithView(this.i3slayer,this.view);this._layerUrl=this.i3slayer.parsedUrl.path;this._controller=new H({layerView:this});this._geoMemoryEstimate=this._texMemoryEstimate=this._gpuMemoryEstimate=0;this._stage=this.view._stage;this._collection=this._stage.renderView.componentObjectCollection;this.resetHighlights();Ga=Ga.defaultGeometrySchema;if(this._isIntegratedMesh||
!Ga)this._hasComponentData=!1;else{const Pa=Ga.featureAttributes;this._hasComponentData=!!(Pa&&Pa.faceRange&&Pa.id)}this._hasVertexColors=null!=(Ga?.vertexAttributes.color??null)&&(null==this.i3slayer.cachedDrawingInfo||!this.i3slayer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.renderer.ensureEdgeView());this._memCache=this.view.resourceController.memoryController.newCache(this.uid,Pa=>this._deleteComponentObject(Pa));this._intersectionHandler=new Z.I3SIntersectionHandler({layerUid:this.layerUid,
sublayerUid:this.sublayerUid,collection:this._collection,slicePlaneEnabled:this.slicePlaneEnabled,isGround:this._isIntegratedMesh,traverseNodeHierarchy:Pa=>l.isSome(this._controller.index)&&l.isSome(this._controller.index.rootNode)?this._controller.index.traverse(this._controller.index.rootNode,Ra=>{var Va=Ra.index;Va=this._nodeId2Meta.get(Va)||this._nodeId2MetaReloading.get(Va);return Pa(Ra,l.isSome(Va)?Va.objectHandle:null)}):()=>{}});this.updatingHandles.add(()=>this.layerUid,Pa=>this._intersectionHandler.layerUid=
Pa);this.updatingHandles.add(()=>this.sublayerUid,Pa=>this._intersectionHandler.sublayerUid=Pa);this._elevationProvider=new ja({layerView:this,intersectionHandler:this._intersectionHandler});this._hasLoadedPBRTextures=this._usePBR;this.updatingHandles.add(()=>this.view.clippingArea,()=>this._clippingAreaChanged(),k.initial);this.updatingHandles.add(()=>this.fullOpacity,Pa=>this._opacityChange(Pa));this.updatingHandles.add(()=>this.slicePlaneEnabled,Pa=>this._slicePlaneEnabledChange(Pa));this.updatingHandles.add(()=>
this.elevationOffset,(Pa,Ra)=>{this._reloadAll(Ra);this._controller.invalidateVisibilityObbs()});this.updatingHandles.add(()=>this.elevationInfo,(Pa,Ra)=>this._elevationInfoChanged(Pa,Ra),k.initial);this.updatingHandles.add(()=>!this.suspended&&this.elevationInfo.mode!==c.ElevationMode.Absolute,(Pa,Ra)=>{Pa?this.handles.add(this.view.basemapTerrain.on("elevation-change",({extent:Va})=>this._ensureElevationTask().addExtent(Va)),"elevation-change"):Ra&&this.handles.remove("elevation-change")},k.initial);
this.updatingHandles.add(()=>this._usePBR,Pa=>this._updatePBR(Pa));Ga=()=>{this._reloadAll();this.clearMemCache()};this.updatingHandles.add(()=>this.rendererTextureUsage,Ga);this.updatingHandles.add(()=>this.uncompressedTextureDownsamplingEnabled,Ga);this.updatingHandles.add(()=>this.suspended,Pa=>this._suspendedChange(Pa),k.initial);this.updatingHandles.add(()=>this.i3slayer.labelsVisible,()=>this._labelingChanged(),k.initial);this.updatingHandles.add(()=>this.i3slayer.labelingInfo,()=>this._labelingChanged(),
k.initial);this.updatingHandles.add(()=>this._modifications,()=>this._modificationsChanged(),k.initial);this.handles.add([k.watch(()=>sa.I3S_TREE_SHOW_TILES,Pa=>{if(Pa&&!this._treeDebugger){const Ra=this._controller.crsIndex;(new Promise((Va,ab)=>a(["./support/I3STreeDebugger"],Va,ab))).then(({I3STreeDebugger:Va})=>{!this._treeDebugger&&sa.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new Va({lv:this,view:this.view,nodeSR:Ra}))})}else Pa||sa.I3S_TREE_SHOW_TILES||(this._treeDebugger=l.destroyMaybe(this._treeDebugger))},
k.initial),k.watch(()=>sa.I3S_SHOW_MODIFICATIONS,()=>this._showModifications(),k.initial)]);this._cacheKeySuffix=na.getCacheKeySuffix(this.i3slayer.spatialReference,this.view.renderSpatialReference);this._idbCache.init().catch(Pa=>qa.warn(`Failed to initialize IndexedDB cache: ${Pa}`))};Ha.destroy=function(){this._clearAddTasks();this._elevationTask=l.destroyMaybe(this._elevationTask);this.i3sOverrides=l.destroyMaybe(this.i3sOverrides);this._elevationProvider&&(this._elevationProvider.layerChanged(),
this.view.elevationProvider.unregister(this._elevationProvider),this._elevationProvider=null);this._intersectionHandler&&(this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler),this._intersectionHandler=null);const ra=this._worker;ra&&(ra.destroyContext(this.uid).then(()=>ra.destroy()),this._worker=null);this._removeAllNodeDataFromStage();this._memCache=l.destroyMaybe(this._memCache);this._edgeView=this._stage=this._collection=null;this._labeler=l.destroyMaybe(this._labeler);
this._treeDebugger=l.destroyMaybe(this._treeDebugger);this._controller=l.destroyMaybe(this._controller);this._highlights.destroy();this._nodeId2Meta.clear();this._nodeId2MetaReloading.clear();this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};Ha._memEstimateTextureAdded=function(ra){ra=ra.estimatedTexMemRequired;this._gpuMemoryEstimate+=ra;this._texMemoryEstimate+=
ra;return ra};Ha._memEstimateTextureRemoved=function(ra){l.isSome(ra)&&(ra=ra.estimatedTexMemRequired,this._gpuMemoryEstimate-=ra,this._texMemoryEstimate-=ra)};Ha._memEstimateGeometryAdded=function(ra){ra=this._collection.getObjectGPUMemoryUsage(ra);this._gpuMemoryEstimate+=ra;this._geoMemoryEstimate+=ra;return ra};Ha._memEstimateGeometryRemoved=function(ra){ra=this._collection.getObjectGPUMemoryUsage(ra);this._gpuMemoryEstimate-=ra;this._geoMemoryEstimate-=ra};Ha.isNodeLoaded=function(ra){return this._nodeId2Meta.has(ra)};
Ha.isNodeReloading=function(ra){return this._nodeId2MetaReloading.has(ra)};Ha.getUsedMemory=function(){let ra=l.isSome(this._labeler)?this._labeler.usedMemory:0;this._nodeId2Meta.forEach(Ga=>ra+=l.isSome(Ga)?Ga.node.memory:0);this._nodeId2MetaReloading.forEach(Ga=>ra+=l.isSome(Ga)?Ga.node.memory:0);return ra};Ha.getUnloadedMemory=function(){return(l.isSome(this._controller)?this._controller.unloadedMemoryEstimate:0)+(l.isSome(this._labeler)?this._labeler.unloadedMemoryEstimate:0)};Ha.ignoresMemoryFactor=
function(){return!1};Ha._labelingChanged=function(){if(!Y.areLabelsVisible(this.i3slayer)||!this._supportsLabeling)l.isSome(this._labeler)&&(this._labeler.destroy(),this._labeler=null);else if(!l.isSome(this._labeler)){var ra=new aa({view:this.view,layer:this.i3slayer,collection:this._collection});this._nodeId2Meta.forEach(Ga=>l.isSome(Ga)&&this._addMetaToLabeler(ra,Ga));this._labeler=ra}};Ha._loadAsyncModule=function(ra){++this._asyncModuleLoading;return ra.then(Ga=>{--this._asyncModuleLoading;return Ga},
Ga=>{--this._asyncModuleLoading;throw Ga;})};Ha._modificationsChanged=function(){if(!this._i3sWasmLoaded&&this.hasModifications)this._i3sWasmLoaded=T.initialize().then(()=>{this._i3sWasmLoaded=!0;this._modificationsChanged();this.notifyUpdate()}),this.notifyUpdate();else if(!0===this._i3sWasmLoaded){var ra=this.uid,Ga=this.i3slayer.spatialReference;this._worker.setModifications(ra,this._layerClippingArea,this._modifications,Ga);var Pa=X.toWasmModification(this._layerClippingArea,this._modifications,
Ga);T.setModificationsSync({context:ra,modifications:Pa,isGeodetic:Ga.isGeographic});this._controller.modificationsChanged();var Ra=this.hasModifications?new v:null;this._nodeId2Meta.forEach((Va,ab)=>{l.isNone(Va)?(this._nodeId2Meta.delete(ab),this._controller.updateLoadStatus(ab,!1)):Va.node.hasModifications?(this._nodeId2Meta.delete(ab),this._nodeId2MetaReloading.set(ab,Va)):l.isSome(Ra)&&Ra.push(Va.node)});l.isSome(Ra)&&this._nodeId2MetaReloading.forEach(Va=>Ra.push(Va.node));l.isSome(Ra)&&0<Ra.length&&
(this.updateNodeModificationStatus(Ra),Ra.forAll(Va=>{if(Va.imModificationImpact!==fa.NodeIMModificationImpact.Culled){const ab=this._nodeId2Meta.get(Va.index);this._controller.invalidateGeometryVisibility(Va.index);l.isSome(ab)?(this._nodeId2Meta.delete(Va.index),this._nodeId2MetaReloading.set(Va.index,ab)):this._nodeId2Meta.has(Va.index)&&(this._nodeId2Meta.delete(Va.index),this._controller.updateLoadStatus(Va.index,!1))}}));this.clearMemCache();this._controller.restartNodeLoading();this._showModifications()}};
Ha._showModifications=function(){l.isSome(this._modificationGraphics)&&(this.view.graphics.removeMany(this._modificationGraphics),this._modificationGraphics=null);if(sa.I3S_SHOW_MODIFICATIONS&&0!==this._modifications.length){var ra={clip:[227,227,79,.8],mask:[227,139,79,.8],replace:[139,227,79,.8]},Ga={type:"simple-fill",outline:{color:[255,255,255],width:1}};this._modificationGraphics=[];for(const Pa of this._modifications){const Ra=Pa.geometry;Ra.spatialReference=this.i3slayer.spatialReference;
this._modificationGraphics.push(new r({geometry:Ra,symbol:{...Ga,color:ra[Pa.type]}}))}this.view.graphics.addMany(this._modificationGraphics)}};Ha._addMetaToLabeler=function(ra,Ga){ra.addNodeMeta(Ga,(Pa,Ra)=>this._createAttributes(Pa,Ra))};Ha._suspendedChange=function(ra){ra?(this._removeAllNodeDataFromStage(),this.view.elevationProvider&&this.view.elevationProvider.unregister(this._elevationProvider),this._stage.view.sceneIntersectionHelper.removeIntersectionHandler(this._intersectionHandler)):(this.view.elevationProvider.register(this._elevationContext,
this._elevationProvider),this._stage.view.sceneIntersectionHelper.addIntersectionHandler(this._intersectionHandler))};Ha.getLoadedAttributes=function(ra){ra=this._nodeId2Meta.get(ra);if(l.isSome(ra)&&l.isSome(ra.attributeInfo))return ra.attributeInfo.loadedAttributes};Ha.getAttributeData=function(ra){ra=this._nodeId2Meta.get(ra);if(l.isSome(ra)&&l.isSome(ra.attributeInfo))return ra.attributeInfo.attributeData};Ha.setAttributeData=function(ra,Ga){ra=this._nodeId2Meta.get(ra);l.isSome(ra)&&l.isSome(ra.attributeInfo)&&
(ra.attributeInfo.attributeData=Ga,this._attributeValuesChanged(ra))};Ha.updateAttributes=function(){var ra=b._asyncToGenerator(function*(Ga,Pa,Ra){const Va=this._nodeId2Meta.get(Ga);l.isSome(Va)&&(yield this.i3sOverrides.apply(Va.featureIds,Pa,Ra),Va.attributeInfo=Pa,this._controller.reschedule(()=>this._attributeValuesChanged(Va),Ra).catch(ab=>{q.isAbortError(ab)||qa.warn("Error while updating attribute values. Layer might not display correctly.",ab)}))});return function(Ga,Pa,Ra){return ra.apply(this,
arguments)}}();Ha._attributeValuesChanged=function(ra){ra.cachedRendererVersion=this._getInvalidRendererVersion();ra.filteredIds=null;l.isSome(this._labeler)&&this._labeler.setNodeMetaAttributes(ra,(Ga,Pa)=>this._createAttributes(Ga,Pa));this._updateEngineObject(ra)};Ha.clearMemCache=function(){l.isSome(this._memCache)&&this._memCache.clear()};Ha.getVisibleNodes=function(){const ra=[];this._nodeId2Meta.forEach(Ga=>l.isSome(Ga)&&ra.push(Ga.node));return ra};Ha.getNodeComponentObb=function(ra){ra=this._nodeId2Meta.get(ra.index)??
this._nodeId2MetaReloading.get(ra.index);return l.isSome(ra)?this._collection.getComponentObb(ra.objectHandle):null};Ha.getLoadedNodeIndices=function(ra){this._nodeId2Meta.forEach((Ga,Pa)=>ra.push(Pa));this._nodeId2MetaReloading.forEach((Ga,Pa)=>ra.push(Pa))};Ha._preLoadBasis=function(){!e("disable-feature:i3s-basis")&&0!==(this.supportedTextureEncodings&ba.TextureEncoding.Basis)&&l.applySome(this.i3slayer.textureSetDefinitions,ra=>ra.some(Ga=>Ga.formats.some(Pa=>"basis"===Pa.format||"ktx2"===Pa.format)))&&
Ja.loadBasis()};Ha._getVertexBufferLayout=function(ra,Ga){ra={hasTexture:ma(ra.params.material),hasNormals:Ga.normal,hasRegions:Ga.uvRegion};return Ea.glLayout(Na.createVertexBufferLayout(this._getGeometryParameters(ra)))};Ha._getObjectIdField=function(){return this.i3slayer.objectIdField||G.fallbackObjectIDAttribute};Ha._findGraphicNodeAndIndex=function(ra){const Ga=wa.attributeLookup(this.i3slayer.fieldsIndex,ra.attributes,this._getObjectIdField());let Pa=null;h.someMap(this._nodeId2Meta,Ra=>{if(l.isNone(Ra))return!1;
const Va=Ra.featureIds.indexOf(Ga);if(-1===Va)return!1;Pa={node:Ra.node,index:Va};return!0});return Pa};Ha._getGraphicIndices=function(ra,Ga){ra=this._nodeId2Meta.get(ra.index);if(l.isNone(ra))return[];const Pa=[],Ra=this._getObjectIdField(),Va=this.i3slayer.fieldsIndex;for(const ab of Ga)Ga=wa.attributeLookup(Va,ab.attributes,Ra),Ga=ra.featureIds.indexOf(Ga),-1!==Ga&&Pa.push(Ga);return Pa};Ha.whenGraphicBounds=function(ra){ra=this._findGraphicNodeAndIndex(ra);if(!ra)return Promise.reject();ra=this._getAABB(ra.node.index,
ra.index);return l.isNone(ra)?Promise.reject():Promise.resolve({boundingBox:ra,screenSpaceObjects:[]})};Ha.getAABBFromIntersectorTarget=function(ra){return null==ra.nodeIndex||null==ra.componentIndex?null:this._getAABB(ra.nodeIndex,ra.componentIndex)};Ha._getAABB=function(ra,Ga){ra=this._nodeId2Meta.get(ra);if(l.isNone(ra)||null==ra.featureIds||Ga>=ra.featureIds.length)return null;Ga=ia.boundingBoxCornerPoints(Ga,this._collection,ra.objectHandle,Sa.newDoubleArray(24));if(!N.projectBuffer(Ga,this.view.renderSpatialReference,
0,Ga,this.view.spatialReference,0,8))return null;ra=P.empty();P.expandWithBuffer(ra,Ga,0,8);return ra};Ha.whenGraphicAttributes=function(ra,Ga){return na.whenGraphicAttributes(this.i3slayer,ra,this._getObjectIdField(),Ga,()=>[...this._nodeId2Meta.values()].filter(l.isSome))};Ha.getGraphicFromIntersectorTarget=function(ra){if(null==ra.nodeIndex||null==ra.componentIndex)return null;const Ga=this._nodeId2Meta.get(ra.nodeIndex);return l.isNone(Ga)||null==Ga.featureIds||ra.componentIndex>=Ga.featureIds.length?
null:this._createGraphic(ra.componentIndex,Ga)};Ha._getCacheKey=function(ra){return`${this._layerUrl}/v${19}/${ra.id}${this._cacheKeySuffix}`};Ha._getMemCacheKey=function(ra,Ga=this.elevationOffset){return ra+"#"+Ga};Ha.loadCachedGPUData=function(ra){return l.isSome(this._memCache)?this._memCache.pop(this._getMemCacheKey(ra.index)):null};Ha.deleteCachedGPUData=function(ra){l.isSome(ra)&&this._deleteComponentObject(ra)};Ha._cacheGPUData=function(ra,Ga=this.elevationOffset){if(l.isNone(this._memCache))this._deleteComponentObject(ra);
else{var Pa=this._controller.indexDepth-ra.node.level;this._memCache.put(this._getMemCacheKey(ra.node.index,Ga),ra,ra.node.memory,Pa)}};Ha.loadMissingTextures=function(ra,Ga,Pa,Ra){const Va=ra?.filter((ab,hb)=>{if(0===(ab.usage&this.rendererTextureUsage))return!1;if(l.isNone(Ga))return!0;ab=ha.selectEncoding(ab.encodings,this.supportedTextureEncodings);hb=Ga[hb];return l.isNone(hb)||null==hb.data||ab&&hb.encoding!==ab.encoding?!0:!1})??[];return 0===Va.length?Promise.resolve(!1):Pa(Va,Ra).then(ab=>
{let hb=0;for(let ib=0;ib<ra.length;ib++)hb<ab.length&&ab[hb].id===ra[ib].id&&(Ga[ib]=ab[hb],hb++);return!0})};Ha.loadCachedNodeData=function(ra,Ga,Pa){return this._idbCacheEnabled?this._idbCache.get(this._getCacheKey(ra),Ga).then(Ra=>{if(null==Ra)return null;if(Ra.nodeVersion!==ra.version)return this._idbCache.remove(this._getCacheKey(ra)),null;this.elevationInfo.mode===c.ElevationMode.Absolute&&(ra.geometryObb=Ra.geometryObb);return this.loadMissingTextures(Ra.requiredTextures,Ra.textureData,Pa,
Ga).then(Va=>{Va&&this._idbCache.initialized&&l.isSome(Ra.textureData)&&(Ra.byteSize=bb(Ra.transformedGeometry,Ra.textureData),Ra.textureData.every(Ya)&&Qa(ra,Ra)&&this._idbCache.put(this._getCacheKey(ra),Ra).catch(ab=>qa.warn(`Failed to update node with textures in IndexedDB cache: ${ra.id}: ${ab}`)));q.throwIfAborted(Ga);return Ra})}):Promise.resolve(null)};Ha.addNode=function(ra,Ga,Pa){return"geometryData"in Ga?null==Ga.geometryBuffer?(this._addNodeMeta(ra.index,null),Promise.resolve()):this._addData(ra,
Ga.attributeDataInfo,()=>this._transformNode(ra,Ga,Pa).then(Ra=>this._safeReschedule(()=>{if(l.isNone(Ra))return ra.hasModifications=!1,this._addCachedNodeData(ra,null,Pa);ra.hasModifications=Ra.transformedGeometry.hasModifications;const {obb:Va,componentOffsets:ab,featureIds:hb,transformedGeometry:ib}=Ra;var kb=la.computeGlobalTransformation(ra.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference),pb=oa.create([Va.center.x,Va.center.y,Va.center.z],[Va.extents.x,Va.extents.y,
Va.extents.z],F.fromValues(Va.orientation.x,Va.orientation.y,Va.orientation.z,Va.orientation.w));E.transformMat4(pb.center,pb.center,kb);this.elevationInfo.mode===c.ElevationMode.Absolute&&(ra.geometryObb=pb);Ga.geometryData.componentOffsets=ab;hb&&(Ga.geometryData.featureIds=Array.from(hb));kb={nodeVersion:ra.version,geometryData:Ga.geometryData,requiredTextures:Ga.requiredTextures,textureData:Ga.textureData,transformedGeometry:ib,globalTrafo:kb,geometryObb:pb,byteSize:bb(ib,Ga.textureData)};this._idbCacheEnabled&&
this._idbCache.initialized&&Qa(ra,kb)&&(pb=l.isSome(kb.textureData)?kb.textureData.map(ub=>Ya(ub)?ub:null):null,this._idbCache.put(this._getCacheKey(ra),{...kb,textureData:pb}).catch(ub=>qa.warn(`Failed to store node in IndexedDB cache: ${ra.id}: ${ub}`)));return this._addCachedNodeData(ra,kb,Pa)},Pa))):Promise.reject()};Ha.computeVisibilityObb=function(ra){return na.computeVisibilityObb(ra,this.view.renderSpatialReference,this._controller.crsIndex,this.i3slayer.spatialReference,this.elevationOffset,
this._modifications)};Ha._transformNode=function(ra,Ga,Pa){var Ra=Ga.geometryData.geometries??[];const Va=Array(Ra.length);for(var ab=0;ab<Ra.length;++ab)Va[ab]=this._getVertexBufferLayout(Ra[ab],Ga.geometryDescriptor);Ra=ra.mbs;ab=this.elevationOffset;var hb=this._controller.crsIndex,ib=this._controller.crsVertex;const kb=this.view.renderSpatialReference,pb=la.getLocalOrigin(Ra,ab,hb),ub=la.computeGlobalTransformation(Ra,ab,hb,kb);hb=N.getProjectorName(hb,ib);ib=N.getProjectorName(ib,kb);return l.isNone(hb)||
l.isNone(ib)?Promise.resolve(null):this._worker.invoke({context:this.uid,geometryBuffer:Ga.geometryBuffer,geometryData:Ga.geometryData,geometryDescriptor:Ga.geometryDescriptor,layouts:Va,localOrigin:pb,globalTrafo:ub,mbs:Ra,obb:ra.serviceObb,elevationOffset:ab,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.i3slayer.normalReferenceFrame||"none",indexToVertexProjector:hb,vertexToRenderProjector:ib},Pa)};Ha._setNewNodeOpacity=function(ra){this._setNodeOpacity(ra,
this.nodeCrossfadingEnabled?0:this.fullOpacity)};Ha.addCachedGPUData=function(ra,Ga,Pa){this.elevationInfo.mode===c.ElevationMode.Absolute&&(ra.geometryObb=oa.clone(this._collection.getComponentObb(Ga.objectHandle)));this._controller.isGeometryVisible(ra)?(l.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,Ga),ra=ra.index,this._addNodeMeta(ra,Ga),this.updateNodeState(ra,Pa),this._collection.setObjectVisibility(Ga.objectHandle,Ia.State.Visible),this._updateMaterial(Ga),this._setNewNodeOpacity(Ga),
this.elevationInfo.mode!==c.ElevationMode.Absolute&&this._ensureElevationTask().schedule(ra),this._updateEngineObject(Ga),this._highlights.objectCreated(Ga),l.isSome(this._treeDebugger)&&this._treeDebugger.update()):this._cacheGPUData(Ga)};Ha.addCachedNodeData=function(ra,Ga,Pa,Ra){return this._addData(ra,Pa,()=>this._addCachedNodeData(ra,Ga,Ra))};Ha._addCachedNodeData=function(){var ra=b._asyncToGenerator(function*(Ga,Pa,Ra){if(this.suspended||!this._controller.isGeometryVisible(Ga))this._removeNodeStageData(Ga.index,
this.elevationOffset,this._nodeId2MetaReloading);else if(l.isNone(Pa))this._addNodeMeta(Ga.index,null);else{var Va=this._addTasks.get(Ga.index),{geometryData:ab,transformedGeometry:hb,globalTrafo:ib}=Pa;yield this.i3sOverrides.apply(ab.featureIds,Va.attributeInfo,Ra);var kb=l.isSome(Pa.textureData)?Pa.textureData.filter(Ab=>l.isSome(Ab)&&0!==(Ab.usage&this.rendererTextureUsage)):[];!e("disable-feature:i3s-basis")&&kb.some(Ab=>l.isSome(Ab)&&(Ab.encoding===ba.TextureEncoding.Basis||Ab.encoding===ba.TextureEncoding.KTX2))&&
(yield Ja.loadBasis());Ga.memory=0;var {componentOffsets:pb,geometries:ub,featureIds:Eb}=ab,Ib=this._collection,tb=ub[0],{layout:nb,indices:yb,interleavedVertexData:Fb,positionData:Jb,hasColors:Pb}=hb,Gb=this._materialParameters(tb,nb),Tb=pb||new Uint32Array([0,yb?yb.length:Fb.byteLength/nb[0].stride]);Tb={vertices:{data:Fb,count:Fb.byteLength/nb[0].stride,layoutParameters:Gb.geometryParams},positionData:{positions:Jb.data,indices:Jb.indices},indices:yb,componentOffsets:Tb};var zb=tb.transformation?
D.clone(tb.transformation):D.create();w.multiply(zb,ib,zb);tb=w.getTranslation(K.create(),zb);zb=u.fromMat4(y.create(),zb);var Rb=this.view.renderSpatialReference,Qb=this.view.basemapTerrain.spatialReference,Ob=K.create(),Kb=[1,1,1];N.localLinearScaleFactors(tb,Rb,Kb,Qb)||qa.errorOnce("Unsupported coordinate system for IM overlay");N.projectVectorToVector(tb,Rb,Ob,Qb);var Sb=Ib.createObject({toMapSpace:M.fromValues(Ob[0],Ob[1],Kb[0],Kb[1]),geometry:Tb,obb:Pa.geometryObb,transform:{position:tb,rotationScale:zb}}),
{textures:vb,texturePromise:Wb}=this._initMaterialAndTextures(Sb,Gb.material,kb,Gb.geometryParams.textureCoordinates===Oa.TextureCoordinateAttributeType.Atlas);Ga.memory+=this._memEstimateGeometryAdded(Sb);Ga.memory+=vb.reduce((Ab,Hb)=>Ab+(l.isSome(Hb)?this._memEstimateTextureAdded(Hb):0),0);kb=!!Gb.material.hasParametersFromSource;Gb="blend"!==Gb.material.alphaMode&&1<=Gb.material.metallicRoughness.baseColorFactor[3];var wb=new Da(Ga,Eb,Sb,this._getInvalidRendererVersion(),Va.attributeInfo,{hasParametersFromSource:kb,
isOpaque:Gb},vb);Va.meta=wb;!this._hasTextures&&Pa.requiredTextures?.some(({usage:Ab})=>0!==(Ab&ba.TextureUsage.ColorTextures))&&(this._hasTextures=!0);this._hasData=!0;this._hasColors=this._hasColors||Pb;this._hasTextures=this._hasTextures||!!Ga.resources.texture;this.notifyChange("hasTexturesOrVertexColors");var ec=this.slicePlaneEnabled;return Promise.all([this._addOrUpdateEdgeRendering(wb),Wb]).then(([Ab])=>{l.isSome(Ab)&&Ab.updateObjectVisibility(wb.objectHandle,!1).catch(Hb=>Za(Hb,this.i3slayer.title));
return this._safeReschedule(()=>{var Hb=this._addTasks.get(Ga.index);if(Hb)if(this._addNodeMeta(Ga.index,wb),Hb.meta=null,this.suspended)this._removeNodeStageData(Ga.index,this.elevationOffset);else{Ib.setObjectVisibility(Sb,Ia.State.Visible);l.isSome(Ab)&&Ab.updateObjectVisibility(wb.objectHandle,!0).catch(Xb=>Za(Xb,this.i3slayer.title));wb.attributeInfo=Hb.attributeInfo;Hb=wb.cachedRendererVersion!==this._rendererVersion;var fc=ec!==this.slicePlaneEnabled;this._updateElevationOffsets(wb);var dc=
wb.elevationOffsets;this._updateComponentData(wb);var Yb=this._applyFiltersToNode(wb);(Hb||l.isSome(Ab)&&(fc||Yb||dc))&&this._addOrUpdateEdgeRendering(wb);l.isSome(this._labeler)&&this._addMetaToLabeler(this._labeler,wb);this._visibleGeometryChanged(wb,Xa.ADD);this._highlights.objectCreated(wb);this._updateMaterial(wb);this._setNewNodeOpacity(wb);l.isSome(this._treeDebugger)&&this._treeDebugger.update()}},Ra)}).catch(Ab=>{l.isSome(Va.meta)&&(this._cacheGPUData(Va.meta),Va.meta=null);throw Ab;})}});
return function(Ga,Pa,Ra){return ra.apply(this,arguments)}}();Ha._addNodeMeta=function(ra,Ga){this._removeNodeStageData(ra,this.elevationOffset,this._nodeId2MetaReloading);if(this._nodeId2Meta.has(ra)){qa.error("Removing duplicated node");const Pa=this._nodeId2Meta.get(ra);l.isSome(Pa)&&this._deleteComponentObject(Pa)}else this._controller.updateLoadStatus(ra,!0);l.isSome(Ga)&&(Ga.lodCrossfadeProgress=null,this.nodeCrossfadingEnabled&&Ca(Ga.cachedEdgeMaterials,0));this._nodeId2Meta.set(ra,Ga)};Ha._updateElevationOffsets=
function(ra){const Ga=this.view.renderSpatialReference,Pa=this.elevationInfo,Ra=this.view.basemapTerrain,Va=Ra.spatialReference;var ab=Pa.mode;if(l.isNone(Ga)||l.isNone(Va)||ab===c.ElevationMode.Absolute)ra.elevationOffsets=null;else{var hb=this._collection.getObjectTransform(ra.objectHandle);ra.elevationOffsets=ra.elevationOffsets??[];var ib=ab===c.ElevationMode.OnTheGround;ab=this.view.renderCoordsHelper;var kb=ra.featureIds.length;if(!ra.cachedMidsTerrainSR){ra.cachedMidsTerrainSR=Sa.newDoubleArray(3*
kb);const Ib=ra.cachedMidsTerrainSR;for(let tb=0;tb<kb;tb++){this._collection.getComponentAabb(ra.objectHandle,tb,mb,!0);E.set(rb,(mb[0]+mb[3])/2,(mb[1]+mb[4])/2,mb[2]);E.transformMat3(rb,rb,hb.rotationScale);E.add(rb,rb,hb.position);const nb=3*tb;Ib[nb+2]=ab.getAltitude(rb);N.projectVectorToVector(rb,Ga,rb,Va);Ib[nb+0]=rb[0];Ib[nb+1]=rb[1]}}var pb=ra.cachedMidsTerrainSR,ub=Pa.offset,Eb=ra.elevationOffsets;Ra.getElevations(pb,kb,(Ib,tb)=>{const nb=ib?pb[3*Ib+2]:0;Eb[Ib]=ub+(l.isSome(tb)?tb-nb:0)})}};
Ha._ensureElevationTask=function(){return l.isSome(this._elevationTask)?this._elevationTask:this._elevationTask=new ea.I3SAsyncElevationUpdater(this.view.resourceController.scheduler,ra=>{ra=this._controller.updateElevationChanged(ra,this.view.basemapTerrain.spatialReference);return l.isSome(ra)?ra.filterInPlace(Ga=>l.isSome(this._nodeId2Meta.get(Ga))):null},ra=>{ra=this._nodeId2Meta.get(ra);this._nodeElevationAlignmentChanged(ra)})};Ha._elevationInfoChanged=function(ra,Ga){const Pa=ra.mode!==c.ElevationMode.Absolute;
ra=!!Ga&&Ga!==ra&&Ga.mode!==c.ElevationMode.Absolute;this._intersectionHandler.updateElevationAlignState(Pa,this.view.state.viewingMode);Pa&&!ra&&this._controller.removeAllGeometryObbs();this._nodeId2Meta.forEach(Ra=>this._nodeElevationAlignmentChanged(Ra))};Ha._nodeElevationAlignmentChanged=function(ra){l.isNone(ra)||(this._updateElevationOffsets(ra),this._updateComponentData(ra),this._updateEdgeRendering(ra),l.isSome(this._labeler)&&this._labeler.updateLabelPositions(ra),this._updateSnappingSources(ra,
Xa.UPDATE))};Ha._safeReschedule=function(ra,Ga){q.throwIfAborted(Ga);return this._controller.reschedule(ra,Ga)};Ha._materialParameters=function(ra,Ga){ra=l.isSome(ra.params.material)?ra.params.material:ha.defaultMaterial();const Pa=Ga.some(Va=>"uvRegion"===Va.name);Ga=Ga.some(Va=>"normalCompressed"===Va.name);const Ra=ma(ra);return{geometryParams:this._getGeometryParameters({hasTexture:Ra,hasNormals:Ga,hasRegions:Pa}),material:ra}};Ha._initMaterialAndTextures=function(ra,Ga,Pa,Ra){const Va=this._stage.renderView,
ab=Pa.map(ib=>ha.createTexture(ib,Ga,Ra,Va));this._stage.addMany(ab);let hb=null;this._collection.updateMaterial(ra,ib=>{hb=ha.configureMaterial(ib,Ga,ab,Pa,this.view._stage.renderView.textureRepository,{rendererTextureUsage:this.rendererTextureUsage,usePBR:this._usePBR,isIntegratedMesh:this._isIntegratedMesh,slicePlaneEnabled:this.slicePlaneEnabled,viewSpatialReference:this.view.spatialReference});this._updateMaterialOverlay(ib)});return{textures:ab,texturePromise:hb}};Ha._getGeometryParameters=
function(ra){return{textureCoordinates:ra.hasTexture?ra.hasRegions?Oa.TextureCoordinateAttributeType.Atlas:Oa.TextureCoordinateAttributeType.Default:Oa.TextureCoordinateAttributeType.None,colors:this._hasVertexColors,normals:ra.hasNormals&&!this._isIntegratedMesh}};Ha._addData=function(ra,Ga,Pa){let Ra=this._addTasks.get(ra.index);Ra?Ra.attributeInfo=Ga:(Ra={...q.createResolver(),attributeInfo:Ga,meta:null},this._addTasks.set(ra.index,Ra),Pa().then(Ra.resolve,Ra.reject).then(()=>this._addTasks.delete(ra.index)).catch(Va=>
{this._addTasks.delete(ra.index);throw Va;}));return Ra.promise};Ha._clearAddTasks=function(){this._addTasks.forEach(ra=>{l.isSome(ra.meta)&&(this._cacheGPUData(ra.meta),ra.meta=null)});this._addTasks.clear()};Ha._clippingAreaChanged=function(){var ra=this.view.renderSpatialReference;const Ga=this.i3slayer.spatialReference,Pa=I.create();this._renderClippingArea=ua.toBoundingRect(this.view.clippingArea,Pa,ra)?Pa:null;ra=I.create();this._layerClippingArea=ua.toBoundingRect(this.view.clippingArea,ra,
Ga)?ra:null;this._filterChange();this._controller&&this._controller.updateClippingArea(this.view.clippingArea);this._isIntegratedMesh&&this._modificationsChanged()};Ha._geometryFilterChange=function(){const ra=this.hasGeometryFilter;this._controller.geometryFilterChanged(ra);this._applyFilters(ra)};Ha._filterChange=function(){this._applyFilters(this.hasGeometryFilter)};Ha._applyFilters=function(ra){this._filters=this.getFilters();ra?this._controller&&this._controller.requestUpdate():this._nodeId2Meta.forEach(Ga=>
{l.isSome(Ga)&&this._applyFiltersToNode(Ga)&&(this._addOrUpdateEdgeRendering(Ga),this._visibleGeometryChanged(Ga,Xa.UPDATE))})};Ha.getFilters=function(){const ra=[],Ga=this._renderClippingArea;l.isSome(Ga)&&ra.push((Pa,Ra)=>this._boundingRectFilter(Pa,Ra,Ga));return ra};Ha.addSqlFilter=function(ra,Ga,Pa){if(l.isSome(Ga)){const Ra=Ga.fieldNames;ra.push((Va,ab)=>this._sqlFilter(Va,ab,Ga,Ra,Pa))}};Ha._sqlFilter=function(ra,Ga,Pa,Ra,Va){const ab={},hb=this._createLayerGraphic(ab),ib=this.i3slayer.objectIdField,
kb=Ga.featureIds,pb=l.isSome(Ga.attributeInfo)&&Ga.attributeInfo.attributeData;Ra.every(ub=>ub===ib||pb&&null!=pb[ub])&&na.filterInPlace(ra,kb,ub=>{ab[ib]=kb[ub];for(const Eb of Ra)Eb!==ib&&(ab[Eb]=pb?na.getCachedAttributeValue(pb[Eb],ub):null);try{return Pa.testFeature(hb)}catch(Eb){return Va(Eb),!1}})};Ha._boundingRectNodeTest=function(ra,Ga){N.projectBoundingSphere(ra.node.mbs,this._controller.crsIndex,Nb,this.view.renderSpatialReference);return na.intersectBoundingRectWithMbs(Ga,Nb)};Ha._boundingRectFeatureTest=
function(ra,Ga,Pa){this._collection.getComponentAabb(ra.objectHandle,Ga,db);P.toRect(db,fb);return I.intersects(Pa,fb)};Ha._boundingRectFilter=function(ra,Ga,Pa){var Ra=this._collection;const Va=this._boundingRectNodeTest(Ga,Pa);if(Va!==na.MbsIntersectResult.INSIDE)if(Va===na.MbsIntersectResult.OUTSIDE)ra.length=0;else if(Ra=Ra.getComponentCount(Ga.objectHandle),Ra.invisible+Ra.visible===Ga.featureIds.length){var ab=this._transformClippingArea(jb,Pa,Ga.objectHandle);na.filterInPlace(ra,Ga.featureIds,
hb=>this._boundingRectFeatureTest(Ga,hb,ab))}};Ha._transformClippingArea=function(ra,Ga,Pa){var Ra=this._collection.getObjectTransform(Pa);Pa=Ra.position;Ra=Ra.rotationScale;ra[0]=(Ga[0]-Pa[0])/Ra[0];ra[1]=(Ga[1]-Pa[1])/Ra[4];ra[2]=(Ga[2]-Pa[0])/Ra[0];ra[3]=(Ga[3]-Pa[1])/Ra[4];return ra};Ha._addOrUpdateEdgeRendering=function(ra,Ga=!0){const Pa=this._edgeView;if(l.isNone(Pa))return Promise.resolve(null);const Ra=ra.objectHandle;var Va=Pa.hasObject(Ra);const {hasEdges:ab,perFeatureEdgeMaterials:hb}=
this._getFilteredEdgeMaterials(ra),ib={hasSlicePlane:this.slicePlaneEnabled};if(ab&&Va)return this.nodeCrossfadingEnabled&&(Va=this.getNodeOpacity(ra),Ca(hb,Va)),Pa.updateAllComponentMaterials(Ra,hb,ib,Ga).catch(kb=>Za(kb,this.i3slayer.title)),Pa.updateObjectVisibility(Ra,!0).catch(kb=>Za(kb,this.i3slayer.title)),Pa.updateAllVerticalOffsets(Ra,ra.elevationOffsets).catch(kb=>Za(kb,this.i3slayer.title)),Promise.resolve(Pa);if(ab&&!Va)return this._collection.addEdges(Ra,Pa,hb,ib).then(kb=>{ra.edgeMemoryUsage=
kb;ra.node.memory+=kb;Pa.updateAllVerticalOffsets(Ra,ra.elevationOffsets).catch(pb=>Za(pb,this.i3slayer.title));return Pa});!ab&&Va&&(ra.node.memory-=ra.edgeMemoryUsage,ra.edgeMemoryUsage=0,Pa.removeObject(Ra));return Promise.resolve(null)};Ha._applyFiltersToNode=function(ra){return this._applyFiltersToNodeComponents(ra)?(l.isSome(this._labeler)&&this._labeler.applyFilterChange(ra),!0):!1};Ha._applyFiltersToNodeComponents=function(ra){const Ga=this._collection;var Pa=0===Ga.getComponentCount(ra.objectHandle).invisible;
Ga.setAllComponentVisibilities(ra.objectHandle,"all");if(0===this._filters.length)return ra.filteredIds=null,!Pa;this._updateCachedFilteredIds(ra);if(ra.filteredIds===ra.featureIds)return!Pa;Pa=this._computeFilteredComponentIndices(ra);Ga.setAllComponentVisibilities(ra.objectHandle,Pa);return!0};Ha._updateCachedFilteredIds=function(ra){if(null==ra.filteredIds||ra.appliedFilters!==this._filters)ra.filteredIds=this._computeFilteredIds(ra),ra.appliedFilters=this._filters};Ha._computeFilteredIds=function(ra){const Ga=
ra.featureIds.slice();for(const Pa of this._filters)if(Pa(Ga,ra),0===Ga.length)break;return Ga.length===ra.featureIds.length?ra.featureIds:Ga};Ha._computeFilteredComponentIndices=function(ra){const Ga=[],Pa=ra.filteredIds;l.isSome(Pa)&&ra.featureIds.forEach((Ra,Va)=>{Pa[Ga.length]===Ra&&Ga.push(Va)});return Ga};Ha._removeAllNodeDataFromStage=function(ra=this.elevationOffset){this._nodeId2Meta.forEach((Ga,Pa)=>this._removeNodeStageData(Pa,ra));this._nodeId2MetaReloading.forEach((Ga,Pa)=>this._removeNodeStageData(Pa,
ra,this._nodeId2MetaReloading));this._elevationTask=l.destroyMaybe(this._elevationTask)};Ha.removeNode=function(ra){const Ga=this.elevationOffset;this._removeNodeStageData(ra,Ga);this._removeNodeStageData(ra,Ga,this._nodeId2MetaReloading);l.isSome(this._elevationTask)&&this._elevationTask.remove(ra)};Ha._removeNodeStageData=function(ra,Ga,Pa=this._nodeId2Meta){Pa.has(ra)&&this._controller.updateLoadStatus(ra,!1);const Ra=Pa.get(ra);l.isNone(Ra)?Pa.delete(ra):(this._collection.setObjectVisibility(Ra.objectHandle,
Ia.State.Hidden),l.isSome(this._edgeView)&&this._edgeView.hasObject(Ra.objectHandle)&&this._edgeView.updateObjectVisibility(Ra.objectHandle,!1).catch(Va=>Za(Va,this.i3slayer.title)),this._visibleGeometryChanged(Ra,Xa.REMOVE),l.isSome(this._labeler)&&this._labeler.removeNodeMeta(Ra),Pa.delete(ra),this._highlights.objectDeleted(Ra),Pa===this._nodeId2Meta?(this._cacheGPUData(Ra,Ga),this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopNodeFading(Ra)):this._deleteComponentObject(Ra),l.isSome(this._treeDebugger)&&
this._treeDebugger.update())};Ha._deleteComponentObject=function(ra){l.isSome(this._edgeView)&&this._edgeView.removeObject(ra.objectHandle);this._memEstimateGeometryRemoved(ra.objectHandle);this._collection.destroyObject(ra.objectHandle);if(ra.textures)for(const Ga of ra.textures)this._memEstimateTextureRemoved(Ga),this._stage.remove(Ga)};Ha.updateNodeState=function(ra,Ga){ra=this._nodeId2Meta.get(ra);l.isSome(ra)&&this._collection.updateMaterial(ra.objectHandle,Pa=>Pa.polygonOffsetEnabled=Ga===fa.NodeState.Hole)};
Ha._invalidateAllSymbols=function(){this._rendererVersion=na.addWraparound(this._rendererVersion,1);this._controller&&this._controller.requestUpdate()};Ha._getInvalidRendererVersion=function(){return na.addWraparound(this._rendererVersion,-1)};Ha._rendererChange=function(){var ra=b._asyncToGenerator(function*(Ga){this._currentRenderer=Ga;this.notifyChange("rendererTextureUsage");this._rendererVersion=na.addWraparound(this._rendererVersion,1);this._opacityVariable=this._colorVariable=this._rendererFields=
null;this._invalidateAllSymbols();Ga&&(this._rendererFields=yield Ga.getRequiredFields(this.i3slayer.fieldsIndex));this._updateSymbologyFields();!this._arcade&&Ga&&"arcadeRequired"in Ga&&Ga.arcadeRequired&&(this._arcade=yield R.loadArcade());if(Ga&&"visualVariables"in Ga&&Ga.visualVariables)for(const Pa of Ga.visualVariables)"color"===Pa.type?this._colorVariable=Pa:"opacity"===Pa.type?this._opacityVariable=Pa:qa.warn(`Unsupported visual variable type for 3D Object Scene Services: ${Pa.type}`);if(Ga)for(const Pa of Ga.getSymbols())"mesh-3d"!==
Pa.type&&qa.error(`Symbols of type '${Pa.type}' are not supported for 3D Object Scene Services.`);this._controller&&this._controller.requestUpdate()});return function(Ga){return ra.apply(this,arguments)}}();Ha._getCachedEdgeMaterials=function(ra){this._hasComponentData&&ra.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(ra);return ra.cachedEdgeMaterials};Ha._getComponentParameters=function(ra){this._hasComponentData&&ra.cachedRendererVersion!==this._rendererVersion&&
this._updateCachedRendererData(ra);const Ga=ra.cachedSymbology;return(Pa,Ra)=>{const Va=5*Pa;J.set(Ra.externalColor,Ga[Va+0]/255,Ga[Va+1]/255,Ga[Va+2]/255,Ga[Va+3]/255);if(l.isSome(this._stage.renderView.objectAndLayerIdRenderHelper)){const ab=ra.featureIds[Pa];this._stage.renderView.objectAndLayerIdRenderHelper.setUidToObjectAndLayerId(ab,ab,this.layerId,this.layerUid+"_"+this.sublayerId,this.layerPopupEnabled,ra.node.resources.attributes,Pa,this.sublayerId);Ra.objectAndLayerIdColor=this._stage.renderView.getObjectAndLayerIdColor({graphicUid:ab,
layerUid:this.layerUid+"_"+this.sublayerId})}Ra.externalColorMixMode=Ga[Va+4]&(1<<La.CastShadows)-1;Ra.castShadows=0!==(Ga[Va+4]&1<<La.CastShadows);Ra.pickable=0!==(Ga[Va+4]&1<<La.Pickable);Ra.elevationOffset=ra.elevationOffsets?.[Pa]??0}};Ha._getSymbolInfo=function(ra,Ga){Ga=ra&&ra.getSymbol(Ga,{arcade:this._arcade});if(!(Ga instanceof Q))return null;ra=Ga.id;if(this._symbolInfos.has(ra))return this._symbolInfos.get(ra);Ga=na.getSymbolInfo(Ga);this._symbolInfos.set(ra,Ga);return Ga};Ha._setSymbologyOverride=
function(ra,Ga){this._symbologyOverride!==ra&&(this._symbologyOverride=ra,this._symbologyOverrideFields=Ga,this._invalidateAllSymbols(),this._updateSymbologyFields())};Ha._updateSymbologyFields=function(){this._symbologyFields=l.isSome(this._symbologyOverrideFields)&&0<this._symbologyOverrideFields.length?l.isSome(this._rendererFields)&&0<this._rendererFields.length?L.fixFields(this.i3slayer.fieldsIndex,[...this._rendererFields,...this._symbologyOverrideFields]):this._symbologyOverrideFields:this._rendererFields};
Ha._updateCachedRendererData=function(ra){ra.cachedRendererVersion=this._rendererVersion;if(this._hasComponentData){var Ga=this._tmpAttributeOnlyGraphic,Pa={};Ga.attributes=Pa;var Ra=this._currentRenderer,Va=l.isSome(ra.attributeInfo)&&ra.attributeInfo.attributeData,ab=null!=ra.featureIds?this.i3slayer.objectIdField:null,hb=null!=Va&&l.isSome(this._symbologyFields)&&0<this._symbologyFields.length,ib=null,kb=null;if(hb&&l.isSome(this._symbologyFields)){ib=[];kb=[];for(var pb of this._symbologyFields){var ub=
Va[pb];ub&&(ib.push(pb),kb.push(ub))}}ra.cachedSymbology||(ra.cachedSymbology=new Uint8Array(5*ra.featureIds.length));Va={color:ob,castShadows:!0,pickable:!0,colorMixMode:za.ColorMixModeEnum.Multiply,edgeMaterial:null};pb=this.fullOpacity;pb=this.nodeCrossfadingEnabled?this.getNodeOpacity(ra):pb;ub=null;var Eb=Ua.Transparency.OPAQUE,Ib=na.transparentEdgeMaterial,tb=0;for(let Jb=0;Jb<ra.featureIds.length;Jb++){null!=ab&&(Pa[ab]=ra.featureIds[Jb]);if(hb&&ib)for(var nb=0;nb<ib.length;nb++)Pa[ib[nb]]=
na.getCachedAttributeValue(kb[nb],Jb);var yb=Ra?this._getSymbolInfo(Ra,Ga):null;let Pb=nb=null;if(Ra&&"visualVariables"in Ra){if(this._colorVariable){var Fb=S.getColor(this._colorVariable,Ga,{color:xb,arcade:this._arcade});Fb&&(nb=ob,nb[0]=Fb.r/255,nb[1]=Fb.g/255,nb[2]=Fb.b/255,this._opacityVariable||null===Fb.a||(Pb=Fb.a))}this._opacityVariable&&(Pb=S.getOpacity(this._opacityVariable,Ga,{arcade:this._arcade}))}yb&&yb.material&&(Fb=yb.material,nb=l.isNone(nb)||l.isNone(Pb)?U.overrideColor(nb,Pb,Fb.color,
Fb.alpha,ya,ob):U.overrideColor(nb,Pb,null,null,ya,ob));l.isNone(nb)&&(nb=ob,nb[0]=1,nb[1]=1,nb[2]=1,nb[3]=1);Va.pickable=!0;Va.castShadows=yb?yb.castShadows:!0;Va.colorMixMode=yb&&yb.material?yb.material.colorMixMode:za.ColorMixModeEnum.Multiply;Va.edgeMaterial=yb?yb.edgeMaterial:null;l.isSome(this._symbologyOverride)&&(Va.color=nb,this._symbologyOverride(Ga,Va),nb=Va.color);if(l.isSome(Va.edgeMaterial)){yb=0>=nb[3]?Ua.Transparency.INVISIBLE:1<=nb[3]&&(ra.material.isOpaque||Va.colorMixMode===za.ColorMixModeEnum.Replace)?
Ua.Transparency.OPAQUE:Ua.Transparency.TRANSPARENT;if(Va.edgeMaterial!==ub||yb!==Eb)Ib={...Va.edgeMaterial,opacity:pb,objectTransparency:yb},ub=Va.edgeMaterial,Eb=yb;ra.cachedEdgeMaterials[Jb]=Ib}else ra.cachedEdgeMaterials[Jb]=na.transparentEdgeMaterial;ra.cachedSymbology[tb+0]=Math.round(255*nb[0]);ra.cachedSymbology[tb+1]=Math.round(255*nb[1]);ra.cachedSymbology[tb+2]=Math.round(255*nb[2]);ra.cachedSymbology[tb+3]=Math.round(255*nb[3]);ra.cachedSymbology[tb+4]=Va.colorMixMode|+Va.castShadows<<
La.CastShadows|+Va.pickable<<La.Pickable;tb+=5}}};Ha._getFilteredEdgeMaterials=function(ra){var Ga=this._getCachedEdgeMaterials(ra);this.nodeCrossfadingEnabled||Ca(Ga,this.fullOpacity);const Pa=ra.filteredIds;if(l.isNone(Pa))return{hasEdges:Ga.some(ab=>ab!==na.transparentEdgeMaterial),perFeatureEdgeMaterials:Ga};let Ra=0,Va=!1;Ga=Ga.map((ab,hb)=>{if(ra.featureIds[hb]!==Pa[Ra])return na.transparentEdgeMaterial;Va=Va||ab!==na.transparentEdgeMaterial;Ra++;return ab});return{hasEdges:Va,perFeatureEdgeMaterials:Ga}};
Ha._updateComponentData=function(ra){if(this._hasComponentData){var Ga=ra.objectHandle;ra=this._getComponentParameters(ra);this._collection.setComponentData(Ga,ra);this._stage.renderView.requestRender()}};Ha._reloadAll=function(ra=this.elevationOffset){this._removeAllNodeDataFromStage(ra);null!=this._controller&&this._controller.restartNodeLoading()};Ha._opacityChange=function(ra){this.nodeCrossfadingEnabled&&this._crossfadeHelper.stopAllNodeFading();this._nodeId2Meta.forEach(Ga=>{l.isNone(Ga)||(this._collection.updateMaterial(Ga.objectHandle,
Pa=>Pa.objectOpacity=ra),Ca(Ga.cachedEdgeMaterials,ra),this._updateEdgeRendering(Ga))})};Ha._updateMaterial=function(ra){this._collection.updateMaterial(ra.objectHandle,Ga=>{Ga.commonMaterialParameters.hasSlicePlane=this.slicePlaneEnabled;Ga.usePBR=this._usePBR;this._updateMaterialOverlay(Ga)})};Ha._updateMaterialOverlay=function(ra){};Ha._updateEngineObject=function(ra){this._updateComponentData(ra);this._applyFiltersToNode(ra);this._addOrUpdateEdgeRendering(ra);this._visibleGeometryChanged(ra,Xa.UPDATE)};
Ha._slicePlaneEnabledChange=function(ra){this._intersectionHandler&&(this._intersectionHandler.slicePlaneEnabled=ra);l.isSome(this._labeler)&&(this._labeler.slicePlaneEnabled=ra);this._nodeId2Meta.forEach(Ga=>{l.isNone(Ga)||(this._collection.updateMaterial(Ga.objectHandle,Pa=>Pa.commonMaterialParameters.hasSlicePlane=ra),this._updateEdgeRendering(Ga,!1))})};Ha._updatePBR=function(ra){this._nodeId2Meta.forEach(Ga=>{l.isNone(Ga)||this._collection.updateMaterial(Ga.objectHandle,Pa=>Pa.usePBR=ra)});this._hasLoadedPBRTextures=
!0};Ha._updateEdgeRendering=function(ra,Ga=!0){l.isSome(this._edgeView)&&this._edgeView.hasObject(ra.objectHandle)&&this._addOrUpdateEdgeRendering(ra,Ga)};Ha._forAllNodes=function(ra){this._nodeId2Meta.forEach(ra)};Ha._forAllFeatures=function(ra,Ga,Pa=W.ForAllFeaturesVisibilityMode.VISIBLE_ONLY){h.someMap(this._nodeId2Meta,Ra=>{if(l.isNone(Ra))return!1;if(l.isSome(Ga))switch(Ga(Ra)){case W.ForAllFeaturesReturnType.EXIT:return!0;case W.ForAllFeaturesReturnType.SKIP:return!1}let Va=W.ForAllFeaturesReturnType.CONTINUE;
switch(Pa){case W.ForAllFeaturesVisibilityMode.ALL:Va=this._forAllFeaturesOfNode(Ra,ra);break;case W.ForAllFeaturesVisibilityMode.VISIBLE_ONLY:Va=this._forVisibleFeaturesOfNode(Ra,ra);break;case W.ForAllFeaturesVisibilityMode.ALL_IN_CLIPPING_AREA:Va=this._forAllFeaturesOfNodeInClippingArea(Ra,ra)}return Va===W.ForAllFeaturesReturnType.EXIT})};Ha._forAllFeaturesOfNode=function(ra,Ga){let Pa=W.ForAllFeaturesReturnType.CONTINUE;const Ra=ra.featureIds;for(let Va=0;Va<Ra.length&&(Pa=Ga(Ra[Va],Va,ra),Pa!==
W.ForAllFeaturesReturnType.EXIT);Va++);return Pa};Ha._forVisibleFeaturesOfNode=function(ra,Ga){let Pa=W.ForAllFeaturesReturnType.CONTINUE;const Ra=ra.featureIds;this._collection.forEachVisibleComponent(ra.objectHandle,Va=>{Pa=Ga(Ra[Va],Va,ra);return Pa===W.ForAllFeaturesReturnType.CONTINUE});return Pa};Ha._forAllFeaturesOfNodeInClippingArea=function(ra,Ga){if(l.isNone(this._renderClippingArea))return this._forAllFeaturesOfNode(ra,Ga);var Pa=this._boundingRectNodeTest(ra,this._renderClippingArea);
if(Pa===na.MbsIntersectResult.OUTSIDE)return W.ForAllFeaturesReturnType.CONTINUE;if(Pa===na.MbsIntersectResult.INSIDE)return this._forAllFeaturesOfNode(ra,Ga);Pa=W.ForAllFeaturesReturnType.CONTINUE;const Ra=ra.featureIds,Va=na.getClipRect(this._renderClippingArea,this._collection.getObjectTransform(ra.objectHandle));for(let ab=0;ab<Ra.length;ab++){if(!this._boundingRectFeatureTest(ra,ab,Va))continue;const hb=Ga(Ra[ab],ab,ra);if(hb===W.ForAllFeaturesReturnType.EXIT)return hb}return Pa};Ha._createAttributes=
function(ra,Ga){const Pa={};null!=Ga.featureIds&&(Pa[this._getObjectIdField()]=Ga.featureIds[ra]);Ga=l.isSome(Ga.attributeInfo)&&Ga.attributeInfo.attributeData;if(l.isSome(Ga))for(const Ra of Object.keys(Ga))Pa[Ra]=na.getCachedAttributeValue(Ga[Ra],ra);return Pa};Ha._createGraphic=function(ra,Ga){return this._createLayerGraphic(this._createAttributes(ra,Ga))};Ha.highlight=function(ra){const Ga=this._highlights;"number"===typeof ra?ra=[ra]:ra instanceof r?ra=[ra]:ra instanceof f&&(ra=ra.toArray());
if(Array.isArray(ra)&&0<ra.length){if(ra[0]instanceof r){const Pa=this.i3slayer.fieldsIndex,Ra=this._getObjectIdField();ra=ra.map(hb=>wa.attributeLookup(Pa,hb.attributes,Ra));const {set:Va,handle:ab}=Ga.acquireSet();Ga.setFeatureIds(Va,ra);return ab}if("number"===typeof ra[0]){const {set:Pa,handle:Ra}=Ga.acquireSet();Ga.setFeatureIds(Pa,ra);return Ra}}return Bb};Ha.resetHighlights=function(){l.destroyMaybe(this._highlights);this._highlights=new da({collection:this._collection,forAllFeatures:ra=>this._forAllFeatures(ra,
null,W.ForAllFeaturesVisibilityMode.ALL),forAllFeaturesOfNode:(ra,Ga)=>this._forAllFeaturesOfNode(ra,Ga)})};Ha._visibleGeometryChanged=function(ra,Ga){this._elevationProvider&&(this._elevationProvider.objectChanged(ra.node),null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=p.schedule(()=>{this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle=null})),this._updateSnappingSources(ra,Ga))};Ha.getNodeOpacityByIndex=function(ra){ra=
this._nodeId2Meta.get(ra);return this.getNodeOpacity(ra)};Ha.getNodeOpacity=function(ra){return l.isSome(ra)?this._collection.getMaterial(ra.objectHandle).objectOpacity:0};Ha.isNodeFullyFadedIn=function(ra){return this._crossfadeHelper.isNodeFullyFadedIn(ra)};Ha.getNodeCrossfadeMetaData=function(ra){return this._nodeId2Meta.get(ra)};Ha.markNodeToRemove=function(ra){this._controller&&this._controller.markNodeToRemove(ra)};Ha.removeMarkedNodes=function(){this._controller&&this._controller.removeMarkedNodes()};
Ha.foreachCrossfadeNode=function(ra){this._nodeId2Meta.forEach((Ga,Pa)=>ra(Pa,Ga))};Ha.fadeNode=function(ra,Ga,Pa){if(this.nodeCrossfadingEnabled){var Ra=this._nodeId2Meta.get(ra);l.isSome(Ra)&&this._crossfadeHelper.fadeNode(ra,Ra,Ga,Pa)}};Ha.setNodeOpacityByIndex=function(ra,Ga){ra=this._nodeId2Meta.get(ra);l.isSome(ra)&&this._setNodeOpacity(ra,Ga)};Ha._setNodeOpacity=function(ra,Ga){this._collection.updateMaterial(ra.objectHandle,Pa=>Pa.objectOpacity=Ga);this._setNodeEdgeOpacity(ra,Ga)};Ha._setNodeEdgeOpacity=
function(ra,Ga){!l.isNone(this._edgeView)&&ra.cachedEdgeMaterials&&(Ca(ra.cachedEdgeMaterials,Ga),ra=ra.objectHandle,this._edgeView.hasObject(ra)&&this._edgeView.updateAllComponentOpacities(ra,Ga).catch(Pa=>Za(Pa,this.i3slayer.title)))};Ha.updateNodeModificationStatus=function(ra){var Ga=ra.length;if(this.hasModifications&&!(0>=Ga)&&!0===this._i3sWasmLoaded){Ga=this.uid;var Pa=Aa(ra);if(l.isSome(Pa)){T.filterObbsForModificationsSync({context:Ga,buffer:Pa.buffer});const Ra=new Float64Array(Pa.buffer);
ra.forAll((Va,ab)=>{ab=T.interpretObbModificationResults(Ra[ab]);Va.imModificationImpact=ab;ab!==fa.NodeIMModificationImpact.Unmodified&&this._controller.invalidateGeometryVisibility(Va.index)})}}};Ha.notifyUpdate=function(){this.notifyChange("updating")};Ha.notifyLODUpdate=function(){this._controller.notifyLODUpdate()};Ha.isUpdating=function(){return!(!this._controller||!this._controller.updating)||!!this._visibleGeometryChangedSchedulerHandle||l.isSome(this._labeler)&&this._labeler.updating||this._crossfadeHelper.updating||
this._i3sWasmLoaded instanceof Promise||0<this._asyncModuleLoading||l.isSome(this._elevationTask)&&this._elevationTask.running};Ha.trackSnappingSources=function(ra){var Ga=this;const Pa={events:ra,fetchEdgeLocations:function(){var Ra=b._asyncToGenerator(function*(Va,ab,hb){Va=Ga._nodeId2Meta.get(Va);if(l.isNone(Va))throw Error("invalid-node");const {origin:ib,buffer:kb}=yield Ga._collection.extractEdgeInformation(Va.objectHandle,ab,hb);Ga._snappingLocationsApplyElevation(Va,kb,ib);return{type:"components",
objectIds:Va.featureIds,locations:kb,origin:ib}});return function(Va,ab,hb){return Ra.apply(this,arguments)}}(),remove:()=>{m.removeUnordered(this._snappingSourcesTrackers,Pa)}};this._snappingSourcesTrackers.push(Pa);this._nodeId2Meta.forEach((Ra,Va)=>{l.isNone(Ra)||(Ra=this._controller.getRenderMbs(Ra.node),l.isSome(Ra)&&ra.add(Va,Ra))});return Pa};Ha._snappingLocationsApplyElevation=function(ra,Ga,Pa){if(ra.elevationOffsets&&this.elevationInfo.mode!==c.ElevationMode.Absolute){var Ra=Ga.position0,
Va=Ga.position1;Ga=Ga.componentIndex;var ab=K.create(),hb=K.create(),ib=(kb,pb)=>{E.add(kb,kb,Pa);this.view.renderCoordsHelper.worldUpAtPosition(kb,hb);E.add(kb,kb,E.scale(hb,hb,pb));E.subtract(kb,kb,Pa)};for(let kb=0;kb<Ra.count;kb++){const pb=ra.elevationOffsets[Ga.get(kb)];Ra.getVec(kb,ab);ib(ab,pb);Ra.setVec(kb,ab);Va.getVec(kb,ab);ib(ab,pb);Va.setVec(kb,ab)}}};Ha._updateSnappingSources=function(ra,Ga){const {index:Pa}=ra.node;ra=this._controller.getRenderMbs(ra.node);if(!l.isNone(ra))for(const Ra of this._snappingSourcesTrackers)Ga!==
Xa.REMOVE&&Ga!==Xa.UPDATE||Ra.events.remove(Pa),Ga!==Xa.ADD&&Ga!==Xa.UPDATE||Ra.events.add(Pa,ra)};b._createClass(Ka,[{key:"lodCrossfadeoutDuration",get:function(){return 0}},{key:"lodCrossfadeinDuration",get:function(){return 0}},{key:"lodCrossfadeUncoveredDuration",get:function(){return 0}},{key:"layerUid",get:function(){return this.i3slayer&&this.i3slayer.uid}},{key:"sublayerUid",get:function(){return null}},{key:"layerId",get:function(){return this.i3slayer&&this.i3slayer.id}},{key:"sublayerId",
get:function(){return null}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??0}},{key:"hasTexturesOrVertexColors",get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"}},{key:"rendererTextureUsage",get:function(){return na.rendererNeedsTextures(this._currentRenderer)?this._usePBR||this._hasLoadedPBRTextures?ba.TextureUsage.AllTexturesPBR:ba.TextureUsage.AllTextures:this._usePBR||this._hasLoadedPBRTextures?ba.TextureUsage.GeometryTexturesPBR:
ba.TextureUsage.GeometryTextures}},{key:"elevationOffset",get:function(){const ra=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null!=ra&&"absolute-height"===ra.mode){const Ga=C.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference),Pa=V.getMetersPerUnit(ra.unit);return l.unwrapOr(ra.offset,0)*Pa/Ga}return 0}},{key:"elevationInfo",get:function(){const ra=null!=this.i3slayer?this.i3slayer.elevationInfo:null;if(null==ra)return{mode:c.ElevationMode.Absolute,offset:0};var Ga=C.getMetersPerVerticalUnitForSR(this.i3slayer.spatialReference);
const Pa=V.getMetersPerUnit(ra.unit);Ga=l.unwrapOr(ra.offset,0)*Pa/Ga;switch(ra.mode){case "absolute-height":return{mode:c.ElevationMode.Absolute,offset:Ga};case "relative-to-ground":return{mode:c.ElevationMode.RelativeToGround,offset:Ga};case "on-the-ground":return{mode:c.ElevationMode.OnTheGround,offset:0};default:return{mode:c.ElevationMode.Absolute,offset:0}}}},{key:"supportedTextureEncodings",get:function(){return ha.getSupportedEncodings(this.view._stage.renderView.capabilities)}},{key:"uncompressedTextureDownsamplingEnabled",
get:function(){const ra=0===(this.supportedTextureEncodings&ba.TextureEncoding.DDS_S3TC);return this.view?.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&ra}},{key:"_idbCacheEnabled",get:function(){return!this._controller.disableIDBCache&&!this.hasModifications&&0===this.elevationOffset&&null!=this._cacheKeySuffix}},{key:"_supportsNodeCrossFading",get:function(){return!this.view?._stage?.renderer.shadowsEnabled}},{key:"nodeCrossfadingEnabled",get:function(){return this._supportsNodeCrossFading&&
(0<this.lodCrossfadeinDuration||0<this.lodCrossfadeoutDuration||0<this.lodCrossfadeUncoveredDuration)}},{key:"nodeFadeoutEnabled",get:function(){return this._supportsNodeCrossFading&&0<this.lodCrossfadeoutDuration}},{key:"hasGeometryFilter",get:function(){return!1}},{key:"_usePBR",get:function(){return!this._isIntegratedMesh&&this.view.qualitySettings.physicallyBasedRenderingEnabled}},{key:"performanceInfo",get:function(){const ra={displayedNumberOfFeatures:0,maximumNumberOfFeatures:0,totalNumberOfFeatures:0,
core:null,index:0,nodes:this._nodeId2Meta.size,"Total GPU Memory Estimate":(this._gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this._geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this._texMemoryEstimate/1048576).toFixed(1)+"MB","Unloaded Memory Estimate":(this.getUnloadedMemory()/1048576).toFixed(1)+"MB"};l.isSome(this._memCache)&&(ra.MemCache=Math.round(100*this._memCache.hitRate)+"% hit");this._controller&&(this._idbCacheEnabled&&(ra.IDBCache=Math.round(100*
this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(ra));return ra}},{key:"test",get:function(){const ra=this;return{controller:this._controller,labeler:this._labeler,get visibleObjectIds(){const Ga=[];ra._forAllFeatures(Pa=>{Ga.push(Pa);return W.ForAllFeaturesReturnType.CONTINUE},null,W.ForAllFeaturesVisibilityMode.VISIBLE_ONLY);Ga.sort((Pa,Ra)=>Pa-Ra);return Ga},get numNodes(){return ra._nodeId2Meta.size},get loadedNodes(){return Array.from(ra._nodeId2Meta.keys()).sort((Ga,Pa)=>Ga-
Pa)}}}},{key:"hasModifications",get:function(){return this._isIntegratedMesh&&l.isSome(this._layerClippingArea)||this._modifications&&0<this._modifications.length}}]);return Ka}(eb);t.__decorate([B.property()],eb.prototype,"_hasLoadedPBRTextures",void 0);t.__decorate([B.property()],eb.prototype,"_asyncModuleLoading",void 0);t.__decorate([B.property()],eb.prototype,"_visibleGeometryChangedSchedulerHandle",void 0);t.__decorate([B.property()],eb.prototype,"view",void 0);t.__decorate([B.property()],eb.prototype,
"i3slayer",void 0);t.__decorate([B.property()],eb.prototype,"_controller",void 0);t.__decorate([B.property()],eb.prototype,"_labeler",void 0);t.__decorate([B.property()],eb.prototype,"updating",void 0);t.__decorate([B.property()],eb.prototype,"suspended",void 0);t.__decorate([B.property()],eb.prototype,"holeFilling",void 0);t.__decorate([B.property(xa.updatingProgress)],eb.prototype,"updatingProgress",void 0);t.__decorate([B.property()],eb.prototype,"updatingProgressValue",null);t.__decorate([B.property()],
eb.prototype,"hasTexturesOrVertexColors",null);t.__decorate([B.property()],eb.prototype,"rendererTextureUsage",null);t.__decorate([B.property()],eb.prototype,"elevationOffset",null);t.__decorate([B.property()],eb.prototype,"elevationInfo",null);t.__decorate([B.property({type:Boolean})],eb.prototype,"slicePlaneEnabled",void 0);t.__decorate([B.property()],eb.prototype,"supportedTextureEncodings",null);t.__decorate([B.property()],eb.prototype,"uncompressedTextureDownsamplingEnabled",null);t.__decorate([B.property({type:[O]})],
eb.prototype,"_modifications",void 0);t.__decorate([B.property()],eb.prototype,"_elevationTask",void 0);t.__decorate([B.property({readOnly:!0})],eb.prototype,"_usePBR",null);return eb=t.__decorate([x.subclass("esri.views.3d.layers.I3SMeshView3D")],eb)};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../dehydratedFeatures ../../support/PromiseQueue ../../../views/ViewingMode ../../../views/3d/layers/i3s/I3SFrameTask ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNode ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SStreamDataController ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/support/I3SLayerView ../../../views/3d/support/extentUtils ../../../views/3d/support/index ../../../views/support/layerViewUtils ../../../views/support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P){function I(V,aa){return m.isSome(V)&&V.length===aa.length&&V.every(X=>0<=G(aa,X.name))}function G(V,aa){aa=aa.toLowerCase();for(let X=0;X<V.length;X++)if(V[X].name.toLowerCase()===aa)return X;return-1}const H=r.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");b=function(V){function aa(W){W=V.call(this,W)||this;W.screenSizeFactor=0;W.featureTarget=5E4;W.fixedFeatureTarget=!1;W.updating=!0;W.updatingProgress=
1;W.leavesReached=!1;W.scaleVisibilityEnabled=!0;W._featureLOD=1;W._stableFeatureLOD=!1;W._isIdle=!1;W._cameraDirty=!0;W._invisibleDirty=!1;W._idleStateCallbacks=null;W._newLoadingNodes=new d({deallocator:null});W._loadedNodeScales=new Map;W._modificationsNodeFilteringArray=new d;W._downloadingCount=0;W._loadingNodes=new Map;W._updatingNodes=new Map;W._progressMaxNumNodes=1;W._requiredAttributes=[];W._requiredAttributesDirty=!0;W._updatesDisabled=!1;W.disableIDBCache=!1;W._disableMemCache=!1;W._restartNodeLoading=
!1;W._fields=null;W._attributeStorageInfo=null;W._handles=new t;W._idleQueue=new C.PromiseQueue;W._elevationUpdateNodes=new d({deallocator:null});W._errorCount=0;return W}a._inheritsLoose(aa,V);var X=aa.prototype;X.initialize=function(){const {layerView:W,layer:T}=this;this._disableMemCache=!W.loadCachedGPUData||!W.addCachedGPUData;this._lodHandling=new u(W);this._defaultGeometrySchema=T.store.defaultGeometrySchema;this.disableIDBCache=n("disable-feature:idb-cache");"fields"in T&&(this._fields=T.fields,
this._attributeStorageInfo=T.attributeStorageInfo);this.addResolvingPromise(Promise.all([T.indexInfo,T.when(),W.when()]).then(([U])=>{if(!this.destroyed&&W&&!W.destroyed&&U){var {view:Y}=W,{resourceController:ba}=Y;this._setClippingArea(Y.clippingArea);this.addHandles([g.watch(()=>Y?.pointsOfInterest?.focus?.renderLocation,da=>this._pointOfInterestChanged(da),g.initial),g.watch(()=>ba.memoryController.memoryFactor,()=>this._setCameraDirty(),g.sync),g.watch(()=>W.suspended,da=>{const ea=da?()=>this._updateViewData():
()=>this._updateIdleState(!0),ca=da?()=>{}:()=>this._updateIdleState(!1);!da&&m.isSome(this._index)&&this._index.invalidateAllElevationRanges();this._idleStateCallbacks?(da&&this.cancelNodeLoading(),this.restartNodeLoading(),this._idleStateCallbacks.idleBegin=ea,this._idleStateCallbacks.idleEnd=ca):this._idleStateCallbacks=ba.scheduler.registerIdleStateCallbacks(ea,ca)},g.initial),A.addCallback(W.view.resourceController.scheduler,this),g.watch(()=>W.uncompressedTextureDownsamplingEnabled,()=>this.restartNodeLoading()),
g.watch(()=>[this.featureTarget,this.fixedFeatureTarget],()=>{this._setCameraDirty();this._stableFeatureLOD=!1}),g.watch(()=>Y.state?.contentCamera,()=>this._setCameraDirty()),g.watch(()=>T.elevationInfo,da=>this._elevationInfoChanged(da)),g.watch(()=>T.effectiveScaleRange,()=>this._scaleBoundsChanged()),g.watch(()=>W.lodFactor,()=>this._setCameraDirty()),g.watch(()=>W.availableFields,()=>this._requiredFieldsChange()),g.watch(()=>W.holeFilling,da=>m.isSome(this._index)&&(this._index.holeFilling=da))]);
this._updateScaleHandles();this._viewportQueries=new E(this.crsIndex,Y.renderCoordsHelper,Y.state.contentCamera,!Y.state.fixedContentCamera||this.isGraphics3D,this._clippingArea,this.isMeshPyramid?Y.basemapTerrain:Y.elevationProvider,B.viewingModeFromString(Y.viewingMode),this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(),screenspaceErrorBias:this._lod,angleDependentLoD:.5>this._lod});this._index=new x.I3SIndex(T,U,this.indexStreamController,this._viewportQueries,H,W.holeFilling,
da=>W.isNodeLoaded(da),da=>W.isNodeReloading(da),da=>this._shouldLoadNode(da),da=>this._enableFromGPUCache(da,y.NodeState.Leaf),da=>this._needsUpdate(da),()=>!this.indexStreamController.busy,da=>W.computeVisibilityObb?W.computeVisibilityObb(da):null,W?.computeNodeFiltering?da=>W.computeNodeFiltering(da):void 0);this._index.updateElevationInfo(this.layer.elevationInfo,this.isMeshPyramid);this._index.imModificationsChanged(!!W.hasModifications);this._startNodeLoading()}}));this._tmpPoint=z.makeDehydratedPoint(0,
0,0,this.crsIndex)};X.updateNodeModificationStatus=function(W){const T=this._index,U=this.layerView;m.isSome(T)&&U?.updateNodeModificationStatus&&(this._modificationsNodeFilteringArray.clear(),W.forAll(Y=>{Y=T.getNode(Y);m.isSome(Y)&&this._modificationsNodeFilteringArray.push(Y)}),U.updateNodeModificationStatus(this._modificationsNodeFilteringArray),this._invisibleDirty=!0)};X.destroy=function(){this.cancelNodeLoading();this._idleStateCallbacks&&(this._isIdle=!1,this._idleStateCallbacks.remove(),
this._idleStateCallbacks=null);this._handles.destroy();this._nodeLoader=null;L.prune();m.isSome(O)&&(O.hide(),O=null)};X._getRequiredAttributes=function(){if(null==this._attributeStorageInfo||!this._fields||!this.layerView.availableFields)return[];const W=this._attributeStorageInfo,T=this._fields,U=this.layer.objectIdField;return this.layerView.availableFields.map(Y=>{const ba=G(W,Y);Y=G(T,Y);return 0<=ba&&0<=Y?{index:ba,name:T[Y].name,field:T[Y],attributeStorageInfo:W[ba]}:null}).filter(Y=>null!=
Y&&Y.name!==U)};X._requiredFieldsChange=function(){const W=this._getRequiredAttributes();I(this._requiredAttributes,W)||(this._requiredAttributes=W,this._requiredAttributesDirty=!1,this.restartNodeLoading())};X.requestUpdate=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};X._setClippingArea=function(W){const T=p.create();J.toBoundingRect(W,T,this.layerView.view.renderSpatialReference)?this._clippingArea=T:this._clippingArea=null};X._pointOfInterestChanged=function(W){m.isSome(this._viewportQueries)&&
(this._viewportQueries.setPointOfInterest(W),m.isSome(this._index)&&(this._index.progressiveLoadPenalty=S.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestUpdate()))};X.updateClippingArea=function(W){this._setClippingArea(W);m.isSome(this._viewportQueries)&&m.isSome(this._index)&&(this._viewportQueries.updateClippingArea(this._clippingArea),this._index.invalidateVisibilityCache());this._setCameraDirty()};X._setCameraDirty=function(){this._cameraDirty=!0;this._lodHandling.setLodGlobalDirty();
this._evaluateUpdating()};X.updateElevationChanged=function(W,T){const U=this._index;if(m.isNone(U)||m.isNone(U.rootNode)||m.isNone(T))return null;this.crsIndex.equals(T)||(k.projectBoundingRect(W,T,R,this.crsIndex),W=R);const Y=this._elevationUpdateNodes;Y.clear();F.findIntersectingNodes(W,U.rootNode,U,ba=>Y.push(ba.index));Y.length&&(Y.forAll(ba=>U.updateElevationChanged(ba)),this._setCameraDirty());return Y};X.getParentIndex=function(W){return m.isSome(this._index)?this._index.getParentIndex(W):
-1};X.removeAllGeometryObbs=function(){m.isSome(this._index)&&this._index.removeAllGeometryObbs()};X.getRenderMbs=function(W){return m.isSome(this._viewportQueries)?this._viewportQueries.getRenderMbs(W):null};X._elevationInfoChanged=function(W){m.isNone(this._index)||(this._index.updateElevationInfo(W,this.isMeshPyramid),this._setCameraDirty())};X._updateScaleHandles=function(){this._handles.remove("scale-bounds");this._areScaleBoundsActive&&this._handles.add(this.layerView.view.basemapTerrain.on("scale-change",
W=>this._scaleUpdateHandler(W)),"scale-bounds")};X._scaleBoundsChanged=function(){this._areScaleBoundsActive||this._loadedNodeScales.clear();this._updateScaleHandles();this._setCameraDirty()};X._scaleUpdateHandler=function(W){this._updateScaleInBoundingRect(W.extent,W.spatialReference);this._setCameraDirty()};X._updateScaleInBoundingRect=function(W,T){const U=this._index;m.isNone(U)||!m.isNone(U.rootNode)&&k.projectBoundingRect(W,T,R,this.crsIndex)&&this._loadedNodeScales.forEach((Y,ba)=>{Y=U.getNode(ba);
m.isSome(Y)&&p.intersectsSphere(R,Y.mbs)&&this._loadedNodeScales.set(ba,this._computeScale(Y))})};X.restartNodeLoading=function(){this._restartNodeLoading=!0;this.cancelNodeLoading();this._evaluateUpdating()};X.schedule=function(W,T){return this._idleQueue.push(W,T)};X.reschedule=function(W,T){return this._idleQueue.unshift(W,T)};X.runTask=function(W,T){if(this.layerView.suspended)return this._updateViewData(),this._evaluateUpdating(),-Infinity;if(!this.layerView.visible||m.isNone(this._index))return-Infinity;
this._processWithErrorLogging(W,T);return this._index.maxPriority};X._processWithErrorLogging=function(W,T){try{this._process(W,T)}catch(U){50>this._errorCount?H.error("Error during processing: "+U):50===this._errorCount&&H.error("Too many errors for this layer. Further errors will not be displayed."),this._errorCount++}};X._process=function(W,T){this._restartNodeLoading&&this._startNodeLoading();null==this._nodeLoader||m.isNone(this._index)||(this._updateViewData(),this._invisibleDirty&&this._removeInvisibleNodes(W)&&
(this._invisibleDirty=!1),this._isIntegratedMesh&&(W.enabled=!1),W.run(()=>this._processIndex(W)),this._updateFeatureLOD(),W.run(()=>this._processCache(W)),this._isIntegratedMesh&&(W.enabled=!0),W.run(()=>this._processNodes(W,T)),this._idleQueue.runTask(W),W.run(()=>this._prefetchIndex()),T.numIndexLoading+=this._index.indexLoading,T.numNodesLoading+=this._downloadingCount,W.run(()=>this._lodHandling.lodGlobalHandling(W)),this._evaluateUpdating())};X._processIndex=function(W){if(m.isNone(this._index))return!1;
this._index.dirty&&(this._newLoadingNodes.clear(),this._index.update(Array.from(this._loadingNodes.keys()),W,T=>this.updateNodeModificationStatus(T)),this._disableMemCache||(this._newLoadingNodes.pushArray(this._index.updates.add.data,this._index.updates.add.length),this._newLoadingNodes.pushArray(this._index.updates.missing.data,this._index.updates.missing.length)),W=this._index.featureEstimate.leavesReached,this._index.isLoading||W===this._get("leavesReached")||this._set("leavesReached",W));return this._index.load()};
X._prefetchIndex=function(){return m.isNone(this._index)||0<this._loadingNodes.size||0<this._index.updates.add.length?!1:this._index.prefetch()};X._updateFeatureLOD=function(){if(this.useMaximumNumberOfFeatures&&!m.isNone(this._index)&&!m.isNone(this._viewportQueries)){var W=!this._index.isLoading,T=this.featureTarget*this._baseLOD,U=this._index.featureEstimate;U.estimate=U.estimate||T/2;if(500<this._index.indexMissing){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=
!1}else if(W&&U.estimate<T){if(U.leavesReached||1E4<=this._featureLOD||this._stableFeatureLOD)return;this._featureLOD*=Math.min(10,Math.max(T/U.estimate,1.001));W=this._lod;T=this._index.checkFeatureTarget(T,W);T!==W&&(this._featureLOD=T/this._baseLOD,this._stableFeatureLOD=!0)}else if(U.estimate>1.2*T||W&&U.estimate>T){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(U.estimate/T-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._lod);
this._index.requestUpdate()}};X._processCache=function(W){const T=this._index;if(m.isNone(T))return!1;for(;0<this._newLoadingNodes.length&&!W.done;){var U=this._newLoadingNodes.pop();for(U=T.getParent(U);m.isSome(U)&&!this.layerView.isNodeLoaded(U.index)&&this._isNodeInScaleBounds(U);U=T.getParent(U.index))if(this._enableFromGPUCache(U,y.NodeState.Hole)){W.madeProgress();break}}return W.hasProgressed};X._processNodes=function(W,T){if(m.isNone(this._index))return!1;let U=(this._isIdle?100:2)-this._loadingNodes.size;
const Y=this._index.updates;Y.cancel.forEach(this._cancelNode,this);for(Y.cancel=[];0<Y.remove.length&&!W.done;)this.layerView.removeNode(Y.remove.pop()),W.madeProgress();for(;0<Y.update.length&&!W.done;){var ba=this._index.getNode(Y.update.pop());m.isSome(ba)&&(this._updateLoadedNode(ba),W.madeProgress())}for(;0<Y.add.length&&!W.done&&0<U;){--U;ba=this._index.getNode(Y.add.back());if(m.isNone(ba)||ba.cacheState!==y.CacheState.Cached&&!this._hasNodeLoadToken(T))break;Y.add.pop();this._loadNode(ba);
W.madeProgress()}return W.hasProgressed};X._cancelAllNodes=function(){this._loadingNodes.forEach(W=>W.abort());this._loadingNodes.clear();this._updatingNodes.forEach(W=>W.abort());this._updatingNodes.clear()};X._cancelNode=function(W){const T=this._loadingNodes.get(W);T&&(T.abort(),this._loadingNodes.delete(W))};X._hasNodeLoadToken=function(W){return!this._isIdle&&2<=W.numNodesLoading+this._loadingNodes.size?!1:this._downloadingCount<M.maxDownloadSlots&&!this.dataStreamController.busy};X._evaluateUpdating=
function(){var W=!1,T=0;this.layerView.suspended?T=(W=this._cameraDirty)?0:1:(W=m.isSome(this._index)?this._index.indexMissing:0,T=m.isSome(this._index)?this._index.updates.add.length:0,T=W+3*T+2*this._loadingNodes.size,W=!!(0<T||0<this._updatingNodes.size||this._restartNodeLoading||this._cameraDirty||this._idleQueue.running||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling||m.isSome(this._index)&&this._index.isPrefetching),0===T&&(this._progressMaxNumNodes=1),this._progressMaxNumNodes=
Math.max(T,this._progressMaxNumNodes),T=1-T/this._progressMaxNumNodes);this.updating=W;this.updatingProgress=T};X._updateViewData=function(){if(this._cameraDirty&&!m.isNone(this._index)&&!m.isNone(this._viewportQueries)){var W=this.layerView.view,{contentCamera:T,fixedContentCamera:U}=W.state;this.screenSizeFactor=1/(T.perScreenPixelRatio/2);this._viewportQueries.updateCamera(T,!U||this.isGraphics3D);this._viewportQueries.setPointOfInterest(W.pointsOfInterest.focus.renderLocation);this._viewportQueries.updateScreenSpaceErrorBias(this._lod);
this._index.invalidateVisibilityCache();this._index.progressiveLoadPenalty=S.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestUpdate();this._stableFeatureLOD=!1;this._invisibleDirty=!0;this._cameraDirty=!1;this.notifyChange("rootNodeVisible")}};X._getProgressiveLoadFactor=function(){return 1>this.layerView.view.resourceController.memoryController.memoryFactor?1:this.layerView.progressiveLoadFactor};X.isGeometryVisible=function(W){return m.isSome(this._index)&&this._index.isGeometryVisible(W.index)};
X.updateVisibility=function(W){m.isSome(this._index)&&this._index.invalidateNodeVisibilityCache(W)};X.invalidateGeometryVisibility=function(W){m.isSome(this._index)&&this._index.invalidateGeometryVisibility(W)};X.invalidateVisibilityObbs=function(){m.isSome(this._index)&&this._index.invalidateVisibilityObbs()};X.modificationsChanged=function(){m.isSome(this._index)&&this._index.imModificationsChanged(!!this.layerView.hasModifications);this._invisibleDirty=!0};X._shouldLoadNode=function(W){return!this._lodHandling.shouldLoadNode(W)||
this._shouldDropNode(W)||m.isNone(this._index)||!this._index.isGeometryVisible(W.index)?!1:this._isNodeInScaleBounds(W)};X._shouldDropNode=function(W){if(m.isNone(this._viewportQueries))return!1;const T=this._lodDropFactor;return 1<=T||!this._lodHandling.hasNoVisibleChildren(W)?!1:Math.abs(this._viewportQueries.calcCameraDistanceToCenter(W))-this._viewportQueries.minDistance>(this._viewportQueries.maxDistance-this._viewportQueries.minDistance)*T};X._startNodeLoading=function(){this._restartNodeLoading=
!1;const W=this._index;this._updatesDisabled||m.isNone(W)||m.isNone(this._viewportQueries)||(this._updateViewData(),this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1),this._nodeLoader=new w(this.layer,this.dataStreamController,H,this._defaultGeometrySchema,this._requiredAttributes,{textureEncodings:this.layerView.supportedTextureEncodings,uncompressedTextureDownsamplingEnabled:this.layerView.uncompressedTextureDownsamplingEnabled,
textureUsageMask:this.layerView.rendererTextureUsage,loadFeatureData:this.useMaximumNumberOfFeatures}),W.requestUpdate(),this._lodHandling.startNodeLoading(T=>this._isNodeInScaleBounds(T),(T,U)=>this._removeNodes(T,U,Q.fadeout),W,{maxLodLevel:this._viewportQueries.maxLodLevel}),this._evaluateUpdating())};X.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};X.cancelNodeLoading=function(){this.isNodeLoading()&&(this.indexStreamController.cancelAll(),this.dataStreamController.cancelAll(),
this._idleQueue.cancelAll(),this._cancelAllNodes(),this._nodeLoader=null,this._evaluateUpdating())};X._removeInvisibleNodes=function(W){const T=this._index;if(m.isNone(T)||m.isNone(this._viewportQueries))return!1;L.clear();this.layerView.getLoadedNodeIndices(L);const U=0===this._viewportQueries.maxDistance,Y=U?()=>!1:ba=>this._shouldDropNode(ba);L.filterInPlace(ba=>{const da=T.getNode(ba);return m.isNone(da)||!T.isGeometryVisible(ba)||Y(da)||!this._isNodeInScaleBounds(da)});0<L.length&&this._lodHandling.setLodGlobalDirty();
this._removeNodes(L,W,Q.pop);if(U&&1>this._lodDropFactor)return!1;if(0===L.length)return!0;L.clear();return!1};X.markNodeToRemove=function(W){L.push(W)};X.removeMarkedNodes=function(){this._removeNodes(L,P.noBudget,Q.pop)};X._removeNodes=function(W,T,U){const Y=W.length;if(0!==Y&&!T.done){for(m.isSome(this._index)&&this._index.requestUpdate();0<W.length&&!T.done;){const ba=W.pop(),da=this._index;U===Q.fadeout&&this.layerView.nodeFadeoutEnabled&&m.isSome(da)&&da.isGeometryVisible(ba)?this.layerView.fadeNode(ba,
K.FadeDirection.FadeOut,!0):this.layerView.removeNode(ba);T.madeProgress()}if(0<this._loadedNodeScales.size)for(T=W.length;T<Y;T++)this._loadedNodeScales.delete(W.data[T])}};X._needsUpdate=function(W){if(!W.resources.hasFeatureData||this._updatingNodes.has(W.index))return!1;W=this.layerView.getLoadedAttributes(W.index);return null!=W&&W!==this._requiredAttributes};X._updateLoadedNode=function(W){const T=new AbortController;this._updatingNodes.set(W.index,T);const U=this.layerView.getLoadedAttributes(W.index);
(I(U,this._requiredAttributes)?Promise.resolve(this.layerView.getAttributeData(W.index)):this._nodeLoader.loadAttributes(W,this._requiredAttributes,T.signal)).then(Y=>this.schedule(()=>this.layerView.updateAttributes(W.index,{loadedAttributes:this._requiredAttributes,attributeData:Y},T.signal),T.signal)).catch(Y=>{if(!e.isAbortError(Y))return this.layerView.updateAttributes(W.index,{loadedAttributes:this._requiredAttributes,attributeData:{}},T.signal)}).catch(()=>{}).then(()=>{this._updatingNodes.delete(W.index);
this._evaluateUpdating()});this._evaluateUpdating()};X._loadNode=function(W){if(this._loadingNodes.has(W.index))H.error("already loading node "+W.index);else{var T=new AbortController;this._loadingNodes.set(W.index,T);this._evaluateUpdating();this._loadAndAddNode(W,T.signal).then(U=>{U&&m.isSome(this._index)&&this._loadingNodes.get(W.index)===T&&(this._loadingNodes.delete(W.index),this._index.requestUpdate())}).catch(U=>{if(!e.isAbortError(U))throw U;}).finally(()=>{this._loadingNodes.get(W.index)===
T&&this._loadingNodes.delete(W.index);this._evaluateUpdating()})}};X._loadAndAddNode=function(W,T){return W.cacheState===y.CacheState.Uncached?this._loadUncached(W,T).then(()=>!1):this._loadCached(W,T).then(U=>{if(U)return!1;W.cacheState=y.CacheState.Uncached;return!0}).catch(U=>e.isAbortError(U)?!1:(W.cacheState=y.CacheState.Uncached,!0))};X._enableFromGPUCache=function(W,T){if(this._disableMemCache||m.isNone(this._index))return!1;if(T===y.NodeState.Hole&&!this._index.useNodeAsHole(W.index))return!0;
const U=this._loadCachedGPUData(W);if(!U)return!1;this.layerView.addCachedGPUData(W,U,T);this._nodeAdded();return!0};X._loadCachedGPUData=function(W){W=this.layerView.loadCachedGPUData(W);if(m.isSome(W)&&m.isSome(W.attributeInfo)&&I(W.attributeInfo.loadedAttributes,this._requiredAttributes))return W;this.layerView.deleteCachedGPUData(W);return null};X._nodeAdded=function(){m.isSome(this._index)&&this._index.requestUpdate();this._lodHandling.setLodGlobalDirty();this._evaluateUpdating()};X.updateLoadStatus=
function(W,T){const U=this._index;m.isSome(U)&&U.updateChildrenLoaded(W,T?1:-1)};X._loadCached=function(W,T){if(this._enableFromGPUCache(W,y.NodeState.Leaf))return Promise.resolve(!0);const U=this.layerView;return!this.disableIDBCache&&U.loadCachedNodeData&&U.addCachedNodeData?this.schedule(()=>U.loadCachedNodeData(W,T,(Y,ba)=>this._nodeLoader.loadTextures(W,Y,ba)),T).then(Y=>{if(m.isNone(Y))return!1;const ba=this._requiredAttributes;return this.reschedule(()=>this._nodeLoader.loadAttributes(W,ba,
T),T).then(da=>this.reschedule(()=>U.addCachedNodeData(W,Y,{loadedAttributes:ba,attributeData:da},T),T)).then(()=>{this._nodeAdded();return!0})}):Promise.resolve(!1)};X._loadUncached=function(W,T){this._downloadingCount++;return this._nodeLoader.loadNodeData(W,T).catch(U=>{this._downloadingCount--;throw U;}).then(U=>{this._downloadingCount--;return this.schedule(()=>this.layerView.addNode(W,U,T),T)}).then(()=>{this._nodeAdded();W.cacheState=y.CacheState.Cached}).catch(U=>{if(!e.isAbortError(U))throw H.error("#loadNodeData()",
this.layer,`Failed to load node '${W.id}'`,U),W.failed=!0,m.isSome(this._index)&&this._index.requestUpdate(),U;})};X._updateIdleState=function(W){W!==this._isIdle&&(this._isIdle=W,this._evaluateUpdating(),W&&this._index&&m.isSome(this._index)&&this._index.resetFailedNodes())};X._getScale=function(W){if(this._loadedNodeScales.has(W.index))return this._loadedNodeScales.get(W.index);const T=this._computeScale(W);this.layerView.isNodeLoaded(W.index)&&this._loadedNodeScales.set(W.index,T);return T};X._computeScale=
function(W){this._tmpPoint.x=W.mbs[0];this._tmpPoint.y=W.mbs[1];this._tmpPoint.z=W.mbs[2];return this.layerView.view.basemapTerrain.getSphereScale(this._tmpPoint,W.mbs[3])};X._isNodeInScaleBounds=function(W){if(!this._areScaleBoundsActive)return!0;W=this._getScale(W);const {minScale:T,maxScale:U}=N.extractSafeScaleBounds(this.layer);return N.scaleBoundsPredicate(W,T,U)};X.updateStats=function(W){W.index=m.isSome(this._index)?this._index.size:0;this.isGraphics3D&&(W.detail=this._featureLOD,W.target=
this.featureTarget*this._baseLOD);m.isSome(this._index)&&this._index.updateStats(W)};X.notifyLODUpdate=function(){this._lodHandling.setLodGlobalDirty();this._evaluateUpdating();m.isSome(this._index)&&this._index.requestUpdate()};X.geometryFilterChanged=function(W){const T=this._index;m.isSome(T)&&T.layerFilterChanged(W);this._setCameraDirty()};a._createClass(aa,[{key:"isMeshPyramid",get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store?.lodType}},{key:"isGraphics3D",
get:function(){return"points"===this.layer.profile}},{key:"useMaximumNumberOfFeatures",get:function(){return!this.isMeshPyramid&&(m.isNone(this.layer.priority)||"High"===this.layer.priority)}},{key:"indexStreamController",get:function(){const W=this.layerView.view.resourceController.createStreamDataRequester(M.ClientType.I3S_INDEX);return new D.I3SStreamDataController(W,this.layer.apiKey)}},{key:"dataStreamController",get:function(){const W=this.layerView.view.resourceController.createStreamDataRequester(M.ClientType.I3S_DATA);
return new D.I3SStreamDataController(W,this.layer.apiKey)}},{key:"crsVertex",get:function(){return F.getVertexCrs(this.layer)}},{key:"crsIndex",get:function(){return F.getIndexCrs(this.layer)}},{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"running",get:function(){return this.updating}},{key:"rootNodeVisible",get:function(){if(m.isSome(this._index)){const W=this._index.rootNode;if(m.isSome(W))return this._updateViewData(),this._index.isNodeVisible(W.index)}return!0}},{key:"index",
get:function(){return this._index}},{key:"_isIntegratedMesh",get:function(){return"integrated-mesh"===this.layer.type}},{key:"_areScaleBoundsActive",get:function(){const {minScale:W,maxScale:T}=N.extractSafeScaleBounds(this.layer);return this.scaleVisibilityEnabled&&(0<W||0<T)}},{key:"unloadedMemoryEstimate",get:function(){return m.isNone(this._index)||this.layerView.suspended?0:this._index.unloadedMemoryEstimate*this._lodDropFactor}},{key:"indexDepth",get:function(){return m.isSome(this._index)?
this._index.maxLevel:0}},{key:"disableMemCache",set:function(W){this.layerView.loadCachedGPUData&&this.layerView.addCachedGPUData||(this._disableMemCache=!0);this._disableMemCache=W}},{key:"_lod",get:function(){return this._featureLOD*this._baseLOD}},{key:"_baseLOD",get:function(){const W=this.layerView.lodFactor,T=this.layerView.view.resourceController.memoryController.memoryFactor;return this.fixedFeatureTarget?1:(0<W?W:1)*T}},{key:"_lodDropFactor",get:function(){if(this.fixedFeatureTarget)return 1;
const W=this.layerView.view.resourceController.memoryController;return(Math.min(W.memoryFactor,.5)-W.minQuality)/(.5-W.minQuality)}},{key:"test",get:function(){const W=this;return{index:this._index,set disableUpdates(T){(W._updatesDisabled=T)?W.cancelNodeLoading():W.requestUpdate()},set disableIDBCache(T){W.disableIDBCache=T},set ignoreServiceObb(T){m.isSome(W._index)&&(W._index.ignoreServiceObb=T)},shouldLoadNode:T=>W._shouldLoadNode(T)}}}]);return aa}(f.EsriPromiseMixin(b));c.__decorate([h.property({readOnly:!0})],
b.prototype,"isMeshPyramid",null);c.__decorate([h.property({readOnly:!0})],b.prototype,"isGraphics3D",null);c.__decorate([h.property({readOnly:!0})],b.prototype,"useMaximumNumberOfFeatures",null);c.__decorate([h.property({readOnly:!0})],b.prototype,"indexStreamController",null);c.__decorate([h.property({readOnly:!0})],b.prototype,"dataStreamController",null);c.__decorate([h.property({readOnly:!0})],b.prototype,"crsVertex",null);c.__decorate([h.property({readOnly:!0})],b.prototype,"crsIndex",null);
c.__decorate([h.property()],b.prototype,"screenSizeFactor",void 0);c.__decorate([h.property()],b.prototype,"featureTarget",void 0);c.__decorate([h.property()],b.prototype,"fixedFeatureTarget",void 0);c.__decorate([h.property()],b.prototype,"layerView",void 0);c.__decorate([h.property()],b.prototype,"layer",null);c.__decorate([h.property()],b.prototype,"updating",void 0);c.__decorate([h.property({readOnly:!0})],b.prototype,"running",null);c.__decorate([h.property()],b.prototype,"updatingProgress",
void 0);c.__decorate([h.property({readOnly:!0})],b.prototype,"leavesReached",void 0);c.__decorate([h.property({constructOnly:!0})],b.prototype,"scaleVisibilityEnabled",void 0);c.__decorate([h.property({readOnly:!0,dependsOn:[]})],b.prototype,"rootNodeVisible",null);b=c.__decorate([q.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],b);const L=new d({deallocator:null});let O;const S={factorIM:.2,factor3dObject:.05,distancePenalty:10},R=p.create();var Q;(function(V){V[V.pop=0]="pop";
V[V.fadeout=1]="fadeout"})(Q||(Q={}));return b})},"esri/views/3d/layers/i3s/I3SFrameTask":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../support/Scheduler".split(" "),function(a,c,b,t,n,r,m,d,f){let e=function(l){function v(){var k=l.call(this)||
this;k.referenceCount=0;k.callbacks=[];k.runIndex=0;return k}c._inheritsLoose(v,l);var q=v.prototype;q.runTask=function(k){this._sort();const p=this.callbacks,z={numIndexLoading:0,numNodesLoading:0};for(let C=0;C<p.length&&!k.done;++C)p[C].priority=p[C].runTask(k,z),this.runIndex=C};q._sort=function(){const k=this.callbacks;let p=k.length;for(let z=this.runIndex;0<z;z--){const C=k[z-1];let B=z;for(;B<k.length&&C.priority<=k[B].priority&&(B!==p||C.priority<k[B].priority);)k[B-1]=k[B],B++;k[B-1]=C;
p=B-1}this.runIndex=0};q.add=function(k){this._sort();k.priority=Infinity;this.callbacks.unshift(k);this.notifyChange("running")};q.remove=function(k){n.removeUnordered(this.callbacks,k);this.runIndex=this.callbacks.length;this._sort();this.notifyChange("running")};c._createClass(v,[{key:"running",get:function(){return this.callbacks.some(k=>k.running)}}]);return v}(t);b.__decorate([r.property({readOnly:!0})],e.prototype,"running",null);e=b.__decorate([d.subclass("esri.views.3d.layers.i3s.I3SFrameTask")],
e);let g=function(l,v){this.task=l;this.handle=v};const h=new Map;a.addCallback=function(l,v){let q=h.get(l);if(null==q){const k=new e,p=l.registerTask(f.TaskPriority.I3S_CONTROLLER,k);q=new g(k,p);h.set(l,q)}q.task.add(v);return{remove:()=>{null!=q&&(q.task.remove(v),0<q.task.callbacks.length||(h.delete(l),q.handle.remove(),q.task.destroy()),q=null)}}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../chunks/vec3 ../../../../chunks/vec4f64 ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,c,b,t,n,r,m,d,f,e){function g(x){b.isSome(x.node)&&(f.invalidateMbs(x.node.renderMbs),f.invalidateObb(x.node.serviceObbInRenderSR));b.isSome(x.ref)&&(f.invalidateMbs(x.ref.renderMbs),f.invalidateObb(x.ref.serviceObbInRenderSR))}function h(x,u){return 0===u?0:x/u|0}function l(x,u){return 0===u?x:x%u}function v(x){if(x)for(let u=0;u<x.length;u++)for(const y of B)if(y[0]===x[u].metricType)return{lodMetric:y[1],maxError:x[u].maxError};return{lodMetric:d.LodMetric.None,maxError:0}}function q(x){return Math.sqrt(4/
Math.PI*x)}let k=function(x,u,y,w,D){this.childOffset=x;this.childCount=u;this.visibilityCache=y;this.ref=w;this.node=D;this.useAsHole=0;this.filterImpact=d.NodeFilterImpact.NotChecked},p=function(){function x(y,w,D,F,E,K,J,M,N,P,I,G,H,L){this._streamDataController=D;this._viewportQueries=F;this._logger=E;this.holeFilling=K;this._isLoaded=J;this._isReloading=M;this._isSelected=N;this._enable=P;this._needsUpdate=I;this._canRequest=G;this._computeVisibilityObb=H;this._computeNodeFiltering=L;this._dirty=
!0;this._nodePages=[];this._rootIndex=this._nodesPerPage=this._nodeCount=0;this._lodMetric=d.LodMetric.None;this._lodConversion=O=>O;this._urlPrefix="";this._loading=new Set;this._failedNodes=new Set;this._failedPages=new Set;this._indexMissing=1;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._maxProcessingPrio=Number.POSITIVE_INFINITY;this._nodeTraversalState=new Map;this._version=f.addWraparound(0,2);this._visibilityCacheVersion=f.addWraparound(0,2);this._maxLevel=1;this._featureEstimate={estimate:0,
leavesReached:!1};this._unloadedMemoryEstimate=0;this._missing=new t({deallocator:null});this._prefetch=new t({deallocator:null});this._updates=new C(this._missing);this._imModificationUncategorized=new t({deallocator:null});this.ignoreServiceObb=!1;this.progressiveLoadPenalty=0;this._pageQueue=[];this._layerHasFilter=this.layerHasModifications=this.needNodeElevationRange=!1;this._logLayer=y;y.serviceUpdateTimeStamp&&y.serviceUpdateTimeStamp.lastUpdate&&(this._lastUpdate=`${y.serviceUpdateTimeStamp.lastUpdate}`);
this._maxLodLevel=this._viewportQueries?this._viewportQueries.maxLodLevel:1;this._init(w)}var u=x.prototype;u._init=function(y){if("page"===y.type){this._urlPrefix=y.urlPrefix;this._nodesPerPage=y.pageSize;this._rootIndex=y.rootIndex;switch(y.lodMetric){case "maxScreenThreshold":this._lodMetric=d.LodMetric.MaxScreenThreshold;break;case "maxScreenThresholdSQ":this._lodMetric=d.LodMetric.MaxScreenThreshold,this._lodConversion=q}this._addPage(h(this._rootIndex,this._nodesPerPage),y.rootPage);this._updateParentsAndLevel()}else"node"===
y.type&&(this._urlPrefix=y.urlPrefix,this._nodePages.push({nodes:[],children:[],parents:[]}),this._makeRefNode(new d.NodeBase(y.rootNode.id,null),-1),(y=this._validateNode(y.rootNode.id,y.rootNode))&&this._addNode(y,0))};u._loadPage=function(y){this._loading.add(y);this._streamDataController.request(this._urlPrefix+y,"json").then(w=>{this._pageQueue.push({pageIndex:y,page:w})}).catch(w=>{this._loading.delete(y);n.isAbortError(w)||(this._failedPages.add(y),this._logger.error("#loadPage()",this._logLayer,
`Error when loading page ${y}`,w))})};u._addQueuedPages=function(y){for(;0<this._pageQueue.length&&!y.done;){const {pageIndex:w,page:D}=this._pageQueue.shift();this._addPage(w,D);this._loading.delete(w);y.madeProgress()}this._updateParentsAndLevel()};u._addPage=function(y,w){for(let E=this._nodePages.length;E<y;E++)this._nodePages[E]=null;const D=[],F=[];w=w.nodes.map((E,K)=>{const J=D.length,M=E.children?E.children.length:0;F.push(-1);for(var N=0;N<M;N++)D.push(E.children[N]);const P=`${E.index}`;
N=e.clone(E.obb);const I=m.fromArray([N.center[0],N.center[1],N.center[2],r.length(N.halfSize)]),G=E.mesh&&E.mesh.attribute,H=E.mesh&&E.mesh.geometry,L=E.mesh&&E.mesh.material;E=new d.Node(P,y*this._nodesPerPage+K,I,M,0,{hasSharedResource:!1,hasFeatureData:!!H,attributes:G&&null!=G.resource?`${G.resource}`:void 0,geometry:H&&null!=H.resource?`${H.resource}`:void 0,texture:L&&null!=L.resource?`${L.resource}`:void 0,geometryDefinition:H?H.definition:-1,materialDefinition:L?L.definition:-1},this._lastUpdate,
this._lodMetric,this._lodConversion(E.lodThreshold),H?H.featureCount:null);E.serviceObb=N;E.visibilityObb=this._computeVisibilityObb(E);E.vertexCount=H?H.vertexCount:0;return new k(J,M,f.addWraparound(this._visibilityCacheVersion,-2),null,E)});this._nodePages[y]={nodes:w,children:D,parents:F};this._nodeCount+=w.length};u._updateParentsAndLevel=function(){const y=[],w=(D,F,E)=>{const K=this._getPage(D);if(b.isSome(K)){const J=l(D,this._nodesPerPage);K.parents[J]=F;F=K.nodes[J].node;b.isSome(F)&&(F.level=
E,y.push(D))}};for(w(this._rootIndex,-1,0);y.length;){const D=y.pop(),F=this.getNode(D);if(b.isSome(F))for(let E=0;E<F.childCount;E++){const K=this.getChildIndex(F.index,E);w(K,D,F.level+1);this._maxLevel=Math.max(this._maxLevel,F.level+1)}}};u._getPage=function(y){return this._nodePages[h(y,this._nodesPerPage)]};u._getNodeInternal=function(y){const w=this._getPage(y);return b.isNone(w)?null:w.nodes[l(y,this._nodesPerPage)]};u._addNode=function(y,w){null!=y.children&&this.populateChildren(w,y.children);
var D=this.getParent(w);D=b.isSome(D)?D.level+1:0;this._maxLevel=Math.max(this._maxLevel,y.children?D+1:D);const {lodMetric:F,maxError:E}=v(y.lodSelection),K=b.unwrap(this._getNodeInternal(w));K.node=new d.Node(y.id,w,m.fromArray(y.mbs),K.childCount,D,y.resources,y.version,F,E,y.numFeatures);y.obb&&(K.node.serviceObb=e.clone(y.obb));K.node.visibilityObb=this._computeVisibilityObb(K.node);b.isSome(K.ref)&&(null==K.ref.mbs&&(K.ref.mbs=y.mbs),K.node.renderMbs=K.ref.renderMbs,K.node.serviceObbInRenderSR=
K.ref.serviceObbInRenderSR,K.ref.visibilityObb=K.node.visibilityObb);return K.node};u._makeRefNode=function(y,w){const D=this._nodePages[0];if(null==D)return-1;const F=D.nodes.length;D.nodes.push(new k(0,0,f.addWraparound(this._visibilityCacheVersion,-2),y,null));this._nodeCount++;D.parents.push(w);f.invalidateMbs(y.renderMbs);f.invalidateObb(y.serviceObbInRenderSR);return F};u.populateChildren=function(y,w){var D=b.unwrap(this._getNodeInternal(y));const F=b.unwrap(this._getPage(y));D.childOffset=
F.children.length;D.childCount=w.length;for(D=0;D<w.length;D++){const E=this._makeRefNode(w[D],y);F.children.push(E)}};u.getNode=function(y){y=this._getNodeInternal(y);return b.isSome(y)?y.node:null};u.getIndexById=function(y){let w;this._forAllNodes((D,F)=>{b.isSome(D.node)&&D.node.id===y?w=F:b.isSome(D.ref)&&D.ref.id===y&&(w=F)});return w};u.getNodeById=function(y){y=this.getIndexById(y);return null!=y&&0<=y?this.getNode(y):null};u.getChildIndex=function(y,w){const D=this._getPage(y);if(b.isNone(D))return-1;
y=D.nodes[l(y,this._nodesPerPage)];return D.children[y.childOffset+w]};u.getParentIndex=function(y){const w=this._getPage(y);return b.isSome(w)?w.parents[l(y,this._nodesPerPage)]:-1};u.getParent=function(y){y=this.getParentIndex(y);return 0<=y?this.getNode(y):null};u.isLeaf=function(y){y=this._getNodeInternal(y);return b.isSome(y)&&0===y.childCount};u.removeAllGeometryObbs=function(){this._forAllNodes(y=>{b.isSome(y.node)&&(y.node.geometryObb=null)})};u.invalidateVisibilityCache=function(){this._visibilityCacheVersion=
f.addWraparound(this._visibilityCacheVersion,2)};u.invalidateNodeVisibilityCache=function(y){y=this._getNodeInternal(y);b.isSome(y)&&this.invalidateNodeVisibilityCacheInternal(y)};u.invalidateNodeVisibilityCacheInternal=function(y){y.visibilityCache=f.addWraparound(this._visibilityCacheVersion,-2)};u.invalidateBoundingVolumeCache=function(y){y=this._getNodeInternal(y);b.isSome(y)&&(g(y),this.invalidateNodeVisibilityCacheInternal(y))};u.updateElevationChanged=function(y){const w=this._getNodeInternal(y);
b.isNone(w)||(this.needNodeElevationRange?(y=b.isSome(w.node)?w.node:w.ref,b.isNone(y)||(y=y.elevationRange,b.isNone(y)||(y.valid=!1))):this.invalidateBoundingVolumeCache(y))};u.invalidateGeometryVisibility=function(y){y=this._getNodeInternal(y);b.isSome(y)&&b.isSome(y.node)&&(y.node.geometryObb=null,f.invalidateMbs(y.node.renderMbs),f.invalidateObb(y.node.serviceObbInRenderSR))};u.invalidateVisibilityObbs=function(){b.isNone(this.rootNode)||this.traverse(this.rootNode,y=>{y.visibilityObb=this._computeVisibilityObb(y);
y.geometryObb=null;return!0})};u._updateElevationRange=function(y){var w=this._getNodeInternal(y);if(b.isNone(w))return null;const D=b.isSome(w.node)?w.node:w.ref;if(b.isNone(D))return null;const F=D.elevationRange;if(b.isSome(F)&&F.valid)return F;const E=new d.ElevationRange;let K=!1;for(let J=0;J<w.childCount;J++){const M=this._updateElevationRange(this.getChildIndex(y,J));b.isNone(M)?K=!0:(E.min=Math.min(E.min,M.min),E.max=Math.max(E.max,M.max))}if(0===w.childCount||K&&b.isSome(w.node)&&w.node.resources.geometry)w=
this._viewportQueries.getElevationRange(D),b.isSome(w)&&(E.min=Math.min(E.min,w.min),E.max=Math.max(E.max,w.max));if(b.isSome(F)&&F.min===E.min&&F.max===E.max)return F.valid=!0,F;E.valid=!0;D.elevationRange=E;this.invalidateBoundingVolumeCache(y);return E};u.isNodeVisible=function(y){const w=this._getNodeInternal(y);if(b.isNone(w)||b.isSome(w.ref)&&!w.ref.mbs)return!0;this.needNodeElevationRange&&this._updateElevationRange(y);if((w.visibilityCache&-2)!==this._visibilityCacheVersion){y=w.node;const F=
b.isSome(y)&&(b.isNone(w.ref)||b.isSome(y.visibilityObb))?y:b.isSome(w.ref)?w.ref:null;if(this._layerHasFilter&&this._computeNodeFiltering&&(b.isSome(y)||b.isSome(w.ref))&&w.filterImpact===d.NodeFilterImpact.NotChecked){var D=b.isSome(y)?y.mbs:b.isSome(w.ref)?w.ref.mbs:null;w.filterImpact=null!=D?this._computeNodeFiltering(D):d.NodeFilterImpact.Unmodified}D=b.isSome(y)&&w.filterImpact===d.NodeFilterImpact.Culled;y=!(b.isSome(y)&&y.imModificationImpact===d.NodeIMModificationImpact.Culled)&&(!F||this._viewportQueries.isNodeVisible(F))&&
!D;w.visibilityCache=this._visibilityCacheVersion+(y?1:0);return y}return 1===(w.visibilityCache&1)};u.isGeometryVisible=function(y){if(!this.isNodeVisible(y))return!1;y=this._getNodeInternal(y);return b.isSome(y)&&b.isSome(y.node)&&b.isSome(y.node.geometryObb)&&(!this.layerHasModifications||y.node.imModificationImpact!==d.NodeIMModificationImpact.NotChecked)?this._viewportQueries.isGeometryVisible(y.node):!0};u._traverseCoverage=function(y,w,D,F,E){y=this._getPage(y);if(!b.isNone(y)&&0!==w.childCount){var K=
w.childOffset+w.childCount,J=[];for(w=w.childOffset;w<K;++w){const M=y.children[w],N=this._getNodeInternal(M);b.isSome(N)&&b.isSome(N.node)&&this.isGeometryVisible(M)&&J.push(N)}F/=J.length;for(const M of J)y=b.unwrap(M.node).index,this._isLoaded(y)||this._isReloading(y)?(E.delta=Math.max(E.delta,D),E.coverage+=F):this._traverseCoverage(y,M,D+1,F,E)}};u.useNodeAsHole=function(y){if("off"===this.holeFilling)return!1;const w=this._getNodeInternal(y);if(b.isNone(w))return!1;if("always"===this.holeFilling)return!0;
if((w.useAsHole&-2)===this._version)return 1===(w.useAsHole&1);const D={delta:0,coverage:0};this._traverseCoverage(y,w,0,1,D);y=.5>=D.delta*D.coverage;w.useAsHole=this._version+(y?1:0);return y};u.destroy=function(){this._updates.add.prune();this._updates.update.prune()};u.requestUpdate=function(){this._dirty=!0;this._indexMissing=1;this._version=f.addWraparound(this._version,2)};u.imModificationsChanged=function(y){this.layerHasModifications=y;this._forAllNodes(({node:w})=>{b.isSome(w)&&(w.imModificationImpact=
d.NodeIMModificationImpact.NotChecked,w.visibilityObb=this._computeVisibilityObb(w),w.hasModifications&&this.invalidateGeometryVisibility(w.index))});this.invalidateVisibilityCache()};u.layerFilterChanged=function(y){this._layerHasFilter=y;this._forAllNodes(w=>{b.isSome(w)&&(w.filterImpact=d.NodeFilterImpact.NotChecked,w=w.node,b.isSome(w)&&this.invalidateNodeVisibilityCache(w.index))});this.invalidateVisibilityCache()};u.update=function(y,w,D){if(this._dirty){0<this._pageQueue.length&&this._addQueuedPages(w);
this._maxProcessingPrio=this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(y);z.clear();var F=!0,E=new A,K=new A,J=this._imModificationUncategorized;J.clear();var M=new Set;this.traverseVisible((P,I,G)=>{if(b.isNone(I))I=this._entryPriority(P),Infinity===I&&(I=this._entryPriority(G)),P=h(P,this._nodesPerPage),z.set(P,Math.max(I,z.get(P)||0)),this._loading.has(P)||this._failedPages.has(P)||this._missing.push(P),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,
I);else{var H=I.node;this._updateNodeFeatureEstimate(H,K);if(b.isNone(H))I=this._entryPriority(P),this._loading.has(P)||this._failedNodes.has(P)||(this._missing.push(P),z.set(P,I)),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,I);else{G=b.unwrap(this._getPage(P));if(0===this._missing.length&&0===this._nodesPerPage)for(let L=0;L<I.childCount;L++){const O=G.children[I.childOffset+L],S=this._getNodeInternal(O);!b.isSome(S)||S.node||this._loading.has(O)||this._failedNodes.has(O)||(z.set(O,
this._entryPriority(O)),this._prefetch.push(O))}H.failed||!H.resources.hasFeatureData?F&&0<I.childCount&&this._isSelected(H)&&(F=!1):(M.add(H.id),this._isLoaded(P)?(E.known+=H.memory,++E.knownNodes,this._isSelected(H)?0<I.childCount&&(F=!1):(E.unremoved+=H.memory,F=!1),this._needsUpdate(H)&&(I=this._entryPriority(P),z.set(P,I),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,I),this._updates.update.push(P))):(H.memory&&(E.known+=H.memory,++E.knownNodes),this._isSelected(H)?(0<I.childCount&&
(F=!1),H.memory?(E.missing+=H.memory,E.known+=H.memory,++E.knownNodes):++E.missingNodes,y.includes(H.index)?(this._maxProcessingPrio=Math.max(this._maxProcessingPrio,this._entryPriority(P)),this._updates.cancel=this._updates.cancel.filter(L=>L!==H.index)):!w.done&&this._enable(H)?w.madeProgress():(I=this._entryPriority(P),z.set(P,I),this._maxProcessingPrio=Math.max(this._maxProcessingPrio,I),this._updates.add.push(P),this.layerHasModifications&&D&&b.isSome(H)&&H.imModificationImpact===d.NodeIMModificationImpact.NotChecked&&
J.push(P))):this._isReloading(P)&&this._updates.remove.push(P)))}}});var N=this._updates.add;0<N.length&&this.layerHasModifications&&(0<J.length&&D?.(J),N.filterInPlace(P=>{var I=this._getNodeInternal(P);(I=b.isNone(I)||b.isNone(I.node)||I.node.imModificationImpact!==d.NodeIMModificationImpact.Culled)||this.invalidateNodeVisibilityCache(P);return I}));this._unloadedMemoryEstimate=E.missing-E.unremoved;3<E.knownNodes&&0<E.missingNodes&&(this._unloadedMemoryEstimate+=E.known/E.knownNodes*E.missingNodes);
this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=this._computeFeatureEstimate(K);this._featureEstimate.leavesReached=F;this._missing.sort((P,I)=>P-I);this._missing.filterInPlace((P,I)=>1>I||this._missing.data[I-1]!==P);this._missing.sort((P,I)=>z.get(P)-z.get(I));0<this._missing.length&&(this._maxUnloadedPrio=z.get(this._missing.back()),this._prefetch.clear());this._updates.add.filterInPlace(P=>z.get(P)>=this._maxUnloadedPrio).sort((P,I)=>z.get(P)-
z.get(I));this._updates.update.sort((P,I)=>z.get(P)-z.get(I));this._indexMissing=this._loading.size+this._missing.length;this._dirty=0<this._indexMissing;z.clear()}};u.checkFeatureTarget=function(y,w){const D=this._viewportQueries.updateScreenSpaceErrorBias(w);let F=w,E=w,K=D,J=10;for(;J--;){const M=new A;this._updateFeatureEstimate(F,M);if(this._computeFeatureEstimate(M)<=y){if(F>=w||0<M.missingNodes||0===J)break;K=F;F=.5*(F+E)}else E=F,F=.5*(F+K)}this._version=f.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(D);
return Math.min(w,F)};u._updateFeatureEstimate=function(y,w){this._version=f.addWraparound(this._version,2);this._viewportQueries.updateScreenSpaceErrorBias(y);this.traverseVisible((D,F)=>this._updateNodeFeatureEstimate(b.isSome(F)?F.node:void 0,w))};u._updateNodeFeatureEstimate=function(y,w){b.isNone(y)||y.failed||b.isNone(y.numFeatures)||(this._isLoaded(y.index)?(w.known+=y.numFeatures,++w.knownNodes,this._isSelected(y)||(w.unremoved+=y.numFeatures)):this._isSelected(y)&&(b.isSome(y.numFeatures)?
(w.missing+=y.numFeatures,w.known+=y.numFeatures,++w.knownNodes):++w.missingNodes))};u._computeFeatureEstimate=function(y){let w=y.known-y.unremoved;3<y.knownNodes&&0<y.missingNodes&&(w+=y.known/y.knownNodes*y.missingNodes);return Math.max(0,w)};u.load=function(){return this._load(this._missing)};u.prefetch=function(){this._prefetch.sort((y,w)=>z.get(y)-z.get(w));return this._load(this._prefetch)};u._load=function(y){if(0===y.length||!this._canRequest())return!1;for(;0<y.length&&this._canRequest();)0===
this._nodesPerPage?this._loadNode(y.pop()):this._loadPage(y.pop());return!0};u.nodeTraversalState=function(y){if(b.isNone(y))return null;let w=this._nodeTraversalState.get(y.index);if(w&&(w.version&-2)===this._version)return w;const D=this._viewportQueries.getLodLevel(y),F=this._viewportQueries.hasLOD(y);var E=!0;F?(E=this.getParentIndex(y.index),0<=E?(E=this._nodeTraversalState.get(E),E=!!E&&D>E.lodLevel):E=0<D):E=0===y.childCount;if(w)return w.lodLevel=D,w.isChosen=E,w.version=this._version+1,w;
w=new d.NodeTraversalState(F,E,D,this._version+1);this._nodeTraversalState.set(y.index,w);return w};u._loadNode=function(y){this._loading.add(y);const w=b.unwrap(this._getNodeInternal(y)).ref;if(b.isNone(w))this._failedNodes.add(y);else{var D=w.id,F=this._urlPrefix+D,E=()=>{this._loading.delete(y);0===this._missing.length&&0===this._loading.size&&this.requestUpdate()};this._streamDataController.request(F,"json").then(K=>{E();K=this._validateNode(D,K);null!=K&&(K.obb&&this.invalidateNodeVisibilityCache(y),
K=this._addNode(K,y),this.nodeTraversalState(K))},K=>{E();n.isAbortError(K)||(this._logger.error("#loadNode()",this._logLayer,"Error loading node: "+F),this._failedNodes.add(y))})}};u._validateNode=function(y,w){if(null==w||"object"!==typeof w||w.id!==y)return this._logger.error("#validateNode()",this._logLayer,`Invalid node. Wrong type or wrong id "${y}"`),null;if(!Array.isArray(w.mbs))return this._logger.error("#validateNode()",this._logLayer,`Invalid bounding volume on node ${y}.`),null;w.sharedResource&&
"./shared"!==w.sharedResource.href&&"./shared/"!==w.sharedResource.href&&this._logger.warn("#validateNode()",this._logLayer,`Invalid shared resource href on node "${y}"`);null==w.geometryData||Array.isArray(w.geometryData)&&1===w.geometryData.length&&"./geometries/0"===w.geometryData[0].href||this._logger.warn("#validateNode()",this._logLayer,`Invalid geometry data on node "${y}"`);null==w.attributeData||Array.isArray(w.attributeData)&&!w.attributeData.some((K,J)=>K.href!==`./attributes/f_${J}/0`)||
this._logger.warn("#validateNode()",this._logLayer,`Invalid attribute data on node "${y}"`);w.featureData&&1<w.featureData.length&&this._logger.warn("#validateNode()",this._logLayer,`Node ${y} has ${w.featureData.length} bundles. Only the first bundle will be loaded.`);const D=w.hasOwnProperty("obb")&&!this.ignoreServiceObb?w.obb:null,F=w.featureData&&1===w.featureData.length&&w.featureData[0].featureRange?w.featureData[0].featureRange[1]-w.featureData[0].featureRange[0]+1:void 0;var E=K=>{if(null==
K)return null;var J=M=>this._logger.error("#validateNode()",this._logLayer,`Invalid node reference on node ${y}: ${M}`);if("number"===typeof K.id)J(`id ${K.id} is a number instead of a string.`);else if("string"!==typeof K.id||!Array.isArray(K.mbs))return J("Missing or invalid id."),null;if(!Array.isArray(K.mbs))return J(`Invalid bounding volume on reference ${K.id}.`),null;K.href&&K.href!=="../"+K.id&&this._logger.error("#validateNode()",this._logLayer,`Invalid node href on node "${y}"`);J=K.hasOwnProperty("obb")&&
!this.ignoreServiceObb?K.obb:null;K=new d.NodeBase(`${K.id}`,K.mbs);K.serviceObb=J;K.visibilityObb=this._computeVisibilityObb(K);return K};E=Array.isArray(w.children)?w.children.map(E).filter(K=>null!=K):null;return{id:y,mbs:w.mbs,obb:D,children:E,resources:{hasFeatureData:w.featureData&&0<w.featureData.length,hasSharedResource:null!=w.sharedResource,attributes:w.attributeData?y:void 0,texture:w.textureData&&0<w.textureData.length?y:void 0,geometry:null!=w.geometryData?y:void 0},version:"string"===
typeof w.version?w.version:null,lodSelection:Array.isArray(w.lodSelection)?w.lodSelection:null,numFeatures:F}};u.resetFailedNodes=function(){this._failedNodes.clear();this._failedPages.clear();this._forAllNodes(y=>{b.isSome(y.node)&&(y.node.failed=!1)})};u._entryPriority=function(y){var w=this._getNodeInternal(y),D=this.getParentIndex(y);if(b.isNone(w)||0>D&&null==w.node)return 0>D?Infinity:this._entryPriority(D);let F=0;w.node&&0<=D&&(D=this._nodeTraversalState.get(D),null!=D&&(F=D.lodLevel));for(D=
this.progressiveLoadPenalty;0<=y;y=this.getParentIndex(y))if(this._isLoaded(y)){D=0;break}w=b.isSome(w.ref)?this._viewportQueries.distToPOI(w.ref):b.isSome(w.node)?this._viewportQueries.distToPOI(w.node):0;return-w-F*(w+this.progressiveLoadPenalty)+D};u.traverseVisible=function(y){const w=this._getNodeInternal(this._rootIndex);b.isNone(w)?y(this._rootIndex,null,null):this._traverseVisible(this._rootIndex,-1,w,y)};u._traverseVisible=function(y,w,D,F){if(D.node&&0===D.childCount)this.isGeometryVisible(y)&&
F(y,D,w);else if(this.isNodeVisible(y)&&(F(y,D,w),null!=D.node&&(w=this.nodeTraversalState(D.node),!w?.nodeHasLOD||w.lodLevel!==this._maxLodLevel))){w=b.unwrap(this._getPage(y));for(let E=0;E<D.childCount;E++){const K=w.children[D.childOffset+E],J=this._getNodeInternal(K);b.isSome(J)?this._traverseVisible(K,y,J,F):F(K,null,y)}}};u.traverse=function(y,w){w(y)&&this.traverseChildren(y,w)};u.traverseChildren=function(y,w){y=y.index;const D=this._getNodeInternal(y);b.isSome(D)&&this._traverseChildren(y,
D,w)};u._traverseChildren=function(y,w,D){y=this._getPage(y);if(!b.isNone(y)){var F=w.childOffset+w.childCount;for(w=w.childOffset;w<F;++w){const E=y.children[w],K=this._getNodeInternal(E);b.isSome(K)&&b.isSome(K.node)&&D(K.node)&&this._traverseChildren(E,K,D)}}};u.updateChildrenLoaded=function(y,w){for(y=this.getNode(y);b.isSome(y);)y.childrenLoaded+=w,y=this.getParent(y.index)};u.checkChildrenLoadedInvariant=function(){if(b.isNone(this.rootNode))return!0;const y=[],w=D=>{let F=this._isLoaded(D.index)||
this._isReloading(D.index)?1:0;this.traverseChildren(D,E=>{F+=w(E);return!1});D.childrenLoaded!==F&&y.push(D.index);return F};w(this.rootNode);y.length&&this._logger.error("childrenLoaded invariant broken at following nodes: "+y.join(","));return 0<y.length};u.updateStats=function(y){0<this._updates.add.length&&(y.nodes+=" + "+this._updates.add.length);if(this._indexMissing||0<this._prefetch.length)y.index+=" + "+this._indexMissing||this._prefetch.length;y.prio=this._maxProcessingPrio;if(this._featureEstimate.estimate){const w=
this._featureEstimate.estimate-y.features;0<w?y.features+=" + "+w:0>w&&(y.features+=" - "+-w)}};u.updateElevationInfo=function(y,w){this.needNodeElevationRange=w&&!!y&&("relative-to-ground"===y.mode||"on-the-ground"===y.mode);this._viewportQueries.updateElevationInfo(y);this.invalidateAllElevationRanges()};u.invalidateAllElevationRanges=function(){this._forAllNodes(y=>{g(y);b.isSome(y.node)&&(y.node.elevationRange=null);b.isSome(y.ref)&&(y.ref.elevationRange=null)})};u._forAllNodes=function(y){for(let w=
0;w<this._nodePages.length;w++){const D=this._nodePages[w];if(D){const F=w*this._nodesPerPage;for(let E=0;E<D.nodes.length;E++)y(D.nodes[E],F+E)}}};c._createClass(x,[{key:"rootNode",get:function(){return this.getNode(this._rootIndex)}},{key:"size",get:function(){return this._nodeCount}},{key:"maxLevel",get:function(){return this._maxLevel}},{key:"dirty",get:function(){return this._dirty}},{key:"isLoading",get:function(){return 0<this._indexMissing}},{key:"isPrefetching",get:function(){return 0<this._prefetch.length}},
{key:"indexLoading",get:function(){return this._loading.size}},{key:"indexMissing",get:function(){return this._indexMissing}},{key:"unloadedMemoryEstimate",get:function(){return this._unloadedMemoryEstimate}},{key:"updates",get:function(){return this._updates}},{key:"featureEstimate",get:function(){return this._featureEstimate}},{key:"maxPriority",get:function(){return Math.max(this._maxProcessingPrio,this._maxUnloadedPrio)}},{key:"test",get:function(){return{addNode:(y,w)=>this._addNode(y,w)}}}]);
return x}();const z=new Map;let C=function(){function x(u){this.missing=u;this.update=new t({deallocator:null});this.add=new t({deallocator:null});this.remove=new t({deallocator:null});this.cancel=[]}x.prototype.reset=function(u){this.add.clear();this.update.clear();this.cancel=u};return x}();const B=[["maxScreenThreshold",d.LodMetric.MaxScreenThreshold],["screenSpaceRelative",d.LodMetric.ScreenSpaceRelative],["removedFeatureDiameter",d.LodMetric.RemovedFeatureDiameter],["distanceRangeFromDefaultCamera",
d.LodMetric.DistanceRangeFromDefaultCamera]];let A=function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0};a.I3SIndex=p;a.selectErrorMetric=v;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNode":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/sphere"],function(a,c,b){let t=function(r,m){this.id=r;this.mbs=m;this.renderMbs=b.fromValues(0,0,0,-1);this.elevationRange=null};a.NodeFilterImpact=
void 0;(function(r){r[r.Unmodified=0]="Unmodified";r[r.Culled=1]="Culled";r[r.NotChecked=2]="NotChecked"})(a.NodeFilterImpact||(a.NodeFilterImpact={}));a.NodeIMModificationImpact=void 0;(function(r){r[r.Unmodified=0]="Unmodified";r[r.PotentiallyModified=1]="PotentiallyModified";r[r.Culled=2]="Culled";r[r.Unknown=3]="Unknown";r[r.NotChecked=4]="NotChecked"})(a.NodeIMModificationImpact||(a.NodeIMModificationImpact={}));let n=function(r){function m(d,f,e,g,h,l,v,q,k,p){d=r.call(this,d,e)||this;d.index=
f;d.childCount=g;d.level=h;d.resources=l;d.version=v;d.lodMetric=q;d.maxError=k;d.numFeatures=p;d.failed=!1;d.cacheState=a.CacheState.Unknown;d.vertexCount=0;d.memory=0;d.childrenLoaded=0;d.hasModifications=!1;d.imModificationImpact=a.NodeIMModificationImpact.NotChecked;return d}c._inheritsLoose(m,r);return m}(t);a.CacheState=void 0;(function(r){r[r.Unknown=0]="Unknown";r[r.Uncached=1]="Uncached";r[r.Cached=2]="Cached"})(a.CacheState||(a.CacheState={}));a.LodMetric=void 0;(function(r){r[r.None=0]=
"None";r[r.MaxScreenThreshold=1]="MaxScreenThreshold";r[r.ScreenSpaceRelative=2]="ScreenSpaceRelative";r[r.RemovedFeatureDiameter=3]="RemovedFeatureDiameter";r[r.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"})(a.LodMetric||(a.LodMetric={}));a.NodeState=void 0;(function(r){r[r.Hole=0]="Hole";r[r.Leaf=1]="Leaf"})(a.NodeState||(a.NodeState={}));a.ElevationRange=function(){this.min=Infinity;this.max=-Infinity;this.valid=!1};a.Node=n;a.NodeBase=t;a.NodeTraversalState=function(r,m,
d,f){this.nodeHasLOD=r;this.isChosen=m;this.lodLevel=d;this.version=f};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/PooledArray","./I3SNode","../support/I3SLayerView"],function(a,c,b,t,n){let r=function(){function d(e){this._layerView=e;this._lodGlobalDirty=!1}var f=d.prototype;f.startNodeLoading=function(e,g,h,l){this._maxLodLevel=
l.maxLodLevel;this._index=h;this._isNodeInScaleBounds=e;this._removeNodes=g};f.shouldLoadNode=function(e){if(c.isNone(e))return!1;const g=this._index.nodeTraversalState(e);return this._isChosenMaxLOD(g)?!0:g.isChosen?this._childrenRequireLoading(e):!1};f.setLodGlobalDirty=function(){this._lodGlobalDirty=!0};f.lodGlobalHandling=function(e){if(!this.requiresLODGlobalHandling)return!1;this._lodGlobalDirty=!1;var g=Math.max(0,Math.floor(10*(this._layerView.view.resourceController.memoryController.usedMemory-
1)));m.clear();this._lodGlobalHandling(this._index.rootNode,g,!1,!!this._layerView.nodeCrossfadingEnabled);g=m.length;this._removeNodes(m,e);e=m.length<g;0!==m.length&&(this._lodGlobalDirty=!0);m.clear();return e};f._lodGlobalHandling=function(e,g,h,l){if(c.isNone(e))return!1;const v=e.index,q=this._index,k=this._layerView;var p=q.nodeTraversalState(e);p=this._isChosenMaxLOD(p);var z=!e.resources.hasFeatureData;if(p&&z)return 0<e.childrenLoaded&&this._removeChildrenRecursive(e),!0;z=k.isNodeLoaded(v);
if(l&&z&&p){var C=!h&&this.hasNoVisibleChildren(e);k.fadeNode(v,n.FadeDirection.FadeIn,!C)}C=z&&(!k.isNodeFullyFadedIn||k.isNodeFullyFadedIn(v));if(z&&(k.updateNodeState(v,p?t.NodeState.Leaf:t.NodeState.Hole),p))return C&&this._removeChildrenRecursive(e),C;var B=0<e.childCount;let A=B;if(B)for(B=0;B<e.childCount;B++){const x=q.getChildIndex(v,B),u=q.getNode(x);c.isSome(u)?q.isGeometryVisible(x)&&!this._lodGlobalHandling(u,g,h||C,l)&&this._isNodeInScaleBounds(u)&&(A=!1):q.isNodeVisible(x)&&(A=!1)}(g=
z&&!p&&(A||m.length<g))&&m.push(v);!l||g||!z||h||A||k.fadeNode(v,n.FadeDirection.FadeIn,!1);e=!e.resources.hasFeatureData;return A||C&&!g||e};f._removeChildrenRecursive=function(e){this._index.traverseChildren(e,g=>{(this._layerView.isNodeLoaded(g.index)||this._layerView.isNodeReloading(g.index))&&m.push(g.index);return 0<g.childrenLoaded})};f.hasNoVisibleChildren=function(e){let g=!0;this._index.traverseChildren(e,h=>g&&this._index.isNodeVisible(h.index)?this._layerView.isNodeLoaded(h.index)?g=!1:
0<h.childrenLoaded:!1);return g};f._childrenRequireLoading=function(e){let g=!1,h=!0;this._index.traverseChildren(e,l=>{if(!h||!this._index.isNodeVisible(l.index))return!1;const v=this._index.nodeTraversalState(l);this._isChosenMaxLOD(v)&&this._index.isGeometryVisible(l.index)&&(g=!0);return this._layerView.isNodeLoaded(l.index)?h=!1:0<l.childrenLoaded});return h&&g};f._isChosenMaxLOD=function(e){return e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel)};a._createClass(d,[{key:"requiresLODGlobalHandling",
get:function(){return null!=this._index&&!0===this._lodGlobalDirty}}]);return d}();const m=new b({deallocator:null});return r})},"esri/views/3d/layers/support/I3SLayerView":function(){define(["exports"],function(a){a.FadeDirection=void 0;var c=a.FadeDirection||(a.FadeDirection={});c[c.FadeIn=0]="FadeIn";c[c.FadeOut=1]="FadeOut";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/has ../../../../core/lang ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/urlUtils ./enums ./I3SBinaryReader ./I3SMaterialUtil".split(" "),
function(a,c,b,t,n,r,m,d,f,e){return function(){function g(l,v,q,k,p,z){this._streamDataController=v;this._logger=q;this._defaultGeometrySchema=k;this._requiredAttributes=p;this._options=z;this._logLayer=l;this._layerUrl=l.parsedUrl.path;this._geometryDefinitions=l.geometryDefinitions;if(l.materialDefinitions){const C=l.textureSetDefinitions;this._materialAndTextures=l.materialDefinitions.map(B=>e.getMaterialAndTextures(C,B))}}var h=g.prototype;h._load=function(l,v,q){return this._streamDataController.request(l,
v,q)};h._loadAttribute=function(l,v,q){return this._load(`${this._layerUrl}/nodes/${l.resources.attributes}/attributes/${v.key}/0`,"binary",q).then(k=>f.readBinaryAttribute(v,k))};h.loadAttributes=function(l,v,q){return r.eachAlways(v.map(k=>this._loadAttribute(l,k.attributeStorageInfo,q))).then(k=>{const p={};for(let z=0;z<v.length;++z){const C=k[z].value;if(C)p[v[z].name]=C;else{if(r.isAbortError(k[z].error))throw k[z].error;this._logger.error("#loadAttributes",this._logLayer,`Failed to load attributeData for '${v[z].name}' on node '${l.id}'`,
k[z].error)}}return p})};h.loadNodeData=function(){var l=a._asyncToGenerator(function*(v,q){var k=null!=this._requiredAttributes&&v.resources.attributes?c.result(this.loadAttributes(v,this._requiredAttributes,q)):null;var p=this._geometryDefinitions;var z={bufferDefinition:null,bufferIndex:0};var C=v.resources.geometryDefinition;if(!(null==p||null==C||0>C)&&(p=0<=C?p[C].geometryBuffers:null,null!=p))for(C=0;C<p.length;C++){var B=p[C];if(null!=B.compressedAttributes){if("draco"===B.compressedAttributes.encoding&&
!b("disable-feature:i3s-draco")){z.bufferIndex=C;z.bufferDefinition=B;break}}else z.bufferIndex=C,z.bufferDefinition=p[C]}const {bufferDefinition:A,bufferIndex:x}=z;C=(B=!!v.resources.geometry)?c.result(this._loadGeometry(v.resources.geometry,x,q)):null;p=v.resources.hasSharedResource?yield this._loadShared(v,q):null;z=v.resources.materialDefinition;z=this._materialAndTextures&&null!=z&&0<=z?this._materialAndTextures[z]:null!=p?e.getMaterialAndTexturesFromShared(p):null;var u=z?.material;z=z?.textures??
[];const y=`${v.id}`,w=!B&&this._options.loadFeatureData;B=w?yield this._loadFeatureData(y,q):null;if(w)a:{if(B)for(F of B.featureData)if(u=F.geometries,null!=u)for(var D of u){var F={featureIds:[F.id],featureDataPosition:F.position,geometries:[D]};break a}F=null}else F={featureIds:[],geometries:[{type:"ArrayBufferView",params:{material:u}}],featureDataPosition:[0,0,0]};if(n.isNone(F))if(B){D=[];for(E of B.featureData)null!=E.position&&D.push({featureIds:[E.id],featureDataPosition:E.position,geometries:[]});
var E=D}else E=null;else E=null;D=0<z.length?c.result(this.loadTextures(v,z,q)):null;q=v=null;C&&(v=c.assertResult(yield C),(q=this._defaultGeometrySchema)&&p&&p.materialDefinitions&&(C=Object.keys(p.materialDefinitions)[0],!p.materialDefinitions[C].params.vertexRegions&&q.vertexAttributes.region&&(q=t.clone(q),delete q.vertexAttributes.region)),q=f.createGeometryDescriptor(A,q));p=D?c.assertResult(yield D):null;k=(k=k?c.assertResult(yield k):{})?{attributeData:k,loadedAttributes:this._requiredAttributes}:
null;if(n.isSome(F))return{geometryData:F,attributeDataInfo:k,geometryBuffer:v,geometryDescriptor:q,requiredTextures:z,textureData:p};if(n.isSome(E))return{pointData:E,attributeDataInfo:k,geometryBuffer:v,geometryDescriptor:q,requiredTextures:z,textureData:p};throw Error();});return function(v,q){return l.apply(this,arguments)}}();g._addAbsoluteHrefTexture=function(l,v){l=l.textureDefinitions;if(null!=l)for(const q of Object.keys(l))for(const k of l[q].images)Array.isArray(k.href)?k.hrefConcat=k.href.map(p=>
m.makeAbsolute(p,v)):k.hrefConcat=m.makeAbsolute(k.href,v)};g._fixTextureEncodings=function(l){l=l.textureDefinitions;if(null!=l)for(const q in l){const k=l[q];if(Array.isArray(k.encoding))for(var v=0;v<k.encoding.length;v++){const p=k.encoding[v];"data:"===p.substring(0,5)&&(k.encoding[v]=p.substring(5))}else v=k.encoding,"data:"===v.substring(0,5)&&(k.encoding=v.substring(5))}};h._loadShared=function(l,v){const q=`${this._layerUrl}/nodes/${l.resources.geometry}/shared`;return this._load(q,"json",
v).then(k=>{g._fixTextureEncodings(k);g._addAbsoluteHrefTexture(k,q);return k})};h._loadTexture=function(l,v,q,k,p,z){let C=!1;return p===d.TextureEncoding.DDS_S3TC||p===d.TextureEncoding.KTX2||p===d.TextureEncoding.Basis?this._load(l,"binary",z).then(B=>({id:v,usage:q,data:B,encoding:p,downsampled:C})):this._load(l,"image",z).then(B=>{var A=B;if(k&&4096<=B.width*B.height){A=Math.ceil(B.width/2);const x=Math.ceil(B.height/2),u=document.createElement("canvas");u.width=A;u.height=x;u.getContext("2d").drawImage(B,
0,0,A,x);A=u;C=!0}return{id:v,usage:q,data:A,encoding:p,downsampled:C}})};h.loadTextures=function(l,v,q){const k=!!this._options.uncompressedTextureDownsamplingEnabled,p=this._options.textureUsageMask;return Promise.all(v.map(z=>{if(0===(z.usage&p))return null;const C=e.selectEncoding(z.encodings,this._options.textureEncodings);return null==C?(this._logger.error("#loadTextures",this._logLayer,`No known encoding for texture found on node ${l.id}`),Promise.reject()):this._loadTexture(`${this._layerUrl}/nodes/${l.resources.texture||
l.id}/textures/${C.name}`,z.id,z.usage,k,C.encoding,q)}))};h._loadFeatureData=function(l,v){return this._load(`${this._layerUrl}/nodes/${l}/features/0`,"json",v)};h._loadGeometry=function(l,v,q){return this._load(`${this._layerUrl}/nodes/${l}/geometries/${v}`,"binary",q)};return g}()})},"esri/views/3d/layers/i3s/enums":function(){define(["exports"],function(a){a.TextureEncoding=void 0;(function(c){c[c.KTX2=1]="KTX2";c[c.Basis=2]="Basis";c[c.DDS_S3TC=4]="DDS_S3TC";c[c.PNG=8]="PNG";c[c.JPG=16]="JPG";
c[c.KTX_ETC2=32]="KTX_ETC2"})(a.TextureEncoding||(a.TextureEncoding={}));a.TextureUsage=void 0;(function(c){c[c.None=0]="None";c[c.Color=1]="Color";c[c.MetallicRoughness=2]="MetallicRoughness";c[c.Normal=4]="Normal";c[c.Occlusion=8]="Occlusion";c[c.Emissive=16]="Emissive";c[c.AlphaMask=32]="AlphaMask";c[c.ColorTextures=19]="ColorTextures";c[c.GeometryTextures=36]="GeometryTextures";c[c.GeometryTexturesPBR=44]="GeometryTexturesPBR";c[c.AllTextures=37]="AllTextures";c[c.AllTexturesPBR=63]="AllTexturesPBR"})(a.TextureUsage||
(a.TextureUsage={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SMaterialUtil":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../core/maybe ./enums ../../webgl-engine/core/material/RenderTexture ../../webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../webgl-engine/core/shaderLibrary/util/AlphaCutoff ../../webgl-engine/core/shaderLibrary/util/EllipsoidMode ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Texture ../../../webgl/enums".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(A){return A.sort((x,u)=>x.encoding-u.encoding)}function v(A,x,u){if(t.isNone(A)||u===n.TextureUsage.None)return null;for(let y=0;y<A.length;y++){const w=A[y];if(t.isSome(w)&&0!==(w.usage&u))return A=x[y],t.isSome(A)?A.id:null}return null}function q(A){switch(A){case n.TextureEncoding.KTX2:return e.TextureEncodingMimeType.KTX2_ENCODING;case n.TextureEncoding.Basis:return e.TextureEncodingMimeType.BASIS_ENCODING;case n.TextureEncoding.DDS_S3TC:return e.TextureEncodingMimeType.DDS_ENCODING;
case n.TextureEncoding.PNG:return"image/png";case n.TextureEncoding.JPG:return"image/jpeg";case n.TextureEncoding.KTX_ETC2:return"image/ktx";default:return""}}const k={ktx2:n.TextureEncoding.KTX2,basis:n.TextureEncoding.Basis,dds:n.TextureEncoding.DDS_S3TC,png:n.TextureEncoding.PNG,jpg:n.TextureEncoding.JPG,"ktx-etc2":n.TextureEncoding.KTX_ETC2},p={[e.TextureEncodingMimeType.KTX2_ENCODING]:n.TextureEncoding.Basis,[e.TextureEncodingMimeType.BASIS_ENCODING]:n.TextureEncoding.Basis,[e.TextureEncodingMimeType.DDS_ENCODING]:n.TextureEncoding.DDS_S3TC,
"image/png":n.TextureEncoding.PNG,"image/jpg":n.TextureEncoding.JPG,"image/jpeg":n.TextureEncoding.JPG,"image/ktx":n.TextureEncoding.KTX_ETC2},z=()=>({alphaMode:"opaque",alphaCutoff:d.defaultMaskAlphaCutoff,doubleSided:!0,cullFace:e.CullFaceOptions.None,normalTextureId:-1,emissiveTextureId:-1,occlusionTextureId:-1,emissiveFactor:[0,0,0],metallicRoughness:{baseColorFactor:[.8,.8,.8,1],baseColorTextureId:-1,metallicRoughnessTextureId:-1,metallicFactor:0,roughnessFactor:.6},wrapTextures:!1,hasParametersFromSource:!0}),
C={s:h.TextureWrapMode.CLAMP_TO_EDGE,t:h.TextureWrapMode.CLAMP_TO_EDGE},B={s:h.TextureWrapMode.REPEAT,t:h.TextureWrapMode.REPEAT};a.configureMaterial=function(A,x,u,y,w,D){const F=D.rendererTextureUsage;var E=x.metallicRoughness.baseColorFactor,K=b.clamp(x.metallicRoughness.baseColorFactor[3],0,1);A.baseColor=[E[0],E[1],E[2],K];A.hasParametersFromSource=!!x.hasParametersFromSource;A.usePBR=D.usePBR;A.mrrFactors=[x.metallicRoughness.metallicFactor,x.metallicRoughness.roughnessFactor,x.hasParametersFromSource?
.2:.5];A.emissiveFactor=x.emissiveFactor;A.isIntegratedMesh=D.isIntegratedMesh;A.textureAlphaCutoff="mask"===x.alphaMode?x.alphaCutoff:d.defaultMaskAlphaCutoff;A.alphaDiscardMode="opaque"===x.alphaMode?e.AlphaDiscardMode.Opaque:"mask"===x.alphaMode?e.AlphaDiscardMode.Mask:e.AlphaDiscardMode.MaskBlend;E=[];K=v(y,u,(n.TextureUsage.Color|n.TextureUsage.AlphaMask)&F);t.isSome(K)&&(A.baseColorTexture=new r.RenderTexture(w,K),E.push(A.baseColorTexture.loadPromise));K=v(y,u,n.TextureUsage.MetallicRoughness&
F);t.isSome(K)&&(A.metallicRoughnessTexture=new r.RenderTexture(w,K),E.push(A.metallicRoughnessTexture.loadPromise));K=v(y,u,n.TextureUsage.Emissive&F);t.isSome(K)&&(A.emissionTexture=new r.RenderTexture(w,K),E.push(A.emissionTexture.loadPromise));K=v(y,u,n.TextureUsage.Occlusion&F);t.isSome(K)&&(A.occlusionTexture=new r.RenderTexture(w,K),E.push(A.occlusionTexture.loadPromise));u=v(y,u,n.TextureUsage.Normal&F);t.isSome(u)&&(A.normalTexture=new r.RenderTexture(w,u),E.push(A.normalTexture.loadPromise));
A.commonMaterialParameters.hasSlicePlane=D.slicePlaneEnabled;A.commonMaterialParameters.doubleSided=x.doubleSided;A.commonMaterialParameters.cullFace=x.cullFace;A.ellipsoidMode=f.getEllipsoidMode(D.viewSpatialReference);return Promise.all(E)};a.createTexture=function(A,x,u,y){if(t.isNone(A)||null==A.data)return null;const w=A.data;var D=!(w instanceof HTMLImageElement)||b.isPowerOfTwo(w.width)&&b.isPowerOfTwo(w.height),F=y.renderingContext.parameters.maxMaxAnisotropy;y=u&&!y.capabilities.shaderTextureLOD?
1:F;D=D&&!A.downsampled&&1<y;u=u||!x.wrapTextures?C:B;F=q(A.encoding);return new g.Texture(w,{mipmap:D,maxAnisotropy:y,encoding:F,wrap:u,components:A.usage&n.TextureUsage.Color?"opaque"===x.alphaMode?3:4:3,noUnpackFlip:!0})};a.defaultMaterial=z;a.getMaterialAndTextures=function(A,x){const u=new Map,y=(N,P)=>{if(t.isNone(N))return-1;var I=u.get(N.id);if(I)return I.usage|=P,I.id;I=u.size;u.set(N.id,{id:I,usage:P});return I};var w=x.pbrMetallicRoughness;const D=w&&w.baseColorFactor,F=x.emissiveFactor,
E=null==x.normalTexture&&null==x.emissiveTexture&&null==x.occlusionTexture&&(w?null==w.metallicRoughnessTexture&&1===w.roughnessFactor&&(1===w.metallicFactor||0===w.metallicFactor):!0),K=E?m.PBRSchematicMRRValues[0]:w?w.metallicFactor:1,J=E?m.PBRSchematicMRRValues[1]:w?w.roughnessFactor:1;w={baseColorFactor:D?[D[0],D[1],D[2],D[3]]:[1,1,1,1],baseColorTextureId:y(w&&w.baseColorTexture,"mask"===x.alphaMode?n.TextureUsage.Color|n.TextureUsage.AlphaMask:n.TextureUsage.Color),metallicRoughnessTextureId:y(w&&
w.metallicRoughnessTexture,n.TextureUsage.MetallicRoughness),metallicFactor:K,roughnessFactor:J};x={alphaMode:x.alphaMode,alphaCutoff:x.alphaCutoff,doubleSided:x.doubleSided,cullFace:"none"===x.cullFace?e.CullFaceOptions.None:"back"===x.cullFace?e.CullFaceOptions.Back:"front"===x.cullFace?e.CullFaceOptions.Front:e.CullFaceOptions.None,normalTextureId:y(x.normalTexture,n.TextureUsage.Normal),emissiveTextureId:y(x.emissiveTexture,n.TextureUsage.Emissive),occlusionTextureId:y(x.occlusionTexture,n.TextureUsage.Occlusion),
emissiveFactor:F?[F[0],F[1],F[2]]:[0,0,0],metallicRoughness:w,wrapTextures:!1,hasParametersFromSource:E};const M=[];u.forEach(({usage:N},P)=>{var I=t.isSome(A)&&A[P]&&A[P].formats;I=I?l(I.map(({name:G,format:H})=>({name:G,encoding:k[H]}))):[];M.push({id:P,usage:N,encodings:I})});return{material:x,textures:M}};a.getMaterialAndTexturesFromShared=function(A){var x=A&&A.materialDefinitions?Object.keys(A.materialDefinitions)[0]:null,u=A&&A.textureDefinitions?Object.keys(A.textureDefinitions)[0]:null;x=
x?A.materialDefinitions?.[x]:null;u=u?A.textureDefinitions?.[u]:null;A=z();if(null!=x){x=x.params;x.diffuse&&(A.metallicRoughness.baseColorFactor=[x.diffuse[0],x.diffuse[1],x.diffuse[2],1]);null!=x.doubleSided&&(A.doubleSided=x.doubleSided,A.cullFace=x.doubleSided?e.CullFaceOptions.None:e.CullFaceOptions.Back);if("none"===x.cullFace||"front"===x.cullFace||"back"===x.cullFace)A.cullFace="none"===x.cullFace?e.CullFaceOptions.None:"back"===x.cullFace?e.CullFaceOptions.Back:e.CullFaceOptions.Front;x.transparency&&
(A.metallicRoughness.baseColorFactor[3]=b.clamp(1-x.transparency,0,1));if(x.useVertexColorAlpha||1>A.metallicRoughness.baseColorFactor[3])A.alphaMode="blend"}x=[];if(null!=u){!u.wrap||"repeat"!==u.wrap[0]&&"repeat"!==u.wrap[1]||(A.wrapTextures=!0);let y=n.TextureUsage.Color;"rgba"===u.channels&&(A.alphaMode="blend",y|=n.TextureUsage.AlphaMask);const w=u.images[u.images.length-1],D=F=>F&&F.split("/").pop();u=Array.isArray(u.encoding)?l(u.encoding.map((F,E)=>({name:D(w.href[E]),encoding:p[F]||0}))):
[{name:D(w.href),encoding:p[u.encoding]||0}];x.push({id:0,usage:y,encodings:u});A.metallicRoughness.baseColorTextureId=0}return{material:A,textures:x}};a.getSupportedEncodings=function(A){const x=!!A.compressedTextureS3TC;A=!!A.compressedTextureETC;const u=c("disable-feature:i3s-basis")?0:n.TextureEncoding.Basis|n.TextureEncoding.KTX2,y=u|n.TextureEncoding.DDS_S3TC;return n.TextureEncoding.JPG|n.TextureEncoding.PNG|(x?y:0)|(A?u:0)};a.selectEncoding=function(A,x){if(null!=x)return A.find(u=>0!==(u.encoding&
x))};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/webgl-engine/core/material/RenderTexture":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/promiseUtils"],function(a,c,b,t){let n=function(){function r(m,d){this._textureRep=m;this.loadPromise=null;this._disposed=!1;m=this._textureRep.acquire(d);t.isPromiseLike(m)?(m.then(f=>{this._disposed?b.releaseMaybe(f):this._textureRef=f}),this.loadPromise=
m):this._textureRef=m}r.prototype.dispose=function(){this._textureRef=b.releaseMaybe(this._textureRef);this._disposed=!0};c._createClass(r,[{key:"glTexture",get:function(){return b.isSome(this._textureRef)?this._textureRef.glTexture:null}}]);return r}();a.RenderTexture=n;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SStreamDataController":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/promiseUtils"],function(a,
c,b){let t=function(){function n(m,d){this._requester=m;this._apiKey=d;this._activeRequests=new Set}var r=n.prototype;r.request=function(m,d,f){const e=new AbortController;f=b.onAbortOrThrow(f,()=>e.abort());m=this._requester.request(m,d,{signal:e.signal,query:{token:this._apiKey}});const g={response:m,abortController:e,abortHandle:f};this._activeRequests.add(g);b.always(m,()=>{g.abortController=null;g.abortHandle?.remove();g.abortHandle=null;this._activeRequests.delete(g)});return m};r.cancelAll=
function(){this._activeRequests.forEach(m=>{m.abortController?.abort();m.abortController=null;m.abortHandle?.remove()});this._activeRequests.clear()};c._createClass(n,[{key:"busy",get:function(){return this._requester.busy}}]);return n}();a.I3SStreamDataController=t;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../geometry/ellipsoidUtils ../../../../geometry/projection ../../../../geometry/spatialReferenceEllipsoidUtils ../../../../geometry/support/frustum ../../../../geometry/support/spatialReferenceUtils ../../../../chunks/sphere ../../../../layers/graphics/dehydratedFeatures ../graphics/elevationAlignmentUtils ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ./I3SNode ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){return function(){function z(B,A,x,u,y,w,D,F,E={}){this._indexSR=B;this._renderCoordsHelper=A;this._clippingArea=y;this._elevationProvider=w;this._viewingMode=D;this._options=E;this._frustum=d.create();this._useFrustumCulling=!1;this._poi=b.create();this._elevationContext=null;this.minDistance=Infinity;this.maxDistance=0;this.maxLodLevel=2;this._tmpObb=p.create();this._tmp1=b.create();this._tmp2=b.create();this._tmp3=b.create();this._tmp0=b.create();this._screenspaceErrorBias=
E.screenspaceErrorBias||1;this._progressiveLoadFactor=E.progressiveLoadFactor||1;this.updateCamera(x,u);this.engineSR=this._renderCoordsHelper.spatialReference;this.updateElevationInfo(F);this._tmpPoint=g.makeDehydratedPoint(0,0,0,B);this._isECEFOBBInLocalMode=this._indexSR.isWGS84&&(this.engineSR.isWebMercator||f.isPlateCarree(this.engineSR));this._indexSREllipsoidRadius=n.getReferenceEllipsoid(this._indexSR).radius}var C=z.prototype;C.updateElevationInfo=function(B){null==B?this._elevationContext=
null:(this._elevationContext=l.ElevationContext.fromElevationInfo(B),this._elevationContext.updateFeatureExpressionInfoContext(v.createContextWithoutExpressionSupport(v.extractExpressionInfo(B,!1))))};C.updateCamera=function(B,A){(this._useFrustumCulling=A)&&d.fromMatrix(B.viewMatrix,B.projectionMatrix,this._frustum);this._screenSizeFactor=1/(B.perScreenPixelRatio/2);this._camPos=B.eye;this.minDistance=Infinity;this.maxDistance=0};C.setPointOfInterest=function(B){this._poi=B};C.updateScreenSpaceErrorBias=
function(B){const A=this._screenspaceErrorBias;this._screenspaceErrorBias=B;return A};C.updateClippingArea=function(B){this._clippingArea=B};C.getElevationRange=function(B){if(a.isNone(this._elevationContext))return null;var A=B.mbs;if(!A)return null;B=A[0];const x=A[1],u=A[2];A=A[3];const y="relative-to-scene"===this._elevationContext.mode?"scene":"ground";if(this._elevationProvider.getSphereElevationBounds)return this._elevationProvider.getSphereElevationBounds(B,x,u,A,this._indexSR,y);B=this._elevationProvider.getElevation(B,
x,u,this._indexSR,y);return a.isSome(B)?{min:B,max:B}:null};C.getRenderMbs=function(B){const A=B.renderMbs;if(k.isValidMbs(A))return A;B.mbs&&t.copy(A,B.mbs);this._elevationContext&&1E5>A[3]&&(this._tmpPoint.x=A[0],this._tmpPoint.y=A[1],this._tmpPoint.z=A[2],A[2]=h.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper));r.projectBoundingSphere(A,this._indexSR,A,this.engineSR);return A};C.getVisibilityObb=function(B){if(a.isSome(B.visibilityObb))return B.visibilityObb;
const A=B.serviceObb,x=.01*this._indexSREllipsoidRadius;if(a.isNone(A)||!B.mbs||!k.isValidObb(A)||this._isECEFOBBInLocalMode&&A.halfSize.some(u=>u>x))return null;B.serviceObbInRenderSR=this._computeRenderObb(A,B.serviceObbInRenderSR,B.mbs[3],B.elevationRange);return B.serviceObbInRenderSR};C._computeRenderObb=function(B,A,x,u){if(a.isNone(A))A=p.create();else if(k.isValidObb(A))return A;let y=0,w=0;if(this._elevationContext&&a.isSome(u)&&Number.isFinite(u.min))switch(this._elevationContext.mode){case "relative-to-ground":y=
this._elevationContext.geometryZWithOffset(B.center[2],this._renderCoordsHelper)+u.min-B.center[2];w=u.max-u.min;break;case "on-the-ground":y=u.min-B.center[2],w=u.max-u.min}else this._elevationContext&&1E5>x&&(this._tmpPoint.x=B.center[0],this._tmpPoint.y=B.center[1],this._tmpPoint.z=B.center[2],y=h.evaluateElevationAlignmentAtPoint(this._tmpPoint,this._elevationProvider,this._elevationContext,this._renderCoordsHelper)-B.center[2]);0<w?(k.transformObb(B,this._indexSR,this._tmpObb,this.engineSR,y),
p.computeOffsetObb(this._tmpObb,0,w,this._viewingMode,A)):k.transformObb(B,this._indexSR,A,this.engineSR,y);return A};C.isNodeVisible=function(B){const A=this.getRenderMbs(B);if(!this._isMBSinClippingArea(A))return!1;if(!this._useFrustumCulling)return!0;B=this.getVisibilityObb(B);return a.isSome(B)?p.isVisible(B,this._frustum):d.intersectsSphere(this._frustum,e.wrap(A))};C.isGeometryVisible=function(B){if(!this._useFrustumCulling)return!0;const A=B.geometryObb;return a.isSome(A)?p.isVisible(A,this._frustum):
this.isNodeVisible(B)};C._isMBSinClippingArea=function(B){return a.isNone(this._clippingArea)?!0:k.intersectBoundingRectWithMbs(this._clippingArea,B)!==k.MbsIntersectResult.OUTSIDE};C._screenSpaceDiameterMbs=function(B,A){var x=this.getRenderMbs(B);B=Math.sqrt(c.squaredDistance(x,this._camPos));x=B-x[3];this._updateMinMaxDistance(B);return 0>x?.5*Number.MAX_VALUE:A/x*this._screenSizeFactor};C.calcCameraDistance=function(B){return this.calcCameraDistanceToCenter(B)-this.getRenderMbs(B)[3]};C.calcCameraDistanceToCenter=
function(B){B=this.getRenderMbs(B);B=c.distance(B,this._camPos);this._updateMinMaxDistance(B);return B};C.calcAngleDependentLoD=function(B){B=this.getRenderMbs(B);const A=B[3];B=(Math.abs(B[0]*(B[0]-this._camPos[0])+B[1]*(B[1]-this._camPos[1])+B[2]*(B[2]-this._camPos[2]))/c.length(B)+A)/c.distance(B,this._camPos);return Math.min(1,B)};C.hasLOD=function(B){return B.lodMetric!==q.LodMetric.None};C._getDistancePlanarMode=function(B,A){var x=B[0]-A[0];const u=B[1]-A[1];B=B[2]-A[2];x=x*x+u*u;A=A[3];if(x<=
A*A)return Math.abs(B);A=Math.sqrt(x)-A;return Math.sqrt(B*B+A*A)};C._getDistanceGlobeMode=function(B,A){var x=c.length(A);const u=c.length(B)-x;c.scale(this._tmp0,B,c.dot(B,A)/c.squaredLength(B));var y=c.squaredDistance(A,this._tmp0),w=A[3];if(y<=w*w)return Math.abs(u);A=c.scale(this._tmp0,A,1/x);x=c.scale(this._tmp1,A,x-w*w/2/x);y=c.subtract(this._tmp2,B,x);y=c.subtract(this._tmp2,y,c.scale(this._tmp3,A,c.dot(A,y)));x=c.add(this._tmp2,x,c.scale(this._tmp2,y,w/c.length(y)));w=c.distance(B,x);2E5<=
u&&(B=c.subtract(this._tmp1,B,x),B=c.dot(B,A)/c.length(B),.08>B&&(B=1E-4),w/=B);return w};C._getDistance=function(B,A){return this.engineSR===m.getSphericalPCPF(this.engineSR)?this._getDistanceGlobeMode(B,A):this._getDistancePlanarMode(B,A)};C._updateMinMaxDistance=function(B){0<B?(this.minDistance=Math.min(this.minDistance,B),this.maxDistance=Math.max(this.maxDistance,B)):(this.minDistance=0,this.maxDistance=Math.max(this.maxDistance,-B))};C.getLodLevel=function(B){if(B.lodMetric===q.LodMetric.None)return 0;
if(0===B.childCount)return this.maxLodLevel;if(this._useFrustumCulling&&1>this._progressiveLoadFactor){const A=this._screenspaceErrorBias;return this.evaluateLODmetric(B,this._progressiveLoadFactor*this._screenspaceErrorBias)?this.evaluateLODmetric(B,A)?2:1:0}return this.evaluateLODmetric(B,this._screenspaceErrorBias)?this.maxLodLevel:0};C.evaluateLODmetric=function(B,A){switch(B.lodMetric){case q.LodMetric.ScreenSpaceRelative:const x=this.getRenderMbs(B),u=this._getDistance(this._camPos,x),y=2*u/
this._screenSizeFactor;this._updateMinMaxDistance(u+x[3]);return B.maxError*A<=y;case q.LodMetric.MaxScreenThreshold:return A=this._screenSpaceDiameterMbs(B,B.mbs[3]*A),this._options.angleDependentLoD&&(A*=this.calcAngleDependentLoD(B)),A<B.maxError;case q.LodMetric.RemovedFeatureDiameter:return 10>this._screenSpaceDiameterMbs(B,B.maxError)*A;case q.LodMetric.DistanceRangeFromDefaultCamera:return this.calcCameraDistance(B)>B.maxError*A}return!1};C.distToPOI=function(B){B=this.getRenderMbs(B);return c.distance(B,
this._poi)-B[3]};C.distCameraToPOI=function(){return c.distance(this._camPos,this._poi)};return z}()})},"esri/layers/support/SceneModification":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/lang ../../core/Warning ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/decorators/persistable ../../geometry/projection ../../geometry/Polygon".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){var v;b=v=function(q){function k(z){z=q.call(this,z)||this;z.geometry=null;z.type="clip";return z}a._inheritsLoose(k,q);var p=k.prototype;p.writeGeometry=function(z,C,B,A){if(A.layer&&A.layer.spatialReference&&!A.layer.spatialReference.equals(this.geometry.spatialReference)){if(!h.canProjectWithoutEngine(z.spatialReference,A.layer.spatialReference)){A&&A.messages&&A.messages.push(new r("scenemodification:unsupported","Scene modifications with incompatible spatial references are not supported",
{modification:this,spatialReference:A.layer.spatialReference,context:A}));return}const x=new l;h.projectPolygon(z,x,A.layer.spatialReference);C[B]=x.toJSON(A)}else C[B]=z.toJSON(A);delete C[B].spatialReference};p.clone=function(){return new v({geometry:n.clone(this.geometry),type:this.type})};return k}(t.JSONSupport);c.__decorate([m.property({type:l}),g.persistable()],b.prototype,"geometry",void 0);c.__decorate([e.writer(["web-scene","portal-item"],"geometry")],b.prototype,"writeGeometry",null);c.__decorate([m.property({type:["clip",
"mask","replace"],nonNullable:!0}),g.persistable()],b.prototype,"type",void 0);return b=v=c.__decorate([f.subclass("esri.layers.support.SceneModification")],b)})},"esri/views/3d/layers/I3SMeshViewLabeler":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../symbols ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/diffUtils ../../../chunks/vec3f64 ../../../layers/graphics/dehydratedFeatures ./graphics/Graphics3DCore ./graphics/Graphics3DScaleVisibility ./i3s/I3SGeometryUtil ../support/LimitGraphicsMap ../webgl-engine/lib/UpdatePolicy ../../../symbols/PointSymbol3D".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A){t=function(y){function w(F){F=y.call(this,F)||this;F.loadedGraphics=new C.LimitGraphicsMap(5E4);F.slicePlaneEnabled=!1;F._renderingInfo={symbol:new A};F._handles=new r;F._graphicsByNode=new Map;return F}a._inheritsLoose(w,y);var D=w.prototype;D.initialize=function(){const F=this.view.basemapTerrain;this._graphicsCore=new k.Graphics3DCore({owner:this,layer:this.layer,preferredUpdatePolicy:B.UpdatePolicy.ASYNC,elevationFeatureExpressionEnabled:!1,
graphicSymbolSupported:!1,getRenderingInfoWithoutRenderer:!0,hasZ:!0,hasM:!1,componentFactories:{deconflictor:E=>this.view.deconflictor.addGraphicsOwner(E),labeler:(E,K)=>this.view.labeler.addGraphicsOwner(E,K,{emptySymbolLabelSupported:!0,elevationInfoOverride:{mode:"absolute-height",offset:0},disablePlacement:{logEntityDescription:"3D Object Scene Layer features"}}),scaleVisibility:(E,K)=>new p({graphicsCoreOwner:this,layer:this.layer,queryGraphicUIDsInExtent:K,graphicsCore:E,basemapTerrain:F,layerScaleEnabled:!1})}});
this._graphicsCore.initializePromise.then(()=>this._graphicsCore.startCreateGraphics()).catch(()=>{});this._handles.add(d.watch(()=>this.layer.labelingInfo,(E,K)=>{l.diff(E,K)&&this._graphicsCore.updateLabelingInfo()}))};D.destroy=function(){this._handles=m.destroyMaybe(this._handles);this._graphicsCore=m.destroyMaybe(this._graphicsCore);this.loadedGraphics=m.destroyMaybe(this.loadedGraphics);this.view=null};D.addNodeMeta=function(F,E){let K=0;const J=F.filteredIds,M=this.view.spatialReference,N=
F.featureIds.map((P,I)=>{z.boundingBoxTop(I,this.collection,F.objectHandle,u);const G=q.makeDehydratedPoint(0,0,0,M);this.view.renderCoordsHelper.fromRenderCoords(u,G);I=E(I,F);let H=!1;m.isNone(J)?H=!0:K<J.length&&P===J[K]&&(H=!0,K++);return{objectId:P,uid:b.generateUID(),attributes:I,visible:H,geometry:G}});this.loadedGraphics.addMany(N);this._graphicsByNode.set(F.node.index,N)};D.updateLabelPositions=function(F){const E=this._graphicsByNode.get(F.node.index);if(E){var K=0,J=this.view.spatialReference,
M=this.view.renderCoordsHelper;for(let N=0;N<F.featureIds.length;N++){const P=E[K];if(F.featureIds[N]===P.objectId){K++;const I=this._graphicsCore.getGraphics3DGraphicById(P.uid);m.isNone(I)||(z.boundingBoxTop(N,this.collection,F.objectHandle,u),this.view.renderCoordsHelper.fromRenderCoords(u,u,J),I.alignWithAbsoluteElevation(u[2],M,!1),m.isSome(P.geometry)&&"point"===P.geometry.type&&(P.geometry.z=u[2]))}}}};D.setNodeMetaAttributes=function(F,E){const K=this._graphicsByNode.get(F.node.index);if(K){var J=
Array(K.length);for(let M=0;M<K.length;M++){const N=K[M];N.attributes=E(M,F);J[M]=N.uid}this._graphicsCore.updateLabelingInfo(J)}};D.applyFilterChange=function(F){var E=this._graphicsByNode.get(F.node.index);if(E)if(m.isNone(F.filteredIds))for(var K of E)K.visible||(K.visible=!0,x.graphic=K,x.property="visible",x.oldValue=!1,x.newValue=!0,this._graphicsCore.graphicUpdateHandler(x));else{K=0;for(const J of E)E=J.visible,K<F.filteredIds.length&&J.objectId===F.filteredIds[K]?(J.visible=!0,K++):J.visible=
!1,E!==J.visible&&(x.graphic=J,x.property="visible",x.oldValue=E,x.newValue=J.visible,this._graphicsCore.graphicUpdateHandler(x))}};D.removeNodeMeta=function(F){this.loadedGraphics.removeManyByObjectId(F.featureIds)};D.getRenderingInfo=function(){return this._renderingInfo};D.notifyGraphicGeometryChanged=function(){};D.notifyGraphicVisibilityChanged=function(){};a._createClass(w,[{key:"updating",get:function(){return this._graphicsCore?.updating??!1}},{key:"updatePolicy",get:function(){return this._graphicsCore.effectiveUpdatePolicy}},
{key:"usedMemory",get:function(){return this._graphicsCore.usedMemory}},{key:"unloadedMemoryEstimate",get:function(){return this._graphicsCore.unprocessedMemoryEstimate}},{key:"test",get:function(){return{graphicsCore:this._graphicsCore}}}]);return w}(n);c.__decorate([f.property()],t.prototype,"view",void 0);c.__decorate([f.property()],t.prototype,"layer",void 0);c.__decorate([f.property()],t.prototype,"collection",void 0);c.__decorate([f.property()],t.prototype,"loadedGraphics",void 0);c.__decorate([f.property()],
t.prototype,"updating",null);c.__decorate([f.property()],t.prototype,"slicePlaneEnabled",void 0);c.__decorate([f.property()],t.prototype,"_graphicsCore",void 0);t=c.__decorate([h.subclass("esri.views.3d.layers.I3SMeshViewLabeler")],t);const x={graphic:null,property:null,oldValue:null,newValue:null},u=v.create();return t})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../webgl-engine/lib/DoubleArray".split(" "),
function(a,c,b,t,n,r,m){function d(g,h,l,v){g=h.getComponentAabb(l,g,f);h=h.getObjectTransform(l);for(l=0;8>l;++l)e[0]=l&1?g[0]:g[3],e[1]=l&2?g[1]:g[4],e[2]=l&4?g[2]:g[5],b.transformMat3(e,e,h.rotationScale),b.add(e,e,h.position),v[3*l]=e[0],v[3*l+1]=e[1],v[3*l+2]=e[2];return v}const f=r.create(),e=t.create();a.boundingBoxCornerPoints=d;a.boundingBoxTop=function(g,h,l,v){g=h.getComponentAabb(l,g,f);h=h.getObjectTransform(l);v[0]=0;v[1]=0;v[2]=0;for(l=0;8>l;++l)e[0]=l&1?g[0]:g[3],e[1]=l&2?g[1]:g[4],
e[2]=g[5],b.transformMat3(e,e,h.rotationScale),b.add(e,e,h.position),v[0]+=e[0],v[1]+=e[1],v[2]+=e[2];v[0]/=8;v[1]/=8;v[2]/=8;return v};a.createGetFeatureExtent=function(g,h,l){const v=m.newDoubleArray(24);return q=>{var k=q.meta.featureExtents;if(c.isNone(k)){k=new Float64Array(6*q.meta.featureIds.length);q.meta.featureExtents=k;for(let p=0;p<k.length;p+=6)k[p]=Number.POSITIVE_INFINITY}k=new Float64Array(k.buffer,6*q.index*Float64Array.BYTES_PER_ELEMENT,6);k[0]===Number.POSITIVE_INFINITY&&(d(q.index,
l,q.meta.objectHandle,v),n.projectBuffer(v,h,0,v,g,0,8)?(r.set(k,r.NEGATIVE_INFINITY),r.expandWithBuffer(k,v,0,8)):r.set(k,r.ZERO));return k}};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/LimitGraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils","./GraphicsMap"],function(a,c,b,t,n){b=function(d){function f(g){var h=d.call(this)||this;h._limit=g;h._all=new n.GraphicsMap;h._active=
new m(c._assertThisInitialized(h));h._pending=new Map;h._handle=h._all.on("change",l=>h._handleChanges(l));return h}c._inheritsLoose(f,d);var e=f.prototype;e.destroy=function(){this._handle.remove()};e.toArray=function(){return this._active.toArray()};e.find=function(g){return this._active.find(g)};e.forEach=function(g){this._active.forEach(g)};e.addMany=function(g){this._all.addMany(g)};e.removeManyByObjectId=function(g){this._all.removeManyByObjectId(g)};e._handleChanges=function(g){let h=g.removed;
if(0<this._pending.size){h=[];for(var l of g.removed)this._pending.delete(l.objectId)||h.push(l)}l=this._limit-this._active.length+h.length;l<g.added.length&&(this._active.removeMany(h),h=[],r.reset(1-this._limit/(this._active.length+g.added.length)),this._active.forEach(q=>{r.sample()&&(h.push(q),this._pending.set(q.objectId,q))}),l=this._limit-this._active.length+h.length);let v=g.added;if(l<g.added.length){v=[];r.reset(l/g.added.length);for(const q of g.added)r.sample()?v.push(q):this._pending.set(q.objectId,
q)}g=l-v.length;0<g&&0<this._pending.size&&(r.reset(g/this._pending.size),this._pending.forEach(q=>{r.sample()&&(v.push(q),this._pending.delete(q.objectId))}));this._active.addAndRemove(v,h)};c._createClass(f,[{key:"length",get:function(){return this._active.length}}]);return f}(b);const r=new (function(){function d(){this._percentage=1;this._last=-1;this._index=0}var f=d.prototype;f.reset=function(e){this._percentage=e;this._last=-1};f.sample=function(){const e=Math.floor(this._index*this._percentage);
++this._index;if(e===this._last)return!1;this._last=e;return!0};return d}());let m=function(){function d(e){this._parent=e;this._map=new Map}var f=d.prototype;f.forEach=function(e){this._map.forEach(g=>e(g))};f.find=function(e){let g=void 0;t.someMap(this._map,h=>e(h)?(g=h,!0):!1);return g};f.toArray=function(){return[...this._map.values()]};f.addAndRemove=function(e,g){for(const h of e)this._map.set(h.objectId,h);for(const h of g)this._map.delete(h.objectId);(0<e.length||0<g.length)&&this._parent.emit("change",
{added:e,removed:g})};f.removeMany=function(e){for(const g of e)this._map.delete(g.objectId);0<e.length&&this._parent.emit("change",{added:[],removed:e})};c._createClass(d,[{key:"length",get:function(){return this._map.size}}]);return d}();a.LimitGraphicsMap=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/support/GraphicsMap":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/Evented","../../../core/MapUtils"],function(a,c,b,t){b=
function(n){function r(){var d=n.apply(this,arguments)||this;d._map=new Map;return d}c._inheritsLoose(r,n);var m=r.prototype;m.clear=function(){if(0<this._map.size){const d=this.toArray();this._map.clear();this.emit("change",{added:[],removed:d})}};m.get=function(d){return this._map.get(d)};m.addMany=function(d){if(0!==d.length){var f=new Set;for(let e=0;e<d.length;e++){const g=d[e],h=g.objectId,l=this._map.get(h);l?(f.add(h),g!==l&&(d[e]=l),l.refCount||(l.refCount=0),++l.refCount):(g.refCount=1,
this._map.set(h,g))}d=0<f.size?d.filter(e=>!f.has(e.objectId)):d;0<d.length&&this.emit("change",{added:d,removed:[]})}};m.removeMany=function(d){const f=[];for(const e of d){d=e.objectId;const g=this._map.get(d);null!=g&&(!g.refCount||0>=--g.refCount)&&(this._map.delete(d),f.push(e))}0<f.length&&this.emit("change",{added:[],removed:f})};m.removeManyByObjectId=function(d){const f=[];for(const e of d)d=this._map.get(e),null!=d&&(!d.refCount||0>=--d.refCount)&&(this._map.delete(e),f.push(d));0<f.length&&
this.emit("change",{added:[],removed:f})};m.toArray=function(){return[...this._map.values()]};m.find=function(d){let f;t.someMap(this._map,e=>d(e)?(f=e,!0):!1);return f};m.forEach=function(d){this._map.forEach(f=>d(f))};c._createClass(r,[{key:"length",get:function(){return this._map.size}}]);return r}(b);a.GraphicsMap=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/I3SMeshWorkerHandle":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/PooledArray ../../../core/workers/WorkerHandle ../../../geometry/projection ../../../libs/i3s/enums".split(" "),
function(a,c,b,t,n,r,m,d){function f(h,l,v){e.clear();var q=Infinity;let k=Infinity,p=-Infinity,z=-Infinity,C=!1;for(const A of l){var B="clip"===A.type?d.ModificationType.Inside:"mask"===A.type?d.ModificationType.Outside:d.ModificationType.Replace;const x=t.unwrapOrThrow(A.geometry,"modification.geometry");l=u=>u;if(x.spatialReference){if(!m.canProjectWithoutEngine(x.spatialReference,v)){b.getLogger("esri.views.3d.layers.I3SMeshWorkerHandle").warn("Can't project modification polygon into layer spatial reference, ignoring modification");
continue}l=u=>{m.projectVectorToVector(u,x.spatialReference,g,v);return g}}else x.hasZ||(g[2]=0,l=u=>{g[0]=u[0];g[1]=u[1];return g});C=C||B===d.ModificationType.Outside;e.push(B);e.push(x.rings.length);for(const u of x.rings){e.push(u.length);for(const y of u)B=l(y),e.push(B[0]),e.push(B[1]),e.push(B[2]),q=Math.min(q,B[0]),k=Math.min(k,B[1]),p=Math.max(p,B[0]),z=Math.max(z,B[1])}}t.isSome(h)&&(C?(e.push(d.ModificationType.Inside),e.push(2),e.push(4),e.push(q-1E-4),e.push(k-1E-4),e.push(0),e.push(p+
1E-4),e.push(k-1E-4),e.push(0),e.push(p+1E-4),e.push(z+1E-4),e.push(0),e.push(q-1E-4),e.push(z+1E-4),e.push(0)):(e.push(d.ModificationType.Outside),e.push(1)),e.push(4),e.push(h[0]),e.push(h[1]),e.push(0),e.push(h[2]),e.push(h[1]),e.push(0),e.push(h[2]),e.push(h[3]),e.push(0),e.push(h[0]),e.push(h[3]),e.push(0));e.push(d.ModificationType.Finished);h=new Float64Array(e.length);for(q=0;q<e.length;++q)h[q]=e.getItemAt(q);return h}r=function(h){function l(q){return h.call(this,"SceneLayerWorker","process",
{process:k=>[k.geometryBuffer]},q,{hasInitialize:!0})||this}c._inheritsLoose(l,h);var v=l.prototype;v.setModifications=function(q,k,p,z){q={context:q,modifications:f(k,p,z),isGeodetic:z.isGeographic};this.broadcast(q,"setModifications")};v.setLegacySchema=function(q,k){k=JSON.stringify(k);this.broadcast({context:q,jsonSchema:k},"setLegacySchema")};v.destroyContext=function(q){return this.broadcast(q,"destroyContext")};return l}(r.WorkerHandle);const e=new n({deallocator:null}),g=[0,0,0];a.I3SMeshWorkerHandle=
r;a.toWasmModification=f;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/enums":function(){define(["exports"],function(a){a.IndexType=void 0;(function(c){c[c.None=0]="None";c[c.Int16=1]="Int16";c[c.Int32=2]="Int32"})(a.IndexType||(a.IndexType={}));a.ModificationType=void 0;(function(c){c[c.Replace=0]="Replace";c[c.Outside=1]="Outside";c[c.Inside=2]="Inside";c[c.Finished=3]="Finished"})(a.ModificationType||(a.ModificationType={}));Object.defineProperty(a,Symbol.toStringTag,
{value:"Module"})})},"esri/views/3d/layers/II3SMeshView3D":function(){define(["exports"],function(a){a.ForAllFeaturesVisibilityMode=void 0;(function(c){c[c.VISIBLE_ONLY=0]="VISIBLE_ONLY";c[c.ALL=1]="ALL";c[c.ALL_IN_CLIPPING_AREA=2]="ALL_IN_CLIPPING_AREA"})(a.ForAllFeaturesVisibilityMode||(a.ForAllFeaturesVisibilityMode={}));a.ForAllFeaturesReturnType=void 0;(function(c){c[c.EXIT=0]="EXIT";c[c.CONTINUE=1]="CONTINUE";c[c.SKIP=2]="SKIP"})(a.ForAllFeaturesReturnType||(a.ForAllFeaturesReturnType={}));
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/SceneLayerWorker":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../libs/i3s/enums ../../../libs/i3s/I3SModule ./i3s/I3SNode".split(" "),function(a,c,b,t,n,r){function m(){m=c._asyncToGenerator(function*(A){yield p();const x=[A.geometryBuffer];return{result:l(A,x),transferList:x}});return m.apply(this,arguments)}function d(){d=c._asyncToGenerator(function*(A){yield p();
const x=[A.geometryBuffer];var {geometryBuffer:u}=A,y=u.byteLength;A=C._malloc(y);y=new Uint8Array(C.HEAPU8.buffer,A,y);y.set(new Uint8Array(u));u=C.dracoDecompressPointCloudData(A,y.byteLength);C._free(A);if(0<u.error.length)throw Error(`i3s.wasm: ${u.error}`);A=0<u.featureIds?.length?u.featureIds.slice():null;u=u.positions.slice();A&&x.push(A.buffer);x.push(u.buffer);return{result:{positions:u,featureIds:A},transferList:x}});return d.apply(this,arguments)}function f(){f=c._asyncToGenerator(function*(A){yield p();
v(A);A={buffer:A.buffer};return{result:A,transferList:[A.buffer]}});return f.apply(this,arguments)}function e(){e=c._asyncToGenerator(function*(A){yield p();h(A)});return e.apply(this,arguments)}function g(){g=c._asyncToGenerator(function*(A){yield p();C.setLegacySchema(A.context,A.jsonSchema)});return g.apply(this,arguments)}function h(A){const x=A.modifications,u=C._malloc(8*x.length),y=new Float64Array(C.HEAPU8.buffer,u,x.length);for(let w=0;w<x.length;++w)y[w]=x[w];C.setModifications(A.context,
u,x.length,A.isGeodetic);C._free(u)}function l(A,x){if(!C)return null;const {context:u,localOrigin:y,globalTrafo:w,mbs:D,obb:F,elevationOffset:E,geometryBuffer:K,geometryDescriptor:J,indexToVertexProjector:M,vertexToRenderProjector:N}=A;var P=C._malloc(K.byteLength),I=C._malloc(33*Float64Array.BYTES_PER_ELEMENT),G=new Uint8Array(C.HEAPU8.buffer,P,K.byteLength);G.set(new Uint8Array(K));var H=new Float64Array(C.HEAPU8.buffer,I,33);k(H,y);var L=H.byteOffset+3*H.BYTES_PER_ELEMENT,O=new Float64Array(H.buffer,
L);k(O,w);L+=16*H.BYTES_PER_ELEMENT;O=new Float64Array(H.buffer,L);k(O,D);L+=4*H.BYTES_PER_ELEMENT;b.isSome(F)&&(O=new Float64Array(H.buffer,L),k(O,F.center),L+=3*H.BYTES_PER_ELEMENT,O=new Float64Array(H.buffer,L),k(O,F.halfSize),L+=3*H.BYTES_PER_ELEMENT,O=new Float64Array(H.buffer,L),k(O,F.quaternion));H={isDraco:!1,isLegacy:!1,color:A.layouts.some(R=>R.some(Q=>"color"===Q.name)),normal:A.needNormals&&A.layouts.some(R=>R.some(Q=>"normalCompressed"===Q.name)),uv0:A.layouts.some(R=>R.some(Q=>"uv0"===
Q.name)),uvRegion:A.layouts.some(R=>R.some(Q=>"uvRegion"===Q.name)),featureIndex:J.featureIndex};G=C.process(u,!!A.obb,P,G.byteLength,J,H,I,E,M,N,A.normalReferenceFrame);C._free(I);C._free(P);if(0<G.error.length)throw Error(`i3s.wasm: ${G.error}`);if(G.discarded)return null;P=0<G.componentOffsets.length?G.componentOffsets.slice():null;I=0<G.featureIds.length?G.featureIds.slice():null;H=G.interleavedVertedData.slice().buffer;L=G.indicesType===t.IndexType.Int16?(new Uint16Array(G.indices.buffer,G.indices.byteOffset,
G.indices.byteLength/2)).slice():(new Uint32Array(G.indices.buffer,G.indices.byteOffset,G.indices.byteLength/4)).slice();O=G.positions.slice();const S=G.positionIndicesType===t.IndexType.Int16?(new Uint16Array(G.positionIndices.buffer,G.positionIndices.byteOffset,G.positionIndices.byteLength/2)).slice():(new Uint32Array(G.positionIndices.buffer,G.positionIndices.byteOffset,G.positionIndices.byteLength/4)).slice();A={layout:A.layouts[0],interleavedVertexData:H,indices:L,hasColors:G.hasColors,hasModifications:G.hasModifications,
positionData:{data:O,indices:S}};I&&x.push(I.buffer);P&&x.push(P.buffer);x.push(H);x.push(L.buffer);x.push(O.buffer);x.push(S.buffer);return{componentOffsets:P,featureIds:I,transformedGeometry:A,obb:G.obb}}function v(A){const {context:x,buffer:u}=A;A=C._malloc(u.byteLength);const y=u.byteLength/Float64Array.BYTES_PER_ELEMENT,w=new Float64Array(C.HEAPU8.buffer,A,y),D=new Float64Array(u);w.set(D);C.filterOBBs(x,A,y);D.set(w);C._free(A)}function q(A){C&&C.destroy(A)}function k(A,x){for(let u=0;u<x.length;++u)A[u]=
x[u]}function p(){if(C)return Promise.resolve();z||(z=n.get().then(A=>{C=A;z=null}));return z}let z,C;const B={transform:l,destroy:q};a.destroyContext=function(A){q(A)};a.dracoDecompressPointCloudData=function(A){return d.apply(this,arguments)};a.filterObbsForModifications=function(A){return f.apply(this,arguments)};a.filterObbsForModificationsSync=v;a.initialize=p;a.interpretObbModificationResults=function(A){return 0===A?r.NodeIMModificationImpact.Unmodified:1===A?r.NodeIMModificationImpact.PotentiallyModified:
2===A?r.NodeIMModificationImpact.Culled:r.NodeIMModificationImpact.Unknown};a.process=function(A){return m.apply(this,arguments)};a.setLegacySchema=function(A){return g.apply(this,arguments)};a.setModifications=function(A){return e.apply(this,arguments)};a.setModificationsSync=h;a.test=B;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/libs/i3s/I3SModule":function(){define(["require","exports","../../assets"],function(a,c,b){function t(r){return b.getAssetUrl(`esri/libs/i3s/${r}`)}
let n;c.get=function(){n||(n=(new Promise(r=>(new Promise((m,d)=>a(["../../chunks/i3s"],m,d))).then(m=>m.i3s).then(({default:m})=>{const d=m({locateFile:t,onRuntimeInitialized:()=>r(d)});delete d.then}))).catch(r=>{throw r;}));return n};Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/Highlights":function(){define(["../../../../core/arrayUtils","../II3SMeshView3D"],function(a,c){let b=function(){this.ids=new Set;this.paused=!1};return function(){function t({collection:r,
forAllFeatures:m,forAllFeaturesOfNode:d}){this._highlights=[];this._collection=r;this._forAllFeatures=m;this._forAllFeaturesOfNode=d}var n=t.prototype;n.destroy=function(){this._highlights.forEach(r=>this._releaseSet(r));this._highlights=null};n.acquireSet=function(){const r=new b;this._highlights.push(r);return{set:r,handle:{remove:()=>{this._highlights&&(this._releaseSet(r),a.removeUnordered(this._highlights,r))},pause:()=>{this._releaseSet(r);r.paused=!0},resume:()=>{r.paused=!1;this._initializeSet(r)}}}};
n.setFeatureIds=function(r,m){m.forEach(d=>r.ids.add(d));this._initializeSet(r)};n._initializeSet=function(r){this._forAllFeatures((m,d,f)=>{r.ids.has(m)&&this._collection.addComponentHighlight(f.objectHandle,d);return c.ForAllFeaturesReturnType.CONTINUE})};n._releaseSet=function(r){this._forAllFeatures((m,d,f)=>{r.ids.has(m)&&this._collection.removeComponentHighlight(f.objectHandle,d);return c.ForAllFeaturesReturnType.CONTINUE})};n.objectCreated=function(r){this._highlights.forEach(m=>{m.paused||
this._forAllFeaturesOfNode(r,(d,f)=>{m.ids.has(d)&&this._collection.addComponentHighlight(r.objectHandle,f);return c.ForAllFeaturesReturnType.CONTINUE})})};n.objectDeleted=function(r){this._collection.clearHighlights(r.objectHandle)};return t}()})},"esri/views/3d/layers/i3s/I3SAsyncElevationUpdater":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../graphics/ExtentSet ../../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g){a.I3SAsyncElevationUpdater=function(h){function l(q,k,p){var z=h.call(this,{})||this;z._updateExtent=k;z._updateNode=p;z.running=!1;z._extentSet=new e.ExtentSet;z._nodeSet=new Set;z.addHandles(q.registerTask(g.TaskPriority.ELEVATION_ALIGNMENT,c._assertThisInitialized(z)));return z}c._inheritsLoose(l,h);var v=l.prototype;v.normalizeCtorArgs=function(){return{}};v.addExtent=function(q){this._extentSet.add(q);this.running=!0};v.schedule=function(q){this._nodeSet.add(q);
this.running=!0};v.remove=function(q){this._nodeSet.delete(q);this._updateRunning()};v.runTask=function(q){const k=this._extentSet;for(q.run(()=>k.merge(q));!k.empty&&!q.done;){var p=this._updateExtent(k.pop());n.isSome(p)&&p.forAll(z=>this.schedule(z));q.madeProgress()}if(!q.done){p=this._nodeSet;for(const z of p)if(p.delete(z),this._updateNode(z),q.madeProgress(),q.done)break;this._updateRunning()}};v._updateRunning=function(){this.running=0<this._nodeSet.size||0<this._extentSet.size};return l}(t);
b.__decorate([r.property()],a.I3SAsyncElevationUpdater.prototype,"running",void 0);a.I3SAsyncElevationUpdater=b.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SAsyncElevationUpdater.ts")],a.I3SAsyncElevationUpdater);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SCrossfadeHelper":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/scheduling","../support/I3SLayerView"],function(a,c,
b,t,n){let r=function(){function m(f){this._view=f;this._currentFrameStartTime=this._preRenderFrameTaskHandle=null;this._numFadingNodes=0}var d=m.prototype;d.stopNodeFading=function(f){null!=f.lodCrossfadeProgress&&(this._numFadingNodes--,f.lodCrossfadeProgress=null,0===this._numFadingNodes&&(null!=this._preRenderFrameTaskHandle&&(this._preRenderFrameTaskHandle=b.removeMaybe(this._preRenderFrameTaskHandle)),this._view.notifyLODUpdate(),this._view.notifyUpdate()))};d._startNodeFading=function(f,e,
g){0===this._numFadingNodes&&(this._preRenderFrameTaskHandle=t.addFrameTask({preRender:h=>this._updateAllNodeFading(h)}),this._view.notifyLODUpdate());null==f.lodCrossfadeProgress&&(this._numFadingNodes++,this._view.notifyUpdate());f.lodCrossfadeSignedDuration=g;f.lodCrossfadeProgress=e};d._updateAllNodeFading=function(f){const e=this._view.nodeCrossfadingEnabled;this._view.foreachCrossfadeNode((g,h)=>{if(b.isSome(h)&&b.isSome(h.lodCrossfadeProgress)){const l=h.lodCrossfadeSignedDuration,v=h.lodCrossfadeProgress+
Math.abs(f.deltaTime/l),q=!e||1<=v||0===l,k=(0<l?this._view.fullOpacity:0)-(q?0:0<l?1:-1)*(1-v);q?(this.stopNodeFading(h),0>l&&this._view.markNodeToRemove(g)):h.lodCrossfadeProgress=v;this._view.setNodeOpacityByIndex(g,k)}});this._view.removeMarkedNodes()};d.stopAllNodeFading=function(){this._view.foreachCrossfadeNode((f,e)=>{b.isSome(e)&&b.isSome(e.lodCrossfadeProgress)&&(this.stopNodeFading(e),e=e.lodCrossfadeSignedDuration,0>e&&this._view.markNodeToRemove(f),this._view.setNodeOpacityByIndex(f,
0<e?this._view.fullOpacity:0))});this._view.removeMarkedNodes()};d.fadeNode=function(f,e,g,h){null==this._currentFrameStartTime&&(this._currentFrameStartTime=Date.now());var l=this._view;const v=l.nodeCrossfadingEnabled,q=g===n.FadeDirection.FadeIn?l.fullOpacity:0;h=v?h?g===n.FadeDirection.FadeIn?l.lodCrossfadeinDuration:l.lodCrossfadeoutDuration:l.lodCrossfadeUncoveredDuration:0;l=this._view.getNodeOpacityByIndex(f);v&&l!==q&&0<h?this._startNodeFading(e,1-Math.abs(q-l),(g===n.FadeDirection.FadeIn?
1:-1)*h):(this.stopNodeFading(e),this._view.setNodeOpacityByIndex(f,q),g===n.FadeDirection.FadeOut&&this._view.removeNode(f))};d.isNodeFullyFadedIn=function(f){const e=this._view.getNodeCrossfadeMetaData(f);return b.isNone(e)||null==e.lodCrossfadeProgress&&this._view.getNodeOpacityByIndex(f)===this._view.fullOpacity};c._createClass(m,[{key:"updating",get:function(){return 0<this._numFadingNodes}}]);return m}();a.I3SCrossfadeHelper=r;a.NodeCrossfadeMetaData=function(){this.lodCrossfadeSignedDuration=
0};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p){const z=q.empty(),C=h.create(),B=v.create(),A=v.create(),x=v.create();b=function(u){function y(D){D=u.call(this,D)||this;D._tmpEvent={spatialReference:null,extent:z,context:"scene"};return D}a._inheritsLoose(y,u);var w=y.prototype;w.initialize=function(){this.view=this.layerView.view;this._renderCoordsHelper=this.view.renderCoordsHelper;this._intersector=k.newIntersector(this.view.state.viewingMode);this._intersector.options.store=p.StoreResults.MIN;const D=
this.layerView.i3slayer.fullExtent;r.isNone(D)?n.getLogger(this.declaredClass).error("I3SElevationProvider expected fullExtent on I3SLayer."):(this._zmin=D.zmin,this._zmax=D.zmax);this._tmpEvent.context=this.intersectionHandler.isGround?"ground":"scene"};w.getElevation=function(D,F,E,K){B[0]=D;B[1]=F;B[2]=E;if(!this._renderCoordsHelper.toRenderCoords(B,K,B))return n.getLogger(this.declaredClass).error("could not project point to compute elevation"),null;D=this.layerView.elevationOffset;F=this._zmin+
D;this._renderCoordsHelper.setAltitude(A,this._zmax+D,B);this._renderCoordsHelper.setAltitude(x,F,B);this._intersector.reset(A,x,null);this.intersectionHandler.intersect(this._intersector,null,A,x);return this._intersector.results.min.getIntersectionPoint(B)?this._renderCoordsHelper.getAltitude(B):null};w.layerChanged=function(){this.spatialReference&&(this._tmpEvent.extent=this._computeLayerExtent(),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))};
w.objectChanged=function(D){this.spatialReference&&(this._tmpEvent.extent=this._computeObjectExtent(D),this._tmpEvent.spatialReference=this.spatialReference,this.emit("elevation-change",this._tmpEvent))};w._computeObjectExtent=function(D){q.empty(z);this._expandExtent(D,z);return z};w._computeLayerExtent=function(){q.empty(z);for(const D of this.layerView.getVisibleNodes())this._expandExtent(D,z);return z};w._expandExtent=function(D,F){const E=this.spatialReference;if(!r.isNone(E)&&(D=this.layerView.getNodeComponentObb(D),
!r.isNone(D))){g.fromQuat(C,D.quaternion);C[12]=D.center[0];C[13]=D.center[1];C[14]=D.center[2];for(let K=0;8>K;++K)B[0]=K&1?D.halfSize[0]:-D.halfSize[0],B[1]=K&2?D.halfSize[1]:-D.halfSize[1],B[2]=K&4?D.halfSize[2]:-D.halfSize[2],l.transformMat4(B,B,C),this._renderCoordsHelper.fromRenderCoords(B,B,E),q.expand(F,B,F)}};a._createClass(y,[{key:"spatialReference",get:function(){return this.view?.elevationProvider?.spatialReference}}]);return y}(t.EventedMixin(b));c.__decorate([m.property({constructOnly:!0})],
b.prototype,"layerView",void 0);c.__decorate([m.property({constructOnly:!0})],b.prototype,"intersectionHandler",void 0);c.__decorate([m.property()],b.prototype,"view",void 0);c.__decorate([m.property()],b.prototype,"spatialReference",null);return b=c.__decorate([e.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],b)})},"esri/views/3d/layers/i3s/I3SIntersectionHandler":function(){define("exports ../../../../core/maybe ../../../ViewingMode ./I3SUtil ./Intersector ../../support/orientedBoundingBox ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,c,b,t,n,r,m,d,f){function e(h,l,v,q=0){q=h[3]+q;const k=l[0]-h[0],p=l[1]-h[1];h=l[2]-h[2];l=v[0];const z=v[1];v=v[2];const C=l*k+z*p+v*h;return 0<=C*C-(l*l+z*z+v*v)*(k*k+p*p+h*h-q*q)}let g=function(){function h(v){this.type=d.IntersectorType.I3S;this._needVerticalOffset=!1;this.layerUid=v.layerUid;this.sublayerUid=v.sublayerUid;this._collection=v.collection;this._traverseNodeHierarchy=v.traverseNodeHierarchy;this.slicePlaneEnabled=v.slicePlaneEnabled;this.isGround=v.isGround}var l=h.prototype;
l.updateElevationAlignState=function(v,q){this._needVerticalOffset=v&&q===b.ViewingMode.Global};l.intersect=function(v,q,k,p){const z=v.results,C=v.options.store===d.StoreResults.ALL,B=v.ray.direction,A=v.tolerance;let x=w=>w,u=w=>w;const y=f.getVerticalOffsetI3S(c.isSome(v.verticalOffset)?v.verticalOffset:this._needVerticalOffset?0:null);c.isSome(v.verticalOffset)&&c.isSome(y)&&(x=w=>y.applyToMbs(w),u=w=>y.applyToObb(w));this._traverseNodeHierarchy((w,D)=>{if(0===w.childrenLoaded)return!1;const F=
c.isSome(w.serviceObbInRenderSR)&&t.isValidObb(w.serviceObbInRenderSR)?w.serviceObbInRenderSR:null;if(c.isSome(F)&&!r.intersectLine(u(F),k,B,A))return!1;D&&(c.isSome(F)||!t.isValidMbs(w.renderMbs)||e(x(w.renderMbs),k,B,A))&&(c.isNone(w.geometryObb)||r.intersectLine(u(w.geometryObb),k,B,A))&&this._collection.intersect(D,k,p,A,y,(E,K,J,M)=>{if(0<=K&&(null==q||q(k,p,K))){var N=P=>{const I=new n.I3sTarget(this.layerUid,this.sublayerUid,w.index,E,M);P.set(this.type,I,K,J)};this.isGround&&(null==z.ground.dist||
K<z.ground.dist)&&N(z.ground);if(!v.options.isFiltered&&((null==z.min.dist||K<z.min.dist)&&N(z.min),(null==z.max.dist||K>z.max.dist)&&N(z.max),C)){const P=m.newIntersectorResult(v.ray);N(P);v.results.all.push(P)}}});return!0})};return h}();a.I3SIntersectionHandler=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SOverrides":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../request ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../intl/number ../../../../layers/support/featureQueryAll ../../../../support/featureFlags ../FeatureLayerView3D".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C){a.I3SOverrides=function(x){function u(w){w=x.call(this,w)||this;w._warnMaximumChangedObjectsExceeded=!1;w._interactiveEditingSessions=null;w._maximumNumberOfEditOVerrides=5E4;w._original3DOFLDefinitionExpression=null;w._associatedLayerView=null;w._changedObjectIds=new Set;w._pendingFetchChangedObjectIds=null;w._pendingFetchAbortController=new AbortController;return w}c._inheritsLoose(u,x);var y=u.prototype;y.initialize=function(){this._memCache=this.memoryController.newCache(`${this.layer.uid}-attribute-overrides`);
this._pendingFetchChangedObjectIds=this._fetchChangedObjectIds(this._pendingFetchAbortController?.signal);this._pendingFetchChangedObjectIds.then(()=>{this._pendingFetchChangedObjectIds=this._pendingFetchAbortController=null});this.is3DOFL&&z.enableDirect3DObjectFeatureLayerDisplay()&&e.isSome(this._associatedLayer)&&this._associatedLayer.load().then(w=>{this.destroyed||(this._original3DOFLDefinitionExpression=w.definitionExpression,this.addHandles(h.watch(()=>this._definitionExpression,D=>w.definitionExpression=
D,h.initial)),this._associatedLayerView=new C({layer:this._associatedLayer,view:this.view}))})};y.destroy=function(){this.is3DOFL&&z.enableDirect3DObjectFeatureLayerDisplay()&&e.isSome(this._associatedLayerView)&&e.isSome(this._associatedLayer)&&(this._associatedLayer.definitionExpression=e.unwrap(this._original3DOFLDefinitionExpression));this._set("layer",null);this._memCache=e.destroyMaybe(this._memCache);this._pendingFetchAbortController=e.abortMaybe(this._pendingFetchAbortController);this._pendingFetchChangedObjectIds=
null};y.createInteractiveEditSession=function(w){this._changedObjectIds.add(w);this.notifyChange("_changedObjectIds");e.isNone(this._interactiveEditingSessions)&&(this._interactiveEditingSessions=[]);const D=this._interactiveEditingSessions,F=new B(w,{rollback:()=>{r.remove(D,F);0===D.length&&(this._interactiveEditingSessions=null)},commit:E=>{for(const [K,J]of E)this.updateAttributeValue(w,K,J)}});D.unshift(F);return F};y.apply=function(){var w=c._asyncToGenerator(function*(D,F,E){if(!e.isNone(F)){var {loadedAttributes:K,
attributeData:J}=F;if(!e.isNone(K)&&0!==K.length&&!e.isNone(J)&&(this._pendingFetchChangedObjectIds&&(yield g.whenOrAbort(this._pendingFetchChangedObjectIds,E)),0!==this._changedObjectIds.size)){F={loadedAttributes:K,attributeData:J};var M=this._getOverridesFromCache(D,F,this._changedObjectIds),{objectIds:N,fieldNames:P}=M;0!==N.length&&0!==P.length&&(E=yield this._queryOverridesFromAssociatedLayer(N,P,E),e.isNone(E)||this._processOverridesFromAssociatedLayer(D,E,P,F))}}});return function(D,F,E){return w.apply(this,
arguments)}}();y.updateGeometry=function(w){this._changedObjectIds.add(w);this.notifyChange("_changedObjectIds")};y.updateAttributeValue=function(w,D,F){this._changedObjectIds.add(w);this._cacheAttributeValue(w,D,F);this.notifyChange("_changedObjectIds")};y._cacheAttributeValue=function(w,D,F){this._memCache.put(this._getAttributeCacheKey(w,D),F,this._memCacheAttributeValueSize(F))};y._getOverridesFromCache=function(w,{loadedAttributes:D,attributeData:F},E){const K=new Set,J=[];for(var M of D)J[M.index]=
F[M.name];F=new Set;for(M=0;M<w.length;M++){const N=w[M];if(E.has(N))for(const P of D){const I=this._fromCache(N,P.index);void 0!==I?J[P.index][M]=I:(K.add(N),F.add(P.name))}}return{objectIds:Array.from(K),fieldNames:Array.from(F)}};y._fromCache=function(w,D){const F=this._fromInteractiveEditingSession(w,D);if(void 0!==F)return F;w=this._getAttributeCacheKey(w,D);return this._memCache.get(w)};y._fromInteractiveEditingSession=function(w,D){if(!e.isNone(this._interactiveEditingSessions))for(const F of this._interactiveEditingSessions){if(F.objectId!==
w)continue;const E=F.get(D);if(void 0!==E)return E}};y._getAttributeCacheKey=function(w,D){return`${w}-${D}`};y._queryOverridesFromAssociatedLayer=function(){var w=c._asyncToGenerator(function*(D,F,E){if(0===D.length||0===F.length)return null;D=D.sort((M,N)=>M-N);this._warnMaximumChangedObjectsExceeded&&(this._warnMaximumChangedObjectsExceeded=!1,this._logMaximumObjectsExceededWarning());const K=this.layer.associatedLayer;if(e.isNone(K))return null;const J=K.createQuery();J.where="1\x3d1";J.returnGeometry=
!1;J.outFields=[K.objectIdField,...F];J.cacheHint=!0;J.objectIds=D;F=p.getMaximumQuerySize(K);D=D.length>F?r.splitIntoChunks(D,F).map(M=>{const N=J.clone();N.objectIds=M;return m.resultOrAbort(p.queryAllJSON(K,N,{signal:E}))}):[m.resultOrAbort(p.queryAllJSON(K,J,{signal:E}))];return(yield Promise.all(D)).reduce((M,N)=>M.concat(N.ok?N.value.features:[]),[])});return function(D,F,E){return w.apply(this,arguments)}}();y._logMaximumObjectsExceededWarning=function(){let w=`The number of edited objects that are not yet cached in the scene service exceeds the maximum limit. Attribute changes will only be available for the first ${k.formatNumber(this._maximumNumberOfEditOVerrides)} objects. Please consider re-caching the scene service`;
const D=this.layer.portalItem;w=D&&D.loaded?w+` (${D.portal.url}/home/item.html?id=${D.id}#settings)`:w+` (${this.layer.parsedUrl.path})`;f.getLogger("esri.views.3d.layers.i3s.I3SOverrides").warn("#queryOverrides()",this.layer.title,`${w}.`)};y._processOverridesFromAssociatedLayer=function(w,D,F,{loadedAttributes:E,attributeData:K}){var J=this.layer.associatedLayer;if(!e.isNone(J)){J=J.objectIdField;var M=F.map(P=>K[P]),N=new Map(E.map(P=>[P.name,P.index]));E=F.map(P=>N.get(P));w=new Map(Array.from(w,
(P,I)=>[P,I]));for(const P of D){D=P.attributes[J];for(let I=0;I<F.length;I++){const G=E[I],H=w.get(D),L=P.attributes[F[I]];M[I][H]=L;this._cacheAttributeValue(D,G,L)}}}};y._memCacheAttributeValueSize=function(w){return"string"===typeof w?d.estimateStringByteSize(w):d.estimateNumberByteSize()};y._fetchChangedObjectIds=function(){var w=c._asyncToGenerator(function*(D){var F=this.layer;yield F.load({signal:D});this._changedObjectIds.clear();if(!e.isNone(F.associatedLayer)&&F.associatedLayer.capabilities?.operations?.supportsChangeTracking){var E=
this._getFetchChangedObjectIdsServerGen();if(!e.isNone(E)){var K=F.associatedLayer.layerId,J=e.isSome(F.associatedLayer.infoFor3D);D=yield m.result(t(`${F.associatedLayer.url}/extractChanges`,{method:"post",query:{f:"json",returnIdsOnly:!0,layers:`[${K}]`,returnUpdates:!0,returnDeletes:J,returnInserts:J,layerServerGens:JSON.stringify([{id:K,serverGen:E}])},timeout:1E4,signal:D}));if(D.ok&&D.value.data?.edits&&1===D.value.data.edits.length)for(E=D.value.data.edits[0],D=e.get(E,"objectIds","adds"),
F=e.get(E,"objectIds","updates"),K=e.get(E,"objectIds","deletes"),E=[],e.isSome(D)&&(E=E.concat(D)),e.isSome(F)&&(E=E.concat(F)),e.isSome(K)&&(E=E.concat(K)),D=Math.min(this._maximumNumberOfEditOVerrides,E.length),D<E.length&&(this._warnMaximumChangedObjectsExceeded=!0),F=E.sort((M,N)=>M-N),E=0;E<D;E++)this._changedObjectIds.add(F[E]);this.notifyChange("_changedObjectIds")}}});return function(D){return w.apply(this,arguments)}}();y._getFetchChangedObjectIdsServerGen=function(){var w=this.layer;if(e.isSome(w.serviceUpdateTimeStamp)&&
e.isSome(w.serviceUpdateTimeStamp.lastUpdate))return w.serviceUpdateTimeStamp.lastUpdate;w=w.associatedLayer;return e.isSome(w)&&e.isSome(w.serverGens)&&e.isSome(w.serverGens.minServerGen)?w.serverGens.minServerGen:null};c._createClass(u,[{key:"is3DOFL",get:function(){return z.sceneLayerEditingEnabled()&&e.isSome(this._associatedLayer)&&e.isSome(this._associatedLayer.infoFor3D)}},{key:"geometryChangedObjectIds",get:function(){return this.is3DOFL?[...this._changedObjectIds]:[]}},{key:"_associatedLayer",
get:function(){return null==this.layer?null:this.layer.associatedLayer}},{key:"_definitionExpression",get:function(){const w=this.geometryChangedObjectIds;return 0===w.length?"1 \x3d 0":`OBJECTID IN (${w.join(",")})`}},{key:"updating",get:function(){return this.is3DOFL&&z.enableDirect3DObjectFeatureLayerDisplay()?!e.isSome(this._associatedLayerView)||e.isSome(this._associatedLayerView)&&this._associatedLayerView.updating:!1}},{key:"isEmpty",get:function(){return null==this._pendingFetchChangedObjectIds&&
0===this._changedObjectIds.size}},{key:"test",get:function(){const w=this;return{changedObjectIds:Array.from(this._changedObjectIds),pendingFetchChangedObjectIds:this._pendingFetchChangedObjectIds,get maximumNumberOfEditOVerrides(){return w._maximumNumberOfEditOVerrides},set maximumNumberOfEditOVerrides(D){w._maximumNumberOfEditOVerrides=D}}}}]);return u}(n);b.__decorate([l.property({constructOnly:!0})],a.I3SOverrides.prototype,"view",void 0);b.__decorate([l.property({constructOnly:!0})],a.I3SOverrides.prototype,
"layer",void 0);b.__decorate([l.property({readOnly:!0})],a.I3SOverrides.prototype,"is3DOFL",null);b.__decorate([l.property({readOnly:!0})],a.I3SOverrides.prototype,"geometryChangedObjectIds",null);b.__decorate([l.property()],a.I3SOverrides.prototype,"_associatedLayer",null);b.__decorate([l.property()],a.I3SOverrides.prototype,"_associatedLayerView",void 0);b.__decorate([l.property({constructOnly:!0})],a.I3SOverrides.prototype,"memoryController",void 0);b.__decorate([l.property()],a.I3SOverrides.prototype,
"_changedObjectIds",void 0);b.__decorate([l.property()],a.I3SOverrides.prototype,"_pendingFetchChangedObjectIds",void 0);b.__decorate([l.property()],a.I3SOverrides.prototype,"_definitionExpression",null);b.__decorate([l.property()],a.I3SOverrides.prototype,"updating",null);b.__decorate([l.property()],a.I3SOverrides.prototype,"isEmpty",null);a.I3SOverrides=b.__decorate([q.subclass("esri.views.3d.layers.i3s.I3SOverrides")],a.I3SOverrides);let B=function(){function x(y,w){this.objectId=y;this._options=
w;this._updates=new Map;this._state=A.ACTIVE}var u=x.prototype;u.get=function(y){return this._updates.get(y)};u.set=function(y,w){this._isActive&&this._updates.set(y,w)};u.rollback=function(){this._isActive&&(this._state=A.ROLLED_BACK,this._options.rollback())};u.commit=function(){this._isActive&&(this._state=A.COMMITTED,this._options.commit(this._updates),this._updates.clear())};c._createClass(x,[{key:"_isActive",get:function(){return this._state===A.ACTIVE}}]);return x}();var A;(function(x){x[x.ACTIVE=
0]="ACTIVE";x[x.COMMITTED=1]="COMMITTED";x[x.ROLLED_BACK=2]="ROLLED_BACK"})(A||(A={}));Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/featureQueryAll":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../rest/support/Query"],function(a,c,b,t){function n(){n=c._asyncToGenerator(function*(f,e,g){e=e.clone();f.capabilities.query.supportsMaxRecordCountFactor&&(e.maxRecordCountFactor=d(f));const h=r(f),l=f.capabilities.query.supportsPagination;
e.start=0;e.num=h;let v=null;for(;;){const q=yield f.source.queryFeaturesJSON(e,g);b.isNone(v)?v=q:v.features=v.features.concat(q.features);v.exceededTransferLimit=q.exceededTransferLimit;if(!l||!q.exceededTransferLimit)break;e.start+=h}return v});return n.apply(this,arguments)}function r(f){return d(f)*m(f)}function m(f){return f.capabilities.query.maxRecordCount||2E3}function d(f){return f.capabilities.query.supportsMaxRecordCountFactor?t.MAX_MAX_RECORD_COUNT_FACTOR:1}a.getMaxRecordCountFactor=
d;a.getMaximumQuerySize=r;a.getMaximumRecordCount=m;a.queryAllJSON=function(f,e,g){return n.apply(this,arguments)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/byteSizeEstimations ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils".split(" "),function(a,c,b,t,n,r){function m(e){return new Promise((g,h)=>{e.oncomplete=()=>g();e.onerror=
()=>h(e.error);e.onabort=()=>h(e.error)})}function d(e){return new Promise((g,h)=>{"done"===e.readyState?null!=e.error?h(e.error):g(e.result):(e.onsuccess=()=>g(e.result),e.onerror=()=>h(e.error))})}let f=function(){function e(h,l,v=14){this._version=v;this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=b.ByteSizeUnit.GIGABYTES;this.quotaReductionFactor=.2;this._dbName=h;this._storeName=l}var g=e.prototype;g.init=
function(){return Promise.resolve().then(()=>{const h=indexedDB.open(this._dbName,this._version);h.onupgradeneeded=l=>{var v=h.result;const q=h.transaction,k=v.objectStoreNames.contains(this._storeName)?q.objectStore(this._storeName):v.createObjectStore(this._storeName);v=v.objectStoreNames.contains("last_access")?q.objectStore("last_access"):v.createObjectStore("last_access");v.indexNames.contains("date")||v.createIndex("date","date",{unique:!1});v.indexNames.contains("byteSize")||v.createIndex("byteSize",
"byteSize",{unique:!1});l.oldVersion<this._version&&(k.clear(),v.clear())};return d(h)}).then(h=>{this._destroyed?h.close():this._db=h})};g.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};g.getHitRate=function(){return this._hit/(this._hit+this._miss)};g.put=function(h,l){return null==this._db?Promise.reject(new t("indexedb:not-initialized","IndexedDB Cache is not initialized")):(null!=this._quotaReductionPromise?this._quotaReductionPromise:Promise.resolve()).then(()=>
this._put(h,l)).catch(v=>{if(v&&"QuotaExceededError"===v.name)return null==this._quotaReductionPromise&&(this._quotaReductionPromise=this._getCacheSize().then(q=>this._removeLeastRecentlyAccessed(l.byteSize+Math.ceil(q*this.quotaReductionFactor))),this._quotaReductionPromise.then(()=>this._quotaReductionPromise=null,()=>this._quotaReductionPromise=null)),this._quotaReductionPromise.then(()=>this._put(h,l));throw v;}).then(()=>{this._gcCounter--;0>this._gcCounter&&null!=this._db&&(this._gcCounter=
this.gcFrequency,this._getCacheSize().then(v=>this._removeLeastRecentlyAccessed(v-this.maxByteSize)))})};g.get=function(h,l){const v=this._db;if(null==v)return Promise.resolve(void 0);let q=null;return Promise.resolve().then(()=>{const k=v.transaction(this._storeName,"readonly");q=r.onAbort(l,()=>{k.abort()});const p=k.objectStore(this._storeName).get(h);return d(p)}).then(k=>{null==k?++this._miss:this._db&&(++this._hit,this._db.transaction("last_access","readwrite").objectStore("last_access").put({date:Date.now(),
byteSize:k.byteSize},h));n.isSome(q)&&q.remove();return k}).catch(()=>{++this._miss;r.throwIfAborted(l);n.isSome(q)&&q.remove()})};g.remove=function(h){var l=this;const v=this._db;return null==v?Promise.resolve():Promise.resolve().then(c._asyncToGenerator(function*(){const q=v.transaction([l._storeName,"last_access"],"readwrite");var k=q.objectStore(l._storeName),p=q.objectStore("last_access");k=k.delete(h);p=p.delete(h);yield Promise.all([d(k),d(p),m(q)])}))};g._put=function(h,l){var v=this._db;
if(null==v)return Promise.resolve();v=v.transaction([this._storeName,"last_access"],"readwrite");var q=v.objectStore(this._storeName);const k=v.objectStore("last_access");q=q.put(l,h);h=k.put({date:Date.now(),byteSize:l.byteSize},h);return Promise.all([d(q),d(h),m(v)])};g._removeLeastRecentlyAccessed=function(h){if(0>=h||!this._db)return Promise.resolve();const l=this._db.transaction([this._storeName,"last_access"],"readwrite"),v=l.objectStore(this._storeName),q=l.objectStore("last_access");let k=
0;const p=q.index("date").openCursor(null,"next");p.onsuccess=()=>{const z=p.result;null!=z&&(null!=z.value.byteSize&&(k+=z.value.byteSize),v.delete(z.primaryKey),q.delete(z.primaryKey),k<h&&z.continue())};return m(l)};g._getCacheSize=function(){var h=this._db;if(null==h)return Promise.resolve(0);h=h.transaction("last_access");let l=0;const v=h.objectStore("last_access").index("byteSize").openKeyCursor();v.onsuccess=()=>{const q=v.result;if(q){var k=q.key;null!=k&&(l+=k);q.continue()}};return m(h).then(()=>
l)};c._createClass(e,[{key:"initialized",get:function(){return null!=this._db}}]);return e}();a.IDBCache=f;a.whenRequest=d;a.whenTransaction=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/IDBMockCache":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,c){let b=function(){function t(){this._data=new Map;this._hit=this._miss=0;this.initialized=!0}var n=t.prototype;n.init=function(){return Promise.resolve()};n.get=function(){var r=
c._asyncToGenerator(function*(m,d){if(this._data.has(m))return this._hit++,this._data.get(m)??void 0;this._miss++});return function(m,d){return r.apply(this,arguments)}}();n.destroy=function(){};n.put=function(r,m){this._data.set(r,m);return Promise.resolve()};n.remove=function(r){this._data.delete(r);return Promise.resolve()};n.getHitRate=function(){return this._hit/(this._hit+this._miss)};return t}();a.IDBMockCache=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/attributeEditing":function(){define(["exports",
"../../../../core/lang","../../../../core/maybe","../support/attributeUtils"],function(a,c,b,t){function n(g,h){const l=h.edits.updateFeatures;if(!l||0===l.length)return new e;const v=r(h),q=new e;h=new Map;for(let C=0;C<g.attributeStorageInfo.length;C++)h.set(g.attributeStorageInfo[C].name,C);const k=g.fieldsIndex,p=g.objectIdField,z=l.filter(C=>{C=t.attributeLookup(k,C.attributes,p);return v.has(C)});g.forEachNode((C,B)=>{const A=new Set(B);for(const D of z){const F=t.attributeLookup(k,D.attributes,
p);if(!A.has(F))continue;const E=B.indexOf(F);for(const K in D.attributes){var x=g.fieldsIndex.normalizeFieldName(K);var u=q;var y=C.index,w=u.get(y);w?u=w:(w=new f,u.set(y,w),u=w);(y=null!=x&&u.get(x))?x=y:(y=[],u.set(x,y),x=y);x.push({featureIndex:E,featureId:F,value:D.attributes[K]})}}});return q}function r(g){const h=new Set;if(!g.updatedFeatures)return h;for(const l of g.updatedFeatures)null!=l.objectId&&null==l.error&&h.add(l.objectId);return h}const m={setAttribute(){},rollback(){},commit(){}};
var d;(function(g){g[g.EDITING=0]="EDITING";g[g.ROLLED_BACK=1]="ROLLED_BACK";g[g.COMMITTED=2]="COMMITTED"})(d||(d={}));const f=Map,e=Map;a.createInteractiveEditSession=function(g,h){const l=h.attributes[g.objectIdField];var v=g.sessions.get(l);if(v)return v;const q=c.clone(h.attributes),k=new Set;if(null==l)return m;const p=g.i3sOverrides.createInteractiveEditSession(l),z=new Map;let C=d.EDITING;v={setAttribute(B,A){if(C===d.EDITING){var x=g.fieldsIndex.get(B);if(!b.isNone(x)){var u=g.attributeStorageInfo.findIndex(D=>
D.name===x.name);if(!(0>u)){p.set(u,A);var y=g.attributeStorageInfo[u],w=!1;k.add(B);g.forEachNode((D,F)=>{var E=z.get(D);null==E?(F=F.indexOf(l),z.set(D,F)):F=E;if(-1!==F&&(E=g.getAttributeData(D.index))){const K=E[y.name];K&&(K[F]=A,g.setAttributeData(D.index,E,h),w=!0)}});w&&g.clearMemCache()}}}},rollback(){if(C===d.EDITING){for(const B of k)this.setAttribute(B,q[B]);p.rollback();C=d.ROLLED_BACK;g.sessions.delete(l)}},commit(){C===d.EDITING&&(p.commit(),C=d.COMMITTED,g.sessions.delete(l))}};g.sessions.set(l,
v);return v};a.processAttributeEdits=function(g,h){h=n(g,h);if(0!==h.size){var l=new Map;for(let q=0;q<g.attributeStorageInfo.length;q++)l.set(g.attributeStorageInfo[q].name,q);var v=!1;h.forEach((q,k)=>{const p=g.getAttributeData(k);let z=!1;q.forEach((C,B)=>{const A=b.isSome(p)?p[B]:null;B=l.get(B);for(const {featureIndex:x,value:u,featureId:y}of C)A&&(A[x]=u,v=z=!0),g.i3sOverrides.updateAttributeValue(y,B,u)});z&&g.setAttributeData(k,p,null)});v&&g.clearMemCache()}};a.processGeometryEdits=function(g,
h){h=[...h.addedFeatures,...h.updatedFeatures,...h.deletedFeatures];for(const l of h)l.objectId&&g.i3sOverrides.updateGeometry(l.objectId)};Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SMeshViewFilter":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/maybeUpdating ../../../../core/reactiveUtils ../../../../core/unitUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../core/sql/WhereClause ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/Ellipsoid ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/support/webMercatorUtils ../../../../layers/support/FeatureFilter ./I3SUtil ../../webgl-engine/lib/DoubleArray ../../../../geometry/SpatialReference".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E){function K(aa,X,W){if(e.isNone(X))return null;if("disjoint"===W&&"polygon"===X.type){W=X.rings.length;const T=X.spatialReference,U=Array(W);for(let da=0;da<W;++da){const ea=A.fromValues(Infinity,Infinity,-Infinity,-Infinity);A.expandWithNestedArray(ea,X.rings[da]);U[da]={type:"polygon",rings:[X.rings[da]],spatialReference:T,cache:{},aabr:ea}}U.sort((da,ea)=>da.aabr[0]-ea.aabr[0]);const Y=new Set,ba=new m.PositionHint;for(X=0;X<U.length;++X){const da=
U[X],ea=da.aabr[0];Y.forEach(ca=>{ea>=ca.aabr[2]?Y.delete(ca):da.aabr[1]>ca.aabr[3]||da.aabr[3]<ca.aabr[1]||!aa.intersects(da,ca)||(da.rings=da.rings.concat(ca.rings),A.expand(da.aabr,ca.aabr,da.aabr),da.cache={},Y.delete(ca),ca=m.indexOf(U,ca,U.length,ba),U.splice(ca,1))});Y.add(da)}for(const da of U)da.aabr=void 0;return U}return[X]}function J(aa,X,W,T,U){const Y=P(aa,X,T);return W.every(ba=>I(aa,ba,Y,U)!==R.DISCARD)}function M(aa,X,W,T,U,Y,ba,da){const ea=ba[0].spatialReference||U.spatialReference;
if(C.projectBoundingSphere(W.node.mbs,Y,Q,ea)){Y=P(aa,Q,ea);var ca=N(da,U,ea,T,W.objectHandle);for(const ja of ba){if(0===X.length)break;switch(I(aa,ja,Y,da)){case R.DISCARD:X.length=0;return;case R.KEEP:continue}D.filterInPlace(X,W.featureIds,ia=>L(aa,ja,ia,ca))}}else O.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter")}function N(aa,X,W,T,U){X=X.renderSpatialReference;const Y=new Map,ba={type:"polygon",rings:[[[0,0,0],[0,0,0],[0,0,0],[0,0,
0]]],spatialReference:W};ba.rings[0][3]=ba.rings[0][0];let da,ea;switch(aa){case "intersects":da=(ca,ja,ia)=>ca.intersects(ja,ia)?R.KEEP:R.TEST;ea=G;break;case "contains":da=(ca,ja,ia)=>ca.contains(ja,ia)?R.TEST:R.DISCARD;ea=G;break;default:da=(ca,ja,ia)=>ca.disjoint(ja,ia)?R.TEST:R.DISCARD,ea=H}return{collection:T,object:U,type:aa,maskSR:W,renderSR:X,aabbCache:Y,triangle:ba,positions:{indices:null,data:null,stride:0,startIndex:0,endIndex:0},triangleTest:da,geometryTest:ea}}function P(aa,X,W){const T=
{type:"point",x:X[0],y:X[1],hasZ:!1,hasM:!1,spatialReference:W};W=!u.isWGS84(W)&&!u.isWebMercator(W);X=Number.isNaN(X[3])?0:f.clamp(X[3],0,2*x.earth.radius);aa=W?aa.buffer(T,X,1):aa.geodesicBuffer(T,X,1);aa.type="polygon";return aa}function I(aa,X,W,T){switch(T){case "intersects":case "contains":return G(aa,X,W);case "disjoint":return H(aa,X,W)}}function G(aa,X,W){return aa.intersects(X,W)?aa.contains(X,W)?R.KEEP:R.TEST:R.DISCARD}function H(aa,X,W){return aa.intersects(X,W)?aa.contains(X,W)?R.DISCARD:
R.TEST:R.KEEP}function L(aa,X,W,T){const {collection:U,object:Y,renderSR:ba,maskSR:da,geometryTest:ea,aabbCache:ca}=T;var ja=ca.get(W);if(!ja){ja=U.getObjectTransform(Y);U.getComponentAabb(Y,W,V);var ia=[[V[0],V[1],0],[V[0],V[4],0],[V[3],V[4],0],[V[3],V[1],0]];for(var Z=0;4>Z;++Z)p.transformMat3(ia[Z],ia[Z],ja.rotationScale),p.add(ia[Z],ia[Z],ja.position),C.projectVectorToVector(ia[Z],ba,ia[Z],da);ja={type:"polygon",rings:[ia],spatialReference:da,cache:{}};ja.rings[0][4]=ja.rings[0][0];ca.set(W,ja)}switch(ea(aa,
X,ja)){case R.DISCARD:return!1;case R.KEEP:return!0}const {triangle:ha,triangleTest:fa,positions:ka}=T;ja=ha.rings[0][0];ia=ha.rings[0][1];Z=ha.rings[0][2];const la=U.getObjectTransform(Y);U.getComponentPositions(Y,W,ka);const {indices:na,data:pa,stride:va,startIndex:wa,endIndex:za}=ka;for(W=wa;W<za;W+=3){const sa=va*na[W+0],ua=va*na[W+1],oa=va*na[W+2];p.set(ja,pa[sa+0],pa[sa+1],pa[sa+2]);p.set(ia,pa[ua+0],pa[ua+1],pa[ua+2]);p.set(Z,pa[oa+0],pa[oa+1],pa[oa+2]);p.transformMat3(ja,ja,la.rotationScale);
p.transformMat3(ia,ia,la.rotationScale);p.transformMat3(Z,Z,la.rotationScale);p.add(ja,ja,la.position);p.add(ia,ia,la.position);p.add(Z,Z,la.position);C.projectVectorToVector(ja,ba,ja,da);C.projectVectorToVector(ia,ba,ia,da);C.projectVectorToVector(Z,ba,Z,da);switch(fa(aa,X,ha)){case R.DISCARD:return!1;case R.KEEP:return!0}}switch(T.type){case "intersects":return!1;default:return!0}}const O=d.getLogger("esri.views.3d.layers.i3s.I3SMeshViewFilter");c.I3SMeshViewFilter=function(aa){function X(T){T=
aa.call(this,T)||this;T._projectionEngineLoaded=!1;return T}b._inheritsLoose(X,aa);var W=X.prototype;W.initialize=function(){h.whenOnce(()=>e.unwrap(this.viewFilter)?.geometry||e.isSome(this.layerFilter)).then(()=>this.loadAsyncModule((new Promise((T,U)=>a(["../../../../geometry/geometryEngine"],T,U))).then(T=>{this.destroyed||(this._geometryEngine=T)})))};W.addFilters=function(T,U,Y,ba){const da=this.sortedObjectIds;e.isSome(da)&&T.push(ia=>D.objectIdFilter(da,!0,ia));this.addSqlFilter(T,this.parsedWhereClause);
const ea=g.unwrapUpdating(this._layerMaskGeometries),ca=this._geometryEngine;if(e.isSome(ea)&&e.isSome(this.layerFilter)&&e.isSome(ca)){const ia=this.layerFilter.spatialRelationship;T.push((Z,ha)=>M(ca,Z,ha,ba,U,Y,ea,ia))}const ja=g.unwrapUpdating(this._viewMaskGeometries);if(e.isSome(ja)&&e.isSome(this.viewFilter)&&e.isSome(ca)){const ia=this.viewFilter.spatialRelationship;T.push((Z,ha)=>M(ca,Z,ha,ba,U,Y,ja,ia))}};W.isMBSGeometryVisible=function(T,U,Y){var ba=g.unwrapUpdating(this._layerMaskGeometries);
const da=this._geometryEngine;if(e.isSome(ba)&&e.isSome(this.layerFilter)&&e.isSome(da)){var ea=this.layerFilter.spatialRelationship;U=ba[0].spatialReference||U;return C.projectBoundingSphere(T,Y,Q,U)?J(da,Q,ba,U,ea):(O.warnOnce("SceneLayer.mask geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)}ba=g.unwrapUpdating(this._viewMaskGeometries);return e.isSome(ba)&&e.isSome(this.viewFilter)&&e.isSome(da)?(ea=this.viewFilter.spatialRelationship,U=ba[0].spatialReference||
U,C.projectBoundingSphere(T,Y,Q,U)?J(da,Q,ba,U,ea):(O.warnOnce("SceneLayerView.filter.geometry is using unsupported SpatialReference, skipping geometry filter for MBS"),!0)):!0};X.checkSupport=function(T){if(e.isNone(T))return!1;if(T.timeExtent)return O.warn("Filters with a timeExtent are not supported for mesh scene layers"),!1;T=T.spatialRelationship;return null!=T&&S.includes(T)?!0:(O.warn(`Filters with spatialRelationship other than ${S.join(", ")} are not supported for mesh scene layers`),!1)};
b._createClass(X,[{key:"sortedObjectIds",get:function(){if(e.isNone(this.viewFilter)||e.isNone(this.viewFilter.objectIds))return null;const T=F.doubleArrayFrom(this.viewFilter.objectIds);T.sort();return T}},{key:"parsedWhereClause",get:function(){const T=e.isSome(this.viewFilter)?this.viewFilter.where:null;if(e.isNone(T)||!T)return null;try{return z.WhereClause.create(T,this.layerFieldsIndex)}catch(U){O.error(`Failed to parse filter where clause: ${U}`)}return null}},{key:"parsedGeometry",get:function(){const T=
g.unwrapUpdating(this._viewMaskGeometries),U=g.unwrapUpdating(this._layerMaskGeometries);return e.isNone(T)||e.isNone(U)?T||U:U.concat(T)}},{key:"_layerMaskGeometries",get:function(){const T=this.layerFilter;return e.isNone(T)?null:e.isNone(this._geometryEngine)?g.updating:"disjoint"===T.spatialRelationship?T.geometries.map(U=>({type:"polygon",rings:U.rings,spatialReference:U.spatialReference,cache:{}})):[T.geometries.reduce((U,Y)=>{U.rings=[...U.rings,...Y.rings];return U},{type:"polygon",rings:[],
spatialReference:T.geometries[0].spatialReference,cache:{}})]}},{key:"_viewMaskGeometries",get:function(){if(e.isNone(this.viewFilter))return null;var {geometry:T}=this.viewFilter;if(e.isNone(T))return null;if(e.isNone(this.viewFilter)||e.isNone(this._geometryEngine))return g.updating;const {distance:U,units:Y}=this.viewFilter,ba=this.viewFilter.spatialRelationship;T="mesh"===T.type?T.extent:T;if(e.isNone(U)||0===U)return K(this._geometryEngine,T,ba);const da=Y||l.getUnitString(T.spatialReference);
if(T.spatialReference.isWGS84)return T=this._geometryEngine.geodesicBuffer(T,U,da),K(this._geometryEngine,T,ba);var ea=y.project(T,E.WGS84);if(e.isSome(ea))return T=y.project(this._geometryEngine.geodesicBuffer(ea,U,da),T.spatialReference),K(this._geometryEngine,T,ba);if(!this._projectionEngineLoaded&&(this.loadAsyncModule(C.load().then(()=>this._projectionEngineLoaded=!0)),!this._projectionEngineLoaded))return null;ea=null;try{ea=C.project(T,E.WGS84)}catch(ca){}if(ea)try{ea=C.project(this._geometryEngine.geodesicBuffer(ea,
U,da),T.spatialReference)}catch(ca){ea=null}ea||O.error(`Filter by geodesic buffer (distance) unsupported, failed to project input geometry (${T.spatialReference.wkid}) to WGS84.`);return K(this._geometryEngine,ea,ba)}},{key:"updating",get:function(){return g.isUpdating(this._layerMaskGeometries)||g.isUpdating(this._viewMaskGeometries)}}]);return X}(r);t.__decorate([v.property()],c.I3SMeshViewFilter.prototype,"layerFilter",void 0);t.__decorate([v.property({type:w})],c.I3SMeshViewFilter.prototype,
"viewFilter",void 0);t.__decorate([v.property()],c.I3SMeshViewFilter.prototype,"layerFieldsIndex",void 0);t.__decorate([v.property()],c.I3SMeshViewFilter.prototype,"loadAsyncModule",void 0);t.__decorate([v.property()],c.I3SMeshViewFilter.prototype,"addSqlFilter",void 0);t.__decorate([v.property({readOnly:!0})],c.I3SMeshViewFilter.prototype,"sortedObjectIds",null);t.__decorate([v.property({readOnly:!0})],c.I3SMeshViewFilter.prototype,"parsedWhereClause",null);t.__decorate([v.property({readOnly:!0})],
c.I3SMeshViewFilter.prototype,"parsedGeometry",null);t.__decorate([v.property({readOnly:!0})],c.I3SMeshViewFilter.prototype,"_layerMaskGeometries",null);t.__decorate([v.property({readOnly:!0})],c.I3SMeshViewFilter.prototype,"_viewMaskGeometries",null);t.__decorate([v.property()],c.I3SMeshViewFilter.prototype,"updating",null);t.__decorate([v.property()],c.I3SMeshViewFilter.prototype,"_projectionEngineLoaded",void 0);t.__decorate([v.property()],c.I3SMeshViewFilter.prototype,"_geometryEngine",void 0);
c.I3SMeshViewFilter=t.__decorate([k.subclass("esri.views.3d.layers.i3s.I3SMeshViewFilter")],c.I3SMeshViewFilter);const S=["contains","intersects","disjoint"];var R;(function(aa){aa[aa.KEEP=0]="KEEP";aa[aa.DISCARD=1]="DISCARD";aa[aa.TEST=2]="TEST"})(R||(R={}));const Q=[0,0,0,0],V=B.create();Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})})},"esri/core/maybeUpdating":function(){define(["exports"],function(a){a.isUpdating=function(c){return"updating"===c};a.unwrapUpdating=function(c){return"updating"===
c?null:c};a.updating="updating";Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Error ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/LayerConstants ../../../../layers/graphics/data/QueryEngine ../../../../rest/support/FeatureSet ../../../../rest/support/Query".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k){const p=v.QueryEngine;a.I3SQueryEngine=function(z){function C(A){A=z.call(this,A)||this;A._handles=new r;return A}c._inheritsLoose(C,z);var B=C.prototype;B.initialize=function(){this._handles.add(this.layerView.on("visible-geometry-changed",()=>this.spatialIndex.events.emit("changed")))};B.destroy=function(){this._dataQueryEngineInstance=m.destroyMaybe(this._dataQueryEngineInstance);this._handles=m.destroyMaybe(this._handles);this._set("layerView",null)};
B.executeQueryForCount=function(){var A=c._asyncToGenerator(function*(x,u){return this._dataQueryEngine.executeQueryForCount(this._ensureQueryJSON(x),u)});return function(x,u){return A.apply(this,arguments)}}();B.executeQueryForExtent=function(){var A=c._asyncToGenerator(function*(x,u){const {count:y,extent:w}=yield this._dataQueryEngine.executeQueryForExtent(this._ensureQueryJSON(x),u);x=h.fromJSON(w);return{count:y,extent:x}});return function(x,u){return A.apply(this,arguments)}}();B.executeQueryForIds=
function(){var A=c._asyncToGenerator(function*(x,u){return this._dataQueryEngine.executeQueryForIds(this._ensureQueryJSON(x),u)});return function(x,u){return A.apply(this,arguments)}}();B.executeQuery=function(){var A=c._asyncToGenerator(function*(x,u){x=this._ensureQueryJSON(x);if(x.returnGeometry)throw new n("feature-store:unsupported-query","returnGeometry is not yet supported for mesh scene layer queries");if(x.returnCentroid)throw new n("feature-store:unsupported-query","returnCentroid is not yet supported for mesh scene layer queries");
u=yield this._dataQueryEngine.executeQuery(x,u);u=q.fromJSON(u);u.features.forEach(y=>{y.geometry=null});return u});return function(x,u){return A.apply(this,arguments)}}();B._ensureQueryJSON=function(A){return m.isNone(A)?this.defaultQueryJSON:A.toJSON()};B._ensureDataQueryEngine=function(){if(this._dataQueryEngineInstance)return this._dataQueryEngineInstance;const A=this.layer.objectIdField||l.fallbackObjectIDAttribute,x=this.layer.fields?.map(w=>w.toJSON())??[],u=this.layerView.view.resourceController.scheduler,
y=this.spatialReference.toJSON();return this._dataQueryEngineInstance=new p({hasZ:!0,hasM:!1,geometryType:"esriGeometryPolygon",fields:x,timeInfo:null,spatialReference:y,objectIdField:A,featureStore:this.spatialIndex,scheduler:u,priority:this.priority})};c._createClass(C,[{key:"spatialReference",get:function(){return this.layerView.view.spatialReference}},{key:"layer",get:function(){return this.layerView.i3slayer}},{key:"defaultQueryJSON",get:function(){return(new k({outSpatialReference:this.spatialReference})).toJSON()}},
{key:"_dataQueryEngine",get:function(){return this._ensureDataQueryEngine()}}]);return C}(t);b.__decorate([d.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"layerView",void 0);b.__decorate([d.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"priority",void 0);b.__decorate([d.property({constructOnly:!0})],a.I3SQueryEngine.prototype,"spatialIndex",void 0);b.__decorate([d.property()],a.I3SQueryEngine.prototype,"spatialReference",null);b.__decorate([d.property()],a.I3SQueryEngine.prototype,
"layer",null);b.__decorate([d.property()],a.I3SQueryEngine.prototype,"defaultQueryJSON",null);a.I3SQueryEngine=b.__decorate([g.subclass("esri.views.3d.layers.i3s.I3SQueryEngine")],a.I3SQueryEngine);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureAdapter":function(){define("exports ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/centroid ../../../../layers/graphics/OptimizedGeometry ./I3SUtil".split(" "),
function(a,c,b,t,n,r){let m=function(){function f(g){this._objectIdField=g.objectIdField;this._getFeatureExtent=g.getFeatureExtent}var e=f.prototype;e.getObjectId=function(g){return g.id};e.getAttributes=function(g){const {meta:h,index:l}=g,v={};this._objectIdField&&(v[this._objectIdField]=g.id);g=c.isSome(h.attributeInfo)&&h.attributeInfo.attributeData;if(c.isSome(g))for(const q of Object.keys(g))v[q]=r.getCachedAttributeValue(g[q],l);return v};e.getAttribute=function(g,h){if(h===this._objectIdField)return g.id;
const {meta:l,index:v}=g;g=c.isSome(l.attributeInfo)&&l.attributeInfo.attributeData;return c.isSome(g)?r.getCachedAttributeValue(g[h],v):null};e.getGeometry=function(g){if(g.geometry)return g.geometry;const [h,l,v,q,k]=this._getFeatureExtent(g,d);return new n([5],[h,l,v,q,l,v,q,k,v,h,k,v,h,l,v])};e.getCentroid=function(g,h){if(g.geometry)return t.getCentroidOptimizedGeometry(new n,g.geometry,h.hasZ,h.hasM);const [l,v,q,k,p,z]=this._getFeatureExtent(g,d);return new n([0],[(l+k)/2,(v+p)/2,(q+z)/2])};
e.cloneWithGeometry=function(g,h){const {id:l,index:v,meta:q}=g;return{id:l,index:v,meta:q,geometry:h}};return f}();const d=b.create();a.I3SQueryFeatureAdapter=m;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SQueryFeatureStore":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../II3SMeshView3D".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v){const q=h.create();a.I3SQueryFeatureStore=function(C){function B(x){x=C.call(this,x)||this;x.events=new n;return x}c._inheritsLoose(B,C);var A=B.prototype;A.forEach=function(x){this.forAllFeatures(u=>{x(u);return v.ForAllFeaturesReturnType.CONTINUE})};A.forEachBounds=function(x,u){const y=this.getFeatureExtent;for(const w of x)u(y(w,q))};A.forEachInBounds=function(x,u){this.forAllFeatures(y=>{const w=this.getFeatureExtent(y,p);l.intersects(x,h.toRect(w,z))&&u(y);
return v.ForAllFeaturesReturnType.CONTINUE},y=>{g.projectBoundingSphere(y.node.mbs,this.sourceSpatialReference,k,this.viewSpatialReference);if(k[0]>=x[0]&&k[2]<=x[2]&&k[1]>=x[1]&&k[3]<=x[3])return v.ForAllFeaturesReturnType.CONTINUE;y=k[0]-Math.max(x[0],Math.min(k[0],x[2]));const w=k[1]-Math.max(x[1],Math.min(k[1],x[3]));return y*y+w*w<=k[3]*k[3]?v.ForAllFeaturesReturnType.CONTINUE:v.ForAllFeaturesReturnType.SKIP})};return B}(t);b.__decorate([r.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,
"featureAdapter",void 0);b.__decorate([r.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"forAllFeatures",void 0);b.__decorate([r.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"getFeatureExtent",void 0);b.__decorate([r.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"sourceSpatialReference",void 0);b.__decorate([r.property({constructOnly:!0})],a.I3SQueryFeatureStore.prototype,"viewSpatialReference",void 0);a.I3SQueryFeatureStore=b.__decorate([f.subclass("esri.views.3d.layers.i3s.I3SQueryFeatureStore")],
a.I3SQueryFeatureStore);const k=e.create(),p=h.create(),z=l.create();Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/DefinitionExpressionSceneLayerView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../core/sql/WhereClause ../i3s/I3SUtil".split(" "),
function(a,c,b,t,n,r,m,d,f,e){a.DefinitionExpressionSceneLayerView=g=>{g=function(h){function l(){var q=h.apply(this,arguments)||this;q._definitionExpressionErrors=0;q._maxDefinitionExpressionErrors=20;q.logError=k=>{q._definitionExpressionErrors<q._maxDefinitionExpressionErrors&&t.getLogger(q.declaredClass).error("Error while evaluating definitionExpression: "+k);q._definitionExpressionErrors++;q._definitionExpressionErrors===q._maxDefinitionExpressionErrors&&t.getLogger(q.declaredClass).error("Further errors are ignored")};
return q}c._inheritsLoose(l,h);var v=l.prototype;v._evaluateClause=function(q,k){try{return q.testFeature(k)}catch(p){return this.logError(p),!1}};v._addDefinitionExpressionToQuery=function(q){if(!this.parsedDefinitionExpression)return q;const k=this.i3slayer.definitionExpression;q=q.clone();q.where=q.where?`(${k}) AND (${q.where})`:k;return q};c._createClass(l,[{key:"parsedDefinitionExpression",get:function(){if(!this.i3slayer||!this.i3slayer.definitionExpression)return null;try{const q=f.WhereClause.create(this.i3slayer.definitionExpression,
this.i3slayer.fieldsIndex);if(!q.isStandardized)return t.getLogger(this.declaredClass).error("definitionExpression is using non standard function"),null;const k=[];e.findFieldsCaseInsensitive(q.fieldNames,this.i3slayer.fields,{missingFields:k});if(0<k.length)return t.getLogger(this.declaredClass).error(`definitionExpression references unknown fields: ${k.join(", ")}`),null;this._definitionExpressionErrors=0;return q}catch(q){return t.getLogger(this.declaredClass).error("Failed to parse definitionExpression: "+
q),null}}},{key:"definitionExpressionFields",get:function(){return this.parsedDefinitionExpression?this.parsedDefinitionExpression.fieldNames:[]}}]);return l}(g);b.__decorate([n.property()],g.prototype,"i3slayer",void 0);b.__decorate([n.property({readOnly:!0})],g.prototype,"parsedDefinitionExpression",null);b.__decorate([n.property({readOnly:!0})],g.prototype,"definitionExpressionFields",null);return g=b.__decorate([d.subclass("esri.views.3d.layers.support.DefinitionExpressionSceneLayerView")],g)};
Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/fieldProperties":function(){define(["exports","../../../../layers/support/fieldUtils"],function(a,c){a.defineFieldProperties=function(){return{requiredFields:{type:[String],readOnly:!0},availableFields:{type:[String],readOnly:!0,get:function(){const {layer:b,layer:{fieldsIndex:t},requiredFields:n}=this;return b.outFields?c.fixFields(t,[...c.unpackFieldNames(t,b.outFields),...n]):c.fixFields(t,n)}}}};Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/support/SceneLayerViewRequiredFields":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/AsyncUpdate ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/fieldUtils".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h){function l(q){return v.apply(this,arguments)}function v(){v=c._asyncToGenerator(function*(q){const k=new Set;try{return yield q(k),Array.from(k).sort()}catch(p){return r.getLogger("esri.views.3d.layers.support.SceneLayerViewRequiredFields").error(p),null}});return v.apply(this,arguments)}a.SceneLayerViewRequiredFields=function(q){function k(p){return q.call(this,p)||this}c._inheritsLoose(k,q);k.prototype.initialize=function(){var p=this;this.handles.add([this.autoUpdateAsync("rendererFields",
c._asyncToGenerator(function*(){const {fieldsIndex:z,renderer:C}=p.layer;return C?l(B=>C.collectRequiredFields(B,z)):null})),this.autoUpdateAsync("labelingFields",c._asyncToGenerator(function*(){const {layer:z}=p;return z.labelsVisible?l(C=>h.collectLabelingFields(C,z)):null})),this.autoUpdateAsync("viewFilterFields",()=>{const {layer:z,filter:C}=this.layerView;return l(B=>h.collectFilterFields(B,z,C))})])};c._createClass(k,[{key:"layer",get:function(){return this.layerView.layer}},{key:"requiredFields",
get:function(){const {layerView:{layer:{fieldsIndex:p},definitionExpressionFields:z},rendererFields:C,labelingFields:B,viewFilterFields:A}=this;return h.fixFields(p,[...m.unwrapOr(z,[]),...m.unwrapOr(C,[]),...m.unwrapOr(B,[]),...m.unwrapOr(A,[])])}}]);return k}(t.AsyncUpdateMixin(n.HandleOwner));b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,"layerView",void 0);b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,"layer",null);b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,
"requiredFields",null);b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,"rendererFields",void 0);b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,"labelingFields",void 0);b.__decorate([d.property()],a.SceneLayerViewRequiredFields.prototype,"viewFilterFields",void 0);a.SceneLayerViewRequiredFields=b.__decorate([g.subclass("esri.views.3d.layers.support.SceneLayerViewRequiredFields")],a.SceneLayerViewRequiredFields);Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},
"esri/core/AsyncUpdate":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ./Accessor ./Logger ./accessorSupport/tracking ./accessorSupport/decorators/property ./accessorSupport/decorators/subclass ./accessorSupport/tracking/SimpleTrackingTarget".split(" "),function(a,c,b,t,n,r,m,d,f){function e(l,v){const q=()=>{if(!k||p)return v();k.clear();p=!0;const z=r.runTracked(k,v);p=!1;return z};let k=new f.SimpleTrackingTarget(()=>{k&&!p&&l(q)}),p=!1;l(q);return{remove:()=>
{k&&(k.destroy(),k=null)}}}const g=l=>{l=function(v){function q(){var p=v.apply(this,arguments)||this;p._numUpdating=0;p._asyncUpdateState=new Map;return p}c._inheritsLoose(q,v);var k=q.prototype;k.autoUpdateAsync=function(p,z){return e(C=>this._updateAsync(p,C),z)};k._updateAsync=function(){var p=c._asyncToGenerator(function*(z,C){if(!this._startAsyncUpdate(z)){try{const B=yield C();this._set(z,B)}catch(B){n.getLogger(this.declaredClass).warn(`Async update of "${String(z)}" failed. Async update functions should not throw exceptions.`)}this._endAsyncUpdate(z)&&
this._updateAsync(z,C)}});return function(z,C){return p.apply(this,arguments)}}();k._startAsyncUpdate=function(p){const z=this._asyncUpdateState.get(p)??h.None;if(z&h.Updating)return this._asyncUpdateState.set(p,z|h.Invalidated),!0;++this._numUpdating;this._asyncUpdateState.set(p,z|h.Updating);return!1};k._endAsyncUpdate=function(p){--this._numUpdating;const z=(this._asyncUpdateState.get(p)??h.None)&~h.Updating;if(z&h.Invalidated)return this._asyncUpdateState.set(p,z&~h.Invalidated),!0;this._asyncUpdateState.set(p,
z);return!1};c._createClass(q,[{key:"updating",get:function(){return 0<this._numUpdating}}]);return q}(l);b.__decorate([m.property({readOnly:!0})],l.prototype,"updating",null);b.__decorate([m.property()],l.prototype,"_numUpdating",void 0);return l=b.__decorate([d.subclass("esri.core.AsyncUpdate")],l)};var h;(function(l){l[l.None=0]="None";l[l.Updating=1]="Updating";l[l.Invalidated=2]="Invalidated"})(h||(h={}));a.AsyncUpdate=function(l){function v(){return l.apply(this,arguments)||this}c._inheritsLoose(v,
l);return v}(g(t));a.AsyncUpdate=b.__decorate([d.subclass("esri.core.AsyncUpdate")],a.AsyncUpdate);a.AsyncUpdateMixin=g;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/SceneLayerView":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/maybe ../../core/maybeUpdating ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/projection ./LayerView".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l){const v=t.getLogger("esri.views.layers.SceneLayerView");t=function(q){function k(){var z=q.apply(this,arguments)||this;z.layer=null;z.filter=null;z._geometryEngine=null;z._projectionEngineLoaded=!1;return z}c._inheritsLoose(k,q);var p=k.prototype;p.initialize=function(){var z=this;m.whenOnce(()=>!this._geometryEngine&&n.isSome(this.layer.filter)&&this.layer.filter.geometries.length).then(c._asyncToGenerator(function*(){return z._geometryEngine=yield new Promise((C,
B)=>a(["../../geometry/geometryEngine"],C,B))}));this._projectionEngineLoaded=h.isLoaded();m.whenOnce(()=>!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine).then(c._asyncToGenerator(function*(){yield h.load();z._projectionEngineLoaded=!0}))};p.highlight=function(z){throw Error("Not implemented");};p.queryFeatures=function(z,C){throw Error("Not implemented");};p.queryObjectIds=function(z,C){throw Error("Not implemented");};p.queryFeatureCount=function(z,C){throw Error("Not implemented");
};p.createQuery=function(){throw Error("Not implemented");};p.queryExtent=function(z,C){throw Error("Not implemented");};c._createClass(k,[{key:"availableFields",get:function(){return[]}},{key:"maximumNumberOfFeatures",get:function(){return 0},set:function(z){throw Error("Not implemented");}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return!1}},{key:"layerFilter",get:function(){return r.unwrapUpdating(this._layerFilter)}},{key:"_layerFilter",get:function(){const z=this.layer.filter;if(n.isNone(z)||
1>z.geometries.length)return null;const C=this._geometryEngine;if(n.isNone(C)||!this._projectionEngineLoaded&&this._filterNeedsProjectionEngine)return r.updating;const B=z.geometries.getItemAt(0).spatialReference,A=z.geometries.toArray().map(w=>{try{w=C.simplify(w)}catch(D){return v.warnOncePerTick("Failed to simplify scene filter mask polygon. Polygon will be ignored."),null}if(null==w)return null;if(w.spatialReference.equals(B))return w;try{return h.project(w,B)}catch(D){return v.warnOncePerTick("Failed to project scene filter mask polygon. Polygon will be ignored."),
null}}).filter(n.isSome).sort((w,D)=>w.extent.xmin-D.extent.xmin),x=new Set,u=[],y=[];for(let w of A){const D=w.extent.xmin;u.length=0;x.forEach(F=>{D>=F.extent.xmax?(y.push(F),x.delete(F)):w.extent.ymin<=F.extent.ymax&&w.extent.ymax>=F.extent.ymin&&C.intersects(w,F)&&u.push(F)});if(0<u.length){u.push(w);try{w=C.union(u)}catch(F){v.warnOncePerTick("Failed to unify filter mask polygons. Polygon will be ignored.");continue}u.pop();u.forEach(F=>x.delete(F))}x.add(w)}x.forEach(w=>y.push(w));return 0<
y.length?{spatialRelationship:z.spatialRelationship,geometries:y}:null}},{key:"_filterNeedsProjectionEngine",get:function(){const z=this.layer.filter;if(n.isNone(z)||1>=z.geometries.length)return!1;const C=z.geometries.getItemAt(0).spatialReference;return z.geometries.some(({spatialReference:B})=>!B.equals(C)&&!h.canProjectWithoutEngine(B,C))}},{key:"layerFilterUpdating",get:function(){return r.isUpdating(this._layerFilter)}}]);return k}(l);b.__decorate([d.property()],t.prototype,"layer",void 0);
b.__decorate([d.property()],t.prototype,"availableFields",null);b.__decorate([d.property()],t.prototype,"maximumNumberOfFeatures",null);b.__decorate([d.property({readOnly:!0})],t.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([d.property()],t.prototype,"filter",void 0);b.__decorate([d.property({readOnly:!0})],t.prototype,"layerFilter",null);b.__decorate([d.property({readOnly:!0})],t.prototype,"_layerFilter",null);b.__decorate([d.property()],t.prototype,"_geometryEngine",void 0);b.__decorate([d.property()],
t.prototype,"_projectionEngineLoaded",void 0);b.__decorate([d.property()],t.prototype,"_filterNeedsProjectionEngine",null);b.__decorate([d.property()],t.prototype,"layerFilterUpdating",null);return t=b.__decorate([g.subclass("esri.views.layers.SceneLayerView")],t)})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/arrayUtils ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/contains ../../../geometry/support/zscale ../../../layers/LayerConstants ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/hydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../layers/support/FeatureFilter ../../../rest/support/Query ./I3SPointsWorkerHandle ./LayerView3D ./graphics/Graphics3DFeatureProcessor ./graphics/QueryEngine ./i3s/attributeEditing ./i3s/I3SGraphicsMap ./i3s/I3SOverrides ./i3s/I3SUtil ./support/DefinitionExpressionSceneLayerView ./support/fieldProperties ./support/PopupSceneLayerView ./support/SceneLayerViewRequiredFields ../support/debugFlags ../support/orientedBoundingBox ../support/updatingProperties ../webgl-engine/lib/Attribute ../webgl-engine/lib/DoubleArray ../webgl-engine/lib/UpdatePolicy ../../layers/SceneLayerView ../../support/Scheduler".split(" "),
function(a,c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V){function aa(Y){return"geometryBuffer"in Y&&null!==Y.geometryBuffer}function X(Y){const ba=Y.attributeInfo,da=Y.node.index;if(!(m.isNone(ba)||m.isNone(ba.loadedAttributes)||m.isNone(ba.attributeData)))for(let ea=0;ea<Y.graphics.length;ea++){const ca=Y.graphics[ea];if(ca.nodeIndex===da){ca.attributes||(ca.attributes={});for(const {name:ja}of ba.loadedAttributes)ba.attributeData[ja]&&(ca.attributes[ja]=J.getCachedAttributeValue(ba.attributeData[ja],
ea))}}}e=N.defineFieldProperties();y=function(Y){function ba(){var ea=Y.apply(this,arguments)||this;ea.type="scene-layer-graphics-3d";ea._queryEngine=null;ea._memCache=null;ea._interactiveEditingSessions=new Map;ea.loadedGraphics=new E.I3SGraphicsMap((ca,ja,ia)=>{{const Z=ja.attributeInfo;if(m.isNone(Z)||m.isNone(Z.loadedAttributes)||m.isNone(Z.attributeData))ca=!1;else{ja=!1;for(const {name:ha}of Z.loadedAttributes)if(Z.attributeData[ha]){const fa=J.getCachedAttributeValue(Z.attributeData[ha],ia);
fa!==ca.attributes[ha]&&(ca.attributes[ha]=fa,ja=!0)}ca=ja}}return ca},ca=>ea.processor.graphicsCore.recreateGraphics(ca));ea.holeFilling="always";ea.progressiveLoadFactor=1;ea.supportsHeightUnitConversion=!0;ea._coordinatesOutsideExtentErrors=0;ea._maxCoordinatesOutsideExtentErrors=20;return ea}c._inheritsLoose(ba,Y);var da=ba.prototype;da.tryRecycleWith=function(ea,ca){return ea.url===this.layer.url&&this._i3sOverrides.isEmpty?ea.load(ca).then(()=>{J.checkRecyclable(this.layer,ea,this._i3sOverrides);
this.layer=ea;this._i3sOverrides.destroy();this._i3sOverrides=new K.I3SOverrides({view:this.view,layer:ea,memoryController:this.view.resourceController?.memoryController});m.destroyMaybe(this._queryEngine);this._setupQueryEngine();this.processor.resetObjectStates()}):null};da.initialize=function(){this.addResolvingPromise(this.layer.indexInfo);this._i3sOverrides=new K.I3SOverrides({view:this.view,layer:this.layer,memoryController:this.view.resourceController?.memoryController});J.checkSpatialReferences(this.layer,
this.view.spatialReference,this.view.viewingMode);this._fieldsHelper=new I.SceneLayerViewRequiredFields({layerView:this});this.updatingHandles.add(()=>this.layer.rangeInfos,ea=>this._rangeInfosChanged(ea),d.initial);this.updatingHandles.add(()=>this.layer.renderer,(ea,ca)=>this._rendererChange(ea,ca));this.updatingHandles.add(()=>[this.parsedDefinitionExpression,this._excludeObjectIdsSorted],()=>this._filterChange());this.handles.add(d.watch(()=>G.I3S_TREE_SHOW_TILES,ea=>{if(ea&&!this._treeDebugger){const ca=
this._controller.crsIndex;(new Promise((ja,ia)=>a(["./support/I3STreeDebugger"],ja,ia))).then(({I3STreeDebugger:ja})=>{!this._treeDebugger&&G.I3S_TREE_SHOW_TILES&&(this._treeDebugger=new ja({lv:this,view:this.view,nodeSR:ca}))})}else ea||!this._treeDebugger||G.I3S_TREE_SHOW_TILES||(this._treeDebugger.destroy(),this._treeDebugger=null)},d.initial));this._set("processor",new w({owner:this,preferredUpdatePolicy:R.UpdatePolicy.ASYNC,scaleVisibilityEnabled:!0,filterVisibilityEnabled:!0,timeExtentEnabled:!1,
frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,setUidToIdOnAdd:!1,dataExtent:this.layer.fullExtent,updateClippingExtent:ea=>this._updateClippingExtent(ea)}));this.processor.elevationAlignment?.events.on("invalidate-elevation",ea=>this._controller.updateElevationChanged(ea.extent,ea.spatialReference));this.supportsHeightUnitConversion&&(this._verticalScale=k.getGeometryZScaler("point",this.layer.spatialReference,this.view.spatialReference));this.addResolvingPromise(this.processor.initializePromise);
this._memCache=this.view.resourceController.memoryController.newCache(this.uid);this._controller=new B({layerView:this,scaleVisibilityEnabled:!1});J.containsDraco(this.layer.geometryDefinitions)&&(this._worker=new u.I3SPointsWorkerHandle(ea=>this.view.resourceController.immediate.schedule(ea)));this.handles.add(this.layer.on("apply-edits",ea=>this.updatingHandles.addPromise(ea.result)));this.handles.add(this.layer.on("edits",ea=>this._handleEdits(ea)));this.when(()=>{this._setupQueryEngine();this.updatingHandles.add(()=>
this.maximumNumberOfFeatures,ea=>this._controller.featureTarget=ea,d.initial);this.updatingHandles.add(()=>this.suspended,ea=>{ea&&this._removeAllNodeData()})})};da.destroy=function(){this._treeDebugger=m.destroyMaybe(this._treeDebugger);this._i3sOverrides=m.destroyMaybe(this._i3sOverrides);this._set("processor",m.destroyMaybe(this.processor));this._controller=m.destroyMaybe(this._controller);this._queryEngine=m.destroyMaybe(this._queryEngine);this._worker=m.destroyMaybe(this._worker);this._memCache=
m.destroyMaybe(this._memCache);this.loadedGraphics.clear();this._fieldsHelper=m.destroyMaybe(this._fieldsHelper)};da.whenGraphicAttributes=function(){var ea=c._asyncToGenerator(function*(ca,ja){return J.whenGraphicAttributes(this.layer,ca,this._getObjectIdField(),ja,()=>[...this.loadedGraphics.nodes()])});return function(ca,ja){return ea.apply(this,arguments)}}();da.getHit=function(ea){if(!this.loadedGraphics)return null;const ca=C.hydrateGraphic(this.loadedGraphics.find(ia=>ia.uid===ea),this.layer),
ja=this._getObjectIdField();if(!ca||!ca.attributes||!ca.attributes[ja])return null;ca.layer=this.layer;ca.sourceLayer=this.layer;return{type:"graphic",graphic:ca,layer:ca.layer}};da.whenGraphicBounds=function(ea,ca){return this.processor.whenGraphicBounds(ea,ca)};da.computeAttachmentOrigin=function(ea,ca){return this.processor.computeAttachmentOrigin(ea,ca)};da.canResume=function(){return Y.prototype.canResume.call(this)&&(!this._controller||this._controller.rootNodeVisible)};da.isUpdating=function(){return!!(this._controller?.updating||
this.processor?.updating||this._fieldsHelper?.updating||this.layerFilterUpdating)};da.highlight=function(ea){return this.processor.highlight(ea,this.layer.objectIdField)};da.createInteractiveEditSession=function(ea){return F.createInteractiveEditSession(this._attributeEditingContext,ea)};da._decompressBinaryPointData=function(){var ea=c._asyncToGenerator(function*(ca,ja){ca={geometryBuffer:ca.geometryBuffer};m.isNone(this._worker)&&(this._worker=new u.I3SPointsWorkerHandle(ia=>this.view.resourceController.immediate.schedule(ia)));
ja=yield this._worker.invoke(ca,ja);if(m.isNone(ja))throw Error("Failed to decompress Draco point data");return{positionData:ja.positions,featureIds:ja.featureIds}});return function(ca,ja){return ea.apply(this,arguments)}}();da.addNode=function(){var ea=c._asyncToGenerator(function*(ca,ja,ia){if(!(aa(ja)||"pointData"in ja))throw Error();if(this.loadedGraphics.hasNode(ca.index))r.getLogger(this.declaredClass).error("I3S node "+ca.id+" already added");else{if(m.isSome(this.layer.fullExtent)){var Z=
this.layer.fullExtent.clone();Z.xmin-=.5;Z.ymin-=.5;Z.xmax+=.5;Z.ymax+=.5;null!=Z.zmin&&null!=Z.zmax&&(Z.zmin-=.5,Z.zmax+=.5);null!=Z.mmin&&null!=Z.mmax&&(Z.mmin-=.5,Z.mmax+=.5)}else Z=null;var ha=Z;Z=[];var {featureIds:fa,pointPositions:ka}=aa(ja)?yield this._extractBinaryPointPositions(ca,ja,ia):this._extractLegacyPointPositions(ja);this._validatePositions(ca,fa,ka,ha,Z);var la=this._controller.crsVertex;v.projectBuffer(ka,la,0,ka,this.view.spatialReference,0,fa.length);ha=aa(ja)?ca.level:0;ha=
{graphics:this._createGraphics(fa,ka,ca.index,ha),featureIds:fa,attributeInfo:ja.attributeDataInfo,node:ca};yield this._i3sOverrides.apply(ha.featureIds,ja.attributeDataInfo,ia);ca.numFeatures=ha.graphics.length;this._updateNodeMemory(ca);X(ha);0<Z.length&&(this._computeObb(ca,Z,la),this._controller.updateVisibility(ca.index));if(this._controller.isGeometryVisible(ca)){if(m.isSome(this._verticalScale))for(const na of ha.graphics)this._verticalScale(na.geometry);ja=this.view._stage.renderView.objectAndLayerIdRenderHelper;
if(m.isSome(ja))for(ia=0;ia<ha.featureIds.length;ia++)ja.setUidToObjectAndLayerId(ha.featureIds[ia],ha.graphics[ia].uid,this.layer.id,this.layer.uid,this.layer.popupEnabled,ha.node.resources.attributes,ia);this.loadedGraphics.addNode(ca.index,ha);this._controller.updateLoadStatus(ca.index,!0);this._filterNode(ha);this._treeDebugger&&this._treeDebugger.update()}else this._cacheNodeData(ha)}});return function(ca,ja,ia){return ea.apply(this,arguments)}}();da._computeObb=function(ea,ca,ja){const ia=this._controller.crsIndex,
Z=ia.isGeographic?this.view.renderSpatialReference:ia;v.projectBuffer(ca,ja,0,ca,Z,0,ca.length/3);ea.serviceObb=H.compute(new O.Attribute(ca,3));ia.isGeographic&&v.projectVectorToVector(ea.serviceObb.center,Z,ea.serviceObb.center,ia)};da.isNodeLoaded=function(ea){return this.loadedGraphics.hasNode(ea)};da.isNodeReloading=function(){return!1};da.updateNodeState=function(){};da._extractBinaryPointPositions=function(){var ea=c._asyncToGenerator(function*(ca,ja,ia){ja=yield this._decompressBinaryPointData(ja,
ia);ia=ja.positionData;const Z=ia.length/3,ha=S.newDoubleArray(3*Z);ca=m.isSome(ca.serviceObb)?ca.serviceObb.center:[0,0,0];const fa=Math.abs(ca[2])*2**-20;for(let ka=0;ka<Z;ka++){const la=3*ka;ha[la+0]=ia[la+0]+ca[0];ha[la+1]=ia[la+1]+ca[1];ha[la+2]=ia[la+2]+ca[2];Math.abs(ha[la+2])<fa&&(ha[la+2]=0)}return{featureIds:ja.featureIds?Array.from(ja.featureIds):[],pointPositions:ha}});return function(ca,ja,ia){return ea.apply(this,arguments)}}();da._extractLegacyPointPositions=function(ea){const ca=ea.pointData.length,
ja=S.newDoubleArray(3*ca),ia=[];for(let fa=0;fa<ca;fa++){var Z=ea.pointData[fa];const ka=Z.featureDataPosition,la=ka.length;var ha=Z.geometries?.[0]??W[la];Z=Z.featureIds[0];if("Embedded"!==ha.type||"points"!==ha.params.type||2>la||3<la)continue;ha=ha.params.vertexAttributes?.position??[0,0,0];const na=3*ia.length;ja[na+0]=ka[0]+ha[0];ja[na+1]=ka[1]+ha[1];ja[na+2]=3===la?ka[2]+ha[2]:NaN;ia.push(Z)}return{featureIds:ia,pointPositions:ja}};da._validatePositions=function(ea,ca,ja,ia,Z){if(!m.isNone(ia)||
!ea.serviceObb){ca=ca.length;for(let ha=0;ha<ca;ha++){const fa=3*ha;h.set(T,ja[fa],ja[fa+1],ja[fa+2]);m.isSome(ia)&&!q.extentContainsCoords3D(ia,T)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&r.getLogger(this.declaredClass).error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&r.getLogger(this.declaredClass).error("Maximum number of errors reached. Further errors are ignored."),
this._coordinatesOutsideExtentErrors++);ea.serviceObb||Z.push(T[0],T[1],T[2])}}};da._createGraphics=function(ea,ca,ja,ia){const Z=ea.length,ha=this._getObjectIdField(),fa=this.processor.graphicsCore,ka=[],la=this.view.spatialReference;for(let wa=0;wa<Z;wa++){var na=ea[wa];const za={};null!=na&&(za[ha]=na);na=null==na?t.generateUID():na;var pa=3*wa,va=isNaN(ca[pa+2])?void 0:ca[pa+2];pa=z.makeDehydratedPoint(ca[pa],ca[pa+1],va,la);va=this.loadedGraphics.get(na);if(m.isSome(va)){if(null==va.level||va.level<
ia)U.property="geometry",U.graphic=va,U.oldValue=m.unwrap(va.geometry),U.newValue=pa,va.geometry=pa,va.level=ia,fa.graphicUpdateHandler(U);ka.push(va)}else va=t.generateUID(),ka.push({objectId:na,uid:va,geometry:pa,attributes:za,visible:!0,nodeIndex:ja,level:ia})}return ka};da._updateNodeMemory=function(ea){ea.memory=4096+(m.isSome(ea.numFeatures)?ea.numFeatures*this.processor.graphicsCore.usedMemoryPerGraphic:0)};da._cacheNodeData=function(ea){const ca=ea.graphics.reduce((ja,ia)=>z.estimateSize(ia)+
ja,8*ea.featureIds.length+1536);this._memCache.put(this._getMemCacheKey(ea.node),ea,ca)};da._getMemCacheKey=function(ea){return`${ea.index}`};da._removeAllNodeData=function(){this.loadedGraphics.forEachNode((ea,ca)=>{ea&&(this._updateNodeMemory(ea.node),this._cacheNodeData(ea));this._controller.updateLoadStatus(ca,!1)});this._treeDebugger&&this._treeDebugger.update();this.loadedGraphics.clear()};da.removeNode=function(ea){if(ea=this._removeNodeStageData(ea))this._updateNodeMemory(ea.node),this._cacheNodeData(ea)};
da._removeNodeStageData=function(ea){const ca=this.loadedGraphics.getNode(ea);if(m.isNone(ca))return null;this._controller.updateLoadStatus(ea,!1);this.loadedGraphics.removeNode(ea);this._treeDebugger&&this._treeDebugger.update();return ca};da.loadCachedNodeData=function(){var ea=c._asyncToGenerator(function*(ca){return this._memCache?.pop(this._getMemCacheKey(ca))});return function(ca){return ea.apply(this,arguments)}}();da.addCachedNodeData=function(){var ea=c._asyncToGenerator(function*(ca,ja,
ia,Z){this.loadedGraphics.hasNode(ca.index)?r.getLogger(this.declaredClass).error("I3S node "+ca.id+" already added"):(yield this._i3sOverrides.apply(ja.featureIds,ia,Z),this.loadedGraphics.addNode(ca.index,ja),this._controller.updateLoadStatus(ca.index,!0),this._updateNodeMemory(ca),ja.attributeInfo=ia,this._attributeValuesChanged(ja),this._filterNode(ja),this._treeDebugger&&this._treeDebugger.update())});return function(ca,ja,ia,Z){return ea.apply(this,arguments)}}();da.getLoadedNodeIds=function(){const ea=
[];this.loadedGraphics.forEachNode(ca=>ea.push(ca.node.id));return ea.sort()};da.getVisibleNodes=function(){const ea=[];this.loadedGraphics.forEachNode(ca=>ea.push(ca.node));return ea};da.getLoadedNodeIndices=function(ea){this.loadedGraphics.forEachNode((ca,ja)=>ea.push(ja))};da.getLoadedAttributes=function(ea){ea=this.loadedGraphics.getNode(ea);if(m.isSome(ea)&&m.isSome(ea.attributeInfo))return ea.attributeInfo.loadedAttributes};da.getAttributeData=function(ea){ea=this.loadedGraphics.getNode(ea);
if(m.isSome(ea)&&m.isSome(ea.attributeInfo))return ea.attributeInfo.attributeData};da._setAttributeData=function(ea,ca){ea=this.loadedGraphics.getNode(ea);m.isNone(ea)||m.isNone(ea.attributeInfo)||(ea.attributeInfo.attributeData=ca,this._attributeValuesChanged(ea))};da.updateAttributes=function(){var ea=c._asyncToGenerator(function*(ca,ja,ia){ca=this.loadedGraphics.getNode(ca);m.isNone(ca)||(yield this._i3sOverrides.apply(ca.featureIds,ja,ia),ca.attributeInfo=ja,this._attributeValuesChanged(ca))});
return function(ca,ja,ia){return ea.apply(this,arguments)}}();da._attributeValuesChanged=function(ea){X(ea);this._filterNode(ea);this.processor.graphicsCore.labelsEnabled&&(ea=ea.graphics.map(ca=>ca.uid),this.processor.graphicsCore.updateLabelingInfo(ea))};da._updateClippingExtent=function(ea){this._controller&&this._controller.updateClippingArea(ea);return!1};da._getObjectIdField=function(){return this.layer.objectIdField||p.fallbackObjectIDAttribute};da._rendererChange=function(){var ea=c._asyncToGenerator(function*(ca,
ja){const {layer:{fieldsIndex:ia}}=this,Z=new Set;let ha;ca?(yield ca.collectRequiredFields(Z,ia),ha=Array.from(Z).sort()):ha=[];Z.clear();let fa;ja?(yield ja.collectRequiredFields(Z,ia),fa=Array.from(Z).sort()):fa=[];ha.length===fa.length&&ha.every((ka,la)=>ha[la]===fa[la])||this._reloadAllNodes()});return function(ca,ja){return ea.apply(this,arguments)}}();da._rangeInfosChanged=function(ea){null!=ea&&0<ea.length&&r.getLogger(this.declaredClass).warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};
da._filterChange=function(){this.loadedGraphics.forEachNode(ea=>this._filterNode(ea))};da._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};da._filterNode=function(ea){const ca=this.parsedDefinitionExpression,ja=this._excludeObjectIdsSorted,ia=this._getObjectIdField();for(const Z of ea.graphics){ea=Z.visible;const ha=!ca||this._evaluateClause(ca,Z),fa=m.isNone(ja)||0>n.binaryIndexOf(ja,Z.attributes[ia]);Z.visible=ha&&fa;ea!==Z.visible&&(U.graphic=
Z,U.property="visible",U.oldValue=ea,U.newValue=Z.visible,this.processor.graphicsCore.graphicUpdateHandler(U))}};da.createQuery=function(){const ea={outFields:["*"],returnGeometry:!0,outSpatialReference:this.view.spatialReference};return m.isSome(this.filter)?this.filter.createQuery(ea):new x(ea)};da.queryFeatures=function(ea,ca){return this._queryEngine.executeQuery(this._ensureQuery(ea),ca?.signal)};da.queryObjectIds=function(ea,ca){return this._queryEngine.executeQueryForIds(this._ensureQuery(ea),
ca?.signal)};da.queryFeatureCount=function(ea,ca){return this._queryEngine.executeQueryForCount(this._ensureQuery(ea),ca?.signal)};da.queryExtent=function(ea,ca){return this._queryEngine.executeQueryForExtent(this._ensureQuery(ea),ca?.signal)};da._ensureQuery=function(ea){return this._addDefinitionExpressionToQuery(m.isNone(ea)?this.createQuery():x.from(ea))};da._setupQueryEngine=function(){const ea=()=>this.processor.featureStore;this._queryEngine=new D.QueryEngine({context:{spatialReference:this.view.spatialReference,
layer:this.layer,scheduler:this.view.resourceController.scheduler,get featureStore(){return ea()},hasZ:this.hasZ,hasM:this.hasM},priority:V.TaskPriority.FEATURE_QUERY_ENGINE})};da.getUsedMemory=function(){return this.processor?.graphicsCore?.usedMemory??0};da.getUnloadedMemory=function(){return.8*((this._controller?.unloadedMemoryEstimate??0)+(this.processor?.graphicsCore?.unprocessedMemoryEstimate??0))};da.ignoresMemoryFactor=function(){return this._controller&&this._controller.fixedFeatureTarget};
da._handleEdits=function(ea){F.processAttributeEdits(this._attributeEditingContext,ea)};c._createClass(ba,[{key:"i3slayer",get:function(){return this.layer}},{key:"updatingProgressValue",get:function(){return this._controller?.updatingProgress??1}},{key:"requiredFields",get:function(){return this._fieldsHelper?.requiredFields??[]}},{key:"maximumNumberOfFeatures",get:function(){return this.processor?.graphicsCore?.displayFeatureLimit?.maximumNumberOfFeatures??0},set:function(ea){null!=ea?(this._override("maximumNumberOfFeatures",
ea),this._controller.fixedFeatureTarget=!0):(this._clearOverride("maximumNumberOfFeatures"),this._controller.fixedFeatureTarget=!1)}},{key:"maximumNumberOfFeaturesExceeded",get:function(){return this.suspended?!1:!!this._controller?.useMaximumNumberOfFeatures&&!this._controller.leavesReached}},{key:"_excludeObjectIdsSorted",get:function(){const ea=this.layer.excludeObjectIds;return ea.length?ea.toArray().sort((ca,ja)=>ca-ja):null}},{key:"lodFactor",get:function(){return"Labels"===this.layer.semantic?
1:this.view.qualitySettings.sceneService.point.lodFactor}},{key:"hasM",get:function(){return!1}},{key:"hasZ",get:function(){return!0}},{key:"updatePolicy",get:function(){return this.processor.graphicsCore.effectiveUpdatePolicy}},{key:"_attributeEditingContext",get:function(){const ea=this._getObjectIdField();return{sessions:this._interactiveEditingSessions,fieldsIndex:this.layer.fieldsIndex,objectIdField:ea,forEachNode:ca=>this.loadedGraphics.forEachNode(ja=>ca(ja.node,ja.featureIds)),attributeStorageInfo:this.i3slayer.attributeStorageInfo??
[],i3sOverrides:this._i3sOverrides,getAttributeData:ca=>this.getAttributeData(ca),setAttributeData:(ca,ja,ia)=>{this._setAttributeData(ca,ja);ca=this.loadedGraphics.getNode(ca);m.isSome(ia)?(ia=this.loadedGraphics.get(ia.attributes[ea]),m.isSome(ia)&&this.processor.graphicsCore.recreateGraphics([ia])):m.isSome(ca)&&this.processor.graphicsCore.recreateGraphics(ca.graphics)},clearMemCache:()=>{}}}},{key:"performanceInfo",get:function(){const ea={displayedNumberOfFeatures:this.loadedGraphics.length,
maximumNumberOfFeatures:this.maximumNumberOfFeatures,totalNumberOfFeatures:-1,nodes:this.loadedGraphics.nodeCount,core:this.processor.graphicsCore.performanceInfo};this._controller&&this._controller.updateStats(ea);return ea}},{key:"test",get:function(){return{controller:this._controller,numNodes:this.loadedGraphics.nodeCount,loadedGraphics:this.loadedGraphics}}}]);return ba}(M.DefinitionExpressionSceneLayerView(P.PopupSceneLayerView(y.LayerView3D(Q))));b.__decorate([f.property()],y.prototype,"processor",
void 0);b.__decorate([f.property({type:A})],y.prototype,"filter",void 0);b.__decorate([f.property()],y.prototype,"loadedGraphics",void 0);b.__decorate([f.property()],y.prototype,"i3slayer",null);b.__decorate([f.property()],y.prototype,"_controller",void 0);b.__decorate([f.property()],y.prototype,"updating",void 0);b.__decorate([f.property()],y.prototype,"suspended",void 0);b.__decorate([f.property()],y.prototype,"holeFilling",void 0);b.__decorate([f.property(L.updatingProgress)],y.prototype,"updatingProgress",
void 0);b.__decorate([f.property()],y.prototype,"updatingProgressValue",null);b.__decorate([f.property(e.requiredFields)],y.prototype,"requiredFields",null);b.__decorate([f.property(e.availableFields)],y.prototype,"availableFields",void 0);b.__decorate([f.property()],y.prototype,"_fieldsHelper",void 0);b.__decorate([f.property({type:Number})],y.prototype,"maximumNumberOfFeatures",null);b.__decorate([f.property({readOnly:!0})],y.prototype,"maximumNumberOfFeaturesExceeded",null);b.__decorate([f.property()],
y.prototype,"_excludeObjectIdsSorted",null);b.__decorate([f.property({readOnly:!0})],y.prototype,"lodFactor",null);b.__decorate([f.property({readOnly:!0})],y.prototype,"hasM",null);b.__decorate([f.property({readOnly:!0})],y.prototype,"hasZ",null);b=y=b.__decorate([g.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],y);const W={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},T=l.create(),
U={graphic:null,property:null,oldValue:null,newValue:null};return b})},"esri/views/3d/layers/I3SPointsWorkerHandle":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/workers/WorkerHandle"],function(a,c,b){b=function(t){function n(r){return t.call(this,"SceneLayerWorker","dracoDecompressPointCloudData",{dracoDecompressPointCloudData:m=>[m.geometryBuffer]},r,{hasInitialize:!0})||this}c._inheritsLoose(n,t);return n}(b.WorkerHandle);a.I3SPointsWorkerHandle=b;Object.defineProperty(a,
Symbol.toStringTag,{value:"Module"})})},"esri/views/3d/layers/i3s/I3SGraphicsMap":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Evented","../../../../core/MapUtils","../../../../core/maybe"],function(a,c,b,t,n){b=function(r){function m(f,e){var g=r.call(this)||this;g._updateAndCompare=f;g._notifyUpdated=e;g._nodes=new Map;g._graphics=new Map;g._duplicates=new Map;return g}c._inheritsLoose(m,r);var d=m.prototype;d.clear=function(){if(0<this._graphics.size){const f=
this.toArray();this._graphics.clear();this.emit("change",{added:[],removed:f})}this._nodes.clear()};d.get=function(f){return this._graphics.get(f)};d.getNode=function(f){return this._nodes.get(f)};d.hasNode=function(f){return this._nodes.has(f)};d.nodes=function(){return this._nodes.values()};d.addNode=function(f,e){this._nodes.set(f,e);const g=e.graphics;if(0!==g.length){var h=new Set;for(let v=0;v<g.length;v++){var l=g[v];const q=l.objectId,k=this._graphics.get(q);k?(h.add(q),l!==k&&(g[v]=k),(l=
this._duplicates.get(q))?l.push(f):this._duplicates.set(q,[k.nodeIndex,f])):(l.nodeIndex=f,this._graphics.set(q,l))}h.size&&this._updateForeignGraphics(e);f=0<h.size?g.filter(v=>!h.has(v.objectId)):g;0<f.length&&this.emit("change",{added:f,removed:[]})}};d.removeNode=function(f){var e=this._nodes.get(f);if(e){this._nodes.delete(f);var g=new Set,h=[];for(const q of e.graphics){e=q.objectId;var l=this._graphics.get(e);if(!l)continue;const k=this._duplicates.get(e);if(k){var v=k.indexOf(f);if(-1===v)console.error("error: removing graphic from node that should not reference it.");
else{k.splice(v,1);if(l.nodeIndex===f){l=this.getNode(k[0]);for(v=1;v<k.length;v++){const p=this.getNode(k[v]);if(n.isNone(l)||n.isSome(p)&&p.node.level>l.node.level)l=p}n.isSome(l)&&g.add(l)}1===k.length&&this._duplicates.delete(e)}}else this._graphics.delete(e),h.push(q)}0<h.length&&this.emit("change",{added:[],removed:h});g.forEach(q=>this._updateForeignGraphics(q))}else console.error("Removing unknown node")};d._updateForeignGraphics=function(f){const e=[],g=f.node.index,h=f.node.level;let l=
0;for(;l<f.graphics.length;){var v=f.graphics[l].nodeIndex;if(v===g){l++;continue}let q=1;for(;l+q<f.graphics.length&&f.graphics[l+q].nodeIndex===v;)q++;v=this.getNode(v);if(!(n.isSome(v)&&v.node.level>h))for(v=l;v<l+q;v++){const k=f.graphics[v];k.nodeIndex=g;this._updateAndCompare(k,f,v)&&e.push(k)}l+=q}this._notifyUpdated(e)};d.toArray=function(){return Array.from(this._graphics.values())};d.find=function(f){let e=void 0;t.someMap(this._graphics,g=>f(g)?(e=g,!0):!1);return e};d.forEach=function(f){this._graphics.forEach(e=>
f(e))};d.forEachNode=function(f){this._nodes.forEach((e,g)=>f(e,g))};d._checkInvariants=function(){const f=new Map;this._nodes.forEach((g,h)=>{h!==g.node.index&&console.error("Mismatched node index");g.graphics.forEach(l=>{f.set(l.objectId,1+(f.get(l.objectId)??0));const v=this._duplicates.get(l.objectId);v&&!v.includes(h)&&console.error("Node not listed in duplicate list");v||l.nodeIndex===h||console.error("Unique graphic does not reference owning node index")})});this._graphics.size!==f.size&&console.error("Mismatch between actual and expected number of graphics");
let e=0;f.forEach((g,h)=>{e+=1<g?1:0;const l=this._graphics.get(h);if(l){var v=this._nodes.get(l.nodeIndex);v?(h=this._duplicates.get(h))?(h.length!==g&&console.error("Wrong number of entries in duplicate list"),h.forEach(q=>{(q=this._nodes.get(q))?q.node.level>v.node.level&&console.error("Duplicated graphic does not reference highest level node"):console.error("Unknown node in duplicate list")})):1<g&&console.error("Missing duplicates entry"):console.error("Graphic references unkown node")}else console.error("Missing graphic entry")});
this._duplicates.size!==e&&console.error("Mismatch between expected and actual number of duplicate entries")};c._createClass(m,[{key:"length",get:function(){return this._graphics.size}},{key:"nodeCount",get:function(){return this._nodes.size}}]);return m}(b);a.I3SGraphicsMap=b;Object.defineProperty(a,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/iteratorUtils ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/cast ../core/arrayUtils ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/LayerConstants ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/IntersectorInterfaces ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/RenderState ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/SpatialReference ../geometry/Point ../geometry/Extent".split(" "),function(a,
c,b,t,n,r,m,d,f,e,g,h,l,v,q,k,p,z,C,B,A,x,u,y,w,D,F,E,K,J,M,N,P,I,G,H,L,O,S,R,Q,V,aa,X,W,T,U,Y,ba,da,ea,ca,ja,ia,Z,ha,fa,ka,la,na,pa,va,wa,za,sa,ua,oa,xa,Ea,Ia,Na,Oa,Ja,Sa,Ua,Za,ma,Ya,bb,Qa,Aa,Ca,qa,ya,Da,La,Ta,Xa,db,fb){function jb(mb,eb){mb.layerUids||(mb.layerUids=new Set);mb.layerUids.add(eb)}function lb(mb,eb){return k.isSome(mb)&&M.canProjectWithoutEngine(mb.spatialReference,eb)?M.project(mb,eb):null}const ob=mb=>Object.freeze(Object.defineProperty({__proto__:null,default:mb},Symbol.toStringTag,
{value:"Module"}));n=function(mb){function eb(Ka){var Ha=mb.call(this,Ka)||this;Ha._userClippingArea=null;Ha._clippingArea=null;Ha._initialDefaultSpatialReference=null;Ha._defaults={};Ha._externallySet={environment:!1};Ha._createGraphicsViewController=null;Ha._lostWebGLContextHandle=null;Ha._resolveWhenReady=[];Ha._propertiesPool=new za.PropertiesPool({slicePlane:P.BoundedPlaneClass},c._assertThisInitialized(Ha));Ha._resourceController=oa.newResourceController(c._assertThisInitialized(Ha));Ha._defaultToMapOptions=
{include:new Set};Ha._defaultHitTestOptions={exclude:new Set};Ha.deconflictor=new ca.GraphicsDeconflictor({view:c._assertThisInitialized(Ha)});Ha.labeler=new ja.Labeler({view:c._assertThisInitialized(Ha),deconflictor:Ha.deconflictor.labels});Ha.sharedSymbolResources=null;Ha.analyses=new O.AnalysesCollection;Ha.basemapTerrain=null;Ha.elevationProvider=null;Ha.canvas=null;Ha.constraints=new Y.Constraints;Ha.environmentManager=new da.SceneViewEnvironmentManager;Ha.floors=new d;Ha.fullOpacity=1;Ha.graphicsView=
null;Ha.analysisViewManager=new U({view:c._assertThisInitialized(Ha)});Ha.groundView=null;Ha.map=null;Ha.screenSizePerspectiveEnabled=!0;Ha.state=new Z;Ha.spatialReference=null;Ha.alphaCompositingEnabled=!1;Ha.preserveDrawingBufferEnabled=!1;Ha.supersampleScreenshotsEnabled=!0;Ha.type="3d";Ha.ui=new La;Ha._numUpdating=0;Ha._lastUpdateTime=0;Ha.updatingProgress=.5;Ha.highlightOptions=new va;Ha.voxelWasm=null;Ha.voxelWasmPromise=null;x.initialize();Ka&&Ka.environment||(Ha._defaults.environment=new ba,
Ha.environment=Ha._defaults.environment);const ra=(Ga=null)=>{k.isSome(Ga)&&Ga.type===p.ObservableChangesType.MOVE||(Ha._updatingChanged(),Ha.map&&Ha.map.allLayers.forEach(function(){var Pa=c._asyncToGenerator(function*(Ra){try{yield Ra.when()}catch{}Ha._updatingChanged()});return function(Ra){return Pa.apply(this,arguments)}}()))};Ha.handles.add([C.on(()=>Ha.map?.allLayers,"after-changes",Ga=>ra(Ga),{onListenerAdd:()=>ra(),onListenerRemove:()=>ra(),sync:!0}),Ha.allLayerViews.on("after-changes",Ga=>
Ha._updateUpdatingMonitors(Ga)),C.watch(()=>Ha.map,Ga=>{Ga&&"load"in Ga&&Ga.load&&Ga.load().catch(()=>{})})]);Ha.inputManager=new ea({view:c._assertThisInitialized(Ha)});Ha.stateManager=new ha.ViewStateManager({view:c._assertThisInitialized(Ha)});return Ha}c._inheritsLoose(eb,mb);var cb=eb.prototype;cb.initialize=function(){this.groundView=new Q({view:this});this._updateUpdatingMonitors();const Ka=()=>this._updateDefaultToMapOptions();this.handles.add(C.on(()=>this.map?.allLayers,"after-changes",
Ka,{onListenerAdd:Ka,onListenerRemove:Ka}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Ha=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=Ha)},C.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Ha=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=Ha)},C.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate??0,Ha=>B.setFrameDuration(0<Ha?1E3/Math.ceil(Ha):0),C.initial);
this.updatingHandles.add(()=>this.map?.ground,Ka,C.syncAndInitial);this.updatingHandles.add(()=>this.map?.ground?.opacity,()=>this._updateDefaultHitTestOptions(),C.syncAndInitial);this.handles.add(C.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),C.sync))};cb.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=k.destroyMaybe(this.sharedSymbolResources),
this._set("labeler",k.destroyMaybe(this.labeler)),this._set("deconflictor",k.destroyMaybe(this.deconflictor)),this._resourceController=k.destroyMaybe(this._resourceController),this._set("stateManager",k.destroyMaybe(this.stateManager)),this._set("inputManager",k.destroyMaybe(this.inputManager)),this.state.destroy(),this._propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this._set("environmentManager",k.destroyMaybe(this.environmentManager)),this.groundView=k.destroyMaybe(this.groundView))};
cb.installContentCameraReset=function(Ka={sticky:!1}){return this.stateManager.installContentCameraReset(Ka)};cb.castEnvironment=function(Ka){return Ka?Ka instanceof ba?Ka:Ka instanceof Ta?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(Ka):ba.fromWebsceneEnvironment(Ka):F.ensureType(ba,Ka):new ba};cb.on=function(Ka,Ha,ra,Ga){return(ra=this.viewEvents.on(Ka,Ha,ra,Ga))?ra:mb.prototype.on.call(this,Ka,Ha)};cb.hasEventListener=function(Ka){return mb.prototype.hasEventListener.call(this,
Ka)||this.viewEvents.hasHandler(Ka)};cb.toMap=function(Ka,Ha){if(!this.ready)return q.getLogger(this.declaredClass).error("#toMap()","Scene view cannot be used before it is ready"),null;Ha=Ha?this.externalToInternalIntersectOptions(Ha):this._defaultToMapOptions;var ra=k.isSome(Ha.graphics)&&(k.isSome(Ha.graphics.include)||k.isSome(Ha.graphics.exclude));Ka=qa.isSupportedScreenPointEvent(Ka)?qa.createScreenPointFromSupportedEvent(this,Ka):Ka;Ka=A.screenPointObjectToArray(Ka);Ha.enableDraped=Ha.include&&
!Ha.include.has(Ya.TERRAIN_ID)||Ha.exclude&&Ha.exclude.has(Ya.TERRAIN_ID);const Ga=this.sceneIntersectionHelper,Pa=Sa.newIntersector(this.state.viewingMode);Pa.options.selectionMode=!0;Pa.options.store=ra?Ua.StoreResults.ALL:Ua.StoreResults.MIN;Ga.intersectIntersectorScreen(Ka,Pa,Ha);if(ra){for(const Ra of Pa.results.all)if(ra=ma.toHit(Ra,this),k.isNone(ra)||"graphic"!==ra.type||this._testGraphicUidFilter(Ha.graphics,ra.graphic))return this._intersectResultToMapPoint(Ra);return null}return this._intersectResultToMapPoint(Pa.results.min)};
cb.toScreen=function(Ka){if(!this.ready)return q.getLogger(this.declaredClass).error("#toScreen()","Scene view cannot be used before it is ready"),null;const Ha=k.unwrapOr(null==Ka.z?pa.getElevationAtPoint(this.elevationProvider,Ka):null,0);M.projectPointToVector(Ka,Nb,this.renderSpatialReference,Ha);this.state.camera.projectToScreen(Nb,Bb);return A.createScreenPoint(Bb[0],Bb[1])};cb.pixelSizeAt=function(Ka){if(!this.ready)return q.getLogger(this.declaredClass).error("#pixelSizeAt()","Scene view cannot be used before it is ready"),
null;if(!Ka)return 0;M.projectPointToVector(Ka,Nb,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(Nb)};cb.overlayPixelSizeInMapUnits=function(Ka){const Ha=this.basemapTerrain.overlayManager;return Ha?Ha.overlayPixelSizeInMapUnits(Ka):1};cb.hitTest=function(Ka,Ha){if(!this.ready)return q.getLogger(this.declaredClass).error("#hitTest()","Scene view cannot be used before it is ready"),null;Ka=qa.isSupportedScreenPointEvent(Ka)?qa.createScreenPointFromSupportedEvent(this,
Ka):Ka;var ra=A.createScreenPointArray(Ka.x,Ka.y),Ga=Ha?this.externalToInternalIntersectOptions(Ha):this._defaultHitTestOptions;Ga.requiresGroundFeedback=!0;Ga.enableDraped=!0;Ha=Sa.newIntersector(this.state.viewingMode);Ha.options.selectionMode=!0;Ha.options.store=Ua.StoreResults.ALL;this.sceneIntersectionHelper.intersectIntersectorScreen(ra,Ha,Ga);ra=this._intersectResultsToHits(Ha.results.all,Ga.graphics);Ga=Ha.results.ground;var Pa=ma.toOwner(Ga,this);Pa=k.isSome(Pa)&&"type"in Pa&&"integrated-mesh"===
Pa.type?Pa:null;Ka={screenPoint:Ka,results:ra,ground:{mapPoint:this._intersectResultToMapPoint(Ga),distance:Za.isValidIntersectorResult(Ga)?Ga.distanceInRenderSpace:0,layer:Pa}};la.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Ka.intersector=Ha);return Promise.resolve(Ka)};cb.popupHitTest=function(){var Ka=c._asyncToGenerator(function*(Ha){const {results:ra,ground:Ga}=yield bb.hitTestSelectSimilarDistance(this,Ha);let Pa=null;!(0===ra.length||1E-5>Math.abs(k.unwrapOr(ra[0].distance,0)-Ga.distance))||Ga.layer&&
"integrated-mesh"===Ga.layer.type||(Pa=Ga.mapPoint);return{results:ra,screenPoint:Ha,mapPoint:Pa}});return function(Ha){return Ka.apply(this,arguments)}}();cb.goTo=function(Ka,Ha){return this.updatingHandles.addPromise(this.stateManager.goTo(Ka,Ha))};cb.whenAnalysisView=function(){var Ka=c._asyncToGenerator(function*(Ha){if(k.isNone(Ha.parent))throw new e("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:Ha});switch(Ha.parent.type){case "line-of-sight":case "dimension":return(yield this.whenLayerView(Ha.parent)).whenAnalysisView();
default:return this.analysisViewManager.whenAnalysisView(Ha)}});return function(Ha){return Ka.apply(this,arguments)}}();cb.whenLayerView=function(Ka){return mb.prototype.whenLayerView.call(this,Ka)};cb.takeScreenshot=function(){var Ka=c._asyncToGenerator(function*(Ha){Ha=this._completeSettings(Ha);yield this.whenReady();const ra=yield this._stage.renderView.takeScreenshot(Ha);return Ca.encode(ra,Ha,this._pixelFormat())});return function(Ha){return Ka.apply(this,arguments)}}();cb._takeScreenshot=function(){var Ka=
c._asyncToGenerator(function*(Ha){Ha=this._completeSettings(Ha);yield this.whenReady();Ha=yield this._stage.renderView.takeScreenshot(Ha);return Ca.encodeData(Ha,this._pixelFormat())});return function(Ha){return Ka.apply(this,arguments)}}();cb._takeScreenshotWithObjectAndLayerId=function(){var Ka=c._asyncToGenerator(function*(Ha){Ha=this._completeSettings(Ha);yield this.whenReady();Ha=yield this._stage.renderView.takeScreenshotWithOID(Ha);return[Ca.encodeData(Ha[0],this._pixelFormat()),Ca.encodeData(Ha[1],
this._pixelFormat())]});return function(Ha){return Ka.apply(this,arguments)}}();cb._completeSettings=function(Ka){Ka=Ca.toRenderSettings(Ka,this);Ka.pixelRatio/=this.state.pixelRatio;return Ca.screenshotSuperSampleSettings(Ka,this.supersampleScreenshotsEnabled,this.padding)};cb._pixelFormat=function(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}};cb.takeScreenshotWithObjectAndLayerId=function(){var Ka=c._asyncToGenerator(function*(Ha){if(!l("enable-feature:objectAndLayerId-rendering"))throw Error("has enable-feature:objectAndLayerId-rendering must be true");
var ra=this._completeSettings(Ha);yield this.whenReady();var Ga=yield this._stage.renderView.takeScreenshotWithOID(ra);ra=Ca.encode(Ga[0],ra,this._pixelFormat());Ha=this._completeSettings(Ha);Ha.format="png";Ga=Ca.encode(Ga[1],Ha,this._pixelFormat());return[ra,Ga]});return function(Ha){return Ka.apply(this,arguments)}}();cb.getColorToObjectAndLayerIdMapping=function(){if(k.isNone(this._stage.renderView.objectAndLayerIdRenderHelper))throw Error("has enable-feature:objectAndLayerId-rendering must be true");
return this._stage.renderView.objectAndLayerIdRenderHelper.getColorToObjectAndLayerIdMapping()};cb.addUpdatingPromise=function(Ka){return this.updatingHandles.addPromise(Ka)};cb.importLayerView=function(Ka){return T.layerView3DImporter.importLayerView(Ka)};cb.hasLayerViewModule=function(Ka){return T.layerView3DImporter.hasLayerViewModule(Ka)};cb.forceDOMReadyCycle=function(){this.forceReadyCycle()};cb.getDefaultSpatialReference=function(){return this.map&&"initialViewProperties"in this.map&&this.map?.initialViewProperties?.spatialReference||
this.defaultsFromMap?.spatialReference||this.defaultsFromMap?.ready&&this._initialDefaultSpatialReference||null};cb.validate=function(){var Ka=c._asyncToGenerator(function*(){let Ha=Da.check(this.type);const ra=l("safari");ra&&9>ra&&(Ha=new e("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:ra}));if(k.isSome(Ha))throw q.getLogger(this.declaredClass).warn("#validate()",Ha.message),Ha;});return function(){return Ka.apply(this,
arguments)}}();cb.getSpatialReferenceSupport=function({spatialReference:Ka,layer:Ha}){var ra=this._predeterminedViewingMode;if(k.isSome(ra))return this._validateSpatialReferenceForViewingMode(Ka,Ha,ra)?{constraints:this._makeSpatialReferenceConstraints(Ka,Ha,ra)}:null;ra=this._validateSpatialReferenceForViewingMode(Ka,Ha,W.ViewingMode.Local);const Ga=this._validateSpatialReferenceForViewingMode(Ka,Ha,W.ViewingMode.Global);return ra||Ga?ra&&Ga?{constraints:this._makeSpatialReferenceConstraints(Ka,
Ha,null)}:ra?{constraints:this._makeSpatialReferenceConstraints(Ka,Ha,W.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Ka,Ha,W.ViewingMode.Global)}:null};cb._validateSpatialReferenceForViewingMode=function(Ka,Ha,ra){return ya.isSpatialReferenceSupported(Ka,ra)?k.isNone(Ha)||L.isImageryTileLayer(Ha)?!0:L.isTiledLayer(Ha)&&k.isNone(Oa.getTiledLayerInfo(Ha,Ka,ra))||L.isVoxelLayer(Ha)&&ra===W.ViewingMode.Global?!1:!0:!1};cb._makeSpatialReferenceConstraints=function(Ka,Ha,ra){if(k.isNone(Ha))return[{spatialReference:Ka,
viewingMode:ra}];const Ga=Ka.isWebMercator,Pa=Ka.isWGS84;return L.isImageryTileLayer(Ha)&&(Ga||Pa)?(Pa&&ra!==W.ViewingMode.Local?null===Oa.checkIfTileInfoSupportedForView(Ha.tileInfo,Ha.fullExtent,Ka,W.ViewingMode.Global):1)?[{spatialReference:Ka,viewingMode:ra},{spatialReference:Xa.WebMercator,viewingMode:ra}]:[{spatialReference:Ga?Xa.WGS84:Xa.WebMercator,viewingMode:ra}]:L.isTiledLayer(Ha)||L.isVoxelLayer(Ha)||!Ga&&!Pa?L.isTiledLayer(Ha)&&Ga&&ra!==W.ViewingMode.Global?[{spatialReference:Ka,viewingMode:ra},
{spatialReference:Xa.WGS84,viewingMode:W.ViewingMode.Local}]:[{spatialReference:Ka,viewingMode:ra}]:[{spatialReference:Ka,viewingMode:ra},{spatialReference:Ga?Xa.WGS84:Xa.WebMercator,viewingMode:ra}]};cb._validateSpatialReference=function(Ka){const Ha=k.isSome(this.getSpatialReferenceSupport({spatialReference:Ka})),ra=this._predeterminedViewingMode;Ha||(k.isSome(ra)?q.getLogger(this.declaredClass).warnOnce(`Spatial reference defined on view not supported in ${W.stringFromViewingMode(ra)} viewing mode.`):
Ka.isGeographic&&q.getLogger(this.declaredClass).warnOnce("Spatial reference is geographic but not supported."));return Ha};cb.whenReady=function(){return new Promise(Ka=>{this.ready?Ka(this):this._resolveWhenReady.push(Ka)})};cb.computeMapPointFromVec3d=function(Ka,Ha){let ra=this.spatialReference||Xa.WGS84;M.projectVectorToVector(Ka,this.renderSpatialReference,Ka,ra)||(ra=Xa.WGS84,M.projectVectorToVector(Ka,this.renderSpatialReference,Ka,ra));Ha?(Ha.x=Ka[0],Ha.y=Ka[1],Ha.z=Ka[2],Ha.spatialReference=
ra):Ha=new db(Ka,ra);return Ha};cb.trackGraphicState=function(Ka){if(!Ka.graphic)return q.getLogger(this.declaredClass).error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const Ha=this.getViewForGraphic(Ka.graphic);let ra=null,Ga=!1;const Pa=Ra=>{!Ga&&k.isSome(Ra)&&"processor"in Ra&&"graphics-3d"===Ra.processor?.type&&Ra.processor.graphicsCore&&(ra=Ra.processor.graphicsCore.trackGraphicState(Ka))};k.isSome(Ha)?Pa(Ha):this.whenViewForGraphic(Ka.graphic,
{waitForLayer:!0}).then(Ra=>Pa(Ra),()=>{}).catch(()=>{});return{remove:()=>{Ga=!0;k.isSome(ra)&&(ra.remove(),ra=null)}}};cb.highlight=function(Ka){if(Array.isArray(Ka))return h.handlesGroup(Ka.map(ra=>this.highlight(ra)));if(d.isCollection(Ka))return h.handlesGroup(Ka.toArray().map(ra=>this.highlight(ra)));const Ha=this.getViewForGraphic(Ka);return Ha&&"highlight"in Ha?Ha.highlight(Ka):h.makeHandle()};cb.maskOccludee=function(Ka){if(!Ka)return q.getLogger(this.declaredClass).error("maskOccludee",
"GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Ha=this.getViewForGraphic(Ka);let ra=null,Ga=!1;const Pa=Ra=>{!Ga&&k.isSome(Ra)&&Qa.occludeesSupported(Ra)&&(ra=Ra.maskOccludee(Ka))};k.isSome(Ha)?Pa(Ha):this.whenViewForGraphic(Ka,{waitForLayer:!0}).then(Ra=>Pa(Ra),()=>{}).catch(()=>{});return{remove:()=>{Ga=!0;k.isSome(ra)&&(ra.remove(),ra=null)}}};cb.getViewForGraphic=function(Ka){return Ka.layer===this.graphics?this.graphicsView:Ka.layer?this.allLayerViews.find(Ha=>
Ha.layer===Ka.layer):null};cb.graphicChanged=function(Ka){k.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(Ka)};cb.whenViewForGraphic=function(){var Ka=c._asyncToGenerator(function*(Ha,ra){if(Ha.layer===this)return yield C.whenOnce(()=>this.graphicsView),this.graphicsView;if(!Ha.layer||!this.map)throw new e("no-view-for-graphic");return ra&&ra.waitForLayer&&!this.map.allLayers.includes(Ha.layer)?new Promise((Ga,Pa)=>{const Ra=this.map.allLayers.on("change",Va=>{Va.added.includes(Ha.layer)&&
(Ra.remove(),this.whenLayerView(Ha.layer).then(Ga,Pa))})}):this.whenLayerView(Ha.layer)});return function(Ha,ra){return Ka.apply(this,arguments)}}();cb.externalToInternalIntersectOptions=function(Ka){const Ha=this._externalToInternalRenderItems(Ka.include,xb.INCLUDE);Ka=this._externalToInternalRenderItems(Ka.exclude,xb.EXCLUDE);return{include:Ha.layerUids,exclude:Ka.layerUids,graphics:{include:Ha.graphicUids,exclude:Ka.graphicUids}}};cb._intersectResultToMapPoint=function(Ka,Ha){return Ka.getIntersectionPoint(Nb)?
(Ha=this.computeMapPointFromVec3d(Nb,Ha),Ka.intersector===Ua.IntersectorType.TERRAIN&&this.basemapTerrain&&(Ha.z=k.unwrapOr(pa.getElevationAtPoint(this.basemapTerrain,Ha),0)),Ha):null};cb._intersectResultsToHits=function(Ka,Ha){const ra=[];let Ga=null;for(let Va=0;Va<Ka.length;Va++){const ab=Ka[Va];var Pa=ma.toOwner(ab,this);if(k.isSome(Pa)&&(Pa===this.map.ground||"type"in Pa&&"integrated-mesh"===Pa.type))break;Pa=ma.toHit(ab,this);if(!k.isNone(Pa)){if("graphic"===Pa.type){k.isNone(Ga)&&Va!==Ka.length-
1&&(Ga=new Set);if(k.isSome(Ga)){var Ra=this._getGraphicFilterUid(Pa.graphic);if(Ga.has(Ra))continue;Ga.add(Ra)}if(!this._testGraphicUidFilter(Ha,Pa.graphic))continue}Ra=this._intersectResultToMapPoint(ab);ra.push({...Pa,mapPoint:Ra,distance:ab.distanceInRenderSpace})}}return ra};cb._getGraphicFilterUid=function(Ka){var Ha=Ka.sourceLayer,ra=Ka.layer;if(Ha=Ha&&"objectIdField"in Ha?Ha:ra&&"objectIdField"in ra?ra:Ha)if(ra=Ha.objectIdField??H.fallbackObjectIDAttribute,ra=Ka.attributes?.[ra])return`o-${Ha.id}-${ra}`;
return`u-${Ka.uid}`};cb._testGraphicUidFilter=function(Ka,Ha){Ha=this._getGraphicFilterUid(Ha);return k.isNone(Ka)||(k.isNone(Ka.include)||Ka.include.has(Ha))&&(k.isNone(Ka.exclude)||!Ka.exclude.has(Ha))};cb._externalToInternalRenderItems=function(Ka,Ha,ra={layerUids:void 0,graphicUids:void 0}){if(!Ka)return ra;if(Ka instanceof r){var Ga=this._getGraphicFilterUid(Ka);ra.graphicUids||(ra.graphicUids=new Set);ra.graphicUids.add(Ga);Ha===xb.INCLUDE&&(k.isSome(this.graphicsView)&&Ka.layer===this?jb(ra,
this.graphicsView.processor.layer.id):Ka.layer&&jb(ra,Ka.layer.uid))}else if(v.isIterable(Ka))for(Ga of Ka)Ga===this.graphics&&k.isSome(this.graphicsView)?jb(ra,this.graphicsView.processor.layer.id):Ga===this.map.ground?jb(ra,Ya.TERRAIN_ID):this._externalToInternalRenderItems(Ga,Ha,ra);else"uid"in Ka&&jb(ra,Ka.uid);return ra};cb._initBasemapTerrain=function(){this._set("basemapTerrain",new Na({view:this}));this._set("elevationProvider",new ka.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",
this.basemapTerrain)};cb._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};cb._initGlobe=function(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",new Ia.PointsOfInterest({view:this}));this._set("featureTiles",new ia.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,
cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Ka=()=>{var Ha=this.basemapTerrain?.extent;this.clippingArea||Ha?Ha&&this.basemapTerrain.spatialReference?(Ha=k.isSome(this.basemapTerrain.extent)&&k.isSome(this.basemapTerrain.spatialReference)?M.project(N.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),
this.spatialReference):null,k.isSome(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(Ha):this.featureTiles.filterExtent=Ha):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>la.FEATURE_TILE_TREE_SHOW_TILES,Ha=>{Ha&&this.featureTiles&&!this._featureTreeDebugger?this.updatingHandles.addPromise(new Promise((ra,Ga)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],ra,Ga))).then(({FeatureTileTree3DDebugger:ra})=>
{!this._featureTreeDebugger&&la.FEATURE_TILE_TREE_SHOW_TILES&&(this._featureTreeDebugger=new ra({view:this}))}):Ha||!this._featureTreeDebugger||la.FEATURE_TILE_TREE_SHOW_TILES||(this._featureTreeDebugger.destroy(),this._featureTreeDebugger=null)},C.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,Ka,C.syncAndInitial),this.updatingHandles.add(()=>this.basemapTerrain.extent,Ka,C.syncAndInitial)],"feature-tiles");this.stateManager.init()};cb._exitGlobe=function(){this.state&&(this.stateManager.exit(),
this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};cb._initCoordinateSystem=function(){if(this.spatialReference){var Ka=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Ka)||this._set("mapCoordsHelper",new wa.MapCoordsHelper(this.map,
Ka));const Ha=this.state.isGlobal;Ka=I.renderSRFromViewSR(Ha,Ka);Ka!==this.renderSpatialReference&&(this._set("renderCoordsHelper",ua.RenderCoordsHelper.create(this.state.viewingMode,Ka)),Ha||this.handles.add(C.watch(()=>this.basemapTerrain?.extent,ra=>{const Ga=this.renderCoordsHelper.spatialReference;k.isSome(ra)&&(0!==ra[0]||0!==ra[1]||0!==ra[2]||0!==ra[3])&&M.projectBoundingRect(ra,this.basemapTerrain.spatialReference,rb,Ga)&&(this.renderCoordsHelper.extent=rb)},C.sync),"render-coords-helper"),
this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Sa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};cb._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",null),this._set("mapCoordsHelper",null))};cb._updatingChanged=function(){this.notifyChange("updating")};cb._updateUpdatingMonitors=function(Ka=null){k.isSome(Ka)&&
Ka.type===p.ObservableChangesType.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(Ha=>{Ha.destroyed||(this.handles.add(C.watch(()=>[Ha.updating,Ha.updatingProgress],()=>this._updatingChanged(),C.sync),"updatingMonitors"),Ha.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())};cb._prepareScreenshotOverlay=function(){var Ka=c._asyncToGenerator(function*(){this.overlay&&(yield this.overlay.prepare())});return function(){return Ka.apply(this,
arguments)}}();cb._renderScreenshotOverlay=function(Ka,Ha){if(!this.overlay||!this.overlay.hasVisibleItems)return Ha;const ra=Ka.getContext("2d");ra.putImageData(Ha,0,0);this.overlay.renderCanvas(Ka);return ra.getImageData(0,0,Ha.width,Ha.height)};cb._initStage=function(){var Ka={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,
screenshot:{prepareOverlay:()=>this._prepareScreenshotOverlay(),renderOverlay:(ra,Ga)=>this._renderScreenshotOverlay(ra,Ga)}},Ha=new fa.SceneIntersectionHelper(this.state.viewingMode,ra=>this._stage.layers.forAll(ra),this);this._set("sceneIntersectionHelper",Ha);Ha=f.byId(this.surface);this._stage=new Ja.Stage({view:this,options:Ka,container:Ha});this._stage.renderer.setParameters({slicePlane:this.slicePlane});this._lostWebGLContextHandle=g.on(this._stage.renderView.canvas,"webglcontextlost",()=>
this.fatalError=new e("webgl-context-lost"));this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderer.setParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),C.initial),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,ra=>this._stage.renderer.setParameters({highQualityTransparency:ra}),C.initial),C.watch(()=>this.magnifier,ra=>this._stage.renderView.magnifier=ra,C.syncAndInitial),this.on("pointer-move",
()=>this._stage?.renderer.resetAnimation())],"stage");Ka=()=>{this._stage.renderer.setParameters({defaultHighlightOptions:va.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],Ka),"stage");Ka();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Sa.DEFAULT_TOLERANCE/
this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};cb._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage=k.destroyMaybe(this._stage);this._lostWebGLContextHandle=k.removeMaybe(this._lostWebGLContextHandle);this.handles.remove("stage");this._set("canvas",null)};cb._initSurface=function(Ka){this._exitSurface();this.state.init(Ka,this.spatialReference);this._initStage();this._initGlobe();this.sharedSymbolResources=new Ea.SharedSymbolResources({view:this,
viewingMode:Ka,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state})};cb._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};cb._createGraphicsViewIfNeeded=function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");
this._createGraphicsViewController=new AbortController;var Ka=()=>{this._createGraphicsViewController=null;this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Ka,Ka);this._updatingChanged()}};cb._createGraphicsViewAsync=function(){var Ka=c._asyncToGenerator(function*(Ha){const ra=(yield new Promise((Ga,Pa)=>a(["./3d/layers/GraphicsView3D"],Ra=>Ga(ob(Ra)),Pa))).default;z.throwIfAborted(Ha);yield C.whenOnce(()=>this.basemapTerrain?.ready,Ha);this._set("graphicsView",
new ra({view:this}))});return function(Ha){return Ka.apply(this,arguments)}}();cb._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");k.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),this.graphicsView.destroy(),this._set("graphicsView",null))};cb._startup=function(){var Ka=W.viewingModeFromString(this.viewingMode);Ka===W.ViewingMode.Global&&
(this._clippingArea=null);this._initSurface(Ka);this._set("ready",!0);this.handles.add(C.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(Ka=this.get("map.initialViewProperties.environment"))&&(this.environment=Ka);this.labeler.setup();this.environmentManager.connectView(this);this.inputManager.connect();Ka=this._resolveWhenReady;this._resolveWhenReady=[];Ka.forEach(Ha=>Ha(this))};cb._teardown=
function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};cb._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&this._defaultToMapOptions.include.add(Ya.TERRAIN_ID);for(const Ka of this.map.allLayers.items)"integrated-mesh"===Ka.type&&this._defaultToMapOptions.include.add(Ka.uid)}};
cb._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(Ya.TERRAIN_ID);for(const Ka of this.map.allLayers.items)"integrated-mesh"===Ka.type&&1>Ka.opacity&&this._defaultHitTestOptions.exclude.add(Ka.uid)}};cb.addVoxelLayerViewToWasm=function(Ka){return k.isNone(this.voxelWasm)?(k.isNone(this.voxelWasmPromise)&&(this.voxelWasmPromise=(new Promise((Ha,ra)=>a(["../layers/VoxelWasmPerSceneView"],
Ga=>Ha(ob(Ga)),ra))).then(Ha=>this.voxelWasm=new Ha.default(this))),this.voxelWasmPromise.then(Ha=>Ha.addVoxelLayer(Ka))):this.voxelWasm.addVoxelLayer(Ka)};cb.removeVoxelLayerViewFromWasm=function(Ka){k.isSome(this.voxelWasm)&&1>this.voxelWasm.removeVoxelLayer(Ka)&&(this.voxelWasmPromise=this.voxelWasm=null)};c._createClass(eb,[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},{key:"basemapSpatialReference",get:function(){return this.basemapTerrain?.spatialReference}},
{key:"animation",get:function(){return this.state?.animation}},{key:"camera",get:function(){return this.stateManager?.camera},set:function(Ka){this.stateManager&&(this.stateManager.camera=Ka)}},{key:"contentCamera",get:function(){return this.stateManager?.contentCamera},set:function(Ka){this.stateManager&&(this.stateManager.contentCamera=Ka)}},{key:"center",get:function(){return this.stateManager?.center},set:function(Ka){this.stateManager&&(this.stateManager.center=Ka)}},{key:"clippingArea",get:function(){if("global"===
this.viewingMode)return null;let Ka=this._userClippingArea||("clippingArea"in this.map?this.map?.clippingArea:void 0);if(!this._userClippingArea&&!this.get("map.clippingEnabled")||k.isNone(Ka))return this._clippingArea=null;if(!(Ka instanceof fb))return q.getLogger(this.declaredClass).error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(Ka=lb(Ka,this.spatialReference),k.isNone(Ka)))return q.getLogger(this.declaredClass).error("#clippingArea",
"setting clippingArea with incompatible SpatialReference"),this._clippingArea;Ka=Ka.clone();k.isNone(Ka.intersection(this._groundAndLayersExtent))&&(Ka.xmin=Ka.xmax,Ka.ymin=Ka.ymax);Ka.zmin=void 0;Ka.zmax=void 0;Ka.equals(this._clippingArea)||(this._clippingArea=Ka);return this._clippingArea},set:function(Ka){this.ready&&"global"===this.viewingMode&&k.isSome(Ka)?q.getLogger(this.declaredClass).error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=
Ka}},{key:"renderDataExtent",get:function(){if(this.state.viewingMode===W.ViewingMode.Global)return null;const Ka=this.renderSpatialReference,Ha=this.dataExtent;return k.isNone(Ha)||k.isNone(Ka)||Ha.spatialReference.equals(Ka)?Ha:lb(Ha,Ka)}},{key:"dataExtent",get:function(){let Ka=this._groundAndLayersExtent;var Ha=lb(this.clippingArea,this.spatialReference||Xa.WGS84);k.isSome(Ha)&&(Ka=k.isSome(Ka)?Ka.intersection(Ha):Ha);Ha=this._get("dataExtent");return k.isSome(Ka)&&Ka.equals(Ha)?Ha:Ka}},{key:"_groundAndLayersExtent",
get:function(){const Ka=this.spatialReference||Xa.WGS84;let Ha;const ra=Pa=>{Pa=lb(Pa,Ka);k.isNone(Pa)||(k.isSome(Ha)?Ha.union(Pa):Ha=Pa.clone())};var Ga=this.basemapTerrain;if(Ga?.spatialReference){const Pa=Ga.groundExtent;ra(new fb({xmin:Pa[0],ymin:Pa[1],zmin:0,xmax:Pa[2],ymax:Pa[3],zmax:0,spatialReference:Ga.spatialReference}))}this.map&&this.map.allLayers.forEach(Pa=>{!k.isSome(Pa.fullExtent)||"graphics"===Pa.type&&Pa.internal||ra(Pa.fullExtent)});if(k.isNone(Ha))return null;Ha.hasZ?(Ha.zmin=
Math.min(0,Ha.zmin??0),Ha.zmax=Math.max(0,Ha.zmax??0)):(Ha.zmin=0,Ha.zmax=0);Ga=this._get("_groundAndLayersExtent");return Ha.equals(Ga)?Ga:Ha}},{key:"environment",set:function(Ka){Ka!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Ka)}},{key:"extent",get:function(){return this.stateManager?.extent},set:function(Ka){this.stateManager&&(this.stateManager.extent=Ka)}},{key:"screenCenter",get:function(){return this.stateManager?.screenCenter}},{key:"frustum",
get:function(){return this.stateManager?.frustum}},{key:"initialExtentRequired",get:function(){return this.stateManager&&!this.stateManager.hasInitialView}},{key:"_defaultsFromMapSettings",get:function(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}},{key:"interacting",get:function(){return this.navigating||k.isSome(this.activeTool)&&this.activeTool.visible}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(k.isNone(this.state)||this.state.stationary)}},{key:"navigating",
get:function(){return this.state?.navigating??!1}},{key:"padding",get:function(){return this.stateManager?.padding},set:function(Ka){this.stateManager&&(this.stateManager.padding=Ka)}},{key:"qualityProfile",get:function(){return this._get("qualityProfile")||na.getDefaultProfile()},set:function(Ka){na.isValidProfile(Ka)&&(na.apply(Ka,this.qualitySettings),this._set("qualityProfile",Ka))}},{key:"slicePlane",set:function(Ka){k.isSome(this._stage)&&this._stage.renderer.setParameters({slicePlane:Ka});
if(k.isNone(Ka))this._set("slicePlane",null);else{var Ha=this._propertiesPool.get("slicePlane");P.copy(Ka,Ha);this._set("slicePlane",Ha)}}},{key:"typeSpecificPreconditionsReady",get:function(){return!!this.viewingMode}},{key:"resolution",get:function(){return null!=this.spatialReference?G.getResolutionForScale(this.scale,this.spatialReference):0}},{key:"scale",get:function(){return this.stateManager?.scale},set:function(Ka){this.stateManager&&(this.stateManager.scale=Ka)}},{key:"heightModelInfo",
get:function(){const Ka=this.getDefaultHeightModelInfo();return null!=Ka?J.deriveUnitFromSR(Ka,this.spatialReference):null}},{key:"updating",get:function(){if(this.destroyed)return!1;let Ka=0,Ha=this.layerViewManager.updating,ra=Ha?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(Ra=>{Ra.isFulfilled()?Ra.updating&&(Ha=!0,Ra.suspended||Oa.isSurfaceLayerView(Ra)||(++ra,Ka+=Ra.updatingProgress)):++ra});for(var Ga of[this.graphicsView,this.basemapView,this._resourceController,this._stage,
this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this._featureTreeDebugger,this.toolViewManager,this.analysisViewManager])k.isSome(Ga)&&Ga.updating&&(ra+=.1,Ka+=.05);for(var Pa of[this.deconflictor,this.labeler,this.basemapTerrain])k.isSome(Pa)&&Pa.updating&&(++ra,Ka+=Pa.updatingProgress);Ga=this.stateManager.test.updatingIgnoreRenderState?Aa.RenderState.IDLE:this.state.mode;(Ha=!!(Ha||0<ra||this.updatingHandles.updating||!this.ready||!this.stationary||Ga!==Aa.RenderState.IDLE||
this._createGraphicsViewController||this.inputManager?.hasPendingInputs||this.map?.allLayers?.some(Ra=>!Ra.isFulfilled())))?(this._numUpdating=Math.max(ra,this._numUpdating),Ka+=this._numUpdating-ra):this._numUpdating=0;Ka=0<this._numUpdating?Ka/this._numUpdating:Ha?0:1;this._get("updatingProgress")!==Ka&&(Ga=performance.now(),1>Ka&&(Pa=Math.min((Ga-this._lastUpdateTime)/2E3,1),Ka=this.updatingProgress*(1-Pa)+Ka*Pa),this._set("updatingProgress",Ka),this._lastUpdateTime=Ha&&1>Ka?Ga:0);return Ha}},
{key:"viewingMode",get:function(){var Ka=this._predeterminedViewingMode;return k.isSome(Ka)?W.stringFromViewingMode(Ka):(Ka=this.spatialReference)?k.isSome(this.defaultsFromMap?.viewingMode)&&Ka.equals(this.defaultsFromMap.spatialReference)?W.stringFromViewingMode(this.defaultsFromMap.viewingMode):ya.isSpatialReferenceSupported(Ka,W.ViewingMode.Global)?"global":"local":"global"},set:function(Ka){this.ready?q.getLogger(this.declaredClass).error("#viewingMode","viewingMode cannot be set once view is ready"):
this._overrideIfSome("viewingMode",Ka)}},{key:"viewpoint",get:function(){return this.stateManager?.viewpoint},set:function(Ka){this.stateManager&&(this.stateManager.viewpoint=Ka)}},{key:"zoom",get:function(){return this.stateManager.zoom},set:function(Ka){this.stateManager&&(this.stateManager.zoom=Ka)}},{key:"resourceController",get:function(){return this._resourceController}},{key:"performanceInfo",get:function(){return new xa(this)}},{key:"test",get:function(){return{takeScreenshot:Ka=>this._takeScreenshot(Ka),
takeScreenshotWithObjectAndLayerId:Ka=>this._takeScreenshotWithObjectAndLayerId(Ka)}}},{key:"_predeterminedViewingMode",get:function(){const Ka=this._isOverridden("viewingMode")?this._get("viewingMode"):(this.map&&"initialViewProperties"in this.map?this.map.initialViewProperties?.viewingMode:null)??null;return k.isSome(Ka)?W.viewingModeFromString(Ka):null}}]);return eb}(S.BreakpointsOwner(R.DOMContainer(V.PopupView(aa))));n.type="3d";b.__decorate([u.property()],n.prototype,"_userClippingArea",void 0);
b.__decorate([u.property()],n.prototype,"_resourceController",void 0);b.__decorate([u.property()],n.prototype,"_stage",void 0);b.__decorate([u.property({readOnly:!0})],n.prototype,"deconflictor",void 0);b.__decorate([u.property({readOnly:!0})],n.prototype,"labeler",void 0);b.__decorate([u.property(K.owningCollectionProperty(O.AnalysesCollection,"analyses"))],n.prototype,"analyses",void 0);b.__decorate([u.property({type:X,readOnly:!0})],n.prototype,"animation",null);b.__decorate([u.property({readOnly:!0})],
n.prototype,"basemapTerrain",void 0);b.__decorate([u.property({readOnly:!0})],n.prototype,"elevationProvider",void 0);b.__decorate([u.property()],n.prototype,"camera",null);b.__decorate([u.property({type:t})],n.prototype,"contentCamera",null);b.__decorate([u.property({readOnly:!0})],n.prototype,"canvas",void 0);b.__decorate([u.property({type:db})],n.prototype,"center",null);b.__decorate([u.property({type:fb})],n.prototype,"clippingArea",null);b.__decorate([u.property({type:Y.Constraints})],n.prototype,
"constraints",void 0);b.__decorate([u.property({type:fb,readOnly:!0})],n.prototype,"renderDataExtent",null);b.__decorate([u.property({type:fb,readOnly:!0})],n.prototype,"dataExtent",null);b.__decorate([u.property({type:fb,readOnly:!0})],n.prototype,"_groundAndLayersExtent",null);b.__decorate([u.property({value:null,type:ba})],n.prototype,"environment",null);b.__decorate([y.cast("environment")],n.prototype,"castEnvironment",null);b.__decorate([u.property({readOnly:!0})],n.prototype,"environmentManager",
void 0);b.__decorate([u.property({type:fb})],n.prototype,"extent",null);b.__decorate([u.property()],n.prototype,"floors",void 0);b.__decorate([u.property()],n.prototype,"screenCenter",null);b.__decorate([u.property()],n.prototype,"frustum",null);b.__decorate([u.property({type:Number,readOnly:!0})],n.prototype,"fullOpacity",void 0);b.__decorate([u.property({readOnly:!0})],n.prototype,"graphicsView",void 0);b.__decorate([u.property({readOnly:!0})],n.prototype,"analysisViewManager",void 0);b.__decorate([u.property()],
n.prototype,"groundView",void 0);b.__decorate([u.property({type:Boolean})],n.prototype,"initialExtentRequired",null);b.__decorate([u.property()],n.prototype,"_defaultsFromMapSettings",null);b.__decorate([u.property()],n.prototype,"interacting",null);b.__decorate([u.property()],n.prototype,"stationary",null);b.__decorate([u.property()],n.prototype,"navigating",null);b.__decorate([u.property()],n.prototype,"map",void 0);b.__decorate([u.property({readOnly:!0})],n.prototype,"mapCoordsHelper",void 0);
b.__decorate([u.property()],n.prototype,"padding",null);b.__decorate([u.property({type:Ia.PointsOfInterest,readOnly:!0})],n.prototype,"pointsOfInterest",void 0);b.__decorate([u.property({type:ia.FeatureTileTree3D,readOnly:!0})],n.prototype,"featureTiles",void 0);b.__decorate([u.property()],n.prototype,"_featureTreeDebugger",void 0);b.__decorate([u.property({type:Boolean})],n.prototype,"screenSizePerspectiveEnabled",void 0);b.__decorate([u.property({constructOnly:!0})],n.prototype,"deactivatedWebGLExtensions",
void 0);b.__decorate([u.property({constructOnly:!0})],n.prototype,"debugWebGLExtensions",void 0);b.__decorate([u.property({constructOnly:!0})],n.prototype,"renderCanvas",void 0);b.__decorate([u.property({constructOnly:!0})],n.prototype,"state",void 0);b.__decorate([u.property({readOnly:!0})],n.prototype,"inputManager",void 0);b.__decorate([u.property({readOnly:!0})],n.prototype,"stateManager",void 0);b.__decorate([u.property({type:["low","medium","high"]})],n.prototype,"qualityProfile",null);b.__decorate([u.property({type:sa,
get(){let mb=this._get("qualitySettings");mb||(mb=new sa,na.apply(this.qualityProfile,mb));return mb}})],n.prototype,"qualitySettings",void 0);b.__decorate([u.property()],n.prototype,"slicePlane",null);b.__decorate([u.property({readOnly:!0})],n.prototype,"typeSpecificPreconditionsReady",null);b.__decorate([u.property({readOnly:!0})],n.prototype,"renderCoordsHelper",void 0);b.__decorate([u.property({readOnly:!0})],n.prototype,"sceneIntersectionHelper",void 0);b.__decorate([u.property({type:Number,
dependsOn:["scale","spatialReference"],readOnly:!0})],n.prototype,"resolution",null);b.__decorate([u.property({type:Number})],n.prototype,"scale",null);b.__decorate([u.property()],n.prototype,"heightModelInfo",null);b.__decorate([u.property()],n.prototype,"spatialReference",void 0);b.__decorate([u.property({type:Boolean,constructOnly:!0})],n.prototype,"alphaCompositingEnabled",void 0);b.__decorate([u.property({constructOnly:!0})],n.prototype,"preserveDrawingBufferEnabled",void 0);b.__decorate([u.property({type:Boolean})],
n.prototype,"supersampleScreenshotsEnabled",void 0);b.__decorate([u.property({readOnly:!0})],n.prototype,"type",void 0);b.__decorate([u.property({type:La})],n.prototype,"ui",void 0);b.__decorate([u.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs toolViewManager.updating analysisViewManager.updating state.mode".split(" ")})],
n.prototype,"updating",null);b.__decorate([u.property({type:Number,readOnly:!0,dependsOn:["updating"]})],n.prototype,"updatingProgress",void 0);b.__decorate([u.property({type:["global","local"]})],n.prototype,"viewingMode",null);b.__decorate([u.property({type:m})],n.prototype,"viewpoint",null);b.__decorate([u.property({type:Number})],n.prototype,"zoom",null);b.__decorate([u.property({type:va})],n.prototype,"highlightOptions",void 0);n=b.__decorate([D.subclass("esri.views.SceneView")],n);var xb;(function(mb){mb[mb.INCLUDE=
0]="INCLUDE";mb[mb.EXCLUDE=1]="EXCLUDE"})(xb||(xb={}));const Nb=E.create(),Bb=A.createScreenPointArray(),rb=N.create();return n});