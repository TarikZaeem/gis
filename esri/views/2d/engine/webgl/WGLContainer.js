// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3f32 ../brushes ../Container ./ClippingInfo ./enums".split(" "),function(k,u,h,p,q,r,t,d){return function(f){function g(){var a=f.apply(this,arguments)||this;a.name=a.constructor.name;return a}k._inheritsLoose(g,f);var c=g.prototype;c.beforeRender=function(a){f.prototype.beforeRender.call(this,a);this.updateTransforms(a.state)};c._createTransforms=function(){return{dvs:p.create()}};
c.doRender=function(a){a=this.createRenderParams(a);const {painter:b,globalOpacity:e,profiler:l,drawPhase:m}=a,n=m===d.WGLDrawPhase.LABEL||m===d.WGLDrawPhase.HIGHLIGHT?1:e*this.computedOpacity;l.recordContainerStart(this.name);b.beforeRenderLayer(a,this._clippingInfos?255:0,n);this.renderChildren(a);b.compositeLayer(a,n);l.recordContainerEnd()};c.renderChildren=function(a){h.isNone(this._renderPasses)&&(this._renderPasses=this.prepareRenderPasses(a.painter));for(const b of this._renderPasses)try{b.render(a)}catch(e){}};
c.createRenderParams=function(a){a.requireFBO=this.requiresDedicatedFBO;return a};c.prepareRenderPasses=function(a){return[a.registerRenderPass({name:"clip",brushes:[q.brushes.clip],target:()=>this._clippingInfos,drawPhase:d.WGLDrawPhase.MAP|d.WGLDrawPhase.LABEL|d.WGLDrawPhase.LABEL_ALPHA|d.WGLDrawPhase.DEBUG|d.WGLDrawPhase.HIGHLIGHT})]};c.updateTransforms=function(a){for(const b of this.children)b.setTransform(a)};c.onAttach=function(){f.prototype.onAttach.call(this);this._updateClippingInfo()};
c.onDetach=function(){f.prototype.onDetach.call(this);this._updateClippingInfo()};c._updateClippingInfo=function(){h.isSome(this._clippingInfos)&&(this._clippingInfos.forEach(e=>e.destroy()),this._clippingInfos=null);const a=this.stage;if(a){var b=this._clips;h.isSome(b)&&b.length&&(this._clippingInfos=b.items.map(e=>t.fromClipArea(a,e)));this.requestRender()}};k._createClass(g,[{key:"clips",set:function(a){this._clips=a;this.children.forEach(b=>b.clips=a);this._updateClippingInfo()}}]);return g}(r.Container)});