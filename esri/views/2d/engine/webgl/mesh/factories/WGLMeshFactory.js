// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/has ../../../../../../core/maybe ../../../../../../core/promiseUtils ../../../../../../geometry/libtess ../../DisplayId ../templates/WGLLabelTemplate ../templates/WGLMarkerTemplate ../templates/WGLTemplateStore".split(" "),function(v,r,w,p,x,z,A,y,B,q){w=function(){function t(c,a,b){this._loadPromise=z.loadLibtess();this._geometryType=c;this._idField=a;this._templateStore=b}var m=t.prototype;m.update=function(c,
a){p.isSome(c.mesh.labels)&&(this._labelTemplates=this._createLabelTemplates(c.mesh.labels,a));this._schema=c};m._createLabelTemplates=function(c,a){const b=new Map;if("simple"===c.type){for(var d of c.classes)c=y.fromLabelClass(d,a),b.set(d.index,c);return b}for(const g in c.classes){d=c.classes[g];for(const e of d)d=y.fromLabelClass(e,a),b.set(e.index,d)}return b};m.analyze=function(){var c=r._asyncToGenerator(function*(a,b,d,g,e,f,h){if(!x.isAborted(h)){var l;"dictionary"===d?.type&&(l=yield d.analyze(this._idField,
a.copy(),b,e,f,h));for(b=0;a.next();){var k=null;k=l?l[b++]:p.isSome(g)&&A.isAggregateId(a.getDisplayId())&&1!==a.readAttribute("cluster_count")?g.match(this._idField,a,this._geometryType,e,f):d.match(this._idField,a,this._geometryType,e,f);a.setGroupId(k);if(q.isDynamicId(k)){k=this._templateStore.getDynamicTemplateGroup(k).templates;for(const n of k)n&&n.analyze&&n.analyze(this._templateStore,a,e,f)}}yield this._loadPromise;return this._templateStore.finalize(h)}});return function(a,b,d,g,e,f,h){return c.apply(this,
arguments)}}();m.analyzeGraphics=function(){var c=r._asyncToGenerator(function*(a,b,d,g,e,f){if(!x.isAborted(f)){a=a.getCursor();for(d&&(yield d.analyze(this._idField,a.copy(),b,g,e,f));a.next();){b=a.getGroupId();if(null==b||-1===b)b=d?.match(this._idField,a,a.geometryType,g,e),a.setGroupId(b);if(q.isDynamicId(b)){const h=this._templateStore.getDynamicTemplateGroup(b).templates;for(const l of h)l&&l.analyze&&l.analyze(this._templateStore,a,g,e)}a.setGroupId(b)}yield this._loadPromise;return this._templateStore.finalize(f)}});
return function(a,b,d,g,e,f){return c.apply(this,arguments)}}();m.writeGraphic=function(c,a,b,d){const g=a.getGroupId(),e=a.getDisplayId(),f=this._templateStore.getTemplateGroup(g);c.featureStart(a.insertAfter,0);if(null!=e){if(q.isDynamicId(g))for(const h of f.templates)h&&h.bindFeature(a,null,null);if(f){for(const h of f.templates)h&&h.write(c,a,b,d);c.featureEnd()}}};m.writeCursor=function(c,a,b,d,g,e,f){const h=a.getGroupId(),l=a.getDisplayId();var k=this._templateStore.getTemplateGroup(h);const n=
k.templates;k=this._getSortKeyValue(a,k);c.featureStart(0,k);if(null!=l&&n){if(q.isDynamicId(h))for(const u of n)u.bindFeature(a,b,d);for(const u of n)u.write(c,a,g,f);p.isSome(e)&&c.hasRecords&&(b=e&&this._findLabelRef(n),this._writeLabels(c,a,e,b,g,f));c.featureEnd()}};m._getSortKeyValue=function(c,a){const b=this._schema.mesh.sortKey;if(p.isNone(b))return 0;let d=0;d=!0===b.byRenderer&&null!=a.sortKey?a.sortKey:null!=b.fieldIndex?c.getComputedNumericAtIndex(b.fieldIndex):null!=b.field?c.readAttribute(b.field):
c.readAttribute(this._idField);d*="asc"===b.order?1:-1;return null==d||isNaN(d)?0:d};m._findLabelRef=function(c){for(const a of c)if(a instanceof B)return a;return null};m._writeLabels=function(c,a,b,d,g,e){for(const f of b)if(p.isSome(f)&&f){const {glyphs:h,rtl:l,index:k}=f;if(b=this._labelTemplates.get(k))b.setZoomLevel(g),b.bindReferenceTemplate(d),b.bindTextInfo(h,l),b.write(c,a,null,e)}};r._createClass(t,[{key:"templates",get:function(){return this._templateStore}}]);return t}();v.WGLMeshFactory=
w;Object.defineProperty(v,Symbol.toStringTag,{value:"Module"})});