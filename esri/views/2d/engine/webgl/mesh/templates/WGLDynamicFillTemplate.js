// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../core/maybe ../../../../../../core/screenUtils ../../color ../../definitions ../../GeometryUtils ../../number ../../materialKey/MaterialKey ./util ./WGLBaseFillTemplate ./WGLDynamicMeshTemplate ../../util/Result".split(" "),function(A,B,p,x,k,y,q,C,l,D,E,F){return function(z){function u(a,c,r){var b=z.call(this,a)||this;b._minMaxZoom=q.i1616to32(Math.round(c*k.MIN_MAX_ZOOM_PRECISION_FACTOR),Math.round(r*k.MIN_MAX_ZOOM_PRECISION_FACTOR));
l.isFunction(a.color)?b._dynamicPropertyMap.set("fillColor",(d,f,g)=>(d=a.color(d,f,g))&&x.premultiplyAlphaRGBA(d)||0):(c=a.color,b.fillColor=c&&x.premultiplyAlphaRGBA(c)||0);const h="CIMMarkerPlacementInsidePolygon"===a.cim.placement?.type&&a.cim.placement.shiftOddRows?2:1,e=a.height;l.isFunction(e)?b._dynamicPropertyMap.set("_height",(d,f,g)=>e(d,f,g)*h):b._height=(e||0)*h;const m=a.offsetX;l.isFunction(m)?b._dynamicPropertyMap.set("_offsetX",(d,f,g)=>p.pt2px(m(d,f,g))):b._offsetX=p.pt2px(m||0);
const n=a.offsetY;l.isFunction(n)?b._dynamicPropertyMap.set("_offsetY",(d,f,g)=>p.pt2px(-n(d,f,g))):b._offsetY=p.pt2px(-n||0);c=a.scaleX;l.isFunction(c)?b._dynamicPropertyMap.set("_scaleX",c):b._scaleX=c||1;const t=a.angle;l.isFunction(t)?b._dynamicPropertyMap.set("_angle",(d,f,g)=>y.degToByte(t(d,f,g))):b._angle=y.degToByte(t)||0;B.isSome(a.effects)&&(c=a.effects,l.isFunction(c)?b._dynamicPropertyMap.set("_effects",c):b._effects=c);b._cimFillLayer=a;b._bitset=(a.colorLocked?k.BITSET_GENERIC_LOCK_COLOR:
0)|(a.applyRandomOffset?k.BITSET_FILL_RANDOM_PATTERN_OFFSET:0)|(a.sampleAlphaOnly?k.BITSET_GENERIC_CONSIDER_ALPHA_ONLY:0)|(a.hasUnresolvedReplacementColor?k.BITSET_FILL_HAS_UNRESOLVED_REPLACEMENT_COLOR:0);b._fillMaterialKey=a.materialKey;return b}A._inheritsLoose(u,z);u.fromCIMFill=function(a,c){const [r,b]=l.getMinMaxZoom(a.scaleInfo,c);return new u(a,r,b)};u.prototype.bindFeature=function(a,c,r){const b=a.readLegacyFeature();this._dynamicPropertyMap.forEach((m,n)=>{this[n]=m(b,c,r)});a=C.FillMaterialKey.load(this._fillMaterialKey);
var h=this._materialCache,e=this._cimFillLayer.materialHash;e=e(b,c,r);e=h.get(e);h=null;e&&F.ok(e.spriteMosaicItem)&&(h=e.spriteMosaicItem);if(h){const {rect:m,width:n,height:t}=h;e=m.x+k.SPRITE_PADDING;const d=m.y+k.SPRITE_PADDING,f=e+n,g=d+t;let v=Math.round(p.pt2px(this._height));0>=v&&(v=g-d);let w=Math.round(p.pt2px(this._height/t*n||0));0>=w&&(w=f-e);const G=this._scaleX;this.tl=q.i1616to32(e,d);this.br=q.i1616to32(f,g);this.aux21=q.i1616to32(w,v);this.aux22=q.i1616to32(this._offsetX,this._offsetY);
this.aux3=q.i8888to32(128*G,128,this._angle,0);a.sdf=h.sdf;a.pattern=!0;a.textureBinding=h.textureBinding}else this.aux3=this.aux22=this.aux21=this.br=this.tl=0,a.sdf=!1,a.pattern=!1,a.textureBinding=0;this._materialKey=a.data};return u}(D(E))});