// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../../../../../core/maybe ../../../../../../core/screenUtils ../../VertexStream ../../../../../webgl/enums ../../../../../webgl/FramebufferObject ../../../../../webgl/Texture".split(" "),function(q,n,r,A,b,t,B){const C=[1,0],D=[0,1];let I=function(){function u(){this._verticalBlurFBO=this._horizontalBlurFBO=this._layerFBOTexture=null;this._size=[0,0];this._quad=null;this._programDesc={blur:{vsPath:"post-processing/pp",fsPath:"post-processing/blur/gaussianBlur",attributes:new Map([["a_position",
0]])},composite:{vsPath:"post-processing/pp",fsPath:"post-processing/drop-shadow/composite",attributes:new Map([["a_position",0]])},blit:{vsPath:"post-processing/pp",fsPath:"post-processing/blit",attributes:new Map([["a_position",0]])}}}var p=u.prototype;p.dispose=function(){this._layerFBOTexture=n.disposeMaybe(this._layerFBOTexture);this._horizontalBlurFBO=n.disposeMaybe(this._horizontalBlurFBO);this._verticalBlurFBO=n.disposeMaybe(this._verticalBlurFBO)};p.draw=function(d,c,e){const {context:a,
state:E,painter:F}=d,{materialManager:v}=F,w=this._programDesc,k=c.width,l=c.height,m=[Math.round(k),Math.round(l)],{blurRadius:x,offsetX:G,offsetY:H,color:f}=e;e=[r.pt2px(G),r.pt2px(H)];this._createOrResizeResources(d,k,l,m);const y=this._horizontalBlurFBO;d=this._verticalBlurFBO;a.setStencilWriteMask(0);a.setStencilTestEnabled(!1);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);const z=this._layerFBOTexture;c.copyToTexture(0,0,k,l,0,0,z);this._quad||(this._quad=new A(a,[-1,-1,1,-1,-1,1,1,1]));
a.setViewport(0,0,m[0],m[1]);const h=this._quad;h.bind();a.setBlendingEnabled(!1);const g=v.getProgram(w.blur,[{name:"radius",value:Math.ceil(x)}]);a.useProgram(g);a.bindFramebuffer(y);a.bindTexture(c.colorTexture,4);g.setUniform1i("u_colorTexture",4);g.setUniform2fv("u_texSize",m);g.setUniform2fv("u_direction",C);g.setUniform1f("u_sigma",x);h.draw();a.bindFramebuffer(d);a.bindTexture(y?.colorTexture,5);g.setUniform1i("u_colorTexture",5);g.setUniform2fv("u_direction",D);h.draw();a.bindFramebuffer(c);
a.setViewport(0,0,k,l);c=v.getProgram(w.composite);a.useProgram(c);a.bindTexture(d?.colorTexture,2);c.setUniform1i("u_blurTexture",2);a.bindTexture(z,3);c.setUniform1i("u_layerFBOTexture",3);c.setUniform4fv("u_shadowColor",[f[0]/255*f[3],f[1]/255*f[3],f[2]/255*f[3],f[3]]);c.setUniformMatrix3fv("u_displayViewMat3",E.displayMat3);c.setUniform2fv("u_shadowOffset",e);h.draw();a.setBlendingEnabled(!0);a.setStencilTestEnabled(!0);a.setBlendFunction(b.BlendFactor.ONE,b.BlendFactor.ONE_MINUS_SRC_ALPHA);h.unbind()};
p._createOrResizeResources=function(d,c,e,a){({context:d}=d);this._horizontalBlurFBO&&this._size[0]===c&&this._size[1]===e||(this._size[0]=c,this._size[1]=e,this._horizontalBlurFBO?this._horizontalBlurFBO.resize(a[0],a[1]):this._horizontalBlurFBO=new t.FramebufferObject(d,{colorTarget:b.TargetType.TEXTURE,depthStencilTarget:b.DepthStencilTargetType.NONE,width:a[0],height:a[1]},{target:b.TextureType.TEXTURE_2D,pixelFormat:b.PixelFormat.RGBA,internalFormat:b.PixelFormat.RGBA,dataType:b.PixelType.UNSIGNED_BYTE,
wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:b.TextureSamplingMode.LINEAR,flipped:!1,width:a[0],height:a[1]}),this._verticalBlurFBO?this._verticalBlurFBO.resize(a[0],a[1]):this._verticalBlurFBO=new t.FramebufferObject(d,{colorTarget:b.TargetType.TEXTURE,depthStencilTarget:b.DepthStencilTargetType.NONE,width:a[0],height:a[1]},{target:b.TextureType.TEXTURE_2D,pixelFormat:b.PixelFormat.RGBA,internalFormat:b.PixelFormat.RGBA,dataType:b.PixelType.UNSIGNED_BYTE,wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,
samplingMode:b.TextureSamplingMode.LINEAR,flipped:!1,width:a[0],height:a[1]}),this._layerFBOTexture?this._layerFBOTexture.resize(c,e):this._layerFBOTexture=new B.Texture(d,{target:b.TextureType.TEXTURE_2D,pixelFormat:b.PixelFormat.RGBA,internalFormat:b.PixelFormat.RGBA,dataType:b.PixelType.UNSIGNED_BYTE,wrapMode:b.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:b.TextureSamplingMode.LINEAR,flipped:!1,width:c,height:e}))};return u}();q.DropShadow=I;Object.defineProperty(q,Symbol.toStringTag,{value:"Module"})});