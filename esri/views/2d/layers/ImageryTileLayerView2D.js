// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/rasterDatasets/multidimensionalUtils":function(){define(["exports","../../../core/maybe","../DimensionalDefinition"],function(C,H,A){function r(D,e,d){const c=e.shift();0===d.length&&d.push({sliceId:-1,multidimensionalDefinition:[]});const g=d.length;for(let t=0;t<g;t++){const N=d.shift().multidimensionalDefinition;c.values?.forEach(a=>{d.push({sliceId:-1,multidimensionalDefinition:[...N,{variableName:D,dimensionName:c.name,values:[a]}]})})}e.length&&r(D,e,d)}
function m(D,e){return Array.isArray(D)?e[0]===e[1]?D[0]===e[0]||D[1]===e[0]:D[0]>=e[0]&&D[0]<=e[1]&&D[1]>=e[0]&&D[1]<=e[1]:D>=e[0]&&D<=e[1]}function G(D,e){return D[0]<=e[0]&&D[1]>=e[0]||D[0]<=e[1]&&D[1]>=e[1]||D[0]>=e[0]&&D[1]<=e[1]}function q(D){return 1===D.length?[D[0],D[0]]:[D[0],D[D.length-1]]}function J(D,e,d){if(!e?.subsetDefinitions?.length)return D;if(d){const {variables:g}=e;if(g.length&&!g.includes(d))return null;e=e.subsetDefinitions.find(t=>t.dimensionName===D.name&&t.variableName===
d);if(!e?.values?.length)return D;e=q(e.values)}else e=e.dimensions.find(({name:g})=>g===D.name)?.extent;const c=e;if(!c||!c?.length)return D;e=D.values.filter(g=>m(g,c));return{...D,extent:[...c],values:e}}function B(D,e,d){if(!e?.subsetDefinitions?.length)return!1;const {variables:c}=e;if(c.length&&D.some(({variableName:g})=>g&&!c.includes(g)))return!0;for(let g=0;g<D.length;g++){const t=D[g],N=e.subsetDefinitions.find(a=>(""===t.variableName||a.variableName===t.variableName)&&a.dimensionName===
t.dimensionName);if(N?.values.length){const a=q(N.values);if(!t.isSlice&&2===t.values.length&&!Array.isArray(t.values[0])&&t.values[0]!==t.values[1]&&d){if(!G(t.values,a))return!0}else if(t.values.some(f=>!m(f,a)))return!0}}return!1}function E(D,e){var d=D.dimensions.find(({name:N})=>"StdTime"===N);if(null==d||H.isNone(e.start)&&H.isNone(e.end))return e;e=e.clone();const {start:c,end:g}=e.toJSON(),t=c===g?[c]:null!=c&&null!=g?[c,g]:[c??g];if(2===t.length&&d?.extent.length&&(t[0]=Math.max(t[0],d.extent[0]),
t[1]=Math.min(t[1],d.extent[1]??d.extent[0]),t[1]<t[0]))return null;d=new A({variableName:"",dimensionName:"StdTime",isSlice:1===t.length,values:t});if(B([d],D,!0))return null;e.start=new Date(t[0]);e.end=new Date(t[1]??t[0]);return e}function v(D,e={}){const {multidimensionalInfo:d,keyProperties:c}=D;if(H.isNone(d))return null;const {variableName:g,multidimensionalSubset:t,multidimensionalDefinition:N}=e;D=H.isSome(N)?N[0]?.variableName:null;const a=g||D||c?.DefaultVariable;({variables:D}=d);t?.variables?.length&&
(D=D.filter(({name:f})=>t.variables.includes(f)));return a?D.find(({name:f})=>f===a)??D[0]:D[0]}function x(D,e){var {values:d}=e;if(d?.length)return Array.isArray(d[0])!==Array.isArray(D)?-1:Array.isArray(d[0])?d.findIndex(t=>t[0]===D[0]&&t[1]===D[1]):d.indexOf(D);var {extent:c}=e;if(Array.isArray(D)||D<c[0]||D>c[1])return-1;d=e.interval||1;if("ISO8601"!==e.unit)return Math.round((D-c[0])/d);c=c[0];let g=-1;switch(e.intervalUnit?.toLowerCase()||"seconds"){case "seconds":g=Math.round((D-c)/1E3/d);
break;case "minutes":g=Math.round((D-c)/6E4/d);break;case "hours":g=Math.round((D-c)/36E5/d);break;case "days":g=Math.round((D-c)/864E5/d);break;case "months":e=(new Date(D)).getUTCFullYear()-(new Date(c)).getUTCFullYear();d=(new Date(c)).getUTCMonth();c=(new Date(D)).getUTCMonth();g=0===e?c-d:c+11-d+12*(e-1);break;case "years":g=Math.round(((new Date(D)).getUTCFullYear()-(new Date(c)).getUTCFullYear())/d);break;case "decades":g=Math.round(((new Date(D)).getUTCFullYear()-(new Date(c)).getUTCFullYear())/
10/d)}return g}function M(D){var e=D.values?.length;if(e)return e;const {extent:d,unit:c}=D;e=D.interval||1;var g=d?d[1]-d[0]:0;if("ISO8601"!==c)return Math.round(g/e);switch(D.intervalUnit?.toLowerCase()??"seconds"){case "seconds":e=Math.round(g/1E3/e);break;case "minutes":e=Math.round(g/6E4/e);break;case "hours":e=Math.round(g/36E5/e);break;case "days":e=Math.round(g/864E5/e);break;case "months":D=(new Date(d[1])).getUTCFullYear()-(new Date(d[0])).getUTCFullYear();e=(new Date(d[1][0])).getUTCMonth();
g=(new Date(d[1][1])).getUTCMonth();e=0===D?g-e+1:g+11-e+12*(D-1)+1;break;case "years":e=Math.round(((new Date(d[1])).getUTCFullYear()-(new Date(d[0])).getUTCFullYear())/e);break;case "decades":e=Math.round(((new Date(d[1])).getUTCFullYear()-(new Date(d[0])).getUTCFullYear())/10/e);break;default:e=0}return e}C.createSlices=function(D,e){const d=[];let c=0;(e?D.variables.filter(g=>g.name.toLowerCase()===e.toLowerCase()):[...D.variables].sort((g,t)=>g.name>t.name?1:-1)).forEach(g=>{const t=[],N=[...g.dimensions].sort((a,
f)=>a.name>f.name?-1:1);r(g.name,N,t);t.forEach(a=>{d.push({...a,sliceId:c++})})});return d};C.getDefaultMultidimensionalDefinition=function(D,e={}){var d=v(D,e);if(!d)return null;D=[];const {dimensions:c,name:g}=d;if(0===c.length)return[new A({variableName:g,dimensionName:"",values:[],isSlice:!0})];for(d=0;d<c.length;d++){const t=J(c[d],e.multidimensionalSubset,g);if(!t)return null;const {values:N,extent:a}=t;let f=N?.[0]??a[0];"stdz"===t.name.toLowerCase()&&!t.hasRanges&&Math.abs(a[1])<=Math.abs(a[0])&&
(f=N?.length?N[N.length-1]:a[1]);D.push(new A({variableName:g,dimensionName:t.name,values:[f],isSlice:e.useRangeForRangedDimensionInfo?!!t.hasRanges:!0}))}return D};C.getDefaultVariablInfo=v;C.getSliceIds=function(D,e,d){let c=D;e&&(e=[...e].sort((g,t)=>g.dimensionName<t.dimensionName?-1:1),e.forEach(({dimensionName:g,values:t,isSlice:N})=>{t.length&&(c=c.filter(a=>{a=a.multidimensionalDefinition.find(l=>l.dimensionName===g);if(null==a)return!1;const f=a.values[0];return"number"===typeof f?"number"===
typeof t[0]?t.includes(f):t.some(l=>l[0]<=f&&l[1]>=f):"number"===typeof t[0]?t.some(l=>f[0]<=l&&f[1]>=l):N?t.some(l=>l[0]===f[0]&&l[0]===f[1]):t.some(l=>l[0]>=f[0]&&l[0]<=f[1]||l[1]>=f[0]&&l[1]<=f[1]||l[0]<f[0]&&l[1]>f[1])}))}));if(c.length&&d&&H.isSome(d.start)&&H.isSome(d.end)){const g=d.start.getTime(),t=d.end.getTime(),N=c[0].multidimensionalDefinition.findIndex(a=>"StdTime"===a.dimensionName);-1<N&&(c=c.filter(a=>{a=a.multidimensionalDefinition[N].values[0];return g<=a&&t>=a}))}return c.map(g=>
g.sliceId)};C.getSliceIndex=function(D,e){let d=0;var c=D[0].variableName;e=[...e.variables].sort((t,N)=>t.name>N.name?1:-1);for(var g=0;g<e.length;g++){const t=e[g],N=[...t.dimensions].sort((a,f)=>a.name>f.name?-1:1);if(t.name!==c)d+=N.map(a=>M(a)).reduce((a,f)=>a*f);else{c=N.map(a=>M(a));e=N.length;for(let a=0;a<e;a++){g=D.find(f=>f.dimensionName===N[a].name);if(null==g)return null;g=x(g.values[0],N[a]);if(-1===g)return null;c.shift();d=a===e-1?d+g:d+g*c.reduce((f,l)=>f*l)}break}}return d};C.getSubsetVariablesFromMdInfo=
function(D,e){if(H.isNone(e)||H.isNone(D))return null;e=e.variables.map(d=>({...d}));D?.variables?.length&&(e=e.filter(({name:d})=>D.variables.includes(d)),e.forEach(d=>{d.dimensions=d.dimensions.map(c=>J(c,D,d.name)).filter(H.isSome)}));return e};C.hasExcludedVariableOrDimension=B;C.intersectMultimensionalSubset=function(D,e){if(H.isNone(D))return{isOutside:!1};const {geometry:d,timeExtent:c,multidimensionalDefinition:g}=e;e=null;if(H.isSome(c)&&(e=E(D,c),H.isNone(e)))return{isOutside:!0};const {areaOfInterest:t}=
D;if(t&&d){const N="point"===d.type?d:"extent"===d.type?d.center:"polygon"===d.type?d.centroid:null;if(N&&!t.contains(N))return{isOutside:!0}}return H.isSome(g)&&g.length&&B(g,D,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:d,timeExtent:e,multidimensionalDefinition:g}}};C.isMultiSliceOrRangeDefinition=function(D){return H.isNone(D)||!D.length?!1:D.some(e=>{if(null==e.values)return!0;const d=e.values.length;return 0===d||1<d||!e.isSlice&&Array.isArray(e.values[0])})};Object.defineProperty(C,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/DimensionalDefinition":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(C,H,A,r,m,G,q){var J;A=J=function(B){function E(v){v=B.call(this,v)||this;v.variableName=null;v.dimensionName=null;v.values=[];v.isSlice=!1;return v}
C._inheritsLoose(E,B);E.prototype.clone=function(){return new J({variableName:this.variableName,dimensionName:this.dimensionName,values:r.clone(this.values),isSlice:this.isSlice})};return E}(A.JSONSupport);H.__decorate([m.property({type:String,json:{write:!0}})],A.prototype,"variableName",void 0);H.__decorate([m.property({type:String,json:{write:!0}})],A.prototype,"dimensionName",void 0);H.__decorate([m.property({type:G.types.array(G.types.oneOf([G.types.native(Number),G.types.array(G.types.native(Number))])),
json:{write:!0}})],A.prototype,"values",void 0);H.__decorate([m.property({type:Boolean,json:{write:!0}})],A.prototype,"isSlice",void 0);return A=J=H.__decorate([q.subclass("esri.layers.support.DimensionalDefinition")],A)})},"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v,x,M){r=function(D){function e(){var c=D.apply(this,arguments)||this;c._loadImagery=(g,t,N,a,f)=>v.loadImagery(c.layer,g,t,N,a,f);c._createFlowMesh=(g,t,N,a)=>c.layer.createFlowMesh({meshType:g,flowData:N,simulationSettings:t},{signal:a});c.attached=!1;c.type="flow";c.timeExtent=null;c.redrawOrRefetch=C._asyncToGenerator(function*(){c._updateVisualization()});return c}C._inheritsLoose(e,D);var d=e.prototype;d.attach=function(){const {layer:c}=this,g=()=>{this._loadImagery=
(t,N,a,f,l)=>v.loadImagery(c,t,N,a,f,l);this._updateVisualization()};"multidimensionalDefinition"in c?this.addHandles(m.watch(()=>c.multidimensionalDefinition,g)):this.addHandles([m.watch(()=>c.mosaicRule,g),m.watch(()=>c.renderingRule,g),m.watch(()=>c.definitionExpression,g)]);this.container=new x;this._strategy=new M({flowContainer:this.container});this._updateVisualization()};d.detach=function(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()};
d.update=function(c){c.stationary?this._strategy.update(c):this.layerView.requestUpdate()};d.hitTest=function(c){return new A({attributes:{},geometry:c.clone(),layer:this.layer})};d.moveEnd=function(){};d.doRefresh=function(){var c=C._asyncToGenerator(function*(){});return function(){return c.apply(this,arguments)}}();d._updateVisualization=function(){var c=this.layer.renderer;null!=c&&"flow"===c.type&&(c=E(c,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),
this.container.flowStyle=c,this.layerView.requestUpdate())};C._createClass(e,[{key:"updating",get:function(){return!this.attached||this._strategy.updating}}]);return e}(r);H.__decorate([G.property()],r.prototype,"_strategy",void 0);H.__decorate([G.property()],r.prototype,"attached",void 0);H.__decorate([G.property()],r.prototype,"container",void 0);H.__decorate([G.property()],r.prototype,"layer",void 0);H.__decorate([G.property()],r.prototype,"layerView",void 0);H.__decorate([G.property()],r.prototype,
"type",void 0);H.__decorate([G.property()],r.prototype,"updating",null);H.__decorate([G.property()],r.prototype,"timeExtent",void 0);return r=H.__decorate([B.subclass("esri.views.2d.engine.flow.FlowView2D")],r)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define("../../../../core/maybe ./utils ./styles/Imagery ./styles/Particles ./styles/Stack ./styles/Streamlines".split(" "),function(C,H,A,r,m,G){return function(q,J){const {flowSpeed:B,trailLength:E}=q,v=H.getFlowSimulationSettings(q);
let x=null;const M={opacity:H.getOpacity(q),size:H.getSize(q)};let D=H.getColor(q);"none"===q.background?M.color=D:("constant"===D.kind&&(D={kind:"ramp",stops:[0,1],values:[0,0,0,1,D.value[0],D.value[1],D.value[2],D.value[3]],count:2}),x=new A.Imagery({loadImagery:J.loadImagery,timeExtent:J.timeExtent,color:D,opacity:{kind:"constant",value:[1]}}),M.color=H.getForegroundColor());J={loadImagery:J.loadImagery,createFlowMesh:J.createFlowMesh,simulationSettings:v,timeExtent:J.timeExtent,trailLength:E,
flowSpeed:B,featheringSize:1,featheringOffset:.5,introFade:!0,fadeToZero:!0,decayRate:2.3,color:M.color,opacity:M.opacity,size:M.size};q="butt"===q.trailCap||4>=H.getMax(H.getSize(q))?new G(J):new r.Particles(J);return C.isSome(x)?new m.Stack([x,q]):q}})},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/maybe","../../../../core/screenUtils"],function(C,H,A){function r(B){return"constant"===B.kind?B.value[0]:B.values[B.values.length-1]}function m(B){B=B.toRgba();return[B[0]/
255,B[1]/255,B[2]/255,B[3]]}function G(B){if(!B.hasVisualVariables("size"))return{kind:"constant",value:[A.pt2px(B.trailWidth)]};const E=B.getVisualVariablesForType("size")[0];B=[];const v=[];if(E.stops){for(x of E.stops)B.push(x.value),v.push(A.pt2px(x.size));var x=E.stops.length}else B.push(E.minDataValue,E.maxDataValue),v.push(A.pt2px(E.minSize),A.pt2px(E.maxSize)),x=2;return{kind:"ramp",stops:B,values:v,count:x}}function q(B,E,v,x){switch(E){case "int":B.setUniform1iv(v,x);break;case "float":B.setUniform1fv(v,
x);break;case "vec2":B.setUniform2fv(v,x);break;case "vec3":B.setUniform3fv(v,x);break;case "vec4":B.setUniform4fv(v,x)}}function J(B,E){return B===E?!0:H.isSome(B)&&H.isSome(E)?B.equals(E):!1}C.areStreamlinesCompatible=function(B,E){var v=B.simulationSettings,x=E.simulationSettings;let M;M=(M=(M=(M=(M=(M=(M=(M=(M=(M=(M=v.collisions===x.collisions)&&v.density===x.density)&&v.interpolate===x.interpolate)&&v.lineCollisionWidth===x.lineCollisionWidth)&&v.lineSpacing===x.lineSpacing)&&v.maxTurnAngle===
x.maxTurnAngle)&&v.minSpeedThreshold===x.minSpeedThreshold)&&v.segmentLength===x.segmentLength)&&v.smoothing===x.smoothing)&&v.velocityScale===x.velocityScale)&&v.verticesPerLine===x.verticesPerLine;return M&&J(B.timeExtent,E.timeExtent)?v=(v=(v=(v=(v=B.loadImagery===E.loadImagery)&&B.createFlowMesh===E.createFlowMesh)&&B.color.kind===E.color.kind)&&B.opacity.kind===E.opacity.kind)&&B.size.kind===E.size.kind:!1};C.getColor=function(B){if(!B.hasVisualVariables("color"))return{kind:"constant",value:m(B.color)};
B=B.getVisualVariablesForType("color")[0];const E=[],v=[];for(const x of B.stops)E.push(x.value),Array.prototype.push.apply(v,m(x.color));return{kind:"ramp",stops:E,values:v,count:B.stops.length}};C.getFlowSimulationSettings=function(B){var E=G(B);E=r(E);const v=Math.max(E/2,5),x=Math.round(A.pt2px(B.maxPathLength)/v)+1,{density:M}=B;return{smoothing:A.pt2px(B.smoothing),interpolate:!0,velocityScale:"flow-from"===B.flowRepresentation?1:-1,verticesPerLine:x,minSpeedThreshold:.001,segmentLength:v,maxTurnAngle:1,
collisions:!0,lineCollisionWidth:E,lineSpacing:10,density:M}};C.getForegroundColor=function(B){return{kind:"constant",value:[.1,.1,.1,1]}};C.getMax=r;C.getOpacity=function(B){if(!B.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};B=B.getVisualVariablesForType("opacity")[0];const E=[],v=[];for(const x of B.stops)E.push(x.value),v.push(x.opacity);return{kind:"ramp",stops:E,values:v,count:B.stops.length}};C.getSize=G;C.setUniform=q;C.setUniforms=function(B,E,v,x){"constant"===x.kind?q(B,
v,`u_${E}`,x.value):(q(B,"float",`u_${E}_stops`,x.stops),q(B,v,`u_${E}_values`,x.values),B.setUniform1i(`u_${E}_count`,x.count))};C.timeExtentsEqual=J;C.toRgba=m;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),
function(C,H,A,r,m,G,q,J,B){let E=function(){function e(c){this._params=c;this.animated=!1}var d=e.prototype;d.isCompatible=function(c){if(!(c instanceof e&&r.timeExtentsEqual(this._params.timeExtent,c._params.timeExtent)))return!1;let g;return g=(g=(g=this._params.loadImagery===c._params.loadImagery)&&this._params.color.kind===c._params.color.kind)&&this._params.opacity.kind===c._params.opacity.kind};d.load=function(){var c=H._asyncToGenerator(function*(g,t){const {extent:N,size:a}=g;A.throwIfAborted(t);
g=yield this._params.loadImagery(N,a[0],a[1],this._params.timeExtent,t);return new D(g,{color:this._params.color,opacity:this._params.opacity})});return function(g,t){return c.apply(this,arguments)}}();d.render=function(c,g,t){({context:c}=c);const {program:N}=t;c.setFaceCullingEnabled(!1);c.setBlendingEnabled(!0);c.setBlendFunction(G.BlendFactor.ONE,G.BlendFactor.ONE_MINUS_SRC_ALPHA);c.useProgram(N);N.setUniformMatrix3fv("u_dvsMat3",g.dvsMat3);c.bindTexture(t.texture,0);N.setUniform1i("u_texture",
0);N.setUniform1f("u_Min",t.min);N.setUniform1f("u_Max",t.max);r.setUniforms(N,"color","vec4",this._params.color);r.setUniforms(N,"opacity","float",this._params.opacity);c.bindVAO(t.vertexArray);c.drawArrays(G.PrimitiveType.TRIANGLE_STRIP,0,4)};return e}();const v=new Map;v.set("a_position",0);v.set("a_texcoord",1);const x={geometry:[new B.VertexElementDescriptor("a_position",2,G.DataType.UNSIGNED_SHORT,0,8),new B.VertexElementDescriptor("a_texcoord",2,G.DataType.UNSIGNED_SHORT,4,8)]},M={vsPath:"raster/flow/imagery",
fsPath:"raster/flow/imagery",attributes:v};let D=function(){function e(c,g){this._flowData=c;this._values=g}var d=e.prototype;d.attach=function(c){var {context:g}=c;const {width:t,height:N}=this._flowData;var a={geometry:m.BufferObject.createVertex(g,G.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,t,0,1,1,0,N,0,0,t,N,1,0]))};a=new J.VertexArrayObject(g,v,x,a);var f=[];"ramp"===this._values.color.kind&&f.push("vvColor");"ramp"===this._values.opacity.kind&&f.push("vvOpacity");c=c.painter.materialManager.getProgram(M,
f);f=1E6;let l=-1E6;for(var p=0;p<N;p++)for(var b=0;b<t;b++)if(0!==this._flowData.mask[p*t+b]){var k=this._flowData.data[2*(p*t+b)],n=this._flowData.data[2*(p*t+b)+1];k=Math.sqrt(k*k+n*n);f=Math.min(f,k);l=Math.max(l,k)}p=new Uint8Array(4*t*N);for(b=0;b<N;b++)for(k=0;k<t;k++)if(0!==this._flowData.mask[b*t+k]){n=this._flowData.data[2*(b*t+k)];const u=this._flowData.data[2*(b*t+k)+1];p[4*(b*t+k)]=(Math.sqrt(n*n+u*u)-f)/(l-f)*255;p[4*(b*t+k)+1]=0;p[4*(b*t+k)+2]=0;p[4*(b*t+k)+3]=255}else p[4*(b*t+k)]=
0,p[4*(b*t+k)+1]=0,p[4*(b*t+k)+2]=0,p[4*(b*t+k)+3]=0;g=new q.Texture(g,{pixelFormat:G.PixelFormat.RGBA,internalFormat:G.PixelFormat.RGBA,samplingMode:G.TextureSamplingMode.LINEAR,dataType:G.PixelType.UNSIGNED_BYTE,wrapMode:G.TextureWrapMode.CLAMP_TO_EDGE,flipped:!0,width:t,height:N},p);this.vertexArray=a;this.program=c;this.texture=g;this.min=f;this.max=l;this._flowData=null};d.detach=function(){this.vertexArray.dispose();this.texture.dispose()};H._createClass(e,[{key:"ready",get:function(){return this.program.compiled}}]);
return e}();C.Imagery=E;C.ImageryResources=D;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(C,H,A,r,m,G,q,J){let B=function(){function D(d){this._params=d}var e=D.prototype;
e.isCompatible=function(d){return d instanceof D?r.areStreamlinesCompatible(this._params,d._params):!1};e.load=function(){var d=H._asyncToGenerator(function*(c,g){const {extent:t,size:N}=c;A.throwIfAborted(g);c=yield this._params.loadImagery(t,N[0],N[1],this._params.timeExtent,g);const {vertexData:a,indexData:f}=yield this._params.createFlowMesh("Particles",this._params.simulationSettings,c,g);return new M(a,f,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})});return function(c,
g){return d.apply(this,arguments)}}();e.render=function(d,c,g){({context:d}=d);const {program:t}=g;d.setFaceCullingEnabled(!1);d.setBlendingEnabled(!0);d.setBlendFunction(G.BlendFactor.ONE,G.BlendFactor.ONE_MINUS_SRC_ALPHA);d.useProgram(t);t.setUniform1f("u_time",c.time);t.setUniform1f("u_trailLength",this._params.trailLength);t.setUniform1f("u_flowSpeed",this._params.flowSpeed);t.setUniform1f("u_featheringSize",this._params.featheringSize);t.setUniform1f("u_featheringOffset",this._params.featheringOffset);
t.setUniform1f("u_introFade",this._params.introFade?1:0);t.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);t.setUniform1f("u_decayRate",this._params.decayRate);t.setUniformMatrix3fv("u_dvsMat3",c.dvsMat3);t.setUniformMatrix3fv("u_displayViewMat3",c.displayViewMat3);r.setUniforms(t,"color","vec4",this._params.color);r.setUniforms(t,"opacity","float",this._params.opacity);r.setUniforms(t,"size","float",this._params.size);d.bindVAO(g.vertexArray);d.drawElements(G.PrimitiveType.TRIANGLES,g.indexCount,
G.DataType.UNSIGNED_INT,0)};H._createClass(D,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return D}();const E=new Map;E.set("a_xyts0",0);E.set("a_xyts1",1);E.set("a_typeIdDurationSeed",2);E.set("a_extrudeInfo",3);const v={geometry:[new J.VertexElementDescriptor("a_xyts0",4,G.DataType.FLOAT,0,64),new J.VertexElementDescriptor("a_xyts1",4,G.DataType.FLOAT,16,64),new J.VertexElementDescriptor("a_typeIdDurationSeed",4,G.DataType.FLOAT,32,64),new J.VertexElementDescriptor("a_extrudeInfo",
4,G.DataType.FLOAT,48,64)]},x={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:E};let M=function(){function D(d,c,g){this._vertexData=d;this._indexData=c;this._values=g}var e=D.prototype;e.attach=function(d){var {context:c}=d,g=m.BufferObject.createVertex(c,G.Usage.STATIC_DRAW,this._vertexData);const t=m.BufferObject.createIndex(c,G.Usage.STATIC_DRAW,this._indexData);c=new q.VertexArrayObject(c,E,v,{geometry:g},t);g=[];"ramp"===this._values.color.kind&&g.push("vvColor");"ramp"===
this._values.opacity.kind&&g.push("vvOpacity");"ramp"===this._values.size.kind&&g.push("vvSize");d=d.painter.materialManager.getProgram(x,g);this.vertexArray=c;this.program=d;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};e.detach=function(){this.vertexArray.dispose()};H._createClass(D,[{key:"ready",get:function(){return this.program.compiled}}]);return D}();C.Particles=B;C.ParticlesResources=M;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(C,H){let A=function(){function m(q){this._styles=q}var G=m.prototype;G.isCompatible=function(q){if(!(q instanceof m)||this._styles.length!==q._styles.length)return!1;const J=this._styles.length;for(let B=0;B<J;B++)if(!this._styles[B].isCompatible(q._styles[B]))return!1;return!0};G.load=function(){var q=H._asyncToGenerator(function*(J,B){const E=yield Promise.all(this._styles.map(v=>v.load(J,B)));return new r(E)});return function(J,B){return q.apply(this,
arguments)}}();G.render=function(q,J,B){for(let E=0;E<this._styles.length;E++)this._styles[E].render(q,J,B.resources[E])};H._createClass(m,[{key:"animated",get:function(){return this._styles.reduce((q,J)=>q||J.animated,!1)}}]);return m}(),r=function(){function m(q){this.resources=q}var G=m.prototype;G.attach=function(q){for(const J of this.resources)J.attach(q)};G.detach=function(){for(const q of this.resources)q.detach()};H._createClass(m,[{key:"ready",get:function(){return this.resources.reduce((q,
J)=>q&&J.ready,!0)}}]);return m}();C.Stack=A;C.StackResources=r;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(C,H,A,r,m,G,q){let J=function(){function M(e){this._params=e}var D=
M.prototype;D.isCompatible=function(e){return e instanceof M?A.areStreamlinesCompatible(this._params,e._params):!1};D.load=function(){var e=C._asyncToGenerator(function*(d,c){const {extent:g,size:t}=d;H.throwIfAborted(c);d=yield this._params.loadImagery(g,t[0],t[1],this._params.timeExtent,c);const {vertexData:N,indexData:a}=yield this._params.createFlowMesh("Streamlines",this._params.simulationSettings,d,c);return new x(N,a,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})});
return function(d,c){return e.apply(this,arguments)}}();D.render=function(e,d,c){({context:e}=e);const {program:g}=c;e.setFaceCullingEnabled(!1);e.setBlendingEnabled(!0);e.setBlendFunction(m.BlendFactor.ONE,m.BlendFactor.ONE_MINUS_SRC_ALPHA);e.useProgram(g);g.setUniform1f("u_time",d.time);g.setUniform1f("u_trailLength",this._params.trailLength);g.setUniform1f("u_flowSpeed",this._params.flowSpeed);g.setUniform1f("u_featheringSize",this._params.featheringSize);g.setUniform1f("u_featheringOffset",this._params.featheringOffset);
g.setUniform1f("u_introFade",this._params.introFade?1:0);g.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);g.setUniform1f("u_decayRate",this._params.decayRate);g.setUniformMatrix3fv("u_dvsMat3",d.dvsMat3);g.setUniformMatrix3fv("u_displayViewMat3",d.displayViewMat3);A.setUniforms(g,"color","vec4",this._params.color);A.setUniforms(g,"opacity","float",this._params.opacity);A.setUniforms(g,"size","float",this._params.size);e.bindVAO(c.vertexArray);e.drawElements(m.PrimitiveType.TRIANGLES,c.indexCount,
m.DataType.UNSIGNED_INT,0)};C._createClass(M,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return M}();const B=new Map;B.set("a_positionAndSide",0);B.set("a_timeInfo",1);B.set("a_extrude",2);B.set("a_speed",3);const E={geometry:[new q.VertexElementDescriptor("a_positionAndSide",3,m.DataType.FLOAT,0,36),new q.VertexElementDescriptor("a_timeInfo",3,m.DataType.FLOAT,12,36),new q.VertexElementDescriptor("a_extrude",2,m.DataType.FLOAT,24,36),new q.VertexElementDescriptor("a_speed",
1,m.DataType.FLOAT,32,36)]},v={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:B};let x=function(){function M(e,d,c){this._vertexData=e;this._indexData=d;this._values=c}var D=M.prototype;D.attach=function(e){var {context:d}=e,c=r.BufferObject.createVertex(d,m.Usage.STATIC_DRAW,this._vertexData);const g=r.BufferObject.createIndex(d,m.Usage.STATIC_DRAW,this._indexData);d=new G.VertexArrayObject(d,B,E,{geometry:c},g);c=[];"ramp"===this._values.color.kind&&c.push("vvColor");
"ramp"===this._values.opacity.kind&&c.push("vvOpacity");"ramp"===this._values.size.kind&&c.push("vvSize");e=e.painter.materialManager.getProgram(v,c);this.vertexArray=d;this.program=e;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};D.detach=function(){this.vertexArray.dispose()};C._createClass(M,[{key:"ready",get:function(){return this.program.compiled}}]);return M}();return J})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v){function x(){x=H._asyncToGenerator(function*(b,k,n,u){const z=performance.now();var K=M(k,n);const w=performance.now();n=e(k,K,n.width,n.height);k=performance.now();K=c(n,!0);n=performance.now();b="Streamlines"===b?g(K,10):t(K);K=performance.now();r("esri-2d-profiler")&&(p.info("I.1","_createFlowFieldFromData (ms)",Math.round(w-z)),p.info("I.2","_getStreamlines (ms)",Math.round(k-w)),p.info("I.3","createAnimatedLinesData (ms)",Math.round(n-k)),p.info("I.4","create{Streamlines|Particles}Mesh (ms)",
Math.round(K-n)),p.info("I.5","createFlowMesh (ms)",Math.round(K-z)),p.info("I.6","Mesh size (bytes)",b.vertexData.buffer.byteLength+b.indexData.buffer.byteLength));yield Promise.resolve();J.throwIfAborted(u);return b});return x.apply(this,arguments)}function M(b,k){const n=d(k.data,k.width,k.height,b.smoothing);return b.interpolate?(u,z)=>{const K=Math.floor(u),w=Math.floor(z);if(0>K||K>=k.width||0>w||w>=k.height)return[0,0];u-=K;z-=w;const y=K<k.width-1?K+1:K,F=w<k.height-1?w+1:w;return[(n[2*(w*
k.width+K)]*(1-z)+n[2*(F*k.width+K)]*z)*(1-u)+(n[2*(w*k.width+y)]*(1-z)+n[2*(F*k.width+y)]*z)*u,(n[2*(w*k.width+K)+1]*(1-z)+n[2*(F*k.width+K)+1]*z)*(1-u)+(n[2*(w*k.width+y)+1]*(1-z)+n[2*(F*k.width+y)+1]*z)*u]}:(u,z)=>{u=Math.round(u);z=Math.round(z);return 0>u||u>=k.width||0>z||z>=k.height?[0,0]:[n[2*(z*k.width+u)],n[2*(z*k.width+u)+1]]}}function D(b,k,n,u,z,K,w,y,F){const L=[];let O=0,[T,V]=k(n,u);T*=b.velocityScale;V*=b.velocityScale;L.push({x:n,y:u,t:O,speed:Math.sqrt(T*T+V*V)});for(let Z=0;Z<
b.verticesPerLine;Z++){let [da,h]=k(n,u);da*=b.velocityScale;h*=b.velocityScale;const I=Math.sqrt(da*da+h*h);if(I<b.minSpeedThreshold)break;const R=da/I,P=h/I;n+=R*b.segmentLength;u+=P*b.segmentLength;O+=b.segmentLength/I;if(Math.acos(R*aa+P*Y)>b.maxTurnAngle)break;if(b.collisions){var aa=Math.round(n*F);var Y=Math.round(u*F);if(0>aa||aa>w-1||0>Y||Y>y-1)break;const S=K[Y*w+aa];if(-1!==S&&S!==z)break;K[Y*w+aa]=z}L.push({x:n,y:u,t:O,speed:I});aa=R;Y=P}return L}function e(b,k,n,u){const z=[],K=new B,
w=1/Math.max(b.lineCollisionWidth,1),y=Math.round(n*w),F=Math.round(u*w),L=new Int32Array(y*F);for(var O=0;O<L.length;O++)L[O]=-1;O=[];for(let T=0;T<u;T+=b.lineSpacing)for(let V=0;V<n;V+=b.lineSpacing)O.push({x:V,y:T,sort:K.getFloat()});O.sort((T,V)=>T.sort-V.sort);for(const {x:T,y:V}of O)K.getFloat()<b.density&&(n=D(b,k,T,V,z.length,L,y,F,w),2>n.length||z.push(n));return z}function d(b,k,n,u){if(0===u)return b;const z=Math.round(3*u),K=Array(2*z+1);var w=0;for(var y=-z;y<=z;y++){var F=Math.exp(-y*
y/(u*u));K[y+z]=F;w+=F}for(u=-z;u<=z;u++)K[u+z]/=w;w=new Float32Array(b.length);for(u=0;u<n;u++)for(y=0;y<k;y++){var L=F=0;for(var O=-z;O<=z;O++)if(!(0>y+O||y+O>=k)){var T=K[O+z];F+=T*b[2*(u*k+(y+O))];L+=T*b[2*(u*k+(y+O))+1]}w[2*(u*k+y)]=F;w[2*(u*k+y)+1]=L}b=new Float32Array(b.length);for(u=0;u<k;u++)for(y=0;y<n;y++){L=F=0;for(O=-z;O<=z;O++)0>y+O||y+O>=n||(T=K[O+z],F+=T*w[2*((y+O)*k+u)],L+=T*w[2*((y+O)*k+u)+1]);b[2*(y*k+u)]=F;b[2*(y*k+u)+1]=L}return b}function c(b,k){const n=new B;var u=b.reduce((y,
F)=>y+F.length,0);u=new Float32Array(4*u);const z=Array(b.length);let K=0,w=0;for(const y of b){b=K;for(const F of y)u[4*K]=F.x,u[4*K+1]=F.y,u[4*K+2]=F.t,u[4*K+3]=F.speed,K++;z[w++]={startVertex:b,numberOfVertices:y.length,totalTime:y[y.length-1].t,timeSeed:k?n.getFloat():0}}return{lineVertices:u,lineDescriptors:z}}function g(b,k){function n(aa,Y,Z,da,h,I,R,P){const S=9*F;let Q=0;y[S+Q++]=aa;y[S+Q++]=Y;y[S+Q++]=1;y[S+Q++]=Z;y[S+Q++]=I;y[S+Q++]=R;y[S+Q++]=da/2;y[S+Q++]=h/2;y[S+Q++]=P;F++;y[S+Q++]=
aa;y[S+Q++]=Y;y[S+Q++]=-1;y[S+Q++]=Z;y[S+Q++]=I;y[S+Q++]=R;y[S+Q++]=-da/2;y[S+Q++]=-h/2;y[S+Q++]=P;F++}const {lineVertices:u,lineDescriptors:z}=b;var K=b=0;for(var w of z)b+=2*w.numberOfVertices,K+=6*(w.numberOfVertices-1);const y=new Float32Array(9*b);w=new Uint32Array(K);let F=0;b=0;for(const aa of z){const {totalTime:Y,timeSeed:Z}=aa;let da=K=null,h=null;var L=null,O=null,T=null;for(let I=0;I<aa.numberOfVertices;I++){L=u[4*(aa.startVertex+I)];const R=u[4*(aa.startVertex+I)+1],P=u[4*(aa.startVertex+
I)+2],S=u[4*(aa.startVertex+I)+3];let Q=null,W=null;var V=null;let X=null;0<I&&(Q=L-K,W=R-da,V=Math.sqrt(Q*Q+W*W),Q/=V,W/=V,1<I?(O=Q+O,T=W+T,V=Math.sqrt(O*O+T*T),O/=V,T/=V,V=Math.min(1/(O*Q+T*W),k),O*=V,T*=V,V=-T,X=O):(V=-W,X=Q),null!==V&&null!==X&&(n(K,da,h,V,X,Y,Z,S),w[b++]=F-2,w[b++]=F,w[b++]=F-1,w[b++]=F,w[b++]=F+1,w[b++]=F-1));K=L;da=R;h=P;O=Q;T=W;L=S}n(K,da,h,-T,O,Y,Z,L)}return{vertexData:y,indexData:w}}function t(b){function k(ca,ba){var ea=P+Q,ia=S+W,fa=Math.sqrt(ea*ea+ia*ia);ea/=fa;ia/=fa;
var ja=P*ea+S*ia,ka=Q+X,la=W+U;fa=Math.sqrt(ka*ka+la*la);ka/=fa;la/=fa;var ha=Q*ka+W*la;fa=V;var na=aa,pa=Y,qa=Z;ia=-(ia/ja);ea/=ja;ja=da;var ra=h,ua=I,va=R;la=-(la/ha);ka/=ha;ha=16*O;let oa=0;for(const wa of[1,2])for(const xa of[1,2,3,4])F[ha+oa++]=fa,F[ha+oa++]=na,F[ha+oa++]=pa,F[ha+oa++]=qa,F[ha+oa++]=ja,F[ha+oa++]=ra,F[ha+oa++]=ua,F[ha+oa++]=va,F[ha+oa++]=wa,F[ha+oa++]=xa,F[ha+oa++]=ca,F[ha+oa++]=ba,F[ha+oa++]=ia/2,F[ha+oa++]=ea/2,F[ha+oa++]=la/2,F[ha+oa++]=ka/2,O++;L[T++]=O-8;L[T++]=O-7;L[T++]=
O-6;L[T++]=O-7;L[T++]=O-5;L[T++]=O-6;L[T++]=O-4;L[T++]=O-3;L[T++]=O-2;L[T++]=O-3;L[T++]=O-1;L[T++]=O-2}function n(ca,ba,ea,ia,fa,ja){P=Q;S=W;Q=X;W=U;null==P&&null==S&&(P=Q,S=W);if(null!=da&&null!=h){X=ca-da;U=ba-h;const ka=Math.sqrt(X*X+U*U);X/=ka;U/=ka}null!=P&&null!=S&&k(fa,ja);V=da;aa=h;Y=I;Z=R;da=ca;h=ba;I=ea;R=ia}function u(ca,ba){P=Q;S=W;Q=X;W=U;null==P&&null==S&&(P=Q,S=W);null!=P&&null!=S&&k(ca,ba)}const {lineVertices:z,lineDescriptors:K}=b;let w=b=0;for(var y of K){const ca=y.numberOfVertices-
1;b+=8*ca;w+=12*ca}const F=new Float32Array(16*b),L=new Uint32Array(w);let O=0,T=0,V,aa,Y,Z,da,h,I,R,P,S,Q,W,X,U;for(const ca of K){U=X=W=Q=S=P=R=I=h=da=Z=Y=aa=V=null;const {totalTime:ba,timeSeed:ea}=ca;for(y=0;y<ca.numberOfVertices;y++)n(z[4*(ca.startVertex+y)],z[4*(ca.startVertex+y)+1],z[4*(ca.startVertex+y)+2],z[4*(ca.startVertex+y)+3],ba,ea);u(ba,ea)}return{vertexData:F,indexData:L}}function N(b,k){const n=k.pixels,{width:u,height:z}=k,K=new Float32Array(u*z*2),w=k.mask||new Uint8Array(u*z*2);
k.mask||w.fill(255);if("vector-uv"===b)for(b=0;b<u*z;b++)K[2*b]=n[0][b],K[2*b+1]=-n[1][b];else if("vector-magdir"===b)for(b=0;b<u*z;b++){k=n[0][b];const y=G.deg2rad(n[1][b]),F=Math.sin(y-Math.PI/2);K[2*b]=Math.cos(y-Math.PI/2)*k;K[2*b+1]=F*k}return{data:K,mask:w,width:u,height:z}}function a(){a=H._asyncToGenerator(function*(b,k,n,u,z,K){const w=performance.now();var y=E.getInfo(k.spatialReference);if(!y)return n=yield f(b,k,n,u,z,K),r("esri-2d-profiler")&&p.info("I.7","loadImagery, early exit (ms)",
Math.round(performance.now()-w)),r("esri-2d-profiler")&&p.info("I.9","Number of parts",1),n;const [F,L]=y.valid,O=Math.ceil(k.width/(L-F)),T=k.width/O,V=Math.round(n/O);let aa=k.xmin;const Y=[];y=performance.now();for(let Z=0;Z<O;Z++){const da=new v({xmin:aa,xmax:aa+T,ymin:k.ymin,ymax:k.ymax,spatialReference:k.spatialReference});Y.push(f(b,da,V,u,z,K));aa+=T}b=yield Promise.all(Y);r("esri-2d-profiler")&&p.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-y));r("esri-2d-profiler")&&
p.info("I.9","Number of parts",b.length);u={data:new Float32Array(n*u*2),mask:new Uint8Array(n*u),width:n,height:u};k=0;for(const Z of b){for(b=0;b<Z.height;b++)for(z=0;z<Z.width;z++)k+z>=n||(u.data[2*(b*n+k+z)]=Z.data[2*(b*Z.width+z)],u.data[2*(b*n+k+z)+1]=Z.data[2*(b*Z.width+z)+1],u.mask[b*n+k+z]=Z.mask[b*Z.width+z]);k+=Z.width}r("esri-2d-profiler")&&p.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-w));return u});return a.apply(this,arguments)}function f(b,k,n,u,z,K){return l.apply(this,
arguments)}function l(){l=H._asyncToGenerator(function*(b,k,n,u,z,K){const w={requestProjectedLocalDirections:!0,signal:K};q.isSome(z)&&(w.timeExtent=z);if("imagery"===b.type)return yield b.load({signal:K}),z=b.rasterInfo.dataType,b=yield b.fetchImage(k,n,u,w),!b||q.isNone(b.pixelData)||q.isNone(b.pixelData.pixelBlock)?{data:new Float32Array(n*u*2),mask:new Uint8Array(n*u),width:n,height:u}:N(z,b.pixelData.pixelBlock);yield b.load({signal:K});z=b.rasterInfo.dataType;b=yield b.fetchPixels(k,n,u,w);
return!b||q.isNone(b.pixelBlock)?{data:new Float32Array(n*u*2),mask:new Uint8Array(n*u),width:n,height:u}:N(z,b.pixelBlock)});return l.apply(this,arguments)}const p=m.getLogger("esri.views.2d.engine.flow.dataUtils");C.createAnimatedLinesData=c;C.createFlowMesh=function(b,k,n,u){return x.apply(this,arguments)};C.createParticlesMesh=t;C.createStreamlinesMesh=g;C.loadImagery=function(b,k,n,u,z,K){return a.apply(this,arguments)};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./BrushFlow","../webgl/enums","../webgl/WGLContainer"],function(C,H,A,r){return function(m){function G(){var J=m.apply(this,arguments)||this;J.flowStyle=null;return J}C._inheritsLoose(G,m);var q=G.prototype;q.doRender=function(J){m.prototype.doRender.call(this,J)};q.prepareRenderPasses=function(J){const B=J.registerRenderPass({name:"flow",brushes:[H],target:()=>this.children,drawPhase:A.WGLDrawPhase.MAP});return[...m.prototype.prepareRenderPasses.call(this,J),B]};C._createClass(G,[{key:"requiresDedicatedFBO",
get:function(){return!1}}]);return G}(r)})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(C,H,A,r,m){return function(G){function q(){var B=G.apply(this,arguments)||this;B._visualState={time:0,dvsMat3:A.create(),displayViewMat3:A.create()};return B}C._inheritsLoose(q,G);var J=q.prototype;J.dispose=function(){};J.prepareState=function(B){({context:B}=
B);B.setColorMask(!0,!0,!0,!0);B.setStencilFunction(m.CompareFunction.EQUAL,0,255)};J.draw=function(B,E){const {requestRender:v,allowDelayedRender:x}=B,{displayData:M}=E;if(!H.isNone(M)&&("loaded"===M.state.name&&M.attach(B),"attached"===M.state.name)){var D=M.state.resources;x&&!D.ready&&H.isSome(v)?v():(this._visualState.time=B.time/1E3,this._visualState.dvsMat3=E.transforms.dvs,this._visualState.displayViewMat3=B.state.displayViewMat3,M.flowStyle.render(B,this._visualState,D),M.flowStyle.animated&&
H.isSome(v)&&v())}};return q}(r)})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v,x,M,D,e,d){function c(g,t){const N=new M({x:(g.xmax+g.xmin)/2,y:(g.ymax+g.ymin)/2,spatialReference:g.spatialReference});var a=g.xmax-g.xmin;const f=g.ymax-g.ymin,l=Math.abs(Math.cos(G.deg2rad(t))),p=Math.abs(Math.sin(G.deg2rad(t)));t=l*a+p*f;a=p*a+l*f;g=new d({xmin:N.x-t/2,ymin:N.y-a/2,xmax:N.x+t/2,ymax:N.y+a/2,spatialReference:g.spatialReference});g.centerAt(N);return g}A=function(g){function t(a){a=g.call(this,a)||this;a._flowDisplayObject=new e.FlowDisplayObject;
a._loading=null;return a}C._inheritsLoose(t,g);var N=t.prototype;N.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};N.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};N.update=function(a){var {flowStyle:f}=this.flowContainer;if(q.isNone(f))this._clear();else{var {extent:l,rotation:p,resolution:b,pixelRatio:k}=a.state;a=c(l,p);a.expand(1.15);f=new D(f,a,[Math.round((a.xmax-a.xmin)/b),Math.round((a.ymax-a.ymin)/b)],k);if(q.isSome(this._loading)){if(this._loading.update(f))return;
this._loading.detach();this._loading=null}if(q.isNone(this._flowDisplayObject.displayData)||!this._flowDisplayObject.displayData.update(f))f.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},n=>{J.isAbortError(n)||(m.getLogger(this.declaredClass).error("A resource failed to load.",n),this._loading=null)}),this._loading=f}};N._clear=function(){this._flowDisplayObject.clear();q.isSome(this._loading)&&(this._loading.detach(),this._loading=
null)};C._createClass(t,[{key:"updating",get:function(){return null!=this._loading}}]);return t}(r);H.__decorate([B.property()],A.prototype,"_loading",void 0);H.__decorate([B.property()],A.prototype,"flowContainer",void 0);H.__decorate([B.property()],A.prototype,"updating",null);return A=H.__decorate([x.subclass("esri.views.2d.engine.flow.FlowStrategy")],A)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger"],function(C,
H){return function(){function A(m,G,q,J){this.state={name:"created"};this.flowStyle=m;this.extent=G;this.size=q;this.pixelRatio=J}var r=A.prototype;r.load=function(){var m=C._asyncToGenerator(function*(){const G=new AbortController;this.state={name:"loading",abortController:G};this.state={name:"loaded",resources:yield this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},G.signal)}});return function(){return m.apply(this,arguments)}}();r.attach=function(m){if("loaded"!==
this.state.name)H.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");else{var G=this.state.resources;G.attach(m);this.state={name:"attached",resources:G}}};r.detach=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};r.update=function(m){if(!this.flowStyle.isCompatible(m.flowStyle)||!this.extent.equals(m.extent)||
this.size[0]!==m.size[0]||this.size[1]!==m.size[1]||this.pixelRatio!==m.pixelRatio)return!1;this.flowStyle=m.flowStyle;return!0};return A}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(C,H,A,r,m,G,q){q=function(J){function B(){var v=J.apply(this,arguments)||this;v._displayData=null;return v}
H._inheritsLoose(B,J);var E=B.prototype;E.clear=function(){r.isSome(this._displayData)&&(this._displayData.detach(),this._displayData=null,this.requestRender())};E.setTransform=function(v){var {displayData:x}=this;if(!r.isNone(x)){var M=[0,0];v.toScreen(M,[x.extent.xmin,x.extent.ymax]);x=(x.extent.xmax-x.extent.xmin)/x.size[0]/v.resolution;var D=A.deg2rad(v.rotation),{dvs:e}=this.transforms;m.fromTranslation(e,[-1,1,0]);m.scale(e,e,[2/(v.size[0]*v.pixelRatio),-2/(v.size[1]*v.pixelRatio),1]);m.translate(e,
e,[M[0],M[1],0]);m.rotate(e,e,D);m.scale(e,e,[x*v.pixelRatio,x*v.pixelRatio,1])}};E._createTransforms=function(){return{dvs:G.create()}};H._createClass(B,[{key:"displayData",get:function(){return this._displayData},set:function(v){this._displayData=v;this.requestRender()}}]);return B}(q.DisplayObject);C.FlowDisplayObject=q;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v,x,M,D,e,d){const c=r.ofType({key:"type",base:null,typeMap:{rect:D,path:d,geometry:e}});C.LayerView2DMixin=g=>{g=function(t){function N(){var f=t.apply(this,arguments)||this;f.attached=!1;f.clips=new c;f.lastUpdateId=-1;f.moving=!1;f.updateRequested=!1;f.visibleAtCurrentScale=!1;f.highlightOptions=null;return f}H._inheritsLoose(N,t);var a=N.prototype;a.initialize=function(){const f=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&f&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new G("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new x.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([q.watch(()=>this.suspended,l=>{this.container&&(this.container.visible=!l);this.view&&!l&&this.updateRequested&&this.view.requestUpdate()},q.syncAndInitial),
q.watch(()=>this.layer?.opacity??1,l=>{this.container&&(this.container.opacity=l)},q.syncAndInitial),q.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",l=>{this.container&&(this.container.blendMode=l)},q.syncAndInitial),q.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,l=>{this.container&&(this.container.effect=l)},q.syncAndInitial),q.watch(()=>this.highlightOptions,l=>this.container.highlightOptions=l,q.syncAndInitial),q.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},q.syncAndInitial),q.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:l})=>{l=null!=l?this.isVisibleAtScale(l):!1;l!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",l)},q.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(l=>{l===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};a.destroy=function(){this.processDetach();this.updateRequested=!1};a.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};a.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};a.isVisibleAtScale=function(f){const l=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!l)return!0;
const {minScale:p,maxScale:b}=l;return(0===p||f<=p)&&(0===b||f>=b)};a.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};a.processUpdate=function(f){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",f),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(f)))};a.hitTest=function(f,l){return Promise.resolve(null)};a.supportsSpatialReference=function(f){return!0};
a.canResume=function(){return this.spatialReferenceSupported?t.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};a.getSuspendInfo=function(){const f=t.prototype.getSuspendInfo.call(this),l=!this.spatialReferenceSupported,p=this.visibleAtCurrentScale;l&&(f.spatialReferenceNotSupported=l);p&&(f.outsideScaleRange=p);return f};a.addAttachHandles=function(f){this.addHandles(f,"attach")};H._createClass(N,[{key:"spatialReferenceSupported",get:function(){const f=this.view?.spatialReference;
return null==f||this.supportsSpatialReference(f)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return N}(g);A.__decorate([J.property()],g.prototype,"attached",void 0);A.__decorate([J.property({type:c,set(t){t=m.referenceSetter(t,this._get("clips"),c);this._set("clips",t)}})],g.prototype,"clips",void 0);A.__decorate([J.property()],g.prototype,"container",void 0);
A.__decorate([J.property()],g.prototype,"moving",void 0);A.__decorate([J.property({readOnly:!0})],g.prototype,"spatialReferenceSupported",null);A.__decorate([J.property({readOnly:!0})],g.prototype,"updateParameters",void 0);A.__decorate([J.property()],g.prototype,"updateRequested",void 0);A.__decorate([J.property()],g.prototype,"updating",null);A.__decorate([J.property()],g.prototype,"view",void 0);A.__decorate([J.property({readOnly:!0})],g.prototype,"visibleAtCurrentScale",void 0);A.__decorate([J.property({type:M})],
g.prototype,"highlightOptions",void 0);return g=A.__decorate([v.subclass("esri.views.2d.layers.LayerView2D")],g)};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(C,
H,A,r,m,G,q){var J;r=J=function(B){function E(x){x=B.call(this,x)||this;x.type="rect";x.left=null;x.right=null;x.top=null;x.bottom=null;return x}C._inheritsLoose(E,B);var v=E.prototype;v.clone=function(){return new J({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};v.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return E}(q);H.__decorate([A.property({type:[Number,String],json:{write:!0}})],
r.prototype,"left",void 0);H.__decorate([A.property({type:[Number,String],json:{write:!0}})],r.prototype,"right",void 0);H.__decorate([A.property({type:[Number,String],json:{write:!0}})],r.prototype,"top",void 0);H.__decorate([A.property({type:[Number,String],json:{write:!0}})],r.prototype,"bottom",void 0);return r=J=H.__decorate([G.subclass("esri.views.layers.support.ClipRect")],r)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass".split(" "),
function(C,H,A,r,m,G,q){A=function(J){function B(){return J.apply(this,arguments)||this}C._inheritsLoose(B,J);C._createClass(B,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return B}(A.JSONSupport);H.__decorate([r.property({readOnly:!0})],A.prototype,"version",null);return A=H.__decorate([q.subclass("esri.views.layers.support.ClipArea")],A)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v,x){var M;A={base:J,key:"type",typeMap:{extent:v,polygon:x}};E=M=function(D){function e(c){c=D.call(this,c)||this;c.type="geometry";c.geometry=null;return c}C._inheritsLoose(e,D);var d=e.prototype;d.clone=function(){return new M({geometry:this.geometry?.clone()??null})};d.commitVersionProperties=function(){this.commitProperty("geometry")};return e}(E);H.__decorate([r.property({types:A,json:{read:B.fromJSON,write:!0}})],E.prototype,"geometry",void 0);return E=M=H.__decorate([q.subclass("esri.views.layers.support.Geometry")],
E)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(C,H,A,r,m,G,q){r=function(J){function B(E){E=J.call(this,E)||this;E.type="path";E.path=[];return E}C._inheritsLoose(B,J);B.prototype.commitVersionProperties=function(){this.commitProperty("path")};
return B}(q);H.__decorate([A.property({type:[[[Number]]],json:{write:!0}})],r.prototype,"path",void 0);return r=H.__decorate([G.subclass("esri.views.layers.support.Path")],r)})},"esri/views/2d/layers/imagery/ImageryTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../engine/imagery/RasterTileContainer ./BaseImageryTileSubView2D ../support/util".split(" "),
function(C,H,A,r,m,G,q,J,B,E){m=function(v){function x(){var D=v.apply(this,arguments)||this;D.type="raster";return D}C._inheritsLoose(x,v);var M=x.prototype;M.attach=function(){v.prototype.attach.call(this);this.container=new J.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this.updateRasterFunctionParameters()};M.detach=function(){v.prototype.detach.call(this);this.container.removeAllChildren();this.container=null};M.canUseWebGLForProcessing=
function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&E.canUseMajorityInterpolationOnDataSource(this.layer))};M.fetchTile=function(D,e){return this.layer.fetchTile(D.level,D.row,D.col,e)};M.updateRasterFunctionParameters=function(){const {raster:D,type:e}=this.layer,{container:d}=this;if("Function"!==D.datasetFormat||"wcs"===e)d.rasterFunctionChain=null,d.children.forEach(p=>{({bitmap:p}=p);p&&(p.suspended=!0,p.processed=!1,
p.projected&&(p.invalidateTexture(),p.rasterTexture=null))}),this._rasterFunctionState="na";else{var c=this._rasterFunctionState,{rasterFunction:g,primaryRasters:t}=D,N=g.supportsGPU&&(!t||1>=t.rasters.length),a=N?g.getFlatWebGLFunctionChain():null,{renderer:f}=this.layer;N=!N||!a?.functions.length||"raster-stretch"===f.type&&f.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();d.rasterFunctionChain=N?null:a;var l=null==g?"na":d.rasterFunctionChain?"gpu":"cpu";d.children.forEach(p=>{({bitmap:p}=
p);p&&(p.suspended=c!==l,p.processed=!1,p.processedTexture=null)});this._rasterFunctionState=l}};M.updateTileSource=function(){var D=C._asyncToGenerator(function*(e,d){const c=this._getBandIds(),g=this._getLayerInterpolation(),t=this.canUseWebGLForProcessing(),{source:N,globalSymbolizerParams:a,suspended:f,coords:l,resolution:p}=d;d=this.layerView.hasTilingEffects?a:d.symbolizerParams;({bitmap:e}=e);[e.x,e.y]=l;e.resolution=p;if(N&&A.isSome(N)&&A.isSome(N.pixelBlock)){var b={extent:N.extent,pixelBlock:N.pixelBlock};
e.rawPixelData=b;t?(e.source=N.pixelBlock,e.isRendereredSource=!1):(b=yield this.layer.applyRenderer(b,"stretch"===a?.type?a:void 0),e.source=b,e.isRendereredSource=!0);e.symbolizerParameters=t?d:null;t?e.transformGrid||(e.transformGrid=N.transformGrid):e.transformGrid=null}else b=this.createEmptyTilePixelBlock(),e.source=b,e.symbolizerParameters=t?d:null,e.transformGrid=null;e.bandIds=t?c:null;e.width=this._tileInfoView.tileInfo.size[0];e.height=this._tileInfoView.tileInfo.size[1];e.interpolation=
g;e.suspended=f;e.invalidateTexture()});return function(e,d){return D.apply(this,arguments)}}();M.updateTileSymbolizerParameters=function(){var D=C._asyncToGenerator(function*(e,d){const {local:c,global:g}=d;d=this._getBandIds();const t=this._getLayerInterpolation(),N=this.canUseWebGLForProcessing();({bitmap:e}=e);const {rawPixelData:a}=e;!N&&A.isSome(a)?(e.source=yield this.layer.applyRenderer(a,"stretch"===g?.type?g:void 0),e.isRendereredSource=!0):(e.isRendereredSource&&A.isSome(a)&&(e.source=
a.pixelBlock),e.isRendereredSource=!1);e.symbolizerParameters=N?this.layerView.hasTilingEffects?g:c:null;e.bandIds=N?d:null;e.interpolation=t;e.suspended=!1});return function(e,d){return D.apply(this,arguments)}}();M._getLayerInterpolation=function(){var D=this.layer.renderer.type;if("raster-colormap"===D||"unique-value"===D||"class-breaks"===D)return"nearest";({interpolation:D}=this.layer);const {renderer:e}=this.layer;return"raster-stretch"===e.type&&null!=e.colorRamp?"bilinear"===D||"cubic"===
D?"bilinear":"nearest":D};return x}(B.BaseImageryTileSubView2D);H.__decorate([r.property()],m.prototype,"container",void 0);H.__decorate([r.property()],m.prototype,"layer",void 0);H.__decorate([r.property()],m.prototype,"type",void 0);return m=H.__decorate([q.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],m)})},"esri/views/2d/engine/imagery/RasterTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/aaBoundingRect ../../viewpointUtils ./BrushRasterBitmap ./RasterTile ../webgl/enums ../webgl/TileContainer".split(" "),
function(C,H,A,r,m,G,q,J){J=function(B){function E(){var x=B.apply(this,arguments)||this;x.isCustomTilingScheme=!1;return x}H._inheritsLoose(E,B);var v=E.prototype;v.createTile=function(x){const M=this._getTileBounds(x),[D,e]=this._tileInfoView.tileInfo.size,d=this._tileInfoView.getTileResolution(x.level);return new G.RasterTile(x,d,M[0],M[3],D,e)};v.prepareRenderPasses=function(x){const M=x.registerRenderPass({name:"imagery (tile)",brushes:[m],target:()=>this.children.map(D=>D.bitmap),drawPhase:q.WGLDrawPhase.MAP});
return[...B.prototype.prepareRenderPasses.call(this,x),M]};v.doRender=function(x){if(this.visible&&x.drawPhase===q.WGLDrawPhase.MAP){var {rasterFunctionChain:M}=this;if(M){var [D,e]=this._tileInfoView.tileInfo.size;x.renderPass="raster";x.rasterFunction={name:"Reproject",parameters:{targetImageSize:[D,e]},pixelType:"f32",id:0,isNoopProcess:!1};B.prototype.doRender.call(this,x);if(M?.functions.length){const {functions:d,hasBranches:c}=M;for(M=0;M<d.length;M++){const g=d[M];"Constant"!==g.name&&"Identity"!==
g.name&&(x.renderPass="raster",x.rasterFunction=g,x.hasBranches=c,B.prototype.doRender.call(this,x))}}x.rasterFunction=null;x.renderPass="bitmap"}else x.renderPass="raster-bitmap";B.prototype.doRender.call(this,x)}};v._getTileBounds=function(x){const M=this._tileInfoView.getTileBounds(A.create(),x);if(this.isCustomTilingScheme&&x.world){var {tileInfo:D}=this._tileInfoView,e=r.getWorldWidth(D.spatialReference);if(e){var d=D.lodAt(x.level);if(!d)return M;({resolution:d}=d);D=(e=e/d%D.size[0])?(D.size[0]-
e)*d:0;M[0]-=D*x.world;M[2]-=D*x.world}}return M};return E}(J);C.RasterTileContainer=J;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushRasterBitmap":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./RasterBitmap ./colorizer/rasterColorizer ./processor/rasterProcessor ../webgl/definitions ../webgl/VertexStream ../webgl/brushes/WGLBrush ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/rasterUtils".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v){return function(x){function M(){var e=x.apply(this,arguments)||this;e.name="raster";e._quad=null;e._rendererUniformInfos=new Map;e._fbo=null;return e}C._inheritsLoose(M,x);var D=M.prototype;D.dispose=function(){H.disposeMaybe(this._quad);H.disposeMaybe(this._fbo)};D.prepareState=function(e){const {context:d,renderPass:c}=e;e="raster"===c;d.setBlendingEnabled(!e);d.setBlendFunctionSeparate(B.BlendFactor.ONE,B.BlendFactor.ONE_MINUS_SRC_ALPHA,B.BlendFactor.ONE,B.BlendFactor.ONE_MINUS_SRC_ALPHA);
d.setColorMask(!0,!0,!0,!0);d.setStencilWriteMask(0);d.setStencilTestEnabled(!e)};D.draw=function(e,d){if(A.hasSource(d)&&!d.suspended){var {renderPass:c}=e;if("raster-bitmap"===c)this._drawBitmap(e,d);else{if("raster"===c)return this._process(e,d);this._drawBitmap(e,d,!0)}}};D._process=function(e,d){var {rasterFunction:c}=e;c="Reproject"===c.name;if(!(c?d.rasterTexture&&d.projected:d.processed)){var {timeline:g,context:t}=e;g.begin(this.name);var N=t.getBoundFramebufferObject(),a=t.getViewport();
c||(d.processedTexture=H.disposeMaybe(d.processedTexture));t.setStencilFunction(B.CompareFunction.EQUAL,d.stencilRef,255);d.updateTexture(e);this._initQuad(t);var {isStandardRasterTileSize:f,fbo:l}=this._getRasterFBO(t,d.width,d.height);m.process(e,this._quad,l,d);f||l.dispose();t.bindFramebuffer(N);t.setViewport(a.x,a.y,a.width,a.height);g.end(this.name)}};D._drawBitmap=function(e,d,c=!1){const {timeline:g,context:t}=e;g.begin(this.name);t.setStencilFunction(B.CompareFunction.EQUAL,d.stencilRef,
255);d.updateTexture(e);if(c&&!d.processedTexture){d.updateProcessedTexture();if(!d.processedTexture){g.end(this.name);return}d.processed=!0}this._initBitmapCommonUniforms(d);var N=d.symbolizerParameters.type;const a=r.getColorizer(N),{requestRender:f,allowDelayedRender:l}=e,{defines:p,program:b}=a.createProgram(e,d,c);l&&H.isSome(f)&&!b.compiled?f():(t.useProgram(b),N=this._getUniformInfos(N,t,b,p),this._quad||(this._quad=new q(t,[0,0,1,0,0,1,1,1])),a.bindTextureAndUniforms(e,b,d,N,c),this._quad.draw(),
g.end(this.name))};D._initBitmapCommonUniforms=function(e){if(!e.commonUniforms){const d=v.getBasicGridUniforms(1,[0,0]),{transformGrid:c,width:g,height:t}=e,N=v.getCommonUniforms(c,[g,t],[e.source.width,e.source.height],1,!1);e.commonUniforms={...d,...N,u_coordScale:e.coordScale}}};D._getRasterFBO=function(e,d,c){const g=d===G.TILE_SIZE||c===G.TILE_SIZE;return g?(this._fbo||(this._fbo=this._createNewFBO(e,d,c)),{isStandardRasterTileSize:g,fbo:this._fbo}):{isStandardRasterTileSize:g,fbo:this._createNewFBO(e,
d,c)}};D._createNewFBO=function(e,d,c){const g=m.createTexture(e,d,c);return new E.FramebufferObject(e,{colorTarget:B.TargetType.TEXTURE,depthStencilTarget:B.DepthStencilTargetType.NONE,width:d,height:c},g)};D._initQuad=function(e){this._quad||(this._quad=new q(e,[0,0,1,0,0,1,1,1]))};D._getUniformInfos=function(e,d,c,g){e=0<g.length?e+"-"+g.join("-"):e;if(this._rendererUniformInfos.has(e))return this._rendererUniformInfos.get(e);d=v.getUniformLocationInfos(d,c);this._rendererUniformInfos.set(e,d);
return d};return M}(J)})},"esri/views/2d/engine/imagery/RasterBitmap":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/pixelUtils ../DisplayObject ../../../webgl/enums ../../../webgl/rasterUtils".split(" "),function(C,H,A,r,m,G,q,J,B,E){const v={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/
255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"};J=function(M){function D(d=null,c=null,g=null){var t=M.call(this)||this;t._textureInvalidated=!0;t._colormapTextureInvalidated=!0;t._rasterTexture=null;t._rasterTextureBandIds=null;t._transformGridTexture=null;t._colormapTexture=null;t._colormap=null;t._supportsBilinearTexture=!0;t._processedTexture=null;t.functionTextures=[];t.projected=!1;t.stencilRef=0;t.coordScale=
[1,1];t._processed=!1;t._symbolizerParameters=null;t.height=null;t.isRendereredSource=!1;t.pixelRatio=1;t.resolution=0;t.rotation=0;t._source=null;t.rawPixelData=null;t._suspended=!1;t._bandIds=null;t._interpolation=null;t._transformGrid=null;t.width=null;t.x=0;t.y=0;t.source=d;t.transformGrid=c;t.interpolation=g;return t}H._inheritsLoose(D,M);var e=D.prototype;e.destroy=function(){this._disposeTextures()};e.invalidateTexture=function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())};
e._createTransforms=function(){return{dvs:m.create()}};e.setTransform=function(d){const c=r.identity(this.transforms.dvs),[g,t]=d.toScreenNoRotation([0,0],[this.x,this.y]);var N=this.resolution/this.pixelRatio/d.resolution;const a=N*this.width;N*=this.height;const f=Math.PI*this.rotation/180;r.translate(c,c,G.fromValues(g,t));r.translate(c,c,G.fromValues(a/2,N/2));r.rotate(c,c,-f);r.translate(c,c,G.fromValues(-a/2,-N/2));r.scaleByVec2(c,c,G.fromValues(a,N));r.multiply(this.transforms.dvs,d.displayViewMat3,
c)};e.getTextures=function({forProcessing:d=!1,useProcessedTexture:c=!1}={}){const g=c?this._processedTexture??this._rasterTexture:this._rasterTexture,t=[],N=[];if(!g)return{names:t,textures:N};if(c)return N.push(g),t.push("u_image"),this._colormapTexture&&(N.push(this._colormapTexture),t.push("u_colormap")),{names:t,textures:N};this._transformGridTexture&&(N.push(this._transformGridTexture),t.push("u_transformGrid"));N.push(g);t.push("u_image");this._colormapTexture&&!d&&(N.push(this._colormapTexture),
t.push("u_colormap"));return{names:t,textures:N}};e.onAttach=function(){this.invalidateTexture()};e.onDetach=function(){this.invalidateTexture()};e.updateTexture=function({context:d}){if(this.stage){var c=this._isValidSource(this.source);c&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(d));this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(d),this._rasterTexture&&(c?this.transformGrid&&!this._transformGridTexture&&
(this._transformGridTexture=E.createTransformTexture(d,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}else this._disposeTextures()};e.updateProcessedTexture=function(){const {functionTextures:d}=this;0!==d.length&&(this.processedTexture=d.shift(),d.forEach(c=>c?.dispose()),d.length=0)};e._createOrDestroyRasterTexture=function(d){const c=A.isSome(this.source)?q.extractBands(this.source,this.bandIds):null;if(this._isValidSource(c)){var g=
!this._isBandIdschanged(this.bandIds);if(this._rasterTexture){if(g)return;this._rasterTexture.dispose();this._rasterTexture=this._rasterTextureBandIds=null}this._supportsBilinearTexture=!!d.capabilities.textureFloat?.textureFloatLinear;g=this._getTextureSamplingMethod(this.interpolation);this._rasterTexture=E.createRasterTexture(d,c,g,this.isRendereredSource||!d.capabilities.textureFloat?.textureFloat);this._processed=this.projected=!1;this._rasterTextureBandIds=this.bandIds?[...this.bandIds]:null}else this._rasterTexture&&
(this._rasterTexture.dispose(),this._rasterTexture=this._rasterTextureBandIds=null)};e._isBandIdschanged=function(d){const c=this._rasterTextureBandIds;return!(null==c&&null==d||c&&d&&c.join("")===d.join(""))};e._isValidSource=function(d){return A.isSome(d)&&0<d.pixels?.length};e._getTextureSamplingMethod=function(d){const {type:c,colormap:g}=this.symbolizerParameters,t="lut"===c||"stretch"===c&&A.isSome(g);return!this._supportsBilinearTexture||t||"bilinear"!==d&&"cubic"!==d?"nearest":"bilinear"};
e._updateColormapTexture=function(d){const c=this._colormap,g=this.symbolizerParameters.colormap;if(!g)this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormap=null;else if(!c)this._colormapTexture=E.createColormapTexture(d,g),this._colormap=g;else if(g.length!==c.length||g.some((t,N)=>t!==c[N]))this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=E.createColormapTexture(d,g),this._colormap=g};e._disposeTextures=
function(d=!1){this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null);!d&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormap=this._colormapTexture=null,this._colormapTextureInvalidated=!0);!d&&this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=this._rasterTexture=null);this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=null)};H._createClass(D,[{key:"processedTexture",get:function(){return this._processedTexture},
set:function(d){this._processedTexture!==d&&(this._disposeTextures(!0),this._processedTexture=d)}},{key:"rasterTexture",get:function(){return this._rasterTexture},set:function(d){this._rasterTexture!==d&&(this._rasterTexture?.dispose(),this._rasterTexture=d)}},{key:"processed",get:function(){return this._processed},set:function(d){this._processed=d;d||(A.disposeMaybe(this.processedTexture),this.invalidateTexture())}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||v},
set:function(d){this._symbolizerParameters!==d&&(this._symbolizerParameters=d,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}},{key:"source",get:function(){return this._source},set:function(d){this._source!==d&&(this._source=d,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=this._rasterTexture=null),this.projected=!1,this.invalidateTexture())}},{key:"suspended",get:function(){return this._suspended},set:function(d){this._suspended&&!d&&this.stage&&(this.ready(),
this.requestRender());this._suspended=d}},{key:"bandIds",get:function(){return this._bandIds},set:function(d){this._bandIds=d;this._isBandIdschanged(d)&&(this.projected=!1,this.invalidateTexture())}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(d){this._interpolation=d;this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(d||"nearest")?B.TextureSamplingMode.LINEAR:B.TextureSamplingMode.NEAREST)}},{key:"transformGrid",
get:function(){return this._transformGrid},set:function(d){this._transformGrid=d;this._transformGridTexture=A.disposeMaybe(this._transformGridTexture)}}]);return D}(J.DisplayObject);let x=function(M){function D(){return M.apply(this,arguments)||this}H._inheritsLoose(D,M);H._createClass(D,[{key:"source",get:function(){return this._source}}]);return D}(J);C.RasterBitmap=J;C.RasterBitmapWithSource=x;C.hasSource=function(M){return A.isSome(M.source)};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},
"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../../../core/maybe","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(C,H,A,r){function m(a){return H.isSome(a)&&"esri.layers.support.PixelBlock"===a.declaredClass&&a.pixels&&0<a.pixels.length}function G(a,f,l,p,b){const k=a.length;b=A.createEmptyBand(b,k);if(f)for(let n=0;n<k;n++)f[n]&&(b[n]=l[a[n]-p]);else for(f=0;f<k;f++)b[f]=l[a[f]-p];return b}function q(a,f,l,p){const b=null!=l&&2<=l.length?new Set(l):
null;l=1===l?.length?l[0]:null;const k=!!f?.length;for(let n=0;n<a.length;n++)if(p[n]){const u=a[n];if(k){let z=!1;for(let K=0;K<f.length;K+=2)if(u>=f[K]&&u<=f[K+1]){z=!0;break}z||(p[n]=0)}p[n]&&(u===l||b?.has(u))&&(p[n]=0)}}function J(a,f){const l=a[0].length;for(let p=0;p<l;p++)if(f[p]){let b=!1;for(let k=0;k<a.length;k++)if(a[k][p]){b=!0;break}b||(f[p]=0)}}function B(a,f){const l=a[0].length;for(let p=0;p<l;p++)if(f[p]){let b=!1;for(let k=0;k<a.length;k++)if(0===a[k][p]){b=!0;break}b&&(f[p]=0)}}
function E(a,f,l,p,b,k,n,u){return{xmin:b<=l*a?0:b<l*a+a?b-l*a:a,ymin:k<=p*f?0:k<p*f+f?k-p*f:f,xmax:b+n<=l*a?0:b+n<l*a+a?b+n-l*a:a,ymax:k+u<=p*f?0:k+u<p*f+f?k+u-p*f:f}}function v(a,f,l,p,b,k){const {width:n,height:u}=l.block,{x:z,y:K}=l.offset,{width:w,height:y}=l.mosaic;l=E(n,u,p,b,z,K,w,y);let F=0;var L=0;if(k){var O=k.hasGCSSShiftTransform?360:k.halfWorldWidth??0,T=n*k.resolutionX;const V=k.startX+p*T;V<O&&V+T>O?L=k.rightPadding:V>=O&&(F=k.leftMargin-k.rightPadding,L=0)}l.xmax-=L;if("number"===
typeof f)for(k=l.ymin;k<l.ymax;k++)for(L=(b*u+k-K)*w+(p*n-z)+F,O=l.xmin;O<l.xmax;O++)a[L+O]=f;else for(k=l.ymin;k<l.ymax;k++)for(L=(b*u+k-K)*w+(p*n-z)+F,O=k*n,T=l.xmin;T<l.xmax;T++)a[L+T]=f[O+T]}function x(a,f,l={}){const {clipOffset:p,clipSize:b,alignmentInfo:k,blockWidths:n}=l;if(n)return M(a,f,{blockWidths:n});var u=a.find(Y=>m(Y));if(H.isNone(u))return null;l=b?b.width:f.width;const z=b?b.height:f.height;var K=u.width,w=u.height;const y=f.width/K,F=f.height/w;f={offset:p||{x:0,y:0},mosaic:b||
f,block:{width:K,height:w}};K=u.pixelType;w=A.getPixelArrayConstructor(K);var L=u.pixels.length;u=[];for(var O=0;O<L;O++){var T=new w(l*z);for(let Y=0;Y<F;Y++)for(let Z=0;Z<y;Z++){var V=a[Y*y+Z];m(V)&&(V=V.pixels[O],v(T,V,f,Z,Y,k))}u.push(T)}let aa;if(a.some(Y=>H.isNone(Y)||H.isSome(Y.mask)&&0<Y.mask.length))for(aa=new Uint8Array(l*z),w=0;w<F;w++)for(L=0;L<y;L++)T=a[w*y+L],O=H.isSome(T)?T.mask:null,H.isSome(O)?v(aa,O,f,L,w,k):T?v(aa,1,f,L,w,k):v(aa,0,f,L,w,k);a=new A({width:l,height:z,pixels:u,pixelType:K,
mask:aa});a.updateStatistics();return a}function M(a,f,l){const p=a.find(L=>H.isSome(L));if(H.isNone(p))return null;var b=a.some(L=>H.isSome(L)?!!L.mask:!0);const {width:k,height:n}=f;f=b?new Uint8Array(k*n):null;({blockWidths:l}=l);const u=[],z=p.getPlaneCount(),K=A.getPixelArrayConstructor(p.pixelType);if(b)for(let L=0,O=0;L<a.length;O+=l[L],L++)if(b=a[L],m(b)){var w=H.unwrap(b.mask);for(var y=0;y<n;y++)for(var F=0;F<l[L];F++)f[y*k+F+O]=null==w?255:w[y*b.width+F]}for(b=0;b<z;b++){w=new K(k*n);for(let L=
0,O=0;L<a.length;O+=l[L],L++)if(y=a[L],m(y)&&(F=y.pixels[b],null!=F))for(let T=0;T<n;T++)for(let V=0;V<l[L];V++)w[T*k+V+O]=F[T*y.width+V];u.push(w)}a=new A({width:k,height:n,mask:f,pixels:u,pixelType:p.pixelType});a.updateStatistics();return a}function D(a){if(!m(a))return null;const f=a.clone(),{width:l,height:p,pixels:b}=a;var k=b[0];const n=f.pixels[0];a=H.unwrap(a.mask);for(let K=2;K<p-1;K++){const w=new Map;for(var u=K-2;u<K+2;u++)for(var z=0;4>z;z++){const y=u*l+z;c(w,k[y],a?a[y]:1)}n[K*l]=
e(w);n[K*l+1]=n[K*l+2]=n[K*l];for(u=3;u<l-1;u++)z=(K-2)*l+u+1,c(w,k[z],a?a[z]:1),z=(K-1)*l+u+1,c(w,k[z],a?a[z]:1),z=K*l+u+1,c(w,k[z],a?a[z]:1),z=(K+1)*l+u+1,c(w,k[z],a?a[z]:1),z=(K-2)*l+u-3,d(w,k[z],a?a[z]:1),z=(K-1)*l+u-3,d(w,k[z],a?a[z]:1),z=K*l+u-3,d(w,k[z],a?a[z]:1),z=(K+1)*l+u-3,d(w,k[z],a?a[z]:1),n[K*l+u]=e(w);n[K*l+u+1]=n[K*l+u]}for(k=0;k<l;k++)n[k]=n[l+k]=n[2*l+k],n[(p-1)*l+k]=n[(p-2)*l+k];f.updateStatistics();return f}function e(a){if(0===a.size)return 0;let f=0,l=-1,p=0;const b=a.keys();
let k=b.next();for(;!k.done;)p=a.get(k.value),p>f&&(l=k.value,f=p),k=b.next();return l}function d(a,f,l){0!==l&&(l=a.get(f),1===l?a.delete(f):a.set(f,l-1))}function c(a,f,l){0!==l&&a.set(f,a.has(f)?a.get(f)+1:1)}function g(a,f,l){let {x:p,y:b}=f;const {width:k,height:n}=l;if(0===p&&0===b&&n===a.height&&k===a.width)return a;const {width:u,height:z}=a;f=Math.max(0,b);const K=Math.max(0,p),w=Math.min(p+k,u),y=Math.min(b+n,z);if(0>w||0>y||!m(a))return null;p=Math.max(0,-p);b=Math.max(0,-b);var {pixels:F}=
a,L=k*n,O=F.length;const T=[];for(var V=0;V<O;V++){var aa=F[V],Y=A.createEmptyBand(a.pixelType,L);for(let Z=f;Z<y;Z++){const da=Z*u;let h=(Z+b-f)*k+p;for(let I=K;I<w;I++)Y[h++]=aa[da+I]}T.push(Y)}F=new Uint8Array(L);L=H.unwrap(a.mask);for(O=f;O<y;O++)for(V=O*u,aa=(O+b-f)*k+p,Y=K;Y<w;Y++)F[aa++]=L?L[V+Y]:1;a=new A({width:l.width,height:l.height,pixelType:a.pixelType,pixels:T,mask:F});a.updateStatistics();return a}function t(a,f=!0){if(!m(a))return null;const {pixels:l,width:p,height:b,mask:k,pixelType:n}=
a;a=[];const u=Math.round(p/2),z=Math.round(b/2),K=b-1,w=p-1;for(var y=0;y<l.length;y++){var F=l[y],L=A.createEmptyBand(n,u*z),O=0;for(var T=0;T<b;T+=2)for(var V=0;V<p;V+=2){var aa=F[T*p+V];if(f){var Y=V===w?aa:F[T*p+V+1];const Z=T===K?aa:F[T*p+V+p],da=V===w?Z:T===K?Y:F[T*p+V+p+1];L[O++]=(aa+Y+Z+da)/4}else L[O++]=aa}a.push(L)}y=null;if(H.isSome(k))for(y=new Uint8Array(u*z),F=0,L=0;L<b;L+=2)for(O=0;O<p;O+=2)T=k[L*p+O],f?(V=O===w?T:k[L*p+O+1],aa=L===K?T:k[L*p+O+p],Y=O===w?aa:L===K?V:k[L*p+O+p+1],y[F++]=
T*V*aa*Y?1:0):y[F++]=T;return new A({width:u,height:z,pixelType:n,pixels:a,mask:y})}function N(a,f,l,p,b=0){const {width:k,height:n}=a,{width:u,height:z}=f;a=p.cols;p=p.rows;f=Math.ceil(u/a-.1/a);const K=Math.ceil(z/p-.1/p);let w,y,F,L,O;const T=f*a;var V=T*K*p;const aa=new Float32Array(V),Y=new Float32Array(V),Z=new Uint32Array(V),da=new Uint32Array(V);let h=0,I,R;for(let Q=0;Q<K;Q++)for(let W=0;W<f;W++){var P=12*(Q*f+W);V=l[P];w=l[P+1];y=l[P+2];F=l[P+3];L=l[P+4];O=l[P+5];for(var S=0;S<p;S++){h=
(Q*p+S)*T+W*a;R=(S+.5)/p;for(let X=0;X<S;X++)I=(X+.5)/a,aa[h+X]=(V*I+w*R+y)*k+b,Y[h+X]=(F*I+L*R+O)*n+b,Z[h+X]=Math.floor(aa[h+X]),da[h+X]=Math.floor(Y[h+X])}P+=6;V=l[P];w=l[P+1];y=l[P+2];F=l[P+3];L=l[P+4];O=l[P+5];for(P=0;P<p;P++)for(h=(Q*p+P)*T+W*a,R=(P+.5)/p,S=P;S<a;S++)I=(S+.5)/a,aa[h+S]=(V*I+w*R+y)*k+b,Y[h+S]=(F*I+L*R+O)*n+b,Z[h+S]=Math.floor(aa[h+S]),da[h+S]=Math.floor(Y[h+S])}return{offsets_x:aa,offsets_y:Y,offsets_xi:Z,offsets_yi:da,gridWidth:T}}C.NoDataInterpretation=void 0;(function(a){a[a.matchAny=
0]="matchAny";a[a.matchAll=1]="matchAll"})(C.NoDataInterpretation||(C.NoDataInterpretation={}));C.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]="bestMatch";a[a.fail=1]="fail"})(C.MissingBandAction||(C.MissingBandAction={}));C.MAX_MAP_SIZE_GPU=6;C.approximateTransform=function(a,f,l,p,b="nearest"){if(!m(a))return null;"majority"===b&&(a=D(a));const {pixels:k,mask:n,pixelType:u}=a,z=a.width;var K=a.height;const w=A.getPixelArrayConstructor(u),y=k.length,{width:F,height:L}=f;a=!1;for(let da=
0;da<l.length;da+=3)-1===l[da]&&-1===l[da+1]&&-1===l[da+2]&&(a=!0);const {offsets_x:O,offsets_y:T,offsets_xi:V,offsets_yi:aa,gridWidth:Y}=N({width:z,height:K},f,l,p,"majority"===b?.5:0);let Z;f=(da,h,I)=>{const R=da instanceof Float32Array||da instanceof Float64Array?0:.5;for(let P=0;P<L;P++){Z=P*Y;for(let S=0;S<F;S++){if(0>O[Z]||0>T[Z])da[P*F+S]=0;else if(I)da[P*F+S]=h[V[Z]+aa[Z]*z];else{const Q=Math.floor(O[Z]),W=Math.floor(T[Z]),X=Math.ceil(O[Z]),U=Math.ceil(T[Z]),ca=O[Z]-Q,ba=T[Z]-W;da[P*F+S]=
!n||n[Q+W*z]&&n[Q+W*z]&&n[Q+U*z]&&n[X+U*z]?(1-ba)*((1-ca)*h[Q+W*z]+ca*h[X+W*z])+ba*((1-ca)*h[Q+U*z]+ca*h[X+U*z])+R:h[V[Z]+aa[Z]*z]}Z++}}};l=[];for(K=0;K<y;K++)p=new w(F*L),f(p,k[K],"nearest"===b||"majority"===b),l.push(p);b=new A({width:F,height:L,pixelType:u,pixels:l});if(H.isSome(n))b.mask=new Uint8Array(F*L),f(b.mask,n,!0);else if(a)for(b.mask=new Uint8Array(F*L),a=0;a<F*L;a++)b.mask[a]=0>O[a]||0>T[a]?0:1;b.updateStatistics();return b};C.clip=g;C.colorize=function(a,f){if(!m(a)||!f||!f.indexedColormap&&
!f.indexed2DColormap)return a;const l=a.clone();var p=l.pixels;let b=l.mask;const k=l.width*l.height;if(1!==p.length)return a;const {indexedColormap:n,indexed2DColormap:u,offset:z,alphaSpecified:K}=f;a=0;p=p[0];f=new Uint8Array(p.length);const w=new Uint8Array(p.length),y=new Uint8Array(p.length);var F=0;if(n){const L=n.length-1;if(H.isSome(b))for(a=0;a<k;a++)b[a]&&(F=4*(p[a]-z),F<z||F>L?b[a]=0:(f[a]=n[F],w[a]=n[F+1],y[a]=n[F+2],b[a]=n[F+3]));else{b=new Uint8Array(k);for(a=0;a<k;a++)F=4*(p[a]-z),
F<z||F>L?b[a]=0:(f[a]=n[F],w[a]=n[F+1],y[a]=n[F+2],b[a]=n[F+3]);l.mask=b}}else if(u)if(H.isSome(b))for(a=0;a<k;a++)b[a]&&(F=u[p[a]],f[a]=F[0],w[a]=F[1],y[a]=F[2],b[a]=F[3]);else{b=new Uint8Array(k);for(a=0;a<k;a++)F=u[p[a]],f[a]=F[0],w[a]=F[1],y[a]=F[2],b[a]=F[3];l.mask=b}l.pixels=[f,w,y];l.statistics=null;l.pixelType="u8";l.maskIsAlpha=K;return l};C.compositeBands=function(a){if(!a?.length||a.some(z=>!m(z)))return null;if(1===a.length)return H.isSome(a[0])?a[0].clone():null;const {width:f,height:l,
pixelType:p}=a[0];if(a.some(z=>z.width!==f||z.height!==l))return null;const b=a.map(({mask:z})=>z).filter(z=>null!=z);let k=null;b.length&&(k=new Uint8Array(f*l),k.set(b[0]),1<b.length&&B(b.slice(1),k));const n=[];a.forEach(({pixels:z})=>n.push(...z));const u=[];a.map(({statistics:z})=>z).filter(z=>z?.length).forEach(z=>u.push(...z));return new A({pixelType:p,width:f,height:l,mask:k,pixels:n,statistics:u.length?u:null})};C.createColormapLUT=function(a){if(a){var f=a.colormap;if(f&&0!==f.length){f=
f.sort((K,w)=>K[0]-w[0]);var l=0;0>f[0][0]&&(l=f[0][0]);var p=Math.max(256,f[f.length-1][0]-l+1),b=new Uint8Array(4*p),k=[],n=0,u=0,z=5===f[0].length;if(65536<p)return f.forEach(K=>{k[K[0]-l]=z?K.slice(1):K.slice(1).concat([255])}),{indexed2DColormap:k,offset:l,alphaSpecified:z};if(a.fillUnspecified)for(a=f[u],n=a[0]-l;n<p;n++)b[4*n]=a[1],b[4*n+1]=a[2],b[4*n+2]=a[3],b[4*n+3]=z?a[4]:255,n===a[0]-l&&(a=u===f.length-1?a:f[++u]);else for(n=0;n<f.length;n++)a=f[n],u=4*(a[0]-l),b[u]=a[1],b[u+1]=a[2],b[u+
2]=a[3],b[u+3]=z?a[4]:255;return{indexedColormap:b,offset:l,alphaSpecified:z}}}};C.createMaskLUT=function(a,f,l){if("u8"!==a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var p=a.includes("16")?65536:256;a=a.includes("s")?-p/2:0;p=new Uint8Array(p);if(f)for(let k=0;k<f.length;k++){var b=Math.ceil(f[2*k]-a);const n=Math.floor(f[2*k+1]-a);for(;b<=n;b++)p[b]=255}else p.fill(255);if(l)for(f=0;f<l.length;f++)p[l[f]-a]=0;return{lut:p,offset:a}};C.createRemapLUT=function(a){const {srcPixelType:f,inputRanges:l,
outputValues:p,allowUnmatched:b,noDataRanges:k,isLastInputRangeInclusive:n,outputPixelType:u}=a;if("u8"!==f&&"s8"!==f&&"u16"!==f&&"s16"!==f)return null;var z=f.includes("16")?65536:256;a=f.includes("s")?-z/2:0;const K=A.createEmptyBand(u,z);z=new Uint8Array(z);b&&z.fill(255);const [w,y]=r.getPixelValueRange(u);if(l?.length&&p?.length){var F=l.map(V=>V-1E-6);F[0]=l[0];n&&(F[F.length-1]=l[l.length-1]);for(var L=0;L<F.length;L++){var O=p[L]>y?y:p[L]<w?w:p[L],T=Math.ceil(F[2*L]-a);const V=Math.floor(F[2*
L+1]-a);for(;T<=V;T++)K[T]=O,z[T]=255}}if(k?.length)for(F=0;F<k.length;F++)for(O=Math.ceil(k[2*F]-a),L=Math.floor(k[2*F+1]-a);O<=L;O++)z[O]=0;return{lut:K,offset:a,mask:z}};C.extractBands=function(a,f){if(!f?.length||!m(a))return a;const l=a.pixels.length;return f&&f.some(p=>p>=l)||1===l&&1===f.length&&0===f[0]||l===f.length&&!f.some((p,b)=>p!==b)?a:new A({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:f.map(p=>a.pixels[p]),
statistics:a.statistics&&f.map(p=>a.statistics[p])})};C.getClipBounds=E;C.getLocalArithmeticNorthRotations=function(a,f){const {coefficients:l,spacing:p}=f,{offsets_x:b,offsets_y:k,gridWidth:n}=N(a,a,l,{rows:p[0],cols:p[1]}),{width:u,height:z}=a;a=new Float32Array(u*z);f=180/Math.PI;for(let y=0;y<z;y++)for(let F=0;F<u;F++){var K=y*n+F,w=0===y?K:K-n;const L=y===z-1?K:K+n;K=b[w]-b[L];w=k[L]-k[w];isNaN(K)||isNaN(w)?a[y*u+F]=90:(w=Math.atan2(w,K)*f,w=(360+w)%360,a[y*u+F]=w)}return a};C.interpolateOffsets=
N;C.isValidPixelBlock=m;C.lookupBandValues=G;C.lookupPixels=function(a,f){if(!m(a))return null;const {pixels:l,mask:p}=a,b=l.length;let k=f.lut;const {offset:n}=f;k&&1===k[0].length&&(k=l.map(()=>k));const u=[];f=f.outputPixelType||"u8";for(let z=0;z<b;z++){const K=G(l[z],p,k[z],n||0,f);u.push(K)}a=new A({width:a.width,height:a.height,pixels:u,mask:p,pixelType:f});a.updateStatistics();return a};C.mask=function(a,f){if(!m(a))return null;const {width:l,height:p,pixels:b}=a;var k=l*p;const n=new Uint8Array(k);
a.mask?n.set(a.mask):n.fill(255);a=b.length;const {includedRanges:u,noDataValues:z,outputPixelType:K,matchAll:w,lookups:y}=f;if(y){k=[];for(f=0;f<a;f++){var F=y[f];F=G(b[f],n,F.lut,F.offset||0,"u8");k.push(F)}1===k.length?n.set(k[0]):w?J(k,n):B(k,n)}else if(w){f=[];for(F=0;F<a;F++){const L=new Uint8Array(k);L.set(n);q(b[F],u?.slice(2*F,2*F+2),z?.[F],L);f.push(L)}1===f.length?n.set(f[0]):J(f,n)}else for(k=0;k<a;k++)q(b[k],u?.slice(2*k,2*k+2),z?.[k],n);return new A({width:l,height:p,pixelType:K,pixels:b,
mask:n})};C.mosaic=x;C.mosaicPixelData=function(a,f){if(!a||0===a.length)return null;var l=a.find(y=>y.pixelBlock);if(!l||H.isNone(l.pixelBlock))return null;var p=(l.extent.xmax-l.extent.xmin)/l.pixelBlock.width;const b=(l.extent.ymax-l.extent.ymin)/l.pixelBlock.height,k=.01*Math.min(p,b),n=a.sort((y,F)=>Math.abs(y.extent.ymax-F.extent.ymax)>k?F.extent.ymax-y.extent.ymax:Math.abs(y.extent.xmin-F.extent.xmin)>k?y.extent.xmin-F.extent.xmin:0);var u=Math.min.apply(null,n.map(y=>y.extent.xmin));const z=
Math.min.apply(null,n.map(y=>y.extent.ymin)),K=Math.max.apply(null,n.map(y=>y.extent.xmax)),w=Math.max.apply(null,n.map(y=>y.extent.ymax));a={x:Math.round((f.xmin-u)/p),y:Math.round((w-f.ymax)/b)};u={width:Math.round((K-u)/p),height:Math.round((w-z)/b)};p={width:Math.round((f.xmax-f.xmin)/p),height:Math.round((f.ymax-f.ymin)/b)};if(Math.round(u.width/l.pixelBlock.width)*Math.round(u.height/l.pixelBlock.height)!==n.length||0>a.x||0>a.y||u.width<p.width||u.height<p.height)return null;l=n.map(y=>y.pixelBlock);
l=x(l,u,{clipOffset:a,clipSize:p});return{extent:f,pixelBlock:l}};C.remap=function(a,f){if(!m(a))return null;const {width:l,height:p}=a,{inputRanges:b,outputValues:k,outputPixelType:n,noDataRanges:u,allowUnmatched:z,isLastInputRangeInclusive:K}=f;f=a.pixels[0];const w=A.createEmptyBand(n,f.length),y=a.mask,F=new Uint8Array(l*p);y?F.set(y):F.fill(255);const L=a.pixelType.startsWith("f")?1E-6:0;var O=b.map(h=>h-L);O[0]=b[0];O[O.length-1]=b[b.length-1]+(K?1E-6:0);a=b.length/2;const [T,V]=r.getPixelValueRange(n);
for(var aa=0;aa<p;aa++)for(var Y=0;Y<l;Y++){var Z=aa*l+Y;if(F[Z]){var da=f[Z];let h=!1;for(let I=a-1;0<=I;I--)if(da===O[2*I]||da>O[2*I]&&da<O[2*I+1]){w[Z]=k[I];h=!0;break}h||(z?w[Z]=da>V?V:da<T?T:da:F[Z]=0)}}if(u?.length)for(O=0;O<p;O++)for(aa=0;aa<l;aa++)if(Y=O*l+aa,!y||y[Y])for(Z=f[Y],da=0;da<a;da+=2)if(Z>=u[da]&&Z<=u[da+1]){w[Y]=0;F[Y]=0;break}return new A({width:l,height:p,pixelType:n,pixels:[w],mask:F})};C.remapColor=function(a,f){if(!m(a))return null;a=a.clone();var {pixels:l}=a;const p=a.width*
a.height,b=f.length,k=Math.floor(b/2),n=f[Math.floor(k)];l=l[0];let u,z,K,w,y,F,L=!1;const O=new Uint8Array(p),T=new Uint8Array(p),V=new Uint8Array(p);let aa=a.mask;const Y=4===f[0].mappedColor.length;aa||(aa=new Uint8Array(p),aa.fill(Y?255:1),a.mask=aa);for(y=0;y<p;y++)if(aa[y]){u=l[y];L=!1;F=k;z=n;K=0;for(w=b-1;1<w-K;){if(u===z.value){L=!0;break}u>z.value?K=F:w=F;F=Math.floor((K+w)/2);z=f[Math.floor(F)]}L||(u===f[K].value?(z=f[K],L=!0):u===f[w].value?(z=f[w],L=!0):u<f[K].value?(L=!1,z=null):u>f[K].value&&
(u<f[w].value?(z=f[K],L=!0):w===b-1?(L=!1,z=null):(z=f[w],L=!0)));L?(O[y]=z.mappedColor[0],T[y]=z.mappedColor[1],V[y]=z.mappedColor[2],aa[y]=z.mappedColor[3]):O[y]=T[y]=V[y]=aa[y]=0}a.pixels=[O,T,V];a.mask=aa;a.pixelType="u8";a.maskIsAlpha=Y;return a};C.resampleByMajority=D;C.setValidBoundary=function(a,f,l){if(!m(a))return null;const {width:p,height:b}=a,k=f.x;f=f.y;const n=l.width+k;l=l.height+f;if(0>k||0>f||n>p||l>b||0===k&&0===f&&n===p&&l===b)return a;a.mask||(a.mask=new Uint8Array(p*b));const u=
a.mask;for(let z=0;z<b;z++){const K=z*p;for(let w=0;w<p;w++)u[K+w]=z<f||z>=l||w<k||w>=n?0:1}a.updateStatistics();return a};C.split=function(a,f,l){if(!m(a))return null;const {width:p,height:b}=f;let {width:k,height:n}=a;const u=new Map,z={x:0,y:0};l=null==l?1:1+l;for(let K=0;K<l;K++){const w=Math.ceil(k/p),y=Math.ceil(n/b);for(let F=0;F<y;F++){z.y=F*b;for(let L=0;L<w;L++){z.x=L*p;const O=g(a,z,f);u.set(`${K}/${F}/${L}`,O)}}K<l-1&&(a=t(a));k=Math.round(k/2);n=Math.round(n/2)}return u};Object.defineProperty(C,
Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),function(C,H,A,r,m,G,q,J,B,E,v,x){var M;r=M=function(D){function e(c){c=
D.call(this,c)||this;c.width=null;c.height=null;c.pixelType="f32";c.validPixelCount=null;c.mask=null;c.maskIsAlpha=!1;c.premultiplyAlpha=!1;c.statistics=null;c.depthCount=1;return c}C._inheritsLoose(e,D);e.createEmptyBand=function(c,g){return new (M.getPixelArrayConstructor(c))(g)};e.getPixelArrayConstructor=function(c){let g;switch(c){case "u1":case "u2":case "u4":case "u8":g=Uint8Array;break;case "u16":g=Uint16Array;break;case "u32":g=Uint32Array;break;case "s8":g=Int8Array;break;case "s16":g=Int16Array;
break;case "s32":g=Int32Array;break;case "f32":g=Float32Array;break;case "f64":g=Float64Array;break;case "c64":case "c128":case "unknown":g=Float32Array}return g};var d=e.prototype;d.castPixelType=function(c){if(!c)return"f32";c=c.toLowerCase();["u1","u2","u4"].includes(c)?c="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(c)||(c="f32");return c};d.getPlaneCount=function(){return this.pixels?.length};d.addData=function(c){if(!c.pixels||c.pixels.length!==this.width*this.height)throw new A("pixelblock:invalid-or-missing-pixels",
"add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(c.pixels);this.statistics.push(c.statistics??new v.SimpleBandStatistics)};d.getAsRGBA=function(){const c=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(c);break;default:this._fillFrom8Bit(c)}return new Uint8ClampedArray(c)};
d.getAsRGBAFloat=function(){const c=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(c);return c};d.updateStatistics=function(){if(this.pixels){this.statistics=this.pixels.map(t=>this._calculateBandStatistics(t,this.mask));var c=this.mask,g=0;if(q.isSome(c))for(let t=0;t<c.length;t++)c[t]&&g++;else g=this.width*this.height;this.validPixelCount=g}};d.clamp=function(c){if(c&&"f64"!==c&&"f32"!==c&&this.pixels){var [g,t]=x.getPixelValueRange(c),N=this.pixels,a=this.width*this.height,f=N.length,
l=[];for(let n=0;n<f;n++){var p=M.createEmptyBand(c,a);var b=N[n];for(let u=0;u<a;u++){var k=b[u];p[u]=k>t?t:k<g?g:k}l.push(p)}this.pixels=l;this.pixelType=c}};d.extractBands=function(c){const {pixels:g,statistics:t}=this;if(q.isNone(c)||0===c.length||!g||0===g.length)return this;var N=g.length;const a=c.some(f=>f>=g.length);N=N===c.length&&!c.some((f,l)=>f!==l);return a||N?this:new M({pixelType:this.pixelType,width:this.width,height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,
maskIsAlpha:this.maskIsAlpha,pixels:c.map(f=>g[f]),statistics:t&&c.map(f=>t[f])})};d.clone=function(){const c=new M({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});q.isSome(this.mask)&&(c.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));let g;const t=M.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){c.pixels=[];const N=!!this.pixels[0].slice;for(g=0;g<
this.pixels.length;g++)c.pixels[g]=N?this.pixels[g].slice(0,this.pixels[g].length):new t(this.pixels[g])}if(this.statistics)for(c.statistics=[],g=0;g<this.statistics.length;g++)c.statistics[g]=m.clone(this.statistics[g]);c.premultiplyAlpha=this.premultiplyAlpha;return c};d._fillFrom8Bit=function(c){const {mask:g,maskIsAlpha:t,premultiplyAlpha:N,pixels:a}=this;if(c&&a&&a.length){var f,l;var p=f=l=a[0];3<=a.length?(f=a[1],l=a[2]):2===a.length&&(f=a[1]);var b=new Uint32Array(c),k=this.width*this.height;
if(p.length!==k)G.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(q.isSome(g)&&g.length===k)if(t)for(c=0;c<k;c++){const n=g[c];if(n){const u=n/255;b[c]=N?n<<24|l[c]*u<<16|f[c]*u<<8|p[c]*u:n<<24|l[c]<<16|f[c]<<8|p[c]}}else for(c=0;c<k;c++)g[c]&&(b[c]=-16777216|l[c]<<16|f[c]<<8|p[c]);else for(c=0;c<k;c++)b[c]=-16777216|l[c]<<16|f[c]<<8|p[c]}else G.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};
d._fillFromNon8Bit=function(c){const {pixels:g,mask:t,statistics:N}=this;if(c&&g&&g.length){var a=this.pixelType,f=1,l=0;f=1;if(N&&0<N.length){for(var p of N)null!=p.minValue&&(l=Math.min(l,p.minValue)),null!=p.maxValue&&null!=p.minValue&&(f=Math.max(f,p.maxValue-p.minValue));f=255/f}else f=255,"s8"===a?(l=-128,f=127):"u16"===a?f=65535:"s16"===a?(l=-32768,f=32767):"u32"===a?f=4294967295:"s32"===a?(l=-2147483648,f=2147483647):"f32"===a?(l=-3.4*1E39,f=3.4*1E39):"f64"===a&&(l=-Number.MAX_VALUE,f=Number.MAX_VALUE),
f=255/(f-l);c=new Uint32Array(c);a=this.width*this.height;var b,k,n;p=b=k=g[0];if(p.length!==a)return G.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=g.length)if(b=g[1],3<=g.length&&(k=g[2]),q.isSome(t)&&t.length===a)for(n=0;n<a;n++)t[n]&&(c[n]=-16777216|(k[n]-l)*f<<16|(b[n]-l)*f<<8|(p[n]-l)*f);else for(n=0;n<a;n++)c[n]=-16777216|(k[n]-l)*f<<16|(b[n]-l)*f<<8|(p[n]-l)*f;else if(q.isSome(t)&&t.length===a)for(n=0;n<a;n++)b=(p[n]-l)*f,
t[n]&&(c[n]=-16777216|b<<16|b<<8|b);else for(n=0;n<a;n++)b=(p[n]-l)*f,c[n]=-16777216|b<<16|b<<8|b}else G.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};d._fillFrom32Bit=function(c){const {pixels:g,mask:t}=this;if(!c||!g||!g.length)return G.getLogger(this.declaredClass).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let N,a,f,l;N=a=f=g[0];3<=g.length?(a=g[1],f=g[2]):2===g.length&&(a=g[1]);const p=
this.width*this.height;if(N.length!==p)return G.getLogger(this.declaredClass).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let b=0;if(q.isSome(t)&&t.length===p)for(l=0;l<p;l++)c[b++]=N[l],c[b++]=a[l],c[b++]=f[l],c[b++]=t[l]&1;else for(l=0;l<p;l++)c[b++]=N[l],c[b++]=a[l],c[b++]=f[l],c[b++]=1};d._calculateBandStatistics=function(c,g){let t=Infinity,N=-Infinity;const a=c.length;let f,l=0;if(q.isSome(g))for(f=0;f<a;f++)g[f]&&(l=c[f],t=l<t?l:t,N=l>N?l:N);else for(f=
0;f<a;f++)l=c[f],t=l<t?l:t,N=l>N?l:N;return new v.SimpleBandStatistics(t,N)};return e}(r.JSONSupport);H.__decorate([J.property({json:{write:!0}})],r.prototype,"width",void 0);H.__decorate([J.property({json:{write:!0}})],r.prototype,"height",void 0);H.__decorate([J.property({json:{write:!0}})],r.prototype,"pixelType",void 0);H.__decorate([B.cast("pixelType")],r.prototype,"castPixelType",null);H.__decorate([J.property({json:{write:!0}})],r.prototype,"validPixelCount",void 0);H.__decorate([J.property({json:{write:!0}})],
r.prototype,"mask",void 0);H.__decorate([J.property({json:{write:!0}})],r.prototype,"maskIsAlpha",void 0);H.__decorate([J.property({json:{write:!0}})],r.prototype,"pixels",void 0);H.__decorate([J.property()],r.prototype,"premultiplyAlpha",void 0);H.__decorate([J.property({json:{write:!0}})],r.prototype,"statistics",void 0);H.__decorate([J.property({json:{write:!0}})],r.prototype,"depthCount",void 0);H.__decorate([J.property({json:{write:!0}})],r.prototype,"noDataValues",void 0);H.__decorate([J.property({json:{write:!0}})],
r.prototype,"bandMasks",void 0);return r=M=H.__decorate([E.subclass("esri.layers.support.PixelBlock")],r)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],function(C){C.SimpleBandStatistics=function(H=null,A=null,r=null){this.minValue=H;this.maxValue=A;this.noDataValue=r};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],function(C){function H(r){return A[r]??[-3.4028234663852886E38,
3.4028234663852886E38]}const A={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};C.convertNoDataToMask=function(r,m,G){if(!(r.depthCount&&1<r.depthCount)){var {pixels:q,statistics:J,pixelType:B}=r,E=q[0].length,v=r.bandMasks??[],x=r.mask??(new Uint8Array(E)).fill(255),M="f32"===B||"f64"===B,D=H(B),e=!1;for(let g=0;g<q.length;g++){const t=
"number"===typeof m?m:m[g];if(null==t)continue;var d=J?.[g].maxValue??D[1];if((J?.[g].minValue??D[0])>t+Number.EPSILON||d<t-Number.EPSILON)continue;d=v[g]||(new Uint8Array(E)).fill(255);const N=q[g];var c=G?.customFloatTolerance;if(M&&0!==c){c||(c=9.999999E37<=Math.abs(t)?2E-7*Math.abs(t):"f32"===B?2**-23:Number.EPSILON);for(let a=0;a<N.length;a++)d[a]&&Math.abs(N[a]-t)<c&&(N[a]=0,d[a]=0,x[a]=0,e=!0)}else for(c=0;c<N.length;c++)d[c]&&N[c]===t&&(N[c]=0,d[c]=0,x[c]=0,e=!0);v[g]=d}e&&(r.bandMasks=v,
r.mask=x);e&&"updateStatistics"in r&&r.updateStatistics()}};C.getPixelValueRange=H;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/webgl/rasterUtils":function(){define("exports ../../core/maybe ../../chunks/vec2f64 ./context-util ./enums ./Texture".split(" "),function(C,H,A,r,m,G){C.createColormapTexture=function(q,J){return new G.Texture(q,{width:J.length/4,height:1,target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,internalFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,
samplingMode:m.TextureSamplingMode.NEAREST,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},J)};C.createRasterTexture=function(q,J,B="nearest",E=!1){const v=(E=!(E&&"u8"===J.pixelType))?m.PixelType.FLOAT:m.PixelType.UNSIGNED_BYTE,x=null==J.pixels||0===J.pixels.length?null:E?J.getAsRGBAFloat():J.getAsRGBA();return new G.Texture(q,{width:J.width,height:J.height,target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,internalFormat:q.type===r.ContextType.WEBGL2&&E?m.SizedPixelFormat.RGBA32F:
m.PixelFormat.RGBA,samplingMode:!q.capabilities.textureFloat?.textureFloatLinear||"bilinear"!==B&&"cubic"!==B?m.TextureSamplingMode.NEAREST:m.TextureSamplingMode.LINEAR,dataType:v,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},x)};C.createTransformTexture=function(q,J){const {spacing:B,offsets:E,coefficients:v,size:[x,M]}=J;var D=1<B[0];J={width:D?4*x:x,height:M,target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,internalFormat:q.type===r.ContextType.WEBGL2?m.SizedPixelFormat.RGBA32F:
m.PixelFormat.RGBA,dataType:m.PixelType.FLOAT,samplingMode:m.TextureSamplingMode.NEAREST,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1};const e=new Float32Array(D?x*M*16:2*E.length);if(D&&null!=v)for(let d=0,c=0;d<v.length;d++)e[c++]=v[d],2===d%3&&(e[c++]=1);else for(D=0;D<M;D++)for(let d=0;d<x;d++){const c=4*(D*x+d),g=2*(d*M+D);e[c]=E[g];e[c+1]=E[g+1];e[c+3]=-1===E[g]?0:1}return new G.Texture(q,J,e)};C.getBasicGridUniforms=function(q,J){return{u_scale:q,u_offset:J}};C.getColormapUniforms=function(q,
J){return{u_colormapOffset:J||0,u_colormapMaxIndex:q?q.length/4-1:0}};C.getCommonUniforms=function(q,J,B,E=1,v=!0){return{u_flipY:v,u_applyTransform:q?!0:!1,u_opacity:E,u_transformSpacing:q?q.spacing:A.ZEROS,u_transformGridSize:q?q.size:A.ZEROS,u_targetImageSize:J,u_srcImageSize:B}};C.getShadedReliefUniforms=function(q){return{u_hillshadeType:q.hillshadeType,u_sinZcosAs:q.sinZcosAs,u_sinZsinAs:q.sinZsinAs,u_cosZs:q.cosZs,u_weights:q.weights,u_factor:q.factor,u_minValue:q.minValue,u_maxValue:q.maxValue}};
C.getStretchUniforms=function(q){return{u_bandCount:q.bandCount,u_minOutput:q.outMin,u_maxOutput:q.outMax,u_minCutOff:q.minCutOff,u_maxCutOff:q.maxCutOff,u_factor:q.factor,u_useGamma:q.useGamma,u_gamma:q.gamma,u_gammaCorrection:q.gammaCorrection}};C.getUniformLocationInfos=function(q,J){q=q.gl;J=J.glName;const B=new Map;if(H.isNone(J))return B;const E=q.getProgramParameter(J,q.ACTIVE_UNIFORMS);let v;for(let x=0;x<E;x++)(v=q.getActiveUniform(J,x))&&B.set(v.name,{location:q.getUniformLocation(J,v.name),
info:v});return B};C.setTextures=function(q,J,B,E){B.length===E.length&&(E.some(v=>null==v)||B.some(v=>null==v)||B.forEach((v,x)=>{J.setUniform1i(v,x);q.bindTexture(E[x],x)}))};C.setUniforms=function(q,J,B){Object.keys(B).forEach(E=>{var v=J.get(E)||J.get(E+"[0]");if(v){var x=B[E];if(null!==v&&null!=x)switch({info:v}=v,v.type){case m.UniformType.FLOAT:1<v.size?q.setUniform1fv(E,x):q.setUniform1f(E,x);break;case m.UniformType.FLOAT_VEC2:q.setUniform2fv(E,x);break;case m.UniformType.FLOAT_VEC3:q.setUniform3fv(E,
x);break;case m.UniformType.FLOAT_VEC4:q.setUniform4fv(E,x);break;case m.UniformType.FLOAT_MAT3:q.setUniformMatrix3fv(E,x);break;case m.UniformType.FLOAT_MAT4:q.setUniformMatrix4fv(E,x);break;case m.UniformType.INT:1<v.size?q.setUniform1iv(E,x):q.setUniform1i(E,x);break;case m.UniformType.BOOL:q.setUniform1i(E,x?1:0);break;case m.UniformType.INT_VEC2:case m.UniformType.BOOL_VEC2:q.setUniform2iv(E,x);break;case m.UniformType.INT_VEC3:case m.UniformType.BOOL_VEC3:q.setUniform3iv(E,x);break;case m.UniformType.INT_VEC4:case m.UniformType.BOOL_VEC4:q.setUniform4iv(E,
x)}}})};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/rasterColorizer":function(){define(["exports","./lut","./shadedrelief","./stretch"],function(C,H,A,r){const m=new Map;m.set("lut",H);m.set("hillshade",A);m.set("stretch",r);C.getColorizer=function(G){return m.get(G)};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/lut":function(){define(["./utils","../../../../webgl/rasterUtils"],function(C,
H){const A={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(r,m,G){m=G?[]:C.getProjectionDefines(m.transformGrid);r=r.painter.materialManager.getProgram(A,m);return{defines:m,program:r}},bindTextureAndUniforms:function(r,m,G,q,J=!1){const {names:B,textures:E}=G.getTextures({useProcessedTexture:J});H.setTextures(r.context,m,B,E);H.setUniforms(m,q,G.commonUniforms);m.setUniformMatrix3fv("u_dvsMat3",G.transforms.dvs);const {colormap:v,
colormapOffset:x}=G.symbolizerParameters;r=H.getColormapUniforms(v,x);H.setUniforms(m,q,r)}}})},"esri/views/2d/engine/imagery/colorizer/utils":function(){define(["exports"],function(C){C.getInterpolationDefines=function(H,A,r){r=!r.capabilities.textureFloat?.textureFloatLinear;const m=[];"cubic"===H?m.push("bicubic"):"bilinear"===H&&(A?(m.push("bilinear"),m.push("nnedge")):r&&m.push("bilinear"));return m};C.getProjectionDefines=function(H){const A=[];H&&(A.push("applyProjection"),1===H.spacing[0]&&
A.push("lookupProjection"));return A};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/colorizer/shadedrelief":function(){define(["./utils","../../../../webgl/rasterUtils"],function(C,H){const A={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(r,m,G){const {colormap:q}=m.symbolizerParameters;G=G?[]:C.getProjectionDefines(m.transformGrid);m=C.getInterpolationDefines(m.interpolation,
null!=q,r.context);m=[...G,...m];null!=q&&m.push("applyColormap");r=r.painter.materialManager.getProgram(A,m);return{defines:m,program:r}},bindTextureAndUniforms:function(r,m,G,q,J=!1){const {names:B,textures:E}=G.getTextures({useProcessedTexture:J});H.setTextures(r.context,m,B,E);H.setUniforms(m,q,G.commonUniforms);m.setUniformMatrix3fv("u_dvsMat3",G.transforms.dvs);r=G.symbolizerParameters;const {colormap:v,colormapOffset:x}=r;null!=v&&(G=H.getColormapUniforms(v,x),H.setUniforms(m,q,G));r=H.getShadedReliefUniforms(r);
H.setUniforms(m,q,r)}}})},"esri/views/2d/engine/imagery/colorizer/stretch":function(){define(["./utils","../../../../webgl/rasterUtils"],function(C,H){const A={vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(r,m,G){const {colormap:q}=m.symbolizerParameters;var J=G?[]:C.getProjectionDefines(m.transformGrid);const B=C.getInterpolationDefines(m.interpolation,null!=q,r.context);J=[...J,...B];m.isRendereredSource&&!G?
J.push("noop"):null!=q&&J.push("applyColormap");r=r.painter.materialManager.getProgram(A,J);return{defines:J,program:r}},bindTextureAndUniforms:function(r,m,G,q,J=!1){const {names:B,textures:E}=G.getTextures({useProcessedTexture:J});H.setTextures(r.context,m,B,E);H.setUniforms(m,q,G.commonUniforms);m.setUniformMatrix3fv("u_dvsMat3",G.transforms.dvs);r=G.symbolizerParameters;const {colormap:v,colormapOffset:x}=r;null!=v&&(G=H.getColormapUniforms(v,x),H.setUniforms(m,q,G));r=H.getStretchUniforms(r);
H.setUniforms(m,q,r)}}})},"esri/views/2d/engine/imagery/processor/rasterProcessor":function(){define("exports ../../../../../core/maybe ./aspectProcessor ./bandArithmeticProcessor ./compositeBandProcessor ./convolutionProcessor ./extractBandProcessor ./localProcessor ./maskProcessor ./ndviProcessor ./remapProcessor ./reprojectProcessor ./slopeProcessor ./stretchProcessor ../../../../webgl/context-util ../../../../webgl/enums ../../../../webgl/Texture".split(" "),function(C,H,A,r,m,G,q,J,B,E,v,x,M,
D,e,d,c){function g(N,a,f){return new c.Texture(N,{width:a,height:f,target:d.TextureType.TEXTURE_2D,pixelFormat:d.PixelFormat.RGBA,internalFormat:N.type===e.ContextType.WEBGL2?d.SizedPixelFormat.RGBA32F:d.PixelFormat.RGBA,samplingMode:d.TextureSamplingMode.NEAREST,dataType:d.PixelType.FLOAT,isImmutable:N.type===e.ContextType.WEBGL2,wrapMode:d.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1})}const t=new Map;t.set("aspect",A);t.set("bandarithmetic",r);t.set("compositeband",m);t.set("convolution",G);t.set("extractband",
q);t.set("local",J);t.set("mask",B);t.set("ndvi",E);t.set("remap",v);t.set("slope",M);t.set("stretch",D);C.createTexture=g;C.process=function(N,a,f,l){const p=N.rasterFunction.name.toLowerCase(),b="reproject"===p?x:t.get(p.toLowerCase());if(null!=b){{const {context:w,requestRender:y,allowDelayedRender:F}=N;var k=b.createProgram(N,l);if(F&&H.isSome(y)&&!k.compiled)y(),k=null;else{var {width:n,height:u}=l;w.bindFramebuffer(f);w.setViewport(0,0,n,u);w.useProgram(k)}}if(k){b.bindTextureAndUniforms(N,
k,l);a.draw();var {width:z,height:K}=l;a=g(N.context,z,K);f.copyToTexture(0,0,z,K,0,0,a);"reproject"===p?(l.rasterTexture=a,l.projected=!0):l.functionTextures[N.hasBranches?N.rasterFunction.id:0]=a}}};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/processor/aspectProcessor":function(){define(["./utils"],function(C){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(A,
r){return A.painter.materialManager.getProgram(H,[])},bindTextureAndUniforms:function(A,r,m){C.setSingleImageTextures(A,r,m);C.setCoordsAndTransforms(r);const {width:G,height:q,resolution:J}=m;r.setUniform2fv("u_srcImageSize",[G,q]);r.setUniform2fv("u_cellSize",[J,J])}}})},"esri/views/2d/engine/imagery/processor/utils":function(){define(["exports","../../../../webgl/rasterUtils"],function(C,H){function A(G,q,J){const {context:B,rasterFunction:E,hasBranches:v}=G;({raster:G}=E.parameters);H.setTextures(B,
q,["u_image"],[J.functionTextures[v?G?.id??-1:0]??J.rasterTexture])}const r=[1,1],m=[2,0,0,0,2,0,-1,-1,0];C.setCoordsAndTransforms=function(G){G.setUniform2fv("u_coordScale",r);G.setUniformMatrix3fv("u_dvsMat3",m)};C.setMultipleImageTextures=function(G,q,J){var {rasters:B}=G.rasterFunction.parameters;if(B){if(2>B.length)return A(G,q,J);var E=B.filter(v=>"Constant"!==v.name).map(v=>null!=v.id&&"Identity"!==v.name?J.functionTextures[v.id]:J.rasterTexture);H.setTextures(G.context,q,["u_image","u_image1",
"u_image2"].slice(0,E.length),E);if(E.length!==B.length)if(2===B.length)E=B.findIndex(v=>"Constant"===v.name),G=0===E?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],{value:B}=B[E].parameters,q.setUniform1f("u_image1Const",B),q.setUniformMatrix3fv("u_imageSwap",G);else if(3===B.length){const v=[];B.forEach((x,M)=>"Constant"===x.name&&v.push(M));1===v.length?({value:B}=B[v[0]].parameters,q.setUniform1f("u_image1Const",B),q.setUniformMatrix3fv("u_imageSwap",0===v[0]?[0,1,0,0,0,1,1,0,0]:1===v[0]?[1,0,0,0,0,
1,0,1,0]:[1,0,0,0,1,0,0,0,1])):2===v.length&&({value:G}=B[v[0]].parameters,q.setUniform1f("u_image1Const",G),{value:G}=B[v[1]].parameters,q.setUniform1f("u_image2Const",G),B=B.findIndex(x=>"Constant"!==x.name),q.setUniformMatrix3fv("u_imageSwap",0===B?[1,0,0,0,1,0,0,0,1]:1===B?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0]))}}};C.setSingleImageTextures=A;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/processor/bandArithmeticProcessor":function(){define(["./utils"],
function(C){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(A,r){const {painter:m,rasterFunction:G}=A;({indexType:A}=G.parameters);return m.materialManager.getProgram(H,[A])},bindTextureAndUniforms:function(A,r,m){C.setSingleImageTextures(A,r,m);C.setCoordsAndTransforms(r);({bandIndexMat3:A}=A.rasterFunction.parameters);r.setUniformMatrix3fv("u_bandIndexMat3",A)}}})},"esri/views/2d/engine/imagery/processor/compositeBandProcessor":function(){define(["./utils"],
function(C){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(A,r){return A.painter.materialManager.getProgram(H,[])},bindTextureAndUniforms:function(A,r,m){C.setMultipleImageTextures(A,r,m);C.setCoordsAndTransforms(r)}}})},"esri/views/2d/engine/imagery/processor/convolutionProcessor":function(){define(["./utils"],function(C){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",
0],["a_texcoord",1]])};return{createProgram:function(A,r){const {painter:m,rasterFunction:G}=A,{kernelRows:q,kernelCols:J}=G.parameters;return m.materialManager.getProgram(H,[{name:"rows",value:q},{name:"cols",value:J}])},bindTextureAndUniforms:function(A,r,m){C.setSingleImageTextures(A,r,m);C.setCoordsAndTransforms(r);r.setUniform2fv("u_srcImageSize",[m.width,m.height]);const {kernel:G,clampRange:q}=A.rasterFunction.parameters;r.setUniform1fv("u_kernel",G);r.setUniform2fv("u_clampRange",q)}}})},
"esri/views/2d/engine/imagery/processor/extractBandProcessor":function(){define(["./utils"],function(C){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(A,r){return A.painter.materialManager.getProgram(H,[])},bindTextureAndUniforms:function(A,r,m){C.setSingleImageTextures(A,r,m);C.setCoordsAndTransforms(r);({bandIndexMat3:A}=A.rasterFunction.parameters);r.setUniformMatrix3fv("u_bandIndexMat3",A)}}})},
"esri/views/2d/engine/imagery/processor/localProcessor":function(){define(["./utils","../../../../webgl/context-util"],function(C,H){const A={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])},r=new Set("sinh cosh tanh asinh acosh atanh".split(" "));return{createProgram:function(m){const {painter:G,rasterFunction:q}=m,{imageCount:J,operationName:B,rasters:E,isOutputRounded:v}=q.parameters;var x=B.toLowerCase();m.context.type===H.ContextType.WEBGL1&&
r.has(x)&&(x=`polyfill${x}`);m=[x];2===J&&m.push("twoImages");x=E.filter(M=>"Constant"===M.name);x.length&&(m.push("oneConstant"),2===x.length&&m.push("twoConstant"));v&&m.push("roundOutput");return G.materialManager.getProgram(A,m)},bindTextureAndUniforms:function(m,G,q){C.setMultipleImageTextures(m,G,q);C.setCoordsAndTransforms(G);({domainRange:m}=m.rasterFunction.parameters);G.setUniform2fv("u_domainRange",m)}}})},"esri/views/2d/engine/imagery/processor/maskProcessor":function(){define(["./utils"],
function(C){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(A,r){const {painter:m,rasterFunction:G}=A;return m.materialManager.getProgram(H,1<G.parameters.bandCount?["multiBand"]:[])},bindTextureAndUniforms:function(A,r,m){C.setSingleImageTextures(A,r,m);C.setCoordsAndTransforms(r);const {includedRanges:G,noDataValues:q}=A.rasterFunction.parameters;r.setUniform1fv("u_includedRanges",G);r.setUniform1fv("u_noDataValues",
q)}}})},"esri/views/2d/engine/imagery/processor/ndviProcessor":function(){define(["./utils"],function(C){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(A,r){const {painter:m,rasterFunction:G}=A;return m.materialManager.getProgram(H,G.parameters.scaled?["scaled"]:[])},bindTextureAndUniforms:function(A,r,m){C.setSingleImageTextures(A,r,m);C.setCoordsAndTransforms(r);({bandIndexMat3:A}=A.rasterFunction.parameters);
r.setUniformMatrix3fv("u_bandIndexMat3",A)}}})},"esri/views/2d/engine/imagery/processor/remapProcessor":function(){define(["./utils"],function(C){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(A,r){return A.painter.materialManager.getProgram(H,[])},bindTextureAndUniforms:function(A,r,m){C.setSingleImageTextures(A,r,m);C.setCoordsAndTransforms(r);const {noDataRanges:G,rangeMaps:q,allowUnmatched:J,clampRange:B}=
A.rasterFunction.parameters;r.setUniform1fv("u_noDataRanges",G);r.setUniform1fv("u_rangeMaps",q);r.setUniform1f("u_unmatchMask",J?1:0);r.setUniform2fv("u_clampRange",B)}}})},"esri/views/2d/engine/imagery/processor/reprojectProcessor":function(){define(["../../../../../chunks/vec2f64","../../../../webgl/rasterUtils"],function(C,H){const A={vsPath:"raster/common",fsPath:"raster/reproject",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(r,m){const {painter:G}=r,
q=[];r=!r.context.capabilities.textureFloat?.textureFloatLinear;const {interpolation:J,transformGrid:B}=m;"cubic"===J?q.push("bicubic"):"bilinear"===J&&r&&q.push("bilinear");B&&(q.push("applyProjection"),1===B.spacing[0]&&q.push("lookupProjection"));return G.materialManager.getProgram(A,q)},bindTextureAndUniforms:function(r,m,G){const {names:q,textures:J}=G.getTextures({forProcessing:!0});H.setTextures(r.context,m,q,J);m.setUniform1f("u_scale",1);m.setUniform2fv("u_offset",[0,0]);m.setUniform2fv("u_coordScale",
[1,1]);m.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]);m.setUniform1i("u_flipY",0);m.setUniform1f("u_opacity",1);const {width:B,height:E,source:v,transformGrid:x}=G;m.setUniform2fv("u_srcImageSize",[v.width,v.height]);m.setUniform2fv("u_targetImageSize",[B,E]);m.setUniform2fv("u_transformSpacing",x?x.spacing:C.ZEROS);m.setUniform2fv("u_transformGridSize",x?x.size:C.ZEROS)}}})},"esri/views/2d/engine/imagery/processor/slopeProcessor":function(){define(["./utils"],function(C){const H={vsPath:"raster/rfx/vs",
fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(A,r){const {painter:m,rasterFunction:G}=A;({slopeType:A}=G.parameters);return m.materialManager.getProgram(H,"percent-rise"===A?["percentRise"]:[])},bindTextureAndUniforms:function(A,r,m){C.setSingleImageTextures(A,r,m);C.setCoordsAndTransforms(r);const {width:G,height:q,resolution:J}=m,{zFactor:B,slopeType:E,pixelSizePower:v,pixelSizeFactor:x}=A.rasterFunction.parameters;r.setUniform2fv("u_srcImageSize",
[G,q]);r.setUniform2fv("u_cellSize",[J,J]);r.setUniform1f("u_zFactor",B);r.setUniform1f("u_pixelSizePower","adjusted"===E?v:0);r.setUniform1f("u_pixelSizeFactor","adjusted"===E?x:0)}}})},"esri/views/2d/engine/imagery/processor/stretchProcessor":function(){define(["./utils"],function(C){const H={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};return{createProgram:function(A,r){const {useGamma:m,bandCount:G,isOutputRounded:q}=A.rasterFunction.parameters;
r=[];m&&r.push("useGamma");1<G&&r.push("multiBand");q&&r.push("roundOutput");return A.painter.materialManager.getProgram(H,r)},bindTextureAndUniforms:function(A,r,m){C.setSingleImageTextures(A,r,m);C.setCoordsAndTransforms(r);const {width:G,height:q}=m;A=A.rasterFunction.parameters;r.setUniform2fv("u_srcImageSize",[G,q]);r.setUniform1f("u_minOutput",A.outMin);r.setUniform1f("u_maxOutput",A.outMax);r.setUniform1fv("u_factor",A.factor);r.setUniform1fv("u_minCutOff",A.minCutOff);r.setUniform1fv("u_maxCutOff",
A.maxCutOff);r.setUniform1fv("u_gamma",A.gamma);r.setUniform1fv("u_gammaCorrection",A.gammaCorrection)}}})},"esri/views/2d/engine/imagery/RasterTile":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f32","./RasterBitmap","../webgl/TiledDisplayObject"],function(C,H,A,r,m){m=function(G){function q(B,E,v,x,M,D,e=null){var d=G.call(this,B,E,v,x,M,D)||this;d.bitmap=null;d.bitmap=new r.RasterBitmap(e,null,null);d.bitmap.coordScale=[M,D];d.bitmap.once("isReady",
()=>d.ready());return d}H._inheritsLoose(q,G);var J=q.prototype;J.destroy=function(){G.prototype.destroy.call(this);this.bitmap.destroy();this.stage=this.bitmap=null};J.setTransform=function(B){G.prototype.setTransform.call(this,B);this.bitmap.transforms.dvs=this.transforms.dvs};J._createTransforms=function(){return{dvs:A.create(),tileMat3:A.create()}};J.onAttach=function(){this.bitmap.stage=this.stage};J.onDetach=function(){this.bitmap.stage=null};H._createClass(q,[{key:"stencilRef",get:function(){return this.bitmap.stencilRef},
set:function(B){this.bitmap.stencilRef=B}}]);return q}(m.TiledDisplayObject);C.RasterTile=m;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/BaseImageryTileSubView2D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/HandleOwner ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ../../../../layers/support/PixelBlock ../../../../layers/support/TileInfo ../../../../layers/support/rasterDatasets/RawBlockCache ../../../../layers/support/rasterFunctions/pixelUtils ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../tiling/PagedTileQueue ../../tiling/TileInfoView ../../tiling/TileKey ../../tiling/TileQueue ../../tiling/TileStrategy ../../engine/webgl/definitions ../../../webgl/capabilities ../../../../geometry/Extent".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v,x,M,D,e,d,c,g,t,N,a,f,l,p,b,k){const n=[0,0];C.BaseImageryTileSubView2D=function(u){function z(){var w=u.apply(this,arguments)||this;w._emptyTilePixelBlock=null;w._tileStrategy=null;w._tileInfoView=null;w._fetchQueue=null;w._blockCacheRegistryUrl=null;w._blockCacheRegistryId=null;w._srcResolutions=[];w.previousLOD=null;w._needBlockCacheUpdate=!1;w._globalSymbolizerParams=null;w._symbolizerParams=null;w._abortController=null;w._isCustomTilingScheme=!1;w._rasterFunctionState=
"na";w._globalUpdateRequested=!1;w.attached=!1;w.timeExtent=null;w.redrawOrRefetch=J.debounce(H._asyncToGenerator(function*(y={}){if(w.previousLOD&&!w.layerView.suspended){var F=w._rasterFunctionState;y.reprocess&&(yield w.updatingHandles.addPromise(w.layer.updateRasterFunction()),w.updateRasterFunctionParameters());var L=w._rasterFunctionState,{type:O}=H._assertThisInitialized(w);return y.refetch||"raster"!==O&&y.reprocess||"cpu"===L||"cpu"===F?w.updatingHandles.addPromise(w.doRefresh()):w.updatingHandles.addPromise(w._redrawImage(y.signal))}}));
return w}H._inheritsLoose(z,u);var K=z.prototype;K.update=function(w){this._fetchQueue.pause();this._fetchQueue.state=w.state;this._tileStrategy.update(w);this._fetchQueue.resume();const {extent:y,resolution:F,scale:L}=w.state;w=this._tileInfoView.getClosestInfoForScale(L);if(this.layer.raster){if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){const O=this._srcResolutions[w.level],T=y.toJSON?y:k.fromJSON(y);d.update(this._blockCacheRegistryUrl,this._blockCacheRegistryId,T,F,O,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=
!1;this.previousLOD?.level!==w.level&&(this.previousLOD=w,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}};K.moveEnd=function(){if(this.layerView.hasTilingEffects||!this.useProgressiveUpdate)this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then(()=>{this._globalUpdateRequested=!1;this.layerView.requestUpdate()});
const w=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(w);this.layerView.requestUpdate()};K.attach=function(){b.getWebGLCapabilities("2d").supportsTextureFloat||(this.useWebGLForProcessing=!1);this._initializeTileInfo();this._tileInfoView=new N(this.layerView.tileInfo,this.layerView.fullExtent);var w=this._computeFetchConcurrency();this._fetchQueue=new f({tileInfoView:this._tileInfoView,concurrency:w,process:(y,F)=>this._fetchTile1(y,F)});w=this._getCacheSize(this.useProgressiveUpdate);
this._tileStrategy=new l({cachePolicy:"purge",acquireTile:y=>this.acquireTile(y),releaseTile:y=>this.releaseTile(y),cacheSize:w,tileInfoView:this._tileInfoView});this._updateBlockCacheRegistry()};K.detach=function(){this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._fetchQueue=this._tileStrategy=this._tileInfoView=null;d.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);this._blockCacheRegistryUrl=this._blockCacheRegistryId=null};K.acquireTile=
function(w){w=this.container.createTile(w);this._enqueueTileFetch(w);this.layerView.requestUpdate();this._needBlockCacheUpdate=!0;this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate;return w};K.releaseTile=function(w){this._fetchQueue.abort(w.key.id);this.container.removeChild(w);w.once("detach",()=>{w.destroy();this.layerView.requestUpdate()});this.layerView.requestUpdate()};K.createEmptyTilePixelBlock=function(w=null){const y=null==w||w.join(",")===this._tileInfoView.tileInfo.size.join(",");
if(y&&q.isSome(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;w=w||this._tileInfoView.tileInfo.size;const [F,L]=w;w=new D({width:F,height:L,pixels:[new Uint8Array(F*L)],mask:new Uint8Array(F*L),pixelType:"u8"});y&&(this._emptyTilePixelBlock=w);return w};K._getBandIds=function(){if(!("rasterFunctionChain"in this.container&&this.container.rasterFunctionChain))return this.layer.bandIds;const {bandIds:w,raster:y}=this.layer,F="rasterFunction"in y?y.rasterFunction.rawInputBandIds:null;return w?.length&&
F?.length&&1!==y.rasterInfo.bandCount?w.map(L=>F[Math.min(L,F.length-1)]):w||F};K.updateRasterFunctionParameters=function(){};K._fetchTile1=function(w,y){y=q.isSome(y)?y.signal:null;const F=this.canUseWebGLForProcessing(),{layerView:L}=this,{tileInfo:O}=L,T=!O.isWrappable&&q.isSome(g.getWorldWidth(L.view.spatialReference));y={allowPartialFill:!0,datumTransformation:L.datumTransformation,interpolation:F?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:F&&this.layer.raster.hasUniqueSourceStorageInfo,
skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:q.unwrap(y),srcResolution:this._srcResolutions[w.level],timeExtent:L.timeExtent,tileInfo:O,disableWrapAround:T};return this.fetchTile(w,y)};K._getCacheSize=function(w){return w?40:0};K._initializeTileInfo=function(){const {layerView:w}=this;var y=w.view.spatialReference;const F=new M({x:w.fullExtent.xmin,y:w.fullExtent.ymax,spatialReference:y});if(this._canUseLayerLODs()){const {lods:V}=this.layer.tileInfo,aa=
V.map(({scale:Z})=>Z),Y=e.create({spatialReference:y,size:p.TILE_SIZE,scales:aa});this._isCustomTilingScheme=Math.abs(Y.origin.x-F.x)>(y.isGeographic?.01*1E-5:.01);if(0===Y.origin.x||Y.origin.x>F.x)Y.origin=F;if(!this._isCustomTilingScheme){const Z=e.create({spatialReference:y,size:p.TILE_SIZE}).lods.map(({scale:da})=>da);this._isCustomTilingScheme=aa.some(da=>!Z.some(h=>.001>Math.abs(h-da)))}w.set("tileInfo",Y);this._srcResolutions=V.map(({resolution:Z})=>({x:Z,y:Z}))}else{var {scales:L,srcResolutions:O,
isCustomTilingScheme:T}=g.computeProjectedScales(this.layer.rasterInfo,y,p.TILE_SIZE);y=e.create({spatialReference:y,size:p.TILE_SIZE,scales:L});if(0===y.origin.x||y.origin.x>F.x)y.origin=F;this._isCustomTilingScheme=T;w.set("tileInfo",y);this._srcResolutions=O??[]}};K._canUseLayerLODs=function(){const {layer:w,layerView:y}=this;if("Map"!==w.raster.tileType)return!1;const {lods:F}=w.tileInfo;var L=y.view.constraints?.effectiveLODs;if(L?.length!==F.length||!L.every(({scale:O},T)=>.001>Math.abs(O-F[T].scale)))return!1;
L=[];for(let O=0;O<F.length-1;O++)L.push(Math.round(10*F[O].resolution/F[O+1].resolution)/10);return L.some(O=>O!==O[0])};K._computeFetchConcurrency=function(){var {blockBoundary:w}=this.layer.rasterInfo.storageInfo;w=w[w.length-1];return 64<(w.maxCol-w.minCol+1)*(w.maxRow-w.minRow+1)?2:10};K._enqueueTileFetch=function(){var w=H._asyncToGenerator(function*(y,F){this.updatingHandles.addPromise(this._enqueueTileFetch1(y,F))});return function(y,F){return w.apply(this,arguments)}}();K._enqueueTileFetch1=
function(){var w=H._asyncToGenerator(function*(y,F){if(!this._fetchQueue.has(y.key.id)){try{const L=yield this._fetchQueue.push(y.key),O=this._getBandIds();let T=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams;if(this._globalUpdateRequested&&!this.layerView.moving&&0===this._fetchQueue.length){T=!1;try{yield this._redrawImage(this._abortController?.signal)}catch(Y){J.isAbortError(Y)&&G.getLogger(this.declaredClass).error(Y)}this._globalUpdateRequested=!1}!this.canUseWebGLForProcessing()&&
"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams();const V=this._tileInfoView.getTileCoords(n,y.key),aa=this._tileInfoView.getTileResolution(y.key);yield this.updateTileSource(y,{source:L,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:T,bandIds:O,coords:V,resolution:aa});y.once("attach",()=>this.layerView.requestUpdate());this.container.addChild(y)}catch(L){J.isAbortError(L)||
G.getLogger(this.declaredClass).error(L)}this.layerView.requestUpdate()}});return function(y,F){return w.apply(this,arguments)}}();K._redrawImage=function(){var w=H._asyncToGenerator(function*(y){var F=this;0!==this.container.children.length&&(yield this.layer.updateRenderer(),this.layerView.hasTilingEffects?yield this._updateGlobalSymbolizerParams(y):(this._updateSymbolizerParams(),this._globalSymbolizerParams=null),y=this.container.children.map(function(){var L=H._asyncToGenerator(function*(O){return F.updateTileSymbolizerParameters(O,
{local:F._symbolizerParams,global:F._globalSymbolizerParams})});return function(O){return L.apply(this,arguments)}}()),yield J.eachAlways(y),this.container.requestRender())});return function(y){return w.apply(this,arguments)}}();K._updateGlobalSymbolizerParams=function(){var w=H._asyncToGenerator(function*(y){if((y=yield this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,{srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,
signal:y}))&&y.pixelBlock){var {resolution:F}=this.previousLOD,L=this._getBandIds();y=this.layer.symbolizer.generateWebGLParameters({pixelBlock:c.extractBands(y.pixelBlock,L),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:F,y:F},bandIds:L});!this.canUseWebGLForProcessing()&&y&&"stretch"===y.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(y.factor=y.factor.map(O=>255*O),y.outMin=Math.round(255*y.outMin),y.outMax=Math.round(255*y.outMax));this._globalSymbolizerParams=
y}});return function(y){return w.apply(this,arguments)}}();K._updateSymbolizerParams=function(){const {resolution:w}=this.previousLOD,y=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:w,y:w},bandIds:y})};K._updateBlockCacheRegistry=function(w=!1){const {layer:y,layerView:F}=this,{url:L,raster:O}=y;var {multidimensionalDefinition:T}=y.normalizeRasterFetchOptions({multidimensionalDefinition:y.multidimensionalDefinition,
timeExtent:F.timeExtent});T=O.rasterInfo.multidimensionalInfo?O.getSliceIndex(T):null;T=d.getRasterId(L,T);if(T!==this._blockCacheRegistryUrl){null!=this._blockCacheRegistryUrl&&d.unregister(this._blockCacheRegistryUrl,this._blockCacheRegistryId);this._blockCacheRegistryId=d.register(T,O.rasterInfo);if(w){({view:w}=F);const V=this._tileInfoView.getClosestInfoForScale(w.scale);d.update(T,this._blockCacheRegistryId,w.extent,w.resolution,this._srcResolutions[V.level],O.ioConfig.sampling)}this._blockCacheRegistryUrl=
T}};K.doRefresh=function(){var w=H._asyncToGenerator(function*(){if(this.attached){yield this.layer.updateRenderer();this.layerView.hasTilingEffects||this._updateSymbolizerParams();this._updateBlockCacheRegistry(!0);this._fetchQueue.reset();var y=[];this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate;this._tileStrategy.tiles.forEach(F=>y.push(this._enqueueTileFetch(F)));yield J.eachAlways(y)}});return function(){return w.apply(this,arguments)}}();H._createClass(z,
[{key:"useWebGLForProcessing",get:function(){return this._get("useWebGLForProcessing")??!0},set:function(w){this._set("useWebGLForProcessing",w)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")?!0:this._get("useProgressiveUpdate")},set:function(w){if(this._tileStrategy&&this.useProgressiveUpdate!==w){this._tileStrategy.destroy();this.container.removeAllChildren();const y=this._getCacheSize(w);this._tileStrategy=new l({cachePolicy:"purge",acquireTile:F=>this.acquireTile(F),
releaseTile:F=>this.releaseTile(F),cacheSize:y,tileInfoView:this._tileInfoView});this._set("useProgressiveUpdate",w);this.layerView.requestUpdate()}}},{key:"updating",get:function(){return this._fetchQueue?.updating||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}}]);return z}(m.HandleOwner);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"_fetchQueue",void 0);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"_globalUpdateRequested",
void 0);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"attached",void 0);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"container",void 0);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"layer",void 0);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"layerView",void 0);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"type",void 0);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"useWebGLForProcessing",
null);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"useProgressiveUpdate",null);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"timeExtent",void 0);A.__decorate([B.property()],C.BaseImageryTileSubView2D.prototype,"updating",null);C.BaseImageryTileSubView2D=A.__decorate([x.subclass("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],C.BaseImageryTileSubView2D);Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/RawBlockCache":function(){define("exports ../../../geometry ../../../core/maybe ./EphemeralBlockCache ../rasterFunctions/rasterProjectionHelper ../../../geometry/Point".split(" "),
function(C,H,A,r,m,G){function q(E,v){return(E=J.get(E))?E[v]??null:null}const J=new Map,B=new r;C.decreaseRefCount=function(E,v,x){const M=J.get(E);if(!M)return null==v?B.decreaseRefCount(E,x):0;if(null==v||null==M[v])return B.decreaseRefCount(E,x);v=M[v]?.cache;E=v?.get(x);if(v&&E){E.refCount--;if(0===E.refCount){v.delete(x);for(v=0;v<M.length;v++)M[v]?.cache.delete(x);E.controller&&E.controller.abort()}return E.refCount}return 0};C.deleteBlock=function(E,v,x){const M=J.get(E);M?null==v||null==
M[v]?B.deleteBlock(E,x):M[v]?.cache.delete(x):null==v&&B.deleteBlock(E,x)};C.deleteRaster=function(E){J.delete(E)};C.getBlock=function(E,v,x){const M=J.get(E);if(!M)return null==v?B.getBlock(E,x):null;if(null==v||null==M[v]){for(v=0;v<M.length;v++){var D=M[v]?.cache.get(x);if(D)return D.refCount++,D.block}return B.getBlock(E,x)}if(E=M[v]?.cache.get(x))return E.refCount++,E.block;for(E=0;E<M.length;E++){if(E===v||!M[E])continue;D=M[E]?.cache;const e=D?.get(x);if(D&&e)return e.refCount++,D.set(x,e),
e.block}return null};C.getRasterId=function(E,v){return null==v?E:`${E}?sliceId=${v}`};C.putBlock=function(E,v,x,M,D=null){const e=J.get(E);if(e)if(null==v||null==e[v])B.putBlock(E,x,M,D);else{var d={refCount:1,block:M,isResolved:!1,isRejected:!1,controller:D};M.then(()=>d.isResolved=!0).catch(()=>d.isRejected=!0);e[v]?.cache.set(x,d)}else null==v&&B.putBlock(E,x,M,D)};C.register=function(E,v){v={extent:null,rasterInfo:v,cache:new Map};const x=J.get(E);if(x)return x.push(v),x.length-1;J.set(E,[v]);
return 0};C.unregister=function(E,v){const x=J.get(E);x&&(x[v]=null,x.some(M=>null!=M)||J.delete(E))};C.update=function(E,v,x,M,D,e,d=null){if(E=q(E,v)){v=E.extent;var {cache:c,rasterInfo:g}=E;if(!v||v.xmin!==x.xmin||v.xmax!==x.xmax||v.ymin!==x.ymin||v.ymax!==x.ymax){M=M??0;v=x.clone().normalize();var {spatialReference:t,transform:N}=g,a=new Set;for(let n=0;n<v.length;n++){var f=v[n];if(f.xmax-f.xmin<=M||f.ymax-f.ymin<=M)continue;var l=m.projectExtent(f,t,d);A.isSome(N)&&(l=N.inverseTransform(l));
var p=new G({x:M,y:M,spatialReference:f.spatialReference});if(null==D&&(D=m.projectResolution(p,t,f,d),!D))return;const {pyramidLevel:u,pyramidResolution:z,excessiveReading:K}=m.snapPyramid(D,g,e||"closest");if(K)return;({storageInfo:f}=g);var {origin:b}=f;p=Math.max(0,Math.floor((l.xmin-b.x)/z.x));b=Math.max(0,Math.floor((b.y-l.ymax)/z.y));const w=0<u?f.pyramidBlockWidth:f.blockWidth,y=0<u?f.pyramidBlockHeight:f.blockHeight;f=Math.max(0,Math.floor(p/w)-1);var k=Math.max(0,Math.floor(b/y)-1);p=Math.floor((p+
Math.ceil((l.xmax-l.xmin)/z.x-.1)-1)/w)+1;l=Math.floor((b+Math.ceil((l.ymax-l.ymin)/z.y-.1)-1)/y)+1;for(b=k;b<=l;b++)for(k=f;k<=p;k++)a.add(`${u}/${b}/${k}`)}c.forEach((n,u)=>{a.has(u)||(n=c.get(u),(null==n||n.isResolved||n.isRejected)&&c.delete(u))});E.extent={xmin:x.xmin,ymin:x.ymin,xmax:x.xmax,ymax:x.ymax}}}};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterDatasets/EphemeralBlockCache":function(){define(function(){return function(){function C(A=15E3,r=
5E3){this._timer=null;this._cachedBlocks=new Map;this._size=-1;this._duration=A;this._interval=Math.min(A,r)}var H=C.prototype;H.decreaseRefCount=function(A,r){A=A+"/"+r;r=this._cachedBlocks;if(r.has(A)){const m=r.get(A);m.refCount--;0>=m.refCount&&(r.delete(A),m.controller&&m.controller.abort());return m.refCount}return 0};H.getBlock=function(A,r){A=A+"/"+r;r=this._cachedBlocks;if(r.has(A)){const m=r.get(A);m.ts=Date.now();m.refCount++;r.delete(A);r.set(A,m);return m.block}return null};H.putBlock=
function(A,r,m,G){const q=this._cachedBlocks;A=A+"/"+r;q.has(A)?(m=q.get(A),m.ts=Date.now(),m.refCount++):q.set(A,{block:m,ts:Date.now(),refCount:1,controller:G});this._trim();this._updateTimer()};H.deleteBlock=function(A,r){const m=this._cachedBlocks;A=A+"/"+r;m.has(A)&&m.delete(A)};H.updateMaxSize=function(A){this._size=A;this._trim()};H.empty=function(){this._cachedBlocks.clear();this._clearTimer()};H.getCurrentSize=function(){return this._cachedBlocks.size};H._updateTimer=function(){if(null==
this._timer){var A=this._cachedBlocks;this._timer=setInterval(()=>{const r=Array.from(A),m=Date.now();for(let G=0;G<r.length;G++)if(r[G][1].ts<=m-this._duration)A.delete(r[G][0]);else break;0===A.size&&this._clearTimer()},this._interval)}};H._trim=function(){const A=this._cachedBlocks;if(!(-1===this._size||this._size>=A.size)){var r=Array.from(A);for(let m=0;m<r.length-this._size;m++)A.delete(r[m][0])}};H._clearTimer=function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)};return C}()})},
"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),function(C,H,A,r,m,G,q,J,B,E,v,x){function M(h,I,R){return!J.canProjectWithoutEngine(h,I,R)}function D(h,I,R){if((h=M(h,
I,R))&&!J.isLoaded())throw new r("rasterprojectionhelper-project","projection engine is not loaded");return h}function e(){e=H._asyncToGenerator(function*(){J.isLoaded()||(yield J.load())});return e.apply(this,arguments)}function d(h,I,R,P=null){const S=h.spatialReference;if(S.equals(I))return h;D(S,I,P);R=R.center;R=new B({xmin:R.x-h.x/2,xmax:R.x+h.x/2,ymin:R.y-h.y/2,ymax:R.y+h.y/2,spatialReference:S});P=J.project(R,I,P);R=w(I);m.isNone(P)||m.isSome(R)&&P.width>=R?(I=G.getMetersPerUnitForSR(S)/G.getMetersPerUnitForSR(I),
h={x:h.x*I,y:h.y*I}):h={x:P.width,y:P.height};return h}function c(h,I=.01){return G.getMetersPerUnitForSR(h)?I/G.getMetersPerUnitForSR(h):0}function g(h,I,R=null,P=!0){const S=h.spatialReference;if(S.equals(I))return h;D(S,I,R);R=J.project(h,I,R);if(!P||!R)return R;t([h],[R],S,I);return R}function t(h,I,R,P){const S=y(R,!0),Q=y(P,!0);R=c(R,500);P=c(P,500);if(R&&m.isSome(S)&&m.isSome(Q))for(let W=0;W<h.length;W++){const X=I[W];if(!X)continue;const {x:U}=h[W],{x:ca}=X;ca>=Q[1]-P&&Math.abs(U-S[0])<R?
X.x-=Q[1]-Q[0]:ca<=Q[0]+P&&Math.abs(U-S[1])<R&&(X.x+=Q[1]-Q[0])}}function N(h){const {inSR:I,outSR:R,datumTransformation:P,preferPE:S}=h;if(I.equals(R))return{points:h}=b(h,null),h;if(I.isWebMercator&&R.isWGS84||I.isWGS84&&R.isWebMercator){const {cols:ca,rows:ba,xres:ea,yres:ia,usePixelCenter:fa,inSR:ja,outSR:ka}=h;let {xmin:la,ymax:ha}=h;fa&&(la+=ea/2,ha-=ia/2);h=[];var Q=[],W=Math.max(ca,ba);for(var X=0;X<W;X++){var U=J.project(new E({x:la+ea*Math.min(ca,X),y:ha-ia*Math.min(ba,X),spatialReference:ja}),
ka);X<=ca&&h.push(U.x);X<=ba&&Q.push(U.y)}W=[];for(X=0;X<ca;X++)for(U=0;U<ba;U++)W.push([h[X],Q[U]]);return W}if(D(I,R,P)&&S){if(I.isGeographic)return f(h);Q=l(I);if(m.isSome(Q))return f(h)}return a(h)}function a(h){var {points:I}=b(h,null);const {inSR:R,outSR:P,datumTransformation:S}=h;h=I.map(Q=>new E(Q[0],Q[1],R));I=J.project(h,P,S);S&&t(h,I,R,P);return I.map(Q=>Q?[Q.x,Q.y]:[NaN,NaN])}function f(h){const {inSR:I,outSR:R,datumTransformation:P}=h;var S=l(I);const {points:Q,mask:W}=b(h,S);I.isGeographic||
(h=I.wkid?q.PeFactory.coordsys(I.wkid):q.PeFactory.fromString(I.isGeographic?q.PeDefs.PE_TYPE_GEOGCS:q.PeDefs.PE_TYPE_PROJCS,I.wkt),q.PeCSTransformations.projToGeog(h,Q.length,Q));if(m.isSome(P)&&P.steps.length){var X;R.isGeographic&&(X=Q.map(([U])=>179.9955<U?1:-179.9955>U?-1:0));P.steps.forEach(U=>{const ca=U.wkid?q.PeFactory.geogtran(U.wkid):q.PeFactory.fromString(q.PeDefs.PE_TYPE_GEOGTRAN,U.wkt);q.PeGTTransformations.geogToGeog(ca,Q.length,Q,null,U.isInverse?q.PeDefs.PE_TRANSFORM_2_TO_1:q.PeDefs.PE_TRANSFORM_1_TO_2)});
if(X)for(h=0;h<Q.length;h++){S=X[h];const U=Q[h][0],ca=179.9955<U?1:-179.9955>U?-1:0;S&&ca&&S!==ca&&(Q[h][0]=0<S?U+360:U-360)}}R.isGeographic||(X=l(R,!0),X=m.isSome(X)&&X.isEnvelope?[X.bbox[1],X.bbox[3]]:[-90,90],k(Q,X),X=R.wkid?q.PeFactory.coordsys(R.wkid):q.PeFactory.fromString(R.isGeographic?q.PeDefs.PE_TYPE_GEOGCS:q.PeDefs.PE_TYPE_PROJCS,R.wkt),q.PeCSTransformations.geogToProj(X,Q.length,Q));X=Q;if(W&&Q.length!==W.length){X=[];for(let U=0,ca=0;U<W.length;U++)W[U]?X.push(Q[ca++]):X.push([NaN,NaN])}return X}
function l(h,I=!1){var R=h.wkid||h.wkt;if(!R||h.isGeographic)return null;R=String(R);if(Z.has(R))return R=Z.get(R),I?R?.gcs:R?.pcs;var P=h.wkid?q.PeFactory.coordsys(h.wkid):q.PeFactory.fromString(h.isGeographic?q.PeDefs.PE_TYPE_GEOGCS:q.PeDefs.PE_TYPE_PROJCS,h.wkt);h=c(h,1E-4);h=p(P,h);P=p(P,0,!0);Z.set(R,{pcs:h,gcs:P});return I?P:h}function p(h,I=0,R=!1){var P=q.PePCSInfo.generate(h),S=R?h.horizonGcsGenerate():h.horizonPcsGenerate();if(!P||!S?.length)return null;h=!1;var Q=S.find(ba=>1===ba.getInclusive()&&
1===ba.getKind());if(!Q){Q=S.find(ba=>1===ba.getInclusive()&&0===ba.getKind());if(!Q)return null;h=!0}R=R?0:(2===P.getNorthPoleLocation()?1:0)|(2===P.getSouthPoleLocation()?2:0);P=P.isPannableRectangle();Q=Q.getCoord();if(h)return{isEnvelope:h,isPannable:P,vertices:Q,coef:null,bbox:[Q[0][0]-I,Q[0][1]-I,Q[1][0]+I,Q[1][1]+I],poleLocation:R};I=0;h=[];let [W,X]=Q[0],[U,ca]=Q[0];for(let ba=0,ea=Q.length;ba<ea;ba++){I++;I===ea&&(I=0);const [ia,fa]=Q[ba],[ja,ka]=Q[I];if(ka===fa)h.push([ia,ja,fa,ka,2]);else{S=
(ja-ia)/(ka-fa||1E-4);const la=ia-S*fa;fa<ka?h.push([S,la,fa,ka,0]):h.push([S,la,ka,fa,1])}W=W<ia?W:ia;X=X<fa?X:fa;U=U>ia?U:ia;ca=ca>fa?ca:fa}return{isEnvelope:!1,isPannable:P,vertices:Q,coef:h,bbox:[W,X,U,ca],poleLocation:R}}function b(h,I){const R=[],{cols:P,rows:S,xres:Q,yres:W,usePixelCenter:X}=h;let {xmin:U,ymax:ca}=h;X&&(U+=Q/2,ca-=W/2);if(m.isNone(I)){for(h=0;h<P;h++)for(I=0;I<S;I++)R.push([U+Q*h,ca-W*I]);return{points:R}}h=new Uint8Array(P*S);if(I.isEnvelope){const {bbox:[la,ha,na,pa]}=I;
for(let qa=0,ra=0;qa<P;qa++){var ba=U+Q*qa,ea=I.isPannable||ba>=la&&ba<=na;for(var ia=0;ia<S;ia++,ra++){var fa=ca-W*ia;ea&&fa>=ha&&fa<=pa&&(R.push([ba,fa]),h[ra]=1)}}return{points:R,mask:h}}ba=I.coef;I=[];for(ea=0;ea<S;ea++){var ja=ca-W*ea;ia=[];fa=[];for(var ka=0;ka<ba.length;ka++){const [la,ha,na,pa,qa]=ba[ka];ja===na&&na===pa?(ia.push(la),ia.push(ha),fa.push(2),fa.push(2)):ja>=na&&ja<=pa&&(ia.push(la*ja+ha),fa.push(qa))}ja=ia;if(2<ia.length){ka=2===fa[0]?0:fa[0];let la=ia[0];ja=[];for(let ha=1;ha<
fa.length;ha++)if(2!==fa[ha]||ha===fa.length-1)fa[ha]!==ka&&(ja.push(0===ka?Math.min(la,ia[ha-1]):Math.max(la,ia[ha-1])),ka=fa[ha],la=ia[ha]),ha===fa.length-1&&ja.push(0===fa[ha]?Math.min(la,ia[ha]):Math.max(la,ia[ha]));ja.sort((ha,na)=>ha-na)}else ia[0]>ia[1]&&(ja=[ia[1],ia[0]]);I.push(ja)}for(let la=0,ha=0;la<P;la++)for(ba=U+Q*la,ea=0;ea<S;ea++,ha++)if(ia=ca-W*ea,fa=I[ea],2===fa.length)ba>=fa[0]&&ba<=fa[1]&&(R.push([ba,ia]),h[ha]=1);else if(2<fa.length){ja=!1;for(ka=0;ka<fa.length;ka+=2)if(ba>=
fa[ka]&&ba<=fa[ka+1]){ja=!0;break}ja&&(R.push([ba,ia]),h[ha]=1)}return{points:R,mask:h}}function k(h,I){const [R,P]=I;for(I=0;I<h.length;I++){const S=h[I][1];if(S<R||S>P)h[I]=[NaN,NaN]}}function n(h){const I=w(h[0].spatialReference);if(2>h.length||m.isNone(I))return h[0];let {xmin:R,xmax:P,ymin:S,ymax:Q}=h[0];for(let W=1;W<h.length;W++){const X=h[W];P=X.xmax+I*W;S=Math.min(S,X.ymin);Q=Math.max(Q,X.ymax)}return new B({xmin:R,xmax:P,ymin:S,ymax:Q,spatialReference:h[0].spatialReference})}function u(h,
I,R=null,P=!0){var S=h.spatialReference;if(S.equals(I))return h;var Q=L(h);const W=w(S,!0);var X=w(I);if(0===Q||m.isNone(W)||m.isNone(X))return Q=K(h,I,R,P),m.isNone(W)&&m.isSome(X)&&Math.abs(Q.width-X)<c(I)&&J.isLoaded()&&(S=l(S),m.isSome(S)&&S.poleLocation===V.None&&h.width<(S.bbox[2]-S.bbox[0])/2)?z(h,I)||Q:Q;X=h.clone().normalize();if(1===X.length&&h.xmax<W&&h.xmax-W/2>c(S)){const {xmin:U,xmax:ca}=h;for(let ba=0;ba<=Q;ba++)X[ba]=new B({xmin:0===ba?U:-W/2,xmax:ba===Q?ca-W*ba:W/2,ymin:h.ymin,ymax:h.ymax,
spatialReference:S})}h=X.map(U=>K(U,I,R,P));return n(h.filter(m.isSome))}function z(h,I){const R=w(I);if(m.isNone(R))return null;let {xmin:P,ymin:S,xmax:Q,ymax:W}=h;var X=h.spatialReference;h=new v({spatialReference:X,rings:[[[P,S],[Q,S],[Q,W],[P,W],[P,S]]]});h=J.project(h,I);if(2!==h.rings.length||!h.rings[0].length||!h.rings[1].length)return null;({rings:h}=h);X=c(X);I=new B({spatialReference:I});for(let U=0;2>U;U++){P=Q=h[U][0][0];S=W=h[U][0][1];for(let ca=0;ca<h[U].length;ca++)P=P>h[U][ca][0]?
h[U][ca][0]:P,Q=Q<h[U][ca][0]?h[U][ca][0]:Q,S=S>h[U][ca][1]?h[U][ca][1]:S,W=W<h[U][ca][1]?h[U][ca][1]:W;if(0===U)I.ymin=S,I.ymax=W,I.xmin=P,I.xmax=Q;else if(I.ymin=Math.min(I.ymin,S),I.ymax=Math.max(I.ymax,W),Math.abs(Q-R/2)<X)I.xmin=P,I.xmax+=R;else if(Math.abs(P+R/2)<X)I.xmax=Q+R;else return null}return I}function K(h,I,R=null,P=!0,S=!0){const Q=h.spatialReference;if(Q.equals(I)||!I)return h;D(Q,I,R);const W=J.project(h,I,R);if(S&&I.isWebMercator&&W&&(W.ymax=Math.min(2.0037508342787E7,W.ymax),W.ymin=
Math.max(-2.0037508342787E7,W.ymin),W.ymin>=W.ymax))return null;if(!P||!W)return W;var X=y(Q,!0);P=y(I,!0);if(m.isNone(X)||m.isNone(P))return W;S=c(Q,.001);const U=c(Q,500);var ca=c(I,.001);if(Math.abs(W.xmin-P[0])<ca&&Math.abs(W.xmax-P[1])<ca){ca=Math.abs(h.xmin-X[0]);X=Math.abs(X[1]-h.xmax);if(ca<S&&X>U){W.xmin=P[0];var ba=[];ba.push(new E(h.xmax,h.ymin,Q));ba.push(new E(h.xmax,(h.ymin+h.ymax)/2,Q));ba.push(new E(h.xmax,h.ymax,Q));ba=ba.map(ea=>g(ea,I,R)).filter(ea=>!isNaN(ea?.x)).map(ea=>ea.x);
W.xmax=Math.max.apply(null,ba)}X<S&&ca>U&&(W.xmax=P[1],P=[],P.push(new E(h.xmin,h.ymin,Q)),P.push(new E(h.xmin,(h.ymin+h.ymax)/2,Q)),P.push(new E(h.xmin,h.ymax,Q)),h=P.map(ea=>g(ea,I,R)).filter(ea=>!isNaN(ea?.x)).map(ea=>ea.x),W.xmin=Math.min.apply(null,h))}else h=c(I,.001),Math.abs(W.xmin-P[0])<h&&(W.xmin=P[0]),Math.abs(W.xmax-P[1])<h&&(W.xmax=P[1]);return W}function w(h,I=!1){return h?h.isWebMercator?2*(I?2.0037508342787E7:2.0037508342788905E7):h.wkid&&h.isGeographic?360:2*Y[h.wkid]||null:null}
function y(h,I=!1){if(h.isGeographic)return[-180,180];h=w(h,I);return m.isSome(h)?[-h/2,h/2]:null}function F(h,I,R,P){h=(h-I)/R;0!==h-Math.floor(h)?h=Math.floor(h):P&&--h;return h}function L(h,I=!1){var R=w(h.spatialReference);if(m.isNone(R))return 0;const P=I?0:-(R/2),S=c(h.spatialReference),Q=!I&&Math.abs(h.xmin+R/2)<S?-R/2:h.xmin;h=F(!I&&Math.abs(h.xmax-R/2)<S?R/2:h.xmax,P,R,!0);R=F(Q,P,R,!1);return h-R}function O(h){const {projectedExtent:I,srcBufferExtent:R,pixelSize:P,datumTransformation:S,
rasterTransform:Q}=h;var W=I.spatialReference;const X=R.spatialReference;var U=D(W,X);const {xmin:ca,ymin:ba,xmax:ea,ymax:ia}=I,fa=w(X),ja=m.isSome(fa)&&(h.hasWrapAround||"gcs-shift"===Q?.type);h=h.spacing||[32,32];var ka=h[0]*P.x,la=h[1]*P.y;const ha=1===h[0],na=Math.ceil((ea-ca)/ka-.1/h[0])+(ha?0:1),pa=Math.ceil((ia-ba)/la-.1/h[1])+(ha?0:1);ka=N({cols:na,rows:pa,xmin:ca,ymax:ia,xres:ka,yres:la,inSR:W,outSR:X,datumTransformation:S,preferPE:4>=h[0],usePixelCenter:ha});la=[];let qa,ra=0;const ua=ha?
-1:NaN,{xmin:va,xmax:oa,ymax:wa,width:xa,height:ya}=R,za=c(X,500),Aa=m.isSome(fa)&&0<va&&oa>fa/2;var sa=!1;U&&(sa=l(W),sa=m.isSome(sa)&&0<sa.poleLocation);for(W=0;W<na;W++){U=[];for(let ta=0;ta<pa;ta++){var ma=ka[W*pa+ta];ja&&ma[0]>oa&&ma[0]>fa/2-za?ma[0]-=fa:ja&&0===W&&0>ma[0]&&Aa&&!Q&&(ma[0]+=fa);!ma||isNaN(ma[0])||isNaN(ma[1])?(la.push(ua),la.push(ua),U.push(null),ra++):(Q&&(ma=Q.inverseTransform(new E({x:ma[0],y:ma[1],spatialReference:X})),ma=[ma.x,ma.y]),U.push(ma),0<W&&ja&&qa[ta]&&ma[0]<qa[ta][0]&&
(ma[0]+=fa,sa&&ma[0]>oa&&ma[0]>fa&&(ma[0]-=fa)),la.push((ma[0]-va)/xa),la.push((wa-ma[1])/ya))}qa=U}return{offsets:la,error:null,coefficients:null,outofBoundPointCount:ra,spacing:h,size:ha?[na,pa]:[na-1,pa-1]}}function T(h,I,R){const {cols:P,rows:S}=I;I=new Float32Array((P-1)*(S-1)*12);const Q=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),W=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let ia=0;ia<P-1;ia++){for(var X=0;X<S-1;X++){var U=ia*S*2+2*X,ca=h[U];const fa=h[U+1];var ba=h[U+2],ea=h[U+3];U+=2*S;
const ja=h[U],ka=h[U+1],la=h[U+2];U=h[U+3];let ha=0,na=12*(X*(P-1)+ia);for(let pa=0;3>pa;pa++)I[na++]=Q[ha++]*ca+Q[ha++]*ba+Q[ha++]*la;ha=0;for(ba=0;3>ba;ba++)I[na++]=Q[ha++]*fa+Q[ha++]*ea+Q[ha++]*U;ha=0;for(ea=0;3>ea;ea++)I[na++]=W[ha++]*ca+W[ha++]*ja+W[ha++]*la;ha=0;for(ca=0;3>ca;ca++)I[na++]=W[ha++]*fa+W[ha++]*ka+W[ha++]*U}if(R)for(X=0;X<I.length;X++)isNaN(I[X])&&(I[X]=-1)}return I}var V;(function(h){h[h.None=0]="None";h[h.North=1]="North";h[h.South=2]="South";h[h.Both=3]="Both"})(V||(V={}));const aa=
(h,I,R,P=0)=>{if(1===R[0])return[0,0];var S=1,Q=-1,W=1,X=-1;for(var U=0;U<h.length;U+=2)isNaN(h[U])||(S=S>h[U]?h[U]:S,Q=Q>h[U]?Q:h[U],W=W>h[U+1]?h[U+1]:W,X=X>h[U+1]?X:h[U+1]);const {cols:ca,rows:ba}=I;I=(Q-S)/ca/R[0];R=(X-W)/ba/R[1];P*=2;W=0;X=!1;S=[0,0];for(Q=0;Q<ca-3;Q++){for(U=0;U<ba-3;U++){var ea=Q*ba*2+2*U;const ia=Math.abs(((h[ea]+h[ea+4]+h[ea+4*ba]+h[ea+4*ba+4])/4-h[ea+2*ba+2])/I);ea=Math.abs(((h[ea+1]+h[ea+5]+h[ea+4*ba+1]+h[ea+4*ba+5])/4-h[ea+2*ba+3])/R);ia+ea>W&&(W=ia+ea,S=[ia,ea]);if(P&&
W>P){X=!0;break}}if(X)break}return S},Y={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,53080:2.0015114352186374E7,54001:2.0037508342789244E7,
54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},Z=new Map,da=new Map;C.computeProjectedScales=function(h,I,R=512,P=!0){const {extent:S,spatialReference:Q,pixelSize:W}=h,X=d(new E({x:W.x,y:W.y,spatialReference:Q}),I,S);if(null==X)return{projectedPixelSize:null,scales:null,srcResolutions:null,
isCustomTilingScheme:!1};const U=(X.x+X.y)/2,ca=G.getMetersPerUnitForSR(I);var ba=U*ca*96*39.37,ea=I.isGeographic?256/R*2.958287637958547E8:256/R*5.91657527591555E8,ia="vector-magdir"===h.dataType||"vector-uv"===h.dataType,fa=u(S,I),ja=Math.min(Math.ceil(Math.log(Math.min(h.width,h.height)/32)/Math.LN2),Math.ceil(Math.log(ea/2/ba)/Math.LN2));!ia&&P&&(I.isGeographic||I.isWebMercator)&&(ia=0>fa.xmin*fa.xmax,!ia&&3>ja&&(P=w(I),m.isSome(P)&&(ia=2**ja*U*R,R=Math.ceil(P/ia),ia=1===R||2===R&&P/2-fa.xmax<
ia)));P=ba;h=Math.min(2,Math.max(1.414,h.storageInfo?.pyramidScalingFactor||2));if(ia)P=ea,ea=I.isGeographic?1.341104507446289E-6:.29858214164761665,ja=96*ea*ca*39.37,I=d(new E({x:ea,y:ea,spatialReference:{wkid:I.isGeographic?4326:3857}}),Q,fa),I.x*=P/ja,I.y*=P/ja;else{I={x:W.x,y:W.y};for(fa=0;P<.5005*ea&&fa<ja;)fa++,P*=h,I.x*=h,I.y*=h;1.001>=Math.max(P,ea)/Math.min(P,ea)&&(P=ea)}ea=[P];fa=[{x:I.x,y:I.y}];for(ba=Math.min(70.5310735,ba)/1.001;P>=ba;)P/=h,I.x/=h,I.y/=h,ea.push(P),fa.push({x:I.x,y:I.y});
return{projectedPixelSize:X,scales:ea,srcResolutions:fa,isCustomTilingScheme:!ia}};C.defaultGridSpacing=32;C.defaultProjectionToleranceInPixels=4;C.getDefaultDatumTransformationForDataset=function(h,I,R){return D(h.spatialReference,I)?R?J.getTransformation(I,h.spatialReference,h):J.getTransformation(h.spatialReference,I,h):null};C.getProjectedGridPoints=N;C.getProjectionOffsetGrid=function(h){var I=h.isAdaptive&&null==h.spacing;let R=h.spacing||[32,32],P=O(h);var S={cols:P.size[0]+1,rows:P.size[1]+
1};const Q=0<P.outofBoundPointCount&&P.outofBoundPointCount<P.offsets.length/2;let W=P.outofBoundPointCount===P.offsets.length/2||I&&Q?[0,0]:aa(P.offsets,S,R,4);const X=(W[0]+W[1])/2;var U=h.projectedExtent.spatialReference;const ca=h.srcBufferExtent.spatialReference;I&&(Q||4<X)&&(M(U,ca,h.datumTransformation)&&(U.isGeographic||m.isSome(l(U))),R=[4,4],P=O({...h,spacing:R}),S={cols:P.size[0]+1,rows:P.size[1]+1},W=aa(P.offsets,S,R,4));P.error=W;1<R[0]&&(P.coefficients=T(P.offsets,S,Q));!h.includeGCSGrid||
U.isGeographic||U.isWebMercator||(ca.isGeographic?P.gcsGrid={offsets:P.offsets,coefficients:P.coefficients,spacing:R}:(I=l(U),m.isSome(I)&&!I.isEnvelope&&(U&&!U.isGeographic&&(I=String(U.wkid||U.wkt),da.has(I)?U=da.get(I):(U=(U.wkid?q.PeFactory.coordsys(U.wkid):q.PeFactory.fromString(q.PeDefs.PE_TYPE_PROJCS,U.wkt)).getGeogcs().getCode(),da.set(I,U)),U=new x({wkid:U})),U=u(h.projectedExtent,U),{offsets:h}=O({...h,srcBufferExtent:U,spacing:R}),S=T(h,S,Q),P.gcsGrid={offsets:h,coefficients:S,spacing:R})));
return P};C.getRasterDatasetAlignmentInfo=function(h){const I=h.storageInfo.origin.x;var R=w(h.spatialReference,!0);if(m.isNone(R))return{originX:I,halfWorldWidth:null,pyramidsInfo:null};const P=R/2,{nativePixelSize:S,storageInfo:Q,extent:W}=h,{maximumPyramidLevel:X,blockWidth:U,pyramidScalingFactor:ca}=Q;let ba=S.x;const ea=[];h=m.isSome(h.transform)&&"gcs-shift"===h.transform.type;const ia=I+(h?0:P);R=h?R-I:P-I;for(let fa=0;fa<=X;fa++){const ja=(W.xmax-I)/ba/U,ka=R/ba/U;ea.push({resolutionX:ba,
blockWidth:U,datsetColumnCount:0===ja-Math.floor(ja)?ja:Math.ceil(ja),worldColumnCountFromOrigin:0===ka-Math.floor(ka)?ka:Math.ceil(ka),leftMargin:Math.round(ia/ba)%U,rightPadding:(U-Math.round(R/ba)%U)%U,originColumnOffset:Math.floor(ia/ba/U)});ba*=ca}return{originX:I,halfWorldWidth:P,pyramidsInfo:ea,hasGCSSShiftTransform:h}};C.getWorldWidth=w;C.getWorldWrapCount=L;C.load=function(){return e.apply(this,arguments)};C.minimumGridSpacing=4;C.projectExtent=u;C.projectPoint=g;C.projectResolution=d;C.requirePE=
M;C.snapExtent=function(h){h=h.clone().normalize();return 1===h.length?h[0]:n(h)};C.snapPyramid=function(h,I,R){const {storageInfo:P,pixelSize:S}=I;var Q=0;let W=!1;var {pyramidResolutions:X}=P;if(m.isSome(X)&&X.length){h=(h.x+h.y)/2;var U=X[X.length-1];U=(U.x+U.y)/2;var ca=(S.x+S.y)/2;if(h<=ca)Q=0;else if(h>=U)Q=X.length,W=8<h/U;else{U=ca;for(let ba=1;ba<=X.length;ba++){ca=(X[ba-1].x+X[ba-1].y)/2;if(h<=ca){h===ca?Q=ba:"down"===R?(Q=ba-1,W=8<h/U):Q="up"===R?ba:h-U>ca-h||2<h/U?ba:ba-1;break}U=ca}}R=
0===Q?S:X[Q-1];W&&(X=Math.min(R.x,R.y),h=G.getMetersPerUnitForSR(I.spatialReference),19567<X*h&&(W=!1));return{pyramidLevel:Q,pyramidResolution:new E({x:R.x,y:R.y,spatialReference:I.spatialReference}),excessiveReading:W}}Q=Math.log(h.x/S.x)/Math.LN2;h=Math.log(h.y/S.y)/Math.LN2;X=I.storageInfo.maximumPyramidLevel||0;Q="down"===R?Math.floor(Math.min(Q,h)):"up"===R?Math.ceil(Math.max(Q,h)):Math.round((Q+h)/2);0>Q?Q=0:Q>X&&(W=Q>X+3,Q=X);R=2**Q;I=new E({x:R*I.nativePixelSize.x,y:R*I.nativePixelSize.y,
spatialReference:I.spatialReference});return{pyramidLevel:Q,pyramidResolution:I,excessiveReading:W}};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldTileView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFTileContainer ./BaseImageryTileSubView2D".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v){G=function(x){function M(){var e=x.apply(this,arguments)||this;e._handle=null;e.type="rasterVF";return e}C._inheritsLoose(M,x);var D=M.prototype;D.canUseWebGLForProcessing=function(){return!1};D.fetchTile=function(){var e=C._asyncToGenerator(function*(d,c){c={...c,interpolation:"nearest",requestProjectedLocalDirections:!0};d=yield this.layer.fetchTile(d.level,d.row,d.col,c);"vector-magdir"===this.layer.rasterInfo.dataType&&d?.pixelBlock&&(d.pixelBlock=yield this.layer.convertVectorFieldData(d.pixelBlock,
c));return d});return function(d,c){return e.apply(this,arguments)}}();D.updateTileSource=function(e,d){const c=d.symbolizerParams,{tileData:g}=e;g.key=e.key;g.width=this._tileInfoView.tileInfo.size[0];g.height=this._tileInfoView.tileInfo.size[1];({symbolTileSize:e}=c);({source:d}=d);g.offset=this._getTileSymbolOffset(g.key,e);A.isSome(d)&&A.isSome(d.pixelBlock)?(g.rawPixelData={extent:d.extent,pixelBlock:d.pixelBlock},g.symbolizerParameters=c,g.source=this._sampleVectorFieldData(d.pixelBlock,c,g.offset)):
(d=this.createEmptyTilePixelBlock([Math.round((this._tileInfoView.tileInfo[0]-g.offset[0])/e),Math.round((this._tileInfoView.tileInfo[1]-g.offset[1])/e)]),g.source=d,g.symbolizerParameters=c);g.invalidateVAO();return Promise.resolve()};D.updateTileSymbolizerParameters=function(e,d){var c=d.local;({symbolTileSize:d}=c);({tileData:e}=e);e.offset=this._getTileSymbolOffset(e.key,d);const g=e.symbolizerParameters.symbolTileSize;e.symbolizerParameters=c;c=e.rawPixelData?.pixelBlock;A.isSome(c)&&g!==d&&
(e.source=this._sampleVectorFieldData(c,e.symbolizerParameters,e.offset));return Promise.resolve()};D.attach=function(){x.prototype.attach.call(this);this.container=new E.RasterVFTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this._updateSymbolType(this.layer.renderer);this._handle=r.watch(()=>this.layer.renderer,e=>this._updateSymbolType(e))};D.detach=function(){x.prototype.detach.call(this);this.container.removeAllChildren();this._handle?.remove();
this.container=this._handle=null};D._getTileSymbolOffset=function(e,d){const c=e.col*this._tileInfoView.tileInfo.size[0]%d;e=e.row*this._tileInfoView.tileInfo.size[1]%d;return[c>d/2?d-c:-c,e>d/2?d-e:-e]};D._sampleVectorFieldData=function(e,d,c){({symbolTileSize:d}=d);return B.sampleVectorField(e,"vector-uv",d,c)};D._updateSymbolType=function(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])};return M}(v.BaseImageryTileSubView2D);
H.__decorate([m.property()],G.prototype,"container",void 0);H.__decorate([m.property()],G.prototype,"layer",void 0);H.__decorate([m.property()],G.prototype,"type",void 0);return G=H.__decorate([J.subclass("esri.views.2d.layers.imagery.VectorFieldTileView2D")],G)})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../../../core/maybe","../PixelBlock","./pixelUtils"],function(C,H,A,r,m){function G(b,k){return c.get(b)/c.get(k)||1}function q(b,
k="geographic"){const [n,u]=b;b=Math.sqrt(n*n+u*u);let z=Math.atan2(u,n)*g;z=(360+z)%360;"geographic"===k&&(z=(450-z)%360);return[b,z]}function J(b,k="geographic"){let n=b[1];"geographic"===k&&(n=(450-n)%360);n%=360;b=b[0];return[b*Math.cos(n/g),b*Math.sin(n/g)]}function B(b,k,n="geographic",u=1){if(!m.isValidPixelBlock(b))return b;const {pixels:z,width:K,height:w}=b;var y=K*w;const F=z[0],L=z[1],O=b.pixelType.startsWith("f")?b.pixelType:"f32",T=r.createEmptyBand(O,y);y=r.createEmptyBand(O,y);let V=
0;for(let aa=0;aa<w;aa++)for(let Y=0;Y<K;Y++)"vector-uv"===k?([T[V],y[V]]=q([F[V],L[V]],n),T[V]*=u):([T[V],y[V]]=J([F[V],L[V]],n),T[V]*=u,y[V]*=u),V++;b=new r({pixelType:O,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:[T,y]});b.updateStatistics();return b}function E(b=0,k=0,n=Math.PI,u=!0){u&&(n=(2*Math.PI-n)%(2*Math.PI));u=u?-1:1;const z=-7*u,K=-2*u,w=-16*u,[y,F]=x(0,k+13*u,n,21.75),[L,O]=x(b-5.5,k+z,n,21.75),[T,V]=x(b+5.5,k+z,n,21.75),
[aa,Y]=x(b-1.5,k+K,n,21.75),[Z,da]=x(b+1.5,k+K,n,21.75),[h,I]=x(b-1.5,k+w,n,21.75),[R,P]=x(b+1.5,k+w,n,21.75);return[y,F,L,O,aa,Y,Z,da,T,V,h,I,R,P]}function v(b=0,k=Math.PI,n=!0){n&&(k=(2*Math.PI-k)%(2*Math.PI));var u=n?-1:1,z=5*u;const K=20*u,w=25*u;u*=2;const y=n?1:-1;n=5*y;let [F,L]=[0+n,0-K],[O,T]=[F+2*y,L],[V,aa]=[O-0*y,T+u],[Y,Z]=[0-n,0-w],[da,h]=[Y+0*y,Z-u],I=Math.ceil(b/5),R=Math.floor(I/10);I-=8*R;b=[];const P=[];for(let ia=0;ia<I/2;ia++,R--){0>=R&&1===I%2&&ia===(I-1)/2&&(Y=0,da=Y+0*y,Z=
(Z+L)/2,h=Z-u);const [fa,ja]=x(Y,Z,k,45);if(0<R){const [ka,la]=x(O,Z,k,45),[ha,na]=x(F,L,k,45);b.push(ka);b.push(la);b.push(fa);b.push(ja);b.push(ha);b.push(na)}else{const [ka,la]=x(O,T,k,45),[ha,na]=x(V,aa,k,45),[pa,qa]=x(da,h,k,45);P.push(fa);P.push(ja);P.push(pa);P.push(qa);P.push(ha);P.push(na);P.push(ka);P.push(la)}Z+=z;L+=z;T+=z;aa+=z;h+=z}const [S,Q]=x(0+n,0+K,k,45);z=7*y;const [W,X]=x(0+z,0+K,k,45),[U,ca]=x(0+n,0-w,k,45),[ba,ea]=x(0+z,0-w,k,45);return{pennants:b,barbs:P,shaft:[S,Q,W,X,U,ca,
ba,ea]}}function x(b,k,n,u=1){return[Math.sqrt(b*b+k*k)/u,(2*Math.PI+(2*Math.PI+Math.atan2(k,b))%(2*Math.PI)-n)%(2*Math.PI)]}function M(b,k,n,u){n=G(u||"knots",n);for(u=1;u<k.length;u++)if(u===k.length-1){if(b<k[u]*n)break}else if(b<=k[u]*n)break;return Math.min(u-1,k.length-2)}function D(b,k,n,u,z){let K=0;switch(k){case "beaufort_kn":K=M(b,a,"knots",n);break;case "beaufort_km":K=M(b,a,"kilometer-per-hour",n);break;case "beaufort_ft":K=M(b,a,"feet-per-second",n);break;case "beaufort_m":K=M(b,a,"meter-per-second",
n);break;case "classified_arrow":K=M(b,z??[],u,n);break;case "ocean_current_m":K=M(b,f,"meter-per-second",n);break;case "ocean_current_kn":K=M(b,l,"knots",n)}return K}function e(b,k){const {style:n,inputUnit:u,outputUnit:z,breakValues:K}=k,w=t.fromJSON(u),y=t.fromJSON(z);let F=0,L=0;const {width:O,height:T,mask:V}=b,aa=b.pixels[0];b=b.pixels[1];var Y=A.isSome(V)?V.filter(h=>0<h).length:O*T;const Z=new Float32Array(42*Y);Y=new Uint32Array(15*Y);k=k.invertDirection?E(0,0,0,!1):N;for(let h=0;h<T;h++)for(let I=
0;I<O;I++){var da=h*O+I;if(!V||V[h*O+I]){const R=(b[da]+360)%360/180*Math.PI,P=D(aa[da],n,w,y,K);for(let S=0;S<k.length;S+=2)Z[F++]=(I+.5)/O,Z[F++]=(h+.5)/T,Z[F++]=k[S],Z[F++]=k[S+1]+R,Z[F++]=P,Z[F++]=aa[da];da=7*(F/42-1);Y[L++]=da;Y[L++]=da+1;Y[L++]=da+2;Y[L++]=da+0;Y[L++]=da+4;Y[L++]=da+3;Y[L++]=da+0;Y[L++]=da+2;Y[L++]=da+3;Y[L++]=da+2;Y[L++]=da+5;Y[L++]=da+3;Y[L++]=da+5;Y[L++]=da+6;Y[L++]=da+3}}return{vertexData:Z,indexData:Y}}function d(b,k){let n=0,u=0;const {width:z,height:K,mask:w}=b;b=b.pixels[0];
const y=[],F=[];var L=t.fromJSON(k.inputUnit);L=G(L,"knots");k="wind_speed"===k.style?5:Number.MAX_VALUE;for(let T=0;T<K;T++)for(let V=0;V<z;V++){var O=b[T*z+V]*L;if((!w||w[T*z+V])&&O<k){for(let aa=0;4>aa;aa++)y[n++]=(V+.5)/z,y[n++]=(T+.5)/K,y[n++]=2>aa?-.5:.5,y[n++]=0===aa%2?-.5:.5,y[n++]=0,y[n++]=O;O=4*(n/24-1);F[u++]=O;F[u++]=O+1;F[u++]=O+2;F[u++]=O+1;F[u++]=O+2;F[u++]=O+3}}return{vertexData:new Float32Array(y),indexData:new Uint32Array(F)}}const c=new Map;c.set("meter-per-second",1);c.set("kilometer-per-hour",
.277778);c.set("knots",.514444);c.set("feet-per-second",.3048);c.set("mile-per-hour",.44704);const g=180/Math.PI,t=new H.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),N=E(0,0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],f=[0,.5,1,1.5,2],l=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],p=[];C.convertToLocalDirections=function(b,k,n,u="geographic"){if(!m.isValidPixelBlock(b)||A.isNone(n))return b;
b="vector-magdir"===k?b.clone():A.unwrap(B(b,k));const z=b.pixels[1];for(let K=0;K<z.length;K++)z[K]="geographic"===u?(z[K]+n[K]+270)%360:(z[K]+360-n[K])%360;return"vector-magdir"===k?b:B(b,"vector-magdir")};C.convertVectorFieldData=B;C.convertVectorFieldUnit=function(b,k,n=1){if(1===n||!m.isValidPixelBlock(b))return b;b=b.clone();const {pixels:u,width:z,height:K}=b,w=u[0],y=u[1];let F=0;for(let L=0;L<K;L++)for(let O=0;O<z;O++)"vector-uv"===k?(w[F]*=n,y[F]*=n):w[F]*=n,F++;b.updateStatistics();return b};
C.createVFMesh=function(b,k){if("simple_scalar"===k.style)k=d(b,k);else if("wind_speed"===k.style){if(0===p.length)for(var n=0;30>n;n++)p.push(v(5*n,0,!k.invertDirection));k=t.fromJSON(k.inputUnit);k=G(k,"knots");const {width:w,height:y,mask:F}=b;n=b.pixels[0];b=b.pixels[1];const L=[],O=[];let T=0,V=0;for(let aa=0;aa<y;aa++)for(let Y=0;Y<w;Y++){var u=aa*w+Y,z=n[u]*k;if((!F||F[aa*w+Y])&&5<=z){const Z=(b[u]+360)%360/180*Math.PI,{pennants:da,barbs:h,shaft:I}=p[Math.min(Math.floor(z/5),29)];if(0===da.length+
h.length)continue;u=L.length/6;const R=(Y+.5)/w,P=(aa+.5)/y;for(var K=0;K<da.length;K+=2)L[T++]=R,L[T++]=P,L[T++]=da[K],L[T++]=da[K+1]+Z,L[T++]=0,L[T++]=z;for(K=0;K<h.length;K+=2)L[T++]=R,L[T++]=P,L[T++]=h[K],L[T++]=h[K+1]+Z,L[T++]=0,L[T++]=z;for(K=0;K<I.length;K+=2)L[T++]=R,L[T++]=P,L[T++]=I[K],L[T++]=I[K+1]+Z,L[T++]=0,L[T++]=z;for(z=0;z<da.length/6;z++)O[V++]=u,O[V++]=u+1,O[V++]=u+2,u+=3;for(z=0;z<h.length/8;z++)O[V++]=u,O[V++]=u+1,O[V++]=u+2,O[V++]=u+1,O[V++]=u+2,O[V++]=u+3,u+=4;O[V++]=u+0;O[V++]=
u+1;O[V++]=u+2;O[V++]=u+1;O[V++]=u+3;O[V++]=u+2;u+=4}}k={vertexData:new Float32Array(L),indexData:new Uint32Array(O)}}else k=e(b,k);return k};C.createVFMeshScalar=d;C.getUnitConversionFactor=G;C.sampleVectorField=function(b,k,n,u=[0,0],z=.5){const {width:K,height:w,mask:y}=b,[F,L]=b.pixels,[O,T]=u;b=Math.round((K-O)/n);u=Math.round((w-T)/n);var V=b*u;const aa=new Float32Array(V),Y=new Float32Array(V);V=new Uint8Array(V);k="vector-uv"===k;for(let da=0;da<u;da++)for(let h=0;h<b;h++){let I=0;const R=
da*b+h,P=Math.max(0,da*n+T),S=Math.max(0,h*n+O),Q=Math.min(w,P+n),W=Math.min(K,S+n);for(let X=P;X<Q;X++)for(let U=S;U<W;U++){var Z=X*K+U;if(!y||y[Z]){I++;Z=k?[F[Z],L[Z]]:[F[Z],(360+L[Z])%360];const [ca,ba]=k?Z:J(Z);aa[R]+=ca;Y[R]+=ba}}if(I>=(Q-P)*(W-S)*(1-z)){V[R]=1;const [X,U]=q([aa[R]/I,Y[R]/I]);aa[R]=X;Y[R]=U}else V[R]=0,aa[R]=0,Y[R]=0}n=new r({width:b,height:u,pixels:[aa,Y],mask:V});n.updateStatistics();return n};C.snapImageToSymbolTile=function(b,k,n,u,z){if(A.isNone(z)||!z.spatialReference.equals(b.spatialReference))return{extent:b,
width:Math.round(k/u),height:Math.round(n/u),resolution:b.width/k};const K=z.xmin;z=z.ymax;k=(b.xmax-b.xmin)/k*u;n=(b.ymax-b.ymin)/n*u;b.xmin=K+Math.floor((b.xmin-K)/k)*k;b.xmax=K+Math.ceil((b.xmax-K)/k)*k;b.ymin=z+Math.floor((b.ymin-z)/n)*n;b.ymax=z+Math.ceil((b.ymax-z)/n)*n;return{extent:b,width:Math.round(b.width/k),height:Math.round(b.height/n),resolution:(k+n)/2}};C.unitKebabDict=t;C.uvComponentToVector=q;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFTileContainer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry/support/aaBoundingRect ./BrushVectorField ./RasterVFTile ../webgl/enums ../webgl/TileContainer".split(" "),
function(C,H,A,r,m,G,q){q=function(J){function B(){var v=J.apply(this,arguments)||this;v.isCustomTilingScheme=!1;v.symbolTypes=["triangle"];return v}H._inheritsLoose(B,J);var E=B.prototype;E.createTile=function(v){const x=this._tileInfoView.getTileBounds(A.create(),v),[M,D]=this._tileInfoView.tileInfo.size,e=this._tileInfoView.getTileResolution(v.level);return new m.RasterVFTile(v,e,x[0],x[3],M,D)};E.prepareRenderPasses=function(v){const x=v.registerRenderPass({name:"imagery (vf tile)",brushes:[r],
target:()=>this.children.map(M=>M.tileData),drawPhase:G.WGLDrawPhase.MAP});return[...J.prototype.prepareRenderPasses.call(this,v),x]};E.doRender=function(v){this.visible&&v.drawPhase===G.WGLDrawPhase.MAP&&this.symbolTypes.forEach(x=>{v.renderPass=x;J.prototype.doRender.call(this,v)})};return B}(q);C.RasterVFTileContainer=q;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(C,H,A,r){const m=new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,
1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),G={beaufort_ft:m,beaufort_m:m,beaufort_km:m,beaufort_mi:m,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,
.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,
.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,
1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),single_arrow:new Float32Array([0,92/255,230/255,1]),wind_speed:new Float32Array([0,0,0,1])},q=[0,20];return function(J){function B(){var v=J.apply(this,arguments)||this;v._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",
attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}};return v}C._inheritsLoose(B,J);var E=B.prototype;E.dispose=function(){};E.prepareState=function({context:v}){v.setBlendingEnabled(!0);v.setBlendFunctionSeparate(r.BlendFactor.ONE,r.BlendFactor.ONE_MINUS_SRC_ALPHA,r.BlendFactor.ONE,r.BlendFactor.ONE_MINUS_SRC_ALPHA);v.setColorMask(!0,!0,!0,!0);v.setStencilWriteMask(0);v.setStencilTestEnabled(!0);
v.setStencilOp(r.StencilOperation.KEEP,r.StencilOperation.KEEP,r.StencilOperation.REPLACE)};E.draw=function(v,x){if(!H.isNone(x.source)&&0!==x.source.validPixelCount){var {context:M,timeline:D}=v;D.begin(this.name);M.setStencilFunction(r.CompareFunction.EQUAL,x.stencilRef,255);x.updateVectorFieldVAO(v);if("scalar"===v.renderPass){var e=x.vaoData.scalar;e&&this._drawScalars(v,x,e.vao,e.elementCount)}else(e=x.vaoData.magdir)&&this._drawTriangles(v,x,e.vao,e.elementCount);D.end(this.name)}};E._drawTriangles=
function(v,x,M,D){const {context:e,painter:d,requestRender:c,allowDelayedRender:g}=v,{symbolizerParameters:t}=x;var N=t.dataRange?["dataRange"]:[];"geographic"===t.rotationType&&N.push("rotationGeographic");N=d.materialManager.getProgram(this._desc.magdir,N);if(g&&H.isSome(c)&&!N.compiled)c();else{e.useProgram(N);var {coordScale:a,opacity:f,transforms:l}=x;N.setUniform2fv("u_coordScale",a);N.setUniform1f("u_opacity",f);N.setUniformMatrix3fv("u_dvsMat3",l.dvs);var {style:p,dataRange:b,rotation:k,symbolPercentRange:n}=
t;N.setUniform4fv("u_colors",G[p]||G.single_arrow);N.setUniform2fv("u_dataRange",b||q);N.setUniform1f("u_rotation",k);N.setUniform2fv("u_symbolPercentRange",n);v=this._getSymbolSize(v,x);N.setUniform2fv("u_symbolSize",v);e.bindVAO(M);e.drawElements(r.PrimitiveType.TRIANGLES,D,r.DataType.UNSIGNED_INT,0)}};E._drawScalars=function(v,x,M,D){const {context:e,painter:d,requestRender:c,allowDelayedRender:g}=v,{symbolizerParameters:t}=x;var N=[];"wind_speed"===t.style?N.push("innerCircle"):t.dataRange&&N.push("dataRange");
"geographic"===t.rotationType&&N.push("rotationGeographic");N=d.materialManager.getProgram(this._desc.scalar,N);if(g&&H.isSome(c)&&!N.compiled)c();else{e.useProgram(N);var {coordScale:a,opacity:f,transforms:l}=x;N.setUniform2fv("u_coordScale",a);N.setUniform1f("u_opacity",f);N.setUniformMatrix3fv("u_dvsMat3",l.dvs);var {dataRange:p,symbolPercentRange:b}=t;N.setUniform2fv("u_dataRange",p||q);N.setUniform2fv("u_symbolPercentRange",b);v=this._getSymbolSize(v,x);N.setUniform2fv("u_symbolSize",v);e.bindVAO(M);
e.drawElements(r.PrimitiveType.TRIANGLES,D,r.DataType.UNSIGNED_INT,0)}};E._getSymbolSize=function(v,x){v=x.key?2**(v.displayLevel-x.key.level):x.resolution/v.state.resolution;const {symbolTileSize:M}=x.symbolizerParameters;return[M/(Math.round((x.width-x.offset[0])/M)*M)/v,M/(Math.round((x.height-x.offset[1])/M)*M)/v]};return B}(A)})},"esri/views/2d/engine/imagery/RasterVFTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./RasterVFDisplayObject ../webgl/TiledDisplayObject".split(" "),
function(C,H,A,r,m,G){G=function(q){function J(E,v,x,M,D,e,d=null){var c=q.call(this,E,v,x,M,D,e)||this;c.tileData=new m.RasterVFDisplayObject(d);c.tileData.coordScale=[D,e];c.tileData.once("isReady",()=>c.ready());return c}H._inheritsLoose(J,q);var B=J.prototype;B.destroy=function(){q.prototype.destroy.call(this);this.tileData.destroy();this.stage=this.tileData=null};B._createTransforms=function(){return{dvs:r.create(),tileMat3:r.create()}};B.setTransform=function(E){q.prototype.setTransform.call(this,
E);const v=this.resolution/(E.resolution*E.pixelRatio),x=this.transforms.tileMat3,[M,D]=this.tileData.offset,[e,d]=E.toScreenNoRotation([0,0],[this.x+M*this.resolution,this.y-D*this.resolution]),{symbolTileSize:c}=this.tileData.symbolizerParameters;A.set(x,Math.round((this.width-this.tileData.offset[0])/c)*c/this.rangeX*v,0,0,0,Math.round((this.height-this.tileData.offset[1])/c)*c/this.rangeY*v,0,e,d,1);A.multiply(this.transforms.dvs,E.displayViewMat3,x);this.tileData.transforms.dvs=this.transforms.dvs};
B.onAttach=function(){this.tileData.stage=this.stage};B.onDetach=function(){this.tileData.stage=null};H._createClass(J,[{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(E){this.tileData.stencilRef=E}}]);return J}(G.TiledDisplayObject);C.RasterVFTile=G;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v,x,M){A=function(D){function e(c=null){var g=D.call(this)||this;g._source=null;g._symbolizerParameters=null;g._vaoInvalidated=!0;g.coordScale=[1,1];g.height=null;g.key=null;g.offset=null;g.stencilRef=0;g.resolution=null;g.pixelRatio=1;g.x=0;g.y=0;g.rotation=0;g.rawPixelData=null;g.vaoData=null;g.width=null;g.source=c;return g}H._inheritsLoose(e,D);var d=e.prototype;d.destroy=function(){r.isSome(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),
this.vaoData=null)};d.invalidateVAO=function(){!this._vaoInvalidated&&r.isSome(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())};d.updateVectorFieldVAO=function(c){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(r.isSome(this.source)&&r.isNone(this.vaoData)){var {style:g}=this.symbolizerParameters;switch(g){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":g=
J.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(c.context,g)};break;case "simple_scalar":g=J.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(c.context,g)};break;case "wind_speed":g=J.createVFMesh(this.source,this.symbolizerParameters);g=this._createVectorFieldVAO(c.context,g);const t=J.createVFMeshScalar(this.source,this.symbolizerParameters);c=this._createVectorFieldVAO(c.context,t);this.vaoData=
{magdir:g,scalar:c}}}this.ready();this.requestRender()}};d._createTransforms=function(){return{dvs:G.create()}};d.setTransform=function(c){const g=m.identity(this.transforms.dvs),[t,N]=c.toScreenNoRotation([0,0],[this.x,this.y]);var a=this.resolution/this.pixelRatio/c.resolution;const f=a*this.width;a*=this.height;const l=Math.PI*this.rotation/180;m.translate(g,g,q.fromValues(t,N));m.translate(g,g,q.fromValues(f/2,a/2));m.rotate(g,g,-l);m.translate(g,g,q.fromValues(-f/2,-a/2));m.scaleByVec2(g,g,q.fromValues(f,
a));m.multiply(this.transforms.dvs,c.displayViewMat3,g)};d.onAttach=function(){this.invalidateVAO()};d.onDetach=function(){this.invalidateVAO()};d._createVectorFieldVAO=function(c,g){const {vertexData:t,indexData:N}=g;g=v.BufferObject.createVertex(c,x.Usage.STATIC_DRAW,new Float32Array(t));const a=v.BufferObject.createIndex(c,x.Usage.STATIC_DRAW,new Uint32Array(N)),f=E.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:x.DataType.FLOAT,normalized:!1},{location:1,
name:"a_offset",count:2,type:x.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:x.DataType.FLOAT,normalized:!1}]});return{vao:new M.VertexArrayObject(c,f.attributes,f.bufferLayouts,{geometry:g},a),elementCount:N.length}};H._createClass(e,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(c){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(c)&&(this._symbolizerParameters=c,this.invalidateVAO())}},{key:"source",get:function(){return this._source},
set:function(c){this._source=c;this.invalidateVAO()}}]);return e}(B.DisplayObject);C.RasterVFDisplayObject=A;Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/ImageryTileLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../layers/support/commonProperties ../../layers/support/rasterFunctions/rasterProjectionHelper ./support/popupUtils".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v,x){return M=>{M=function(D){function e(){var c=D.apply(this,arguments)||this;c._rasterFieldPrefix="Raster.";c.layer=null;c.view=null;c.tileInfo=null;return c}C._inheritsLoose(e,D);var d=e.prototype;d._getfullExtent=function(){return this.projectFullExtent(this.view.spatialReference)};d.supportsSpatialReference=function(c){return!!this.projectFullExtent(c)};d.projectFullExtent=function(c){const g=m.unwrap(this.layer.fullExtent),t=v.getDefaultDatumTransformationForDataset(g,
c,!1);return v.projectExtent(g,c,t)};d.fetchPopupFeatures=function(){var c=C._asyncToGenerator(function*(g,t){const {layer:N}=this;if(!g)throw new r("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:N});var {popupEnabled:a}=N;t=x.getFetchPopupTemplate(N,t);if(!a||m.isNone(t))throw new r("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:t});a=[];const {value:f,magdirValue:l}=yield N.identify(g,{timeExtent:this.timeExtent});
let p="";if(f&&f.length){p="imagery-tile"===N.type&&N.hasStandardTime()&&null!=f[0]?f.map(k=>N.getStandardTimeValue(k)).join(", "):f.join(", ");g={ObjectId:0};g["Raster.ServicePixelValue"]=p;t=N.rasterInfo.attributeTable;if(m.isSome(t)){const {fields:k,features:n}=t,u=k.find(({name:z})=>"value"===z.toLowerCase());if(t=u?n.find(z=>String(z.attributes[u.name])===p):null)for(var b in t.attributes)t.attributes.hasOwnProperty(b)&&(g[this._rasterFieldPrefix+b]=t.attributes[b])}b=N.rasterInfo.dataType;if("vector-magdir"===
b||"vector-uv"===b)g["Raster.Magnitude"]=l?.[0],g["Raster.Direction"]=l?.[1];b=new A(this.fullExtent.clone(),null,g);b.layer=N;b.sourceLayer=b.layer;a.push(b)}return a});return function(g,t){return c.apply(this,arguments)}}();C._createClass(e,[{key:"fullExtent",get:function(){return this._getfullExtent()}},{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"datumTransformation",get:function(){return v.getDefaultDatumTransformationForDataset(m.unwrap(this.layer.fullExtent),
this.view.spatialReference,!0)}}]);return e}(M);H.__decorate([G.property()],M.prototype,"layer",void 0);H.__decorate([G.property(E.combinedViewLayerTimeExtentProperty)],M.prototype,"timeExtent",void 0);H.__decorate([G.property()],M.prototype,"view",void 0);H.__decorate([G.property()],M.prototype,"fullExtent",null);H.__decorate([G.property()],M.prototype,"tileInfo",void 0);H.__decorate([G.property({readOnly:!0})],M.prototype,"hasTilingEffects",null);H.__decorate([G.property()],M.prototype,"datumTransformation",
null);return M=H.__decorate([B.subclass("esri.views.layers.ImageryTileLayerView")],M)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(C,H,A,r){function m(){m=H._asyncToGenerator(function*(G,q=G.popupTemplate){if(A.isNone(q))return[];const J=yield q.getRequiredFields(G.fieldsIndex);({lastEditInfoEnabled:q}=q);const {objectIdField:B,typeIdField:E,globalIdField:v,relationships:x}=
G;if(J.includes("*"))return["*"];q=q?yield r.getFeatureEditFields(G):[];const M=r.fixFields(G.fieldsIndex,[...J,...q]);E&&M.push(E);M&&B&&G.fieldsIndex?.has(B)&&!M.includes(B)&&M.push(B);M&&v&&G.fieldsIndex?.has(v)&&!M.includes(v)&&M.push(v);x&&x.forEach(D=>{({keyField:D}=D);M&&D&&G.fieldsIndex?.has(D)&&!M.includes(D)&&M.push(D)});return M});return m.apply(this,arguments)}C.getFetchPopupTemplate=function(G,q){return G.popupTemplate?G.popupTemplate:A.isSome(q)&&q.defaultPopupTemplateEnabled&&A.isSome(G.defaultPopupTemplate)?
G.defaultPopupTemplate:null};C.getRequiredFields=function(G){return m.apply(this,arguments)};Object.defineProperty(C,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),
function(C,H,A,r,m,G,q,J,B){return E=>{E=function(v){function x(){return v.apply(this,arguments)||this}C._inheritsLoose(x,v);x.prototype.initialize=function(){this.handles.add(m.on(()=>this.layer,"refresh",M=>{this.doRefresh(M.dataChanged).catch(D=>{r.isAbortError(D)||A.getLogger(this.declaredClass).error(D)})}),"RefreshableLayerView")};return x}(E);H.__decorate([G.property()],E.prototype,"layer",void 0);return E=H.__decorate([B.subclass("esri.layers.mixins.RefreshableLayerView")],E)}})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../layers/support/rasterDatasets/multidimensionalUtils ../engine/flow/FlowView2D ./LayerView2D ./imagery/ImageryTileView2D ./imagery/VectorFieldTileView2D ./support/util ../../layers/ImageryTileLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),
function(C,H,A,r,m,G,q,J,B,E,v,x,M,D,e,d,c,g,t,N){B=function(a){function f(){var p=a.apply(this,arguments)||this;p._useWebGLForProcessing=!0;p._useProgressiveUpdate=!0;p.subview=null;return p}C._inheritsLoose(f,a);var l=f.prototype;l.update=function(p){this.subview?.update(p);this.notifyChange("updating")};l.isUpdating=function(){return!this.subview||this.subview.updating};l.attach=function(){this.layer.increaseRasterJobHandlerUsage();this._updateSubview();this.addAttachHandles([q.watch(()=>{const {layer:p}=
this;return{bandIds:p.bandIds,renderer:p.renderer,interpolation:p.interpolation,multidimensionalDefinition:p.multidimensionalDefinition,rasterFunction:"imagery-tile"===p.type?p.rasterFunction:null}},(p,b)=>{const k=p.interpolation!==b?.interpolation&&("majority"===p.interpolation||"majority"===b?.interpolation)&&c.canUseMajorityInterpolationOnDataSource(this.layer),n=p.renderer!==b?.renderer&&b?.renderer?.type!==p.renderer?.type;n&&this._updateSubview();const u=p.rasterFunction!==b?.rasterFunction,
z=u&&!this._useWebGLForProcessing;this.subview.redrawOrRefetch({refetch:p.multidimensionalDefinition!==b?.multidimensionalDefinition||k||n||z,reprocess:u}).catch(K=>{G.isAbortError(K)||r.getLogger(this.declaredClass).error(K)});this.notifyChange("updating")}),q.watch(()=>this.layer.blendMode??"normal",p=>{this.subview.container.blendMode=p},q.syncAndInitial),q.watch(()=>this.layer.effect??null,p=>{this.subview.container.effect=p},q.syncAndInitial),q.watch(()=>this.layer.multidimensionalSubset??null,
(p,b)=>{const {multidimensionalDefinition:k}=this.layer;m.isSome(k)&&x.hasExcludedVariableOrDimension(k,p)!==x.hasExcludedVariableOrDimension(k,b)&&(this.subview.redrawOrRefetch({refetch:!0}).catch(n=>{G.isAbortError(n)||r.getLogger(this.declaredClass).error(n)}),this.notifyChange("updating"))},q.sync),q.watch(()=>this.timeExtent,()=>{this.subview.timeExtent=this.timeExtent;this.subview.redrawOrRefetch({refetch:!0}).catch(p=>{G.isAbortError(p)||r.getLogger(this.declaredClass).error(p)})},q.initial)])};
l.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null};l.moveStart=function(){this.requestUpdate()};l.viewChange=function(){this.requestUpdate()};l.moveEnd=function(){this.subview.moveEnd()};l.hitTest=function(){var p=C._asyncToGenerator(function*(b,k){return[{type:"graphic",layer:this.layer,mapPoint:b,graphic:new A({attributes:{},geometry:b.clone()})}]});return function(b,k){return p.apply(this,arguments)}}();l.doRefresh=
function(){return this.subview?this.subview.doRefresh():Promise.resolve()};l._updateSubview=function(){var p="vector-field"===this.layer.renderer.type?"rasterVF":"flow"===this.layer.renderer.type?"flow":"raster";if(this.subview){if(this.subview.type===p){this._attachSubview(this.subview);return}this._detachSubview(this.subview);this.subview?.destroy();this.subview=null}var {layer:b}=this;p="rasterVF"===p?new d({layer:b,layerView:this}):"flow"===p?new M({layer:b,layerView:this}):new e({layer:b,layerView:this});
"useWebGLForProcessing"in p&&(p.useWebGLForProcessing=this._useWebGLForProcessing);"useProgressiveUpdate"in p&&(p.useProgressiveUpdate=this._useProgressiveUpdate);"previousLOD"in p&&({subview:b}=this,p.previousLOD=b&&"previousLOD"in b?b.previousLOD:null);this._attachSubview(p);this.subview=p;this.requestUpdate()};l._attachSubview=function(p){p&&!p.attached&&(p.attach(),p.attached=!0,this.container.addChildAt(p.container,0),p.container.blendMode=this.layer.blendMode,p.container.effect=this.layer.effect)};
l._detachSubview=function(p){p?.attached&&(this.container.removeChild(p.container),p.detach(),p.attached=!1)};C._createClass(f,[{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(p){this._useWebGLForProcessing=p;this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=p)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(p){this._useProgressiveUpdate=p;this.subview&&"useProgressiveUpdate"in
this.subview&&(this.subview.useProgressiveUpdate=p)}}]);return f}(g(N(D.LayerView2DMixin(t))));H.__decorate([J.property()],B.prototype,"subview",void 0);H.__decorate([J.property()],B.prototype,"useWebGLForProcessing",null);H.__decorate([J.property()],B.prototype,"useProgressiveUpdate",null);return B=H.__decorate([v.subclass("esri.views.2d.layers.ImageryTileLayerView2D")],B)});