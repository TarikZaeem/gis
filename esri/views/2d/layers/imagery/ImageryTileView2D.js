// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../engine/imagery/RasterTileContainer ./BaseImageryTileSubView2D ../support/util".split(" "),function(v,p,q,w,l,C,y,z,A,B){l=function(r){function x(){var b=r.apply(this,arguments)||this;b.type="raster";return b}v._inheritsLoose(x,
r);var k=x.prototype;k.attach=function(){r.prototype.attach.call(this);this.container=new z.RasterTileContainer(this._tileInfoView);this.container.isCustomTilingScheme=this._isCustomTilingScheme;this.updateRasterFunctionParameters()};k.detach=function(){r.prototype.detach.call(this);this.container.removeAllChildren();this.container=null};k.canUseWebGLForProcessing=function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&B.canUseMajorityInterpolationOnDataSource(this.layer))};
k.fetchTile=function(b,a){return this.layer.fetchTile(b.level,b.row,b.col,a)};k.updateRasterFunctionParameters=function(){const {raster:b,type:a}=this.layer,{container:c}=this;if("Function"!==b.datasetFormat||"wcs"===a)c.rasterFunctionChain=null,c.children.forEach(d=>{({bitmap:d}=d);d&&(d.suspended=!0,d.processed=!1,d.projected&&(d.invalidateTexture(),d.rasterTexture=null))}),this._rasterFunctionState="na";else{var n=this._rasterFunctionState,{rasterFunction:h,primaryRasters:g}=b,e=h.supportsGPU&&
(!g||1>=g.rasters.length),f=e?h.getFlatWebGLFunctionChain():null,{renderer:t}=this.layer;e=!e||!f?.functions.length||"raster-stretch"===t.type&&t.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();c.rasterFunctionChain=e?null:f;var u=null==h?"na":c.rasterFunctionChain?"gpu":"cpu";c.children.forEach(d=>{({bitmap:d}=d);d&&(d.suspended=n!==u,d.processed=!1,d.processedTexture=null)});this._rasterFunctionState=u}};k.updateTileSource=function(){var b=v._asyncToGenerator(function*(a,c){const n=this._getBandIds(),
h=this._getLayerInterpolation(),g=this.canUseWebGLForProcessing(),{source:e,globalSymbolizerParams:f,suspended:t,coords:u,resolution:d}=c;c=this.layerView.hasTilingEffects?f:c.symbolizerParams;({bitmap:a}=a);[a.x,a.y]=u;a.resolution=d;if(e&&q.isSome(e)&&q.isSome(e.pixelBlock)){var m={extent:e.extent,pixelBlock:e.pixelBlock};a.rawPixelData=m;g?(a.source=e.pixelBlock,a.isRendereredSource=!1):(m=yield this.layer.applyRenderer(m,"stretch"===f?.type?f:void 0),a.source=m,a.isRendereredSource=!0);a.symbolizerParameters=
g?c:null;g?a.transformGrid||(a.transformGrid=e.transformGrid):a.transformGrid=null}else m=this.createEmptyTilePixelBlock(),a.source=m,a.symbolizerParameters=g?c:null,a.transformGrid=null;a.bandIds=g?n:null;a.width=this._tileInfoView.tileInfo.size[0];a.height=this._tileInfoView.tileInfo.size[1];a.interpolation=h;a.suspended=t;a.invalidateTexture()});return function(a,c){return b.apply(this,arguments)}}();k.updateTileSymbolizerParameters=function(){var b=v._asyncToGenerator(function*(a,c){const {local:n,
global:h}=c;c=this._getBandIds();const g=this._getLayerInterpolation(),e=this.canUseWebGLForProcessing();({bitmap:a}=a);const {rawPixelData:f}=a;!e&&q.isSome(f)?(a.source=yield this.layer.applyRenderer(f,"stretch"===h?.type?h:void 0),a.isRendereredSource=!0):(a.isRendereredSource&&q.isSome(f)&&(a.source=f.pixelBlock),a.isRendereredSource=!1);a.symbolizerParameters=e?this.layerView.hasTilingEffects?h:n:null;a.bandIds=e?c:null;a.interpolation=g;a.suspended=!1});return function(a,c){return b.apply(this,
arguments)}}();k._getLayerInterpolation=function(){var b=this.layer.renderer.type;if("raster-colormap"===b||"unique-value"===b||"class-breaks"===b)return"nearest";({interpolation:b}=this.layer);const {renderer:a}=this.layer;return"raster-stretch"===a.type&&null!=a.colorRamp?"bilinear"===b||"cubic"===b?"bilinear":"nearest":b};return x}(A.BaseImageryTileSubView2D);p.__decorate([w.property()],l.prototype,"container",void 0);p.__decorate([w.property()],l.prototype,"layer",void 0);p.__decorate([w.property()],
l.prototype,"type",void 0);return l=p.__decorate([y.subclass("esri.views.2d.layers.imagery.ImageryTileView2D")],l)});