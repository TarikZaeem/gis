// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(l,f,t,d,p,u,q,k,B,C,v,w,x,y,z,A){d=function(r){function m(){var a=r.apply(this,arguments)||this;a.attached=!1;a.container=new y.Container;a.updateRequested=!1;a.type="imagery";a._bitmapView=new x.BitmapContainer;return a}l._inheritsLoose(m,r);var g=m.prototype;g.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};g.update=function(a){this.strategy.update(a).catch(b=>{q.isAbortError(b)||p.getLogger(this.declaredClass).error(b)})};g.hitTest=function(a){return new t({attributes:{},
geometry:a.clone(),layer:this.layer})};g.attach=function(){this.container.addChild(this._bitmapView);this.strategy=new A({container:this._bitmapView,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})};g.detach=function(){this.strategy.destroy();this._bitmapView.removeAllChildren();
this.container.removeAllChildren();this.updateRequested=!1};g.redraw=function(){var a=this;this.strategy.updateExports(function(){var b=l._asyncToGenerator(function*(e){const {source:h}=e;if(h&&!(h instanceof ImageBitmap)){var c=yield a.layer.applyRenderer({extent:h.extent,pixelBlock:h.originalPixelBlock??h.pixelBlock});h.filter=n=>a.layer.pixelFilter?a.layer.applyFilter(n):{...c,extent:h.extent}}});return function(e){return b.apply(this,arguments)}}()).catch(b=>{q.isAbortError(b)||p.getLogger(this.declaredClass).error(b)})};
g.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};g.isUpdating=function(){return this.strategy.updating||this.updateRequested};g.getPixelData=function(){if(this.updating)return null;var a=this.strategy.bitmaps;if(1===a.length&&a[0].source)return{extent:a[0].source.extent,pixelBlock:a[0].source.originalPixelBlock};if(1<a.length){const b=this.view.extent;a=a.map(e=>e.source).filter(e=>e.extent&&e.extent.intersects(b)).map(e=>({extent:e.extent,pixelBlock:e.originalPixelBlock}));
a=w.mosaicPixelData(a,b);return u.isSome(a)?{extent:a.extent,pixelBlock:a.pixelBlock}:null}return null};g._fetchImage=function(){var a=l._asyncToGenerator(function*(b,e,h,c){c=c||{};c.timeExtent=this.timeExtent;c.requestAsImageElement=!0;c.returnImageBitmap=!0;b=yield this.layer.fetchImage(b,e,h,c);if(b.imageBitmap)return b.imageBitmap;c=yield this.layer.applyRenderer(b.pixelData,{signal:c.signal});c=new z(c.pixelBlock,c.extent?.clone(),b.pixelData.pixelBlock);c.filter=n=>this.layer.applyFilter(n);
return c});return function(b,e,h,c){return a.apply(this,arguments)}}();l._createClass(m,[{key:"updating",get:function(){return!this.attached||this.isUpdating()}}]);return m}(d);f.__decorate([k.property()],d.prototype,"attached",void 0);f.__decorate([k.property()],d.prototype,"container",void 0);f.__decorate([k.property()],d.prototype,"layer",void 0);f.__decorate([k.property()],d.prototype,"strategy",void 0);f.__decorate([k.property()],d.prototype,"timeExtent",void 0);f.__decorate([k.property()],d.prototype,
"view",void 0);f.__decorate([k.property()],d.prototype,"updateRequested",void 0);f.__decorate([k.property()],d.prototype,"updating",null);f.__decorate([k.property()],d.prototype,"type",void 0);return d=f.__decorate([v.subclass("esri.views.2d.layers.imagery.ImageryView2D")],d)});