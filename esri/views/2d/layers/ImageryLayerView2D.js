// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/flow/FlowView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ./createFlowStyle ./dataUtils ./FlowContainer ./FlowStrategy".split(" "),function(E,G,K,I,w,M,D,L,
F,T,P,J,V){I=function(Y){function W(){var k=Y.apply(this,arguments)||this;k._loadImagery=(n,B,u,a,f)=>P.loadImagery(k.layer,n,B,u,a,f);k._createFlowMesh=(n,B,u,a)=>k.layer.createFlowMesh({meshType:n,flowData:u,simulationSettings:B},{signal:a});k.attached=!1;k.type="flow";k.timeExtent=null;k.redrawOrRefetch=E._asyncToGenerator(function*(){k._updateVisualization()});return k}E._inheritsLoose(W,Y);var U=W.prototype;U.attach=function(){const {layer:k}=this,n=()=>{this._loadImagery=(B,u,a,f,c)=>P.loadImagery(k,
B,u,a,f,c);this._updateVisualization()};"multidimensionalDefinition"in k?this.addHandles(w.watch(()=>k.multidimensionalDefinition,n)):this.addHandles([w.watch(()=>k.mosaicRule,n),w.watch(()=>k.renderingRule,n),w.watch(()=>k.definitionExpression,n)]);this.container=new J;this._strategy=new V({flowContainer:this.container});this._updateVisualization()};U.detach=function(){this._strategy.destroy();this.container?.removeAllChildren();this.container=null;this.removeHandles()};U.update=function(k){k.stationary?
this._strategy.update(k):this.layerView.requestUpdate()};U.hitTest=function(k){return new K({attributes:{},geometry:k.clone(),layer:this.layer})};U.moveEnd=function(){};U.doRefresh=function(){var k=E._asyncToGenerator(function*(){});return function(){return k.apply(this,arguments)}}();U._updateVisualization=function(){var k=this.layer.renderer;null!=k&&"flow"===k.type&&(k=T(k,{loadImagery:this._loadImagery,createFlowMesh:this._createFlowMesh,timeExtent:this.timeExtent}),this.container.flowStyle=k,
this.layerView.requestUpdate())};E._createClass(W,[{key:"updating",get:function(){return!this.attached||this._strategy.updating}}]);return W}(I);G.__decorate([M.property()],I.prototype,"_strategy",void 0);G.__decorate([M.property()],I.prototype,"attached",void 0);G.__decorate([M.property()],I.prototype,"container",void 0);G.__decorate([M.property()],I.prototype,"layer",void 0);G.__decorate([M.property()],I.prototype,"layerView",void 0);G.__decorate([M.property()],I.prototype,"type",void 0);G.__decorate([M.property()],
I.prototype,"updating",null);G.__decorate([M.property()],I.prototype,"timeExtent",void 0);return I=G.__decorate([F.subclass("esri.views.2d.engine.flow.FlowView2D")],I)})},"esri/views/2d/engine/flow/createFlowStyle":function(){define("../../../../core/maybe ./utils ./styles/Imagery ./styles/Particles ./styles/Stack ./styles/Streamlines".split(" "),function(E,G,K,I,w,M){return function(D,L){const {flowSpeed:F,trailLength:T}=D,P=G.getFlowSimulationSettings(D);let J=null;const V={opacity:G.getOpacity(D),
size:G.getSize(D)};let Y=G.getColor(D);"none"===D.background?V.color=Y:("constant"===Y.kind&&(Y={kind:"ramp",stops:[0,1],values:[0,0,0,1,Y.value[0],Y.value[1],Y.value[2],Y.value[3]],count:2}),J=new K.Imagery({loadImagery:L.loadImagery,timeExtent:L.timeExtent,color:Y,opacity:{kind:"constant",value:[1]}}),V.color=G.getForegroundColor());L={loadImagery:L.loadImagery,createFlowMesh:L.createFlowMesh,simulationSettings:P,timeExtent:L.timeExtent,trailLength:T,flowSpeed:F,featheringSize:1,featheringOffset:.5,
introFade:!0,fadeToZero:!0,decayRate:2.3,color:V.color,opacity:V.opacity,size:V.size};D="butt"===D.trailCap||4>=G.getMax(G.getSize(D))?new M(L):new I.Particles(L);return E.isSome(J)?new w.Stack([J,D]):D}})},"esri/views/2d/engine/flow/utils":function(){define(["exports","../../../../core/maybe","../../../../core/screenUtils"],function(E,G,K){function I(F){return"constant"===F.kind?F.value[0]:F.values[F.values.length-1]}function w(F){F=F.toRgba();return[F[0]/255,F[1]/255,F[2]/255,F[3]]}function M(F){if(!F.hasVisualVariables("size"))return{kind:"constant",
value:[K.pt2px(F.trailWidth)]};const T=F.getVisualVariablesForType("size")[0];F=[];const P=[];if(T.stops){for(J of T.stops)F.push(J.value),P.push(K.pt2px(J.size));var J=T.stops.length}else F.push(T.minDataValue,T.maxDataValue),P.push(K.pt2px(T.minSize),K.pt2px(T.maxSize)),J=2;return{kind:"ramp",stops:F,values:P,count:J}}function D(F,T,P,J){switch(T){case "int":F.setUniform1iv(P,J);break;case "float":F.setUniform1fv(P,J);break;case "vec2":F.setUniform2fv(P,J);break;case "vec3":F.setUniform3fv(P,J);
break;case "vec4":F.setUniform4fv(P,J)}}function L(F,T){return F===T?!0:G.isSome(F)&&G.isSome(T)?F.equals(T):!1}E.areStreamlinesCompatible=function(F,T){var P=F.simulationSettings,J=T.simulationSettings;let V;V=(V=(V=(V=(V=(V=(V=(V=(V=(V=(V=P.collisions===J.collisions)&&P.density===J.density)&&P.interpolate===J.interpolate)&&P.lineCollisionWidth===J.lineCollisionWidth)&&P.lineSpacing===J.lineSpacing)&&P.maxTurnAngle===J.maxTurnAngle)&&P.minSpeedThreshold===J.minSpeedThreshold)&&P.segmentLength===
J.segmentLength)&&P.smoothing===J.smoothing)&&P.velocityScale===J.velocityScale)&&P.verticesPerLine===J.verticesPerLine;return V&&L(F.timeExtent,T.timeExtent)?P=(P=(P=(P=(P=F.loadImagery===T.loadImagery)&&F.createFlowMesh===T.createFlowMesh)&&F.color.kind===T.color.kind)&&F.opacity.kind===T.opacity.kind)&&F.size.kind===T.size.kind:!1};E.getColor=function(F){if(!F.hasVisualVariables("color"))return{kind:"constant",value:w(F.color)};F=F.getVisualVariablesForType("color")[0];const T=[],P=[];for(const J of F.stops)T.push(J.value),
Array.prototype.push.apply(P,w(J.color));return{kind:"ramp",stops:T,values:P,count:F.stops.length}};E.getFlowSimulationSettings=function(F){var T=M(F);T=I(T);const P=Math.max(T/2,5),J=Math.round(K.pt2px(F.maxPathLength)/P)+1,{density:V}=F;return{smoothing:K.pt2px(F.smoothing),interpolate:!0,velocityScale:"flow-from"===F.flowRepresentation?1:-1,verticesPerLine:J,minSpeedThreshold:.001,segmentLength:P,maxTurnAngle:1,collisions:!0,lineCollisionWidth:T,lineSpacing:10,density:V}};E.getForegroundColor=
function(F){return{kind:"constant",value:[.1,.1,.1,1]}};E.getMax=I;E.getOpacity=function(F){if(!F.hasVisualVariables("opacity"))return{kind:"constant",value:[1]};F=F.getVisualVariablesForType("opacity")[0];const T=[],P=[];for(const J of F.stops)T.push(J.value),P.push(J.opacity);return{kind:"ramp",stops:T,values:P,count:F.stops.length}};E.getSize=M;E.setUniform=D;E.setUniforms=function(F,T,P,J){"constant"===J.kind?D(F,P,`u_${T}`,J.value):(D(F,"float",`u_${T}_stops`,J.stops),D(F,P,`u_${T}_values`,J.values),
F.setUniform1i(`u_${T}_count`,J.count))};E.timeExtentsEqual=L;E.toRgba=w;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Imagery":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/Texture ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(E,G,K,I,w,M,D,L,F){let T=
function(){function W(k){this._params=k;this.animated=!1}var U=W.prototype;U.isCompatible=function(k){if(!(k instanceof W&&I.timeExtentsEqual(this._params.timeExtent,k._params.timeExtent)))return!1;let n;return n=(n=(n=this._params.loadImagery===k._params.loadImagery)&&this._params.color.kind===k._params.color.kind)&&this._params.opacity.kind===k._params.opacity.kind};U.load=function(){var k=G._asyncToGenerator(function*(n,B){const {extent:u,size:a}=n;K.throwIfAborted(B);n=yield this._params.loadImagery(u,
a[0],a[1],this._params.timeExtent,B);return new Y(n,{color:this._params.color,opacity:this._params.opacity})});return function(n,B){return k.apply(this,arguments)}}();U.render=function(k,n,B){({context:k}=k);const {program:u}=B;k.setFaceCullingEnabled(!1);k.setBlendingEnabled(!0);k.setBlendFunction(M.BlendFactor.ONE,M.BlendFactor.ONE_MINUS_SRC_ALPHA);k.useProgram(u);u.setUniformMatrix3fv("u_dvsMat3",n.dvsMat3);k.bindTexture(B.texture,0);u.setUniform1i("u_texture",0);u.setUniform1f("u_Min",B.min);
u.setUniform1f("u_Max",B.max);I.setUniforms(u,"color","vec4",this._params.color);I.setUniforms(u,"opacity","float",this._params.opacity);k.bindVAO(B.vertexArray);k.drawArrays(M.PrimitiveType.TRIANGLE_STRIP,0,4)};return W}();const P=new Map;P.set("a_position",0);P.set("a_texcoord",1);const J={geometry:[new F.VertexElementDescriptor("a_position",2,M.DataType.UNSIGNED_SHORT,0,8),new F.VertexElementDescriptor("a_texcoord",2,M.DataType.UNSIGNED_SHORT,4,8)]},V={vsPath:"raster/flow/imagery",fsPath:"raster/flow/imagery",
attributes:P};let Y=function(){function W(k,n){this._flowData=k;this._values=n}var U=W.prototype;U.attach=function(k){var {context:n}=k;const {width:B,height:u}=this._flowData;var a={geometry:w.BufferObject.createVertex(n,M.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,B,0,1,1,0,u,0,0,B,u,1,0]))};a=new L.VertexArrayObject(n,P,J,a);var f=[];"ramp"===this._values.color.kind&&f.push("vvColor");"ramp"===this._values.opacity.kind&&f.push("vvOpacity");k=k.painter.materialManager.getProgram(V,f);f=1E6;let c=
-1E6;for(var l=0;l<u;l++)for(var b=0;b<B;b++)if(0!==this._flowData.mask[l*B+b]){var e=this._flowData.data[2*(l*B+b)],g=this._flowData.data[2*(l*B+b)+1];e=Math.sqrt(e*e+g*g);f=Math.min(f,e);c=Math.max(c,e)}l=new Uint8Array(4*B*u);for(b=0;b<u;b++)for(e=0;e<B;e++)if(0!==this._flowData.mask[b*B+e]){g=this._flowData.data[2*(b*B+e)];const h=this._flowData.data[2*(b*B+e)+1];l[4*(b*B+e)]=(Math.sqrt(g*g+h*h)-f)/(c-f)*255;l[4*(b*B+e)+1]=0;l[4*(b*B+e)+2]=0;l[4*(b*B+e)+3]=255}else l[4*(b*B+e)]=0,l[4*(b*B+e)+
1]=0,l[4*(b*B+e)+2]=0,l[4*(b*B+e)+3]=0;n=new D.Texture(n,{pixelFormat:M.PixelFormat.RGBA,internalFormat:M.PixelFormat.RGBA,samplingMode:M.TextureSamplingMode.LINEAR,dataType:M.PixelType.UNSIGNED_BYTE,wrapMode:M.TextureWrapMode.CLAMP_TO_EDGE,flipped:!0,width:B,height:u},l);this.vertexArray=a;this.program=k;this.texture=n;this.min=f;this.max=c;this._flowData=null};U.detach=function(){this.vertexArray.dispose();this.texture.dispose()};G._createClass(W,[{key:"ready",get:function(){return this.program.compiled}}]);
return W}();E.Imagery=T;E.ImageryResources=Y;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Particles":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(E,G,K,I,w,M,D,L){let F=function(){function Y(U){this._params=U}var W=Y.prototype;
W.isCompatible=function(U){return U instanceof Y?I.areStreamlinesCompatible(this._params,U._params):!1};W.load=function(){var U=G._asyncToGenerator(function*(k,n){const {extent:B,size:u}=k;K.throwIfAborted(n);k=yield this._params.loadImagery(B,u[0],u[1],this._params.timeExtent,n);const {vertexData:a,indexData:f}=yield this._params.createFlowMesh("Particles",this._params.simulationSettings,k,n);return new V(a,f,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})});return function(k,
n){return U.apply(this,arguments)}}();W.render=function(U,k,n){({context:U}=U);const {program:B}=n;U.setFaceCullingEnabled(!1);U.setBlendingEnabled(!0);U.setBlendFunction(M.BlendFactor.ONE,M.BlendFactor.ONE_MINUS_SRC_ALPHA);U.useProgram(B);B.setUniform1f("u_time",k.time);B.setUniform1f("u_trailLength",this._params.trailLength);B.setUniform1f("u_flowSpeed",this._params.flowSpeed);B.setUniform1f("u_featheringSize",this._params.featheringSize);B.setUniform1f("u_featheringOffset",this._params.featheringOffset);
B.setUniform1f("u_introFade",this._params.introFade?1:0);B.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);B.setUniform1f("u_decayRate",this._params.decayRate);B.setUniformMatrix3fv("u_dvsMat3",k.dvsMat3);B.setUniformMatrix3fv("u_displayViewMat3",k.displayViewMat3);I.setUniforms(B,"color","vec4",this._params.color);I.setUniforms(B,"opacity","float",this._params.opacity);I.setUniforms(B,"size","float",this._params.size);U.bindVAO(n.vertexArray);U.drawElements(M.PrimitiveType.TRIANGLES,n.indexCount,
M.DataType.UNSIGNED_INT,0)};G._createClass(Y,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return Y}();const T=new Map;T.set("a_xyts0",0);T.set("a_xyts1",1);T.set("a_typeIdDurationSeed",2);T.set("a_extrudeInfo",3);const P={geometry:[new L.VertexElementDescriptor("a_xyts0",4,M.DataType.FLOAT,0,64),new L.VertexElementDescriptor("a_xyts1",4,M.DataType.FLOAT,16,64),new L.VertexElementDescriptor("a_typeIdDurationSeed",4,M.DataType.FLOAT,32,64),new L.VertexElementDescriptor("a_extrudeInfo",
4,M.DataType.FLOAT,48,64)]},J={vsPath:"raster/flow/particles",fsPath:"raster/flow/particles",attributes:T};let V=function(){function Y(U,k,n){this._vertexData=U;this._indexData=k;this._values=n}var W=Y.prototype;W.attach=function(U){var {context:k}=U,n=w.BufferObject.createVertex(k,M.Usage.STATIC_DRAW,this._vertexData);const B=w.BufferObject.createIndex(k,M.Usage.STATIC_DRAW,this._indexData);k=new D.VertexArrayObject(k,T,P,{geometry:n},B);n=[];"ramp"===this._values.color.kind&&n.push("vvColor");"ramp"===
this._values.opacity.kind&&n.push("vvOpacity");"ramp"===this._values.size.kind&&n.push("vvSize");U=U.painter.materialManager.getProgram(J,n);this.vertexArray=k;this.program=U;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};W.detach=function(){this.vertexArray.dispose()};G._createClass(Y,[{key:"ready",get:function(){return this.program.compiled}}]);return Y}();E.Particles=F;E.ParticlesResources=V;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Stack":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(E,G){let K=function(){function w(D){this._styles=D}var M=w.prototype;M.isCompatible=function(D){if(!(D instanceof w)||this._styles.length!==D._styles.length)return!1;const L=this._styles.length;for(let F=0;F<L;F++)if(!this._styles[F].isCompatible(D._styles[F]))return!1;return!0};M.load=function(){var D=G._asyncToGenerator(function*(L,F){const T=yield Promise.all(this._styles.map(P=>P.load(L,F)));return new I(T)});return function(L,F){return D.apply(this,
arguments)}}();M.render=function(D,L,F){for(let T=0;T<this._styles.length;T++)this._styles[T].render(D,L,F.resources[T])};G._createClass(w,[{key:"animated",get:function(){return this._styles.reduce((D,L)=>D||L.animated,!1)}}]);return w}(),I=function(){function w(D){this.resources=D}var M=w.prototype;M.attach=function(D){for(const L of this.resources)L.attach(D)};M.detach=function(){for(const D of this.resources)D.detach()};G._createClass(w,[{key:"ready",get:function(){return this.resources.reduce((D,
L)=>D&&L.ready,!0)}}]);return w}();E.Stack=K;E.StackResources=I;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/styles/Streamlines":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/promiseUtils ../utils ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject ../../../../webgl/VertexElementDescriptor".split(" "),function(E,G,K,I,w,M,D){let L=function(){function V(W){this._params=W}var Y=
V.prototype;Y.isCompatible=function(W){return W instanceof V?K.areStreamlinesCompatible(this._params,W._params):!1};Y.load=function(){var W=E._asyncToGenerator(function*(U,k){const {extent:n,size:B}=U;G.throwIfAborted(k);U=yield this._params.loadImagery(n,B[0],B[1],this._params.timeExtent,k);const {vertexData:u,indexData:a}=yield this._params.createFlowMesh("Streamlines",this._params.simulationSettings,U,k);return new J(u,a,{color:this._params.color,opacity:this._params.opacity,size:this._params.size})});
return function(U,k){return W.apply(this,arguments)}}();Y.render=function(W,U,k){({context:W}=W);const {program:n}=k;W.setFaceCullingEnabled(!1);W.setBlendingEnabled(!0);W.setBlendFunction(w.BlendFactor.ONE,w.BlendFactor.ONE_MINUS_SRC_ALPHA);W.useProgram(n);n.setUniform1f("u_time",U.time);n.setUniform1f("u_trailLength",this._params.trailLength);n.setUniform1f("u_flowSpeed",this._params.flowSpeed);n.setUniform1f("u_featheringSize",this._params.featheringSize);n.setUniform1f("u_featheringOffset",this._params.featheringOffset);
n.setUniform1f("u_introFade",this._params.introFade?1:0);n.setUniform1f("u_fadeToZero",this._params.fadeToZero?1:0);n.setUniform1f("u_decayRate",this._params.decayRate);n.setUniformMatrix3fv("u_dvsMat3",U.dvsMat3);n.setUniformMatrix3fv("u_displayViewMat3",U.displayViewMat3);K.setUniforms(n,"color","vec4",this._params.color);K.setUniforms(n,"opacity","float",this._params.opacity);K.setUniforms(n,"size","float",this._params.size);W.bindVAO(k.vertexArray);W.drawElements(w.PrimitiveType.TRIANGLES,k.indexCount,
w.DataType.UNSIGNED_INT,0)};E._createClass(V,[{key:"animated",get:function(){return 0<this._params.flowSpeed}}]);return V}();const F=new Map;F.set("a_positionAndSide",0);F.set("a_timeInfo",1);F.set("a_extrude",2);F.set("a_speed",3);const T={geometry:[new D.VertexElementDescriptor("a_positionAndSide",3,w.DataType.FLOAT,0,36),new D.VertexElementDescriptor("a_timeInfo",3,w.DataType.FLOAT,12,36),new D.VertexElementDescriptor("a_extrude",2,w.DataType.FLOAT,24,36),new D.VertexElementDescriptor("a_speed",
1,w.DataType.FLOAT,32,36)]},P={vsPath:"raster/flow/streamlines",fsPath:"raster/flow/streamlines",attributes:F};let J=function(){function V(W,U,k){this._vertexData=W;this._indexData=U;this._values=k}var Y=V.prototype;Y.attach=function(W){var {context:U}=W,k=I.BufferObject.createVertex(U,w.Usage.STATIC_DRAW,this._vertexData);const n=I.BufferObject.createIndex(U,w.Usage.STATIC_DRAW,this._indexData);U=new M.VertexArrayObject(U,F,T,{geometry:k},n);k=[];"ramp"===this._values.color.kind&&k.push("vvColor");
"ramp"===this._values.opacity.kind&&k.push("vvOpacity");"ramp"===this._values.size.kind&&k.push("vvSize");W=W.painter.materialManager.getProgram(P,k);this.vertexArray=U;this.program=W;this.indexCount=this._indexData.length;this._indexData=this._vertexData=null};Y.detach=function(){this.vertexArray.dispose()};E._createClass(V,[{key:"ready",get:function(){return this.program.compiled}}]);return V}();return L})},"esri/views/2d/engine/flow/dataUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/has ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/RandomLCG ../../../../geometry/support/spatialReferenceUtils ../../../../geometry/Extent".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P){function J(){J=G._asyncToGenerator(function*(b,e,g,h){const m=performance.now();var q=V(e,g);const y=performance.now();g=W(e,q,g.width,g.height);e=performance.now();q=k(g,!0);g=performance.now();b="Streamlines"===b?n(q,10):B(q);q=performance.now();I("esri-2d-profiler")&&(l.info("I.1","_createFlowFieldFromData (ms)",Math.round(y-m)),l.info("I.2","_getStreamlines (ms)",Math.round(e-y)),l.info("I.3","createAnimatedLinesData (ms)",Math.round(g-e)),l.info("I.4","create{Streamlines|Particles}Mesh (ms)",
Math.round(q-g)),l.info("I.5","createFlowMesh (ms)",Math.round(q-m)),l.info("I.6","Mesh size (bytes)",b.vertexData.buffer.byteLength+b.indexData.buffer.byteLength));yield Promise.resolve();L.throwIfAborted(h);return b});return J.apply(this,arguments)}function V(b,e){const g=U(e.data,e.width,e.height,b.smoothing);return b.interpolate?(h,m)=>{const q=Math.floor(h),y=Math.floor(m);if(0>q||q>=e.width||0>y||y>=e.height)return[0,0];h-=q;m-=y;const t=q<e.width-1?q+1:q,r=y<e.height-1?y+1:y;return[(g[2*(y*
e.width+q)]*(1-m)+g[2*(r*e.width+q)]*m)*(1-h)+(g[2*(y*e.width+t)]*(1-m)+g[2*(r*e.width+t)]*m)*h,(g[2*(y*e.width+q)+1]*(1-m)+g[2*(r*e.width+q)+1]*m)*(1-h)+(g[2*(y*e.width+t)+1]*(1-m)+g[2*(r*e.width+t)+1]*m)*h]}:(h,m)=>{h=Math.round(h);m=Math.round(m);return 0>h||h>=e.width||0>m||m>=e.height?[0,0]:[g[2*(m*e.width+h)],g[2*(m*e.width+h)+1]]}}function Y(b,e,g,h,m,q,y,t,r){const x=[];let C=0,[O,Q]=e(g,h);O*=b.velocityScale;Q*=b.velocityScale;x.push({x:g,y:h,t:C,speed:Math.sqrt(O*O+Q*Q)});for(let Z=0;Z<
b.verticesPerLine;Z++){let [da,d]=e(g,h);da*=b.velocityScale;d*=b.velocityScale;const p=Math.sqrt(da*da+d*d);if(p<b.minSpeedThreshold)break;const A=da/p,v=d/p;g+=A*b.segmentLength;h+=v*b.segmentLength;C+=b.segmentLength/p;if(Math.acos(A*aa+v*X)>b.maxTurnAngle)break;if(b.collisions){var aa=Math.round(g*r);var X=Math.round(h*r);if(0>aa||aa>y-1||0>X||X>t-1)break;const H=q[X*y+aa];if(-1!==H&&H!==m)break;q[X*y+aa]=m}x.push({x:g,y:h,t:C,speed:p});aa=A;X=v}return x}function W(b,e,g,h){const m=[],q=new F,
y=1/Math.max(b.lineCollisionWidth,1),t=Math.round(g*y),r=Math.round(h*y),x=new Int32Array(t*r);for(var C=0;C<x.length;C++)x[C]=-1;C=[];for(let O=0;O<h;O+=b.lineSpacing)for(let Q=0;Q<g;Q+=b.lineSpacing)C.push({x:Q,y:O,sort:q.getFloat()});C.sort((O,Q)=>O.sort-Q.sort);for(const {x:O,y:Q}of C)q.getFloat()<b.density&&(g=Y(b,e,O,Q,m.length,x,t,r,y),2>g.length||m.push(g));return m}function U(b,e,g,h){if(0===h)return b;const m=Math.round(3*h),q=Array(2*m+1);var y=0;for(var t=-m;t<=m;t++){var r=Math.exp(-t*
t/(h*h));q[t+m]=r;y+=r}for(h=-m;h<=m;h++)q[h+m]/=y;y=new Float32Array(b.length);for(h=0;h<g;h++)for(t=0;t<e;t++){var x=r=0;for(var C=-m;C<=m;C++)if(!(0>t+C||t+C>=e)){var O=q[C+m];r+=O*b[2*(h*e+(t+C))];x+=O*b[2*(h*e+(t+C))+1]}y[2*(h*e+t)]=r;y[2*(h*e+t)+1]=x}b=new Float32Array(b.length);for(h=0;h<e;h++)for(t=0;t<g;t++){x=r=0;for(C=-m;C<=m;C++)0>t+C||t+C>=g||(O=q[C+m],r+=O*y[2*((t+C)*e+h)],x+=O*y[2*((t+C)*e+h)+1]);b[2*(t*e+h)]=r;b[2*(t*e+h)+1]=x}return b}function k(b,e){const g=new F;var h=b.reduce((t,
r)=>t+r.length,0);h=new Float32Array(4*h);const m=Array(b.length);let q=0,y=0;for(const t of b){b=q;for(const r of t)h[4*q]=r.x,h[4*q+1]=r.y,h[4*q+2]=r.t,h[4*q+3]=r.speed,q++;m[y++]={startVertex:b,numberOfVertices:t.length,totalTime:t[t.length-1].t,timeSeed:e?g.getFloat():0}}return{lineVertices:h,lineDescriptors:m}}function n(b,e){function g(aa,X,Z,da,d,p,A,v){const H=9*r;let z=0;t[H+z++]=aa;t[H+z++]=X;t[H+z++]=1;t[H+z++]=Z;t[H+z++]=p;t[H+z++]=A;t[H+z++]=da/2;t[H+z++]=d/2;t[H+z++]=v;r++;t[H+z++]=
aa;t[H+z++]=X;t[H+z++]=-1;t[H+z++]=Z;t[H+z++]=p;t[H+z++]=A;t[H+z++]=-da/2;t[H+z++]=-d/2;t[H+z++]=v;r++}const {lineVertices:h,lineDescriptors:m}=b;var q=b=0;for(var y of m)b+=2*y.numberOfVertices,q+=6*(y.numberOfVertices-1);const t=new Float32Array(9*b);y=new Uint32Array(q);let r=0;b=0;for(const aa of m){const {totalTime:X,timeSeed:Z}=aa;let da=q=null,d=null;var x=null,C=null,O=null;for(let p=0;p<aa.numberOfVertices;p++){x=h[4*(aa.startVertex+p)];const A=h[4*(aa.startVertex+p)+1],v=h[4*(aa.startVertex+
p)+2],H=h[4*(aa.startVertex+p)+3];let z=null,R=null;var Q=null;let S=null;0<p&&(z=x-q,R=A-da,Q=Math.sqrt(z*z+R*R),z/=Q,R/=Q,1<p?(C=z+C,O=R+O,Q=Math.sqrt(C*C+O*O),C/=Q,O/=Q,Q=Math.min(1/(C*z+O*R),e),C*=Q,O*=Q,Q=-O,S=C):(Q=-R,S=z),null!==Q&&null!==S&&(g(q,da,d,Q,S,X,Z,H),y[b++]=r-2,y[b++]=r,y[b++]=r-1,y[b++]=r,y[b++]=r+1,y[b++]=r-1));q=x;da=A;d=v;C=z;O=R;x=H}g(q,da,d,-O,C,X,Z,x)}return{vertexData:t,indexData:y}}function B(b){function e(ca,ba){var ea=v+z,ia=H+R,fa=Math.sqrt(ea*ea+ia*ia);ea/=fa;ia/=fa;
var ja=v*ea+H*ia,ka=z+S,la=R+N;fa=Math.sqrt(ka*ka+la*la);ka/=fa;la/=fa;var ha=z*ka+R*la;fa=Q;var na=aa,pa=X,qa=Z;ia=-(ia/ja);ea/=ja;ja=da;var ra=d,ua=p,va=A;la=-(la/ha);ka/=ha;ha=16*C;let oa=0;for(const wa of[1,2])for(const xa of[1,2,3,4])r[ha+oa++]=fa,r[ha+oa++]=na,r[ha+oa++]=pa,r[ha+oa++]=qa,r[ha+oa++]=ja,r[ha+oa++]=ra,r[ha+oa++]=ua,r[ha+oa++]=va,r[ha+oa++]=wa,r[ha+oa++]=xa,r[ha+oa++]=ca,r[ha+oa++]=ba,r[ha+oa++]=ia/2,r[ha+oa++]=ea/2,r[ha+oa++]=la/2,r[ha+oa++]=ka/2,C++;x[O++]=C-8;x[O++]=C-7;x[O++]=
C-6;x[O++]=C-7;x[O++]=C-5;x[O++]=C-6;x[O++]=C-4;x[O++]=C-3;x[O++]=C-2;x[O++]=C-3;x[O++]=C-1;x[O++]=C-2}function g(ca,ba,ea,ia,fa,ja){v=z;H=R;z=S;R=N;null==v&&null==H&&(v=z,H=R);if(null!=da&&null!=d){S=ca-da;N=ba-d;const ka=Math.sqrt(S*S+N*N);S/=ka;N/=ka}null!=v&&null!=H&&e(fa,ja);Q=da;aa=d;X=p;Z=A;da=ca;d=ba;p=ea;A=ia}function h(ca,ba){v=z;H=R;z=S;R=N;null==v&&null==H&&(v=z,H=R);null!=v&&null!=H&&e(ca,ba)}const {lineVertices:m,lineDescriptors:q}=b;let y=b=0;for(var t of q){const ca=t.numberOfVertices-
1;b+=8*ca;y+=12*ca}const r=new Float32Array(16*b),x=new Uint32Array(y);let C=0,O=0,Q,aa,X,Z,da,d,p,A,v,H,z,R,S,N;for(const ca of q){N=S=R=z=H=v=A=p=d=da=Z=X=aa=Q=null;const {totalTime:ba,timeSeed:ea}=ca;for(t=0;t<ca.numberOfVertices;t++)g(m[4*(ca.startVertex+t)],m[4*(ca.startVertex+t)+1],m[4*(ca.startVertex+t)+2],m[4*(ca.startVertex+t)+3],ba,ea);h(ba,ea)}return{vertexData:r,indexData:x}}function u(b,e){const g=e.pixels,{width:h,height:m}=e,q=new Float32Array(h*m*2),y=e.mask||new Uint8Array(h*m*2);
e.mask||y.fill(255);if("vector-uv"===b)for(b=0;b<h*m;b++)q[2*b]=g[0][b],q[2*b+1]=-g[1][b];else if("vector-magdir"===b)for(b=0;b<h*m;b++){e=g[0][b];const t=M.deg2rad(g[1][b]),r=Math.sin(t-Math.PI/2);q[2*b]=Math.cos(t-Math.PI/2)*e;q[2*b+1]=r*e}return{data:q,mask:y,width:h,height:m}}function a(){a=G._asyncToGenerator(function*(b,e,g,h,m,q){const y=performance.now();var t=T.getInfo(e.spatialReference);if(!t)return g=yield f(b,e,g,h,m,q),I("esri-2d-profiler")&&l.info("I.7","loadImagery, early exit (ms)",
Math.round(performance.now()-y)),I("esri-2d-profiler")&&l.info("I.9","Number of parts",1),g;const [r,x]=t.valid,C=Math.ceil(e.width/(x-r)),O=e.width/C,Q=Math.round(g/C);let aa=e.xmin;const X=[];t=performance.now();for(let Z=0;Z<C;Z++){const da=new P({xmin:aa,xmax:aa+O,ymin:e.ymin,ymax:e.ymax,spatialReference:e.spatialReference});X.push(f(b,da,Q,h,m,q));aa+=O}b=yield Promise.all(X);I("esri-2d-profiler")&&l.info("I.8","All calls to _fetchPart (ms)",Math.round(performance.now()-t));I("esri-2d-profiler")&&
l.info("I.9","Number of parts",b.length);h={data:new Float32Array(g*h*2),mask:new Uint8Array(g*h),width:g,height:h};e=0;for(const Z of b){for(b=0;b<Z.height;b++)for(m=0;m<Z.width;m++)e+m>=g||(h.data[2*(b*g+e+m)]=Z.data[2*(b*Z.width+m)],h.data[2*(b*g+e+m)+1]=Z.data[2*(b*Z.width+m)+1],h.mask[b*g+e+m]=Z.mask[b*Z.width+m]);e+=Z.width}I("esri-2d-profiler")&&l.info("I.10","loadImagery, general exit (ms)",Math.round(performance.now()-y));return h});return a.apply(this,arguments)}function f(b,e,g,h,m,q){return c.apply(this,
arguments)}function c(){c=G._asyncToGenerator(function*(b,e,g,h,m,q){const y={requestProjectedLocalDirections:!0,signal:q};D.isSome(m)&&(y.timeExtent=m);if("imagery"===b.type)return yield b.load({signal:q}),m=b.rasterInfo.dataType,b=yield b.fetchImage(e,g,h,y),!b||D.isNone(b.pixelData)||D.isNone(b.pixelData.pixelBlock)?{data:new Float32Array(g*h*2),mask:new Uint8Array(g*h),width:g,height:h}:u(m,b.pixelData.pixelBlock);yield b.load({signal:q});m=b.rasterInfo.dataType;b=yield b.fetchPixels(e,g,h,y);
return!b||D.isNone(b.pixelBlock)?{data:new Float32Array(g*h*2),mask:new Uint8Array(g*h),width:g,height:h}:u(m,b.pixelBlock)});return c.apply(this,arguments)}const l=w.getLogger("esri.views.2d.engine.flow.dataUtils");E.createAnimatedLinesData=k;E.createFlowMesh=function(b,e,g,h){return J.apply(this,arguments)};E.createParticlesMesh=B;E.createStreamlinesMesh=n;E.loadImagery=function(b,e,g,h,m,q){return a.apply(this,arguments)};Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/flow/FlowContainer":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./BrushFlow","../webgl/enums","../webgl/WGLContainer"],function(E,G,K,I){return function(w){function M(){var L=w.apply(this,arguments)||this;L.flowStyle=null;return L}E._inheritsLoose(M,w);var D=M.prototype;D.doRender=function(L){w.prototype.doRender.call(this,L)};D.prepareRenderPasses=function(L){const F=L.registerRenderPass({name:"flow",brushes:[G],target:()=>this.children,drawPhase:K.WGLDrawPhase.MAP});return[...w.prototype.prepareRenderPasses.call(this,L),F]};E._createClass(M,[{key:"requiresDedicatedFBO",
get:function(){return!1}}]);return M}(I)})},"esri/views/2d/engine/flow/BrushFlow":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../chunks/mat3f32","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(E,G,K,I,w){return function(M){function D(){var F=M.apply(this,arguments)||this;F._visualState={time:0,dvsMat3:K.create(),displayViewMat3:K.create()};return F}E._inheritsLoose(D,M);var L=D.prototype;L.dispose=function(){};L.prepareState=function(F){({context:F}=
F);F.setColorMask(!0,!0,!0,!0);F.setStencilFunction(w.CompareFunction.EQUAL,0,255)};L.draw=function(F,T){const {requestRender:P,allowDelayedRender:J}=F,{displayData:V}=T;if(!G.isNone(V)&&("loaded"===V.state.name&&V.attach(F),"attached"===V.state.name)){var Y=V.state.resources;J&&!Y.ready&&G.isSome(P)?P():(this._visualState.time=F.time/1E3,this._visualState.dvsMat3=T.transforms.dvs,this._visualState.displayViewMat3=F.state.displayViewMat3,V.flowStyle.render(F,this._visualState,Y),V.flowStyle.animated&&
G.isSome(P)&&P())}};return D}(I)})},"esri/views/2d/engine/flow/FlowStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../geometry ../../../../core/Accessor ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Point ./FlowDisplayData ./FlowDisplayObject ../../../../geometry/Extent".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P,J,V,Y,W,U){function k(n,B){const u=new V({x:(n.xmax+n.xmin)/2,y:(n.ymax+n.ymin)/2,spatialReference:n.spatialReference});var a=n.xmax-n.xmin;const f=n.ymax-n.ymin,c=Math.abs(Math.cos(M.deg2rad(B))),l=Math.abs(Math.sin(M.deg2rad(B)));B=c*a+l*f;a=l*a+c*f;n=new U({xmin:u.x-B/2,ymin:u.y-a/2,xmax:u.x+B/2,ymax:u.y+a/2,spatialReference:n.spatialReference});n.centerAt(u);return n}K=function(n){function B(a){a=n.call(this,a)||this;a._flowDisplayObject=new W.FlowDisplayObject;
a._loading=null;return a}E._inheritsLoose(B,n);var u=B.prototype;u.initialize=function(){this.flowContainer.addChild(this._flowDisplayObject)};u.destroy=function(){this._clear();this.flowContainer.removeAllChildren()};u.update=function(a){var {flowStyle:f}=this.flowContainer;if(D.isNone(f))this._clear();else{var {extent:c,rotation:l,resolution:b,pixelRatio:e}=a.state;a=k(c,l);a.expand(1.15);f=new Y(f,a,[Math.round((a.xmax-a.xmin)/b),Math.round((a.ymax-a.ymin)/b)],e);if(D.isSome(this._loading)){if(this._loading.update(f))return;
this._loading.detach();this._loading=null}if(D.isNone(this._flowDisplayObject.displayData)||!this._flowDisplayObject.displayData.update(f))f.load().then(()=>{this._flowDisplayObject.clear();this._flowDisplayObject.displayData=this._loading;this._loading=null},g=>{L.isAbortError(g)||(w.getLogger(this.declaredClass).error("A resource failed to load.",g),this._loading=null)}),this._loading=f}};u._clear=function(){this._flowDisplayObject.clear();D.isSome(this._loading)&&(this._loading.detach(),this._loading=
null)};E._createClass(B,[{key:"updating",get:function(){return null!=this._loading}}]);return B}(I);G.__decorate([F.property()],K.prototype,"_loading",void 0);G.__decorate([F.property()],K.prototype,"flowContainer",void 0);G.__decorate([F.property()],K.prototype,"updating",null);return K=G.__decorate([J.subclass("esri.views.2d.engine.flow.FlowStrategy")],K)})},"esri/views/2d/engine/flow/FlowDisplayData":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger"],function(E,
G){return function(){function K(w,M,D,L){this.state={name:"created"};this.flowStyle=w;this.extent=M;this.size=D;this.pixelRatio=L}var I=K.prototype;I.load=function(){var w=E._asyncToGenerator(function*(){const M=new AbortController;this.state={name:"loading",abortController:M};this.state={name:"loaded",resources:yield this.flowStyle.load({extent:this.extent,size:this.size,pixelRatio:this.pixelRatio},M.signal)}});return function(){return w.apply(this,arguments)}}();I.attach=function(w){if("loaded"!==
this.state.name)G.getLogger("esri.views.2d.engine.flow.FlowDisplayData").error("Only loaded resources can be attached.");else{var M=this.state.resources;M.attach(w);this.state={name:"attached",resources:M}}};I.detach=function(){"loading"===this.state.name?(this.state.abortController.abort(),this.state={name:"detached"}):"attached"===this.state.name&&(this.state.resources.detach(),this.state={name:"detached"})};I.update=function(w){if(!this.flowStyle.isCompatible(w.flowStyle)||!this.extent.equals(w.extent)||
this.size[0]!==w.size[0]||this.size[1]!==w.size[1]||this.pixelRatio!==w.pixelRatio)return!1;this.flowStyle=w.flowStyle;return!0};return K}()})},"esri/views/2d/engine/flow/FlowDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../DisplayObject".split(" "),function(E,G,K,I,w,M,D){D=function(L){function F(){var P=L.apply(this,arguments)||this;P._displayData=null;return P}
G._inheritsLoose(F,L);var T=F.prototype;T.clear=function(){I.isSome(this._displayData)&&(this._displayData.detach(),this._displayData=null,this.requestRender())};T.setTransform=function(P){var {displayData:J}=this;if(!I.isNone(J)){var V=[0,0];P.toScreen(V,[J.extent.xmin,J.extent.ymax]);J=(J.extent.xmax-J.extent.xmin)/J.size[0]/P.resolution;var Y=K.deg2rad(P.rotation),{dvs:W}=this.transforms;w.fromTranslation(W,[-1,1,0]);w.scale(W,W,[2/(P.size[0]*P.pixelRatio),-2/(P.size[1]*P.pixelRatio),1]);w.translate(W,
W,[V[0],V[1],0]);w.rotate(W,W,Y);w.scale(W,W,[J*P.pixelRatio,J*P.pixelRatio,1])}};T._createTransforms=function(){return{dvs:M.create()}};G._createClass(F,[{key:"displayData",get:function(){return this._displayData},set:function(P){this._displayData=P;this.requestRender()}}]);return F}(D.DisplayObject);E.FlowDisplayObject=D;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P,J,V,Y,W,U){const k=I.ofType({key:"type",base:null,typeMap:{rect:Y,path:U,geometry:W}});E.LayerView2DMixin=n=>{n=function(B){function u(){var f=B.apply(this,arguments)||this;f.attached=!1;f.clips=new k;f.lastUpdateId=-1;f.moving=!1;f.updateRequested=!1;f.visibleAtCurrentScale=!1;f.highlightOptions=null;return f}G._inheritsLoose(u,B);var a=u.prototype;a.initialize=function(){const f=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&f&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new M("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new J.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([D.watch(()=>this.suspended,c=>{this.container&&(this.container.visible=!c);this.view&&!c&&this.updateRequested&&this.view.requestUpdate()},D.syncAndInitial),
D.watch(()=>this.layer?.opacity??1,c=>{this.container&&(this.container.opacity=c)},D.syncAndInitial),D.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",c=>{this.container&&(this.container.blendMode=c)},D.syncAndInitial),D.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,c=>{this.container&&(this.container.effect=c)},D.syncAndInitial),D.watch(()=>this.highlightOptions,c=>this.container.highlightOptions=c,D.syncAndInitial),D.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},D.syncAndInitial),D.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:c})=>{c=null!=c?this.isVisibleAtScale(c):!1;c!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",c)},D.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(c=>{c===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};a.destroy=function(){this.processDetach();this.updateRequested=!1};a.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};a.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};a.isVisibleAtScale=function(f){const c=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!c)return!0;
const {minScale:l,maxScale:b}=c;return(0===l||f<=l)&&(0===b||f>=b)};a.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};a.processUpdate=function(f){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",f),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(f)))};a.hitTest=function(f,c){return Promise.resolve(null)};a.supportsSpatialReference=function(f){return!0};
a.canResume=function(){return this.spatialReferenceSupported?B.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};a.getSuspendInfo=function(){const f=B.prototype.getSuspendInfo.call(this),c=!this.spatialReferenceSupported,l=this.visibleAtCurrentScale;c&&(f.spatialReferenceNotSupported=c);l&&(f.outsideScaleRange=l);return f};a.addAttachHandles=function(f){this.addHandles(f,"attach")};G._createClass(u,[{key:"spatialReferenceSupported",get:function(){const f=this.view?.spatialReference;
return null==f||this.supportsSpatialReference(f)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return u}(n);K.__decorate([L.property()],n.prototype,"attached",void 0);K.__decorate([L.property({type:k,set(B){B=w.referenceSetter(B,this._get("clips"),k);this._set("clips",B)}})],n.prototype,"clips",void 0);K.__decorate([L.property()],n.prototype,"container",void 0);
K.__decorate([L.property()],n.prototype,"moving",void 0);K.__decorate([L.property({readOnly:!0})],n.prototype,"spatialReferenceSupported",null);K.__decorate([L.property({readOnly:!0})],n.prototype,"updateParameters",void 0);K.__decorate([L.property()],n.prototype,"updateRequested",void 0);K.__decorate([L.property()],n.prototype,"updating",null);K.__decorate([L.property()],n.prototype,"view",void 0);K.__decorate([L.property({readOnly:!0})],n.prototype,"visibleAtCurrentScale",void 0);K.__decorate([L.property({type:V})],
n.prototype,"highlightOptions",void 0);return n=K.__decorate([P.subclass("esri.views.2d.layers.LayerView2D")],n)};Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(E,
G,K,I,w,M,D){var L;I=L=function(F){function T(J){J=F.call(this,J)||this;J.type="rect";J.left=null;J.right=null;J.top=null;J.bottom=null;return J}E._inheritsLoose(T,F);var P=T.prototype;P.clone=function(){return new L({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};P.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return T}(D);G.__decorate([K.property({type:[Number,String],json:{write:!0}})],
I.prototype,"left",void 0);G.__decorate([K.property({type:[Number,String],json:{write:!0}})],I.prototype,"right",void 0);G.__decorate([K.property({type:[Number,String],json:{write:!0}})],I.prototype,"top",void 0);G.__decorate([K.property({type:[Number,String],json:{write:!0}})],I.prototype,"bottom",void 0);return I=L=G.__decorate([M.subclass("esri.views.layers.support.ClipRect")],I)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass".split(" "),
function(E,G,K,I,w,M,D){K=function(L){function F(){return L.apply(this,arguments)||this}E._inheritsLoose(F,L);E._createClass(F,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return F}(K.JSONSupport);G.__decorate([I.property({readOnly:!0})],K.prototype,"version",null);return K=G.__decorate([D.subclass("esri.views.layers.support.ClipArea")],K)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P,J){var V;K={base:L,key:"type",typeMap:{extent:P,polygon:J}};T=V=function(Y){function W(k){k=Y.call(this,k)||this;k.type="geometry";k.geometry=null;return k}E._inheritsLoose(W,Y);var U=W.prototype;U.clone=function(){return new V({geometry:this.geometry?.clone()??null})};U.commitVersionProperties=function(){this.commitProperty("geometry")};return W}(T);G.__decorate([I.property({types:K,json:{read:F.fromJSON,write:!0}})],T.prototype,"geometry",void 0);return T=V=G.__decorate([D.subclass("esri.views.layers.support.Geometry")],
T)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(E,G,K,I,w,M,D){I=function(L){function F(T){T=L.call(this,T)||this;T.type="path";T.path=[];return T}E._inheritsLoose(F,L);F.prototype.commitVersionProperties=function(){this.commitProperty("path")};
return F}(D);G.__decorate([K.property({type:[[[Number]]],json:{write:!0}})],I.prototype,"path",void 0);return I=G.__decorate([M.subclass("esri.views.layers.support.Path")],I)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./BaseGraphicContainer ../../../webgl/enums".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P){K=function(J){function V(){return J.apply(this,arguments)||this}E._inheritsLoose(V,J);var Y=V.prototype;Y.doRender=function(W){W.drawPhase===F.WGLDrawPhase.HIGHLIGHT&&J.prototype.doRender.call(this,W)};Y.renderChildren=function(W){this.attributeView.update();if(this.children.some(k=>k.hasData)){this.attributeView.bindTextures(W.context);J.prototype.renderChildren.call(this,W);var {painter:U}=W;U=U.effects.highlight;U.bind(W);W.context.setColorMask(!0,!0,!0,!0);W.context.clear(P.ClearBufferBit.COLOR_BUFFER_BIT);
this._renderChildren(W,U.defines.concat(["highlightAll"]));U.draw(W);U.unbind()}};return V}(T);return K=G.__decorate([L.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],K)})},"esri/views/2d/layers/imagery/ImageryView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../layers/support/rasterFunctions/pixelUtils ../../engine/BitmapContainer ../../engine/Container ../../engine/ImageryBitmapSource ../support/ExportStrategy".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P,J,V,Y,W,U){I=function(k){function n(){var u=k.apply(this,arguments)||this;u.attached=!1;u.container=new Y.Container;u.updateRequested=!1;u.type="imagery";u._bitmapView=new V.BitmapContainer;return u}E._inheritsLoose(n,k);var B=n.prototype;B.destroy=function(){this.attached&&(this.detach(),this.attached=!1);this.updateRequested=!1};B.update=function(u){this.strategy.update(u).catch(a=>{D.isAbortError(a)||w.getLogger(this.declaredClass).error(a)})};B.hitTest=function(u){return new K({attributes:{},
geometry:u.clone(),layer:this.layer})};B.attach=function(){this.container.addChild(this._bitmapView);this.strategy=new U({container:this._bitmapView,imageNormalizationSupported:10<=this.layer.version,imageMaxHeight:10.1<=this.layer.version?this.layer.imageMaxHeight:2048,imageMaxWidth:10.1<=this.layer.version?this.layer.imageMaxWidth:2048,fetchSource:this._fetchImage.bind(this),requestUpdate:()=>this.requestUpdate()})};B.detach=function(){this.strategy.destroy();this._bitmapView.removeAllChildren();
this.container.removeAllChildren();this.updateRequested=!1};B.redraw=function(){var u=this;this.strategy.updateExports(function(){var a=E._asyncToGenerator(function*(f){const {source:c}=f;if(c&&!(c instanceof ImageBitmap)){var l=yield u.layer.applyRenderer({extent:c.extent,pixelBlock:c.originalPixelBlock??c.pixelBlock});c.filter=b=>u.layer.pixelFilter?u.layer.applyFilter(b):{...l,extent:c.extent}}});return function(f){return a.apply(this,arguments)}}()).catch(a=>{D.isAbortError(a)||w.getLogger(this.declaredClass).error(a)})};
B.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate())};B.isUpdating=function(){return this.strategy.updating||this.updateRequested};B.getPixelData=function(){if(this.updating)return null;var u=this.strategy.bitmaps;if(1===u.length&&u[0].source)return{extent:u[0].source.extent,pixelBlock:u[0].source.originalPixelBlock};if(1<u.length){const a=this.view.extent;u=u.map(f=>f.source).filter(f=>f.extent&&f.extent.intersects(a)).map(f=>({extent:f.extent,pixelBlock:f.originalPixelBlock}));
u=J.mosaicPixelData(u,a);return M.isSome(u)?{extent:u.extent,pixelBlock:u.pixelBlock}:null}return null};B._fetchImage=function(){var u=E._asyncToGenerator(function*(a,f,c,l){l=l||{};l.timeExtent=this.timeExtent;l.requestAsImageElement=!0;l.returnImageBitmap=!0;a=yield this.layer.fetchImage(a,f,c,l);if(a.imageBitmap)return a.imageBitmap;l=yield this.layer.applyRenderer(a.pixelData,{signal:l.signal});l=new W(l.pixelBlock,l.extent?.clone(),a.pixelData.pixelBlock);l.filter=b=>this.layer.applyFilter(b);
return l});return function(a,f,c,l){return u.apply(this,arguments)}}();E._createClass(n,[{key:"updating",get:function(){return!this.attached||this.isUpdating()}}]);return n}(I);G.__decorate([L.property()],I.prototype,"attached",void 0);G.__decorate([L.property()],I.prototype,"container",void 0);G.__decorate([L.property()],I.prototype,"layer",void 0);G.__decorate([L.property()],I.prototype,"strategy",void 0);G.__decorate([L.property()],I.prototype,"timeExtent",void 0);G.__decorate([L.property()],I.prototype,
"view",void 0);G.__decorate([L.property()],I.prototype,"updateRequested",void 0);G.__decorate([L.property()],I.prototype,"updating",null);G.__decorate([L.property()],I.prototype,"type",void 0);return I=G.__decorate([P.subclass("esri.views.2d.layers.imagery.ImageryView2D")],I)})},"esri/layers/support/rasterFunctions/pixelUtils":function(){define(["exports","../../../core/maybe","../PixelBlock","../rasterFormats/pixelRangeUtils"],function(E,G,K,I){function w(a){return G.isSome(a)&&"esri.layers.support.PixelBlock"===
a.declaredClass&&a.pixels&&0<a.pixels.length}function M(a,f,c,l,b){const e=a.length;b=K.createEmptyBand(b,e);if(f)for(let g=0;g<e;g++)f[g]&&(b[g]=c[a[g]-l]);else for(f=0;f<e;f++)b[f]=c[a[f]-l];return b}function D(a,f,c,l){const b=null!=c&&2<=c.length?new Set(c):null;c=1===c?.length?c[0]:null;const e=!!f?.length;for(let g=0;g<a.length;g++)if(l[g]){const h=a[g];if(e){let m=!1;for(let q=0;q<f.length;q+=2)if(h>=f[q]&&h<=f[q+1]){m=!0;break}m||(l[g]=0)}l[g]&&(h===c||b?.has(h))&&(l[g]=0)}}function L(a,f){const c=
a[0].length;for(let l=0;l<c;l++)if(f[l]){let b=!1;for(let e=0;e<a.length;e++)if(a[e][l]){b=!0;break}b||(f[l]=0)}}function F(a,f){const c=a[0].length;for(let l=0;l<c;l++)if(f[l]){let b=!1;for(let e=0;e<a.length;e++)if(0===a[e][l]){b=!0;break}b&&(f[l]=0)}}function T(a,f,c,l,b,e,g,h){return{xmin:b<=c*a?0:b<c*a+a?b-c*a:a,ymin:e<=l*f?0:e<l*f+f?e-l*f:f,xmax:b+g<=c*a?0:b+g<c*a+a?b+g-c*a:a,ymax:e+h<=l*f?0:e+h<l*f+f?e+h-l*f:f}}function P(a,f,c,l,b,e){const {width:g,height:h}=c.block,{x:m,y:q}=c.offset,{width:y,
height:t}=c.mosaic;c=T(g,h,l,b,m,q,y,t);let r=0;var x=0;if(e){var C=e.hasGCSSShiftTransform?360:e.halfWorldWidth??0,O=g*e.resolutionX;const Q=e.startX+l*O;Q<C&&Q+O>C?x=e.rightPadding:Q>=C&&(r=e.leftMargin-e.rightPadding,x=0)}c.xmax-=x;if("number"===typeof f)for(e=c.ymin;e<c.ymax;e++)for(x=(b*h+e-q)*y+(l*g-m)+r,C=c.xmin;C<c.xmax;C++)a[x+C]=f;else for(e=c.ymin;e<c.ymax;e++)for(x=(b*h+e-q)*y+(l*g-m)+r,C=e*g,O=c.xmin;O<c.xmax;O++)a[x+O]=f[C+O]}function J(a,f,c={}){const {clipOffset:l,clipSize:b,alignmentInfo:e,
blockWidths:g}=c;if(g)return V(a,f,{blockWidths:g});var h=a.find(X=>w(X));if(G.isNone(h))return null;c=b?b.width:f.width;const m=b?b.height:f.height;var q=h.width,y=h.height;const t=f.width/q,r=f.height/y;f={offset:l||{x:0,y:0},mosaic:b||f,block:{width:q,height:y}};q=h.pixelType;y=K.getPixelArrayConstructor(q);var x=h.pixels.length;h=[];for(var C=0;C<x;C++){var O=new y(c*m);for(let X=0;X<r;X++)for(let Z=0;Z<t;Z++){var Q=a[X*t+Z];w(Q)&&(Q=Q.pixels[C],P(O,Q,f,Z,X,e))}h.push(O)}let aa;if(a.some(X=>G.isNone(X)||
G.isSome(X.mask)&&0<X.mask.length))for(aa=new Uint8Array(c*m),y=0;y<r;y++)for(x=0;x<t;x++)O=a[y*t+x],C=G.isSome(O)?O.mask:null,G.isSome(C)?P(aa,C,f,x,y,e):O?P(aa,1,f,x,y,e):P(aa,0,f,x,y,e);a=new K({width:c,height:m,pixels:h,pixelType:q,mask:aa});a.updateStatistics();return a}function V(a,f,c){const l=a.find(x=>G.isSome(x));if(G.isNone(l))return null;var b=a.some(x=>G.isSome(x)?!!x.mask:!0);const {width:e,height:g}=f;f=b?new Uint8Array(e*g):null;({blockWidths:c}=c);const h=[],m=l.getPlaneCount(),q=
K.getPixelArrayConstructor(l.pixelType);if(b)for(let x=0,C=0;x<a.length;C+=c[x],x++)if(b=a[x],w(b)){var y=G.unwrap(b.mask);for(var t=0;t<g;t++)for(var r=0;r<c[x];r++)f[t*e+r+C]=null==y?255:y[t*b.width+r]}for(b=0;b<m;b++){y=new q(e*g);for(let x=0,C=0;x<a.length;C+=c[x],x++)if(t=a[x],w(t)&&(r=t.pixels[b],null!=r))for(let O=0;O<g;O++)for(let Q=0;Q<c[x];Q++)y[O*e+Q+C]=r[O*t.width+Q];h.push(y)}a=new K({width:e,height:g,mask:f,pixels:h,pixelType:l.pixelType});a.updateStatistics();return a}function Y(a){if(!w(a))return null;
const f=a.clone(),{width:c,height:l,pixels:b}=a;var e=b[0];const g=f.pixels[0];a=G.unwrap(a.mask);for(let q=2;q<l-1;q++){const y=new Map;for(var h=q-2;h<q+2;h++)for(var m=0;4>m;m++){const t=h*c+m;k(y,e[t],a?a[t]:1)}g[q*c]=W(y);g[q*c+1]=g[q*c+2]=g[q*c];for(h=3;h<c-1;h++)m=(q-2)*c+h+1,k(y,e[m],a?a[m]:1),m=(q-1)*c+h+1,k(y,e[m],a?a[m]:1),m=q*c+h+1,k(y,e[m],a?a[m]:1),m=(q+1)*c+h+1,k(y,e[m],a?a[m]:1),m=(q-2)*c+h-3,U(y,e[m],a?a[m]:1),m=(q-1)*c+h-3,U(y,e[m],a?a[m]:1),m=q*c+h-3,U(y,e[m],a?a[m]:1),m=(q+1)*
c+h-3,U(y,e[m],a?a[m]:1),g[q*c+h]=W(y);g[q*c+h+1]=g[q*c+h]}for(e=0;e<c;e++)g[e]=g[c+e]=g[2*c+e],g[(l-1)*c+e]=g[(l-2)*c+e];f.updateStatistics();return f}function W(a){if(0===a.size)return 0;let f=0,c=-1,l=0;const b=a.keys();let e=b.next();for(;!e.done;)l=a.get(e.value),l>f&&(c=e.value,f=l),e=b.next();return c}function U(a,f,c){0!==c&&(c=a.get(f),1===c?a.delete(f):a.set(f,c-1))}function k(a,f,c){0!==c&&a.set(f,a.has(f)?a.get(f)+1:1)}function n(a,f,c){let {x:l,y:b}=f;const {width:e,height:g}=c;if(0===
l&&0===b&&g===a.height&&e===a.width)return a;const {width:h,height:m}=a;f=Math.max(0,b);const q=Math.max(0,l),y=Math.min(l+e,h),t=Math.min(b+g,m);if(0>y||0>t||!w(a))return null;l=Math.max(0,-l);b=Math.max(0,-b);var {pixels:r}=a,x=e*g,C=r.length;const O=[];for(var Q=0;Q<C;Q++){var aa=r[Q],X=K.createEmptyBand(a.pixelType,x);for(let Z=f;Z<t;Z++){const da=Z*h;let d=(Z+b-f)*e+l;for(let p=q;p<y;p++)X[d++]=aa[da+p]}O.push(X)}r=new Uint8Array(x);x=G.unwrap(a.mask);for(C=f;C<t;C++)for(Q=C*h,aa=(C+b-f)*e+l,
X=q;X<y;X++)r[aa++]=x?x[Q+X]:1;a=new K({width:c.width,height:c.height,pixelType:a.pixelType,pixels:O,mask:r});a.updateStatistics();return a}function B(a,f=!0){if(!w(a))return null;const {pixels:c,width:l,height:b,mask:e,pixelType:g}=a;a=[];const h=Math.round(l/2),m=Math.round(b/2),q=b-1,y=l-1;for(var t=0;t<c.length;t++){var r=c[t],x=K.createEmptyBand(g,h*m),C=0;for(var O=0;O<b;O+=2)for(var Q=0;Q<l;Q+=2){var aa=r[O*l+Q];if(f){var X=Q===y?aa:r[O*l+Q+1];const Z=O===q?aa:r[O*l+Q+l],da=Q===y?Z:O===q?X:
r[O*l+Q+l+1];x[C++]=(aa+X+Z+da)/4}else x[C++]=aa}a.push(x)}t=null;if(G.isSome(e))for(t=new Uint8Array(h*m),r=0,x=0;x<b;x+=2)for(C=0;C<l;C+=2)O=e[x*l+C],f?(Q=C===y?O:e[x*l+C+1],aa=x===q?O:e[x*l+C+l],X=C===y?aa:x===q?Q:e[x*l+C+l+1],t[r++]=O*Q*aa*X?1:0):t[r++]=O;return new K({width:h,height:m,pixelType:g,pixels:a,mask:t})}function u(a,f,c,l,b=0){const {width:e,height:g}=a,{width:h,height:m}=f;a=l.cols;l=l.rows;f=Math.ceil(h/a-.1/a);const q=Math.ceil(m/l-.1/l);let y,t,r,x,C;const O=f*a;var Q=O*q*l;const aa=
new Float32Array(Q),X=new Float32Array(Q),Z=new Uint32Array(Q),da=new Uint32Array(Q);let d=0,p,A;for(let z=0;z<q;z++)for(let R=0;R<f;R++){var v=12*(z*f+R);Q=c[v];y=c[v+1];t=c[v+2];r=c[v+3];x=c[v+4];C=c[v+5];for(var H=0;H<l;H++){d=(z*l+H)*O+R*a;A=(H+.5)/l;for(let S=0;S<H;S++)p=(S+.5)/a,aa[d+S]=(Q*p+y*A+t)*e+b,X[d+S]=(r*p+x*A+C)*g+b,Z[d+S]=Math.floor(aa[d+S]),da[d+S]=Math.floor(X[d+S])}v+=6;Q=c[v];y=c[v+1];t=c[v+2];r=c[v+3];x=c[v+4];C=c[v+5];for(v=0;v<l;v++)for(d=(z*l+v)*O+R*a,A=(v+.5)/l,H=v;H<a;H++)p=
(H+.5)/a,aa[d+H]=(Q*p+y*A+t)*e+b,X[d+H]=(r*p+x*A+C)*g+b,Z[d+H]=Math.floor(aa[d+H]),da[d+H]=Math.floor(X[d+H])}return{offsets_x:aa,offsets_y:X,offsets_xi:Z,offsets_yi:da,gridWidth:O}}E.NoDataInterpretation=void 0;(function(a){a[a.matchAny=0]="matchAny";a[a.matchAll=1]="matchAll"})(E.NoDataInterpretation||(E.NoDataInterpretation={}));E.MissingBandAction=void 0;(function(a){a[a.bestMatch=0]="bestMatch";a[a.fail=1]="fail"})(E.MissingBandAction||(E.MissingBandAction={}));E.MAX_MAP_SIZE_GPU=6;E.approximateTransform=
function(a,f,c,l,b="nearest"){if(!w(a))return null;"majority"===b&&(a=Y(a));const {pixels:e,mask:g,pixelType:h}=a,m=a.width;var q=a.height;const y=K.getPixelArrayConstructor(h),t=e.length,{width:r,height:x}=f;a=!1;for(let da=0;da<c.length;da+=3)-1===c[da]&&-1===c[da+1]&&-1===c[da+2]&&(a=!0);const {offsets_x:C,offsets_y:O,offsets_xi:Q,offsets_yi:aa,gridWidth:X}=u({width:m,height:q},f,c,l,"majority"===b?.5:0);let Z;f=(da,d,p)=>{const A=da instanceof Float32Array||da instanceof Float64Array?0:.5;for(let v=
0;v<x;v++){Z=v*X;for(let H=0;H<r;H++){if(0>C[Z]||0>O[Z])da[v*r+H]=0;else if(p)da[v*r+H]=d[Q[Z]+aa[Z]*m];else{const z=Math.floor(C[Z]),R=Math.floor(O[Z]),S=Math.ceil(C[Z]),N=Math.ceil(O[Z]),ca=C[Z]-z,ba=O[Z]-R;da[v*r+H]=!g||g[z+R*m]&&g[z+R*m]&&g[z+N*m]&&g[S+N*m]?(1-ba)*((1-ca)*d[z+R*m]+ca*d[S+R*m])+ba*((1-ca)*d[z+N*m]+ca*d[S+N*m])+A:d[Q[Z]+aa[Z]*m]}Z++}}};c=[];for(q=0;q<t;q++)l=new y(r*x),f(l,e[q],"nearest"===b||"majority"===b),c.push(l);b=new K({width:r,height:x,pixelType:h,pixels:c});if(G.isSome(g))b.mask=
new Uint8Array(r*x),f(b.mask,g,!0);else if(a)for(b.mask=new Uint8Array(r*x),a=0;a<r*x;a++)b.mask[a]=0>C[a]||0>O[a]?0:1;b.updateStatistics();return b};E.clip=n;E.colorize=function(a,f){if(!w(a)||!f||!f.indexedColormap&&!f.indexed2DColormap)return a;const c=a.clone();var l=c.pixels;let b=c.mask;const e=c.width*c.height;if(1!==l.length)return a;const {indexedColormap:g,indexed2DColormap:h,offset:m,alphaSpecified:q}=f;a=0;l=l[0];f=new Uint8Array(l.length);const y=new Uint8Array(l.length),t=new Uint8Array(l.length);
var r=0;if(g){const x=g.length-1;if(G.isSome(b))for(a=0;a<e;a++)b[a]&&(r=4*(l[a]-m),r<m||r>x?b[a]=0:(f[a]=g[r],y[a]=g[r+1],t[a]=g[r+2],b[a]=g[r+3]));else{b=new Uint8Array(e);for(a=0;a<e;a++)r=4*(l[a]-m),r<m||r>x?b[a]=0:(f[a]=g[r],y[a]=g[r+1],t[a]=g[r+2],b[a]=g[r+3]);c.mask=b}}else if(h)if(G.isSome(b))for(a=0;a<e;a++)b[a]&&(r=h[l[a]],f[a]=r[0],y[a]=r[1],t[a]=r[2],b[a]=r[3]);else{b=new Uint8Array(e);for(a=0;a<e;a++)r=h[l[a]],f[a]=r[0],y[a]=r[1],t[a]=r[2],b[a]=r[3];c.mask=b}c.pixels=[f,y,t];c.statistics=
null;c.pixelType="u8";c.maskIsAlpha=q;return c};E.compositeBands=function(a){if(!a?.length||a.some(m=>!w(m)))return null;if(1===a.length)return G.isSome(a[0])?a[0].clone():null;const {width:f,height:c,pixelType:l}=a[0];if(a.some(m=>m.width!==f||m.height!==c))return null;const b=a.map(({mask:m})=>m).filter(m=>null!=m);let e=null;b.length&&(e=new Uint8Array(f*c),e.set(b[0]),1<b.length&&F(b.slice(1),e));const g=[];a.forEach(({pixels:m})=>g.push(...m));const h=[];a.map(({statistics:m})=>m).filter(m=>
m?.length).forEach(m=>h.push(...m));return new K({pixelType:l,width:f,height:c,mask:e,pixels:g,statistics:h.length?h:null})};E.createColormapLUT=function(a){if(a){var f=a.colormap;if(f&&0!==f.length){f=f.sort((q,y)=>q[0]-y[0]);var c=0;0>f[0][0]&&(c=f[0][0]);var l=Math.max(256,f[f.length-1][0]-c+1),b=new Uint8Array(4*l),e=[],g=0,h=0,m=5===f[0].length;if(65536<l)return f.forEach(q=>{e[q[0]-c]=m?q.slice(1):q.slice(1).concat([255])}),{indexed2DColormap:e,offset:c,alphaSpecified:m};if(a.fillUnspecified)for(a=
f[h],g=a[0]-c;g<l;g++)b[4*g]=a[1],b[4*g+1]=a[2],b[4*g+2]=a[3],b[4*g+3]=m?a[4]:255,g===a[0]-c&&(a=h===f.length-1?a:f[++h]);else for(g=0;g<f.length;g++)a=f[g],h=4*(a[0]-c),b[h]=a[1],b[h+1]=a[2],b[h+2]=a[3],b[h+3]=m?a[4]:255;return{indexedColormap:b,offset:c,alphaSpecified:m}}}};E.createMaskLUT=function(a,f,c){if("u8"!==a&&"s8"!==a&&"u16"!==a&&"s16"!==a)return null;var l=a.includes("16")?65536:256;a=a.includes("s")?-l/2:0;l=new Uint8Array(l);if(f)for(let e=0;e<f.length;e++){var b=Math.ceil(f[2*e]-a);
const g=Math.floor(f[2*e+1]-a);for(;b<=g;b++)l[b]=255}else l.fill(255);if(c)for(f=0;f<c.length;f++)l[c[f]-a]=0;return{lut:l,offset:a}};E.createRemapLUT=function(a){const {srcPixelType:f,inputRanges:c,outputValues:l,allowUnmatched:b,noDataRanges:e,isLastInputRangeInclusive:g,outputPixelType:h}=a;if("u8"!==f&&"s8"!==f&&"u16"!==f&&"s16"!==f)return null;var m=f.includes("16")?65536:256;a=f.includes("s")?-m/2:0;const q=K.createEmptyBand(h,m);m=new Uint8Array(m);b&&m.fill(255);const [y,t]=I.getPixelValueRange(h);
if(c?.length&&l?.length){var r=c.map(Q=>Q-1E-6);r[0]=c[0];g&&(r[r.length-1]=c[c.length-1]);for(var x=0;x<r.length;x++){var C=l[x]>t?t:l[x]<y?y:l[x],O=Math.ceil(r[2*x]-a);const Q=Math.floor(r[2*x+1]-a);for(;O<=Q;O++)q[O]=C,m[O]=255}}if(e?.length)for(r=0;r<e.length;r++)for(C=Math.ceil(e[2*r]-a),x=Math.floor(e[2*r+1]-a);C<=x;C++)m[C]=0;return{lut:q,offset:a,mask:m}};E.extractBands=function(a,f){if(!f?.length||!w(a))return a;const c=a.pixels.length;return f&&f.some(l=>l>=c)||1===c&&1===f.length&&0===
f[0]||c===f.length&&!f.some((l,b)=>l!==b)?a:new K({pixelType:a.pixelType,width:a.width,height:a.height,mask:a.mask,validPixelCount:a.validPixelCount,maskIsAlpha:a.maskIsAlpha,pixels:f.map(l=>a.pixels[l]),statistics:a.statistics&&f.map(l=>a.statistics[l])})};E.getClipBounds=T;E.getLocalArithmeticNorthRotations=function(a,f){const {coefficients:c,spacing:l}=f,{offsets_x:b,offsets_y:e,gridWidth:g}=u(a,a,c,{rows:l[0],cols:l[1]}),{width:h,height:m}=a;a=new Float32Array(h*m);f=180/Math.PI;for(let t=0;t<
m;t++)for(let r=0;r<h;r++){var q=t*g+r,y=0===t?q:q-g;const x=t===m-1?q:q+g;q=b[y]-b[x];y=e[x]-e[y];isNaN(q)||isNaN(y)?a[t*h+r]=90:(y=Math.atan2(y,q)*f,y=(360+y)%360,a[t*h+r]=y)}return a};E.interpolateOffsets=u;E.isValidPixelBlock=w;E.lookupBandValues=M;E.lookupPixels=function(a,f){if(!w(a))return null;const {pixels:c,mask:l}=a,b=c.length;let e=f.lut;const {offset:g}=f;e&&1===e[0].length&&(e=c.map(()=>e));const h=[];f=f.outputPixelType||"u8";for(let m=0;m<b;m++){const q=M(c[m],l,e[m],g||0,f);h.push(q)}a=
new K({width:a.width,height:a.height,pixels:h,mask:l,pixelType:f});a.updateStatistics();return a};E.mask=function(a,f){if(!w(a))return null;const {width:c,height:l,pixels:b}=a;var e=c*l;const g=new Uint8Array(e);a.mask?g.set(a.mask):g.fill(255);a=b.length;const {includedRanges:h,noDataValues:m,outputPixelType:q,matchAll:y,lookups:t}=f;if(t){e=[];for(f=0;f<a;f++){var r=t[f];r=M(b[f],g,r.lut,r.offset||0,"u8");e.push(r)}1===e.length?g.set(e[0]):y?L(e,g):F(e,g)}else if(y){f=[];for(r=0;r<a;r++){const x=
new Uint8Array(e);x.set(g);D(b[r],h?.slice(2*r,2*r+2),m?.[r],x);f.push(x)}1===f.length?g.set(f[0]):L(f,g)}else for(e=0;e<a;e++)D(b[e],h?.slice(2*e,2*e+2),m?.[e],g);return new K({width:c,height:l,pixelType:q,pixels:b,mask:g})};E.mosaic=J;E.mosaicPixelData=function(a,f){if(!a||0===a.length)return null;var c=a.find(t=>t.pixelBlock);if(!c||G.isNone(c.pixelBlock))return null;var l=(c.extent.xmax-c.extent.xmin)/c.pixelBlock.width;const b=(c.extent.ymax-c.extent.ymin)/c.pixelBlock.height,e=.01*Math.min(l,
b),g=a.sort((t,r)=>Math.abs(t.extent.ymax-r.extent.ymax)>e?r.extent.ymax-t.extent.ymax:Math.abs(t.extent.xmin-r.extent.xmin)>e?t.extent.xmin-r.extent.xmin:0);var h=Math.min.apply(null,g.map(t=>t.extent.xmin));const m=Math.min.apply(null,g.map(t=>t.extent.ymin)),q=Math.max.apply(null,g.map(t=>t.extent.xmax)),y=Math.max.apply(null,g.map(t=>t.extent.ymax));a={x:Math.round((f.xmin-h)/l),y:Math.round((y-f.ymax)/b)};h={width:Math.round((q-h)/l),height:Math.round((y-m)/b)};l={width:Math.round((f.xmax-f.xmin)/
l),height:Math.round((f.ymax-f.ymin)/b)};if(Math.round(h.width/c.pixelBlock.width)*Math.round(h.height/c.pixelBlock.height)!==g.length||0>a.x||0>a.y||h.width<l.width||h.height<l.height)return null;c=g.map(t=>t.pixelBlock);c=J(c,h,{clipOffset:a,clipSize:l});return{extent:f,pixelBlock:c}};E.remap=function(a,f){if(!w(a))return null;const {width:c,height:l}=a,{inputRanges:b,outputValues:e,outputPixelType:g,noDataRanges:h,allowUnmatched:m,isLastInputRangeInclusive:q}=f;f=a.pixels[0];const y=K.createEmptyBand(g,
f.length),t=a.mask,r=new Uint8Array(c*l);t?r.set(t):r.fill(255);const x=a.pixelType.startsWith("f")?1E-6:0;var C=b.map(d=>d-x);C[0]=b[0];C[C.length-1]=b[b.length-1]+(q?1E-6:0);a=b.length/2;const [O,Q]=I.getPixelValueRange(g);for(var aa=0;aa<l;aa++)for(var X=0;X<c;X++){var Z=aa*c+X;if(r[Z]){var da=f[Z];let d=!1;for(let p=a-1;0<=p;p--)if(da===C[2*p]||da>C[2*p]&&da<C[2*p+1]){y[Z]=e[p];d=!0;break}d||(m?y[Z]=da>Q?Q:da<O?O:da:r[Z]=0)}}if(h?.length)for(C=0;C<l;C++)for(aa=0;aa<c;aa++)if(X=C*c+aa,!t||t[X])for(Z=
f[X],da=0;da<a;da+=2)if(Z>=h[da]&&Z<=h[da+1]){y[X]=0;r[X]=0;break}return new K({width:c,height:l,pixelType:g,pixels:[y],mask:r})};E.remapColor=function(a,f){if(!w(a))return null;a=a.clone();var {pixels:c}=a;const l=a.width*a.height,b=f.length,e=Math.floor(b/2),g=f[Math.floor(e)];c=c[0];let h,m,q,y,t,r,x=!1;const C=new Uint8Array(l),O=new Uint8Array(l),Q=new Uint8Array(l);let aa=a.mask;const X=4===f[0].mappedColor.length;aa||(aa=new Uint8Array(l),aa.fill(X?255:1),a.mask=aa);for(t=0;t<l;t++)if(aa[t]){h=
c[t];x=!1;r=e;m=g;q=0;for(y=b-1;1<y-q;){if(h===m.value){x=!0;break}h>m.value?q=r:y=r;r=Math.floor((q+y)/2);m=f[Math.floor(r)]}x||(h===f[q].value?(m=f[q],x=!0):h===f[y].value?(m=f[y],x=!0):h<f[q].value?(x=!1,m=null):h>f[q].value&&(h<f[y].value?(m=f[q],x=!0):y===b-1?(x=!1,m=null):(m=f[y],x=!0)));x?(C[t]=m.mappedColor[0],O[t]=m.mappedColor[1],Q[t]=m.mappedColor[2],aa[t]=m.mappedColor[3]):C[t]=O[t]=Q[t]=aa[t]=0}a.pixels=[C,O,Q];a.mask=aa;a.pixelType="u8";a.maskIsAlpha=X;return a};E.resampleByMajority=
Y;E.setValidBoundary=function(a,f,c){if(!w(a))return null;const {width:l,height:b}=a,e=f.x;f=f.y;const g=c.width+e;c=c.height+f;if(0>e||0>f||g>l||c>b||0===e&&0===f&&g===l&&c===b)return a;a.mask||(a.mask=new Uint8Array(l*b));const h=a.mask;for(let m=0;m<b;m++){const q=m*l;for(let y=0;y<l;y++)h[q+y]=m<f||m>=c||y<e||y>=g?0:1}a.updateStatistics();return a};E.split=function(a,f,c){if(!w(a))return null;const {width:l,height:b}=f;let {width:e,height:g}=a;const h=new Map,m={x:0,y:0};c=null==c?1:1+c;for(let q=
0;q<c;q++){const y=Math.ceil(e/l),t=Math.ceil(g/b);for(let r=0;r<t;r++){m.y=r*b;for(let x=0;x<y;x++){m.x=x*l;const C=n(a,m,f);h.set(`${q}/${r}/${x}`,C)}}q<c-1&&(a=B(a));e=Math.round(e/2);g=Math.round(g/2)}return h};Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/PixelBlock":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ./SimpleBandStatistics ./rasterFormats/pixelRangeUtils".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P,J){var V;I=V=function(Y){function W(k){k=Y.call(this,k)||this;k.width=null;k.height=null;k.pixelType="f32";k.validPixelCount=null;k.mask=null;k.maskIsAlpha=!1;k.premultiplyAlpha=!1;k.statistics=null;k.depthCount=1;return k}E._inheritsLoose(W,Y);W.createEmptyBand=function(k,n){return new (V.getPixelArrayConstructor(k))(n)};W.getPixelArrayConstructor=function(k){let n;switch(k){case "u1":case "u2":case "u4":case "u8":n=Uint8Array;break;case "u16":n=Uint16Array;break;case "u32":n=
Uint32Array;break;case "s8":n=Int8Array;break;case "s16":n=Int16Array;break;case "s32":n=Int32Array;break;case "f32":n=Float32Array;break;case "f64":n=Float64Array;break;case "c64":case "c128":case "unknown":n=Float32Array}return n};var U=W.prototype;U.castPixelType=function(k){if(!k)return"f32";k=k.toLowerCase();["u1","u2","u4"].includes(k)?k="u8":"unknown u8 s8 u16 s16 u32 s32 f32 f64".split(" ").includes(k)||(k="f32");return k};U.getPlaneCount=function(){return this.pixels?.length};U.addData=function(k){if(!k.pixels||
k.pixels.length!==this.width*this.height)throw new K("pixelblock:invalid-or-missing-pixels","add data requires valid pixels array that has same length defined by pixel block width * height");this.pixels||(this.pixels=[]);this.statistics||(this.statistics=[]);this.pixels.push(k.pixels);this.statistics.push(k.statistics??new P.SimpleBandStatistics)};U.getAsRGBA=function(){const k=new ArrayBuffer(this.width*this.height*4);switch(this.pixelType){case "s8":case "s16":case "u16":case "s32":case "u32":case "f32":case "f64":this._fillFromNon8Bit(k);
break;default:this._fillFrom8Bit(k)}return new Uint8ClampedArray(k)};U.getAsRGBAFloat=function(){const k=new Float32Array(this.width*this.height*4);this._fillFrom32Bit(k);return k};U.updateStatistics=function(){if(this.pixels){this.statistics=this.pixels.map(B=>this._calculateBandStatistics(B,this.mask));var k=this.mask,n=0;if(D.isSome(k))for(let B=0;B<k.length;B++)k[B]&&n++;else n=this.width*this.height;this.validPixelCount=n}};U.clamp=function(k){if(k&&"f64"!==k&&"f32"!==k&&this.pixels){var [n,
B]=J.getPixelValueRange(k),u=this.pixels,a=this.width*this.height,f=u.length,c=[];for(let g=0;g<f;g++){var l=V.createEmptyBand(k,a);var b=u[g];for(let h=0;h<a;h++){var e=b[h];l[h]=e>B?B:e<n?n:e}c.push(l)}this.pixels=c;this.pixelType=k}};U.extractBands=function(k){const {pixels:n,statistics:B}=this;if(D.isNone(k)||0===k.length||!n||0===n.length)return this;var u=n.length;const a=k.some(f=>f>=n.length);u=u===k.length&&!k.some((f,c)=>f!==c);return a||u?this:new V({pixelType:this.pixelType,width:this.width,
height:this.height,mask:this.mask,validPixelCount:this.validPixelCount,maskIsAlpha:this.maskIsAlpha,pixels:k.map(f=>n[f]),statistics:B&&k.map(f=>B[f])})};U.clone=function(){const k=new V({width:this.width,height:this.height,pixelType:this.pixelType,maskIsAlpha:this.maskIsAlpha,validPixelCount:this.validPixelCount});D.isSome(this.mask)&&(k.mask=this.mask instanceof Uint8Array?new Uint8Array(this.mask):this.mask.slice(0));let n;const B=V.getPixelArrayConstructor(this.pixelType);if(this.pixels&&0<this.pixels.length){k.pixels=
[];const u=!!this.pixels[0].slice;for(n=0;n<this.pixels.length;n++)k.pixels[n]=u?this.pixels[n].slice(0,this.pixels[n].length):new B(this.pixels[n])}if(this.statistics)for(k.statistics=[],n=0;n<this.statistics.length;n++)k.statistics[n]=w.clone(this.statistics[n]);k.premultiplyAlpha=this.premultiplyAlpha;return k};U._fillFrom8Bit=function(k){const {mask:n,maskIsAlpha:B,premultiplyAlpha:u,pixels:a}=this;if(k&&a&&a.length){var f,c;var l=f=c=a[0];3<=a.length?(f=a[1],c=a[2]):2===a.length&&(f=a[1]);var b=
new Uint32Array(k),e=this.width*this.height;if(l.length!==e)M.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");else if(D.isSome(n)&&n.length===e)if(B)for(k=0;k<e;k++){const g=n[k];if(g){const h=g/255;b[k]=u?g<<24|c[k]*h<<16|f[k]*h<<8|l[k]*h:g<<24|c[k]<<16|f[k]<<8|l[k]}}else for(k=0;k<e;k++)n[k]&&(b[k]=-16777216|c[k]<<16|f[k]<<8|l[k]);else for(k=0;k<e;k++)b[k]=-16777216|c[k]<<16|f[k]<<8|l[k]}else M.getLogger(this.declaredClass).error("getAsRGBA()",
"Unable to convert to RGBA. The input pixel block is empty.")};U._fillFromNon8Bit=function(k){const {pixels:n,mask:B,statistics:u}=this;if(k&&n&&n.length){var a=this.pixelType,f=1,c=0;f=1;if(u&&0<u.length){for(var l of u)null!=l.minValue&&(c=Math.min(c,l.minValue)),null!=l.maxValue&&null!=l.minValue&&(f=Math.max(f,l.maxValue-l.minValue));f=255/f}else f=255,"s8"===a?(c=-128,f=127):"u16"===a?f=65535:"s16"===a?(c=-32768,f=32767):"u32"===a?f=4294967295:"s32"===a?(c=-2147483648,f=2147483647):"f32"===a?
(c=-3.4*1E39,f=3.4*1E39):"f64"===a&&(c=-Number.MAX_VALUE,f=Number.MAX_VALUE),f=255/(f-c);k=new Uint32Array(k);a=this.width*this.height;var b,e,g;l=b=e=n[0];if(l.length!==a)return M.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The pixelblock is invalid.");if(2<=n.length)if(b=n[1],3<=n.length&&(e=n[2]),D.isSome(B)&&B.length===a)for(g=0;g<a;g++)B[g]&&(k[g]=-16777216|(e[g]-c)*f<<16|(b[g]-c)*f<<8|(l[g]-c)*f);else for(g=0;g<a;g++)k[g]=-16777216|(e[g]-c)*f<<16|(b[g]-c)*f<<
8|(l[g]-c)*f;else if(D.isSome(B)&&B.length===a)for(g=0;g<a;g++)b=(l[g]-c)*f,B[g]&&(k[g]=-16777216|b<<16|b<<8|b);else for(g=0;g<a;g++)b=(l[g]-c)*f,k[g]=-16777216|b<<16|b<<8|b}else M.getLogger(this.declaredClass).error("getAsRGBA()","Unable to convert to RGBA. The input pixel block is empty.")};U._fillFrom32Bit=function(k){const {pixels:n,mask:B}=this;if(!k||!n||!n.length)return M.getLogger(this.declaredClass).error("getAsRGBAFloat()","Unable to convert to RGBA. The input pixel block is empty.");let u,
a,f,c;u=a=f=n[0];3<=n.length?(a=n[1],f=n[2]):2===n.length&&(a=n[1]);const l=this.width*this.height;if(u.length!==l)return M.getLogger(this.declaredClass).error("getAsRGBAFloat()","Unable to convert to RGBA. The pixelblock is invalid.");let b=0;if(D.isSome(B)&&B.length===l)for(c=0;c<l;c++)k[b++]=u[c],k[b++]=a[c],k[b++]=f[c],k[b++]=B[c]&1;else for(c=0;c<l;c++)k[b++]=u[c],k[b++]=a[c],k[b++]=f[c],k[b++]=1};U._calculateBandStatistics=function(k,n){let B=Infinity,u=-Infinity;const a=k.length;let f,c=0;
if(D.isSome(n))for(f=0;f<a;f++)n[f]&&(c=k[f],B=c<B?c:B,u=c>u?c:u);else for(f=0;f<a;f++)c=k[f],B=c<B?c:B,u=c>u?c:u;return new P.SimpleBandStatistics(B,u)};return W}(I.JSONSupport);G.__decorate([L.property({json:{write:!0}})],I.prototype,"width",void 0);G.__decorate([L.property({json:{write:!0}})],I.prototype,"height",void 0);G.__decorate([L.property({json:{write:!0}})],I.prototype,"pixelType",void 0);G.__decorate([F.cast("pixelType")],I.prototype,"castPixelType",null);G.__decorate([L.property({json:{write:!0}})],
I.prototype,"validPixelCount",void 0);G.__decorate([L.property({json:{write:!0}})],I.prototype,"mask",void 0);G.__decorate([L.property({json:{write:!0}})],I.prototype,"maskIsAlpha",void 0);G.__decorate([L.property({json:{write:!0}})],I.prototype,"pixels",void 0);G.__decorate([L.property()],I.prototype,"premultiplyAlpha",void 0);G.__decorate([L.property({json:{write:!0}})],I.prototype,"statistics",void 0);G.__decorate([L.property({json:{write:!0}})],I.prototype,"depthCount",void 0);G.__decorate([L.property({json:{write:!0}})],
I.prototype,"noDataValues",void 0);G.__decorate([L.property({json:{write:!0}})],I.prototype,"bandMasks",void 0);return I=V=G.__decorate([T.subclass("esri.layers.support.PixelBlock")],I)})},"esri/layers/support/SimpleBandStatistics":function(){define(["exports"],function(E){E.SimpleBandStatistics=function(G=null,K=null,I=null){this.minValue=G;this.maxValue=K;this.noDataValue=I};Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFormats/pixelRangeUtils":function(){define(["exports"],
function(E){function G(I){return K[I]??[-3.4028234663852886E38,3.4028234663852886E38]}const K={u1:[0,1],u2:[0,3],u4:[0,15],u8:[0,255],s8:[-128,127],u16:[0,65535],s16:[-32768,32767],u32:[0,4294967295],s32:[-2147483648,2147483647],f32:[-3.4028234663852886E38,3.4028234663852886E38],f64:[-Number.MAX_VALUE,Number.MAX_VALUE]};E.convertNoDataToMask=function(I,w,M){if(!(I.depthCount&&1<I.depthCount)){var {pixels:D,statistics:L,pixelType:F}=I,T=D[0].length,P=I.bandMasks??[],J=I.mask??(new Uint8Array(T)).fill(255),
V="f32"===F||"f64"===F,Y=G(F),W=!1;for(let n=0;n<D.length;n++){const B="number"===typeof w?w:w[n];if(null==B)continue;var U=L?.[n].maxValue??Y[1];if((L?.[n].minValue??Y[0])>B+Number.EPSILON||U<B-Number.EPSILON)continue;U=P[n]||(new Uint8Array(T)).fill(255);const u=D[n];var k=M?.customFloatTolerance;if(V&&0!==k){k||(k=9.999999E37<=Math.abs(B)?2E-7*Math.abs(B):"f32"===F?2**-23:Number.EPSILON);for(let a=0;a<u.length;a++)U[a]&&Math.abs(u[a]-B)<k&&(u[a]=0,U[a]=0,J[a]=0,W=!0)}else for(k=0;k<u.length;k++)U[k]&&
u[k]===B&&(u[k]=0,U[k]=0,J[k]=0,W=!0);P[n]=U}W&&(I.bandMasks=P,I.mask=J);W&&"updateStatistics"in I&&I.updateStatistics()}};E.getPixelValueRange=G;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/support/ExportStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/has ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../layers/support/TileInfo ../../viewStateUtils ../../engine/Bitmap ../../tiling/TileInfoView ../../tiling/TileKey".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P,J,V,Y,W,U){const k=T.create(),n=[0,0],B=new U(0,0,0,0);K=function(u){function a(c){var l=u.call(this,c)||this;l._imagePromise=null;l.bitmaps=[];l.hidpi=!1;l.imageMaxWidth=2048;l.imageMaxHeight=2048;l.imageRotationSupported=!1;l.imageNormalizationSupported=!1;l.update=w.debounce(function(){var b=E._asyncToGenerator(function*(e,g){w.throwIfAborted(g);if(e.stationary&&!l.destroyed){var h=e.state,m=P.getInfo(h.spatialReference);e=l.hidpi?e.pixelRatio:1;var q=l.imageNormalizationSupported&&
h.worldScreenWidth&&h.worldScreenWidth<h.size[0],y=l.imageMaxWidth??0,t=l.imageMaxHeight??0;q?(n[0]=h.worldScreenWidth,n[1]=h.size[1]):l.imageRotationSupported?(n[0]=h.size[0],n[1]=h.size[1]):V.getOuterSize(n,h);m=m&&(h.extent.xmin<m.valid[0]||h.extent.xmax>m.valid[1]);var r=!l.imageNormalizationSupported&&m,x=!(Math.floor(n[0]*e)>y||Math.floor(n[1]*e)>t)&&!r,C=l.imageRotationSupported?h.rotation:0;m=l.container.children.slice();x?(q=q?h.paddedViewState.center:h.center,l._imagePromise&&console.error("Image promise was not defined!"),
l._imagePromise=l._singleExport(h,n,q,h.resolution,C,e,g)):(q=Math.min(y,t),r&&(q=Math.min(h.worldScreenWidth,q)),l._imagePromise=l._tiledExport(h,q,e,g));try{const O=(yield l._imagePromise)??[];w.throwIfAborted(g);g=[];l._imagePromise=null;if(!l.destroyed){l.bitmaps=O;for(const Q of m)O.includes(Q)||g.push(Q.fadeOut().then(()=>{Q.remove();Q.destroy()}));for(const Q of O)g.push(Q.fadeIn());yield Promise.all(g)}}catch(O){l._imagePromise=null,w.throwIfAbortError(O)}}});return function(e,g){return b.apply(this,
arguments)}}(),5E3);l.updateExports=w.debounce(function(){var b=E._asyncToGenerator(function*(e){const g=[];for(const h of l.container.children){if(!h.visible||!h.stage)return;g.push(e(h).then(()=>{h.invalidateTexture();h.requestRender()}))}l._imagePromise=w.eachAlways(g).then(()=>l._imagePromise=null);yield l._imagePromise});return function(e){return b.apply(this,arguments)}}());return l}E._inheritsLoose(a,u);var f=a.prototype;f.destroy=function(){this.bitmaps.forEach(c=>c.destroy());this.bitmaps=
[]};f._export=function(){var c=E._asyncToGenerator(function*(l,b,e,g,h,m){e=yield this.fetchSource(l,Math.floor(b*h),Math.floor(e*h),{rotation:g,pixelRatio:h,signal:m});w.throwIfAborted(m);const q=new Y.Bitmap(null,{immutable:!0,requestRenderOnSourceChangedEnabled:!0});q.x=l.xmin;q.y=l.ymax;q.resolution=l.width/b;q.rotation=g;q.pixelRatio=h;q.opacity=0;this.container.addChild(q);yield q.setSourceAsync(e,m);w.throwIfAborted(m);return q});return function(l,b,e,g,h,m){return c.apply(this,arguments)}}();
f._singleExport=function(){var c=E._asyncToGenerator(function*(l,b,e,g,h,m,q){V.getBBox(k,e,g,b);l=T.toExtent(k,l.spatialReference);return[yield this._export(l,b[0],b[1],h,m,q)]});return function(l,b,e,g,h,m,q){return c.apply(this,arguments)}}();f._tiledExport=function(c,l,b,e){var g=J.create({size:l,spatialReference:c.spatialReference,scales:[c.scale]});const h=new W(g);g=h.getTileCoverage(c);if(!g)return null;const m=[];g.forEach((q,y,t,r)=>{B.set(q,y,t,0);h.getTileBounds(k,B);const x=T.toExtent(k,
c.spatialReference);m.push(this._export(x,l,l,0,b,e).then(C=>{0!==r&&(B.set(q,y,t,r),h.getTileBounds(k,B),C.x=k[0],C.y=k[3]);return C}))});return Promise.all(m)};E._createClass(a,[{key:"updating",get:function(){return!this.destroyed&&null!==this._imagePromise}}]);return a}(K);G.__decorate([M.property()],K.prototype,"_imagePromise",void 0);G.__decorate([M.property()],K.prototype,"bitmaps",void 0);G.__decorate([M.property()],K.prototype,"container",void 0);G.__decorate([M.property()],K.prototype,"fetchSource",
void 0);G.__decorate([M.property()],K.prototype,"hidpi",void 0);G.__decorate([M.property()],K.prototype,"imageMaxWidth",void 0);G.__decorate([M.property()],K.prototype,"imageMaxHeight",void 0);G.__decorate([M.property()],K.prototype,"imageRotationSupported",void 0);G.__decorate([M.property()],K.prototype,"imageNormalizationSupported",void 0);G.__decorate([M.property()],K.prototype,"requestUpdate",void 0);G.__decorate([M.property()],K.prototype,"updating",null);return K=G.__decorate([F.subclass("esri.views.2d.layers.support.ExportStrategy")],
K)})},"esri/views/2d/viewStateUtils":function(){define(["exports"],function(E){const G=Math.PI/180;E.getBBox=function(K,I,w,M){const [D,L]=I,[F,T]=M;I=.5*w;K[0]=D-I*F;K[1]=L-I*T;K[2]=D+I*F;K[3]=L+I*T;return K};E.getOuterSize=function(K,I){var w=I.rotation*G;const M=Math.abs(Math.cos(w));w=Math.abs(Math.sin(w));const [D,L]=I.size;K[0]=Math.round(L*w+D*M);K[1]=Math.round(L*M+D*w);return K};Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/imagery/VectorFieldView2D":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../Graphic ../../../../request ../../../../core/HandleOwner ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../../../layers/support/rasterFunctions/rasterProjectionHelper ../../../../layers/support/rasterFunctions/vectorFieldUtils ../../engine/imagery/RasterVFContainer ./ImageryVFStrategy".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P,J,V,Y,W,U){w=function(k){function n(){var u=k.apply(this,arguments)||this;u.attached=!1;u.container=new W.RasterVFContainer;u.type="imageryVF";u._dataParameters={exportParametersVersion:0,bbox:"",symbolTileSize:0,time:""};u._fetchpixels=function(){var a=E._asyncToGenerator(function*(f,c,l,b){const e=yield u._projectFullExtentPromise,{symbolTileSize:g}=u.layer.renderer,{extent:h,width:m,height:q}=Y.snapImageToSymbolTile(f,c,l,g,e);if(M.isSome(e)&&!e.intersects(f))return{extent:h,
pixelBlock:null};f={bbox:`${h.xmin}, ${h.ymin}, ${h.xmax}, ${h.ymax}`,exportParametersVersion:u.layer.exportImageServiceParameters.version,symbolTileSize:g,time:JSON.stringify(u.timeExtent||"")};if(u._canReuseVectorFieldData(f)&&(c=u.getPixelData(),M.isSome(c)&&`${c.extent.xmin}, ${c.extent.ymin}, ${c.extent.xmax}, ${c.extent.ymax}`===f.bbox))return c;({pixelData:b}=yield u.layer.fetchImage(h,m,q,{timeExtent:u.timeExtent,requestAsImageElement:!1,signal:b}));u._dataParameters=f;b=b?.pixelBlock;if(M.isNone(b))return{extent:h,
pixelBlock:null};b="vector-uv"===u.layer.rasterInfo.dataType?M.unwrap(Y.convertVectorFieldData(b,"vector-uv")):b;return{extent:h,pixelBlock:b}});return function(f,c,l,b){return a.apply(this,arguments)}}();return u}E._inheritsLoose(n,k);var B=n.prototype;B.attach=function(){this._projectFullExtentPromise=this._getProjectedFullExtent(this.view.spatialReference);this._strategy=new U({container:this.container,fetchPixels:this._fetchpixels});this.handles.add(D.watch(()=>this.layer.renderer,u=>this._updateSymbolizerParams(u),
D.syncAndInitial),"attach")};B.detach=function(){this._strategy.destroy();this.container.children.forEach(u=>u.destroy());this.container.removeAllChildren();this.handles.remove("attach");this._strategy=this.container=this._projectFullExtentPromise=null};B.getPixelData=function(){const u=this.container.children[0]?.rawPixelData;if(this.updating||!u)return null;const {extent:a,pixelBlock:f}=u;return{extent:a,pixelBlock:f}};B.hitTest=function(u){return new K({attributes:{},geometry:u.clone(),layer:this.layer})};
B.update=function(u){this._strategy.update(u,this._symbolizerParams)};B.redraw=function(){const {renderer:u}=this.layer;u&&(this._updateSymbolizerParams(u),this._strategy.redraw(this._symbolizerParams))};B._canReuseVectorFieldData=function(u){const a=this._dataParameters.time===u.time,f=this._dataParameters.symbolTileSize===u.symbolTileSize,c=this._dataParameters.bbox===u.bbox;return this._dataParameters.exportParametersVersion===u.exportParametersVersion&&a&&f&&c};B._getProjectedFullExtent=function(){var u=
E._asyncToGenerator(function*(a){try{return yield V.projectExtent(this.layer.fullExtent,a)}catch(f){try{const c=(yield I(this.layer.url,{query:{option:"footprints",outSR:a.wkid||JSON.stringify(a.toJSON()),f:"json"}})).data.featureCollection.layers[0].layerDefinition.extent;return c?J.fromJSON(c):null}catch{return null}}});return function(a){return u.apply(this,arguments)}}();B._updateSymbolizerParams=function(u){"vector-field"===u.type&&(this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null}))};
E._createClass(n,[{key:"updating",get:function(){return!this.attached||this._strategy.updating}}]);return n}(w.HandleOwner);G.__decorate([L.property()],w.prototype,"attached",void 0);G.__decorate([L.property()],w.prototype,"container",void 0);G.__decorate([L.property()],w.prototype,"layer",void 0);G.__decorate([L.property()],w.prototype,"timeExtent",void 0);G.__decorate([L.property()],w.prototype,"type",void 0);G.__decorate([L.property()],w.prototype,"view",void 0);G.__decorate([L.property()],w.prototype,
"updating",null);return w=G.__decorate([P.subclass("esri.views.2d.layers.imagery.VectorFieldView2D")],w)})},"esri/layers/support/rasterFunctions/rasterProjectionHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/maybe ../../../core/unitUtils ../../../chunks/pe ../../../geometry/projection ../../../geometry/Extent ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/SpatialReference".split(" "),function(E,
G,K,I,w,M,D,L,F,T,P,J){function V(d,p,A){return!L.canProjectWithoutEngine(d,p,A)}function Y(d,p,A){if((d=V(d,p,A))&&!L.isLoaded())throw new I("rasterprojectionhelper-project","projection engine is not loaded");return d}function W(){W=G._asyncToGenerator(function*(){L.isLoaded()||(yield L.load())});return W.apply(this,arguments)}function U(d,p,A,v=null){const H=d.spatialReference;if(H.equals(p))return d;Y(H,p,v);A=A.center;A=new F({xmin:A.x-d.x/2,xmax:A.x+d.x/2,ymin:A.y-d.y/2,ymax:A.y+d.y/2,spatialReference:H});
v=L.project(A,p,v);A=y(p);w.isNone(v)||w.isSome(A)&&v.width>=A?(p=M.getMetersPerUnitForSR(H)/M.getMetersPerUnitForSR(p),d={x:d.x*p,y:d.y*p}):d={x:v.width,y:v.height};return d}function k(d,p=.01){return M.getMetersPerUnitForSR(d)?p/M.getMetersPerUnitForSR(d):0}function n(d,p,A=null,v=!0){const H=d.spatialReference;if(H.equals(p))return d;Y(H,p,A);A=L.project(d,p,A);if(!v||!A)return A;B([d],[A],H,p);return A}function B(d,p,A,v){const H=t(A,!0),z=t(v,!0);A=k(A,500);v=k(v,500);if(A&&w.isSome(H)&&w.isSome(z))for(let R=
0;R<d.length;R++){const S=p[R];if(!S)continue;const {x:N}=d[R],{x:ca}=S;ca>=z[1]-v&&Math.abs(N-H[0])<A?S.x-=z[1]-z[0]:ca<=z[0]+v&&Math.abs(N-H[1])<A&&(S.x+=z[1]-z[0])}}function u(d){const {inSR:p,outSR:A,datumTransformation:v,preferPE:H}=d;if(p.equals(A))return{points:d}=b(d,null),d;if(p.isWebMercator&&A.isWGS84||p.isWGS84&&A.isWebMercator){const {cols:ca,rows:ba,xres:ea,yres:ia,usePixelCenter:fa,inSR:ja,outSR:ka}=d;let {xmin:la,ymax:ha}=d;fa&&(la+=ea/2,ha-=ia/2);d=[];var z=[],R=Math.max(ca,ba);for(var S=
0;S<R;S++){var N=L.project(new T({x:la+ea*Math.min(ca,S),y:ha-ia*Math.min(ba,S),spatialReference:ja}),ka);S<=ca&&d.push(N.x);S<=ba&&z.push(N.y)}R=[];for(S=0;S<ca;S++)for(N=0;N<ba;N++)R.push([d[S],z[N]]);return R}if(Y(p,A,v)&&H){if(p.isGeographic)return f(d);z=c(p);if(w.isSome(z))return f(d)}return a(d)}function a(d){var {points:p}=b(d,null);const {inSR:A,outSR:v,datumTransformation:H}=d;d=p.map(z=>new T(z[0],z[1],A));p=L.project(d,v,H);H&&B(d,p,A,v);return p.map(z=>z?[z.x,z.y]:[NaN,NaN])}function f(d){const {inSR:p,
outSR:A,datumTransformation:v}=d;var H=c(p);const {points:z,mask:R}=b(d,H);p.isGeographic||(d=p.wkid?D.PeFactory.coordsys(p.wkid):D.PeFactory.fromString(p.isGeographic?D.PeDefs.PE_TYPE_GEOGCS:D.PeDefs.PE_TYPE_PROJCS,p.wkt),D.PeCSTransformations.projToGeog(d,z.length,z));if(w.isSome(v)&&v.steps.length){var S;A.isGeographic&&(S=z.map(([N])=>179.9955<N?1:-179.9955>N?-1:0));v.steps.forEach(N=>{const ca=N.wkid?D.PeFactory.geogtran(N.wkid):D.PeFactory.fromString(D.PeDefs.PE_TYPE_GEOGTRAN,N.wkt);D.PeGTTransformations.geogToGeog(ca,
z.length,z,null,N.isInverse?D.PeDefs.PE_TRANSFORM_2_TO_1:D.PeDefs.PE_TRANSFORM_1_TO_2)});if(S)for(d=0;d<z.length;d++){H=S[d];const N=z[d][0],ca=179.9955<N?1:-179.9955>N?-1:0;H&&ca&&H!==ca&&(z[d][0]=0<H?N+360:N-360)}}A.isGeographic||(S=c(A,!0),S=w.isSome(S)&&S.isEnvelope?[S.bbox[1],S.bbox[3]]:[-90,90],e(z,S),S=A.wkid?D.PeFactory.coordsys(A.wkid):D.PeFactory.fromString(A.isGeographic?D.PeDefs.PE_TYPE_GEOGCS:D.PeDefs.PE_TYPE_PROJCS,A.wkt),D.PeCSTransformations.geogToProj(S,z.length,z));S=z;if(R&&z.length!==
R.length){S=[];for(let N=0,ca=0;N<R.length;N++)R[N]?S.push(z[ca++]):S.push([NaN,NaN])}return S}function c(d,p=!1){var A=d.wkid||d.wkt;if(!A||d.isGeographic)return null;A=String(A);if(Z.has(A))return A=Z.get(A),p?A?.gcs:A?.pcs;var v=d.wkid?D.PeFactory.coordsys(d.wkid):D.PeFactory.fromString(d.isGeographic?D.PeDefs.PE_TYPE_GEOGCS:D.PeDefs.PE_TYPE_PROJCS,d.wkt);d=k(d,1E-4);d=l(v,d);v=l(v,0,!0);Z.set(A,{pcs:d,gcs:v});return p?v:d}function l(d,p=0,A=!1){var v=D.PePCSInfo.generate(d),H=A?d.horizonGcsGenerate():
d.horizonPcsGenerate();if(!v||!H?.length)return null;d=!1;var z=H.find(ba=>1===ba.getInclusive()&&1===ba.getKind());if(!z){z=H.find(ba=>1===ba.getInclusive()&&0===ba.getKind());if(!z)return null;d=!0}A=A?0:(2===v.getNorthPoleLocation()?1:0)|(2===v.getSouthPoleLocation()?2:0);v=v.isPannableRectangle();z=z.getCoord();if(d)return{isEnvelope:d,isPannable:v,vertices:z,coef:null,bbox:[z[0][0]-p,z[0][1]-p,z[1][0]+p,z[1][1]+p],poleLocation:A};p=0;d=[];let [R,S]=z[0],[N,ca]=z[0];for(let ba=0,ea=z.length;ba<
ea;ba++){p++;p===ea&&(p=0);const [ia,fa]=z[ba],[ja,ka]=z[p];if(ka===fa)d.push([ia,ja,fa,ka,2]);else{H=(ja-ia)/(ka-fa||1E-4);const la=ia-H*fa;fa<ka?d.push([H,la,fa,ka,0]):d.push([H,la,ka,fa,1])}R=R<ia?R:ia;S=S<fa?S:fa;N=N>ia?N:ia;ca=ca>fa?ca:fa}return{isEnvelope:!1,isPannable:v,vertices:z,coef:d,bbox:[R,S,N,ca],poleLocation:A}}function b(d,p){const A=[],{cols:v,rows:H,xres:z,yres:R,usePixelCenter:S}=d;let {xmin:N,ymax:ca}=d;S&&(N+=z/2,ca-=R/2);if(w.isNone(p)){for(d=0;d<v;d++)for(p=0;p<H;p++)A.push([N+
z*d,ca-R*p]);return{points:A}}d=new Uint8Array(v*H);if(p.isEnvelope){const {bbox:[la,ha,na,pa]}=p;for(let qa=0,ra=0;qa<v;qa++){var ba=N+z*qa,ea=p.isPannable||ba>=la&&ba<=na;for(var ia=0;ia<H;ia++,ra++){var fa=ca-R*ia;ea&&fa>=ha&&fa<=pa&&(A.push([ba,fa]),d[ra]=1)}}return{points:A,mask:d}}ba=p.coef;p=[];for(ea=0;ea<H;ea++){var ja=ca-R*ea;ia=[];fa=[];for(var ka=0;ka<ba.length;ka++){const [la,ha,na,pa,qa]=ba[ka];ja===na&&na===pa?(ia.push(la),ia.push(ha),fa.push(2),fa.push(2)):ja>=na&&ja<=pa&&(ia.push(la*
ja+ha),fa.push(qa))}ja=ia;if(2<ia.length){ka=2===fa[0]?0:fa[0];let la=ia[0];ja=[];for(let ha=1;ha<fa.length;ha++)if(2!==fa[ha]||ha===fa.length-1)fa[ha]!==ka&&(ja.push(0===ka?Math.min(la,ia[ha-1]):Math.max(la,ia[ha-1])),ka=fa[ha],la=ia[ha]),ha===fa.length-1&&ja.push(0===fa[ha]?Math.min(la,ia[ha]):Math.max(la,ia[ha]));ja.sort((ha,na)=>ha-na)}else ia[0]>ia[1]&&(ja=[ia[1],ia[0]]);p.push(ja)}for(let la=0,ha=0;la<v;la++)for(ba=N+z*la,ea=0;ea<H;ea++,ha++)if(ia=ca-R*ea,fa=p[ea],2===fa.length)ba>=fa[0]&&ba<=
fa[1]&&(A.push([ba,ia]),d[ha]=1);else if(2<fa.length){ja=!1;for(ka=0;ka<fa.length;ka+=2)if(ba>=fa[ka]&&ba<=fa[ka+1]){ja=!0;break}ja&&(A.push([ba,ia]),d[ha]=1)}return{points:A,mask:d}}function e(d,p){const [A,v]=p;for(p=0;p<d.length;p++){const H=d[p][1];if(H<A||H>v)d[p]=[NaN,NaN]}}function g(d){const p=y(d[0].spatialReference);if(2>d.length||w.isNone(p))return d[0];let {xmin:A,xmax:v,ymin:H,ymax:z}=d[0];for(let R=1;R<d.length;R++){const S=d[R];v=S.xmax+p*R;H=Math.min(H,S.ymin);z=Math.max(z,S.ymax)}return new F({xmin:A,
xmax:v,ymin:H,ymax:z,spatialReference:d[0].spatialReference})}function h(d,p,A=null,v=!0){var H=d.spatialReference;if(H.equals(p))return d;var z=x(d);const R=y(H,!0);var S=y(p);if(0===z||w.isNone(R)||w.isNone(S))return z=q(d,p,A,v),w.isNone(R)&&w.isSome(S)&&Math.abs(z.width-S)<k(p)&&L.isLoaded()&&(H=c(H),w.isSome(H)&&H.poleLocation===Q.None&&d.width<(H.bbox[2]-H.bbox[0])/2)?m(d,p)||z:z;S=d.clone().normalize();if(1===S.length&&d.xmax<R&&d.xmax-R/2>k(H)){const {xmin:N,xmax:ca}=d;for(let ba=0;ba<=z;ba++)S[ba]=
new F({xmin:0===ba?N:-R/2,xmax:ba===z?ca-R*ba:R/2,ymin:d.ymin,ymax:d.ymax,spatialReference:H})}d=S.map(N=>q(N,p,A,v));return g(d.filter(w.isSome))}function m(d,p){const A=y(p);if(w.isNone(A))return null;let {xmin:v,ymin:H,xmax:z,ymax:R}=d;var S=d.spatialReference;d=new P({spatialReference:S,rings:[[[v,H],[z,H],[z,R],[v,R],[v,H]]]});d=L.project(d,p);if(2!==d.rings.length||!d.rings[0].length||!d.rings[1].length)return null;({rings:d}=d);S=k(S);p=new F({spatialReference:p});for(let N=0;2>N;N++){v=z=
d[N][0][0];H=R=d[N][0][1];for(let ca=0;ca<d[N].length;ca++)v=v>d[N][ca][0]?d[N][ca][0]:v,z=z<d[N][ca][0]?d[N][ca][0]:z,H=H>d[N][ca][1]?d[N][ca][1]:H,R=R<d[N][ca][1]?d[N][ca][1]:R;if(0===N)p.ymin=H,p.ymax=R,p.xmin=v,p.xmax=z;else if(p.ymin=Math.min(p.ymin,H),p.ymax=Math.max(p.ymax,R),Math.abs(z-A/2)<S)p.xmin=v,p.xmax+=A;else if(Math.abs(v+A/2)<S)p.xmax=z+A;else return null}return p}function q(d,p,A=null,v=!0,H=!0){const z=d.spatialReference;if(z.equals(p)||!p)return d;Y(z,p,A);const R=L.project(d,
p,A);if(H&&p.isWebMercator&&R&&(R.ymax=Math.min(2.0037508342787E7,R.ymax),R.ymin=Math.max(-2.0037508342787E7,R.ymin),R.ymin>=R.ymax))return null;if(!v||!R)return R;var S=t(z,!0);v=t(p,!0);if(w.isNone(S)||w.isNone(v))return R;H=k(z,.001);const N=k(z,500);var ca=k(p,.001);if(Math.abs(R.xmin-v[0])<ca&&Math.abs(R.xmax-v[1])<ca){ca=Math.abs(d.xmin-S[0]);S=Math.abs(S[1]-d.xmax);if(ca<H&&S>N){R.xmin=v[0];var ba=[];ba.push(new T(d.xmax,d.ymin,z));ba.push(new T(d.xmax,(d.ymin+d.ymax)/2,z));ba.push(new T(d.xmax,
d.ymax,z));ba=ba.map(ea=>n(ea,p,A)).filter(ea=>!isNaN(ea?.x)).map(ea=>ea.x);R.xmax=Math.max.apply(null,ba)}S<H&&ca>N&&(R.xmax=v[1],v=[],v.push(new T(d.xmin,d.ymin,z)),v.push(new T(d.xmin,(d.ymin+d.ymax)/2,z)),v.push(new T(d.xmin,d.ymax,z)),d=v.map(ea=>n(ea,p,A)).filter(ea=>!isNaN(ea?.x)).map(ea=>ea.x),R.xmin=Math.min.apply(null,d))}else d=k(p,.001),Math.abs(R.xmin-v[0])<d&&(R.xmin=v[0]),Math.abs(R.xmax-v[1])<d&&(R.xmax=v[1]);return R}function y(d,p=!1){return d?d.isWebMercator?2*(p?2.0037508342787E7:
2.0037508342788905E7):d.wkid&&d.isGeographic?360:2*X[d.wkid]||null:null}function t(d,p=!1){if(d.isGeographic)return[-180,180];d=y(d,p);return w.isSome(d)?[-d/2,d/2]:null}function r(d,p,A,v){d=(d-p)/A;0!==d-Math.floor(d)?d=Math.floor(d):v&&--d;return d}function x(d,p=!1){var A=y(d.spatialReference);if(w.isNone(A))return 0;const v=p?0:-(A/2),H=k(d.spatialReference),z=!p&&Math.abs(d.xmin+A/2)<H?-A/2:d.xmin;d=r(!p&&Math.abs(d.xmax-A/2)<H?A/2:d.xmax,v,A,!0);A=r(z,v,A,!1);return d-A}function C(d){const {projectedExtent:p,
srcBufferExtent:A,pixelSize:v,datumTransformation:H,rasterTransform:z}=d;var R=p.spatialReference;const S=A.spatialReference;var N=Y(R,S);const {xmin:ca,ymin:ba,xmax:ea,ymax:ia}=p,fa=y(S),ja=w.isSome(fa)&&(d.hasWrapAround||"gcs-shift"===z?.type);d=d.spacing||[32,32];var ka=d[0]*v.x,la=d[1]*v.y;const ha=1===d[0],na=Math.ceil((ea-ca)/ka-.1/d[0])+(ha?0:1),pa=Math.ceil((ia-ba)/la-.1/d[1])+(ha?0:1);ka=u({cols:na,rows:pa,xmin:ca,ymax:ia,xres:ka,yres:la,inSR:R,outSR:S,datumTransformation:H,preferPE:4>=d[0],
usePixelCenter:ha});la=[];let qa,ra=0;const ua=ha?-1:NaN,{xmin:va,xmax:oa,ymax:wa,width:xa,height:ya}=A,za=k(S,500),Aa=w.isSome(fa)&&0<va&&oa>fa/2;var sa=!1;N&&(sa=c(R),sa=w.isSome(sa)&&0<sa.poleLocation);for(R=0;R<na;R++){N=[];for(let ta=0;ta<pa;ta++){var ma=ka[R*pa+ta];ja&&ma[0]>oa&&ma[0]>fa/2-za?ma[0]-=fa:ja&&0===R&&0>ma[0]&&Aa&&!z&&(ma[0]+=fa);!ma||isNaN(ma[0])||isNaN(ma[1])?(la.push(ua),la.push(ua),N.push(null),ra++):(z&&(ma=z.inverseTransform(new T({x:ma[0],y:ma[1],spatialReference:S})),ma=
[ma.x,ma.y]),N.push(ma),0<R&&ja&&qa[ta]&&ma[0]<qa[ta][0]&&(ma[0]+=fa,sa&&ma[0]>oa&&ma[0]>fa&&(ma[0]-=fa)),la.push((ma[0]-va)/xa),la.push((wa-ma[1])/ya))}qa=N}return{offsets:la,error:null,coefficients:null,outofBoundPointCount:ra,spacing:d,size:ha?[na,pa]:[na-1,pa-1]}}function O(d,p,A){const {cols:v,rows:H}=p;p=new Float32Array((v-1)*(H-1)*12);const z=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),R=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let ia=0;ia<v-1;ia++){for(var S=0;S<H-1;S++){var N=ia*H*2+
2*S,ca=d[N];const fa=d[N+1];var ba=d[N+2],ea=d[N+3];N+=2*H;const ja=d[N],ka=d[N+1],la=d[N+2];N=d[N+3];let ha=0,na=12*(S*(v-1)+ia);for(let pa=0;3>pa;pa++)p[na++]=z[ha++]*ca+z[ha++]*ba+z[ha++]*la;ha=0;for(ba=0;3>ba;ba++)p[na++]=z[ha++]*fa+z[ha++]*ea+z[ha++]*N;ha=0;for(ea=0;3>ea;ea++)p[na++]=R[ha++]*ca+R[ha++]*ja+R[ha++]*la;ha=0;for(ca=0;3>ca;ca++)p[na++]=R[ha++]*fa+R[ha++]*ka+R[ha++]*N}if(A)for(S=0;S<p.length;S++)isNaN(p[S])&&(p[S]=-1)}return p}var Q;(function(d){d[d.None=0]="None";d[d.North=1]="North";
d[d.South=2]="South";d[d.Both=3]="Both"})(Q||(Q={}));const aa=(d,p,A,v=0)=>{if(1===A[0])return[0,0];var H=1,z=-1,R=1,S=-1;for(var N=0;N<d.length;N+=2)isNaN(d[N])||(H=H>d[N]?d[N]:H,z=z>d[N]?z:d[N],R=R>d[N+1]?d[N+1]:R,S=S>d[N+1]?S:d[N+1]);const {cols:ca,rows:ba}=p;p=(z-H)/ca/A[0];A=(S-R)/ba/A[1];v*=2;R=0;S=!1;H=[0,0];for(z=0;z<ca-3;z++){for(N=0;N<ba-3;N++){var ea=z*ba*2+2*N;const ia=Math.abs(((d[ea]+d[ea+4]+d[ea+4*ba]+d[ea+4*ba+4])/4-d[ea+2*ba+2])/p);ea=Math.abs(((d[ea+1]+d[ea+5]+d[ea+4*ba+1]+d[ea+
4*ba+5])/4-d[ea+2*ba+3])/A);ia+ea>R&&(R=ia+ea,H=[ia,ea]);if(v&&R>v){S=!0;break}}if(S)break}return H},X={3395:2.0037508342789244E7,3410:1.7334193943686873E7,3857:2.0037508342788905E7,3975:1.7367530445161372E7,4087:2.0037508342789244E7,4088:2.0015108787169147E7,6933:1.7367530445161372E7,32662:2.0037508342789244E7,53001:2.001508679602057E7,53002:1.000754339801029E7,53003:2.001508679602057E7,53004:2.001508679602057E7,53016:1.4152803599503474E7,53017:1.7333573624304302E7,53034:2.001508679602057E7,53079:2.0015114352186374E7,
53080:2.0015114352186374E7,54001:2.0037508342789244E7,54002:1.0018754171394624E7,54003:2.0037508342789244E7,54004:2.0037508342789244E7,54016:1.4168658027268292E7,54017:1.736753044516137E7,54034:2.0037508342789244E7,54079:2.0037508342789244E7,54080:2.0037508342789244E7,54100:2.0037508342789244E7,54101:2.0037508342789244E7},Z=new Map,da=new Map;E.computeProjectedScales=function(d,p,A=512,v=!0){const {extent:H,spatialReference:z,pixelSize:R}=d,S=U(new T({x:R.x,y:R.y,spatialReference:z}),p,H);if(null==
S)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const N=(S.x+S.y)/2,ca=M.getMetersPerUnitForSR(p);var ba=N*ca*96*39.37,ea=p.isGeographic?256/A*2.958287637958547E8:256/A*5.91657527591555E8,ia="vector-magdir"===d.dataType||"vector-uv"===d.dataType,fa=h(H,p),ja=Math.min(Math.ceil(Math.log(Math.min(d.width,d.height)/32)/Math.LN2),Math.ceil(Math.log(ea/2/ba)/Math.LN2));!ia&&v&&(p.isGeographic||p.isWebMercator)&&(ia=0>fa.xmin*fa.xmax,!ia&&3>ja&&(v=y(p),w.isSome(v)&&
(ia=2**ja*N*A,A=Math.ceil(v/ia),ia=1===A||2===A&&v/2-fa.xmax<ia)));v=ba;d=Math.min(2,Math.max(1.414,d.storageInfo?.pyramidScalingFactor||2));if(ia)v=ea,ea=p.isGeographic?1.341104507446289E-6:.29858214164761665,ja=96*ea*ca*39.37,p=U(new T({x:ea,y:ea,spatialReference:{wkid:p.isGeographic?4326:3857}}),z,fa),p.x*=v/ja,p.y*=v/ja;else{p={x:R.x,y:R.y};for(fa=0;v<.5005*ea&&fa<ja;)fa++,v*=d,p.x*=d,p.y*=d;1.001>=Math.max(v,ea)/Math.min(v,ea)&&(v=ea)}ea=[v];fa=[{x:p.x,y:p.y}];for(ba=Math.min(70.5310735,ba)/
1.001;v>=ba;)v/=d,p.x/=d,p.y/=d,ea.push(v),fa.push({x:p.x,y:p.y});return{projectedPixelSize:S,scales:ea,srcResolutions:fa,isCustomTilingScheme:!ia}};E.defaultGridSpacing=32;E.defaultProjectionToleranceInPixels=4;E.getDefaultDatumTransformationForDataset=function(d,p,A){return Y(d.spatialReference,p)?A?L.getTransformation(p,d.spatialReference,d):L.getTransformation(d.spatialReference,p,d):null};E.getProjectedGridPoints=u;E.getProjectionOffsetGrid=function(d){var p=d.isAdaptive&&null==d.spacing;let A=
d.spacing||[32,32],v=C(d);var H={cols:v.size[0]+1,rows:v.size[1]+1};const z=0<v.outofBoundPointCount&&v.outofBoundPointCount<v.offsets.length/2;let R=v.outofBoundPointCount===v.offsets.length/2||p&&z?[0,0]:aa(v.offsets,H,A,4);const S=(R[0]+R[1])/2;var N=d.projectedExtent.spatialReference;const ca=d.srcBufferExtent.spatialReference;p&&(z||4<S)&&(V(N,ca,d.datumTransformation)&&(N.isGeographic||w.isSome(c(N))),A=[4,4],v=C({...d,spacing:A}),H={cols:v.size[0]+1,rows:v.size[1]+1},R=aa(v.offsets,H,A,4));
v.error=R;1<A[0]&&(v.coefficients=O(v.offsets,H,z));!d.includeGCSGrid||N.isGeographic||N.isWebMercator||(ca.isGeographic?v.gcsGrid={offsets:v.offsets,coefficients:v.coefficients,spacing:A}:(p=c(N),w.isSome(p)&&!p.isEnvelope&&(N&&!N.isGeographic&&(p=String(N.wkid||N.wkt),da.has(p)?N=da.get(p):(N=(N.wkid?D.PeFactory.coordsys(N.wkid):D.PeFactory.fromString(D.PeDefs.PE_TYPE_PROJCS,N.wkt)).getGeogcs().getCode(),da.set(p,N)),N=new J({wkid:N})),N=h(d.projectedExtent,N),{offsets:d}=C({...d,srcBufferExtent:N,
spacing:A}),H=O(d,H,z),v.gcsGrid={offsets:d,coefficients:H,spacing:A})));return v};E.getRasterDatasetAlignmentInfo=function(d){const p=d.storageInfo.origin.x;var A=y(d.spatialReference,!0);if(w.isNone(A))return{originX:p,halfWorldWidth:null,pyramidsInfo:null};const v=A/2,{nativePixelSize:H,storageInfo:z,extent:R}=d,{maximumPyramidLevel:S,blockWidth:N,pyramidScalingFactor:ca}=z;let ba=H.x;const ea=[];d=w.isSome(d.transform)&&"gcs-shift"===d.transform.type;const ia=p+(d?0:v);A=d?A-p:v-p;for(let fa=
0;fa<=S;fa++){const ja=(R.xmax-p)/ba/N,ka=A/ba/N;ea.push({resolutionX:ba,blockWidth:N,datsetColumnCount:0===ja-Math.floor(ja)?ja:Math.ceil(ja),worldColumnCountFromOrigin:0===ka-Math.floor(ka)?ka:Math.ceil(ka),leftMargin:Math.round(ia/ba)%N,rightPadding:(N-Math.round(A/ba)%N)%N,originColumnOffset:Math.floor(ia/ba/N)});ba*=ca}return{originX:p,halfWorldWidth:v,pyramidsInfo:ea,hasGCSSShiftTransform:d}};E.getWorldWidth=y;E.getWorldWrapCount=x;E.load=function(){return W.apply(this,arguments)};E.minimumGridSpacing=
4;E.projectExtent=h;E.projectPoint=n;E.projectResolution=U;E.requirePE=V;E.snapExtent=function(d){d=d.clone().normalize();return 1===d.length?d[0]:g(d)};E.snapPyramid=function(d,p,A){const {storageInfo:v,pixelSize:H}=p;var z=0;let R=!1;var {pyramidResolutions:S}=v;if(w.isSome(S)&&S.length){d=(d.x+d.y)/2;var N=S[S.length-1];N=(N.x+N.y)/2;var ca=(H.x+H.y)/2;if(d<=ca)z=0;else if(d>=N)z=S.length,R=8<d/N;else{N=ca;for(let ba=1;ba<=S.length;ba++){ca=(S[ba-1].x+S[ba-1].y)/2;if(d<=ca){d===ca?z=ba:"down"===
A?(z=ba-1,R=8<d/N):z="up"===A?ba:d-N>ca-d||2<d/N?ba:ba-1;break}N=ca}}A=0===z?H:S[z-1];R&&(S=Math.min(A.x,A.y),d=M.getMetersPerUnitForSR(p.spatialReference),19567<S*d&&(R=!1));return{pyramidLevel:z,pyramidResolution:new T({x:A.x,y:A.y,spatialReference:p.spatialReference}),excessiveReading:R}}z=Math.log(d.x/H.x)/Math.LN2;d=Math.log(d.y/H.y)/Math.LN2;S=p.storageInfo.maximumPyramidLevel||0;z="down"===A?Math.floor(Math.min(z,d)):"up"===A?Math.ceil(Math.max(z,d)):Math.round((z+d)/2);0>z?z=0:z>S&&(R=z>S+
3,z=S);A=2**z;p=new T({x:A*p.nativePixelSize.x,y:A*p.nativePixelSize.y,spatialReference:p.spatialReference});return{pyramidLevel:z,pyramidResolution:p,excessiveReading:R}};Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/rasterFunctions/vectorFieldUtils":function(){define(["exports","../../../core/jsonMap","../../../core/maybe","../PixelBlock","./pixelUtils"],function(E,G,K,I,w){function M(b,e){return k.get(b)/k.get(e)||1}function D(b,e="geographic"){const [g,h]=
b;b=Math.sqrt(g*g+h*h);let m=Math.atan2(h,g)*n;m=(360+m)%360;"geographic"===e&&(m=(450-m)%360);return[b,m]}function L(b,e="geographic"){let g=b[1];"geographic"===e&&(g=(450-g)%360);g%=360;b=b[0];return[b*Math.cos(g/n),b*Math.sin(g/n)]}function F(b,e,g="geographic",h=1){if(!w.isValidPixelBlock(b))return b;const {pixels:m,width:q,height:y}=b;var t=q*y;const r=m[0],x=m[1],C=b.pixelType.startsWith("f")?b.pixelType:"f32",O=I.createEmptyBand(C,t);t=I.createEmptyBand(C,t);let Q=0;for(let aa=0;aa<y;aa++)for(let X=
0;X<q;X++)"vector-uv"===e?([O[Q],t[Q]]=D([r[Q],x[Q]],g),O[Q]*=h):([O[Q],t[Q]]=L([r[Q],x[Q]],g),O[Q]*=h,t[Q]*=h),Q++;b=new I({pixelType:C,width:b.width,height:b.height,mask:b.mask,validPixelCount:b.validPixelCount,maskIsAlpha:b.maskIsAlpha,pixels:[O,t]});b.updateStatistics();return b}function T(b=0,e=0,g=Math.PI,h=!0){h&&(g=(2*Math.PI-g)%(2*Math.PI));h=h?-1:1;const m=-7*h,q=-2*h,y=-16*h,[t,r]=J(0,e+13*h,g,21.75),[x,C]=J(b-5.5,e+m,g,21.75),[O,Q]=J(b+5.5,e+m,g,21.75),[aa,X]=J(b-1.5,e+q,g,21.75),[Z,da]=
J(b+1.5,e+q,g,21.75),[d,p]=J(b-1.5,e+y,g,21.75),[A,v]=J(b+1.5,e+y,g,21.75);return[t,r,x,C,aa,X,Z,da,O,Q,d,p,A,v]}function P(b=0,e=Math.PI,g=!0){g&&(e=(2*Math.PI-e)%(2*Math.PI));var h=g?-1:1,m=5*h;const q=20*h,y=25*h;h*=2;const t=g?1:-1;g=5*t;let [r,x]=[0+g,0-q],[C,O]=[r+2*t,x],[Q,aa]=[C-0*t,O+h],[X,Z]=[0-g,0-y],[da,d]=[X+0*t,Z-h],p=Math.ceil(b/5),A=Math.floor(p/10);p-=8*A;b=[];const v=[];for(let ia=0;ia<p/2;ia++,A--){0>=A&&1===p%2&&ia===(p-1)/2&&(X=0,da=X+0*t,Z=(Z+x)/2,d=Z-h);const [fa,ja]=J(X,Z,
e,45);if(0<A){const [ka,la]=J(C,Z,e,45),[ha,na]=J(r,x,e,45);b.push(ka);b.push(la);b.push(fa);b.push(ja);b.push(ha);b.push(na)}else{const [ka,la]=J(C,O,e,45),[ha,na]=J(Q,aa,e,45),[pa,qa]=J(da,d,e,45);v.push(fa);v.push(ja);v.push(pa);v.push(qa);v.push(ha);v.push(na);v.push(ka);v.push(la)}Z+=m;x+=m;O+=m;aa+=m;d+=m}const [H,z]=J(0+g,0+q,e,45);m=7*t;const [R,S]=J(0+m,0+q,e,45),[N,ca]=J(0+g,0-y,e,45),[ba,ea]=J(0+m,0-y,e,45);return{pennants:b,barbs:v,shaft:[H,z,R,S,N,ca,ba,ea]}}function J(b,e,g,h=1){return[Math.sqrt(b*
b+e*e)/h,(2*Math.PI+(2*Math.PI+Math.atan2(e,b))%(2*Math.PI)-g)%(2*Math.PI)]}function V(b,e,g,h){g=M(h||"knots",g);for(h=1;h<e.length;h++)if(h===e.length-1){if(b<e[h]*g)break}else if(b<=e[h]*g)break;return Math.min(h-1,e.length-2)}function Y(b,e,g,h,m){let q=0;switch(e){case "beaufort_kn":q=V(b,a,"knots",g);break;case "beaufort_km":q=V(b,a,"kilometer-per-hour",g);break;case "beaufort_ft":q=V(b,a,"feet-per-second",g);break;case "beaufort_m":q=V(b,a,"meter-per-second",g);break;case "classified_arrow":q=
V(b,m??[],h,g);break;case "ocean_current_m":q=V(b,f,"meter-per-second",g);break;case "ocean_current_kn":q=V(b,c,"knots",g)}return q}function W(b,e){const {style:g,inputUnit:h,outputUnit:m,breakValues:q}=e,y=B.fromJSON(h),t=B.fromJSON(m);let r=0,x=0;const {width:C,height:O,mask:Q}=b,aa=b.pixels[0];b=b.pixels[1];var X=K.isSome(Q)?Q.filter(d=>0<d).length:C*O;const Z=new Float32Array(42*X);X=new Uint32Array(15*X);e=e.invertDirection?T(0,0,0,!1):u;for(let d=0;d<O;d++)for(let p=0;p<C;p++){var da=d*C+p;
if(!Q||Q[d*C+p]){const A=(b[da]+360)%360/180*Math.PI,v=Y(aa[da],g,y,t,q);for(let H=0;H<e.length;H+=2)Z[r++]=(p+.5)/C,Z[r++]=(d+.5)/O,Z[r++]=e[H],Z[r++]=e[H+1]+A,Z[r++]=v,Z[r++]=aa[da];da=7*(r/42-1);X[x++]=da;X[x++]=da+1;X[x++]=da+2;X[x++]=da+0;X[x++]=da+4;X[x++]=da+3;X[x++]=da+0;X[x++]=da+2;X[x++]=da+3;X[x++]=da+2;X[x++]=da+5;X[x++]=da+3;X[x++]=da+5;X[x++]=da+6;X[x++]=da+3}}return{vertexData:Z,indexData:X}}function U(b,e){let g=0,h=0;const {width:m,height:q,mask:y}=b;b=b.pixels[0];const t=[],r=[];
var x=B.fromJSON(e.inputUnit);x=M(x,"knots");e="wind_speed"===e.style?5:Number.MAX_VALUE;for(let O=0;O<q;O++)for(let Q=0;Q<m;Q++){var C=b[O*m+Q]*x;if((!y||y[O*m+Q])&&C<e){for(let aa=0;4>aa;aa++)t[g++]=(Q+.5)/m,t[g++]=(O+.5)/q,t[g++]=2>aa?-.5:.5,t[g++]=0===aa%2?-.5:.5,t[g++]=0,t[g++]=C;C=4*(g/24-1);r[h++]=C;r[h++]=C+1;r[h++]=C+2;r[h++]=C+1;r[h++]=C+2;r[h++]=C+3}}return{vertexData:new Float32Array(t),indexData:new Uint32Array(r)}}const k=new Map;k.set("meter-per-second",1);k.set("kilometer-per-hour",
.277778);k.set("knots",.514444);k.set("feet-per-second",.3048);k.set("mile-per-hour",.44704);const n=180/Math.PI,B=new G.JSONMap({esriMetersPerSecond:"meter-per-second",esriKilometersPerHour:"kilometer-per-hour",esriKnots:"knots",esriFeetPerSecond:"feet-per-second",esriMilesPerHour:"mile-per-hour"}),u=T(0,0,0),a=[0,1,3,6,10,16,21,27,33,40,47,55,63],f=[0,.5,1,1.5,2],c=[0,.25,.5,1,1.5,2,2.5,3,3.5,4],l=[];E.convertToLocalDirections=function(b,e,g,h="geographic"){if(!w.isValidPixelBlock(b)||K.isNone(g))return b;
b="vector-magdir"===e?b.clone():K.unwrap(F(b,e));const m=b.pixels[1];for(let q=0;q<m.length;q++)m[q]="geographic"===h?(m[q]+g[q]+270)%360:(m[q]+360-g[q])%360;return"vector-magdir"===e?b:F(b,"vector-magdir")};E.convertVectorFieldData=F;E.convertVectorFieldUnit=function(b,e,g=1){if(1===g||!w.isValidPixelBlock(b))return b;b=b.clone();const {pixels:h,width:m,height:q}=b,y=h[0],t=h[1];let r=0;for(let x=0;x<q;x++)for(let C=0;C<m;C++)"vector-uv"===e?(y[r]*=g,t[r]*=g):y[r]*=g,r++;b.updateStatistics();return b};
E.createVFMesh=function(b,e){if("simple_scalar"===e.style)e=U(b,e);else if("wind_speed"===e.style){if(0===l.length)for(var g=0;30>g;g++)l.push(P(5*g,0,!e.invertDirection));e=B.fromJSON(e.inputUnit);e=M(e,"knots");const {width:y,height:t,mask:r}=b;g=b.pixels[0];b=b.pixels[1];const x=[],C=[];let O=0,Q=0;for(let aa=0;aa<t;aa++)for(let X=0;X<y;X++){var h=aa*y+X,m=g[h]*e;if((!r||r[aa*y+X])&&5<=m){const Z=(b[h]+360)%360/180*Math.PI,{pennants:da,barbs:d,shaft:p}=l[Math.min(Math.floor(m/5),29)];if(0===da.length+
d.length)continue;h=x.length/6;const A=(X+.5)/y,v=(aa+.5)/t;for(var q=0;q<da.length;q+=2)x[O++]=A,x[O++]=v,x[O++]=da[q],x[O++]=da[q+1]+Z,x[O++]=0,x[O++]=m;for(q=0;q<d.length;q+=2)x[O++]=A,x[O++]=v,x[O++]=d[q],x[O++]=d[q+1]+Z,x[O++]=0,x[O++]=m;for(q=0;q<p.length;q+=2)x[O++]=A,x[O++]=v,x[O++]=p[q],x[O++]=p[q+1]+Z,x[O++]=0,x[O++]=m;for(m=0;m<da.length/6;m++)C[Q++]=h,C[Q++]=h+1,C[Q++]=h+2,h+=3;for(m=0;m<d.length/8;m++)C[Q++]=h,C[Q++]=h+1,C[Q++]=h+2,C[Q++]=h+1,C[Q++]=h+2,C[Q++]=h+3,h+=4;C[Q++]=h+0;C[Q++]=
h+1;C[Q++]=h+2;C[Q++]=h+1;C[Q++]=h+3;C[Q++]=h+2;h+=4}}e={vertexData:new Float32Array(x),indexData:new Uint32Array(C)}}else e=W(b,e);return e};E.createVFMeshScalar=U;E.getUnitConversionFactor=M;E.sampleVectorField=function(b,e,g,h=[0,0],m=.5){const {width:q,height:y,mask:t}=b,[r,x]=b.pixels,[C,O]=h;b=Math.round((q-C)/g);h=Math.round((y-O)/g);var Q=b*h;const aa=new Float32Array(Q),X=new Float32Array(Q);Q=new Uint8Array(Q);e="vector-uv"===e;for(let da=0;da<h;da++)for(let d=0;d<b;d++){let p=0;const A=
da*b+d,v=Math.max(0,da*g+O),H=Math.max(0,d*g+C),z=Math.min(y,v+g),R=Math.min(q,H+g);for(let S=v;S<z;S++)for(let N=H;N<R;N++){var Z=S*q+N;if(!t||t[Z]){p++;Z=e?[r[Z],x[Z]]:[r[Z],(360+x[Z])%360];const [ca,ba]=e?Z:L(Z);aa[A]+=ca;X[A]+=ba}}if(p>=(z-v)*(R-H)*(1-m)){Q[A]=1;const [S,N]=D([aa[A]/p,X[A]/p]);aa[A]=S;X[A]=N}else Q[A]=0,aa[A]=0,X[A]=0}g=new I({width:b,height:h,pixels:[aa,X],mask:Q});g.updateStatistics();return g};E.snapImageToSymbolTile=function(b,e,g,h,m){if(K.isNone(m)||!m.spatialReference.equals(b.spatialReference))return{extent:b,
width:Math.round(e/h),height:Math.round(g/h),resolution:b.width/e};const q=m.xmin;m=m.ymax;e=(b.xmax-b.xmin)/e*h;g=(b.ymax-b.ymin)/g*h;b.xmin=q+Math.floor((b.xmin-q)/e)*e;b.xmax=q+Math.ceil((b.xmax-q)/e)*e;b.ymin=m+Math.floor((b.ymin-m)/g)*g;b.ymax=m+Math.ceil((b.ymax-m)/g)*g;return{extent:b,width:Math.round(b.width/e),height:Math.round(b.height/g),resolution:(e+g)/2}};E.unitKebabDict=B;E.uvComponentToVector=D;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/RasterVFContainer":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","./BrushVectorField","../webgl/enums","../webgl/WGLContainer"],function(E,G,K,I,w){w=function(M){function D(){var F=M.apply(this,arguments)||this;F.symbolTypes=["triangle"];return F}G._inheritsLoose(D,M);var L=D.prototype;L.prepareRenderPasses=function(F){const T=F.registerRenderPass({name:"imagery (vf)",brushes:[K],target:()=>this.children,drawPhase:I.WGLDrawPhase.MAP});return[...M.prototype.prepareRenderPasses.call(this,F),T]};L.doRender=function(F){this.visible&&
F.drawPhase===I.WGLDrawPhase.MAP&&this.symbolTypes.forEach(T=>{F.renderPass=T;M.prototype.doRender.call(this,F)})};G._createClass(D,[{key:"requiresDedicatedFBO",get:function(){return!1}}]);return D}(w);E.RasterVFContainer=w;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/imagery/BrushVectorField":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../webgl/brushes/WGLBrush","../../../webgl/enums"],function(E,G,K,I){const w=
new Float32Array([.27058823529411763,.4588235294117647,.7098039215686275,1,.396078431372549,.5372549019607843,.7215686274509804,1,.5176470588235295,.6196078431372549,.7294117647058823,1,.6352941176470588,.7058823529411765,.7411764705882353,1,.7529411764705882,.8,.7450980392156863,1,.8705882352941177,.8901960784313725,.7490196078431373,1,1,1,.7490196078431373,1,1,.8627450980392157,.6313725490196078,1,.9803921568627451,.7254901960784313,.5176470588235295,1,.9607843137254902,.596078431372549,.4117647058823529,
1,.9294117647058824,.4588235294117647,.3176470588235294,1,.9098039215686274,.08235294117647059,.08235294117647059,1]),M={beaufort_ft:w,beaufort_m:w,beaufort_km:w,beaufort_mi:w,beaufort_kn:new Float32Array([.1568627450980392,.5725490196078431,.7803921568627451,1,.34901960784313724,.6352941176470588,.7294117647058823,1,.5058823529411764,.7019607843137254,.6705882352941176,1,.6274509803921569,.7607843137254902,.6078431372549019,1,.7490196078431373,.8313725490196079,.5411764705882353,1,.8549019607843137,
.9019607843137255,.4666666666666667,1,.9803921568627451,.9803921568627451,.39215686274509803,1,.9882352941176471,.8352941176470589,.3254901960784314,1,.9882352941176471,.7019607843137254,.4,1,.9803921568627451,.5529411764705883,.20392156862745098,1,.9686274509803922,.43137254901960786,.16470588235294117,1,.9411764705882353,.2784313725490196,.11372549019607843,1]),classified_arrow:new Float32Array([.2196078431372549,.6588235294117647,0,1,.5450980392156862,1.2117647058823529,0,1,1,1,0,1,1,.5019607843137255,
0,1,1,0,0,1]),ocean_current_m:new Float32Array([.3058823529411765,.10196078431372549,.6,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),ocean_current_kn:new Float32Array([0,0,0,1,0,.1450980392156863,.39215686274509803,1,.3058823529411765,.10196078431372549,.6,1,.592156862745098,0,.39215686274509803,1,.7019607843137254,.10588235294117647,.10196078431372549,1,.6941176470588235,
.3058823529411765,.10196078431372549,1,.792156862745098,.5019607843137255,.10196078431372549,1,.6941176470588235,.7019607843137254,.20392156862745098,1,.6941176470588235,.6941176470588235,.6941176470588235,1]),single_arrow:new Float32Array([0,92/255,230/255,1]),wind_speed:new Float32Array([0,0,0,1])},D=[0,20];return function(L){function F(){var P=L.apply(this,arguments)||this;P._desc={magdir:{vsPath:"raster/magdir",fsPath:"raster/magdir",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])},
scalar:{vsPath:"raster/scalar",fsPath:"raster/scalar",attributes:new Map([["a_pos",0],["a_offset",1],["a_vv",2]])}};return P}E._inheritsLoose(F,L);var T=F.prototype;T.dispose=function(){};T.prepareState=function({context:P}){P.setBlendingEnabled(!0);P.setBlendFunctionSeparate(I.BlendFactor.ONE,I.BlendFactor.ONE_MINUS_SRC_ALPHA,I.BlendFactor.ONE,I.BlendFactor.ONE_MINUS_SRC_ALPHA);P.setColorMask(!0,!0,!0,!0);P.setStencilWriteMask(0);P.setStencilTestEnabled(!0);P.setStencilOp(I.StencilOperation.KEEP,
I.StencilOperation.KEEP,I.StencilOperation.REPLACE)};T.draw=function(P,J){if(!G.isNone(J.source)&&0!==J.source.validPixelCount){var {context:V,timeline:Y}=P;Y.begin(this.name);V.setStencilFunction(I.CompareFunction.EQUAL,J.stencilRef,255);J.updateVectorFieldVAO(P);if("scalar"===P.renderPass){var W=J.vaoData.scalar;W&&this._drawScalars(P,J,W.vao,W.elementCount)}else(W=J.vaoData.magdir)&&this._drawTriangles(P,J,W.vao,W.elementCount);Y.end(this.name)}};T._drawTriangles=function(P,J,V,Y){const {context:W,
painter:U,requestRender:k,allowDelayedRender:n}=P,{symbolizerParameters:B}=J;var u=B.dataRange?["dataRange"]:[];"geographic"===B.rotationType&&u.push("rotationGeographic");u=U.materialManager.getProgram(this._desc.magdir,u);if(n&&G.isSome(k)&&!u.compiled)k();else{W.useProgram(u);var {coordScale:a,opacity:f,transforms:c}=J;u.setUniform2fv("u_coordScale",a);u.setUniform1f("u_opacity",f);u.setUniformMatrix3fv("u_dvsMat3",c.dvs);var {style:l,dataRange:b,rotation:e,symbolPercentRange:g}=B;u.setUniform4fv("u_colors",
M[l]||M.single_arrow);u.setUniform2fv("u_dataRange",b||D);u.setUniform1f("u_rotation",e);u.setUniform2fv("u_symbolPercentRange",g);P=this._getSymbolSize(P,J);u.setUniform2fv("u_symbolSize",P);W.bindVAO(V);W.drawElements(I.PrimitiveType.TRIANGLES,Y,I.DataType.UNSIGNED_INT,0)}};T._drawScalars=function(P,J,V,Y){const {context:W,painter:U,requestRender:k,allowDelayedRender:n}=P,{symbolizerParameters:B}=J;var u=[];"wind_speed"===B.style?u.push("innerCircle"):B.dataRange&&u.push("dataRange");"geographic"===
B.rotationType&&u.push("rotationGeographic");u=U.materialManager.getProgram(this._desc.scalar,u);if(n&&G.isSome(k)&&!u.compiled)k();else{W.useProgram(u);var {coordScale:a,opacity:f,transforms:c}=J;u.setUniform2fv("u_coordScale",a);u.setUniform1f("u_opacity",f);u.setUniformMatrix3fv("u_dvsMat3",c.dvs);var {dataRange:l,symbolPercentRange:b}=B;u.setUniform2fv("u_dataRange",l||D);u.setUniform2fv("u_symbolPercentRange",b);P=this._getSymbolSize(P,J);u.setUniform2fv("u_symbolSize",P);W.bindVAO(V);W.drawElements(I.PrimitiveType.TRIANGLES,
Y,I.DataType.UNSIGNED_INT,0)}};T._getSymbolSize=function(P,J){P=J.key?2**(P.displayLevel-J.key.level):J.resolution/P.state.resolution;const {symbolTileSize:V}=J.symbolizerParameters;return[V/(Math.round((J.width-J.offset[0])/V)*V)/P,V/(Math.round((J.height-J.offset[1])/V)*V)/P]};return F}(K)})},"esri/views/2d/layers/imagery/ImageryVFStrategy":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/Extent ../../engine/imagery/RasterVFDisplayObject".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P,J){K=function(V){function Y(U){var k=V.call(this,U)||this;k._loading=null;k.update=M.debounce((n,B)=>k._update(n,B).catch(u=>{M.isAbortError(u)||I.getLogger(k.declaredClass).error(u)}));return k}E._inheritsLoose(Y,V);var W=Y.prototype;W.redraw=function(U){if(this.container.children.length){var k=this.container.children[0];k.symbolizerParameters=U;k.invalidateVAO();this.container.symbolTypes="wind_speed"===U.style?["scalar","triangle"]:"simple_scalar"===U.style?["scalar"]:
["triangle"];this.container.requestRender()}};W._update=function(){var U=E._asyncToGenerator(function*(k,n,B){if(k.stationary){var {extent:u,spatialReference:a}=k.state,f=new P({xmin:u.xmin,ymin:u.ymin,xmax:u.xmax,ymax:u.ymax,spatialReference:a}),[c,l]=k.state.size;this._loading=this.fetchPixels(f,c,l,B);B=yield this._loading;this._addToDisplay(B,n,k.state);this._loading=null}});return function(k,n,B){return U.apply(this,arguments)}}();W._addToDisplay=function(U,k,n){if(w.isNone(U.pixelBlock))this.container.children.forEach(f=>
f.destroy()),this.container.removeAllChildren();else{var {extent:B,pixelBlock:u}=U,a=new J.RasterVFDisplayObject(u);a.offset=[0,0];a.symbolizerParameters=k;a.rawPixelData=U;a.invalidateVAO();a.x=B.xmin;a.y=B.ymax;a.pixelRatio=n.pixelRatio;a.rotation=n.rotation;a.resolution=n.resolution;a.width=u.width*k.symbolTileSize;a.height=u.height*k.symbolTileSize;this.container.children.forEach(f=>f.destroy());this.container.removeAllChildren();this.container.symbolTypes="wind_speed"===k.style?["scalar","triangle"]:
"simple_scalar"===k.style?["scalar"]:["triangle"];this.container.addChild(a)}};E._createClass(Y,[{key:"updating",get:function(){return!!this._loading}}]);return Y}(K);G.__decorate([D.property()],K.prototype,"fetchPixels",void 0);G.__decorate([D.property()],K.prototype,"container",void 0);G.__decorate([D.property()],K.prototype,"_loading",void 0);G.__decorate([D.property()],K.prototype,"updating",null);return K=G.__decorate([T.subclass("esri.views.2d.layers.imagery.ImageryVFStrategy")],K)})},"esri/views/2d/engine/imagery/RasterVFDisplayObject":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../layers/support/rasterFunctions/vectorFieldUtils ../DisplayObject ../webgl/Utils ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P,J,V){K=function(Y){function W(k=null){var n=Y.call(this)||this;n._source=null;n._symbolizerParameters=null;n._vaoInvalidated=!0;n.coordScale=[1,1];n.height=null;n.key=null;n.offset=null;n.stencilRef=0;n.resolution=null;n.pixelRatio=1;n.x=0;n.y=0;n.rotation=0;n.rawPixelData=null;n.vaoData=null;n.width=null;n.source=k;return n}G._inheritsLoose(W,Y);var U=W.prototype;U.destroy=function(){I.isSome(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),
this.vaoData=null)};U.invalidateVAO=function(){!this._vaoInvalidated&&I.isSome(this.vaoData)&&(this.vaoData.magdir?.vao.dispose(),this.vaoData.scalar?.vao.dispose(),this.vaoData=null,this._vaoInvalidated=!0,this.requestRender())};U.updateVectorFieldVAO=function(k){if(this._vaoInvalidated){this._vaoInvalidated=!1;if(I.isSome(this.source)&&I.isNone(this.vaoData)){var {style:n}=this.symbolizerParameters;switch(n){case "beaufort_ft":case "beaufort_km":case "beaufort_kn":case "beaufort_m":case "beaufort_mi":case "classified_arrow":case "ocean_current_kn":case "ocean_current_m":case "single_arrow":n=
L.createVFMesh(this.source,this.symbolizerParameters);this.vaoData={magdir:this._createVectorFieldVAO(k.context,n)};break;case "simple_scalar":n=L.createVFMeshScalar(this.source,this.symbolizerParameters);this.vaoData={scalar:this._createVectorFieldVAO(k.context,n)};break;case "wind_speed":n=L.createVFMesh(this.source,this.symbolizerParameters);n=this._createVectorFieldVAO(k.context,n);const B=L.createVFMeshScalar(this.source,this.symbolizerParameters);k=this._createVectorFieldVAO(k.context,B);this.vaoData=
{magdir:n,scalar:k}}}this.ready();this.requestRender()}};U._createTransforms=function(){return{dvs:M.create()}};U.setTransform=function(k){const n=w.identity(this.transforms.dvs),[B,u]=k.toScreenNoRotation([0,0],[this.x,this.y]);var a=this.resolution/this.pixelRatio/k.resolution;const f=a*this.width;a*=this.height;const c=Math.PI*this.rotation/180;w.translate(n,n,D.fromValues(B,u));w.translate(n,n,D.fromValues(f/2,a/2));w.rotate(n,n,-c);w.translate(n,n,D.fromValues(-f/2,-a/2));w.scaleByVec2(n,n,D.fromValues(f,
a));w.multiply(this.transforms.dvs,k.displayViewMat3,n)};U.onAttach=function(){this.invalidateVAO()};U.onDetach=function(){this.invalidateVAO()};U._createVectorFieldVAO=function(k,n){const {vertexData:B,indexData:u}=n;n=P.BufferObject.createVertex(k,J.Usage.STATIC_DRAW,new Float32Array(B));const a=P.BufferObject.createIndex(k,J.Usage.STATIC_DRAW,new Uint32Array(u)),f=T.createProgramDescriptor("vector-field",{geometry:[{location:0,name:"a_pos",count:2,type:J.DataType.FLOAT,normalized:!1},{location:1,
name:"a_offset",count:2,type:J.DataType.FLOAT,normalized:!1},{location:2,name:"a_vv",count:2,type:J.DataType.FLOAT,normalized:!1}]});return{vao:new V.VertexArrayObject(k,f.attributes,f.bufferLayouts,{geometry:n},a),elementCount:u.length}};G._createClass(W,[{key:"symbolizerParameters",get:function(){return this._symbolizerParameters},set:function(k){JSON.stringify(this._symbolizerParameters)!==JSON.stringify(k)&&(this._symbolizerParameters=k,this.invalidateVAO())}},{key:"source",get:function(){return this._source},
set:function(k){this._source=k;this.invalidateVAO()}}]);return W}(F.DisplayObject);E.RasterVFDisplayObject=K;Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/ImageryLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Error ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/Point ../../layers/support/commonProperties ../../rest/support/Query ./support/popupUtils".split(" "),
function(E,G,K,I,w,M,D,L,F,T,P,J){return V=>{V=function(Y){function W(){var k=Y.apply(this,arguments)||this;k.view=null;return k}E._inheritsLoose(W,Y);var U=W.prototype;U.fetchPopupFeatures=function(){var k=E._asyncToGenerator(function*(n,B){const {layer:u}=this;if(!n)throw new K("imagerylayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:u});var {popupEnabled:a}=u;const f=J.getFetchPopupTemplate(u,B);if(!a||I.isNone(f))throw new K("imagerylayerview:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",
{popupEnabled:a,popupTemplate:f});const c=yield f.getRequiredFields();a=new P;a.timeExtent=this.timeExtent;a.geometry=n;a.outFields=c;a.outSpatialReference=n.spatialReference;const {resolution:l,spatialReference:b}=this.view;n="2d"===this.view.type?new F(l,l,b):new F(.5*l,.5*l,b);const {returnTopmostRaster:e,showNoDataRecords:g}=f.layerOptions||{returnTopmostRaster:!0,showNoDataRecords:!1};B={returnDomainValues:!0,returnTopmostRaster:e,pixelSize:n,showNoDataRecords:g,signal:I.isSome(B)?B.signal:null};
return u.queryVisibleRasters(a,B).then(h=>h)});return function(n,B){return k.apply(this,arguments)}}();U.canResume=function(){return!Y.prototype.canResume.call(this)||this.timeExtent?.isEmpty?!1:!0};return W}(V);G.__decorate([w.property()],V.prototype,"layer",void 0);G.__decorate([w.property()],V.prototype,"suspended",void 0);G.__decorate([w.property(T.combinedViewLayerTimeExtentProperty)],V.prototype,"timeExtent",void 0);G.__decorate([w.property()],V.prototype,"view",void 0);return V=G.__decorate([L.subclass("esri.views.layers.ImageryLayerView")],
V)}})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(E,G,K,I){function w(){w=G._asyncToGenerator(function*(M,D=M.popupTemplate){if(K.isNone(D))return[];const L=yield D.getRequiredFields(M.fieldsIndex);({lastEditInfoEnabled:D}=D);const {objectIdField:F,typeIdField:T,globalIdField:P,relationships:J}=M;if(L.includes("*"))return["*"];D=D?yield I.getFeatureEditFields(M):
[];const V=I.fixFields(M.fieldsIndex,[...L,...D]);T&&V.push(T);V&&F&&M.fieldsIndex?.has(F)&&!V.includes(F)&&V.push(F);V&&P&&M.fieldsIndex?.has(P)&&!V.includes(P)&&V.push(P);J&&J.forEach(Y=>{({keyField:Y}=Y);V&&Y&&M.fieldsIndex?.has(Y)&&!V.includes(Y)&&V.push(Y)});return V});return w.apply(this,arguments)}E.getFetchPopupTemplate=function(M,D){return M.popupTemplate?M.popupTemplate:K.isSome(D)&&D.defaultPopupTemplateEnabled&&K.isSome(M.defaultPopupTemplate)?M.defaultPopupTemplate:null};E.getRequiredFields=
function(M){return w.apply(this,arguments)};Object.defineProperty(E,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),function(E,G,K,I,w,M,D,L,F){return T=>
{T=function(P){function J(){return P.apply(this,arguments)||this}E._inheritsLoose(J,P);J.prototype.initialize=function(){this.handles.add(w.on(()=>this.layer,"refresh",V=>{this.doRefresh(V.dataChanged).catch(Y=>{I.isAbortError(Y)||K.getLogger(this.declaredClass).error(Y)})}),"RefreshableLayerView")};return J}(T);G.__decorate([M.property()],T.prototype,"layer",void 0);return T=G.__decorate([F.subclass("esri.layers.mixins.RefreshableLayerView")],T)}})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../support/GraphicsCollection ../engine/flow/FlowView2D ./LayerView2D ./graphics/GraphicsView2D ./graphics/HighlightGraphicContainer ./imagery/ImageryView2D ./imagery/VectorFieldView2D ../../layers/ImageryLayerView ../../layers/LayerView ../../layers/RefreshableLayerView".split(" "),function(E,
G,K,I,w,M,D,L,F,T,P,J,V,Y,W,U,k,n,B){D=function(u){function a(){var c=u.apply(this,arguments)||this;c._exportImageVersion=-1;c._highlightGraphics=new T.GraphicsCollection;c._highlightView=void 0;c.layer=null;c.subview=null;return c}E._inheritsLoose(a,u);var f=a.prototype;f.hitTest=function(){var c=E._asyncToGenerator(function*(l,b){return this.subview?[{type:"graphic",graphic:this.subview.hitTest(l),layer:this.layer,mapPoint:l}]:null});return function(l,b){return c.apply(this,arguments)}}();f.update=
function(c){this.subview?.update(c)};f.attach=function(){this.layer.increaseRasterJobHandlerUsage();this._setSubView();this.view&&(this._highlightView=new V({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new Y(this.view.featuresTilingScheme)}),this.container.addChild(this._highlightView.container));this.addAttachHandles([w.watch(()=>this.layer.blendMode??"normal",c=>this.subview&&(this.subview.container.blendMode=c),w.syncAndInitial),w.watch(()=>
this.layer.effect??null,c=>this.subview&&(this.subview.container.effect=c),w.syncAndInitial),w.watch(()=>this.layer.exportImageServiceParameters.version,c=>{c&&this._exportImageVersion!==c&&(this._exportImageVersion=c,this.requestUpdate())},w.sync),w.watch(()=>this.timeExtent,c=>{const {subview:l}=this;l&&(l.timeExtent=c,"redraw"in l?this.requestUpdate():l.redrawOrRefetch())},w.sync),this.layer.on("redraw",()=>{const {subview:c}=this;c&&("redraw"in c?c.redraw():c.redrawOrRefetch())}),w.watch(()=>
this.layer.renderer,()=>this._setSubView())])};f.detach=function(){this.layer.decreaseRasterJobHandlerUsage();this.container.removeAllChildren();this._detachSubview(this.subview);this.subview?.destroy();this.subview=null;this._highlightView?.destroy();this._exportImageVersion=-1};f.moveStart=function(){};f.viewChange=function(){};f.moveEnd=function(){this.requestUpdate()};f.highlight=function(c,l){if(!((Array.isArray(c)?c[0]:I.isCollection(c)?c.getItemAt(0):c)instanceof K))return{remove:()=>{}};let b=
[];Array.isArray(c)||I.isCollection(c)?b=c.map(e=>e.clone()):c instanceof K&&(b=[c.clone()]);this._highlightGraphics.addMany(b);return{remove:()=>{this._highlightGraphics.removeMany(b)}}};f.doRefresh=function(){var c=E._asyncToGenerator(function*(){this.requestUpdate()});return function(){return c.apply(this,arguments)}}();f.isUpdating=function(){return!this.subview||this.subview.updating};f._setSubView=function(){if(this.view){var c=this.layer.renderer?.type,l="imagery";"vector-field"===c?l="imageryVF":
"flow"===c&&(l="flow");if(this.subview){({type:c}=this.subview);if(c===l){this._attachSubview(this.subview);"flow"===c?this.subview.redrawOrRefetch():"imagery"===c&&"lerc"===this.layer.format?this.subview.redraw():this.requestUpdate();return}this._detachSubview(this.subview);this.subview?.destroy()}this.subview="imagery"===l?new W({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):"imageryVF"===l?new U({layer:this.layer,view:this.view,timeExtent:this.timeExtent}):new P({layer:this.layer,
layerView:this});this._attachSubview(this.subview);this.requestUpdate()}};f._attachSubview=function(c){c&&!c.attached&&(c.attach(),c.attached=!0,this.container.addChildAt(c.container,0),c.container.blendMode=this.layer.blendMode,c.container.effect=this.layer.effect)};f._detachSubview=function(c){c?.attached&&(this.container.removeChild(c.container),c.detach(),c.attached=!1)};E._createClass(a,[{key:"pixelData",get:function(){const {subview:c}=this;return this.updating||!c?null:"getPixelData"in c?c.getPixelData():
null}}]);return a}(k(B(J.LayerView2DMixin(n))));G.__decorate([M.property()],D.prototype,"pixelData",null);G.__decorate([M.property()],D.prototype,"subview",void 0);return D=G.__decorate([F.subclass("esri.views.2d.layers.ImageryLayerView2D")],D)});