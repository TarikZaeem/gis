// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Collection ../../../core/maybe ../../../core/reactiveUtils ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/Error ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/Container ../engine/webgl/GroupContainer ./LayerView2D ./graphics/GraphicContainer ./graphics/GraphicsView2D ../../layers/LayerView".split(" "),function(m,
u,v,w,k,g,n,E,F,G,H,x,y,z,A,q,r,B){const C=Object.freeze({remove(){},pause(){},resume(){}});n=function(t){function p(){var a=t.apply(this,arguments)||this;a._highlightIds=new Map;a.container=new z.GroupContainer;return a}m._inheritsLoose(p,t);var d=p.prototype;d.fetchPopupFeatures=function(){var a=m._asyncToGenerator(function*(b){return Array.from(this.graphicsViews(),e=>e.hitTest(b).filter(c=>!!c.popupTemplate)).flat()});return function(b){return a.apply(this,arguments)}}();d.graphicsViews=function*(){k.isSome(this._graphicsViewsFeatureCollectionMap)?
yield*this._graphicsViewsFeatureCollectionMap.keys():k.isSome(this._graphicsViews)?yield*this._graphicsViews:yield*[]};d.hitTest=function(){var a=m._asyncToGenerator(function*(b,e){return Array.from(this.graphicsViews(),c=>{const f=c.hitTest(b);if(k.isSome(this._graphicsViewsFeatureCollectionMap)){c=this._graphicsViewsFeatureCollectionMap.get(c);for(const h of f)!h.popupTemplate&&c.popupTemplate&&(h.popupTemplate=c.popupTemplate),h.sourceLayer=h.layer=this.layer}return f}).flat().map(c=>({type:"graphic",
graphic:c,layer:this.layer,mapPoint:b}))});return function(b,e){return a.apply(this,arguments)}}();d.highlight=function(a){let b;"number"===typeof a?b=[a]:a instanceof v?b=[a.uid]:Array.isArray(a)&&0<a.length?b="number"===typeof a[0]?a:a.map(c=>c&&c.uid):w.isCollection(a)&&(b=a.map(c=>c&&c.uid).toArray());const e=b?.filter(k.isSome);if(!e?.length)return C;this._addHighlight(e);return{remove:()=>{this._removeHighlight(e)}}};d.update=function(a){for(const b of this.graphicsViews())b.processUpdate(a)};
d.attach=function(){const a=this.view,b=()=>this.requestUpdate();var e=this.layer.featureCollections;if(k.isSome(e)&&e.length){this._graphicsViewsFeatureCollectionMap=new Map;for(const c of e){e=new q(this.view.featuresTilingScheme);const f=new r({view:a,graphics:c.source,renderer:c.renderer,requestUpdateCallback:b,container:e});this._graphicsViewsFeatureCollectionMap.set(f,c);this.container.addChild(f.container);this.addHandles([g.watch(()=>c.visible,h=>f.container.visible=h,g.initial),g.watch(()=>
f.updating,()=>this.notifyChange("updating"),g.initial)],"layerView")}this._updateHighlight()}else k.isSome(this.layer.sublayers)&&this.addHandles(g.on(()=>this.layer.sublayers,"change",()=>this._createGraphicsViews(),{onListenerAdd:()=>this._createGraphicsViews(),onListenerRemove:()=>this._destroyGraphicsViews()}),"sublayers")};d.detach=function(){this._destroyGraphicsViews();this.removeHandles("sublayers")};d.moveStart=function(){};d.moveEnd=function(){};d.viewChange=function(){for(const a of this.graphicsViews())a.viewChange()};
d.isUpdating=function(){for(const a of this.graphicsViews())if(a.updating)return!0;return!1};d._destroyGraphicsViews=function(){this.container.removeAllChildren();this.removeHandles("layerView");for(const a of this.graphicsViews())a.destroy();this._graphicsViewsFeatureCollectionMap=this._graphicsViews=null};d._createGraphicsViews=function(){this._destroyGraphicsViews();if(!k.isNone(this.layer.sublayers)){var a=[],b=this.view,e=()=>this.requestUpdate();for(const c of this.layer.sublayers){const f=
new y.Container,h=new q(this.view.featuresTilingScheme);h.fadeTransitionEnabled=!0;const l=new r({view:b,graphics:c.graphics,requestUpdateCallback:e,container:h});this.addHandles([c.on("graphic-update",l.graphicUpdateHandler),g.watch(()=>c.visible,D=>l.container.visible=D,g.initial),g.watch(()=>l.updating,()=>this.notifyChange("updating"),g.initial)],"layerView");f.addChild(l.container);this.container.addChild(f);a.push(l)}this._graphicsViews=a;this._updateHighlight()}};d._addHighlight=function(a){for(const b of a)this._highlightIds.has(b)?
(a=this._highlightIds.get(b),this._highlightIds.set(b,a+1)):this._highlightIds.set(b,1);this._updateHighlight()};d._removeHighlight=function(a){for(const b of a)this._highlightIds.has(b)&&(a=this._highlightIds.get(b)-1,0===a?this._highlightIds.delete(b):this._highlightIds.set(b,a));this._updateHighlight()};d._updateHighlight=function(){const a=Array.from(this._highlightIds.keys());for(const b of this.graphicsViews())b.setHighlight(a)};return p}(A.LayerView2DMixin(B));return n=u.__decorate([x.subclass("esri.views.2d.layers.MapNotesLayerView2D")],
n)});