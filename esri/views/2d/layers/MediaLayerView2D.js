// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/support/MediaElementView":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/Polygon ../../geometry/projection ../../geometry/support/aaBoundingRect ../../geometry/support/normalizeUtilsSync".split(" "),function(l,n,h,q,B,C,k,e,
x,y,J,c,z){l.MediaElementView=function(w){function D(G){return w.call(this,G)||this}n._inheritsLoose(D,w);n._createClass(D,[{key:"bounds",get:function(){const G=this.coords;return B.isNone(G)||B.isNone(G.extent)?null:c.fromExtent(G.extent)}},{key:"coords",get:function(){const G=B.unwrap(this.element.georeference)?.coords;return J.projectOrLoad(G,this.spatialReference).geometry}},{key:"normalizedCoords",get:function(){return y.fromJSON(z.normalizeCentralMeridianSync(this.coords))}},{key:"normalizedBounds",
get:function(){const G=B.isSome(this.normalizedCoords)?this.normalizedCoords.extent:null;return B.isSome(G)?c.fromExtent(G):null}}]);return D}(q);h.__decorate([C.property()],l.MediaElementView.prototype,"spatialReference",void 0);h.__decorate([C.property()],l.MediaElementView.prototype,"element",void 0);h.__decorate([C.property()],l.MediaElementView.prototype,"bounds",null);h.__decorate([C.property()],l.MediaElementView.prototype,"coords",null);h.__decorate([C.property()],l.MediaElementView.prototype,
"normalizedCoords",null);h.__decorate([C.property()],l.MediaElementView.prototype,"normalizedBounds",null);l.MediaElementView=h.__decorate([x.subclass("esri.layers.support.MediaElementView")],l.MediaElementView);Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/engine/webgl/Overlay":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/events ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/perspectiveUtils ../../../../core/reactiveUtils ../../../../chunks/mat3f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../DisplayObject ../../../webgl/BufferObject ../../../webgl/context-util ../../../webgl/enums ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),
function(l,n,h,q,B,C,k,e,x,y,J,c,z,w,D,G,p){const m=x.create();return function(A){function K(d){var a=A.call(this)||this;a.elementView=d;a.isWrapAround=!1;a.perspectiveTransform=J.create();a._vertices=new Float32Array(20);a._handles=[];a._handles.push(e.watch(()=>a.elementView.element.opacity,f=>a.opacity=f,e.initial),e.watch(()=>[a.elementView.coords],()=>{a.requestRender()},e.initial),e.when(()=>a.elementView.element.loaded,()=>{const f=a.elementView.element;a.ready();"video"===f.type&&C.isSome(f.content)&&
a._handles.push(h.on(f.content,"play",()=>a.requestRender()))},e.initial));d.element.load().catch(f=>{q.getLogger("esri.views.2d.layers.MediaLayerView2D").error(new n("element-load-error","Element cannot be displayed",{element:d,error:f}))});return a}l._inheritsLoose(K,A);var t=K.prototype;t.destroy=function(){this._handles.forEach(d=>d.remove());this.texture=C.disposeMaybe(this.texture)};t.beforeRender=function(d){const {context:a}=d,f=this.elementView.element.content;if(C.isSome(f)){var u=f instanceof
HTMLImageElement;const v=f instanceof HTMLVideoElement,E=u?f.naturalWidth:v?f.videoWidth:f.width;u=u?f.naturalHeight:v?f.videoHeight:f.height;this._updatePerspectiveTransform(E,u);this.texture?v&&!f.paused&&(this.texture.setData(f),this.requestRender(),(a.type===w.ContextType.WEBGL2||B.isPowerOfTwo(E)&&B.isPowerOfTwo(u))&&this.texture.generateMipmap()):(this.texture=new G.Texture(a,{pixelFormat:D.PixelFormat.RGBA,dataType:D.PixelType.UNSIGNED_BYTE,samplingMode:D.TextureSamplingMode.LINEAR,wrapMode:D.TextureWrapMode.CLAMP_TO_EDGE,
width:E,height:u,preMultiplyAlpha:!0},f),(a.type===w.ContextType.WEBGL2||B.isPowerOfTwo(E)&&B.isPowerOfTwo(u))&&this.texture.generateMipmap(),v&&!f.paused&&this.requestRender())}A.prototype.beforeRender.call(this,d)};t._createTransforms=function(){return null};t.updateDrawCoords=function(d,a){var f=this.elementView.coords;if(!C.isNone(f)){var [u,v,E,L]=f.rings[0];f=this._vertices;var {x:H,y:I}=d;(d=0!==a)?f.set([v[0]-H,v[1]-I,u[0]-H,u[1]-I,E[0]-H,E[1]-I,L[0]-H,L[1]-I,L[0]-H,L[1]-I,v[0]+a-H,v[1]-I,
v[0]+a-H,v[1]-I,u[0]+a-H,u[1]-I,E[0]+a-H,E[1]-I,L[0]+a-H,L[1]-I]):f.set([v[0]-H,v[1]-I,u[0]-H,u[1]-I,E[0]-H,E[1]-I,L[0]-H,L[1]-I]);this.isWrapAround=d}};t.getVAO=function(d,a,f){if(C.isNone(this.elementView.coords))return null;var u=this._vertices;this._vao?this._geometryVbo.setData(u):(this._geometryVbo=z.BufferObject.createVertex(d,D.Usage.DYNAMIC_DRAW,u),u=z.BufferObject.createVertex(d,D.Usage.STATIC_DRAW,new Uint16Array([0,0,0,1,1,0,1,1,1,1,0,0,0,0,0,1,1,0,1,1])),this._vao=new p.VertexArrayObject(d,
f,a,{geometry:this._geometryVbo,tex:u}));return this._vao};t._updatePerspectiveTransform=function(d,a){const f=this._vertices;k.getProjectiveTransform(m,[0,0,d,0,0,a,d,a],[f[0],f[1],f[4],f[5],f[2],f[3],f[6],f[7]]);y.set(this.perspectiveTransform,m[6]/m[8]*d,m[7]/m[8]*a)};l._createClass(K,[{key:"dvsMat3",get:function(){return this.parent.dvsMat3}}]);return K}(c.DisplayObject)})},"esri/core/perspectiveUtils":function(){define("exports ../chunks/mat3 ../chunks/mat3f64 ../chunks/vec2 ../chunks/vec3 ../chunks/vec3f64".split(" "),
function(l,n,h,q,B,C){function k(c,z,w,D,G,p,m,A,K){n.set(c,z,D,p,w,G,m,1,1,1);B.set(e,A,K,1);n.adjoint(x,c);const [t,d,a]=B.transformMat3(e,e,n.transpose(x,x));n.set(x,t,0,0,0,d,0,0,0,a);return n.multiply(c,x,c)}const e=C.create(),x=h.create(),y=h.create(),J=h.create();l.getProjectiveTransform=function(c,z,w){k(y,z[0],z[1],z[2],z[3],z[4],z[5],z[6],z[7]);k(J,w[0],w[1],w[2],w[3],w[4],w[5],w[6],w[7]);n.multiply(c,n.adjoint(y,y),J);0!==c[8]&&(c[0]/=c[8],c[1]/=c[8],c[2]/=c[8],c[3]/=c[8],c[4]/=c[8],c[5]/=
c[8],c[6]/=c[8],c[7]/=c[8],c[8]/=c[8]);return c};l.transformProjective=function(c,z,w){B.set(e,z[0],z[1],1);B.transformMat3(e,e,n.transpose(x,w));return 0===e[2]?q.set(c,e[0],e[1]):q.set(c,e[0]/e[2],e[1]/e[2])};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/chunks/mat3f64":function(){define(["exports"],function(l){function n(){return[1,0,0,0,1,0,0,0,1]}function h(k){return[k[0],k[1],k[2],k[3],k[4],k[5],k[6],k[7],k[8]]}function q(k,e,x,y,J,c,z,w,D){return[k,e,x,y,J,c,z,w,D]}
function B(k,e){return new Float64Array(k,e,9)}const C=Object.freeze(Object.defineProperty({__proto__:null,clone:h,create:n,createView:B,fromValues:q},Symbol.toStringTag,{value:"Module"}));l.clone=h;l.create=n;l.createView=B;l.fromValues=q;l.mat3f64=C})},"esri/views/2d/engine/webgl/OverlayContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat3 ../../../../chunks/mat3f32 ../../../../chunks/vec2f32 ../../../../chunks/vec3f32 ../../../../geometry/support/normalizeUtils ../../../../geometry/support/spatialReferenceUtils ../../viewpointUtils ../brushes ./enums ./WGLContainer".split(" "),
function(l,n,h,q,B,C,k,e,x,y,J,c,z){return function(w){function D(){var p=w.apply(this,arguments)||this;p._localOrigin=h.createScreenPoint(0,0);p._viewStateId=-1;p._dvsMat3=B.create();p.requiresDedicatedFBO=!1;return p}l._inheritsLoose(D,w);var G=D.prototype;G.beforeRender=function(p){this._updateMatrices(p);this._updateOverlays(p,this.children);for(const m of this.children)m.beforeRender(p)};G.prepareRenderPasses=function(p){const m=p.registerRenderPass({name:"overlay",brushes:[J.brushes.overlay],
target:()=>this.children,drawPhase:c.WGLDrawPhase.MAP});return[...w.prototype.prepareRenderPasses.call(this,p),m]};G._updateMatrices=function(p){var {state:m}=p;const {id:A,size:K,pixelRatio:t,resolution:d,rotation:a,viewpoint:f,displayMat3:u}=m;if(this._viewStateId!==A){p=Math.PI/180*a;var v=t*K[0],E=t*K[1],{x:L,y:H}=f.targetGeometry;m=e.normalizeMapX(L,m.spatialReference);this._localOrigin.x=m;this._localOrigin.y=H;m=d*v;var I=d*E,N=q.identity(this._dvsMat3);q.multiply(N,N,u);q.translate(N,N,C.fromValues(v/
2,E/2));q.scale(N,N,k.fromValues(v/m,-E/I,1));q.rotate(N,N,-p);this._viewStateId=A}};G._updateOverlays=function(p,m){const {state:A}=p,{rotation:K,spatialReference:t,worldScreenWidth:d,size:a,viewpoint:f}=A;p=this._localOrigin;let u=0;var v=x.getInfo(t);if(v&&t.isWrappable){var E=180/Math.PI*K,L=Math.round(a[0]*Math.abs(Math.cos(E))+a[1]*Math.abs(Math.sin(E)));const [I,N]=v.valid;v=y.getWorldWidth(t);const {x:Y,y:ba}=f.targetGeometry;E=[0,0];A.toScreen(E,[Y,ba]);const T=[0,0];L=L>d?.5*d:.5*L;var H=
Math.floor((Y+.5*v)/v);const ca=I+H*v;H=N+H*v;const X=[E[0]+L,0];A.toMap(T,X);T[0]>H&&(u=v);X[0]=E[0]-L;A.toMap(T,X);T[0]<ca&&(u=-v);for(const U of m){m=U.elementView.bounds;if(n.isNone(m))continue;const [Z,,aa]=m;Z<I&&aa>I?U.updateDrawCoords(p,v):aa>N&&Z<N?U.updateDrawCoords(p,-v):U.updateDrawCoords(p,u)}}else for(E of m)E.updateDrawCoords(p,u)};l._createClass(D,[{key:"dvsMat3",get:function(){return this._dvsMat3}}]);return D}(z)})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(l,n,h,q,B,C,k,e,x,y,J,c,z,w,D,G){const p=q.ofType({key:"type",base:null,typeMap:{rect:w,path:G,geometry:D}});l.LayerView2DMixin=m=>{m=function(A){function K(){var d=A.apply(this,arguments)||this;d.attached=!1;d.clips=new p;d.lastUpdateId=-1;d.moving=!1;d.updateRequested=!1;d.visibleAtCurrentScale=!1;d.highlightOptions=null;return d}n._inheritsLoose(K,A);var t=K.prototype;t.initialize=function(){const d=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&d&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new C("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new c.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([k.watch(()=>this.suspended,a=>{this.container&&(this.container.visible=!a);this.view&&!a&&this.updateRequested&&this.view.requestUpdate()},k.syncAndInitial),
k.watch(()=>this.layer?.opacity??1,a=>{this.container&&(this.container.opacity=a)},k.syncAndInitial),k.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",a=>{this.container&&(this.container.blendMode=a)},k.syncAndInitial),k.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,a=>{this.container&&(this.container.effect=a)},k.syncAndInitial),k.watch(()=>this.highlightOptions,a=>this.container.highlightOptions=a,k.syncAndInitial),k.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},k.syncAndInitial),k.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:a})=>{a=null!=a?this.isVisibleAtScale(a):!1;a!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",a)},k.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(a=>{a===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};t.destroy=function(){this.processDetach();this.updateRequested=!1};t.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};t.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};t.isVisibleAtScale=function(d){const a=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!a)return!0;
const {minScale:f,maxScale:u}=a;return(0===f||d<=f)&&(0===u||d>=u)};t.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};t.processUpdate=function(d){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",d),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(d)))};t.hitTest=function(d,a){return Promise.resolve(null)};t.supportsSpatialReference=function(d){return!0};
t.canResume=function(){return this.spatialReferenceSupported?A.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};t.getSuspendInfo=function(){const d=A.prototype.getSuspendInfo.call(this),a=!this.spatialReferenceSupported,f=this.visibleAtCurrentScale;a&&(d.spatialReferenceNotSupported=a);f&&(d.outsideScaleRange=f);return d};t.addAttachHandles=function(d){this.addHandles(d,"attach")};n._createClass(K,[{key:"spatialReferenceSupported",get:function(){const d=this.view?.spatialReference;
return null==d||this.supportsSpatialReference(d)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return K}(m);h.__decorate([e.property()],m.prototype,"attached",void 0);h.__decorate([e.property({type:p,set(A){A=B.referenceSetter(A,this._get("clips"),p);this._set("clips",A)}})],m.prototype,"clips",void 0);h.__decorate([e.property()],m.prototype,"container",void 0);
h.__decorate([e.property()],m.prototype,"moving",void 0);h.__decorate([e.property({readOnly:!0})],m.prototype,"spatialReferenceSupported",null);h.__decorate([e.property({readOnly:!0})],m.prototype,"updateParameters",void 0);h.__decorate([e.property()],m.prototype,"updateRequested",void 0);h.__decorate([e.property()],m.prototype,"updating",null);h.__decorate([e.property()],m.prototype,"view",void 0);h.__decorate([e.property({readOnly:!0})],m.prototype,"visibleAtCurrentScale",void 0);h.__decorate([e.property({type:z})],
m.prototype,"highlightOptions",void 0);return m=h.__decorate([J.subclass("esri.views.2d.layers.LayerView2D")],m)};Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(l,
n,h,q,B,C,k){var e;q=e=function(x){function y(c){c=x.call(this,c)||this;c.type="rect";c.left=null;c.right=null;c.top=null;c.bottom=null;return c}l._inheritsLoose(y,x);var J=y.prototype;J.clone=function(){return new e({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};J.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return y}(k);n.__decorate([h.property({type:[Number,String],json:{write:!0}})],
q.prototype,"left",void 0);n.__decorate([h.property({type:[Number,String],json:{write:!0}})],q.prototype,"right",void 0);n.__decorate([h.property({type:[Number,String],json:{write:!0}})],q.prototype,"top",void 0);n.__decorate([h.property({type:[Number,String],json:{write:!0}})],q.prototype,"bottom",void 0);return q=e=n.__decorate([C.subclass("esri.views.layers.support.ClipRect")],q)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass".split(" "),
function(l,n,h,q,B,C,k){h=function(e){function x(){return e.apply(this,arguments)||this}l._inheritsLoose(x,e);l._createClass(x,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return x}(h.JSONSupport);n.__decorate([q.property({readOnly:!0})],h.prototype,"version",null);return h=n.__decorate([k.subclass("esri.views.layers.support.ClipArea")],h)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(l,n,h,q,B,C,k,e,x,y,J,c){var z;h={base:e,key:"type",typeMap:{extent:J,polygon:c}};y=z=function(w){function D(p){p=w.call(this,p)||this;p.type="geometry";p.geometry=null;return p}l._inheritsLoose(D,w);var G=D.prototype;G.clone=function(){return new z({geometry:this.geometry?.clone()??null})};G.commitVersionProperties=function(){this.commitProperty("geometry")};return D}(y);n.__decorate([q.property({types:h,json:{read:x.fromJSON,write:!0}})],y.prototype,"geometry",void 0);return y=z=n.__decorate([k.subclass("esri.views.layers.support.Geometry")],
y)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(l,n,h,q,B,C,k){q=function(e){function x(y){y=e.call(this,y)||this;y.type="path";y.path=[];return y}l._inheritsLoose(x,e);x.prototype.commitVersionProperties=function(){this.commitProperty("path")};
return x}(k);n.__decorate([h.property({type:[[[Number]]],json:{write:!0}})],q.prototype,"path",void 0);return q=n.__decorate([C.subclass("esri.views.layers.support.Path")],q)})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../Graphic ../../../renderers/ClassBreaksRenderer ../../../renderers/DictionaryRenderer ../../../renderers/DotDensityRenderer ../../../renderers/HeatmapRenderer ../../../renderers/PieChartRenderer ../../../renderers/Renderer ../../../renderers/SimpleRenderer ../../../renderers/UniqueValueRenderer ../../../renderers/support/jsonUtils ../../../symbols ../../../core/Collection ../../../core/has ../../../core/Logger ../../../core/MapUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../geometry/support/intersectsBase ../../../layers/support/MediaElementView ../../../core/Error ../../../core/scheduling ../../../request ../../../chunks/index3 ../../../core/urlUtils ../../../chunks/index4 ../../../layers/effects/EffectView ../engine/DisplayObject ../engine/webgl/effects/highlight/HighlightGradient ../engine/webgl/BufferPool ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../chunks/vec4f32 ../engine/webgl/Utils ../engine/webgl/shaders/BackgroundPrograms ../../webgl/enums ../../webgl/checkWebGLError ../../webgl/context-util ../../../chunks/builtins ../../../core/RandomLCG ../engine/webgl/materialKey/MaterialKey ../engine/webgl/techniques/Technique ../engine/webgl/techniques/dotDensity/TechniqueDotDensity ../engine/webgl/techniques/heatmap/TechniqueHeatmap ../engine/webgl/techniques/pieChart/TechniquePieChart ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/VertexArrayObject ../engine/webgl/brushes/WGLBrushHeatmap ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/shaders/TileInfoPrograms ../engine/webgl/brushes/WGLGeometryBrushMarker ../../../core/mathUtils ../engine/webgl/number ../engine/vectorTiles/style/StyleDefinition ../../../chunks/vec2f32 ../engine/vectorTiles/enums ../engine/vectorTiles/shaders/sources/resolver ../engine/webgl/shaders/BitBlitPrograms ../engine/webgl/shaders/sources/resolver ../engine/webgl/TextureManager ../engine/webgl/shaders/StencilPrograms ../engine/webgl/effects/BlendEffect ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/Profiler ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../../core/floatRGBA ../../3d/webgl-engine/lib/OrderIndependentTransparency ../../../chunks/webgl-debug ../LabelManager ./graphics/GraphicsView2D ../engine/webgl/AttributeStoreView ../../../chunks/earcut ../../../layers/graphics/featureConversionUtils ../../../core/unitUtils ../../../renderers/support/lengthUtils ../../../chunks/vec3f32 ../../../geometry/support/normalizeUtils ../navigation/MapViewNavigation ../../../core/asyncUtils ../engine/webgl/shaders/MagnifierPrograms ../tiling/PagedTileQueue ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../engine/webgl/Overlay ../engine/webgl/OverlayContainer ./LayerView2D ../../layers/LayerView ../../../geometry/Extent".split(" "),function(l,
n,h,q,B,C,k,e,x,y,J,c,z,w,D,G,p,m,A,K,t,d,a,f,u,v,E,L,H,I,N,Y,ba,T,ca,X,U,Z,aa,oa,pa,qa,ra,sa,ta,ua,va,wa,xa,ya,za,Aa,Ba,Ca,Da,Ea,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,$a,ab,bb,cb,db,eb,fb,gb,hb,ib,jb,kb,lb,mb,nb,ob,pb,qb,fa,ha,ia,ja,ka,la,ma){function da(Q,R,F){Q.getTileBounds(O,R.key,!0);V.xmin=O[0];V.ymin=O[1];V.xmax=O[2];V.ymax=O[3];return L.extentIntersectsPolygon(V,F)}let S=function(Q){function R(){var b=Q.apply(this,arguments)||this;b._overlayContainer=null;b._fetchQueue=
null;b._tileStrategy=null;b._elementReferences=new Map;b._debugGraphicsView=null;b.layer=null;b.elements=new D;return b}l._inheritsLoose(R,Q);var F=R.prototype;F.attach=function(){this.addAttachHandles([t.on(()=>this.layer.effectiveSource,"refresh",()=>{for(const b of this._tileStrategy.tiles)this._updateTile(b);this.requestUpdate()}),t.on(()=>this.layer.effectiveSource,"change",({element:b})=>this._elementUpdateHandler(b))]);this._overlayContainer=new ja;this.container.addChild(this._overlayContainer);
this._fetchQueue=new fa({tileInfoView:this.view.featuresTilingScheme,concurrency:10,process:(b,g)=>this._queryElements(b,g)});this._tileStrategy=new ha({cachePolicy:"purge",resampling:!0,acquireTile:b=>this._acquireTile(b),releaseTile:b=>this._releaseTile(b),tileInfoView:this.view.featuresTilingScheme});this.requestUpdate()};F.detach=function(){this.elements.removeAll();this._tileStrategy.destroy();this._fetchQueue.destroy();this._overlayContainer.removeAllChildren();this.container.removeAllChildren();
this._elementReferences.clear();this._debugGraphicsView?.destroy()};F.supportsSpatialReference=function(b){return!0};F.moveStart=function(){this.requestUpdate()};F.viewChange=function(){this.requestUpdate()};F.moveEnd=function(){this.requestUpdate()};F.update=function(b){this._tileStrategy.update(b);this._debugGraphicsView?.update(b)};F.hitTest=function(){var b=l._asyncToGenerator(function*(g,r){r=[];var M=g.normalize();M=[M.x,M.y];for(const {projectedElement:{normalizedCoords:W,element:P}}of this._elementReferences.values())A.isSome(W)&&
E.ringsContainsCoords(W.rings,M)&&r.push({type:"media",element:P,layer:this.layer,mapPoint:g});return r.reverse()});return function(g,r){return b.apply(this,arguments)}}();F.canResume=function(){return null!=this.layer.source&&Q.prototype.canResume.call(this)};F.doRefresh=function(){var b=l._asyncToGenerator(function*(){this._fetchQueue.reset();this._tileStrategy.tiles.forEach(g=>this._updateTile(g))});return function(){return b.apply(this,arguments)}}();F._acquireTile=function(b){b=new na(b.clone());
this._updateTile(b);return b};F._updateTile=function(b){this.updatingHandles.addPromise(this._fetchQueue.push(b.key).then(g=>{const [r,M]=b.setElements(g);this._referenceElements(b,r);this._dereferenceElements(b,M);this.requestUpdate()},g=>{K.isAbortError(g)||p.getLogger(this.declaredClass).error(g)}))};F._releaseTile=function(b){this._fetchQueue.abort(b.key.id);b.elements&&this._dereferenceElements(b,b.elements);this.requestUpdate()};F._queryElements=function(){var b=l._asyncToGenerator(function*(g,
r){const M=this.layer.effectiveSource;if(A.isNone(M))return[];this.view.featuresTilingScheme.getTileBounds(O,g,!0);g=new ma({xmin:O[0],ymin:O[1],xmax:O[2],ymax:O[3],spatialReference:this.view.spatialReference});return M.queryElements(g,r)});return function(g,r){return b.apply(this,arguments)}}();F._referenceElements=function(b,g){if(!A.isNone(this.layer.source))for(const r of g)this._referenceElement(b,r)};F._referenceElement=function(b,g){m.getOrCreateMapValue(this._elementReferences,g.uid,()=>{const r=
new H.MediaElementView({element:g,spatialReference:this.view.spatialReference}),M=new ia(r);this._overlayContainer.addChild(M);this.elements.add(g);return{tiles:new Set,projectedElement:r,overlay:M,debugGraphic:null}}).tiles.add(b)};F._dereferenceElements=function(b,g){for(const r of g)this._dereferenceElement(b,r)};F._dereferenceElement=function(b,g){const r=this._elementReferences.get(g.uid);r.tiles.delete(b);r.tiles.size||(this._overlayContainer.removeChild(r.overlay),r.overlay.destroy(),r.projectedElement.destroy(),
this._elementReferences.delete(g.uid),this.elements.remove(g),this._debugGraphicsView?.graphics.remove(r.debugGraphic))};F._elementUpdateHandler=function(b){var g=this._elementReferences.get(b.uid);if(g){const W=g.projectedElement.normalizedCoords;if(A.isNone(W))this._overlayContainer.removeChild(g.overlay),g.overlay.destroy(),g.projectedElement.destroy(),this._elementReferences.delete(b.uid),this.elements.remove(b),this._debugGraphicsView?.graphics.remove(g.debugGraphic);else{var r=[],M=[];for(const P of this._tileStrategy.tiles){const ea=
da(this.view.featuresTilingScheme,P,W);g.tiles.has(P)?ea||M.push(P):ea&&r.push(P)}for(const P of r)this._referenceElement(P,b);for(const P of M)this._dereferenceElement(P,b);g=this._elementReferences.get(b.uid);g?.debugGraphic&&(g.debugGraphic.geometry=g.projectedElement.normalizedCoords,this._debugGraphicsView.graphicUpdateHandler({graphic:g.debugGraphic,property:"geometry"}))}}else if(g=(new H.MediaElementView({element:b,spatialReference:this.view.spatialReference})).normalizedCoords,A.isSome(g))for(r of this._tileStrategy.tiles)da(this.view.featuresTilingScheme,
r,g)&&this._referenceElement(r,b)};return R}(ka.LayerView2DMixin(la));n.__decorate([d.property()],S.prototype,"_fetchQueue",void 0);n.__decorate([d.property()],S.prototype,"layer",void 0);n.__decorate([d.property({readOnly:!0})],S.prototype,"elements",void 0);S=n.__decorate([u.subclass("esri.views.2d.layers.MediaLayerView2D")],S);const O=v.create(),V={xmin:0,ymin:0,xmax:0,ymax:0};let na=function(){function Q(F){this.key=F;this.elements=null;this.isReady=!1;this.visible=!0}var R=Q.prototype;R.setElements=
function(F){const b=[],g=new Set(this.elements);this.elements=F;for(const r of F)g.has(r)?g.delete(r):b.push(r);this.isReady=!0;return[b,Array.from(g)]};R.destroy=function(){};return Q}();return S});