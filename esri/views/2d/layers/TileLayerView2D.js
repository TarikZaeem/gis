// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/layers/BitmapTileLayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/Error ../../../core/has ../../../core/accessorSupport/decorators/subclass ../engine/BitmapTileContainer".split(" "),function(n,d,c,e,a,b,f,h,k,g){n.BitmapTileLayerView2D=l=>{l=function(r){function m(){return r.apply(this,arguments)||this}d._inheritsLoose(m,
r);var q=m.prototype;q.attach=function(){this.view.timeline.record(`${this.layer.title} (BitmapTileLayer) Attach`);this._bitmapView=new g.BitmapTileContainer(this._tileInfoView);this.container.addChild(this._bitmapView)};q.detach=function(){this.container.removeChild(this._bitmapView);this._bitmapView?.removeAllChildren()};return m}(l);return l=c.__decorate([k.subclass("esri.views.2d.layers.BitmapTileLayerView2D")],l)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/2d/layers/LayerView2D":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/collectionUtils ../../../core/Error ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../engine/Container ../support/HighlightOptions ../../layers/support/ClipRect ../../layers/support/Geometry ../../layers/support/Path".split(" "),
function(n,d,c,e,a,b,f,h,k,g,l,r,m,q,t,w){const x=e.ofType({key:"type",base:null,typeMap:{rect:q,path:w,geometry:t}});n.LayerView2DMixin=u=>{u=function(P){function R(){var D=P.apply(this,arguments)||this;D.attached=!1;D.clips=new x;D.lastUpdateId=-1;D.moving=!1;D.updateRequested=!1;D.visibleAtCurrentScale=!1;D.highlightOptions=null;return D}d._inheritsLoose(R,P);var K=R.prototype;K.initialize=function(){const D=this.view?.spatialReferenceLocked??!0;this.view?.spatialReference&&D&&!this.spatialReferenceSupported?
this.addResolvingPromise(Promise.reject(new b("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",{layer:this.layer}))):(this.container||(this.container=new r.Container),this.container.fadeTransitionEnabled=!0,this.container.visible=!1,this.container.endTransitions(),this.addHandles([f.watch(()=>this.suspended,E=>{this.container&&(this.container.visible=!E);this.view&&!E&&this.updateRequested&&this.view.requestUpdate()},f.syncAndInitial),
f.watch(()=>this.layer?.opacity??1,E=>{this.container&&(this.container.opacity=E)},f.syncAndInitial),f.watch(()=>this.layer&&"blendMode"in this.layer?this.layer.blendMode:"normal",E=>{this.container&&(this.container.blendMode=E)},f.syncAndInitial),f.watch(()=>this.layer&&"effect"in this.layer?this.layer.effect:null,E=>{this.container&&(this.container.effect=E)},f.syncAndInitial),f.watch(()=>this.highlightOptions,E=>this.container.highlightOptions=E,f.syncAndInitial),f.on(()=>this.clips,"change",()=>
{this.container&&(this.container.clips=this.clips)},f.syncAndInitial),f.watch(()=>({scale:this.view?.scale,scaleRange:this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null}),({scale:E})=>{E=null!=E?this.isVisibleAtScale(E):!1;E!==this.visibleAtCurrentScale&&this._set("visibleAtCurrentScale",E)},f.syncAndInitial)],"constructor"),this.view?.whenLayerView?this.view.whenLayerView(this.layer).then(E=>{E===this&&this.processAttach()},()=>{}):this.when().then(()=>{this.processAttach()},
()=>{}))};K.destroy=function(){this.processDetach();this.updateRequested=!1};K.processAttach=function(){this.isResolved()&&!this.attached&&!this.destroyed&&this.spatialReferenceSupported&&(this.attach(),this.attached=!0,this.requestUpdate())};K.processDetach=function(){this.attached&&(this.attached=!1,this.removeHandles("attach"),this.detach(),this.updateRequested=!1)};K.isVisibleAtScale=function(D){const E=this.layer&&"effectiveScaleRange"in this.layer?this.layer.effectiveScaleRange:null;if(!E)return!0;
const {minScale:C,maxScale:V}=E;return(0===C||D<=C)&&(0===V||D>=V)};K.requestUpdate=function(){this.destroyed||this.updateRequested||(this.updateRequested=!0,this.suspended||this.view.requestUpdate())};K.processUpdate=function(D){this.isFulfilled()&&!this.isResolved()?this.updateRequested=!1:(this._set("updateParameters",D),this.updateRequested&&!this.suspended&&(this.updateRequested=!1,this.update(D)))};K.hitTest=function(D,E){return Promise.resolve(null)};K.supportsSpatialReference=function(D){return!0};
K.canResume=function(){return this.spatialReferenceSupported?P.prototype.canResume.call(this)?this.visibleAtCurrentScale:!1:!1};K.getSuspendInfo=function(){const D=P.prototype.getSuspendInfo.call(this),E=!this.spatialReferenceSupported,C=this.visibleAtCurrentScale;E&&(D.spatialReferenceNotSupported=E);C&&(D.outsideScaleRange=C);return D};K.addAttachHandles=function(D){this.addHandles(D,"attach")};d._createClass(R,[{key:"spatialReferenceSupported",get:function(){const D=this.view?.spatialReference;
return null==D||this.supportsSpatialReference(D)}},{key:"updating",get:function(){return this.spatialReferenceSupported&&(!this.attached||!this.suspended&&(this.updateRequested||this.isUpdating())||!!this.updatingHandles?.updating)}}]);return R}(u);c.__decorate([h.property()],u.prototype,"attached",void 0);c.__decorate([h.property({type:x,set(P){P=a.referenceSetter(P,this._get("clips"),x);this._set("clips",P)}})],u.prototype,"clips",void 0);c.__decorate([h.property()],u.prototype,"container",void 0);
c.__decorate([h.property()],u.prototype,"moving",void 0);c.__decorate([h.property({readOnly:!0})],u.prototype,"spatialReferenceSupported",null);c.__decorate([h.property({readOnly:!0})],u.prototype,"updateParameters",void 0);c.__decorate([h.property()],u.prototype,"updateRequested",void 0);c.__decorate([h.property()],u.prototype,"updating",null);c.__decorate([h.property()],u.prototype,"view",void 0);c.__decorate([h.property({readOnly:!0})],u.prototype,"visibleAtCurrentScale",void 0);c.__decorate([h.property({type:m})],
u.prototype,"highlightOptions",void 0);return u=c.__decorate([l.subclass("esri.views.2d.layers.LayerView2D")],u)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/support/ClipRect":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(n,
d,c,e,a,b,f){var h;e=h=function(k){function g(r){r=k.call(this,r)||this;r.type="rect";r.left=null;r.right=null;r.top=null;r.bottom=null;return r}n._inheritsLoose(g,k);var l=g.prototype;l.clone=function(){return new h({left:this.left,right:this.right,top:this.top,bottom:this.bottom})};l.commitVersionProperties=function(){this.commitProperty("left");this.commitProperty("right");this.commitProperty("top");this.commitProperty("bottom")};return g}(f);d.__decorate([c.property({type:[Number,String],json:{write:!0}})],
e.prototype,"left",void 0);d.__decorate([c.property({type:[Number,String],json:{write:!0}})],e.prototype,"right",void 0);d.__decorate([c.property({type:[Number,String],json:{write:!0}})],e.prototype,"top",void 0);d.__decorate([c.property({type:[Number,String],json:{write:!0}})],e.prototype,"bottom",void 0);return e=h=d.__decorate([b.subclass("esri.views.layers.support.ClipRect")],e)})},"esri/views/layers/support/ClipArea":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass".split(" "),
function(n,d,c,e,a,b,f){c=function(h){function k(){return h.apply(this,arguments)||this}n._inheritsLoose(k,h);n._createClass(k,[{key:"version",get:function(){this.commitVersionProperties();return(this._get("version")||0)+1}}]);return k}(c.JSONSupport);d.__decorate([e.property({readOnly:!0})],c.prototype,"version",null);return c=d.__decorate([f.subclass("esri.views.layers.support.ClipArea")],c)})},"esri/views/layers/support/Geometry":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../geometry ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/Geometry ../../../geometry/support/jsonUtils ./ClipArea ../../../geometry/Extent ../../../geometry/Polygon".split(" "),
function(n,d,c,e,a,b,f,h,k,g,l,r){var m;c={base:h,key:"type",typeMap:{extent:l,polygon:r}};g=m=function(q){function t(x){x=q.call(this,x)||this;x.type="geometry";x.geometry=null;return x}n._inheritsLoose(t,q);var w=t.prototype;w.clone=function(){return new m({geometry:this.geometry?.clone()??null})};w.commitVersionProperties=function(){this.commitProperty("geometry")};return t}(g);d.__decorate([e.property({types:c,json:{read:k.fromJSON,write:!0}})],g.prototype,"geometry",void 0);return g=m=d.__decorate([f.subclass("esri.views.layers.support.Geometry")],
g)})},"esri/views/layers/support/Path":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./ClipArea".split(" "),function(n,d,c,e,a,b,f){e=function(h){function k(g){g=h.call(this,g)||this;g.type="path";g.path=[];return g}n._inheritsLoose(k,h);k.prototype.commitVersionProperties=function(){this.commitProperty("path")};
return k}(f);d.__decorate([c.property({type:[[[Number]]],json:{write:!0}})],e.prototype,"path",void 0);return e=d.__decorate([b.subclass("esri.views.layers.support.Path")],e)})},"esri/views/2d/layers/graphics/HighlightGraphicContainer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/accessorSupport/decorators/subclass ../../engine/webgl/enums ./BaseGraphicContainer ../../../webgl/enums".split(" "),
function(n,d,c,e,a,b,f,h,k,g,l){c=function(r){function m(){return r.apply(this,arguments)||this}n._inheritsLoose(m,r);var q=m.prototype;q.doRender=function(t){t.drawPhase===k.WGLDrawPhase.HIGHLIGHT&&r.prototype.doRender.call(this,t)};q.renderChildren=function(t){this.attributeView.update();if(this.children.some(x=>x.hasData)){this.attributeView.bindTextures(t.context);r.prototype.renderChildren.call(this,t);var {painter:w}=t;w=w.effects.highlight;w.bind(t);t.context.setColorMask(!0,!0,!0,!0);t.context.clear(l.ClearBufferBit.COLOR_BUFFER_BIT);
this._renderChildren(t,w.defines.concat(["highlightAll"]));w.draw(t);w.unbind()}};return m}(g);return c=d.__decorate([h.subclass("esri.views.2d.layers.support.HighlightGraphicContainer")],c)})},"esri/views/2d/layers/support/imageUtils":function(){define(["exports"],function(n){function d(c){const e=document.createElement("canvas");[e.width,e.height]=c;return e}n.createBlankImage=d;n.resampleImage=function(c,e,a,b){if(a.level===b.level)return e;const f=c.tileInfo.size;var h=c.getTileResolution(a.level),
k=c.getTileResolution(b.level),g=c.getLODInfoAt(b.level),l=g.getXForColumn(b.col);b=g.getYForRow(b.row);g=c.getLODInfoAt(a.level);c=g.getXForColumn(a.col);const r=g.getYForRow(a.row);g=(e instanceof HTMLImageElement?e.naturalWidth:e.width)/f[0];a=(e instanceof HTMLImageElement?e.naturalHeight:e.height)/f[1];l=Math.round((l-c)/h*g);b=Math.round(-(b-r)/h*a);c=Math.round(k/h*f[0]*g);h=Math.round(k/h*f[1]*a);k=d(f);k.getContext("2d").drawImage(e,l,b,c,h,0,0,f[0],f[1]);return k};Object.defineProperty(n,
Symbol.toStringTag,{value:"Module"})})},"esri/views/layers/RefreshableLayerView":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Logger ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass".split(" "),function(n,d,c,e,a,b,f,h,k){return g=>{g=function(l){function r(){return l.apply(this,arguments)||this}n._inheritsLoose(r,
l);r.prototype.initialize=function(){this.handles.add(a.on(()=>this.layer,"refresh",m=>{this.doRefresh(m.dataChanged).catch(q=>{e.isAbortError(q)||c.getLogger(this.declaredClass).error(q)})}),"RefreshableLayerView")};return r}(g);d.__decorate([b.property()],g.prototype,"layer",void 0);return g=d.__decorate([k.subclass("esri.layers.mixins.RefreshableLayerView")],g)}})},"esri/views/layers/support/MapServiceLayerViewHelper":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/Collection ../../../core/Error ../../../core/has ../../../core/MapUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/unitUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/Extent ../../../geometry/support/scaleUtils ../../../layers/support/floorFilterUtils ../../../renderers/support/clickToleranceUtils ../../../rest/identify ../../../rest/support/IdentifyParameters ../../../support/arcadeOnDemand ../../../symbols/SimpleMarkerSymbol ./popupUtils".split(" "),
function(n,d,c,e,a,b,f,h,k,g,l,r,m,q,t,w,x,u,P,R,K,D,E,C,V,Z,aa){function ba(T,O,M){const y=[],p=v=>{var B=0===v.minScale||O<=v.minScale;const Q=0===v.maxScale||O>=v.maxScale;v.visible&&B&&Q&&(v.sublayers?v.sublayers.forEach(p):v.popupEnabled&&(B=aa.getFetchPopupTemplate(v,{...M,defaultPopupTemplateEnabled:!1}),l.isSome(B)&&y.unshift({sublayer:v,popupTemplate:B})))};(T?.toArray()??[]).reverse().map(p);return y}function ca(T){return T.expressionInfos?.length||Array.isArray(T.content)&&T.content.some(O=>
"expression"===O.type)?V.loadArcade():Promise.resolve()}function ia(T,O){return da.apply(this,arguments)}function da(){da=c._asyncToGenerator(function*(T,O){if(T.capabilities?.operations?.supportsQuery)return!0;try{return yield Promise.any(O.map(({sublayer:M})=>M.load().then(()=>M.capabilities.operations.supportsQuery)))}catch{return!1}});return da.apply(this,arguments)}function ka(T,O){return ea.apply(this,arguments)}function ea(){ea=c._asyncToGenerator(function*(T,O){const M=T.renderer;M&&"defaultSymbol"in
M&&!M.defaultSymbol&&(O=M.valueExpression?yield Promise.all(O.map(y=>M.getSymbolAsync(y).then(p=>p?y:null))).then(y=>y.filter(p=>null!=p)):O.filter(y=>null!=M.getSymbol(y)));return O});return ea.apply(this,arguments)}let fa=null;d.MapServiceLayerViewHelper=function(T){function O(y){var p=T.call(this,y)||this;p._featuresResolutions=new WeakMap;p.highlightGraphics=null;p.highlightGraphicUpdated=null;p.updateHighlightedFeatures=r.debounce(function(){var v=c._asyncToGenerator(function*(B){p.destroyed||
p.updatingHandles.addPromise(p._updateHighlightedFeaturesGeometries(B).catch(()=>{}))});return function(B){return v.apply(this,arguments)}}());return p}c._inheritsLoose(O,T);var M=O.prototype;M.initialize=function(){const y=p=>{this.updatingHandles.addPromise(this._updateHighlightedFeaturesSymbols(p).catch(()=>{}));this.updateHighlightedFeatures(this._highlightGeometriesResolution)};this.addHandles([m.on(()=>this.highlightGraphics,"change",p=>y(p.added),{onListenerAdd:p=>y(p)})])};M.fetchPopupFeatures=
function(){var y=c._asyncToGenerator(function*(p,v){const {layerView:{layer:B,view:{scale:Q}}}=this;if(!p)throw new h("fetchPopupFeatures:invalid-area","Nothing to fetch without area",{layer:B});const G=ba(B.sublayers,Q,v);if(!G.length)return[];const S=yield ia(B,G);if(!((B.capabilities?.operations?.supportsIdentify??!0)&&10.5<=B.version||S))throw new h("fetchPopupFeatures:not-supported","query operation is disabled for this service",{layer:B});return S?this._fetchPopupFeaturesUsingQueries(p,G,v):
this._fetchPopupFeaturesUsingIdentify(p,G,v)});return function(p,v){return y.apply(this,arguments)}}();M.clearHighlights=function(){this.highlightGraphics?.removeAll()};M.highlight=function(y){const p=this.highlightGraphics;if(!p)return{remove(){}};let v=null;y instanceof a?v=[y]:f.isCollection(y)&&0<y.length?v=y.toArray():Array.isArray(y)&&0<y.length&&(v=y);v=v?.filter(l.isSome);if(!v||!v.length)return{remove:()=>{}};for(const B of v)y=B.sourceLayer,null!=y&&"geometryType"in y&&"point"===y.geometryType&&
(B.visible=!1);p.addMany(v);return{remove:()=>{p.removeMany(v??[])}}};M._updateHighlightedFeaturesSymbols=function(){var y=c._asyncToGenerator(function*(p){const {layerView:{view:v},highlightGraphics:B,highlightGraphicUpdated:Q}=this;if(B&&Q)for(const G of p){const S=G.sourceLayer&&"renderer"in G.sourceLayer&&G.sourceLayer.renderer;G.sourceLayer&&"geometryType"in G.sourceLayer&&"point"===G.sourceLayer.geometryType&&S&&"getSymbolAsync"in S&&S.getSymbolAsync(G).then(function(){var N=c._asyncToGenerator(function*(F){F||
(F=new Z);let H=null;const I="visualVariables"in S?S.visualVariables?.find(L=>"size"===L.type):void 0;I&&(fa||(fa=(yield new Promise((L,W)=>n(["../../../renderers/visualVariables/support/visualVariableUtils"],L,W))).getSize),H=fa(I,G,{view:v.type,scale:v.scale,shape:"simple-marker"===F.type?F.style:null}));H||(H="width"in F&&"height"in F&&null!=F.width&&null!=F.height?Math.max(F.width,F.height):"size"in F?F.size:16);B.includes(G)&&(G.symbol=new Z({style:"square",size:H,xoffset:"xoffset"in F?F.xoffset:
0,yoffset:"yoffset"in F?F.yoffset:0}),Q(G,"symbol"),G.visible=!0)});return function(F){return N.apply(this,arguments)}}())}});return function(p){return y.apply(this,arguments)}}();M._updateHighlightedFeaturesGeometries=function(){var y=c._asyncToGenerator(function*(p){const {layerView:{layer:v,view:B},highlightGraphics:Q,highlightGraphicUpdated:G}=this;this._highlightGeometriesResolution=p;if(G&&Q?.length&&v.capabilities.operations.supportsQuery){var S=this._getTargetResolution(p);p=new Map;for(var N of Q)(!this._featuresResolutions.has(N)||
this._featuresResolutions.get(N)>S)&&g.getOrCreateMapValue(p,N.sourceLayer,()=>new Map).set(N.getObjectId(),N);N=Array.from(p,([F,H])=>{const I=F.createQuery();I.objectIds=[...H.keys()];I.outFields=[F.objectIdField];I.returnGeometry=!0;I.maxAllowableOffset=S;I.outSpatialReference=B.spatialReference;return F.queryFeatures(I)});N=yield Promise.all(N);if(!this.destroyed)for(const {features:F}of N)for(const H of F)(N=p.get(H.sourceLayer).get(H.getObjectId()))&&Q.includes(N)&&(N.geometry=H.geometry,G(N,
"geometry"),this._featuresResolutions.set(N,S))}});return function(p){return y.apply(this,arguments)}}();M._getTargetResolution=function(y){const p=y*q.getMetersPerUnitForSR(this.layerView.view.spatialReference),v=p/16;return 10>=v?0:y/p*v};M._fetchPopupFeaturesUsingIdentify=function(){var y=c._asyncToGenerator(function*(p,v,B){p=yield this._createIdentifyParameters(p,v,B);if(l.isNone(p))return[];({results:p}=yield E.identify(this.layerView.layer.parsedUrl,p));return p.map(Q=>Q.feature)});return function(p,
v,B){return y.apply(this,arguments)}}();M._createIdentifyParameters=function(){var y=c._asyncToGenerator(function*(p,v,B){const {floors:Q,layer:G,timeExtent:S,view:{spatialReference:N,scale:F}}=this.layerView,H=l.isSome(B)?B.event:null;if(!v.length)return null;yield Promise.all(v.map(({sublayer:W})=>W.load().catch(()=>{})));v=Math.min(k("mapservice-popup-identify-max-tolerance"),G.allSublayers.reduce((W,Y)=>Y.renderer?D.calculateTolerance({renderer:Y.renderer,event:H}):W,2));var I=this.createFetchPopupFeaturesQueryGeometry(p,
v);const L=R.getResolutionForScale(F,N);B=Math.round(I.width/L);I=new P({xmin:I.center.x-L*B,ymin:I.center.y-L*B,xmax:I.center.x+L*B,ymax:I.center.y+L*B,spatialReference:I.spatialReference});return new C({floors:Q,gdbVersion:"gdbVersion"in G?G.gdbVersion:void 0,geometry:p,height:B,layerOption:"popup",mapExtent:I,returnGeometry:!0,spatialReference:N,sublayers:G.sublayers,timeExtent:S,tolerance:v,width:B})});return function(p,v,B){return y.apply(this,arguments)}}();M._fetchPopupFeaturesUsingQueries=
function(){var y=c._asyncToGenerator(function*(p,v,B){var Q=this;const {layerView:{floors:G,timeExtent:S}}=this,N=l.isSome(B)?B.event:null;v=v.map(function(){var F=c._asyncToGenerator(function*({sublayer:H,popupTemplate:I}){yield H.load().catch(()=>{});if(H.capabilities&&!H.capabilities.operations.supportsQuery)return[];var L=H.createQuery(),W=D.calculateTolerance({renderer:H.renderer,event:N}),Y=Q.createFetchPopupFeaturesQueryGeometry(p,W);L.geometry=Y;L.outFields=yield aa.getRequiredFields(H,I);
L.timeExtent=S;if(G){var ha=G.clone();ha=K.getLayerFloorFilterClause(ha,H);l.isSome(ha)&&(L.where=L.where?`(${L.where}) AND (${ha})`:ha)}W=Q._getTargetResolution(Y.width/W);Y=yield ca(I);I="point"===H.geometryType||Y&&Y.arcadeUtils.hasGeometryOperations(I);I||(L.maxAllowableOffset=W);({features:L}=yield H.queryFeatures(L));I=I?0:W;L=yield ka(H,L);for(const qa of L)Q._featuresResolutions.set(qa,I);return L});return function(H){return F.apply(this,arguments)}}());return(yield r.eachAlways(v)).reverse().reduce((F,
H)=>H.value?[...F,...H.value]:F,[]).filter(F=>null!=F)});return function(p,v,B){return y.apply(this,arguments)}}();return O}(b);e.__decorate([t.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"createFetchPopupFeaturesQueryGeometry",void 0);e.__decorate([t.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"layerView",void 0);e.__decorate([t.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"highlightGraphics",void 0);e.__decorate([t.property({constructOnly:!0})],
d.MapServiceLayerViewHelper.prototype,"highlightGraphicUpdated",void 0);e.__decorate([t.property({constructOnly:!0})],d.MapServiceLayerViewHelper.prototype,"updatingHandles",void 0);d.MapServiceLayerViewHelper=e.__decorate([u.subclass("esri.views.layers.support.MapService")],d.MapServiceLayerViewHelper);d.collectPopupProviders=ba;d.isMapServiceLayerView=function(T,O){return"tile"===O.type||"map-image"===O.type};Object.defineProperty(d,Symbol.toStringTag,{value:"Module"})})},"esri/geometry/support/scaleUtils":function(){define(["exports",
"../../core/unitUtils"],function(n,d){function c(e,a){a=d.getMetersPerUnitForSR(a);return e/(a*d.inchesPerMeter*96)}n.getExtentForScale=function(e,a){const b=e.extent;e=e.width-(e.padding?e.padding.left+e.padding.right:0);a=c(a,b.spatialReference);return b.clone().expand(a*e/b.width)};n.getResolutionForScale=c;n.getResolutionInMetersForScale=function(e){return e/(96*d.inchesPerMeter)};n.getScale=function(e,a){a=a||e.extent;e=e.width;const b=d.getMetersPerUnitForSR(a&&a.spatialReference);return a&&
e?a.width/e*b*d.inchesPerMeter*96:0};n.getScaleForResolution=function(e,a){a=d.getMetersPerUnitForSR(a);return e*a*d.inchesPerMeter*96};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(n){function d(c,e){if(!c?.length)return null;c=c.filter(a=>""!==a).map(a=>`'${a}'`);c.push("''");return`${e} IN (${c.join(",")}) OR ${e} IS NULL`}n.getFloorFilterClause=function(c){const e=c.layer;return"floorInfo"in e&&e.floorInfo?.floorField&&
"floors"in c.view?d(c.view.floors,e.floorInfo.floorField):null};n.getLayerFloorFilterClause=function(c,e){return"floorInfo"in e&&e.floorInfo?.floorField?d(c,e.floorInfo.floorField):null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/renderers/support/clickToleranceUtils":function(){define(["exports"],function(n){function d(a,b){return b?"xoffset"in b&&b.xoffset?Math.max(a,Math.abs(b.xoffset)):"yoffset"in b&&b.yoffset?Math.max(a,Math.abs(b.yoffset||0)):a:a}function c(a,b){if("number"===
typeof a)return a;if(a&&a.stops&&a.stops.length){a=a.stops;let f=b=0;for(let h=0;h<a.length;h++){const k=a[h].size;"number"===typeof k&&(b+=k,f++)}return b/f}return b}function e(a,b){if(!b)return a;b=b.filter(k=>"size"===k.type).map(k=>{const {maxSize:g,minSize:l}=k;return(c(g,a)+c(l,a))/2});let f=0;const h=b.length;if(0===h)return a;for(let k=0;k<h;k++)f+=b[k];return Math.max(Math.floor(f/h),a)}n.calculateTolerance=function(a){const b=a&&a.renderer;a="touch"===(a&&a.event&&a.event.pointerType)?9:
6;if(!b)return a;a="visualVariables"in b?e(a,b.visualVariables):a;if("simple"===b.type)return d(a,b.symbol);if("unique-value"===b.type){let f=a;b.uniqueValueInfos?.forEach(h=>{f=d(f,h.symbol)});return f}if("class-breaks"===b.type){let f=a;b.classBreakInfos.forEach(h=>{f=d(f,h.symbol)});return f}return a};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/rest/identify":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../request ../geometry/support/normalizeUtils ./utils ./operations/identify ./support/IdentifyParameters ./support/IdentifyResult".split(" "),
function(n,d,c,e,a,b,f,h){function k(){k=d._asyncToGenerator(function*(m,q,t){q=l(q);const w=q.geometry?[q.geometry]:[],x=a.parseUrl(m);x.path+="/identify";return e.normalizeCentralMeridian(w).then(u=>{u=b.identifyToIdentifyRESTParameters(q,{geometry:u&&u[0]});u=a.encode({...x.query,f:"json",...u});u=a.asValidOptions(u,t);return c(x.path,u).then(g).then(P=>r(P,q.sublayers))})});return k.apply(this,arguments)}function g(m){m=m.data;m.results=m.results||[];m.exceededTransferLimit=!!m.exceededTransferLimit;
m.results=m.results.map(q=>h.fromJSON(q));return m}function l(m){return m=f.from(m)}function r(m,q){function t(x){w.set(x.id,x);x.sublayers&&x.sublayers.forEach(t)}if(!q?.length)return m;const w=new Map;q.forEach(t);for(const x of m.results)x.feature.sourceLayer=w.get(x.layerId);return m}n.identify=function(m,q,t){return k.apply(this,arguments)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/rest/operations/identify":function(){define("exports ../../core/maybe ../../core/sql ../../geometry/support/jsonUtils ../../geometry/support/scaleUtils ../../layers/support/floorFilterUtils ../../layers/support/sublayerUtils".split(" "),
function(n,d,c,e,a,b,f){function h(g){const {mapExtent:l,floors:r,width:m,sublayers:q,layerIds:t,layerOption:w,gdbVersion:x}=g;var u=q?.find(C=>null!=C.layer)?.layer?.serviceSublayers;const P="popup"===w;g={};const R=a.getScale({extent:l,width:m,spatialReference:l?.spatialReference}),K=[],D=C=>{const V=0===R,Z=0===C.minScale||R<=C.minScale,aa=0===C.maxScale||R>=C.maxScale;C.visible&&(V||Z&&aa)&&(C.sublayers?C.sublayers.forEach(D):!1!==t?.includes(C.id)&&(!P||C.popupTemplate&&C.popupEnabled)&&K.unshift(C))};
q?.forEach(D);if(q&&!K.length)g.layerIds=[];else{u=f.isExportDynamic(K,u,x);var E=K.map(C=>{const V=b.getLayerFloorFilterClause(r,C);return C.toExportImageJSON(V)});if(u)g.dynamicLayers=JSON.stringify(E);else if(q?(u=K.map(({id:C})=>C),t&&(u=u.filter(C=>t.includes(C))),g.layerIds=u):t?.length&&(g.layerIds=t),u=k(r,K),d.isSome(u)&&u.length){E={};for(const C of u)C.definitionExpression&&(E[C.id]=C.definitionExpression);Object.keys(E).length&&(g.layerDefs=JSON.stringify(E))}}return g}function k(g,l){const r=
!!g?.length;l=l.filter(m=>null!=m.definitionExpression||r&&null!=m.floorInfo);return l.length?l.map(m=>{var q=b.getLayerFloorFilterClause(g,m);q=c.sqlAnd(q,m.definitionExpression);return{id:m.id,definitionExpression:d.unwrapOr(q,void 0)}}):null}n.identifyToIdentifyRESTParameters=function(g,l){const {dpi:r,gdbVersion:m,geometry:q,geometryPrecision:t,height:w,layerOption:x,mapExtent:u,maxAllowableOffset:P,returnFieldName:R,returnGeometry:K,returnUnformattedValues:D,returnZ:E,spatialReference:C,timeExtent:V,
tolerance:Z,width:aa}=g.toJSON(),{dynamicLayers:ba,layerDefs:ca,layerIds:ia}=h(g);l=l&&d.isSome(l.geometry)?l.geometry:null;g={geometryPrecision:t,maxAllowableOffset:P,returnFieldName:R,returnGeometry:K,returnUnformattedValues:D,returnZ:E,tolerance:Z};l=l&&l.toJSON()||q;g.imageDisplay=`${aa},${w},${r}`;m&&(g.gdbVersion=m);l&&(delete l.spatialReference,g.geometry=JSON.stringify(l),g.geometryType=e.getJsonType(l));C?g.sr=C.wkid||JSON.stringify(C):l&&l.spatialReference?g.sr=l.spatialReference.wkid||
JSON.stringify(l.spatialReference):u&&u.spatialReference&&(g.sr=u.spatialReference.wkid||JSON.stringify(u.spatialReference));g.time=V?[V.start,V.end].join():null;if(u){const {xmin:da,ymin:ka,xmax:ea,ymax:fa}=u;g.mapExtent=`${da},${ka},${ea},${fa}`}ca&&(g.layerDefs=ca);ba&&!ca&&(g.dynamicLayers=ba);g.layers="popup"===x?"visible":x;ia&&!ba&&(g.layers+=`:${ia.join(",")}`);return g};n.toDynamicLayersJSON=h;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/sublayerUtils":function(){define(["exports",
"../../core/maybe","../../core/accessorSupport/PropertyOrigin"],function(n,d,c){function e(a,b){if(!a||!a.length||d.isNone(b))return!0;b=b.slice().reverse().flatten(({sublayers:k})=>k&&k.toArray().reverse()).map(k=>k.id).toArray();if(a.length>b.length)return!1;let f=0;const h=b.length;for(const {id:k}of a){for(;f<h&&b[f]!==k;)f++;if(f>=h)return!1}return!0}n.isExportDynamic=function(a,b,f){return a.some(h=>{const k=h.source;return!(!k||"map-layer"===k.type&&k.mapLayerId===h.id&&(d.isNone(k.gdbVersion)||
k.gdbVersion===f))||h.originIdOf("renderer")>c.OriginId.SERVICE||h.originIdOf("labelingInfo")>c.OriginId.SERVICE||h.originIdOf("opacity")>c.OriginId.SERVICE||h.originIdOf("labelsVisible")>c.OriginId.SERVICE})?!0:!e(a,b)};n.isSublayerOverhaul=function(a){return!!a&&a.some(b=>null!=b.minScale||b.layerDefinition&&null!=b.layerDefinition.minScale)};n.shouldWriteSublayerStructure=function(a,b,f){return b.flatten(({sublayers:h})=>h).length!==a.length||a.some(h=>h.originIdOf("minScale")>f||h.originIdOf("maxScale")>
f||h.originIdOf("renderer")>f||h.originIdOf("labelingInfo")>f||h.originIdOf("opacity")>f||h.originIdOf("labelsVisible")>f||h.originIdOf("source")>f)?!0:!e(a,b)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/rest/support/IdentifyParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../TimeExtent ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/Extent ../../geometry/SpatialReference".split(" "),
function(n,d,c,e,a,b,f,h,k,g,l,r){var m;a=m=function(q){function t(w){w=q.call(this,w)||this;w.dpi=96;w.floors=null;w.gdbVersion=null;w.geometry=null;w.geometryPrecision=null;w.height=400;w.layerIds=null;w.layerOption="top";w.mapExtent=null;w.maxAllowableOffset=null;w.returnFieldName=!0;w.returnGeometry=!1;w.returnM=!1;w.returnUnformattedValues=!0;w.returnZ=!1;w.spatialReference=null;w.sublayers=null;w.timeExtent=null;w.tolerance=null;w.width=400;return w}n._inheritsLoose(t,q);t.from=function(w){return f.ensureClass(m,
w)};return t}(a.JSONSupport);d.__decorate([b.property({type:Number,json:{write:!0}})],a.prototype,"dpi",void 0);d.__decorate([b.property()],a.prototype,"floors",void 0);d.__decorate([b.property({type:String,json:{write:!0}})],a.prototype,"gdbVersion",void 0);d.__decorate([b.property({types:c.geometryTypes,json:{read:g.fromJSON,write:!0}})],a.prototype,"geometry",void 0);d.__decorate([b.property({type:Number,json:{write:!0}})],a.prototype,"geometryPrecision",void 0);d.__decorate([b.property({type:Number,
json:{write:!0}})],a.prototype,"height",void 0);d.__decorate([b.property({type:[Number],json:{write:!0}})],a.prototype,"layerIds",void 0);d.__decorate([b.property({type:["top","visible","all","popup"],json:{write:!0}})],a.prototype,"layerOption",void 0);d.__decorate([b.property({type:l,json:{write:!0}})],a.prototype,"mapExtent",void 0);d.__decorate([b.property({type:Number,json:{write:!0}})],a.prototype,"maxAllowableOffset",void 0);d.__decorate([b.property({type:Boolean,json:{write:!0}})],a.prototype,
"returnFieldName",void 0);d.__decorate([b.property({type:Boolean,json:{write:!0}})],a.prototype,"returnGeometry",void 0);d.__decorate([b.property({type:Boolean,json:{write:!0}})],a.prototype,"returnM",void 0);d.__decorate([b.property({type:Boolean,json:{write:!0}})],a.prototype,"returnUnformattedValues",void 0);d.__decorate([b.property({type:Boolean,json:{write:!0}})],a.prototype,"returnZ",void 0);d.__decorate([b.property({type:r,json:{write:!0}})],a.prototype,"spatialReference",void 0);d.__decorate([b.property()],
a.prototype,"sublayers",void 0);d.__decorate([b.property({type:e,json:{write:!0}})],a.prototype,"timeExtent",void 0);d.__decorate([b.property({type:Number,json:{write:!0}})],a.prototype,"tolerance",void 0);d.__decorate([b.property({type:Number,json:{write:!0}})],a.prototype,"width",void 0);return a=m=d.__decorate([k.subclass("esri.rest.support.IdentifyParameters")],a)})},"esri/rest/support/IdentifyResult":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../geometry/support/typeUtils".split(" "),
function(n,d,c,e,a,b,f,h,k,g,l,r,m){c=function(q){function t(x){x=q.call(this,x)||this;x.displayFieldName=null;x.feature=null;x.layerId=null;x.layerName=null;return x}n._inheritsLoose(t,q);var w=t.prototype;w.readFeature=function(x,u){return e.fromJSON({attributes:{...u.attributes},geometry:{...u.geometry}})};w.writeFeature=function(x,u){if(x){var {attributes:P,geometry:R}=x;P&&(u.attributes={...P});b.isSome(R)&&(u.geometry=R.toJSON(),u.geometryType=m.typeKebabDictionary.toJSON(R.type))}};return t}(a.JSONSupport);
d.__decorate([f.property({type:String,json:{write:!0}})],c.prototype,"displayFieldName",void 0);d.__decorate([f.property({type:e})],c.prototype,"feature",void 0);d.__decorate([g.reader("feature",["attributes","geometry"])],c.prototype,"readFeature",null);d.__decorate([r.writer("feature")],c.prototype,"writeFeature",null);d.__decorate([f.property({type:Number,json:{write:!0}})],c.prototype,"layerId",void 0);d.__decorate([f.property({type:String,json:{write:!0}})],c.prototype,"layerName",void 0);return c=
d.__decorate([l.subclass("esri.rest.support.IdentifyResult")],c)})},"esri/views/layers/support/popupUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../layers/support/fieldUtils"],function(n,d,c,e){function a(){a=d._asyncToGenerator(function*(b,f=b.popupTemplate){if(c.isNone(f))return[];const h=yield f.getRequiredFields(b.fieldsIndex);({lastEditInfoEnabled:f}=f);const {objectIdField:k,typeIdField:g,globalIdField:l,relationships:r}=b;if(h.includes("*"))return["*"];
f=f?yield e.getFeatureEditFields(b):[];const m=e.fixFields(b.fieldsIndex,[...h,...f]);g&&m.push(g);m&&k&&b.fieldsIndex?.has(k)&&!m.includes(k)&&m.push(k);m&&l&&b.fieldsIndex?.has(l)&&!m.includes(l)&&m.push(l);r&&r.forEach(q=>{({keyField:q}=q);m&&q&&b.fieldsIndex?.has(q)&&!m.includes(q)&&m.push(q)});return m});return a.apply(this,arguments)}n.getFetchPopupTemplate=function(b,f){return b.popupTemplate?b.popupTemplate:c.isSome(f)&&f.defaultPopupTemplateEnabled&&c.isSome(b.defaultPopupTemplate)?b.defaultPopupTemplate:
null};n.getRequiredFields=function(b){return a.apply(this,arguments)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/views/support/drapedUtils":function(){define("exports ../../geometry ../../core/maybe ../../core/unitUtils ../../renderers/support/clickToleranceUtils ../../geometry/Extent".split(" "),function(n,d,c,e,a,b){function f(k,g,l,r=new b){let m=0;if("2d"===l.type)m=g*(l.resolution??0);else if("3d"===l.type){var q=l.overlayPixelSizeInMapUnits(k),t=l.basemapSpatialReference;
m=c.isSome(t)&&!t.equals(l.spatialReference)?e.getMetersPerUnitForSR(t)/e.getMetersPerUnitForSR(l.spatialReference):g*q}g=k.x-m;q=k.y-m;t=k.x+m;k=k.y+m;({spatialReference:l}=l);r.xmin=Math.min(g,t);r.ymin=Math.min(q,k);r.xmax=Math.max(g,t);r.ymax=Math.max(q,k);r.spatialReference=l;return r}const h=new b;n.createQueryGeometry=f;n.intersectsDrapedGeometry=function(k,g,l){k=l.toMap(k);if(c.isNone(k))return!1;const r=a.calculateTolerance();return f(k,r,l,h).intersects(g)};Object.defineProperty(n,Symbol.toStringTag,
{value:"Module"})})},"*noref":1}});
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/spatialReferenceUtils ../../../support/GraphicsCollection ../../../core/Error ../../../core/has ../../../core/scheduling ../../../request ../../../chunks/index3 ../../../core/urlUtils ../../../chunks/index4 ../../../layers/effects/EffectView ../engine/DisplayObject ../engine/webgl/effects/highlight/HighlightGradient ../engine/webgl/BufferPool ../engine/webgl/enums ../engine/webgl/brushes/BrushBitmap ../../../chunks/vec4f32 ../engine/webgl/Utils ../engine/webgl/shaders/BackgroundPrograms ../../webgl/enums ../../webgl/checkWebGLError ../../webgl/context-util ../../../chunks/builtins ../../../core/RandomLCG ../engine/webgl/materialKey/MaterialKey ../engine/webgl/techniques/Technique ../engine/webgl/techniques/dotDensity/TechniqueDotDensity ../engine/webgl/techniques/heatmap/TechniqueHeatmap ../engine/webgl/techniques/pieChart/TechniquePieChart ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/VertexArrayObject ../engine/webgl/brushes/WGLBrushHeatmap ../engine/webgl/DefaultVertexAttributeLayouts ../engine/webgl/shaders/TileInfoPrograms ../engine/webgl/brushes/WGLGeometryBrushMarker ../../../core/mathUtils ../engine/webgl/number ../engine/vectorTiles/style/StyleDefinition ../../../chunks/vec2f32 ../engine/vectorTiles/enums ../engine/vectorTiles/shaders/sources/resolver ../engine/webgl/shaders/BitBlitPrograms ../engine/webgl/shaders/sources/resolver ../engine/webgl/TextureManager ../engine/webgl/shaders/StencilPrograms ../engine/webgl/effects/BlendEffect ../engine/webgl/shaders/HighlightPrograms ../engine/webgl/Profiler ../../webgl/renderState ../../3d/webgl-engine/core/shaderModules/interfaces ../../../core/floatRGBA ../../3d/webgl-engine/lib/OrderIndependentTransparency ../../../chunks/webgl-debug ../LabelManager ./graphics/GraphicsView2D ../engine/webgl/AttributeStoreView ../../../chunks/earcut ../../../layers/graphics/featureConversionUtils ../../../core/unitUtils ../../../renderers/support/lengthUtils ../../../chunks/vec3f32 ../../../geometry/support/normalizeUtils ../navigation/MapViewNavigation ../../../core/asyncUtils ../engine/webgl/shaders/MagnifierPrograms ./BitmapTileLayerView2D ./LayerView2D ./graphics/HighlightGraphicContainer ./support/imageUtils ../tiling/TileInfoView ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../../layers/LayerView ../../layers/RefreshableLayerView ../../layers/support/MapServiceLayerViewHelper ../../support/drapedUtils".split(" "),function(n,
d,c,e,a,b,f,h,k,g,l,r,m,q,t,w,x,u,P,R,K,D,E,C,V,Z,aa,ba,ca,ia,da,ka,ea,fa,T,O,M,y,p,v,B,Q,G,S,N,F,H,I,L,W,Y,ha,qa,Fa,Ga,Ha,Ia,Ja,Ka,La,Ma,Na,Oa,Pa,ua,Qa,Ra,Sa,Ta,Ua,Va,Wa,Xa,Ya,Za,va,wa,xa,la,ya,ra,za,Aa,Ba,Ca,sa,Da){const Ea=[0,0];f=function(ma){function na(){var z=ma.apply(this,arguments)||this;z._fetchQueue=null;z._highlightGraphics=new l.GraphicsCollection;z._highlightView=null;z._popupHighlightHelper=null;z._tileStrategy=null;z.layer=null;return z}n._inheritsLoose(na,ma);var U=na.prototype;U.update=
function(z){this._fetchQueue.pause();this._fetchQueue.state=z.state;this._tileStrategy.update(z);this._fetchQueue.resume();this._highlightView?.processUpdate(z)};U.attach=function(){const z="tileServers"in this.layer?this.layer.tileServers:null;this._tileInfoView=new ya(this.layer.tileInfo,this.layer.fullExtent);this._fetchQueue=new za({tileInfoView:this._tileInfoView,concurrency:z&&10*z.length||10,process:(A,J)=>this.fetchTile(A,J)});this._tileStrategy=new Aa({cachePolicy:"keep",resampling:this.resampling,
acquireTile:A=>this.acquireTile(A),releaseTile:A=>this.releaseTile(A),tileInfoView:this._tileInfoView});if(sa.isMapServiceLayerView(this,this.layer)){const A=this._highlightView=new ua({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new xa(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1});this.container.addChild(this._highlightView.container);this._popupHighlightHelper=new sa.MapServiceLayerViewHelper({createFetchPopupFeaturesQueryGeometry:(J,
X)=>Da.createQueryGeometry(J,X,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(J,X)=>{A.graphicUpdateHandler({graphic:J,property:X})},layerView:this,updatingHandles:this.updatingHandles})}this.requestUpdate();this.addAttachHandles(a.watch(()=>this.resampling,()=>{this.doRefresh()}));ma.prototype.attach.call(this)};U.detach=function(){ma.prototype.detach.call(this);this._tileStrategy.destroy();this._fetchQueue.clear();this.container.removeAllChildren();this._popupHighlightHelper?.destroy();
this._fetchQueue=this._tileStrategy=this._tileInfoView=this._popupHighlightHelper=null};U.fetchPopupFeatures=function(){var z=n._asyncToGenerator(function*(A,J){return this._popupHighlightHelper?this._popupHighlightHelper.fetchPopupFeatures(A,J):[]});return function(A,J){return z.apply(this,arguments)}}();U.highlight=function(z){return this._popupHighlightHelper?this._popupHighlightHelper.highlight(z):{remove(){}}};U.moveStart=function(){this.requestUpdate()};U.viewChange=function(){this.requestUpdate()};
U.moveEnd=function(){this.requestUpdate()};U.supportsSpatialReference=function(z){return g.equals(this.layer.tileInfo?.spatialReference,z)};U.doRefresh=function(){var z=n._asyncToGenerator(function*(){!this.attached||this.updateRequested||this.suspended||(this._fetchQueue.reset(),this._tileStrategy.tiles.forEach(A=>this._enqueueTileFetch(A)))});return function(){return z.apply(this,arguments)}}();U.isUpdating=function(){return this._fetchQueue?.updating??!1};U.acquireTile=function(z){z=this._bitmapView.createTile(z);
const A=z.bitmap;[A.x,A.y]=this._tileInfoView.getTileCoords(Ea,z.key);A.resolution=this._tileInfoView.getTileResolution(z.key);[A.width,A.height]=this._tileInfoView.tileInfo.size;this._enqueueTileFetch(z);this._bitmapView.addChild(z);this.requestUpdate();return z};U.releaseTile=function(z){this._fetchQueue.abort(z.key.id);this._bitmapView.removeChild(z);z.once("detach",()=>z.destroy());this.requestUpdate()};U.fetchTile=function(){var z=n._asyncToGenerator(function*(A,J={}){var X="tilemapCache"in this.layer?
this.layer.tilemapCache:null;const {signal:oa,resamplingLevel:ta=0}=J;if(!X)try{return yield this._fetchImage(A,oa)}catch(ja){if(!e.isAbortError(ja)&&!this.resampling)return la.createBlankImage(this._tileInfoView.tileInfo.size);if(3>ta&&(X=this._tileInfoView.getTileParentId(A.id)))return X=new ra(X),J=yield this.fetchTile(X,{...J,resamplingLevel:ta+1}),la.resampleImage(this._tileInfoView,J,X,A);throw ja;}J=new ra(0,0,0,0);let pa;try{yield X.fetchAvailabilityUpsample(A.level,A.row,A.col,J,{signal:oa});
if(J.level!==A.level&&!this.resampling)return la.createBlankImage(this._tileInfoView.tileInfo.size);pa=yield this._fetchImage(J,oa)}catch(ja){if(e.isAbortError(ja))throw ja;pa=yield this._fetchImage(A,oa)}return this.resampling?la.resampleImage(this._tileInfoView,pa,J,A):pa});return function(A){return z.apply(this,arguments)}}();U._enqueueTileFetch=function(){var z=n._asyncToGenerator(function*(A){if(!this._fetchQueue.has(A.key.id)){try{const J=yield this._fetchQueue.push(A.key);A.bitmap.source=J;
A.bitmap.width=this._tileInfoView.tileInfo.size[0];A.bitmap.height=this._tileInfoView.tileInfo.size[1];A.once("attach",()=>this.requestUpdate())}catch(J){e.isAbortError(J)||c.getLogger(this.declaredClass).error(J)}this.requestUpdate()}});return function(A){return z.apply(this,arguments)}}();U._fetchImage=function(){var z=n._asyncToGenerator(function*(A,J){return this.layer.fetchImageBitmapTile(A.level,A.row,A.col,{signal:J})});return function(A,J){return z.apply(this,arguments)}}();n._createClass(na,
[{key:"resampling",get:function(){return!("resampling"in this.layer)||!1!==this.layer.resampling}}]);return na}(Ca(va.BitmapTileLayerView2D(wa.LayerView2DMixin(Ba))));d.__decorate([b.property()],f.prototype,"_fetchQueue",void 0);d.__decorate([b.property()],f.prototype,"resampling",null);return f=d.__decorate([k.subclass("esri.views.2d.layers.TileLayerView2D")],f)});