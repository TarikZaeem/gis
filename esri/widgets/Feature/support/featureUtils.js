// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../intl ../../../core/Logger ../../../core/maybe ../../../core/string ../../../intl/date ../../../intl/number ../../../layers/support/fieldUtils ../../../layers/support/layerUtils ../../../popup/support/FieldInfoFormat ../../../support/arcadeOnDemand".split(" "),function(g,l,ja,P,n,p,m,A,B,Q,R,S){function q(){q=l._asyncToGenerator(function*(a,b){return"function"===typeof a?a.call(null,b):a});return q.apply(this,arguments)}function C(a){return a?
D.test(a):!1}function T(a,b){if(!C(b)||!a)return null;const c=b.replace(D,"").toLowerCase();let d=null;a.some(e=>e.name.toLowerCase()===c?(d=e,!0):!1);return d}function r(a,b){return(b=t(b,a))?b.name:a}function t(a,b){return a&&"function"===typeof a.getField&&b?a.getField(b)??null:null}function E({formattedAttributes:a,template:b,fieldInfoMap:c}){return`${p.replace(p.replace(b,d=>{const e=c.get(d.toLowerCase());return`{${e&&e.fieldName||d}}`}),a).replace(U,"")}`.trim()}function V(a,b,c=!1){const d=
b[a];"string"===typeof d&&(c=(c?encodeURIComponent(d):d).replace(W,"%27"),b[a]=c)}function X(a,b=!1){const c={...a};Object.keys(c).forEach(d=>V(d,c,b));return c}function F(a,b){return a.replace(Y,(c,d,e)=>(c=t(b,e))?`{${c.name}}`:d)}function Z(a,b,c){return(a=F(a,c))?a.replace(aa,(d,e,f)=>{e=`${e||f}`.trim();return p.replace(d,X(b,e&&"{"!==e[0]||!1))}):a}function G(a,b){var c=b.fieldName,d=H(b.fieldInfos,c)?.clone();const e=b.preventPlacesFormatting;b=b.layer;var f=t(b,c);d&&"date"===f?.type&&(f=
d.format||new R,f.dateFormat=f.dateFormat||"short-date-short-time",f.dateTimeFormatOptions=!b?.layer&&"feature"===b?.type&&b.datesInUnknownTimezone||b?.layer&&"map-image"===b.layer?.type&&b.layer.datesInUnknownTimezone?{timeZone:"UTC"}:null,d.format=f);d=d&&d.format;if("string"===typeof a&&B.isRasterPixelValueField(c)&&d)return d.formatRasterPixelValue(a);"string"!==typeof a||!d||null!=d.dateFormat||null==d.places&&null==d.digitSeparator||(c=Number(a),isNaN(c)||(a=c));return"string"===typeof a||null==
a||null==d?u(a):e?A.formatNumber(a,{...A.convertNumberFormatToIntlOptions(d),minimumFractionDigits:0,maximumFractionDigits:20}):d.format(a)}function H(a,b){if(a&&a.length&&b){var c=b.toLowerCase(),d=void 0;a.some(e=>e.fieldName&&e.fieldName.toLowerCase()===c?(d=e,!0):!1);return d}}function ba({fieldName:a,graphic:b,layer:c}){if(v(a)||!c||"function"!==typeof c.getFeatureType)return null;const {typeIdField:d}=c;return d&&a===d?(a=c.getFeatureType(b))?a.name:null:null}function ca({fieldName:a,value:b,
graphic:c,layer:d}){return v(a)||!d||"function"!==typeof d.getFieldDomain?null:(a=c&&d.getFieldDomain(a,{feature:c}))&&"coded-value"===a.type?a.getName(b):null}function u(a){return"string"===typeof a?a.replace(da,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):a}function I(a){const {value:b,fieldName:c,fieldInfos:d,fieldInfoMap:e,layer:f,graphic:h}=a;return null==b?"":(a=ca({fieldName:c,value:b,graphic:h,layer:f}))||(a=ba({fieldName:c,graphic:h,layer:f}))?a:e.get(c.toLowerCase())?G(b,{fieldInfos:d||
Array.from(e.values()),fieldName:c,layer:f}):(a=f&&f.fieldsIndex)&&a.isDateField(c)?m.formatDate(b,w):u(b)}function J(a,b){return x.apply(this,arguments)}function x(){x=l._asyncToGenerator(function*(a,b){const {layer:c,graphic:d,outFields:e,objectIds:f,returnGeometry:h,spatialReference:k}=a;a=f[0];if("number"!==typeof a&&"string"!==typeof a)return K.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:c,graphic:d,objectId:a,requiredFields:e}),null;
if(!Q.getEffectiveLayerCapabilities(c)?.operations?.supportsQuery)return K.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:c,graphic:d,requiredFields:e,returnGeometry:h}),null;a=c.createQuery();a.objectIds=f;a.outFields=e?.length?e:[c.objectIdField];a.returnGeometry=!!h;a.returnZ=!!h;a.returnM=!!h;a.outSpatialReference=k;return(yield c.queryFeatures(a,b)).features[0]});return x.apply(this,arguments)}function ea(a){return y.apply(this,arguments)}function y(){y=
l._asyncToGenerator(function*(a){if(!a.expressionInfos?.length)return!1;var b=yield S.loadArcade();({arcadeUtils:{hasGeometryFunctions:b}}=b);return b(a)});return y.apply(this,arguments)}function z(){z=l._asyncToGenerator(function*({graphic:a,popupTemplate:b,layer:c,spatialReference:d},e){if(c&&b&&("function"===typeof c.load&&(yield c.load(e)),a.attributes)){var f=a.attributes[c.objectIdField];if(null!=f){f=[f];var h=yield b.getRequiredFields(c.fieldsIndex),k=B.featureHasFields(h,a);h=k?[]:h;b=b.returnGeometry||
(yield ea(b));if(!k||b)if(c=yield J({layer:c,graphic:a,outFields:h,objectIds:f,returnGeometry:b,spatialReference:d},e))c.geometry&&(a.geometry=c.geometry),c.attributes&&(a.attributes={...a.attributes,...c.attributes})}}});return z.apply(this,arguments)}function v(a=""){return a?a.includes("relationships/"):!1}function L({attributes:a,graphic:b,relatedInfo:c,fieldInfos:d,fieldInfoMap:e,layer:f}){a&&b&&c&&Object.keys(b.attributes).forEach(h=>{var k=(k={layerId:c.relation.id.toString(),fieldName:h},
`${"relationships/"}${k.layerId}/${k.fieldName}`);a[k]=I({fieldName:k,fieldInfos:d,fieldInfoMap:e,layer:f,value:b.attributes[h],graphic:b})})}function fa({attributes:a,relatedInfo:b,fieldInfoMap:c,fieldInfos:d,layer:e}){a&&b&&(b.relatedFeatures&&b.relatedFeatures&&b.relatedFeatures.forEach(f=>L({attributes:a,graphic:f,relatedInfo:b,fieldInfoMap:c,fieldInfos:d,layer:e})),b.relatedStatsFeatures&&b.relatedStatsFeatures&&b.relatedStatsFeatures.forEach(f=>L({attributes:a,graphic:f,relatedInfo:b,fieldInfoMap:c,
fieldInfos:d,layer:e})))}function M(a,b,c){return a.find(d=>d!==b&&"feature"===d.type&&d.url===b.url&&d.layerId===c.relatedTableId)}const K=P.getLogger("esri.widgets.Feature.support.featureUtils"),U=/href=(""|'')/gi,Y=/(\{([^\{\r\n]+)\})/g,W=/'/g,D=/^\s*expression\//i,da=/(\n)/gi,ha=/[\u00A0-\u9999<>&]/gim,aa=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,ia=/^(?:mailto:|tel:)/,w=m.convertDateFormatToIntlOptions("short-date-short-time"),N=a=>{if(!a)return!1;a=a.toUpperCase();return a.includes("CURRENT_TIMESTAMP")||
a.includes("CURRENT_DATE")||a.includes("CURRENT_TIME")},O=({layer:a,method:b,query:c,definitionExpression:d})=>{a.capabilities?.query?.supportsCacheHint&&"attachments"!==b&&(a=n.isSome(c.where)?c.where:null,b=n.isSome(c.geometry)?c.geometry:null,N(d)||N(a)||"extent"===b?.type||"tile"===c.resultType||(c.cacheHint=!0))};g.applyTextFormattingHTML=u;g.createfieldInfoMap=function(a,b){const c=new Map;if(!a)return c;a.forEach(d=>{const e=r(d.fieldName,b);d.fieldName=e;c.set(e.toLowerCase(),d)});return c};
g.findRelatedLayer=function(a,b,c){return a&&b&&c?M(a.allLayers,b,c)||M(a.allTables,b,c):null};g.fixTokens=F;g.formatAttributes=function({fieldInfos:a,attributes:b,layer:c,graphic:d,fieldInfoMap:e,relatedInfos:f}){const h={};f?.forEach(k=>fa({attributes:h,relatedInfo:k,fieldInfoMap:e,fieldInfos:a,layer:c}));b&&Object.keys(b).forEach(k=>{h[k]=I({fieldName:k,fieldInfos:a,fieldInfoMap:e,layer:c,value:b[k],graphic:d})});return h};g.formatEditInfo=function(a,b){const {creatorField:c,creationDateField:d,
editorField:e,editDateField:f}=a;if(b){a=b[f];if("number"===typeof a)return b=b[e],{type:"edit",date:m.formatDate(a,w),user:b};a=b[d];return"number"===typeof a?(b=b[c],{type:"create",date:m.formatDate(a,w),user:b}):null}};g.formatValueToFieldInfo=G;g.getAllFieldInfos=function(a){const b=[];if(!a)return b;const {fieldInfos:c,content:d}=a;c&&b.push(...c);if(!d||!Array.isArray(d))return b;d.forEach(e=>{"fields"===e.type&&(e=e&&e.fieldInfos)&&b.push(...e)});return b};g.getFieldInfo=H;g.getFieldInfoLabel=
function(a,b){return(b=T(b,a?.fieldName))?b.title||null:a?a.label||a.fieldName:null};g.getFixedFieldName=r;g.getFixedFieldNames=function(a,b){return a&&a.map(c=>r(c,b))};g.getSourceLayer=function(a){if(!n.isNone(a))return a.get("sourceLayer")||a.get("layer")};g.graphicCallback=function(a,b){return q.apply(this,arguments)};g.htmlEntities=function(a){return a.replace(ha,b=>`&#${b.charCodeAt(0)};`)};g.isExpressionField=C;g.isRelatedField=v;g.preLayerQueryCallback=({query:a,layer:b,method:c})=>{O({layer:b,
method:c,query:a,definitionExpression:`${b.definitionExpression} ${b.serviceDefinitionExpression}`})};g.preRequestCallback=({queryPayload:a,layer:b,method:c})=>{O({layer:b,method:c,query:a,definitionExpression:`${b.definitionExpression} ${b.serviceDefinitionExpression}`})};g.querySourceLayer=J;g.queryUpdatedFeature=function(a,b){return z.apply(this,arguments)};g.shouldOpenInNewTab=function(a=""){if(a)return!ia.test(a.trim().toLowerCase())};g.substituteAttributes=E;g.substituteFieldsInLinksAndAttributes=
function({attributes:a,globalAttributes:b,layer:c,text:d,expressionAttributes:e,fieldInfoMap:f}){return d?E({formattedAttributes:b,template:Z(d,{...b,...e,...a},c),fieldInfoMap:f}):""};Object.defineProperty(g,Symbol.toStringTag,{value:"Module"})});