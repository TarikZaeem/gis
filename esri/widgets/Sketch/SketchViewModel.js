// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../symbols ../../core/Collection ../../core/Error ../../core/Evented ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/ellipsoidUtils ../../geometry/projection ../../geometry/support/coordsUtils ../../geometry/support/spatialReferenceUtils ../../layers/GraphicsLayer ../../views/3d/interactive/editingTools/isSupportedGraphicUtils ../../views/3d/interactive/editingTools/moveGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/reshapeGraphic/isSupportedGraphic ../../views/3d/interactive/editingTools/transformGraphic/isSupportedGraphic ../../views/draw/support/layerUtils ../../views/input/InputManager ../../views/interactive/keybindings ../../views/interactive/sketch/SketchLabelOptions ../../views/interactive/sketch/SketchTooltipOptions ../../views/interactive/snapping/SnappingManager ../../views/interactive/snapping/SnappingOptions ../../views/interactive/snapping/snappingUtils ../../views/support/hitTestSelectUtils ../../views/support/screenUtils ./support/OperationHandle ../../symbols/SimpleMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol".split(" "),
function(F,t,w,J,fa,ha,v,T,ia,r,R,G,x,ta,ua,ja,ka,L,U,la,ma,H,na,M,oa,V,C,A,W,X,pa,Y,qa,ra,Z,K,S,aa,ba){function sa(y){return"polygon"===y||"rectangle"===y||"circle"===y}function N(y,D){ca("undo",y.history.undo,y.history.redo,D)}function O(y,D){ca("redo",y.history.redo,y.history.undo,D)}function ca(y,D,m,a){if(D=D.pop()){var c=D.updates,d=[];a.forEach((b,e)=>{e=c[e];null!=e&&("geometry"in e&&r.isSome(e.geometry)&&(d.push({geometry:b.geometry}),b.geometry=e.geometry),"symbol"in e&&r.isSome(e.symbol)&&
(d.push({symbol:b.symbol}),b.symbol=e.symbol),"undo"in e&&(d.push(e),e[y](b)))});m.push({updates:d})}}function I(y){return{updates:y.map(D=>({geometry:D.geometry}))}}function B(y){return"requireError"in y&&"aborted"===y.requireError}const P=y=>Object.freeze(Object.defineProperty({__proto__:null,default:y},Symbol.toStringTag,{value:"Module"})),da={defaultZ:0},Q={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,
multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,tool:"transform"};v=function(y){function D(a){a=y.call(this,a)||this;a._numUpdating=0;a._handles=new T;a._internalGraphicsLayer=new ma({listMode:"hide",internal:!0,title:"SVM Internal"});a._operationHandle=null;a._viewHandles=new T;a.activeFillSymbol=null;a.activeLineSymbol=null;a.activeVertexSymbol=null;a.allowDeleteKey=!0;a.labelOptions=new W;a.layer=null;a.pointSymbol=new S({style:"circle",size:6,color:[255,255,
255],outline:{color:[50,50,50],width:1}});a.polygonSymbol=new aa({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}});a.polylineSymbol=new ba({color:[130,130,130,1],width:2});a._snappingManager=null;a.tooltipOptions=new X;a.updateGraphics=new fa;a.updateOnGraphicClick=!0;a.updatePointSymbol=new S({size:10,color:[0,200,255,.5],outline:{color:"black",width:1}});a.updatePolygonSymbol=new aa({color:[12,207,255,.2],outline:{join:"round",color:[12,207,255],width:2}});a.updatePolylineSymbol=new ba({color:[12,
207,255],width:2});a.vertexSymbol=new S({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}});a._moduleLoaderAbortController=null;a._viewReadyAbortController=null;a._originalAutoOpenEnabled=null;a.defaultCreateOptions=da;a.defaultUpdateOptions=Q;a.snappingOptions=new Y;return a}t._inheritsLoose(D,y);var m=D.prototype;m.initialize=function(){this._handles.add([G.on(()=>this.view?.map?.layers,"change",a=>{a.removed.includes(this.layer)&&this.cancel()}),G.on(()=>this.layer?.graphics,
"change",a=>{if(r.isSome(this._operationHandle))for(const c of a.removed)this.updateGraphics.includes(c)&&(1<this.updateGraphics.length?this._operationHandle.removeFromSelection(c):this._operationHandle.cancel())}),G.watch(()=>this.layer?.elevationInfo??null,a=>{a!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=a)},G.syncAndInitial),G.watch(()=>this.view,a=>{r.destroyMaybe(this._snappingManager);a&&(this._snappingManager=new pa.SnappingManager({view:a,
options:this.snappingOptions}),"2d"===a.type?new Promise((c,d)=>F(["../../views/2d/interactive/editingTools"],c,d)):"3d"===a.type&&(new Promise((c,d)=>F(["../../views/3d/interactive/editingTools"],c,d)),new Promise((c,d)=>F(["../../views/3d/layers/GraphicsLayerView3D"],b=>c(P(b)),d))))},G.syncAndInitial),G.watch(()=>this.view?.spatialReference,(a,c)=>{a&&c&&!a.equals(c)&&this.cancel()})]);qa.setupSnappingToggleHandles(this)};m.destroy=function(){this.cancel();this._handles=r.destroyMaybe(this._handles);
this._viewHandles=r.destroyMaybe(this._viewHandles);this._removeDefaultLayer();this._snappingManager=r.destroyMaybe(this._snappingManager);this._set("view",null);this.emit("destroy")};m.cancel=function(){this._moduleLoaderAbortController=r.abortMaybe(this._moduleLoaderAbortController);this._viewReadyAbortController=r.abortMaybe(this._viewReadyAbortController);this._operationHandle&&this._operationHandle.cancel()};m.complete=function(){this._operationHandle&&this._operationHandle.complete()};m.delete=
function(){const {state:a,updateGraphics:c}=this;if("active"===a&&c.length){const {activeTool:d,layer:b}=this,e=c.toArray();b.removeMany(e);this.cancel();this._emitDeleteEvent({graphics:e,tool:d})}};m.duplicate=function(){if("active"===this.state&&this.updateGraphics.length){const a=this.updateGraphics.map(c=>c.clone()).toArray();this.layer.addMany(a);this.emit("duplicate",{graphics:a,type:"duplicate"});return a}return[]};m.create=function(){var a=t._asyncToGenerator(function*(c,d){this.cancel();
yield this._waitViewReady();const {view:b,layer:e}=this;if(!b||"disabled"===this.state)throw e||this._logMissingLayer(),R.createAbortError();r.isSome(b.activeTool)&&(b.activeTool=null);if(c){V.addUniqueLayer(b,this._internalGraphicsLayer);var f=yield this._setupCreateOperation(c,d);r.isNone(f)||this.destroyed?b.map.remove(this._internalGraphicsLayer):(f.on("complete",()=>{if(f===this._operationHandle){const g=this.createGraphic,h=this._operationHandle.cancelled;this._operationHandle.destroy();this._operationHandle=
null;this._set("createGraphic",null);this.view&&this.view.map&&this.view.map.remove(this._internalGraphicsLayer);f.cancelled||null==g||e.add(g);this.emit("create",{graphic:g,state:h?"cancel":"complete",tool:c,toolEventInfo:null,type:"create"})}}),this._operationHandle=f,b.ready&&b.focus())}else this._logError("sketch:missing-parameter","Missing parameter 'tool'.")});return function(c,d){return a.apply(this,arguments)}}();m.update=function(){var a=t._asyncToGenerator(function*(c,d){this.cancel();yield this._waitViewReady();
const {layer:b,view:e,state:f}=this;if(!e||"disabled"===f)throw b||this._logMissingLayer(),R.createAbortError();r.isSome(e.activeTool)&&(e.activeTool=null);const g=Array.isArray(c)?c:[c];null!=c&&g&&g.length?g.some(h=>h.layer!==b?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):r.isNone(h.geometry)?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),
!0):!1)||(c=yield this._setupUpdateOperation(g,d),this.destroyed||r.isNone(c)||B(c)||(V.addUniqueLayer(e,this._internalGraphicsLayer),this._setUpdateOperationHandle(c,d),this.emit("update",{graphics:g,state:"start",aborted:!1,tool:c.tool,toolEventInfo:null,type:"update"}))):this._logError("sketch:missing-parameter","Missing parameter 'graphics'.")});return function(c,d){return a.apply(this,arguments)}}();m._updateSpatialReference=function(){var a=t._asyncToGenerator(function*(c){const d=this.view;
if(d){this._beginAsyncOperation();c=Array.isArray(c)?c:[c];for(const b of c)r.isSome(b.geometry)&&"mesh"!==b.geometry.type&&!la.equals(b.geometry.spatialReference,d.spatialReference)&&(L.canProjectWithoutEngine(b.geometry.spatialReference,d.spatialReference)||L.isLoaded()||(yield L.load()),b.geometry=L.project(b.geometry,d.spatialReference));this._endAsyncOperation()}else this._logMissingView()});return function(c){return a.apply(this,arguments)}}();m.undo=function(){this.canUndo()&&this._operationHandle?.undo()};
m.redo=function(){this.canRedo()&&this._operationHandle?.redo()};m.canUndo=function(){return!(!this._operationHandle||!this._operationHandle.canUndo())};m.canRedo=function(){return!(!this._operationHandle||!this._operationHandle.canRedo())};m.toggleUpdateTool=function(){this._operationHandle&&this._operationHandle.toggleTool&&this._operationHandle.toggleTool()};m._getFirstHit=function(){var a=t._asyncToGenerator(function*(c){var d=this.view;if(!d)return this._logMissingView(),null;if("2d"===d.type){const e=
[];d.map.allLayers.forEach(f=>{"vector-tile"!==f.type&&"imagery"!==f.type||e.push(f)});d=yield d.hitTest(c,{exclude:e});return ra.findFirstGraphicHit(d.results)}const b=[d.map.ground];d.map.allLayers.forEach(e=>{"integrated-mesh"===e.type&&b.push(e)});c=yield d.hitTest(c,{exclude:b});if(0<c.results.length){const e=c.results[0];if(r.isSome(e)&&"graphic"===e.type&&e.graphic&&(!c.ground.mapPoint||1>d.map.ground.opacity||c.ground.distance-r.unwrapOr(e.distance,0)>-Math.min(3*c.ground.distance,"global"===
d.viewingMode?ka.getReferenceEllipsoid(d.renderCoordsHelper.spatialReference).radius/d.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return e}return null});return function(c){return a.apply(this,arguments)}}();m._generateViewHandles=function(a){var c=this;return[a.on("immediate-click",function(){var d=t._asyncToGenerator(function*(b){var e="active"===c.state&&"create"===c._operationHandle?.type;if("disabled"!==c.state&&!e&&c.updateOnGraphicClick){c._beginAsyncOperation();var f=yield b.async(()=>
c._getFirstHit(Z.createScreenPointFromEvent(b)));e=null;r.isSome(f)?(f=f.graphic,c.updateGraphics.includes(f)||f.layer===c.layer?(b.stopPropagation(),e=f):"2d"!==a.type||c._isComponentGraphic(f)||"active"!==c.state||c.cancel()):"active"===c.state&&c.cancel();r.isSome(e)&&!c.updateGraphics.includes(e)&&(yield c.update([e],{...c.defaultUpdateOptions,reshapeOptions:{...c.defaultUpdateOptions.reshapeOptions}}));c._endAsyncOperation()}});return function(b){return d.apply(this,arguments)}}(),C.ViewEventPriorities.WIDGET)]};
m._setupCreateOperation=function(){var a=t._asyncToGenerator(function*(c,d){const b=this.view;if(!b)return this._logMissingView(),null;c=yield this._setupDrawGraphicTool(c,b,{hasZ:"3d"===b.type,...this.defaultCreateOptions,...d});if(r.isNone(c))return null;b.tools.add(c);b.activeTool=c;return this._setupCreateOperationHandle(c)});return function(c,d){return a.apply(this,arguments)}}();m._setupDrawGraphicTool=function(){var a=t._asyncToGenerator(function*(c,d,b){if("multipoint"===c&&"3d"===d.type)return this._logError("sketch:create",
"Multipoint geometries are not supported in SceneView."),null;if(!d)return this._logMissingView(),null;const e="rectangle"!==c,f="rectangle"!==c;c={view:d,mode:"rectangle"===c||"circle"===c?"hybrid":"click",...b,snapToScene:!1,geometryType:c,graphicSymbol:this._getGraphicSymbolFromTool(c),snappingManager:this._snappingManager,forceUniformSize:f,centered:e};return"2d"===d.type?this._makeDrawGraphicTool2D(c):this._makeDrawGraphicTool3D(c)});return function(c,d,b){return a.apply(this,arguments)}}();
m._makeDrawGraphicTool2D=function(){var a=t._asyncToGenerator(function*(c){const d=yield this._requireModule(new Promise((b,e)=>F(["../../views/2d/interactive/editingTools"],b,e)));return B(d)||this.destroyed?null:new d.module.DrawGraphicTool2D({...c,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:sa(c.geometryType)?this.activeFillSymbol:null,tooltipOptions:this.tooltipOptions})});return function(c){return a.apply(this,
arguments)}}();m._makeDrawGraphicTool3D=function(){var a=t._asyncToGenerator(function*(c){const d=yield this._requireModule(new Promise((e,f)=>F(["../../views/3d/interactive/editingTools"],e,f)));if(B(d)||this.destroyed)return null;const {elevationInfo:b}=this.layer;return new d.module.DrawGraphicTool3D({...c,elevationInfo:b,snapToScene:r.isSome(b)?"absolute-height"===b.mode:!0,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions})});return function(c){return a.apply(this,arguments)}}();
m._setupCreateOperationHandle=function(a){const c=this.view;if(!c)return this._logMissingView(),null;let d=null;const b=a.forceUniformSize,e=a.centered,f=[c.on("key-down",h=>{if(h.key===A.SKETCH_KEYS.pan)h.stopPropagation(),h.repeat||(a.enabled=!1);else if(h.key===A.SKETCH_KEYS.complete)h.stopPropagation(),a.completeCreateOperation();else if(h.key!==A.SKETCH_KEYS.vertexAdd||h.repeat)h.key===A.SKETCH_KEYS.undo?(h.stopPropagation(),g.undo()):h.key===A.SKETCH_KEYS.redo?(h.stopPropagation(),g.redo()):
h.key!==A.SKETCH_KEYS.constraint||"rectangle"!==a.geometryType&&"circle"!==a.geometryType||h.repeat?h.key!==A.SKETCH_KEYS.center||h.repeat||(a.centered=!e,h.stopPropagation()):(a.forceUniformSize=!b,h.stopPropagation());else{const p=a.drawOperation.geometryType;if("polyline"===p||"polygon"===p||"multipoint"===p)h.stopPropagation(),a.drawOperation.commitStagedVertex()}},C.ViewEventPriorities.WIDGET),c.on("key-up",h=>{h.key===A.SKETCH_KEYS.pan?a.enabled=!0:h.key!==A.SKETCH_KEYS.constraint||"rectangle"!==
a.geometryType&&"circle"!==a.geometryType?h.key===A.SKETCH_KEYS.center&&(a.centered=e,h.stopPropagation()):(a.forceUniformSize=b,h.stopPropagation())},C.ViewEventPriorities.WIDGET),a.on("vertex-add",h=>{d=r.isNone(d)?"start":"active";switch(h.operation){case "apply":this.emit("create",{graphic:r.unwrap(a.graphic),state:d,tool:this.activeTool,toolEventInfo:h,type:"create"});break;case "undo":this._emitUndoEvent({graphics:[r.unwrap(a.graphic)],tool:a.geometryType});break;case "redo":this._emitRedoEvent({graphics:[r.unwrap(a.graphic)],
tool:a.geometryType})}}),a.on("cursor-update",h=>{0<a.drawOperation.numCommittedVertices&&this.emit("create",{graphic:r.unwrap(a.graphic),state:"active",tool:this.activeTool,toolEventInfo:{coordinates:h.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),a.on("vertex-remove",h=>{switch(h.operation){case "apply":this.emit("create",{graphic:r.unwrap(a.graphic),state:"active",tool:this.activeTool,toolEventInfo:h,type:"create"});break;case "undo":this._emitUndoEvent({graphics:[r.unwrap(a.graphic)],
tool:a.geometryType});break;case "redo":this._emitRedoEvent({graphics:[r.unwrap(a.graphic)],tool:a.geometryType})}}),a.on("complete",h=>{this._set("createGraphic",r.unwrap(h.graphic));d="complete";h.aborted?g&&g.cancel():g&&g.complete()}),G.watch(()=>this._getGraphicSymbolFromTool(a.geometryType),h=>{a.graphicSymbol=h})],g=new K.CreateOperationHandle({activeComponent:a,tool:a.geometryType,type:"create",onEnd:()=>{f.forEach(h=>h.remove());f.length=0;c.tools?.remove(a)},undo:()=>{a.canUndo&&a.undo()},
redo:()=>{a.canRedo&&a.redo()},canUndo:()=>a.canUndo,canRedo:()=>a.canRedo});return g};m._getGraphicSymbolFromTool=function(a){switch(a){case "point":case "multipoint":return this.pointSymbol;case "polyline":return this.polylineSymbol;case "circle":case "rectangle":case "polygon":return this.polygonSymbol}};m._setupUpdateOperation=function(){var a=t._asyncToGenerator(function*(c,d){const {layer:b,view:e}=this;if(!e)return this._logMissingView(),null;d={tool:this._defaultUpdateTool,...this.defaultUpdateOptions,
...d,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...d?.reshapeOptions}};var f=d.tool;for(var g of c)b.remove(g),b.add(g);if("3d"===e.type){if(0===c.length)return null;switch(f){case "move":return this._setupMove3DOperation(c,d,e,f);case "reshape":if(1<c.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;f=M.isSupportedGraphic(c[0]);if(f===H.SupportedGraphicResult.SUPPORTED)return this._setupReshape3DOperation(c[0],d,
e);this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${H.isSupportedGraphicResultMessage(f)}).`);return null;case "transform":return this._setupGraphicTransform3DOperation(c,d,e)}}switch(f){case "move":return this._setupMove2DOperation(c,d,e);case "reshape":if(1<c.length)return this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null;g=M.isSupportedGraphic(c[0]);if(g===H.SupportedGraphicResult.SUPPORTED)return this._setupTransformOrReshape2DOperation(c,
f,d,e);this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${H.isSupportedGraphicResultMessage(g)}).`);return null;case "transform":return 1===c.length&&(g=r.get(c[0].geometry,"type"),"point"===g||"multipoint"===g)&&(f="reshape"),this._setupTransformOrReshape2DOperation(c,f,d,e)}});return function(c,d){return a.apply(this,arguments)}}();m._setupMove3DOperation=function(){var a=t._asyncToGenerator(function*(c,d,b,e,f=!1){var g=this;for(var h of c){const k=na.isSupportedGraphic(h);
if(k!==H.SupportedGraphicResult.SUPPORTED)return this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${H.isSupportedGraphicResultMessage(k)}).`),null}h=yield this._requireModule(new Promise((k,q)=>F(["../../views/3d/interactive/editingTools"],k,q)));if(B(h))return h;const p=new h.module.GraphicMoveTool({view:b,enableZ:d.enableZ,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});b.tools.add(p);p.graphics.addMany(c);f||this.updateGraphics.addMany(c);
const n=[],l=new K.UpdateOperationHandle({activeComponent:p,tool:e,type:"update",onEnd:()=>{n.forEach(k=>k.remove());n.length=0;b.tools?.remove(p);p.destroyed||p.destroy()},undo:()=>{N(l,this.updateGraphics.toArray());this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:e})},redo:()=>{O(l,this.updateGraphics.toArray());this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:e})},addToSelection:k=>{this.updateGraphics.push(k);p.graphics.push(k);this.emit("update",{graphics:this.updateGraphics.toArray(),
state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[k],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:k=>{const q=this.updateGraphics.indexOf(k);l.history.undo.forEach(u=>u.updates.splice(q,1));l.history.redo.forEach(u=>u.updates.splice(q,1));this.updateGraphics.remove(k);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[k],type:"selection-change"},type:"update"});0===
this.updateGraphics.length?l.complete():p.graphics.remove(k)},toggleTool:function(){var k=t._asyncToGenerator(function*(){if(1===g.updateGraphics.length&&!1!==d.toggleToolOnClick&&"transform"===e){var q=g.updateGraphics.getItemAt(0);M.isSupportedGraphic(q)===H.SupportedGraphicResult.SUPPORTED&&(q=yield g._setupReshape3DOperation(q,d,b,!0),B(q)||(l.onEnd(),l.destroy(),g._setUpdateOperationHandle(q,d)))}});return function(){return k.apply(this,arguments)}}()});n.push(...this._getHandlesForComponent(l,
d),b.on("immediate-click",k=>this._getCommonUpdateOperationClickHandlers(l,k,d),C.ViewEventPriorities.WIDGET),b.on("key-down",k=>{this._getCommonUpdateOperationKeyDownHandlers(l,k)},C.ViewEventPriorities.WIDGET));return l});return function(c,d,b,e){return a.apply(this,arguments)}}();m._setupGraphicTransform3DOperation=function(a,c,d,b=!1){if(1===a.length&&oa.isSupportedGraphic(a[0])===H.SupportedGraphicResult.SUPPORTED){const e=a[0],f=e.geometry;if(r.isSome(f)&&("point"===f.type||"mesh"===f.type))return this._setupPointTransform3DOperation(e,
c,d);if(r.isSome(f)&&("polygon"===f.type||"polyline"===f.type))return this._setupPolyTransform3DOperation(e,c,d,b)}return this._setupMove3DOperation(a,c,d,"transform",b)};m._setupPointTransform3DOperation=function(){var a=t._asyncToGenerator(function*(c,d,b){var e=this;const {enableRotation:f,enableScaling:g,enableZ:h}=d,p=yield this._requireModule(new Promise((q,u)=>F(["../../views/3d/interactive/editingTools"],q,u)));if(B(p))return p;const n=new p.module.GraphicTransformTool({graphic:c,view:b,enableRotation:f,
enableScaling:g,enableZ:h,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions});b.tools.add(n);this.updateGraphics.add(c);const l=[],k=new K.UpdateOperationHandle({activeComponent:n,tool:"transform",type:"update",onEnd:()=>{l.forEach(q=>q.remove());l.length=0;b.tools?.remove(n);n.destroyed||n.destroy()},undo:()=>{N(k,this.updateGraphics.toArray());this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},redo:()=>{O(k,this.updateGraphics.toArray());this._emitRedoEvent({graphics:this.updateGraphics.toArray(),
tool:"transform"})},addToSelection:function(){var q=t._asyncToGenerator(function*(u){e.updateGraphics.add(u);e.emit("update",{graphics:e.updateGraphics.toArray(),state:"active",aborted:!1,tool:e.activeTool,toolEventInfo:{added:[u],removed:[],type:"selection-change"},type:"update"});u=yield e._setupMove3DOperation(e.updateGraphics.toArray(),d,b,"transform",!0);B(u)||(k.onEnd(),k.destroy(),e._setUpdateOperationHandle(u,d))});return function(u){return q.apply(this,arguments)}}(),removeFromSelection:q=>
{this.updateGraphics.remove(q);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[q],type:"selection-change"},type:"update"});k.complete()},toggleTool:()=>{}});l.push(...this._getHandlesForComponent(k,d),b.on("immediate-click",q=>this._getCommonUpdateOperationClickHandlers(k,q,d),C.ViewEventPriorities.WIDGET),b.on("key-down",q=>{this._getCommonUpdateOperationKeyDownHandlers(k,q)},C.ViewEventPriorities.WIDGET));
return k});return function(c,d,b){return a.apply(this,arguments)}}();m._setupPolyTransform3DOperation=function(){var a=t._asyncToGenerator(function*(c,d,b,e=!1){var f=this;const {enableRotation:g,enableScaling:h,enableZ:p,preserveAspectRatio:n}=d,l=yield this._requireModule(new Promise((z,E)=>F(["../../views/3d/interactive/editingTools"],z,E)));if(B(l))return l;const k=new l.module.ExtentTransformTool({graphic:c,view:b,enableRotation:g,enableScaling:h,enableZ:p,preserveAspectRatio:n,tooltipOptions:this.tooltipOptions});
b.tools.add(k);e||this.updateGraphics.add(c);const q=[],u=new K.UpdateOperationHandle({activeComponent:k,tool:"transform",type:"update",onEnd:()=>{q.forEach(z=>z.remove());q.length=0;b.tools?.remove(k);k.destroyed||k.destroy()},canUndo:()=>k.canUndo,undo:()=>{k.undo();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},canRedo:()=>k.canRedo,redo:()=>{k.redo();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"transform"})},addToSelection:function(){var z=
t._asyncToGenerator(function*(E){f.updateGraphics.add(E);f.emit("update",{graphics:f.updateGraphics.toArray(),state:"active",aborted:!1,tool:f.activeTool,toolEventInfo:{added:[E],removed:[],type:"selection-change"},type:"update"});E=yield f._setupMove3DOperation(f.updateGraphics.toArray(),d,b,"transform",!0);B(E)||(u.onEnd(),u.destroy(),f._setUpdateOperationHandle(E,d))});return function(E){return z.apply(this,arguments)}}(),removeFromSelection:z=>{this.updateGraphics.remove(z);this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[z],type:"selection-change"},type:"update"});u.complete()},toggleTool:function(){var z=t._asyncToGenerator(function*(){if(1===f.updateGraphics.length&&!1!==d.toggleToolOnClick){var E=f.updateGraphics.getItemAt(0);M.isSupportedGraphic(E)===H.SupportedGraphicResult.SUPPORTED&&(E=yield f._setupReshape3DOperation(E,d,b,!0),B(E)||(u.onEnd(),u.destroy(),f._setUpdateOperationHandle(E,d)))}});
return function(){return z.apply(this,arguments)}}()});q.push(...this._getHandlesForComponent(u,d),b.on("immediate-click",z=>this._getCommonUpdateOperationClickHandlers(u,z,d),C.ViewEventPriorities.WIDGET),b.on("key-down",z=>this._getCommonUpdateOperationKeyDownHandlers(u,z),C.ViewEventPriorities.WIDGET),b.on("key-down",z=>{z.key!==A.SKETCH_KEYS.constraint||z.repeat||(k.preserveAspectRatio=!k.preserveAspectRatio,z.stopPropagation())},C.ViewEventPriorities.WIDGET),b.on("key-up",z=>{z.key===A.SKETCH_KEYS.constraint&&
(k.preserveAspectRatio=!k.preserveAspectRatio,z.stopPropagation())},C.ViewEventPriorities.WIDGET));return u});return function(c,d,b){return a.apply(this,arguments)}}();m._setupMove2DOperation=function(){var a=t._asyncToGenerator(function*(c,d,b){var e=this;this.updateGraphics.addMany(c);yield this._updateSpatialReference(c);const f=yield this._getGraphicMover(c,d,b);if(B(f))return f;const g=new K.UpdateOperationHandle({activeComponent:f,tool:"move",type:"update",onEnd:()=>{this._displayDefaultCursor();
n.forEach(l=>l.remove());p.forEach(l=>l.remove());n=[];p=[];f.destroy();this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const l=this.updateGraphics.toArray();N(g,l);g.refreshComponent();this._emitUndoEvent({graphics:l,tool:"move"})},redo:()=>{const l=this.updateGraphics.toArray();O(g,l);g.refreshComponent();this._emitRedoEvent({graphics:l,tool:"move"})},addToSelection:function(){var l=t._asyncToGenerator(function*(k){yield e._updateSpatialReference(k);e.updateGraphics.push(k);
f.graphics=e.updateGraphics.toArray();e.emit("update",{graphics:e.updateGraphics.toArray(),state:"active",aborted:!1,tool:e.activeTool,toolEventInfo:{added:[k],removed:[],type:"selection-change"},type:"update"})});return function(k){return l.apply(this,arguments)}}(),removeFromSelection:l=>{const k=this.updateGraphics.indexOf(l);g.history.undo.forEach(u=>u.updates.splice(k,1));g.history.redo.forEach(u=>u.updates.splice(k,1));this.updateGraphics.remove(l);const q=this.updateGraphics.toArray();this.emit("update",
{graphics:q,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"});0===this.updateGraphics.length?g.complete():f.graphics=q}});let h=!1,p=[b.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(g,l,d),C.ViewEventPriorities.WIDGET),b.on("key-down",l=>{this._getCommonUpdateOperationKeyDownHandlers(g,l);l.key!==A.SKETCH_KEYS.constraint||l.repeat||(h=!0,f.enableMoveAllGraphics=!f.enableMoveAllGraphics)},C.ViewEventPriorities.WIDGET),
b.on("key-up",l=>{l.key===A.SKETCH_KEYS.constraint&&h&&(h=!1,f.enableMoveAllGraphics=!f.enableMoveAllGraphics)},C.ViewEventPriorities.WIDGET)],n=this._getHandlesForComponent(g,d);return g});return function(c,d,b){return a.apply(this,arguments)}}();m._setupReshape3DOperation=function(){var a=t._asyncToGenerator(function*(c,d,b,e=!1){var f=this;const g=yield this._requireModule(new Promise((k,q)=>F(["../../views/3d/interactive/editingTools"],k,q)));if(B(g))return g;const h=d.reshapeOptions,p=new g.module.GraphicReshapeTool({view:b,
graphic:c,enableZVertex:d.enableZ&&"move"===h?.vertexOperation,enableZShape:d.enableZ&&"move"===h?.shapeOperation,enableMoveGraphic:"move"===h?.shapeOperation||"move-xy"===h?.shapeOperation,enableMidpoints:"split"===h?.edgeOperation,enableEdgeOffset:"offset"===h?.edgeOperation,snappingManager:this._snappingManager,labelOptions:this.labelOptions,tooltipOptions:this.tooltipOptions});b.tools.add(p);e||this.updateGraphics.add(c);const n=[],l=new K.UpdateOperationHandle({activeComponent:p,tool:"reshape",
type:"update",onEnd:()=>{n.forEach(k=>k.remove());n.length=0;b.tools?.remove(p);p.destroyed||p.destroy()},canUndo:()=>p.canUndo,undo:()=>{p.undo();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:"reshape"})},canRedo:()=>p.canRedo,redo:()=>{p.redo();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:"reshape"})},addToSelection:function(){var k=t._asyncToGenerator(function*(q){f.updateGraphics.add(q);f.emit("update",{graphics:f.updateGraphics.toArray(),state:"active",
aborted:!1,tool:f.activeTool,toolEventInfo:{added:[q],removed:[],type:"selection-change"},type:"update"});q=yield f._setupMove3DOperation(f.updateGraphics.toArray(),d,b,"transform",!0);B(q)||(l.onEnd(),l.destroy(),f._setUpdateOperationHandle(q,d))});return function(q){return k.apply(this,arguments)}}(),removeFromSelection:k=>{this.updateGraphics.remove(k);this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[k],type:"selection-change"},
type:"update"});l.complete()},toggleTool:function(){var k=t._asyncToGenerator(function*(){if(!1!==d.toggleToolOnClick){var q=yield f._setupGraphicTransform3DOperation(f.updateGraphics.toArray(),d,b,!0);B(q)||(l.onEnd(),l.destroy(),f._setUpdateOperationHandle(q,d))}});return function(){return k.apply(this,arguments)}}()});n.push(...this._getHandlesForComponent(l,d),b.on("immediate-click",k=>this._getCommonUpdateOperationClickHandlers(l,k,d),C.ViewEventPriorities.WIDGET),b.on("key-down",k=>{this._getCommonUpdateOperationKeyDownHandlers(l,
k)},C.ViewEventPriorities.WIDGET));return l});return function(c,d,b){return a.apply(this,arguments)}}();m._setupTransformOrReshape2DOperation=function(){var a=t._asyncToGenerator(function*(c,d,b,e){var f=this;this.updateGraphics.addMany(c);yield this._updateSpatialReference(c);c="transform"===d?yield this._getBox(c,b,e):yield this._getReshape(c,b,e);if(B(c))return c;const g=new K.UpdateOperationHandle({activeComponent:c,type:"update",onEnd:()=>{p.forEach(n=>n.remove());h.forEach(n=>n.remove());p=
[];h=[];g.activeComponent&&!g.activeComponent.destroyed&&g.activeComponent.destroy();this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{N(g,this.updateGraphics.toArray());g.refreshComponent();this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:g.tool})},redo:()=>{O(g,this.updateGraphics.toArray());g.refreshComponent();this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:g.tool})},addToSelection:function(){var n=t._asyncToGenerator(function*(l){var k=
g.activeComponent;if("reshape"===k?.type){k=[...f.updateGraphics,l];f.updateGraphics.removeAll();k=yield f._setupMove2DOperation(k,b,e);if(B(k))return;g.onEnd();g.destroy();f._setUpdateOperationHandle(k,b)}else f.updateGraphics.add(l),k.graphics=f.updateGraphics.toArray(),k.refresh(),g.resetHistory();f.emit("update",{graphics:f.updateGraphics.toArray(),state:"active",aborted:!1,tool:f.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})});return function(l){return n.apply(this,
arguments)}}(),removeFromSelection:function(){var n=t._asyncToGenerator(function*(l){const k=f.updateGraphics.indexOf(l);g.history.undo.forEach(u=>u.updates.splice(k,1));g.history.redo.forEach(u=>u.updates.splice(k,1));f.updateGraphics.remove(l);const q=f.updateGraphics.toArray();if(0===q.length)g.complete();else{const u=q[0].geometry;1!==q.length||!r.isSome(u)||"point"!==u.type&&"multipoint"!==u.type?g.activeComponent.graphics=q:g.toggleTool()}f.emit("update",{graphics:q,state:"active",aborted:!1,
tool:f.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})});return function(l){return n.apply(this,arguments)}}(),toggleTool:function(){var n=t._asyncToGenerator(function*(){if(!(1<f.updateGraphics.length)){var l=f.updateGraphics.getItemAt(0),k=l.geometry;r.isSome(k)&&("reshape"===g.tool&&("point"===k.type||"multipoint"===k.type)||"transform"===g.tool&&"extent"===k.type)||(k=null,"transform"===g.tool?k=yield f._getReshape([l],b,e):"reshape"===g.tool&&(k=yield f._getBox([l],
b,e)),B(k)||(g.activeComponent?.destroy(),g.activeComponent=k,g.activeComponent&&(p.forEach(q=>q.remove()),p=f._getHandlesForComponent(g,b))))}});return function(){return n.apply(this,arguments)}}()});let h=[e.on("immediate-click",n=>this._getCommonUpdateOperationClickHandlers(g,n,b),C.ViewEventPriorities.WIDGET),e.on("key-down",n=>{this._getCommonUpdateOperationKeyDownHandlers(g,n);n.key===A.SKETCH_KEYS.constraint&&!n.repeat&&g&&(n=g.activeComponent)&&"box"===n.type&&(n.preserveAspectRatio=!n.preserveAspectRatio)},
C.ViewEventPriorities.WIDGET),e.on("key-up",n=>{n.key===A.SKETCH_KEYS.constraint&&g&&(n=g.activeComponent)&&"box"===n.type&&(n.preserveAspectRatio=!n.preserveAspectRatio)},C.ViewEventPriorities.WIDGET)],p=this._getHandlesForComponent(g,b);return g});return function(c,d,b,e){return a.apply(this,arguments)}}();m._getGraphicMover=function(){var a=t._asyncToGenerator(function*(c,d,b){({enableMoveAllGraphics:d}=d);const e=yield this._requireModule(new Promise((f,g)=>F(["../../views/draw/support/GraphicMover"],
h=>f(P(h)),g)));return B(e)?e:new e.module.default({enableMoveAllGraphics:d,highlightsEnabled:!0,indicatorsEnabled:!1,graphics:c,view:b,callbacks:{onGraphicMoveStart:({dx:f,dy:g,graphic:h})=>{this._displayGrabbingCursor();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:g,mover:h,type:"move-start"},type:"update"})},onGraphicMove:({dx:f,dy:g,graphic:h})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",
aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:g,mover:h,type:"move"},type:"update"}),onGraphicMoveStop:({dx:f,dy:g,graphic:h})=>{this._displayPointerCursor();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:f,dy:g,mover:h,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})});return function(c,d,b){return a.apply(this,arguments)}}();
m._getBox=function(){var a=t._asyncToGenerator(function*(c,d,b){const {enableRotation:e,enableScaling:f,preserveAspectRatio:g}=d;d=yield this._requireModule(new Promise((h,p)=>F(["../../views/draw/support/Box"],n=>h(P(n)),p)));return B(d)?d:new d.module.default({graphics:c,enableRotation:e,enableScaling:f,preserveAspectRatio:g,layer:this._internalGraphicsLayer,view:b,tooltipOptions:this.tooltipOptions,callbacks:{onMoveStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",
aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onMove:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onMoveStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScaleStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{...h},type:"update"}),onScale:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onScaleStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotateStart:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),
onRotate:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"}),onRotateStop:h=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...h},type:"update"})}})});return function(c,d,b){return a.apply(this,arguments)}}();m._getReshape=function(){var a=t._asyncToGenerator(function*(c,d,b){const e="split"===d.reshapeOptions?.edgeOperation;d="move"===
d.reshapeOptions?.shapeOperation;const f=yield this._requireModule(new Promise((g,h)=>F(["../../views/draw/support/Reshape"],p=>g(P(p)),h)));return B(f)?f:new f.module.default({enableMidpoints:e,enableMovement:d,graphic:c[0],layer:this._internalGraphicsLayer,snappingManager:this._snappingManager,tooltipOptions:this.tooltipOptions,view:b,callbacks:{onReshapeStart:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),
onReshape:g=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...g},type:"update"}),onReshapeStop:({mover:g,type:h})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:g,type:h},type:"update"}),onMoveStart:({dx:g,dy:h,mover:p,type:n})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:g,
dy:h,mover:p,type:n},type:"update"}),onMove:({dx:g,dy:h,mover:p,type:n})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:g,dy:h,mover:p,type:n},type:"update"}),onMoveStop:({dx:g,dy:h,mover:p,type:n})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:g,dy:h,mover:p,type:n},type:"update"}),onVertexAdd:({added:g,type:h,vertices:p})=>{g=g.map(n=>U.geometryToCoordinates(n.geometry));
this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:g,vertices:p,type:h},type:"update"})},onVertexRemove:({removed:g,type:h,vertices:p})=>{g=g.map(n=>U.geometryToCoordinates(n.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:g,vertices:p,type:h},type:"update"})}}})});return function(c,d,b){return a.apply(this,arguments)}}();m._getHandlesForComponent=
function(a,c){const d=a.activeComponent;if(!d)return[];switch(d.type){case "graphic-mover":return[d.on("graphic-click",({graphic:b,viewEvent:e})=>{e.native?.shiftKey&&(e.stopPropagation(),a.removeFromSelection(b))}),d.on("graphic-move-start",b=>a.addToHistory(I(b.allGraphics)))];case "box":return[d.on("graphic-click",b=>this._onTransformOrReshape2DGraphicClick(a,c,b)),d.on("move-start",b=>a.addToHistory(I(b.graphics))),d.on("rotate-start",b=>a.addToHistory(I(b.graphics))),d.on("scale-start",b=>a.addToHistory(I(b.graphics)))];
case "reshape":return[d.on("graphic-click",b=>this._onTransformOrReshape2DGraphicClick(a,c,b)),d.on("move-start",b=>a.addToHistory(I([b.mover]))),d.on("reshape-start",b=>a.addToHistory(I([b.graphic]))),d.on("vertex-add",b=>a.addToHistory(I([b.oldGraphic]))),d.on("vertex-remove",b=>a.addToHistory(I([b.oldGraphic])))];case "move-3d":return[d.on("graphic-move-start",b=>{a.addToHistory(I(b.allGraphics));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:{dx:0,dy:0,mover:0<b.allGraphics.length?b.allGraphics[0]:null,type:"move-start"},type:"update"})}),d.on("graphic-move",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:b.dx,dy:b.dy,mover:0<b.allGraphics.length?b.allGraphics[0]:null,type:"move"},type:"update"})}),d.on("graphic-move-stop",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,
dy:0,mover:0<b.allGraphics.length?b.allGraphics[0]:null,type:"move-stop"},type:"update"})}),d.on("immediate-click",b=>{b.shiftKey?this._toggleSelection([b.graphic],a,c):a.toggleTool()})];case "transform-3d":return[d.on("record-undo",({record:b})=>{a.addToHistory({updates:[b]})}),d.on("graphic-translate-start",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,dx:b.dxScreen,dy:b.dyScreen,type:"move-start"},type:"update"})}),
d.on("graphic-translate-stop",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,dx:b.dxScreen,dy:b.dyScreen,type:"move-stop"},type:"update"})}),d.on("graphic-rotate-start",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,angle:b.angle,type:"rotate-start"},type:"update"})}),d.on("graphic-rotate-stop",b=>{this.emit("update",
{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,angle:b.angle,type:"rotate-stop"},type:"update"})}),d.on("graphic-scale-start",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,xScale:b.xScale,yScale:b.yScale,type:"scale-start"},type:"update"})}),d.on("graphic-scale-stop",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",
aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,xScale:b.xScale,yScale:b.yScale,type:"scale-stop"},type:"update"})}),d.on("graphic-translate",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,dx:b.dxScreen,dy:b.dyScreen,type:"move"},type:"update"})}),d.on("graphic-rotate",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,
angle:b.angle,type:"rotate"},type:"update"})}),d.on("graphic-scale",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:b.graphic,xScale:b.xScale,yScale:b.yScale,type:"scale"},type:"update"})}),d.on("immediate-click",b=>{b.shiftKey?this._toggleSelection([b.graphic],a,c):a.toggleTool()})];case "reshape-3d":return[d.on("reshape",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,
toolEventInfo:b,type:"update"})}),d.on("move",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:b,type:"update"})}),d.on("vertex-add",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:b,type:"update"})}),d.on("vertex-remove",b=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:b,type:"update"})}),
d.on("immediate-click",b=>{b.shiftKey?this._toggleSelection([b.graphic],a,c):a.toggleTool()})]}};m._onTransformOrReshape2DGraphicClick=function(a,c,d){const {graphic:b,viewEvent:e}=d;if(e.native?.shiftKey&&b.layer===this.layer)return e.stopPropagation(),a.removeFromSelection(b);if(c.toggleToolOnClick)return e.stopPropagation(),a.toggleTool()};m._setUpdateOperationHandle=function(a,c){this._operationHandle=a;const d=this.view?.map;this._disablePopup(c);a.on("complete",()=>{if(a===this._operationHandle){const b=
this.updateGraphics.toArray(),e=this._operationHandle.tool;this._operationHandle.destroy();this._operationHandle=null;this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray());this.updateGraphics.removeAll();d&&d.remove(this._internalGraphicsLayer);this._restorePopup(c);this.emit("update",{graphics:b,state:"complete",aborted:a.cancelled,tool:e,toolEventInfo:null,type:"update"})}})};m._getCommonUpdateOperationClickHandlers=function(){var a=t._asyncToGenerator(function*(c,d,b){const e=Z.createScreenPointFromEvent(d),
f=yield d.async(()=>this._getFirstHit(e));r.isNone(f)?c.complete():d.native.shiftKey&&this._toggleSelection([f.graphic],c,b)?d.stopPropagation():this.updateGraphics.includes(f.graphic)?d.stopPropagation():c.complete()});return function(c,d,b){return a.apply(this,arguments)}}();m._toggleSelection=function(a,c,d){const b=!!d.multipleSelectionEnabled;return a.some(e=>null==e?!1:b&&e.layer===this.layer?(this.updateGraphics.includes(e)?c.removeFromSelection(e):c.addToSelection(e),!0):!1)};m._getCommonUpdateOperationKeyDownHandlers=
function(a,c){if(a){var d=c.key;d===A.SKETCH_KEYS.undo&&a.canUndo()?(c.stopPropagation(),a.undo()):d===A.SKETCH_KEYS.redo&&a.canRedo()?(c.stopPropagation(),a.redo()):d===A.SKETCH_KEYS.cancel?(c.stopPropagation(),a.cancel()):this.allowDeleteKey&&A.SKETCH_KEYS.delete.includes(d)&&this._onDeleteKey(c)}};m._onDeleteKey=function(a){if(this._operationHandle&&"update"===this._operationHandle.type){var c=this.activeComponent,d=this.updateGraphics.toArray();r.isNone(c)||"reshape-3d"===c.type||"reshape"===
c.type&&(1!==d.length||"point"!==r.get(d[0].geometry,"type"))||(a.stopPropagation(),this.delete())}};m._removeDefaultLayer=function(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=r.destroyMaybe(this._internalGraphicsLayer))};m._isComponentGraphic=function(a){const {activeComponent:c}=this;return!a||r.isNone(c)?!1:a.attributes&&a.attributes.esriSketchTool||"draw-2d"===c.type&&c.graphic===a||("box"===c.type||"reshape"===c.type)&&c.isUIGraphic(a)};
m._displayPointerCursor=function(){this.view&&this.view.container&&"pointer"!==this.view.cursor&&(this.view.cursor="pointer")};m._displayGrabbingCursor=function(){this.view&&this.view.container&&"grabbing"!==this.view.cursor&&(this.view.cursor="grabbing")};m._displayDefaultCursor=function(){this.view&&this.view.container&&null!==this.view.cursor&&(this.view.cursor=null)};m._logError=function(a,c,d){ia.getLogger(this.declaredClass).error(new ha(a,c,d))};m._requireModule=function(){var a=t._asyncToGenerator(function*(c){const d=
new AbortController;this._moduleLoaderAbortController=d;c=yield c;return this._moduleLoaderAbortController!==d||d.signal.aborted?{requireError:"aborted"}:{module:c}});return function(c){return a.apply(this,arguments)}}();m._emitUndoEvent=function(a){this.emit("undo",{...a,type:"undo"})};m._emitRedoEvent=function(a){this.emit("redo",{...a,type:"redo"})};m._emitDeleteEvent=function(a){this.emit("delete",{...a,type:"delete"})};m.wait=function(){return G.whenOnce(()=>!this.updating)};m._beginAsyncOperation=
function(){this._numUpdating+=1;this.notifyChange("updating")};m._endAsyncOperation=function(){--this._numUpdating;this.notifyChange("updating")};m._disablePopupEnabled=function(a){return"3d"!==this.view?.type||this.updateOnGraphicClick||(r.unwrap(a)?.toggleToolOnClick??!1)};m._disablePopup=function(a){this._disablePopupEnabled(a)&&(a=this.view?.popup)&&r.isNone(this._originalAutoOpenEnabled)&&(this._originalAutoOpenEnabled=a.autoOpenEnabled,a.autoOpenEnabled=!1)};m._restorePopup=function(a){this._disablePopupEnabled(a)&&
(a=this.view?.popup)&&r.isSome(this._originalAutoOpenEnabled)&&(a.autoOpenEnabled=this._originalAutoOpenEnabled,this._originalAutoOpenEnabled=null)};m._waitViewReady=function(){var a=t._asyncToGenerator(function*(){const c=this.view;c?(r.abortMaybe(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,yield R.whenOrAbort(G.whenOnce(()=>c?.ready),this._viewReadyAbortController.signal)):this._logMissingView()});return function(){return a.apply(this,arguments)}}();m._logMissingView=
function(){this._logError("sketch:missing-property",ea("view"))};m._logMissingLayer=function(){this._logError("sketch:missing-property",ea("layer"))};t._createClass(D,[{key:"_defaultUpdateTool",get:function(){return"3d"===this.view?.type?"move":"transform"}},{key:"updating",get:function(){return 0<this._numUpdating||r.isSome(this._snappingManager)&&this._snappingManager.updating}},{key:"activeTool",get:function(){return this._operationHandle?.tool??null}},{key:"activeComponent",get:function(){return this._operationHandle?.activeComponent??
null}},{key:"createGraphic",get:function(){return!r.isSome(this.activeComponent)||"draw-3d"!==this.activeComponent.type&&"draw-2d"!==this.activeComponent.type?this._get("createGraphic"):r.unwrap(this.activeComponent.graphic)}},{key:"defaultCreateOptions",get:function(){return this._get("defaultCreateOptions")},set:function(a){this._set("defaultCreateOptions",{...da,...a})}},{key:"defaultUpdateOptions",get:function(){return this._get("defaultUpdateOptions")},set:function(a){this._set("defaultUpdateOptions",
{...Q,...a,reshapeOptions:{...Q.reshapeOptions,...a?.reshapeOptions}})}},{key:"snappingOptions",set:function(a){r.isSome(this._snappingManager)&&(this._snappingManager.options=a);this._set("snappingOptions",a)}},{key:"state",get:function(){const a=!(!this.view?.ready||!this.layer),c=this._operationHandle;return a&&c?"active":a?"ready":"disabled"}},{key:"view",get:function(){return this._get("view")},set:function(a){const c=this._get("view");if(c){const {container:d,map:b}=c;d&&(c.cursor=null);b&&
b.remove(this._internalGraphicsLayer);this._viewHandles.removeAll();this.cancel()}this._handles.remove("view-ready");a&&this._handles.add(G.when(()=>a.ready,d=>{this._viewHandles.removeAll();d&&this._viewHandles.add(this._generateViewHandles(a))},G.syncAndInitial),"view-ready");this._set("view",a)}},{key:"test",get:function(){return{operationHandle:this._operationHandle,defaultUpdateOptions:Q}}}]);return D}(v.EventedAccessor);w.__decorate([x.property()],v.prototype,"updating",null);w.__decorate([x.property()],
v.prototype,"_operationHandle",void 0);w.__decorate([x.property({readOnly:!0})],v.prototype,"activeTool",null);w.__decorate([x.property()],v.prototype,"activeFillSymbol",void 0);w.__decorate([x.property()],v.prototype,"activeLineSymbol",void 0);w.__decorate([x.property()],v.prototype,"activeVertexSymbol",void 0);w.__decorate([x.property()],v.prototype,"allowDeleteKey",void 0);w.__decorate([x.property({readOnly:!0})],v.prototype,"createGraphic",null);w.__decorate([x.property()],v.prototype,"defaultCreateOptions",
null);w.__decorate([x.property()],v.prototype,"defaultUpdateOptions",null);w.__decorate([x.property({type:W,nonNullable:!0})],v.prototype,"labelOptions",void 0);w.__decorate([x.property()],v.prototype,"layer",void 0);w.__decorate([x.property({types:J.symbolTypes})],v.prototype,"pointSymbol",void 0);w.__decorate([x.property({types:J.symbolTypes})],v.prototype,"polygonSymbol",void 0);w.__decorate([x.property({types:J.symbolTypes})],v.prototype,"polylineSymbol",void 0);w.__decorate([x.property({type:Y,
nonNullable:!0})],v.prototype,"snappingOptions",null);w.__decorate([x.property()],v.prototype,"_snappingManager",void 0);w.__decorate([x.property({readOnly:!0})],v.prototype,"state",null);w.__decorate([x.property({type:X,nonNullable:!0})],v.prototype,"tooltipOptions",void 0);w.__decorate([x.property({readOnly:!0})],v.prototype,"updateGraphics",void 0);w.__decorate([x.property()],v.prototype,"updateOnGraphicClick",void 0);w.__decorate([x.property({types:J.symbolTypes})],v.prototype,"updatePointSymbol",
void 0);w.__decorate([x.property({types:J.symbolTypes})],v.prototype,"updatePolygonSymbol",void 0);w.__decorate([x.property({types:J.symbolTypes})],v.prototype,"updatePolylineSymbol",void 0);w.__decorate([x.property({types:J.symbolTypes})],v.prototype,"vertexSymbol",void 0);w.__decorate([x.property({value:null})],v.prototype,"view",null);v=w.__decorate([ja.subclass("esri.widgets.Sketch.SketchViewModel")],v);const ea=y=>`Property '${y}' is missing on SketchViewModel.`;return v});