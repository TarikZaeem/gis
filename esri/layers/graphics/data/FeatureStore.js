// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/Evented ../../../core/Logger ../../../core/maybe ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../featureConversionUtils ./BoundsStore ./optimizedFeatureQueryEngineAdapter ./utils".split(" "),function(k,l,m,n,e,h,p,q,r,t,u){const v=h.create();return function(){function g(a){this.geometryInfo=a;this._boundsStore=new r.BoundsStore;this._featuresById=new Map;this._markedIds=new Set;
this.events=new m;this.featureAdapter=t.optimizedFeatureQueryEngineAdapter}var c=g.prototype;c.getFullExtent=function(a){if(e.isNone(this.fullBounds))return null;const [b,d,f,w]=this.fullBounds;return{xmin:b,ymin:d,xmax:f,ymax:w,spatialReference:u.cleanFromGeometryEngine(a)}};c.add=function(a){this._add(a);this._emitChanged()};c.addMany=function(a){for(const b of a)this._add(b);this._emitChanged()};c.clear=function(){this._featuresById.clear();this._boundsStore.clear();this._emitChanged()};c.removeById=
function(a){a=this._featuresById.get(a);if(!a)return null;this._remove(a);this._emitChanged();return a};c.removeManyById=function(a){this._boundsStore.invalidateIndex();for(const b of a)(a=this._featuresById.get(b))&&this._remove(a);this._emitChanged()};c.forEachBounds=function(a,b){for(const d of a)(a=this._boundsStore.get(d.objectId))&&b(h.fromRect(v,a))};c.getFeature=function(a){return this._featuresById.get(a)};c.has=function(a){return this._featuresById.has(a)};c.forEach=function(a){this._featuresById.forEach(b=>
a(b))};c.forEachInBounds=function(a,b){this._boundsStore.forEachInBounds(a,d=>{b(this._featuresById.get(d))})};c.startMarkingUsedFeatures=function(){this._boundsStore.invalidateIndex();this._markedIds.clear()};c.sweep=function(){let a=!1;this._featuresById.forEach((b,d)=>{this._markedIds.has(d)||(a=!0,this._remove(b))});this._markedIds.clear();a&&this._emitChanged()};c._emitChanged=function(){this.events.emit("changed",void 0)};c._add=function(a){if(a){var b=a.objectId;if(null==b)n.getLogger("esri.layers.graphics.data.FeatureStore").error(new l("featurestore:invalid-feature",
"feature id is missing",{feature:a}));else{var d=this._featuresById.get(b);this._markedIds.add(b);if(d){a.displayId=d.displayId;var f=this._boundsStore.get(b);this._boundsStore.delete(b)}else if(e.isSome(this.onFeatureAdd))this.onFeatureAdd(a);!e.isNone(a.geometry)&&a.geometry.coords&&a.geometry.coords.length?(f=q.getBoundsOptimizedGeometry(e.isSome(f)?f:p.create(),a.geometry,this.geometryInfo.hasZ,this.geometryInfo.hasM),e.isSome(f)&&this._boundsStore.set(b,f)):this._boundsStore.set(b,null);this._featuresById.set(b,
a)}}};c._remove=function(a){if(e.isSome(this.onFeatureRemove))this.onFeatureRemove(a);const b=a.objectId;this._markedIds.delete(b);this._boundsStore.delete(b);this._featuresById.delete(b);return a};k._createClass(g,[{key:"geometryType",get:function(){return this.geometryInfo.geometryType}},{key:"hasM",get:function(){return this.geometryInfo.hasM}},{key:"hasZ",get:function(){return this.geometryInfo.hasZ}},{key:"numFeatures",get:function(){return this._featuresById.size}},{key:"fullBounds",get:function(){return this._boundsStore.fullBounds}},
{key:"storeStatistics",get:function(){let a=0;this._featuresById.forEach(b=>{e.isSome(b.geometry)&&b.geometry.coords&&(a+=b.geometry.coords.length)});return{featureCount:this._featuresById.size,vertexCount:a/(this.hasZ?this.hasM?4:3:this.hasM?3:2)}}}]);return g}()});