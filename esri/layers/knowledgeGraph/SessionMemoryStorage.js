// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define(["../graphics/featureConversionUtils","../graphics/OptimizedFeature"],function(m,k){return function(){function e(){this._featureLookup=new Map}e.getInstance=function(){e.instance||(e.instance=new e);return e.instance};var g=e.prototype;g.deleteFromStore=function(b){b.forEach(d=>{this._featureLookup.delete(d)})};g.readFromStoreByList=function(b){const d=[];b.forEach(f=>{(f=this.readFromStoreById(f))&&d.push(f)});return d};g.readFromStoreById=function(b){return(b=this._featureLookup.get(b))?
b:null};g.writeToStore=function(b,d,f){const l=[];b.forEach(a=>{if(a&&a.id){a.properties||(a.properties=[]);var c=null;f&&(c=a.properties[f]?m.convertFromGeometry(a.properties[f]):null);"originId"in a&&"destinationId"in a&&(a.properties.ESRI__ORIGIN_ID=a.originId,a.properties.ESRI__DESTINATION_ID=a.destinationId);if((a.properties[d]=a.id)&&this._featureLookup.has(a.id)){const h=this._featureLookup.get(a.id);c=new k.OptimizedFeature(c?JSON.parse(JSON.stringify(c)):h?.geometry?JSON.parse(JSON.stringify(h.geometry)):
null,JSON.parse(JSON.stringify(Object.assign(a.properties,h?.attributes))),null,a.properties[d])}else c=new k.OptimizedFeature(c?JSON.parse(JSON.stringify(c)):null,a.properties,null,a.properties[d]);this._featureLookup.set(a.id,c);l.push(c)}});return l};return e}()});