// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../core/maybe ../../core/workers/workers ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ../../geometry/projection ../../geometry/support/spatialReferenceUtils ../Layer ../graphics/data/FeatureStore ../graphics/data/QueryEngine ../graphics/sources/support/clientSideDefaults ./KnowledgeGraphLayerDataManager ./KnowledgeGraphSubLayerBase ../mixins/BlendLayer ../mixins/FeatureReductionLayer ../mixins/RefreshableLayer ../mixins/ScaleRangeLayer ../support/Field ../support/fieldUtils ../../rest/support/FeatureSet ../../rest/support/Query ../../support/popupUtils ../../core/workers/RemoteClient ../../geometry/Extent ../../geometry/Polygon ../../geometry/Polyline ../../geometry/support/typeUtils".split(" "),
function(k,f,e,z,S,T,U,V,W,X,Y,Z,u,A,B,aa,g,ba,ca,C,p,q,D,E,F,r,v,G,H,I,J,K,w,L,M,n,N,O,x,P,Q,m){e=function(y){function t(c){var a=y.call(this,c)||this;a.capabilities=r.createCapabilities(!1,!1);a.displayField="";a.geometryFieldName=null;a.hasM=!1;a.hasZ=!1;a.objectIdField=v.MOCK_OID_FIELD_NAME;a.popupTemplate=null;a.source={openPorts:()=>a.load().then(()=>{const b=new MessageChannel;new O(b.port1,{channel:b,client:{queryFeatures:(d,l={})=>{d=n.fromJSON(d);return a.queryFeaturesJSON(d,l)}}},()=>null);
return[b.port2]})};a.type="knowledge-graph-sublayer";if("link-chart"===c.parentCompositeLayer.type)a.geometryType="relationship"===c.graphType?"polyline":"point",a.geometryFieldName=v.MOCK_LAYOUT_GEOMETRY_FIELD_NAME;else if(c.parentCompositeLayer.dataManager.geographicLookup.get(c.objectType.name)?.geometryType&&"esriGeometryNull"!==c.parentCompositeLayer.dataManager.geographicLookup.get(c.objectType.name)?.geometryType){const b=c.parentCompositeLayer.dataManager.geographicLookup.get(c.objectType.name);
a.geometryFieldName=b?.name?b.name:null;a.geometryType=b?.geometryType?m.featureGeometryTypeKebabDictionary.fromJSON(b.geometryType):null;b?.name&&c.objectType.properties&&c.objectType.properties[b.name]?(a.hasM=c.objectType.properties[b.name].hasM,a.hasZ=c.objectType.properties[b.name].hasZ):(a.hasM=!1,a.hasZ=!1)}else a.geometryType=null;c.objectType.properties?.forEach(b=>{let d=b.fieldType;"esriFieldTypeOID"===d&&(d="esriFieldTypeInteger");a.fields.push(w.fromJSON({name:b.name,type:d,alias:b.alias,
defaultValue:null,editable:b.editable,nullable:b.nullable}))});a.fields.push(w.fromJSON({name:a.objectIdField,type:"esriFieldTypeString",alias:a.objectIdField,editable:!1}));c.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference&&(a.spatialReference=c.parentCompositeLayer.dataManager.knowledgeGraph.dataModel.spatialReference);a.renderer="link-chart"===c.parentCompositeLayer.type?"relationship"===c.graphType?u.fromJSON(r.createDrawingInfo(m.featureGeometryTypeKebabDictionary.toJSON("polyline")).renderer):
u.fromJSON(r.createDrawingInfo(m.featureGeometryTypeKebabDictionary.toJSON("point")).renderer):u.fromJSON(r.createDrawingInfo(m.featureGeometryTypeKebabDictionary.toJSON(a.geometryType)).renderer);return a}k._inheritsLoose(t,y);var h=t.prototype;h.createPopupTemplate=function(c){return N.createPopupTemplate(this,c)};h.createQuery=function(){return new n({where:"1\x3d1",outFields:["*"]})};h.getField=function(c){for(let a=0;a<this.fields.length;a++)if(this.fields[a].name===c)return this.fields[a];throw Error("Field not found");
};h.getFieldDomain=function(c,a){return null};h.queryFeatures=function(){var c=k._asyncToGenerator(function*(a,b){const {resolvedQuery:d,queryEngine:l}=yield this._setupQueryObjects(a);a=M.fromJSON(yield l.executeQuery(d.toJSON(),b?.signal));a.features.forEach(R=>{R.sourceLayer=this});return a});return function(a,b){return c.apply(this,arguments)}}();h.queryFeaturesJSON=function(){var c=k._asyncToGenerator(function*(a,b){const {resolvedQuery:d,queryEngine:l}=yield this._setupQueryObjects(a);return yield l.executeQuery(d.toJSON(),
b?.signal)});return function(a,b){return c.apply(this,arguments)}}();h.queryFeatureCount=function(){var c=k._asyncToGenerator(function*(a,b){const {resolvedQuery:d,queryEngine:l}=yield this._setupQueryObjects(a);return l.executeQueryForCount(d.toJSON(),b?.signal)});return function(a,b){return c.apply(this,arguments)}}();h.queryExtent=function(){var c=k._asyncToGenerator(function*(a={},b){const {resolvedQuery:d,queryEngine:l}=yield this._setupQueryObjects({...a,returnGeometry:!0});a=yield l.executeQueryForExtent(d.toJSON(),
b?.signal);b=null!=a.extent?.xmin&&null!=a.extent?.xmax&&null!=a.extent?.ymin&&null!=a.extent?.ymax?new x(a.extent):new x;return{count:a.count,extent:b}});return function(){return c.apply(this,arguments)}}();h.queryObjectIds=function(){var c=k._asyncToGenerator(function*(a,b){a=n.from(a);if("link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine)var d=this._cachedQueryEngine;else d=yield this.parentCompositeLayer.dataManager.getData(a,this,b),d=this.loadQueryEngine(d);return d.executeQueryForIds(a.toJSON(),
b?.signal)});return function(a,b){return c.apply(this,arguments)}}();h.loadQueryEngine=function(c){var a=new E({geometryType:m.featureGeometryTypeKebabDictionary.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ});a=new F.QueryEngine({fields:this.fields.map(b=>b.toJSON()),geometryType:m.featureGeometryTypeKebabDictionary.toJSON(this.geometryType),hasM:this.hasM,hasZ:this.hasZ,objectIdField:this.objectIdField,spatialReference:this.spatialReference.toJSON(),timeInfo:null,featureStore:a});a.featureStore.addMany(c);
return a};h.refreshCachedQueryEngine=function(){var c=k._asyncToGenerator(function*(){const a=yield this.parentCompositeLayer.dataManager.getData(new n({where:"1\x3d1",outFields:[v.MOCK_OID_FIELD_NAME]}),this);this._cachedQueryEngine=this.loadQueryEngine(a)});return function(){return c.apply(this,arguments)}}();h._setupQueryObjects=function(){var c=k._asyncToGenerator(function*(a,b){a=n.from(a);const d=B.unwrap(a.geometry);d&&!d.spatialReference?.isWGS84&&(yield p.initializeProjection(d.spatialReference,
q.WGS84),a.geometry=d instanceof P?p.project(d,q.WGS84):d instanceof Q?p.project(d,q.WGS84):p.project(d.extent,q.WGS84));"link-chart"===this.parentCompositeLayer.type&&this._cachedQueryEngine?b=this._cachedQueryEngine:(b=yield this.parentCompositeLayer.dataManager.getData(a,this,b),b=this.loadQueryEngine(b));return{resolvedQuery:a,queryEngine:b}});return function(a,b){return c.apply(this,arguments)}}();k._createClass(t,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},
{key:"renderer",set:function(c){L.fixRendererFields(c,this.fieldsIndex);this._set("renderer",c)}}]);return t}(I.FeatureReductionLayer(G.KnowledgeGraphSubLayerBase(H.BlendLayer(K.ScaleRangeLayer(J.RefreshableLayer(D))))));f.__decorate([g.property()],e.prototype,"capabilities",void 0);f.__decorate([g.property({readOnly:!0})],e.prototype,"defaultPopupTemplate",null);f.__decorate([g.property()],e.prototype,"definitionExpression",void 0);f.__decorate([g.property()],e.prototype,"displayField",void 0);f.__decorate([g.property()],
e.prototype,"elevationInfo",void 0);f.__decorate([g.property()],e.prototype,"geometryType",void 0);f.__decorate([g.property()],e.prototype,"geometryFieldName",void 0);f.__decorate([g.property()],e.prototype,"graphType",void 0);f.__decorate([g.property()],e.prototype,"hasM",void 0);f.__decorate([g.property()],e.prototype,"hasZ",void 0);f.__decorate([g.property()],e.prototype,"labelsVisible",void 0);f.__decorate([g.property()],e.prototype,"labelingInfo",void 0);f.__decorate([g.property()],e.prototype,
"objectIdField",void 0);f.__decorate([g.property()],e.prototype,"objectType",void 0);f.__decorate([g.property()],e.prototype,"parentCompositeLayer",void 0);f.__decorate([g.property({type:z,json:{name:"popupInfo",write:!0}})],e.prototype,"popupTemplate",void 0);f.__decorate([g.property({types:A.rendererTypes,json:{write:{target:"layerDefinition.drawingInfo.renderer"}}})],e.prototype,"renderer",null);f.__decorate([g.property()],e.prototype,"source",void 0);f.__decorate([g.property({json:{read:!1}})],
e.prototype,"type",void 0);return e=f.__decorate([C.subclass("esri.layers.knowledgeGraph.KnowledgeGraphSubLayer")],e)});