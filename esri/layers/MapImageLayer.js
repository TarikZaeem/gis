// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
require({cache:{"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(n,l){function c(d,m){m=l.getMetersPerUnitForSR(m);return d/(m*l.inchesPerMeter*96)}n.getExtentForScale=function(d,m){const e=d.extent;d=d.width-(d.padding?d.padding.left+d.padding.right:0);m=c(m,e.spatialReference);return e.clone().expand(m*d/e.width)};n.getResolutionForScale=c;n.getResolutionInMetersForScale=function(d){return d/(96*l.inchesPerMeter)};n.getScale=function(d,m){m=m||d.extent;
d=d.width;const e=l.getMetersPerUnitForSR(m&&m.spatialReference);return m&&d?m.width/d*e*l.inchesPerMeter*96:0};n.getScaleForResolution=function(d,m){m=l.getMetersPerUnitForSR(m);return d*m*l.inchesPerMeter*96};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/ArcGISMapService":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/promiseUtils ../../core/urlUtils ../../core/Version ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../geometry/Extent ../../geometry/SpatialReference ../support/commonProperties".split(" "),
function(n,l,c,d,m,e,A,p,F,ca,K,ha,ia,H,Z){n.ArcGISMapService=L=>{L=function(P){function W(){var t=P.apply(this,arguments)||this;t.capabilities=void 0;t.copyright=null;t.fullExtent=null;t.legendEnabled=!0;t.spatialReference=null;t.version=void 0;t._allLayersAndTablesPromise=null;t._allLayersAndTablesMap=null;return t}l._inheritsLoose(W,P);var k=W.prototype;k.readCapabilities=function(t,q){var w=q.capabilities&&q.capabilities.split(",").map(Q=>Q.toLowerCase().trim());if(!w)return{operations:{supportsExportMap:!1,
supportsExportTiles:!1,supportsIdentify:!1,supportsQuery:!1,supportsTileMap:!1},exportMap:null,exportTiles:null};var x=this.type;t="tile"!==x&&!!q.supportsDynamicLayers;const N=w.includes("query"),v=w.includes("map"),B=!!q.exportTilesAllowed,E=w.includes("tilemap");w=w.includes("data");const S="tile"!==x&&(!q.tileInfo||t),X="tile"!==x&&(!q.tileInfo||t);x="tile"!==x;var r=q.cimVersion&&A.Version.parse(q.cimVersion);const da=r?.since(1,4)??!1;r=r?.since(2,0)??!1;return{operations:{supportsExportMap:v,
supportsExportTiles:B,supportsIdentify:N,supportsQuery:w,supportsTileMap:E},exportMap:v?{supportsArcadeExpressionForLabeling:da,supportsSublayersChanges:x,supportsDynamicLayers:t,supportsSublayerVisibility:S,supportsSublayerDefinitionExpression:X,supportsCIMSymbols:r}:null,exportTiles:B?{maxExportTilesCount:+q.maxExportTilesCount}:null}};k.readVersion=function(t,q){(t=q.currentVersion)||(t=q.hasOwnProperty("capabilities")||q.hasOwnProperty("tables")?10:q.hasOwnProperty("supportedImageFormatTypes")?
9.31:9.3);return t};k.fetchSublayerInfo=function(){var t=l._asyncToGenerator(function*(q,w){try{return yield this.fetchAllLayersAndTables(w),this._allLayersAndTablesMap?.get(q)}catch{}});return function(q,w){return t.apply(this,arguments)}}();k.fetchAllLayersAndTables=function(){var t=l._asyncToGenerator(function*(q){yield this.load(q);this._allLayersAndTablesPromise||(this._allLayersAndTablesPromise=d(e.urlToObject(this.url).path+"/layers",{responseType:"json",query:{f:"json",...this.customParameters,
token:this.apiKey}}).then(x=>{this._allLayersAndTablesMap=new Map;for(const N of x.data.layers)this._allLayersAndTablesMap.set(N.id,N);return{result:x.data}},x=>({error:x})));const w=yield this._allLayersAndTablesPromise;m.throwIfAborted(q);if("result"in w)return w.result;throw w.error;});return function(q){return t.apply(this,arguments)}}();return W}(L);c.__decorate([p.property({readOnly:!0})],L.prototype,"capabilities",void 0);c.__decorate([K.reader("service","capabilities",["capabilities","exportTilesAllowed",
"maxExportTilesCount","supportsDynamicLayers","tileInfo"])],L.prototype,"readCapabilities",null);c.__decorate([p.property({json:{read:{source:"copyrightText"}}})],L.prototype,"copyright",void 0);c.__decorate([p.property({type:ia})],L.prototype,"fullExtent",void 0);c.__decorate([p.property(Z.id)],L.prototype,"id",void 0);c.__decorate([p.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],L.prototype,"legendEnabled",void 0);c.__decorate([p.property(Z.popupEnabled)],
L.prototype,"popupEnabled",void 0);c.__decorate([p.property({type:H})],L.prototype,"spatialReference",void 0);c.__decorate([p.property({readOnly:!0})],L.prototype,"version",void 0);c.__decorate([K.reader("version",["currentVersion","capabilities","tables","supportedImageFormatTypes"])],L.prototype,"readVersion",null);return L=c.__decorate([ha.subclass("esri.layers.mixins.ArcGISMapService")],L)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/core/Version":function(){define(["exports",
"./Error"],function(n,l){let c=function(){function d(e,A,p=""){this.major=e;this.minor=A;this._context=p}var m=d.prototype;m.lessThan=function(e,A){return this.major<e||e===this.major&&this.minor<A};m.since=function(e,A){return!this.lessThan(e,A)};m.validate=function(e){if(this.major!==e.major)throw new l((this._context&&this._context+":")+"unsupported-version",`Required major ${this._context&&this._context+" "}version is '${this.major}', but got '\${version.major}.\${version.minor}'`,{version:e});
};m.clone=function(){return new d(this.major,this.minor,this._context)};d.parse=function(e,A=""){const [p,F]=e.split(".");var ca=/^\s*\d+\s*$/;if(!p||!p.match||!p.match(ca))throw new l((A&&A+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:e});if(!F||!F.match||!F.match(ca))throw new l((A&&A+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",{version:e});e=parseInt(p,10);ca=parseInt(F,10);return new d(e,ca,A)};return d}();
n.Version=c;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/mixins/SublayersOwner":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/CollectionFlattener ../../core/Error ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/utils ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/PropertyOrigin ../support/Sublayer ../support/sublayerUtils".split(" "),
function(n,l,c,d,m,e,A,p,F,ca,K,ha,ia,H,Z,L){function P(q,w){const x=[],N={};if(!q)return x;q.forEach(v=>{const B=new Z;B.read(v,w);N[B.id]=B;null!=v.parentLayerId&&-1!==v.parentLayerId?(v=N[v.parentLayerId],v.sublayers||(v.sublayers=[]),v.sublayers.unshift(B)):x.unshift(B)});return x}function W(q,w){q&&q.forEach(x=>{w(x);x.sublayers&&x.sublayers.length&&W(x.sublayers,w)})}const k=A.getLogger("esri.layers.TileLayer"),t=d.ofType(Z);n.SublayersOwner=q=>{q=function(w){function x(...v){var B=w.call(this,
...v)||this;B.allSublayers=new m({getCollections:()=>[B.sublayers],getChildrenFunction(E){return E.sublayers}});B.sublayersSourceJSON={[H.OriginId.SERVICE]:{},[H.OriginId.PORTAL_ITEM]:{},[H.OriginId.WEB_SCENE]:{},[H.OriginId.WEB_MAP]:{}};B.addHandles(p.watch(()=>B.sublayers,(E,S)=>B._handleSublayersChange(E,S),p.sync));return B}l._inheritsLoose(x,w);var N=x.prototype;N.readSublayers=function(v,B){if(B&&v){var {sublayersSourceJSON:E}=this,S=H.nameToId(B.origin);if(!(S<H.OriginId.SERVICE||(E[S]={context:B,
visibleLayers:v.visibleLayers||E[S].visibleLayers,layers:v.layers||E[S].layers},S>H.OriginId.SERVICE))){this._set("serviceSublayers",this.createSublayersForOrigin("service").sublayers);var {sublayers:X,origin:r}=this.createSublayersForOrigin("web-document");v=ha.getProperties(this);v.setDefaultOrigin(r);this._set("sublayers",new t(X));v.setDefaultOrigin("user")}}};N.findSublayerById=function(v){return this.allSublayers.find(B=>B.id===v)};N.createServiceSublayers=function(){return this.createSublayersForOrigin("service").sublayers};
N.createSublayersForOrigin=function(v){const B="web-document"===v?H.nameToId("web-map"):H.nameToId(v);let E=H.OriginId.SERVICE;v=this.sublayersSourceJSON[H.OriginId.SERVICE].layers;let S=this.sublayersSourceJSON[H.OriginId.SERVICE].context,X=null;var r=[H.OriginId.PORTAL_ITEM,H.OriginId.WEB_SCENE,H.OriginId.WEB_MAP].filter(y=>y<=B);for(var da of r)r=this.sublayersSourceJSON[da],L.isSublayerOverhaul(r.layers)&&(E=da,v=r.layers,S=r.context,r.visibleLayers&&(X={visibleLayers:r.visibleLayers,context:r.context}));
da=[H.OriginId.PORTAL_ITEM,H.OriginId.WEB_SCENE,H.OriginId.WEB_MAP].filter(y=>y>E&&y<=B);let Q=null;for(var ja of da){const {layers:y,visibleLayers:ka,context:la}=this.sublayersSourceJSON[ja];y&&(Q={layers:y,context:la});ka&&(X={visibleLayers:ka,context:la})}ja=P(v,S);const ea=new Map,aa=new Set;if(Q)for(const y of Q.layers)ea.set(y.id,y);if(X?.visibleLayers)for(const y of X.visibleLayers)aa.add(y);W(ja,y=>{Q&&y.read(ea.get(y.id),Q.context);X&&y.read({defaultVisibility:aa.has(y.id)},X.context)});
return{origin:H.idToName(E),sublayers:new t({items:ja})}};N.read=function(v,B){w.prototype.read.call(this,v,B);this.readSublayers(v,B)};N._handleSublayersChange=function(v,B){B&&(B.forEach(E=>{E.parent=null;E.layer=null}),this.handles.remove("sublayers-owner"));v&&(v.forEach(E=>{E.parent=this;E.layer=this}),this.handles.add([v.on("after-add",({item:E})=>{E.parent=this;E.layer=this}),v.on("after-remove",({item:E})=>{E.parent=null;E.layer=null})],"sublayers-owner"),"tile"===this.type&&this.handles.add(v.on("before-changes",
E=>{k.error(new e("tilelayer:sublayers-non-modifiable","ISublayer can't be added, moved, or removed from the layer's sublayers",{layer:this}));E.preventDefault()}),"sublayers-owner"))};return x}(q);c.__decorate([F.property({readOnly:!0})],q.prototype,"allSublayers",void 0);c.__decorate([F.property({readOnly:!0,type:d.ofType(Z)})],q.prototype,"serviceSublayers",void 0);c.__decorate([F.property({value:null,type:t,json:{read:!1,write:{allowNull:!0,ignoreOrigin:!0}}})],q.prototype,"sublayers",void 0);
c.__decorate([F.property({readOnly:!0})],q.prototype,"sublayersSourceJSON",void 0);return q=c.__decorate([ia.subclass("esri.layers.mixins.SublayersOwner")],q)};n.forEachSublayer=W;Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/Sublayer":function(){define("require ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../renderers/support/types ../../request ../../symbols ../../core/Collection ../../core/Error ../../core/HandleOwner ../../core/has ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/sql ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/ensureType ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/utils ../graphics/sources/support/QueryTask ./FeatureType ./Field ./FieldsIndex ./LabelClass ./labelingInfo ./LayerFloorInfo ./serviceCapabilitiesUtils ./source/DataLayerSource ./source/MapLayerSource ../../rest/support/AttachmentQuery ../../rest/support/Query ../../support/popupUtils ../../geometry/Extent ../../geometry/support/typeUtils".split(" "),
function(n,l,c,d,m,e,A,p,F,ca,K,ha,ia,H,Z,L,P,W,k,t,q,w,x,N,v,B,E,S,X,r,da,Q,ja,ea,aa,y,ka,la,pa,oa,Y,g,z,D,I,J,T,R,M,fa,na,sa){function ta(G){return null!=G&&"esriSMS"===G.type}function ua(G,V,u){G=this.originIdOf(V)>=y.nameToId(u.origin);return{ignoreOrigin:!0,allowNull:G,enabled:u?"map-image"===u.layer?.type&&(u.writeSublayerStructure||G):!1}}function va(G,V,u){return{enabled:u?"tile"===u.layer?.type&&this._isOverridden(V):!1}}function ba(G,V,u){return{ignoreOrigin:!0,enabled:u&&u.writeSublayerStructure||
!1}}function qa(G,V,u){return{ignoreOrigin:!0,enabled:u?u.writeSublayerStructure||this.originIdOf(V)>=y.nameToId(u.origin):!1}}var ra;let xa=0;const ma=new Set;ma.add("layer");ma.add("parent");ma.add("loaded");ma.add("loadStatus");ma.add("loadError");ma.add("loadWarnings");d=ra=function(G){function V(a){a=G.call(this,a)||this;a.capabilities=void 0;a.fields=null;a.fullExtent=null;a.geometryType=null;a.globalIdField=null;a.legendEnabled=!0;a.objectIdField=null;a.popupEnabled=!0;a.popupTemplate=null;
a.sourceJSON=null;a.title=null;a.typeIdField=null;a.types=null;a._lastParsedUrl=null;return a}l._inheritsLoose(V,G);var u=V.prototype;u.load=function(){var a=l._asyncToGenerator(function*(b){var f=this;this.addResolvingPromise(l._asyncToGenerator(function*(){const {layer:h,source:C,url:U}=f;if(!h&&!U)throw new k("sublayer:missing-layer","Sublayer can't be loaded without being part of a layer",{sublayer:f});var O=null;!h||f.originIdOf("url")>y.OriginId.SERVICE||"data-layer"===C?.type?O=(yield L(U,
{responseType:"json",query:{f:"json"},...b})).data:(O=f.id,"map-layer"===C?.type&&(O=C.mapLayerId),O=yield h.fetchSublayerInfo(O,b));O&&(f.sourceJSON=O,f.read({layerDefinition:O},{origin:"service"}))})());return this});return function(b){return a.apply(this,arguments)}}();u.readCapabilities=function(a,b){b=b.layerDefinition||b;const {operations:{supportsQuery:f,supportsQueryAttachments:h},query:{supportsFormatPBF:C},data:{supportsAttachment:U}}=I.getFeatureLayerCapabilities(b,this.url);return{exportMap:{supportsModification:!!b.canModifyLayer},
operations:{supportsQuery:f,supportsQueryAttachments:h},data:{supportsAttachment:U},query:{supportsFormatPBF:C}}};u.readGlobalIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.globalIdField)return b.globalIdField;if(b.fields)for(const f of b.fields)if("esriFieldTypeGlobalID"===f.type)return f.name};u.writeLabelingInfo=function(a,b,f,h){a&&a.length&&(b.layerDefinition={drawingInfo:{labelingInfo:a.map(C=>C.write({},h))}})};u.readMinScale=function(a,b){return b.minScale||b.layerDefinition&&
b.layerDefinition.minScale||0};u.readMaxScale=function(a,b){return b.maxScale||b.layerDefinition&&b.layerDefinition.maxScale||0};u.readObjectIdFieldFromService=function(a,b){b=b.layerDefinition||b;if(b.objectIdField)return b.objectIdField;if(b.fields)for(const f of b.fields)if("esriFieldTypeOID"===f.type)return f.name};u.readOpacity=function(a,b){a=b.layerDefinition;return 1-.01*((null!=a?.transparency?a.transparency:a?.drawingInfo?.transparency)??0)};u.writeOpacity=function(a,b,f,h){b.layerDefinition=
{drawingInfo:{transparency:100-100*a}}};u.writeParent=function(a,b){b.parentLayerId=this.parent&&this.parent!==this.layer?aa.ensureInteger(this.parent.id):-1};u.castSublayers=function(a){return aa.ensureType(W.ofType(ra),a)};u.writeSublayers=function(a,b,f){this.sublayers?.length&&(b[f]=this.sublayers.map(h=>h.id).toArray().reverse())};u.readTypeIdField=function(a,b){b=b.layerDefinition||b;let f=b.typeIdField;f&&b.fields&&(f=f.toLowerCase(),a=b.fields.find(h=>h.name.toLowerCase()===f))&&(f=a.name);
return f};u.writeVisible=function(a,b,f,h){b[f]=this.getAtOrigin("defaultVisibility","service")||a};u.clone=function(){const {store:a}=ka.getProperties(this),b=new ra;ka.getProperties(b).store=a.clone(ma);this.commitProperty("url");b._lastParsedUrl=this._lastParsedUrl;return b};u.createPopupTemplate=function(a){return fa.createPopupTemplate(this,a)};u.createQuery=function(){return new M({returnGeometry:!0,where:this.definitionExpression||"1\x3d1"})};u.createFeatureLayer=function(){var a=l._asyncToGenerator(function*(){if(this.hasOwnProperty("sublayers"))return null;
const {layer:b}=this,f=b?.parsedUrl,h=new (yield new Promise((C,U)=>n(["../FeatureLayer"],O=>C(Object.freeze(Object.defineProperty({__proto__:null,default:O},Symbol.toStringTag,{value:"Module"}))),U))).default({url:f?.path});f&&this.source&&("map-layer"===this.source.type?h.layerId=this.source.mapLayerId:h.dynamicDataSource=this.source);null!=b?.refreshInterval&&(h.refreshInterval=b.refreshInterval);this.definitionExpression&&(h.definitionExpression=this.definitionExpression);this.floorInfo&&(h.floorInfo=
x.clone(this.floorInfo));this.originIdOf("labelingInfo")>y.OriginId.SERVICE&&(h.labelingInfo=x.clone(this.labelingInfo));this.originIdOf("labelsVisible")>y.OriginId.DEFAULTS&&(h.labelsVisible=this.labelsVisible);this.originIdOf("legendEnabled")>y.OriginId.DEFAULTS&&(h.legendEnabled=this.legendEnabled);this.originIdOf("visible")>y.OriginId.DEFAULTS&&(h.visible=this.visible);this.originIdOf("minScale")>y.OriginId.DEFAULTS&&(h.minScale=this.minScale);this.originIdOf("maxScale")>y.OriginId.DEFAULTS&&
(h.maxScale=this.maxScale);this.originIdOf("opacity")>y.OriginId.DEFAULTS&&(h.opacity=this.opacity);this.originIdOf("popupTemplate")>y.OriginId.DEFAULTS&&(h.popupTemplate=x.clone(this.popupTemplate));this.originIdOf("renderer")>y.OriginId.SERVICE&&(h.renderer=x.clone(this.renderer));"data-layer"===this.source?.type&&(h.dynamicDataSource=this.source.clone());this.originIdOf("title")>y.OriginId.DEFAULTS&&(h.title=this.title);"map-image"===b?.type&&b.originIdOf("customParameters")>y.OriginId.DEFAULTS&&
(h.customParameters=b.customParameters);"tile"===b?.type&&b.originIdOf("customParameters")>y.OriginId.DEFAULTS&&(h.customParameters=b.customParameters);return h});return function(){return a.apply(this,arguments)}}();u.getField=function(a){return this.fieldsIndex.get(a)};u.getFeatureType=function(a){const {typeIdField:b,types:f}=this;if(!b||!a)return null;const h=a.attributes?a.attributes[b]:void 0;if(null==h)return null;let C=null;f?.some(U=>{const {id:O}=U;if(null==O)return!1;O.toString()===h.toString()&&
(C=U);return!!C});return C};u.getFieldDomain=function(a,b){return(b=this.getFeatureType(b&&b.feature))&&(b=b.domains&&b.domains[a])&&"inherited"!==b.type?b:this._getLayerDomain(a)};u.queryAttachments=function(){var a=l._asyncToGenerator(function*(b,f){yield this.load();b=R.from(b);const h=this.capabilities;if(!h?.data?.supportsAttachment)throw new k("queryAttachments:not-supported","this layer doesn't support attachments");const {attachmentTypes:C,objectIds:U,globalIds:O,num:ya,size:za,start:Aa,where:wa}=
b;if(!h?.operations?.supportsQueryAttachments&&(0<C?.length||0<O?.length||0<za?.length||ya||Aa||wa))throw new k("queryAttachments:option-not-supported","when 'capabilities.operations.supportsQueryAttachments' is false, only objectIds is supported",b);if(!(U?.length||O?.length||wa))throw new k("queryAttachments:invalid-query","'objectIds', 'globalIds', or 'where' are required to perform attachment query",b);return this.queryTask.executeAttachmentQuery(b,f)});return function(b,f){return a.apply(this,
arguments)}}();u.queryFeatures=function(){var a=l._asyncToGenerator(function*(b=this.createQuery(),f){yield this.load();if(!this.capabilities.operations.supportsQuery)throw new k("queryFeatures:not-supported","this layer doesn't support queries.");if(!this.url)throw new k("queryFeatures:not-supported","this layer has no url.");b=yield this.queryTask.execute(b,{...f,query:{...this.layer?.customParameters,token:this.layer?.apiKey}});if(b?.features)for(const h of b.features)h.sourceLayer=this;return b});
return function(){return a.apply(this,arguments)}}();u.toExportImageJSON=function(a){const b={id:this.id,source:this.source?.toJSON()||{mapLayerId:this.id,type:"mapLayer"}};a=S.sqlAnd(a,this.definitionExpression);B.isSome(a)&&(b.definitionExpression=a);const f=["renderer","labelingInfo","opacity","labelsVisible"].reduce((h,C)=>{h[C]=this.originIdOf(C);return h},{});if(Object.keys(f).some(h=>f[h]>y.OriginId.SERVICE)){a=b.drawingInfo={};f.renderer>y.OriginId.SERVICE&&(a.renderer=this.renderer?this.renderer.toJSON():
null);f.labelsVisible>y.OriginId.SERVICE&&(a.showLabels=this.labelsVisible);if(this.labelsVisible&&f.labelingInfo>y.OriginId.SERVICE){!this.loaded&&this.labelingInfo.some(C=>!C.labelPlacement)&&v.getLogger(this.declaredClass).warnOnce(`A Sublayer (title: ${this.title}, id: ${this.id}) has an undefined 'labelPlacement' `+"and so labels cannot be displayed. Either define a valid 'labelPlacement' or call Sublayer.load() to use a default value based on geometry type.",{sublayer:this});let h=this.labelingInfo;
B.isSome(this.geometryType)&&(h=z.validateLabelingInfo(this.labelingInfo,sa.featureGeometryTypeKebabDictionary.toJSON(this.geometryType)));a.labelingInfo=h.filter(C=>C.labelPlacement).map(C=>C.toJSON({origin:"service",layer:this.layer}));a.showLabels=!0}f.opacity>y.OriginId.SERVICE&&(a.transparency=100-100*this.opacity);this._assignDefaultSymbolColors(a.renderer)}return b};u._assignDefaultSymbolColors=function(a){this._forEachSimpleMarkerSymbols(a,b=>{b.color||"esriSMSX"!==b.style&&"esriSMSCross"!==
b.style||(b.color=b.outline&&b.outline.color?b.outline.color:[0,0,0,0])})};u._forEachSimpleMarkerSymbols=function(a,b){if(a){const f=("uniqueValueInfos"in a?a.uniqueValueInfos:"classBreakInfos"in a?a.classBreakInfos:null)??[];for(const h of f)ta(h.symbol)&&b(h.symbol);"symbol"in a&&ta(a.symbol)&&b(a.symbol);"defaultSymbol"in a&&ta(a.defaultSymbol)&&b(a.defaultSymbol)}};u._setAndNotifyLayer=function(a,b){const f=this.layer,h=this._get(a);let C,U;switch(a){case "definitionExpression":case "floorInfo":C=
"supportsSublayerDefinitionExpression";break;case "minScale":case "maxScale":case "visible":C="supportsSublayerVisibility";break;case "labelingInfo":case "labelsVisible":case "opacity":case "renderer":case "source":C="supportsDynamicLayers",U="supportsModification"}const O=ka.getProperties(this).getDefaultOrigin();if("service"!==O){if(C&&!1===this.layer?.capabilities?.exportMap?.[C]){this._logLockedError(a,`capability not available 'layer.capabilities.exportMap.${C}'`);return}if(U&&!1===this.capabilities?.exportMap[U]){this._logLockedError(a,
`capability not available 'capabilities.exportMap.${U}'`);return}}"source"===a&&"not-loaded"!==this.loadStatus?this._logLockedError(a,"'source' can't be changed after calling sublayer.load()"):(this._set(a,b),"service"!==O&&h!==b&&f&&f.emit&&f.emit("sublayer-update",{propertyName:a,target:this}))};u._handleSublayersChange=function(a,b){b&&(b.forEach(f=>{f.parent=null;f.layer=null}),this.handles.removeAll());a&&(a.forEach(f=>{f.parent=this;f.layer=this.layer}),this.handles.add([a.on("after-add",({item:f})=>
{f.parent=this;f.layer=this.layer}),a.on("after-remove",({item:f})=>{f.parent=null;f.layer=null}),a.on("before-changes",f=>{const h=this.layer?.capabilities?.exportMap?.supportsSublayersChanges;null==h||h||(v.getLogger(this.declaredClass).error(new k("sublayer:sublayers-non-modifiable","Sublayer can't be added, moved, or removed from the layer's sublayers",{sublayer:this,layer:this.layer})),f.preventDefault())})]))};u._logLockedError=function(a,b){const {layer:f,declaredClass:h}=this;v.getLogger(h).error(new k("sublayer:locked",
`Property '${String(a)}' can't be changed on Sublayer from the layer '${f?.id}'`,{reason:b,sublayer:this,layer:f}))};u._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};l._createClass(V,[{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"definitionExpression",set:function(a){this._setAndNotifyLayer("definitionExpression",a)}},{key:"fieldsIndex",get:function(){return new Y(this.fields||[])}},{key:"floorInfo",set:function(a){this._setAndNotifyLayer("floorInfo",
a)}},{key:"id",get:function(){const a=this._get("id");return null==a?xa++:a},set:function(a){this._get("id")!==a&&(!1===this.layer?.capabilities?.exportMap?.supportsDynamicLayers?this._logLockedError("id","capability not available 'layer.capabilities.exportMap.supportsDynamicLayers'"):this._set("id",a))}},{key:"labelingInfo",set:function(a){this._setAndNotifyLayer("labelingInfo",a)}},{key:"labelsVisible",set:function(a){this._setAndNotifyLayer("labelsVisible",a)}},{key:"layer",set:function(a){this._set("layer",
a);this.sublayers&&this.sublayers.forEach(b=>b.layer=a)}},{key:"listMode",set:function(a){this._set("listMode",a)}},{key:"minScale",set:function(a){this._setAndNotifyLayer("minScale",a)}},{key:"maxScale",set:function(a){this._setAndNotifyLayer("maxScale",a)}},{key:"effectiveScaleRange",get:function(){const {minScale:a,maxScale:b}=this;return{minScale:a,maxScale:b}}},{key:"opacity",set:function(a){this._setAndNotifyLayer("opacity",a)}},{key:"queryTask",get:function(){if(!this.layer)return null;const {spatialReference:a}=
this.layer,b="gdbVersion"in this.layer?this.layer.gdbVersion:void 0,{capabilities:f,fieldsIndex:h}=this,C=q("featurelayer-pbf")&&f?.query.supportsFormatPBF;return new la({url:this.url,pbfSupported:C,fieldsIndex:h,gdbVersion:b,sourceSpatialReference:a,queryAttachmentsSupported:f?.operations?.supportsQueryAttachments??!1})}},{key:"renderer",set:function(a){if(a)for(const b of a.getSymbols())if(P.isSymbol3D(b)){v.getLogger(this.declaredClass).warn("Sublayer renderer should use 2D symbols");break}this._setAndNotifyLayer("renderer",
a)}},{key:"source",get:function(){return this._get("source")||new T.MapLayerSource({mapLayerId:this.id})},set:function(a){this._setAndNotifyLayer("source",a)}},{key:"sublayers",set:function(a){this._handleSublayersChange(a,this._get("sublayers"));this._set("sublayers",a)}},{key:"url",get:function(){const a=this.layer?.parsedUrl??this._lastParsedUrl;var b=this.source;if(!a)return null;this._lastParsedUrl=a;if("map-layer"===b?.type)return`${a.path}/${b.mapLayerId}`;b={layer:JSON.stringify({source:this.source})};
return`${a.path}/dynamicLayer?${X.objectToQuery(b)}`},set:function(a){this._overrideIfSome("url",a)}},{key:"visible",set:function(a){this._setAndNotifyLayer("visible",a)}}]);return V}(t.HandleOwnerMixin(E.MultiOriginJSONMixin(w.IdentifiableMixin(N))));d.test={isMapImageLayerOverridePolicy:G=>G===ba||G===ua,isTileImageLayerOverridePolicy:G=>G===va};c.__decorate([r.property({readOnly:!0})],d.prototype,"capabilities",void 0);c.__decorate([Q.reader("service","capabilities",["layerDefinition.canModifyLayer",
"layerDefinition.capabilities"])],d.prototype,"readCapabilities",null);c.__decorate([r.property()],d.prototype,"defaultPopupTemplate",null);c.__decorate([r.property({type:String,value:null,json:{name:"layerDefinition.definitionExpression",write:{allowNull:!0,overridePolicy:ua}}})],d.prototype,"definitionExpression",null);c.__decorate([r.property({type:[oa],json:{origins:{service:{read:{source:"layerDefinition.fields"}}}}})],d.prototype,"fields",void 0);c.__decorate([r.property({readOnly:!0})],d.prototype,
"fieldsIndex",null);c.__decorate([r.property({type:D,value:null,json:{name:"layerDefinition.floorInfo",read:{source:"layerDefinition.floorInfo"},write:{target:"layerDefinition.floorInfo",overridePolicy:ua},origins:{"web-scene":{read:!1,write:!1}}}})],d.prototype,"floorInfo",null);c.__decorate([r.property({type:na,json:{read:{source:"layerDefinition.extent"}}})],d.prototype,"fullExtent",void 0);c.__decorate([r.property({type:sa.featureGeometryTypeKebabDictionary.apiValues,json:{origins:{service:{name:"layerDefinition.geometryType",
read:{reader:sa.featureGeometryTypeKebabDictionary.read}}}}})],d.prototype,"geometryType",void 0);c.__decorate([r.property({type:String})],d.prototype,"globalIdField",void 0);c.__decorate([Q.reader("service","globalIdField",["layerDefinition.globalIdField","layerDefinition.fields"])],d.prototype,"readGlobalIdFieldFromService",null);c.__decorate([r.property({type:aa.Integer,json:{write:{ignoreOrigin:!0}}})],d.prototype,"id",null);c.__decorate([r.property({value:null,type:[g],json:{read:{source:"layerDefinition.drawingInfo.labelingInfo"},
write:{target:"layerDefinition.drawingInfo.labelingInfo",overridePolicy:ba}}})],d.prototype,"labelingInfo",null);c.__decorate([ea.writer("labelingInfo")],d.prototype,"writeLabelingInfo",null);c.__decorate([r.property({type:Boolean,value:!0,json:{read:{source:"layerDefinition.drawingInfo.showLabels"},write:{target:"layerDefinition.drawingInfo.showLabels",overridePolicy:ba}}})],d.prototype,"labelsVisible",null);c.__decorate([r.property({value:null})],d.prototype,"layer",null);c.__decorate([r.property({type:Boolean,
value:!0,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend",overridePolicy:qa}}})],d.prototype,"legendEnabled",void 0);c.__decorate([r.property({type:["show","hide","hide-children"],value:"show",json:{read:!1,write:!1,origins:{"web-scene":{read:!0,write:!0}}}})],d.prototype,"listMode",null);c.__decorate([r.property({type:Number,value:0,json:{write:{overridePolicy:ba}}})],d.prototype,"minScale",null);c.__decorate([Q.reader("minScale",["minScale","layerDefinition.minScale"])],
d.prototype,"readMinScale",null);c.__decorate([r.property({type:Number,value:0,json:{write:{overridePolicy:ba}}})],d.prototype,"maxScale",null);c.__decorate([Q.reader("maxScale",["maxScale","layerDefinition.maxScale"])],d.prototype,"readMaxScale",null);c.__decorate([r.property({readOnly:!0})],d.prototype,"effectiveScaleRange",null);c.__decorate([r.property({type:String})],d.prototype,"objectIdField",void 0);c.__decorate([Q.reader("service","objectIdField",["layerDefinition.objectIdField","layerDefinition.fields"])],
d.prototype,"readObjectIdFieldFromService",null);c.__decorate([r.property({type:Number,value:1,json:{write:{target:"layerDefinition.drawingInfo.transparency",overridePolicy:ba}}})],d.prototype,"opacity",null);c.__decorate([Q.reader("opacity",["layerDefinition.drawingInfo.transparency","layerDefinition.transparency"])],d.prototype,"readOpacity",null);c.__decorate([ea.writer("opacity")],d.prototype,"writeOpacity",null);c.__decorate([r.property({json:{type:aa.Integer,write:{target:"parentLayerId",writerEnsuresNonNull:!0,
overridePolicy:ba}}})],d.prototype,"parent",void 0);c.__decorate([ea.writer("parent")],d.prototype,"writeParent",null);c.__decorate([r.property({type:Boolean,value:!0,json:{read:{source:"disablePopup",reader(G,V){return!V.disablePopup}},write:{target:"disablePopup",overridePolicy:qa,writer(G,V,u){V[u]=!G}}}})],d.prototype,"popupEnabled",void 0);c.__decorate([r.property({type:m,json:{read:{source:"popupInfo"},write:{target:"popupInfo",overridePolicy:qa}}})],d.prototype,"popupTemplate",void 0);c.__decorate([r.property({readOnly:!0})],
d.prototype,"queryTask",null);c.__decorate([r.property({types:Z.rendererTypes,value:null,json:{name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ba},origins:{"web-scene":{types:Z.webSceneRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy:ba}}}}})],d.prototype,"renderer",null);c.__decorate([r.property({types:{key:"type",base:null,typeMap:{"data-layer":J.DataLayerSource,"map-layer":T.MapLayerSource}},cast(G){if(G){if("mapLayerId"in G)return aa.ensureClass(T.MapLayerSource,
G);if("dataSource"in G)return aa.ensureClass(J.DataLayerSource,G)}return G},json:{name:"layerDefinition.source",write:{overridePolicy:ba}}})],d.prototype,"source",null);c.__decorate([r.property()],d.prototype,"sourceJSON",void 0);c.__decorate([r.property({value:null,json:{type:[aa.Integer],write:{target:"subLayerIds",allowNull:!0,overridePolicy:ba}}})],d.prototype,"sublayers",null);c.__decorate([da.cast("sublayers")],d.prototype,"castSublayers",null);c.__decorate([ea.writer("sublayers")],d.prototype,
"writeSublayers",null);c.__decorate([r.property({type:String,json:{name:"name",write:{overridePolicy:qa}}})],d.prototype,"title",void 0);c.__decorate([r.property({type:String})],d.prototype,"typeIdField",void 0);c.__decorate([Q.reader("typeIdField",["layerDefinition.typeIdField"])],d.prototype,"readTypeIdField",null);c.__decorate([r.property({type:[pa],json:{origins:{service:{read:{source:"layerDefinition.types"}}}}})],d.prototype,"types",void 0);c.__decorate([r.property({type:String,json:{read:{source:"layerUrl"},
write:{target:"layerUrl",overridePolicy:va}}})],d.prototype,"url",null);c.__decorate([r.property({type:Boolean,value:!0,json:{read:{source:"defaultVisibility"},write:{target:"defaultVisibility",overridePolicy:ba}}})],d.prototype,"visible",null);c.__decorate([ea.writer("visible")],d.prototype,"writeVisible",null);return d=ra=c.__decorate([ja.subclass("esri.layers.support.Sublayer")],d)})},"esri/layers/support/sublayerUtils":function(){define(["exports","../../core/maybe","../../core/accessorSupport/PropertyOrigin"],
function(n,l,c){function d(m,e){if(!m||!m.length||l.isNone(e))return!0;e=e.slice().reverse().flatten(({sublayers:F})=>F&&F.toArray().reverse()).map(F=>F.id).toArray();if(m.length>e.length)return!1;let A=0;const p=e.length;for(const {id:F}of m){for(;A<p&&e[A]!==F;)A++;if(A>=p)return!1}return!0}n.isExportDynamic=function(m,e,A){return m.some(p=>{const F=p.source;return!(!F||"map-layer"===F.type&&F.mapLayerId===p.id&&(l.isNone(F.gdbVersion)||F.gdbVersion===A))||p.originIdOf("renderer")>c.OriginId.SERVICE||
p.originIdOf("labelingInfo")>c.OriginId.SERVICE||p.originIdOf("opacity")>c.OriginId.SERVICE||p.originIdOf("labelsVisible")>c.OriginId.SERVICE})?!0:!d(m,e)};n.isSublayerOverhaul=function(m){return!!m&&m.some(e=>null!=e.minScale||e.layerDefinition&&null!=e.layerDefinition.minScale)};n.shouldWriteSublayerStructure=function(m,e,A){return e.flatten(({sublayers:p})=>p).length!==m.length||m.some(p=>p.originIdOf("minScale")>A||p.originIdOf("maxScale")>A||p.originIdOf("renderer")>A||p.originIdOf("labelingInfo")>
A||p.originIdOf("opacity")>A||p.originIdOf("labelsVisible")>A||p.originIdOf("source")>A)?!0:!d(m,e)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/ExportImageParameters":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/HandleOwner ../../core/maybe ../../core/sql ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/subclass ./commonProperties ./floorFilterUtils ./sublayerUtils".split(" "),
function(n,l,c,d,m,e,A,p,F,ca,K,ha,ia,H){const Z={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};n.ExportImageParameters=function(L){function P(k){k=L.call(this,k)||this;k.floors=null;k.scale=0;return k}l._inheritsLoose(P,L);var W=P.prototype;W.destroy=function(){this.layer=null};W.toJSON=
function(){var k=this.layer;k={dpi:k.dpi,format:k.imageFormat,transparent:k.imageTransparency,gdbVersion:k.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?k.dynamicLayers=this.dynamicLayers:k={...k,layers:this.layers,layerDefs:this.layerDefs};return k};l._createClass(P,[{key:"dynamicLayers",get:function(){if(!this.hasDynamicLayers)return null;const k=this.visibleSublayers.map(t=>{const q=ia.getLayerFloorFilterClause(this.floors,t);return t.toExportImageJSON(q)});return k.length?JSON.stringify(k):
null}},{key:"hasDynamicLayers",get:function(){return this.layer&&H.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer.gdbVersion)}},{key:"layer",set:function(k){this._get("layer")!==k&&(this._set("layer",k),this.handles.remove("layer"),k&&this.handles.add([k.allSublayers.on("change",()=>this.notifyChange("visibleSublayers")),k.on("sublayer-update",t=>this.notifyChange(Z[t.propertyName]))],"layer"))}},{key:"layers",get:function(){const k=this.visibleSublayers;return k?k.length?
"show:"+k.map(t=>t.id).join(","):"show:-1":null}},{key:"layerDefs",get:function(){const k=!!this.floors?.length,t=this.visibleSublayers.filter(q=>null!=q.definitionExpression||k&&null!=q.floorInfo);return t.length?JSON.stringify(t.reduce((q,w)=>{var x=ia.getLayerFloorFilterClause(this.floors,w);x=A.sqlAnd(x,w.definitionExpression);e.isSome(x)&&(q[w.id]=x);return q},{})):null}},{key:"version",get:function(){this.commitProperty("layers");this.commitProperty("layerDefs");this.commitProperty("dynamicLayers");
this.commitProperty("timeExtent");const k=this.layer;k&&(k.commitProperty("dpi"),k.commitProperty("imageFormat"),k.commitProperty("imageTransparency"),k.commitProperty("gdbVersion"));return(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){const k=[];if(!this.layer)return k;var t=this.layer.sublayers;const q=w=>{const x=this.scale,N=0===w.minScale||x<=w.minScale,v=0===w.maxScale||x>=w.maxScale;w.visible&&(0===x||N&&v)&&(w.sublayers?w.sublayers.forEach(q):k.unshift(w))};t&&t.forEach(q);
t=this._get("visibleSublayers");return!t||t.length!==k.length||t.some((w,x)=>k[x]!==w)?k:t}}]);return P}(m.HandleOwnerMixin(d));c.__decorate([p.property({readOnly:!0})],n.ExportImageParameters.prototype,"dynamicLayers",null);c.__decorate([p.property()],n.ExportImageParameters.prototype,"floors",void 0);c.__decorate([p.property({readOnly:!0})],n.ExportImageParameters.prototype,"hasDynamicLayers",null);c.__decorate([p.property()],n.ExportImageParameters.prototype,"layer",null);c.__decorate([p.property({readOnly:!0})],
n.ExportImageParameters.prototype,"layers",null);c.__decorate([p.property({readOnly:!0})],n.ExportImageParameters.prototype,"layerDefs",null);c.__decorate([p.property({type:Number})],n.ExportImageParameters.prototype,"scale",void 0);c.__decorate([p.property(ha.combinedViewLayerTimeExtentProperty)],n.ExportImageParameters.prototype,"timeExtent",void 0);c.__decorate([p.property({readOnly:!0})],n.ExportImageParameters.prototype,"version",null);c.__decorate([p.property({readOnly:!0})],n.ExportImageParameters.prototype,
"visibleSublayers",null);n.ExportImageParameters=c.__decorate([K.subclass("esri.layers.mixins.ExportImageParameters")],n.ExportImageParameters);Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/floorFilterUtils":function(){define(["exports"],function(n){function l(c,d){if(!c?.length)return null;c=c.filter(m=>""!==m).map(m=>`'${m}'`);c.push("''");return`${d} IN (${c.join(",")}) OR ${d} IS NULL`}n.getFloorFilterClause=function(c){const d=c.layer;return"floorInfo"in
d&&d.floorInfo?.floorField&&"floors"in c.view?l(c.view.floors,d.floorInfo.floorField):null};n.getLayerFloorFilterClause=function(c,d){return"floorInfo"in d&&d.floorInfo?.floorField?l(c,d.floorInfo.floorField):null};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"esri/layers/support/imageBitmapUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/Error"],function(n,l,c){function d(){d=l._asyncToGenerator(function*(m,e){try{return yield createImageBitmap(m)}catch(A){throw new c("request:server",
`Unable to load ${e}`,{url:e,error:A});}});return d.apply(this,arguments)}n.createBitmap=function(m,e){return d.apply(this,arguments)};Object.defineProperty(n,Symbol.toStringTag,{value:"Module"})})},"*noref":1}});
define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../request ../TimeExtent ../core/Error ../core/HandleOwner ../core/loadAll ../core/maybe ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/arrayUtils ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer ../core/accessorSupport/PropertyOrigin ../geometry/Extent ../geometry/support/scaleUtils ./Layer ./mixins/APIKeyMixin ./mixins/ArcGISMapService ./mixins/ArcGISService ./mixins/BlendLayer ./mixins/CustomParametersMixin ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/RefreshableLayer ./mixins/ScaleRangeLayer ./mixins/SublayersOwner ./mixins/TemporalLayer ./support/commonProperties ./support/ExportImageParameters ./support/imageBitmapUtils ./support/Sublayer ./support/sublayerUtils ./support/versionUtils ../time/TimeReference".split(" "),function(n,
l,c,d,m,e,A,p,F,ca,K,ha,ia,H,Z,L,P,W,k,t,q,w,x,N,v,B,E,S,X,r,da,Q,ja,ea,aa,y,ka,la){e=function(pa){function oa(...g){g=pa.call(this,...g)||this;g.dateFieldsTimeReference=null;g.datesInUnknownTimezone=!1;g.dpi=96;g.gdbVersion=null;g.imageFormat="png24";g.imageMaxHeight=2048;g.imageMaxWidth=2048;g.imageTransparency=!0;g.isReference=null;g.labelsVisible=!1;g.operationalLayerType="ArcGISMapServiceLayer";g.preferredTimeReference=null;g.sourceJSON=null;g.sublayers=null;g.type="map-image";g.url=null;return g}
n._inheritsLoose(oa,pa);var Y=oa.prototype;Y.normalizeCtorArgs=function(g,z){return"string"===typeof g?{url:g,...z}:g};Y.load=function(g){const z=p.isSome(g)?g.signal:null;this.addResolvingPromise(this.loadFromPortal({supportedTypes:["Map Service"]},g).catch(ca.throwIfAbortError).then(()=>this._fetchService(z)));return Promise.resolve(this)};Y.readImageFormat=function(g,z){return(g=z.supportedImageFormatTypes)&&g.includes("PNG32")?"png32":"png24"};Y.writeSublayers=function(g,z,D,I){if(this.loaded&&
g){g=g.slice().reverse().flatten(({sublayers:M})=>M&&M.toArray().reverse()).toArray();D=!1;if(this.capabilities&&this.capabilities.operations.supportsExportMap&&this.capabilities.exportMap?.supportsDynamicLayers){const M=P.nameToId(I.origin);M===P.OriginId.PORTAL_ITEM?(D=this.createSublayersForOrigin("service").sublayers,D=y.shouldWriteSublayerStructure(g,D,P.OriginId.SERVICE)):M>P.OriginId.PORTAL_ITEM&&(D=this.createSublayersForOrigin("portal-item"),D=y.shouldWriteSublayerStructure(g,D.sublayers,
P.nameToId(D.origin)))}var J=[],T={writeSublayerStructure:D,...I},R=D;g.forEach(M=>{const fa=M.write({},T);J.push(fa);R=R||"user"===M.originOf("visible")});J.some(M=>1<Object.keys(M).length)&&(z.layers=J);R&&(z.visibleLayers=g.filter(M=>M.visible).map(M=>M.id))}};Y.createExportImageParameters=function(g,z,D,I){var J=I&&I.pixelRatio||1;g&&10<=this.version&&(g=g.clone().shiftCentralMeridian());var T=new ja.ExportImageParameters({layer:this,floors:I?.floors,scale:k.getScale({extent:g,width:z})*J});const R=
T.toJSON();T.destroy();T=!I||!I.rotation||10.3>this.version?{}:{rotation:-I.rotation};var M=g&&g.spatialReference;M=M.wkid||JSON.stringify(M.toJSON());R.dpi*=J;J={};if(I?.timeExtent){const {start:fa,end:na}=I.timeExtent.toJSON();J.time=fa&&na&&fa===na?""+fa:`${null==fa?"null":fa},${null==na?"null":na}`}else this.timeInfo&&!this.timeInfo.hasLiveData&&(J.time="null,null");return{bbox:g&&g.xmin+","+g.ymin+","+g.xmax+","+g.ymax,bboxSR:M,imageSR:M,size:z+","+D,...R,...T,...J}};Y.fetchImage=function(){var g=
n._asyncToGenerator(function*(z,D,I,J){({data:z}=yield this._fetchImage("image",z,D,I,J));return z});return function(z,D,I,J){return g.apply(this,arguments)}}();Y.fetchImageBitmap=function(){var g=n._asyncToGenerator(function*(z,D,I,J){const {data:T,url:R}=yield this._fetchImage("blob",z,D,I,J);return ea.createBitmap(T,R)});return function(z,D,I,J){return g.apply(this,arguments)}}();Y.fetchRecomputedExtents=function(){var g=n._asyncToGenerator(function*(z={}){({data:z}=yield c(this.url,{...z,query:{returnUpdates:!0,
f:"json",...this.customParameters,token:this.apiKey}}));const {extent:D,fullExtent:I,timeExtent:J}=z;z=D||I;return{fullExtent:z&&W.fromJSON(z),timeExtent:J&&d.fromJSON({start:J[0],end:J[1]})}});return function(){return g.apply(this,arguments)}}();Y.loadAll=function(){return A.loadAll(this,g=>{g(this.allSublayers)})};Y.serviceSupportsSpatialReference=function(g){return ka.serviceSupportsSpatialReference(this,g)};Y._fetchImage=function(){var g=n._asyncToGenerator(function*(z,D,I,J,T){z={responseType:z,
signal:T?.signal??null,query:{...this.parsedUrl.query,...this.createExportImageParameters(D,I,J,T),f:"image",...this.refreshParameters,...this.customParameters,token:this.apiKey}};D=this.parsedUrl.path+"/export";if(null!=z.query?.dynamicLayers&&!this.capabilities?.exportMap?.supportsDynamicLayers)throw new m("mapimagelayer:dynamiclayer-not-supported",`service ${this.url} doesn't support dynamic layers, which is required to be able to change the sublayer's order, rendering, labeling or source.`,{query:z.query});
try{const {data:R}=yield c(D,z);return{data:R,url:D}}catch(R){if(ca.isAbortError(R))throw R;throw new m("mapimagelayer:image-fetch-error",`Unable to load image: ${D}`,{error:R});}});return function(z,D,I,J,T){return g.apply(this,arguments)}}();Y._fetchService=function(){var g=n._asyncToGenerator(function*(z){if(this.sourceJSON)this.read(this.sourceJSON,{origin:"service",url:this.parsedUrl});else{var {data:D,ssl:I}=yield c(this.parsedUrl.path,{query:{f:"json",...this.parsedUrl.query,...this.customParameters,
token:this.apiKey},signal:z});I&&(this.url=this.url.replace(/^http:/i,"https:"));this.sourceJSON=D;this.read(D,{origin:"service",url:this.parsedUrl})}});return function(z){return g.apply(this,arguments)}}();return oa}(N.BlendLayer(da.TemporalLayer(X.ScaleRangeLayer(r.SublayersOwner(w.ArcGISMapService(x.ArcGISService(B.OperationalLayer(E.PortalLayer(F.MultiOriginJSONMixin(S.RefreshableLayer(q.APIKeyMixin(v.CustomParametersMixin(e.HandleOwnerMixin(t))))))))))))));l.__decorate([K.property({type:la})],
e.prototype,"dateFieldsTimeReference",void 0);l.__decorate([K.property({type:Boolean})],e.prototype,"datesInUnknownTimezone",void 0);l.__decorate([K.property()],e.prototype,"dpi",void 0);l.__decorate([K.property()],e.prototype,"gdbVersion",void 0);l.__decorate([K.property()],e.prototype,"imageFormat",void 0);l.__decorate([H.reader("imageFormat",["supportedImageFormatTypes"])],e.prototype,"readImageFormat",null);l.__decorate([K.property({json:{origins:{service:{read:{source:"maxImageHeight"}}}}})],
e.prototype,"imageMaxHeight",void 0);l.__decorate([K.property({json:{origins:{service:{read:{source:"maxImageWidth"}}}}})],e.prototype,"imageMaxWidth",void 0);l.__decorate([K.property()],e.prototype,"imageTransparency",void 0);l.__decorate([K.property({type:Boolean,json:{read:!1,write:{enabled:!0,overridePolicy:()=>({enabled:!1})}}})],e.prototype,"isReference",void 0);l.__decorate([K.property({json:{read:!1,write:!1}})],e.prototype,"labelsVisible",void 0);l.__decorate([K.property({type:["ArcGISMapServiceLayer"]})],
e.prototype,"operationalLayerType",void 0);l.__decorate([K.property({json:{read:!1,write:!1}})],e.prototype,"popupEnabled",void 0);l.__decorate([K.property({type:la})],e.prototype,"preferredTimeReference",void 0);l.__decorate([K.property()],e.prototype,"sourceJSON",void 0);l.__decorate([K.property({json:{write:{ignoreOrigin:!0}}})],e.prototype,"sublayers",void 0);l.__decorate([L.writer("sublayers",{layers:{type:[aa]},visibleLayers:{type:[ha.Integer]}})],e.prototype,"writeSublayers",null);l.__decorate([K.property({type:["show",
"hide","hide-children"]})],e.prototype,"listMode",void 0);l.__decorate([K.property({json:{read:!1},readOnly:!0,value:"map-image"})],e.prototype,"type",void 0);l.__decorate([K.property(Q.url)],e.prototype,"url",void 0);return e=l.__decorate([Z.subclass("esri.layers.MapImageLayer")],e)});