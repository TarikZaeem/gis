// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../request ../../core/promiseUtils ../../core/urlUtils ../../views/2d/engine/vectorTiles/style/VectorTileSource".split(" "),function(y,q,z,D,E,k,F){function t(){t=q._asyncToGenerator(function*(b,c){const a={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null,sourceNameToSource:{},primarySourceName:"",spriteFormat:"png"},[g,f]="string"===typeof b?[b,null]:[null,b.jsonUrl];yield m(a,
"esri",b,f,c);b={layerDefinition:a.validatedSource,url:g,serviceUrl:a.sourceUrl,style:a.style,styleUrl:a.styleUrl,spriteUrl:a.style.sprite&&n(a.styleBase,a.style.sprite),spriteFormat:a.spriteFormat,glyphsUrl:a.style.glyphs&&n(a.styleBase,a.style.glyphs),sourceNameToSource:a.sourceNameToSource,primarySourceName:a.primarySourceName};p(b.spriteUrl);p(b.glyphsUrl);return b});return t.apply(this,arguments)}function p(b){b&&(b=k.getOrigin(b),u&&!u.includes(b)&&u.push(b))}function n(...b){let c=void 0;for(const a of b)null!=
a&&(k.isProtocolRelative(a)?c&&(c=c.split("://")[0]+":"+a.trim()):c=k.isAbsolute(a)?a:k.join(c,a));return c?k.removeTrailingSlash(c):void 0}function m(b,c,a,g,f){return v.apply(this,arguments)}function v(){v=q._asyncToGenerator(function*(b,c,a,g,f){E.throwIfAborted(f);let d,h;if("string"===typeof a){a=k.normalize(a);p(a);var e=yield D(a,{...f,responseType:"json",query:{f:"json",...f?.query}});e.ssl&&(d&&(d=d.replace(/^http:/i,"https:")),h&&(h=h.replace(/^http:/i,"https:")));h=d=a}else null!=a&&(e=
{data:a},d=a.jsonUrl||null,h=g);e=e?.data;if(e?.sources)return b.styleUrl=d||null,G(b,e,h,f);if(!e?.sources)return b.sourceUrl?A(b,e,h,!1,c,f):(b.sourceUrl=d||null,A(b,e,h,!0,c,f));throw Error("You must specify the URL or the JSON for a service or for a style.");});return v.apply(this,arguments)}function G(b,c,a,g){return w.apply(this,arguments)}function w(){w=q._asyncToGenerator(function*(b,c,a,g){a=a?k.removeFile(a):k.getAppBaseUrl();b.styleBase=a;b.style=c;b.styleUrl&&p(b.styleUrl);c["sprite-format"]&&
"webp"===c["sprite-format"].toLowerCase()&&(b.spriteFormat="webp");const f=[];if(c.sources&&c.sources.esri){const d=c.sources.esri;d.url?yield m(b,"esri",n(a,d.url),void 0,g):f.push(m(b,"esri",d,a,g))}for(const d of Object.keys(c.sources))"esri"!==d&&"vector"===c.sources[d].type&&(c.sources[d].url?f.push(m(b,d,n(a,c.sources[d].url),void 0,g)):c.sources[d].tiles&&f.push(m(b,d,c.sources[d],a,g)));yield Promise.all(f)});return w.apply(this,arguments)}function A(b,c,a,g,f,d){return x.apply(this,arguments)}
function x(){x=q._asyncToGenerator(function*(b,c,a,g,f,d){a=a?k.removeTrailingSlash(a)+"/":k.getAppBaseUrl();if(c.hasOwnProperty("tileInfo"))var h=c;else{var e={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},l=78271.51696400007,B=2.958287637957775E8,C=[],H=c.hasOwnProperty("minzoom")?+c.minzoom:0,I=c.hasOwnProperty("maxzoom")?+c.maxzoom:22;for(let r=0;r<=I;r++)r>=H&&C.push({level:r,scale:B,resolution:l}),l/=
2,B/=2;for(h of c.tiles??[])p(n(a,h));h={capabilities:"TilesOnly",initialExtent:e,fullExtent:e,minScale:0,maxScale:0,tiles:c.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:C,spatialReference:{wkid:102100}}}}e=new F(f,k.addQueryParameters(a,d?.query??{}),h);if(!g&&b.primarySourceName in b.sourceNameToSource){l=b.sourceNameToSource[b.primarySourceName];if(!l.isCompatibleWith(e))return;null!=e.fullExtent&&(null!=l.fullExtent?l.fullExtent.union(e.fullExtent):
l.fullExtent=e.fullExtent.clone());l.tileInfo&&e.tileInfo&&l.tileInfo.lods.length<e.tileInfo.lods.length&&(l.tileInfo=e.tileInfo)}g?(b.sourceBase=a,b.source=c,b.validatedSource=h,b.primarySourceName=f,b.sourceUrl&&p(b.sourceUrl)):p(a);b.sourceNameToSource[f]=e;if(!b.style){if(null==c.defaultStyles)throw Error();return"string"===typeof c.defaultStyles?m(b,"",n(a,c.defaultStyles,"root.json"),void 0,d):m(b,"",c.defaultStyles,n(a,"root.json"),d)}});return x.apply(this,arguments)}const u=z.defaults&&z.defaults.io.corsEnabledServers;
y.loadMetadata=function(b,c){return t.apply(this,arguments)};Object.defineProperty(y,Symbol.toStringTag,{value:"Module"})});