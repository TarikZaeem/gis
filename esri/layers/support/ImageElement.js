// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../request ../../core/Error ../../core/maybe ../../core/urlUtils ../../core/uuid ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/arrayUtils ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ./MediaElementBase ../../portal/support/resourceExtension ../../chunks/persistableUrlUtils".split(" "),
function(v,l,r,z,A,h,B,t,g,J,C,D,E,F,G,m){function w(b){return u.apply(this,arguments)}function u(){u=v._asyncToGenerator(function*(b){if("string"===typeof b){if(h.isBlobProtocol(b)){var {data:f}=yield r(b,{responseType:"blob"});return f}if(h.isDataProtocol(b))return h.dataToBlob(b);f=yield r(b,{responseType:"image"});return w(f.data)}return new Promise(k=>{if(b instanceof HTMLCanvasElement)var a=b;else{a=b instanceof HTMLImageElement?b.naturalWidth:b.width;var e=b instanceof HTMLImageElement?b.naturalHeight:
b.height,d=document.createElement("canvas"),c=d.getContext("2d");d.width=a;d.height=e;b instanceof HTMLImageElement?c.drawImage(b,0,0,b.width,b.height):b instanceof ImageData&&c.putImageData(b,0,0);a=d}return a.toBlob(k)})});return u.apply(this,arguments)}function H(b,f){const k=B.generateUUID();b=`${h.join("media",k)}.${G.getResourceContentExtension(b)}`;return f.resourceFromPath(b)}g=function(b){function f(a){a=b.call(this,a)||this;a.content=null;a.image=null;a.type="image";a.image=null;return a}
v._inheritsLoose(f,b);var k=f.prototype;k.load=function(){const a=this.image;if("string"===typeof a){var e=r(a,{responseType:"image"}).then(({data:d})=>{this._set("content",d)});this.addResolvingPromise(e)}else a instanceof HTMLImageElement?(e=a.decode().then(()=>{this._set("content",a)}),this.addResolvingPromise(e)):a?this._set("content",a):this.addResolvingPromise(Promise.reject(new z("image-element:invalid-image-type","Invalid image type",{image:a})));return Promise.resolve(this)};k.readImage=
function(a,e,d){return m.fromJSON(e.url,d)};k.writeImage=function(a,e,d,c){if(!A.isNone(a)){var n=c?.portalItem,p=c?.resources;if(n&&p){var q="string"!==typeof a||h.isDataProtocol(a)||h.isBlobProtocol(a)?null:a;if(q){if(null==m.itemIdFromResourceUrl(q)){e[d]=q;return}c=m.toJSON(q,{...c,verifyItemRelativeUrls:c&&c.verifyItemRelativeUrls?{writtenUrls:c.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},m.MarkKeep.NO);if(n&&c&&!h.isAbsolute(c)){p.toKeep.push({resource:n.resourceFromPath(c),
compress:!1});e[d]=c;return}}e[d]="\x3cpending\x3e";p.pendingOperations.push(w(a).then(x=>{const y=H(x,n);e[d]=y.itemRelativeUrl;p.toAdd.push({resource:y,content:x,compress:!1,finish:I=>{this.image=I.url}})}))}else"string"===typeof a&&(e[d]=m.toJSON(a,c))}};return f}(F);l.__decorate([t.property({readOnly:!0})],g.prototype,"content",void 0);l.__decorate([t.property({json:{name:"url",type:String}})],g.prototype,"image",void 0);l.__decorate([C.reader("image",["url"])],g.prototype,"readImage",null);l.__decorate([E.writer("image")],
g.prototype,"writeImage",null);l.__decorate([t.property({readOnly:!0,json:{name:"mediaType"}})],g.prototype,"type",void 0);return g=l.__decorate([D.subclass("esri.layers.support.ImageElement")],g)});