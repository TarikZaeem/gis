// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../PopupTemplate ../../renderers/ClassBreaksRenderer ../../renderers/DictionaryRenderer ../../renderers/DotDensityRenderer ../../renderers/HeatmapRenderer ../../renderers/PieChartRenderer ../../renderers/Renderer ../../renderers/SimpleRenderer ../../renderers/UniqueValueRenderer ../../renderers/support/jsonUtils ../../core/has ../../core/Error ../../core/HandleOwner ../../core/Identifiable ../../core/lang ../../core/Loadable ../../core/Logger ../../core/maybe ../../core/MultiOriginJSONSupport ../../core/object ../../core/sql ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/PropertyOrigin ../../core/accessorSupport/extensions/serializableProperty/reader ../../form/FormTemplate ./commonProperties ./featureLayerUtils ./FeatureTemplate ./fieldProperties ./fieldUtils ./LabelClass ./labelingInfo ../../rest/support/Query ../../support/popupUtils ../../symbols/support/defaults".split(" "),
function(t,e,P,C,na,oa,pa,qa,Q,H,R,ra,sa,D,d,S,x,T,U,E,V,W,K,g,ta,F,X,Y,Z,aa,ba,z,ca,L,G,da,ea,fa,ha,ia,I){function A(h){const m=h.json.write;"object"===typeof m?m.ignoreOrigin=!0:h.json.write={ignoreOrigin:!0};return h}function ja(h){switch(h){case "point":case "multipoint":return I.defaultPointSymbol2D.clone();case "polyline":return I.defaultPolylineSymbol2D.clone();case "polygon":case "multipatch":return I.defaultPolygonSymbol2D.clone();default:return null}}function ka(h,m){return m?"unique-value"===
h?.type&&"string"===typeof h.field&&h.field.toLowerCase()===m.toLowerCase()&&!h.field2&&!h.field3&&!h.valueExpression:!1}function M(h,m){return null==h?null:m.subtypes?.find(l=>l.code===h)}const la="charts editingEnabled formTemplate labelsVisible labelingInfo legendEnabled minScale maxScale opacity popupEnabled popupTemplate renderer subtypeCode templates title visible".split(" ");C={key:"type",base:Q,errorContext:"renderer",typeMap:{simple:H,"unique-value":R,"class-breaks":C}};G=G.defineFieldProperties();
const N=aa.createTypeReader({types:C});let ma=0;d=function(h){function m(a){a=h.call(this,a)||this;a.charts=null;a.editingEnabled=!0;a.fieldOverrides=null;a.fieldsIndex=null;a.formTemplate=null;a.id=`${Date.now().toString(16)}-subtype-sublayer-${ma++}`;a.type="subtype-sublayer";a.labelsVisible=!0;a.labelingInfo=null;a.layerType="ArcGISFeatureLayer";a.legendEnabled=!0;a.listMode="show";a.minScale=0;a.maxScale=0;a.opacity=1;a.popupEnabled=!0;a.popupTemplate=null;a.subtypeCode=null;a.templates=null;
a.title=null;a.visible=!0;return a}t._inheritsLoose(m,h);var l=m.prototype;l.writeFieldOverrides=function(a,b,f){const {fields:c,parent:k}=this;let n;if(c){n=[];let q=0;c.forEach(({name:y,alias:B,editable:p,visible:u})=>{if(u&&(u=k?.fields?.find(J=>J.name===y))){var r={name:y},v=!1;B!==u.alias&&(r.alias=B,v=!0);p!==u.editable&&(r.editable=p,v=!0);n.push(r);v&&q++}});0===q&&n.length===c.length&&(n=null)}else n=x.clone(a);n?.length&&W.setDeepValue(f,n,b)};l.readRendererFromService=function(a,b,f){if("Table"===
b.type)return null;f=N(b.drawingInfo?.renderer,b,f);a=void 0;const {subtypeCode:c}=this;null!=c&&ka(f,b.subtypeField)?(b=f.uniqueValueInfos?.find(({value:k})=>{k="number"===typeof k?String(k):k;return k===String(c)}))&&(a=new H({symbol:b.symbol})):"simple"!==f?.type||f.visualVariables?.length||(a=f);return a};l.readRenderer=function(a,b,f){if((a=b?.layerDefinition?.drawingInfo?.renderer)&&!a.visualVariables?.some(c=>"rotationInfo"!==c.type))return N(a,b,f)||void 0};l.readTemplatesFromService=function(a,
b){a=this.subtypeCode;let f=null;switch(b.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":f="point";break;case "esriGeometryPolyline":f="line";break;case "esriGeometryPolygon":case "esriGeometryMultiPatch":f="polygon";break;default:f=null}const c={};var k=M(a,b);if(E.isSome(k)){({defaultValues:k}=k);for(const n in k)c[n]=k[n]}c[b.subtypeField]=a;return[new L({name:"New Feature",drawingTool:f,prototype:{attributes:c}})]};l.readTitleFromService=function(a,b){a=M(this.subtypeCode,
b);return E.isSome(a)?a.name:null};l.addAttachment=function(){var a=t._asyncToGenerator(function*(b,f){const {parent:c}=this;if(!c)throw w("addAttachment");if(b.getAttribute(c.subtypeField)!==this.subtypeCode)throw new D("subtype-sublayer:addAttachment","The feature provided does not belong to this SubtypeSublayer");return c.addAttachment(b,f)});return function(b,f){return a.apply(this,arguments)}}();l.updateAttachment=function(){var a=t._asyncToGenerator(function*(b,f,c){const {parent:k}=this;if(!k)throw w("updateAttachment");
if(b.getAttribute(k.subtypeField)!==this.subtypeCode)throw new D("subtype-sublayer:updateAttachment","The feature provided does not belong to this SubtypeSublayer");return k.updateAttachment(b,f,c)});return function(b,f,c){return a.apply(this,arguments)}}();l.deleteAttachments=function(){var a=t._asyncToGenerator(function*(b,f){const {parent:c}=this;if(!c)throw w("deleteAttachments");if(b.getAttribute(c.subtypeField)!==this.subtypeCode)throw new D("subtype-sublayer:deleteAttachments","The feature provided does not belong to this SubtypeSublayer");
return c.deleteAttachments(b,f)});return function(b,f){return a.apply(this,arguments)}}();l.applyEdits=function(){var a=t._asyncToGenerator(function*(b,f){if(!this.parent)throw w("applyEdits");return this.parent.applyEdits(b,f)});return function(b,f){return a.apply(this,arguments)}}();l.createPopupTemplate=function(a){let b=this;const {parent:f,fields:c,title:k}=this;if(f){const {displayField:n,editFieldsInfo:q,objectIdField:y}=f;b={displayField:n,editFieldsInfo:q,fields:c,objectIdField:y,title:k}}return ia.createPopupTemplate(b,
a)};l.createQuery=function(){if(!this.parent)throw w("createQuery");const a=ca.createQuery(this.parent);a.where=K.sqlAnd(`${this.parent.subtypeField}=${this.subtypeCode}`,this.parent.definitionExpression);return a};l.getField=function(a){return this.fieldsIndex.get(a)};l.getFieldDomain=function(a){return this._getLayerDomain(a)};l.hasUserOverrides=function(){return la.some(a=>this.originIdOf(a)===Z.OriginId.USER)};l.queryAttachments=function(){var a=t._asyncToGenerator(function*(b,f){const c=yield this.load();
if(!c.parent)throw w("queryAttachments");const k=b.clone();k.where=O(k.where,c.parent.subtypeField,c.subtypeCode);return c.parent.queryAttachments(b,f)});return function(b,f){return a.apply(this,arguments)}}();l.queryFeatures=function(){var a=t._asyncToGenerator(function*(b,f){const c=yield this.load();if(!c.parent)throw w("queryFeatures");const k=ha.from(b)??c.createQuery();E.isSome(b)&&(k.where=O(k.where,c.parent.subtypeField,c.subtypeCode));return c.parent.queryFeatures(k,f)});return function(b,
f){return a.apply(this,arguments)}}();l._getLayerDomain=function(a){return(a=this.fieldsIndex.get(a))?a.domain:null};t._createClass(m,[{key:"capabilities",get:function(){return this.parent?.capabilities}},{key:"effectiveCapabilities",get:function(){return this.parent?.effectiveCapabilities}},{key:"effectiveEditingEnabled",get:function(){const {parent:a}=this;return a?a.effectiveEditingEnabled&&this.editingEnabled:this.editingEnabled}},{key:"elevationInfo",get:function(){return this.parent?.elevationInfo}},
{key:"fields",get:function(){const {parent:a,fieldOverrides:b,subtypeCode:f}=this;var c=a?.fields;if(!a||!c?.length)return null;const {subtypes:k,subtypeField:n}=a;var q=k?.find(u=>u.code===f);const y=q?.defaultValues;q=q?.domains;const B=[];for(const u of c){c=u.clone();const {name:r}=c;var p=b?.find(v=>v.name===r);c.visible=!b||!!p;if(p){const {alias:v,editable:J}=p;v&&(c.alias=v);!1===J&&(c.editable=!1)}p=y?.[r]??null;c.defaultValue=r===n?f:p;p=q?.[r]??null;c.domain=r===n?null:p?"inherited"===
p.type?c.domain:p.clone():null;B.push(c)}return B}},{key:"geometryType",get:function(){return this.parent?.geometryType}},{key:"effectiveScaleRange",get:function(){const {minScale:a,maxScale:b}=this;return{minScale:a,maxScale:b}}},{key:"objectIdField",get:function(){this.parent||U.getLogger("esri.layers.support.SubtypeSublayer").error(w("objectIdField"));return this.parent?.objectIdField}},{key:"defaultPopupTemplate",get:function(){return this.createPopupTemplate()}},{key:"renderer",get:function(){if(this._isOverridden("renderer"))return this._get("renderer");
const {parent:a}=this;return a&&!a.isTable&&"mesh"!==a.geometryType?new H({symbol:ja(a.geometryType)}):null},set:function(a){da.fixRendererFields(a,this.fieldsIndex);this._override("renderer",a)}},{key:"spatialReference",get:function(){return this.parent?.spatialReference}},{key:"url",get:function(){return this.parent?.url}},{key:"userHasUpdateItemPrivileges",get:function(){return!!this.parent?.userHasUpdateItemPrivileges}}]);return m}(d.HandleOwnerMixin(V.MultiOriginJSONMixin(S.IdentifiableMixin(T))));
e.__decorate([g.property({readOnly:!0,json:{read:!1}})],d.prototype,"capabilities",null);e.__decorate([g.property({readOnly:!0,json:{read:!1}})],d.prototype,"effectiveCapabilities",null);e.__decorate([g.property({json:{write:{ignoreOrigin:!0}}})],d.prototype,"charts",void 0);e.__decorate([g.property({type:Boolean,nonNullable:!0,json:{name:"enableEditing",write:{ignoreOrigin:!0}}})],d.prototype,"editingEnabled",void 0);e.__decorate([g.property({type:Boolean,readOnly:!0})],d.prototype,"effectiveEditingEnabled",
null);e.__decorate([g.property({readOnly:!0,json:{read:!1}})],d.prototype,"elevationInfo",null);e.__decorate([g.property({readOnly:!0,json:{name:"layerDefinition.fieldOverrides",origins:{service:{read:!1}},write:{ignoreOrigin:!0,allowNull:!0}}})],d.prototype,"fieldOverrides",void 0);e.__decorate([Y.writer("fieldOverrides")],d.prototype,"writeFieldOverrides",null);e.__decorate([g.property({...G.fields,readOnly:!0,json:{read:!1}})],d.prototype,"fields",null);e.__decorate([g.property(G.fieldsIndex)],
d.prototype,"fieldsIndex",void 0);e.__decorate([g.property({type:ba,json:{name:"formInfo",write:{ignoreOrigin:!0}}})],d.prototype,"formTemplate",void 0);e.__decorate([g.property({type:String,readOnly:!0,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],d.prototype,"id",void 0);e.__decorate([g.property({readOnly:!0,json:{read:!1}})],d.prototype,"geometryType",null);e.__decorate([g.property({readOnly:!0,json:{read:!1}})],d.prototype,"type",void 0);e.__decorate([g.property(A(x.clone(z.labelsVisible)))],
d.prototype,"labelsVisible",void 0);e.__decorate([g.property({type:[ea],json:{name:"layerDefinition.drawingInfo.labelingInfo",origins:{service:{read:!1}},read:{reader:fa.reader},write:{ignoreOrigin:!0}}})],d.prototype,"labelingInfo",void 0);e.__decorate([g.property({type:["ArcGISFeatureLayer"],readOnly:!0,json:{read:!1,write:{ignoreOrigin:!0}}})],d.prototype,"layerType",void 0);e.__decorate([g.property(A(x.clone(z.legendEnabled)))],d.prototype,"legendEnabled",void 0);e.__decorate([g.property({type:["show",
"hide"]})],d.prototype,"listMode",void 0);e.__decorate([g.property((()=>{const h=x.clone(z.minScale);h.json.origins.service.read=!1;return A(h)})())],d.prototype,"minScale",void 0);e.__decorate([g.property((()=>{const h=x.clone(z.maxScale);h.json.origins.service.read=!1;return A(h)})())],d.prototype,"maxScale",void 0);e.__decorate([g.property({readOnly:!0})],d.prototype,"effectiveScaleRange",null);e.__decorate([g.property({readOnly:!0,json:{read:!1}})],d.prototype,"objectIdField",null);e.__decorate([g.property({type:Number,
range:{min:0,max:1},nonNullable:!0,json:{write:{ignoreOrigin:!0}}})],d.prototype,"opacity",void 0);e.__decorate([g.property()],d.prototype,"parent",void 0);e.__decorate([g.property(A(x.clone(z.popupEnabled)))],d.prototype,"popupEnabled",void 0);e.__decorate([g.property({type:P,json:{name:"popupInfo",write:{ignoreOrigin:!0}}})],d.prototype,"popupTemplate",void 0);e.__decorate([g.property({readOnly:!0})],d.prototype,"defaultPopupTemplate",null);e.__decorate([g.property({types:C,json:{write:{target:"layerDefinition.drawingInfo.renderer",
ignoreOrigin:!0}}})],d.prototype,"renderer",null);e.__decorate([F.reader("service","renderer",["drawingInfo.renderer","subtypeField","type"])],d.prototype,"readRendererFromService",null);e.__decorate([F.reader("renderer",["layerDefinition.drawingInfo.renderer"])],d.prototype,"readRenderer",null);e.__decorate([g.property({readOnly:!0,json:{read:!1}})],d.prototype,"spatialReference",null);e.__decorate([g.property({type:Number,json:{origins:{service:{read:!1}},write:{ignoreOrigin:!0}}})],d.prototype,
"subtypeCode",void 0);e.__decorate([g.property({type:[L],json:{name:"layerDefinition.templates",write:{ignoreOrigin:!0}}})],d.prototype,"templates",void 0);e.__decorate([F.reader("service","templates",["geometryType","subtypeField","subtypes","type"])],d.prototype,"readTemplatesFromService",null);e.__decorate([g.property({type:String,json:{write:{ignoreOrigin:!0}}})],d.prototype,"title",void 0);e.__decorate([F.reader("service","title",["subtypes"])],d.prototype,"readTitleFromService",null);e.__decorate([g.property({readOnly:!0,
json:{read:!1}})],d.prototype,"url",null);e.__decorate([g.property({readOnly:!0})],d.prototype,"userHasUpdateItemPrivileges",null);e.__decorate([g.property({type:Boolean,nonNullable:!0,json:{name:"visibility",write:{ignoreOrigin:!0}}})],d.prototype,"visible",void 0);d=e.__decorate([X.subclass("esri.layers.support.SubtypeSublayer")],d);const O=(h,m,l)=>{const a=new RegExp(`${m}=[0-9]`);m=`${m}=${l}`;h=E.unwrapOr(h,"");return a.test(h)?h.replace(a,m):K.sqlAnd(m,h)},w=h=>new D(`This sublayer must have a parent SubtypeGroupLayer in order to use ${h}`);
return d});