// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Error ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/accessorSupport/decorators/subclass ./BaseRaster".split(" "),function(p,n,x,v,q,k,A,y,z){k=function(w){function u(){var b=w.apply(this,arguments)||this;b.datasetFormat="Function";b.tileType="Raster";b.rasterFunction=null;return b}p._inheritsLoose(u,w);var r=
u.prototype;r.open=function(){var b=p._asyncToGenerator(function*(h){yield this.init();const {rasterFunction:c}=this;this.primaryRasters?.rasters?.length?c.sourceRasters=this.primaryRasters.rasters:this.primaryRasters=c.getPrimaryRasters();const {rasters:f,rasterIds:m}=this.primaryRasters;var d=f.map(a=>a.rasterInfo?void 0:a.open(h));yield Promise.all(d);d=f.map(({rasterInfo:a})=>a);const g=c.bind({rasterInfos:d,rasterIds:m});if(!g.success||0===d.length)throw new x("raster-function:open",`cannot bind the function: ${g.error??
""}`);yield this.syncJobHandler();const e=d[0];this.hasUniqueSourceStorageInfo=1===d.length||d.slice(1).every(a=>this._hasSameStorageInfo(a,e));this.set("sourceJSON",f[0].sourceJSON);this.set("rasterInfo",c.rasterInfo)});return function(h){return b.apply(this,arguments)}}();r.syncJobHandler=function(){var b=p._asyncToGenerator(function*(){return this.rasterJobHandler?.updateRasterFunction(this.rasterFunction)});return function(){return b.apply(this,arguments)}}();r.fetchPixels=function(){var b=p._asyncToGenerator(function*(h,
c,f,m={}){const {rasters:d,rasterIds:g}=this.primaryRasters;var e=d.map(l=>l.fetchPixels(h,c,f,m));e=yield Promise.all(e);var a=e.map(l=>l.pixelBlock);if(m.skipRasterFunction||a.every(l=>v.isNone(l)))return e[0];const t=e.find(l=>v.isSome(l.pixelBlock))?.extent??h;a=this.rasterJobHandler?yield this.rasterJobHandler.process({extent:t,primaryPixelBlocks:a,primaryRasterIds:g}):this.rasterFunction.process({extent:t,primaryPixelBlocks:a,primaryRasterIds:g});return{...e[0],pixelBlock:a}});return function(h,
c,f){return b.apply(this,arguments)}}();r._hasSameStorageInfo=function(b,h){const {storageInfo:c,pixelSize:f,spatialReference:m,extent:d}=b,{storageInfo:g,pixelSize:e,spatialReference:a,extent:t}=h;return f.x===e.x&&f.y===e.y&&m.equals(a)&&d.equals(t)&&c.blockHeight===g.blockHeight&&c.blockWidth===g.blockWidth&&c.maximumPyramidLevel===g.maximumPyramidLevel};return u}(z);n.__decorate([q.property({type:String,json:{write:!0}})],k.prototype,"datasetFormat",void 0);n.__decorate([q.property()],k.prototype,
"tileType",void 0);n.__decorate([q.property()],k.prototype,"rasterFunction",void 0);n.__decorate([q.property()],k.prototype,"primaryRasters",void 0);return k=n.__decorate([y.subclass("esri.layers.support.rasterDatasets.FunctionRaster")],k)});