// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.26/esri/copyright.txt for details.
//>>built
define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../rasterRenderers ../../request ../../core/Error ../../core/jsonMap ../../core/lang ../../core/Logger ../../core/maybe ../../core/reactiveUtils ../../core/urlUtils ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../support/commonProperties ../support/DimensionalDefinition ../support/ExportImageServiceParameters ../support/Field ../support/FieldsIndex ../support/imageBitmapUtils ../support/imageryRendererUtils ../support/MosaicRule ../support/MultidimensionalSubset ../support/PixelBlock ../support/rasterEnums ../support/RasterFunction ../support/RasterInfo ../support/RasterJobHandler ../support/rasterDatasets/multidimensionalUtils ../support/rasterFormats/RasterCodec ../support/rasterFunctions/vectorFieldUtils ../../renderers/support/rasterRendererHelper ../../renderers/support/RasterSymbolizer ../../rest/imageService ../../core/has ../support/source/DataLayerSource ../../rest/query/executeQueryJSON ../../config ../../kernel ../../core/unitUtils ../../geometry/support/spatialReferenceUtils ../graphics/featureConversionUtils ../../geometry/Extent ../../geometry/Geometry ../../geometry/Multipoint ../../geometry/Point ../../geometry/Polygon ../../geometry/Polyline ../../geometry/support/normalizeUtils ../../core/pbf ../../rest/support/FeatureSet ../../rest/support/Query ../../rest/query/support/AttachmentInfo ../../rest/support/AttachmentQuery ../../rest/query/executeForCount ../../rest/query/executeForIds ../../rest/support/RelationshipQuery ../../rest/support/TopFeaturesQuery ../../rest/imageService/fetchRasterInfo ../../rest/imageService/getCatalogItemRasterInfo ../../rest/support/ImageAngleParameters ../../rest/support/ImageAreaParameters ../../rest/support/ImageDistanceParameters ../../rest/support/ImageHeightParameters ../../rest/support/ImageHistogramParameters ../../rest/support/ImageIdentifyParameters ../../rest/support/ImagePixelLocationParameters ../../rest/support/ImagePointParameters ../../rest/support/ImageSampleParameters ../../views/2d/engine/flow/dataUtils ../../geometry/SpatialReference".split(" "),
function(Z,v,k,Sa,ka,R,D,y,la,aa,ba,u,ma,na,q,B,C,oa,H,ca,pa,qa,I,ra,da,sa,J,ta,S,L,K,ua,va,M,T,wa,N,xa,E,Ta,Ua,ya,Va,Wa,Xa,Ya,Za,U,$a,ab,bb,za,cb,db,eb,Aa,V,fb,gb,Ba,Ca,hb,ib,ea,Da,Ea,Fa,Ga,Ha,fa,ha,Ia,Ja,Ka,La,W){function Ma(h){return h?(h=JSON.stringify(h).match(/"rasterFunction":"(.*?")/gi)?.map(w=>w.replace('"rasterFunction":"',"").replace('"',"")))?h.join("/"):null:null}const X=la.strict()({U1:"u1",U2:"u2",U4:"u4",U8:"u8",S8:"s8",U16:"u16",S16:"s16",U32:"u32",S32:"s32",F32:"f32",F64:"f64",C64:"c64",
C128:"c128",UNKNOWN:"unknown"}),Na=new Set("png png8 png24 png32 jpg bmp gif jpgpng lerc tiff".split(" ")),Oa=q.ensureRange(B.ensureNumber,{min:0,max:255});Z.ArcGISImageService=h=>{function w(F){return F?.path??""}h=function(F){function O(){var b=F.apply(this,arguments)||this;b._functionRasterInfos={};b._rasterJobHandler={instance:null,refCount:0,connectionPromise:null};b._cachedRendererJson=null;b._serviceSupportsMosaicRule=null;b._rasterAttributeTableFieldPrefix="Raster.";b.adjustAspectRatio=null;
b.bandIds=void 0;b.capabilities=null;b.compressionQuality=void 0;b.compressionTolerance=.01;b.copyright=null;b.defaultMosaicRule=null;b.definitionExpression=null;b.exportImageServiceParameters=null;b.rasterInfo=null;b.fields=null;b.fullExtent=null;b.hasMultidimensions=!1;b.imageMaxHeight=4100;b.imageMaxWidth=4100;b.interpolation=void 0;b.minScale=0;b.maxScale=0;b.multidimensionalInfo=null;b.multidimensionalSubset=null;b.noData=null;b.noDataInterpretation=void 0;b.objectIdField=null;b.geometryType=
"polygon";b.typeIdField=null;b.types=[];b.pixelFilter=null;b.raster=void 0;b.sourceType=null;b.viewId=void 0;b.symbolizer=null;b.rasterFunctionInfos=null;b.serviceDataType=null;b.spatialReference=null;b.pixelType=null;b.serviceRasterInfo=null;b.sourceJSON=null;b.url=null;b.version=void 0;return b}v._inheritsLoose(O,F);var f=O.prototype;f.initialize=function(){this._set("exportImageServiceParameters",new qa.ExportImageServiceParameters({layer:this}))};f.readServiceSupportsMosaicRule=function(b,a){return this._isMosaicRuleSupported(a)};
f.readBandIds=function(b,a){if(Array.isArray(b)&&0<b.length&&b.every(c=>"number"===typeof c))return b};f.readCapabilities=function(b,a){return this._readCapabilities(a)};f.writeCompressionQuality=function(b,a,c){null!=b&&"lerc"!==this.format&&(a[c]=b)};f.writeCompressionTolerance=function(b,a,c){"lerc"===this.format&&null!=b&&(a[c]=b)};f.readDefaultMosaicRule=function(b,a){return this._serviceSupportsMosaicRule?J.fromJSON(a):null};f.readFormat=function(b,a){return"esriImageServiceDataTypeVector-UV"===
a.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===a.serviceDataType?"lerc":null!=this.pixelFilter?"lerc":"jpgpng"};f.readMinScale=function(b,a){return null!=a.minLOD&&null!=a.maxLOD?b:0};f.readMaxScale=function(b,a){return null!=a.minLOD&&null!=a.maxLOD?b:0};f.readMosaicRule=function(b,a){return(b=b||a.mosaicRule)?J.fromJSON(b):this._isMosaicRuleSupported(a)?J.fromJSON(a):null};f.writeMosaicRule=function(b,a,c){b=this.mosaicRule;const d=this.definitionExpression;b?d&&d!==b.where&&(b=b.clone(),
b.where=d):d&&(b=new J({where:d}));this._isValidCustomizedMosaicRule(b)&&(a[c]=b.toJSON())};f.writeNoData=function(b,a,c){null!=b&&"number"===typeof b&&(a[c]=Oa(b))};f.readObjectIdField=function(b,a){b||(b=(b=a.fields.filter(c=>"esriFieldTypeOID"===c.type||"oid"===c.type))&&b[0]&&b[0].name);return b};f.readSourceType=function(b,a){return this._isMosaicDataset(a)?"mosaic-dataset":"raster-dataset"};f.readRenderer=function(b,a,c){b=a?.layerDefinition?.drawingInfo?.renderer;c=R.read(b,c);if(null==c)return null;
"vector-field"===c.type&&a.symbolTileSize&&!b.symbolTileSize&&(c.symbolTileSize=a.symbolTileSize);sa.isSupportedRendererType(c)||ba.getLogger(this.declaredClass).warn("ArcGISImageService","Imagery layer doesn't support given renderer type.");return c};f.writeRenderer=function(b,a,c){a.layerDefinition=a.layerDefinition||{};a.layerDefinition.drawingInfo=a.layerDefinition.drawingInfo||{};a.layerDefinition.drawingInfo.renderer=b.toJSON();"vector-field"===b.type&&(a.symbolTileSize=b.symbolTileSize)};f.readRenderingRule=
function(b,a){b=a.rasterFunctionInfos;return a.renderingRule||b&&b.length&&"None"!==b[0].name?this._isRFTJson(a.renderingRule)?K.fromJSON({rasterFunctionDefinition:a.renderingRule}):K.fromJSON(a.renderingRule||{rasterFunctionInfos:a.rasterFunctionInfos}):null};f.writeRenderingRule=function(b,a,c){b=b.toJSON();a[c]=b.rasterFunctionDefinition?b.rasterFunctionDefinition:b};f.readSpatialReference=function(b,a){return(b=b||a.extent.spatialReference)?W.fromJSON(b):null};f.readPixelType=function(b){return X.fromJSON(b)||
b};f.writePixelType=function(b,a,c){if(u.isNone(this.serviceRasterInfo)||this.pixelType!==this.serviceRasterInfo.pixelType)a[c]=X.toJSON(b)};f.readVersion=function(b,a){(b=a.currentVersion)||(b=a.hasOwnProperty("fields")||a.hasOwnProperty("timeInfo")?10:9.3);return b};f.applyFilter=function(b){let a=b;this.pixelFilter&&(a=this._clonePixelData(b),this.pixelFilter(a));return a};f.applyRenderer=function(){var b=v._asyncToGenerator(function*(a,c){var d=a;const {renderer:e,symbolizer:g,pixelFilter:n,bandIds:l}=
this;if(!this._isPicture()&&e&&g&&!n){d=JSON.stringify(this._cachedRendererJson)!==JSON.stringify(e.toJSON());const p=this._rasterJobHandler.instance;p?(d&&(g.bind(),yield p.updateSymbolizer(g,c),this._cachedRendererJson=e.toJSON()),c=yield p.symbolize({bandIds:l,...a},c),d={extent:a.extent,pixelBlock:c}):d={extent:a.extent,pixelBlock:g.symbolize({bandIds:l,...a})}}return d});return function(a,c){return b.apply(this,arguments)}}();f.destroy=function(){this._shutdownJobHandler()};f.increaseRasterJobHandlerUsage=
function(){this._rasterJobHandler.refCount++};f.decreaseRasterJobHandlerUsage=function(){this._rasterJobHandler.refCount--;0>=this._rasterJobHandler.refCount&&this._shutdownJobHandler()};f.computeAngles=function(){var b=v._asyncToGenerator(function*(a,c){if(!(yield this._fetchCapabilities(c?.signal)).operations.supportsComputeAngles)throw new y("imagery-layer:compute-angles","this operation is not supported on the input image service");a=B.ensureClass(Ea,a).clone();return E.computeAngles(this.url,
a,this._getRequestOptions(c))});return function(a,c){return b.apply(this,arguments)}}();f.computePixelSpaceLocations=function(){var b=v._asyncToGenerator(function*(a,c){if(!(yield this._fetchCapabilities(c?.signal)).operations.supportsComputePixelLocation)throw new y("imagery-layer:compute-pixel-space-locations","this operation is not supported on the input image service");a=B.ensureClass(Ia,a).clone();return E.computePixelSpaceLocations(this.url,a,this._getRequestOptions(c))});return function(a,
c){return b.apply(this,arguments)}}();f.computeHistograms=function(){var b=v._asyncToGenerator(function*(a,c){if(!(yield this._fetchCapabilities(c?.signal)).operations.supportsComputeHistograms)throw new y("imagery-layer:compute-histograms","this operation is not supported on the input image service");a=B.ensureClass(fa,a).clone();this._applyMosaicAndRenderingRules(a);return E.computeHistograms(this.url,a,this._getRequestOptions(c))});return function(a,c){return b.apply(this,arguments)}}();f.computeStatisticsHistograms=
function(){var b=v._asyncToGenerator(function*(a,c){if(!(yield this._fetchCapabilities(c?.signal)).operations.supportsComputeStatisticsHistograms)throw new y("imagery-layer:compute-statistics-histograms","this operation is not supported on the input image service");a=B.ensureClass(fa,a).clone();this._applyMosaicAndRenderingRules(a);return E.computeStatisticsHistograms(this.url,a,this._getRequestOptions(c))});return function(a,c){return b.apply(this,arguments)}}();f.measureHeight=function(){var b=
v._asyncToGenerator(function*(a,c){const d=yield this._fetchCapabilities(c?.signal);if(!("base-and-top"===a.operationType?d.mensuration.supportsHeightFromBaseAndTop:"base-and-top-shadow"===a.operationType?d.mensuration.supportsHeightFromBaseAndTopShadow:d.mensuration.supportsHeightFromTopAndTopShadow))throw new y("imagery-layer:measure-height","this operation is not supported on the input image service");a=B.ensureClass(Ha,a).clone();this._applyMosaicAndRenderingRules(a);return E.measureHeight(this.url,
a,this._getRequestOptions(c))});return function(a,c){return b.apply(this,arguments)}}();f.measureAreaAndPerimeter=function(){var b=v._asyncToGenerator(function*(a,c){const d=yield this._fetchCapabilities(c?.signal);if(!d.mensuration.supportsAreaAndPerimeter||a.is3D&&!d.mensuration.supports3D)throw new y("imagery-layer:measure-area-and-perimeter","this operation is not supported on the input image service");a=B.ensureClass(Fa,a).clone();this._applyMosaicAndRenderingRules(a);return E.measureAreaAndPerimeter(this.url,
a,this._getRequestOptions(c))});return function(a,c){return b.apply(this,arguments)}}();f.measureDistanceAndAngle=function(){var b=v._asyncToGenerator(function*(a,c){const d=yield this._fetchCapabilities(c?.signal);if(!d.mensuration.supportsDistanceAndAngle||a.is3D&&!d.mensuration.supports3D)throw new y("imagery-layer:measure-distance-and-angle","this operation is not supported on the input image service");a=B.ensureClass(Ga,a).clone();this._applyMosaicAndRenderingRules(a);return E.measureDistanceAndAngle(this.url,
a,this._getRequestOptions(c))});return function(a,c){return b.apply(this,arguments)}}();f.measurePointOrCentroid=function(){var b=v._asyncToGenerator(function*(a,c){const d=yield this._fetchCapabilities(c?.signal);if(!d.mensuration.supportsPointOrCentroid||a.is3D&&!d.mensuration.supports3D)throw new y("imagery-layer:measure-point-or-centroid","this operation is not supported on the input image service");a=B.ensureClass(Ja,a).clone();this._applyMosaicAndRenderingRules(a);return E.measurePointOrCentroid(this.url,
a,this._getRequestOptions(c))});return function(a,c){return b.apply(this,arguments)}}();f.getField=function(b){const {fieldsIndex:a}=this;return u.isSome(a)?a.get(b):void 0};f.getFieldDomain=function(b,a){return(b=this.getField(b))?b.domain:null};f.fetchImage=function(){var b=v._asyncToGenerator(function*(a,c,d,e={}){if(null==a||null==c||null==d)throw new y("imagery-layer:fetch-image","Insufficient parameters for requesting an image. A valid extent, width and height values are required.");if(this.renderer||
this.symbolizer){var g=yield this.generateRasterInfo(this.renderingRule,{signal:e.signal});g&&(this.rasterInfo=g)}g=this.getExportImageServiceParameters(a,c,d,e.timeExtent);if(null==g){if(e.requestAsImageElement&&this._canRequestImageElement(this.format))return a=document.createElement("canvas"),a.width=c,a.height=d,e.returnImageBitmap?{imageBitmap:yield da.createBitmap(a,`${w(this.parsedUrl)}/exportImage`)}:{imageOrCanvasElement:a};const {bandIds:l,rasterInfo:p}=this;e=(l?.length||p.bandCount)??
0;g=c*d;var n=p.pixelType;const m=[];for(let r=0;r<e;r++)m.push(S.createEmptyBand(n,g));return{pixelData:{pixelBlock:new S({width:c,height:d,pixels:m,mask:new Uint8Array(g),pixelType:n}),extent:a}}}n=!!e.requestAsImageElement&&!this.pixelFilter;return this._requestArrayBuffer({imageServiceParameters:g,imageProps:{extent:a,width:c,height:d,format:this.format},requestAsImageElement:n,returnImageBitmap:n&&!!e.returnImageBitmap,signal:e.signal})});return function(a,c,d){return b.apply(this,arguments)}}();
f.fetchKeyProperties=function(b){return D(w(this.parsedUrl)+"/keyProperties",{query:this._getQueryParams({renderingRule:10.3<=this.version?b?.renderingRule:null})}).then(a=>a.data)};f.fetchRasterAttributeTable=function(b){return 10.1>this.version?Promise.reject(new y("#fetchRasterAttributeTable()","Failed to get rasterAttributeTable")):D(w(this.parsedUrl)+"/rasterAttributeTable",{query:this._getQueryParams({renderingRule:10.3<=this.version?b?.renderingRule:null})}).then(a=>Aa.fromJSON(a.data))};f.getCatalogItemRasterInfo=
function(b,a){const c=this._getQueryParams();a={...a,query:c};return Da.getCatalogItemRasterInfo(w(this.parsedUrl),b,a)};f.getCatalogItemICSInfo=function(){var b=v._asyncToGenerator(function*(a,c){var {data:d}=yield D(w(this.parsedUrl)+"/"+a+"/info/ics",{query:this._getQueryParams(),...c});if(d=d&&d.ics){var e=null;try{e=(yield D(w(this.parsedUrl)+"/"+a+"/info",{query:this._getQueryParams(),...c})).data.extent}catch{}if(!e||!e.spatialReference)return{ics:d,icsToPixelTransform:null,icsExtent:null,
northDirection:null};var g=10.7<=this.version?D(w(this.parsedUrl)+"/"+a+"/info/icstopixel",{query:this._getQueryParams(),...c}).then(t=>t.data).catch(()=>({})):{},n=e.spatialReference,l={geometries:JSON.stringify({geometryType:"esriGeometryEnvelope",geometries:[e]}),inSR:n.wkid||JSON.stringify(n),outSR:"0:"+a};l=D(w(this.parsedUrl)+"/project",{query:this._getQueryParams(l),...c}).then(t=>t.data).catch(()=>({}));var p=(e.xmin+e.xmax)/2,m=(e.ymax-e.ymin)/6;e=e.ymin+m;var r=[];for(let t=0;5>t;t++)r.push({x:p,
y:e+m*t});a={geometries:JSON.stringify({geometryType:"esriGeometryPoint",geometries:r}),inSR:n.wkid||JSON.stringify(n),outSR:"0:"+a};c=D(w(this.parsedUrl)+"/project",{query:this._getQueryParams(a),...c}).then(t=>t.data).catch(()=>({}));a=yield Promise.all([g,l,c]);c=a[0].ipxf;null==c&&(g=d.geodataXform?.xf_0,"topup"===g?.name?.toLowerCase()&&6===g?.coefficients?.length&&(c={affine:{name:"ics [sensor: Frame] to pixel (column, row) transformation",coefficients:g.coefficients,cellsizeRatio:0,type:"GeometricXform"}}));
if(g=U.fromJSON(a[1]&&a[1].geometries&&a[1].geometries[0]))g.spatialReference=new W({wkid:0,imageCoordinateSystem:d});a=a[2].geometries?a[2].geometries.filter(t=>null!=t&&null!=t.x&&null!=t.y&&"NaN"!==t.x&&"NaN"!==t.y):[];l=a.length;if(3>l)return{ics:d,icsToPixelTransform:c,icsExtent:g,northDirection:null};e=m=p=n=0;for(r=0;r<l;r++)n+=a[r].x,p+=a[r].y,m+=a[r].x*a[r].x,e+=a[r].x*a[r].y;l=(l*e-n*p)/(l*m-n*n);n=0;p=a[4].x>a[0].x;a=a[4].y>a[0].y;Infinity===l?n=a?90:270:0===l?n=p?0:180:0<l?n=p?180*Math.atan(l)/
Math.PI:180*Math.atan(l)/Math.PI+180:0>l&&(n=a?180+180*Math.atan(l)/Math.PI:360+180*Math.atan(l)/Math.PI);return{ics:d,icsToPixelTransform:c,icsExtent:g,northDirection:n}}});return function(a,c){return b.apply(this,arguments)}}();f.generateRasterInfo=function(){var b=v._asyncToGenerator(function*(a,c){a=B.ensureClass(K,a);if(this.serviceRasterInfo&&(!a||"none"===a.functionName?.toLowerCase()||this._isVectorFieldResampleFunction(a)))return this.serviceRasterInfo;const d=Ma(a);if(!d)return null;if(this._functionRasterInfos[d])return this._functionRasterInfos[d];
a=this._generateRasterInfo(a,c);this._functionRasterInfos[d]=a;try{return yield a}catch{return this._functionRasterInfos[d]=null}});return function(a,c){return b.apply(this,arguments)}}();f.getExportImageServiceParameters=function(b,a,c,d){b=b.clone().shiftCentralMeridian();const e=E.getImageSpatialReferenceQueryParameter(b.spatialReference,w(this.parsedUrl));this.pixelType!==this.serviceRasterInfo.pixelType&&(this.exportImageServiceParameters.pixelType=this.pixelType);const g=this.exportImageServiceParameters.toJSON(),
{bandIds:n,noData:l}=g;var {renderingRule:p}=g,m=this.renderingRule?.rasterFunctionDefinition,r=!this.renderer||"raster-stretch"===this.renderer.type;n?.length&&this._hasRenderingRule(this.renderingRule)&&!m&&r?(m={rasterFunction:"ExtractBand",rasterFunctionArguments:{BandIds:n}},"Stretch"===p.rasterFunction?(m.rasterFunctionArguments.Raster=p.rasterFunctionArguments.Raster,p.rasterFunctionArguments.Raster=m):"Colormap"===p.rasterFunction?(r=p.rasterFunctionArguments.Raster,"Stretch"===r?.rasterFunction?
(m.rasterFunctionArguments.Raster=r.rasterFunctionArguments.Raster,r.rasterFunctionArguments.Raster=m):(m.rasterFunctionArguments.Raster=r,p.rasterFunctionArguments.Raster=m)):(m.rasterFunctionArguments.Raster=p,p=m),g.bandIds=void 0):g.bandIds=n?.join(",");l instanceof Array&&0<l.length&&(g.noData=l.join(","));d=this._processMultidimensionalIntersection(null,d,this.exportImageServiceParameters.mosaicRule);if(d.isOutSide)return null;g.mosaicRule=u.isSome(d.mosaicRule)?JSON.stringify(d.mosaicRule):
null;d=d.timeExtent;g.renderingRule=this._getRenderingRuleString(K.fromJSON(p));p={};if(u.isSome(d)){const {start:t,end:A}=d.toJSON();if(t&&A&&t===A)p.time=""+t;else if(null!=t||null!=A)p.time=`${null==t?"null":t},${null==A?"null":A}`}return{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,bboxSR:e,imageSR:e,size:a+","+c,...g,...p}};f.getSamples=function(){var b=v._asyncToGenerator(function*(a,c){if(!(yield this._fetchCapabilities(c?.signal))?.operations.supportsGetSamples)throw new y("imagery-layer:get-samples",
"getSamples operation is not supported on the input image service");a=B.ensureClass(Ka,a).clone();const {raster:d}=this;d&&null==a.raster&&(a.raster=d);return E.getSamples(this.url,a,this._getRequestOptions(c))});return function(a,c){return b.apply(this,arguments)}}();f.identify=function(){var b=v._asyncToGenerator(function*(a,c){if(!(yield this._fetchCapabilities(c?.signal)).operations.supportsIdentify)throw new y("imagery-layer:identify","identify operation is not supported on the input image service");
a=B.ensureClass(ha,a).clone();const d=this._processMultidimensionalIntersection(a.geometry,a.timeExtent,a.mosaicRule||this.mosaicRule);if(d.isOutSide)throw new y("imagery-layer:identify","the request cannot be fulfilled when falling outside of the multidimensional subset");a.timeExtent=u.unwrap(d.timeExtent);a.mosaicRule=u.unwrap(d.mosaicRule);const {raster:e,renderingRule:g}=this;g&&null==a.renderingRule&&(a.renderingRule=g);e&&null==a.raster&&(a.raster=e);return E.identify(this.url,a,this._getRequestOptions(c))});
return function(a,c){return b.apply(this,arguments)}}();f.createQuery=function(){const b=new V;b.outFields=["*"];b.returnGeometry=!0;b.where=this.definitionExpression||"1\x3d1";return b};f.queryRasters=function(){var b=v._asyncToGenerator(function*(a,c){({query:a,requestOptions:c}=yield this._prepareForQuery(a,c));return ya.executeQueryJSON(this.url,a,c)});return function(a,c){return b.apply(this,arguments)}}();f.queryObjectIds=function(){var b=v._asyncToGenerator(function*(a,c){({query:a,requestOptions:c}=
yield this._prepareForQuery(a,c));return Ca.executeForIds(this.url,a,c)});return function(a,c){return b.apply(this,arguments)}}();f.queryRasterCount=function(){var b=v._asyncToGenerator(function*(a,c){({query:a,requestOptions:c}=yield this._prepareForQuery(a,c));return Ba.executeForCount(this.url,a,c)});return function(a,c){return b.apply(this,arguments)}}();f.queryVisibleRasters=function(){var b=v._asyncToGenerator(function*(a,c){if(!a)throw new y("imagery-layer: query-visible-rasters","missing query parameter");
yield this.load();const {pixelSize:d,returnDomainValues:e,returnTopmostRaster:g,showNoDataRecords:n}=c||{pixelSize:null,returnDomainValues:!1,returnTopmostRaster:!1,showNoDataRecords:!1};let l=!1;var p=null,m=null;const r=this._rasterFunctionNamesIndex;if(u.isSome(a.outFields)&&(l=a.outFields.some(z=>!z.toLowerCase().includes("raster.servicepixelvalue")),10.4<=this.version)){m=a.outFields.filter(x=>x.toLowerCase().includes("raster.servicepixelvalue")&&24<x.length).map(x=>{x=x.slice(25);return[this._updateRenderingRulesFunctionName(x,
r),x]});p=m.map(x=>new K({functionName:x[0]}));m=m.map(x=>x[1]);const {renderingRule:z}=this;0===p.length?z?.functionName?(p.push(z),m.push(z.functionName)):p=null:z?.functionName&&!p.some(x=>x.functionName===z.functionName)&&(p.push(z),m.push(z.functionName))}const t=u.isNone(a.outSpatialReference)||a.outSpatialReference.equals(this.spatialReference);var {multidimensionalSubset:A}=this;let G=a.timeExtent||this.timeExtent;if(A){const {isOutside:z,intersection:x}=M.intersectMultimensionalSubset(A,
{geometry:u.unwrap(a.geometry),timeExtent:u.unwrap(a.timeExtent),multidimensionalDefinition:this.exportImageServiceParameters.mosaicRule?.multidimensionalDefinition});if(z)throw new y("imagery-layer:query-visible-rasters","the request cannot be fulfilled when falling outside of the multidimensional subset");x&&u.isSome(x.timeExtent)&&(G=x.timeExtent)}A=this._combineMosaicRuleWithTimeExtent(this.exportImageServiceParameters.mosaicRule,G);p=this._getQueryParams({geometry:a.geometry,timeExtent:G,mosaicRule:A,
renderingRule:10.4>this.version?this.renderingRule:null,renderingRules:p,pixelSize:d,returnCatalogItems:l,returnGeometry:t,raster:this.raster,maxItemCount:g?1:null});delete p.f;p=new ha(p);try{yield this.generateRasterInfo(this.renderingRule);const z=yield E.identify(this.url,p,{signal:c?.signal,query:{...this.customParameters}}),x=a.outFields,Pa=null!=z.value&&z.value.toLowerCase().includes("nodata");if(!l||t||!z?.catalogItems?.features.length||!n&&Pa)return this._processVisibleRastersResponse(z,
{returnDomainValues:e,templateRRFunctionNames:m,showNoDataRecords:n,templateFields:x});const P=this.objectIdField||"ObjectId",ia=z.catalogItems?.features??[],Qa=ia.map(Q=>Q.attributes?.[P]),Ra=new V({objectIds:Qa,returnGeometry:!0,outSpatialReference:a.outSpatialReference,outFields:[P]}),ja=yield this.queryRasters(Ra);ja?.features?.length&&ja.features.forEach(Q=>{ia.forEach(Y=>{Y.attributes[P]===Q.attributes[P]&&(Y.geometry=new za(Q.geometry),u.isSome(a.outSpatialReference)&&(Y.geometry.spatialReference=
a.outSpatialReference))})});return this._processVisibleRastersResponse(z,{returnDomainValues:e,templateRRFunctionNames:m,showNoDataRecords:n,templateFields:x})}catch{throw new y("imagery-layer:query-visible-rasters","encountered error when querying visible rasters");}});return function(a,c){return b.apply(this,arguments)}}();f.fetchVariableStatisticsHistograms=function(){var b=v._asyncToGenerator(function*(a,c){var d=D(w(this.parsedUrl)+"/statistics",{query:this._getQueryParams({variable:a}),signal:c}).then(e=>
e.data?.statistics);a=D(w(this.parsedUrl)+"/histograms",{query:this._getQueryParams({variable:a}),signal:c}).then(e=>e.data?.histograms);d=yield Promise.all([d,a]);d[0]&&d[0].forEach(e=>{e.avg=e.mean;e.stddev=e.standardDeviation});return{statistics:d[0]||null,histograms:d[1]||null}});return function(a,c){return b.apply(this,arguments)}}();f.createFlowMesh=function(){var b=v._asyncToGenerator(function*(a,c){const d=this._rasterJobHandler.instance;return d?d.createFlowMesh(a,c):La.createFlowMesh(a.meshType,
a.simulationSettings,a.flowData,u.isSome(c.signal)?c.signal:(new AbortController).signal)});return function(a,c){return b.apply(this,arguments)}}();f.getMultidimensionalSubsetVariables=function(b){return M.getSubsetVariablesFromMdInfo(this.multidimensionalSubset,b??this.serviceRasterInfo.multidimensionalInfo)};f._fetchService=function(){var b=v._asyncToGenerator(function*(a){yield this._fetchServiceInfo(a);this.rasterInfo||(this.rasterInfo=this.serviceRasterInfo);var c=this.sourceJSON;c=u.isSome(this.serviceRasterInfo)?
Promise.resolve(this.serviceRasterInfo):ea.fetchServiceRasterInfo(w(this.parsedUrl),c,{signal:a,query:this._getQueryParams()}).then(e=>{this._set("serviceRasterInfo",e);this._set("multidimensionalInfo",e.multidimensionalInfo);return e});a=this._hasRenderingRule(this.renderingRule)?this.generateRasterInfo(this.renderingRule,{signal:a}):null;const d=this._getRasterFunctionInfos();return Promise.all([c,a,d]).then(e=>{e[1]?this._set("rasterInfo",e[1]):this._set("rasterInfo",e[0]);e[2]&&this._set("rasterFunctionInfos",
e[2]);this.renderer&&!this._isSupportedRenderer(this.renderer)&&(this._set("renderer",null),ba.getLogger(this.declaredClass).warn("ArcGISImageService","Switching to the default renderer. Renderer applied is not valid for this Imagery Layer"));this._set("renderer",this._configRenderer(this.renderer));this.addHandles([ma.watch(()=>this.renderingRule,g=>{(this.renderer||this.symbolizer||this.popupEnabled&&this.popupTemplate)&&this.generateRasterInfo(g).then(n=>{n&&(this.rasterInfo=n)})})]);({serviceRasterInfo:e}=
this);u.isSome(e.multidimensionalInfo)&&this._updateMultidimensionalDefinition(e)})});return function(a){return b.apply(this,arguments)}}();f._combineMosaicRuleWithTimeExtent=function(b,a){var c=this.timeInfo,{multidimensionalInfo:d}=this.serviceRasterInfo;if(u.isNone(b)||u.isNone(d)||u.isNone(a)||u.isNone(c?.startField))return b;const {startField:e}=c,g=d.variables.some(m=>m.dimensions.some(r=>r.name===e))?e:"StdTime";b=b.clone();if("mosaic-dataset"===this.sourceType)return b.multidimensionalDefinition=
b.multidimensionalDefinition?.filter(m=>m.dimensionName!==g),this._cleanupMultidimensionalDefinition(b);b.multidimensionalDefinition=b.multidimensionalDefinition||[];c=b.multidimensionalDefinition.filter(m=>m.dimensionName===g);d=u.isSome(a.start)?a.start.getTime():null;a=u.isSome(a.end)?a.end.getTime():null;const n=null==d||null==a||d===a,l=n?[d||a]:[[d,a]],p=10.8<=this.version;c.length?c.forEach(m=>{m.dimensionName===g&&(p?(m.dimensionName=null,m.isSlice=!1,m.values=[]):(m.isSlice=n,m.values=l))}):
p||(a=b.multidimensionalDefinition.filter(m=>null!=m.variableName&&null==m.dimensionName),a.length?a.forEach(m=>{m.dimensionName=g;m.isSlice=n;m.values=l}):b.multidimensionalDefinition.push(new pa({variableName:"",dimensionName:g,isSlice:n,values:l})));return this._cleanupMultidimensionalDefinition(b)};f._cleanupMultidimensionalDefinition=function(b){if(u.isNone(b))return null;b.multidimensionalDefinition&&(b.multidimensionalDefinition=b.multidimensionalDefinition.filter(a=>!(!a.variableName&&!a.dimensionName)),
0===b.multidimensionalDefinition.length&&(b.multidimensionalDefinition=null));return"mosaic-dataset"!==this.sourceType&&null==b.multidimensionalDefinition?null:b};f._prepareForQuery=function(){var b=v._asyncToGenerator(function*(a,c){if(!(yield this._fetchCapabilities(c?.signal)).operations.supportsQuery)throw new y("imagery-layer:query-rasters","query operation is not supported on the input image service");a=u.isSome(a)?B.ensureClass(V,a):this.createQuery();c=this._getRequestOptions(c);this.raster&&
(c.query={...c.query,raster:this.raster});return{query:a,requestOptions:c}});return function(a,c){return b.apply(this,arguments)}}();f._initJobHandler=function(){var b=v._asyncToGenerator(function*(){if(null!=this._rasterJobHandler.connectionPromise)return this._rasterJobHandler.connectionPromise;const a=new va;this._rasterJobHandler.connectionPromise=a.initialize().then(()=>{this._rasterJobHandler.instance=a},()=>{});yield this._rasterJobHandler.connectionPromise});return function(){return b.apply(this,
arguments)}}();f._shutdownJobHandler=function(){this._rasterJobHandler.instance&&this._rasterJobHandler.instance.destroy();this._rasterJobHandler.instance=null;this._rasterJobHandler.connectionPromise=null;this._rasterJobHandler.refCount=0;this._cachedRendererJson=null};f._isSupportedRenderer=function(b){const {rasterInfo:a,renderingRule:c}=this;return"unique-value"===b.type&&this._hasRenderingRule(c)&&1===a?.bandCount&&["u8","s8"].includes(a.pixelType)||null!=a&&null!=b&&N.getSupportedRendererTypes(a).includes(b.type)};
f._fetchCapabilities=function(){var b=v._asyncToGenerator(function*(a){if(this.capabilities)return this.capabilities;yield this._fetchServiceInfo(a);return this.capabilities});return function(a){return b.apply(this,arguments)}}();f._fetchServiceInfo=function(){var b=v._asyncToGenerator(function*(a){let c=this.sourceJSON;if(!c){const {data:d,ssl:e}=yield D(w(this.parsedUrl),{query:this._getQueryParams(),signal:a});this.sourceJSON=c=d;e&&(this.url=this.url.replace(/^http:/i,"https:"))}if(-1<c.capabilities?.toLowerCase().split(",").map(d=>
d.trim()).indexOf("tilesonly"))throw new y("imagery-layer:fetch-service-info","use ImageryTileLayer to open tiles-only image services");this.read(c,{origin:"service",url:this.parsedUrl})});return function(a){return b.apply(this,arguments)}}();f._isMosaicDataset=function(b){return b.serviceSourceType?"esriImageServiceSourceTypeMosaicDataset"===b.serviceSourceType:0<b.fields?.length};f._isMosaicRuleSupported=function(b){if(!b)return!1;const a=this._isMosaicDataset(b);b=10.71<=b.currentVersion&&b.hasMultidimensions&&
!(1<b.fields?.length);return a||b};f._isVectorFieldResampleFunction=function(b){if(u.isNone(b))return!1;const {functionName:a,functionArguments:c}=b;b="resample"===a?.toLowerCase();const d=c?.ResampleType||c?.resampleType;return b&&(7===d||10===d)};f._isPicture=function(){return!this.format||this.format.includes("jpg")||this.format.includes("png")};f._configRenderer=function(b){var a=this._isPicture();const {rasterInfo:c}=this;if(!a&&!this.pixelFilter||this._isVectorDataSet())!this.bandIds&&3<=c.bandCount&&
(!(a=N.getDefaultBandCombination(c))||3===c.bandCount&&0===a[0]&&1===a[1]&&2===a[2]||(this.bandIds=a)),b||(b=N.createDefaultRenderer(c,{bandIds:this.bandIds,variableName:this.renderingRule?null:this.mosaicRule?.multidimensionalDefinition?.[0].variableName})),a=N.normalizeRendererJSON(b.toJSON()),this.symbolizer?(this.symbolizer.rendererJSON=a,this.symbolizer.rasterInfo=c):this.symbolizer=new xa({rendererJSON:a,rasterInfo:c}),this.symbolizer.bind().success||(this.symbolizer=null);return b};f._clonePixelData=
function(b){return null==b?b:{extent:b.extent&&b.extent.clone(),pixelBlock:u.isSome(b.pixelBlock)?b.pixelBlock.clone():null}};f._getQueryParams=function(b){b&&u.isSome(b.renderingRule)&&"string"!==typeof b.renderingRule&&(b.renderingRule=this._getRenderingRuleString(b.renderingRule));const {raster:a,viewId:c}=this;return{raster:a,viewId:c,f:"json",...b,...this.customParameters}};f._getRequestOptions=function(b){return{...b,query:{...b?.query,...this.customParameters}}};f._decodePixelBlock=function(b,
a,c){return this._rasterJobHandler.instance?this._rasterJobHandler.instance.decode({data:b,options:a}):T.decode(b,a,c)};f._getRasterFunctionInfos=function(){var b=v._asyncToGenerator(function*(a){const c=this.sourceJSON.rasterFunctionInfos;return this.loaded?c:c&&10.3<=this.version?1===c.length&&"none"===c[0].name.toLowerCase()?c:(yield D(w(this.parsedUrl)+"/rasterFunctionInfos",{query:this._getQueryParams(),signal:a})).data?.rasterFunctionInfos:null});return function(a){return b.apply(this,arguments)}}();
f._canRequestImageElement=function(b){return!this.pixelFilter&&(!b||b.includes("png"))};f._requestArrayBuffer=function(){var b=v._asyncToGenerator(function*(a){const {imageProps:c,requestAsImageElement:d,returnImageBitmap:e,signal:g}=a;if(d&&this._canRequestImageElement(c.format)){var n=`${w(this.parsedUrl)}/exportImage`;({data:a}=yield D(n,{responseType:e?"blob":"image",query:this._getQueryParams({f:"image",...this.refreshParameters,...a.imageServiceParameters}),signal:g}));return a instanceof Blob?
{imageBitmap:yield da.createBitmap(a,n),params:c}:{imageOrCanvasElement:a,params:c}}n=this._initJobHandler();a=D(w(this.parsedUrl)+"/exportImage",{responseType:"array-buffer",query:this._getQueryParams({f:"image",...a.imageServiceParameters}),signal:g});a=(yield Promise.all([a,n]))[0].data;var l=n=c.format||"jpgpng";"bsq"!==l&&"bip"!==l&&(l=T.getFormat(a));if(!l)throw new y("imagery-layer:fetch-image","unsupported format signature "+String.fromCharCode.apply(null,new Uint8Array(a)));l="gif"===n||
"bmp"===n||n.includes("png")&&("png"===l||"jpg"===l);const p={signal:g};return{pixelData:{pixelBlock:yield l?T.decode(a,{useCanvas:!0,...c},p):this._decodePixelBlock(a,{width:c.width,height:c.height,planes:null,pixelType:null,noDataValue:null,format:n},p),extent:c.extent},params:c}});return function(a){return b.apply(this,arguments)}}();f._generateRasterInfo=function(b,a){const c=this._getQueryParams();a={...a,query:c};return ea.generateRasterInfo(w(this.parsedUrl),b,a)};f._isValidCustomizedMosaicRule=
function(b){return b&&JSON.stringify(b.toJSON())!==JSON.stringify(this.defaultMosaicRule?.toJSON())};f._updateMultidimensionalDefinition=function(b){if(!this._isValidCustomizedMosaicRule(this.mosaicRule)&&(b=M.getDefaultMultidimensionalDefinition(b,{multidimensionalSubset:this.multidimensionalSubset}),u.isSome(b)&&0<b.length)){this.mosaicRule=this.mosaicRule||new J;const a=this.mosaicRule.multidimensionalDefinition;!this.sourceJSON.defaultVariableName&&this.renderingRule&&"none"!==this.renderingRule.functionName?.toLowerCase()&&
b.forEach(c=>c.variableName="");b=b.filter(({variableName:c,dimensionName:d})=>c&&"*"!==c||d);!a?.length&&b.length&&(this.mosaicRule.multidimensionalDefinition=b)}};f._processVisibleRastersResponse=function(b,a){a=a||{};const c=b.value,{templateRRFunctionNames:d,showNoDataRecords:e,returnDomainValues:g,templateFields:n}=a;a=b.processedValues;var l=b.catalogItems&&b.catalogItems.features;let p=b.properties&&b.properties.Values&&b.properties.Values.map(G=>G.replace(/ /gi,", "))||[];var m=this.objectIdField||
"ObjectId",r="string"===typeof c&&c.toLowerCase().includes("nodata");b=[];!c||l||r||(l={},l[m]=0,l=new ka(this.fullExtent,null,l),p=[c],l=[l]);if(!l)return[];this._updateResponseFieldNames(l,n);r&&!e&&(l=[]);for(m=0;m<l.length;m++){r=l[m];if(null!=c){var t=p[m];var A=this.renderingRule&&a&&0<a.length&&d&&0<d.length&&d.includes(this.renderingRule.functionName)?a[d.indexOf(this.renderingRule.functionName)]:c;if("nodata"===t.toLowerCase()&&!e)continue;r.attributes["Raster.ItemPixelValue"]=t;r.attributes["Raster.ServicePixelValue"]=
A;this._updateFeatureWithMagDirValues(r,t);const G=this.fields&&0<this.fields.length;A=this.renderingRule&&u.isSome(this.serviceRasterInfo.attributeTable)?G?t:c:A;this.renderingRule||(A=G?t:c);this._updateFeatureWithRasterAttributeTableValues(r,A)}r.sourceLayer=r.layer=this;g&&this._updateFeatureWithDomainValues(r);if(d&&a&&d.length===a.length)for(t=0;t<d.length;t++)r.attributes["Raster.ServicePixelValue."+d[t]]=a[t];b.push(l[m])}return b};f._processMultidimensionalIntersection=function(b,a,c){const {multidimensionalSubset:d}=
this;if(!d)return c=this._combineMosaicRuleWithTimeExtent(c,a),{isOutSide:!1,timeExtent:a,mosaicRule:c};if(d){const {isOutside:e,intersection:g}=M.intersectMultimensionalSubset(d,{geometry:b,timeExtent:a});if(e)return{isOutSide:!0,timeExtent:null,mosaicRule:null};g&&u.isSome(g.timeExtent)&&(a=g.timeExtent)}c=this._combineMosaicRuleWithTimeExtent(c,a);return u.isSome(c)&&c.multidimensionalDefinition&&({isOutside:b}=M.intersectMultimensionalSubset(d,{multidimensionalDefinition:c.multidimensionalDefinition}),
b)?{isOutSide:!0,timeExtent:null,mosaicRule:null}:{isOutSide:!1,timeExtent:a,mosaicRule:c}};f._updateFeatureWithRasterAttributeTableValues=function(b,a){var c=this.rasterInfo.attributeTable||this.serviceRasterInfo.attributeTable;if(!u.isNone(c)){var {features:d,fields:e}=c,g=(c=e.map(l=>l.name).filter(l=>"value"===l.toLowerCase()))&&c[0];if(g){var n=d.filter(l=>l.attributes[g]===(null!=a?parseInt(a,10):null));n&&n[0]&&e.forEach(l=>{b.attributes[this._rasterAttributeTableFieldPrefix+l.name]=n[0].attributes[l.name]})}}};
f._updateFeatureWithMagDirValues=function(b,a){if(this._isVectorDataSet()){var c=a.split(/,\s*/).map(d=>parseFloat(d));a=c.map(d=>[d]);c=c.map(d=>({minValue:d,maxValue:d,noDataValue:null}));a=new S({height:1,width:1,pixelType:"f32",pixels:a,statistics:c});null!=this.pixelFilter&&this.pixelFilter({pixelBlock:a,extent:new U(0,0,0,0,this.spatialReference)});a="esriImageServiceDataTypeVector-MagDir"===this.serviceDataType?[a.pixels[0][0],a.pixels[1][0]]:wa.uvComponentToVector([a.pixels[0][0],a.pixels[1][0]]);
b.attributes["Raster.Magnitude"]=a[0];b.attributes["Raster.Direction"]=a[1]}};f._updateFeatureWithDomainValues=function(b){const a=this.fields&&this.fields.filter(c=>c.domain&&"coded-value"===c.domain.type);null!=a&&a.forEach(c=>{const d=b.attributes[c.name];if(null!=d){const e=c.domain.codedValues.find(g=>g.code===d);e&&(b.attributes[c.name]=e.name)}})};f._updateResponseFieldNames=function(b,a){if(a&&!(1>a.length)){var c=this.fieldsIndex;u.isNone(c)||b.forEach(d=>{if(d&&d.attributes)for(const e of a){const g=
c.get(e)?.name;g&&g!==e&&(d.attributes[e]=d.attributes[g],delete d.attributes[g])}})}};f._getRenderingRuleString=function(b){if(b){b=b.toJSON();b=b.rasterFunctionDefinition??b;if(b.thumbnail||b.thumbnailEx)b.thumbnail=b.thumbnailEx=null;return JSON.stringify(b)}return null};f._hasRenderingRule=function(b){return null!=b&&null!=b.functionName&&"none"!==b.functionName.toLowerCase()};f._updateRenderingRulesFunctionName=function(b,a){if(b&&!(1>b.length)){if("Raw"===b)return b.replace("Raw","None");var c=
b.toLowerCase().replace(/ /gi,"_");return a.has(c)?a.get(c):b}};f._isRFTJson=function(b){return b&&b.name&&b.arguments&&b.function&&b.hasOwnProperty("functionType")};f._isVectorDataSet=function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType};f._applyMosaicAndRenderingRules=function(b){const {raster:a,mosaicRule:c,renderingRule:d}=this;d&&null==b.renderingRule&&(b.renderingRule=d);c&&null==b.mosaicRule&&(b.mosaicRule=
c);a&&null==b.raster&&(b.raster=a)};f._readCapabilities=function(b){const a=b.capabilities?b.capabilities.toLowerCase().split(",").map(t=>t.trim()):["image","catalog"],{currentVersion:c,advancedQueryCapabilities:d,maxRecordCount:e}=b,g=a.includes("image"),n="esriImageServiceDataTypeElevation"===b.serviceDataType;var l=!!(b.spatialReference||b.extent&&b.extent.spatialReference);const p=a.includes("edit");l=a.includes("mensuration")&&l;const m=null==b.mensurationCapabilities?[]:b.mensurationCapabilities.toLowerCase().split(",").map(t=>
t.trim()),r=l&&m.includes("basic");return{data:{supportsAttachment:!1},operations:{supportsComputeHistograms:g,supportsExportImage:g,supportsIdentify:g,supportsMeasure:l,supportsDownload:a.includes("download"),supportsQuery:a.includes("catalog")&&b.fields&&0<b.fields.length,supportsGetSamples:10.2<=c&&g,supportsProject:10.3<=c&&g,supportsComputeStatisticsHistograms:10.4<=c&&g,supportsQueryBoundary:10.6<=c&&g,supportsCalculateVolume:10.7<=c&&n,supportsComputePixelLocation:10.7<=c&&a.includes("catalog"),
supportsComputeAngles:10.91<=c,supportsAdd:p,supportsDelete:p,supportsEditing:p,supportsUpdate:p,supportsCalculate:!1,supportsTruncate:!1,supportsValidateSql:!1,supportsChangeTracking:!1,supportsQueryAttachments:!1,supportsResizeAttachments:!1,supportsSync:!1,supportsExceedsLimitStatistics:!1,supportsQueryAnalytics:!1,supportsQueryTopFeatures:!1},query:{maxRecordCount:e,maxRecordCountFactor:void 0,supportsStatistics:!!d?.supportsStatistics,supportsOrderBy:!!d?.supportsOrderBy,supportsDistinct:!!d?.supportsDistinct,
supportsPagination:!!d?.supportsPagination,supportsStandardizedQueriesOnly:!!d?.useStandardizedQueries,supportsPercentileStatistics:!!d?.supportsPercentileStatistics,supportsCentroid:!!d?.supportsReturningGeometryCentroid,supportsDistance:!!d?.supportsQueryWithDistance,supportsExtent:!!d?.supportsReturningQueryExtent,supportsGeometryProperties:!!d?.supportsReturningGeometryProperties,supportsHavingClause:!!d?.supportsHavingClause,supportsQuantization:!1,supportsQuantizationEditMode:!1,supportsQueryGeometry:!1,
supportsResultType:!1,supportsMaxRecordCountFactor:!1,supportsSqlExpression:!1,supportsTopFeaturesQuery:!1,supportsQueryByOthers:!1,supportsHistoricMoment:!1,supportsFormatPBF:!1,supportsDisjointSpatialRelationship:!1,supportsCacheHint:!1,supportsSpatialAggregationStatistics:!1,supportedSpatialAggregationStatistics:{envelope:!1,centroid:!1,convexHull:!1},supportsDefaultSpatialReference:!!d?.supportsDefaultSR,supportsFullTextSearch:!1,supportsCompactGeometry:!1,standardMaxRecordCount:void 0,tileMaxRecordCount:void 0},
mensuration:{supportsDistanceAndAngle:r,supportsAreaAndPerimeter:r,supportsPointOrCentroid:r,supportsHeightFromBaseAndTop:l&&m.includes("base-top height"),supportsHeightFromBaseAndTopShadow:l&&m.includes("base-top shadow height"),supportsHeightFromTopAndTopShadow:l&&m.includes("top-top shadow height"),supports3D:l&&m.includes("3d")}}};v._createClass(O,[{key:"_rasterFunctionNamesIndex",get:function(){const b=new Map;if(!this.rasterFunctionInfos||u.isSome(this.rasterFunctionInfos)&&1>this.rasterFunctionInfos.length)return b;
u.isSome(this.rasterFunctionInfos)&&this.rasterFunctionInfos.forEach(a=>{b.set(a.name.toLowerCase().replace(/ /gi,"_"),a.name)});return b}},{key:"fieldsIndex",get:function(){return this.fields?new ra(this.fields):null}},{key:"format",set:function(b){b&&Na.has(b.toLowerCase())&&this._set("format",b.toLowerCase())}},{key:"mosaicRule",set:function(b){b&&b.mosaicMethod&&(b=J.fromJSON({...b.toJSON(),mosaicMethod:b.mosaicMethod,mosaicOperation:b.mosaicOperation}));this._set("mosaicRule",b)}},{key:"parsedUrl",
get:function(){return na.urlToObject(this.url)}},{key:"renderer",set:function(b){this.loaded&&(b=this._configRenderer(b));this._set("renderer",b)}},{key:"rasterFields",get:function(){const b=this._rasterAttributeTableFieldPrefix||"Raster.";var a=new I({name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"string"});const c=new I({name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"string"}),d=new I({name:"Raster.ServicePixelValue.Raw",
alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"string"});let e=this.fields?aa.clone(this.fields):[];e.push(c);this.capabilities?.operations.supportsQuery&&this.fields&&0<this.fields.length&&e.push(a);10.4<=this.version&&u.isSome(this.rasterFunctionInfos)&&this.rasterFunctionInfos.some(g=>"none"===g.name.toLowerCase())&&e.push(d);u.isSome(this.rasterFunctionInfos)&&this.rasterFunctionInfos.filter(g=>"none"!==g.name.toLowerCase()).forEach(g=>{e.push(new I({name:"Raster.ServicePixelValue."+
g.name,alias:g.name,domain:null,editable:!1,length:50,type:"string"}))});this._isVectorDataSet()&&(e.push(new I({name:"Raster.Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"double"})),e.push(new I({name:"Raster.Direction",alias:"Direction",domain:null,editable:!1,type:"double"})));({attributeTable:a}=this.rasterInfo??{});u.isSome(a)&&(a=a.fields.filter(g=>"esriFieldTypeOID"!==g.type&&"value"!==g.name.toLowerCase()).map(g=>{const n=aa.clone(g);n.name=b+g.name;return n}),e=e.concat(a));
return e}},{key:"renderingRule",set:function(b){b&&b.rasterFunction&&(b=K.fromJSON({...b.toJSON(),rasterFunction:b.rasterFunction,rasterFunctionArguments:b.rasterFunctionArguments}));this._set("renderingRule",b)}}]);return O}(h);k.__decorate([q.property()],h.prototype,"_functionRasterInfos",void 0);k.__decorate([q.property()],h.prototype,"_rasterJobHandler",void 0);k.__decorate([q.property()],h.prototype,"_cachedRendererJson",void 0);k.__decorate([q.property({readOnly:!0})],h.prototype,"_serviceSupportsMosaicRule",
void 0);k.__decorate([C.reader("_serviceSupportsMosaicRule",["currentVersion","fields"])],h.prototype,"readServiceSupportsMosaicRule",null);k.__decorate([q.property()],h.prototype,"_rasterAttributeTableFieldPrefix",void 0);k.__decorate([q.property({readOnly:!0})],h.prototype,"_rasterFunctionNamesIndex",null);k.__decorate([q.property()],h.prototype,"adjustAspectRatio",void 0);k.__decorate([q.property({type:[B.Integer],json:{write:!0}})],h.prototype,"bandIds",void 0);k.__decorate([C.reader("bandIds")],
h.prototype,"readBandIds",null);k.__decorate([q.property({readOnly:!0,json:{read:!1}})],h.prototype,"capabilities",void 0);k.__decorate([C.reader("service","capabilities",["capabilities","currentVersion","serviceDataType"])],h.prototype,"readCapabilities",null);k.__decorate([q.property({type:Number})],h.prototype,"compressionQuality",void 0);k.__decorate([H.writer("compressionQuality")],h.prototype,"writeCompressionQuality",null);k.__decorate([q.property({type:Number})],h.prototype,"compressionTolerance",
void 0);k.__decorate([H.writer("compressionTolerance")],h.prototype,"writeCompressionTolerance",null);k.__decorate([q.property({json:{read:{source:"copyrightText"}}})],h.prototype,"copyright",void 0);k.__decorate([q.property({readOnly:!0,dependsOn:["_serviceSupportsMosaicRule"]})],h.prototype,"defaultMosaicRule",void 0);k.__decorate([C.reader("defaultMosaicRule",["defaultMosaicMethod"])],h.prototype,"readDefaultMosaicRule",null);k.__decorate([q.property({type:String,json:{name:"layerDefinition.definitionExpression",
write:{enabled:!0,allowNull:!0}}})],h.prototype,"definitionExpression",void 0);k.__decorate([q.property({readOnly:!0,constructOnly:!0})],h.prototype,"exportImageServiceParameters",void 0);k.__decorate([q.property()],h.prototype,"rasterInfo",void 0);k.__decorate([q.property({readOnly:!0,type:[I]})],h.prototype,"fields",void 0);k.__decorate([q.property({readOnly:!0})],h.prototype,"fieldsIndex",null);k.__decorate([q.property({type:"png png8 png24 png32 jpg bmp gif jpgpng lerc tiff".split(" "),json:{write:!0}})],
h.prototype,"format",null);k.__decorate([C.reader("service","format",["serviceDataType"])],h.prototype,"readFormat",null);k.__decorate([q.property({type:U})],h.prototype,"fullExtent",void 0);k.__decorate([q.property({readOnly:!0})],h.prototype,"hasMultidimensions",void 0);k.__decorate([q.property({json:{read:{source:"maxImageHeight"}}})],h.prototype,"imageMaxHeight",void 0);k.__decorate([q.property({json:{read:{source:"maxImageWidth"}}})],h.prototype,"imageMaxWidth",void 0);k.__decorate([q.property({type:String,
json:{type:L.interpolationKebab.jsonValues,read:L.interpolationKebab.read,write:L.interpolationKebab.write}})],h.prototype,"interpolation",void 0);k.__decorate([q.property()],h.prototype,"minScale",void 0);k.__decorate([C.reader("service","minScale")],h.prototype,"readMinScale",null);k.__decorate([q.property()],h.prototype,"maxScale",void 0);k.__decorate([C.reader("service","maxScale")],h.prototype,"readMaxScale",null);k.__decorate([q.property({type:J})],h.prototype,"mosaicRule",null);k.__decorate([C.reader("mosaicRule",
["mosaicRule","defaultMosaicMethod"])],h.prototype,"readMosaicRule",null);k.__decorate([H.writer("mosaicRule")],h.prototype,"writeMosaicRule",null);k.__decorate([q.property()],h.prototype,"multidimensionalInfo",void 0);k.__decorate([q.property({type:ta,json:{write:!0}})],h.prototype,"multidimensionalSubset",void 0);k.__decorate([q.property({json:{type:B.Integer}})],h.prototype,"noData",void 0);k.__decorate([H.writer("noData")],h.prototype,"writeNoData",null);k.__decorate([q.property({type:String,
json:{type:L.noDataInterpretationKebab.jsonValues,read:L.noDataInterpretationKebab.read,write:L.noDataInterpretationKebab.write}})],h.prototype,"noDataInterpretation",void 0);k.__decorate([q.property({type:String,readOnly:!0,json:{read:{source:["fields"]}}})],h.prototype,"objectIdField",void 0);k.__decorate([C.reader("objectIdField")],h.prototype,"readObjectIdField",null);k.__decorate([q.property({})],h.prototype,"geometryType",void 0);k.__decorate([q.property({})],h.prototype,"typeIdField",void 0);
k.__decorate([q.property({})],h.prototype,"types",void 0);k.__decorate([q.property({readOnly:!0})],h.prototype,"parsedUrl",null);k.__decorate([q.property({type:Function})],h.prototype,"pixelFilter",void 0);k.__decorate([q.property()],h.prototype,"raster",void 0);k.__decorate([q.property({readOnly:!0})],h.prototype,"sourceType",void 0);k.__decorate([C.reader("sourceType",["serviceSourceType","fields"])],h.prototype,"readSourceType",null);k.__decorate([q.property()],h.prototype,"viewId",void 0);k.__decorate([q.property({types:R.rasterRendererTypes,
json:{name:"layerDefinition.drawingInfo.renderer",origins:{"web-scene":{types:R.websceneRasterRendererTypes,name:"layerDefinition.drawingInfo.renderer",write:{overridePolicy(F){return{enabled:F&&"vector-field"!==F.type&&"flow"!==F.type}}}}}}})],h.prototype,"renderer",null);k.__decorate([C.reader("renderer")],h.prototype,"readRenderer",null);k.__decorate([H.writer("renderer")],h.prototype,"writeRenderer",null);k.__decorate([q.property()],h.prototype,"symbolizer",void 0);k.__decorate([q.property(ca.opacity)],
h.prototype,"opacity",void 0);k.__decorate([q.property({readOnly:!0})],h.prototype,"rasterFields",null);k.__decorate([q.property({constructOnly:!0})],h.prototype,"rasterFunctionInfos",void 0);k.__decorate([q.property({type:K})],h.prototype,"renderingRule",null);k.__decorate([C.reader("renderingRule",["renderingRule","rasterFunctionInfos"])],h.prototype,"readRenderingRule",null);k.__decorate([H.writer("renderingRule")],h.prototype,"writeRenderingRule",null);k.__decorate([q.property()],h.prototype,
"serviceDataType",void 0);k.__decorate([q.property({readOnly:!0,type:W})],h.prototype,"spatialReference",void 0);k.__decorate([C.reader("spatialReference",["spatialReference","extent"])],h.prototype,"readSpatialReference",null);k.__decorate([q.property({json:{type:X.jsonValues}})],h.prototype,"pixelType",void 0);k.__decorate([C.reader("pixelType")],h.prototype,"readPixelType",null);k.__decorate([H.writer("pixelType")],h.prototype,"writePixelType",null);k.__decorate([q.property({constructOnly:!0,type:ua})],
h.prototype,"serviceRasterInfo",void 0);k.__decorate([q.property()],h.prototype,"sourceJSON",void 0);k.__decorate([q.property(ca.url)],h.prototype,"url",void 0);k.__decorate([q.property({readOnly:!0})],h.prototype,"version",void 0);k.__decorate([C.reader("version",["currentVersion","fields","timeInfo"])],h.prototype,"readVersion",null);return h=k.__decorate([oa.subclass("esri.layers.mixins.ArcGISImageService")],h)};Object.defineProperty(Z,Symbol.toStringTag,{value:"Module"})});